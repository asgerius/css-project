[{"tags": ["haskell", "powerset"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1473893959, "post_id": 39500812, "comment_id": 66319110, "body": "What other ways are you interested in? List comprehensions? Also I think you forgot to say that you have defined <code>type Set a = [a]</code>, and you are not using the one from <a href=\"https://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Set.html\" rel=\"nofollow noreferrer\"><code>containers</code></a>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1473894035, "post_id": 39500812, "comment_id": 66319128, "body": "the errors you are not telling us is partly due to <code>(+)</code> only working on numeric types and not lists - you should rather use  <code>(++)</code> instead."}, {"owner": {"reputation": 43, "user_id": 6383318, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10206492762785284/picture?type=large", "display_name": "TurboCrackers", "link": "https://stackoverflow.com/users/6383318/turbocrackers"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1473894278, "post_id": 39500812, "comment_id": 66319192, "body": "@epsilonhalbe Yes, I&#39;d like to use list comprehensions! Also yes, I did this before creating my function: type Set a = [a] Also I will change to ++ :)"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1473894404, "post_id": 39500812, "comment_id": 66319229, "body": "The lambda can be easily be replaced by a named function, either at the top level or in a where or let clause."}, {"owner": {"reputation": 43, "user_id": 6383318, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10206492762785284/picture?type=large", "display_name": "TurboCrackers", "link": "https://stackoverflow.com/users/6383318/turbocrackers"}, "edited": false, "score": 0, "creation_date": 1473894439, "post_id": 39500812, "comment_id": 66319236, "body": "So, I changed it with ++, but I&#39;m getting this error:     Couldn&#39;t match type <code>a&#39; with </code>[a]&#39;       <code>a&#39; is a rigid type variable bound by           the type signature for powerset :: Set a -&gt; Set (Set a)           at assignment2.hs:71:1     In the first argument of </code>(++)&#39;, namely <code>x&#39;     In the expression: x ++ (powerset xs)     In the first argument of </code>(++)&#39;, namely `[x ++ (powerset xs)]&#39;"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 6383318, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10206492762785284/picture?type=large", "display_name": "TurboCrackers", "link": "https://stackoverflow.com/users/6383318/turbocrackers"}, "edited": false, "score": 0, "creation_date": 1473895558, "post_id": 39500924, "comment_id": 66319549, "body": "OMG thank you SO much! You just made everything make way more sense to me. I have seen list comprehensions before, but I didn&#39;t really understand them. This was super helpful :) Also, my instructor was wanting us to use list comprehensions so that we understood exactly what was happening. It&#39;s a coding languages class at TAMU! I completely agree that map is important."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 2, "last_activity_date": 1473895834, "last_edit_date": 1473895834, "creation_date": 1473894256, "answer_id": 39500924, "question_id": 39500812, "link": "https://stackoverflow.com/questions/39500812/how-do-i-make-a-powerset-without-using-map-or-lambda-in-haskell/39500924#39500924", "title": "How do I make a powerset without using map or lambda in Haskell?", "body": "<p>You are almost there - if you want to use list comprehensions, which are equivalent to <code>map</code> in this case you only need a small step:</p>\n\n<pre><code>powerset (x:xs) = [x:ps | ps &lt;- powerset xs] ++ powerset xs\n</code></pre>\n\n<p><sub>\nWhat I am curious - why do you want to avoid <code>map</code>, it is one of the most important functional programming patterns you will find! But I guess that is not part of my answer - just a side note.\n</sub></p>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 6383318, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10206492762785284/picture?type=large", "display_name": "TurboCrackers", "link": "https://stackoverflow.com/users/6383318/turbocrackers"}, "edited": false, "score": 0, "creation_date": 1473895603, "post_id": 39500967, "comment_id": 66319559, "body": "I also figured out that switching [[]] and [] on the second line fixed everything! It works now, with @epsilonhalbe &#39;s solution! Thank you for your help!"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "reply_to_user": {"reputation": 43, "user_id": 6383318, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10206492762785284/picture?type=large", "display_name": "TurboCrackers", "link": "https://stackoverflow.com/users/6383318/turbocrackers"}, "edited": false, "score": 0, "creation_date": 1473897006, "post_id": 39500967, "comment_id": 66319901, "body": "@LauraAdams <code>switching [[]] and [] on the second line fixed everything</code> This might fix the compiler error, but now you have a logic error because you will just get one big long list, not a list of lists as you need."}], "tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": false, "score": 1, "last_activity_date": 1473894582, "creation_date": 1473894582, "answer_id": 39500967, "question_id": 39500812, "link": "https://stackoverflow.com/questions/39500812/how-do-i-make-a-powerset-without-using-map-or-lambda-in-haskell/39500967#39500967", "title": "How do I make a powerset without using map or lambda in Haskell?", "body": "<p>From comments:</p>\n\n<blockquote>\n  <p>a' with [a]' a' is a rigid type variable bound by the type signature for powerset :: Set a -> Set (Set a) at assignment2.hs:71:1 In the first argument of (++)', namely x' In the expression: x ++ (powerset xs) In the first argument of (++)', namely `[x ++ (powerset xs)]'</p>\n</blockquote>\n\n<p>This is because <code>powerset</code> returns a <code>Set (Set a)</code> where <code>Set</code> is just an alias for lists. Note that <code>(++)</code> concatenates two lists of the same type. Since <code>x</code> is a <code>Set a</code>, it cannot be concatenated with a <code>Set (Set a)</code>. Instead, you should use the cons operator <code>(:)</code> which appends an element to the beginning of the list.</p>\n\n<pre><code>x : powerset xs\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 6383318, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10206492762785284/picture?type=large", "display_name": "TurboCrackers", "link": "https://stackoverflow.com/users/6383318/turbocrackers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 908, "favorite_count": 1, "accepted_answer_id": 39500924, "answer_count": 2, "score": 0, "last_activity_date": 1473895834, "creation_date": 1473893503, "last_edit_date": 1473893890, "question_id": 39500812, "link": "https://stackoverflow.com/questions/39500812/how-do-i-make-a-powerset-without-using-map-or-lambda-in-haskell", "title": "How do I make a powerset without using map or lambda in Haskell?", "body": "<p>I'm trying to make a powerset in Haskell (I'm very new to it), and I can't figure out exactly what I need to do in order to make one without map. WITH map and lambda, I found this solution: </p>\n\n<pre><code>powerset :: Set a -&gt; Set (Set a)\npowerset [] = [[]]\npowerset (head:tail) = powerset tail &gt;&gt;= \\set -&gt;[set, head:set]\npowerset (x:xs) = map (x:) (powerset xs) ++ powerset xs\n</code></pre>\n\n<p>This is NOT what I want. I looked all over on other questions and couldn't find the answer I'm looking for. Help would be greatly appreciated!!</p>\n\n<p>Edit: This is what I've come up with so far.. It obviously doesn't work but I'm trying!! </p>\n\n<pre><code>powerset :: Set a -&gt; Set (Set a)\npowerset [] = [[]]\npowerset (x:xs) = [x + (powerset xs)] + powerset xs\n</code></pre>\n"}, {"tags": ["selenium", "haskell", "webdriver"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1473881993, "post_id": 39497838, "comment_id": 66314327, "body": "Insted of extracting all the options in <code>WD.findElemsFrom</code>, perhaps targeting  a specific option using a dynamically generated XPath expression like <code>&quot;&#47;&#47;option[contains(text(), &#39;SomeOption&#39;)]&quot;</code> would be faster. It seems that it would save you multiple calls to <code>WD.getText</code>."}], "answers": [{"tags": [], "owner": {"reputation": 899, "user_id": 1686629, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/783eacdab4a800eab9d786d5f5911fac?s=128&d=identicon&r=PG", "display_name": "Echo Nolan", "link": "https://stackoverflow.com/users/1686629/echo-nolan"}, "is_accepted": true, "score": 0, "last_activity_date": 1473964419, "creation_date": 1473964419, "answer_id": 39518095, "question_id": 39497838, "link": "https://stackoverflow.com/questions/39497838/how-can-i-quickly-select-an-option-from-a-dropdown-using-haskell-and-webdriver/39518095#39518095", "title": "How can I quickly select an option from a dropdown using Haskell and webdriver?", "body": "<p>Based on danidiaz's answer, I wrote this:</p>\n\n<pre><code>findFieldByLabel :: (WD.WebDriver m, MonadIO m) =&gt; Text -&gt; m WD.Element\nfindFieldByLabel str = do\n  labels :: [WD.Element] &lt;- WD.findElems $ WD.ByXPath $\n    \"//label[text() = \\\"\" &lt;&gt; str &lt;&gt; \"\\\"]\"\n  els &lt;- catMaybes &lt;$&gt; mapM (`WD.attr` \"for\") labels\n  liftIO $ els `shouldSatisfy` ((==1) . length)\n  WD.findElem $ WD.ById $ headEx els\n\nselectDropdownByLabel :: (WD.WebDriver m, MonadIO m) =&gt; Text -&gt; Text -&gt; m ()\nselectDropdownByLabel label optionName = do\n  field &lt;- findFieldByLabel label\n  targetOptions &lt;- WD.findElemsFrom field $ WD.ByXPath $\n    \"option[text() = \\\"\" &lt;&gt; optionName &lt;&gt; \"\\\"]\"\n  liftIO $ targetOptions `shouldSatisfy` ((==1) . length)\n  WD.click $ headEx targetOptions\n</code></pre>\n\n<p>I use it like this:</p>\n\n<pre><code>selectDropdownByLabel \"Country of residence\" \"United States\"\n</code></pre>\n\n<p>The original solution took around 2.5 seconds, this is around 0.16. Big improvement, thanks danidiaz!</p>\n"}], "owner": {"reputation": 899, "user_id": 1686629, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/783eacdab4a800eab9d786d5f5911fac?s=128&d=identicon&r=PG", "display_name": "Echo Nolan", "link": "https://stackoverflow.com/users/1686629/echo-nolan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 1, "accepted_answer_id": 39518095, "answer_count": 1, "score": 2, "last_activity_date": 1473964419, "creation_date": 1473879786, "last_edit_date": 1495535244, "question_id": 39497838, "link": "https://stackoverflow.com/questions/39497838/how-can-i-quickly-select-an-option-from-a-dropdown-using-haskell-and-webdriver", "title": "How can I quickly select an option from a dropdown using Haskell and webdriver?", "body": "<p>I have a site with a <code>&lt;select&gt;</code> that has more than 100 <code>&lt;option&gt;</code>s in it, one for every country in the world. My test needs to select one. My current solution - below - takes around 2.5 seconds. I'd like it to be much faster.\n</p>\n\n<pre><code>findChildrenByLabel :: (WD.WebDriver m, MonadIO m) =&gt;\n  Text -&gt; Text -&gt; m [WD.Element]\nfindChildrenByLabel label tagName = do\n  parentEl &lt;- findFieldByLabel label\n  WD.findElemsFrom parentEl $ WD.ByTag tagName\n\nfindChildByLabelF :: (WD.WebDriver m, MonadIO m) =&gt;\n  Text -&gt; Text -&gt; (WD.Element -&gt; m Bool) -&gt; m WD.Element\nfindChildByLabelF label tagName f = do\n  children &lt;- findChildrenByLabel label tagName\n  child &lt;- filterM f children\n  liftIO $ child `shouldSatisfy` ((==1) . length)\n  return (headEx child)\n\nselectDropdownByLabel :: (WD.WebDriver m, MonadIO m) =&gt; Text -&gt; Text -&gt; m ()\nselectDropdownByLabel label optionName = do\n  targetOption &lt;- findChildByLabelF\n    label \"option\" (\\el -&gt; (== optionName) &lt;$&gt; WD.getText el)\n  WD.click targetOption\n</code></pre>\n\n<p>I found <a href=\"https://stackoverflow.com/questions/7232544/selenium-webdriver-and-dropdown-boxes\">this SO answer</a> in Java, but there doesn't seem to be anything like <code>Selenium.Support</code> or <code>SelectByText</code> for Haskell.</p>\n"}, {"tags": ["haskell", "cairo", "gtk2hs"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1473875837, "creation_date": 1473875837, "answer_id": 39496828, "question_id": 39496319, "link": "https://stackoverflow.com/questions/39496319/how-to-check-whether-render-state-is-saved-or-not-in-gtk2hs-cairo-to-prevent-sca/39496828#39496828", "title": "How to check whether render state is saved or not in Gtk2hs Cairo to prevent scaling image on resizing window in Haskell", "body": "<p>The <code>save</code> and <code>restore</code> actions are not really related to whether the image gets recomputed. However there is a demo included with gtk2hs that shows how to cache the result of executing a <code>Cairo</code> action, see <a href=\"https://github.com/gtk2hs/gtk2hs/blob/master/cairo/demo/Clock.hs\" rel=\"nofollow\">cairo/demo/Clock.hs</a>, especially lines 320-404 of <code>main</code>:</p>\n\n<pre><code>  let redrawStaticLayers = do\n        (width, height) &lt;- widgetGetSize window\n        drawWin &lt;- widgetGetDrawWindow window\n        background &lt;- createImageSurface FormatARGB32 width height\n        foreground &lt;- createImageSurface FormatARGB32 width height\n        let clear = do\n              save\n              setOperator OperatorClear\n              paint\n              restore\n        renderWith background $ do\n          clear\n          drawClockBackground True width height\n        renderWith foreground $ do\n          clear\n          drawClockForeground True width height\n        writeIORef backgroundRef (Just background)\n        writeIORef foregroundRef (Just foreground)\n\n  onRealize window redrawStaticLayers\n\n  sizeRef &lt;- newIORef (initialSize, initialSize)\n  timeoutHandlerRef &lt;- newIORef Nothing\n  window `on` configureEvent $ do\n    (w,h) &lt;- eventSize\n    liftIO $ do\n    size &lt;- readIORef sizeRef\n    writeIORef sizeRef (w,h)\n    when (size /= (w,h)) $ do\n\n      background &lt;- readIORef backgroundRef\n      foreground &lt;- readIORef foregroundRef\n      maybe (return ()) surfaceFinish background\n      maybe (return ()) surfaceFinish foreground\n\n      writeIORef backgroundRef Nothing\n      writeIORef foregroundRef Nothing\n\n      timeoutHandler &lt;- readIORef timeoutHandlerRef\n      maybe (return ()) timeoutRemove timeoutHandler\n\n      handler &lt;- timeoutAddFull (do\n        writeIORef timeoutHandlerRef Nothing\n        redrawStaticLayers\n        widgetQueueDraw window\n        return False\n        ) priorityDefaultIdle 300\n      writeIORef timeoutHandlerRef (Just handler)\n\n    return False\n\n  window `on` exposeEvent $ do\n    drawWin &lt;- eventWindow\n    exposeRegion &lt;- eventRegion\n    liftIO $ do\n    (width, height) &lt;- drawableGetSize drawWin\n\n    background &lt;- readIORef backgroundRef\n    foreground &lt;- readIORef foregroundRef\n\n    renderWithDrawable drawWin $ do\n      region exposeRegion\n      clip\n\n      save\n      setOperator OperatorSource\n      setSourceRGBA 0 0 0 0\n      paint\n      restore\n\n      case background of\n        Nothing -&gt; drawClockBackground False width height\n        Just background -&gt; do\n          setSourceSurface background 0 0\n          paint\n\n      drawClockHands (isJust background) width height\n\n      case foreground of\n        Nothing -&gt; drawClockForeground False width height\n        Just foreground -&gt; do\n          setSourceSurface foreground 0 0\n          paint\n\n    return True\n</code></pre>\n"}], "owner": {"reputation": 1690, "user_id": 5691928, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/pm6iL.jpg?s=128&g=1", "display_name": "Ratan Senapathy", "link": "https://stackoverflow.com/users/5691928/ratan-senapathy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1473875837, "creation_date": 1473873826, "question_id": 39496319, "link": "https://stackoverflow.com/questions/39496319/how-to-check-whether-render-state-is-saved-or-not-in-gtk2hs-cairo-to-prevent-sca", "title": "How to check whether render state is saved or not in Gtk2hs Cairo to prevent scaling image on resizing window in Haskell", "body": "<p>I am trying to draw some simple images in gtk2hs cairo. I know you can save the current state using <code>save</code> command and restore using <code>restore</code> command. Is thee a way to check is a state is currently saved. I do not want my image to scale when resizing the window or is there a better to prevent resizing. I do not want to recompute the image every time the window is resized.</p>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1473881597, "post_id": 39495993, "comment_id": 66314145, "body": "The Functor constrain on your definition of <code>hoistFree</code> is wrong, isn&#39;t it? The inferred type is <code>Functor f =&gt;   (f (Free g a) -&gt; g (Free g a)) -&gt; Free f a -&gt; Free g a</code>."}, {"owner": {"reputation": 360, "user_id": 2626557, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5495eeaa39169e3064453987524aae27?s=128&d=identicon&r=PG", "display_name": "stackman", "link": "https://stackoverflow.com/users/2626557/stackman"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1473882102, "post_id": 39495993, "comment_id": 66314378, "body": "@michael I don&#39;t know why the wider type is not inferred. This is a mystery to me."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1473882796, "post_id": 39495993, "comment_id": 66314713, "body": "The type inferencer doesn&#39;t infer rank 2 types, or is that what you mean?  This is the &#39;wider type&#39; in the sense that it applies to more cases."}, {"owner": {"reputation": 360, "user_id": 2626557, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5495eeaa39169e3064453987524aae27?s=128&d=identicon&r=PG", "display_name": "stackman", "link": "https://stackoverflow.com/users/2626557/stackman"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1473884565, "post_id": 39495993, "comment_id": 66315588, "body": "@michael Yes, that&#39;s what I mean."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1473885464, "post_id": 39495993, "comment_id": 66316044, "body": "In this case wouldn&#39;t it just be wrong to infer the rank 2 argument? It&#39;s intuitively an arbitrary restriction on the first argument, if we consider the definition as a random bit of Haskell.  In more interesting cases the type checker won&#39;t be able to see that the definition is good without the explicit rank 2 signature."}], "answers": [{"comments": [{"owner": {"reputation": 360, "user_id": 2626557, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5495eeaa39169e3064453987524aae27?s=128&d=identicon&r=PG", "display_name": "stackman", "link": "https://stackoverflow.com/users/2626557/stackman"}, "edited": false, "score": 0, "creation_date": 1473974728, "post_id": 39497394, "comment_id": 66356928, "body": "Thanks for the answer. But even if f is always a natural transformation mathematically speaking, there may be several non-equivalent ways to implement it, e.g. <a href=\"http://blog.sigfpe.com/2008/02/how-many-functions-are-there-from-to.html\" rel=\"nofollow noreferrer\">this post</a>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 360, "user_id": 2626557, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5495eeaa39169e3064453987524aae27?s=128&d=identicon&r=PG", "display_name": "stackman", "link": "https://stackoverflow.com/users/2626557/stackman"}, "edited": false, "score": 0, "creation_date": 1473980305, "post_id": 39497394, "comment_id": 66358787, "body": "@stackman True. Maybe someone else can provide more insight. Understanding the precise strictness level of a higher-level function is quite challenging."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1473878116, "creation_date": 1473878116, "answer_id": 39497394, "question_id": 39495993, "link": "https://stackoverflow.com/questions/39495993/definition-of-hoistfree/39497394#39497394", "title": "Definition of hoistfree", "body": "<p><strong>Question 1</strong></p>\n\n<p>Because of type inference, which chooses <code>&lt;$&gt;</code> from <code>g</code>. Indeed, in</p>\n\n<pre><code>Free (hoistFree f &lt;$&gt; f as)\n</code></pre>\n\n<p><code>f as</code> has type <code>g &lt;something&gt;</code>, hence the <code>&lt;$&gt;</code> is the one given by <code>Functor g</code>.</p>\n\n<p><strong>Question 2</strong></p>\n\n<p>I think that, in Haskell, <code>f</code> is always a natural transformation. Any polymorphic function <code>f a -&gt; g a</code> must be natural in <code>a</code>, by parametricity / free theorem.\nBoth definitions being equivalent, I'm not sure if any one is the \"best\". Maybe yours is. Or maybe the original one has better performance in practice. It looks a bit as the <code>foldr</code> vs <code>foldl'</code> argument on associative operators, where there's no clear winner.</p>\n\n<p><strong>Question 3</strong> No idea.</p>\n"}], "owner": {"reputation": 360, "user_id": 2626557, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5495eeaa39169e3064453987524aae27?s=128&d=identicon&r=PG", "display_name": "stackman", "link": "https://stackoverflow.com/users/2626557/stackman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 1, "answer_count": 1, "score": 8, "last_activity_date": 1473878116, "creation_date": 1473872503, "question_id": 39495993, "link": "https://stackoverflow.com/questions/39495993/definition-of-hoistfree", "title": "Definition of hoistfree", "body": "<p>I have some questions concerning the function hoistfree from the Haskell library <a href=\"http://hackage.haskell.org/package/free-4.12.4/docs/src/Control-Monad-Free.html#hoistfree\">Control.Monad.Free</a>. Given a transformation <code>f</code> between two functors, hoistfree f produces a morphism between the corresponding free monads. Here is its definition.</p>\n\n<pre><code>hoistFree :: Functor g =&gt; (forall a. f a -&gt; g a) -&gt; Free f b -&gt; Free g b\nhoistFree _ (Pure a)  = Pure a\nhoistFree f (Free as) = Free (hoistFree f &lt;$&gt; f as)\n</code></pre>\n\n<p><strong>Question 1</strong> How does Haskell know that <code>&lt;$&gt;</code> is the map associated to <code>g</code> and not to <code>f</code>, <code>Free f</code> or <code>Free g</code>?</p>\n\n<p><strong>Question 2</strong> Why hoistfree has not been defined as </p>\n\n<pre><code>hoistFree :: Functor g =&gt; (forall a. f a -&gt; g a) -&gt; Free f b -&gt; Free g b\nhoistFree _ (Pure a)  = Pure a\nhoistFree f (Free as) = Free (f (hoistFree f &lt;$&gt; as))\n</code></pre>\n\n<p>?</p>\n\n<p>If <code>f</code> is a natural transformation, these two definitions coincide. The second definition however always satisfies the relation</p>\n\n<pre><code>hoistfree f = iter (wrap . f) . map return\n</code></pre>\n\n<p>which looks pretty natural. Furthermore, there are a few basic functions that can be expressed using <code>iter_map f g = iter f . map g</code>. For example,</p>\n\n<pre><code>(=&lt;&lt;) f = iter_map wrap f\n</code></pre>\n\n<p><strong>Question 3</strong> Is iter_map defined somewhere? It looks like a monadic mapreduce. I didn't see it in the base library. Is there some gain in fusioning iter and map? In a few other languages, this is the case, but I am not sure for Haskell.</p>\n"}, {"tags": ["haskell", "attoparsec"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473879822, "post_id": 39494530, "comment_id": 66313200, "body": "Using a parser is a <i>solution</i> to a problem; what is the <i>actual problem</i>?"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473870351, "post_id": 39495163, "comment_id": 66308173, "body": "Why not use something at least vaguely like <code>MaybeT (StateT (Bool, Bool, Bool) Parser)</code> to interleave counting with parsing and allow an early failure if too many are seen?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473870730, "post_id": 39495163, "comment_id": 66308418, "body": "You can do that easily with parsec, but as I recall implementing stateful parses is not that easy with attoparsec. And even if you did I&#39;m sure this approach would be more performant. Of course, performance for any implementation will depend on what kind of bad inputs you expect."}, {"owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "edited": false, "score": 0, "creation_date": 1473936523, "post_id": 39495163, "comment_id": 66334511, "body": "Thanks, I didn&#39;t realize how <code>guard</code> could help here."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1473869512, "creation_date": 1473869512, "answer_id": 39495163, "question_id": 39494530, "link": "https://stackoverflow.com/questions/39494530/parser-enforcing-unicity-when-order-is-not-known/39495163#39495163", "title": "Parser: Enforcing unicity when order is not known", "body": "<p>There are a couple of issues with your code:</p>\n\n<p>Firstly, it doesn't enforce exactly one <code>x</code>, <code>y</code> and <code>z</code> in the string. For instance, it will accept <code>xxx\\n</code></p>\n\n<p>Secondly, it's very inefficient. Consider how <code>xyz1</code> is parsed when given the string <code>aaaaaaaaaz</code>:</p>\n\n<ol>\n<li><p>We first try <code>p 'x'</code>. This starts by parsing all of the <code>a</code> characters and then finds a <code>z</code>. Since <code>z</code> is not <code>x</code>, the entire <code>p 'x'</code> parser fails.</p></li>\n<li><p>Then we try <code>p 'y'</code>. This re-parses all of the <code>a</code> characters and then finds the <code>z</code> again. Since <code>z</code> is not <code>y</code> the entire <code>p 'y'</code> parser fails.</p></li>\n<li><p>On the third try we succeed, only after re-parsing all of the <code>a</code> characters for the third time.</p></li>\n</ol>\n\n<p>It would be better to write something like:</p>\n\n<pre><code>parse = do\n   s &lt;- A8.takeWhile (\\x -&gt; elem x \"abcxyz\")\n   let xs = count 'x' s\n       ys = count 'y' s\n       zs = count 'z' s\n   guard $ xs == 1 &amp;&amp; ys == 1 &amp;&amp; zs == 1\n   return s\n</code></pre>\n\n<p>The function <code>count</code> is from <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString-Char8.html#v:count\" rel=\"nofollow\"><code>Data.ByteString.Char8</code></a> and <code>guard</code> is from <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#v:guard\" rel=\"nofollow\"><code>Control.Monad</code></a></p>\n"}], "owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 39495163, "answer_count": 1, "score": 1, "last_activity_date": 1473869512, "creation_date": 1473867485, "last_edit_date": 1473868271, "question_id": 39494530, "link": "https://stackoverflow.com/questions/39494530/parser-enforcing-unicity-when-order-is-not-known", "title": "Parser: Enforcing unicity when order is not known", "body": "<p>Using Attoparsec, I am trying to match strings containing exactly 1 'x', 1 'y', and 1 'z', and any number of 'a', 'b', or 'c', without any constraint on the order of each char.</p>\n\n<p>For instance, \"abbb<strong>z</strong>ac<strong>y</strong>aaa<strong>x</strong>cba\" and \"abbb<strong>z</strong>ac<strong>x</strong>aaa<strong>y</strong>cba\" should be a match but the following should not :</p>\n\n<ul>\n<li>\"abbb<strong>z</strong>ac<strong>y</strong>aaacba\" (reason: no 'x')</li>\n<li>\"abbb<strong>z</strong>ac<strong>y</strong>aaa<strong>x</strong>cb<strong>x</strong>a\" (reason: duplicate 'x')</li>\n</ul>\n\n<p>The best I've been able to do so far is this:</p>\n\n<pre><code>import qualified Data.Attoparsec.ByteString.Char8 as A8\nimport qualified Data.ByteString.Char8 as B8 (pack)\n\np ch = do\n    abcs &lt;- A8.many' (A8.choice [A8.char 'a', A8.char 'b', A8.char 'c'])\n    x    &lt;- A8.char ch\n    return $ concat [[x],abcs]\n\nparse = do\n    xyz1 &lt;- A8.choice [p 'x', p 'y', p 'z']\n    xyz2 &lt;- A8.choice [p 'x', p 'y', p 'z']\n    xyz3 &lt;- A8.choice [p 'x', p 'y', p 'z']\n    final &lt;- A8.manyTill (A8.choice [A8.char 'a', A8.char 'b', A8.char 'c']) $ A8.char '\\n'\n    return (xyz1, xyz2, xyz3, final)\n</code></pre>\n\n<p>(arbitrarily, I chose to stop the parsing with '\\n', but that's just to pick a simple example).</p>\n\n<p>then trying in ghci:</p>\n\n<pre><code>Prelude&gt; A8.parseTest parse $ B8.pack \"abbbzacyaaaxcba\\n\"\nDone \"\" (\"zabbb\",\"yac\",\"xaaa\", \"cba\")\nPrelude&gt; A8.parseTest parse $ B8.pack \"abbbzacyaaacba\\n\"\nFail \"aaacba\\n\" [] \"Failed reading: empty\"\nPrelude&gt; A8.parseTest parse $ B8.pack \"abbbzacyaaaxcbxa\\n\"\nFail \"xa\\n\" [] \"Failed reading: empty\"\n</code></pre>\n\n<p>But it looks very clunky, and it does not scale easily to a list of unique characters (eg I am given a givenchars :: [Char] list without duplicates and I want to match any string made of all the givenchars and of any 'a','b','c's in between, in any order).</p>\n\n<p>Is there a better, more elegant, and scalable way to do this? </p>\n\n<p>PS: I am not looking for a regex solution as it would not apply to my real-life problem. I need to use a parser.</p>\n"}, {"tags": ["haskell", "charts"], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 1, "last_activity_date": 1473863798, "creation_date": 1473863798, "answer_id": 39493216, "question_id": 39491774, "link": "https://stackoverflow.com/questions/39491774/color-scheme-in-haskell-chart/39493216#39493216", "title": "Color scheme in Haskell-Chart", "body": "<p>Did you look at the documentation?</p>\n\n<p>I will only answer the part about background and leave the rest to you, as it shoud be possible to get all the information you seek in the docs, otherwise aks a new, more concrete question.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/Chart-1.8/docs/Graphics-Rendering-Chart-Layout.html\" rel=\"nofollow\">http://hackage.haskell.org/package/Chart-1.8/docs/Graphics-Rendering-Chart-Layout.html</a> for example provides the type <code>Layout x y</code> where you can set the background.</p>\n"}], "owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 39493216, "answer_count": 1, "score": 0, "last_activity_date": 1473863798, "creation_date": 1473859725, "question_id": 39491774, "link": "https://stackoverflow.com/questions/39491774/color-scheme-in-haskell-chart", "title": "Color scheme in Haskell-Chart", "body": "<p>I use Haskell-Chart according to the example <a href=\"https://github.com/timbod7/haskell-chart/wiki/example-1\" rel=\"nofollow\">example-1</a>.Everything works fine. But I can`t get, how it is possible to change colors (backgound, axes, ...)? \nThank you!</p>\n"}, {"tags": ["haskell", "vim", "autocomplete", "haskell-stack", "ghc-mod"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1473866955, "post_id": 39491226, "comment_id": 66306098, "body": "It&#39;s rather hard to help you without knowing anything about how you&#39;ve setup your autocompletion.  There are many possible ways to do what you describe."}], "owner": {"reputation": 63, "user_id": 6411681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6becd74614e4f918fa11a1054da3974a?s=128&d=identicon&r=PG&f=1", "display_name": "Tunga", "link": "https://stackoverflow.com/users/6411681/tunga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 756, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1473858318, "creation_date": 1473858318, "question_id": 39491226, "link": "https://stackoverflow.com/questions/39491226/haskells-autocompletion-in-vim", "title": "haskell&#39;s autocompletion in vim", "body": "<p>I went through tutorials about how to create vim \nenvironment with autocomplete words and functions from other modules. And it's fine until I'll change something in my previously created modules. In other files those changes are invisible and vim autocompletes words and functions that doesn't exist anymore and does not help with new functions.</p>\n\n<p>Is there a way to fix this and update ghc-mod data in actually opened files?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1473854550, "post_id": 39489880, "comment_id": 66297431, "body": "<code>brick</code> depends on <code>vty</code> which <a href=\"https://github.com/coreyoconnor/vty#windows\" rel=\"nofollow noreferrer\">does not support windows</a>."}, {"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "reply_to_user": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1473854671, "post_id": 39489880, "comment_id": 66297504, "body": "But I&#39;m inside MSYS2, still not enough?"}, {"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1473854744, "post_id": 39489880, "comment_id": 66297534, "body": "As I understand it, msys is just native windows, i.e. you can only use windows APIs."}, {"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "reply_to_user": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1473854947, "post_id": 39489880, "comment_id": 66297657, "body": "This is bizzare. So many linux tools way more complicated has been &#39;ported&#39; on MSYS2, <code>vty</code> should be a piece of cake. Anway, this isn&#39;t what the error told me though. it says my include dir is a relative path"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 266, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1484966595, "creation_date": 1473854265, "last_edit_date": 1484966595, "question_id": 39489880, "link": "https://stackoverflow.com/questions/39489880/stack-in-msys2-extra-include", "title": "stack in MSYS2 extra include", "body": "<p>I am on Windows 10 with MSYS2\nIn the MINGW64 shell,i try to install the brick package which requires ncurse.h</p>\n\n<pre><code>stack install brick\n</code></pre>\n\n<p>I have added the include path in <code>stack.yaml</code>\nbut stack still complains:\nAny ideas how to fix this?</p>\n\n<pre><code>brick-0.1.0.0: build\nPreprocessing library brick-0.1.0.0...\nIn-place registering brick-0.1.0.0...\nsetup-Simple-Cabal-1.22.5.0-ghc-7.10.3.exe: 'C:\\Users\\user\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-7.10.3\\bin\\ghc-pkg.exe'\nexited with an error:\nbrick-0.1.0.0: Warning: haddock-interfaces: C:\\msys64\\home\\  user\\haskell\\brick\\.stack-work\\dist\\2672c1f3\\doc\\html\\brick\\brick.haddock\ndoesn't exist or isn't a file\nbrick-0.1.0.0: Warning: haddock-html: C:\\msys64\\home\\user\\haskell\\brick\\.stack-work\\dist\\2672c1f3\\doc\\html\\brick doesn't exist or\nisn't a directory\nbrick-0.1.0.0: include-dirs: /usr/include/ncurses is a relative path which\nmakes no sense (as there is nothing for it to be relative to). You can make\npaths relative to the package database itself by using ${pkgroot}. (use\n--force to override)\n\n--  While building package brick-0.1.0.0 using:\n      C:\\Users\\user\\AppData\\Roaming\\stack\\setup-exe-cache\\x86_64-windows\\setup-Simple-Cabal-1.22.5.0-ghc-7.10.3.exe --builddir=.stack-work\\dist\\2672c1f3 build lib:brick exe:brick-exe --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n"}, {"tags": ["haskell", "agda"], "comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1473839523, "post_id": 39484310, "comment_id": 66288557, "body": "You might find <a href=\"http://stackoverflow.com/questions/31105947/eliminating-a-maybe-at-the-type-level\">Eliminating a Maybe at the type level</a> useful."}, {"owner": {"reputation": 748, "user_id": 2128597, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/100000157613328/picture?type=large", "display_name": "\u76db\u5b89\u5b89", "link": "https://stackoverflow.com/users/2128597/%e7%9b%9b%e5%ae%89%e5%ae%89"}, "edited": false, "score": 0, "creation_date": 1473876295, "post_id": 39484310, "comment_id": 66311364, "body": "In contrast to the technical answers below, I want to point out you&#39;re are thinking non-functionally. It&#39;s like someone who wants to get rid of the <code>IO</code> monad and writes imperative code everywhere in Haskell: generally, there is no way to extract the underlying type from a term of type <code>Maybe</code> whatever; It&#39;s the gist of strong functional programming languages such as Agda, so you must pass the monad all the way around until you find a good way to encode it into value of another type."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1473837656, "post_id": 39484577, "comment_id": 66287543, "body": "I had just started seeing that idiom around with <code>True</code> but didn&#39;t really dig in. Thanks."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 10, "last_activity_date": 1508619841, "last_edit_date": 1508619841, "creation_date": 1473837436, "answer_id": 39484577, "question_id": 39484310, "link": "https://stackoverflow.com/questions/39484310/known-pattern-match-in-agda/39484577#39484577", "title": "Known pattern match in agda", "body": "<p>The usual deal is to write something like</p>\n\n<pre><code>Just : {X : Set} -&gt; Maybe X -&gt; Set\nJust (just x) = One -- or whatever you call the fieldless record type\nJust nothing = Zero\n\njustify : {X : Set}(m : Maybe X){p : Just m} -&gt; X\njustify (just x) = x\njustify nothing {()}\n</code></pre>\n\n<p>If m computes to a success, the type of p is One and the value is inferred.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 2, "last_activity_date": 1474060909, "last_edit_date": 1474060909, "creation_date": 1473837444, "answer_id": 39484582, "question_id": 39484310, "link": "https://stackoverflow.com/questions/39484310/known-pattern-match-in-agda/39484582#39484582", "title": "Known pattern match in agda", "body": "<p>Well I found one way to do it, which is sortof bizarre and magical.</p>\n\n<pre><code>testTerm-checks : \u03a3 Expr (\\e -&gt; check testTerm \u2261 just e)\ntestTerm-checks = _ , refl\n\nrealTerm : Expr\nrealTerm = proj\u2081 testTerm-checks\n</code></pre>\n\n<p>This gives me the heebie jeebies, but not necessarily in a bad way.  Still interested in other ways to do it.</p>\n"}], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 39484577, "answer_count": 2, "score": 5, "last_activity_date": 1508619841, "creation_date": 1473836527, "question_id": 39484310, "link": "https://stackoverflow.com/questions/39484310/known-pattern-match-in-agda", "title": "Known pattern match in agda", "body": "<p>Roughly, I have</p>\n\n<pre><code>check : UExpr -&gt; Maybe Expr\n</code></pre>\n\n<p>And I have a test term</p>\n\n<pre><code>testTerm : UExpr\n</code></pre>\n\n<p>Which I hope will <code>check</code> successfully, after which I want to extract the resulting <code>Expr</code> and manipulate it further.  Basically</p>\n\n<pre><code>realTerm : Expr\njust realTerm = check testTerm\n</code></pre>\n\n<p>Such that this definition would fail to typecheck if <code>check testTerm</code> turned out to be <code>nothing</code>.  Is this possible?</p>\n"}, {"tags": ["haskell", "constraints", "ghc", "typeclass"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1473802866, "post_id": 39478919, "comment_id": 66277990, "body": "This is just the <code>show . read</code> problem. You need to pick a type <code>n</code> for <code>doRunFoo</code>."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1473802943, "post_id": 39478919, "comment_id": 66278026, "body": "How should the caller of <code>fooWrapperExample</code> specify which instance of <code>RunFoo</code> they want you to use in <code>fooExample</code>?"}, {"owner": {"reputation": 247, "user_id": 2104932, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/bs98N.jpg?s=128&g=1", "display_name": "matchwood", "link": "https://stackoverflow.com/users/2104932/matchwood"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1473804111, "post_id": 39478919, "comment_id": 66278391, "body": "@ReidBarton Yes that will compile but it sadly won&#39;t help with the issue here because I specifically don&#39;t want to force an particular type."}, {"owner": {"reputation": 247, "user_id": 2104932, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/bs98N.jpg?s=128&g=1", "display_name": "matchwood", "link": "https://stackoverflow.com/users/2104932/matchwood"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1473804310, "post_id": 39478919, "comment_id": 66278467, "body": "@amalloy Good question - the simple answer in that in my use case for this it doesn&#39;t have to - the real point behind the structure I was attempting to capture is that RunFooWrapper will impose a type at some point (i.e. the implementation of doRunFoo will be free to force any concrete implementation it wants at the time eg (bool :: RunSlow Bool) &lt;- x"}], "answers": [{"comments": [{"owner": {"reputation": 247, "user_id": 2104932, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/bs98N.jpg?s=128&g=1", "display_name": "matchwood", "link": "https://stackoverflow.com/users/2104932/matchwood"}, "edited": false, "score": 0, "creation_date": 1473804778, "post_id": 39479472, "comment_id": 66278604, "body": "Perfect, many thanks, this is exactly what I was looking for. I use RankNTypes in other places, but I&#39;m only just getting the hang of the way the foralls scope the type variables.   One small change is still necessary though I think - as it stands GHC complains with &#39;Couldn&#39;t match type <code>a</code> with Bool&#39;, but adding another forall seems to solve that, so <code>doRunFoo :: forall a. (forall n. RunFoo n =&gt; n a) -&gt; m a</code> ?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 247, "user_id": 2104932, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/bs98N.jpg?s=128&g=1", "display_name": "matchwood", "link": "https://stackoverflow.com/users/2104932/matchwood"}, "edited": false, "score": 0, "creation_date": 1473814581, "post_id": 39479472, "comment_id": 66281035, "body": "@sybilsleaf, that means the same thing. GHC automatically puts in <code>forall a</code>."}, {"owner": {"reputation": 247, "user_id": 2104932, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/bs98N.jpg?s=128&g=1", "display_name": "matchwood", "link": "https://stackoverflow.com/users/2104932/matchwood"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473900295, "post_id": 39479472, "comment_id": 66320659, "body": "@dfeuer That&#39;s what I thought, but I&#39;m sure when I tried it I got that compilation error. However I&#39;ve just tried again and it seems to be compiling fine now so not sure what was going on... So thanks!"}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 10, "last_activity_date": 1473803084, "last_edit_date": 1495540098, "creation_date": 1473803084, "answer_id": 39479472, "question_id": 39478919, "link": "https://stackoverflow.com/questions/39478919/why-cant-a-function-take-a-type-constrained-only-by-a-typeclass/39479472#39479472", "title": "Why can&#39;t a function take a type constrained only by a typeclass?", "body": "<h2>RankNTypes</h2>\n\n<pre><code>{-# language RankNTypes #-}    \n\nclass RunFoo m where\n  runFoo :: m a -&gt; a\n\nclass RunFooWrapper m where\n  doRunFoo :: (forall n. RunFoo n =&gt; n a) -&gt; m a\n\nfooExample :: RunFoo m =&gt; m Bool\nfooExample = undefined\n\nfooWrapperExample :: RunFooWrapper m =&gt; m Bool\nfooWrapperExample = doRunFoo fooExample\n</code></pre>\n\n\n\n<p>The <code>(forall n. RunFoo n =&gt; n a) -&gt; m a</code> is the key difference. It lets you pass in <code>fooExample</code>, which has the type <code>forall m. RunFoo m =&gt; m Bool</code> (the <code>forall</code> being implicitly added by the compiler) and so the <code>m</code> unifies with the <code>n</code> and everybody is happy. Though I cannot read minds, I believe this type reflects your true intent. You only wanted a <code>RunFoo</code> instance, nothing more, and having the <code>n</code> scoped to the first argument provides it.</p>\n\n<p>The problem was that your given code is implicitly typed as <code>forall n. RunFoo n =&gt; n a -&gt; m a</code>. That means you need to first <em>pick an <code>n</code> such that <code>RunFoo n</code></em> and then come up with a value with type <code>n a</code> to pass in as the first argument. This simple act of moving the parentheses (increasing the rank of <code>n</code>) changes the meaning entirely.</p>\n\n<p>For an example of someone who had the same problem, see <a href=\"https://stackoverflow.com/questions/33446759/understanding-haskells-rankntypes\">this Stack Overflow question</a>. For a better explanation of <code>RankNTypes</code> than I could provide, see <a href=\"https://ocharles.org.uk/blog/guest-posts/2014-12-18-rank-n-types.html\" rel=\"nofollow noreferrer\">Oliver's blog post on it</a>.</p>\n"}], "owner": {"reputation": 247, "user_id": 2104932, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/bs98N.jpg?s=128&g=1", "display_name": "matchwood", "link": "https://stackoverflow.com/users/2104932/matchwood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "accepted_answer_id": 39479472, "answer_count": 1, "score": 4, "last_activity_date": 1473805683, "creation_date": 1473800457, "last_edit_date": 1473805683, "question_id": 39478919, "link": "https://stackoverflow.com/questions/39478919/why-cant-a-function-take-a-type-constrained-only-by-a-typeclass", "title": "Why can&#39;t a function take a type constrained only by a typeclass?", "body": "<p>I don't have quite the vocabulary for phrasing this question (and therefore for searching for answers, so apologies if the answer is easily available). Consider the following</p>\n\n<pre><code>class RunFoo m where\n  runFoo :: m a -&gt; a\n\nclass RunFooWrapper m where\n  doRunFoo :: (RunFoo n) =&gt; n a -&gt; m a\n\nnewtype RunFast a = RunFast a\n\nnewtype RunSlow a = RunSlow a\n\nfooExample :: (RunFoo m) =&gt; m Bool\nfooExample = undefined\n\nfooWrapperExample :: (RunFooWrapper m) =&gt; m Bool\nfooWrapperExample = doRunFoo fooExample\n</code></pre>\n\n<p>This does not compile: <code>Could not deduce (RunFoo n0) arising from a use of \u2018doRunFoo\u2019</code>.</p>\n\n<p>It seems that the compiler (GHC 7.10) is insisting on a concrete instantiation of the <code>m</code> from <code>fooExample</code>, and is therefore refusing to continue. But in this case I can't see why the program is ill-typed - <code>fooExample</code> explicitly defines a <code>RunFoo m</code> and all <code>doRunFoo</code> requires is a <code>RunFoo x</code>. So why doesn't this work?</p>\n\n<p>As a supplementary question, is there some kind of special extension (something to do with existential types perhaps) that would allow a program like this? Ideally I'd like to be able to say that doRunFoo takes anything defined existentially (?) as <code>RunFoo m =&gt; m</code> (rather than taking any concrete instantiation of <code>RunFoo</code>). </p>\n\n<p><strong>Motivation</strong></p>\n\n<p>I'd like to create composable functions that operate on some aspect of a type constrained by a typeclass - I can provide a concrete example of what I mean if necessary!</p>\n\n<p><strong>Edit with more motivation and alternative implementation</strong></p>\n\n<p>I was curious about the answer to this question in the general case, but I thought I'd add that in the context I ran across this issue what I really wanted is for a sort of constrained delegation between monads. So I wanted to write functions in a monad constrained only by a typeclass that invoked monads in another type class. The top level function could then be run in different contexts, performing the same logic but with the underlying implementation swapped out according to the wrapping monad. As there was a one-to-one correspondence between the wrapping and the implementation monad I was able to use type families to do this, so</p>\n\n<pre><code>class (RunFoo (RunFooM m)) =&gt; RunFooWrapper m where\n  type RunFooM m :: * -&gt; *\n  doRunFoo :: RunFooM m a -&gt; m a\n\ninstance RunFooWrapper RunFooWrapperSlow where \n  type RunFooM RunFooWrapperSlow = RunSlow\n  doRunFoo :: [...]\n</code></pre>\n\n<p>This meant that the resolution of the <code>fooExample</code> <code>m</code> was determined by the class context of the wrapper monad, and seems to work fine, but it is a very narrow solution compared to that provided by haoformayor.</p>\n"}, {"tags": ["windows", "haskell", "ffmpeg", "pkg-config"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1473860320, "post_id": 39478851, "comment_id": 66301337, "body": "<a href=\"https://people.freedesktop.org/~dbn/pkg-config-guide.html\" rel=\"nofollow noreferrer\">see here</a>"}, {"owner": {"reputation": 31, "user_id": 3717652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ad83a0e9e2800ebe61089bdb7f3d3de?s=128&d=identicon&r=PG&f=1", "display_name": "WirflBirfl", "link": "https://stackoverflow.com/users/3717652/wirflbirfl"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1473959312, "post_id": 39478851, "comment_id": 66349144, "body": "@user2407038: OK this helped. But now cabal is complaining about missing c libraries: libavutil, libavformat, libavcodec, libswscale, libavdevice. I made a .pc file for every on of these. Then the error message says this: This problem can usually be solved by installing the system packages that provide these libraries (you may need the &quot;-dev&quot; versions). If the libraries are already installed but in a non-standard location then you can use the flags --extra-include-dirs= and --extra-lib-dirs= to specify where they are."}], "owner": {"reputation": 31, "user_id": 3717652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ad83a0e9e2800ebe61089bdb7f3d3de?s=128&d=identicon&r=PG&f=1", "display_name": "WirflBirfl", "link": "https://stackoverflow.com/users/3717652/wirflbirfl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 751, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1473800233, "creation_date": 1473800233, "question_id": 39478851, "link": "https://stackoverflow.com/questions/39478851/tell-pkg-config-where-to-find-packages-on-windows", "title": "Tell pkg-config where to find packages on windows", "body": "<p>I want to use the Haskell ffmpeg library under windows so I tried to install it via cabal. <br>\nAfter downloading and extracting ffmpeg shared (64bit) version to C:\\FFmpeg cabal complained that pkg-config was not installed. <br>\nI downloaded it and moved it to the bin folder of MinGw. Now cabal complains that it can not find the pkg-config package libavutil.<br><br>\nFirst part of the question:<br>\nWhat is a pkg-config package? Is it just the dll that comes with the shared version of ffmpeg?<br><br>\nSecond part:<br>\nI know pkg-config uses .pc files to describe where to look for packages and it uses the PKG_CONFIG_PATH variable to find .pc files. So how would a .pc file look when the libavutil dll is located in C:\\FFmpeg\\bin?</p>\n\n<p>PS: The dll in FFmpeg\\bin is named avutil-55.dll</p>\n\n<p>Thanks</p>\n"}, {"tags": ["parsing", "haskell", "recursion"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1473788428, "post_id": 39475820, "comment_id": 66271125, "body": "As an aside, <code>brackets</code> looks a bit more concise as <code>brackets p = char &#39;(&#39; *&gt; p &lt;* char &#39;)&#39;</code> and <code>leaf = Leaf &lt;$&gt; many1 (choice (map char [&#39;a&#39;..&#39;z&#39;]))</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1473791071, "post_id": 39475820, "comment_id": 66272547, "body": "In a sense, every recursion is infinite. E.g. <code>let x = (1, 2 + fst x) in snd x</code> looks as if it loops forever but does not. Above, <code>this</code> is  a function in disguise, and <code>&gt;&gt;=</code> is passing a different argument to it every time we recurse."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1473860532, "post_id": 39475950, "comment_id": 66301491, "body": "It is even shorter and simpler with applicative notation: <code>this = p +++ (Branch op &lt;$&gt; (p +++ brackets tree &lt;* char name) &lt;*&gt; this)</code>"}, {"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1473860613, "post_id": 39475950, "comment_id": 66301558, "body": "@user2407038 Yes indeed. I merely copied the code from wikibooks to explain how it works."}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": true, "score": 6, "last_activity_date": 1473843184, "last_edit_date": 1473843184, "creation_date": 1473788274, "answer_id": 39475950, "question_id": 39475820, "link": "https://stackoverflow.com/questions/39475820/readp-recursive-parsing/39475950#39475950", "title": "ReadP recursive parsing", "body": "<p>Let's look at the definition of <code>this</code> (I find it easier to work with the <code>do</code> notation):</p>\n\n<pre><code>let this = p +++ do a &lt;- p +++ brackets tree\n                    char name\n                    b &lt;- this\n                    return (Branch op a b)\n in this\n</code></pre>\n\n<p>So here, the only occurrence of <code>this</code> in the right hand side, is inside the second argument to the <code>+++</code> operation, which is:</p>\n\n<pre><code>do a &lt;- p +++ brackets tree\n   char name\n   b &lt;- this\n   return (Branch op a b)\n</code></pre>\n\n<p>As you can see, in this expression, <code>this</code> appears after some other operations, namely <code>a &lt;- p +++ brackets tree</code> and <code>char name</code>. This means that these other operations will be tried first before <code>this</code>. If one of them fails, then none of the subsequent operations will be tried. So for example, if <code>a &lt;- p +++ brackets tree</code> succeeds, but then the input stream does not contain a character equal to value reference by <code>name</code>, <code>char name</code> will fail and the <code>b &lt;- this</code> line will not be attempted at all. So this means that it is not necessary that <code>this</code> will recursively invoke itself <em>unconditionally</em>.</p>\n"}, {"comments": [{"owner": {"reputation": 563, "user_id": 1135884, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/f5f0766028f7bf53969634c22e1bb876?s=128&d=identicon&r=PG", "display_name": "A Friedrich", "link": "https://stackoverflow.com/users/1135884/a-friedrich"}, "edited": false, "score": 0, "creation_date": 1473958088, "post_id": 39476565, "comment_id": 66348490, "body": "Thanks for your answer. While I accepted the other one, your hint that this is an instance of &quot;tying the knot&quot; was really helpful too."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1473791448, "last_edit_date": 1473791448, "creation_date": 1473790605, "answer_id": 39476565, "question_id": 39475820, "link": "https://stackoverflow.com/questions/39475820/readp-recursive-parsing/39476565#39476565", "title": "ReadP recursive parsing", "body": "<p>Here is an alternate way of seeing the definition of <code>tree</code>:</p>\n\n<pre><code>t0 = leaf +++ brackets tree\nt1 = do a &lt;- t0 +++ (t0 +++ brackets tree)\n        char '+'\n        b &lt;- t1\n        return (Branch Add a b)\nt2 = do a &lt;- t1 +++ (t1 +++ brackets tree)\n        char '*'\n        b &lt;- t2\n        return (Branch Mul a b)\nt3 = do a &lt;- t2 +++ (t2 +++ brackets tree)\n        char '^'\n        b &lt;- t3\n        return (Branch Exp a b)\ntree = t3\n</code></pre>\n\n<p>Note the is a circular dependency in the definition of tree: <code>tree</code> -> <code>t3</code> -> <code>t2</code> -> <code>t1</code> -> <code>t0</code> -> <code>tree</code>. The definition of <code>t0</code> \"ties the knot\" since\nit refers to <code>brackets tree</code>.</p>\n\n<p>Each level adds the ability to parse a new operator: <code>t0</code> parses just\nleaf nodes and brackets, <code>t1</code> adds addition on top of <code>t0</code>, <code>t2</code>\nadds multiplication on top of <code>t1</code>, etc.</p>\n\n<p>(Edit: Actually, since this is a right fold the operators are effectively added in the reverse order - ie. <code>t1</code> adds exponentiation and <code>t3</code> adds addition.)</p>\n\n<p>This makes the final parser <code>tree</code> right associative, i.e. <code>a+b+c</code> is parsed as <code>a + (b + c)</code>.</p>\n"}], "owner": {"reputation": 563, "user_id": 1135884, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/f5f0766028f7bf53969634c22e1bb876?s=128&d=identicon&r=PG", "display_name": "A Friedrich", "link": "https://stackoverflow.com/users/1135884/a-friedrich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "accepted_answer_id": 39475950, "answer_count": 2, "score": 2, "last_activity_date": 1473843184, "creation_date": 1473787747, "question_id": 39475820, "link": "https://stackoverflow.com/questions/39475820/readp-recursive-parsing", "title": "ReadP recursive parsing", "body": "<p>In a <a href=\"http://en.wikibooks.org/wiki/Haskell/ParseExps\" rel=\"nofollow\">wikibooks article</a> about parsing a string like <code>\"(a*b+c^d)\"</code> into a tree using <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Text-ParserCombinators-ReadP.html\" rel=\"nofollow\">ReadP</a>, there is the following piece of code:</p>\n\n<pre><code>import Text.ParserCombinators.ReadP\n\nbrackets p = do char '('\n                r &lt;- p\n                char ')'\n                return r\n\ndata Operator = Add | Mul | Exp deriving Show\noperators = [(Add,'+'),(Mul,'*'),(Exp,'^')]\n\ndata Tree = Branch Operator Tree Tree | Leaf String deriving Show\n\nleaf = do s &lt;- many1 (choice (map char ['a'..'z']))\n          return (Leaf s)\n\ntree = foldr (\\(op,name) p -&gt;\n               let this = p +++ (p +++ brackets tree\n                        &gt;&gt;= (\\a -&gt; char name\n                        &gt;&gt;= (\\_ -&gt; this\n                        &gt;&gt;= (\\b -&gt; return (Branch op a b)))))\n                in this)\n             (leaf +++ brackets tree)\n             operators\n</code></pre>\n\n<p>What I cannot get is the way the recursion on <code>this</code> works here (I've desugared <code>do</code> hoping it would help me understand it, to no avail). Can someone please explain how <code>this</code> within the <code>do</code>-block gets evaluated (since it looks like infinite recursion to me, which it obviously isn't)?</p>\n"}, {"tags": ["haskell", "functor", "applicative"], "answers": [{"tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": false, "score": 10, "last_activity_date": 1473770198, "last_edit_date": 1473770198, "creation_date": 1473769465, "answer_id": 39470038, "question_id": 39469980, "link": "https://stackoverflow.com/questions/39469980/difference-between-just-and-pure/39470038#39470038", "title": "Difference between &#39;Just&#39; and &#39;pure&#39;", "body": "<p><code>pure</code> is an overloaded operation. It is defined for all types that implement the <code>Applicative</code> class. One of the types that do that is <code>Maybe</code>. So <code>pure</code> in that context is the same as <code>Just</code>. But there are other types that also implement <code>Applicative</code> such as <code>[]</code> (lists). In that case, <code>pure</code> means singleton (i.e. the function that takes a single value and returns the one-element list that contains that value). So</p>\n\n<pre><code>pure (*3) &lt;*&gt; [0..10]\n</code></pre>\n\n<p>really means:</p>\n\n<pre><code>[(*3)] &lt;*&gt; [0..10]\n</code></pre>\n\n<p>and not</p>\n\n<pre><code>Just (*3) &lt;*&gt; [0..10]\n</code></pre>\n\n<p>In this last example you are trying to mix lists with maybes which is why GHC rejects it. In general, haskell figures out what is the exact meaning of <code>pure</code> based on the context, e.g. if you try to use it with maybes, it will interpret it as <code>Just</code>, if you use it with lists interpret it as singleton.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 6, "last_activity_date": 1473778130, "last_edit_date": 1473778130, "creation_date": 1473769992, "answer_id": 39470229, "question_id": 39469980, "link": "https://stackoverflow.com/questions/39469980/difference-between-just-and-pure/39470229#39470229", "title": "Difference between &#39;Just&#39; and &#39;pure&#39;", "body": "<p>The <code>pure</code> function returns a polymorphic value:</p>\n\n<pre><code>Prelude&gt; :t pure \"foo\"\npure \"foo\" :: Applicative f =&gt; f [Char]\n</code></pre>\n\n<p>For <code>Maybe</code>, <code>pure</code> is just defined to be <code>Just</code>:</p>\n\n<pre><code>instance Applicative Maybe where\n    pure = Just\n    -- ...\n</code></pre>\n\n<p>Other types provide different definitions; as an example, it is defined for lists as</p>\n\n<pre><code>instance Applicative [] where\n    pure x    = [x]\n    -- ...\n</code></pre>\n\n<p>Specifying a type for the return value tells Haskell which <code>Applicative</code> instance to use for the definition of <code>pure</code>.</p>\n\n<pre><code>Prelude&gt; pure \"foo\" :: [[Char]]\n[\"foo\"]\nPrelude&gt; pure \"foo\" :: Maybe [Char]\nJust \"foo\"\n</code></pre>\n\n<p>In addition to providing an explicit type, Haskell can infer which type to use base on how the value is used. For instance, <code>(&lt;*&gt; [1..5]) :: (Num a, Enum a) =&gt; [a -&gt; b] -&gt; [b]</code>, so in <code>pure (+3) &lt;*&gt; [1..5]</code>, we know <code>pure (+3)</code> has to have type <code>[a -&gt; b]</code>. Similarly, in <code>pure (+3) &lt;*&gt; Just 5</code>, we know that <code>pure (+3)</code> must have type <code>Maybe (a-&gt;b)</code>.</p>\n\n<p>In general, in any expression <code>pure f &lt;*&gt; g</code>, the type of <code>g</code> will determine what type of value <code>pure f</code> needs to return.</p>\n"}], "owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1473781935, "creation_date": 1473769296, "last_edit_date": 1473781935, "question_id": 39469980, "link": "https://stackoverflow.com/questions/39469980/difference-between-just-and-pure", "title": "Difference between &#39;Just&#39; and &#39;pure&#39;", "body": "<pre><code>Just (+) &lt;*&gt; Just 3 &lt;*&gt; Just 5\n</code></pre>\n\n<blockquote>\n  <p>Just 8</p>\n</blockquote>\n\n<pre><code>pure (+) &lt;*&gt; Just 3 &lt;*&gt; Just 5\n</code></pre>\n\n<blockquote>\n  <p>Just 8</p>\n</blockquote>\n\n<pre><code>pure (*3) &lt;*&gt; [0..10]\n</code></pre>\n\n<blockquote>\n  <p>[0,3,6,9,12,15,18,21,24,27,30]</p>\n</blockquote>\n\n<pre><code>Just (*3) &lt;*&gt; [0..10]\n</code></pre>\n\n<blockquote>\n  <p>Couldn't match type \u2018[]\u2019 with \u2018Maybe\u2019</p>\n  \n  <p>Expected type: Maybe b</p>\n  \n  <p>Actual type: [b]</p>\n  \n  <p>In the second argument of \u2018(&lt;*>)\u2019, namely \u2018[0 .. 10]\u2019</p>\n  \n  <p>In the expression: Just (* 3) &lt;*> [0 .. 10]</p>\n  \n  <p>In an equation for \u2018it\u2019: it = Just (* 3) &lt;*> [0 .. 10]</p>\n</blockquote>\n\n<p>When are <code>pure</code> and <code>Just</code> interchangeable and when are they different?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1473741348, "post_id": 39462268, "comment_id": 66245294, "body": "<a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow noreferrer\">wiki.haskell.org/Monomorphism_restriction</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1473741525, "post_id": 39462268, "comment_id": 66245351, "body": "Add a type signature <code>run :: Show a =&gt; Parser a -&gt; String -&gt; IO ()</code>"}], "owner": {"reputation": 831, "user_id": 2198297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d1c9129d47811254fac68d8561c9a50c?s=128&d=identicon&r=PG", "display_name": "andro", "link": "https://stackoverflow.com/users/2198297/andro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "closed_date": 1473741463, "answer_count": 0, "score": 0, "last_activity_date": 1473741285, "creation_date": 1473741285, "question_id": 39462268, "link": "https://stackoverflow.com/questions/39462268/aliasing-parser-function", "closed_reason": "Duplicate", "title": "Aliasing parser function", "body": "<p>Many Haskell tutorials on Parsec alias function names for convenience. Alias is probably the wrong technical word here, but the idea is to use a simpler or alternative name for a function.</p>\n\n<p>With ghci 8.0.1, the following gives an error:</p>\n\n<pre><code>import Text.ParserCombinators.Parser\nrun = parseTest\n</code></pre>\n\n<p>Here is the error:</p>\n\n<pre><code>error:\n    \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018parseTest\u2019\n      prevents the constraint \u2018(Show a0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n      These potential instances exist:\n        instance Show Ordering -- Defined in \u2018GHC.Show\u2019\n        instance Show Integer -- Defined in \u2018GHC.Show\u2019\n        instance Show a =&gt; Show (Maybe a) -- Defined in \u2018GHC.Show\u2019\n        ...plus 22 others\n        ...plus 17 instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 When instantiating \u2018run\u2019, initially inferred to have\n      this overly-general type:\n        forall s t a.\n        (Text.Parsec.Prim.Stream s Data.Functor.Identity.Identity t,\n         Show a) =&gt;\n        Text.Parsec.Prim.Parsec s () a -&gt; s -&gt; IO ()\n      NB: This instantiation can be caused by the monomorphism restriction.\nFailed, modules loaded: none.\n</code></pre>\n\n<p>What am I doing incorrectly, given that it is correct to say the following?</p>\n\n<pre><code>f :: Int -&gt; Int\nf x = x + 1\n\nr = f\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 6, "last_activity_date": 1473747332, "last_edit_date": 1473747332, "creation_date": 1473739864, "answer_id": 39462108, "question_id": 39462053, "link": "https://stackoverflow.com/questions/39462053/creating-a-function-that-takes-a-list-of-ints-and-returns-the-list-with-any-odd/39462108#39462108", "title": "creating a function that takes a list of Ints and returns the list with any odd numbers squared", "body": "<p>Your <code>sqrodd</code> function has <strong>two</strong> parameters: the first is an oddness-predicate <code>a -&gt; Bool</code> and the second is a list of elements <code>[a]</code>. In your example usage, you pass <code>[1..5]</code> as the <strong>first</strong> argument, in place of the <code>a -&gt; Bool</code> predicate. </p>\n\n<p>However, what you really want is to <strong>not</strong> have two parameters, i.e. change <code>sqrodd</code> to a single-parameter function <code>sqrodd :: [a] -&gt; [a]</code> and just use <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:odd\" rel=\"noreferrer\">the function <code>odd</code> from the Prelude</a>.</p>\n\n<p>Note that you'll still need to be a bit more restrictive in your <code>sqrodd</code> type because it is not true that you can apply <code>odd</code> or <code>(*)</code> on elements of any type <code>a</code>; you may want to read up on typeclasses once you get there to get over that next hurdle.</p>\n"}, {"tags": [], "owner": {"reputation": 420, "user_id": 6496011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5da204ac4ee7e380ab27daa05996a2a?s=128&d=identicon&r=PG&f=1", "display_name": "Antisthenes", "link": "https://stackoverflow.com/users/6496011/antisthenes"}, "is_accepted": true, "score": 5, "last_activity_date": 1473754476, "last_edit_date": 1473754476, "creation_date": 1473754164, "answer_id": 39465130, "question_id": 39462053, "link": "https://stackoverflow.com/questions/39462053/creating-a-function-that-takes-a-list-of-ints-and-returns-the-list-with-any-odd/39465130#39465130", "title": "creating a function that takes a list of Ints and returns the list with any odd numbers squared", "body": "<p>As you wrote yourself, you want a function that takes a list as argument and returns another list, so instead of having type signature</p>\n\n<pre><code>    sqrodd :: (a-&gt;Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>You should make a function with a type signature that looks like this</p>\n\n<pre><code>    sqrodd :: [a] -&gt; [a]\n</code></pre>\n\n<p>which is exactly what you have written on the beginning.\nBecause of that compiler expects, that the first argument of this function will be a function of (a -> bool). \nYou should remove odd from arguments list and change type signature as shown above. This will cause the function to use odd from prelude instead of expecting filter function as argument.</p>\n\n<p>Another way of doing it, is renaming you function as, for example sqrfiltered and then you can define sqrodd as partially applied sqrfiltered</p>\n\n<pre><code>    sqrodd = sqrfiltered odd\n</code></pre>\n\n<p>Not tested, but it should be right.</p>\n"}, {"tags": [], "owner": {"reputation": 893, "user_id": 6248287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tPegr.jpg?s=128&g=1", "display_name": "\u019b\u019b\u019b", "link": "https://stackoverflow.com/users/6248287/%c6%9b%c6%9b%c6%9b"}, "is_accepted": false, "score": 0, "last_activity_date": 1473773928, "creation_date": 1473773928, "answer_id": 39471549, "question_id": 39462053, "link": "https://stackoverflow.com/questions/39462053/creating-a-function-that-takes-a-list-of-ints-and-returns-the-list-with-any-odd/39471549#39471549", "title": "creating a function that takes a list of Ints and returns the list with any odd numbers squared", "body": "<p>The filter function examines each element in a list and returns a new list that only contains the elements satisfying the condition. </p>\n\n<p>But what you want to accomplish is to transform a list to a new list; the new list has the same number of elements of the old one. You're not filtering out anything; you're mapping elements from one list to another according to some rules. </p>\n\n<p>Here are two possible ways to write your function.</p>\n\n<pre><code>oddSquared, oddSquared' :: [Int] -&gt; [Int]\n\noddSquared l = [ if (x `mod` 2 /= 0) then x^2 else x | x &lt;- l ]\n\noddSquared'  = map (\\x -&gt; if odd x then x^2 else x)\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 3818146, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/540fd7e9877f81b49f4ee0d9363849b5?s=128&d=identicon&r=PG&f=1", "display_name": "user47835", "link": "https://stackoverflow.com/users/3818146/user47835"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4008, "favorite_count": 0, "accepted_answer_id": 39465130, "answer_count": 3, "score": 1, "last_activity_date": 1473773928, "creation_date": 1473739537, "last_edit_date": 1473739748, "question_id": 39462053, "link": "https://stackoverflow.com/questions/39462053/creating-a-function-that-takes-a-list-of-ints-and-returns-the-list-with-any-odd", "title": "creating a function that takes a list of Ints and returns the list with any odd numbers squared", "body": "<p>I want to write a function very similar to filter using the odd function that takes a list and returns that list with any odd numbers squared.</p>\n\n<p>ex</p>\n\n<pre><code>gchi&gt; sqrodd [1,2,3,4,5]\n[1,2,9,4,25]\n</code></pre>\n\n<p>what I have and believe is close is</p>\n\n<pre><code>sqrodd :: (a-&gt;Bool) -&gt; [a] -&gt; [a]\nsqrodd odd []     = []\nsqrodd odd (x:xs) = if odd x\n                    then (x*x) :sqrodd odd xs\n                    else x : sqrodd odd xs\n</code></pre>\n\n<p>but I get errors with the function definition saying \"couldn't match expected type <code>a -&gt; Bool</code> with actual type <code>[a]</code>\"</p>\n"}, {"tags": ["haskell", "type-inference", "typeclass", "gadt"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1473760368, "post_id": 39462859, "comment_id": 66254252, "body": "This a link-only answer, which should be expanded. Right now it does not explain much."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473787060, "post_id": 39462859, "comment_id": 66270416, "body": "You should also avoid linking to &quot;latest&quot;, preferring a specific documentation version."}], "tags": [], "owner": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "is_accepted": false, "score": 1, "last_activity_date": 1473745157, "creation_date": 1473745157, "answer_id": 39462859, "question_id": 39461561, "link": "https://stackoverflow.com/questions/39461561/gadt-type-argument-not-being-used-for-typeclass-resolution/39462859#39462859", "title": "GADT type argument not being used for typeclass resolution", "body": "<p>Type signatures are not redundant when using GADTs. Note the final bullet point of <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=gadts#generalised-algebraic-data-types-gadts\" rel=\"nofollow\">GHC Users Guide: GADTs</a></p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1473776612, "creation_date": 1473776612, "answer_id": 39472416, "question_id": 39461561, "link": "https://stackoverflow.com/questions/39461561/gadt-type-argument-not-being-used-for-typeclass-resolution/39472416#39472416", "title": "GADT type argument not being used for typeclass resolution", "body": "<p>It's clearer if you write it out with an explicit <code>case</code> (view patterns are pretty obscuring WRT type-information flow):</p>\n\n<pre><code>useDynFoo :: Foo f -&gt; Int\nuseDynFoo foof = case obsFoo foof of\n    Foo -&gt; 1\n</code></pre>\n\n<p>Here, the information <code>f ~ Int</code> is perfectly accessible for the <code>1</code>. Well, but that's not where we need this information: we need it already at <code>obsFoo foof</code>. And the information can't get there: GADT pattern matches act as a complete \u201ctype information diode\u201d, i.e. any information from the outside can be used within the matching scope, but no information from inside can be used without. (For good reasons obviously, because that information can only be confirmed at runtime, when you actually <em>have</em> a GADT constructor to take it from.)</p>\n\n<p>The more interesting question is, why does it work if you add the <code>:: Foo Int</code> signature? Well, that in particular is a weirdness of the view pattern. See, the following would <em>not</em> work:</p>\n\n<pre><code>useDynFoo :: Foo f -&gt; Int\nuseDynFoo foof = case obsFoo foof of\n    (Foo :: Foo Int) -&gt; 1\n</code></pre>\n\n<p>This information, as you said yourself, is completely redundant.</p>\n\n<p>However it turns out that this view pattern is actually equivalent to putting the signature on the other part of the case:</p>\n\n<pre><code>useDynFoo :: Foo f -&gt; Int\nuseDynFoo foof = case obsFoo foof :: Foo Int of\n    Foo -&gt; 1\n</code></pre>\n\n<p>and this is quite a different pair of shoes, because now the <code>Foo Int</code> is not inside the GADT pattern match.</p>\n\n<p>I don't know why view pattern with signatures desugar like this, perhaps to make this very pattern possible.</p>\n"}], "owner": {"reputation": 1525, "user_id": 546591, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/33RTK.jpg?s=128&g=1", "display_name": "James Koppel", "link": "https://stackoverflow.com/users/546591/james-koppel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 1, "accepted_answer_id": 39472416, "answer_count": 2, "score": 8, "last_activity_date": 1473776612, "creation_date": 1473735261, "last_edit_date": 1473738527, "question_id": 39461561, "link": "https://stackoverflow.com/questions/39461561/gadt-type-argument-not-being-used-for-typeclass-resolution", "title": "GADT type argument not being used for typeclass resolution", "body": "<p>Consider the following code</p>\n\n<pre><code>data Foo f where\n  Foo :: Foo Int\n\nclass DynFoo t where\n  dynFoo :: Foo f -&gt; Foo t\n\ninstance DynFoo Int where\n  dynFoo Foo = Foo\n\nobsFoo :: (DynFoo t) =&gt; Foo f -&gt; Foo t\nobsFoo = dynFoo\n\nuseDynFoo :: Foo f -&gt; Int\nuseDynFoo (obsFoo -&gt; Foo) = 1\n</code></pre>\n\n<p>The pattern match in <code>useDynFoo</code> should constrain the use of <code>obsFoo</code> to have type <code>Foo f -&gt; Foo Int</code>, which should cause it to search for an instance of <code>DynFoo Int</code>. However, it instead searches for an instance of <code>DynFoo t</code> for unknown <code>t</code>, and naturally fails.</p>\n\n<pre><code>  No instance for (DynFoo t0) arising from a use of \u2018obsFoo\u2019\n    The type variable \u2018t0\u2019 is ambiguous\n</code></pre>\n\n<p>However, if I change the definition of <code>useDynFoo</code> to</p>\n\n<pre><code>useDynFoo :: Foo f -&gt; Int\nuseDynFoo (obsFoo -&gt; (Foo :: Foo Int)) = 1\n</code></pre>\n\n<p>Then it suddenly works, even though my type signature is completely redundant.</p>\n\n<p>So, why is this happening, and how can I use <code>obsFoo</code> without having to give a type signature?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1473732283, "post_id": 39460961, "comment_id": 66243214, "body": "Presumably you want Haskell to use the first instance over the second one when possible. Unfortunately, when trying to decide which instance to use when there are multiple candidates, GHC only looks at the instance head to try to determine which is most specific."}, {"owner": {"reputation": 649, "user_id": 3534522, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bbDbb.png?s=128&g=1", "display_name": "Fernando Rincon", "link": "https://stackoverflow.com/users/3534522/fernando-rincon"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1473732449, "post_id": 39460961, "comment_id": 66243245, "body": "But in the cases I wrote, the decision should be deterministic, as in the tryFunc2 the second instance is the only that has String as the second type argument, and in the case of tryFunc1 is the combination of the first one and the second one. There is only one possible solution."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1473732951, "post_id": 39460961, "comment_id": 66243331, "body": "@FernandoRincon The design of Haskell&#39;s typeclass system guarantees much more than merely a unique solution: it guarantees that the solution can be found without doing a (backtracking) search. This is an efficiency vs. expressiveness tradeoff, and in my opinion it has served the language well. Your proposed instances would, in general, require the compiler to do search to find the solution, even if it is unique -- and so are rejected."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 6, "last_activity_date": 1473733374, "last_edit_date": 1473733374, "creation_date": 1473733012, "answer_id": 39461308, "question_id": 39460961, "link": "https://stackoverflow.com/questions/39460961/haskell-recursive-type-classes/39461308#39461308", "title": "Haskell Recursive Type Classes", "body": "<p>The solution is to stop using the deprecated <code>OverlappingInstances</code> pragma and start using the per instance <code>OVERLAPPING</code> and <code>OVERLAPPABLE</code> pragmas. With just this change:</p>\n\n<pre><code>instance {-# OVERLAPPABLE #-} Provider a b =&gt; Provider (x, a) b where\n  getInstance (x, a) = getInstance a\n\ninstance {-# OVERLAPPING #-} Provider (b, x) b where\n  getInstance (b, _) = b\n</code></pre>\n\n<p>I get <code>tryFunc1</code> to be <code>10</code> and <code>tryFunc2</code> to be <code>\"test\"</code>.</p>\n\n<hr>\n\n<p>Technically you only need either the <code>OVERLAPPABLE</code> or <code>OVERLAPPING</code> pragma, but I believe that it is good practice to have both in this case... Also, I suppose this is the behaviour that you want, but note that this just gets the <em>first</em> of whatever type you are looking for (so <code>getInstance  (10, (20, ())) :: Int</code> gives me <code>10</code> and <em>not</em> <code>20</code>)</p>\n\n<p>Good source of info is the <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9242\" rel=\"noreferrer\">ticket</a> tracking the feature's creation.</p>\n"}, {"comments": [{"owner": {"reputation": 649, "user_id": 3534522, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bbDbb.png?s=128&g=1", "display_name": "Fernando Rincon", "link": "https://stackoverflow.com/users/3534522/fernando-rincon"}, "edited": false, "score": 0, "creation_date": 1473775469, "post_id": 39467051, "comment_id": 66263439, "body": "thanks for the replay. Do you see any benefit from your implementation compared to Alec &#39;s implementation?"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 649, "user_id": 3534522, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bbDbb.png?s=128&g=1", "display_name": "Fernando Rincon", "link": "https://stackoverflow.com/users/3534522/fernando-rincon"}, "edited": false, "score": 0, "creation_date": 1473776856, "post_id": 39467051, "comment_id": 66264329, "body": "I don&#39;t know much about the pragmas Alec uses but the distinction between overlapping and overlappable leads me to believe that it&#39;s a way to describe the order in which solutions should be tried. There seem to be 2 cases: the base one (overlappable) and the special one (overlapping).  With a type family, you could have more flexibility i.e. not just 2 alternatives but 3 or more. E.g. <a href=\"https://gist.github.com/gallais/3b7c7d9488b25978caa278bc18617f79\" rel=\"nofollow noreferrer\">in this instance</a>, you check not only the left but also the right component of the product for equality. <code>tryFunc3</code> showcases that new ability."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 1, "last_activity_date": 1473760265, "creation_date": 1473760265, "answer_id": 39467051, "question_id": 39460961, "link": "https://stackoverflow.com/questions/39460961/haskell-recursive-type-classes/39467051#39467051", "title": "Haskell Recursive Type Classes", "body": "<p>I know some people don't like <code>UndecidableInstances</code> but that's what I like to do in this type of situation: use a closed <code>type family</code> to make it explicit that the choice is fully deterministic.</p>\n\n<p>The idea is to have the type family compute a boolean flag making it clear which branch should be taken by the typeclass resolution mechanism. The <code>UndecidableInstance</code> extension is needed because of the <code>Provider a b (AtHead a b) =&gt;</code> constraint even though it's harmless.</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances     #-}\n{-# LANGUAGE FlexibleContexts      #-}\n{-# LANGUAGE UndecidableInstances  #-}\n{-# LANGUAGE TypeFamilies          #-}\n{-# LANGUAGE DataKinds             #-}\n{-# LANGUAGE TypeOperators         #-}\n{-# LANGUAGE ScopedTypeVariables   #-}\n\nmodule Provider where\n\nimport Data.Proxy\nimport Data.Type.Equality\n\nclass Provider a b (f :: Bool) where\n  getInstance' :: Proxy f -&gt; a -&gt; b\n\ntype family AtHead x y :: Bool where\n  AtHead (x, a) y = x == y\n\ninstance Provider a b (AtHead a b) =&gt; Provider (x, a) b 'False where\n  getInstance' _ (x, a) = getInstance' (Proxy :: Proxy (AtHead a b)) a\n\ninstance Provider (b, x) b 'True where\n  getInstance' _ (b, _) = b\n\ngetInstance :: forall a b. Provider a b (AtHead a b) =&gt; a -&gt; b\ngetInstance = getInstance' (Proxy :: Proxy (AtHead a b))\n\ntryFunc1 :: Int\ntryFunc1 =\n  let provider = (\"test\", (10, ())) :: (String, (Int, ()))\n  in getInstance provider\n\ntryFunc2 :: String\ntryFunc2 =\n  let provider = (\"test\", (10, ())) :: (String, (Int, ()))\n  in getInstance provider\n</code></pre>\n"}], "owner": {"reputation": 649, "user_id": 3534522, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bbDbb.png?s=128&g=1", "display_name": "Fernando Rincon", "link": "https://stackoverflow.com/users/3534522/fernando-rincon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 2, "answer_count": 2, "score": 1, "last_activity_date": 1473760265, "creation_date": 1473730099, "last_edit_date": 1473732079, "question_id": 39460961, "link": "https://stackoverflow.com/questions/39460961/haskell-recursive-type-classes", "title": "Haskell Recursive Type Classes", "body": "<p>I want to create a recursive instance type based on tuples. What I am looking for is something similar than this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class Provider a b where\n  getInstance :: a -&gt; b\n\ninstance Provider a b =&gt; Provider (x, a) b where\n  getInstance (x, a) = getInstance a\n\ninstance Provider (b, x) b where\n  getInstance (b, _) = b\n\ntryFunc1 :: Int\ntryFunc1 =\n  let provider = (\"test\", (10, ())) :: (String, (Int, ()))\n  in getInstance provider\n\ntryFunc2 :: String\ntryFunc2 =\n  let provider = (\"test\", (10, ())) :: (String, (Int, ()))\n  in getInstance provider\n</code></pre>\n\n<p>Unfortunatelly, haskell fails to solve the instance. Any reason?</p>\n"}, {"tags": ["list", "haskell", "infinite"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1473724919, "post_id": 39460213, "comment_id": 66241791, "body": "For future reference: <code>quicksort</code> -&gt; <code>Data.List.sort</code>; <code>eliminatedouble</code> -&gt; <code>Data.List.nub</code>. The <code>doubled</code> alias for <code>elem</code> seems odd. Also, <code>nub</code> is generally quite slow compared to a <code>Data.Set</code>-based implementation, and <code>allSatisfied</code> will likely also be sped up a lot by using <code>Data.Set</code>. But as described in my answer, the biggest win will come from only generating the elements you care about in the first place rather than generating tons of stuff you don&#39;t care about and filtering."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1473724216, "post_id": 39460292, "comment_id": 66241660, "body": "Exhaustively checking <code>nCr 74 8</code> choices? Might just be doable on a top-notch cluster, definitely not feasible on a PC."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1473724493, "post_id": 39460292, "comment_id": 66241723, "body": "@leftaroundabout Actually, after doing some back-of-the-envelope calculation, I&#39;m more inclined to believe it would be possible... if you don&#39;t mind computing for a few days. Depends on the user&#39;s goals, I think! I&#39;ve updated my answer to be more hopeful."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1473724891, "post_id": 39460292, "comment_id": 66241787, "body": "You&#39;re right, I also had an approximation in my head and it was actually a couple orders of magnitude too pessimistic. Anyway this is definitely a task that would be worth to parallelise."}, {"owner": {"reputation": 1, "user_id": 6824294, "user_type": "registered", "profile_image": "https://graph.facebook.com/1793907904224584/picture?type=large", "display_name": "nub", "link": "https://stackoverflow.com/users/6824294/nub"}, "edited": false, "score": 0, "creation_date": 1473793502, "post_id": 39460292, "comment_id": 66273790, "body": "Why is this so much faster than listcomprehension? I&#39;am kinda new to Haskell so I don&#39;t really know... And anyways, you guys think I should drop this project, since it is kinda important to have the 8... And it&#39;s not really that easy to cut out results because every result can potentially be important, the complete list from 74 choose 8 is gonna be sorted based on the entries in the objects which are basically tuples with 45 entries each... Your function is way faster than the one I used obviously. Would it be more successful to work on this on an object based program language like java?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 6824294, "user_type": "registered", "profile_image": "https://graph.facebook.com/1793907904224584/picture?type=large", "display_name": "nub", "link": "https://stackoverflow.com/users/6824294/nub"}, "edited": false, "score": 0, "creation_date": 1473794338, "post_id": 39460292, "comment_id": 66274216, "body": "@nub The speed difference is not in list comprehension vs. not, but in choosing a better algorithm. Compare: my version need not eliminate duplicates, do any sorting, or verify that any particular predicate holds of elements or of the entire list. That&#39;s a lot of work that simply need not be done in my version compared to yours. I doubt it will be better to abandon Haskell -- 74 choose 8 is just a big number, and you can&#39;t fix that by choosing a different language."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1473724570, "last_edit_date": 1473724570, "creation_date": 1473723900, "answer_id": 39460292, "question_id": 39460213, "link": "https://stackoverflow.com/questions/39460213/haskell-how-to-treat-big-combinatorial-lists/39460292#39460292", "title": "Haskell: how to treat big combinatorial Lists?", "body": "<p>You're making this much more difficult than it needs to be.</p>\n\n<pre><code>choose 0 xs = [[]]\nchoose n [] = []\nchoose n (x:xs) = map (x:) (choose (n-1) xs) ++ choose n xs\n</code></pre>\n\n<p>In my interpreter, <code>choose 5 [1..74]</code> takes about 22 seconds to compute all the entries and <code>choose 6 [1..74]</code> takes 273 seconds. Additionally, <code>choose 8 [1..74]</code> starts chugging through combinations straight away; I estimate that it would take about 6 hours to generate them all. N.B. that this is in the interpreter, with no optimization or other fanciness going on; possibly it could go much faster if you give GHC a chance to figure out how.</p>\n\n<p>Assuming that you intend to do some nontrivial computation on each element of <code>choose 8 [1..74]</code>, I suggest you either schedule a largish chunk of time or else think about solutions that do not do an exhaustive search -- perhaps using some heuristics to get an approximate answer, or figuring out how to do some pruning to cut out large, uninteresting swaths of the search space.</p>\n"}], "owner": {"reputation": 1, "user_id": 6824294, "user_type": "registered", "profile_image": "https://graph.facebook.com/1793907904224584/picture?type=large", "display_name": "nub", "link": "https://stackoverflow.com/users/6824294/nub"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1473724570, "creation_date": 1473723164, "last_edit_date": 1473723495, "question_id": 39460213, "link": "https://stackoverflow.com/questions/39460213/haskell-how-to-treat-big-combinatorial-lists", "title": "Haskell: how to treat big combinatorial Lists?", "body": "<p>just recently I tried to write a program which basically simulates a simple system from an Online Game. The idea behind that is, to let the program calculate the most efficient set of items for the most possible stat efficiency from a set. To clarify this a bit more:\nyou've got 8 item Slots and 74 different items, you can't use any item twice, and it doesn't matter which item is in which slot. I'am not even yet trying to calculate one set of stats, I'am stuck way earlier!</p>\n\n<p>So the problem with this is the number of possibilities which are (74^8) before filtering and (74 choose 8) after filtering.\nMy program already starts lagging when I just try head(permu' 2).\nSince I know Haskell is supposed to work with infinite Lists, how does it work with a List of 899 trillion entries? Well I know obviously it takes a lot of capacity for the PC but that's why I am here to ask:</p>\n\n<p><strong>How do I treat a big List in Haskell so that I can work with it?</strong></p>\n\n<p>the function simplified looks like this:</p>\n\n<pre><code>quicksort :: (Ord a) =&gt; [a] -&gt; [a]\nquicksort [] = []\nquicksort [a] = [a]\nquicksort (x:xs) = (quicksort [y | y &lt;- xs, y &lt;= x]) ++ [x] ++ (quicksort [z | z &lt;- xs , z &gt; x])\n\neliminatedouble [] = []\neliminatedouble (x:xs) = if x `elem` xs then eliminatedouble xs else x:(eliminatedouble xs)\n\npermu' n | n&gt;8 = error \"8 is max\"\n         | otherwise = eliminatedouble (filter allSatisfied (generate n))\n   where\n      generate 0 = [[]]\n      generate x = [quicksort (a:xs) | a &lt;- [1..74], xs &lt;- generate (x-1)]\n      allSatisfied [] = True\n      allSatisfied (x:xs) = (checkConstraint x xs) &amp;&amp; (allSatisfied xs)\n      checkConstraint x xs = not (doubled x xs)\n      doubled x xs = x `elem` xs\n</code></pre>\n\n<p>would be interesting to know how to do all this way cheaper.</p>\n\n<p>Thanks in advance, regards.</p>\n"}, {"tags": ["twitter-bootstrap", "haskell", "hakyll"], "comments": [{"owner": {"reputation": 9806, "user_id": 382982, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9ZaxF.jpg?s=128&g=1", "display_name": "pdoherty926", "link": "https://stackoverflow.com/users/382982/pdoherty926"}, "edited": false, "score": 0, "creation_date": 1473735522, "post_id": 39459703, "comment_id": 66243908, "body": "Will the sidebar&#39;s contents by static or dynamic?"}, {"owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "reply_to_user": {"reputation": 9806, "user_id": 382982, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9ZaxF.jpg?s=128&g=1", "display_name": "pdoherty926", "link": "https://stackoverflow.com/users/382982/pdoherty926"}, "edited": false, "score": 0, "creation_date": 1473791520, "post_id": 39459703, "comment_id": 66272789, "body": "In my idea, it should be dynamic and updated when I add a related post."}, {"owner": {"reputation": 669, "user_id": 3406750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1de70b0e9078f2a462eed59aff2159?s=128&d=identicon&r=PG&f=1", "display_name": "Teodor", "link": "https://stackoverflow.com/users/3406750/teodor"}, "edited": false, "score": 0, "creation_date": 1510066376, "post_id": 39459703, "comment_id": 81271203, "body": "if you want proper answers for this, you need to define <i>what you want to be in the sidebar</i>. The default template already shows navigation links on the top. What do you need further than this?  That being said, your thoughts about a template included with a <code>$partial$</code> sounds reasonable."}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 151, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1474298956, "creation_date": 1473719249, "last_edit_date": 1473791638, "question_id": 39459703, "link": "https://stackoverflow.com/questions/39459703/navigation-sidebar-with-hakyll", "title": "Navigation sidebar with Hakyll", "body": "<p>I'm trying to make a website with <strong>Hakyll</strong> and <strong>bootstrap</strong>. I would like to add a <strong>navigation sidebar</strong> (automatically updated at compilation) on some pages of my website and I'm not sure of how to do it. I searched for tutorials or examples but I didn't find anything.</p>\n\n<p>According to me, I should render a temporary page from a <strong>sidebar template</strong> and render my page by adding this html code with <code>$partial()$</code>. I also read about making <code>snapshots</code>.</p>\n\n<p>But I'm not comfortable with Hakyll functions and I don't know how to do it?</p>\n\n<p><strong>Do you know how to make a navigation sidebar with hakyll ?</strong></p>\n\n<p><strong>Do you have an example or a tutorial who could help me ?</strong></p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 2449, "user_id": 114920, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02dea9f4a7993c9163035b4fc7e3bb15?s=128&d=identicon&r=PG&f=1", "display_name": "DasIch", "link": "https://stackoverflow.com/users/114920/dasich"}, "is_accepted": true, "score": 4, "last_activity_date": 1473722211, "creation_date": 1473722211, "answer_id": 39460083, "question_id": 39459542, "link": "https://stackoverflow.com/questions/39459542/how-to-use-hunit-in-stack/39460083#39460083", "title": "How to use HUnit in Stack", "body": "<p>It looks like you're trying to depend on the executable (<code>Main</code> in <code>build-depends</code> of the <code>test-suite</code> section), so that you can test it in your test suite. That doesn't work, in fact you can't really test your executable at all.</p>\n\n<p>Remove <code>Main</code> from the <code>build-depends</code>. Move all the code you want to test into your library.</p>\n"}], "owner": {"reputation": 2966, "user_id": 3014199, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/72332b0ac6ee78bc829c378c6c747e0e?s=128&d=identicon&r=PG", "display_name": "peer", "link": "https://stackoverflow.com/users/3014199/peer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1407, "favorite_count": 0, "accepted_answer_id": 39460083, "answer_count": 1, "score": 4, "last_activity_date": 1473722211, "creation_date": 1473718284, "question_id": 39459542, "link": "https://stackoverflow.com/questions/39459542/how-to-use-hunit-in-stack", "title": "How to use HUnit in Stack", "body": "<p>I have a stackproject <code>stapro</code> with a file <code>app/Main.hs</code></p>\n\n<pre><code>module Main where\n\nimport Lib\n\nmain = putStrLn \"This is main\" \n\nfoo::Int -&gt;Int\nfoo = (+1)\n</code></pre>\n\n<p>and a file <code>test/Spec.hs</code></p>\n\n<pre><code>module Spec where\n\nimport Test.HUnit\nimport Main (foo)\n\nmain :: IO ()\nmain = putStrLn \"Test suite not yet implemented\"\n\ntestFoo :: Test\ntestFoo = TestCase $ assertEqual \"Should return 2\" 2 (foo 1)\n</code></pre>\n\n<p>When I try to execute the tests however</p>\n\n<pre><code>$ stack test\nWhile constructing the BuildPlan the following exceptions were encountered:\n\n--  While attempting to add dependency,\n    Could not find package Main in known packages\n\n--  Failure when adding dependencies:    \n      Main: needed (-any), stack configuration has no specified version\n    needed for package stapro-0.1.0.0\n</code></pre>\n\n<p>My .cabal file is</p>\n\n<pre><code>name:                stapro\nversion:             0.1.0.0\n...\nbuild-type:          Simple\n-- extra-source-files:\ncabal-version:       &gt;=1.10\n\nlibrary\n  hs-source-dirs:      src\n  exposed-modules:     Lib\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n  default-language:    Haskell2010\n\nexecutable stapro-exe\n  hs-source-dirs:      app\n  main-is:             Main.hs\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n  build-depends:       base\n                     , stapro\n  default-language:    Haskell2010\n\ntest-suite stapro-test\n  type:                exitcode-stdio-1.0\n  hs-source-dirs:      test\n  main-is:             Spec.hs\n  build-depends:       base\n                     , stapro\n                     , HUnit\n                     , Main\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n  default-language:    Haskell2010\n\n...\n</code></pre>\n"}, {"tags": ["haskell", "monads", "state-monad", "category-theory"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1473712931, "post_id": 39458316, "comment_id": 66238105, "body": "This question is far too vague - the actual problem (&quot;without going into too much detail&quot; - this is far too little detail) is unclear. At best it seems to be a request for resources (off-topic). Besides, <code>StateT s (StateT s&#39; m) a</code> and <code>StateT (s, s&#39;) m a</code> <i>are</i> isomorphic, which is really what you&#39;re observing - it&#39;s just a coincidence that <code>ReaderT r (ReaderT r&#39; Identity) a</code> and <code>ReaderT r Identity (ReaderT r&#39; Identity a)</code> are also isomorphic, so you get the more specific version of the isomorphism for <code>Reader</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1473717693, "post_id": 39458316, "comment_id": 66240103, "body": "@user2407038 <code>S r (S s a)</code> is not the same as <code>StateT r (State s) a</code>: in particular, <code>S r (S s a)</code> must commit to an updated <code>r</code> before inspecting the <code>s</code> state. So <code>S r (S s a)</code> and <code>S (r, s) a</code> are <i>not</i> isomorphic!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1473717813, "post_id": 39458316, "comment_id": 66240140, "body": "You may be interested in the related question, <a href=\"http://stackoverflow.com/questions/7040844/applicatives-compose-monads-dont\">Applicatives compose, monads don&#39;t</a>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1473717990, "post_id": 39458316, "comment_id": 66240197, "body": "@user2407038 However, I agree with your assessment that this kind of question is generally considered off-topic here on StackOverflow. I might suggest IRC (if you hop on when the CT heavy hitters are around) or one of the mailing lists (if you&#39;re not sure you can get on at the right time) as more appropriate fora for this kind of discussion."}, {"owner": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "edited": false, "score": 0, "creation_date": 1473776510, "post_id": 39458316, "comment_id": 66264102, "body": "Thanks, I reckon you&#39;re right. A bit more about why I care: In linguistics there&#39;s something of a &#39;debate&#39; between people who represent the meanings of sentences with pronouns as functions from environments to booleans (where environments are sequences of values, like in a Tarskian semantics for first-order logic), and people who prefer the curry&#39;d version. Given the curry-uncurry isomorphisms, it&#39;s hard to imagine this fracas has empirical content. But in richer type-spaces like <code>S</code> (which are <a href=\"http://www.indiana.edu/~iulg/nlcsslides/MNLS.pdf\" rel=\"nofollow noreferrer\">useful</a> in semantics), it seems like it might."}], "owner": {"reputation": 596, "user_id": 2684007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0dc231525b77cbf9b18251173353c74f?s=128&d=identicon&r=PG&f=1", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2684007/simon-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 151, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1473712071, "creation_date": 1473712071, "question_id": 39458316, "link": "https://stackoverflow.com/questions/39458316/getting-my-bearings-on-state-monadic-uncurrying", "title": "Getting my bearings on state-monadic &quot;uncurrying&quot;", "body": "<p>The curry-uncurry isomorphisms can be expressed as invertible maps between various kinds of \"higher-order\" programs in the Reader monad (ignoring wrappers to keep things concise): </p>\n\n<pre><code>type R r a = r -&gt; a\n\nuncurryR :: R r (R s a) -&gt; R (r, s) a\nuncurryR m (r, s) = m r s\n\ncurryR :: R (r, s) a -&gt; R r (R s a)\ncurryR m r s = m (r, s)\n</code></pre>\n\n<p>I have become interested in a State-monadic version of <code>uncurryS</code>, as follows:</p>\n\n<pre><code>type S r a = r -&gt; (a, r)\n\nuncurryS :: S r (S s a) -&gt; S (r, s) a\nuncurryS m (r, s) = (v, (t, u))\n  where (n, t) = m r\n        (v, u) = n s\n</code></pre>\n\n<p>Of course, unlike <code>uncurryR</code>, <code>unCurryS</code> isn't an isomorphism: <code>S (r, s) a</code> is in general a much \"larger\" type than <code>S r (S s a)</code>. </p>\n\n<p>I'm an academic linguist, and without going into <em>too</em> much detail, the difference between <code>R</code> and <code>S</code> with respect to their \"uncurrying\" operations -- i.e., whether they're isomorphisms -- turns out to be consequential for thinking about various problems in the formal semantics of natural language (believe it or not!). </p>\n\n<p>In general, when a construct looks relevant for natural language semantics, I've found it helpful to chase down connections in computer science and category theory, to the extent that I can. To that end, I would be very interested to know of any related issues have been discussed, either in the functional programming literature or in more categorical terms. I am sorry I can't be much more specific, but I appreciate any help and any pointers.</p>\n"}, {"tags": ["algorithm", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 7, "creation_date": 1473710502, "post_id": 39457248, "comment_id": 66236968, "body": "I think the &quot;infinite wheel&quot; is is essentially the sieving process itself."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1473713032, "post_id": 39457248, "comment_id": 66238152, "body": "From the paper: &quot;<i>I will leave experimenting with larger wheels and writing code to generate those wheels as a recreational exercise for the reader.</i>&quot; - well done :-)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1473713282, "post_id": 39457248, "comment_id": 66238284, "body": "@ErikR are you sure? It looks like a different series <a href=\"https://oeis.org/A001223\" rel=\"nofollow noreferrer\">1, 2, 2, 4, 2, 4, 2, 4, 6, 2, 6, 4, 2, 4, 6</a>, so it could have different generating characteristics."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 3, "creation_date": 1473713883, "post_id": 39457248, "comment_id": 66238564, "body": "@Viclib <code>primes = scanl (+) 2 gaps</code> and <code>gaps = (zipWith (-) =&lt;&lt; tail) primes</code>, which is trivial enough to call it an &quot;encoding&quot; of the primes. Constructing the infinite wheel has a lot in common with the sieving process."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1473768749, "post_id": 39457248, "comment_id": 66259061, "body": "That sequence of lists has no limit ( a limit exists only if they all share a finite prefix)."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1473777688, "post_id": 39471491, "comment_id": 66264917, "body": "I realized there is no infinite well. There is still an infinite list of the concatenation of consecutive wheels, which is this <code>gaps</code> as pointed on the comments."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1473787323, "post_id": 39471491, "comment_id": 66270543, "body": "Why would you concatenate wheel532 and wheel7532 ? It doesn&#39;t give you a wheel."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1473789527, "post_id": 39471491, "comment_id": 66271792, "body": "I was just thinking that if there was a simple way to generate the <code>gaps</code> sequence (which is the concatenation of the wheels), then it could give us a new implementation of <code>primes</code> itself."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1473798300, "post_id": 39471491, "comment_id": 66276043, "body": "Can you post a proof that gaps is the concatenation of the wheels ?"}], "tags": [], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "is_accepted": true, "score": 1, "last_activity_date": 1473773754, "creation_date": 1473773754, "answer_id": 39471491, "question_id": 39457248, "link": "https://stackoverflow.com/questions/39457248/is-it-possible-to-generate-the-wheel-lazily/39471491#39471491", "title": "Is it possible to generate the wheel lazily?", "body": "<p>As Bakuriu says, the wheel sequence has no limit. There is no such thing as the \"infinite wheel\", I'll try to demonstrate why.</p>\n\n<p>If we know the first prime numbers p_1,...,p_n, we only need to search the next ones among the numbers that are coprime to them :</p>\n\n<pre><code>isCoprime :: [Int] -&gt; Int -&gt; Bool\nisCoprime ps x = all (\\p -&gt; x `mod` p /= 0) ps \n</code></pre>\n\n<p>The set Coprime(p_1,...,p_n) is (p_1...p_n)-periodic (x is inside it if and only if x + p_1...p_n is inside it), so we call it a wheel.</p>\n\n<p>You're asking for the limit of this Coprime set, as we take more and more prime numbers p_i. However, the only number in Coprime(p_1,...,p_n) below p_n is 1. To prove this, observe that a prime factor of such a number would be one of the p_i.</p>\n\n<p>So as the number of primes tends to infinity, Coprime(p_1,...,p_n) leaves a huge empty hole between 1 and p_n. The only limit you can think of is therefore the empty set : there is no infinite wheel.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 2, "accepted_answer_id": 39471491, "answer_count": 1, "score": 7, "last_activity_date": 1473773754, "creation_date": 1473707839, "last_edit_date": 1473709783, "question_id": 39457248, "link": "https://stackoverflow.com/questions/39457248/is-it-possible-to-generate-the-wheel-lazily", "title": "Is it possible to generate the wheel lazily?", "body": "<p>On the <a href=\"https://www.cs.hmc.edu/~oneill/papers/Sieve-JFP.pdf\" rel=\"noreferrer\">The Genuine Sieve of Erastosthenes</a> paper, the author uses a wheel of finite size to skip checking multiples of the first N primes on the sieve construction. For example, in order to avoid checking multiples of <code>2, 3</code>, you can begin at <code>5</code>, and alternately add 2 and 4. This is the <code>wheel 2</code> below:</p>\n\n<pre><code>-- wheel 0 = ([2],[1])\n-- wheel 1 = ([3,2],[2])\n-- wheel 2 = ([5,3,2],[2,4]) -- \"start at 5, add 2, 4, 2, 4...\"\n-- wheel 3 = ([7,5,3,2],[4,2,4,2,4,6,2,6])\n</code></pre>\n\n<p>Her wheel is fully generated on the startup of the sieving process. This presents a tradeoff, since larger wheels require more memory. I find the underlying mechanism behind the wheel generation interesting by itself, though. Given its clearly repetitive nature, I wonder if it would be possible to create an \"infinite wheel\" which, like the sieve, presented itself as a stream? This stream would be, I guess, the limit of the sequence of lists <code>[1], [2], [2, 4], [4, 2, 4, 2, 4, 6, 2, 6]...</code> - and probably work as an implementation of <code>primes</code> itself.</p>\n"}, {"tags": ["scala", "haskell", "functional-programming", "mapping"], "comments": [{"owner": {"reputation": 8861, "user_id": 561382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/FC1BR.jpg?s=128&g=1", "display_name": "Victor Moroz", "link": "https://stackoverflow.com/users/561382/victor-moroz"}, "edited": false, "score": 2, "creation_date": 1473715023, "post_id": 39457088, "comment_id": 66239033, "body": "<a href=\"https://github.com/scalaz/scalaz/blob/series/7.3.x/core/src/main/scala/scalaz/Arrow.scala\" rel=\"nofollow noreferrer\">github.com/scalaz/scalaz/blob/series/7.3.x/core/src/main/sca&zwnj;&#8203;la/&hellip;</a>, not a standard library though"}, {"owner": {"reputation": 4564, "user_id": 1908650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f316929a9cb85ac26281f87cae2f56f3?s=128&d=identicon&r=PG", "display_name": "Mohan", "link": "https://stackoverflow.com/users/1908650/mohan"}, "reply_to_user": {"reputation": 8861, "user_id": 561382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/FC1BR.jpg?s=128&g=1", "display_name": "Victor Moroz", "link": "https://stackoverflow.com/users/561382/victor-moroz"}, "edited": false, "score": 0, "creation_date": 1473718152, "post_id": 39457088, "comment_id": 66240245, "body": "@VictorMoroz if you turn that into an answer I will accept it\u2026"}, {"owner": {"reputation": 53042, "user_id": 2292812, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ntpOX.jpg?s=128&g=1", "display_name": "Michael Zajac", "link": "https://stackoverflow.com/users/2292812/michael-zajac"}, "edited": false, "score": 0, "creation_date": 1473721011, "post_id": 39457088, "comment_id": 66241006, "body": "Ok, but that&#39;s not the &quot;standard library&quot; as the question was posed."}], "answers": [{"comments": [{"owner": {"reputation": 8861, "user_id": 561382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/FC1BR.jpg?s=128&g=1", "display_name": "Victor Moroz", "link": "https://stackoverflow.com/users/561382/victor-moroz"}, "edited": false, "score": 1, "creation_date": 1473715528, "post_id": 39457181, "comment_id": 66239242, "body": "Haskell is not generalizing it to any arity either. Arrows (that is how they are called in Haskell) can be pretty useful, and not only <code>first</code> and <code>second</code>, there are others too. It&#39;s just not a Scala way as I understand, they are implemented in Scalaz though."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 8861, "user_id": 561382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/FC1BR.jpg?s=128&g=1", "display_name": "Victor Moroz", "link": "https://stackoverflow.com/users/561382/victor-moroz"}, "edited": false, "score": 0, "creation_date": 1473729675, "post_id": 39457181, "comment_id": 66242711, "body": "@VictorMoroz, Haskell&#39;s <code>Arrow</code> class, sadly, is widely considered broken. <code>arr</code> is too powerful, and operations that could avoid it in many useful cases are missing. On the plus side, <code>first</code> and <code>second</code> are also methods of the conceptually simpler <code>Bifunctor</code> class."}], "tags": [], "owner": {"reputation": 53042, "user_id": 2292812, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ntpOX.jpg?s=128&g=1", "display_name": "Michael Zajac", "link": "https://stackoverflow.com/users/2292812/michael-zajac"}, "is_accepted": false, "score": 4, "last_activity_date": 1473707602, "creation_date": 1473707602, "answer_id": 39457181, "question_id": 39457088, "link": "https://stackoverflow.com/questions/39457088/scala-equivalent-of-haskell-first-and-second/39457181#39457181", "title": "Scala equivalent of Haskell first and second", "body": "<blockquote>\n  <p>Are such functions defined in the standard Scala libraries?</p>\n</blockquote>\n\n<p>Nope. This isn't something that comes up so often in Scala that it warrants being in the standard library. It is also very difficult to generalize to tuples of any arity without an explosive amount of code (or macro).</p>\n"}, {"tags": [], "owner": {"reputation": 8861, "user_id": 561382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/FC1BR.jpg?s=128&g=1", "display_name": "Victor Moroz", "link": "https://stackoverflow.com/users/561382/victor-moroz"}, "is_accepted": true, "score": 1, "last_activity_date": 1473722007, "last_edit_date": 1473722007, "creation_date": 1473719726, "answer_id": 39459768, "question_id": 39457088, "link": "https://stackoverflow.com/questions/39457088/scala-equivalent-of-haskell-first-and-second/39459768#39459768", "title": "Scala equivalent of Haskell first and second", "body": "<p>Haskell's Arrows (<code>first</code> and <code>second</code> are among them) are implemented in Scalaz:</p>\n\n<p><a href=\"https://github.com/scalaz/scalaz/blob/series/7.3.x/core/src/main/scala/scalaz/Arrow.scala\" rel=\"nofollow\">Scalaz source</a></p>\n\n<p><a href=\"http://eed3si9n.com/learning-scalaz/Arrow.html\" rel=\"nofollow\">Some examples</a></p>\n\n<p>While it's technically not a standard library it's stable and seems to be well maintained.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Syntax is a bit cumbersome though (maybe there is another way?):</p>\n\n<pre><code>import scalaz._\nimport Scalaz._\n\nval f = (x: Int) =&gt; x + 1\nval g = f.second[String]\ng(\"1\", 2) //&gt; (\"1\", 3)\n\n// or with type inference\n\nf second (\"1\", 2) //&gt; (\"1\", 3)\n</code></pre>\n"}], "owner": {"reputation": 4564, "user_id": 1908650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f316929a9cb85ac26281f87cae2f56f3?s=128&d=identicon&r=PG", "display_name": "Mohan", "link": "https://stackoverflow.com/users/1908650/mohan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 39459768, "answer_count": 2, "score": 0, "last_activity_date": 1473722007, "creation_date": 1473707181, "last_edit_date": 1473707482, "question_id": 39457088, "link": "https://stackoverflow.com/questions/39457088/scala-equivalent-of-haskell-first-and-second", "title": "Scala equivalent of Haskell first and second", "body": "<p>Haskell has very convenient functions called <code>first</code> and <code>second</code> which apply a function to one element of a pair: </p>\n\n<pre><code>first fn (a,b) = (fn a, b)\nsecond fn (a,b) = (a, fn b)\n</code></pre>\n\n<p>Are such functions defined in the standard Scala libraries?  </p>\n\n<p><strong>Edit:</strong> I know it's easy to define them, but where possible it's cleaner to use standard functions with standard names\u2026</p>\n\n<pre><code>def first[A, B, X](fn: A =&gt; X)(pair: (A, B)): (X, B) = (fn(pair._1), pair._2)\ndef second[A, B, X](fn: B =&gt; X)(pair: (A, B)): (A, X) = (pair._1, fn(pair._2))\n</code></pre>\n"}, {"tags": ["haskell", "lambda", "pattern-matching"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1473705757, "post_id": 39456718, "comment_id": 66234582, "body": "Why don&#39;t you use <code>eventTime</code> / <code>eventPath</code> accessor function that this module provides?"}, {"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1473705956, "post_id": 39456718, "comment_id": 66234677, "body": "That&#39;s actually a great solution, and solves my issue. I&#39;d overlooked it while reading the docs. I&#39;m going to leave the question open for a little while longer because I&#39;m interested to see if there&#39;s a general-purpose equivalent of this."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473706690, "post_id": 39456718, "comment_id": 66235087, "body": "I think there&#39;s an argument to be made that there should only be one constructor, <code>Event FilePath UTCTime EventType</code>, with <code>data EventType = Added | Modified | Removed</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473713104, "post_id": 39456718, "comment_id": 66238194, "body": "@chepner, I don&#39;t know anything about this library, but there could be performance reasons for this choice."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1473866090, "post_id": 39456718, "comment_id": 66305527, "body": "May I ask you why you accepted that answer? Did you decide to modify the library to suit your needs? If your question is to solve that problem in the general setting, then I suggest you reword it to clarify this. It doesn&#39;t make sense to have the question asking A, and an accepted answer that answers B."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1473711224, "post_id": 39456998, "comment_id": 66237328, "body": "The file event isn&#39;t just one of many events; it&#39;s a single sum type that could be wrapped with <code>newtype MyEvent = Event (Action, FilePath, UTCTime)</code> for efficiency."}, {"owner": {"reputation": 403, "user_id": 3554119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b79421d48f8e4e753ab9ec19b3a964b7?s=128&d=identicon&r=PG&f=1", "display_name": "dirkt", "link": "https://stackoverflow.com/users/3554119/dirkt"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473745344, "post_id": 39456998, "comment_id": 66246425, "body": "Yes, if there&#39;s only file events a newtype is better."}], "tags": [], "owner": {"reputation": 403, "user_id": 3554119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b79421d48f8e4e753ab9ec19b3a964b7?s=128&d=identicon&r=PG&f=1", "display_name": "dirkt", "link": "https://stackoverflow.com/users/3554119/dirkt"}, "is_accepted": true, "score": 8, "last_activity_date": 1473706826, "creation_date": 1473706826, "answer_id": 39456998, "question_id": 39456718, "link": "https://stackoverflow.com/questions/39456718/does-haskell-provide-an-idiom-for-pattern-matching-against-many-possible-data-co/39456998#39456998", "title": "Does Haskell provide an idiom for pattern matching against many possible data constructors?", "body": "<p>The simplest way would be to actually reflect the homogenity of the alternatives in the type declaration, instead of just observing it:</p>\n\n<pre><code>data Action = Added | Modified | Removed\n\ndata Event = FileEvent Action FilePath UTCTime | OtherEvent ...\n\nf :: Event -&gt; FilePath\nf (FileEvent _ path _) = path\n</code></pre>\n\n<p>In general, Haskell has no way to know that all your constructor alternatives have the same number of arguments and the same type, so no, you can't abstract over the choice of alternative.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1473707483, "creation_date": 1473707483, "answer_id": 39457157, "question_id": 39456718, "link": "https://stackoverflow.com/questions/39456718/does-haskell-provide-an-idiom-for-pattern-matching-against-many-possible-data-co/39457157#39457157", "title": "Does Haskell provide an idiom for pattern matching against many possible data constructors?", "body": "<p>Arguably, this ADT would have better been implemented as</p>\n\n<pre><code>data Event = Event {\n     eventAction :: EventAction\n   , eventPath :: FilePath\n   , eventTime :: UTCTime\n   }\ndata EventAction = Addition | Modification | Removal\n</code></pre>\n\n<p>But those record accessors are actually just ordinary functions:</p>\n\n<pre><code>eventTime :: Event -&gt; UTCTime\neventPath :: Event -&gt; FilePath\n</code></pre>\n\n<p>...which of course you could have easily written yourself. But in fact the FSNotify package <em>provides</em> these precise functions, so in your case, the problem is solved.</p>\n\n<p>...Or is it?</p>\n\n<p>Actually, a record accessor is a bit more powerful than a getter function: it also allows you to <em>modify</em> entries, like</p>\n\n<pre><code>delayEvent :: Event -&gt; Event\ndelayEvent ev = ev{eventTime = addUTCTime 60 $ eventTime ev}\n</code></pre>\n\n<p>You can't easily get that functionality if the type is not actually a record type.</p>\n\n<p><em>Or can you?</em></p>\n\n<p>Records as such have never really worked quite satisfyingly in Haskell: they are ad-hoc syntax that's not very consistent with the rest of the language, and they have scoping issues. In the last years there has been a movement away from these record accessors toward something much more fancy: <a href=\"http://lens.github.io/tutorial.html\" rel=\"nofollow\">lenses</a>.</p>\n\n<p>Actually, in newer libraries you would even more likely find the ADT thus:</p>\n\n<pre><code>import Control.Lens\nimport Control.Lens.TH\n\ndata Event = Event {\n    _eventAction :: EventAction\n  , _eventPath :: FilePath\n  , _eventTime :: UTCTime\n  }\nmakeLenses ''Event\n</code></pre>\n\n<p>In case you haven't come across lenses yet, these are some examples of what they allow you to do:</p>\n\n<pre><code>delayEvent :: Event -&gt; Event\ndelayEvent = eventTime %~ addUTCTime 60\n\nsyncEventTo :: Event -&gt; Event -&gt; Event\nsyncEventTo tref = eventTime .~ tref^.eventTime\n</code></pre>\n\n<p>Now, unlike record accessors, lenses can be implemented 100% within Haskell without any need to special syntax from the compiler:</p>\n\n<pre><code>data Event = Added    FilePath UTCTime\n           | Modified FilePath UTCTime\n           | Removed  FilePath UTCTime\n           deriving (Eq, Show)\n\neventTime :: Lens' Event UTCTime\neventTime = lens get_t set_t\n where get_t (Added    _ t) = t\n       get_t (Modified _ t) = t\n       get_t (Removed  _ t) = t\n       set_t (Added    p _) t = Added p t\n       set_t (Modified p _) t = Modified p t\n       set_t (Removed  p _) t = Removed p t\n</code></pre>\n"}], "owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 482, "favorite_count": 1, "accepted_answer_id": 39456998, "answer_count": 2, "score": 3, "last_activity_date": 1473707483, "creation_date": 1473705623, "last_edit_date": 1473705866, "question_id": 39456718, "link": "https://stackoverflow.com/questions/39456718/does-haskell-provide-an-idiom-for-pattern-matching-against-many-possible-data-co", "title": "Does Haskell provide an idiom for pattern matching against many possible data constructors?", "body": "<p>Working on a Haskell project, I'm dealing with the <code>Event</code> data type from the <a href=\"https://hackage.haskell.org/package/fsnotify-0.2.1/docs/System-FSNotify.html\" rel=\"nofollow\">FSNotify</a> package. The constructors for <code>Event</code> are all:</p>\n\n<pre><code>Added FilePath UTCTime\nModified FilePath UTCTime\nRemoved FilePath UTCTime\n</code></pre>\n\n<p>In my code, I'm only interested in extracting the <code>FilePath</code> from the <code>Event</code> and doing the same action regardless of the type constructor; because of this, I'm tempted to make a lambda.</p>\n\n<p>Unfortunately, the code suffers reduced readability when I drop a <code>case</code> expression into the lambda to pattern match against all three cases; is there some built-in idiom to extract just the <code>FilePath</code> in one expression without having to manually pattern match, given the relative homogeneity of the type constructors?</p>\n\n<p>I've tried passing this expression as an anonymous function in a call to the <code>watchDir</code> action:</p>\n\n<pre><code> wm &lt;- startManager\n sw &lt;- watchDir wm \".\" (\\_ -&gt; True) (\\(_ f t) -&gt; putStrLn f)\n</code></pre>\n\n<p>But, predictably, the don't-care value in the lambda's pattern match causes a parse error.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "is_accepted": true, "score": 12, "last_activity_date": 1473707622, "last_edit_date": 1473707622, "creation_date": 1473706546, "answer_id": 39456925, "question_id": 39456716, "link": "https://stackoverflow.com/questions/39456716/how-to-write-semigroup-instance-for-this-data-type/39456925#39456925", "title": "How to write Semigroup instance for this data type?", "body": "<p>What they want is probably the addition of functions. For that, type <code>b</code> needs to be a Semigroup :</p>\n\n<pre><code>import Data.Semigroup\n\nnewtype Combine a b =\n  Combine { unCombine :: (a -&gt; b) }\n\ninstance Semigroup b =&gt; Semigroup (Combine a b) where\n  (Combine f) &lt;&gt; (Combine g) = Combine (\\x -&gt; f x &lt;&gt; g x)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7105, "user_id": 236007, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BiYes.jpg?s=128&g=1", "display_name": "Emre Sevin&#231;", "link": "https://stackoverflow.com/users/236007/emre-sevin%c3%a7"}, "edited": false, "score": 0, "creation_date": 1473707679, "post_id": 39457058, "comment_id": 66235570, "body": "Thanks! Good to learn that! (And it already started to fee like Lisp :P)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1473707070, "creation_date": 1473707070, "answer_id": 39457058, "question_id": 39456716, "link": "https://stackoverflow.com/questions/39456716/how-to-write-semigroup-instance-for-this-data-type/39457058#39457058", "title": "How to write Semigroup instance for this data type?", "body": "<p>You can shadow <code>Monoid</code>'s <code>(&lt;&gt;)</code> this way:</p>\n\n<pre><code>import Data.Monoid hiding ((&lt;&gt;))\n</code></pre>\n\n<p>Then when you <code>import Data.Semigroup</code>, you will have just one <code>(&lt;&gt;)</code> in scope: the one from <code>Data.Semigroup</code>.</p>\n"}], "owner": {"reputation": 7105, "user_id": 236007, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BiYes.jpg?s=128&g=1", "display_name": "Emre Sevin&#231;", "link": "https://stackoverflow.com/users/236007/emre-sevin%c3%a7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 738, "favorite_count": 2, "accepted_answer_id": 39456925, "answer_count": 2, "score": 4, "last_activity_date": 1473707622, "creation_date": 1473705609, "question_id": 39456716, "link": "https://stackoverflow.com/questions/39456716/how-to-write-semigroup-instance-for-this-data-type", "title": "How to write Semigroup instance for this data type?", "body": "<p>I'm trying to do one of the Semigroup exercises in <a href=\"http://haskellbook.com/\" rel=\"nofollow\">Haskell Book</a> (Chapter 15, \"Monoid, Semigroup\") but I'm stuck. The following is given:</p>\n\n<pre><code>newtype Combine a b =\n  Combine { unCombine :: (a -&gt; b) }\n</code></pre>\n\n<p>and I'm supposed to write the <code>Semigroup</code> instance for <code>Combine</code>.</p>\n\n<p>And then book says that it must behave like the following:</p>\n\n<pre><code> Prelude&gt; let f = Combine $ \\n -&gt; Sum (n + 1)\n Prelude&gt; let g = Combine $ \\n -&gt; Sum (n - 1)\n Prelude&gt; unCombine (f &lt;&gt; g) $ 0\n Sum {getSum = 0}\n Prelude&gt; unCombine (f &lt;&gt; g) $ 1\n Sum {getSum = 2}\n Prelude&gt; unCombine (f &lt;&gt; f) $ 1\n Sum {getSum = 4}\n Prelude&gt; unCombine (g &lt;&gt; f) $ 1\n Sum {getSum = 2}\n</code></pre>\n\n<p>So I first started with a <strong>wrong solution</strong> that type checks:</p>\n\n<pre><code>instance Semigroup (Combine a b) where\n  Combine f &lt;&gt; Combine g = Combine f\n</code></pre>\n\n<p>That does not what is expected of course, but hopefully a step in the right direction. And my thinking is something like the following, in pseudocode:</p>\n\n<pre><code> instance Semigroup (Combine a b) where\n   (Combine f) &lt;&gt; (Combine g) = Combine (SOMETHING)\n</code></pre>\n\n<p>That <strong>SOMETHING</strong> being: <code>f</code> and <code>g</code> appended, whatever that concrete append operation is (it depends on <code>f</code> and <code>g</code>); so I think this requires <code>&lt;&gt;</code> from <code>Data.Monoid</code>, but I already have <code>import Data.Semigroup</code> in my code, and therefore <code>&lt;&gt;</code> from <code>Data.Monoid</code> coincides with the one from <code>Data.Semigroup</code>. So what am I supposed to do?</p>\n\n<p>I tried to find out how I can state something like \"Combine (f Monoid's &lt;> g)\", but couldn't find out. </p>\n\n<p>The book also states unless I'm using GHC 8.x, I'll have to import <code>Semigroup</code> and that I might have \"shadow\" the <code>&lt;&gt;</code> from <code>Monoid</code>; but I'm struggling to find out how to have this effect.</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1473699957, "post_id": 39455300, "comment_id": 66231818, "body": "Looks like the dreaded monomorphism restriction (google that term) - it tries to determine the type of your numbers but cannot decide on one."}, {"owner": {"reputation": 2789, "user_id": 1101776, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/gM3dK.jpg?s=128&g=1", "display_name": "Balraj Singh", "link": "https://stackoverflow.com/users/1101776/balraj-singh"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1473700041, "post_id": 39455300, "comment_id": 66231858, "body": "@Bergi is there a way to modify this? I am not able to think a proper solution."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1473700167, "post_id": 39455300, "comment_id": 66231922, "body": "Add an explicit type <code>findLoot :: Fractional a =&gt; a -&gt; [a] -&gt; a</code>"}, {"owner": {"reputation": 2789, "user_id": 1101776, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/gM3dK.jpg?s=128&g=1", "display_name": "Balraj Singh", "link": "https://stackoverflow.com/users/1101776/balraj-singh"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1473700258, "post_id": 39455300, "comment_id": 66231979, "body": "@Bergi as soon as i add this i am getting error at load time Couldn&#39;t match expected type \u2018a\u2019 with actual type \u2018[a]\u2019       \u2018a\u2019 is a rigid type variable bound by           the type signature for findLoot :: Fractional a =&gt; a -&gt; [a] -&gt; a"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1473700269, "post_id": 39455300, "comment_id": 66231986, "body": "Using both <code>div</code> and <code>&#47;</code> looks wrong. What is the type of your numbers? You likely want only <code>&#47;</code>  (floating point) or only <code>div</code> (integer division)."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1473700353, "post_id": 39455300, "comment_id": 66232035, "body": "Or maybe have a look <a href=\"http://stackoverflow.com/q/34650949/1048572\">here</a> and <a href=\"http://stackoverflow.com/q/37144190/1048572\">there</a>"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1473700463, "post_id": 39455300, "comment_id": 66232098, "body": "@BalrajSingh Ah, it&#39;s <code>a -&gt; [[a]] -&gt; a</code>, I didn&#39;t realise you had a list of lists. Though actually a list of tuples seems to be more appropriate here."}, {"owner": {"reputation": 2789, "user_id": 1101776, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/gM3dK.jpg?s=128&g=1", "display_name": "Balraj Singh", "link": "https://stackoverflow.com/users/1101776/balraj-singh"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1473700531, "post_id": 39455300, "comment_id": 66232131, "body": "@chi I need to get integer part of div when val &gt; y and if val &lt; y i need all the fraction part."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1473701192, "post_id": 39455300, "comment_id": 66232458, "body": "What are the intended types of <code>val</code>, <code>x</code>, <code>y</code>, and the result of <code>findLoot</code>?"}, {"owner": {"reputation": 2789, "user_id": 1101776, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/gM3dK.jpg?s=128&g=1", "display_name": "Balraj Singh", "link": "https://stackoverflow.com/users/1101776/balraj-singh"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1473701601, "post_id": 39455300, "comment_id": 66232649, "body": "@melpomene I have updated question with input and output sets."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1473701644, "post_id": 39455300, "comment_id": 66232678, "body": "@BalrajSingh OK, but what are the intended types?"}, {"owner": {"reputation": 2789, "user_id": 1101776, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/gM3dK.jpg?s=128&g=1", "display_name": "Balraj Singh", "link": "https://stackoverflow.com/users/1101776/balraj-singh"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1473701743, "post_id": 39455300, "comment_id": 66232733, "body": "@melpomene val, x, y are Integer type and result of findLoot is Floot type"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1473702051, "post_id": 39455300, "comment_id": 66232860, "body": "Then <code>| val &lt; y  = (fromIntegral val * fromIntegral x) &#47; fromIntegral y</code> should work."}, {"owner": {"reputation": 2789, "user_id": 1101776, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/gM3dK.jpg?s=128&g=1", "display_name": "Balraj Singh", "link": "https://stackoverflow.com/users/1101776/balraj-singh"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1473702769, "post_id": 39455300, "comment_id": 66233142, "body": "@melpomene same issue after applying the above change"}], "answers": [{"comments": [{"owner": {"reputation": 398, "user_id": 1351182, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/a19ea4f2204cb5ccc2745fcdf8cda84c?s=128&d=identicon&r=PG", "display_name": "Myridium", "link": "https://stackoverflow.com/users/1351182/myridium"}, "edited": false, "score": 0, "creation_date": 1474333316, "post_id": 39456354, "comment_id": 66478267, "body": "Of note is that your explicit declaration of the type will make the compiler give more informative errors. Good practice pays off."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 3, "last_activity_date": 1473704612, "last_edit_date": 1473704612, "creation_date": 1473704166, "answer_id": 39456354, "question_id": 39455300, "link": "https://stackoverflow.com/questions/39455300/no-instance-for-fractional-a0-arising-from-a-use-of-it/39456354#39456354", "title": "No instance for (Fractional a0) arising from a use of \u2018it\u2019", "body": "<p>The problem is that Haskell can only do arithmetic on values of the same type. When you do <code>x + y</code> or <code>x * y</code> or <code>x == y</code>, then <code>x</code> and <code>y</code> must have the same type.</p>\n\n<p>The second issue is that Haskell's numeric types fall (mainly) into two classes, integral and fractional numbers. Only integral types (such as <code>Integer</code>) support <code>div</code> and <code>mod</code>, and only fractional types (such as <code>Double</code>) support <code>/</code>.</p>\n\n<p>Your code tries to use <code>div</code>, <code>mod</code>, and <code>/</code> with <code>x</code>, <code>y</code>, and <code>val</code>, which forces Haskell to look for a single type that is both fractional and integral. Such a type doesn't exist.</p>\n\n<p>Here's a possible solution:</p>\n\n<pre><code>findLoot :: Integer -&gt; [[Integer]] -&gt; Double\nfindLoot val [] = 0\nfindLoot val ((x:y:[]):xs) | val == 0 = 0.0\n                           | val &lt; y  = fromIntegral (val * x) / fromIntegral y\n                           | val &gt; y  = fromIntegral (div val y * x) + findLoot (mod val y) xs\n</code></pre>\n\n<p>Here all inputs (<code>val</code>, <code>x</code>, <code>y</code>) are <code>Integer</code>s, which makes <code>div</code> and <code>mod</code> work, and the result is <code>Double</code>. Whenever fractional numbers are needed (for <code>/</code> and for adding to the result of the recursive <code>findLoot</code> call), <code>fromIntegral</code> is used to convert from <code>Integer</code> to <code>Double</code>.</p>\n"}], "owner": {"reputation": 2789, "user_id": 1101776, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/gM3dK.jpg?s=128&g=1", "display_name": "Balraj Singh", "link": "https://stackoverflow.com/users/1101776/balraj-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 706, "favorite_count": 0, "accepted_answer_id": 39456354, "answer_count": 1, "score": -1, "last_activity_date": 1473704612, "creation_date": 1473699748, "last_edit_date": 1473701672, "question_id": 39455300, "link": "https://stackoverflow.com/questions/39455300/no-instance-for-fractional-a0-arising-from-a-use-of-it", "title": "No instance for (Fractional a0) arising from a use of \u2018it\u2019", "body": "<p>I am writing a function, but I'm unable to find a proper solution. How can I fix this:</p>\n\n<pre><code>findLoot val [] = 0\nfindLoot val ((x:y:[]):xs) | val == 0 = 0.0\n                           | val &lt; y  = ((val*x)/y)\n                           | val &gt; y  = ((div val y)*x) + (findLoot (mod val y) xs)\n</code></pre>\n\n<p>The error is</p>\n\n<pre><code> interactive:33:1:\n     No instance for (Fractional a0) arising from a use of \u2018it\u2019\n     The type variable \u2018a0\u2019 is ambiguous\n     Note: there are several potential instances:\n       instance HasResolution a =&gt; Fractional (Fixed a)\n         -- Defined in \u2018Data.Fixed\u2019\n       instance Integral a =&gt; Fractional (Ratio a)\n         -- Defined in \u2018GHC.Real\u2019\n       instance Fractional Double -- Defined in \u2018GHC.Float\u2019\n       ...plus one other\n     In the first argument of \u2018print\u2019, namely \u2018it\u2019\n     In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>Input Sets are</p>\n\n<pre><code>Input 1:-\n  val = 50\n  ((x:y:[]):xs) = [[120, 30], [100,50],[60, 20]]\nOutput 1:-\n  180.0000\n\nInput 2:-\nval = 10\n((x:y:[]):xs) = [[500,30]]\nOutput 2:- \n166.6667\n</code></pre>\n"}, {"tags": ["list", "function", "haskell", "recursion"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1473695683, "post_id": 39452570, "comment_id": 66229899, "body": "&quot;has to be executed first&quot; -- why do you care about that? In Haskell, we do not care much about execution order, focusing on the returned result instead. Even when reading the above code operationally, I actually follow the opposite direction: <code>x : sums (x+y : ys)</code> generates <code>x</code> in the output list first, and then proceeds by evaluating <code>sums (x+y : ys)</code> (which will produce the rest of the list)."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1473691739, "last_edit_date": 1473691739, "creation_date": 1473690644, "answer_id": 39452776, "question_id": 39452570, "link": "https://stackoverflow.com/questions/39452570/haskell-recursive-sum-function/39452776#39452776", "title": "Haskell Recursive &#39;sum&#39; Function", "body": "<p>This is no different than recursion in any other langauge. When <code>sums [0..4]</code> (the parentheses are unnecessary) is first called, <code>x==0</code>, <code>y==1</code>, and <code>ys == [2..4]</code>. Thus, the return value is a new list created from <code>0</code> and <code>sums [1..4]</code>.</p>\n\n<p>In a strict language, the recursive call would complete before finally creating the new list. Since Haskell is lazy, a list starting with 0 and continuing with a <em>promise</em> to evaluate <code>sums [1..4]</code> is returned. The recursive call won't actually be evaluated until someone actually tries to access the tail of the list.</p>\n"}, {"tags": [], "owner": {"reputation": 6694, "user_id": 2555037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c62b3037add2dde3cb8dd935f7ca9fe7?s=128&d=identicon&r=PG", "display_name": "Toxaris", "link": "https://stackoverflow.com/users/2555037/toxaris"}, "is_accepted": true, "score": 9, "last_activity_date": 1473848195, "last_edit_date": 1473848195, "creation_date": 1473691450, "answer_id": 39453000, "question_id": 39452570, "link": "https://stackoverflow.com/questions/39452570/haskell-recursive-sum-function/39453000#39453000", "title": "Haskell Recursive &#39;sum&#39; Function", "body": "<p>You can understand Haskell code by stepwise reduction. Maybe the following example reduction sequence helps with your aha.</p>\n\n<p>(A Haskell implementation actually does something related to such reduction steps, but maybe in a different order. You get the same end result, though).</p>\n\n<p>In this example, you start with:</p>\n\n<pre><code>sums [0..4]\n</code></pre>\n\n<p>Expand the <code>[0..4]</code> notation a bit:</p>\n\n<pre><code>sums (0 : 1 : [2..4])\n</code></pre>\n\n<p>Now we see that the first equation of <code>sums</code> matches, with <code>x = 0</code>, <code>y = 1</code>, and <code>ys = [2..4]</code>. So we get:</p>\n\n<pre><code>0 : sums (0 + 1 : [2..4])\n</code></pre>\n\n<p>We can compute <code>0 + 1</code>:</p>\n\n<pre><code>0 : sums (1 : [2..4])\n</code></pre>\n\n<p>And expand <code>[2..4]</code> a bit:</p>\n\n<pre><code>0 : sums (1 : 2 : [3..4])\n</code></pre>\n\n<p>Now we see that the first equation of <code>sums</code> matches again, this time with <code>x = 1</code>, <code>y = 2</code>, and <code>ys = [3..4]</code>. So we get:</p>\n\n<pre><code>0 : 1 : sums (1 + 2 : [3..4])\n</code></pre>\n\n<p>We can compute <code>1 + 2</code>:</p>\n\n<pre><code>0 : 1 : sums (3 : [3..4])\n</code></pre>\n\n<p>And expand <code>[3..4]</code> a bit:</p>\n\n<pre><code>0 : 1 : sums (3 : 3 : [4..4])\n</code></pre>\n\n<p>Now we see that the first equation of <code>sums</code> matches again, this time with <code>x = 3</code>, <code>y = 3</code>, and <code>ys = [4..4]</code>. So we get:</p>\n\n<pre><code>0 : 1 : 3 : sums (3 + 3 : [4..4])\n</code></pre>\n\n<p>We can compute <code>3 + 3</code>:</p>\n\n<pre><code>0 : 1 : 3 : sums (6 : [4..4])\n</code></pre>\n\n<p>And expand <code>[4..4]</code>:</p>\n\n<pre><code>0 : 1 : 3 : sums (6 : 4 : [])\n</code></pre>\n\n<p>Now we see that the first equation of <code>sums</code> matches again, this time with <code>x = 6</code>, <code>y = 4</code>, and <code>ys = []</code>. So we get:</p>\n\n<pre><code>0 : 1 : 3 : 6 : sums (6 + 4 : [])\n</code></pre>\n\n<p>We can compute <code>6 + 4</code>:</p>\n\n<pre><code>0 : 1 : 3 : 6 : sums (10 : [])\n</code></pre>\n\n<p>This time, the first equation for <code>sums</code> doesn't match. But the second equation matches. So we get:</p>\n\n<pre><code>0 : 1 : 3 : 6 : 10 : []\n</code></pre>\n\n<p>This is the observed output <code>[0, 1, 3, 6, 10]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 0, "last_activity_date": 1473693619, "last_edit_date": 1473693619, "creation_date": 1473692240, "answer_id": 39453269, "question_id": 39452570, "link": "https://stackoverflow.com/questions/39452570/haskell-recursive-sum-function/39453269#39453269", "title": "Haskell Recursive &#39;sum&#39; Function", "body": "<p>There are two equation that define the function <code>sums</code>. Keep rewriting an expression that involves <code>sums</code> using the first equation that matches the argument, or other suitable equations (like 1+2=3).</p>\n\n<pre><code>sums [0..4] = \n    -- by syntactic sugar\nsums (0:1:2:3:4:[]) = \n    -- by eq. 1, x=0,y=1,ys=2:3:4:[]\n0 : sums ((0+1) : 2 : 3:4:[]) = \n    -- by addition \n0 : sums (1 : 2 : 3:4:[]) = \n    -- by eq. 1, x=1, y=2, ys=3:4:[]\n0 : 1 : sums ((1+2) : 3 : 4:[]) =\n    -- by addition \n0 : 1 : sums (3 : 3 : 4:[]) =\n    -- by eq. 1, x=3, y=3, ys=4:[]\n0 : 1 : 3 : sums ((3+3) : 4 : []) = \n    -- by addition\n0 : 1 : 3 : sums (6 : 4 : []) = \n    -- by eq. 1, x=6, y=4, ys=[]\n0 : 1 : 3 : 6 : sums ((6+4):[]) = \n    -- by addition\n0 : 1 : 3 : 6 : sums (10:[]) = \n    -- by eq  2,xs=(10:[]) \n0 : 1 : 3 : 6 : 10 : [] = \n    -- by syntactic sugar\n[0,1,3,6,10]\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6996876"}, "is_accepted": false, "score": 1, "last_activity_date": 1473695678, "last_edit_date": 1473695678, "creation_date": 1473693225, "answer_id": 39453577, "question_id": 39452570, "link": "https://stackoverflow.com/questions/39452570/haskell-recursive-sum-function/39453577#39453577", "title": "Haskell Recursive &#39;sum&#39; Function", "body": "<p>You could notice that </p>\n\n<pre><code>sums (x:y:ys) =  x:sums(x + y : ys)\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>sums (x:y:z:ys) = x:x+y:sums(x+y+z : ys)\nsums (x:y:ys) = x:sums(x + y : ys)\n</code></pre>\n\n<p>and (with more than 2 items) is also equivalent to</p>\n\n<pre><code>sums (x:y:z: w: ys) = x:x+y:x+y+z:sums(x+y+z +w: ys)\nsums (x:y:z:ys) = x:x+y:sums(x+y+z : ys)\nsums (x:y:ys) = x:sums(x + y : ys)\n</code></pre>\n\n<p>so by induction you have that </p>\n\n<pre><code>sums(1:2:3:4 :[])\n</code></pre>\n\n<p>is equal to</p>\n\n<pre><code>1 : 1 + 2 : 1 + 2 + 3 : 1 + 2 + 3 + 4 : [] \n</code></pre>\n\n<p>Based on the above you can also predict that with</p>\n\n<pre><code>fact(x:y:ys) = x: fact(x * y : ys)\nfact(xs) = xs\n</code></pre>\n\n<p>then</p>\n\n<pre><code>fact([1..4])\n</code></pre>\n\n<p>is </p>\n\n<pre><code>1:1*2:1*2*3:1*2*3*4:[]\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 2843415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/58ac1c408c45bc187eed4b57b020034b?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/2843415/felix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1915, "favorite_count": 0, "accepted_answer_id": 39453000, "answer_count": 4, "score": 1, "last_activity_date": 1473848195, "creation_date": 1473690095, "question_id": 39452570, "link": "https://stackoverflow.com/questions/39452570/haskell-recursive-sum-function", "title": "Haskell Recursive &#39;sum&#39; Function", "body": "<p>I find it really difficult to understand the mechanics of the following recursive function:</p>\n\n<pre><code>sums (x:y:ys) = x:sums(x + y : ys)\nsums xs = xs\n\nsums ([0..4])\n\nOutput:\n[0, 1, 3, 6, 10]\n</code></pre>\n\n<p>What exactly happens in this line?:</p>\n\n<pre><code>x:sums(x + y : ys)\n</code></pre>\n\n<p>I would say that before the program can append the 'x' to the list, the function sum(x + y : ys) has to be executed first. But in that case, 'x' would be appended to the list only once - at the end of the recursion loop - which wouldn't result in the given output... so where are the flaws in my logic?</p>\n\n<p>My follow-up question: how should I look at/treat recursive functions in a logical way, that will (hopefully) lead me to an 'aha-erlebnis'?</p>\n\n<p>Any help is much appreciated!</p>\n"}, {"tags": ["haskell", "generic-programming", "type-level-computation"], "comments": [{"owner": {"reputation": 21174, "user_id": 693166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12c9230466478ce6a7236f9bec819d57?s=128&d=identicon&r=PG", "display_name": "Pawe\u0142 Obrok", "link": "https://stackoverflow.com/users/693166/pawe%c5%82-obrok"}, "edited": false, "score": 2, "creation_date": 1473689752, "post_id": 39451322, "comment_id": 66226189, "body": "You should post that as an answer and accept."}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 106, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1473711469, "creation_date": 1473686404, "last_edit_date": 1473711469, "question_id": 39451322, "link": "https://stackoverflow.com/questions/39451322/type-abstraction-with-comp-data", "title": "type abstraction with comp data", "body": "<p>Only full applied types work in <a href=\"https://github.com/pa-ba/compdata\" rel=\"nofollow\"><code>compdata</code></a>, if I am correct.</p>\n\n<p>What is the fundamental limitation which makes it so ?</p>\n\n<p>Are there ways to get around this ? </p>\n\n<pre><code>import           Data.Constraint \nimport           Data.Comp.Ops\nimport           Data.Comp.Sum\nimport           Data.Comp.Term\n\n\ndata Val a = Val Int deriving Functor \ndata Add a = Add a a deriving Functor \n\n-- Val is a subtype of Val :+: Add\nworks     = Dict :: Dict (Val :&lt;: (Val :+: Add)) \n\n-- Does not work :&lt;: requires fully applied types.... !!\nnotworks  = Dict  :: forall f . Functor f =&gt;  Dict (f :&lt;: (f :+: Add))\n</code></pre>\n\n<hr>\n\n<p><strong>Possible answer</strong> : <a href=\"http://www.diku.dk/~paba/pubs/files/bahr14wgp-paper.pdf\" rel=\"nofollow\">p80</a></p>\n\n<blockquote>\n  <p>The most important limitation is that <code>:\u227a:</code> only works for ground types,\n  i.e. neither side may contain variables. This is to be excepted since\n  we cannot rule out both ambiguity and duplication if the signatures on\n  either side of <code>:\u227a:</code> are not fully instantiated. For example, we may not\n  derive that <code>Val :\u227a: f :+: Val</code> , since if <code>f</code> were instantiated by <code>Val</code> ,\n  then the subsumption would be ambiguous.</p>\n</blockquote>\n\n<p>So indeed, a general function like </p>\n\n<pre><code>notworks  = Dict  :: forall f . Functor f =&gt;  Dict (f :&lt;: (f :+: Add))\n</code></pre>\n\n<p>can not work.</p>\n\n<hr>\n\n<p><strong>Possible answer ?</strong></p>\n\n<p>However, it seems that given proofs <code>s :&lt;: f</code> and <code>f :&lt;: g</code>, I should be able to form the composite (as injectivity is preserved) <code>s :&lt;: g</code>....</p>\n\n<p>edit : something along the line of some 'completion'</p>\n\n<pre><code>data ReflI\ndata CompI\n\ndata InjectProof a io where\n  ReflS :: Dict (f :&lt;: g) -&gt; InjectProof ReflI f g\n  Comp :: InjectProof a f g -&gt; InjectProof b g h  -&gt; InjectProof CompI f h\n\nclass Injectable i f g where\n   injectProof :: InjectProof i f g\n\ninstance (f :&lt;: g) =&gt; Injectable ReflI f g where\n    injectProof = ReflS Dict\n\ninstance (Injectable i f g, Injectable j g h) =&gt; Injectable CompI f h where\n   injectProof = Comp (injectProof ::  InjectProof i f g)  (injectProof ::  InjectProof j g h)\n</code></pre>\n\n<hr>\n\n<p><strong>Possible answer #2 ?</strong></p>\n\n<p>can't we say decorate the types with some levels</p>\n\n<pre><code>(Val,N) :\u227a: ((f, Suc N) :+: (Val, Suc N))\n</code></pre>\n\n<p>Then it is by construction injective, and we can defer giving the proof that each constructor in separate to when we apply it, allowing to strip of the index.. </p>\n"}, {"tags": ["haskell", "type-conversion"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473681908, "post_id": 39449284, "comment_id": 66221003, "body": "What is the purpose of such a function? Anything that can produce a <code>[Contain]</code> can just as easily create a <code>DataSubject</code> instead."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 3, "last_activity_date": 1473680317, "creation_date": 1473680317, "answer_id": 39449448, "question_id": 39449284, "link": "https://stackoverflow.com/questions/39449284/haskell-type-conversion/39449448#39449448", "title": "Haskell - Type conversion?", "body": "<p>You have a <strong>type mismatch</strong>. You have a list of <code>Contain</code>. So when you use</p>\n\n<pre><code>t !! 0\n</code></pre>\n\n<p>you get a <code>Contain</code>, not a <code>String</code>, which is necessary for <code>name</code> in <code>DS</code>. You need a function <code>Contain -&gt; Name</code>, e.g.</p>\n\n<pre><code>containToName :: Contain -&gt; Name\ncontainToName (Name xs) = xs\ncontainToName _         = error \"not a name\"\n</code></pre>\n\n<p>However, that's a partial function, since <code>containToName (Age 12)</code> will lead to an error.</p>\n\n<p>Note that this has nothing to do with <em>typeclasses</em>. Now, if you want to use <code>profile1</code>, one way would be to just use</p>\n\n<pre><code>profile1 :: DataSubject\n</code></pre>\n\n<p>instead of </p>\n\n<pre><code>profile1 :: [Contain]\n</code></pre>\n\n<p>e.g.</p>\n\n<pre><code>profile1 :: DataSubject \nprofile1 = DS \"Bob\" 22 100 \"French\"\n</code></pre>\n\n<p>After all, there's nothing in the <em>type</em> <code>[Contain]</code> that will make sure that you have all the ingredients for a complete <code>DataSubject</code>. </p>\n\n<blockquote>\n  <p>And if there's better ways of doing this?</p>\n</blockquote>\n\n<p>That depends on what you want to do. If you just want to handle <code>DataSubject</code>s, don't use an temporary list of <code>Contain</code>. If you want to handle user input (or similar), it gets a little bit more tricky.</p>\n"}, {"tags": [], "owner": {"reputation": 6694, "user_id": 2555037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c62b3037add2dde3cb8dd935f7ca9fe7?s=128&d=identicon&r=PG", "display_name": "Toxaris", "link": "https://stackoverflow.com/users/2555037/toxaris"}, "is_accepted": false, "score": 1, "last_activity_date": 1473680327, "creation_date": 1473680327, "answer_id": 39449451, "question_id": 39449284, "link": "https://stackoverflow.com/questions/39449284/haskell-type-conversion/39449451#39449451", "title": "Haskell - Type conversion?", "body": "<p>The declaration of <code>DataSubject</code> says that we need a <code>Name</code> for the <code>name</code> field. And <code>Name</code> is the same as <code>String</code>. So in the expression <code>DS {name = t!!0, ...}</code>, we need <code>t !! 0</code> to return a <code>String</code>. However, <code>t !! 0</code> returns an element of  <code>t</code>, and <code>t</code> has type <code>[Contain]</code>. So <code>t !! 0</code> has type <code>Contain</code>, which is different from <code>String</code>.</p>\n\n<p>To fix this type error, you need to convert the <code>Contain</code> to a <code>String</code>, maybe so:</p>\n\n<pre><code>DS { name = case t !! 0 of Name s =&gt; s, ... }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1473696989, "post_id": 39449522, "comment_id": 66230588, "body": "could you add a brief explanation of your code and exactly what its doing, then I can accept answer"}, {"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "reply_to_user": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 1, "creation_date": 1473705036, "post_id": 39449522, "comment_id": 66234215, "body": "I&#39;ve updated my answer with a brief explanation of how the fold works."}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": true, "score": 7, "last_activity_date": 1473705005, "last_edit_date": 1473705005, "creation_date": 1473680555, "answer_id": 39449522, "question_id": 39449284, "link": "https://stackoverflow.com/questions/39449284/haskell-type-conversion/39449522#39449522", "title": "Haskell - Type conversion?", "body": "<p>In the definition of <code>makeDS</code>, the variable <code>t</code> is of type <code>[Contain]</code> (i.e. a list of <code>Contain</code>), so when you say <code>t!!0</code> this will extract the first element of that list, which has type <code>Contain</code>. The problem is that the <code>name</code> field of <code>DataSubject</code> contains a <code>String</code> (which is an alias of <code>[Char]</code>). So you are trying to store a <code>Contain</code> in the place of <code>[Char]</code>, which is not possible because the types are different. You need a different approach in you code.</p>\n\n<p>One issue is that every single <code>Contain</code> value represents a single field of <code>DataSubject</code>. So if we are given a list of <code>Contain</code>, there is no guarantee that the values will be given in a specific order (e.g. <code>Name</code> first, followed by <code>Age</code>, etc) or even that all fields are provided. Even if you always provide all fields in a specific order in your code as convention, haskell cannot possibly know that. One solution that does not depend on order is to try to \"build\" the <code>DataSubject</code> object step-by-step, by starting with an \"empty\" <code>DataSubject</code> and then examining the list of <code>Contain</code> and adding the corresponding <code>DataSubject</code> field:</p>\n\n<pre><code>makeDS :: [Contain] -&gt; DataSubject\nmakeDS = foldr updateDS emptyDS\n  where\n    updateDS (Name s) ds = ds {name = s}\n    updateDS (Age n) ds = ds {age = n}\n    updateDS (Iq n) ds = ds {iq = n}\n    updateDS (Language s) ds = ds {language = s}\n    emptyDS = DS {name = \"\", age = 0, iq = 0, language = \"\"}\n</code></pre>\n\n<p>So here, I defined <code>emptyDS</code> which is an \"empty\" <code>DataSubject</code> object and a function called <code>updateDS</code> which take a (single) <code>Contain</code> and a <code>DataSubject</code> and updates the <code>DataSubject</code> based on the field specified by <code>Contain</code> and then it returns it. Finally, I use a fold to run repeatedly update the <code>DataSubject</code> (starting with <code>emptyDS</code>) using <code>updateDS</code>.</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "accepted_answer_id": 39449522, "answer_count": 3, "score": 0, "last_activity_date": 1473705005, "creation_date": 1473679695, "last_edit_date": 1473680122, "question_id": 39449284, "link": "https://stackoverflow.com/questions/39449284/haskell-type-conversion", "title": "Haskell - Type conversion?", "body": "<p>I'm trying to convert data from a list, 'profile1', into a custom type called 'DataSubject'.</p>\n\n<p>I'm passing this to a function 'makeDS' to attempt this conversion - however the following isn't working:</p>\n\n<pre><code>type Name = String \ntype Age = Int \ntype Iq = Int\ntype Language = String \ndata DataSubject = DS {name :: Name, age :: Age, iq :: Iq, language :: Language} deriving (Show)\ndata Contain = Name String | Age Int | Iq Int | Language String deriving (Show) --Use so list can take multiple types\n\nprofile1 = [Name \"Bob\", Age 22, Iq 100, Language \"French\"]\n\nmakeDS :: [Contain] -&gt; DataSubject\nmakeDS t = DS {name = t!!0, age = t!!1, iq = t!!2, language = t!!3}\n\nmain = do\n  let x = makeDS profile1\n  putStrLn $ show x\n</code></pre>\n\n<p>Error: </p>\n\n<pre><code>Couldn't match type \u2018Contain\u2019 with \u2018[Char]\u2019\n</code></pre>\n\n<p>I'm just getting started with Haskell - could someone advise on my error? And if there's better ways of doing this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1473679716, "post_id": 39449271, "comment_id": 66219791, "body": "The error message usually contains the extension you need to activate. However, the constraint on <code>b</code> should come first, e.g. <code>instance CSizeable b =&gt; CArgumentableAttr</code>. This usually needs <code>-XFlexibleInstances</code>"}, {"owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1473680182, "post_id": 39449271, "comment_id": 66220019, "body": "I use <code>FlexibleInstances</code>"}, {"owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1473680323, "post_id": 39449271, "comment_id": 66220096, "body": "If use <code>XFlexibleInstances</code> then <code>........b9416b003 --enable-tests --enable-benchmarks Process exited with code: ExitFailure 1</code>"}, {"owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1473680382, "post_id": 39449271, "comment_id": 66220130, "body": "<code>setup-Simple-Cabal-1.22.5.0-ghc-7.10.3: The package Lizard-0.1.0.0 requires the following language extensions which are not supported by ghc-7.10.3: XFlexibleInstances</code>"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1473680743, "post_id": 39449271, "comment_id": 66220331, "body": "Don&#39;t add additional information in comments, instead <a href=\"https://stackoverflow.com/posts/39449271/edit\">edit</a> your question."}], "answers": [{"comments": [{"owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "edited": false, "score": 0, "creation_date": 1473680117, "post_id": 39449317, "comment_id": 66219988, "body": "In this case <code>code</code> Could not deduce (Num b) arising from the literal \u20180\u2019     from the context (CSizeable b)       bound by the instance declaration       at src/WebUI/Widgets/UIWidget.hs:642:10-105     Possible fix:       add (Num b) to the context of the instance declaration     In the expression: 0     In the first argument of \u2018a\u2019, namely \u2018(0, 0, 100, 50)\u2019     In the expression: a (0, 0, 100, 50) UI_LT"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "edited": false, "score": 0, "creation_date": 1473685804, "post_id": 39449317, "comment_id": 66223385, "body": "@QSpider You would need to add a <code>Num b</code> constraint: <code>instance (Num b,CSizeable b) =&gt; CArgumentableAttr</code>. The implementation of the <code>Num</code> typeclass provides the logic for interpreting integer literals as a given type. This could be problematic since you have a <code>String</code> instance, so you would probably want to extend the <code>CSizeable</code> typeclass to support instantiation of literals rather than implementing <code>Num String</code>."}], "tags": [], "owner": {"reputation": 6694, "user_id": 2555037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c62b3037add2dde3cb8dd935f7ca9fe7?s=128&d=identicon&r=PG", "display_name": "Toxaris", "link": "https://stackoverflow.com/users/2555037/toxaris"}, "is_accepted": false, "score": 3, "last_activity_date": 1473679832, "creation_date": 1473679832, "answer_id": 39449317, "question_id": 39449271, "link": "https://stackoverflow.com/questions/39449271/haskell-malformed-instance/39449317#39449317", "title": "Haskell: Malformed instance", "body": "<p>You use</p>\n\n<pre><code>instance CArgumentableAttr (CSizeable b) =&gt; ... where ...\n</code></pre>\n\n<p>but I think you want</p>\n\n<pre><code>instance (CSizeable b) =&gt; CArgumentableAttr ... where ...\n</code></pre>\n\n<p>instead.</p>\n"}, {"tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 4, "last_activity_date": 1473687592, "creation_date": 1473687592, "answer_id": 39451709, "question_id": 39449271, "link": "https://stackoverflow.com/questions/39449271/haskell-malformed-instance/39451709#39451709", "title": "Haskell: Malformed instance", "body": "<p>I think @Toxaris identified the issue, but I wanted propose some potential adjustments that may make things easier for you.</p>\n\n<p>A few red flags for me are:</p>\n\n<ol>\n<li>There are <code>CSizeable</code> instances for both <code>Int</code> and <code>String</code> - this of course isn't <em>wrong</em> in any way taken in isolation</li>\n<li>The <code>CSizeable Int</code> instance always assumes pixels which prevents you from ever being able to, for example, numerically represent a percentage</li>\n<li>There is \"parsing/checking\" inside the <code>CSizeable String</code> instance</li>\n<li>There are \"unit-less\" numbers in the <code>CArgumentableAttr</code> instance</li>\n</ol>\n\n<p>My thought is that perhaps <code>CSizeable</code> would be better as a plain data type instead of a class, or that you would have newtype wrappers instead of instances for <code>Int</code> and <code>String</code>.</p>\n\n<p>As a data type:</p>\n\n<pre><code>data Size = Pixels Int | Percent Double | Literal String\ninstance Show Size where\n  show (Pixels x) = show x ++ \"px\"\n  show (Percent x) = show x ++ \"%\"\n  show (Literal x) = x\n\ninstance CArgumentableAttr ((Size,Size,Size,Size) -&gt; UI_StartingPoint -&gt; WidgetUI -&gt; UI WidgetUI) where expressArgumentAttr a = a (Pixels 0, Pixels 0, Pixels 100, Pixels 50) UI_LT\ninstance CArgumentableAttr (UI_StartingPoint -&gt; WidgetUI -&gt; UI WidgetUI) where expressArgumentAttr a = a UI_LT\n\nbounds :: (Size,Size,Size,Size) -&gt; UI_StartingPoint -&gt; WidgetUI -&gt; UI WidgetUI\nbounds (x,y,width,height) startingPoint widget =\n  case startingPoint of\n    UI_LT -&gt; applyStyleToWidget widget (\"left:\"  ++ show x ++ \";top:\" ...\n</code></pre>\n\n<p>The newtype wrappers could look something like this:</p>\n\n<pre><code>newtype Pixels = Pixels Int\nnewtype Percent = Percent Double\nnewtype Literal = Literal String\n\ninstance CSizeable Pixels where showSize (Pixels x) = show x ++ \"px\"\ninstance CSizeable Percent where showSize (Percent x) = show x ++ \"%\"\ninstance CSizeable Literal where showSize (Literal x) = x\n</code></pre>\n"}], "owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 571, "favorite_count": 0, "accepted_answer_id": 39451709, "answer_count": 2, "score": 0, "last_activity_date": 1473687592, "creation_date": 1473679621, "question_id": 39449271, "link": "https://stackoverflow.com/questions/39449271/haskell-malformed-instance", "title": "Haskell: Malformed instance", "body": "<p>I have problem for realisation of next in Haskell:</p>\n\n<p>Type class:</p>\n\n<pre><code>class CArgumentableAttr a where\n    expressArgumentAttr :: a -&gt; (WidgetUI -&gt; UI WidgetUI)\n\ninstance CArgumentableAttr (WidgetUI -&gt; UI WidgetUI) where expressArgumentAttr a = a     \n</code></pre>\n\n<p>and realisation:</p>\n\n<pre><code>instance CArgumentableAttr (CSizeable b) =&gt; ((b, b, b, b) -&gt; UI_StartingPoint -&gt; WidgetUI -&gt; UI WidgetUI) where expressArgumentAttr a = a (0, 0, 100, 50) UI_LT \ninstance CArgumentableAttr (UI_StartingPoint -&gt; WidgetUI -&gt; UI WidgetUI) where expressArgumentAttr a = aUI_LT \n</code></pre>\n\n<p>here:</p>\n\n<pre><code>class Show a =&gt; CSizeable a where\n    showSize :: a -&gt; String\ninstance CSizeable Int where\n    showSize a = (show a) ++ \"px\"\ninstance CSizeable String where\n    showSize a = if '%' `elem` a then a else (a ++ \"%\")\n</code></pre>\n\n<p>It use for:</p>\n\n<pre><code>bounds :: CSizeable a =&gt; (a, a, a, a) -&gt; UI_StartingPoint -&gt; WidgetUI -&gt; UI WidgetUI\nbounds (x, y, width, height) startingPoint widget =\n    case startingPoint of \n        UI_LT -&gt; applyStyleToWidget widget (\"left:\"  ++ (showSize x) ++ \";top:\" ...\n</code></pre>\n\n<p>When compiling get the following error:<BR>\nMalformed instance: CArgumentableAttr (CSizeable b) =>                      ((b, b, b, b) -> UI_StartingPoint -> WidgetUI -> UI WidgetUI)</p>\n\n<p>What can be done in this?\nThank you!</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1473713699, "post_id": 39443009, "comment_id": 66238477, "body": "What I find quite nice is importing modules with a name and export this name, e.g. <code>module Lib (X) where</code> and <code>import System.Random as X</code>."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 11, "last_activity_date": 1473651281, "creation_date": 1473651281, "answer_id": 39443009, "question_id": 39442964, "link": "https://stackoverflow.com/questions/39442964/import-modules-in-haskell/39443009#39443009", "title": "Import modules in Haskell", "body": "<p>Modules can export other modules, including themselves (meaning they export all top level definitions instead of an explicit list of symbols you'd otherwise need to rely on).</p>\n\n<pre><code>module Lib ( module System.Random, module Data.List, module Lib) where\nimport System.Random\nimport Data.List \n\n{-\n Lib code here\n-}\n</code></pre>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1330, "favorite_count": 0, "accepted_answer_id": 39443009, "answer_count": 1, "score": 3, "last_activity_date": 1473651281, "creation_date": 1473650950, "question_id": 39442964, "link": "https://stackoverflow.com/questions/39442964/import-modules-in-haskell", "title": "Import modules in Haskell", "body": "<p>For a Haskell project I've just started, I have two files <code>Main.hs</code> and <code>Lib.hs</code> </p>\n\n<p>However, I often find myself reaching for some modules that I've imported inside <code>Lib</code>  while working in <code>Main</code>. </p>\n\n<p>Is there a way to automatically load in <code>Main.hs</code> all the modules already imported inside Lib?</p>\n\n<p><strong>Lib.hs</strong></p>\n\n<pre><code>import System.Random\nimport Data.List \n\n{-\n Lib code here\n-}\n</code></pre>\n\n<p><strong>Main.hs</strong></p>\n\n<pre><code>import Lib -- Importing should automatically imports System.Random and Data.List\nmain = undefined\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1473638191, "post_id": 39441671, "comment_id": 66205804, "body": "Instead of <code>take 2 (repeat x)</code> you can use <code>replicate 2 x</code>."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 2, "creation_date": 1473691066, "post_id": 39441671, "comment_id": 66227120, "body": "@JoachimBreitner: or just <code>repeat x</code> in this case, since the <code>zip</code> will take care of truncating it to just the right length."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1473691959, "post_id": 39441671, "comment_id": 66227657, "body": "@Cactus Or simply <code>map (\\d -&gt; (d,3))</code>, since <code>zip</code>ing with a constant list is overkill."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1473692261, "post_id": 39441671, "comment_id": 66227842, "body": "@joachimbreitner or use <code>TupleSections</code> and <code>map (,3)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "edited": false, "score": 0, "creation_date": 1473688510, "post_id": 39449197, "comment_id": 66225233, "body": "Thanks! I tried your suggestion, and it did compile. I ran it with <code>.&#47;main -o output.gif -w 400</code> But the resulting gif file was just a large black square: no circles were shown. Did you have the same problems on your computer?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "edited": false, "score": 1, "creation_date": 1473691642, "post_id": 39449197, "comment_id": 66227472, "body": "@smilingbuddha: it seems the Gif backend defaults to black background and foreground; if you use e.g. <code>circle  1 # lc white</code> then you&#39;ll see a white outline of a circle on a black background."}, {"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1473694560, "post_id": 39449197, "comment_id": 66229192, "body": "@Cactus Oh I see. Thanks!!! I tried add <code># white</code> to both elements of my array. But now I only see a single white circle, on a black background. I wanted the animation to keep switching between the two white circles."}], "tags": [], "owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "is_accepted": true, "score": 3, "last_activity_date": 1484642562, "last_edit_date": 1484642562, "creation_date": 1473679326, "answer_id": 39449197, "question_id": 39441671, "link": "https://stackoverflow.com/questions/39441671/how-to-create-this-simple-gif-animation-with-diagrams/39449197#39449197", "title": "How to create this simple gif animation with Diagrams", "body": "<p>It took me a moment to figure it out, because the error message is not obvious at all, but it's a backend problem. <a href=\"http://projects.haskell.org/diagrams/doc/manual.html#animated-gifs\" rel=\"nofollow noreferrer\">The documentation</a> states that the cairo backend can create animated gif. However, you are using the svg backend (which is unable to understand what <code>[(Diagram B, Int)]</code> is.</p>\n\n<p>To solve this, make sure you have the <code>diagrams-cairo</code> package installed, and change the line</p>\n\n<pre><code>import Diagrams.Backend.SVG.CmdLine\n</code></pre>\n\n<p>to</p>\n\n<pre><code>import Diagrams.Backend.Cairo.CmdLine\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1973, "user_id": 1716999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a58106c9a1013f1ca791c46579d664?s=128&d=identicon&r=PG", "display_name": "rubystallion", "link": "https://stackoverflow.com/users/1716999/rubystallion"}, "is_accepted": false, "score": 3, "last_activity_date": 1523075034, "creation_date": 1523075034, "answer_id": 49703816, "question_id": 39441671, "link": "https://stackoverflow.com/questions/39441671/how-to-create-this-simple-gif-animation-with-diagrams/49703816#49703816", "title": "How to create this simple gif animation with Diagrams", "body": "<p>I'll explain the other steps necessary, since this is one of the first search results for doing animations in diagrams. Diagrams rescales the viewport to the image size for each circle, so that <code>circle 1</code> and <code>circle 2</code> are equivalent. To solve this you can lay the circles on invisible squares of the same size as <code>circle 2</code>. \nAlso the delays are given in 1/100 seconds. The correct code would then be:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\nimport Diagrams.Backend.Cairo.CmdLine\nimport Diagrams.Prelude\n\ngif :: [(Diagram B, Int)]\ngif = map (\\x -&gt; (x # lc white &lt;&gt; square 4 # lw none,300)) [circle 1,circle 2]\n\nmain = mainWith gif\n</code></pre>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 690, "favorite_count": 2, "accepted_answer_id": 39449197, "answer_count": 2, "score": 2, "last_activity_date": 1523075034, "creation_date": 1473637035, "question_id": 39441671, "link": "https://stackoverflow.com/questions/39441671/how-to-create-this-simple-gif-animation-with-diagrams", "title": "How to create this simple gif animation with Diagrams", "body": "<p>I am trying to understand how to use Diagrams library in Haskell. </p>\n\n<p>Here is my attempt at making a simple gif animation which switches between two circles of radii 1 and 2. I tried to mimic what I saw on </p>\n\n<p>Here is the code, I tried. </p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\nimport Diagrams.Backend.SVG.CmdLine\nimport Diagrams.Prelude\n\ndelays = take 2 (repeat 3)\n\ngif :: [(Diagram B, Int)]\ngif = zip [circle 1, circle 2] delays\n\nmain = mainWith $ gif\n</code></pre>\n\n<p>But this fails to compile! The errors I get are </p>\n\n<pre><code>[1 of 1] Compiling Main             ( maze.hs, maze.o )\n\nmaze.hs:10:8:\n    No instance for (Diagrams.Backend.CmdLine.Parseable\n                       (Diagrams.Backend.CmdLine.MainOpts\n                          [(QDiagram B V2 Double Any, Int)]))\n      arising from a use of \u2018mainWith\u2019\n    In the expression: mainWith\n    In the expression: mainWith $ gif\n    In an equation for \u2018main\u2019: main = mainWith $ gif\n</code></pre>\n\n<p>Where am I going wrong in the code above? </p>\n"}, {"tags": ["haskell", "reflection", "types"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1473637497, "post_id": 39441509, "comment_id": 66205674, "body": "Does <a href=\"https://hackage.haskell.org/package/QuickCheck-2.9.1/docs/Test-QuickCheck-Arbitrary.html\" rel=\"nofollow noreferrer\"><code>Arbitrary</code></a> already do what you want (without resorting to <code>Data.Data</code>)? Otherwise, what are the arguments you would like fed to the constructors?"}, {"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1473638655, "post_id": 39441509, "comment_id": 66205882, "body": "Basically I want to join a list of numbers with the list of constructors. But I want to dynamically get the list of constructors."}, {"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1473638747, "post_id": 39441509, "comment_id": 66205898, "body": "<code>Arbitrary</code> does not help me in this case. I am not looking to randomly generate data. I want to test a condition for every data instance."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1473651335, "post_id": 39441509, "comment_id": 66208086, "body": "You might also want to look at whatever <code>smallcheck</code> uses to generate test cases. Unlike quickcheck, it&#39;s designed for exhaustive testing."}, {"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1473653922, "post_id": 39441509, "comment_id": 66208630, "body": "@dfeuer I think the answer might be to actually use smallcheck! Thanks for the recommendation."}], "answers": [{"comments": [{"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1473654153, "post_id": 39442721, "comment_id": 66208679, "body": "The data type is not my actual data type. It was the simplest example I could make that would express what I am trying to accomplish. So, the tagged example would not work for me. But thanks for the suggestion."}, {"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1473657380, "post_id": 39442721, "comment_id": 66209443, "body": "I am breaking down piece by piece your answer for the sake of my own understanding, and when I execute this <code>fromConstrM (Just 10 :: Maybe Int) ctor</code> I get <code>Couldn&#39;t match type \u2018d\u2019 with \u2018Int\u2019       \u2018d\u2019 is a rigid type variable bound by         a type expected by the context:           forall d. Data d =&gt; Maybe d         at &lt;interactive&gt;:52:1       Expected type: Maybe d         Actual type: Maybe Int</code> In this case, ctorA does indeed hold a valid <code>A</code> constructor <code>show ctorA</code> -&gt; &quot;A&quot;"}, {"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1473658322, "post_id": 39442721, "comment_id": 66209712, "body": "OK, I have it partially figured out: <code>let c = cast 10 :: forall d. Data d =&gt; Maybe d</code> then <code>fromConstrM c ctorA</code> but I get <code>Just ()</code>"}, {"owner": {"reputation": 1207, "user_id": 795380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fdf8867c62227b63bdf5cf7063f6e54?s=128&d=identicon&r=PG", "display_name": "jgriego", "link": "https://stackoverflow.com/users/795380/jgriego"}, "reply_to_user": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1473704114, "post_id": 39442721, "comment_id": 66233745, "body": "You&#39;ve got the right idea. <code>cast 10 :: forall d. Data d =&gt; Maybe d</code> would <i>almost</i> work but the type of <code>10</code> is going to default to <code>Integer</code> so when we try and cast it to <code>Int</code> we&#39;re going to have a problem.  Issue #2 is that when you call <code>fromConstrM</code> you need to be more specific about type since otherwise you&#39;ll get a <code>forall d. Data d =&gt; Maybe d</code> and GHCi is nice enough to default to <code>d ~ ()</code> for you.  So the full incantation should be <code>fromConstrM (cast (10 :: Int)) ctorA :: Maybe ABC</code>"}], "tags": [], "owner": {"reputation": 1207, "user_id": 795380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fdf8867c62227b63bdf5cf7063f6e54?s=128&d=identicon&r=PG", "display_name": "jgriego", "link": "https://stackoverflow.com/users/795380/jgriego"}, "is_accepted": true, "score": 6, "last_activity_date": 1523451121, "last_edit_date": 1523451121, "creation_date": 1473648268, "answer_id": 39442721, "question_id": 39441509, "link": "https://stackoverflow.com/questions/39441509/dynamically-get-the-list-of-data-constructors-of-a-type/39442721#39442721", "title": "Dynamically get the list of data constructors of a type", "body": "<p>If you're OK with using <code>Data.Data</code>, it works for this use case, but is a little clunky because of the <code>Int</code> parameters.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\nimport Data.Data\nimport Data.Typeable\n\nallCtors :: forall a. Data a =&gt; [Int -&gt; a]\nallCtors = map observeCtor $ dataTypeConstrs $ dataTypeOf (undefined :: a)\n  where\n    observeCtor :: Constr -&gt; Int -&gt; a\n    observeCtor c i = fromJust $ fromConstrM (cast i) c\n</code></pre>\n\n<p>Then we have e.g.</p>\n\n<pre><code>\u03bb data ABC = A Int | B Int | C Int deriving (Show, Data, Typeable)\ndata ABC = A Int | B Int | C Int\n\u03bb map ($ 2) allCtors :: [ABC]\n[A 2,B 2,C 2]\n</code></pre>\n\n<p>If you don't want to use <code>Data.Data</code>, you might to be able to do this with <code>GHC.Generics</code> and <code>-XDefaultSignatures</code></p>\n\n<hr>\n\n<p>FWIW, you wouldn't have to deal with any of this if you could refactor ABC so that the A,B,C tags were their own type...</p>\n\n<pre><code>data ABCTagged = ABCTagged ABC Int deriving Show\n\ndata ABC = A | B | C deriving (Show, Eq, Ord, Enum. Bounded)\n</code></pre>\n\n<p>... then just use <code>enumFrom minBound :: [ABC]</code> to get the whole list. Easy! Not sure how feasible this is for you though.</p>\n"}], "owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 640, "favorite_count": 1, "accepted_answer_id": 39442721, "answer_count": 1, "score": 4, "last_activity_date": 1523451205, "creation_date": 1473635361, "last_edit_date": 1523451205, "question_id": 39441509, "link": "https://stackoverflow.com/questions/39441509/dynamically-get-the-list-of-data-constructors-of-a-type", "title": "Dynamically get the list of data constructors of a type", "body": "<p>I have a data type like this:</p>\n\n<p><code>data ABCS = A Int | B Int | ... | Z Int deriving (Data, Typeable)</code></p>\n\n<p>In a test, I want to dynamically extract all the constructors, make an instance from each constructor, then run the test.</p>\n\n<p>I have been looking through <code>Data.Typeable</code> and <code>Data.Data</code>, but I have not yet seen/understood exactly how to do this starting with only the type (ABC).</p>\n\n<p>Help is much appreciated.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1473649987, "post_id": 39441135, "comment_id": 66207869, "body": "QuickCheck&#39;s vague notion of &quot;size&quot; is the aspect of the library I find most unsatisfactory. Lots of things in QuickCheck just &quot;do the obviously right thing&quot;, but as soon as size enters the picture it goes fuzzy and leaves the user with little guidance about how to make the fiddly judgement calls."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 3, "last_activity_date": 1473632344, "last_edit_date": 1473632344, "creation_date": 1473632003, "answer_id": 39441135, "question_id": 39441006, "link": "https://stackoverflow.com/questions/39441006/what-does-the-growingelements-function-in-quickcheck-do/39441135#39441135", "title": "What does the growingElements function in QuickCheck do?", "body": "<p>QuickCheck has a \"size parameter\" that controls how big the randomly generated inputs can be. It starts by generating smaller test inputs and increases them as it runs more and more tests.</p>\n\n<p>The QuickCheck manual goes into <a href=\"http://www.cse.chalmers.se/~rjmh/QuickCheck/manual_body.html#15\" rel=\"nofollow\">more detail</a> about this:</p>\n\n<blockquote>\n  <p>Test data generators have an implicit <em>size</em> parameter; <code>quickCheck</code> begins by generating small test cases, and gradually increases the size as testing progresses. Different test data generators interpret the size parameter in different ways: some ignore it, while the list generator, for example, interprets it as an upper bound on the length of generated lists. You are free to use it as you wish to control your own test data generators. </p>\n</blockquote>\n\n<p>In the case of <code>growingElements</code>, the size parameter controls how far into the list the generator looks when selecting an entry at random.</p>\n\n<p>If you want to play around with the <code>size</code> parameter yourself, you can use the <code>sized</code> combinator:</p>\n\n<pre><code>sized :: (Int -&gt; Gen a) -&gt; Gen a\n</code></pre>\n\n<p>This lets you write your own <code>Gen a</code> values that depend on the size passed in. Here's what <code>growingElements</code> could look like:</p>\n\n<pre><code>growingElements' xs = sized (\\ size -&gt; oneOf (take size xs))\n</code></pre>\n\n<p>If you want to see how the existing <code>growingElements</code> behaves at different sizes, you can fix a particular size using the <code>resize</code> function. Try</p>\n\n<pre><code>resize 1 (growingElements [1..])\n</code></pre>\n\n<p>which should only return smallish numbers from the beginning of the list. (I looked up <a href=\"https://hackage.haskell.org/package/QuickCheck-2.9.1/docs/src/Test-QuickCheck-Gen.html#growingElements\" rel=\"nofollow\">the actual implementation</a> and it uses some fiddly arithmetic to choose the number of elements based on the size parameter, so I'm too lazy to figure out exactly how it behaveds :)).</p>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 39441135, "answer_count": 1, "score": 2, "last_activity_date": 1473646220, "creation_date": 1473630850, "last_edit_date": 1473646220, "question_id": 39441006, "link": "https://stackoverflow.com/questions/39441006/what-does-the-growingelements-function-in-quickcheck-do", "title": "What does the growingElements function in QuickCheck do?", "body": "<p>I was poking around the documentation of QuickCheck when I stumbled into the <a href=\"https://hackage.haskell.org/package/QuickCheck-2.9.1/docs/Test-QuickCheck-Gen.html#v:growingElements\" rel=\"nofollow\">growingElements</a> function. The documentation there says</p>\n\n<blockquote>\n  <p>Takes a list of elements of increasing size, and chooses among an\n  initial segment of the list. The size of this initial segment\n  increases with the size parameter. The input list must be non-empty.</p>\n</blockquote>\n\n<p>What exactly does this mean? When I tried this function in ghci, \nit just returns random values in the a given array when I run <code>generate</code> on it again and again. I don't see the difference between randomly choosing from the list and what this function is doing. </p>\n\n<pre><code>*Main Test.QuickCheck&gt; generate $ growingElements [1..100]\n13\n*Main Test.QuickCheck&gt; generate $ growingElements [1..100]\n53\n*Main Test.QuickCheck&gt; \n*Main Test.QuickCheck&gt; generate $ growingElements [1..100]\n65\n*Main Test.QuickCheck&gt; generate $ growingElements [1..100]\n49\n*Main Test.QuickCheck&gt; \n</code></pre>\n\n<p>Could someone explain more clearly what this function actually does?</p>\n"}, {"tags": ["haskell", "gadt", "existential-type"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1473690829, "last_edit_date": 1473690829, "creation_date": 1473630445, "answer_id": 39440958, "question_id": 39440920, "link": "https://stackoverflow.com/questions/39440920/gadts-unparametrized-types-and-instance-eq-for-them/39440958#39440958", "title": "GADTs, unparametrized types and instance Eq for them", "body": "<p>Add <code>Typeable</code> so that you have a runtime representation of the type; then use <code>cast</code> to cast one of them to the appropriate type.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\nimport Data.Typeable\n\ndata X where X :: (Eq a, Typeable a) =&gt; a -&gt; X\n\ninstance Eq X where \n    X x == X y = Just x == cast y\n</code></pre>\n"}], "owner": {"reputation": 1075, "user_id": 1299428, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/330bcefb9bb0b6a8e071e5c8b2ff9d6b?s=128&d=identicon&r=PG&f=1", "display_name": "Sophie", "link": "https://stackoverflow.com/users/1299428/sophie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 1, "accepted_answer_id": 39440958, "answer_count": 1, "score": 1, "last_activity_date": 1473853284, "creation_date": 1473630097, "last_edit_date": 1473853284, "question_id": 39440920, "link": "https://stackoverflow.com/questions/39440920/gadts-unparametrized-types-and-instance-eq-for-them", "title": "GADTs, unparametrized types and instance Eq for them", "body": "<p>I have a container type, called <code>X</code>. Since I want heterogeneous lists over <code>X</code>, its constructor is existentially typed over some type variable <code>a</code>. However, I want it to be an instance of the <code>Eq</code> type class. A hackish solution looks like this:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata X where X :: (Eq a, Show a) =&gt; a -&gt; X\n\ninstance Eq X where\n    X x == X y = show x == show y\n</code></pre>\n\n<p>What would be the simplest (clean) solution for this problem?</p>\n\n<p>(<code>X</code>s don't equal if they don't have the same type.)</p>\n"}, {"tags": ["haskell", "ghci", "haskell-stack"], "comments": [{"owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 0, "creation_date": 1473690577, "post_id": 39440416, "comment_id": 66226777, "body": "What is the exact nightly snapshot you&#39;re using (in fact would you be able to post a minimal <code>stack.yaml</code> where this still occurs?). Does this also occur on the current LTS snapshot for you? Which postgres version do you have installed? Did you compile postgres yourself or install it some other way?"}, {"owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "reply_to_user": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 0, "creation_date": 1473693661, "post_id": 39440416, "comment_id": 66228665, "body": "Thanks for the comment. I remember based on your questions, that I did have problems installed <code>postgresql-libpq</code>, which is likely related to the issue I am having. Still, it seemed weird that my project would compile and run fine, but that I would get segfaults in GHCI. I&#39;ll try to switch resolvers and see what happens. I am using <code>DuplicateRecordFields</code>, but I can probably omit that and give it a shot."}, {"owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "reply_to_user": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 0, "creation_date": 1473694708, "post_id": 39440416, "comment_id": 66229277, "body": "@user2847643 I also tried it with <code>lts-6.17</code> and it segfaulted there as well."}, {"owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 0, "creation_date": 1473715286, "post_id": 39440416, "comment_id": 66239151, "body": "Hmm. This seems hard to reproduce. I can&#39;t see anything obviously wrong with your config but I have zero OSX experience nor do I have a Mac handy to run tests. Since you say it segfaults even on <code>lts-6.17</code> which is odd it&#39;s a good bet that there is something wrong with your postgres install. If I were you I would probably be wiping everything clean right about now. Including all of <code>~&#47;.stack</code> and postgres. Also I would stay on LTS for now just to be safe. Otherwise you can hope for some hints from <code>gdb</code> maybe but that&#39;s a kind of a long shot."}, {"owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "reply_to_user": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 0, "creation_date": 1473717448, "post_id": 39440416, "comment_id": 66240006, "body": "Well, I appreciate the feedback and that you were reading. I&#39;ll give your suggestions a shot."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473811667, "post_id": 39479573, "comment_id": 66280385, "body": "You might want to file a bug report, and send a message to haskell-cafe. Those should get a few more eyes on your issue."}], "tags": [], "owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "is_accepted": true, "score": 1, "last_activity_date": 1473803616, "creation_date": 1473803616, "answer_id": 39479573, "question_id": 39440416, "link": "https://stackoverflow.com/questions/39440416/ghci-segfault-when-creating-a-database-connection-with-postgresql-simple/39479573#39479573", "title": "GHCI Segfault When Creating a Database Connection with postgresql-simple", "body": "<p>While attempting to generate a stack trace for my issue, I discovered that I can start ghci in the following way:</p>\n\n<pre><code>$ stack ghci --ghci-options -fexternal-interpreter\n</code></pre>\n\n<p>And then, for whatever, reason, the segfault does not appear and everything works as expected. I have no idea if anyone else will find this useful. </p>\n\n<p>The thing that seemed weird to me was that I didn't have an issue when the code was compiled and run. I only had an issue in GHCI. </p>\n\n<p>Anyway, until I find out more or someone has a better suggestion, I'll go with this so I can continue testing what I want in the REPL.</p>\n"}], "owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "accepted_answer_id": 39479573, "answer_count": 1, "score": 6, "last_activity_date": 1473803616, "creation_date": 1473626251, "last_edit_date": 1473713743, "question_id": 39440416, "link": "https://stackoverflow.com/questions/39440416/ghci-segfault-when-creating-a-database-connection-with-postgresql-simple", "title": "GHCI Segfault When Creating a Database Connection with postgresql-simple", "body": "<p>I am getting a GHCI segfault when trying to create a database connection in GHCI with postgresql-simple. </p>\n\n<p>I am using GHC 8.0.1, OSX 10.11.16. I do not have a system GHC, only the one installed by stack. </p>\n\n<p>If I do the following in my project, it segfaults:</p>\n\n<pre><code>$ stack ghci\nLoaded GHCi configuration from /private/var/folders/wb/vvtxjd7n2qz02f571yjyr9j40000gs/T/ghci62972/ghci-script\ngchi&gt; :set -XOverloadedStrings\ngchi&gt; import Database.PostgreSQL.Simple\ngchi&gt; let connstr = \"host=localhost port=5432 user=myusername password=mypass dbname=local\"\ngchi&gt; conn &lt;- connectPostgreSQL connstr\nzsh: segmentation fault  stack ghci\n</code></pre>\n\n<p>I thought it might be worth looking at that file it mentions, so here are the contents:</p>\n\n<pre><code>&gt; cat /private/var/folders/wb/vvtxjd7n2qz02f571yjyr9j40000gs/T/ghci62972/ghci-script\n:load \"/Users/erewok/projects/haskell/simpleservantblog/app/Main.hs\" \"Api\" \"Api.Post\" \"Api.User\" \"Config\" \"Html.Home\" \"Models.Author\" \"Models.Post\"\n:module + Api Api.Post Api.User Config Html.Home Models.Author Models.Post\n</code></pre>\n\n<p>It's a list of all the modules loaded from the project (which compiles and runs fine).</p>\n\n<hr>\n\n<p>Here's the complete output of everything from starting <code>ghci</code> up to the seg fault:</p>\n\n<pre><code>$ stack ghci\nThe following GHC options are incompatible with GHCi and have not been passed to it: -threaded\nUsing main module: 1. Package `simpleservantblog' component exe:simpleservantblog-exe with main-is file: /Users/erewok/projects/haskell/simpleservantblog/app/Main.hs\nConfiguring GHCi with the following packages: simpleservantblog\nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from /Users/erewok/.ghci\n[1 of 8] Compiling Models.Author    ( /Users/erewok/projects/haskell/simpleservantblog/src/Models/Author.hs, interpreted )\n[2 of 8] Compiling Models.Post      ( /Users/erewok/projects/haskell/simpleservantblog/src/Models/Post.hs, interpreted )\n[3 of 8] Compiling Html.Home        ( /Users/erewok/projects/haskell/simpleservantblog/src/Html/Home.hs, interpreted )\n[4 of 8] Compiling Api.User         ( /Users/erewok/projects/haskell/simpleservantblog/src/Api/User.hs, interpreted )\n[5 of 8] Compiling Api.Post         ( /Users/erewok/projects/haskell/simpleservantblog/src/Api/Post.hs, interpreted )\n[6 of 8] Compiling Config           ( /Users/erewok/projects/haskell/simpleservantblog/src/Config.hs, interpreted )\n[7 of 8] Compiling Api              ( /Users/erewok/projects/haskell/simpleservantblog/src/Api.hs, interpreted )\n[8 of 8] Compiling Main             ( /Users/erewok/projects/haskell/simpleservantblog/app/Main.hs, interpreted )\nOk, modules loaded: Api, Config, Api.Post, Api.User, Html.Home, Models.Post, Models.Author, Main.\nLoaded GHCi configuration from /private/var/folders/wb/vvtxjd7n2qz02f571yjyr9j40000gs/T/ghci64266/ghci-script\ngchi&gt; :set -XOverloadedStrings\ngchi&gt; import Database.PostgreSQL.Simple\ngchi&gt; let connstr = \"host=localhost port=5432 user=myusername password=mypass dbname=local\"\ngchi&gt; conn &lt;- connectPostgreSQL connstr\nzsh: segmentation fault  stack ghci\n</code></pre>\n\n<hr>\n\n<p><strong>More Information</strong></p>\n\n<p>Postgresql Version: 9.5, installed using the <a href=\"https://www.postgresql.org/download/macosx/\" rel=\"nofollow\">EnterpriseDB installer</a></p>\n\n<p>The request to post my <em>stack.yaml</em> (which is below) reminded me of an issue I had when <a href=\"https://github.com/lpsmith/postgresql-libpq/issues/9#issuecomment-205040648\" rel=\"nofollow\">trying to install postgresql-libpq</a>. This is probably related.</p>\n\n<p><em>Stack.yaml</em></p>\n\n<pre><code># This file was automatically generated by stack init\n# For more information, see: http://docs.haskellstack.org/en/stable/yaml_configuration/\n\n# Specifies the GHC version and set of packages available (e.g., lts-3.5, nightly-2015-09-21, ghc-7.10.2)\nresolver: nightly-2016-08-25\n\n# Local packages, usually specified by relative directory name\npackages:\n- '.'\n- location:\n    git: https://www.github.com/mattjbray/elm-export\n    commit: 8868c1f09597f44c2e18e014cd9fbcf8320c3fea\n  extra-dep: True\n- location:\n    git: https://www.github.com/mattjbray/servant-elm\n    commit: e13c8def8127ea339e9801d804638854947193e8\n  extra-dep: True\n# Packages to be pulled from upstream that are not in the resolver (e.g., acme-missiles-0.3)\nextra-deps:\n  - wai-make-assets-0.1.1\n\n# Override default flag values for local packages and extra-deps\nflags: {}\n\n# Extra package databases containing global packages\nextra-package-dbs: []\n\n# Control whether we use the GHC we find on the path\n# system-ghc: true\n\n\n# Extra directories used by stack for building\n# extra-include-dirs: [/path/to/dir]\nextra-lib-dirs: [/usr/local/opt/libiconv/lib, /usr/local/lib, /usr/lib]\n</code></pre>\n\n<hr>\n\n<p><strong>Also segfaults on GHC 7.10.3 with resolver lts-6.17</strong></p>\n\n<pre><code>gchi&gt; conn &lt;- connectPostgreSQL connstr\nzsh: segmentation fault  stack ghci --resolver lts-6.17\n</code></pre>\n\n<hr>\n\n<p><strong>An Idea I had</strong></p>\n\n<p>I think the version of <code>postgresql-libpq</code> I am using was built with <code>libiconv.2.dylib</code> compiled for <strong>Postgresql 9.4</strong>, but the database I am trying to connect to is actually <strong>Postgresql 9.5</strong>. This may be the reason for my issue.</p>\n\n<p><strong>A Thing I Did Inspired By that Idea</strong></p>\n\n<p>Here are some steps I took to try to debug further and/or fix this. I first linked the Postgresql 9.5 <code>*dylib</code> files into my <code>/usr/local/lib</code> directory in order to replace the old ones linked against the Postgresql 9.4 version.</p>\n\n<pre><code>$ cd /usr/local/lib\n$ sudo ln -s -f /Library/PostgreSQL/9.5/lib/*dylib .\n</code></pre>\n\n<p>After that, I tried to force <code>stack</code> to rebuild <code>postgresql-libpq</code> and <code>postgresql-simple</code> in this way:</p>\n\n<pre><code>  $ stack exec -- ghc-pkg unregister --force postgresql-simple\n  $ stack exec -- ghc-pkg unregister --force postgresql-libpq\n  $ rm -rf ~/.stack/precompiled/x86_64-osx/ghc-8.0.1/1.24.0.0/postgresql-libpq-0.9.1.1/\n  $  rm -rf ~/.stack/precompiled/x86_64-osx/ghc-8.0.1/1.24.0.0/postgresql-simple-0.5.2.*\n  $ stack build\n</code></pre>\n\n<p>At which point, it promised me it would build and configure the removed packages. Still segfaulted when I ran the above, however.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "edited": false, "score": 1, "creation_date": 1473628632, "post_id": 39440412, "comment_id": 66203804, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/9952602/does-haskell-require-a-garbage-collector\">Does Haskell require a garbage collector?</a>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1473637301, "post_id": 39440412, "comment_id": 66205645, "body": "I think it&#39;d be pretty tough to implement Haskell&#39;s graph-rewriting semantics without something resembling a heap"}], "answers": [{"comments": [{"owner": {"reputation": 2409, "user_id": 1010494, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/749f82fadb98934c0fe9782ed8067f51?s=128&d=identicon&r=PG", "display_name": "grasevski", "link": "https://stackoverflow.com/users/1010494/grasevski"}, "edited": false, "score": 0, "creation_date": 1473630368, "post_id": 39440738, "comment_id": 66204241, "body": "My understanding is that concatenative languages (which generally just use a stack) could in principle return a variable amount of data by popping and pushing to the stack, e.g. every function basically has the definition &#39;void foo(stack *s)&#39;."}, {"owner": {"reputation": 306, "user_id": 6804703, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-T8mmzU7CMaQ/AAAAAAAAAAI/AAAAAAAACpM/SUjjWffX6f0/photo.jpg?sz=128", "display_name": "a.yekimov", "link": "https://stackoverflow.com/users/6804703/a-yekimov"}, "reply_to_user": {"reputation": 2409, "user_id": 1010494, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/749f82fadb98934c0fe9782ed8067f51?s=128&d=identicon&r=PG", "display_name": "grasevski", "link": "https://stackoverflow.com/users/1010494/grasevski"}, "edited": false, "score": 0, "creation_date": 1473630775, "post_id": 39440738, "comment_id": 66204322, "body": "Every function can rise it&#39;s stack, but not the caller&#39;s stack. Caller needs to know how many memory it needs to allocate for return value before any function may be called."}, {"owner": {"reputation": 2409, "user_id": 1010494, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/749f82fadb98934c0fe9782ed8067f51?s=128&d=identicon&r=PG", "display_name": "grasevski", "link": "https://stackoverflow.com/users/1010494/grasevski"}, "edited": false, "score": 0, "creation_date": 1473636507, "post_id": 39440738, "comment_id": 66205489, "body": "Then how do stack based programming languages work? I think it&#39;s implemented as a separate stack for function calls and a separate stack for data, so this problem never arises. I.e. Like the c declaration I provided."}, {"owner": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "edited": false, "score": 0, "creation_date": 1473775007, "post_id": 39440738, "comment_id": 66263103, "body": "The presence of heap allocations does not imply the presence of garbage collection. Most notably, the programming language <code>C</code> has heap allocations, but no garbage collector. So this answer is completely missing the question which doesn\u2019t ask about whether a heap is needed, but whether (or why) garbage collection is needed."}, {"owner": {"reputation": 306, "user_id": 6804703, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-T8mmzU7CMaQ/AAAAAAAAAAI/AAAAAAAACpM/SUjjWffX6f0/photo.jpg?sz=128", "display_name": "a.yekimov", "link": "https://stackoverflow.com/users/6804703/a-yekimov"}, "edited": false, "score": 0, "creation_date": 1473775424, "post_id": 39440738, "comment_id": 66263410, "body": "I just pointed that you need manage your memory regardless the language you use. GC is just very handy. And I pointed that you can&#39;t just translate your lambdas without need to manage memory by hands or automatically with GC, as authour of the question suggested."}], "tags": [], "owner": {"reputation": 306, "user_id": 6804703, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-T8mmzU7CMaQ/AAAAAAAAAAI/AAAAAAAACpM/SUjjWffX6f0/photo.jpg?sz=128", "display_name": "a.yekimov", "link": "https://stackoverflow.com/users/6804703/a-yekimov"}, "is_accepted": true, "score": 8, "last_activity_date": 1518915834, "last_edit_date": 1518915834, "creation_date": 1473628630, "answer_id": 39440738, "question_id": 39440412, "link": "https://stackoverflow.com/questions/39440412/why-do-functional-programming-languages-require-garbage-collection/39440738#39440738", "title": "Why do functional programming languages require garbage collection?", "body": "<p>Suppose I have a function that generates a linked list of some size. The size is the function parameter. </p>\n\n<p>The question is: where do I have to allocate memory for the list? \nI can't allocate it on the function's stack, since it's invalid after the function is out. And I can't allocate it on the caller's stack, since I don't know how many memory I need to allocate before the function call. So I need to allocate it on the heap. </p>\n\n<p>I think there may be <a href=\"https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization\" rel=\"nofollow noreferrer\">RAII</a> with manual heap management usable, But I can't see how to eliminate heap allocation at all.</p>\n\n<hr>\n\n<h3>Edit</h3>\n\n<p><em>I can't fit all my thoughts in the comment, so I write them here.</em></p>\n\n<p>There is no magic about stack-based allocation languages. You still need to know when your data is relevant and remove them when they're not. </p>\n\n<p>Imagine you have a separate stack, and your function has control to push and pop data in it. First, there is no automatic memory management anymore, i.e. the function terminates but the data is not deallocated automatically. Second, if you function allocates some memory, needed to support e.g. the list calculation, then all that stuff will be shuffled with the list that you want to return. No chance you can free unused memory (other lists, trees or so) since you have just push and pop operations. If you have other operations, then what is the difference with the heap?</p>\n\n<blockquote>\n  <p>What about few stacks, not one? </p>\n</blockquote>\n\n<p>You need to allocate them somewhere, manage their growth and sometimes get them back. That stacks are separate constructions that you need manage by hands. No automatic memory management.</p>\n\n<p>Stack-based languages are ok, but forget about the huge amount of algorithms, that was invented with the concept \"get memory from somewhere\" and \"put the memory back\", like hash maps, red-black trees, linked lists. Of course, we can allocate all of those structs on a stack, but we can't free their parts if they don't need anymore.</p>\n\n<blockquote>\n  <p>What about \"trivial\" lambda calculus translation to Turing machine? </p>\n</blockquote>\n\n<p>Of course, it is trivial, if you resources are infinite. The math theory clarifies nothing about time and memory complexity of such translated constructions. It just approves that both of that models are equivalent, and all that we can say with Turing machine we can say with lambda calculus, and vice-versa. No guarantees that it can work with real-life limitations.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 7, "last_activity_date": 1518917077, "last_edit_date": 1518917077, "creation_date": 1473642710, "answer_id": 39442187, "question_id": 39440412, "link": "https://stackoverflow.com/questions/39440412/why-do-functional-programming-languages-require-garbage-collection/39442187#39442187", "title": "Why do functional programming languages require garbage collection?", "body": "<p>A concatenative programming language is every bit as capable of running out of memory as a functional programming language. </p>\n\n<p>The fundamental challenge garbage collection addresses is freeing memory that is not, or is not known to be, used in a stack-like fashion. It is most especially useful when there is no clear place in the source code that can be pinpointed as the end of the object's lifetime. </p>\n\n<p>If you simply translate a functional language into a concatenative one with only stack allocation, then you will end up overflowing the stack. </p>\n\n<p>There have definitely been various efforts over the years to reduce the need for garbage collection. One interesting (but very complicated) attempt is the <em>region inference system</em> used in the ML Kit. Unfortunately, that's a bit much for most programmers, including myself, to understand. I believe others have worked on such systems since; I don't know the current state of the art. </p>\n\n<p>The take-away is that some very heavy compiler machinery, along with careful programmer discipline and perhaps special annotations, can <em>sometimes</em> reduce or eliminate the need for garbage collection; no trivial transformation is going to do the trick.</p>\n"}], "owner": {"reputation": 2409, "user_id": 1010494, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/749f82fadb98934c0fe9782ed8067f51?s=128&d=identicon&r=PG", "display_name": "grasevski", "link": "https://stackoverflow.com/users/1010494/grasevski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2973, "favorite_count": 6, "accepted_answer_id": 39440738, "answer_count": 2, "score": 16, "last_activity_date": 1518917077, "creation_date": 1473626209, "last_edit_date": 1518914835, "question_id": 39440412, "link": "https://stackoverflow.com/questions/39440412/why-do-functional-programming-languages-require-garbage-collection", "title": "Why do functional programming languages require garbage collection?", "body": "<p>According to Wikipedia, the translation from lambda calculus to combinatory logic is trivial. Concatenative programming languages can rely solely on a stack for memory allocation.</p>\n\n<p>What's stopping GHC from translating Haskell into a concatenative programming language, such as combinatory logic, and then simply using stack allocation for everything? </p>\n\n<p>Is it feasible to do this translation and thus eliminate garbage collection for languages such as Haskell and OCaml? Are there downsides to doing this?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 189, "user_id": 1243776, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/lXOnZ.jpg?s=128&g=1", "display_name": "Can", "link": "https://stackoverflow.com/users/1243776/can"}, "edited": false, "score": 0, "creation_date": 1473624713, "post_id": 39439874, "comment_id": 66202766, "body": "Hi Rakete1111, thanks for your comment. I just had another small experiment to confirm one more thing. You mentioned that I can&#39;t add [Char] to char. However, when I do this line in ghci ( &#39;c&#39;:&quot;dfg&quot; ) it is valid. So can we say (++) operator requires same type."}, {"owner": {"reputation": 42370, "user_id": 3980929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xyKrD.png?s=128&g=1", "display_name": "Rakete1111", "link": "https://stackoverflow.com/users/3980929/rakete1111"}, "reply_to_user": {"reputation": 189, "user_id": 1243776, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/lXOnZ.jpg?s=128&g=1", "display_name": "Can", "link": "https://stackoverflow.com/users/1243776/can"}, "edited": false, "score": 0, "creation_date": 1473625106, "post_id": 39439874, "comment_id": 66202853, "body": "@CanEldem Well, technically, yes. You&#39;re line is valid because the type of <code>c</code> is the type of an element in <code>&quot;dfg&quot;</code>, i.e. <code>Char</code>. <code>&quot;c&quot;:&quot;dfg&quot;</code> would be invalid."}], "tags": [], "owner": {"reputation": 42370, "user_id": 3980929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xyKrD.png?s=128&g=1", "display_name": "Rakete1111", "link": "https://stackoverflow.com/users/3980929/rakete1111"}, "is_accepted": false, "score": 4, "last_activity_date": 1473622204, "creation_date": 1473622204, "answer_id": 39439874, "question_id": 39439834, "link": "https://stackoverflow.com/questions/39439834/pattern-xxs-with-strings/39439874#39439874", "title": "Pattern x:xs with strings", "body": "<pre><code>\"Hello ++ firstLetter\n</code></pre>\n\n<p>The types there are:</p>\n\n<pre><code>[Char] ++ Char\n</code></pre>\n\n<p>As you can see, that isn't possible. You can't add a <code>Char</code> to a <code>[Char]</code>, they are different types!</p>\n\n<p>But by doing</p>\n\n<pre><code>[firstLetter]\n</code></pre>\n\n<p>you are creating a list with 1 element, <code>firstLetter</code>. Because <code>firstLetter</code> is a <code>Char</code>, you'll get a list of <code>Char</code>s, i.e. the list is of type <code>[Char]</code>.</p>\n\n<p>Adding 2 lists of the same type is allowed, and that's why it works in the second case.</p>\n"}, {"tags": [], "owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "is_accepted": true, "score": 5, "last_activity_date": 1473626098, "creation_date": 1473626098, "answer_id": 39440394, "question_id": 39439834, "link": "https://stackoverflow.com/questions/39439834/pattern-xxs-with-strings/39440394#39440394", "title": "Pattern x:xs with strings", "body": "<p>First, if you check the type of <code>(++)</code> in ghci, you get:</p>\n\n<pre><code>Prelude&gt; :t (++)\n(++) :: [a] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>That means it takes two lists of a's as arguments.</p>\n\n<p>Likewise let's see what <code>(:)</code> does:</p>\n\n<pre><code>Prelude&gt; :t (:)\n(:) :: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>So the first argument of <code>(:)</code> need not be a list at all. If we fix <code>a == Char</code> we in fact get <code>(:) :: Char -&gt; String -&gt; String</code>.</p>\n\n<p>We can define a function <code>headStr</code> (recall <code>String == [Char]</code>):</p>\n\n<pre><code>headStr :: String -&gt; Char\nheadStr (x:_) = x\nheadStr _ = error \"Empty string!\"\n</code></pre>\n\n<p>Note that due to the type of <code>(:)</code> in this case <code>x :: Char</code>.</p>\n\n<p>On the other hand if we try to define:</p>\n\n<pre><code>hello :: String -&gt; String\nhello (x:_) = \"Hello\" ++ x\nhello _ = error \"Empty string!\"\n</code></pre>\n\n<p>it will not type check because in the non error case we get <code>[Char] ++ Char</code>. As ghci helpfully told us, the second argument to <code>(++)</code> must always be a list and in this case since the first argument is <code>[Char]</code> it must also be <code>[Char]</code>.</p>\n\n<p>As you noticed yourself, this can be fixed by wrapping <code>x</code> in a list:</p>\n\n<pre><code>hello' :: String -&gt; String\nhello' (x:_) = \"Hello\" ++ [x]\nhello' _ = error \"Empty string!\"\n</code></pre>\n\n<p>and this works as expected.</p>\n"}], "owner": {"reputation": 189, "user_id": 1243776, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/lXOnZ.jpg?s=128&g=1", "display_name": "Can", "link": "https://stackoverflow.com/users/1243776/can"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1204, "favorite_count": 0, "accepted_answer_id": 39440394, "answer_count": 2, "score": 1, "last_activity_date": 1473626098, "creation_date": 1473621931, "last_edit_date": 1473622245, "question_id": 39439834, "link": "https://stackoverflow.com/questions/39439834/pattern-xxs-with-strings", "title": "Pattern x:xs with strings", "body": "<p>I am quite new in Haskell world. I was reading the online <a href=\"http://learnyouahaskell.com\" rel=\"nofollow\">http://learnyouahaskell.com</a> but I could not understand a small detail about pattern-matching section. I have written those functions</p>\n\n<pre><code>myFunc' (firstLetter:_) = firstLetter -- returns firstLetter of given string\n</code></pre>\n\n<p>However if I do something like that</p>\n\n<pre><code>myFunc' (firstLetter:_) = \"Hello\" ++firstLetter\n</code></pre>\n\n<p>Gives me following error when I call this function</p>\n\n<pre><code>Couldn't match type \u2018Char\u2019 with \u2018[Char]\u2019\n      Expected type: [[Char]]\n        Actual type: [Char]\n</code></pre>\n\n<p>But if I modify the function like this </p>\n\n<pre><code>myFunc' (firstLetter:_) = \"Hello\" ++ [firstLetter]\n</code></pre>\n\n<p>That works fine when I call this function. I was wondering why do I need brackets in other cases. What is actually firstLetter.</p>\n"}, {"tags": ["haskell", "fixpoint-combinators"], "answers": [{"comments": [{"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 1, "creation_date": 1473621102, "post_id": 39439677, "comment_id": 66201786, "body": "That should be <code>\\(~(u,v))</code> or <code>\\ ~(u,v)</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 3, "creation_date": 1473621163, "post_id": 39439677, "comment_id": 66201802, "body": "@redneb Fixed. (pun intended :-P)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 14, "last_activity_date": 1473702323, "last_edit_date": 1473702323, "creation_date": 1473620921, "answer_id": 39439677, "question_id": 39439600, "link": "https://stackoverflow.com/questions/39439600/why-does-haskells-fix-seem-to-have-trouble-with-tuples/39439677#39439677", "title": "Why does haskell&#39;s `fix` seem to have trouble with tuples?", "body": "<p>You want</p>\n\n<pre><code>take 10 $ fst $ fix (\\ ~(u,v) -&gt; (0:v,1:u))\n                      ^^^\n</code></pre>\n\n<p>so as to make the pattern matching lazy. In <code>let</code>, the LHS pattern is implicitly lazy/irrefutable.</p>\n\n<p>With the plain <code>\\(u,v) -&gt; ...</code> the argument of the lambda will be demanded before any output is produced -- this makes the function too strict for <code>fix</code>. What you need is something like</p>\n\n<pre><code>take 10 $ fst $ fix (\\p -&gt; (0:snd p,1:fst p))\n</code></pre>\n\n<p>so that the argument is not forced by the lambda (there's no constructor there to match). The lazy pattern approach is equivalent to the <code>fst/snd</code> above.</p>\n"}], "owner": {"reputation": 2588, "user_id": 298736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb2a346fde4e2c5dc426aa702d181443?s=128&d=identicon&r=PG", "display_name": "Peter Milley", "link": "https://stackoverflow.com/users/298736/peter-milley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 39439677, "answer_count": 1, "score": 6, "last_activity_date": 1563167283, "creation_date": 1473620515, "last_edit_date": 1563167283, "question_id": 39439600, "link": "https://stackoverflow.com/questions/39439600/why-does-haskells-fix-seem-to-have-trouble-with-tuples", "title": "Why does haskell&#39;s `fix` seem to have trouble with tuples?", "body": "<p>I'm trying to bend my head around fixed points and recursive definitions.</p>\n\n<p>This works:</p>\n\n<pre><code>&gt;&gt;&gt; take 10 $ let x = (0:x) in x\n[0,0,0,0,0,0,0,0,0,0]\n</code></pre>\n\n<p>This does the same thing, which makes sense given the definition of <code>fix</code>:</p>\n\n<pre><code>&gt;&gt;&gt; take 10 $ fix (\\x -&gt; (0:x))\n[0,0,0,0,0,0,0,0,0,0]\n</code></pre>\n\n<p>Now suppose I start messing around with recursively defined pairs:</p>\n\n<pre><code>&gt;&gt;&gt; take 10 $ fst $ let (u,v) = (0:v,1:u) in (u,v)\n[0,1,0,1,0,1,0,1,0,1]\n</code></pre>\n\n<p>Okay, I should be able to write that with <code>fix</code> too, right?</p>\n\n<pre><code>&gt;&gt;&gt; take 10 $ fst $ fix (\\(u,v) -&gt; (0:v,1:u))\n*** Exception: &lt;&lt;loop&gt;&gt;\n</code></pre>\n\n<p>But it doesn't work. Unless I make the following seemingly trivial change:</p>\n\n<pre><code>&gt;&gt;&gt; take 10 $ fst $ fix (\\r -&gt; let (u,v)=r in (0:v,1:u))\n[0,1,0,1,0,1,0,1,0,1]\n</code></pre>\n\n<p>What's the critical difference between the last two examples?</p>\n"}, {"tags": ["haskell", "pattern-matching", "wildcard", "strictness"], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1473628219, "post_id": 39438211, "comment_id": 66203703, "body": "I suppose it worth mentioning that if you use <code>take</code> function with <code>undefined</code> as <code>n</code> argument then it is unlikely to catch error in <code>unsafeTake</code> function because <code>n</code> is compared with zero earlier, i.e. it would be evaluated earlier. But because <code>take</code> function is supposed to be inlined as much as possible (as comment says) then this check may disappear after some optimizations. That&#39;s why we need <code>!_</code> in <code>unsafeTake</code> as well."}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": true, "score": 12, "last_activity_date": 1473611293, "last_edit_date": 1473611293, "creation_date": 1473611137, "answer_id": 39438211, "question_id": 39438176, "link": "https://stackoverflow.com/questions/39438176/when-is-it-useful-to-use-strict-wildcard-in-haskell-and-what-does-it-do/39438211#39438211", "title": "When is it useful to use &quot;strict wildcard&quot; in Haskell, and what does it do?", "body": "<p>The idea is that <code>unsafeTake</code> (and <code>take</code> for that matter), when asked to return the first <code>m</code> elements of the empty list, it should return the empty list, no matter what the value of <code>m</code> is. But what if <code>m</code> is an expression that throws an exception? For example, it would be weird for <code>unsafeTake undefined []</code> to return <code>[]</code>. So we need to ensure that <code>m</code> evaluates to integer even if we don't care what is its exact value (for the empty list case of course). This makes <code>unsafeTake</code> behave the same way when it comes to its first argument, not matter whether the second argument (the list) is empty or not.</p>\n"}], "owner": {"reputation": 180, "user_id": 2304815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61RFi.jpg?s=128&g=1", "display_name": "Carlos D", "link": "https://stackoverflow.com/users/2304815/carlos-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 328, "favorite_count": 0, "accepted_answer_id": 39438211, "answer_count": 1, "score": 12, "last_activity_date": 1473611293, "creation_date": 1473610861, "question_id": 39438176, "link": "https://stackoverflow.com/questions/39438176/when-is-it-useful-to-use-strict-wildcard-in-haskell-and-what-does-it-do", "title": "When is it useful to use &quot;strict wildcard&quot; in Haskell, and what does it do?", "body": "<p>I was looking at some Haskell source code and came across a pattern match with <code>!_</code>, the code is here: <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.List.html#unsafeTake\">http://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.List.html#unsafeTake</a></p>\n\n<pre><code>take n xs | 0 &lt; n     = unsafeTake n xs\n          | otherwise = []\n\n-- A version of take that takes the whole list if it's given an argument less\n-- than 1.\n{-# NOINLINE [1] unsafeTake #-}\nunsafeTake :: Int -&gt; [a] -&gt; [a]\nunsafeTake !_  []     = []\nunsafeTake 1   (x: _) = [x]\nunsafeTake m   (x:xs) = x : unsafeTake (m - 1) xs\n</code></pre>\n\n<p>I don't really understand how the \"strict wildcard\" works and why it's useful for this function (or any other function).</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "purely-functional"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1473611912, "post_id": 39438091, "comment_id": 66198994, "body": "Btw - where are you seeing this? Having the context would help in formulating an answer."}, {"owner": {"reputation": 2399, "user_id": 3065657, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XDEr0.jpg?s=128&g=1", "display_name": "lycuid", "link": "https://stackoverflow.com/users/3065657/lycuid"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1473615785, "post_id": 39438091, "comment_id": 66200225, "body": "well, IO functions time to execute and also having interaction with user, like <i>getLine</i> which not always but tend to have side-effect. How can that be pure?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1473647397, "post_id": 39438091, "comment_id": 66207440, "body": "The first step to understanding how I/O is managed is to recognize that <code>getLine</code> is <i>not</i> an I/O function. It is a constant with type <code>IO String</code>, which <i>represents</i> a program that can perform I/O."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 11, "last_activity_date": 1473611982, "creation_date": 1473611982, "answer_id": 39438338, "question_id": 39438091, "link": "https://stackoverflow.com/questions/39438091/how-monads-are-considered-pure/39438338#39438338", "title": "How Monads are considered pure?", "body": "<p>One way that \"monads can be pure\" is that they can represent pure expressions. I.e. in the List monad this:</p>\n\n<pre><code>do x &lt;- xs\n   return (x+1)\n</code></pre>\n\n<p>is the same as <code>map (+1) xs</code>.</p>\n\n<p>Another way you can say \"monads can be pure\" is that Haskell distinguishes between <em>creating</em> a monadic computation and <em>running</em> the computation.</p>\n\n<p>Creating a monadic computation is pure and doesn't involve any side effects. For instance, <code>replicateM 3 foo</code> will perform <code>foo</code> three times\nas in <code>replicateM 3 (putStrLn \"Hello, world\")</code>. Purity allows us to reason\nthat <code>replicateM 3 foo</code> is the same as <code>do { foo; foo; foo }</code>. Note that this is true regardless of what kind of computation <code>foo</code> is - it could be a pure computation or one that involves some sort of effect.</p>\n\n<p>Side effects only happen when you <em>run</em> the monadic computation. In the case of the IO monad this happens at run-time time when <code>main</code> is executed.\nOther monads have their own \"run\" functions, i.e. <code>runReader</code> for the Reader monad, <code>runState</code> for the State monad, etc.</p>\n"}, {"comments": [{"owner": {"reputation": 146, "user_id": 1550375, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6ea6ef70d794d7206278a4d3c75194f9?s=128&d=identicon&r=PG", "display_name": "Bassam", "link": "https://stackoverflow.com/users/1550375/bassam"}, "edited": false, "score": 1, "creation_date": 1484758931, "post_id": 39438339, "comment_id": 70645159, "body": "Simply, it&#39;s pure because (1) it will give the same output for the same input and (2) and when evaluated it does not have side-effects on other computations"}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": true, "score": 21, "last_activity_date": 1473612523, "last_edit_date": 1473612523, "creation_date": 1473611982, "answer_id": 39438339, "question_id": 39438091, "link": "https://stackoverflow.com/questions/39438091/how-monads-are-considered-pure/39438339#39438339", "title": "How Monads are considered pure?", "body": "<p>One way to think of this is that a value of type <code>IO a</code> is a \"recipe\", containing a list of instructions that if performed would have side effects. Constructing that \"recipe\" though, does not have any side effects. So a haskell program (whose type is <code>IO ()</code>) is basically a computation that constructs such a recipe. Importantly, the program does not execute any of the instructions in the recipe. When the recipe is completed the program terminates. Then the compiler (or interpreter) takes that recipe and executes it. But the code that the programmer wrote is not running anymore, so the instructions in the recipe are executed <em>outside the scope of the program</em>.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1509799471, "post_id": 39453804, "comment_id": 81171691, "body": "<i>&quot;Monad&quot; refers to a particular pattern of composition that can be implemented on types with certain higher-kinded type constructors.</i> That is all there is to it! Explained in a single sentence. Thank you!"}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 10, "last_activity_date": 1473693888, "creation_date": 1473693888, "answer_id": 39453804, "question_id": 39438091, "link": "https://stackoverflow.com/questions/39438091/how-monads-are-considered-pure/39453804#39453804", "title": "How Monads are considered pure?", "body": "<p>Monads are not considered pure or impure.  They're totally unrelated concepts.  Your title is kind of like asking how verbs are considered delicious.</p>\n\n<p>\"Monad\" refers to a particular pattern of composition that can be implemented on types with certain higher-kinded type constructors.  The entirety of the concept is tied up in the types of a couple operations and the rules for how those operations must interact with themselves and each other.</p>\n\n<p>Few languages can express the concept usefully, since it's so abstract.  The only relatively common language other than Haskell that can is Scala. And it's actually relatively common in Scala too, though they call it <code>flatMap</code> for some reason.  Unsurprisingly, some types that support <code>flatMap</code> in Scala aren't pure.  They support <code>flatMap</code> 100% correctly, and they aren't pure.</p>\n\n<p>The concepts are just not correlated.</p>\n\n<p>Now, all that said, I understand where you're coming from.  Nearly every article on Haskell you see uses phrases like \"the IO monad\" or \"uses monads to control effects\" or other similar things.  The thing is, every use of terminology like that is deeply misleading.</p>\n\n<p><code>IO</code> is a type.  That's what's different from impure languages. IO operations are <em>values</em> of a particular type.  That's what allows Haskell to stay principled (in some ways) about purity, even while interacting with the outside world. Values of a particular type are built to describe interactions with the outside world.  Those values are pure, as described in the other answers.</p>\n\n<p>So where does Monad fit into the whole thing?  Well, <code>IO</code> values need to be combined together to build up more complex IO actions from simpler ones. And it turns out that they way they combine together is exactly the kind of composition the <code>Monad</code> interface describes.  But so is combining lists with <code>flatMap</code>, or <code>Option</code> values with <code>andThen</code>.</p>\n\n<p>The emphasis on <code>Monad</code> as something important, special, or interesting harms both the reputation of Haskell and its approachability for beginners. Especially since it's not important, special or interesting. The best comparison I can make is <code>Iterator</code> in Java. Yes, the language has some syntactic sugar for working with <code>Monad</code>/<code>Iterator</code>. No that doesn't come near implying that the language is unapproachable if you don't know the concept beforehand or that there's deep meaning involved that is necessary for entry into some super-secret society of enlightenment. When it comes down to it, neither idea is very deep or amazing. They're just very widely applicable, simple ideas that are easier to work with when you have a bit of syntactic sugar on hand.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1474573489, "post_id": 39647091, "comment_id": 66598599, "body": "I would probably phrase it a bit differently, because my mental notion of a recipe can be monadic: &quot;Add salt to taste.&quot;"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1474578689, "post_id": 39647091, "comment_id": 66601265, "body": "@dfeuer I didn&#39;t quite get your point. My point is that adding salt is not monadic. If <code>f</code> is &quot;adding&quot; and <code>a</code> is &quot;salt&quot;, then <code>f a</code> is &quot;adding salt&quot; already, before we talk of Monads or Functors even."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1474578970, "post_id": 39647091, "comment_id": 66601375, "body": "You missed the key &quot;to taste&quot;. You taste the dish to decide if it needs more salt. Then you add salt iteratively, until it no longer needs more salt."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1474579320, "post_id": 39647091, "comment_id": 66601504, "body": "@dfeuer ah, yes, this process <i>is</i> essentially-monadic. But you could also just add pre-measured amount, according to your cook-book recipe. :) There&#39;s the usual mix-up here; that&#39;s why I prefer &quot;computation description&quot; (for <code>f a</code> things), and &quot;c.d. constructors&quot; (for functions <code>a -&gt; f b</code>). Your &quot;recipe&quot; refers to the latter; redneb&#39;s &quot;recipe&quot; to the former."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 5, "last_activity_date": 1607732291, "last_edit_date": 1607732291, "creation_date": 1474571327, "answer_id": 39647091, "question_id": 39438091, "link": "https://stackoverflow.com/questions/39438091/how-monads-are-considered-pure/39647091#39647091", "title": "How Monads are considered pure?", "body": "<p><a href=\"https://stackoverflow.com/users/6776093/redneb\">redbneb</a>'s <a href=\"https://stackoverflow.com/questions/39438091/how-monads-are-considered-pure/39438339#39438339\">answer</a> is almost right, except that for <em>Monads</em> the two timelines are <em>intermingled</em>, which is <em>their</em> essence;</p>\n<p>a Haskell computation <em>does</em> take place after the outside world has supplied some inputs, say, in a previous computation step; to construct the <em>next</em> recipe \u2044 &quot;computation descriptions&quot;, which is then <em>run</em> in its turn. Otherwise it would not be a Monad, but an <em>Applicative</em>, which constructs its recipes \u2044 descriptions from components known ahead of time.</p>\n<p>And lowly <em>Functor</em> itself already has the two timelines (which is <em>its</em> essence): <code>IO a</code> value describes an &quot;outside world's&quot;  IO-computation &quot;producing&quot; an &quot;inside&quot; \u2044 pure  <code>a</code> result.</p>\n<p>Consider:</p>\n<pre><code>[f x | x &lt;- xs]             f &lt;$&gt; xs    Functor       [r |      x&lt;-xs,r&lt;-[f x]]\n[y x | y &lt;- f,  x &lt;- xs]    f &lt;*&gt; xs    Applicative   [r | y&lt;-f,x&lt;-xs,r&lt;-[y x]]\n[r   | x &lt;- xs, r &lt;- f x]   f =&lt;&lt; xs    Monad         [r |      x&lt;-xs,r&lt;- f x ]\n</code></pre>\n<p>(written with monad comprehensions). Of course a Functor (Applicative / Monad / ...) can be pure as well; still there are two timelines \u2044 &quot;worlds&quot; there.</p>\n<p>Few concrete examples:</p>\n<pre><code>~&gt; [x*2 | x&lt;-[10,100]]            \n~&gt; [r   | x&lt;-[10,100], r &lt;- [x*2]]           -- non-monadic\n[20,200]                                     -- (*2) &lt;$&gt; [10,100] \n\n~&gt; [x*y | x&lt;-[10,100], y &lt;- [2,3]]          \n~&gt; [r   | x&lt;-[10,100], y &lt;- [2,3], r &lt;- [x*y]]        -- non-monadic\n[20,30,200,300]                                       -- (*) &lt;$&gt; [10,100] &lt;*&gt; [2,3]\n\n~&gt; [r | x&lt;-[10,100], y &lt;- [2,3], r &lt;- replicate 2 (x*y) ]\n~&gt; [r | x&lt;-[10,100], y &lt;- [2,3], r &lt;- [x*y, x*y]]        -- still non-monadic:\n~&gt; (\\a b c-&gt; a*b) &lt;$&gt; [10,100] &lt;*&gt; [2,3] &lt;*&gt; [(),()]     -- it's applicative!\n[20,20,30,30,200,200,300,300]\n\n~&gt; [r | x&lt;-[10,100], y &lt;- [2,3], r &lt;- [x*y, x+y]]                -- and even this\n~&gt; (\\a b c-&gt; c (a*b,a+b)) &lt;$&gt; [10,100] &lt;*&gt; [2,3] &lt;*&gt; [fst,snd]   -- as well\n~&gt; (\\a b c-&gt; c a b)       &lt;$&gt; [10,100] &lt;*&gt; [2,3] &lt;*&gt; [(*),(+)]     \n[20,12,30,13,200,102,300,103]\n\n~&gt; [r | x&lt;-[10,100], y &lt;- [2,3], r &lt;- replicate y (x*y) ]  -- only this is _essentially_\n~&gt; [10,100] &gt;&gt;= \\x-&gt; [2,3] &gt;&gt;= \\y -&gt; replicate y (x*y)     --    monadic !!!!\n[20,20,30,30,30,200,200,300,300,300]                  \n</code></pre>\n<p>Essentially-monadic computations are built of steps which can't be constructed ahead of the combined computation's <em>run-time</em>, because what recipe to construct is determined by the value resulting from a previously <em>computed</em> value -- value, produced by the recipe's computation when it is actually performed.</p>\n<p>The following image might also prove <a href=\"https://stackoverflow.com/questions/34545818/is-monad-bind-operator-closer-to-function-composition-chaining-or-functi/34561605#34561605\">illuminating</a>:</p>\n<p><a href=\"https://i.stack.imgur.com/TBhBu.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/TBhBu.png\" alt=\"pipes image\" /></a></p>\n"}, {"tags": [], "owner": {"reputation": 11283, "user_id": 5825294, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Un5fU.png?s=128&g=1", "display_name": "Enlico", "link": "https://stackoverflow.com/users/5825294/enlico"}, "is_accepted": false, "score": 0, "last_activity_date": 1607733919, "last_edit_date": 1607733919, "creation_date": 1607733516, "answer_id": 65260407, "question_id": 39438091, "link": "https://stackoverflow.com/questions/39438091/how-monads-are-considered-pure/65260407#65260407", "title": "How Monads are considered pure?", "body": "<p>Adding an answer just because what I'm sharing helped me a lot.</p>\n<p>One of (if not the) most notable <code>Monad</code>s is <code>IO</code>, which allows an interaction with the &quot;real world&quot;.</p>\n<p>Is it impure?</p>\n<p>No, it's pure: it takes the &quot;real world&quot; and spits out two outputs,</p>\n<ul>\n<li>one that you're gonna use &quot;intentionally&quot;,</li>\n<li>and the other one, the possibly modified &quot;real world&quot;, which will sit there waiting for the next monadic action to take it in input.</li>\n</ul>\n<p>A more extensive explanation with a very clear example is <a href=\"https://wiki.haskell.org/IO_inside#Welcome_to_the_RealWorld.2C_baby\" rel=\"nofollow noreferrer\">here</a>.</p>\n<p>And <a href=\"https://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html\" rel=\"nofollow noreferrer\">this</a> is another useful (but also funny!) way of picturing functors, applicative functors, and monands in your mind.</p>\n"}], "owner": {"reputation": 2399, "user_id": 3065657, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XDEr0.jpg?s=128&g=1", "display_name": "lycuid", "link": "https://stackoverflow.com/users/3065657/lycuid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1396, "favorite_count": 5, "accepted_answer_id": 39438339, "answer_count": 5, "score": 8, "last_activity_date": 1607804838, "creation_date": 1473610236, "last_edit_date": 1607804838, "question_id": 39438091, "link": "https://stackoverflow.com/questions/39438091/how-monads-are-considered-pure", "title": "How Monads are considered pure?", "body": "<p>I am very much new to Haskell, and really impressed by the language's \"architecture\", but it still bothers me how <strong><em>monads</em></strong> can be pure.</p>\n\n<p>As you have <em>any</em> sequence of instructions, it makes it an impure function, <em>especially</em> functions with I/O wouldn't be pure from any point of view.</p>\n\n<p>Is it because Haskell assumes, like all pure functions, that <code>IO</code> function has a return value too, but in form of opcode or something? I am really confused.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 3021646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86288017f680ca0fb2042c483e65cccb?s=128&d=identicon&r=PG&f=1", "display_name": "2deviate", "link": "https://stackoverflow.com/users/3021646/2deviate"}, "edited": false, "score": 0, "creation_date": 1473615604, "post_id": 39437595, "comment_id": 66200163, "body": "yes thanks - looking for ... nub $ map sum $ sequence [ [1,11], [1,11] ] etc. as its not monadic ..."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1473608718, "last_edit_date": 1473608718, "creation_date": 1473607091, "answer_id": 39437595, "question_id": 39437279, "link": "https://stackoverflow.com/questions/39437279/control-applicative-lifting-on-n-lists/39437595#39437595", "title": "Control.Applicative lifting on n-lists", "body": "<p>If you are using <em>n</em> copies of the same list <code>[1,11]</code> you can use <code>replicateM</code>:</p>\n\n<pre><code>import Control.Monad\n\nghci&gt; replicateM 3 [1,11]\n[[1,1,1],[1,1,11],[1,11,1],[1,11,11],[11,1,1],[11,1,11],[11,11,1],[11,11,11]]\n\nghci&gt; map sum (replicateM 3 [1,11])\n[3,13,13,23,13,23,23,33]\n</code></pre>\n\n<p>In general, you can use <code>sequence</code> to perform a multi-list cartesian product:</p>\n\n<pre><code>ghci&gt; sequence [ [1,11], [2,22], [3,33] ]\n[[1,2,3],[1,2,33],[1,22,3],[1,22,33],[11,2,3],[11,2,33],[11,22,3],[11,22,33]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 597, "user_id": 2157021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5f361d3bd72832787dc2b79ce78de71?s=128&d=identicon&r=PG", "display_name": "amar47shah", "link": "https://stackoverflow.com/users/2157021/amar47shah"}, "is_accepted": false, "score": 0, "last_activity_date": 1473610106, "last_edit_date": 1473610106, "creation_date": 1473607468, "answer_id": 39437645, "question_id": 39437279, "link": "https://stackoverflow.com/questions/39437279/control-applicative-lifting-on-n-lists/39437645#39437645", "title": "Control.Applicative lifting on n-lists", "body": "<p>If you want the flexibility of handling inputs <em>that aren't just lists of <code>[1,11]</code></em>:</p>\n\n<pre><code>\u03bb&gt; import Control.Applicative (liftA2)\n\u03bb&gt; let sumsOfCombinations xs = (:[]) . sum &lt;$&gt; foldr (liftA2 (:)) [[]] xs\n</code></pre>\n\n<p>You can pass it any list of list of numbers:</p>\n\n<pre><code>\u03bb&gt;  sumsOfCombinations' [[0,100],[-1,0,1],[0,1000]]\n[-1,999,0,1000,1,1001,99,1099,100,1100,101,1101]\n</code></pre>\n\n<p>Including, <em>but not limited to</em>, your example:</p>\n\n<pre><code>\u03bb&gt; sumsOfCombinations $ replicate 3 [1,11]\n[[3],[13],[13],[23],[13],[23],[23],[33]]\n\n\u03bb&gt; sumsOfCombinations $ replicate 4 [1,11]\n[[4],[14],[14],[24],[14],[24],[24],[34],[14],[24],[24],[34],[24],[34],[34],[44]]\n</code></pre>\n\n<p>Here is its type:</p>\n\n<pre><code>\u03bb&gt; :t sumsOfCombinations\nsumsOfCombinations :: (Num b, Foldable t) =&gt; t [b] -&gt; [[b]]\n</code></pre>\n\n<p>As written, <code>sumsOfCombinations</code> gives you the exact output you are looking for. However, I don't think it is necessary to return a list of lists, so I would choose:</p>\n\n<pre><code>\u03bb&gt; let sumsOfCombinations' xs = sum &lt;$&gt; foldr (liftA2 (:)) [[]] xs\n\n\u03bb&gt; :t sumsOfCombinations'\nsumsOfCombinations' :: (Num b, Foldable t) =&gt; t [b] -&gt; [b]\n\n\u03bb&gt; sumsOfCombinations' $ replicate 3 [1,11]\n[3,13,13,23,13,23,23,33]\n</code></pre>\n\n<p>Note that you can extract a helper from each of these to give you the combinations of elements from the lists:</p>\n\n<pre><code>\u03bb&gt; let combinations = foldr (liftA2 (:)) [[]]\n\u03bb&gt; combinations [[1,2],[3,4],[5,6]]\n[[1,3,5],[1,3,6],[1,4,5],[1,4,6],[2,3,5],[2,3,6],[2,4,5],[2,4,6]]\n</code></pre>\n\n<p>So then you have:</p>\n\n<pre><code>sumsOfCombinations xs = (:[]) . sum &lt;$&gt; combinations xs\n</code></pre>\n\n<p>or, if you don't need to return a list of lists:</p>\n\n<pre><code>sumsOfCombinations' xs = sum &lt;$&gt; combinations xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 0, "last_activity_date": 1473608144, "creation_date": 1473608144, "answer_id": 39437762, "question_id": 39437279, "link": "https://stackoverflow.com/questions/39437279/control-applicative-lifting-on-n-lists/39437762#39437762", "title": "Control.Applicative lifting on n-lists", "body": "<p>More generally, what you want is the Cartesian product of all the lists in a given list. Once you have that, then you can combine them in any way you like.</p>\n\n<pre><code>cartesian :: [[a]] -&gt; [[a]]\ncartesian [] = [[]]\ncartesian (xs:xss) = [x : ys | x &lt;- xs, ys &lt;- cartesian xss]\n\nmkSums :: [[Int]] -&gt; [[Int]]\nmkSums = map ((\\x -&gt; [x]) . sum) . cartesian\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 3021646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86288017f680ca0fb2042c483e65cccb?s=128&d=identicon&r=PG&f=1", "display_name": "2deviate", "link": "https://stackoverflow.com/users/3021646/2deviate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 39437595, "answer_count": 3, "score": 0, "last_activity_date": 1473610106, "creation_date": 1473605240, "question_id": 39437279, "link": "https://stackoverflow.com/questions/39437279/control-applicative-lifting-on-n-lists", "title": "Control.Applicative lifting on n-lists", "body": "<p>I am quite new to Haskell and would like to know how to achieve the following output without using a fixed comprehension list (or indeed an applicative functor like liftA) i.e.</p>\n\n<pre><code>&gt; [ [x+y+z] | x &lt;- [1,11], y &lt;- [1,11], z &lt;- [1,11]]\n&gt; [[3],[13],[13],[23],[13],[23],[23],[33]]\n</code></pre>\n\n<p>The above code example only processes 3 lists e.g. xyz.  How can I achieve the same thing using n lists e.g. e.g. [[1,11]] or [[1,11],[1,11],[1,11],[1,11],[1,11]] ?</p>\n\n<p>PS - I looked at using a control Applicative functor liftA but its limited to liftA3 e.g. </p>\n\n<pre><code> \u03bb&gt; :m + Control.Applicative\n \u03bb&gt; let combine = liftA2 (,)\n \u03bb&gt; combine \"ab\" \"cd\"\n [('a','c'),('a','d'),('b','c'),('b','d')]\n</code></pre>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "is_accepted": true, "score": 2, "last_activity_date": 1473609630, "creation_date": 1473609630, "answer_id": 39437990, "question_id": 39437022, "link": "https://stackoverflow.com/questions/39437022/console-gui-haskell-on-windows/39437990#39437990", "title": "Console GUI Haskell on Windows", "body": "<p><a href=\"http://hackage.haskell.org/package/ansi-terminal\" rel=\"nofollow\"><code>ansi-terminal</code></a> could do it for you. It works on both.</p>\n"}], "owner": {"reputation": 234, "user_id": 6475907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-xQd4dCvGOmg/AAAAAAAAAAI/AAAAAAAAABo/WuJS4WB_RNg/photo.jpg?sz=128", "display_name": "WellTyped", "link": "https://stackoverflow.com/users/6475907/welltyped"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 290, "favorite_count": 0, "accepted_answer_id": 39437990, "answer_count": 1, "score": 0, "last_activity_date": 1473609630, "creation_date": 1473603638, "question_id": 39437022, "link": "https://stackoverflow.com/questions/39437022/console-gui-haskell-on-windows", "title": "Console GUI Haskell on Windows", "body": "<p>I'm parsing some RSS feed and I want to present to the user in a nicely formatted way(with features such as using the arrow key to scroll and select the feed items) and I can use the brick library on Linux but I can't install this library on Windows.\nAny alternatives on Windows?</p>\n"}, {"tags": ["haskell", "package", "cabal-install", "hlint"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1473599275, "post_id": 39434709, "comment_id": 66195222, "body": "If you want any real hope of such an issue being solved you must include much, much more detail (at the very least the output of the failing command with <code>-v3</code>). A quick google search shows this is likely related to a broken installation of gcc (or ghc is using a different c compiler than it should be)"}, {"owner": {"reputation": 32100, "user_id": 1033581, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/e8891617e36b8d1254eb3ce1a5662da4?s=128&d=identicon&r=PG", "display_name": "C\u0153ur", "link": "https://stackoverflow.com/users/1033581/c%c5%93ur"}, "edited": false, "score": 0, "creation_date": 1546403700, "post_id": 39434709, "comment_id": 94839303, "body": "I moved your solution to a community wiki answer."}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 3, "last_activity_date": 1473600039, "last_edit_date": 1473600039, "creation_date": 1473597576, "answer_id": 39436198, "question_id": 39434709, "link": "https://stackoverflow.com/questions/39434709/when-i-try-to-install-hlint-i-get-errors-surrounding-old-time-1-1-0-3/39436198#39436198", "title": "When I try to install hlint I get errors surrounding old-time-1.1.0.3", "body": "<p>There are lots of variables that could be at play to explain what's going on, including <code>cabal-install</code> and <code>ghc</code> versions. It would be useful if you included the <code>cabal --version</code> and <code>ghc --version</code> output in your question.</p>\n\n<p>That said: I'd recommend trying out the installation using <a href=\"https://haskell-lang.org/get-started\" rel=\"nofollow\">Stack</a>. Once you have Stack installed (on POSIX systems, usually sufficient to run <code>curl -sSL https://get.haskellstack.org/ | sh</code>), you can install with <code>stack --resolver lts-6.16 --install-ghc --no-system-ghc install hlint</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": false, "score": 0, "last_activity_date": 1473667124, "creation_date": 1473667124, "answer_id": 39445731, "question_id": 39434709, "link": "https://stackoverflow.com/questions/39434709/when-i-try-to-install-hlint-i-get-errors-surrounding-old-time-1-1-0-3/39445731#39445731", "title": "When I try to install hlint I get errors surrounding old-time-1.1.0.3", "body": "<p>Are you on Windows or Linux? What does <code>ghc --version</code> say? What about <code>ghc-pkg old-time</code>? I recommend trying to run <code>cabal install old-time</code> directly, which should reproduce the error directly.</p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 6871041, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ef4e5b2061a5eb71752c903c9f17516?s=128&d=identicon&r=PG", "display_name": "Yesat", "link": "https://stackoverflow.com/users/6871041/yesat"}, "is_accepted": false, "score": 4, "last_activity_date": 1474641953, "creation_date": 1474641953, "answer_id": 39663634, "question_id": 39434709, "link": "https://stackoverflow.com/questions/39434709/when-i-try-to-install-hlint-i-get-errors-surrounding-old-time-1-1-0-3/39663634#39663634", "title": "When I try to install hlint I get errors surrounding old-time-1.1.0.3", "body": "<p>The best way to know where it fails is to go through each failed package and install them one after the other.</p>\n\n<p>I had issue with <code>haskell-src-exts</code> in which showed up in <code>hlint</code> and when I tried to <code>cabal install haskell-src-exts</code> it was <code>happy</code>that wasn't properly installed.</p>\n"}, {"tags": [], "owner": {"reputation": 32100, "user_id": 1033581, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/e8891617e36b8d1254eb3ce1a5662da4?s=128&d=identicon&r=PG", "display_name": "C\u0153ur", "link": "https://stackoverflow.com/users/1033581/c%c5%93ur"}, "is_accepted": false, "score": 0, "last_activity_date": 1546403646, "creation_date": 1546403646, "answer_id": 54001232, "question_id": 39434709, "link": "https://stackoverflow.com/questions/39434709/when-i-try-to-install-hlint-i-get-errors-surrounding-old-time-1-1-0-3/54001232#54001232", "title": "When I try to install hlint I get errors surrounding old-time-1.1.0.3", "body": "<p><em>Solution by OP.</em></p>\n\n<p>Modify your cabal config file (you can verify the location by running \"cabal user-config init\") to contain the following lines:</p>\n\n<pre><code>extra-prog-path: C:\\Program Files\\Haskell Platform\\8.0.1\\msys\\usr\\bin\nextra-lib-dirs: C:\\Program Files\\Haskell Platform\\8.0.1\\mingw\\lib\nextra-include-dirs: C:\\Program Files\\Haskell Platform\\8.0.1\\mingw\\include\n</code></pre>\n"}], "owner": {"reputation": 1385, "user_id": 4464551, "user_type": "registered", "accept_rate": 52, "profile_image": "https://graph.facebook.com/10206253300199979/picture?type=large", "display_name": "Felix Ros&#233;n", "link": "https://stackoverflow.com/users/4464551/felix-ros%c3%a9n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1874, "favorite_count": 2, "answer_count": 4, "score": 7, "last_activity_date": 1546403676, "creation_date": 1473586288, "last_edit_date": 1546403676, "question_id": 39434709, "link": "https://stackoverflow.com/questions/39434709/when-i-try-to-install-hlint-i-get-errors-surrounding-old-time-1-1-0-3", "title": "When I try to install hlint I get errors surrounding old-time-1.1.0.3", "body": "<p>I first tried to install Hlint. <code>cabal install hlint</code> but then I got the error:</p>\n\n<pre><code>cabal: Error: some packages failed to install:\ncpphs-1.20.2 depends on old-time-1.1.0.3 which failed to install.\nhaskell-src-exts-1.18.2 depends on old-time-1.1.0.3 which failed to install.\nhlint-1.9.37 depends on old-time-1.1.0.3 which failed to install.\nold-time-1.1.0.3 failed during the configure step. The exception was:\nExitFailure 77\n</code></pre>\n\n<p>Then I tried to install ghc-mod since I read that hlint is a dependency of that package(?). Thinking that it might resolve the problem. So i did <code>cabal install ghc-mod</code> which gave me the error.</p>\n\n<pre><code>cabal: Error: some packages failed to install:\ncpphs-1.20.2 depends on old-time-1.1.0.3 which failed to install.\nghc-mod-5.6.0.0 depends on old-time-1.1.0.3 which failed to install.\nhaskell-src-exts-1.17.1 depends on old-time-1.1.0.3 which failed to install.\nhlint-1.9.35 depends on old-time-1.1.0.3 which failed to install.\nold-time-1.1.0.3 failed during the configure step. The exception was:\nExitFailure 77\n</code></pre>\n\n<p>So it seems to be the same problem, around my the package <code>old-time-1.1.0.3</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473598883, "post_id": 39432649, "comment_id": 66195126, "body": "You do know you are just implementing <code>words</code>, right?"}, {"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473602077, "post_id": 39432649, "comment_id": 66196001, "body": "@chepner: no... I didn&#39;t know that. I&#39;m a total beginner to Haskell. I just want to know how it works."}, {"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473602418, "post_id": 39432649, "comment_id": 66196095, "body": "Why the downvote? Everyone always explains the <code>$</code> operator as the same thing as parenthesizing, but it clearly isn&#39;t in this case. And I felt it was important to understand why."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1473602820, "post_id": 39432649, "comment_id": 66196195, "body": "<code>$</code> reduces the <i>need</i> for parenthesizing; anyone who actually says they are the <i>same</i> is being misleading at best. <code>f 3 + 5</code> is the same as <code>(f 3) + 5</code> because function application has a higher precedence than <code>+</code>. <code>f $ 3 + 5</code> is the same as <code>f (3 + 5)</code> because <code>$</code> has a <i>lower</i> precedence than <code>+</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473603497, "post_id": 39432649, "comment_id": 66196375, "body": "The downvoter (not me) presumably felt you could have looked up the definition of <code>($)</code>  yourself."}, {"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473603512, "post_id": 39432649, "comment_id": 66196378, "body": "@chepner: thank you for that. the book I&#39;m reading literally states &quot;If you like, a way to understand ($) in words is: \u201cevaluate everything to the right of me first.&quot;&quot;. I now understand that this isn&#39;t a complete picture. And I did look the definition up, but the fact that parenthesizing essentially loses the infix operator <code>$</code> and leaves an implicit function application was key. I didn&#39;t notice that immediately."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473603939, "post_id": 39432649, "comment_id": 66196498, "body": "For what it&#39;s worth, I haven&#39;t been terribly impressed with that book. It&#39;s far too verbose. (In its defense, I read it long after I picked up most of the basics, so I definitely wasn&#39;t the target audience.)"}, {"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473604427, "post_id": 39432649, "comment_id": 66196651, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/123107/discussion-between-gogurt-and-chepner\">continue this discussion in chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 0, "creation_date": 1473567360, "post_id": 39432700, "comment_id": 66188618, "body": "But why is that? If I add parentheses like I suggested in my question, then shouldn&#39;t Haskell still try to group <code>splitString</code> to the block on the left? I still don&#39;t understand why one works and the other doesn&#39;t."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 0, "creation_date": 1473568600, "post_id": 39432700, "comment_id": 66188790, "body": "@gogurt The <code>(:)</code> operator has precedence 5, but <code>($)</code> has precedence 0, so <code>(:)</code> binds tighter than <code>($)</code>."}, {"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 0, "creation_date": 1473569292, "post_id": 39432700, "comment_id": 66188885, "body": "Right. But I was asking about the version written <code>takeWhile (&#47;=&#39; &#39;) str : splitString (drop 1 $ dropWhile (&#47;=&#39; &#39;) str)</code>. This works for some reason, even though I didn&#39;t explicitly group <code>splitString</code> to the right side of <code>:</code> as in ErikR&#39;s answer."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1473572081, "post_id": 39432700, "comment_id": 66189282, "body": "Answer updated. Indeed, a good approach to debugging problems like this with <code>$</code> is to replace <code>$</code> with explicit parens."}, {"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 0, "creation_date": 1473602213, "post_id": 39432700, "comment_id": 66196033, "body": "@ErikR: ah, I see. and Haskell interprets the statement like that because function application has higher precedence than any other operator. That gets to the heart of it. Thank you."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 8, "last_activity_date": 1473571850, "last_edit_date": 1473571850, "creation_date": 1473566185, "answer_id": 39432700, "question_id": 39432649, "link": "https://stackoverflow.com/questions/39432649/haskell-operator-why-doesnt-this-work/39432700#39432700", "title": "Haskell $ operator: why doesn&#39;t this work?", "body": "<p>Your code will work if you add parens as indicated below:</p>\n\n<pre><code>...\n  | otherwise = takeWhile (/=' ') str : ( splitString $ drop 1 $ dropWhile (/=' ') str )\n--                                     ^^^                                            ^^^                                                                                        \n</code></pre>\n\n<p>Otherwise Haskell is interpreting the otherwise clause as:</p>\n\n<pre><code>( takeWhile (/=' ') str : splitString )\n    $ drop 1\n    $ dropWhile (/= ' ') str\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>The version you mention in the comments:</p>\n\n<pre><code>     takeWhile (/= ' ') str : splitString ( ... )\n--   \\__ a __/ \\_ b _/   c  : \\___ d ___/ \\_ e _/\n</code></pre>\n\n<p>has the form <code>a b c : d e</code> which Haskell always interprets as <code>(a b c) : (d e)</code> since <code>:</code> is the only infix operator appearing the expression.</p>\n\n<p>When you have something like:</p>\n\n<pre><code>    a b c : d e $ f $ g\n</code></pre>\n\n<p>you have to take into consideration the relative precedence of the <code>:</code> and <code>$</code> infix operators. Since <code>$</code> is <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Function.html#v:-36-\">defined as <code>infixr 0</code></a>, it doesn't\nbind as tight as <code>:</code> and you get the following right-associative grouping:</p>\n\n<pre><code>    (a b c : d e) $ (f $ g)\n</code></pre>\n"}], "owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 39432700, "answer_count": 1, "score": 0, "last_activity_date": 1473602343, "creation_date": 1473565541, "last_edit_date": 1473602343, "question_id": 39432649, "link": "https://stackoverflow.com/questions/39432649/haskell-operator-why-doesnt-this-work", "title": "Haskell $ operator: why doesn&#39;t this work?", "body": "<p>In the <em>Haskell Programming from First Principles</em> book there is an exercise which tells us to write a function which takes a string with spaces inside, splits it by the spaces, and loads the non-space chunks into a list of strings. My first try was:</p>\n\n<pre><code>splitString :: String -&gt; [String]\nsplitString str\n  | str == \"\" = []\n  | otherwise = takeWhile (/=' ') str : splitString $ drop 1 $ dropWhile (/=' ') str\n</code></pre>\n\n<p>Now this doesn't compile. If I replace the first ($) (right after <code>splitString</code>) with the corresponding pair of parentheses instead like so:</p>\n\n<pre><code>takeWhile (/=' ') str : splitString (drop 1 $ dropWhile (/=' ') str)\n</code></pre>\n\n<p>then it works. Based on what I've learned so far about ($) though, shouldn't the two be equivalent? ($) is right associative, so it looks to me like what ought to be happening is</p>\n\n<ol>\n<li><code>dropWhile (/=' ') str</code> is evaluated first</li>\n<li><code>drop 1 (dropWhile (/=' ') str)</code> is next</li>\n<li>then the result is passed onto <code>splitString</code>.</li>\n</ol>\n\n<p>Instead, I get an error from <code>ghc</code> which says </p>\n\n<pre><code>Couldn't match expected type \u2018[Char] -&gt; [String]\u2019\n            with actual type \u2018[[Char]]\u2019\nThe first argument of ($) takes one argument,\nbut its type \u2018[[Char]]\u2019 has none\n</code></pre>\n\n<p>I can see that by \"first argument of ($)\" it's talking about <code>splitString</code>, but I'm puzzled by what the statement</p>\n\n<pre><code>but its type `[[Char]]` has none\n</code></pre>\n\n<p>is supposed to mean.</p>\n"}, {"tags": ["haskell", "import"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1473552239, "post_id": 39431537, "comment_id": 66186505, "body": "Ah, yeah. I quite wish Henning stopped insisting on this naming convention. As someone jokingly said: <i>he likes to name all his data types after himself</i> (<b>T</b>hielemann)... Which is not to say I don&#39;t respect and trust his choices: in a way it does make sense to use modules as the primary naming hierarchy. But since nobody else does this anyway, you can hardly hope to ever get this really consistent. And in some cases it just really doesn&#39;t work well, like the one you have here. Not to speak of documentation readability. Upshot: <i>don&#39;t</i> call your types <code>T</code>."}, {"owner": {"reputation": 675, "user_id": 166765, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6593e0e838ac7520884ef575a45be58f?s=128&d=identicon&r=PG", "display_name": "Exp HP", "link": "https://stackoverflow.com/users/166765/exp-hp"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1473553997, "post_id": 39431537, "comment_id": 66186782, "body": "It&#39;s certainly not a good sign when the first thing I have to click on every Haddock page is <a href=\"http://hackage.haskell.org/package/numeric-prelude-0.4.2/docs/src/Number-Ratio.html\" rel=\"nofollow noreferrer\">the source link</a>"}, {"owner": {"reputation": 675, "user_id": 166765, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6593e0e838ac7520884ef575a45be58f?s=128&d=identicon&r=PG", "display_name": "Exp HP", "link": "https://stackoverflow.com/users/166765/exp-hp"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1473554531, "post_id": 39431537, "comment_id": 66186875, "body": "@leftaroundabout I do somewhat feel for his cause though, as it is certainly possible to pull this off nicely in a language with a <a href=\"http://doc.rust-lang.org/std/error/trait.Error.html\" rel=\"nofollow noreferrer\">better</a> <a href=\"https://doc.rust-lang.org/std/fmt/struct.Error.html\" rel=\"nofollow noreferrer\">module</a> <a href=\"https://doc.rust-lang.org/std/io/struct.Error.html\" rel=\"nofollow noreferrer\">system</a>.  But such is not Haskell."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1473602364, "post_id": 39431537, "comment_id": 66196082, "body": "<a href=\"http://stackoverflow.com/a/35617742/237428\">I answered a related Stack Overflow question</a> about <i>exports</i> a little while back."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1473551592, "post_id": 39431538, "comment_id": 66186408, "body": "You could also define a local synonym <code>(%) = (Ratio.:%)</code>"}, {"owner": {"reputation": 675, "user_id": 166765, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6593e0e838ac7520884ef575a45be58f?s=128&d=identicon&r=PG", "display_name": "Exp HP", "link": "https://stackoverflow.com/users/166765/exp-hp"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1473552468, "post_id": 39431538, "comment_id": 66186539, "body": "@luqui that may work for expressions, but how about the patterns?  I&#39;m not familiar with any way to alias a data constructor"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1473552590, "post_id": 39431538, "comment_id": 66186545, "body": "@ExpHP <code>pattern x :% y = x Ratio.:% y</code>, using the <code>PatternSynonyms</code> extension."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1473552821, "post_id": 39431538, "comment_id": 66186570, "body": "Yeah, a pattern synonym would be possible, but... this really feels wrong. You need to re-declare fixity, it&#39;s questionable if you should give it a type signature (which then would need syncing in case the exported type changes)..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1473563470, "post_id": 39431538, "comment_id": 66188075, "body": "@leftaroundabout I agree that this feels like an oversight on the part of the Committee. There&#39;s no reason for <code>import Number.Ratio ((:%))</code> not to work."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1473590130, "post_id": 39431538, "comment_id": 66192954, "body": "@DanielWagner: why yes, there is a reason: you need some way to distinguish type-level and value-level names in the import list. Of course this problem is most typically encountered with <code>newtypes</code> whose constructor is named the same as the type, but you could also have <code>data (:%) a b = a :% b</code>. Then <code>import Number.Ratio ((:%))</code> would obviously only import <code>(:%) :: * -&gt; * -&gt; *</code>, not <code>(:%) :: a -&gt; b -&gt; a:%b</code>. But I agree that there should be some syntax to import constructors alone. <code>import Number.Ratio (pattern (:%))</code> would be a natural choice."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1473590286, "post_id": 39431538, "comment_id": 66192988, "body": "@DanielWagner wait, <i>this works</i> actually! See my answer."}], "tags": [], "owner": {"reputation": 675, "user_id": 166765, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6593e0e838ac7520884ef575a45be58f?s=128&d=identicon&r=PG", "display_name": "Exp HP", "link": "https://stackoverflow.com/users/166765/exp-hp"}, "is_accepted": false, "score": 2, "last_activity_date": 1473550658, "creation_date": 1473550658, "answer_id": 39431538, "question_id": 39431537, "link": "https://stackoverflow.com/questions/39431537/import-a-data-constructor-without-importing-the-type/39431538#39431538", "title": "Import a data constructor without importing the type", "body": "<p>My current solution, discovered moments before posting:</p>\n\n<ul>\n<li>Give up on trying to import <code>(:%)</code>.</li>\n<li>Keep the qualified import.</li>\n<li>Change <code>:%</code> to <code>Ratio.:%</code> everywhere (patterns and expressions).</li>\n</ul>\n\n<p>Result:</p>\n\n<pre><code>{-# LANGUAGE NoImplicitPrelude #-}\nmodule Number.SqrtRatio (T(..), ratioPart) where\n\nimport qualified Number.Ratio as Ratio\n\nimport qualified Algebra.Ring as Ring\nimport NumericPrelude.Base\n\n-- | A number whose square is rational, canonicalized as a rational\n--   times the square root of a squarefree integer.\ndata T x = T {\n    numerator :: !x,\n    denominator :: !x,\n    rootNum :: !x\n    } deriving (Eq, Show)\n\nratioPart :: T x -&gt; Ratio.T x\nratioPart (T n d _) = n Ratio.:% d\n\nfromRatio :: (Ring.C x) =&gt; Ratio.T x -&gt; T x\nfromRatio (n Ratio.:% d) = T n d Ring.one\n</code></pre>\n\n<p>Ugly.</p>\n"}, {"comments": [{"owner": {"reputation": 675, "user_id": 166765, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6593e0e838ac7520884ef575a45be58f?s=128&d=identicon&r=PG", "display_name": "Exp HP", "link": "https://stackoverflow.com/users/166765/exp-hp"}, "edited": false, "score": 0, "creation_date": 1473605463, "post_id": 39435202, "comment_id": 66196957, "body": "Impressive find!  All documentation I can find on this feature only explicitly covers the case where the constructor in question is declared using <code>pattern</code> in its originating module (which <code>(:%)</code> is not); but it makes sense that this would work for the sake of allowing an exported constructor to be replaced with a synonym transparently."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 9, "last_activity_date": 1473590348, "creation_date": 1473590348, "answer_id": 39435202, "question_id": 39431537, "link": "https://stackoverflow.com/questions/39431537/import-a-data-constructor-without-importing-the-type/39435202#39435202", "title": "Import a data constructor without importing the type", "body": "<p>Turns out there <em>is</em> a proper way to do this:</p>\n\n<pre><code>{-# LANGUAGE NoImplicitPrelude, PatternSynonyms #-}\nmodule Number.SqrtRatio (T(..), ratioPart) where\n\nimport qualified Number.Ratio as Ratio\nimport Number.Ratio (pattern (:%))\n</code></pre>\n\n<p>Note that I've used the <code>-XPatternSynonyms</code> extension not to actually define any pattern synonym, just to enable the <code>pattern</code> keyword so it's clear I want to import the <em>value constructor</em> <code>:%</code> alone.</p>\n"}], "owner": {"reputation": 675, "user_id": 166765, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6593e0e838ac7520884ef575a45be58f?s=128&d=identicon&r=PG", "display_name": "Exp HP", "link": "https://stackoverflow.com/users/166765/exp-hp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1055, "favorite_count": 0, "accepted_answer_id": 39435202, "answer_count": 2, "score": 8, "last_activity_date": 1473590348, "creation_date": 1473550658, "question_id": 39431537, "link": "https://stackoverflow.com/questions/39431537/import-a-data-constructor-without-importing-the-type", "title": "Import a data constructor without importing the type", "body": "<p><code>numeric-prelude</code> does this thing where every data type is named <code>T</code> and every type-class is named <code>C</code>.  For the sake of... consistency, I suppose I'll play along:</p>\n\n<pre><code>{-# LANGUAGE NoImplicitPrelude #-}\nmodule Number.SqrtRatio (T(..), ratioPart) where\n\nimport qualified Number.Ratio as Ratio\nimport Number.Ratio ((:%))\n\nimport qualified Algebra.Ring as Ring\nimport NumericPrelude.Base\n\n-- | A number whose square is rational, canonicalized as a rational\n--   times the square root of a squarefree integer.\ndata T x = T {\n    numerator :: !x,\n    denominator :: !x,\n    rootNum :: !x\n    } deriving (Eq, Show)\n\nratioPart :: T x -&gt; Ratio.T x\nratioPart (T n d _) = n :% d\n\nfromRatio :: (Ring.C x) =&gt; Ratio.T x -&gt; T x\nfromRatio (n :% d) = T n d Ring.one\n</code></pre>\n\n<p><code>ghc</code> is not impressed:</p>\n\n<pre><code>Number/SqrtRatio.hs:5:22:\n    In module \u2018Number.Ratio\u2019:\n      \u2018(:%)\u2019 is a data constructor of \u2018T\u2019\n    To import it use\n      \u2018import\u2019 Number.Ratio( T( (:%) ) )\n    or\n      \u2018import\u2019 Number.Ratio( T(..) )\n</code></pre>\n\n<hr>\n\n<p>Sure thing buddy, I can comply:</p>\n\n<pre><code>{-# LANGUAGE NoImplicitPrelude #-}\nmodule Number.SqrtRatio (T, ratioPart) where\n\nimport qualified Number.Ratio as Ratio\nimport Number.Ratio (T((:%)))\n--       newly added ^\n</code></pre>\n\n<p>...but this also ends up importing <code>Ratio.T</code>, which conflicts with my <code>T</code>!</p>\n\n<pre><code>ratioPart :: T x -&gt; Ratio.T x\n{-           ^-- Ambiguous occurrence \u2018T\u2019\n    It could refer to either \u2018Number.SqrtRatio.T\u2019,\n                             defined at Number/SqrtRatio.hs:11:1\n                          or \u2018Number.Ratio.T\u2019,\n                             imported from \u2018Number.Ratio\u2019 at Number/SqrtRatio.hs:5:22-28\n-}\n</code></pre>\n\n<hr>\n\n<p>Alright, so how about <code>import Number.Ratio (T((:%))) hiding T</code>?</p>\n\n<pre><code>Number/SqrtRatio.hs:5:31: parse error on input \u2018hiding\u2019\n</code></pre>\n\n<p>I'm at a bit of a loss, gaise. :/</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 1, "creation_date": 1473522166, "post_id": 39427712, "comment_id": 66178983, "body": "Changing the minimum amount of code structure, <code>[[x, y, z] | x &lt;- allcards, y &lt;- allcards, z &lt;- allcards, x &lt; y, y &lt; z]</code>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1473522355, "post_id": 39427712, "comment_id": 66179041, "body": "There are dozens of examples of questions about generating sets and combinations of a list if you use the search function"}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1473523210, "creation_date": 1473523210, "answer_id": 39427912, "question_id": 39427712, "link": "https://stackoverflow.com/questions/39427712/cartesian-plane-for-3-cards-and-4cards-of-deck-in-haskell/39427912#39427912", "title": "Cartesian plane for 3 cards and 4cards of deck in Haskell", "body": "<p>Here's a way to recursively generate the sets:</p>\n\n<pre><code>-- an example set of cards:\ndata Card = A | T | J | Q | K\n  deriving (Show, Read, Eq, Ord, Bounded, Enum)\n\nnext intv a\n  | a == maxBound = []\n  | otherwise     = intv (succ a)\n\ninterval a = [ a .. ]\ninterval2 a = [ [x,y] | x &lt;- interval a, y &lt;- next interval x ]\ninterval3 a = [ x:y | x &lt;- interval a, y &lt;- next interval2 x ]\ninterval4 a = [ x:y | x &lt;- interval a, y &lt;- next interval3 x ]\ninterval5 a = [ x:y | x &lt;- interval a, y &lt;- next interval4 x ]\n</code></pre>\n\n<p>E.g.:</p>\n\n<pre><code>interval A = [A,T,J,Q,K]\ninterval2 A = [[A,T],[A,J],[A,Q],[A,K],[T,J],[T,Q],[T,K],[J,Q],[J,K],[Q,K]]\ninterval3 A = [[A,T,J],[A,T,Q],[A,T,K],[A,J,Q],[A,J,K],[A,Q,K],[T,J,Q],[T,J,K],[T,Q,K],[J,Q,K]]\ninterval4 A = [[A,T,J,Q],[A,T,J,K],[A,T,Q,K],[A,J,Q,K],[T,J,Q,K]]\ninterval5 A = [[A,T,J,Q,K]]\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 6724755, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/7ade53fcaa81cddafd5d65f3e955e774?s=128&d=identicon&r=PG&f=1", "display_name": "Arushi", "link": "https://stackoverflow.com/users/6724755/arushi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1473523210, "creation_date": 1473522009, "question_id": 39427712, "link": "https://stackoverflow.com/questions/39427712/cartesian-plane-for-3-cards-and-4cards-of-deck-in-haskell", "title": "Cartesian plane for 3 cards and 4cards of deck in Haskell", "body": "<p>The following code runs for 2cards of a deck and gives cartesian plane such that no duplicates are there.</p>\n\n<pre><code>   allcards = [minBound..maxBound] :: [Card]\n   cartesianplane=[ [x ,y] | x &lt;- allcards, y &lt;- allcards, x &lt; y ]\n</code></pre>\n\n<p>How can I do the same for 3 cards and 4cards such that no duplicates are there.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 273, "user_id": 4748776, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0b92126fb77d1017fdcfe19fe2ef4054?s=128&d=identicon&r=PG&f=1", "display_name": "DoubleOseven", "link": "https://stackoverflow.com/users/4748776/doubleoseven"}, "edited": false, "score": 0, "creation_date": 1473518584, "post_id": 39427122, "comment_id": 66177969, "body": "Thanks for your answer! I still get an error:   * Couldn&#39;t match expected type <code>Bool&#39; with actual type </code>t0 a0 -&gt; Bool&#39;  * In the expression: all . map (elem &quot;ACGT&quot;) $ sekvens       In a stmt of a pattern guard for                      an equation for <code>dnaChecker&#39;:         all . map (elem &quot;ACGT&quot;) $ sekvens       In an equation for </code>dnaChecker&#39;:           dnaChecker sekvens             | all . map (elem &quot;ACGT&quot;) $ sekvens = Dna             | all . map (elem &quot;ARNDCEQGHILKMFPSTWYV&quot;) $ sekvens = Protein"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 273, "user_id": 4748776, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0b92126fb77d1017fdcfe19fe2ef4054?s=128&d=identicon&r=PG&f=1", "display_name": "DoubleOseven", "link": "https://stackoverflow.com/users/4748776/doubleoseven"}, "edited": false, "score": 0, "creation_date": 1473519297, "post_id": 39427122, "comment_id": 66178131, "body": "Oh, the wrong function is being mapped. See the update."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 273, "user_id": 4748776, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0b92126fb77d1017fdcfe19fe2ef4054?s=128&d=identicon&r=PG&f=1", "display_name": "DoubleOseven", "link": "https://stackoverflow.com/users/4748776/doubleoseven"}, "edited": false, "score": 0, "creation_date": 1473519402, "post_id": 39427122, "comment_id": 66178155, "body": "Actually, the whole thing is not yet right. I (or <i>someone</i>) will post an actual correction shortly."}, {"owner": {"reputation": 273, "user_id": 4748776, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0b92126fb77d1017fdcfe19fe2ef4054?s=128&d=identicon&r=PG&f=1", "display_name": "DoubleOseven", "link": "https://stackoverflow.com/users/4748776/doubleoseven"}, "edited": false, "score": 0, "creation_date": 1473519420, "post_id": 39427122, "comment_id": 66178164, "body": "Could you please explain why the <code>elem</code> makes it work? I dont understand the logic, like what is going on? <code>elem</code> is an infix function but doesnt have anything to the left"}, {"owner": {"reputation": 273, "user_id": 4748776, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0b92126fb77d1017fdcfe19fe2ef4054?s=128&d=identicon&r=PG&f=1", "display_name": "DoubleOseven", "link": "https://stackoverflow.com/users/4748776/doubleoseven"}, "edited": false, "score": 0, "creation_date": 1473519974, "post_id": 39427122, "comment_id": 66178355, "body": "by argument do you mean sekvens?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 273, "user_id": 4748776, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0b92126fb77d1017fdcfe19fe2ef4054?s=128&d=identicon&r=PG&f=1", "display_name": "DoubleOseven", "link": "https://stackoverflow.com/users/4748776/doubleoseven"}, "edited": false, "score": 0, "creation_date": 1473520495, "post_id": 39427122, "comment_id": 66178520, "body": "Well, each character of <code>sekvens</code>. <code>all</code> behaves something like <code>map</code>: it applies its first argument to each element of its second argument, but instead of returning a list, it returns a <code>Bool</code> indicating if each function call produced a true value. (My original answer was wrong because I forgot that <code>all</code> doesn&#39;t simply take a list of boolean values and reduces it to a single value.)"}, {"owner": {"reputation": 273, "user_id": 4748776, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0b92126fb77d1017fdcfe19fe2ef4054?s=128&d=identicon&r=PG&f=1", "display_name": "DoubleOseven", "link": "https://stackoverflow.com/users/4748776/doubleoseven"}, "edited": false, "score": 0, "creation_date": 1473520568, "post_id": 39427122, "comment_id": 66178543, "body": "ahaaaaaaaa!!!! That makes sense :) many thanks, that was the explanation I was looking for!"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1473519523, "last_edit_date": 1473519523, "creation_date": 1473518375, "answer_id": 39427122, "question_id": 39426989, "link": "https://stackoverflow.com/questions/39426989/haskell-type-error-couldnt-match-type-char-with-t0-char/39427122#39427122", "title": "Haskell type error &quot;Couldn&#39;t match type `Char&#39; with `t0 [Char]&#39;&quot;", "body": "<p><code>elem \"ACGT\"</code> is a function that checks if the string <code>\"ACGT\"</code> is an element of its argument. What you want is</p>\n\n<pre><code>(`elem` \"ACGT\")\n</code></pre>\n\n<p>, which is a function that checks if its argument is an element of <code>\"ACGT\"</code>.</p>\n\n<pre><code>dnaChecker :: String -&gt; SekvensTyp  \ndnaChecker sekvens\n            | all (`elem` \"ACGT\") sekvens = Dna\n            | all (`elem` \"ARNDCEQGHILKMFPSTWYV\") sekvens = Protein\n</code></pre>\n\n<p>Treating <code>elem</code> as an infix function lets us write a succinct section, rather than writing out an explicit lambda expression like <code>\\x -&gt; elem x \"ACGT\"</code>.</p>\n"}], "owner": {"reputation": 273, "user_id": 4748776, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0b92126fb77d1017fdcfe19fe2ef4054?s=128&d=identicon&r=PG&f=1", "display_name": "DoubleOseven", "link": "https://stackoverflow.com/users/4748776/doubleoseven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 614, "favorite_count": 0, "accepted_answer_id": 39427122, "answer_count": 1, "score": 0, "last_activity_date": 1473519523, "creation_date": 1473517433, "question_id": 39426989, "link": "https://stackoverflow.com/questions/39426989/haskell-type-error-couldnt-match-type-char-with-t0-char", "title": "Haskell type error &quot;Couldn&#39;t match type `Char&#39; with `t0 [Char]&#39;&quot;", "body": "<p>I am trying to create a dnaChecker funtion and get this error. I don't know what is wrong. If someone could explain the error or give me some tips that would be great!\nHere is the error and the code:</p>\n\n<blockquote>\n<pre><code>  * Couldn't match type `Char' with `t0 [Char]'\n  Expected type: [t0 [Char]]\n    Actual type: String\n* In the second argument of `all', namely `sekvens'\n  In the expression: all (elem \"ACGT\") sekvens\n  In a stmt of a pattern guard for\n                 an equation for `dnaChecker':\n    all (elem \"ACGT\") sekvens\n</code></pre>\n</blockquote>\n\n<pre><code>dnaChecker :: String -&gt; SekvensTyp  \ndnaChecker sekvens\n                | all (elem \"ACGT\") sekvens = Dna\n                | all (elem \"ARNDCEQGHILKMFPSTWYV\") sekvens = Protein\n</code></pre>\n"}, {"tags": ["haskell", "parsec", "megaparsec"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1473518083, "post_id": 39426917, "comment_id": 66177854, "body": "You could parse macro definitions as expression trees which preserve whitespace, then parse macro arguments as expressions as well, and then substitute expressions into expressions (a well explored problem). Things like building keywords out of macro arguments (i.e. the <i>semantics</i> of macros, as opposed to their syntax) could be implemented as a transformation on expression trees which is applied right after substitution. (This question could do with some more detail, like a minimal example of a parser described in the question)"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1473756171, "post_id": 39426917, "comment_id": 66251692, "body": "Why not mimick what the C preprocessor does?"}], "owner": {"reputation": 1781, "user_id": 1248563, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8105b89ccc12fd51cdf9267f8ea5704f?s=128&d=identicon&r=PG", "display_name": "cornuz", "link": "https://stackoverflow.com/users/1248563/cornuz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 202, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1473517251, "creation_date": 1473516852, "last_edit_date": 1473517251, "question_id": 39426917, "link": "https://stackoverflow.com/questions/39426917/megaparsec-macro-expansion-during-parsing", "title": "Megaparsec: macro expansion during parsing", "body": "<p>In a small DSL, I'm parsing macro definitions, similarly to <code>#define</code> C pre-processor directives (here a simplistic example):</p>\n\n<pre><code>_def mymacro(a,b) = a + b / a\n</code></pre>\n\n<p>When the following call is encountered by the parser</p>\n\n<pre><code>c = mymacro(pow(10,2),3)\n</code></pre>\n\n<p>it is expanded to</p>\n\n<pre><code>c = pow(10,2) + 3 / pow(10,2)\n</code></pre>\n\n<p>My current approach is:</p>\n\n<ul>\n<li>wrap the parser in a State monad</li>\n<li>when parsing macro definitions, store them in the state, with their body <em>unparsed</em> (parse it as a string)</li>\n<li>when parsing a macro call, find the definition in the state, replace the arguments in the body text, replace the call with this body and resume the parsing. </li>\n</ul>\n\n<p>Some code from the last step:</p>\n\n<pre><code>macrocallStmt\n  = do  -- capture starting position and content of old input before macro call\n        oldInput &lt;- getInput\n        oldPos &lt;- getPosition\n        -- parse the call\n        ret &lt;- identifier\n        symbolCS \"=\"\n        i &lt;- identifier\n        args &lt;- parens $ commaSep anyExprStr\n        -- expand the macro call\n        us &lt;- get\n        let inlinedCall = replaceMacroArgs i args ret us\n        -- set up new input with macro call expanded\n        remainder &lt;- getInput\n        let newInput = T.append inlinedCall (T.cons '\\n' remainder)\n        setPosition oldPos\n        setInput newInput\n        -- update the expanded input script\n        modify (updateExpandedInput oldInput newInput)\n\nanyExprStr = fmap praShow expression &lt;|&gt; fmap praShow algexpr\n</code></pre>\n\n<p>This approach does the job decently. However, it has a number of drawbacks.</p>\n\n<h2>Parsing multiple times</h2>\n\n<p>Any valid DSL expression can be an argument of the macro call. Therefore, even though I only need their textual representation (to be replaced in the macro body), I need to parse them and then convert them again to string - simply looking for the next comma wouldn't work. Then the complete and customised macro will be parsed. So in practice, macro arguments get parsed twice (and also show-ed, which has its cost). Moreover, each call requires a new parsing of the (almost same) body. The reason to keep the body unparsed in memory is to allow maximum flexibility: in the body, even DSL keywords could be constructed out of the macro arguments.</p>\n\n<h2>Error handling</h2>\n\n<p>Because the expanded body is inserted in front of the unconsumed input (replacing the call), the initial and final input can be quite different. In the event of a parse error, the position where the error occurred in the <em>expanded</em> input is available. However, when processing the error, I only have the original, not expanded, input. So the error position won't match.\nThat is why, in the code snippet above, I use the state to save the expanded input, so that it is available when the parser exits with an error.\nThis works well, but I noticed that it becomes quite costly, with new Text arrays (the input stream is Text) being allocated for the whole stream at every expansion. Perhaps keeping the expanded input in the state as String, rather than Text, would be cheaper in this case, i.e. when a middle part needs to be replaced?</p>\n\n<p>The reasons for this question are:</p>\n\n<ul>\n<li>I would appreciate suggestions / comments on the two issues described above</li>\n<li>Can anyone suggest a better approach altogether?</li>\n</ul>\n"}, {"tags": ["haskell", "ocaml", "monads", "free-monad"], "answers": [{"comments": [{"owner": {"reputation": 360, "user_id": 2626557, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5495eeaa39169e3064453987524aae27?s=128&d=identicon&r=PG", "display_name": "stackman", "link": "https://stackoverflow.com/users/2626557/stackman"}, "edited": false, "score": 0, "creation_date": 1473854373, "post_id": 39429728, "comment_id": 66297327, "body": "thanks for the answer. I am still trying to implement your idea in my particular setting."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1473535649, "last_edit_date": 1473535649, "creation_date": 1473535013, "answer_id": 39429728, "question_id": 39426861, "link": "https://stackoverflow.com/questions/39426861/widen-types-in-ocaml/39429728#39429728", "title": "Widen types in ocaml", "body": "<p>I'm not very familiar with Ocaml but I believe that</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>let rec hoistfree : 'b.('b t -&gt; 'b t) -&gt; 'a m -&gt; 'a m =\n</code></pre>\n\n<p>is parsed as</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>let rec hoistfree : 'b. ( ('b t -&gt; 'b t) -&gt; 'a m -&gt; 'a m ) =\n</code></pre>\n\n<p>instead of</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>let rec hoistfree : ('b. ('b t -&gt; 'b t)) -&gt; 'a m -&gt; 'a m =\n</code></pre>\n\n<p>The former is a basic polymorphic type, the latter is a rank2-type which requires more support from the type system than Hindley-Milner.</p>\n\n<p>IIRC, to achieve the latter you need to define a custom wrapper data type. For instance:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>type poly = { polyf: 'a . 'a -&gt; 'a } ;;\n\nlet foo (x: poly): int = x.polyf 4;;\nlet bar: poly = { polyf = fun x -&gt; x } ;;\n\nlet _ = print_string (\"hello \" ^ string_of_int (foo bar));;\n</code></pre>\n"}], "owner": {"reputation": 360, "user_id": 2626557, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5495eeaa39169e3064453987524aae27?s=128&d=identicon&r=PG", "display_name": "stackman", "link": "https://stackoverflow.com/users/2626557/stackman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 3, "answer_count": 1, "score": 5, "last_activity_date": 1473535756, "creation_date": 1473516516, "last_edit_date": 1473535756, "question_id": 39426861, "link": "https://stackoverflow.com/questions/39426861/widen-types-in-ocaml", "title": "Widen types in ocaml", "body": "<p>I am trying to write a free monad library in ocaml, following <a href=\"http://hackage.haskell.org/package/free-4.12.4/docs/src/Control-Monad-Free.html#hoistFree\" rel=\"nofollow\">Control.Monad.Free</a> from haskell but I am stuck at one point, in the implementation of hoistFree.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>hoistFree :: Functor g =&gt; (forall a. f a -&gt; g a) -&gt; Free f b -&gt; Free g b\nhoistFree _ (Pure a)  = Pure a\nhoistFree f (Free as) = Free (hoistFree f &lt;$&gt; f as)\n</code></pre>\n\n<p>Here is my attempt at a translation.</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>let rec hoistfree : 'b.('b t -&gt; 'b t) -&gt; 'a m -&gt; 'a m =\n      fun f x -&gt; match x with\n       | Return x -&gt; Return x\n       | Free x   -&gt; Free (T.map (hoistfree f) (f x));;\n</code></pre>\n\n<p>Unfortunately I get an error telling me I am not widening correctly the type of g. </p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>Error: This definition has type ('b m t -&gt; 'b m t) -&gt; 'b m -&gt; 'b m\n       which is less general than 'a. ('a t -&gt; 'a t) -&gt; 'b m -&gt; 'b m\n</code></pre>\n\n<p>Everything works fine if I don't insert the function type annotation, but then as the error message says, I don't get the general type for f.\nWhere is the problem? How can I widen the type of f?</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "tail-call-optimization"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1473514037, "post_id": 39426512, "comment_id": 66176778, "body": "You realise that <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad-Instances.html#v:return\" rel=\"nofollow noreferrer\"><code>return</code></a> is just a library function, and works quite differently from the <code>return</code> keyword in procedural languages?"}, {"owner": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1473514261, "post_id": 39426512, "comment_id": 66176844, "body": "@leftaroundabout : realized that &quot;something&quot; about this is not correct, as I was hitting &quot;POST&quot;, then saw this comment immediately. Thanks."}, {"owner": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1473514433, "post_id": 39426512, "comment_id": 66176903, "body": "there is no way to &#39;close&#39; a question other than accepting an answer? if so, I need to wait for sometime before I can accept an answer. Will read the stackoverflow documentation. For now, to accept I&#39;ve to wait 7 more minutes :-) ."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1473514674, "post_id": 39426512, "comment_id": 66176980, "body": "@user3169543 There is no rush to accept an answer. Upvote answers that you find useful and come back, say tomorrow, and accept the one you deem best.  Accepting early means that you are less likely to receive very good answers since answerers may lose interest in the question, and often the first answer may not be correct (or as correct) or complete (or as complete) as following answers."}], "answers": [{"tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 5, "last_activity_date": 1473514155, "creation_date": 1473514155, "answer_id": 39426553, "question_id": 39426512, "link": "https://stackoverflow.com/questions/39426512/haskell-tco-and-lazy-evaluation/39426553#39426553", "title": "Haskell: TCO and Lazy evaluation", "body": "<p>Tail-call optimization has <strong>nothing</strong> to do with this behaviour. The problem is simply that the first code contains an infinite loop while the second doesn't.</p>\n\n<p>Your first code is similar to the imperative (python-like):</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>def loop():\n    c = getChar()\n    if valid c:\n        do_something()\n    else:\n        do_something_else()\n\n    print(c)\n    loop()\n</code></pre>\n\n<p>While the latter is similar to:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>def loop():\n    c = getChar()\n    if valid c:\n        do_something()\n    else:\n        do_something_else()\n        print(c)\n        loop()\n</code></pre>\n\n<p>Note how in the latter case the call to <code>loop()</code> is <em>inside</em> the branch <code>else</code> while in the former it's <em>outside</em> and thus is called at every <code>loop</code> invocation.</p>\n\n<p>Also note that <code>return</code> in Haskell does <strong>not</strong> terminate the function calls. It's just an <code>IO</code> action that has a certain value and no side-effects.</p>\n\n<p>For example:</p>\n\n<pre><code>main = do\n    c &lt;- return 1\n    print c\n</code></pre>\n\n<p>In the above code the <code>return</code> does <strong>not</strong> prevent the output from <code>print</code>.</p>\n"}], "owner": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 39426553, "answer_count": 1, "score": 0, "last_activity_date": 1473514155, "creation_date": 1473513870, "last_edit_date": 1495541702, "question_id": 39426512, "link": "https://stackoverflow.com/questions/39426512/haskell-tco-and-lazy-evaluation", "title": "Haskell: TCO and Lazy evaluation", "body": "<p>I'm trying to understand why the first <code>main</code> does not terminate when <code>c</code> is not valid, while the second terminates. From the description <a href=\"https://stackoverflow.com/questions/13782222/haskell-recursion-and-memory-usage\">here</a> \n <code>main</code> is just an unevaluated thunk, and <code>executing</code> it is just building up the data structure. I'm trying to apply the same principle here and see why the first main does not terminate. If someone can help me understand this part, or give me pointers to understanding this would be great. Apart from this, why is GHCI not able to recognize this as TCO ? does is not fit the definition?</p>\n\n<pre><code>main = loop                                                                     \n  where                                                                         \n   loop =  do                                                                   \n     c &lt;- getChar                                                               \n     case valid c of                                                            \n       Nothing -&gt; return ()                                                     \n       Just b  -&gt; print b                                                       \n     print c                                                                    \n     loop                                                                       \n\n&gt; main :: IO ()\n&gt; main = loop\n&gt;   where\n&gt;   loop =  do\n&gt;     c &lt;- getChar\n&gt;     case validate c of\n&gt;       Nothing -&gt; return ()\n&gt;       Just b  -&gt; do\n&gt;         print b\n&gt;         loop\n</code></pre>\n\n<p>Thanks.</p>\n"}, {"tags": ["list", "haskell", "ocaml", "monads", "category-theory"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1473512877, "post_id": 39426131, "comment_id": 66176531, "body": "Free monads are generalised externally-labelled trees; <code>a</code>s appear in the <code>Return</code> constructor, not in the <code>Free</code> constructor. Lists are internally-labelled; they have <code>a</code>s all along the list, not just at the leaves."}, {"owner": {"reputation": 360, "user_id": 2626557, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5495eeaa39169e3064453987524aae27?s=128&d=identicon&r=PG", "display_name": "stackman", "link": "https://stackoverflow.com/users/2626557/stackman"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1473513214, "post_id": 39426131, "comment_id": 66176609, "body": "@Hodgson I am not sure that I understand your comment. There are free monads that are not trees. The monoid of integers, for example, can be realized as the free monad associated to the identity functor on the category of one object (and a single morphism)."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1473514103, "post_id": 39426131, "comment_id": 66176793, "body": "Are you referring to <code>type Nat = Free Identity ()</code>? That&#39;s a tree with a branching factor of 1 (because <code>Identity a</code> contains one <code>a</code>). <code>Free ((-&gt;) r)</code> is a tree with a branching factor of <code>r</code>, <code>Free (Const Void)</code> is a tree with a branching factor of 0. Etc"}, {"owner": {"reputation": 360, "user_id": 2626557, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5495eeaa39169e3064453987524aae27?s=128&d=identicon&r=PG", "display_name": "stackman", "link": "https://stackoverflow.com/users/2626557/stackman"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1473515774, "post_id": 39426131, "comment_id": 66177261, "body": "Yes that&#39;s the point. Consider the integers (the mathematical one, usually implemented as big int), they can be built as a tree or a free monad, as you just mentioned. Why is it not so for flat lists? I am not asking for a philosophical answer, but for some explicit construct (preferably a relation) that shows that List monad cannot be isomorphic to a free monad."}], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1473599734, "post_id": 39435555, "comment_id": 66195333, "body": "You&#39;ll notice thought that bind for <code>List a</code> is not the bind for <code>[]</code>. So you may want to reconsider accepting <code>Free f</code> to be applied to a fixed type like in <code>Nat</code>."}, {"owner": {"reputation": 360, "user_id": 2626557, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5495eeaa39169e3064453987524aae27?s=128&d=identicon&r=PG", "display_name": "stackman", "link": "https://stackoverflow.com/users/2626557/stackman"}, "edited": false, "score": 0, "creation_date": 1473622342, "post_id": 39435555, "comment_id": 66202141, "body": "That&#39;s clever! It&#39;s quite surprising that the <code>&lt;&lt;</code> Free operator corresponds to appending Lists. Now if this construction was a monad isomorphism, <code>Free.(&lt;&lt;) </code> would correspond to the standard <code>[].(&lt;&lt;)</code> operator, which is quite different from append. Still there is one instance where it works, namely for <code>a = ()</code>, in which case we recover Nat."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 1, "last_activity_date": 1473592982, "creation_date": 1473592982, "answer_id": 39435555, "question_id": 39426131, "link": "https://stackoverflow.com/questions/39426131/flat-lists-and-free-monads/39435555#39435555", "title": "Flat lists and free monads", "body": "<p>If you're okay with the free monad being applied to a type in particular which seems to be the case given the way you consider the <code>Nat</code> example given in the comments, then <code>List</code> can indeed be described using <code>Free</code>:</p>\n\n<pre><code>type List a = Free ((,) a) ()\n</code></pre>\n\n<p>The underlying idea here is that a <code>List a</code> is a <code>Nat</code> where each <code>Suc</code> node has been labelled with an <code>a</code> (hence the use of the <code>(a,)</code> functor rather than the <code>Identity</code> one).</p>\n\n<p>Here is a small module witnessing the isomorphism together with an example:</p>\n\n<pre><code>module FreeList where\n\nimport Data.Function\nimport Control.Monad.Free\n\ntype List a = Free ((,) a) ()\n\ntoList :: [a] -&gt; List a\ntoList = foldr (curry Free) (Pure ())\n\nfromList :: List a -&gt; [a]\nfromList = iter (uncurry (:)) . fmap (const [])\n\nappend :: List a -&gt; List a -&gt; List a\nappend xs ys = xs &gt;&gt;= const ys\n\nexample :: [Integer]\nexample = fromList $ (append `on` toList) [1..5] [6..10]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 961, "user_id": 4533618, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb9f7e57a3c762c6d98139a2a349fae9?s=128&d=identicon&r=PG", "display_name": "Ingo Blechschmidt", "link": "https://stackoverflow.com/users/4533618/ingo-blechschmidt"}, "is_accepted": false, "score": 1, "last_activity_date": 1539635292, "last_edit_date": 1539635292, "creation_date": 1488923109, "answer_id": 42658923, "question_id": 39426131, "link": "https://stackoverflow.com/questions/39426131/flat-lists-and-free-monads/42658923#42658923", "title": "Flat lists and free monads", "body": "<p>(Adapted from my <a href=\"https://stackoverflow.com/a/41809366/4533618\">post in a different thread</a>.)</p>\n\n<p>Here is a full proof why the list monad is not free, including a bit of context.</p>\n\n<p>Recall that we can construct, for any functor <code>f</code>, the free monad over <code>f</code>:</p>\n\n<pre><code>data Free f a = Pure a | Roll (f (Free f a))\n</code></pre>\n\n<p>Intuitively, <code>Free f a</code> is the type of <code>f</code>-shaped trees with leaves of type <code>a</code>.\nThe join operation merely grafts trees together and doesn't perform any\nfurther computations. Values of the form <code>(Roll _)</code> shall be called\n\"nontrivial\" in this posting. The task is to show that for no functor <code>f</code>, the monad <code>Free f</code> is isomorphic to the list monad.</p>\n\n<p>The intuitive reason why this is true is because the\njoin operation of the list monad (concatenation) doesn't merely graft\nexpressions together, but flattens them.</p>\n\n<p>More specifically, in the free monad over any functor, the result of binding a nontrivial\naction with any function is always nontrivial, i.e.</p>\n\n<pre><code>(Roll _ &gt;&gt;= _) = Roll _\n</code></pre>\n\n<p>This can be checked directly from the definition of <code>(&gt;&gt;=)</code> for the free\nmonad.</p>\n\n<p>If the list monad would be isomorphic-as-a-monad to the free monad over some\nfunctor, the isomorphism would map only singleton lists <code>[x]</code> to values of\nthe form <code>(Pure _)</code> and all other lists to nontrivial values. This is\nbecause monad isomorphisms have to commute with \"return\" and <code>return x</code>\nis <code>[x]</code> in the list monad and <code>Pure x</code> in the free monad.</p>\n\n<p>These two facts contradict each other, as can be seen with the following\nexample:</p>\n\n<pre><code>do\n    b &lt;- [False,True]  -- not of the form (return _)\n    if b\n        then return 47\n        else []\n-- The result is the singleton list [47], so of the form (return _).\n</code></pre>\n\n<p>After applying a hypothetical isomorphism to the free monad over some\nfunctor, we'd have that the binding of a nontrivial value (the image\nof <code>[False,True]</code> under the isomorphism) with some function results in a\ntrivial value (the image of <code>[47]</code>, i.e. <code>return 47</code>).</p>\n"}], "owner": {"reputation": 360, "user_id": 2626557, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5495eeaa39169e3064453987524aae27?s=128&d=identicon&r=PG", "display_name": "stackman", "link": "https://stackoverflow.com/users/2626557/stackman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 496, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1539635292, "creation_date": 1473510863, "last_edit_date": 1473533933, "question_id": 39426131, "link": "https://stackoverflow.com/questions/39426131/flat-lists-and-free-monads", "title": "Flat lists and free monads", "body": "<p>I am trying to convince myself that the List monad (the one with flat lists, concatenation of lists and map element-wise) is not a free monad (to be precise, the free monad associated to some functor T). As far as I understand, I should be able to achieve that by </p>\n\n<ul>\n<li><p>first finding a relation in the monad List between the usual operators fmap, join etc, </p></li>\n<li><p>then showing that this relation does not hold in any free monad over a functor T, for all T.</p></li>\n</ul>\n\n<p>What is a peculiar relation that holds in the List monad, that sets it apart from the free monads? How can I handle step2 if I don't know what T is? Is there some other strategy to show that flat lists are not free?</p>\n\n<p>As a side note, to dispell any terminology clash, let me remark that the free monad associated to the pair functor is a tree monad (or a nested list monad), it is not the flat List monad.</p>\n\n<p><em>Edit</em>: for people acquainted with the haskell programming language, the question can be formulated as follows: how to show that there is no functor T such that List a = Free T a (for all T and up to monad isomorphism)?</p>\n"}, {"tags": ["parsing", "haskell", "parse-error"], "answers": [{"tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": false, "score": 4, "last_activity_date": 1473511494, "last_edit_date": 1473511494, "creation_date": 1473511141, "answer_id": 39426160, "question_id": 39426111, "link": "https://stackoverflow.com/questions/39426111/haskell-exception-prelude-read-no-parse/39426160#39426160", "title": "Haskell *** Exception: Prelude.read: no parse", "body": "<p><code>read</code> is a function with type <code>read :: Read a =&gt; String -&gt; a</code>. This means that <code>read</code> takes <code>String</code> as input and returns a value for some type <code>a</code> provided that <code>a</code> implements the <code>Read</code> type class. <code>read</code> has to know what specific type to return, and it can know that in one of two ways: either the type is given to it explicitly (e.g. <code>read \"123\" :: Int</code> or <code>read \"True\" :: Bool</code>) or it infers it from the context. In your case, <code>read</code> infers that it must return an <code>Int</code> because <code>LogMessage</code> expects an <code>Int</code> as its second parameter. So in this case the expression <code>read [y]</code> means: take the <code>Char</code> <code>y</code>, convert it into an one-element string, and then try to convert that to an <code>Int</code>, by parsing it. Now if <code>y</code> happens to contain a character that is not a decimal digit, it will fail (by throwing an exception) because it will not know how to covert it into an integer.</p>\n\n<p>Now how can you deal with that issue? You must check that the input to <code>read</code> is ok before calling it. For example, you can check that <code>y</code> is a digit (using the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Char.html#v:isDigit\" rel=\"nofollow\">appropriate function</a>):</p>\n\n<pre><code>parseMessage (x:y:z)\n  | x == 'I' &amp;&amp; isDigit y = LogMessage Info (read [y]) (unwords [z])\n  ...\n</code></pre>\n\n<p>Alternatively, you can use <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Text-Read.html#v:readMaybe\" rel=\"nofollow\">readMaybe</a> from <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Text-Read.html\" rel=\"nofollow\">Text.Read</a> that is like <code>read</code> but it does not throw an exception if it fails, instead it returns a nothing value:</p>\n\n<pre><code>parseMessage (x:y:z)\n  | x == 'I', Just n &lt;- readMaybe [y] = LogMessage Info n (unwords [z])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 107, "user_id": 4095246, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tP0wXvMtv6k/AAAAAAAAAAI/AAAAAAAAC_U/6u2P6QjKdNc/photo.jpg?sz=128", "display_name": "Eduard", "link": "https://stackoverflow.com/users/4095246/eduard"}, "is_accepted": false, "score": 0, "last_activity_date": 1473512968, "creation_date": 1473512968, "answer_id": 39426384, "question_id": 39426111, "link": "https://stackoverflow.com/questions/39426111/haskell-exception-prelude-read-no-parse/39426384#39426384", "title": "Haskell *** Exception: Prelude.read: no parse", "body": "<p>The problem is your input message format. You're reading a line as a string, then matching on the characters in the string (since a string is type alias for <code>[Char]</code>).\nIn your <code>sample.log</code> the first line (<code>I 6 Completed armadillo processing</code>) would be passed in as a string to <code>parseMessage</code>, and the parameters will take the following values:</p>\n\n<p><code>x</code> = <code>'I'</code></p>\n\n<p><code>y</code> = <code>' ' --single white space character</code></p>\n\n<p><code>z</code> = <code>\"6 Completed armadillo processing\"</code></p>\n\n<p><code>read</code> gets the white space character and throws <code>*** Exception: Prelude.read: no parse</code></p>\n\n<p>In order to get the values, you could do the following:</p>\n\n<pre><code>    parseMessage :: String -&gt; LogMessage\n    parseMessage msg = \n      case words msg of\n        \"I\":y:z -&gt; LogMessage Info (read y :: TimeStamp) (unwords z)\n        \"W\":y:z -&gt; undefined\n        \"E\":y:z -&gt; undefined\n        _       -&gt; undefined\n</code></pre>\n\n<p>This way the first two valid words (<code>MessageType</code> and <code>TimeStamp</code> in this case) can be extracted easily.</p>\n"}], "owner": {"reputation": 85, "user_id": 5365743, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bac335edc2f72a6013386555b4c1957f?s=128&d=identicon&r=PG&f=1", "display_name": "A. Morris", "link": "https://stackoverflow.com/users/5365743/a-morris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4601, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1473512968, "creation_date": 1473510708, "question_id": 39426111, "link": "https://stackoverflow.com/questions/39426111/haskell-exception-prelude-read-no-parse", "title": "Haskell *** Exception: Prelude.read: no parse", "body": "<p>Hi I am trying to complete CIS194 Spring 13 when I get the error message <code>*** Exception: Prelude.read: no parse</code> on one of my functions. The file that the function is in is called <code>LogAnalysis.hs</code> and the function is <code>parseMessage</code>, but the file also imports from <code>Log.hs</code>. Why am I geting this error message and how can I fix it?</p>\n\n<p>Here is my code:\n<a href=\"https://github.com/Adam-Morris/CIS194/tree/master/Homework-2\" rel=\"nofollow\">https://github.com/Adam-Morris/CIS194/tree/master/Homework-2</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 7, "creation_date": 1473504831, "post_id": 39424961, "comment_id": 66174636, "body": "I think the usefulness of IO (and similar safety features) should be measured in &quot;how easy to make it work if you don&#39;t want to break it&quot; not &quot;how easy to break it if you want to break it&quot;."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1473507560, "post_id": 39424961, "comment_id": 66175296, "body": "Also, importing <code>System.IO.Unsafe</code> and using <code>unsafePerformIO</code> seems easier ;). It&#39;s easy to bypass, but <i>unsafe</i>."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1473519845, "post_id": 39424961, "comment_id": 66178308, "body": "<code>unsafeDupablePerformIO (IO m) = case runRW# m of (# _, a #) -&gt; a</code> It&#39;s exactly the same, I didn&#39;t know this module though :) I stumbled upon <code>runRW#</code> when reading the simplifier&#39;s Core."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1534130923, "post_id": 39424961, "comment_id": 90584090, "body": "It&#39;s even more unsafe to use <code>realWorld#</code> instead of <code>runRW#</code>."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 10, "last_activity_date": 1534123782, "last_edit_date": 1534123782, "creation_date": 1473504091, "answer_id": 39425221, "question_id": 39424961, "link": "https://stackoverflow.com/questions/39424961/escaping-monad-io/39425221#39425221", "title": "Escaping monad IO", "body": "<p>This is the purpose of Safe Haskell. If you add <code>{-# language Safe #-}</code> to the top of your source file, you will only be allowed to import modules that are either inferred safe or labeled <code>{-# language Trustworthy #-}</code>. This also imposes some mild restrictions on overlapping instances.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1473522526, "post_id": 39425774, "comment_id": 66179080, "body": "In recent GHC versions you can&#39;t define your own <code>Typeable</code> instances. The closest you could come would be to <code>unsafeCoerce</code> something like <code>Dict (Typeable a)</code>, but that would only have local effects."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473523129, "post_id": 39425774, "comment_id": 66179230, "body": "@dfeuer I suspected this was no longer possible since automatic deriving was implemented. Thanks for the clarification."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1473605073, "last_edit_date": 1473605073, "creation_date": 1473508319, "answer_id": 39425774, "question_id": 39424961, "link": "https://stackoverflow.com/questions/39424961/escaping-monad-io/39425774#39425774", "title": "Escaping monad IO", "body": "<p>There are many ways in which you can break purity in Haskell. However, you have to go out of your way to find them. Here are a few:</p>\n\n<ul>\n<li>Importing <code>GHC</code> internal modules to access low-level primitives</li>\n<li>Using the FFI to import a C function as a pure one, when it is not pure</li>\n<li>Using <code>unsafePerformIO</code></li>\n<li>Using <code>unsafeCoerce</code></li>\n<li>Using <code>Ptr a</code> and dereference pointers not pointing to valid data</li>\n<li>Declaring your own <code>Typeable</code> instances, and lying so that you can abuse <code>cast</code>. (No longer possible in recent GHC)</li>\n<li>Using the unsafe array operations</li>\n</ul>\n\n<p>All these, and others, are not meant to be used regularly. They are there so that, if one is really, really sure, can tell the compiler \"I know what I am doing, don't get in my way\". Doing so, you take the burden of the proof -- proving that what you are doing is safe.</p>\n"}], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 483, "favorite_count": 0, "accepted_answer_id": 39425221, "answer_count": 2, "score": 4, "last_activity_date": 1534123782, "creation_date": 1473501887, "question_id": 39424961, "link": "https://stackoverflow.com/questions/39424961/escaping-monad-io", "title": "Escaping monad IO", "body": "<p>One of the things I like best about Haskell is how the compiler locates the side effects via the IO monad in function signatures. However, it seems easy to bypass this type check by importing 2 GHC primitives :</p>\n\n<pre><code>{-# LANGUAGE MagicHash #-}\n\nimport GHC.Magic(runRW#)\nimport GHC.Types(IO(..))\n\nhiddenPrint :: ()\nhiddenPrint = case putStrLn \"Hello !\" of\n  IO sideEffect -&gt; case runRW# sideEffect of\n    _ -&gt; ()\n</code></pre>\n\n<p><code>hiddenPrint</code> is of type unit, but it does trigger a side effect when called (it prints Hello). Is there a way to forbid those hidden IOs (other than trusting no one imports GHC's primitives) ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1473499541, "post_id": 39424505, "comment_id": 66173262, "body": "I don&#39;t think you&#39;ll find a name for this since it doesn&#39;t really have much to do with monoids. That \u201claw\u201d is merely the <i>definition of <code>mconcat</code></i>. A <code>Monoid</code> instance may override this for better performance, but it should always have the semantics of the reference implementation."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1473502263, "post_id": 39424681, "comment_id": 66173957, "body": "Right, although <code>fold</code> does have the disadvantage that the monoid gets no say in the fold association order that&#39;s chosen. And while that must not matter semantically, it certainly can have a significant impact on strictness/performance (the classic example being of course: it would be very inefficient if we had <code>mconcat = foldl&#39; mappend mempty</code> for lists)."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1473533885, "post_id": 39424681, "comment_id": 66182493, "body": "Yes. I&#39;d prefer the name &quot;crush&quot;, as it happens. The trouble is that &quot;fold&quot; has two meanings which coincide only in <code>foldr</code>. Meanwhile, it would indeed be good to be able to indicate whether, for a given monoid, either bias in association is to be preferred. It&#39;s not obvious that the implementation of <code>mconcat</code> is the best way to signal that."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 12, "last_activity_date": 1473499975, "creation_date": 1473499975, "answer_id": 39424681, "question_id": 39424505, "link": "https://stackoverflow.com/questions/39424505/what-is-the-name-of-this-monoid-law/39424681#39424681", "title": "What is the name of this monoid law?", "body": "<p>Mathematically, the definition of a monoid requires the existence of something like <code>mempty</code> and something like <code>mappend</code>, satisfying the first three laws: left and right identity, and associativity.</p>\n\n<p>The <code>mconcat</code> method has been added to the class to reflect the fact that accumulation in a list is often what one does with monoids. The fourth law is the <em>executable specification</em> of <code>mconcat</code>: indeed, that very law is the line of code which gives the default implementation of <code>mconcat</code>. Making <code>mconcat</code> a member of the class means that, per <code>Monoid</code> instance, you are free to give <code>mconcat</code> a more efficient implementation, just as long as it agrees with the default.</p>\n\n<p>It's not clear to me that making <code>mconcat</code> reimplementable in this way is a particularly big win. I'd tend to avoid <code>mconcat</code> in favour of (the confusingly named) <code>fold</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1473517710, "creation_date": 1473517710, "answer_id": 39427020, "question_id": 39424505, "link": "https://stackoverflow.com/questions/39424505/what-is-the-name-of-this-monoid-law/39427020#39427020", "title": "What is the name of this monoid law?", "body": "<p>The purpose of <code>mconcat</code> is not to provide any more information about the monoid; it is an implementation detail. It is a convenience function, but one that might be implemented more efficiently than its default definition. When infinite lists are considered, \"more efficient\" can mean \"possible\".</p>\n\n<p>Consider the <code>Product</code> monoid. The following never terminates, using the default definition of <code>mconcat</code>:</p>\n\n<pre><code>mconcat (map Product [0..])\n</code></pre>\n\n<p>even though it should be obvious that <em>any</em> list of integers containing 0 should produce 0. However, if you were to redefine the function as</p>\n\n<pre><code>mconcat = foldr (\\acc v -&gt; if acc == Product 0 then Product 0 else mappend acc v) empty\n</code></pre>\n\n<p>Then the product of an infinite list containing at least one zero would still terminate. (Of course, an infinite list of of non-zero values would still never terminate, but this <code>mconcat</code> is still more efficient for large lists that contain an \"early\" zero.)</p>\n"}], "owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 2, "accepted_answer_id": 39424681, "answer_count": 2, "score": 8, "last_activity_date": 1473517710, "creation_date": 1473498610, "question_id": 39424505, "link": "https://stackoverflow.com/questions/39424505/what-is-the-name-of-this-monoid-law", "title": "What is the name of this monoid law?", "body": "<p>In the documentation for <code>Data.Monoid</code>, it states the following laws should be satisfied:</p>\n\n<pre><code>mappend mempty x = x\nmappend x mempty = x\nmappend x (mappend y z) = mappend (mappend x y) z\nmconcat = foldr mappend mempty\n</code></pre>\n\n<p>My understanding of these is that the first 2 are identity, and the third is associativity.</p>\n\n<p>But what is the law in the fourth line? Identity again, but for <code>mconcat</code>?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "reply_to_user": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "edited": false, "score": 0, "creation_date": 1473470199, "post_id": 39421516, "comment_id": 66168015, "body": "@smilingbuddha yes, I fixed it. In way, it doesn&#39;t make sense to talk about the size of the haskell representation of a value, because that representation is very opaque to the user. You have no way of inspecting how haskell stores its values."}, {"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "edited": false, "score": 0, "creation_date": 1473470483, "post_id": 39421516, "comment_id": 66168056, "body": "Thanks! Could you explain the <code>alignment</code> function in some more depth? Suppose I have <code>data MyData = MyData { intarray :: [Int], dbarray::[Double],  length::Int}</code> How would I write an implementation for <code>alignment</code>?"}, {"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "reply_to_user": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "edited": false, "score": 0, "creation_date": 1473471295, "post_id": 39421516, "comment_id": 66168173, "body": "For the alignment, you typically copy the alignment of C&#39;s <code>int</code> type. You can do that like so: <code>alignment _ = alignment (undefined :: CInt)</code>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1473524953, "post_id": 39421516, "comment_id": 66179799, "body": "If you have that <code>MyData</code> type, then writing a <code>Storable</code> instance for it doesn&#39;t really make sense, since you can&#39;t represent values of that type in a fixed size."}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": true, "score": 10, "last_activity_date": 1473470185, "last_edit_date": 1473470185, "creation_date": 1473469287, "answer_id": 39421516, "question_id": 39421488, "link": "https://stackoverflow.com/questions/39421488/what-does-the-storable-typeclass-do-in-haskell/39421516#39421516", "title": "What does the Storable typeclass do in Haskell", "body": "<p>Haskell stores values in memory in a way that is very incompatible to C. As a result, it is not possible to call a C function from haskell and pass to it haskell values directly. Instead, you have to create a copy of the value, but not an exact copy, but rather in a format that is understood by C. That's what <code>Storable</code> does. So it essentially provides way to serialize haskell values to a C friendly format (e.g. think C structs). It also supports the opposite operation, it can deserialize values. This is useful when a C function is called from haskell and returns a complex (i.e. non primitive) value.</p>\n\n<p>The serialization/deserialization happens with the help of <code>poke</code>/<code>peek</code>. <code>sizeOf</code> returns the byte size of the C representation of the value. Note that this mechanism only works for values that have a C representation of fixed size (e.g. structs). It does not support things like C strings, they are treated <a href=\"https://hackage.haskell.org/package/base/docs/Foreign-C-String.html\" rel=\"noreferrer\">differently</a>. As for <code>alignment</code>, it used to ensure that memory allocations done in the haskell land satisfy the platform's alignment requirements.</p>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 0, "accepted_answer_id": 39421516, "answer_count": 1, "score": 11, "last_activity_date": 1473470185, "creation_date": 1473468860, "question_id": 39421488, "link": "https://stackoverflow.com/questions/39421488/what-does-the-storable-typeclass-do-in-haskell", "title": "What does the Storable typeclass do in Haskell", "body": "<p>I have been reading some documentation on Haskell's C FFI. And I've just encountered a typeclass called <code>Storable</code>, which I don't understand very well. </p>\n\n<p>Are instances of this typeclass, those types are supposed to have a \"pointer\" to them while interfacing with the C code? </p>\n\n<p>Also what do the individual functions <code>sizeOf</code>, <code>alignment</code>, <code>peek</code>, <code>poke</code> do? It seems <code>peek</code> and <code>poke</code> are used to read data from or write data to a place in memory pointed to by <code>Ptr a</code>. Is this right? </p>\n\n<p>But I don't know what <code>sizeOf</code> and <code>alignment</code> mean at all. Can someone give examples to clarify their use? </p>\n"}, {"tags": ["haskell", "haskell-pipes"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1473456525, "post_id": 39419717, "comment_id": 66165009, "body": "Does <code>Random</code> have a <code>MonadIO</code> instance? If so, you will have <code>hoist liftIO  ::  Consumer (Policy s a) IO x -&gt; Consumer (Policy s a) Random x</code> . There are other ways of going about this, some might be faster, but it might help to know more about <code>Random</code>."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1473456639, "post_id": 39419717, "comment_id": 66165045, "body": "@Michael: It doesn&#39;t, and I don&#39;t want it to. It can only do randomness and <i>not</i> general IO. Ideally, I&#39;d love a solution that only depends on the fact that <code>Random</code> has a <code>runIO :: Random a -&gt; IO a</code> function."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1473456884, "post_id": 39419717, "comment_id": 66165118, "body": "And I guess you don&#39;t want <code>hoist runIO</code> to convert the <code>Producer (Policy s a) Random x</code> into a <code>Producer (Policy s a) IO x</code> because of the way randomness is generated."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1473456960, "post_id": 39419717, "comment_id": 66165143, "body": "I am thinking about the last sentence in saying these things.  Some sort of fold might be the fastest thing, but might require being clearer on what the ultimate effect desired is."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1473457017, "post_id": 39419717, "comment_id": 66165170, "body": "@Michael: Honestly, I&#39;m not sure. Part of the problem is that my mental model for exactly how the randomness is run is pretty weak! Having a function that uses <code>hoist runIO</code> internally to get a <code>Producer (Policy s a) IO x</code> before plugging it into a consumer seems fine\u2014let me give it a try."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1473487786, "post_id": 39419717, "comment_id": 66170611, "body": "The answer to this question lies in the definition of <code>Random</code> which isn&#39;t included in the question. You do not want to <code>hoist runIO</code>, <code>runIO</code> will be invoked many more times than you can possibly imagine resulting in the creation of numerous generators."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1473488259, "post_id": 39419717, "comment_id": 66170695, "body": "@Cirdec: Yeah, good point. I&#39;ll add the definition of <code>Random</code>."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1473523348, "post_id": 39419717, "comment_id": 66179297, "body": "Oh I see the type declaration now. Why not just use <code>type Random m = ReaderT (Gen (PrimState m)) m</code> or something like that, rather than wrapping a rank 2 type?   Then the correct handling with pipes becomes obvious from the pipes API"}], "answers": [{"comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1473797371, "post_id": 39423910, "comment_id": 66275654, "body": "Just got around to implementing this, and I definitely like this solution. Thanks!"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 2, "last_activity_date": 1473493983, "creation_date": 1473493983, "answer_id": 39423910, "question_id": 39419717, "link": "https://stackoverflow.com/questions/39419717/how-can-i-idiomatically-and-efficiently-consume-a-pipe-in-some-non-io-monad-wit/39423910#39423910", "title": "How can I idiomatically and efficiently consume a Pipe in some non-IO monad, with an IO action?", "body": "<p><code>Random</code> is a reader that reads a generator</p>\n\n<pre><code>import Control.Monad.Primitive\nimport System.Random.MWC\n\nnewtype Random a = Random {\n    runRandom :: forall m. PrimMonad m =&gt; Gen (PrimState m) -&gt; m a\n}\n</code></pre>\n\n<p>We can trivially convert a <code>Random a</code> into a <code>ReaderT (Gen (PrimState m)) m a</code>. This <em>trivial</em> operation is the one you want to <code>hoist</code> to turn a <code>Producer ... Random a</code> into a <code>Producer ... IO a</code>.</p>\n\n<pre><code>import Control.Monad.Trans.Reader\n\ntoReader :: PrimMonad m =&gt; Random a -&gt; ReaderT (Gen (PrimState m)) m a\ntoReader = ReaderT . runRandom\n</code></pre>\n\n<p>Since <code>toReader</code> is trivial there won't be any random generation overhead from <code>hoist</code>ing it. This function is written just to demonstrate its type signature.</p>\n\n<pre><code>import Pipes\n\nhoistToReader :: PrimMonad m =&gt; Proxy a a' b b' Random                          r -&gt;\n                                Proxy a a' b b' (ReaderT (Gen (PrimState m)) m) r\nhoistToReader = hoist toReader\n</code></pre>\n\n<p>There are two approaches to take here. The simple approach is to <code>hoist</code> your <code>Consumer</code> into the same monad, compose the pipes together, and run them.</p>\n\n<pre><code>type ReadGenIO = ReaderT GenIO IO\n\ntoReadGenIO :: MFunctor t =&gt; t Random a -&gt; t ReadGenIO a\ntoReadGenIO = hoist toReader\n\nint :: Random Int\nint = Random uniform\n\nints :: Producer Int Random x\nints = forever $ do\n    i &lt;- lift int\n    yield i\n\nsample :: Show a =&gt; Int -&gt; Consumer a IO ()\nsample 0 = return ()\nsample n = do\n    x &lt;- await\n    lift $ print x\n    sample (n-1)\n\nsampleSomeInts :: Effect ReadGenIO ()\nsampleSomeInts = hoist toReader ints &gt;-&gt; hoist lift (sample 1000)\n\nrunReadGenE :: Effect ReadGenIO a -&gt; IO a\nrunReadGenE = withSystemRandom . runReaderT . runEffect\n\nexample :: IO ()\nexample = runReadGenE sampleSomeInts\n</code></pre>\n\n<hr>\n\n<p>There's another set of tools in <code>Pipes.Lift</code> that users of pipes should be aware of. These are the tools for running transformers like your <code>Random</code> monad by distributing it over a <code>Proxy</code>. There are pre-built tools here for running the familiar transformers from the transformers library. They are all built out of <a href=\"http://hackage.haskell.org/package/pipes/docs/Pipes-Lift.html#v:distribute\" rel=\"nofollow\"><code>distribute</code></a>. It turns a <code>Proxy ... (t m) a</code> into a <code>t (Proxy ... m) a</code> which you can run <em>once</em> with whatever tools you use to run a <code>t</code>.</p>\n\n<pre><code>import Pipes.Lift\n\nrunRandomP :: PrimMonad m =&gt; Proxy a a' b b' Random r -&gt;\n                             Gen (PrimState m) -&gt; Proxy a a' b b' m r\nrunRandomP = runReaderT . distribute . hoist toReader\n</code></pre>\n\n<p>You can finish combining the pipes together and use <code>runEffect</code> to get rid of the <code>Proxy</code>s, but you'd be juggling the generator argument yourself as you combine the <code>Proxy ... IO r</code>s together.</p>\n"}], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 39423910, "answer_count": 1, "score": 10, "last_activity_date": 1473493983, "creation_date": 1473455317, "last_edit_date": 1473488546, "question_id": 39419717, "link": "https://stackoverflow.com/questions/39419717/how-can-i-idiomatically-and-efficiently-consume-a-pipe-in-some-non-io-monad-wit", "title": "How can I idiomatically and efficiently consume a Pipe in some non-IO monad, with an IO action?", "body": "<p>I have a <code>Producer</code> that creates values that depend on randomness, using my own <code>Random</code> monad:</p>\n\n<pre><code>policies :: Producer (Policy s a) Random x\n</code></pre>\n\n<p><code>Random</code> is a wrapper over <code>mwc-random</code> that can be run from <code>ST</code> or <code>IO</code>:</p>\n\n<pre><code>newtype Random a =\n  Random (forall m. PrimMonad m =&gt; Gen (PrimState m) -&gt; m a)\n\nrunIO :: Random a -&gt; IO a\nrunIO (Random r) = MWC.withSystemRandom (r @ IO)\n</code></pre>\n\n<p>The <code>policies</code> producer yields better and better policies from a simple reinforcement learning algorithm.</p>\n\n<p>I can efficiently plot the policy after, say, 5,000,000 iterations by indexing into <code>policies</code>:</p>\n\n<pre><code>Just convergedPolicy &lt;- Random.runIO $ Pipes.index 5000000 policies\nplotPolicy convergedPolicy \"policy.svg\"\n</code></pre>\n\n<p>I now want to plot the intermediate policies on every 500,000 steps to see how they converge. I wrote a couple of functions that take the <code>policies</code> producer and extract a list (<code>[Policy s a]</code>) of, say, 10 policies\u2014one every 500,000 iterations\u2014and then plot all of them. </p>\n\n<p>However, these functions take far longer (10x) and use more memory (4x) than just plotting the final policy as above, even though the total number of learning iterations should be the same (ie 5,000,000). I suspect that this is due to extracting a list inhibiting the garbage collector, and this seems to be an unidiomatic use of Pipes:</p>\n\n<blockquote>\n  <p>Idiomatic pipes style consumes the elements immediately as they are generated instead of loading all elements into memory.</p>\n</blockquote>\n\n<p>What's the correct approach to consuming a pipe like this when the <code>Producer</code> is over some random monad (ie <code>Random</code>) and the effect I want to produce is in <code>IO</code>?</p>\n\n<p>Put another way, I want to plug a <code>Producer (Policy s a) Random x</code> into a <code>Consumer (Policy s a) IO x</code>.</p>\n"}, {"tags": ["css", "haskell", "hakyll"], "answers": [{"tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": false, "score": 1, "last_activity_date": 1473456519, "creation_date": 1473456519, "answer_id": 39419959, "question_id": 39419222, "link": "https://stackoverflow.com/questions/39419222/how-to-relativize-urls-in-css-files-in-hakyll/39419959#39419959", "title": "How to relativize URLs in css files in Hakyll?", "body": "<p>Hakyll's <code>relativizeURLs</code> uses <code>TagSoup</code> to parse and pretty-print HTML, so it can only work on URLs found inside HTML attributes. I don't know of any existing functionality to extend this to CSS rather than just HTML attributes.</p>\n\n<p>The relevant code goes through every tag parsed by <code>TagSoup</code> and applies a function to attributes it recognizes as URLs:</p>\n\n<pre><code>-- | Apply a function to each URL on a webpage\nwithUrls :: (String -&gt; String) -&gt; String -&gt; String\nwithUrls f = withTags tag\n  where\n    tag (TS.TagOpen s a) = TS.TagOpen s $ map attr a\n    tag x                = x\n    attr (k, v)          = (k, if isUrlAttribute k then f v else v)\n</code></pre>\n\n<p>(From <a href=\"https://hackage.haskell.org/package/hakyll-4.8.3.2/docs/src/Hakyll-Web-Html.html#withTags\" rel=\"nofollow\"><code>Hakyll.Web.HTML</code></a>)</p>\n\n<p>There's no way to change this traversal logic from the provided <code>relativizeURLs</code> compiler so you'll probably have to write your own. Luckily it's pretty simple: it gets the site root (with <code>toSiteRoot</code>), then uses <code>withURLs</code> to apply a function to every URL that turns absolute paths into relative ones.</p>\n\n<pre><code>relativizeUrls item = do\n    route &lt;- getRoute $ itemIdentifier item\n    return $ case route of\n        Nothing -&gt; item\n        Just r  -&gt; fmap (relativizeUrlsWith $ toSiteRoot r) item\n\nrelativizeUrlsWith root = withUrls rel\n  where\n    isRel x = \"/\" `isPrefixOf` x &amp;&amp; not (\"//\" `isPrefixOf` x)\n    rel x   = if isRel x then root ++ x else x\n</code></pre>\n\n<p>(Excerpts from <a href=\"https://hackage.haskell.org/package/hakyll-4.8.3.2/docs/src/Hakyll-Web-Html-RelativizeUrls.html#relativizeUrls\" rel=\"nofollow\"><code>Hakyll.Web.RelativizeURLs</code></a>).</p>\n\n<p>You'll need to combine this sort of process with a lightweight CSS parser of some sort. It'll look something like this (in pseudocode):</p>\n\n<pre><code>relativizeCssUrls root = renderCSS . fmap relativize . parseCSS\n  where relativize (URL url)\n          | isRel url = URL (root &lt;&gt; url)\n          | otherwise = URL url\n        relativize other = other\n</code></pre>\n\n<p>I haven't used any CSS parsing/printing libraries so I can't give you a good suggestion here, but <a href=\"https://hackage.haskell.org/package/css-text\" rel=\"nofollow\">css-text</a> seems like a decent starting point.</p>\n"}, {"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 1, "last_activity_date": 1473674691, "creation_date": 1473674691, "answer_id": 39447864, "question_id": 39419222, "link": "https://stackoverflow.com/questions/39419222/how-to-relativize-urls-in-css-files-in-hakyll/39447864#39447864", "title": "How to relativize URLs in css files in Hakyll?", "body": "<p>I've gone an easier way. I've used this code to obtain root path relative to a current item:</p>\n\n<pre><code>rootPath :: Compiler String\nrootPath = (toSiteRoot . fromJust) &lt;$&gt; (getUnderlying &gt;&gt;= getRoute)\n</code></pre>\n\n<p>And then created a <code>Context</code> with constant field:</p>\n\n<pre><code>fontCtx = do\n    root &lt;- rootPath\n    return $ constField \"fontRoot\" root\n</code></pre>\n\n<p>Finally, i moved <code>@font-face</code> clause out of a CSS file into HTML one and used my field there:</p>\n\n<pre><code>    &lt;style type=\"text/css\"&gt;\n        @font-face {\n          ...\n          src: url(\"$fontRoot$/data/bla.ttf\") format(\"truetype\");\n        }\n    &lt;/style&gt;\n</code></pre>\n\n<p>That context field turned out to be quite useful in other places, like path strings in Javascript code, which I also use.</p>\n"}, {"tags": [], "owner": {"reputation": 114, "user_id": 6818792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lV3xs.jpg?s=128&g=1", "display_name": "phlummox", "link": "https://stackoverflow.com/users/6818792/phlummox"}, "is_accepted": false, "score": 2, "last_activity_date": 1486892959, "last_edit_date": 1486892959, "creation_date": 1486891546, "answer_id": 42185973, "question_id": 39419222, "link": "https://stackoverflow.com/questions/39419222/how-to-relativize-urls-in-css-files-in-hakyll/42185973#42185973", "title": "How to relativize URLs in css files in Hakyll?", "body": "<p>tl;dr \u2013 You could use Beerend Lauwers's <a href=\"https://github.com/beerendlauwers/hakyll-extra\" rel=\"nofollow noreferrer\"><code>hakyll-extra</code></a> package (doesn't seem to be on <code>hackage</code> yet), which provides a <code>relativizeUrl</code> macro. Or, implement your own as follows:</p>\n\n<p>If you don't have too many links, and don't fancy introducing a CSS parser just in order to do this, you could just create a function field - effectively, a macro -- which allows you to call, e.g. <code>relativize(\"/some/url\")</code> from within the page. (I ran into a similar problem, because I wanted to relativize links to a stylesheet for use only by old versions of Internet Explorer; and to <code>TagSoup</code>, the links looked as if they were within comments, so it didn't process them.)</p>\n\n<p>First, we need to write a version of <code>relativizeUrls</code> which just operates on a single URL:</p>\n\n<pre><code> import Data.List as L\n\n -- | Relativize URL. Same logic as \"relativizeUrlsWith\" in\n -- Hakyll.Web.Html.RelativizeUrls, but for just one url.\n relativizeUrl :: String  -- ^ Path to the site root\n                    -&gt; String  -- ^ link to relativize\n                    -&gt; String  -- ^ Resulting link\n relativizeUrl root = rel\n   where\n     isRel :: String -&gt; Bool\n     isRel x = \"/\" `L.isPrefixOf` x &amp;&amp; not (\"//\" `L.isPrefixOf` x)\n     rel x   = if isRel x then root ++ x else x\n</code></pre>\n\n<p>Then, we define a \"function field\" which can be added to contexts. </p>\n\n<pre><code> import Data.Maybe (maybe)\n\n -- ugh. ugly name.\n relativizeFuncField :: Context a\n relativizeFuncField = functionField \"relativize\" relativize\n   where \n     relativize :: [String] -&gt; Item a -&gt; Compiler String\n     relativize args item = do\n       siteRoot &lt;- getRoot &lt;$&gt; (getRoute $ itemIdentifier item)\n       arg &lt;- case args of \n               [arg] -&gt; return arg\n               _     -&gt; error \"relativize: expected only 1 arg\"\n       return $ relativizeUrl siteRoot arg\n\n     getRoot :: Maybe String -&gt; String\n     getRoot = maybe (error \"relativize: couldn't get route\") toSiteRoot \n</code></pre>\n\n<p>Then, anywhere you want to use this macro, instead of using, say, <code>defaultContext</code>, use <code>relativizeFuncField &lt;&gt; defaultContext</code>. e.g.:</p>\n\n<pre><code> import Data.Monoid( (&lt;&gt;) )\n\n main = \n   -- ... \n\n   match (fromList [\"about.rst\", \"contact.markdown\"]) $ do\n       route   $ setExtension \"html\"\n       compile $ pandocCompiler\n           &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" (relativizeFuncField &lt;&gt; defaultContext)\n           &gt;&gt;= relativizeUrls\n</code></pre>\n\n<p>So, finally, that means that within a file, you can write <code>$relativize(\"/path/to/file\")$</code> in any spot where <code>TagSoup</code> isn't already relativizing links.</p>\n\n<p>Hope that's of use :)<br>\n(This was using Hakyll 4.9.0.0, but I assume other 4.X versions are much the same.) </p>\n\n<p>edited:  p.s., many thanks to Beerend Lauwers, who explained Hakyll function fields in his post <a href=\"http://beerendlauwers.be/posts/2015-09-21-hakylls-functionfield.html\" rel=\"nofollow noreferrer\">here</a>  </p>\n\n<p>edited again: d'oh. I didn't see that Beerend has actually already put a <code>relativizeUrl</code> function in his <code>hakyll-extra</code> package.</p>\n"}], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 0, "accepted_answer_id": 39447864, "answer_count": 3, "score": 3, "last_activity_date": 1486892959, "creation_date": 1473452722, "last_edit_date": 1473472356, "question_id": 39419222, "link": "https://stackoverflow.com/questions/39419222/how-to-relativize-urls-in-css-files-in-hakyll", "title": "How to relativize URLs in css files in Hakyll?", "body": "<p>In my Hakyll site I have a stylesheet linked into the page:</p>\n\n<pre><code>&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"/css/my.css\"&gt;\n</code></pre>\n\n<p>This CSS contains a <code>@font-face</code> directive linking to a font file:</p>\n\n<pre><code>@font-face {\n font-family: \"Bla\";\n src: url(\"/data/bla.ttf\") format(\"truetype\");\n}\n</code></pre>\n\n<p>The problem is that font's URL doesn't get relativized by <code>relativizeUrls</code> even if I move it into a <code>&lt;script&gt;</code> tag inside the page itself. How to solve this problem?</p>\n"}, {"tags": ["haskell", "type-conversion", "haskell-lens", "isomorphism"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1473452765, "post_id": 39417445, "comment_id": 66163491, "body": "It&#39;s too bad the new <code>Data.Coerce</code> isn&#39;t very useful for this."}], "answers": [{"comments": [{"owner": {"reputation": 15620, "user_id": 596361, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b7219254970581e53d3b2b162f7f50f8?s=128&d=identicon&r=PG", "display_name": "Mirzhan Irkegulov", "link": "https://stackoverflow.com/users/596361/mirzhan-irkegulov"}, "edited": false, "score": 0, "creation_date": 1473529485, "post_id": 39419215, "comment_id": 66181183, "body": "Thanks a lot, this is great! One question: what if I want to generalize from concrete type X to any type that can be seen as &quot;canonical&quot; (i.e. <code>(Int, String, Char)</code> is canonical, but <code>(() -&gt; ()) -&gt; (Int, String, Char)</code> isn&#39;t)? I don&#39;t just work with X, but with arbitrary types, including arbitrary tuples."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15620, "user_id": 596361, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b7219254970581e53d3b2b162f7f50f8?s=128&d=identicon&r=PG", "display_name": "Mirzhan Irkegulov", "link": "https://stackoverflow.com/users/596361/mirzhan-irkegulov"}, "edited": false, "score": 0, "creation_date": 1473529569, "post_id": 39419215, "comment_id": 66181207, "body": "@MirzhanIrkegulov Thanks for discovering my bug for me. =) You will need base cases for all the types you consider canonical. I don&#39;t really think there&#39;s a way around that, no matter what design you choose."}, {"owner": {"reputation": 15620, "user_id": 596361, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b7219254970581e53d3b2b162f7f50f8?s=128&d=identicon&r=PG", "display_name": "Mirzhan Irkegulov", "link": "https://stackoverflow.com/users/596361/mirzhan-irkegulov"}, "edited": false, "score": 0, "creation_date": 1473536472, "post_id": 39419215, "comment_id": 66183254, "body": "After spending a few hours I&#39;m still confused how to integrate the isomorphism ((),()) \u2245 () into the scheme above. I bump into conflicting family instances one way or another."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15620, "user_id": 596361, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b7219254970581e53d3b2b162f7f50f8?s=128&d=identicon&r=PG", "display_name": "Mirzhan Irkegulov", "link": "https://stackoverflow.com/users/596361/mirzhan-irkegulov"}, "edited": false, "score": 0, "creation_date": 1473543672, "post_id": 39419215, "comment_id": 66184911, "body": "@MirzhanIrkegulov That is slightly unfortunate, yes. Note well the difference between the arrow case -- where we can afford to decide that one side of the arrow is definitely the unit that we plan to throw away, hence we can be polymorphic and stick <code>Unit a</code> in the context -- and the tuple case -- where either side may be unit, and so the two instances I defined must be monomorphic. I&#39;m not sure exactly what to do about this; the best thing I can think of requires a fair bit of type-level computation that is going to be a heavy hammer for such a thin nail."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 11, "last_activity_date": 1473528881, "last_edit_date": 1473528881, "creation_date": 1473452706, "answer_id": 39419215, "question_id": 39417445, "link": "https://stackoverflow.com/questions/39417445/isomorphisms-between-3-and-more-types-using-lens/39419215#39419215", "title": "Isomorphisms between 3 and more types using lens", "body": "<p>You can structure your isomorphisms as a star graph: have a canonical \"hub\" type to which all others connect. The downside is that you will have to specify the hub explicitly in each instance, and you will only be able to convert between types which share a hub. However your two requirements (good type inference, and a linear number of instances) will be met. Here's how you would do that:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\nimport Control.Lens\nimport Unsafe.Coerce\n\ndata AB = A | B deriving (Show)\ndata CD = C | D deriving (Show)\ndata EF = E | F deriving (Show)\n\nclass Isomorphic a where\n    type Hub a\n    convert :: Iso' a (Hub a)\n\nviaHub :: (Isomorphic a, Isomorphic b, Hub a ~ Hub b) =&gt; a -&gt; b\nviaHub x = x ^. convert . from convert\n\ninstance Isomorphic AB where\n    type Hub AB = AB\n    convert = id\n\ninstance Isomorphic CD where\n    type Hub CD = AB\n    convert = unsafeCoerce -- because I'm too lazy to do it right\n\ninstance Isomorphic EF where\n    type Hub EF = AB\n    convert = unsafeCoerce\n</code></pre>\n\n<p>In ghci:</p>\n\n<pre><code>&gt; viaHub A :: EF\nE\n&gt; viaHub A :: CD\nC\n&gt; viaHub E :: AB\nA\n&gt; viaHub E :: CD\nC\n</code></pre>\n\n<p>Here's how you might use this for your examples:</p>\n\n<pre><code>class Unit a where unit :: a\ninstance Unit () where unit = ()\ninstance Unit b =&gt; Unit (a -&gt; b) where unit _ = unit\n\ninstance Isomorphic X where\n    type Hub X = X\n    convert = id\n\ninstance (Unit a, Isomorphic b) =&gt; Isomorphic (a -&gt; b) where\n    type Hub (a -&gt; b) = Hub b\n    convert = iso ($unit) const . convert\n\ninstance Isomorphic a =&gt; Isomorphic ((), a) where\n    type Hub ((), a) = Hub a\n    convert = iso snd ((,)()) . convert\n\ninstance Isomorphic a =&gt; Isomorphic (a, ()) where\n    type Hub (a, ()) = Hub a\n    convert = iso fst (flip(,)()) . convert\n</code></pre>\n\n<p>Now you will have, e.g.</p>\n\n<pre><code>viaHub :: (() -&gt; (() -&gt; ()) -&gt; X) -&gt; ((), X)\n</code></pre>\n"}], "owner": {"reputation": 15620, "user_id": 596361, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b7219254970581e53d3b2b162f7f50f8?s=128&d=identicon&r=PG", "display_name": "Mirzhan Irkegulov", "link": "https://stackoverflow.com/users/596361/mirzhan-irkegulov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 1, "answer_count": 1, "score": 10, "last_activity_date": 1473528881, "creation_date": 1473444666, "last_edit_date": 1495540098, "question_id": 39417445, "link": "https://stackoverflow.com/questions/39417445/isomorphisms-between-3-and-more-types-using-lens", "title": "Isomorphisms between 3 and more types using lens", "body": "<p>Inspired by <a href=\"https://stackoverflow.com/q/25192250/596361\">a question on polymorphic function between ADTs</a> I'm trying to create isomorphisms between multiple (not just 2) types, so that every time I need an isomorphic but not the same type, I can sprinkle my code with some <code>convert</code>.</p>\n\n<p>Suppose I have 3 ADTs:</p>\n\n<pre><code>data AB = A | B deriving (Show)\ndata CD = C | D deriving (Show)\ndata EF = E | F deriving (Show)\n</code></pre>\n\n<p>Using <a href=\"http://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\"><code>lens</code></a> I can implement 2 isomorphisms between AB and CD, and CD and EF:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\nclass Isomorphic a b where\n  convert :: Iso' a b\n\ninstance Isomorphic AB CD where\n  convert = iso ab2cd cd2ab\n    where ab2cd A = C\n          ab2cd B = D\n          cd2ab C = A\n          cd2ab D = B\n\ninstance Isomorphic AB EF where\n  convert = iso ab2ef ef2ab\n    where ab2ef A = E\n          ab2ef B = F\n          ef2ab E = A\n          ef2ab F = B\n</code></pre>\n\n<p>Converting <code>A</code> to <code>E</code> is easy: <code>A^.convert :: EF</code>. Converting <code>D</code> to <code>B</code> is also easy: <code>D^.from convert :: AB</code>. But if I want to convert from <code>C</code> to <code>E</code> via <code>A</code>, I have to annotate types for every intermediary conversion:</p>\n\n<pre><code>(C^.from convert :: AB)^.convert :: EF\n</code></pre>\n\n<p>I understand why compiler can't infer intermediate types. It could be that there are several isomorphisms through which one could get from <code>C</code> to <code>E</code>. But can I simplify my code so I don't manually annotate types everywhere?</p>\n\n<p>I could just write yet another instance to convert directly between <code>CD</code> and <code>EF</code>, but what if I have more than 3 types? If I had 5 isomorphic types, I would have to specify 10 instances, because the number of isos between isomorphic objects is a number of edges in a complete graph, which is a <a href=\"http://oeis.org/A000217\" rel=\"nofollow noreferrer\">triangular number</a>. I'd rather specify <code>n-1</code> instances, with a trade-off that I write more <code>convert</code> or <code>from convert</code>.</p>\n\n<p>Is there an idiomatic way to establish isomorphisms between multiple types using <a href=\"http://hackage.haskell.org/package/lens/docs/Control-Lens-Iso.html\" rel=\"nofollow noreferrer\"><code>Iso</code></a> from <code>lens</code> so that there is least amount of boilerplate and I don't have to type-annotate everything? If I have to use TemplateHaskell for that, how do I do that?</p>\n\n<p>The motivation is that in my work I have many ridiculously complicated but stupid types, where <code>() -&gt; (() -&gt; ()) -&gt; X</code> and <code>((), X)</code> are isomorphic to <code>X</code>. I have to manually wrap and unwrap everything and I would like some polymorphic way to reduce the complicated types to simpler isomorphic types.</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1473444498, "post_id": 39417334, "comment_id": 66159579, "body": "Why are you including the string <code>&lt;br &#47;&gt;</code>?  That&#39;s just some junk HTML tags and not part of any command."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1473445174, "post_id": 39417334, "comment_id": 66159905, "body": "If you execute <code>cabal install</code> without specifying the name of a package then it assumes your local directory contains a package and the matching <code>packagename.cabal</code> file.  What are you trying to do exactly?"}, {"owner": {"reputation": 254, "user_id": 4584564, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/70e8ff0ff315ab12cdf23e8c1ccdc03f?s=128&d=identicon&r=PG&f=1", "display_name": "Marcus Lagerstedt", "link": "https://stackoverflow.com/users/4584564/marcus-lagerstedt"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1473445699, "post_id": 39417334, "comment_id": 66160173, "body": "Wanted to run cabal update cabal install, maybe i got the wrong idea ?  I&#39;m about to install agda to atom and it dosen&#39;t work completly so i went back to check that i got everything installed and updated"}], "answers": [{"comments": [{"owner": {"reputation": 254, "user_id": 4584564, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/70e8ff0ff315ab12cdf23e8c1ccdc03f?s=128&d=identicon&r=PG&f=1", "display_name": "Marcus Lagerstedt", "link": "https://stackoverflow.com/users/4584564/marcus-lagerstedt"}, "edited": false, "score": 0, "creation_date": 1473576813, "post_id": 39417731, "comment_id": 66190044, "body": "this work but i had to use the uninstall haskell first (i ran the uninstall.hs file)"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 1, "last_activity_date": 1473445810, "creation_date": 1473445810, "answer_id": 39417731, "question_id": 39417334, "link": "https://stackoverflow.com/questions/39417334/cabal-install-command-gives-error/39417731#39417731", "title": "Cabal install command Gives error", "body": "<p>You seem to be wanting to install a particular package, namely <code>agda</code>.  The command <code>cabal install</code> takes either the name of a package or assumes you are installing some package in the local directory.  You are hitting this second case.</p>\n\n<p>To install agda try:</p>\n\n<pre><code>cabal update\ncabal install agda\n</code></pre>\n"}], "owner": {"reputation": 254, "user_id": 4584564, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/70e8ff0ff315ab12cdf23e8c1ccdc03f?s=128&d=identicon&r=PG&f=1", "display_name": "Marcus Lagerstedt", "link": "https://stackoverflow.com/users/4584564/marcus-lagerstedt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 39417731, "answer_count": 1, "score": 1, "last_activity_date": 1473445810, "creation_date": 1473444242, "last_edit_date": 1473445086, "question_id": 39417334, "link": "https://stackoverflow.com/questions/39417334/cabal-install-command-gives-error", "title": "Cabal install command Gives error", "body": "<p>I can't understand why it just dosen't work. My question is what might have gone wrong i have created the ~/.bash_profile and tried to add the PATH given by the haskell webpage.</p>\n\n<p>When i preform cabal install i get this output:</p>\n\n<pre><code>Marcuss-MacBook-Pro:~ marcuslagerstedt$ cabal install\ncabal: Error reading local package.\nCouldn't find .cabal file in: .\nMarcuss-MacBook-Pro:~ marcuslagerstedt$\n</code></pre>\n\n<p>I hope i did a correct question. <br />\nBut i really need help aswell.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1473442190, "post_id": 39416566, "comment_id": 66158447, "body": "Maybe this is an example, but your <code>DataSubject</code> type doesn&#39;t make much sense to me. What is the difference between a <code>DSInformation</code> and <code>DSConstruct</code> and why are they constructors of the same type? Why doesn&#39;t simply <code>DSConstruct</code> suffice instead of  <code>makeDataSubject</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 1, "last_activity_date": 1473441905, "creation_date": 1473441905, "answer_id": 39416808, "question_id": 39416566, "link": "https://stackoverflow.com/questions/39416566/haskells-data-types-and-constructors-with-functions/39416808#39416808", "title": "Haskells data types and constructors with functions?", "body": "<p>Unfortunately you are running into one of Haskell's weaknesses: the record system. It would be nice if we had some sort notation to express <code>subject.name</code> and <code>subject.age</code> rather than destructuring explicitly but right now there is no good answer. Work coming down the pipeline in GHC 8 should address the problem soon, however, and there are are all sorts of libraries working in the problem space. But, for this question specifically, we can employ a simple trick: <code>-XRecordWildcards</code>.</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\n\nmodule Main where\n\nnewtype Name = Name String deriving Show\nnewtype Age = Age Int deriving Show\nnewtype Iq = Iq Int deriving Show\nnewtype Language = Language String deriving Show\n\ndata DataSubject =\n    DSInformation Name Age Iq Language\n  | DSConstruct {name :: String, age :: Int, iq :: Int, language :: String}\n  deriving Show\n\n-- | Take in info and output a record\nmakeDataSubject :: DataSubject -&gt; DataSubject\nmakeDataSubject (DSInformation (Name name) (Age age) (Iq iq) (Language language)) =\n  DSConstruct {..}\n\nmain :: IO ()\nmain =\n  print . makeDataSubject $ DSInformation (Name \"Ron\") (Age 34) (Iq 100) (Language \"French\")\n</code></pre>\n\n\n\n<p>By destructuring into the names of the fields, <code>{..}</code> will pick up on those bindings in scope to automatically populate the fields. You will <em>absolutely</em> want to turn on <code>-Wall -Werror</code> during compilation because it will be now more than ever easier to misspell something and forget to populate a field and then you end up with a partial record (another wart of the records system) where some fields are left <code>undefined</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1473442967, "last_edit_date": 1473442967, "creation_date": 1473442150, "answer_id": 39416876, "question_id": 39416566, "link": "https://stackoverflow.com/questions/39416566/haskells-data-types-and-constructors-with-functions/39416876#39416876", "title": "Haskells data types and constructors with functions?", "body": "<p>Most of your <code>data</code> declarations can probably be simple <code>type</code> aliases.</p>\n\n<pre><code>type Name = String\ntype Age = Int\ntype Iq = Int\ntype Language = String\n</code></pre>\n\n<p>With these aliases, there is no significant difference (record syntax aside) between the two constructors for <code>DataSubject</code>. Get rid of one, and dispense with <code>makeDataSubject</code>. (Unless you want to encapsulate some logic or prevent pattern matching, you don't need a smart constructor to do what you are doing.)</p>\n\n<pre><code>data DataSubject = DS { name :: Name\n                      , age :: Age\n                      , iq :: Iq\n                      , language :: Language\n                   } deriving (Show)\n\nmain = do \n        let x = DS { name=\"Ron\", age=34, iq=100, language=\"French\"}\n        putStrLn $ show x\n</code></pre>\n\n<p>If you do want real types, not just aliases, use <code>newtype</code> instead of <code>data</code>.</p>\n\n<pre><code>newtype Name = Name String deriving Show\nnewtype Age = Age Int deriving Show\nnewtype Iq = Iq Int deriving Show\nnewtype Language = Language String deriving Show\n\ndata DataSubject = DS { name :: Name\n                      , age :: Age\n                      , iq :: Iq\n                      , language :: Language\n                      } deriving (Show)\n\nmain = do\n         let x = DS { name=Name \"Ron\", age=Age 34, iq=Iq 100, language=Language \"French\"}\n         putStrLn $ show x\n</code></pre>\n\n<p>You might want to add a smart constructor here, but have it take each piece of data as a separate argument (wrapped or unwrapped), not a single argument that is already the return value up to isomorphism. (That is, your constructor was essentially the identity function other than some repackaging of the input.)</p>\n\n<pre><code>makeDataSubject :: String -&gt; Int -&gt; Int -&gt; String -&gt; DataSubject\nmakeDataSubject name age iq lang = DS {name=Name name, age=Age age, iq=Iq iq, language=Language lang}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>makeDataSubject' :: Name -&gt; Age -&gt; Iq -&gt; Language -&gt; DataSubject\nmakeDataSubject' name age iq lang = DS {name=name, age=age, iq=iq, language=lang}\n</code></pre>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 39416876, "answer_count": 2, "score": 0, "last_activity_date": 1473445413, "creation_date": 1473440877, "last_edit_date": 1473445413, "question_id": 39416566, "link": "https://stackoverflow.com/questions/39416566/haskells-data-types-and-constructors-with-functions", "title": "Haskells data types and constructors with functions?", "body": "<p>I'm new to Haskell and I'm looking at basic data types and constructors with functions. </p>\n\n<p>I've done the below code:</p>\n\n<pre><code>data Name = Name String deriving (Show)\ndata Age = Age Int deriving (Show)\ndata Iq = Iq Int deriving (Show)\ndata Language = Language String deriving (Show)\ndata DataSubject = DSInformation Name Age Iq Language | DSConstruct {name :: String, age :: Int, iq :: Int, language :: String} deriving (Show)\n\nmakeDataSubject :: DataSubject -&gt; DataSubject --Take in info and output a record\nmakeDataSubject (DSInformation (Name n) (Age a) (Iq i) (Language l)) = (DSConstruct {name = n, age = a, iq = i, language = l})\n\nmain = do \n  let x = makeDataSubject $ (DSInformation (Name \"Ron\") (Age 34) (Iq 100) (Language \"French\"))\n  putStrLn $ show x\n</code></pre>\n\n<p>Runs fine, however it seems overly verbose -- how can I make to make it better? </p>\n"}, {"tags": ["haskell", "yesod", "yesod-forms"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1473433802, "post_id": 39414386, "comment_id": 66153840, "body": "hint: <code>check</code> and <code>checkM</code> both have type <code>... -&gt; Field m a -&gt; Field m a</code>"}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1473433958, "post_id": 39414386, "comment_id": 66153932, "body": "Indeed, I have noticed it - but I still don&#39;t know how to do it ;)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1473434119, "post_id": 39414386, "comment_id": 66154006, "body": "<code>check f . checkM g</code> and <code>checkM g . check f</code> are both valid (type-checking) expressions."}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1473435264, "post_id": 39414386, "comment_id": 66154764, "body": "So simple, wow I feel embarrassed ;) I&#39;ll add the answer, and credit you. Now I wonder - if the first check fails, does it stop there, or it continues to the next one?"}], "answers": [{"tags": [], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "is_accepted": false, "score": 0, "last_activity_date": 1473435456, "last_edit_date": 1495540302, "creation_date": 1473435456, "answer_id": 39415177, "question_id": 39414386, "link": "https://stackoverflow.com/questions/39414386/compose-form-validations/39415177#39415177", "title": "Compose form validations", "body": "<p>As answered by @user2407038 in this <a href=\"https://stackoverflow.com/questions/39414386/compose-form-validations#comment66154006_39414386\">comment</a> , the answer in my case is</p>\n\n<pre><code>&lt;$&gt; areq priceField \"Price\" Nothing\nwhere priceField = (check validateMinimumPrice . checkM validateMinimumPriceInHandler) intField\n</code></pre>\n\n<p>I have updated the <a href=\"https://gist.github.com/amitaibu/65eda8b717a23f9d79e7ef94ba43d774#file-item-fixed-hs\" rel=\"nofollow noreferrer\">gist</a> with the working solution</p>\n"}], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1473435456, "creation_date": 1473432762, "last_edit_date": 1473435319, "question_id": 39414386, "link": "https://stackoverflow.com/questions/39414386/compose-form-validations", "title": "Compose form validations", "body": "<p>I have several validation I'd like to add on the same input field. For example, a price field should not be less than 0 (<a href=\"https://www.stackage.org/haddock/lts-6.16/yesod-form-1.4.7.1/Yesod-Form-Functions.html#v:check\" rel=\"nofollow\">check</a>), and another that will query the DB (<a href=\"https://www.stackage.org/haddock/lts-6.16/yesod-form-1.4.7.1/Yesod-Form-Functions.html#v:checkM\" rel=\"nofollow\">checkM</a>)</p>\n\n<pre><code>    &lt;$&gt; areq priceField \"Price\" Nothing\n    where priceField = check validateMinimumPrice intField\n\n    &lt;$&gt; areq priceField \"Price\" Nothing    \n    where priceField = checkM validatePriceFromDb intField\n</code></pre>\n\n<p>So I know how to add a single validation each time, but how can I compose those validation functions together?</p>\n\n<p>Here's a <a href=\"https://gist.github.com/amitaibu/65eda8b717a23f9d79e7ef94ba43d774#file-item-hs\" rel=\"nofollow\">gist</a> with a simplified working form.</p>\n"}, {"tags": ["haskell", "printing", "io"], "comments": [{"owner": {"reputation": 42370, "user_id": 3980929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xyKrD.png?s=128&g=1", "display_name": "Rakete1111", "link": "https://stackoverflow.com/users/3980929/rakete1111"}, "edited": false, "score": 1, "creation_date": 1473431864, "post_id": 39414079, "comment_id": 66152517, "body": "Is your command line buffered?"}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "reply_to_user": {"reputation": 42370, "user_id": 3980929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xyKrD.png?s=128&g=1", "display_name": "Rakete1111", "link": "https://stackoverflow.com/users/3980929/rakete1111"}, "edited": false, "score": 0, "creation_date": 1473431934, "post_id": 39414079, "comment_id": 66152574, "body": "@Rakete1111 I am not sure, how do I figure out if it is, what does it mean for a command line to be buffered?"}, {"owner": {"reputation": 42370, "user_id": 3980929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xyKrD.png?s=128&g=1", "display_name": "Rakete1111", "link": "https://stackoverflow.com/users/3980929/rakete1111"}, "edited": false, "score": 0, "creation_date": 1473432001, "post_id": 39414079, "comment_id": 66152616, "body": "Well, some command lines flush the stream when they see a newline. Some don&#39;t (CMD). You&#39;ll have to flush the stream manually: <a href=\"http://stackoverflow.com/questions/12435794/putstrln-doesnt-print-to-console\" title=\"putstrln doesnt print to console\">stackoverflow.com/questions/12435794/&hellip;</a>"}, {"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1473432259, "post_id": 39414079, "comment_id": 66152794, "body": "Add this <code>hGetBuffering stdout &gt;&gt;= print</code> to your code and report back the what it prints."}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 0, "creation_date": 1473432536, "post_id": 39414079, "comment_id": 66152987, "body": "it returns LineBuffering"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1473432723, "post_id": 39414079, "comment_id": 66153110, "body": "Failing to flush the stream shouldn&#39;t discard unflushed output, though."}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1473432726, "post_id": 39414079, "comment_id": 66153113, "body": "Comment out the <code>putStrLn (show ((fst.head) c))</code>. Does anything get printed?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1473432916, "post_id": 39414079, "comment_id": 66153225, "body": "There&#39;s no way we can attempt to reproduce this, because we dno&#39;t know what <code>parse parseProgram</code> is."}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "reply_to_user": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1473433682, "post_id": 39414079, "comment_id": 66153747, "body": "@Lynn When I comment out the last putStrLn the first three do get printed"}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1473433750, "post_id": 39414079, "comment_id": 66153800, "body": "Are you sure the first three lines aren\u2019t just scrolling off your screen? :)"}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473433774, "post_id": 39414079, "comment_id": 66153817, "body": "@chepner parseProgram returns a list of tuples of the form [(a, String)] where  the first component of the tuple is the AST generated and the second component is the unconsumed input. I have created a bunch of show instances for the AST types to produce something more readable."}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "reply_to_user": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1473433890, "post_id": 39414079, "comment_id": 66153891, "body": "@Lynn I scrolled up to check, the weird thing is that it does not print those three lines but prior to those three lines I have calls to traceM in my parser and it prints the output of those and then it completely skips those 3 lines and prints out the AST"}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1473434356, "post_id": 39414079, "comment_id": 66154170, "body": "How strange. Try <code>hFlush stdout</code> after the three lines. Does that help?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 1, "creation_date": 1473434477, "post_id": 39414079, "comment_id": 66154252, "body": "@Zubair Did you scroll all the way up to the prompt? Note that your trace messages wouldn&#39;t appear before the banner, but either directly before the parse result or intermingled with it."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473434645, "post_id": 39414079, "comment_id": 66154381, "body": "What happens if you replace the last <code>putStrLn</code> with a hard-coded output like <code>putStrLn &quot;parsed output&quot;</code>? I&#39;m wondering about the contents produce by parsing the file contents and ultimately the file content itself."}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "reply_to_user": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1473434916, "post_id": 39414079, "comment_id": 66154550, "body": "@Lynn adding hFlush stdout did not resolve the issue :("}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473434935, "post_id": 39414079, "comment_id": 66154561, "body": "@chepner When i replace it with hardcoded output, it does print, that is weird so is it do with the file, I extract the contents prior to any printing and run the contents through the parser first"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473434988, "post_id": 39414079, "comment_id": 66154597, "body": "And finally, what happens if you parse the contents <i>after</i> the first three <code>putStrLn</code>?"}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473435094, "post_id": 39414079, "comment_id": 66154668, "body": "@chepner it prints everything, but the issue now is that it prints the three lines then runs through the parser printing all the trace messages and then it prints the AST"}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1473435194, "post_id": 39414079, "comment_id": 66154718, "body": "@sepp2k makes a very good point! Scroll up <b>past</b> the <code>traceM</code> lines. Things are not being printed in the order you think."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473435257, "post_id": 39414079, "comment_id": 66154760, "body": "The trace lines aren&#39;t being executed until you actually force <code>c</code> to be evaluated by calling <code>fst . head</code> on <code>c</code>. They are interfering with standard output somehow."}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 0, "creation_date": 1473435407, "post_id": 39414079, "comment_id": 66154846, "body": "Ahh yes, you guys are right. With the original order of statements, the banner is being printed right at the top of the prompt before the traceM messages. I am guessing the parsing is actually only happening in the <code>(fst.head)</code> call when it is actually forced to return, so I am guessing having that <code>fst.head</code> call before the put statements should resolve my issues."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1473435589, "post_id": 39414079, "comment_id": 66154964, "body": "This is why a <i>reproducible</i> question is essential. The root problem was your definition of <code>parseProgram</code> (I assume that&#39;s where the traces appeared)."}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "edited": false, "score": 0, "creation_date": 1473435589, "post_id": 39414079, "comment_id": 66154965, "body": "Actually no it doesn&#39;t, for some reason it&#39;s not actually parsing (evaluating) until I call show to get back the string rep of the AST"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1473435627, "post_id": 39414079, "comment_id": 66154991, "body": "@Zubair If you need your messages to appear in a specific order, you should not use <code>trace</code> or <code>traceM</code> to print them."}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473435636, "post_id": 39414079, "comment_id": 66154998, "body": "@chepner ah yes, noted next time I will take that in to account before I post a question"}, {"owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1473435783, "post_id": 39414079, "comment_id": 66155107, "body": "@sepp2k the messages that are getting printed by trace &amp; traceM are debugging messages which are created when parsing (i wish there was a way to turn trace of). Is there a way to get the messages to be printed in a specific order, I am trying to force the expression to evaluate but i cannot"}], "answers": [{"tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": true, "score": 3, "last_activity_date": 1473503527, "last_edit_date": 1473503527, "creation_date": 1473438636, "answer_id": 39416003, "question_id": 39414079, "link": "https://stackoverflow.com/questions/39414079/haskell-putstrln-multiple-calls-not-printing/39416003#39416003", "title": "Haskell - putStrLn multiple calls not printing", "body": "<p>This doesn't appear possible. I created a more minimal example following as closely as possible to your code. I used Parsec because I am not sure what parsing library you are using.</p>\n\n<p>Contents of <code>parsec-trivial.hs</code>:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack\n    --resolver lts-6.15\n    --install-ghc\n    runghc\n    --package parsec\n-}\n\nimport System.Environment\nimport Text.ParserCombinators.Parsec\nimport Text.ParserCombinators.Parsec.Char\n\nws = many space\n\nnat :: Parser Integer\nnat = read &lt;$&gt; many digit\n\nparseProgram = ws *&gt; nat &lt;* ws &lt;* eof\n\nmain = do\n  args &lt;- getArgs\n  let filename = head args\n  contents &lt;- readFile filename\n  let c = parse parseProgram filename contents\n  putStrLn \"------------------------------------------------\"\n  putStrLn \"THE PROGRAM WE HAVE PARSED\"\n  putStrLn \"------------------------------------------------\"\n  putStrLn $ show c\n</code></pre>\n\n<p>Contents of <code>foo.b</code>:</p>\n\n<pre><code>42\n</code></pre>\n\n<p>Executing this program goes like this:</p>\n\n<pre><code>$ ./parsec-trivial.hs foo.b\n------------------------------------------------\nTHE PROGRAM WE HAVE PARSED\n------------------------------------------------\nRight 42\n</code></pre>\n"}], "owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 489, "favorite_count": 0, "accepted_answer_id": 39416003, "answer_count": 1, "score": -1, "last_activity_date": 1473503527, "creation_date": 1473431806, "last_edit_date": 1473431881, "question_id": 39414079, "link": "https://stackoverflow.com/questions/39414079/haskell-putstrln-multiple-calls-not-printing", "title": "Haskell - putStrLn multiple calls not printing", "body": "<p>Hi so I have this main method which runs a parser,</p>\n\n<pre><code>main = do\n  args &lt;- getArgs\n  let filename = head args\n  contents &lt;- readFile filename\n  let c = parse parseProgram contents\n  putStrLn \"------------------------------------------------\"\n  putStrLn \"THE PROGRAM WE HAVE PARSED\"\n  putStrLn \"------------------------------------------------\"\n  putStrLn (show ((fst.head) c))\n  return ()\n</code></pre>\n\n<p>when I run this program the first three calls to putStrLn are not printed to the terminal, it only shows the parsed program.</p>\n\n<p>any help will be appreciated, how do I get all the calls to print?</p>\n"}, {"tags": ["haskell", "stackage"], "answers": [{"comments": [{"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1473432985, "post_id": 39414183, "comment_id": 66153279, "body": "I see, thanks. I tried to bump the version of base instead and it seems to work."}], "tags": [], "owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "is_accepted": true, "score": 1, "last_activity_date": 1473432097, "creation_date": 1473432097, "answer_id": 39414183, "question_id": 39414031, "link": "https://stackoverflow.com/questions/39414031/finding-stackage-lts-with-right-version-of-base/39414183#39414183", "title": "Finding Stackage LTS with right version of base", "body": "<p>The major version of base is closely linked to the version of ghc (as you can see on <a href=\"https://wiki.haskell.org/Base_package\" rel=\"nofollow\">this wiki page</a>). Since the ghc version only changes on a major version change of LTS, you could always look at each major version and see if one matches (there is on 6).</p>\n\n<p>However, I think you are out of luck, since the first version of stackage, <a href=\"https://www.stackage.org/lts-1.0\" rel=\"nofollow\"><code>lts-1.0</code></a>, has <code>ghc-7.8.4</code> and <code>base-4.7.0.2</code>, you won't find any LTS for <code>base-4.5</code> on stackage.</p>\n"}], "owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 39414183, "answer_count": 1, "score": 1, "last_activity_date": 1473432097, "creation_date": 1473431648, "question_id": 39414031, "link": "https://stackoverflow.com/questions/39414031/finding-stackage-lts-with-right-version-of-base", "title": "Finding Stackage LTS with right version of base", "body": "<p>What is the easiest way of finding an LTS on <a href=\"https://www.stackage.org/\" rel=\"nofollow\">Stackage</a> with the right version of some particular package (in my case <code>base-4.5.*</code>).</p>\n\n<p>As of now I've had to resort to finding the right resolver by trial and error, which is cumbersome to say the least.</p>\n\n<p>I've tried searching on Google and the Stackage FAQ, but came up empty-handed.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1473423871, "post_id": 39411164, "comment_id": 66147239, "body": "Short of various unsafe &quot;escape&quot; functions, you can&#39;t remove the list from the IO monad to return an <code>Example [a]</code>. The reason there is no <code>IoT</code> transformer is because the IO monad, if used, must be at the base of the stack, meaning the outer most monad of any stack is <code>IO</code>."}, {"owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473424773, "post_id": 39411164, "comment_id": 66147818, "body": "so then how is this kind of situation generally handled?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1473425537, "post_id": 39411164, "comment_id": 66148281, "body": "A monad transformer is primarily about adding behavior to an existing monad, not extracting values from it. If <code>foo</code> returns an <code>IO (Example [a])</code> (as @user2297560 beat me to suggesting), then it is relatively easy to write a function with type <code>bar :: Example [a] -&gt; IO [a]</code> to retrieve the inner list (while keeping it in an IO context). With such a function, you can then write <code>foo &gt;&gt;= bar</code>."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473427109, "post_id": 39412007, "comment_id": 66149294, "body": "Note that <code>Example</code> needs a <code>Traversable</code> instance in order for <code>sequence</code> to turn the <code>Example (IO [a])</code> value into a <code>IO (Example [a])</code> value."}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 2, "last_activity_date": 1473425354, "creation_date": 1473425354, "answer_id": 39412007, "question_id": 39411164, "link": "https://stackoverflow.com/questions/39411164/how-to-apply-a-custom-monad-transformer/39412007#39412007", "title": "How to apply a custom Monad Transformer", "body": "<p>You can never safely \"escape\" from <code>IO</code>, but if you have a value of a type like <code>Example (IO [a])</code> and <code>Example</code> is at least a <code>Traversable</code>, then you can turn it into <code>IO (Example [a])</code> with the <code>sequence</code> function. Using this method you could write your <code>foo</code> function as:</p>\n\n<pre><code>foo :: b -&gt; IO (Example [a])\nfoo = sequence . return . basicIoWrap . fetchList\n</code></pre>\n\n<p>Since you must already be working in the <code>IO</code> monad in order to use <code>basicIoWrap</code>, you can access the <code>Example [a]</code>. For example:</p>\n\n<pre><code>do input &lt;- getLine\n   (Example as) &lt;- foo input\n   mapM_ print as\n</code></pre>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1473428835, "creation_date": 1473422592, "last_edit_date": 1473426678, "question_id": 39411164, "link": "https://stackoverflow.com/questions/39411164/how-to-apply-a-custom-monad-transformer", "title": "How to apply a custom Monad Transformer", "body": "<p>Say I have some Monadic type</p>\n\n<pre><code>data Example a = CheckIt {unwrap :: a}\n\ninstance Functor Example where\n  fmap f (CheckIt x) = CheckIt (f x)\n\ninstance Applicative Example where\n  pure = CheckIt\n  CheckIt f &lt;*&gt; CheckIt x = CheckIt (f x)\n\ninstance Monad (Example) where\n  return = CheckIt\n  e@(CheckIt a) &gt;&gt;= f = f a\n</code></pre>\n\n<p>and I have a function which returns an <code>[a]</code> based on some input:</p>\n\n<pre><code>fetchList :: b -&gt; [Int]\nfetchList _ = [1,2,3,4]\n</code></pre>\n\n<p>and a function that returns an IO [a] (simplified from real implementation):</p>\n\n<pre><code>basicIoWrap :: [a] -&gt; IO [a]\nbasicIoWrap x = return x\n</code></pre>\n\n<p>and I wish to run this IO and then extract an Example [a] from it:</p>\n\n<p>The following does not work:</p>\n\n<pre><code> foo :: b -&gt; Example [a]\n foo val = (basicIoWrap (fetchList val)) &gt;&gt;= \\list -&gt; return list\n</code></pre>\n\n<p>complaining about different monad types</p>\n\n<pre><code> Couldn't match type \u2018IO\u2019 with \u2018Example\u2019\n      Expected type: Example [a]\n        Actual type: IO [Int]\n</code></pre>\n\n<p>So I understand that this is exactly the usecase for Monad transformers, but I am really struggling figuring out how to apply them in context. Say I had a transformer:</p>\n\n<pre><code>newtype ExampleT m a = ExampleT {runExampleT :: m (Example a)}\n</code></pre>\n\n<p>and I rephrased my signature to \n   foo :: b -> ExampleT (IO [a])</p>\n\n<p>I am unclear what the function body would then look like, and also, how I would eventually extract an Example [a] from this? Wouldn't <code>runExampleT ExampleT (IO [a])</code> give an <code>IO [Example a]</code>, thus simply punting the multi Monad problem further down the road?</p>\n"}, {"tags": ["function", "haskell", "functional-programming", "composition"], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 2843415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/58ac1c408c45bc187eed4b57b020034b?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/2843415/felix"}, "edited": false, "score": 0, "creation_date": 1473423737, "post_id": 39411207, "comment_id": 66147152, "body": "that actually makes a lot of sense. Thanks so much!"}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 2, "last_activity_date": 1473422733, "creation_date": 1473422733, "answer_id": 39411207, "question_id": 39411128, "link": "https://stackoverflow.com/questions/39411128/haskell-function-composition-methods/39411207#39411207", "title": "Haskell function composition methods", "body": "<p>Function composition using <code>.</code> implies that there will be another parameter to the function. Had you instead written the following, it would work.</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>main = print $ (intercalate \" something \" . reverse . map reverse) list\n</code></pre>\n\n<p>That way, the <code>list</code> value is a parameter to the function composed inside parentheses.</p>\n"}, {"comments": [{"owner": {"reputation": 137, "user_id": 2843415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/58ac1c408c45bc187eed4b57b020034b?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/2843415/felix"}, "edited": false, "score": 0, "creation_date": 1473423790, "post_id": 39411377, "comment_id": 66147185, "body": "Thanks a lot Bergi for your reply, it makes sense now!"}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": false, "score": 3, "last_activity_date": 1473424625, "last_edit_date": 1473424625, "creation_date": 1473423313, "answer_id": 39411377, "question_id": 39411128, "link": "https://stackoverflow.com/questions/39411128/haskell-function-composition-methods/39411377#39411377", "title": "Haskell function composition methods", "body": "<p>The equivalence of function composition goes as follows:</p>\n\n<pre><code>main = print (intercalate \" something \" (reverse (map reverse list)))\nmain = print (intercalate \" something \" ((reverse . map reverse) list))\nmain = print ((intercalate \" something \" . (reverse . map reverse)) list)\nmain = (print . (intercalate \" something \" . (reverse . map reverse))) list\n</code></pre>\n\n<p>or, by dropping the unnecessary parentheses:</p>\n\n<pre><code>main = (print . intercalate \" something \" . reverse . map reverse) list\nmain = print . intercalate \" something \" . reverse . map reverse $ list\n</code></pre>\n\n<p>In your attempt, <code>map reverse list</code> is a single expression, the argument of the infix <code>.</code> operator, which doesn't work - you only can compose the <code>map reverse</code> function, and then apply the whole composed function to the <code>list</code> argument.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1473428170, "last_edit_date": 1473428170, "creation_date": 1473425801, "answer_id": 39412146, "question_id": 39411128, "link": "https://stackoverflow.com/questions/39411128/haskell-function-composition-methods/39412146#39412146", "title": "Haskell function composition methods", "body": "<p>Brackets don't mean function composition. They just mean \u201cgroup this subexpression\u201d. Of course you can <em>use</em> them to make a chain of function compositions: the following defines <code>c</code> as a composition of the functions <code>f</code>, <code>g</code> and <code>h</code></p>\n\n<pre><code>c x = f (g (h x))\n</code></pre>\n\n<p>This could also be written as:</p>\n\n<pre><code>c = f . g . h\n</code></pre>\n\n<p>Thus, you <em>could</em> write</p>\n\n<pre><code>main = print $ c list\n where c = intercalate \" something \" . reverse . map reverse\n</code></pre>\n\n<p>But if you then inline <code>c</code> again, you need to be careful not to mess up the parsing rules: just writing <code>list</code> to the right of that composition chain will not do, because function application binds more tightly than any infix operator (including <code>.</code>, though that is in fact the tightest infix operator). I.e.,</p>\n\n<pre><code>intercalate \" something \" . reverse . map reverse list\n</code></pre>\n\n<p>is actually parsed as</p>\n\n<pre><code>(intercalate \" something \") . (reverse) . (map reverse list)\n</code></pre>\n\n<p>But that's not what you wanted. You need to make sure that <code>list</code> is actually the argument to the entire composition chain, not just its last element; the preferred way to do that is with the <code>$</code> operator:</p>\n\n<pre><code>intercalate \" something \" . reverse . map reverse $ list\n</code></pre>\n\n<p><code>$</code> has the <em>lowest</em> prevedence, thus this is parsed as</p>\n\n<pre><code>((intercalate \" something \") . (reverse) . (map reverse)) (list)\n</code></pre>\n\n<p>Alternatively, you can apply <code>map reverse</code> to <code>list</code> right away \u2013 this by itself isn't wrong, just the result isn't part of the composition chain anymore:</p>\n\n<pre><code>intercalate \" something \" . reverse $ map reverse list\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 2843415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/58ac1c408c45bc187eed4b57b020034b?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/2843415/felix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 292, "favorite_count": 0, "accepted_answer_id": 39412146, "answer_count": 3, "score": 0, "last_activity_date": 1473428170, "creation_date": 1473422477, "question_id": 39411128, "link": "https://stackoverflow.com/questions/39411128/haskell-function-composition-methods", "title": "Haskell function composition methods", "body": "<p>I just started learning Haskell at uni, and while playing around with it, I stumbled upon a problem that I can't seem to grasp.\nThe following code gives me the desired result:</p>\n\n<pre><code>import Data.List\nlist = [\"Hello\", \"world\"]\n\nmain = print $ intercalate \" something \" (reverse (map reverse list))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>\"dlrow something olleH\"\n</code></pre>\n\n<p>But I want to write the 'main' function with dots instead of brackets, so it tried:</p>\n\n<pre><code>main = print $ intercalate \" something \" . reverse . map reverse list\n</code></pre>\n\n<p>However, this gives me the following errors:</p>\n\n<pre><code>test.hs:5:54: error:\n    \u2022 Couldn't match expected type \u2018a0 -&gt; [[Char]]\u2019\n                  with actual type \u2018[[Char]]\u2019\n    \u2022 Possible cause: \u2018map\u2019 is applied to too many arguments\n</code></pre>\n\n<p>I thought that these dots meant exactly the same as the brackets: function composition. Why do the brackets work, whereas the dots give me a type-related error? Any help would be greatly appreciated!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1473422567, "post_id": 39410968, "comment_id": 66146451, "body": "For  what purpose do you need data families? I don&#39;t yet see any need for them."}, {"owner": {"reputation": 664, "user_id": 931420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/482f6832b98eccb86e2a5dc4de8aad91?s=128&d=identicon&r=PG", "display_name": "Dag", "link": "https://stackoverflow.com/users/931420/dag"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1473440137, "post_id": 39410968, "comment_id": 66157389, "body": "@Andr&#225;sKov&#225;cs Interface design sensibilities and probably also being stuck in OOP-think. Nonetheless, I&#39;m still curious why it doesn&#39;t work."}], "answers": [{"comments": [{"owner": {"reputation": 664, "user_id": 931420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/482f6832b98eccb86e2a5dc4de8aad91?s=128&d=identicon&r=PG", "display_name": "Dag", "link": "https://stackoverflow.com/users/931420/dag"}, "edited": false, "score": 0, "creation_date": 1473439479, "post_id": 39413853, "comment_id": 66157105, "body": "Thanks for your response. I feel I tried this last time around but ultimately dismissed it for some reason, but I can&#39;t remember for sure. I&#39;m still curious though if it&#39;s possible to do it more like I was trying here and if not, why. Cheers."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 664, "user_id": 931420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/482f6832b98eccb86e2a5dc4de8aad91?s=128&d=identicon&r=PG", "display_name": "Dag", "link": "https://stackoverflow.com/users/931420/dag"}, "edited": false, "score": 0, "creation_date": 1473439675, "post_id": 39413853, "comment_id": 66157180, "body": "@Dag <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#overview\" rel=\"nofollow noreferrer\">Data families aren&#39;t promoted</a>, even with <code>TypeInType</code>."}, {"owner": {"reputation": 664, "user_id": 931420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/482f6832b98eccb86e2a5dc4de8aad91?s=128&d=identicon&r=PG", "display_name": "Dag", "link": "https://stackoverflow.com/users/931420/dag"}, "edited": false, "score": 0, "creation_date": 1473440363, "post_id": 39413853, "comment_id": 66157487, "body": "Thanks, I had missed that particular bit in the manual. Seems it would require full dependent types, suggesting it&#39;s unlikely to ever be implemented in GHC?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 664, "user_id": 931420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/482f6832b98eccb86e2a5dc4de8aad91?s=128&d=identicon&r=PG", "display_name": "Dag", "link": "https://stackoverflow.com/users/931420/dag"}, "edited": false, "score": 2, "creation_date": 1473444336, "post_id": 39413853, "comment_id": 66159519, "body": "@Dag I don&#39;t know about the complexities of promoting <code>data</code> families <i>per se</i>, but I do know that <a href=\"https://typesandkinds.wordpress.com/2016/07/24/dependent-types-in-haskell-progress-report/\" rel=\"nofollow noreferrer\">Dependent Haskell remains on the road-map</a>, possibly even this decade. <a href=\"https://github.com/goldfirere/thesis\" rel=\"nofollow noreferrer\">Richard Eisenberg&#39;s thesis</a> (currently a preview) specifies the design of Dependent Haskell, though I can&#39;t comment on its contents because I haven&#39;t got around to reading it yet"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 4, "last_activity_date": 1473507279, "last_edit_date": 1473507279, "creation_date": 1473431075, "answer_id": 39413853, "question_id": 39410968, "link": "https://stackoverflow.com/questions/39410968/kind-promotion-of-data-family-instance-with-typeintype/39413853#39413853", "title": "Kind-promotion of data family instance with TypeInType", "body": "<p>I think you've overcomplicated your solution. Those <code>Node</code> and <code>Edge</code> data families are the cause of your error - <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#overview\" rel=\"nofollow\">data families aren't promoted</a>, even with <code>TypeInType</code> - and they're not adding anything over the following simpler design:</p>\n\n<pre><code>infixr 5 :&gt;\ndata Path (g :: k -&gt; k -&gt; *) (x :: k) (y :: k) where\n    Nil :: Path g x x\n    (:&gt;) :: g x y -&gt; Path g y z -&gt; Path g x z\n</code></pre>\n\n<p><code>Path g</code> is a type-aligned list of <code>g</code>s, such that the <code>g</code>s' types join up like dominoes. Or, viewing types as sets, <code>Path g</code> is the type of morphisms in the free category of a directed graph with nodes in <code>k</code> and edges in <code>g :: k -&gt; k -&gt; *</code>. Or, viewing <code>g</code> as a logical relation, <code>Path g</code> is <code>g</code>'s reflexive transitive closure.</p>\n\n<p>In this instance <code>k</code> and <code>g</code> are, respectively, the following <code>FileSystemItem</code> and <code>FileSystemPart</code> types:</p>\n\n<pre><code>data FileSystemItem = Root | Home | Working | Directory | File\ndata FileSystemPart (dir :: FileSystemItem) (base :: FileSystemItem) where\n    RootDirectory    ::           FileSystemPart Root      Directory\n    HomeDirectory    ::           FileSystemPart Home      Directory\n    WorkingDirectory ::           FileSystemPart Working   Directory\n    DirectoryName    :: String -&gt; FileSystemPart Directory Directory\n    FileName         :: String -&gt; FileSystemPart Directory File\n    FileExtension    :: String -&gt; FileSystemPart File      File\n\ntype FileSystemPath = Path FileSystemPart\n</code></pre>\n\n<p>So <code>FileSystemPath</code> is the set of morphisms in the category of <code>FileSystemItem</code>s:</p>\n\n<pre><code>ghci&gt; :k FileSystemPath\nFileSystemPath :: FileSystemItem -&gt; FileSystemItem -&gt; *\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>myDocument :: FileSystemPath Home File\nmyDocument = HomeDirectory :&gt; DirectoryName \"documents\" :&gt; FileName \"foo\" :&gt; FileExtension \"hs\" :&gt; Nil\n</code></pre>\n\n<p>Note that you don't need the <code>TypeInType</code> or <code>TypeFamilies</code> heavy machinery for this - you only need <code>PolyKinds</code> to define the kind-polymorphic <code>Path</code>, and <code>DataKinds</code> plus <code>GADTs</code> for the filesystem itself.</p>\n"}], "owner": {"reputation": 664, "user_id": 931420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/482f6832b98eccb86e2a5dc4de8aad91?s=128&d=identicon&r=PG", "display_name": "Dag", "link": "https://stackoverflow.com/users/931420/dag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 524, "favorite_count": 0, "accepted_answer_id": 39413853, "answer_count": 1, "score": 2, "last_activity_date": 1473507279, "creation_date": 1473421889, "question_id": 39410968, "link": "https://stackoverflow.com/questions/39410968/kind-promotion-of-data-family-instance-with-typeintype", "title": "Kind-promotion of data family instance with TypeInType", "body": "<p>I'm experimenting with making a generic free category (Path) and an instance for filesystems for strongly-typed filepaths.  I was hoping the new <code>TypeInType</code> extension would make possible this more generalized path type where <a href=\"https://github.com/dag/path/blob/master/src/System/Path/Internal.hs\" rel=\"nofollow\">my earlier efforts</a> back in 2013 seemed to necessitate tying the filesystem parts into the category parts, but I'm running into an issue where I don't seem to be permitted to promote a data family instance to the kind level even though it's accepted by <code>:kind</code> in GHCI.</p>\n\n<p>I might be missing something obvious; I've been mostly away from Haskell and programming for some time now and even then I was hardly an expert at advanced type-level programming.</p>\n\n<p>Is what I'm trying to achieve here possible in GHC 8?</p>\n\n<h2>The Code</h2>\n\n<pre><code>{-# LANGUAGE TypeInType, TypeFamilies, GADTs #-}\n\nimport Data.Kind\n\ndata family Vertex g\n\ndata family Edge g (a :: Vertex g) (b :: Vertex g)\n\ndata Path g (a :: Vertex g) (b :: Vertex g) where\n    Nil :: Path g a a\n    Cons :: Edge g a b -&gt; Path g b c -&gt; Path g a c\n\ndata FileSystem\n\ndata instance Vertex FileSystem = Root | Home | Working | Directory | File\n\ndata instance Edge FileSystem where\n    RootDirectory :: Edge FileSystem Root Directory\n    HomeDirectory :: Edge FileSystem Home Directory\n    WorkingDirectory :: Edge FileSystem Working Directory\n    DirectoryName :: String -&gt; Edge FileSystem Directory Directory\n    FileName :: String -&gt; Edge FileSystem Directory File\n    FileExtension :: String -&gt; Edge FileSystem File File\n</code></pre>\n\n<h2>Compilation Error</h2>\n\n<pre><code>$ ghc Path.hs \n[1 of 1] Compiling Main             ( Path.hs, Path.o )\n\nPath.hs:18:38: error:\n    \u2022 Data constructor \u2018Root\u2019 cannot be used here\n        (it comes from a data family instance)\n    \u2022 In the second argument of \u2018Edge\u2019, namely \u2018Root\u2019\n      In the type \u2018Edge FileSystem Root Directory\u2019\n      In the definition of data constructor \u2018RootDirectory\u2019\n</code></pre>\n\n<h2>GHCi</h2>\n\n<p>Commenting out the <code>Edge FileSystem</code> declaration the code compiles and I can try some things in GHCi.</p>\n\n<pre><code>*Main&gt; :set -XTypeInType -XTypeFamilies -XGADTs\n*Main&gt; :k Edge FileSystem \nEdge FileSystem :: Vertex FileSystem -&gt; Vertex FileSystem -&gt; *\n*Main&gt; :k Root\nRoot :: Vertex FileSystem\n*Main&gt; :k Edge FileSystem Root Directory\nEdge FileSystem Root Directory :: *\n</code></pre>\n"}, {"tags": ["haskell", "segmentation-fault"], "answers": [{"comments": [{"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1473411066, "post_id": 39407058, "comment_id": 66139874, "body": "Indeed. I didn&#39;t know <code>Int#</code> was 64 bits in Haskell, thanks !"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1473411739, "post_id": 39407058, "comment_id": 66140264, "body": "It varies depending on what build of GHC you&#39;re using."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1473679006, "post_id": 39407058, "comment_id": 66219434, "body": "To expand a bit more: The Haskell Report guarantees that <code>Int</code> has at least 29 bits precision. The 32-bit builds of GHC implement <code>Int#</code> as 32 bits, the 64-bit builds of GHC implement it as 64 bits. See the comments in <code>GHC.Prim</code>."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1473410231, "last_edit_date": 1473410231, "creation_date": 1473409452, "answer_id": 39407058, "question_id": 39405662, "link": "https://stackoverflow.com/questions/39405662/segfault-in-arrayarray/39407058#39407058", "title": "Segfault in ArrayArray#", "body": "<p>It seems alright if you do the <code>TODO sizeof Int</code>:</p>\n\n<pre><code>{-# language CPP #-}\n\n-- imports\n\n#include \"MachDeps.h\"\n</code></pre>\n\n<p>And then in the code:</p>\n\n<pre><code>case newByteArray# (SIZEOF_HSINT# *# colCount) s of\n</code></pre>\n\n<p>You can find the contents of <code>MachDeps.h</code> <a href=\"https://github.com/ghc/ghc/blob/master/includes/MachDeps.h\" rel=\"nofollow\">here</a>. </p>\n"}], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 39407058, "answer_count": 1, "score": 1, "last_activity_date": 1473410231, "creation_date": 1473404631, "question_id": 39405662, "link": "https://stackoverflow.com/questions/39405662/segfault-in-arrayarray", "title": "Segfault in ArrayArray#", "body": "<p>I am trying to implement a matrix of integers as an <code>ArrayArray#</code>. It should give me a fast <code>swapLines</code> operation, that only writes a native pointer in memory, rather than copying several integers. It should have less memory indirections than <code>Vector (Unboxed.Vector Int)</code>, because all types are unlifted.</p>\n\n<p>For small matrices it works fine, however it segfaults when I increase the size. Try running <code>crashBigMatrix</code>,</p>\n\n<pre><code>{-# LANGUAGE MagicHash, UnboxedTuples #-}\n\nmodule Matrix where\n\nimport Control.Monad.ST\nimport GHC.ST\nimport GHC.Exts\nimport GHC.Prim\nimport GHC.Magic(runRW#)\n\ndata Matrix = Matrix ArrayArray# -- lifts the array from # to *\ndata MutableMatrix s = MutableMatrix (MutableArrayArray# s)\n\ngenerateLine :: MutableByteArray# s -&gt; Int# -&gt; Int# -&gt; Int# -&gt; (Int -&gt; Int -&gt; Int) -&gt; State# s -&gt; State# s\ngenerateLine mbar curLine curCol colCount genFunc s =\n  case curCol ==# colCount of\n    0# -&gt; case genFunc (I# curLine) (I# curCol) of\n      (I# x) -&gt; generateLine mbar curLine (curCol +# 1#) colCount genFunc (writeIntArray# mbar curCol x s) -- if curCol is replaced by 0#, doesn't crash\n    _ -&gt; s\n\ninitLines :: MutableArrayArray# s -&gt; Int# -&gt; Int# -&gt; Int# -&gt; (Int -&gt; Int -&gt; Int) -&gt; State# s -&gt; State# s\ninitLines mat curLine lineCount colCount genFunc s =\n  case curLine ==# lineCount of\n    1# -&gt; s\n    0# -&gt; case newByteArray# (4# *# colCount) s of -- TODO sizeof Int ?\n      (# s1, mbar #) -&gt; case unsafeFreezeByteArray# mbar (generateLine mbar curLine 0# colCount genFunc s1) of\n        (# s2, bar #) -&gt; initLines mat (curLine +# 1#) lineCount colCount genFunc\n                         (writeByteArrayArray# mat curLine bar s2) -- only writes a pointer to the ByteArray\n\ngenerateMutable# :: Int# -&gt; Int# -&gt; (Int -&gt; Int -&gt; Int) -&gt; State# s -&gt; (# State# s, MutableArrayArray# s #)\ngenerateMutable# lineCount colCount genFunc s =\n  case newArrayArray# lineCount s of\n    (# s1, marrarr #) -&gt; (# initLines marrarr 0# lineCount colCount genFunc s1 , marrarr #)\n\ncrashBigMatrix :: Int\ncrashBigMatrix =\n  case (runRW# $ \\s -&gt; case generateMutable# 150000# 4# (\\x y -&gt; x) s of\n    (# s1, marrarr #) -&gt; (# s1, marrarr #)) of\n    (# _, m #) -&gt; (MutableMatrix m) `seq` 2\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 3233, "user_id": 2487227, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yLbAE.jpg?s=128&g=1", "display_name": "Frederick Zhang", "link": "https://stackoverflow.com/users/2487227/frederick-zhang"}, "is_accepted": true, "score": 16, "last_activity_date": 1473395186, "creation_date": 1473395186, "answer_id": 39403857, "question_id": 39403798, "link": "https://stackoverflow.com/questions/39403798/haskell-variable-not-in-scope/39403857#39403857", "title": "Haskell: Variable not in scope", "body": "<pre><code>main = interact $ show . maxsubseq . map read . words\n\nmaxsubseq :: (Ord a,Num a) =&gt; [a] -&gt; (a,[a])\nmaxsubseq = snd . foldl f ((0,[]),(0,[])) where\nf ((h1,h2),sofar) x = (a,b) where\n    a = max (0,[]) (h1 + x ,h2 ++ [x])\n    b = max sofar a\n</code></pre>\n\n<p>Formats really matter in Haskell...</p>\n\n<p>Perhaps this looks better:</p>\n\n<pre><code>main = interact $ show . maxsubseq . map read . words\n\nmaxsubseq :: (Ord a,Num a) =&gt; [a] -&gt; (a,[a])\nmaxsubseq = snd . foldl f ((0,[]),(0,[])) where\n    f ((h1,h2),sofar) x = (a,b)\n        where {\n        a = max (0,[]) (h1 + x ,h2 ++ [x]);\n        b = max sofar a;\n              }\n</code></pre>\n"}], "owner": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31833, "favorite_count": 2, "accepted_answer_id": 39403857, "answer_count": 1, "score": 11, "last_activity_date": 1473395186, "creation_date": 1473394678, "question_id": 39403798, "link": "https://stackoverflow.com/questions/39403798/haskell-variable-not-in-scope", "title": "Haskell: Variable not in scope", "body": "<p>I have a code as:</p>\n\n<pre><code>main = interact $ show . maxsubseq . map read . words\n\nmaxsubseq :: (Ord a,Num a) =&gt; [a] -&gt; (a,[a])\nmaxsubseq = snd . foldl f ((0,[]),(0,[])) where \nf ((h1,h2),sofar) x = (a,b) where\na = max (0,[]) (h1 + x ,h2 ++ [x]) \nb = max sofar a\n</code></pre>\n\n<p>But I am getting error:</p>\n\n<pre><code>maxSub.hs:6:17: error: Variable not in scope: h1\n\nmaxSub.hs:6:22: error: Variable not in scope: x\n\nmaxSub.hs:6:25: error: Variable not in scope: h2 :: [t1]\n\nmaxSub.hs:6:32: error: Variable not in scope: x\n\nmaxSub.hs:7:9: error: Variable not in scope: sofar :: (t, [t1])\n</code></pre>\n\n<p>Not able to figure out why??</p>\n\n<p>Any ideas??</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "types", "algebraic-data-types"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1473386069, "post_id": 39402638, "comment_id": 66131129, "body": "Writing <code>data Card = ActionCard | BasicCard | BombCard</code> doesn&#39;t mean that <code>Card</code> will be one of <code>Attack</code>, ... , <code>RainboRalphingCat</code> - instead it creates three <i>new</i> data constructors that happen to have the same names as three existing types."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1473387009, "post_id": 39402638, "comment_id": 66131351, "body": "Probably something as <code>data Card = Action ActionCard | Basic BasicCard | Bomb BombCard</code> then you&#39;ll have to change <code>[TacoCat ..]</code> to <code>map Basic [TacoCat..]</code> and <code>Nope</code>  to <code>(Action Nope)</code> and so on..."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 4, "last_activity_date": 1473387553, "creation_date": 1473387553, "answer_id": 39402851, "question_id": 39402638, "link": "https://stackoverflow.com/questions/39402638/datatypes-that-are-represented-by-a-choice-of-one-of-many-other-datatypes/39402851#39402851", "title": "Datatypes that are represented by a choice of one of many other datatypes", "body": "<blockquote>\n<pre><code>data Card = ActionCard | BasicCard | BombCard\n</code></pre>\n</blockquote>\n\n<p>This creates a new datatype <code>Card</code> with three constructors called <code>ActionCard</code>, <code>BasicCard</code> and <code>BombCard</code>. This has nothing to do with the other two datatypes that are called <code>ActionCard</code> or <code>BasicCard</code>; the namespace of types and constructors is distinct.</p>\n\n<p>What you want to do is to define <code>Card</code> as either being an <code>Action</code> comprising an <code>ActionCard</code>, or a <code>Basic</code> <code>BasicCard</code>, or a <code>BombCard</code>:</p>\n\n<pre><code>data Card = Action ActionCard | Basic BasicCard | BombCard\n</code></pre>\n\n<p>then you can make your <code>Deck</code> by wrapping each card type in its correct constructor:</p>\n\n<pre><code>generateDeck :: Int -&gt; Deck\ngenerateDeck players = basics ++ actions ++ bombs\n  where\n    cats = concatMap (replicate 5 . Basic) [TacoCat ..]\n    actions = map Action . concat $\n              [ replicate 2 Nope\n              , replicate 4 Skip\n              , replicate 4 Attack\n              , replicate 4 Shuffle\n              , replicate 4 Future\n              , replicate 1 Defuse\n              , replicate 4 Favor\n              ]\n    bombs = replicate (players + 1) BombCard\n</code></pre>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1473387662, "creation_date": 1473385881, "last_edit_date": 1473387662, "question_id": 39402638, "link": "https://stackoverflow.com/questions/39402638/datatypes-that-are-represented-by-a-choice-of-one-of-many-other-datatypes", "title": "Datatypes that are represented by a choice of one of many other datatypes", "body": "<p>I am attempting to generate a deck for a toy implementation of Exploding Kittens.</p>\n\n<p>Say I had the following types:</p>\n\n<pre><code>data ActionCard = Skip \n  | Attack \n  | Shuffle \n  | Nope \n  | Future \n  | Defuse \n  | Favor\n  deriving Enum\n\ndata BasicCard = TacoCat \n  | MommaCat \n  | Catermelon \n  | BearCat \n  | PotatoCat \n  | BikiniCat \n  | RainboRalphingCat\n  deriving Enum\n\ndata Card = ActionCard | BasicCard | BombCard\n\ntype Deck = [Card]\n</code></pre>\n\n<p>and a deck generator function like so:</p>\n\n<pre><code>generateDeck :: Int -&gt; Deck\ngenerateDeck players = (concat (map (replicate 5) [TacoCat ..])) \n  ++ (replicate 2 Nope)\n  ++ (replicate 4 Skip)\n  ++ (replicate 4 Attack)\n  ++ (replicate 4 Shuffle)\n  ++ (replicate 4 Future)\n  ++ (replicate 1 Defuse)\n  ++ (replicate 4 Favor)\n  ++ (replicate (players + 1) BombCard)\n</code></pre>\n\n<p>This fails with:</p>\n\n<pre><code>Couldn't match expected type \u2018[BasicCard]\u2019\n                    with actual type \u2018a7 -&gt; [a7]\u2019\n        Probable cause: \u2018replicate\u2019 is applied to too few arguments\n        In the first argument of \u2018(+)\u2019, namely\n          \u2018replicate (length $ _players state)\u2019\n        In the second argument of \u2018(++)\u2019, namely\n          \u2018(replicate (length $ _players state) + 1 BombCard)\u2019\n</code></pre>\n\n<p>(and similiar errors for hte other non basic cards)</p>\n\n<p>That makes sense on one level as <code>(concat (map (replicate 5) [TacoCat ..]))</code> returns a <code>[BasicCard]</code>, however I would have expected the function signature to force a more generic type?</p>\n\n<p>How do allow for <code>Card</code> to be either an <code>ActionCard</code>, a <code>BasicCard</code>, or a <code>BombCard</code>?</p>\n"}, {"tags": ["haskell", "haskell-cmdargs"], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1473378762, "creation_date": 1473378762, "question_id": 39401796, "link": "https://stackoverflow.com/questions/39401796/common-flags-of-multiple-modes-with-cmdargs-explicit", "title": "Common flags of multiple modes with cmdargs explicit", "body": "<p>I'm writing a command line program with <strong>Haskell</strong> and <a href=\"https://hackage.haskell.org/package/cmdargs\" rel=\"nofollow\"><strong>cmd-args</strong></a> with the  <a href=\"https://hackage.haskell.org/package/cmdargs-0.10.14/docs/System-Console-CmdArgs-Explicit.html\" rel=\"nofollow\"><strong>Explicit</strong></a> module. </p>\n\n<p>The <a href=\"https://hackage.haskell.org/package/cmdargs-0.10.14/docs/System-Console-CmdArgs-Implicit.html\" rel=\"nofollow\"><strong>Implicit</strong></a> module provide a default help message with a list of differents modes with the common flags to these modes, like this :</p>\n\n<pre><code>diffy [COMMAND] ... [OPTIONS]\n  Create and compare differences\n\nCommon flags:\n  -o --out=FILE     Output file\n  -? --help         Display help message\n  -V --version     Print version information\n\ndiffy create [OPTIONS]\n  Create a fingerprint\n\n  -s  --src=DIR  Source directory\n\ndiffy diff [OPTIONS] OLDFILE NEWFILE\n  Perform a diff\n</code></pre>\n\n<p><strong>Is it possible to make the same thing with the Explicit module ?</strong></p>\n\n<p><strong>Is there a function in cmdargs giving the commons flags of several modes ?</strong></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1473366502, "post_id": 39399510, "comment_id": 66125366, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/4718084/how-does-haskell-do-pattern-matching-without-us-defining-an-eq-on-our-data-types\">How does Haskell do pattern matching without us defining an Eq on our data types?</a> (not exactly of course, but hopefully reading through that thread will answer your question; but the short answer to the question you posted is &quot;pattern matching&quot;)"}, {"owner": {"reputation": 964, "user_id": 1913372, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/440837c3aa8fa3f3617f7029cf92d977?s=128&d=identicon&r=PG", "display_name": "RoyM", "link": "https://stackoverflow.com/users/1913372/roym"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1473378951, "post_id": 39399510, "comment_id": 66129584, "body": "Much appreciated."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 7, "last_activity_date": 1473366587, "creation_date": 1473366587, "answer_id": 39399679, "question_id": 39399510, "link": "https://stackoverflow.com/questions/39399510/how-to-test-for-a-heterogeneous-data-constructor/39399679#39399679", "title": "How to test for a heterogeneous data constructor?", "body": "<p><code>Error</code> isn't a type; it's a data constructor. You can use pattern matching to distinguish between various values of type <code>LogLevel</code>.</p>\n\n<pre><code>case x of\n  Info -&gt; ...\n  Warning -&gt; ...\n  Error n -&gt; ...\n</code></pre>\n\n<p>Here, not only will you take the correct \"branch\" depending on the value of <code>x</code>, but you also get the specific integer associated with <code>Error</code> (in <code>n</code>) when that pattern matches.</p>\n"}], "owner": {"reputation": 964, "user_id": 1913372, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/440837c3aa8fa3f3617f7029cf92d977?s=128&d=identicon&r=PG", "display_name": "RoyM", "link": "https://stackoverflow.com/users/1913372/roym"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 39399679, "answer_count": 1, "score": 1, "last_activity_date": 1473382549, "creation_date": 1473365928, "last_edit_date": 1473382549, "question_id": 39399510, "link": "https://stackoverflow.com/questions/39399510/how-to-test-for-a-heterogeneous-data-constructor", "title": "How to test for a heterogeneous data constructor?", "body": "<p>Seems like a really basic question, but if I have:</p>\n\n<pre><code>data LogLevel = Info | Warning | Error Int\nx = Info\ny = Error 13\n</code></pre>\n\n<p>I can write</p>\n\n<pre><code>if (x==Info)\n</code></pre>\n\n<p>but how would I write a test for type Error?</p>\n"}, {"tags": ["c++", "haskell", "testing", "dsl", "soft-real-time"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1473369884, "post_id": 39399162, "comment_id": 66126888, "body": "You can <a href=\"https://downloads.haskell.org/~ghc/7.10-latest/docs/html/users_guide/ffi-ghc.html\" rel=\"nofollow noreferrer\">embed the GHC RTS</a>\u2014in brief, you\u2019d start the runtime with <code>hs_init()</code>, and either use <a href=\"https://hackage.haskell.org/package/hint\" rel=\"nofollow noreferrer\">hint</a> to load &amp; run Haskell sources from Haskell, or load a shared library of precompiled Haskell code from C++. (The latter is what they do with <a href=\"https://github.com/facebook/Haxl\" rel=\"nofollow noreferrer\">Haxl</a> code at Facebook.)"}], "answers": [{"tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": false, "score": 2, "last_activity_date": 1473381943, "creation_date": 1473381943, "answer_id": 39402185, "question_id": 39399162, "link": "https://stackoverflow.com/questions/39399162/building-a-simple-dsl-in-haskell-with-c-interop/39402185#39402185", "title": "Building a simple DSL in Haskell with C++ interop", "body": "<p>Sounds like the path of least resistance would be an EDSL that generates C++. This way, you don't have to worry about the potential mismatch between soft real-time and the GHC RTS.</p>\n\n<p>You might look at how other EDSLs that generate PLs are implemented:</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/HJScript\" rel=\"nofollow\">HJScript</a> uses a free monad approach to embedding JS.</li>\n<li><a href=\"https://wiki.haskell.org/Jmacro\" rel=\"nofollow\">JMacro</a> uses more of an external DSL approach but embedded via TH. Wouldn't be my choice.</li>\n</ul>\n\n<p>Instead of generating strings of C++ code, it's nice to have a data structure. Unfortunately, there doesn't seem to be a package available for C++. However, you could take a look at <a href=\"https://hackage.haskell.org/package/language-c\" rel=\"nofollow\">language-c</a> \u2014 perhaps extend that or build your own. You might even consider generating C and using the C to C++ interop provided by those languages.</p>\n\n<p>I'd probably dissuade you from looking at the design of <a href=\"http://www.cryptol.net\" rel=\"nofollow\">Cryptol</a> or Cogent as these are fully-fledged programming languages (that you have indicated you are inclined to steer away from).</p>\n"}], "owner": {"reputation": 11, "user_id": 6810526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76842768c5e44de24b2c7dd4a82fa2f6?s=128&d=identicon&r=PG&f=1", "display_name": "Don Shoveri", "link": "https://stackoverflow.com/users/6810526/don-shoveri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 395, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1473381943, "creation_date": 1473364423, "question_id": 39399162, "link": "https://stackoverflow.com/questions/39399162/building-a-simple-dsl-in-haskell-with-c-interop", "title": "Building a simple DSL in Haskell with C++ interop", "body": "<p>I'm designing a simple interpreted language for testing real-time embedded systems. The control flow is severely restricted to provide strong static guarantees on what the scripts will do + how long they will run. For example, you can only branch on constant conditionals or loop over fixed ranges.</p>\n\n<p>There is a large existing codebase in C++ with relevant models and IO libs, so this language must be able to call into C++. The systems under test have hard timing requirements, so we can't tolerate much jitter in the test framework. Our past solution was a custom DSL embedded in the C++ runtime, but we ended up re-inventing too many wheels (parser, linter, interactive interpreter, etc..) to achieve the static guarantees we need. </p>\n\n<p>Haskell's facilities for crafting embedded DSLs with these guarantees are extremely appealing to me, but <strong>I'm stuck in determining how to embed it into the soft real-time C++ runtime</strong>. Any ideas? Pointers to any libraries / existing projects would be greatly appreciated! </p>\n"}, {"tags": ["haskell", "emacs"], "comments": [{"owner": {"reputation": 2528, "user_id": 4905506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vmyz0.png?s=128&g=1", "display_name": "Yuri Steinschreiber", "link": "https://stackoverflow.com/users/4905506/yuri-steinschreiber"}, "edited": false, "score": 0, "creation_date": 1473364923, "post_id": 39399050, "comment_id": 66124574, "body": "1. issue <code>M-x toggle-debug-on-error</code> and try it again (<code>--debug-init</code> only breaks into debugger on startup). 2. Are you sure <code>stack</code> is in the path? Did you try running it from terminal?"}, {"owner": {"reputation": 13890, "user_id": 3642398, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/Y6cZb.jpg?s=128&g=1", "display_name": "elethan", "link": "https://stackoverflow.com/users/3642398/elethan"}, "edited": false, "score": 1, "creation_date": 1473365302, "post_id": 39399050, "comment_id": 66124759, "body": "See this github issue: <a href=\"https://github.com/haskell/haskell-mode/issues/1300\" rel=\"nofollow noreferrer\">github.com/haskell/haskell-mode/issues/1300</a>"}, {"owner": {"reputation": 91, "user_id": 6810868, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-traUfxnoRug/AAAAAAAAAAI/AAAAAAAALz0/OD2Z1o5zgKY/photo.jpg?sz=128", "display_name": "Janjaap Ree", "link": "https://stackoverflow.com/users/6810868/janjaap-ree"}, "reply_to_user": {"reputation": 2528, "user_id": 4905506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vmyz0.png?s=128&g=1", "display_name": "Yuri Steinschreiber", "link": "https://stackoverflow.com/users/4905506/yuri-steinschreiber"}, "edited": false, "score": 0, "creation_date": 1473365364, "post_id": 39399050, "comment_id": 66124790, "body": "@Yuri 1. Worked! I now get each time I change something the error: Company: An error occurred in auto-begin Symbol&#39;s function definition is void: haskell-completions-completion-at-point  2. It works in the terminal. However, I don&#39;t know how to verify if it&#39;s in the correct path"}, {"owner": {"reputation": 2528, "user_id": 4905506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vmyz0.png?s=128&g=1", "display_name": "Yuri Steinschreiber", "link": "https://stackoverflow.com/users/4905506/yuri-steinschreiber"}, "reply_to_user": {"reputation": 13890, "user_id": 3642398, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/Y6cZb.jpg?s=128&g=1", "display_name": "elethan", "link": "https://stackoverflow.com/users/3642398/elethan"}, "edited": false, "score": 0, "creation_date": 1473365895, "post_id": 39399050, "comment_id": 66125069, "body": "Check the link @elethan suggested."}, {"owner": {"reputation": 91, "user_id": 6810868, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-traUfxnoRug/AAAAAAAAAAI/AAAAAAAALz0/OD2Z1o5zgKY/photo.jpg?sz=128", "display_name": "Janjaap Ree", "link": "https://stackoverflow.com/users/6810868/janjaap-ree"}, "reply_to_user": {"reputation": 13890, "user_id": 3642398, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/Y6cZb.jpg?s=128&g=1", "display_name": "elethan", "link": "https://stackoverflow.com/users/3642398/elethan"}, "edited": false, "score": 1, "creation_date": 1473366858, "post_id": 39399050, "comment_id": 66125523, "body": "Adding (add-to-list &#39;exec-path &quot;/usr/local/bin/&quot;) to .emacs config file fixed the problem. Thanks @elethan"}, {"owner": {"reputation": 13890, "user_id": 3642398, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/Y6cZb.jpg?s=128&g=1", "display_name": "elethan", "link": "https://stackoverflow.com/users/3642398/elethan"}, "edited": false, "score": 0, "creation_date": 1473366940, "post_id": 39399050, "comment_id": 66125561, "body": "@JanjaapRee great! You should right that up as an answer for anyone else who might have the problem!"}], "answers": [{"tags": [], "owner": {"reputation": 91, "user_id": 6810868, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-traUfxnoRug/AAAAAAAAAAI/AAAAAAAALz0/OD2Z1o5zgKY/photo.jpg?sz=128", "display_name": "Janjaap Ree", "link": "https://stackoverflow.com/users/6810868/janjaap-ree"}, "is_accepted": false, "score": 6, "last_activity_date": 1473369042, "creation_date": 1473369042, "answer_id": 39400263, "question_id": 39399050, "link": "https://stackoverflow.com/questions/39399050/stack-is-not-found-when-coding-haskell-in-emacs/39400263#39400263", "title": "&quot;Stack&quot; is not found when coding Haskell in emacs", "body": "<p>I've managed to fix the problem by adding </p>\n\n<pre><code>(add-to-list 'exec-path \"/usr/local/bin/\")\n</code></pre>\n\n<p>to the .emacs config file.</p>\n"}, {"tags": [], "owner": {"reputation": 984, "user_id": 460846, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5c6c87eb8e6756f217a9c4951847fe4e?s=128&d=identicon&r=PG", "display_name": "Magnus", "link": "https://stackoverflow.com/users/460846/magnus"}, "is_accepted": false, "score": 1, "last_activity_date": 1473430086, "creation_date": 1473430086, "answer_id": 39413533, "question_id": 39399050, "link": "https://stackoverflow.com/questions/39399050/stack-is-not-found-when-coding-haskell-in-emacs/39413533#39413533", "title": "&quot;Stack&quot; is not found when coding Haskell in emacs", "body": "<p>I'd recommend the <a href=\"https://github.com/purcell/exec-path-from-shell\" rel=\"nofollow\">exec-path-from-shell</a> library; I had similar issues on OS X and this solved them for me.</p>\n\n<p>Once the library is installed, put the following in your <code>.emacs</code>:</p>\n\n<pre><code>(exec-path-from-shell-initialize)\n</code></pre>\n\n<p>If you ever run emacs from the shell, it may be worth inserting the following instead:</p>\n\n<pre><code>(when (memq window-system '(mac ns))\n  (exec-path-from-shell-initialize))\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 6810868, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-traUfxnoRug/AAAAAAAAAAI/AAAAAAAALz0/OD2Z1o5zgKY/photo.jpg?sz=128", "display_name": "Janjaap Ree", "link": "https://stackoverflow.com/users/6810868/janjaap-ree"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 448, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1473430086, "creation_date": 1473363933, "last_edit_date": 1473364572, "question_id": 39399050, "link": "https://stackoverflow.com/questions/39399050/stack-is-not-found-when-coding-haskell-in-emacs", "title": "&quot;Stack&quot; is not found when coding Haskell in emacs", "body": "<p>While coding Haskell in emacs(stack installed with brew) on MacOS 10.12 I get the error:</p>\n\n<p>Error while checking syntax automatically: (file-error \"Searching for program\" \"no such file or directory\" \"stack\")</p>\n\n<p>My config file .emacs contains the following:</p>\n\n<pre><code>(require 'package)\nadd-to-list\n'package-archives\n'(\"melpa\" . \"http://melpa.org/packages/\") t)\n(package-initialize)\n(package-refresh-contents)\n(package-install 'intero)\n(add-hook 'haskell-mode-hook 'intero-mode)\n</code></pre>\n\n<p>Running with emacs --debug-init gives no errors. </p>\n\n<p>Does somebody know how to solve this? </p>\n"}, {"tags": ["haskell", "gadt"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1473365477, "post_id": 39398651, "comment_id": 66124846, "body": "Your GADT isn&#39;t really a GADT. It&#39;s just like <code>newtype Response a = Response a</code> but not as useful because <code>a</code> can only be <code>Sum Int</code> or <code>HashMap Text (Sum Int)</code>. If you use a <code>newtype</code> you can use <code>GeneralizedNewtypeDeriving</code> to get the <code>Monoid</code> instance for free"}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1473370770, "post_id": 39398651, "comment_id": 66127277, "body": "@BenjaminHodgson if I were to define <code>Response a</code> as a newtype would I have a way to define a function over it that knows what <code>a</code> it&#39;s working with?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1473375618, "post_id": 39398651, "comment_id": 66128799, "body": "I&#39;m fond of the old-fashioned way <code>f :: Response (Sum Int) -&gt; Foo</code>"}], "answers": [{"tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 8, "last_activity_date": 1473366279, "last_edit_date": 1473366279, "creation_date": 1473365798, "answer_id": 39399484, "question_id": 39398651, "link": "https://stackoverflow.com/questions/39398651/is-it-possible-to-create-a-monoid-instance-for-a-gadt/39399484#39399484", "title": "Is it possible to create a monoid instance for a GADT?", "body": "<p>As you've noticed, you can't provide an <code>instance Monoid (Response a)</code>, because you can't define <code>mempty :: Response a</code>.  Why not?  Well, <code>mempty</code> has to have type <code>Response a</code> for <em>all</em> <code>a</code>, including, say, <code>Bool</code>.  But you can't construct a value of type <code>Response Bool</code>, only <code>Response (HashMap Text (Sum Int))</code> and <code>Response (Sum Int)</code>.  So you won't be able to create a <code>mempty</code>.  This isn't a problem for <code>mappend</code>, because you're <em>given</em> a <code>Response a</code>, so you can check which <code>a</code> you were given.  But <code>mempty</code> has nothing to analyze.</p>\n\n<p>So what can you do?  Well, first of all, you can provide an <code>instance Semigroup (Response a)</code>.  A semigroup is exactly a monoid without <code>mempty</code>, so this is exactly what you want.  As of GHC 8, you can find this type class in the <code>base</code> package, in the module <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Semigroup.html\" rel=\"noreferrer\"><code>Data.Semigroup</code></a>; prior to that, you need to use the <a href=\"https://hackage.haskell.org/package/semigroups\" rel=\"noreferrer\"><code>semigroups</code></a> package, with the same module name.  Instead of <code>mappend</code>, it uses the binary operator <code>(&lt;&gt;)</code>.  So you'd have</p>\n\n<pre><code>import Data.Semigroup\nimport Data.Monoid hiding ((&lt;&gt;))\n\n-- ...\n\ninstance Semigroup (Response a) where\n  ResponseMap v1 &lt;&gt; ResponseMap v2 = ResponseMap $ v1 &lt;&gt; v2\n  ResponseSum v1 &lt;&gt; ResponseSum v2 = ResponseSum $ v1 &lt;&gt; v2\n</code></pre>\n\n<p>You can also provide <em>specific</em> <code>Monoid</code> instances for the type indices that you can construct.  With <code>FlexibleInstances</code>, that looks like</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\ninstance Monoid (Response (HashMap Text (Sum Int))) where\n  mempty = ResponseMap mempty\n  mappend = (&lt;&gt;)\n\ninstance Monoid (Response (Sum Int)) where\n  mempty = ResponseSum mempty\n  mappend = (&lt;&gt;)\n</code></pre>\n\n<p>Now, for the cases where you <em>do</em> know what the unit is, you have a <code>Monoid</code> instance.</p>\n"}], "owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 39399484, "answer_count": 1, "score": 3, "last_activity_date": 1473366279, "creation_date": 1473362328, "question_id": 39398651, "link": "https://stackoverflow.com/questions/39398651/is-it-possible-to-create-a-monoid-instance-for-a-gadt", "title": "Is it possible to create a monoid instance for a GADT?", "body": "<p>Given the following data type</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>{-# LANGUAGE GADTs #-}\n\ndata Response a where\n  ResponseMap :: HashMap Text (Sum Int) -&gt; Response (HashMap Text (Sum Int))\n  ResponseSum :: Sum Int -&gt; Response (Sum Int)\n</code></pre>\n\n<p>how would I derive a monoid instance for it? For the definition of <code>mappend</code> I can pattern match on the constructors</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>  (ResponseSum v1) `mappend` (ResponseSum v2) = undefined\n  (ResponseMap v1) `mappend` (ResponseMap v2) = undefined\n</code></pre>\n\n<p>and combine the values easily but I don't see how I would implement <code>mempty</code>, or if it's indeed possible, or makes sense?</p>\n"}, {"tags": ["parsing", "haskell", "parser-combinators"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1473359680, "post_id": 39397815, "comment_id": 66121873, "body": "Just because a keyword is followed by a semi-colon, that doesn&#39;t mean it is being used correctly. Keywords are always part of some larger syntactic structure. Namely, a keyword is just a specific token which your grammar is built upon. The only difference between a keyword and an identifier is that the keyword is recognized by the grammar, rather than treated as a generic token left to later stages of parsing and evaluation."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473360231, "post_id": 39397815, "comment_id": 66122165, "body": "The semi-colon itself is another token; you should have another combinator that recognizes correct collections of other tokens. (In this sense, the parser is really doing both lexical analysis--converting a stream of bytes into a stream of tokens--and parsing--converting a stream of tokens into an abstract syntax tree.)"}], "answers": [{"comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 1, "creation_date": 1473414191, "post_id": 39401818, "comment_id": 66141716, "body": "If you do it like this, the identifier &quot;iffy&quot; could be instead parsed as the keyword &quot;if&quot; followed by the identifier &quot;fy&quot;. I believe (and I admit I&#39;m totally guessing) the reason why OP decided that &quot;after a keyword there is a requirement that there is a separator or whitespace&quot; is to disallow this."}, {"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1473416319, "post_id": 39401818, "comment_id": 66142942, "body": "Oh i see, perhaps I missed that point in the question. I&#39;ll give it some thought and update my answer if I have anything to add."}, {"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1473420626, "post_id": 39401818, "comment_id": 66145343, "body": "I pushed a more complete example to <a href=\"https://github.com/steshaw/haskell-shebang-examples/blob/master/stack/imperative.hs\" rel=\"nofollow noreferrer\">github.com/steshaw/haskell-shebang-examples/blob/master/stac&zwnj;&#8203;k/&hellip;</a>"}], "tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": true, "score": 3, "last_activity_date": 1473420361, "last_edit_date": 1473420361, "creation_date": 1473378923, "answer_id": 39401818, "question_id": 39397815, "link": "https://stackoverflow.com/questions/39397815/haskell-parser-combinators-keywords/39401818#39401818", "title": "Haskell -- parser combinators keywords", "body": "<p>Don't try to handle the separators in <code>keyword</code> but you need to ensure that <code>keyword \"if\"</code> will not be confused with an identifier \"iffy\" (see comment by sepp2k).</p>\n\n<pre><code>keyword :: String -&gt; Parser String\nkeyword k = leadingWS $ try (do string k\n                                notFollowedBy alphanum)\n</code></pre>\n\n<p>Handling separators for statements would go like this:</p>\n\n<pre><code>statements = statement `sepBy` semi\nstatement  = ifStatement &lt;|&gt; assignmentStatement &lt;|&gt; ...\n</code></pre>\n"}], "owner": {"reputation": 371, "user_id": 5738619, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/489ffbc19dae2212663f027806a6a95f?s=128&d=identicon&r=PG&f=1", "display_name": "Zubair", "link": "https://stackoverflow.com/users/5738619/zubair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "accepted_answer_id": 39401818, "answer_count": 1, "score": 2, "last_activity_date": 1473420361, "creation_date": 1473359131, "question_id": 39397815, "link": "https://stackoverflow.com/questions/39397815/haskell-parser-combinators-keywords", "title": "Haskell -- parser combinators keywords", "body": "<p>I am working on building a parser in Haskell using parser combinators. I have an issue with parsing keywords such as \"while\", \"true\", \"if\" etc</p>\n\n<p>So the issue I am facing is that after a keyword there is a requirement that there is a separator or whitespace, for example in the statement\n<code>if cond then stat1 else stat2 fi;x = 1</code>\nwith this statement all keywords have either a space in front of them or a semi colon. However in different situations there can be different separators.</p>\n\n<p>Currently I have implemented it as follows:</p>\n\n<pre><code>keyword :: String -&gt; Parser String\nkeyword k = do\n  kword &lt;- leadingWS (string k)\n  check (== ';') &lt;|&gt; check isSpace &lt;|&gt; check (== ',') &lt;|&gt; check (== ']')\n  junk\n  return word\n</code></pre>\n\n<p>however the problem with this keyword parser is that it will allow programs which have statements like if; cond then stat1 else stat2 fi</p>\n\n<p>We tried passing in a (Char -> Bool) to keyword, which would then be passed to check. But this wouldn\u2019t work because where we parse the keyword we don\u2019t know what kind of separator is allowed.</p>\n\n<p>I was wondering if I could have some help with this issue?</p>\n"}, {"tags": ["haskell", "infinite-loop", "typechecking", "type-families"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1473353531, "post_id": 39396195, "comment_id": 66118772, "body": "It seems you are assuming that type-level computation is lazy, hence that the second branch of the <code>If</code> won&#39;t be evaluated unless it is needed. I think that assumption is unwarranted."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 6, "creation_date": 1473353671, "post_id": 39396195, "comment_id": 66118843, "body": "And by the way: being polymorphic over <code>op</code> is probably wrong. For example, <code>Simplify (Either () Int)</code> probably should not reduce to <code>Int</code>."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1473448686, "post_id": 39396195, "comment_id": 66161651, "body": "What should the behaviour be on <code>(String, (), Int)</code>? Both solutions suggested so far reduce that to <code>Int</code>. I don&#39;t even know if it&#39;s possible to get <code>(String, Int)</code>."}, {"owner": {"reputation": 2535, "user_id": 634020, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/044be669886e6b2e625776ff8be167b7?s=128&d=identicon&r=PG", "display_name": "Philip Kamenarsky", "link": "https://stackoverflow.com/users/634020/philip-kamenarsky"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1473686664, "post_id": 39396195, "comment_id": 66223924, "body": "@gallais: That&#39;s fine, terms can be (nested) tuples only."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1473354008, "post_id": 39396485, "comment_id": 66119002, "body": "Wow, I was writing up an answer, too... and came up with <i>exactly</i> the same choice for second test case. For what it&#39;s worth, I think my answer is slightly simpler, though perhaps less generalizable: <code>Simplify1 ((), y) = y; Simplify1 (x, ()) = x; Simplify1 other = other; Simplify (x, y) = Simplify1 (Simplify x, Simplify y); Simplify other = other</code>."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1473354500, "post_id": 39396485, "comment_id": 66119248, "body": "@DanielWagner I mean, you have to nest the <code>()</code>s at least two deep for a real test, right? :-)  And it&#39;s nice to compare your solution!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1473354676, "post_id": 39396485, "comment_id": 66119329, "body": "Also, a fun bit of magic: <code>:kind! forall a. Simplify1 (a, ()) = a</code>. That takes some real cleverness, given that it has to notice the first two clauses of <code>Simplify1</code> will give the same answer!"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1473354812, "post_id": 39396485, "comment_id": 66119380, "body": "@DanielWagner: \u2026 this baffles me.  I really don&#39;t feel like that should work at all!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1473356724, "post_id": 39396485, "comment_id": 66120334, "body": "@DanielWagner, it probably reuses some of the same-RHS logic used to check open type families. A bit unexpected, and I wonder just where it shouts &quot;Surprise!&quot; and breaks down, but definitely cool."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1473359091, "post_id": 39396485, "comment_id": 66121570, "body": "@DanielWagner Aren&#39;t the clauses always tried in-order, in <i>closed</i> type families?"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1473359269, "post_id": 39396485, "comment_id": 66121661, "body": "@chi: Yes, but usually type variables don&#39;t reduce at all, because we don&#39;t know if they&#39;ll unify with the patterns or not. E.g., given <code>type family F x where { F () = Bool ; F a = a }</code>, then <code>:kind! forall a. F a</code> gives <code>forall a. F a :: * = F a</code>, because in some sense it&#39;s waiting to see if <code>a</code> is equal to <code>()</code> or not. But apparently, if the RHS is the same in all cases, then it reduces somehow! E.g., given <code>type family G x where { G () = () ; G a = a }</code>, you indeed have <code>:kind! forall a. G a</code> producing <code>forall a. G a :: * = a</code>. So this is (to me) quite astonishing."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1473359433, "post_id": 39396485, "comment_id": 66121742, "body": "@AntalSpector-Zabusky Ah, I misread <code>Simplify1 ((), a) = a</code> and couldn&#39;t see the issue. Intriguing."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1473359647, "post_id": 39396485, "comment_id": 66121859, "body": "@AntalSpector-Zabusky My guess is, whenever <code>F p = p&#39; ; F q = q&#39;</code>, compute the MGU <code>m</code> of <code>p,q</code> and check whether under that we have <code>p&#39;[m]=q&#39;[m]</code> syntactically. If so, add a third clause before the two stating <code>F p[m] = p&#39;[m]</code>. The syntactic check could be smarter, of course -- this is a fragile heuristics, but I can&#39;t believe GHC can afford much more than this."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1473360415, "post_id": 39396485, "comment_id": 66122260, "body": "@chi What is the MGU of <code>(x,())</code> and <code>((),y)</code>? Is it not <code>x ~ (), y ~ ()</code>? If so, how does an extra clause <code>Simplify1 ((), ()) = ()</code> at the start help?"}], "tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 10, "last_activity_date": 1473353715, "creation_date": 1473353715, "answer_id": 39396485, "question_id": 39396195, "link": "https://stackoverflow.com/questions/39396195/type-reduction-infinite-loop/39396485#39396485", "title": "Type reduction infinite loop", "body": "<p>Type family evaluation isn't lazy, so <code>If c t f</code> will evaluate all of <code>c</code>, <code>t</code>, and <code>f</code>.  (In fact, type family evaluation order isn't really defined at all right now.)  So it's no wonder you end up with an infinite loop \u2013 you always evaluate <code>Simplify (op (Simplify x) (Simplify y))</code>, even when that's <code>Simplify (op x y)</code>!</p>\n\n<p>You can avoid this by splitting the recursion and the simplification apart, like so:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nmodule Simplify where\n\nimport Data.Type.Bool\nimport Data.Type.Equality\n\ntype family Simplify1 x where\n  Simplify1 (op () x) = x\n  Simplify1 (op x ()) = x\n  Simplify1 (op x y)  = op (Simplify1 x) (Simplify1 y)\n  Simplify1 x         = x\n\ntype family SimplifyFix x x' where\n  SimplifyFix x x  = x\n  SimplifyFix x x' = SimplifyFix x' (Simplify1 x')\n\ntype Simplify x = SimplifyFix x (Simplify1 x)\n</code></pre>\n\n<p>The idea is:</p>\n\n<ol>\n<li><code>Simplify1</code> does one step of simplification.</li>\n<li><code>SimplifyFix</code> takes <code>x</code> and its one-step simplification <code>x'</code>, checks if they're equal, and if they aren't does another step of simplification (thus finding the fixed point of <code>Simplify1</code>).</li>\n<li><code>Simplify</code> just starts off the <code>SimplifyFix</code> chain with a call to <code>Simplify1</code>.</li>\n</ol>\n\n<p>Since type family <em>pattern matching</em> is lazy, <code>SimplifyFix</code> correctly delays evaluation, preventing infinite loops.</p>\n\n<p>And indeed:</p>\n\n<pre><code>*Simplify&gt; :kind! Simplify (String, Int)\nSimplify (String, Int) :: *\n= (String, Int)\n\n*Simplify&gt; :kind! Simplify (String, ((), (Int, ())))\nSimplify (String, ((), (Int, ()))) :: *\n= ([Char], Int)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 3, "last_activity_date": 1473444789, "last_edit_date": 1473444789, "creation_date": 1473423931, "answer_id": 39411571, "question_id": 39396195, "link": "https://stackoverflow.com/questions/39396195/type-reduction-infinite-loop/39411571#39411571", "title": "Type reduction infinite loop", "body": "<p>I thought I'd mention that given that the simplification has the structure of a fold, there is no need to build this complex solution involving a fixpoint which re-traverses the expression again and again.</p>\n\n<p>This will do just fine:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies         #-}\n{-# LANGUAGE UndecidableInstances #-}\nmodule Simplify where\n\ntype family Simplify x where\n  Simplify (op a b) = Op op (Simplify a) (Simplify b)\n  Simplify x        = x\n\ntype family Op op a b where\n  Op op () b = b\n  Op op a () = a\n  Op op a b  = op a b\n</code></pre>\n"}], "owner": {"reputation": 2535, "user_id": 634020, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/044be669886e6b2e625776ff8be167b7?s=128&d=identicon&r=PG", "display_name": "Philip Kamenarsky", "link": "https://stackoverflow.com/users/634020/philip-kamenarsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 1, "accepted_answer_id": 39396485, "answer_count": 2, "score": 8, "last_activity_date": 1473444789, "creation_date": 1473352629, "question_id": 39396195, "link": "https://stackoverflow.com/questions/39396195/type-reduction-infinite-loop", "title": "Type reduction infinite loop", "body": "<p>My aim is to eliminate <code>()</code> from terms, like this:</p>\n\n<pre><code>(a, b)       -&gt; (a, b)\n((), b)      -&gt; b\n(a, ((), b)) -&gt; (a, b)\n...\n</code></pre>\n\n<p>And this is the code:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nmodule Simplify where\n\nimport Data.Type.Bool\nimport Data.Type.Equality\n\ntype family Simplify x where\n  Simplify (op () x) = Simplify x\n  Simplify (op x ()) = Simplify x\n  Simplify (op x y)  = If (x == Simplify x &amp;&amp; y == Simplify y)\n                          (op x y)\n                          (Simplify (op (Simplify x) (Simplify y)))\n  Simplify x         = x\n</code></pre>\n\n<p>However, trying it out:</p>\n\n<pre><code>:kind! Simplify (String, Int)\n</code></pre>\n\n<p>...leads to an infinite loop in the type checker. I'm thinking the <code>If</code> type family should be taking care of irreducible terms, but I'm obviously missing something. But what?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 4, "creation_date": 1473350905, "post_id": 39395663, "comment_id": 66117383, "body": "Because it is a <code>do</code>-block and you need <code>let</code>."}, {"owner": {"reputation": 411, "user_id": 2792270, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/29fcf99f59fa019c10273e5c1e529df5?s=128&d=identicon&r=PG&f=1", "display_name": "M&#229;ns Nilsson", "link": "https://stackoverflow.com/users/2792270/m%c3%a5ns-nilsson"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1473351193, "post_id": 39395663, "comment_id": 66117551, "body": "If I add let at the beginning of that row I get &quot;parse error in let binding: missing required &#39;in&#39;&quot; instead."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1473366692, "post_id": 39395935, "comment_id": 66125435, "body": "Most Haskell code uses indentation, but braces and semicolons are legitimate."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1473368554, "post_id": 39395935, "comment_id": 66126326, "body": "@ThomasM.DuBuisson legit, yes, but imo they should be omitted where they are not necessary when you use multiple lines. I see them only in one-liners."}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": true, "score": 4, "last_activity_date": 1473351629, "creation_date": 1473351629, "answer_id": 39395935, "question_id": 39395663, "link": "https://stackoverflow.com/questions/39395663/parse-error-on-input/39395935#39395935", "title": "Parse error on input", "body": "<p>You are missing a <code>let</code> for the declaration of <code>t</code>, and you should use some indentation instead of braces and semicolons:</p>\n\n<pre><code>module Main where\n\nimport System.IO\nimport Data.List.Split\n\nmain = do\n  flag &lt;- isEOF\n  if flag\n    then return 0\n    else do\n      s &lt;- getLine\n      let t = 1\n      print s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": false, "score": 0, "last_activity_date": 1473376193, "creation_date": 1473376193, "answer_id": 39401468, "question_id": 39395663, "link": "https://stackoverflow.com/questions/39395663/parse-error-on-input/39401468#39401468", "title": "Parse error on input", "body": "<p>As others have noted, you have missed a <code>let</code> keyword before <code>t = 1</code>. I was surprised to see that you still get a parse error once this is added.</p>\n\n<p>A syntactically valid solution with braces and semicolons as in your original example is:</p>\n\n<pre><code>module Main where\nimport System.IO\nimport Data.List.Split\nmain = do {\n    flag &lt;- isEOF;\n    if flag then return 0\n    else do { s &lt;- getLine\n            ; let t = 1\n            ; print s\n            }\n}\n</code></pre>\n\n<p>In order to get it to compile you can change <code>return 0</code> to <code>return ()</code>:</p>\n\n<pre><code>module Main where\nimport System.IO\nimport Data.List.Split\nmain = do {\n    flag &lt;- isEOF;\n    if flag then return ()\n    else do { s &lt;- getLine\n            ; let t = 1\n            ; print s\n            }\n}\n</code></pre>\n"}], "owner": {"reputation": 411, "user_id": 2792270, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/29fcf99f59fa019c10273e5c1e529df5?s=128&d=identicon&r=PG&f=1", "display_name": "M&#229;ns Nilsson", "link": "https://stackoverflow.com/users/2792270/m%c3%a5ns-nilsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 39395935, "answer_count": 2, "score": 0, "last_activity_date": 1473376193, "creation_date": 1473350795, "last_edit_date": 1473359663, "question_id": 39395663, "link": "https://stackoverflow.com/questions/39395663/parse-error-on-input", "title": "Parse error on input", "body": "<p>Why does this Haskell code produce <code>Parse error on input '='</code> at row 9 (<code>t = 1</code>)?</p>\n\n<pre><code>module Main where\nimport System.IO\nimport Data.List.Split\nmain = do {\n    flag &lt;- isEOF;\n    if flag then return 0\n    else do {\n        s &lt;- getLine;\n        t = 1;\n        print s;\n    }\n}\n</code></pre>\n"}, {"tags": ["haskell", "ghc-generics"], "comments": [{"owner": {"reputation": 381, "user_id": 4779636, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XfZbZzafRNw/AAAAAAAAAAI/AAAAAAAADqc/jZKyixgEiK4/photo.jpg?sz=128", "display_name": "David Fox", "link": "https://stackoverflow.com/users/4779636/david-fox"}, "edited": false, "score": 0, "creation_date": 1473353083, "post_id": 39395212, "comment_id": 66118514, "body": "I think the answer may be Data.Generics.Uniplate.Operations."}, {"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "edited": false, "score": 1, "creation_date": 1473378052, "post_id": 39395212, "comment_id": 66129387, "body": "Where are the definitions of <code>Name</code> and <code>NameS</code>?"}, {"owner": {"reputation": 381, "user_id": 4779636, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XfZbZzafRNw/AAAAAAAAAAI/AAAAAAAADqc/jZKyixgEiK4/photo.jpg?sz=128", "display_name": "David Fox", "link": "https://stackoverflow.com/users/4779636/david-fox"}, "reply_to_user": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "edited": false, "score": 0, "creation_date": 1473467747, "post_id": 39395212, "comment_id": 66167611, "body": "They are from Language.Haskell.TH.Syntax - i.e. template-haskell."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473662402, "post_id": 39443443, "comment_id": 66211074, "body": "For <code>V1</code> with recent GHC, I&#39;d go for <code>gfriendlyNames v = case v of {}</code>. I think that expresses the point more clearly."}, {"owner": {"reputation": 381, "user_id": 4779636, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XfZbZzafRNw/AAAAAAAAAAI/AAAAAAAADqc/jZKyixgEiK4/photo.jpg?sz=128", "display_name": "David Fox", "link": "https://stackoverflow.com/users/4779636/david-fox"}, "edited": false, "score": 0, "creation_date": 1554155938, "post_id": 39443443, "comment_id": 97640365, "body": "This doesn&#39;t seem to do what syb does - an syb function will work on <i>any</i> instance of Data, finding embedded Name values and modifying them.  This GHC.Generics function does not work on just any instance of Generic, it only works on explicitly declared FriendlyNames instances.  How is this more powerful than a conventional typeclass?"}], "tags": [], "owner": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "is_accepted": false, "score": 4, "last_activity_date": 1473655522, "last_edit_date": 1473655522, "creation_date": 1473655169, "answer_id": 39443443, "question_id": 39395212, "link": "https://stackoverflow.com/questions/39395212/how-do-i-replace-data-generics-with-ghc-generics/39443443#39443443", "title": "How do I replace Data.Generics with GHC.Generics?", "body": "<p>This might be the wrong problem to solve with GHC.Generics, but here's now you'd do it!</p>\n\n<pre><code>{-# Language TypeOperators #-}\n{-# Language DeriveGeneric #-}\n{-# Language DefaultSignatures #-}\n{-# Language FlexibleContexts #-}\nmodule Demo where\n\nimport GHC.Generics\nimport Language.Haskell.TH\nimport Language.Haskell.TH.Syntax\n\ndata Record = Record { field0 :: Int, field1 :: Maybe Record, field2 :: Name } deriving Generic\n\ninstance FriendlyNames Record -- body omitted and derived with GHC.Generics\ninstance FriendlyNames a =&gt; FriendlyNames (Maybe a)\ninstance FriendlyNames Int where friendlyNames = id -- no-op\n\n------------------------------------------------------------------------\n\n-- | Class for types that can be made friendly\nclass FriendlyNames a where\n  friendlyNames :: a -&gt; a\n  default friendlyNames :: (GFriendlyNames (Rep a), Generic a) =&gt; a -&gt; a\n  friendlyNames = to . gfriendlyNames . from\n\n-- | Replaces the second component of a name with 'NameS'\ninstance FriendlyNames Name where\n  friendlyNames (Name x _) = Name x NameS\n\n------------------------------------------------------------------------\n\n-- | Class for generic structures that can have names made friendly\nclass GFriendlyNames f where\n  gfriendlyNames :: f p -&gt; f p\n\n-- | Case for metadata (type constructor, data constructor, field selector)\ninstance GFriendlyNames f =&gt; GFriendlyNames (M1 i c f) where\n  gfriendlyNames (M1 x) = M1 (gfriendlyNames x)\n\n-- | Case for product types\ninstance (GFriendlyNames f, GFriendlyNames g) =&gt; GFriendlyNames (f :*: g) where\n  gfriendlyNames (x :*: y) = gfriendlyNames x :*: gfriendlyNames y\n\n-- | Case for sum types\ninstance (GFriendlyNames f, GFriendlyNames g) =&gt; GFriendlyNames (f :+: g) where\n  gfriendlyNames (L1 x) = L1 (gfriendlyNames x)\n  gfriendlyNames (R1 y) = R1 (gfriendlyNames y)\n\n-- | Case for datatypes without any data constructors (why not?)\ninstance GFriendlyNames V1 where\n  gfriendlyNames v1 = v1 `seq` error \"gfriendlyNames.V1\"\n\n-- | Case for datatypes without any fields\ninstance GFriendlyNames U1 where\n  gfriendlyNames U1 = U1\n\n-- | Case for data constructor fields\ninstance FriendlyNames a =&gt; GFriendlyNames (K1 i a) where\n  gfriendlyNames (K1 x) = K1 (friendlyNames x)\n</code></pre>\n\n<p>The GHC.Generics approach is more suited to situations where this kind of complexity can be written once and hidden away in a library. While the SYB approach relies on runtime checks, observe the GHC core that is generated for a friendlyNames that makes Record values friendly</p>\n\n<pre><code>-- RHS size: {terms: 14, types: 18, coercions: 0}\nrecordFriendlyNames\nrecordFriendlyNames =\n  \\ w_s63w -&gt;\n    case w_s63w of _ { Record ww1_s63z ww2_s63A ww3_s63B -&gt;\n    case $recordFriendlyNames ww1_s63z ww2_s63A ww3_s63B\n    of _ { (# ww5_s63H, ww6_s63I, ww7_s63J #) -&gt;\n    Record ww5_s63H ww6_s63I ww7_s63J\n    }\n    }\n\n-- RHS size: {terms: 19, types: 19, coercions: 0}\n$recordFriendlyNames\n$recordFriendlyNames =\n  \\ ww_s63z ww1_s63A ww2_s63B -&gt;\n    (# ww_s63z,\n       case ww1_s63A of _ {\n         Nothing -&gt; Nothing;\n         Just g1_a601 -&gt; Just (recordFriendlyNames g1_a601)\n       },\n       case ww2_s63B of _ { Name x_a3Z3 ds_d5Z5 -&gt; Name x_a3Z3 NameS } #)\n</code></pre>\n"}], "owner": {"reputation": 381, "user_id": 4779636, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XfZbZzafRNw/AAAAAAAAAAI/AAAAAAAADqc/jZKyixgEiK4/photo.jpg?sz=128", "display_name": "David Fox", "link": "https://stackoverflow.com/users/4779636/david-fox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1473655522, "creation_date": 1473349390, "question_id": 39395212, "link": "https://stackoverflow.com/questions/39395212/how-do-i-replace-data-generics-with-ghc-generics", "title": "How do I replace Data.Generics with GHC.Generics?", "body": "<p>So I've used syb for a long time, and often have functions like</p>\n\n<pre><code>friendlyNames :: Data a =&gt; a -&gt; a\nfriendlyNames = everywhere (mkT (\\(Name x _) -&gt; Name x NameS))\n</code></pre>\n\n<p>What is the equivalent of this using GHC.Generics, assuming Generic a?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 1, "creation_date": 1473351056, "post_id": 39395021, "comment_id": 66117474, "body": "The simplest thing to do is just uncurry the function so there is, in fact, only one argument: <code>maxCuts :: (Int, Int, Int, Int) -&gt; Int</code>"}], "answers": [{"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 2, "last_activity_date": 1473351048, "creation_date": 1473351048, "answer_id": 39395743, "question_id": 39395021, "link": "https://stackoverflow.com/questions/39395021/memoization-of-a-single-parameter-in-a-multi-parameter-function-in-haskell/39395743#39395743", "title": "Memoization of a single parameter in a multi-parameter function in Haskell", "body": "<p>Rewrite your function definition like this:</p>\n\n<pre><code> maxCuts :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int\n maxCuts n a b c = maxCuts' n where\n     maxCuts' n\n          | n == 0    = 0\n          | n &lt; 0     = -10000\n          | otherwise = max (max amax bmax) cmax\n            where \n               amax = 1 + maxCuts' (n - a)  \n               bmax = 1 + maxCuts' (n - b) \n               cmax = 1 + maxCuts' (n - c)\n</code></pre>\n\n<p>Now you have a one-argument function you can memoize.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1473352141, "last_edit_date": 1473352141, "creation_date": 1473351458, "answer_id": 39395873, "question_id": 39395021, "link": "https://stackoverflow.com/questions/39395021/memoization-of-a-single-parameter-in-a-multi-parameter-function-in-haskell/39395873#39395873", "title": "Memoization of a single parameter in a multi-parameter function in Haskell", "body": "<p>Aside: Isn't your algorithm just computing something like <code>div n (minimum [a,b,c])</code>?</p>\n\n<p>As you pointed out, the parameters a, b and c don't change, so first rewrite the function to place the parameter <code>n</code> at the end.</p>\n\n<p>If you decide to use a list to memoize the function values it requires\na little care to make sure GHC will save the mapped list:</p>\n\n<pre><code>import Debug.Trace\n\nmaxCuts' :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int\nmaxCuts' a b c n = memoized_go n\n  where\n    memoized_go n\n      | n &lt; 0 = -10000\n      | otherwise =  mapped_list !! n\n\n    mapped_list = map go [0..]\n\n    go n | trace msg False = undefined\n      where msg = \"go called for \" ++ show n\n    go 0 = 0\n    go n = maximum [amax, bmax, cmax]\n      where\n        amax = 1 + memoized_go (n-a)\n        bmax = 1 + memoized_go (n-b)\n        cmax = 1 + memoized_go (n-c)\n\ntest1 = print $ maxCuts' 1 2 3 10\n</code></pre>\n\n<p>Note the circular dependency of the definitions: <code>memoized_go</code> depends on <code>mapped_list</code> which depends on <code>go</code> which depends on <code>memozied_go</code>.</p>\n\n<p>Since lists only admit non-negative indexes, the case <code>n &lt; 0</code> has to be\nhandled in a separate guard pattern.</p>\n\n<p>The <code>trace</code> calls show that <code>go</code> is only called once per value of <code>n</code>.\nFor instance, consider trying to do this without defining <code>mapped_list</code>:</p>\n\n<pre><code>maxCuts2 :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int\nmaxCuts2 a b c n = memoized_go n\n  where\n    memoized_go n\n      | n &lt; 0 = -10000\n      | otherwise =  (map go [0..]) !! n\n    -- mapped_list = map go [0..]\n    go n | trace msg False = undefined\n      where msg = \"go called for \" ++ show n\n    go 0 = 0\n    go n = maximum [amax, bmax, cmax]\n      where\n        amax = 1 + memoized_go (n-a)\n        bmax = 1 + memoized_go (n-b)\n        cmax = 1 + memoized_go (n-c)\n\ntest2 = print $ maxCuts2 1 2 3 11\n</code></pre>\n\n<p>Running <code>test2</code> shows that <code>go</code> is called multiple times for the same value of <code>n</code>.</p>\n\n<p><strong>Update</strong></p>\n\n<p>To avoid creating large unevaluated thunks, I would use BangPatterns\nfor <code>amax</code>, <code>bmax</code> and <code>cmax</code>:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nmaxCuts' ... =\n  ...\n  where\n    !amax = 1 + ...\n    !bmax = 1 + ...\n    !cmax = 1 + ...\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 4062061, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wMhMb.jpg?s=128&g=1", "display_name": "Gaston Gilbert", "link": "https://stackoverflow.com/users/4062061/gaston-gilbert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1473352141, "creation_date": 1473348794, "last_edit_date": 1473349274, "question_id": 39395021, "link": "https://stackoverflow.com/questions/39395021/memoization-of-a-single-parameter-in-a-multi-parameter-function-in-haskell", "title": "Memoization of a single parameter in a multi-parameter function in Haskell", "body": "<p>I am solving <a href=\"http://codeforces.com/problemset/problem/189/A\" rel=\"nofollow\">this programming problem</a>, and I am exceeding the time limit with my current solution. I believe that the solution to my problem is memoization. However, I do not understand the memoization solutions documented <a href=\"https://wiki.haskell.org/Memoization\" rel=\"nofollow\">here</a>.</p>\n\n<p>Here is the primary function in my current solution.</p>\n\n<pre><code>maxCuts :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int\nmaxCuts n a b c  \n    | n == 0    = 0\n    | n &lt; 0     = -10000\n    | otherwise = max (max amax bmax) cmax\n    where \n        amax = 1 + maxCuts (n - a) a b c\n        bmax = 1 + maxCuts (n - b) a b c\n        cmax = 1 + maxCuts (n - c) a b c\n</code></pre>\n\n<p>This function takes too long to run if a b and c are small relative to n. I would just copy the solution they used for the factorial function, but that function only takes one parameter. I have four parameters, but I only want to key the memoiziation on the first parameter, <code>n</code>. Notice that <code>a</code> <code>b</code> and <code>c</code> do not change in the recursive calls. </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 1, "last_activity_date": 1473346280, "creation_date": 1473346280, "answer_id": 39394072, "question_id": 39393984, "link": "https://stackoverflow.com/questions/39393984/issue-with-printing-in-haskell-and-function-declaration/39394072#39394072", "title": "issue with printing in haskell and function declaration", "body": "<p>You've got a few errors.</p>\n\n<p>The error about ambiguous types can be fixed by adding a type annotation to <code>sumDig</code></p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>sumDig :: Int -&gt; Int\n</code></pre>\n\n<p>Another error is that <code>somaDig</code> is undefined. Did you mean to type <code>sumDig</code>?</p>\n\n<p>If so, then the last compile error is the use of <code>/</code> on integers. You probably want <code>div</code> instead:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>sumDig :: Int -&gt; Int\nsumDig i = if (i == 0) then 0 else ((mod i 10) + sumDig (((i-(mod i 10)) `div` 10)))\n</code></pre>\n"}], "owner": {"reputation": 5719, "user_id": 5348875, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e050e66d97a3f54b0453533428088e6c?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/5348875/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "accepted_answer_id": 39394072, "answer_count": 1, "score": -2, "last_activity_date": 1473346280, "creation_date": 1473345998, "question_id": 39393984, "link": "https://stackoverflow.com/questions/39393984/issue-with-printing-in-haskell-and-function-declaration", "title": "issue with printing in haskell and function declaration", "body": "<p>this is my code:</p>\n\n<pre><code>sumDig i = if (i == 0) then 0 else ((mod i 10) + somaDig ((i-(mod i 10)/10)))\n\n\nmain = do\n    print (sumDig 4)\n</code></pre>\n\n<p>it's not working and I dont know why... it doesn't compile and the compiler message is not helping</p>\n\n<p>the function is just to sum all characters of a given number, eg: 123 = 1 + 2 + 3 = 6, and it does that using n mod 10 + recursion from n/10</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 4881, "user_id": 947526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/6a84b61e353299d7f9306e99bfce8854?s=128&d=identicon&r=PG", "display_name": "C-Otto", "link": "https://stackoverflow.com/users/947526/c-otto"}, "edited": false, "score": 1, "creation_date": 1473342710, "post_id": 39392717, "comment_id": 66111609, "body": "In the <code>n &gt; 0</code> case, you would also need to decrease the following indices (not just the first)."}], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 6376286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29f9527237423285f50e51fc3e21fe99?s=128&d=identicon&r=PG&f=1", "display_name": "GlossMash", "link": "https://stackoverflow.com/users/6376286/glossmash"}, "edited": false, "score": 0, "creation_date": 1473343634, "post_id": 39392791, "comment_id": 66112297, "body": "I tried you code but it says <code>No instance for (Num (Int -&gt; Int)) in the first argument of map</code>, the error is at line of case <code>n==0</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 89, "user_id": 6376286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29f9527237423285f50e51fc3e21fe99?s=128&d=identicon&r=PG&f=1", "display_name": "GlossMash", "link": "https://stackoverflow.com/users/6376286/glossmash"}, "edited": false, "score": 0, "creation_date": 1473343703, "post_id": 39392791, "comment_id": 66112347, "body": "Because I still forget that negative literals are a pain in Haskell."}, {"owner": {"reputation": 1972, "user_id": 1747134, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/696bad3bd2c5e16ded04f3cdf436623f?s=128&d=identicon&r=PG", "display_name": "user1747134", "link": "https://stackoverflow.com/users/1747134/user1747134"}, "edited": false, "score": 0, "creation_date": 1473345214, "post_id": 39392791, "comment_id": 66113512, "body": "One could also simplify it a bit by using <code>pred</code> instead of <code>subtract 1</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473345552, "post_id": 39392791, "comment_id": 66113740, "body": "Ah, I forgot about <code>pred</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 3, "last_activity_date": 1473394227, "last_edit_date": 1473394227, "creation_date": 1473342712, "answer_id": 39392791, "question_id": 39392717, "link": "https://stackoverflow.com/questions/39392717/remove-elements-in-list-with-a-list-of-int-haskell/39392791#39392791", "title": "Remove elements in list with a list of Int (Haskell)", "body": "<p>You need to pass a new list, but every item in that list needs to be decremented, because you've shifted the positions of every element of the second argument. This is true whether or not you've actually removed the head element.</p>\n\n<pre><code>removeEl (n:ns) (x:xs) | n == 0 = removeEl (map pred ns) xs\n                       | n &gt; 0 = x:removeEl (map pred (n:ns)) xs\n</code></pre>\n\n<p>There's a lot of opportunity to refactor this, but nothing I've played with feels significantly simpler.</p>\n\n<p>Also, your first base case is wrong: with no items in the index list, you want to return <em>everything</em>, not <em>nothing</em>:</p>\n\n<pre><code>remove [] xs = xs\n</code></pre>\n\n<p>(Keep in mind this only works if the first argument is monotonically increasing.)</p>\n\n<hr>\n\n<p>You can also avoid the explicit recursion with a list comprehension:</p>\n\n<pre><code>removeEl ns xs = [x | (n,x) &lt;- zip [0..] xs, not(n `elem` ns)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 3, "last_activity_date": 1473347324, "last_edit_date": 1473347324, "creation_date": 1473346955, "answer_id": 39394344, "question_id": 39392717, "link": "https://stackoverflow.com/questions/39392717/remove-elements-in-list-with-a-list-of-int-haskell/39394344#39394344", "title": "Remove elements in list with a list of Int (Haskell)", "body": "<p>I believe your algorithm is <code>O(n*m)</code>, where <code>n</code> is the number of elements in the list and <code>m</code> is the number of indices to remove. It also has the unfortunate requirement that the list of indices must be ordered. Here's a <code>~O(n*log(m))</code> solution that doesn't require the indices be ordered.</p>\n\n<pre><code>import qualified Data.Set as Set\n\nremoveE1 indices xs = go 0 xs\n  where is = Set.fromList indices\n        go _ [] = []\n        go n (y:ys) | n `Set.member` is = go (n+1) ys\n                    | otherwise         = y : go (n+1) ys\n</code></pre>\n\n<p>And this could be improved a bit by using a hash map.</p>\n"}], "owner": {"reputation": 89, "user_id": 6376286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29f9527237423285f50e51fc3e21fe99?s=128&d=identicon&r=PG&f=1", "display_name": "GlossMash", "link": "https://stackoverflow.com/users/6376286/glossmash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "accepted_answer_id": 39392791, "answer_count": 2, "score": 2, "last_activity_date": 1473394227, "creation_date": 1473342537, "question_id": 39392717, "link": "https://stackoverflow.com/questions/39392717/remove-elements-in-list-with-a-list-of-int-haskell", "title": "Remove elements in list with a list of Int (Haskell)", "body": "<p>I am writing function that take a list of <code>Int</code>, a list of general type <code>a</code> and remove all elements that have index in the list of Int.</p>\n\n<p>For example: <code>removeEl [1,3,4] [1,2,3,4,5,6]</code> return <code>[1,3,6]</code>\nor <code>removeEl [1,2] \"Firefox\"</code> return <code>\"Fefox\"</code></p>\n\n<p>Here is my attempt:</p>\n\n<pre><code>removeEl :: [Int] -&gt; [a] -&gt; [a]\nremoveEl [] xs = []\nremoveEl ns [] = []\nremoveEl (n:ns) (x:xs) | n == 0 = removeEl ns xs\n                       | n &gt; 0 = x:removeEl (n-1) xs\n</code></pre>\n\n<p>I realize <code>(n-1)</code> is an <code>Int</code>, not <code>[Int]</code> so it fail. Do I need to write an auxiliary function to use?</p>\n"}, {"tags": ["haskell", "deriving", "newtype"], "answers": [{"comments": [{"owner": {"reputation": 1972, "user_id": 1747134, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/696bad3bd2c5e16ded04f3cdf436623f?s=128&d=identicon&r=PG", "display_name": "user1747134", "link": "https://stackoverflow.com/users/1747134/user1747134"}, "edited": false, "score": 0, "creation_date": 1473336523, "post_id": 39390181, "comment_id": 66107051, "body": "Thanks, I did not know the standalone deriving syntax. I am still interested, why 2 works."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 1, "creation_date": 1473347343, "post_id": 39390181, "comment_id": 66115043, "body": "The specific rule in the documentation says &quot;The rule is this: each constraint in the inferred instance context must consist only of type variables, with no repetitions.&quot; Apparently <code>Eq (f (maybe v))</code> qualifies`."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1473356273, "post_id": 39390181, "comment_id": 66120114, "body": "@AlexeyRomanov, that seems ... surprising. Am I correct in thinking that <code>FlexibleContexts</code> is an unintrusive extension that really just simplifies everything? Or does it have some unfortunate consequences like (some aspects of) <code>FlexibleInstances</code>?"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1473357816, "post_id": 39390181, "comment_id": 66120918, "body": "I&#39;ve undeleted my answer, since I found why 4 isn&#39;t allowed (I think)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1473335507, "creation_date": 1473335507, "answer_id": 39390181, "question_id": 39389412, "link": "https://stackoverflow.com/questions/39389412/deriving-in-newtype-with-more-type-variables/39390181#39390181", "title": "Deriving in newtype with more type variables", "body": "<p>I don't know why 2 works but 4 doesn't. Probably has something to do with flexible contexts (which I don't understand well enough to explain).</p>\n\n<p>To answer the second question... the preferred solution if you want a newtype like that is as GHC suggested: to use a standalone deriving instance.</p>\n\n<pre><code>{-# LANGUAGE StandaloneDeriving, FlexibleContexts, UndecidableInstances #-}\n\nnewtype MyNewtype4 f v = MyNewtype4 { getVal4 :: f (Maybe v) }\nderiving instance (Eq (f (Maybe v))) =&gt; Eq (MyNewtype4 f v)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1972, "user_id": 1747134, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/696bad3bd2c5e16ded04f3cdf436623f?s=128&d=identicon&r=PG", "display_name": "user1747134", "link": "https://stackoverflow.com/users/1747134/user1747134"}, "edited": false, "score": 0, "creation_date": 1473414144, "post_id": 39394278, "comment_id": 66141704, "body": "OK, but then what is the reason that the same error is raised even with -XUndecidableInstances?"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 1972, "user_id": 1747134, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/696bad3bd2c5e16ded04f3cdf436623f?s=128&d=identicon&r=PG", "display_name": "user1747134", "link": "https://stackoverflow.com/users/1747134/user1747134"}, "edited": false, "score": 0, "creation_date": 1473417962, "post_id": 39394278, "comment_id": 66143871, "body": "That&#39;s the sentence I didn&#39;t quote at the beginning: &quot;This rule is applied regardless of flags&quot;. They consider it unsafe enough that it should appear explicitly in code, so that if you do run into problems with termination you can more easily find it."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 3, "last_activity_date": 1473417596, "last_edit_date": 1473417596, "creation_date": 1473346801, "answer_id": 39394278, "question_id": 39389412, "link": "https://stackoverflow.com/questions/39389412/deriving-in-newtype-with-more-type-variables/39394278#39394278", "title": "Deriving in newtype with more type variables", "body": "<blockquote>\n  <p><a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#extensions-to-the-deriving-mechanism\" rel=\"nofollow\">The third [generated instance] is not Haskell 98, and risks losing termination of instances. GHC takes a conservative position: it accepts the first two, but not the third. The rule is this: each constraint in the inferred instance context must consist only of type variables, with no repetitions. This rule is applied regardless of flags. If you want a more exotic context, you can write it yourself, using the standalone deriving mechanism.</a> </p>\n</blockquote>\n\n<p>I think <code>MyNewType4</code> is considered unsafe and so not allowed to be derived because it violates the second Paterson condition:</p>\n\n<blockquote>\n  <p><a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#instance-termination\" rel=\"nofollow\">2.The constraint has fewer constructors and variables (taken together and counting repetitions) than the head</a></p>\n</blockquote>\n\n<p><code>MyNewtype4 f v</code> has 3, and so does <code>f (Maybe v)</code>. <code>MyNewtype2 f maybe v</code> has 4, and so <code>instance (Eq (f (maybe v))) =&gt; MyNewtype2 f maybe v</code> obeys the condition (and so does any case following the rule quoted at the beginning).</p>\n"}], "owner": {"reputation": 1972, "user_id": 1747134, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/696bad3bd2c5e16ded04f3cdf436623f?s=128&d=identicon&r=PG", "display_name": "user1747134", "link": "https://stackoverflow.com/users/1747134/user1747134"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 39394278, "answer_count": 2, "score": 3, "last_activity_date": 1473417596, "creation_date": 1473333154, "question_id": 39389412, "link": "https://stackoverflow.com/questions/39389412/deriving-in-newtype-with-more-type-variables", "title": "Deriving in newtype with more type variables", "body": "<pre><code>newtype MyNewtype1 f v = MyNewtype1 { getVal1 :: f v } deriving Eq -- OK\nnewtype MyNewtype2 f maybe v = MyNewtype2 { getVal2 :: f (maybe v) } deriving Eq --OK\nnewtype MyNewtype3 f v = MyNewtype3 { getVal3 :: f (Maybe v) } --  OK\nnewtype MyNewtype4 f v = MyNewtype4 { getVal4 :: f (Maybe v) } deriving Eq --NOT OK\n</code></pre>\n\n<p>I have these newtypes. The first three work as expected, but the fourth gives:</p>\n\n<pre><code>    \u2022 No instance for (Eq (f (Maybe v)))\n        arising from the 'deriving' clause of a data type declaration\n      Possible fix:\n        use a standalone 'deriving instance' declaration,\n          so you can specify the instance context yourself\n    \u2022 When deriving the instance for (Eq (MyNewtype4 f v))\n</code></pre>\n\n<p>I can't understand where is the problem. It seems to me, that the second newtype is strictly more general and thus have to suffer the same problem. So if <code>MyNewtype2</code> can derive Eq, why <code>MyNewtype2</code> can not?  That's probably what confuses me the  most. Could somebody please explain this to me? Also, what is the preferred solution to if I want a newtype like that?</p>\n"}, {"tags": ["haskell", "functional-programming", "command-line-arguments", "fizzbuzz"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 5, "creation_date": 1473311989, "post_id": 39382857, "comment_id": 66093366, "body": "<code>fizzBuzz :: Args -&gt; IO ()</code> says that <code>fizzBuzz</code> is a function taking an <code>Args</code> as a parameter and returning a <code>IO ()</code>. But then <code>fizzBuzz opts i</code> declares two arguments. And in all of the cases it tries to return a string."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1473337930, "post_id": 39382857, "comment_id": 66108030, "body": "If you are a beginner, I&#39;d go for a simpler approach and avoid optparse-applicative. Just use <code>[s1,s2,s3] &lt;- getArgs</code> to get three strings from the args, convert them to numbers with <code>read</code>, and move on. For bonus points, later on, handle the wrong arguments case (not three / not numeric) using <code>reads</code> or <code>readMaybe</code>. But first, learn about how to use the IO monad using a good tutorial."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1473342688, "post_id": 39382857, "comment_id": 66111592, "body": "You&#39;ll also need to somehow tell it to do all that for all the numbers in <code>[1..upperBound]</code>."}, {"owner": {"reputation": 1, "user_id": 5380534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AS7Rl.jpg?s=128&g=1", "display_name": "selfresonator", "link": "https://stackoverflow.com/users/5380534/selfresonator"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1473367552, "post_id": 39382857, "comment_id": 66125848, "body": "@chi okay i figured as much, def need to hit up more tutorials. in my update i use list comprehension like @Gurkenglas mentions in order to create a list to run against <code>fizzBuzz</code>. so with the updated code that i posted, my main problem i am running into the problem of <code>s1</code> and <code>s2</code> not being in scope. i feel like i am close here."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1473369766, "post_id": 39382857, "comment_id": 66126852, "body": "@selfresonator Add two parameters to <code>fizzBuzz</code>."}, {"owner": {"reputation": 1, "user_id": 5380534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AS7Rl.jpg?s=128&g=1", "display_name": "selfresonator", "link": "https://stackoverflow.com/users/5380534/selfresonator"}, "reply_to_user": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1473372765, "post_id": 39382857, "comment_id": 66127978, "body": "@molbdnilo something like <code>fizzBuzz i j k  | i mod</code>...etc.? when i do this i get that all three arguments are out of scope. now when i move the m line up into the correct scope(and change the <code>=</code> to <code>&lt;-</code>), i still end up with the <code>Couldn&#39;t match expected type \u2018IO String with actual type \u2018[[Char]]\u2019</code> error. I&#39;ve been trying to understand the types better but I think I am mistaken when i write <code>main IO ()</code>, isnt that saying that main returns an action? How should I convert"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1473373204, "post_id": 39400923, "comment_id": 66128133, "body": "Is it intentional that <code>read</code> does not appear in the first solution?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1473373578, "post_id": 39400923, "comment_id": 66128250, "body": "No, I overlooked it at the beginning."}, {"owner": {"reputation": 1, "user_id": 5380534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AS7Rl.jpg?s=128&g=1", "display_name": "selfresonator", "link": "https://stackoverflow.com/users/5380534/selfresonator"}, "edited": false, "score": 0, "creation_date": 1473374758, "post_id": 39400923, "comment_id": 66128562, "body": "thank you for clarifying some things i was wondering but not asking @leftaroundabout. figuring out the type signature for fizzbuzz was definitely in my way. now lets say i dont go with my second solutions work and go with the first. lets say ive got the correct type sig now, I get a <code>No instance for (Show(Args -&gt; Int -&gt; String))</code>. im guessing i need something like <code>instance show (some code)</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1, "user_id": 5380534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AS7Rl.jpg?s=128&g=1", "display_name": "selfresonator", "link": "https://stackoverflow.com/users/5380534/selfresonator"}, "edited": false, "score": 0, "creation_date": 1473374817, "post_id": 39400923, "comment_id": 66128577, "body": "@selfresonator That means you are trying to print a function, instead of the result of the function. Check you are passing all the args to the function whose result you want to print."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473378869, "post_id": 39400923, "comment_id": 66129558, "body": "<code>read</code> doesn&#39;t seem a good way to deal with command-line arguments, even in a simple example. Why not use <code>traverse readMaybe</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1473411648, "post_id": 39400923, "comment_id": 66140207, "body": "Yeah, but does that really improve anything? You&#39;d still not get any understandable error message with that approach. If <code>read</code> didn&#39;t give quite to cryptic errors, then I&#39;d say it would actually be fine to use it for parsing command-line options (a program with wrong cmd options may crash anyway, it just shouldn&#39;t do so in a totally inexplicable way)."}, {"owner": {"reputation": 1, "user_id": 5380534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AS7Rl.jpg?s=128&g=1", "display_name": "selfresonator", "link": "https://stackoverflow.com/users/5380534/selfresonator"}, "edited": false, "score": 0, "creation_date": 1473470348, "post_id": 39400923, "comment_id": 66168038, "body": "@leftaroundabout took your advice here with getArgs, and got the solution i was looking for. optparse-applicative is definitely overkill. i initially wanted to put the fizzbuzz inside of the main do but, when going with my other solution, the compiler threw errors because of the scope issue that you so explicitly reminded me of. thank you very much, much appreciated."}, {"owner": {"reputation": 1, "user_id": 5380534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AS7Rl.jpg?s=128&g=1", "display_name": "selfresonator", "link": "https://stackoverflow.com/users/5380534/selfresonator"}, "edited": false, "score": 0, "creation_date": 1473726503, "post_id": 39400923, "comment_id": 66242075, "body": "@leftaroundabout btw what does the <code>&lt;$&gt;</code> do exactly? is that a haskell templates thing? i understand the usage of <code>$</code> in stead of typing parens everywhere. but im confused why it wouldnt work with just <code>$</code> in this case, in order to pass the getargs as as an arg to the result of <code>map read</code>. whats the difference between <code>$</code> and <code>&lt;$&gt;</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1473726847, "post_id": 39400923, "comment_id": 66242130, "body": "<code>&lt;$&gt;</code>, as <a href=\"https://hayoo.fh-wedel.de/?query=%3C%24%3E\" rel=\"nofollow noreferrer\">Hayoo could have told you</a>, applies a function to a value contained in a monadic action (or more generally in a functor). <code>f &lt;$&gt; m</code> is equivalent to <code>fmap f $ m</code> (or simply <code>fmap f m</code>). In case of IO, it allows you to apply a function to the result-value of some action (such as <code>getArgs</code>), without needing to first give that value any name. Instead of <code>do { y &lt;- f &lt;$&gt; act; ... }</code> you could also write this: <code>do { x &lt;- act; let y = f x; ... }</code>. But this introduces quite unnecessarily the variable <code>x</code> \u2013 if you never use it again, useless."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1473373553, "last_edit_date": 1473373553, "creation_date": 1473372558, "answer_id": 39400923, "question_id": 39382857, "link": "https://stackoverflow.com/questions/39382857/how-do-i-match-types-in-haskell-so-the-expected-type-matches-the-actual-type/39400923#39400923", "title": "How do I match types in Haskell so the expected type matches the actual type?", "body": "<blockquote>\n  <p>How can I access those args outside of the scope of main?</p>\n</blockquote>\n\n<p><em>You can't</em>. That precisely the point of a scope: variables inside stay inside, nicely encapsulated, preventing any hard-to-trace data dependencies.</p>\n\n<p>The easiest way to accomplish the goal of accessing <code>s1</code> <code>s2</code> <code>s3</code> is to simply define <code>fizzbuzz</code> <em>in</em> the scope of main:</p>\n\n<pre><code>main :: IO ()\nmain = do\n   [s1,s2,s3] &lt;- map read&lt;$&gt;getArgs  -- more on this later\n   let fizzBuzz i\n         | i `mod` s1 == 0 &amp;&amp; s1 `mod` s2 == 0 = \"fizzBuzz\"\n         | i `mod` s1 == 0 = \"fizz\"\n         | i `mod` s2 == 0 = \"buzz\"\n         | otherwise = show i\n       m = [fizzBuzz i| i &lt;-[1..s3]]\n   print m\n</code></pre>\n\n<p>However, that's not necessarily the best approach \u2013 you'd essentially create one big pseudo-global IO scope. Mind, this is nowhere as dangerous as global variables in imperative languages, but at least if you want to also use <code>fizzBuzz</code> in some other context, this is clearly not optimal.</p>\n\n<p>The correct way is, of course, to pass in those variables as <em>function arguments</em>. Quite like you already had it \u2013 I find it strange that you removed this again.</p>\n\n<p>So, first of all figure out the signature of <code>fizzBuzz</code>. What does it need, and what does it yield? Well, it needs all those divisors. Hence it actually made a lot of sense to give it an <code>Args</code> argument. But it also needs the number <code>i</code>, which is simply an <code>Int</code>. As for the result... why would it be <code>IO ()</code>? fizzBuzz is a perfectly good pure function, yielding a string. So...</p>\n\n<pre><code>fizzBuzz :: Args -&gt; Int -&gt; String\n</code></pre>\n\n<p>Well, now you're fine. The <em>definition</em> actually looks completely right the way you've originally had it. (But generally, it's much more sensible to <em>first</em> get the type signature right, then worry about how to actually implement it.)</p>\n\n<p>Now you just need to invoke this function. I'd first play around with it in GHCi a bit before writing any <code>main</code> function at all:</p>\n\n<pre><code>$ ghci FizzBuzz.hs\nGHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( FizzBuzz.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; fizzBuzz (Args 3 4 9) 3\n\"fizz\"\n*Main&gt; fizzBuzz (Args 3 4 9) 5\n\"5\"\n...\n</code></pre>\n\n<p>If you think that it works right, you may wrap it into an actual program.</p>\n\n<p>Note that the <code>Args</code> data structure doesn't really have anything to do with the <code>OptParse</code> library. That library makes sense to use for proper command-line programs, but it's overkill here. Nevertheless, it makes a lot of sense to use the <code>Args</code> type for passing those divisors into the function, as I've already showed.</p>\n\n<p>I'd now just use <code>getArgs</code> for fetching the arguments, and manually wrap them into the <code>Args</code> structure:</p>\n\n<pre><code>module Main where\n\nimport System.Environment (getArgs)\n\nmain :: IO ()\nmain = do\n   [s\u2081,s\u2082,s\u2083] &lt;- getArgs\n   let divisors = Args (read s\u2081) (read s\u2082) (read s\u2083)\n   m = [fizzBuzz divisors i | i&lt;-[1..read s\u2083]]\n   print m\n</code></pre>\n\n<p>You may wonder what's up with all that <code>read</code>. Well, <code>getArgs</code> gives you the command-line parameters as they come from the shell: as strings. But you need to interpret, i.e. <em>read</em> those strings as integers. Note that <code>read</code> is pretty unsafe: if the input is not a valid integer literal, the program will crash. Probably not a problem for you right now, but this is one of the things that <code>optparse</code> would nicely solve for you.</p>\n\n<p>Since you don't really need the parameters in string form at all, you might just as well <code>read</code> <em>all</em> of them before even matching out the individual parameters:</p>\n\n<pre><code>main :: IO ()\nmain = do\n   [s\u2081,s\u2082,s\u2083] &lt;- map read &lt;$&gt; getArgs\n   let divisors = Args s\u2081 s\u2082 s\u2083\n   m = [fizzBuzz divisors i | i&lt;-[1..s\u2083]]\n   print m\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 5380534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AS7Rl.jpg?s=128&g=1", "display_name": "selfresonator", "link": "https://stackoverflow.com/users/5380534/selfresonator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1473373553, "creation_date": 1473310631, "last_edit_date": 1473367521, "question_id": 39382857, "link": "https://stackoverflow.com/questions/39382857/how-do-i-match-types-in-haskell-so-the-expected-type-matches-the-actual-type", "title": "How do I match types in Haskell so the expected type matches the actual type?", "body": "<p>Attempting to implement fizzBuzz with some command line using optparse-applicative. </p>\n\n<pre><code>import Options.Applicative\ndata Args = Args { firstDivisor :: Int,\n                 secondDivisor :: Int,\n                 upperBound :: Int }\nfizzBuzz :: Args -&gt; IO ()\nfizzBuzz opts i\n    | i `mod` firstDivisor opts == 0 &amp;&amp; i `mod` secondDivisor opts == 0 = \"fizzBuzz\"\n    | i `mod` firstDivisor opts == 0 = \"fizz\"\n    | i `mod` secondDivisor opts == 0 = \"buzz\"\n    | otherwise = show i\nmain :: IO ()\nmain = print fizzBuzz\n</code></pre>\n\n<p>I have it set up to take in three command line arguments; two divisors(in fizzBuzz usually 3 and 5), and the third being the upper limit(usually 100), but when I go to compile I get an error saying:</p>\n\n<pre><code>Couldn't match expected type \u2018Int -&gt; [Char]\u2019\n            with actual type \u2018IO ()\u2019\nThe equation(s) for \u2018fizzBuzz\u2019 have two arguments,\nbut its type \u2018Args -&gt; IO ()\u2019 has only one\n</code></pre>\n\n<p>My main goal is to just print out the fizzBuzz series with the three command line args. From what I understand, it isn't liking that I supplied fizzBuzz with an extra parameter. Trying to understand why 'i' wouldn't work here.</p>\n\n<hr>\n\n<p>UPDATE:</p>\n\n<p>This code I feel is closer, as it addresses the command line with <code>getArgs</code> instead of optparse. Also added a list to run against <code>fizzBuzz</code>.</p>\n\n<pre><code>import System.Environment\n\nmain :: IO ()\nmain = do\n    [s1,s2,s3] &lt;- getArgs\n    print m\nm = [ fizzBuzz i| i &lt;-[1..s3]]\nfizzBuzz i\n  | i `mod` s1 == 0 &amp;&amp; s1 `mod` s2 == 0 = \"fizzBuzz\"\n  | i `mod` s1 == 0 = \"fizz\"\n  | i `mod` s2 == 0 = \"buzz\"\n  | otherwise = show i\n</code></pre>\n\n<p>So my problem is that I cannot access the s1 and s2 variables in order to get my fizzBuzz goin. How can I access those args outside of the scope of main? Maybe there is another function that can help?</p>\n"}, {"tags": ["haskell", "quickcheck"], "answers": [{"comments": [{"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1473300375, "post_id": 39381473, "comment_id": 66090687, "body": "Thanks, why is it &quot;reaching length / 2 items&quot; on average?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1473300506, "post_id": 39381473, "comment_id": 66090722, "body": "I mean, think about it. In a list with <code>N</code> elements, what is the average index? The middle is the average, and it&#39;s at index <code>N&#47;2</code>. Since you&#39;re choosing uniformly at random, your average index will be the average index of the list."}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1473300966, "post_id": 39381473, "comment_id": 66090826, "body": "Right, but why would you need to traverse the first <code>[len&#47;2] - 1</code> items? If you know the maximum <code>Int</code>, you can get it in O(1) by dividing in 2. Sorry if I&#39;m missing something obvious, I&#39;m a begginer with haskell."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 1, "creation_date": 1473300984, "post_id": 39381473, "comment_id": 66090836, "body": "Lists in Haskell are linked lists, always."}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1473301112, "post_id": 39381473, "comment_id": 66090866, "body": "I see, so even integer lists don&#39;t have random access? This sounds awfully inefficient."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 2, "creation_date": 1473302193, "post_id": 39381473, "comment_id": 66091123, "body": "You use something other than a list when you want random access. An array, for example."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 1, "creation_date": 1473320739, "post_id": 39381473, "comment_id": 66097521, "body": "@dimid It is indeed inefficient, when you need random access. In many cases, though, you don&#39;t. Also, consider simple code like <code>let list = ... in (1:list, 2:list)</code>. Linked lists can build the last pair in O(1), when arrays can not. And arrays can never express infinite (lazy) lists like <code>[1..] :: [Integer]</code>, which are sometimes convenient to use."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 4, "last_activity_date": 1473299931, "creation_date": 1473299931, "answer_id": 39381473, "question_id": 39381379, "link": "https://stackoverflow.com/questions/39381379/create-an-elements-generator-with-an-infinite-list/39381473#39381473", "title": "Create an elements generator with an infinite list", "body": "<p><code>elements</code> chooses elements uniformly at random, which means on average it will be reaching <code>length / 2</code> items into the list. For infinite values this is impossible, and for large finite lists like <code>[1..] :: [Int]</code>, this is still reaching like 1 billion items in, one at a time through the linked list. Quite a slow operation!</p>\n"}, {"comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1473300190, "post_id": 39381477, "comment_id": 66090641, "body": "Actually, as amalloy pointed out, the list in question is finite due to the type <code>[Int]</code>. Depending on your machine, <code>Int</code> may be 32 or 64 bits. In the former case, a computer with a large amount of RAM may terminate (eventually). In the latter case, you will definitely run out of memory."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 1, "last_activity_date": 1473299955, "creation_date": 1473299955, "answer_id": 39381477, "question_id": 39381379, "link": "https://stackoverflow.com/questions/39381379/create-an-elements-generator-with-an-infinite-list/39381477#39381477", "title": "Create an elements generator with an infinite list", "body": "<p>It seems that <code>elements</code> is poorly documented. In addition to being non-empty, the argument should be <strong>finite</strong>. See the source code:</p>\n\n<pre><code>-- | Generates one of the given values. The input list must be non-empty.\nelements :: [a] -&gt; Gen a\nelements [] = error \"QuickCheck.elements used with empty list\"\nelements xs = (xs !!) `fmap` choose (0, length xs - 1)\n</code></pre>\n\n<p>It tries to compute the length of the input list, which will cause an infinite loop on an infinite list.</p>\n"}], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 1, "accepted_answer_id": 39381473, "answer_count": 2, "score": 1, "last_activity_date": 1473300500, "creation_date": 1473299100, "last_edit_date": 1473300500, "question_id": 39381379, "link": "https://stackoverflow.com/questions/39381379/create-an-elements-generator-with-an-infinite-list", "title": "Create an elements generator with an infinite list", "body": "<p>I'm playing with QuickCheck, and stumbled upon some strange behavior</p>\n\n<pre><code>sample $ elements [1..5]\n</code></pre>\n\n<p>works as expected, however</p>\n\n<pre><code>sample $ elements [1..]\n</code></pre>\n\n<p>hangs in ghci, even when using a finite type such as <code>Int</code></p>\n\n<pre><code>sample $ elements [(1::Int)..]\n</code></pre>\n\n<p>Why doesn't it print arbitrary (pun intended :) large <code>Int</code>s?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I've tested @amalloy's explanantion by using</p>\n\n<pre><code>sample $ elements ([1 .. ] :: [Int8])\n</code></pre>\n\n<p>which does terminate.</p>\n"}, {"tags": ["haskell", "testing", "build", "haskell-stack"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1473301085, "post_id": 39381115, "comment_id": 66090858, "body": "Can you include your stack.yaml file contents?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1473323487, "post_id": 39381115, "comment_id": 66099083, "body": "Also, most likely explanation: you want to set <code>extra-dep: true</code> on the <code>slack-api</code> package in stack.yaml."}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 108, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475881312, "creation_date": 1473296873, "last_edit_date": 1475881312, "question_id": 39381115, "link": "https://stackoverflow.com/questions/39381115/stack-test-fails-on-dependency", "title": "Stack test fails on dependency", "body": "<p>Say I have the following test package configured:</p>\n\n<pre><code>test-suite foo-test\n  ghc-options:         -Wall -Werror\n  cpp-options:         -DTEST\n  default-extensions:  OverloadedStrings\n  main-is:             Spec.hs\n  type:                exitcode-stdio-1.0\n  hs-source-dirs:      app, test\n  build-depends:       Foo, base &gt;= 4.8 &amp;&amp; &lt; 4.9, containers &gt;= 0.5 &amp;&amp; &lt;0.6, split &gt;= 0.2 &amp;&amp; &lt; 0.3, hspec, QuickCheck\n  default-language:    Haskell2010\n</code></pre>\n\n<p>And the following spec file:</p>\n\n<pre><code>  import Test.Hspec\n\n  main :: IO ()\n  main = hspec $ do\n    describe \"True\" $ do\n      it \"True\" $ do\n        True `shouldBe` True\n</code></pre>\n\n<p>And a library definition like so:</p>\n\n<pre><code>library\n  build-depends:       base, slack-api, text, lens, hashmap, exceptions, mtl, warp\n  default-extensions:  OverloadedStrings\n                     , TemplateHaskell\n  hs-source-dirs:      app\n  Exposed-modules:     Main\n  default-language:    Haskell2010\n</code></pre>\n\n<p>When I run <code>stack build</code>, the library builds correctly.\nHowever, when I run <code>slack test</code>, this fails with:</p>\n\n<pre><code>slack-api-0.9: test (suite: tests)\nFoo-0.1.0.0: test (suite: foo-test)\nCompleted 2 action(s).\nTest suite failure for package slack-api-0.9\n    tests:  exited with: ExitFailure 1\nFull log available at /Users/abe/github/personal/foo/.stack-work/logs/slack-api-0.9-test.log\n</code></pre>\n\n<p>The listed log file is empty. There is an additional Foo-0.1.1.1.log file which contains</p>\n\n<pre><code>True\n  True\n\nFinished in 0.0011 seconds\n1 example, 0 failures\n</code></pre>\n\n<p>So my \"test\" is running. But so is a test from the dependency (and failing). What could be causing this? And how do I prevent this?</p>\n"}]