[{"tags": ["haskell", "dependencies", "cabal", "hackage"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1430354940, "post_id": 29953440, "comment_id": 48034905, "body": "I hope I don&#39;t sound a bit stupid, but... what&#39;s your question?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1430370019, "post_id": 29953440, "comment_id": 48039152, "body": "@DanielWagner edited to add &quot;What do I need to do to have hackage show only dependencies for the Library section, when the package includes Executable sections?&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1430403827, "post_id": 29961539, "comment_id": 48060312, "body": "FWIW I don&#39;t think it makes sense personally, and it seems like at one point it was declared a bug (unless I&#39;m misreading that old bug report mailing list post). I guess I&#39;ll probably just make all the sections <code>test</code> sections so I only have to do <code>--enable-tests</code> or something."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1430438792, "post_id": 29961539, "comment_id": 48079111, "body": "@jberryman I think you are misreading the old bug report. That report is about Cabal, not Hackage."}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 1, "last_activity_date": 1430378675, "creation_date": 1430378675, "answer_id": 29961539, "question_id": 29953440, "link": "https://stackoverflow.com/questions/29953440/hackage-showing-incorrect-dependencies-for-library-package-with-executable-secti/29961539#29961539", "title": "hackage showing incorrect dependencies for library package with executable sections", "body": "<p>This is not something you can control: If there is an executable section, hackage will expect that users will want to build them. This makes sense, and making that configurable will only cause unnecessary complications.</p>\n\n<p>The proper fix in this case is to put the test suite and benchmark programs into proper Cabal sections of that type. See <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#test-suites\" rel=\"nofollow\">https://www.haskell.org/cabal/users-guide/developing-packages.html#test-suites</a> and <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#benchmarks\" rel=\"nofollow\">https://www.haskell.org/cabal/users-guide/developing-packages.html#benchmarks</a> for their documentation.</p>\n"}], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1430378675, "creation_date": 1430337876, "last_edit_date": 1430369997, "question_id": 29953440, "link": "https://stackoverflow.com/questions/29953440/hackage-showing-incorrect-dependencies-for-library-package-with-executable-secti", "title": "hackage showing incorrect dependencies for library package with executable sections", "body": "<p>Hackage shows the union of the dependencies of the Library section as well as all Executable sections, even when I conditionally hide them behind a flag set to <code>false</code>. </p>\n\n<p>I've only found this ancient, supposedly-fixed <a href=\"https://mail.haskell.org/pipermail/cabal-devel/2010-April/006244.html\" rel=\"nofollow\">bug</a> which claims that specifying <code>cabal &gt;= 1.18</code> solves things, but that doesn't seem to be the case.</p>\n\n<p>What do I need to do to have hackage show only dependencies for the Library section, when the package includes Executable sections?</p>\n\n<p><a href=\"http://hackage.haskell.org/package/hashabler-0.1.0.1\" rel=\"nofollow\">Here</a> is the package that's giving me issues.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "edited": false, "score": 2, "creation_date": 1430346277, "post_id": 29953369, "comment_id": 48032018, "body": "Very interesting answer! Is there a book or reference behind the magic/math here?"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 5, "creation_date": 1430349253, "post_id": 29953369, "comment_id": 48033252, "body": "Chris Taylor has a great set of blog posts about this: <a href=\"http://chris-taylor.github.io/blog/2013/02/10/the-algebra-of-algebraic-data-types/\" rel=\"nofollow noreferrer\">The Algebra of Algebraic Data Types</a>."}, {"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "reply_to_user": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "edited": false, "score": 0, "creation_date": 1430378043, "post_id": 29953369, "comment_id": 48042963, "body": "@tinlyx I think a good search keyword for this is &quot;polynomial types&quot; (there&#39;s also &quot;polynomial functors&quot;, but I can&#39;t yet say whether those are related)."}, {"owner": {"reputation": 1980, "user_id": 170881, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/513d79940a586a121c7a740ffbc6efd7?s=128&d=identicon&r=PG", "display_name": "nils petersohn", "link": "https://stackoverflow.com/users/170881/nils-petersohn"}, "edited": false, "score": 1, "creation_date": 1538826570, "post_id": 29953369, "comment_id": 92286234, "body": "what a great answer"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 54, "last_activity_date": 1563909575, "last_edit_date": 1563909575, "creation_date": 1430337627, "answer_id": 29953369, "question_id": 29953219, "link": "https://stackoverflow.com/questions/29953219/what-is-the-kind-of-void/29953369#29953369", "title": "What is the kind of Void?", "body": "<p>0 was once not considered to be a number.  <a href=\"http://en.wikipedia.org/wiki/0_%28number%29#Greeks_and_Romans\" rel=\"noreferrer\">\"How can nothing be something?\"</a>  But over time we came to accept 0 as a number, noticing its properties and its usefulness.  Today the idea that 0 is <em>not</em> a number is as absurd as the idea that it was one 2,000 years ago.</p>\n\n<p><code>Void</code> is a type the same way 0 is a number. Its kind is <code>*</code>, just like all other types.  The similarity between <code>Void</code> and 0 runs quite deep, as Tikhon Jelvis's answer begins to show.  There is a strong mathematical analogy between types and numbers, with <code>Either</code> playing the role of addition, tupling <code>(,)</code> playing the role of multiplication, functions <code>(-&gt;)</code> as exponentiation (<code>a -&gt; b</code> means b<sup>a</sup>), <code>()</code> (pronounced \"unit\") as 1, and <code>Void</code> as 0. </p>\n\n<p>The number of values a type may take is the numeric interpretation of the type.  So</p>\n\n<pre><code>Either () (Either () ())\n</code></pre>\n\n<p>is interpreted as</p>\n\n<pre><code>1 + (1 + 1)\n</code></pre>\n\n<p>so we should expect three values. And indeed there are exactly three.</p>\n\n<pre><code>Left ()\nRight (Left ())\nRight (Right ())\n</code></pre>\n\n<p>Similarly, </p>\n\n<pre><code>(Either () (), Either () ())\n</code></pre>\n\n<p>is interpreted as </p>\n\n<pre><code>(1 + 1) * (1 + 1)\n</code></pre>\n\n<p>so we should expect four values.  Can you list them?</p>\n\n<p>Coming back to <code>Void</code>, you can have, say, <code>Either () Void</code>, which would be interpreted as 1 + 0.  The constructors of this type are <code>Left ()</code>, and <code>Right v</code> for every value <code>v</code> of type <code>Void</code> -- however there are no values of type <code>Void</code>, so the only constructor for <code>Either () Void</code> is <code>Left ()</code>.  And 1 + 0 = 1, so we got what we expected.</p>\n\n<p><strong>Exercise</strong>: What should the mathematical interpretation of <code>Maybe a</code> be?  How many values of <code>Maybe Void</code> are there -- does this fit with the interpretation?</p>\n\n<h2>Notes</h2>\n\n<ul>\n<li>I am ignoring partiality in this treatment, pretending Haskell is total.  Technically <code>undefined</code> can have type <code>Void</code>, but we like to use <a href=\"http://www.cse.chalmers.se/~nad/publications/danielsson-et-al-popl2006.html\" rel=\"noreferrer\">fast and loose</a> reasoning which ignores these.</li>\n<li>The way <code>void</code> is used in C-based languages is actually much more like Haskell's <code>()</code> than Haskell's <code>Void</code>. In Haskell, a function returning <code>Void</code> can never return at all, whereas in <code>C</code> languages a function returning <code>void</code> can return, but the return value is uninteresting -- there's only one thing it could be so why bother?</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 3152, "user_id": 1377706, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bhJMC.png?s=128&g=1", "display_name": "Pharap", "link": "https://stackoverflow.com/users/1377706/pharap"}, "edited": false, "score": 5, "creation_date": 1430371379, "post_id": 29953374, "comment_id": 48039605, "body": "Wow, I finally realise what object orientation sounds like to people who don&#39;t program."}, {"owner": {"reputation": 842, "user_id": 4737779, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/009c3f05f9273268e5d530785ef14327?s=128&d=identicon&r=PG&f=1", "display_name": "Beerend Lauwers", "link": "https://stackoverflow.com/users/4737779/beerend-lauwers"}, "edited": false, "score": 2, "creation_date": 1430389417, "post_id": 29953374, "comment_id": 48050158, "body": "To be able to mark this question as closed, I&#39;ve selected one of the suggested answers as a definitive one, but that does not mean your answer was any less informative. Thank you for the reply."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 3152, "user_id": 1377706, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bhJMC.png?s=128&g=1", "display_name": "Pharap", "link": "https://stackoverflow.com/users/1377706/pharap"}, "edited": false, "score": 0, "creation_date": 1430413361, "post_id": 29953374, "comment_id": 48067146, "body": "@Pharap: Oh yeah, it was a bit more terse than I usually write, but I didn&#39;t feel like writing more this time :P."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1563971559, "post_id": 29953374, "comment_id": 100876744, "body": "While the use of <code>Void</code> in <code>pipes</code> to mark things that don&#39;t produce outputs is perfectly reasonable, I don&#39;t think the use of <code>()</code> to mark things that don&#39;t take inputs is reasonable. <code>()</code> is a sort of &quot;tick&quot; in that context, a valid thing to wait for and then throw away. In <b>Hask</b>, <code>Void</code> is an initial object and <code>()</code> is a final object. In a non-trivial pipe category, there are no initial or final objects."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": false, "score": 42, "last_activity_date": 1430337654, "creation_date": 1430337654, "answer_id": 29953374, "question_id": 29953219, "link": "https://stackoverflow.com/questions/29953219/what-is-the-kind-of-void/29953374#29953374", "title": "What is the kind of Void?", "body": "<p>It's a type of kind <code>*</code> just like <code>Int</code>, <code>Bool</code> or <code>()</code>. It just happens to have 0 values instead of 1 or 2 or more.</p>\n\n<p>It's not a hack but rather a fundamental part of Haskell's type system. It plays the role of 0 to <code>()</code>'s 1 and, if we look at types as propositions, <code>Void</code> corresponds to the proposition \"false\". It's also an identity to sum types (<code>Either</code>) just like <code>()</code> is an identity to product types: <code>Either a Void</code> is isomorphic to <code>a</code>.</p>\n\n<p>In practice, it often acts as a dual of <code>()</code>; the best example of this I've seen is in <a href=\"https://hackage.haskell.org/package/pipes-4.1.5/docs/Pipes-Core.html#t:X\">pipes</a> where <code>()</code> is used to tag things that don't take inputs and <code>Void</code> (named <code>X</code>) is used to tag things that don't produce outputs. (See <a href=\"https://hackage.haskell.org/package/pipes-4.1.5/docs/Pipes-Tutorial.html#g:9\">Appendix:Types</a> in the tutorial.)</p>\n\n<p>It <em>is</em> a way to mark things as impossible or missing, but it is by no means a hack.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1563925036, "post_id": 29954765, "comment_id": 100859765, "body": "As I explain in my answer, it takes no extensions to write the classic <code>data Void = Void !Void</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1563971069, "post_id": 29954765, "comment_id": 100876417, "body": "For a rank-2 solution, the simplest is <code>newtype Void = Void {absurd :: forall a. a}</code>."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 17, "last_activity_date": 1430354106, "last_edit_date": 1430354106, "creation_date": 1430342287, "answer_id": 29954765, "question_id": 29953219, "link": "https://stackoverflow.com/questions/29953219/what-is-the-kind-of-void/29954765#29954765", "title": "What is the kind of Void?", "body": "<p>Another angle on this question: suppose I asked you to write a guaranteed-terminating function of type <code>a -&gt; b</code>:</p>\n\n<pre><code>aintGonnaWork :: a -&gt; b\naintGonnaWork a = _\n</code></pre>\n\n<p>As hopefully you can tell, it's impossible to write such a function.  It follows from this that the type <code>a -&gt; b</code> has no defined values.  Note also that the kind of <code>a -&gt; b</code> is <code>*</code>:</p>\n\n<pre><code>(-&gt;)   :: * -&gt; * -&gt; *\na      :: *\nb      :: *\n---------------------\na -&gt; b :: *\n</code></pre>\n\n<p>And there we have it: a type of kind <code>*</code>, built from \"vanilla\" Haskell elements (no \"hacks\"), but which nevertheless has no defined values.  So the existence of types like <code>Void</code> is already implicit in \"vanilla\" Haskell; all that the explicit <code>Void</code> type does is provide a standard, named one.</p>\n\n<p>I'll close with a simple implementation of the <code>Void</code> type in terms of the above; the only extension necessary is <code>RankNTypes</code>. </p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nnewtype Void = Void (forall a b. a -&gt; b)\n\nabsurd :: Void -&gt; a\nabsurd (Void f) = f f\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1564065757, "last_edit_date": 1564065757, "creation_date": 1563913658, "answer_id": 57171730, "question_id": 29953219, "link": "https://stackoverflow.com/questions/29953219/what-is-the-kind-of-void/57171730#57171730", "title": "What is the kind of Void?", "body": "<p>Luis Casillas showed that a polymorphic type can be uninhabited in vanilla Haskell. But there are also uninhabited <em>monomorphic</em> types. The classic one looks like this:</p>\n\n<pre><code>data Void = Void !Void\n\nabsurd :: Void -&gt; a\nabsurd (Void x) = absurd x\n</code></pre>\n\n<p>Imagine trying to construct something of type <code>Void</code>.</p>\n\n<pre><code>void :: Void\nvoid = Void _\n</code></pre>\n\n<p>You need something of type <code>Void</code> to fill the hole. Since that's the whole point of <code>void</code>, the only sensible choice is</p>\n\n<pre><code>void :: Void\nvoid = Void void\n</code></pre>\n\n<p>If the <code>Void</code> constructor were lazy, that would be a cyclical structure <code>Void (Void (Void ...))</code>. But since it's strict, <code>void</code> can be written equivalently as</p>\n\n<pre><code>void = void `seq` Void void\n</code></pre>\n\n<p>which is obviously not going to fly.</p>\n"}], "owner": {"reputation": 842, "user_id": 4737779, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/009c3f05f9273268e5d530785ef14327?s=128&d=identicon&r=PG&f=1", "display_name": "Beerend Lauwers", "link": "https://stackoverflow.com/users/4737779/beerend-lauwers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2434, "favorite_count": 8, "accepted_answer_id": 29953369, "answer_count": 4, "score": 37, "last_activity_date": 1564065757, "creation_date": 1430337037, "last_edit_date": 1493189606, "question_id": 29953219, "link": "https://stackoverflow.com/questions/29953219/what-is-the-kind-of-void", "title": "What is the kind of Void?", "body": "<p>Seeing as the type of <code>Void</code> is uninhabited, can it be regarded as a type \"constructor\"? Or is this just a quick \"hack\" to be able to safely disregard / disable functionality and am I looking too deep into this?</p>\n"}, {"tags": ["haskell", "vim", "types", "hdevtools"], "comments": [{"owner": {"reputation": 5271, "user_id": 1658042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/879e79284efb4639584574a5fc46c9e4?s=128&d=identicon&r=PG", "display_name": "lcd047", "link": "https://stackoverflow.com/users/1658042/lcd047"}, "edited": false, "score": 0, "creation_date": 1430380318, "post_id": 29950724, "comment_id": 48044297, "body": "A feature request to that effect has been <a href=\"https://github.com/bitc/vim-hdevtools/issues/13\" rel=\"nofollow noreferrer\">posted</a> some two years ago.  It&#39;s still unsolved."}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1430329000, "creation_date": 1430329000, "question_id": 29950724, "link": "https://stackoverflow.com/questions/29950724/how-to-insert-hdevtools-type-information-into-source-code", "title": "How to insert hdevtool&#39;s type information into source code?", "body": "<p>I try to keep my vim setup light on plugins. For Haskell, all I have is <a href=\"https://github.com/bitc/vim-hdevtools\" rel=\"nofollow\">vim-hdevtools</a>. I'd like to not have to install anything else. </p>\n\n<p>With vim-hdevtools, I can issue the command <code>HdevtoolsInfo</code> and get a separate window with the inferred type of the function the cursor is on.</p>\n\n<p>How do I get Vim to copy that type into my current buffer?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1430329319, "post_id": 29950721, "comment_id": 48022483, "body": "Are you sure you want <code>[(&quot;blue&quot;,&quot;yellow&quot;,&quot;red&quot;)]</code> and not <code>[&quot;blue&quot;,&quot;yellow&quot;,&quot;red&quot;]</code>?"}, {"owner": {"reputation": 21, "user_id": 4847510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bdc50496df03f4ffeb9d3036e5b1658?s=128&d=identicon&r=PG&f=1", "display_name": "Dead5quirre1", "link": "https://stackoverflow.com/users/4847510/dead5quirre1"}, "reply_to_user": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 0, "creation_date": 1430329740, "post_id": 29950721, "comment_id": 48022723, "body": "oops. this one [&quot;blue&quot;,&quot;yellow&quot;,&quot;red&quot;]."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1430329761, "post_id": 29950721, "comment_id": 48022742, "body": "You&#39;re looking for <code>map snd</code>, but notice that your <code>ballots</code> is no list of tuples but of lists of strings rather?"}, {"owner": {"reputation": 21, "user_id": 4847510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bdc50496df03f4ffeb9d3036e5b1658?s=128&d=identicon&r=PG&f=1", "display_name": "Dead5quirre1", "link": "https://stackoverflow.com/users/4847510/dead5quirre1"}, "edited": false, "score": 0, "creation_date": 1430329980, "post_id": 29950721, "comment_id": 48022884, "body": "when i use the function results which i created. it gives [(1,&quot;blue&quot;),(4,&quot;red&quot;),(2,&quot;yellow&quot;)]. which i believe is tuples within tuples"}, {"owner": {"reputation": 21, "user_id": 4847510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bdc50496df03f4ffeb9d3036e5b1658?s=128&d=identicon&r=PG&f=1", "display_name": "Dead5quirre1", "link": "https://stackoverflow.com/users/4847510/dead5quirre1"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1430330708, "post_id": 29950721, "comment_id": 48023335, "body": "@Bergi Thank you. You&#39;re the first person who help me. really appreciate it."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1430334048, "post_id": 29950721, "comment_id": 48025444, "body": "alternatively you can use list comprehensions for this as well.  i.e. <code>[ c | (i,c) &lt;- [(1,&quot;blue&quot;),(4,&quot;red&quot;),(2,&quot;yellow&quot;)] ]</code>"}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 6, "last_activity_date": 1430362616, "last_edit_date": 1430362616, "creation_date": 1430334724, "answer_id": 29952535, "question_id": 29950721, "link": "https://stackoverflow.com/questions/29950721/i-got-a-list-of-tuples-and-i-want-to-get-the-second-element-of-each-tuples-in-th/29952535#29952535", "title": "I got a list of tuples and i want to get the second element of each tuples in the list", "body": "<p><code>map</code>:</p>\n\n<pre><code>\u03bb&gt; :type map\nmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\n\u03bb&gt; :type snd\nsnd :: (a, b) -&gt; b\n\u03bb&gt; :type map snd\nmap snd :: [(a, b)] -&gt; [b]\n</code></pre>\n\n<p>so:</p>\n\n<pre><code>\u03bb&gt; map snd [(1,\"blue\"),(4,\"red\"),(2,\"yellow\")]\n[\"blue\", \"red\", \"yellow\"]\n</code></pre>\n\n<p>If you want it sorted by the first element:</p>\n\n<pre><code>\u03bb&gt; import Data.List\n\u03bb&gt; import Data.Function\n\u03bb&gt; :t sortBy\nsortBy :: (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]\n\u03bb&gt; :t sortBy (compare `on` fst)\nsortBy (compare `on` fst) :: Ord a =&gt; [(a, b)] -&gt; [(a, b)]\n</code></pre>\n\n<p>So:</p>\n\n<pre><code>import Data.List\nimport Data.Function\n\nsolution :: [(Int, String)] -&gt; [String]\nsolution = map snd . sortBy (compare `on` fst)\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 4847510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bdc50496df03f4ffeb9d3036e5b1658?s=128&d=identicon&r=PG&f=1", "display_name": "Dead5quirre1", "link": "https://stackoverflow.com/users/4847510/dead5quirre1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1147, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1430362616, "creation_date": 1430328995, "last_edit_date": 1430329848, "question_id": 29950721, "link": "https://stackoverflow.com/questions/29950721/i-got-a-list-of-tuples-and-i-want-to-get-the-second-element-of-each-tuples-in-th", "title": "I got a list of tuples and i want to get the second element of each tuples in the list", "body": "<p>Something like <code>[(1,\"blue\"),(4,\"red\"),(2,\"yellow\")]</code> will become <code>[\"blue\",\"yellow\",\"red\"]</code>.</p>\n\n<hr>\n\n<pre><code>ballots :: [Ballot]\nballots = [b1, b2, b3, b4, b5, b6]\n\nb1 = [\"Blue\",\"Green\"]\n\nb2 = [\"Green\",\"Blue\",\"Red\"]\n\nb3 = [\"Blue\"]\n\nb4 = [\"Red\",\"Green\"]\n\nb5 = [\"Blue\",\"Red\",\"Green\"]\n\nb6 = [\"Green\",\"Red\"]`\n</code></pre>\n\n<p>ballots will put into the ns\nI'm getting the first element of each b1 till b6 with head function which will be blue, green, blue, red, blue, green.</p>\n\n<pre><code>rank ns = results[head (x) | x&lt;-ns]\n</code></pre>\n\n<p>results is a function I created, it will calculate the total of each color and gives the out like this  <code>[(1,\"red\"),(2,\"green\"),(3,\"blue\")]</code></p>\n\n<p>So, what i want to do now is an output without the int in <code>[(Int, String)]</code>\nwhich looks like <code>[\"red\",\"green\",\"blue\"]</code></p>\n"}, {"tags": ["scala", "haskell", "type-inference"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 10, "creation_date": 1430328799, "post_id": 29950573, "comment_id": 48022178, "body": "The key difference is that Scala has subtyping and Haskell doesn&#39;t. A less fundamental difference is probably that numbers aren&#39;t polymorphic in Scala, though I&#39;m not enough of an expert in Scala to say that for sure."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1430330451, "post_id": 29950573, "comment_id": 48023165, "body": "The compiler looks for <code>Num [Char]</code> because <code>&quot;foo&quot;</code> is a string, i.e. a <code>[Char]</code>, and occurs in the other branch of <code>55</code>. This means that <code>55</code> must be of type <code>[Char]</code> as well, and a way to interpret the number <code>55</code> as a string is searched (said instance)."}], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 8, "last_activity_date": 1430331881, "creation_date": 1430331881, "answer_id": 29951611, "question_id": 29950573, "link": "https://stackoverflow.com/questions/29950573/type-inference-in-haskell-v-scala/29951611#29951611", "title": "Type Inference in Haskell v. Scala", "body": "<p>You can add an instance for <code>Num [Char]</code> in Haskell, if that's what you want:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE FlexibleInstances #-}\n\nimport Data.Function (on)\nimport Data.Composition ((.:))  -- cabal install composition\n\nhelper :: (Integer -&gt; Integer -&gt; Integer) -&gt; (String -&gt; String -&gt; String)\nhelper op = show .: on op read\n\ncast :: (Integer -&gt; Integer) -&gt; (String -&gt; String)\ncast f = show . f . read\n\ninstance Num [Char] where\n    fromInteger = show\n    (+) = helper (+)\n    (-) = helper (-)\n    (*) = helper (*)\n    abs = cast abs\n    signum = cast signum\n    negate = cast negate\n</code></pre>\n\n<p>where this is just one possible implementation.  This will make your example compile:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>&gt; let f x = if x then 55 else \"foo\"\n&gt; f True\n\"55\"\n&gt; f False\n\"foo\"\n</code></pre>\n\n<p>Haskell has polymorphic numeric literals, so <code>55 :: Num a =&gt; a</code>, and since both branches of an <code>if</code> must return the same type, you are forcing <code>a ~ [Char]</code> by having the <code>else</code> branch return <code>\"foo\"</code>.  This leads to a somewhat confusing error message, but it can be a very powerful feature.  It means that any numeric literal can act as the type you need it to be, and it's the same concept behind the <code>OverloadedStrings</code> extension, allowing you to have polymorphic string literals instead of using <code>pack</code> everywhere you need a <code>Text</code> or <code>ByteString</code>.</p>\n\n<p>Scala uses subtyping and has a generic type for all values.  It allows you to relax the type safety on a function and return literally <code>Any</code>thing.  Haskell does not have subtyping at all, so the only way to unify those types (similar to finding the LUB) is to use the fact that numeric literals are polymorphic under the <code>Num</code> constraint, so in order to compile <code>\"foo\"</code> has to implement <code>Num</code>.  Actually, if you enabled <code>OverloadedStrings</code> <code>f</code> will compile just fine with the type</p>\n\n<pre><code>f :: (Data.String.IsString a, Num a) =&gt; Bool -&gt; a\n</code></pre>\n\n<p>There aren't any types by default that meet both constraints, but GHC will happily accept this as a valid function.</p>\n"}, {"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 4, "last_activity_date": 1430334050, "creation_date": 1430334050, "answer_id": 29952324, "question_id": 29950573, "link": "https://stackoverflow.com/questions/29950573/type-inference-in-haskell-v-scala/29952324#29952324", "title": "Type Inference in Haskell v. Scala", "body": "<p>This is because of how number literals are interpreted in Haskell.</p>\n\n<pre><code>\u03bb&gt; :type 412\n412 :: Num a =&gt; a\n</code></pre>\n\n<p>What this is doing behind-the-scenes is calling the <code>Num</code> class <code>fromInteger</code> function to convert <code>412</code>, or in your case, <code>55</code>, into whatever instance.</p>\n\n<p>We can look at the <code>Num</code> class like this:</p>\n\n<pre><code>\u03bb :info Num\nclass Num a where\n  (+) :: a -&gt; a -&gt; a\n  (*) :: a -&gt; a -&gt; a\n  (-) :: a -&gt; a -&gt; a\n  negate :: a -&gt; a\n  abs :: a -&gt; a\n  signum :: a -&gt; a\n  fromInteger :: Integer -&gt; a\n</code></pre>\n\n<p>So, when you write <code>55</code> and <code>\"foo\"</code>, Haskell first realises that the return value must be of type <code>[Char]</code>, because <code>\"foo\" :: [Char]</code>, and tries to find an instance of <code>Num</code> that matches that. It fails, of course.</p>\n\n<p>Scala is a very much less strictly-typed language, and, because it has no type-classes exactly like Haskell's, so can only resort to <code>Any</code> to describe types like that. I don't think I have to explain why that's not great, because type errors are never fun.</p>\n\n<hr>\n\n<p>If you want to be able to return either an <code>Int</code> or <code>String</code>, you can use <code>Either</code>:</p>\n\n<pre><code>f :: Bool -&gt; Either Int String\nf b = if b then Left 55 else Right \"foo\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 1, "last_activity_date": 1430368608, "creation_date": 1430368608, "answer_id": 29959114, "question_id": 29950573, "link": "https://stackoverflow.com/questions/29950573/type-inference-in-haskell-v-scala/29959114#29959114", "title": "Type Inference in Haskell v. Scala", "body": "<p>If you're still somewhat confused, it helps to understand a little of how the back-end works. </p>\n\n<p>In Haskell, a typeclass is <strong>a dictionary of functions associated with a type</strong>. Each type can only have one dictionary of functions for each typeclass. When it does, we say that it <em>satisfies</em> the associated <em>constraint</em>. So if you type <code>:t 5</code> into GHCi it will tell you that the type of 5 is <code>Num a =&gt; a</code>, in other words, there are many types which have a value of <code>5</code> and those types are ones which have a <code>Num</code> dictionary. This is true because the <code>Num</code> dictionary defines the <code>fromInteger :: Num a =&gt; Integer -&gt; a</code> function which takes the specific <code>5</code> of type <code>Integer</code> and casts it to that other type.</p>\n\n<p>So it's complaining that it does not have the <code>Num</code> dictionary defined for the <code>String</code> type -- and <em>of course</em> it doesn't, because people don't usually use strings as numbers. (The type <code>String</code> is an alias for <code>[Char]</code>.)</p>\n\n<p>So when you write:</p>\n\n<pre><code>let f x = if x then 55 else \"foo\"\n</code></pre>\n\n<p>then here is what happens:</p>\n\n<ol>\n<li>Haskell is strongly typed and <code>if</code> is an expression with a concrete return value with a concrete type. Both branches must have the same type.</li>\n<li>GHC knows that and discerns, first off, that the type of <code>x</code> is <code>x :: Bool</code> (because it appears as the test of an if-branch and Haskell's strong types don't allow non-explicit coercion) and that <code>55 :: Num x =&gt; x</code> while <code>\"foo\" :: String</code>. </li>\n<li>GHC now <strong>unifies</strong> those last two types. It does this by merging the constraints separately from merging the types, so it merges <code>x</code> with <code>String</code> to find out that <code>x = String</code> on a type-level.</li>\n<li>GHC propagates the constraint to the result of that to say that the type is <code>Num String =&gt; String</code>.</li>\n<li>GHC complains because it does not know what the <code>Num</code> dictionary for <code>String</code> looks like.</li>\n</ol>\n\n<p>How do you solve this problem? The easiest way is to use the data structure <code>data Either x y = Left x | Right y</code> that comes built-in with Haskell:</p>\n\n<pre><code>let f x = if x then Left 55 else Right \"foo\"\n</code></pre>\n\n<p>The type of the output is then <code>Num x =&gt; Either x String</code>, which is totally fine and does not unify the two at all. <strong>Caution</strong>: Due to a thing called the \"monomorphism restriction\", which is set by default in GHC but not GHCi, if you don't provide an explicit type annotation saying otherwise, <code>f</code> may reduce the <code>Num a =&gt; Either a String</code> to <code>Either Integer String</code>:</p>\n\n<pre><code>Prelude&gt; :set -XMonomorphismRestriction\nPrelude&gt; let f x = if x then Left 55 else Right \"foo\"\nPrelude&gt; :t f\nf :: Num a =&gt; Bool -&gt; Either a [Char]\nPrelude&gt; let f = \\x -&gt; if x then Left 55 else Right \"foo\"\nPrelude&gt; :t f\nf :: Bool -&gt; Either Integer [Char]\n</code></pre>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 2, "accepted_answer_id": 29951611, "answer_count": 3, "score": 4, "last_activity_date": 1430368608, "creation_date": 1430328500, "question_id": 29950573, "link": "https://stackoverflow.com/questions/29950573/type-inference-in-haskell-v-scala", "title": "Type Inference in Haskell v. Scala", "body": "<p>Given the following code:</p>\n\n<pre><code>Prelude&gt; let f x = if (x) then 55 else \"foo\"\n</code></pre>\n\n<p>Why does the compiler look for a <code>Num [Char]</code>?</p>\n\n<pre><code>&lt;interactive&gt;:2:23:\n    No instance for (Num [Char]) arising from the literal `55'\n    In the expression: 55\n    In the expression: if (x) then 55 else \"foo\"\n    In an equation for `f': f x = if (x) then 55 else \"foo\"\n</code></pre>\n\n<p>However, in Scala, it will find the least-upper bound of <code>55</code> and <code>\"foo\"</code>, which is <code>Any</code>:</p>\n\n<pre><code>scala&gt; def f(x: Boolean) = if (x) 55 else \"foo\"\nf: (x: Boolean)Any\n\nimport scala.reflect.runtime.universe._\n\nscala&gt; lub( List[Type]( typeOf[Int], typeOf[String] ) )\nres4: reflect.runtime.universe.Type = Any\n</code></pre>\n\n<p>What's the key difference between Haskell's and Scala's Type Inference?</p>\n"}, {"tags": ["haskell", "functional-programming", "ocaml", "type-inference", "unification"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 4, "creation_date": 1430325138, "post_id": 29949497, "comment_id": 48019786, "body": "And then some poor sap manages it anyway and gets a helpful &quot;the impossible happened&quot;"}, {"owner": {"reputation": 11573, "user_id": 473792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bwv8P.jpg?s=128&g=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/473792/kevin"}, "edited": false, "score": 2, "creation_date": 1430339387, "post_id": 29949497, "comment_id": 48028560, "body": "Why is your question tagged Prolog and OCaml? From what I understand by reading it, it&#39;s only about Haskell and your new language."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 11573, "user_id": 473792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bwv8P.jpg?s=128&g=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/473792/kevin"}, "edited": false, "score": 2, "creation_date": 1430349136, "post_id": 29949497, "comment_id": 48033200, "body": "@Kevin: Both are tenuous, but not completely unrelated. OCaml has a very similar sort of type system to Haskell and Prolog is where the ideas of unification and the occurs check originate (as far as I know). In a sense, this sort of typechecking is very much like running a Prolog program."}, {"owner": {"reputation": 2073, "user_id": 3496273, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e0a40ff2f35bae1a27e3603c20102f4d?s=128&d=identicon&r=PG&f=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/3496273/jack"}, "edited": false, "score": 4, "creation_date": 1430363865, "post_id": 29949497, "comment_id": 48037423, "body": "A modified form of <a href=\"https://en.wikipedia.org/wiki/Greenspun%27s_tenth_rule\" rel=\"nofollow noreferrer\">Greenspun&#39;s Tenth Rule</a> states that any sufficiently complicated typechecker contains an ad hoc, informally-specified, bug-ridden, slow implementation of half of Prolog."}], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 34, "last_activity_date": 1430325649, "creation_date": 1430325649, "answer_id": 29949706, "question_id": 29949497, "link": "https://stackoverflow.com/questions/29949497/is-it-possible-to-get-the-infinite-kind-error-in-haskell-98/29949706#29949706", "title": "Is it possible to get the infinite kind error in Haskell 98?", "body": "<pre><code>data F f = F (f F)\n</code></pre>\n\n<p>On GHC 7.10.1, I get the message:</p>\n\n<pre><code>kind.hs:1:17:\n    Kind occurs check\n    The first argument of \u2018f\u2019 should have kind \u2018k0\u2019,\n      but \u2018F\u2019 has kind \u2018(k0 -&gt; k1) -&gt; *\u2019\n    In the type \u2018f F\u2019\n    In the definition of data constructor \u2018F\u2019\n    In the data declaration for \u2018F\u2019\n</code></pre>\n\n<p>The message doesn't say it's an infinite kind, but that's essentially what it is when the occurs check fails.</p>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 26, "last_activity_date": 1430325876, "creation_date": 1430325876, "answer_id": 29949781, "question_id": 29949497, "link": "https://stackoverflow.com/questions/29949497/is-it-possible-to-get-the-infinite-kind-error-in-haskell-98/29949781#29949781", "title": "Is it possible to get the infinite kind error in Haskell 98?", "body": "<p>Another simple example</p>\n\n<pre><code>GHCi, version 7.10.1: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; let x = undefined :: f f\n\n&lt;interactive&gt;:2:24:\n    Kind occurs check\n    The first argument of \u2018f\u2019 should have kind \u2018k0\u2019,\n      but \u2018f\u2019 has kind \u2018k0 -&gt; k1\u2019\n    In an expression type signature: f f\n    In the expression: undefined :: f f\n    In an equation for \u2018x\u2019: x = undefined :: f f\n</code></pre>\n"}], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 843, "favorite_count": 1, "accepted_answer_id": 29949706, "answer_count": 2, "score": 29, "last_activity_date": 1430749693, "creation_date": 1430324981, "last_edit_date": 1430749693, "question_id": 29949497, "link": "https://stackoverflow.com/questions/29949497/is-it-possible-to-get-the-infinite-kind-error-in-haskell-98", "title": "Is it possible to get the infinite kind error in Haskell 98?", "body": "<p>I am implementing a kind system for a new functional programming language and I am currently writing the function to unify two kinds. There are four cases two consider:</p>\n\n<pre><code>+---------+---------+-------------------------------------------------------+\n|   k1    |   k2    |                        action                         |\n+=========+=========+=======================================================+\n|   var   |   var   |                  k1 := k2 ^ k2 := k1                  |\n+---------+---------+-------------------------------------------------------+\n|   var   | non var |             if (!occurs(k1, k2)) k1 := k2             |\n+---------+---------+-------------------------------------------------------+\n| non var |   var   |             if (!occurs(k2, k1)) k2 := k1             |\n+---------+---------+-------------------------------------------------------+\n| non var | non var | ensure same name and arity, and unify respective args |\n+---------+---------+-------------------------------------------------------+\n</code></pre>\n\n<ol>\n<li>When both <code>k1</code> and <code>k2</code> are variables then they are instantiated to each other.</li>\n<li>When only <code>k1</code> is a variable then it is instantiated to <code>k2</code> iff <code>k1</code> doesn't occur in <code>k2</code>.</li>\n<li>When only <code>k2</code> is a variable then it is instantiated to <code>k1</code> iff <code>k2</code> doesn't occur in <code>k1</code>.</li>\n<li>Otherwise we check whether <code>k1</code> and <code>k2</code> have the same name and arity, and unify their respective arguments.</li>\n</ol>\n\n<p>For the second and third cases we need to implement the occurs check so that we don't get stuck in an infinite loop. However, I doubt that a programmer will be able to construct an infinite kind at all.</p>\n\n<p>In Haskell, it's easy to construct an infinite type:</p>\n\n<pre><code>let f x = f\n</code></pre>\n\n<p>However, I haven't been able to construct an infinite kind no matter how hard I tried. Note, that I didn't make use of any language extensions.</p>\n\n<p>The reason I am asking this is because if it's not possible to construct an infinite kind at all then I won't even bother implementing the occurs check for kinds in my kind system.</p>\n"}, {"tags": ["haskell", "cabal", "hunit", "coderunner"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430324104, "post_id": 29949063, "comment_id": 48019173, "body": "Is your cabal folder in the path (cannot see it) - it is usually in ~/.cabal"}, {"owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430324502, "post_id": 29949063, "comment_id": 48019414, "body": "@Carsten K&#246;nig: Yes, I updated my post."}], "answers": [{"tags": [], "owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "is_accepted": true, "score": 0, "last_activity_date": 1430338985, "creation_date": 1430338985, "answer_id": 29953804, "question_id": 29949063, "link": "https://stackoverflow.com/questions/29949063/could-not-find-module-test-hunit-error-when-executing-haskells-unittest-hu/29953804#29953804", "title": "&quot;Could not find module \u2018Test.HUnit\u2019&quot; Error when executing Haskell&#39;s unittest (HUnit) in CodeRunner", "body": "<p>The problem was the <code>$HOME</code> setup change. I used different $HOME for CodeRunner, but Haskell searches for $HOME/.cabal and $HOME/.ghc for installed package. </p>\n\n<p>After my resetting $HOME to correct location, everything works fine. </p>\n"}], "owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1718, "favorite_count": 0, "accepted_answer_id": 29953804, "answer_count": 1, "score": 1, "last_activity_date": 1452631858, "creation_date": 1430323655, "last_edit_date": 1430324481, "question_id": 29949063, "link": "https://stackoverflow.com/questions/29949063/could-not-find-module-test-hunit-error-when-executing-haskells-unittest-hu", "title": "&quot;Could not find module \u2018Test.HUnit\u2019&quot; Error when executing Haskell&#39;s unittest (HUnit) in CodeRunner", "body": "<p>I have simple unit test code for Haskell's HUnit. I use Mac OS X 10.10, and I installed HUnit with <code>cabal install hunit</code>. </p>\n\n<pre><code>module TestSafePrelude where\n\nimport SafePrelude( safeHead )\nimport Test.HUnit\n\ntestSafeHeadForEmptyList :: Test\ntestSafeHeadForEmptyList = \n    TestCase $ assertEqual \"Should return Nothing for empty list\"\n                           Nothing (safeHead ([]::[Int]))\n\ntestSafeHeadForNonEmptyList :: Test\ntestSafeHeadForNonEmptyList =\n    TestCase $ assertEqual \"Should return (Just head) for non empty list\" (Just 1)\n               (safeHead ([1]::[Int]))\n\nmain :: IO Counts\nmain = runTestTT $ TestList [testSafeHeadForEmptyList, testSafeHeadForNonEmptyList]\n</code></pre>\n\n<p>I can execute it with <code>runhaskell TestSafePrelude.hs</code> to get the results:</p>\n\n<pre><code>Cases: 2  Tried: 2  Errors: 0  Failures: 0\nCounts {cases = 2, tried = 2, errors = 0, failures = 0}\n</code></pre>\n\n<p>However, when I run it in <a href=\"https://coderunnerapp.com\" rel=\"nofollow noreferrer\">Code Runner</a>, I have error message that can't find the HUnit module. </p>\n\n<p><img src=\"https://i.stack.imgur.com/ULB5D.png\" alt=\"enter image description here\"></p>\n\n<p>CodeRunner launches the test on a different shell environment, and this seems to be the issue. If so, what environment variables need to be added? If not, what might be causing the problem? </p>\n\n<p><img src=\"https://i.stack.imgur.com/CkjLr.png\" alt=\"enter image description here\"></p>\n\n<p>I also find that <code>ghc-pkg list</code> from the CodeRunner does not search  for the directories in <code>~/.ghc</code> which contains the HUnit.</p>\n\n<pre><code>/usr/local/Cellar/ghc/7.8.3/lib/ghc-7.8.3/package.conf.d:\n    Cabal-1.18.1.4\n    array-0.5.0.0\n    ...\n    xhtml-3000.2.1\n</code></pre>\n\n<p>This is the results when executed in shell:</p>\n\n<pre><code>/usr/local/Cellar/ghc/7.8.3/lib/ghc-7.8.3/package.conf.d\n   Cabal-1.18.1.4\n   array-0.5.0.0\n   ...\n/Users/smcho/.ghc/x86_64-darwin-7.8.3/package.conf.d\n   ...\n   HUnit-1.2.5.2\n   ...\n   zlib-0.5.4.2\n</code></pre>\n\n<p>I added both <code>~/.cabal</code> and <code>~/.ghc</code> in the path, but it doesn't work. </p>\n"}, {"tags": ["haskell"], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 1, "closed_date": 1430320883, "answer_count": 0, "score": 4, "last_activity_date": 1430320678, "creation_date": 1430320678, "question_id": 29947951, "link": "https://stackoverflow.com/questions/29947951/why-is-repeat-defined-using-a-local-definition", "closed_reason": "Duplicate", "title": "Why is &#39;repeat&#39; defined using a local definition?", "body": "<p>Looking at how <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/src/GHC-List.html#repeat\" rel=\"nofollow\"><code>repeat</code> definition</a> is see:</p>\n\n<pre><code>repeat x = xs where xs = x : xs\n</code></pre>\n\n<p>What's the reason for having the local <code>xs</code> definition here, instead of just defining</p>\n\n<pre><code>repeat x = x : repeat x\n</code></pre>\n\n<p>I suspect it has something to do with compiler optimizations enabled due to better inlining, but I'm really just guessing. Does anybody know the actual reason(s)?</p>\n"}, {"tags": ["string", "list", "haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430315387, "post_id": 29945653, "comment_id": 48012224, "body": "it&#39;s almost right - indeed you have a bit to much ;) - hint: check the types for <code>elem</code>, <code>elem &#39;!&#39;</code> and <code>filter</code> and mind that <code>String = [Char]</code> ;D - btw: it&#39;s really helpful if you would mention what did not work for you (for example compiler errors, stuff going wrong), etc)"}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1430315953, "post_id": 29945892, "comment_id": 48012731, "body": "yeah that is right - but most likely this question was homework and you should have waited a bit longer before spoiling - +1 anyway ^^"}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "edited": false, "score": 0, "creation_date": 1430316351, "post_id": 29945892, "comment_id": 48013119, "body": "yeah but anyway that helped alot! Another question: how do i reverse the filter ? Well I want to return a list without Strings with &quot;!&quot;,...."}, {"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1430316473, "post_id": 29945892, "comment_id": 48013226, "body": "You <i>could</i> use <code>not</code>...  If this is indeed homework, try defining your own function by composing <code>not</code> and <code>elem</code> together."}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "edited": false, "score": 0, "creation_date": 1430316519, "post_id": 29945892, "comment_id": 48013257, "body": "and how do i manage to filter &#39;!&#39;, &#39;?&#39;, &#39;+&#39; at the same time?"}], "tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": true, "score": 3, "last_activity_date": 1430315756, "creation_date": 1430315756, "answer_id": 29945892, "question_id": 29945653, "link": "https://stackoverflow.com/questions/29945653/haskell-filtering-strings-with-a-certain-symbol-e-g-in-a-list/29945892#29945892", "title": "haskell: filtering Strings with a certain symbol e.g &#39;!&#39; in a List?", "body": "<p>You mapped too much.</p>\n\n<pre><code>filter ('!' `elem`) list\n</code></pre>\n\n<p>should work for you....</p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>You have a list of strings <code>[String]</code>.\nA string is a list of chars, because <code>String = [Char]</code>... </p>\n\n<p>So basically you have a list of lists. <code>[[Char]]</code>\nSince elem works by checking if a single element exists in a list, you can just call <code>elem</code> on each list item from your outer list.</p>\n"}], "owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 0, "accepted_answer_id": 29945892, "answer_count": 1, "score": 1, "last_activity_date": 1430315756, "creation_date": 1430315150, "question_id": 29945653, "link": "https://stackoverflow.com/questions/29945653/haskell-filtering-strings-with-a-certain-symbol-e-g-in-a-list", "title": "haskell: filtering Strings with a certain symbol e.g &#39;!&#39; in a List?", "body": "<p>I have a list of Strings :\n<code>[\"1*1\", \"ab!c\", \"cde2\", \"efghi!\"]</code>\nI want to sort out every string with an <code>'!'</code>.\nMy first idea was :\n<code>filter (map elem '!' (list)) list</code> \nString with map elem '!' (list), but thats not really working because it only checkups the String as itself and not the elements of the Strings in that List...</p>\n\n<p>thanks for your help!</p>\n"}, {"tags": ["performance", "haskell", "lambda"], "comments": [{"owner": {"reputation": 134362, "user_id": 83805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68c3dd15d6cd5d99a63113843d7e1c1b?s=128&d=identicon&r=PG", "display_name": "Don Stewart", "link": "https://stackoverflow.com/users/83805/don-stewart"}, "edited": false, "score": 1, "creation_date": 1430312902, "post_id": 29944634, "comment_id": 48010142, "body": "What does <code>!(Term -&gt; Term)</code> do?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 134362, "user_id": 83805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68c3dd15d6cd5d99a63113843d7e1c1b?s=128&d=identicon&r=PG", "display_name": "Don Stewart", "link": "https://stackoverflow.com/users/83805/don-stewart"}, "edited": false, "score": 0, "creation_date": 1430313045, "post_id": 29944634, "comment_id": 48010254, "body": "Uh nothing, guess I added it by mistake. <code>Num !Double</code> is important, though - basically doubles the performance."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430314642, "post_id": 29945101, "comment_id": 48011605, "body": "tl;dr I&#39;m just programming on the LC because I&#39;m more productive on it than in Haskell. I dealt with untyped languages all my life and never had a problem, so that&#39;s how I&#39;m used to do it, I guess. I love the idea of FP and see how the type system is useful for some, but day by day I&#39;ve been <a href=\"http://stackoverflow.com/questions/29879944/why-haskell-doesnt-accept-my-combinatoric-zip-definition\">struggling against it</a>, so I gave up. (And please don&#39;t mention Scheme.)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430314718, "post_id": 29945101, "comment_id": 48011673, "body": "Anyway, are you sure about that? I heard well placed &quot;unsafeCoerce&quot;s could solve it."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 2, "creation_date": 1430317828, "post_id": 29945101, "comment_id": 48014371, "body": "Using <code>unsafeCoerce</code> will definitely make your program <i>compile</i>. The problem is that it is impossible, at run-time, to figure out what&#39;s a <code>Double</code> and what&#39;s a function. To know that, you have to &amp;mdash; you know &amp;mdash; store that information."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430317883, "post_id": 29945101, "comment_id": 48014441, "body": "It isn&#39;t like (say) JavaScript where everything gets auto-converted. If you use <code>unsafeCoerce</code> to make your code compile, then your program will almost certainly segfault as soon as you run it."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1430321598, "post_id": 29945101, "comment_id": 48017462, "body": "Side note: I have the opposite problem to you. Whenever I use untyped languages, it always goes horribly wrong. ;-)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430322398, "post_id": 29945101, "comment_id": 48018010, "body": "Right? I still don&#39;t understand what is wrong with me but I gave like an year of chance and it just doesn&#39;t work. I once remade the engine of a big Nintendo game in 5 days on JavaScript, yet I couldn&#39;t create a pong in a week in Haskell. And that&#39;s not about FP - I reinvented a huge part of Prelude in less than a week on LC. The types hate me, man. Go figure."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430322613, "post_id": 29945101, "comment_id": 48018169, "body": "The thing I hate the most is when I get stuck for hours trying to decipher a type error and in the end the code was fine - I just needed to do some type-level hackery for it to work. That zip function I just posted on my last question is an example, and trust me, that happens <b>a lot</b>. I like to program things more generically than Haskell can handle trivially, and I&#39;m not smart enough to explain it to the type system."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 4, "last_activity_date": 1430313760, "creation_date": 1430313760, "answer_id": 29945101, "question_id": 29944634, "link": "https://stackoverflow.com/questions/29944634/is-there-any-way-to-make-this-haskell-program-faster/29945101#29945101", "title": "Is there any way to make this Haskell program faster?", "body": "<p>I don't think you can keep <code>Double</code> <em>and</em> avoid wrapping. I think the closest you can get would be just</p>\n\n<pre><code>newtype Term = Term (Term -&gt; Term)\n</code></pre>\n\n<p>But that's going to make arithmetic massively slower, I would imagine.</p>\n\n<p>The only other thing I can think of is maybe trying to cache previous results to avoid recomputing them (but that could easily be slower, not faster).</p>\n\n<p>I <em>am</em> curious to know what on Earth you've actually \"using\" this for though. ;-)</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 1, "accepted_answer_id": 29945101, "answer_count": 1, "score": 0, "last_activity_date": 1430313760, "creation_date": 1430312657, "last_edit_date": 1430313645, "question_id": 29944634, "link": "https://stackoverflow.com/questions/29944634/is-there-any-way-to-make-this-haskell-program-faster", "title": "Is there any way to make this Haskell program faster?", "body": "<p>Mind the following Haskell program:</p>\n\n<pre><code>-- Lambda Calculus ADT\ndata Term = Fun (Term -&gt; Term) | Num !Double\ninstance Show Term where\n    show (Num x) = \"(Num \"++(if fromIntegral (floor x) == x then show (floor x) else show x)++\")\"\n    show (Fun _) = \"(&lt;function&gt;)\"\n\n-- Lambda Calculus term application\n(#) :: Term -&gt; Term -&gt; Term\n(Fun f) # x = f x\ninfixl 0 # \n\n-- We have floats as primitives for performance\nfloat_toChurch :: Term\nfloat_toChurch = Fun (\\ (Num n) -&gt; Fun (\\f -&gt; Fun (\\x -&gt; \n    if n &lt;= 0 \n        then x \n        else (f # (float_toChurch # (Num (n - 1)) # f # x)))))\n\nfloat_add :: Term\nfloat_add = Fun (\\ (Num x) -&gt; Fun (\\ (Num y) -&gt; Num (x + y)))\n\n-- Function compiled from the Lambda Calculus.\n-- It sums all nats from 0 til a number.\nsum_til :: Term\nsum_til = (Fun(\\v0-&gt;((((((float_toChurch # v0) # (Fun(\\v1-&gt;(Fun(\\v2-&gt;(Fun(\\v3-&gt;(Fun(\\v4-&gt;((v3 # v2) # (((v1 # ((float_add # v2) # (Num 1))) # v3) # v4))))))))))) # (Fun(\\v1-&gt;(Fun(\\v2-&gt;(Fun(\\v3-&gt;v3))))))) # (Num 0)) # (Fun(\\v1-&gt;(Fun(\\v2-&gt;((float_add # v2) # v1)))))) # (Num 0))))\n\n-- Testing it\nmain = do\n    let n = 512*512*8\n    print $ (sum_til # (Num n))\n</code></pre>\n\n<p>Since there is no fast lambda calculator around, I'm using the strategy above to compile terms of the Untyped Lambda Calculus to Haskell in order to evaluate them fast. I'm impressed with the performance: that program creates a list of numbers from <code>0</code> to <code>2097152</code> and sums them all in less than a second on my computer. That is much faster than I expected - only 4 times slower than a <a href=\"http://lpaste.net/131680\" rel=\"nofollow\">Haskell direct equivalent</a> - and sufficient to be useful for my goals. Yet, notice that <strong>I had to wrap functions and terms under the Fun/Num constructors</strong> in order to satisfy the type system. That boxing is probably not ideal. So, my question is: is it possible to run the same Lambda Calculus program and get the same result even faster? I.e., any way to remove the boxing? (Also, it doesn't <strong>need</strong> to use Haskell.)</p>\n"}, {"tags": ["haskell", "parallel-processing", "timeout"], "answers": [{"comments": [{"owner": {"reputation": 185, "user_id": 2292040, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9bc998bf2e47133277207c93ddf2746a?s=128&d=identicon&r=PG&f=1", "display_name": "user2292040", "link": "https://stackoverflow.com/users/2292040/user2292040"}, "edited": false, "score": 0, "creation_date": 1431008137, "post_id": 29977747, "comment_id": 48318654, "body": "First, thank you very much for your answer. The solution has a similar shape to the one I need for my purpose. I tried to adapt it to my needs and ended with code of the type pasted here: <a href=\"http://lpaste.net/132151\" rel=\"nofollow noreferrer\">lpaste.net/132151</a>  Unfortunatley for me it seems to be that the program (here for test purpose &quot;sleep&quot; \u2013 but my real, computation intensive program behaves the same) is not invoked.  Do you have an idea why? Does things become simpler if portability to windows is no required?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 185, "user_id": 2292040, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9bc998bf2e47133277207c93ddf2746a?s=128&d=identicon&r=PG&f=1", "display_name": "user2292040", "link": "https://stackoverflow.com/users/2292040/user2292040"}, "edited": false, "score": 0, "creation_date": 1431033169, "post_id": 29977747, "comment_id": 48334359, "body": "@user2292040 Are you using the <code>hGetContents</code> from <code>System.IO</code>? If you use the alternative <code>hGetContents</code> from <code>Data.ByteString</code> or the one from <code>Data.Text.IO</code> (<code>text</code> package), does the problem persist?"}, {"owner": {"reputation": 185, "user_id": 2292040, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9bc998bf2e47133277207c93ddf2746a?s=128&d=identicon&r=PG&f=1", "display_name": "user2292040", "link": "https://stackoverflow.com/users/2292040/user2292040"}, "edited": false, "score": 0, "creation_date": 1431070895, "post_id": 29977747, "comment_id": 48346968, "body": "I found it: I have to give my input to the input handle given by &#39;createProcess&#39;. My program was invoked but totally idle due to missing input. :-D  I&#39;ll try to improve my solution \u2013 also with the answers I found recently from <a href=\"https://stackoverflow.com/questions/8820903/haskell-how-to-timeout-a-function-that-runs-an-external-command\" title=\"haskell how to timeout a function that runs an external command\">stackoverflow.com/questions/8820903/&hellip;</a> and in case of success write it down here.  Again, thank you for your help, that lead me on the right path."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 185, "user_id": 2292040, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9bc998bf2e47133277207c93ddf2746a?s=128&d=identicon&r=PG&f=1", "display_name": "user2292040", "link": "https://stackoverflow.com/users/2292040/user2292040"}, "edited": false, "score": 0, "creation_date": 1431092502, "post_id": 29977747, "comment_id": 48360236, "body": "@user2292040 You&#39;re welcome. One precaution you should take is to perform the &quot;feeding&quot; of stdin concurrently with the reading of stdout, concurrently with the reading of stderr. Otherwise deadlocks can happen due to output buffers that fill up and are never read. The easiest way to accomplish this is by using the <code>Concurrently</code> applicative from the <code>async</code> package."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1430470188, "last_edit_date": 1430470188, "creation_date": 1430427992, "answer_id": 29977747, "question_id": 29944344, "link": "https://stackoverflow.com/questions/29944344/timeout-for-parallel-running-command-calls-with-a-worker-pool-in-haskell/29977747#29977747", "title": "Timeout for parallel running command-calls with a worker pool in Haskell", "body": "<p>In Haskell, cancellation is usually handled through asynchronous exceptions. That's what <code>timeout</code> seems to use.</p>\n\n<p>So, we can try to install an exception handler in the code that executes the external process. The handler will invoke <code>terminateProcess</code> whenever an exception (asynchronous or not) crops up. Because <a href=\"http://hackage.haskell.org/package/process-1.2.3.0/docs/System-Process.html#v:terminateProcess\" rel=\"nofollow\"><code>terminateProcess</code></a> requires a reference to the\nprocess handle, we'll have to use <a href=\"http://hackage.haskell.org/package/process-1.2.3.0/docs/System-Process.html#v:createProcess\" rel=\"nofollow\"><code>createProcess</code></a> instead of the higher-level <a href=\"http://hackage.haskell.org/package/process-1.2.3.0/docs/System-Process.html#v:readProcessWithExitCode\" rel=\"nofollow\"><code>readProcessWithExitCode</code></a>.</p>\n\n<p>First, some imports and auxiliary functions (I'm using the <a href=\"http://hackage.haskell.org/package/async\" rel=\"nofollow\"><code>async</code></a> package):</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Control.Applicative\nimport Control.Exception \nimport Control.Concurrent (threadDelay, MVar, newEmptyMVar, putMVar, takeMVar)\nimport Control.Concurrent.Async (race_, Concurrently(..), waitEither, withAsync)\nimport System.Process\nimport System.Exit\nimport System.IO\nimport qualified Data.ByteString as B\n\n-- Executes two actions concurrently and returns the one that finishes first.\n-- If an asynchronous exception is thrown, the second action is terminated\n-- first.\nrace' :: IO a -&gt; IO a -&gt; IO a\nrace' left right =\n    withAsync left $ \\a -&gt;\n    withAsync right $ \\b -&gt;\n    fmap (either id id) (waitEither a b)\n\n-- terminate external process on exception, ignore if already dead.\nterminateCarefully :: ProcessHandle -&gt; IO ()\nterminateCarefully pHandle = \n    catch (terminateProcess pHandle) (\\(e::IOException) -&gt; return ())\n</code></pre>\n\n<p>This function launches an external process and returns its stdout and exit code, terminating the process if the thread is cancelled:</p>\n\n<pre><code>safeExec :: CreateProcess -&gt; IO (B.ByteString, ExitCode)\nsafeExec cp = \n    bracketOnError \n        (createProcess cp {std_out = CreatePipe})\n        (\\(_,_        ,_,pHandle) -&gt; terminateCarefully pHandle)  \n        (\\(_,Just hOut,_,pHandle) -&gt; do\n            -- Workaround for a Windows issue.\n            latch &lt;- newEmptyMVar\n            race' \n               (do -- IO actions are uninterruptible on Windows :(\n                  takeMVar latch \n                  contents &lt;- B.hGetContents hOut \n                  ec &lt;- waitForProcess pHandle\n                  pure (contents,ec))\n               -- Dummy interruptible action that   \n               -- receives asynchronous exceptions first\n               -- and helps to end the other action.\n               (onException \n                   (do \n                      putMVar latch () \n                      -- runs forever unless interrupted\n                      runConcurrently empty)\n                   (terminateCarefully pHandle))) \n</code></pre>\n\n<p>About the implementation:</p>\n\n<ul>\n<li><p><a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Exception-Base.html#v:bracketOnError\" rel=\"nofollow\">bracketOnError</a> is used to ensure that the external process is killed if an exception happens.</p></li>\n<li><p>In Windows, I/O operations like reading from a <code>Handle</code> are uninterruptible (see <a href=\"https://ghc.haskell.org/trac/ghc/ticket/7353\" rel=\"nofollow\">https://ghc.haskell.org/trac/ghc/ticket/7353</a>). This means they are impervious to asynchronous exceptions. As a workaround to this, I create a \"dummy\" thread that waits forever (<code>runConcurrently empty</code>) and can be interrupted by exceptions. When it is interrupted, it terminates the external process, causing the reads in the companion thread to finish, making the companion thread vulnerable to asynchronous exceptions again.</p></li>\n<li><p>The \"latch\" is used to prevent any uninterruptible operation on the handle until the inner exception handler is installed.</p></li>\n</ul>\n\n<p>It's a bit convoluted but it seems to work, at least tested with:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    race_ (safeExec $ proc \"calc\" []) \n          (threadDelay (3*10^6))\n</code></pre>\n\n<p>The calc app is killed after three seconds. Here's the whole <a href=\"https://gist.github.com/danidiaz/1de546fd69220583997a\" rel=\"nofollow\">gist</a>.</p>\n\n<p>Remember also that:</p>\n\n<blockquote>\n  <p>on Windows, if the process was a shell command created by createProcess with shell, or created by runCommand or runInteractiveCommand, then terminateProcess will only terminate the shell, not the command itself. </p>\n</blockquote>\n"}], "owner": {"reputation": 185, "user_id": 2292040, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9bc998bf2e47133277207c93ddf2746a?s=128&d=identicon&r=PG&f=1", "display_name": "user2292040", "link": "https://stackoverflow.com/users/2292040/user2292040"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1430470188, "creation_date": 1430311986, "last_edit_date": 1430325041, "question_id": 29944344, "link": "https://stackoverflow.com/questions/29944344/timeout-for-parallel-running-command-calls-with-a-worker-pool-in-haskell", "title": "Timeout for parallel running command-calls with a worker pool in Haskell", "body": "<p>I have to write a command line tool gluing together some components for an experiment and need help for a code design that meet my requirements. </p>\n\n<p>At top level I have to work with samples each generated by a \u2013 in runtime as well as in memory consumption \u2013 expensive call to another program with the function \"System.Process.readProcessWithExitCode\". Therefore you can imagine to have a (expensive) function \"genSample :: IO a\" and you need n return values of that function.</p>\n\n<p>My requirements are:\n 1. Let p be the number of processors, then at most p samples (i.e. calls to genSample) should be computed in parallel.\n 2. A timeout should be possible set which aborts the generation of the samples.\n 3. If the computation of all the samples times out, the started processes within a genSample-call should be stopped</p>\n\n<p>My current solution meets requirements 1 and 2. For the third one I currently help myself by executing a killall-command. That seems to be a dirty hack to me. Perhaps someone has a better idea?</p>\n\n<p>Here the central part of my current solution:</p>\n\n<pre><code>import qualified Control.Monad.Par.Class as ParIO\nimport qualified Control.Monad.Par.IO as ParIO\n\u2026\n-- | @parRepeatM i n a@ performs action @a@ @n@ times in parallel with timeout @t@\nparRepeatM :: ParIO.NFData a =&gt;\n              Integer -- ^ timeout in seconds\n           -&gt; Integer -- ^ number of duplicates (here: number of req. samples)\n           -&gt; IO a    -- ^ action to perform (here: genSample)\n           -&gt; IO (Maybe [a])\nparRepeatM t n a = timeout t $ ParIO.runParIO $ do\n  let tasks = genericReplicate n $ liftIO a -- :: [ParIO a]\n  ivars &lt;- mapM ParIO.spawn tasks\n  mapM ParIO.get ivars\n</code></pre>\n\n<p>A central problem at the moment is that after abortion due to a timeout the command called within genSample continues it's execution \u2013 in the worst case until the whole haskell-gluing-program ends.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430312226, "post_id": 29944263, "comment_id": 48009571, "body": "the <code>let ... in ...</code> in the expanded version is an expression that get&#39;s evaluated for each <code>x</code> - so the function get&#39;s redefined (without the <code>x</code> Haskell will produce an function where it is only evaluated once in order to define the function - remember a function is just a value after all ;)) - is this better?"}], "answers": [{"comments": [{"owner": {"reputation": 17508, "user_id": 1128289, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9gnmI.jpg?s=128&g=1", "display_name": "Praxeolitic", "link": "https://stackoverflow.com/users/1128289/praxeolitic"}, "edited": false, "score": 1, "creation_date": 1512508251, "post_id": 29944599, "comment_id": 82284523, "body": "In both cases, the definition of <code>fibs&#39;</code> is independent of <code>x</code>. I still don&#39;t see a reason why it&#39;s necessarily impossible for a compiler to take advantage of that fact in case 2. Is there a fundamental reason for this that has to do with Haskell or is this just a quirk of GHC?"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 5, "last_activity_date": 1430312568, "creation_date": 1430312568, "answer_id": 29944599, "question_id": 29944263, "link": "https://stackoverflow.com/questions/29944263/why-would-eta-expansion-degrade-the-performance-of-fib/29944599#29944599", "title": "Why would eta expansion degrade the performance of fib?", "body": "<p>Looking at the linked article, it seems that it's the difference between</p>\n\n<pre><code>fibs = let fibs' = ... in (\\ x -&gt; map fibs [0..] !! x)\n</code></pre>\n\n<p>verses</p>\n\n<pre><code>fibs = \\ x -&gt; let fibs' = ... in map fibs [0..] !! x\n</code></pre>\n\n<p>As you can see, in the first version <code>fibs'</code> is a global constant that never changes, and you're just indexing into that. In the second version, <code>fibs</code> is a function that constructs a \"new\", different <code>fibs'</code> for every value of <code>x</code>. And that's the performance difference.</p>\n"}], "owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1522632022, "creation_date": 1430311802, "last_edit_date": 1522632022, "question_id": 29944263, "link": "https://stackoverflow.com/questions/29944263/why-would-eta-expansion-degrade-the-performance-of-fib", "title": "Why would eta expansion degrade the performance of fib?", "body": "<p>I read <a href=\"https://wiki.haskell.org/Let_vs._Where\" rel=\"nofollow noreferrer\">this article</a> which says that the eta expansion would degrade performance of <code>fib</code>, like code below, the <code>fib1</code> would be much faster than other implementations. It explains that in the slower versions, the <code>fib'</code> would be redefined for every argument x. But I don't really get it. Could anyone give a more detailed explanation? </p>\n\n<pre><code>import System.Environment\nimport Control.Monad\n\nmain = do\n    (mode:num:_) &lt;- liftM (map read) getArgs\n    case mode of\n      1 -&gt; print $ fib1 num\n      2 -&gt; print $ fib2 num\n      3 -&gt; print $ fib3 num\n      4 -&gt; print $ fib4 num\n\nfib1 :: Int-&gt;Integer\nfib1 = (map fib' [0..] !!)\n  where fib' 0 = 1\n        fib' 1 = 1\n        fib' n = fib1 (n-1) + fib1 (n-2)\nfib2 :: Int-&gt;Integer\nfib2 x = map fib' [0..] !! x\n  where fib' 0 = 1\n        fib' 1 = 1\n        fib' n = fib2 (n-1) + fib2 (n-2)\nfib3 :: Int-&gt;Integer\nfib3 = (map fib' [0..] !!)\n  where fib' 0 = 1\n        fib' 1 = 1\n        fib' n = fib' (n-1) + fib' (n-2)\nfib4 :: Int-&gt;Integer\nfib4 x = map fib' [0..] !! x\n  where fib' 0 = 1\n        fib' 1 = 1\n        fib' n = fib' (n-1) + fib' (n-2)\n</code></pre>\n\n<p>I tested the code above.</p>\n\n<p>Compiled with <code>ghc --make fib.hs</code>, <code>fib1</code> is much faster than the others.\nCompile with <code>ghc -O2 fib.hs</code>, <code>fib1</code> and <code>fib2</code> are of the same performance, while <code>fib3</code> and <code>fib4</code> are much slower.</p>\n\n<p>It seems that with <code>-O2</code> flag, <code>fib2</code> is further optimized, so I tested with <code>ghc --make fib.hs -ddump-simpl</code> to see what is going on, and the generated code for the two functions are below</p>\n\n<pre><code>Rec {\nfib1 [Occ=LoopBreaker] :: Int -&gt; Integer\n[GblId, Str=DmdType]\nfib1 =\n  !!\n    @ Integer\n    (map\n       @ Int\n       @ Integer\n       (\\ (ds_d10B :: Int) -&gt;\n          case ds_d10B of wild_X6 { GHC.Types.I# ds1_d10C -&gt;\n          case ds1_d10C of _ [Occ=Dead] {\n            __DEFAULT -&gt;\n              + @ Integer\n                GHC.Num.$fNumInteger\n                (fib1 (- @ Int GHC.Num.$fNumInt wild_X6 (GHC.Types.I# 1)))\n                (fib1 (- @ Int GHC.Num.$fNumInt wild_X6 (GHC.Types.I# 2)));\n            0 -&gt; __integer 1;\n            1 -&gt; __integer 1\n          }\n          })\n       (enumFrom @ Int GHC.Enum.$fEnumInt (GHC.Types.I# 0)))\nend Rec }\n\nRec {\nfib2 [Occ=LoopBreaker] :: Int -&gt; Integer\n[GblId, Arity=1, Str=DmdType]\nfib2 =\n  \\ (x_ay6 :: Int) -&gt;\n    !!\n      @ Integer\n      (map\n         @ Int\n         @ Integer\n         (\\ (ds_d10x :: Int) -&gt;\n            case ds_d10x of wild_X8 { GHC.Types.I# ds1_d10y -&gt;\n            case ds1_d10y of _ [Occ=Dead] {\n              __DEFAULT -&gt;\n                + @ Integer\n                  GHC.Num.$fNumInteger\n                  (fib2 (- @ Int GHC.Num.$fNumInt wild_X8 (GHC.Types.I# 1)))\n                  (fib2 (- @ Int GHC.Num.$fNumInt wild_X8 (GHC.Types.I# 2)));\n              0 -&gt; __integer 1;\n              1 -&gt; __integer 1\n            }\n            })\n         (enumFrom @ Int GHC.Enum.$fEnumInt (GHC.Types.I# 0)))\n      x_ay6\nend Rec }\n</code></pre>\n\n<p>after read the code that <code>ghc -make -ddump-simpl fib.hs</code> generated, I write two new function to test it. Now compiled with <code>ghc --make fib.hs</code>, <code>fib5</code> is still much faster than <code>fib6</code>, I think these two functions would make it easier to analyze.</p>\n\n<pre><code>fib5 :: Int-&gt;Integer\nfib5 = (!!) \n        (map (\\n-&gt;\n                case n of \n                  0 -&gt; 1\n                  1 -&gt; 1\n                  _ -&gt; fib5 (n-1) + fib5 (n-2))\n             [0..])\nfib6 :: Int-&gt;Integer\nfib6 = \\x-&gt;\n        (!!) (map (\\n-&gt;\n                case n of \n                  0 -&gt; 1\n                  1 -&gt; 1\n                  _ -&gt; fib6 (n-1) + fib6 (n-2))\n              [0..]) \n             x\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 17464, "user_id": 2040251, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UsW2G.jpg?s=128&g=1", "display_name": "kraskevich", "link": "https://stackoverflow.com/users/2040251/kraskevich"}, "edited": false, "score": 2, "creation_date": 1430309622, "post_id": 29943390, "comment_id": 48007449, "body": "Why would you want to do it recursively?"}, {"owner": {"reputation": 127, "user_id": 4846276, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/77b204d85b0268c249e22cbfdb1679d3?s=128&d=identicon&r=PG&f=1", "display_name": "HazardAGuess", "link": "https://stackoverflow.com/users/4846276/hazardaguess"}, "reply_to_user": {"reputation": 17464, "user_id": 2040251, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UsW2G.jpg?s=128&g=1", "display_name": "kraskevich", "link": "https://stackoverflow.com/users/2040251/kraskevich"}, "edited": false, "score": 0, "creation_date": 1430309900, "post_id": 29943390, "comment_id": 48007695, "body": "Well ive just started learning recursion and this was something i came across that would be interesting to see how it could be done"}, {"owner": {"reputation": 777, "user_id": 3900056, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45ff0756018a3a41955b5d29e3ab63fb?s=128&d=identicon&r=PG&f=1", "display_name": "zcleghern", "link": "https://stackoverflow.com/users/3900056/zcleghern"}, "edited": false, "score": 0, "creation_date": 1430325941, "post_id": 29943390, "comment_id": 48020297, "body": "Thinking this way is a solution looking for a problem, not the other way around."}], "answers": [{"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 4, "creation_date": 1430310248, "post_id": 29943516, "comment_id": 48007987, "body": "Because you want to! Because you want to! [Er, sorry about that...]"}], "tags": [], "owner": {"reputation": 14704, "user_id": 908515, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/f1L9v.png?s=128&g=1", "display_name": "undur_gongor", "link": "https://stackoverflow.com/users/908515/undur-gongor"}, "is_accepted": true, "score": 5, "last_activity_date": 1430309820, "creation_date": 1430309820, "answer_id": 29943516, "question_id": 29943390, "link": "https://stackoverflow.com/questions/29943390/how-would-i-write-a-triangle-function-recursively/29943516#29943516", "title": "How would I write a triangle function recursively?", "body": "<pre><code>triangle 0 = 0\ntriangle n = n + triangle (n-1)\n</code></pre>\n\n<p>But why?</p>\n"}, {"tags": [], "owner": {"reputation": 1409, "user_id": 1876583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdf666782fb48c703f4fae045f681c13?s=128&d=identicon&r=PG", "display_name": "WolfeFan", "link": "https://stackoverflow.com/users/1876583/wolfefan"}, "is_accepted": false, "score": 0, "last_activity_date": 1430329058, "creation_date": 1430329058, "answer_id": 29950740, "question_id": 29943390, "link": "https://stackoverflow.com/questions/29943390/how-would-i-write-a-triangle-function-recursively/29950740#29950740", "title": "How would I write a triangle function recursively?", "body": "<pre><code>triangle :: Integer -&gt; Integer\ntriangle n = recTriangle n 0\n    where\n      recTriangle 0 acc = acc\n      recTriangle n2 acc = recTriangle (n2-1) (acc+n2)\n</code></pre>\n\n<p>If you want tail recursion, this is it. (Your initial attempt is still better.)</p>\n"}], "owner": {"reputation": 127, "user_id": 4846276, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/77b204d85b0268c249e22cbfdb1679d3?s=128&d=identicon&r=PG&f=1", "display_name": "HazardAGuess", "link": "https://stackoverflow.com/users/4846276/hazardaguess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 358, "favorite_count": 0, "accepted_answer_id": 29943516, "answer_count": 2, "score": 1, "last_activity_date": 1430329058, "creation_date": 1430309482, "last_edit_date": 1430310015, "question_id": 29943390, "link": "https://stackoverflow.com/questions/29943390/how-would-i-write-a-triangle-function-recursively", "title": "How would I write a triangle function recursively?", "body": "<p>So I am trying to write a recursive function where you can input a triangle number e.g. 5 and it will return the answer 15. I can use this to output the correct answer: </p>\n\n<pre><code>triangle n = n * (n + 1) `div` 2\n</code></pre>\n\n<p>But how could I do this recursively?</p>\n"}, {"tags": ["json", "haskell", "aeson"], "answers": [{"tags": [], "owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "is_accepted": true, "score": 2, "last_activity_date": 1430308089, "creation_date": 1430308089, "answer_id": 29942829, "question_id": 29941866, "link": "https://stackoverflow.com/questions/29941866/parsing-json-data-from-a-url-in-haskell-using-aeson/29942829#29942829", "title": "Parsing JSON data from a URL in Haskell using Aeson", "body": "<p>In its current form, your code can only parse a single line of the form <code>{\"date\":\"2015-04-12T20:36:25+00:00\", \"temperature\":7}</code> : it tries to parse the input into a <code>Temperatures</code>, but can't find a <code>date</code> key into the root object because it only has a <code>temperatures</code> key.</p>\n\n<p>The problem is that your <code>Temperatures</code> datatype does not really match your input. Here is something that should match:</p>\n\n<pre><code>data DataPoint = DataPoint { date :: String\n                           , temperature :: Int\n                           } deriving (Show, Generic)\n\ndata Temperatures = Temperatures { temperatures :: [DataPoint]\n                                 } deriving (Show, Generic)\n</code></pre>\n"}], "owner": {"reputation": 1079, "user_id": 1909658, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cfMSw.png?s=128&g=1", "display_name": "Bradley", "link": "https://stackoverflow.com/users/1909658/bradley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 521, "favorite_count": 0, "accepted_answer_id": 29942829, "answer_count": 1, "score": 1, "last_activity_date": 1430308089, "creation_date": 1430305565, "question_id": 29941866, "link": "https://stackoverflow.com/questions/29941866/parsing-json-data-from-a-url-in-haskell-using-aeson", "title": "Parsing JSON data from a URL in Haskell using Aeson", "body": "<p>I'm trying to create a web app in Haskell that takes some JSON input from a URL.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, DeriveGeneric #-}\n\nimport Data.Aeson as Q\nimport Data.Text\nimport Control.Applicative\nimport Control.Monad\nimport qualified Data.ByteString.Lazy as B\nimport Network.HTTP.Conduit (simpleHttp)\nimport GHC.Generics\n--import Data.DateTime\n\ndata Temperatures = \n  Temperatures { date :: String\n               , temperature :: Int\n                 } deriving (Show, Generic)\n\ninstance FromJSON Temperatures\ninstance ToJSON Temperatures\n\n\njsonURL :: String\njsonURL = \"http://www.phoric.eu/temperature\"\n\ngetJSON :: IO B.ByteString\ngetJSON = simpleHttp jsonURL\n\n\nmain :: IO ()\nmain = do \n d &lt;- (eitherDecode &lt;$&gt; getJSON) :: IO (Either String Temperatures)\n case d of\n  Left e   -&gt; putStrLn e\n  Right stuff -&gt; print stuff\n</code></pre>\n\n<p>However, I'm getting the error at runtime:</p>\n\n<pre><code>Bradley$ runhaskell test.hs\nThe key \"date\" was not found\n</code></pre>\n\n<p>The JSON is below @ the URL which is in the code.</p>\n\n<pre><code>{\"temperatures\":[\n    {\"date\":\"2015-02-28T20:16:12+00:00\", \"temperature\":0},\n    {\"date\":\"2015-01-01T21:46:55+00:00\", \"temperature\":2}, \n    {\"date\":\"2015-04-08T21:46:53+00:00\", \"temperature\":3},\n    {\"date\":\"2015-04-09T21:46:01+00:00\", \"temperature\":4},\n    {\"date\":\"2015-04-10T21:46:40+00:00\", \"temperature\":5},\n    {\"date\":\"2015-04-11T21:46:36+00:00\", \"temperature\":6},\n    {\"date\":\"2015-04-12T20:36:25+00:00\", \"temperature\":7}\n]}\n</code></pre>\n\n<p>I have no idea why it is not recognising the keys when they're clearly present in the JSON object, any ideas?</p>\n"}, {"tags": ["haskell", "state", "monads"], "comments": [{"owner": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "edited": false, "score": 2, "creation_date": 1430305423, "post_id": 29941633, "comment_id": 48004349, "body": "If you are new to monad transformers, importing <code>Control.Monad.Trans.State</code> instead of <code>Control.Monad.State</code> can make things easier to understand (e.g. more clear error messages etc.)"}, {"owner": {"reputation": 267, "user_id": 2903213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98c73d72d188f40b0769fa5d571454af?s=128&d=identicon&r=PG&f=1", "display_name": "Tommalla", "link": "https://stackoverflow.com/users/2903213/tommalla"}, "reply_to_user": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "edited": false, "score": 0, "creation_date": 1430307531, "post_id": 29941633, "comment_id": 48005910, "body": "@ZhekaKozlov Now this is interesting. As you might have expected, my original problem was a much more complicated version of the one I presented in my question. Using <code>Control.Monad.Trans.State</code> helped me find where the problem actually was (and it was a completely different thing). Thank you for that comment, it helped me solve my issue."}], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1430335061, "post_id": 29941692, "comment_id": 48026031, "body": "That <code>=</code> should be <code>~</code>, as in type equality, right?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1430409813, "post_id": 29941692, "comment_id": 48064880, "body": "I&#39;m not really familiar with what GHC uses for type equity constraints; I was just trying to write something that an average person would understand."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 4, "last_activity_date": 1430305069, "creation_date": 1430305069, "answer_id": 29941692, "question_id": 29941633, "link": "https://stackoverflow.com/questions/29941633/haskell-state-monad-with-tuples-as-state/29941692#29941692", "title": "Haskell State monad with tuples as state", "body": "<p>The type of <code>get</code> is</p>\n\n<pre><code>get :: State s s\n</code></pre>\n\n<p>So if <code>s = (Int, Int)</code> then you want</p>\n\n<pre><code>get :: State (Int, Int) (Int, Int)\n</code></pre>\n\n<p>That's all. <code>get</code> returns the entire tuple.</p>\n"}], "owner": {"reputation": 267, "user_id": 2903213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98c73d72d188f40b0769fa5d571454af?s=128&d=identicon&r=PG&f=1", "display_name": "Tommalla", "link": "https://stackoverflow.com/users/2903213/tommalla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 329, "favorite_count": 0, "accepted_answer_id": 29941692, "answer_count": 1, "score": 1, "last_activity_date": 1430305069, "creation_date": 1430304920, "question_id": 29941633, "link": "https://stackoverflow.com/questions/29941633/haskell-state-monad-with-tuples-as-state", "title": "Haskell State monad with tuples as state", "body": "<p>My apologies if my question is stupid (I'm still quite new to monads), but I couldn't find the answer to it so far.</p>\n\n<p>I want to store pairs as the state in the State monad. However, if I try this on a simple example of (Int, Int) I get (ghci):  </p>\n\n<pre><code>Prelude&gt; import Control.Monad.State\nPrelude Control.Monad.State&gt; :t get :: State Int Int\nget :: State Int Int :: State Int Int\nPrelude Control.Monad.State&gt; :t get :: State (Int, Int) Int\n\n&lt;interactive&gt;:1:1:\n    No instance for (MonadState\n                       Int (StateT (Int, Int)  Data.Functor.Identity.Identity))\n      arising from a use of \u2018get\u2019\n    In the expression: get :: State (Int, Int) Int\n</code></pre>\n\n<p>My questions are:<br>\n1. Why?<br>\n2. How do I get this to work?  </p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 4, "last_activity_date": 1430302901, "creation_date": 1430302901, "answer_id": 29940886, "question_id": 29939644, "link": "https://stackoverflow.com/questions/29939644/backjump-limit-reached-change-with-max-backjumps/29940886#29940886", "title": "Backjump limit reached (change with --max-backjumps)", "body": "<p>100 is too low a backjump count. I typically recommend <code>--max-backjumps=-1</code> to set it to an unbounded number. However, a more robust way of installing Yesod is to use LTS Haskell, so that the dependency tree is solved and tested for you by the Stackage project. This is the approach taken by <a href=\"http://www.yesodweb.com/page/quickstart\" rel=\"nofollow\">the Yesod quickstart guide</a>. Typically, this can be achieved by running the following inside your project directory:</p>\n\n<pre><code>wget https://www.stackage.org/lts/cabal.config\n</code></pre>\n\n<p>This will require that you're using GHC 7.8.X, preferably 7.8.4.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1360, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1430302901, "creation_date": 1430299860, "question_id": 29939644, "link": "https://stackoverflow.com/questions/29939644/backjump-limit-reached-change-with-max-backjumps", "title": "Backjump limit reached (change with --max-backjumps)", "body": "<p>I scaffolded Yesod project using <code>yesod init &amp;&amp; cd lemonstand</code>. When I do \"cabal install\", it throws the error, </p>\n\n<pre><code>Backjump limit reached (change with --max-backjumps).\n</code></pre>\n\n<p>Then i passed an option as <code>max-backjumps</code>,</p>\n\n<pre><code>cabal install --max-backjumps 100\n</code></pre>\n\n<p>And i followed the <a href=\"http://www.reddit.com/r/haskell/comments/2ameew/best_practices_for_avoiding_cabal_hell/\" rel=\"nofollow\">reddit conversation</a>, and did this,</p>\n\n<pre><code>cabal install --max-backjumps 100 --reorder-goals\n</code></pre>\n\n<p>None of these steps worked. Any clues?</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "edited": false, "score": 0, "creation_date": 1430303965, "post_id": 29939355, "comment_id": 48003281, "body": "Well that explains why, not matter what I try, it will not compile, trying to combine lists with different attributes. How would I find out what makeTuple is?"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "edited": false, "score": 0, "creation_date": 1430305247, "post_id": 29939355, "comment_id": 48004225, "body": "@user3633383 look at type signature, you take two tuples of types <code>(a, b)</code> and <code>(a, c)</code> then, It cannot be <code>(String, Bool)</code> and <code>(Int, Double)</code> since <code>String</code> type is different than <code>Int</code> type and, signature force to be <code>a</code> the same type on first and second tuples. You can replace each <code>a</code>, <code>b</code> and <code>c</code> into signature by any explicit types. In fact, the signature force to you to write only two possible bodies!!! :)"}, {"owner": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "edited": false, "score": 0, "creation_date": 1430308690, "post_id": 29939355, "comment_id": 48006761, "body": "Going by the example usage:      join [(2,&quot;S&quot;),(1,&quot;J&quot;)] [(2,True),(3,False)]         = [(2,&quot;S&quot;,True)]     join [(2,&quot;S&quot;),(1,&quot;J&quot;)] [(2,1),(2,2),(3,4)]         = [(2,&quot;S&quot;,1),(2,&quot;S&quot;,2)]  (int, char, bool) But the second usage is (int, char, int)"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "edited": false, "score": 0, "creation_date": 1430309401, "post_id": 29939355, "comment_id": 48007262, "body": "Don&#39;t worry about explicit types, although second example is <code>(Int, String, Int)</code> really your function define the tuple <code>(a, b, c)</code> with first and third elements with different type. Finally, if is <code>makeTuple (x1, y) (x2, z)</code>, the only two valid bodies are <code>(x1, y, z)</code> and <code>(x2, y, z)</code> not exists any other possible function. Try to use type information to fix your <code>join</code> function. :)"}, {"owner": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "edited": false, "score": 0, "creation_date": 1430310899, "post_id": 29939355, "comment_id": 48008492, "body": "&#39;makeTuple (a:b) (a:c) = (fst(head[a]), snd(head[b]), snd(head[c]))&#39; produces an error <b>Repeated variable &quot;a&quot; in pattern</b> ?"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "edited": false, "score": 0, "creation_date": 1430313635, "post_id": 29939355, "comment_id": 48010796, "body": "Ouch! is not the same thing types than values, I&#39;ll update my response but I suggest to you learn Haskell basics. Lots of courage and good luck!"}, {"owner": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "edited": false, "score": 0, "creation_date": 1430316506, "post_id": 29939355, "comment_id": 48013247, "body": "Wow, what a really simple way to do it (now that I see how it&#39;s done). I was close a few times in some of the things that I tried, but doubt I would have tried the end result. Thanks for all your help. Now I need to figure out how to extend it to add implementation of a Maybe data type for the third part of the triple. Cheers!"}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": false, "score": 1, "last_activity_date": 1430313898, "last_edit_date": 1430313898, "creation_date": 1430299150, "answer_id": 29939355, "question_id": 29939257, "link": "https://stackoverflow.com/questions/29939257/haskell-create-list-from-lists-with-different-attributes/29939355#29939355", "title": "haskell create list from lists with different attributes", "body": "<p>Your types do not match</p>\n\n<pre><code>join :: Eq a =&gt; [(a,b)] -&gt; [(a,c)] -&gt; [(a,b,c)]\njoin xs     []     = xs\njoin []     ys     = ys\n                 --  ^^^^   three different types involved!\n</code></pre>\n\n<p><code>xs</code> and <code>ys</code> has type <code>[(a, b)]</code> and <code>[(a, c)]</code> then, they can not be the resultant type <code>[(a,b,c)]</code>.</p>\n\n<p>You must to create your resultant data from <code>xs</code> and <code>ys</code>, something like</p>\n\n<pre><code>join ? ? = ... (a, b, c) ...\n</code></pre>\n\n<p>Can you figure that?</p>\n\n<p>Tip: what is the body of</p>\n\n<pre><code>makeTuple :: (a, b) -&gt; (a, c) -&gt; (a, b, c)\n                         --          ^  ^\n                         --          :  |\n                         --          :  +-- only one value exists you can put here\n                         --          :\n                         --          +\u00b7\u00b7\u00b7\u00b7\u00b7 only one value exists you can put here\n</code></pre>\n\n<p>the only two possible functions are</p>\n\n<pre><code>makeTuple (x1, y) (x2, z) = (x1, y, z)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>makeTuple (x1, y) (x2, z) = (x2, y, z)\n</code></pre>\n\n<p>In the same way, your <code>join</code> must to preserve the resultant type.</p>\n\n<p>From signature</p>\n\n<pre><code>join :: Eq a =&gt; [(a,b)] -&gt; [(a,c)] -&gt; [(a,b,c)]\n</code></pre>\n\n<p>you know type <code>a</code> is equatable and you know <strong>nothing</strong> about <code>b</code> and <code>c</code> types.</p>\n\n<p>A simple way to do this is</p>\n\n<pre><code>join xs ys = [(xa, xb, yc) | (xa, xb) &lt;- xs, (ya, yc) &lt;- ys, xa == ya]\n                                      --                     ^^^^^^^^\n                                      --                 from `Eq a` constraint\n</code></pre>\n"}], "owner": {"reputation": 458, "user_id": 3633383, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100000079202979/picture?type=large", "display_name": "Zast", "link": "https://stackoverflow.com/users/3633383/zast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1430313898, "creation_date": 1430298922, "question_id": 29939257, "link": "https://stackoverflow.com/questions/29939257/haskell-create-list-from-lists-with-different-attributes", "title": "haskell create list from lists with different attributes", "body": "<p>Yes this is a uni assignment question, so please do not just give me the answer, I need to be able to learn what it is and how to do it, (mostly because there are further questions and I need to develop an understanding of the Haskell language to do them!</p>\n\n<h1>THE QUESTION:</h1>\n\n<pre><code>join :: Eq a =&gt; [(a,b)] -&gt; [(a,c)] -&gt; [(a,b,c)].\n</code></pre>\n\n<p>join takes two lists of pairs, and returns a single list of triples. A triple\nis generated only when there exists a member of both argument lists\nthat have the same first element. The list elements are not sorted. This\nis the same semantics as the relational algebra natural join operation.</p>\n\n<p>For example:</p>\n\n<pre><code>join [(2,\"S\"),(1,\"J\")] [(2,True),(3,False)]) \n    Should produce the output [(2,\"S\",True)]\njoin [(2,\"S\"),(1,\"J\")] [(2,1),(2,2),(3,4)])\n    Should produce the output [(2,\"S\",1),(2,\"S\",2)]\n</code></pre>\n\n<h1>My problem</h1>\n\n<p>My main problem is trying to figure out how to create a new list from the 2 lists that are input, which have different attributes.</p>\n\n<h2>What I have so far:</h2>\n\n<pre><code>join :: Eq a =&gt; [(a,b)] -&gt; [(a,c)] -&gt; [(a,b,c)]\njoin xs     []     = xs\njoin []     ys     = ys\njoin (x:xs) (y:ys) = (x ++ snd(head[x]) ++ snd(head[y]) ++ []) join xs ys\n</code></pre>\n\n<h1>The resulting error:</h1>\n\n<pre><code>Type error in explicitly typed binding\n*** Term           : merge\n*** Type           : [(a,b)] -&gt; [(a,c)] -&gt; [(a,b)]\n*** Does not match : [(a,b)] -&gt; [(a,c)] -&gt; [(a,b,c)]\n</code></pre>\n\n<h1>Other notes:</h1>\n\n<p>I have tried several variations of the (x ++ snd(head[x]) ++ snd(head[y]) ++ []) section of code, with the results being mostly the same or simular error message!</p>\n"}, {"tags": ["haskell", "compiler-errors", "instances", "genetic-programming"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430316679, "post_id": 29938821, "comment_id": 48013380, "body": "Looks like you might have a conflicting version of a package installed (this happened to me the other day).  Try installing it in a sandbox, or if you already have try deleting the sandbox and starting with a fresh one."}, {"owner": {"reputation": 43, "user_id": 3950094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/215085325d5c901c5a17f159fb53ce97?s=128&d=identicon&r=PG&f=1", "display_name": "zariuq", "link": "https://stackoverflow.com/users/3950094/zariuq"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430355147, "post_id": 29938821, "comment_id": 48034974, "body": "Hmm, my cabal version didn&#39;t seem to support sandoxes (as I saw on a tutorial). So I updated to the Haskell Platform 2014.  Now cabalcomplains of compile errors when trying to install GenProg ...  Does GenProg (or the example) work for others? (Say on version 7.8.3, 7.10.1, or...)"}, {"owner": {"reputation": 43, "user_id": 3950094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/215085325d5c901c5a17f159fb53ce97?s=128&d=identicon&r=PG&f=1", "display_name": "zariuq", "link": "https://stackoverflow.com/users/3950094/zariuq"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1430380886, "post_id": 29938821, "comment_id": 48044654, "body": "Wow, I feel like an idiot :(  Adding <code>import GenProg.GenExpr import GenProg.GenExpr.Data</code> Got it to work :&lt;  (In version 7.6.3 -- the package doesn&#39;t seem to compile in other versions :/) With the example in the GitHub version: <a href=\"https://github.com/jsnajder/genprog/blob/master/src/GenProg.hs\" rel=\"nofollow noreferrer\">github.com/jsnajder/genprog/blob/master/src/GenProg.hs</a> (which, ugh, is slightly different from the Hackage version)"}, {"owner": {"reputation": 3754, "user_id": 604382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b768ebe08698de5cf097fbaa2e66f9cf?s=128&d=identicon&r=PG", "display_name": "declension", "link": "https://stackoverflow.com/users/604382/declension"}, "edited": false, "score": 0, "creation_date": 1504543306, "post_id": 29938821, "comment_id": 79042746, "body": "For posterity, I found that <i>just</i> the <code>import GenProg.GenExpr.Data</code> was sufficient (but necessary)"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1521244894, "post_id": 29938821, "comment_id": 85664119, "body": "@zariuq since you found an answer, you you add it and accept it to indicate this question was solved for future readers?"}], "answers": [{"tags": [], "owner": {"reputation": 43, "user_id": 3950094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/215085325d5c901c5a17f159fb53ce97?s=128&d=identicon&r=PG&f=1", "display_name": "zariuq", "link": "https://stackoverflow.com/users/3950094/zariuq"}, "is_accepted": false, "score": 0, "last_activity_date": 1521354714, "creation_date": 1521354714, "answer_id": 49345121, "question_id": 29938821, "link": "https://stackoverflow.com/questions/29938821/instance-errors-in-hackages-genprog-example/49345121#49345121", "title": "Instance errors in Hackage&#39;s GenProg example", "body": "<p>Adding import GenProg.GenExpr.Data got it to work. (In version 7.6.3 -- the package doesn't seem to compile in other versions.) With the example in the GitHub version: github.com/jsnajder/genprog/blob/master/src/GenProg.hs (which, ugh, is slightly different from the Hackage version) </p>\n\n<p>[Thanks for noting the question had been answered in comments.]</p>\n"}], "owner": {"reputation": 43, "user_id": 3950094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/215085325d5c901c5a17f159fb53ce97?s=128&d=identicon&r=PG&f=1", "display_name": "zariuq", "link": "https://stackoverflow.com/users/3950094/zariuq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1521354714, "creation_date": 1430297688, "last_edit_date": 1521329362, "question_id": 29938821, "link": "https://stackoverflow.com/questions/29938821/instance-errors-in-hackages-genprog-example", "title": "Instance errors in Hackage&#39;s GenProg example", "body": "<p>So, I'm trying to get an example of GenProg working, a Haskell genetic programming library.</p>\n\n<p>However, I'm getting various instance errors. My guess is that the example is written in slightly out-dated Haskell and just has to be minorly tweaked. The code makes sense, but I don't know enough about instances to easily rewrite it myself. I made a few tweaks.</p>\n\n<p>Error: </p>\n\n<blockquote>\n  <p>genprogtest.hs:27:10:\n      Could not deduce (MonadRandom-0.1.13:Control.Monad.Random.Class.MonadRandom\n                          (Rand StdGen))\n        arising from the superclasses of an instance declaration\n      from the context (GenExpr E)</p>\n</blockquote>\n\n<p>That is, the first line of the instance.\n(The actual example is here: <a href=\"https://hackage.haskell.org/package/genprog-0.1/docs/GenProg.html#9\" rel=\"nofollow\">https://hackage.haskell.org/package/genprog-0.1/docs/GenProg.html#9</a> )</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable, FlexibleInstances, FlexibleContexts, MultiParamTypeClasses #-}\n-- Just put them in one line, yo~\n\nimport GenProg\nimport GenProg.GenExpr\nimport Data.Generics\nimport Control.Monad\nimport Control.Monad.Random\n\ndata E = Plus E E\n       | Minus E E\n       | Times E E\n       | Div E E\n       | Const Int\n       deriving (Typeable,Data,Eq,Show)\n\neval :: E -&gt; Maybe Int\neval (Const c)     = Just c\neval (Plus e1 e2)  = liftM2 (+) (eval e1) (eval e2)\neval (Minus e1 e2) = liftM2 (-) (eval e1) (eval e2)\neval (Times e1 e2) = liftM2 (*) (eval e1) (eval e2)\neval (Div e1 e2) | ok        = liftM2 div x1 x2\n                 | otherwise = Nothing\n  where (x1,x2) = (eval e1,eval e2)\n        ok = x2 /= Just 0 &amp;&amp; liftM2 mod x1 x2 == Just 0\n\ninstance (GenExpr E) =&gt; GenProg (Rand StdGen) E where\n  terminal    = Const `liftM` getRandomR (1,9)\n  nonterminal = do\n    r &lt;- getRandomR (0,3)\n    [liftM2 Plus terminal terminal,\n     liftM2 Minus terminal terminal,\n     liftM2 Times terminal terminal,\n     liftM2 Div terminal terminal] !! r    \n\nmyFitness :: (GenProg.GenExpr.GenExpr E) =&gt; Int -&gt; E -&gt; Double\nmyFitness n e = error + size\n  where error = realToFrac $ maybe maxBound (abs . (n-)) (eval e)\n        size  = (realToFrac $ nodes e) / 100  \n</code></pre>\n"}, {"tags": ["file", "haskell", "io"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 2, "creation_date": 1430297252, "post_id": 29938484, "comment_id": 47998478, "body": "Have a look at <code>mapM_ :: Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m ()</code>."}], "answers": [{"comments": [{"owner": {"reputation": 59, "user_id": 1496332, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/919f5074049d5ab012b4c6e9b6c630ac?s=128&d=identicon&r=PG", "display_name": "jjcohen", "link": "https://stackoverflow.com/users/1496332/jjcohen"}, "edited": false, "score": 0, "creation_date": 1430300770, "post_id": 29939254, "comment_id": 48000931, "body": "That worked perfectly and thanks for explaining the steps along the way too, it made it much easier to understand."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1430298916, "creation_date": 1430298916, "answer_id": 29939254, "question_id": 29938484, "link": "https://stackoverflow.com/questions/29938484/batch-modify-files-haskell/29939254#29939254", "title": "Batch modify files Haskell", "body": "<p>Start by running the IO action producing the file list:</p>\n\n<pre><code>addHeaderToMultiple :: String -&gt; IO [FilePath] -&gt; IO ()\naddHeaderToMultiple header files = do\n   -- files has type IO [FilePath]\n   paths &lt;- files\n   -- paths has type [FilePath], so we can map over that\n   map (addHeaderToFile header) paths\n   -- this produces [IO ()], which is not IO ()\n</code></pre>\n\n<p>We hit a problem in the last line, which builds a list of IO actions instead of running them. We could use a helper function:</p>\n\n<pre><code>runInSequence :: [IO ()] -&gt; IO ()\nrunInSequence []     = return ()  -- nothing to do\nrunInSequence (a:as) = a &gt;&gt; runInSequence as\n</code></pre>\n\n<p>which can be simplified to</p>\n\n<pre><code>runInSequence = foldr (&gt;&gt;) (return ())\n</code></pre>\n\n<p>Actually, there already exists a library function doing that: it's called <code>sequence_</code>. Our code now becomes</p>\n\n<pre><code>import Control.Monad\naddHeaderToMultiple header files = do\n   paths &lt;- files\n   sequence_ (map (addHeaderToFile header) paths)\n   -- this produces IO (), so it's OK\n</code></pre>\n\n<p>The combo <code>sequence_ (map ...</code> has its own library function as well, called <code>mapM_</code>:</p>\n\n<pre><code>addHeaderToMultiple header files = do\n   paths &lt;- files\n   mapM_ (addHeaderToFile header) paths\n</code></pre>\n\n<p>This can be further refined using <code>&gt;&gt;=</code> directly</p>\n\n<pre><code>addHeaderToMultiple header files =\n   files &gt;&gt;= mapM_ (addHeaderToFile header)\n</code></pre>\n"}], "owner": {"reputation": 59, "user_id": 1496332, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/919f5074049d5ab012b4c6e9b6c630ac?s=128&d=identicon&r=PG", "display_name": "jjcohen", "link": "https://stackoverflow.com/users/1496332/jjcohen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 29939254, "answer_count": 1, "score": 1, "last_activity_date": 1430298916, "creation_date": 1430296708, "last_edit_date": 1430297211, "question_id": 29938484, "link": "https://stackoverflow.com/questions/29938484/batch-modify-files-haskell", "title": "Batch modify files Haskell", "body": "<p>I am trying to create a program that adds a simple text header to every file in a directory (and its subdirectories). I need to do this just using the built in functions from ghc (I can't access cabal).</p>\n\n<p>The type signature of the functions are</p>\n\n<pre><code>getRecursiveContents :: FilePath -&gt; IO [FilePath]\n\naddHeaderToFile :: String -&gt; FilePath -&gt; IO ()\n</code></pre>\n\n<p>These both work fine independently but I am struggling to use the two functions in conjunction because of the types. I assumed using a map would be the correct way to do this, but so far I have been unsuccessful.</p>\n\n<pre><code>addHeaderToMultiple :: String -&gt; IO [FilePath] -&gt; IO ()\naddHeaderToMultiple header files = map (addHeaderToFile header) files\n</code></pre>\n\n<p>I understand this will not work due to the types used but I have not found a way to fix it.</p>\n"}, {"tags": ["haskell", "typeclass", "applicative", "arrows", "alternative-functor"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1430289758, "post_id": 29935479, "comment_id": 47994045, "body": "It may be the case that it&#39;s impossible to be a Sum without being a Product, but being a Sum alone is possible."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1430294280, "post_id": 29936206, "comment_id": 47996756, "body": "<code>sumZip</code> is also pointless since you can have <code>either (fmap Left) (fmap Right)</code>, right?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1430300744, "post_id": 29936206, "comment_id": 48000909, "body": "@chi: I suppose so, but I&#39;m not sure about the proof."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1430289983, "creation_date": 1430289983, "answer_id": 29936206, "question_id": 29935479, "link": "https://stackoverflow.com/questions/29935479/product-and-sum-type-parallels-in-haskell-type-classes/29936206#29936206", "title": "Product and Sum Type Parallels in Haskell Type Classes", "body": "<p><code>Arrow</code> is basically the class for <a href=\"https://en.wikipedia.org/wiki/Monoidal_category\" rel=\"noreferrer\">monoidal categories</a><sup>1</sup> &ndash; with &ldquo;monoid&rdquo; not referring to <code>Monoid</code>, but the <em>product-monoid of Haskell types</em>. I.e., with unit element <code>()</code> and multiplication <code>(,)</code>. Now, sum types make up a monoid as well, and that's what <code>ArrowChoice</code> uses. These two classes are in that sense complementary; <code>ArrowChoice</code> shouldn't really be a subclass of <code>Arrow</code>.</p>\n\n<p>In a monoidal category, you can then go on to have <a href=\"https://en.wikipedia.org/wiki/Monoidal_functor\" rel=\"noreferrer\">monoidal functors</a>. How these come out depends on what you use as your type-monoid. For <code>(), (,)</code>, you get</p>\n\n<pre><code>class ProdMonoidalFtor f where\n  prodUnit :: () -&gt; f ()\n  prodZip :: (f a, f b) -&gt; f (a,b)\n\ntype (+) = Either\nclass SumMonoidalFtor f where\n  sumUnit :: Void -&gt; f Void\n  sumZip :: f a + f b -&gt; f (a+b)\n</code></pre>\n\n<p>Turns out the latter is basically useless, because <code>Void</code> is the <a href=\"https://en.wikipedia.org/wiki/Initial_and_terminal_objects\" rel=\"noreferrer\">initial object</a> of <strong>Hask</strong>, meaning there exists exactly one <code>Void -&gt; a</code> (namely <a href=\"http://hackage.haskell.org/package/void-0.7/docs/Data-Void.html#v:absurd\" rel=\"noreferrer\"><code>absurd</code></a>) for <em>all</em> types <code>a</code>. However, what does make some sense is <em>comonoidal functors</em> with <code>+</code>:</p>\n\n<pre><code>class SumCoMonoidalFtor f where\n  sumCounit :: f Void -&gt; Void -- I bet you find this useless too, but it's not totally.\n  sumCozip :: f (a+b) -&gt; f a + f b\n</code></pre>\n\n<p>That in turn wouldn't make sense for product types, because <code>()</code> is the <em>terminal</em> object.</p>\n\n<p>What's interesting now is that <code>ProdMonoidalFtor</code> is equivalent to <code>Applicative</code>:</p>\n\n<pre><code>instance (ProdMonoidalFtor f) =&gt; Applicative f where\n  pure x = fmap (const x) $ prodUnit ()\n  fs &lt;*&gt; xs = fmap (\\(f,x) -&gt; f x) $ prodZip (fs,xs)\n</code></pre>\n\n<p>One might then suspect that <code>Alternative</code> is equivalent to <code>SumMonoidalFtor</code>, but it's not! Actually, it is equivalent to <a href=\"http://www.reddit.com/r/haskell/comments/qsrmq/coapplicative_functor/\" rel=\"noreferrer\">decisive functors</a>, which are to <a href=\"http://hackage.haskell.org/package/comonad-4.2.5/docs/Control-Comonad.html\" rel=\"noreferrer\">comonads</a> as applicatives are to monads.</p>\n\n<p>Whereas <code>Alternative</code> and <code>MonadPlus</code> don't really seem to have much mathematical backing, they're essentially what you get when &ldquo;un-Kleisliing&rdquo; the <code>ArrowChoice</code> class, but using the Kleisli category that arises from <code>ProdMonoidalFtor</code>. It's all a bit dubious.</p>\n\n<hr>\n\n<p><sup>1</sup><sub>That's considering only <code>first</code>/<code>left</code>, <code>second</code>/<code>right</code>, and <code>***</code>/<code>+++</code>. As for the remaining <code>&amp;&amp;&amp;</code>, <code>|||</code> and <code>arr</code>, these are more specific and IMO belong <a href=\"http://hackage.haskell.org/package/constrained-categories-0.2.0.0/docs/Control-Arrow-Constrained.html\" rel=\"noreferrer\">in seperate classes</a>.</sub></p>\n"}], "owner": {"reputation": 327, "user_id": 3312149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nZoBq.jpg?s=128&g=1", "display_name": "David Harrison", "link": "https://stackoverflow.com/users/3312149/david-harrison"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 2, "accepted_answer_id": 29936206, "answer_count": 1, "score": 8, "last_activity_date": 1613970508, "creation_date": 1430287068, "last_edit_date": 1613970508, "question_id": 29935479, "link": "https://stackoverflow.com/questions/29935479/product-and-sum-type-parallels-in-haskell-type-classes", "title": "Product and Sum Type Parallels in Haskell Type Classes", "body": "<p>It appears that type classes such as <a href=\"http://hackage.haskell.org/package/base/docs/Control-Applicative.html#t:Applicative\">Applicative</a>, <a href=\"http://hackage.haskell.org/package/base/docs/Prelude.html#t:Monad\">Monad</a> and <a href=\"http://hackage.haskell.org/package/base/docs/Control-Arrow.html#t:Arrow\">Arrow</a> have some sort of sum type equivalent in type classes such as <a href=\"http://hackage.haskell.org/package/base/docs/Control-Applicative.html#t:Alternative\">Alternative</a>, <a href=\"http://hackage.haskell.org/package/base/docs/Control-Monad.html#t:MonadPlus\">MonadPlus</a> and <a href=\"http://hackage.haskell.org/package/base/docs/Control-Arrow.html#t:ArrowPlus\">ArrowPlus</a> respectively. For example, Applicative and Alternative can be used to define the following:</p>\n\n<pre><code>(&lt;&amp;&amp;&gt;) :: Applicative f =&gt; f a -&gt; f b -&gt; f (a, b)\na &lt;&amp;&amp;&gt; b = (,) &lt;$&gt; a &lt;*&gt; b\n\n(&lt;||&gt;) :: Alternative f =&gt; f a -&gt; f b -&gt; f (Either a b)\na &lt;||&gt; b = (Left &lt;$&gt; a) &lt;|&gt; (Right &lt;$&gt; b)\n</code></pre>\n\n<p>However, in all of these cases (as well as with <a href=\"http://hackage.haskell.org/package/base/docs/Control-Arrow.html#t:ArrowChoice\">ArrowChoice</a>), the product type class is a prerequisite for the sum type class. Are there type class rules or common functions that depend on the prerequisite class? The <a href=\"https://wiki.haskell.org/Typeclassopedia\">Typeclassopedia</a> touches on these relationships, but unfortunately I couldn't find any explicit reason for the dependency.</p>\n"}, {"tags": ["json", "parsing", "haskell", "curl", "io"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1430285963, "post_id": 29935116, "comment_id": 47992282, "body": "Well, you can&#39;t write <code>IO (CurlCode, String) -&gt; CurlCode</code>, but you can write <code>IO (CurlCode, String) -&gt; IO CurlCode</code> (which is <code>fmap fst</code>)."}, {"owner": {"reputation": 327, "user_id": 1748977, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8b2b5ffcfd4e2f5294728bfef99fd1a2?s=128&d=identicon&r=PG", "display_name": "camrymps", "link": "https://stackoverflow.com/users/1748977/camrymps"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1430287137, "post_id": 29935116, "comment_id": 47992766, "body": "Thank you for your comment @Zeta. Wouldn&#39;t this be expecting just IO CurlCode as a result and give me an error? I should be modifying this line: getReq url opt = curlGetString url opt right?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1430287463, "post_id": 29935116, "comment_id": 47992930, "body": "What&#39;s your actual goal? Do you want a <code>IO CurlCode</code>? In this case can you can use <code>fmap fst $ getReq url opt</code>. Do you want <code>CurlCode</code> as a result of <code>getReq</code> without <code>IO</code>? That&#39;s not possible. Either way, you should make clear what you actually want (in the question, not in the comments ;))."}], "answers": [{"tags": [], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "is_accepted": true, "score": 1, "last_activity_date": 1430286993, "creation_date": 1430286993, "answer_id": 29935456, "question_id": 29935116, "link": "https://stackoverflow.com/questions/29935116/get-curlcode-form-curl-io-response-haskell/29935456#29935456", "title": "Get CurlCode form cURL IO response - Haskell", "body": "<p>Here are some ideas of what you can do. Is any of them close to what you want to do?</p>\n\n<pre><code>getCurlCode :: IO (CurlCode, String) -&gt; IO CurlCode\ngetCurlCode res = do\n    (cc, _) &lt;- res\n    return cc\n\nprintCurlCode :: IO (CurlCode, String) -&gt; IO ()\nprintCurlCode res = do\n    (cc, _) &lt;- res\n    print cc\n\nprintStatus :: IO (CurlCode, String) -&gt; IO ()\nprintStatus res = do\n    cc &lt;- getCurlCode res\n    if cc == CurlOk\n        then putStrLn \"Everything okay\"\n        else putStrLn \"Maybe not okay\"\n\ncurlMessage :: CurlCode -&gt; String\ncurlMessage cc =\n    case cc of\n        CurlOk -&gt; \"Everything okay\"\n        _      -&gt; \"Maybe not okay\"\n\nprintCurlMessage :: IO (CurlCode, String) -&gt; IO ()\n    cc &lt;- getCurlCode res\n    let msg = curlMessage cc\n    putStrLn msg\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14052, "user_id": 1004301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a6aacd03deb37cb13cbc8b65e454f2b?s=128&d=identicon&r=PG", "display_name": "Lee Duhem", "link": "https://stackoverflow.com/users/1004301/lee-duhem"}, "is_accepted": false, "score": 1, "last_activity_date": 1430287279, "creation_date": 1430287279, "answer_id": 29935531, "question_id": 29935116, "link": "https://stackoverflow.com/questions/29935116/get-curlcode-form-curl-io-response-haskell/29935531#29935531", "title": "Get CurlCode form cURL IO response - Haskell", "body": "<p>You can use <code>getReq</code> like this:</p>\n\n<pre><code>do\n  (c, _) &lt;- getReq ...\n</code></pre>\n\n<p>Because <code>getReq</code> returns an <code>IO</code> monad instead of a normal value, it has to be used in another <code>IO</code> monad.</p>\n\n<p>You can learn more about monad and do-notation from <a href=\"https://wiki.haskell.org/Monad\" rel=\"nofollow\">Monad</a></p>\n"}], "owner": {"reputation": 327, "user_id": 1748977, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8b2b5ffcfd4e2f5294728bfef99fd1a2?s=128&d=identicon&r=PG", "display_name": "camrymps", "link": "https://stackoverflow.com/users/1748977/camrymps"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 29935456, "answer_count": 2, "score": 0, "last_activity_date": 1430287444, "creation_date": 1430285557, "question_id": 29935116, "link": "https://stackoverflow.com/questions/29935116/get-curlcode-form-curl-io-response-haskell", "title": "Get CurlCode form cURL IO response - Haskell", "body": "<p>I am relatively new to Haskell and I am having some trouble with parsing the response of a cURL request.</p>\n\n<p>Here is the code I have so far:</p>\n\n<pre><code>import Control.Monad\nimport Network.Curl\nimport Data.Aeson\n\ngetReq :: URLString -&gt; [CurlOption] -&gt; IO (CurlCode, String)\ngetReq url opt = curlGetString url opt\n</code></pre>\n\n<p>When I use the getReq function,</p>\n\n<pre><code>Prelude&gt; getReq \"http://google.com\" []\n</code></pre>\n\n<p>I get something like this as a response:</p>\n\n<pre><code>(CurlOk, \"&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"&gt;...)\n</code></pre>\n\n<p>What I am trying to do is just somehow parse out the CurlCode (CurlOk). It is an IO type so I am confused on how I would go about getting the CurlCode from that.</p>\n\n<p>Any help is greatly appreciated!</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 177, "user_id": 708134, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/36f1e433c4e029dcd48d6c5cae1e4600?s=128&d=identicon&r=PG", "display_name": "Lyndon Maydwell", "link": "https://stackoverflow.com/users/708134/lyndon-maydwell"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1430286478, "post_id": 29934976, "comment_id": 47992464, "body": "It&#39;s a manual installation. GHC 7.8.3 - Up-to-date cabal."}], "answers": [{"tags": [], "owner": {"reputation": 177, "user_id": 708134, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/36f1e433c4e029dcd48d6c5cae1e4600?s=128&d=identicon&r=PG", "display_name": "Lyndon Maydwell", "link": "https://stackoverflow.com/users/708134/lyndon-maydwell"}, "is_accepted": true, "score": 1, "last_activity_date": 1430286597, "creation_date": 1430286597, "answer_id": 29935363, "question_id": 29934976, "link": "https://stackoverflow.com/questions/29934976/issue-using-hoe-from-cabal-sandbox-system-random-not-found/29935363#29935363", "title": "Issue using Hoe from cabal sandbox - System.Random not found", "body": "<p>I actually just came across the solution</p>\n\n<p>Setting GHC_PACKAGE_PATH to include the sandbox, and the default package location:</p>\n\n<pre><code>lyndon@endpin ~/Haskell-Sandboxes/hoe-1.0.1 find ~/ghc_versions/ghc-7.8.3/ | grep package.cache\n/Users/lyndon/ghc_versions/ghc-7.8.3//lib/ghc-7.8.3/package.conf.d/package.cache\nlyndon@endpin ~/Haskell-Sandboxes/hoe-1.0.1 GHC_PACKAGE_PATH=~/ghc_versions/ghc-7.8.3//lib/ghc-7.8.3/package.conf.d:./.cabal-sandbox/x86_64-osx-ghc-7.8.3-packages.conf.d ./.cabal-sandbox/bin/hoe head\nasdf\n'a'\n</code></pre>\n"}], "owner": {"reputation": 177, "user_id": 708134, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/36f1e433c4e029dcd48d6c5cae1e4600?s=128&d=identicon&r=PG", "display_name": "Lyndon Maydwell", "link": "https://stackoverflow.com/users/708134/lyndon-maydwell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30, "favorite_count": 0, "accepted_answer_id": 29935363, "answer_count": 1, "score": 0, "last_activity_date": 1430286597, "creation_date": 1430284922, "last_edit_date": 1495542133, "question_id": 29934976, "link": "https://stackoverflow.com/questions/29934976/issue-using-hoe-from-cabal-sandbox-system-random-not-found", "title": "Issue using Hoe from cabal sandbox - System.Random not found", "body": "<p>I'm trying to use the <a href=\"http://github.com/tanakh/hoe\" rel=\"nofollow noreferrer\">Hoe</a> utility from a cabal sandbox and am presented with the following error:</p>\n\n<pre><code>lyndon@endpin ~/Haskell-Sandboxes/hoe-1.0.1 ./.cabal-sandbox/bin/hoe head\ncompile error: &lt;no location info&gt;:\n    Could not find module \u2018System.Random\u2019\n    Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>I believe that this is due to Hoe using Hint to interpret expressions at runtime, and as part of this, expecting to be able to load globally installed modules. However, since I'm using a cabal-sandbox, modules are only installed locally.</p>\n\n<p>I've attempted to look for any environment variables I can use to specify the location of the random module as <code>./.cabal-sandbox/lib/x86_64-osx-ghc-7.8.3/random-1.1</code>, however nothing obvious has appeared.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/22070308/using-fay-in-a-cabal-sandbox\">22070308</a> suggested that HASKELL_PACKAGE_SANDBOX might help, but it doesn't seem to.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 3, "last_activity_date": 1430274989, "creation_date": 1430274989, "answer_id": 29933350, "question_id": 29933069, "link": "https://stackoverflow.com/questions/29933069/how-can-i-make-insert-sort-high-order-function-in-haskell/29933350#29933350", "title": "How can i make Insert_sort high-order-function in Haskell", "body": "<p>First, a fundamental misunderstanding.</p>\n\n<p>Write a type for <code>insert_high</code> - it should probably be <code>(a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]</code>. But you've written a specialization for lists of tuples, so you've forced it to be less general than that.</p>\n\n<p>You can only cover the general case. You're being misled by your examples.</p>\n\n<p>I'd argue what you really want is</p>\n\n<pre><code>\u03bb insert_sort_high (&lt;) [3,5,2,1,4]\n[1,2,3,4,5]\n\u03bb insert_sort_high (\\(x,y) (a,b) -&gt; x &lt; a) [(2,'a'), (3,'b'), (1,'c')]\n[(1,'c'),(2,'a'),(3,'b')]\n</code></pre>\n\n<p>The latter can be written a little more easily as</p>\n\n<pre><code>\u03bb :m +Data.Function\n\u03bb insert_sort_high ((&lt;) `on` fst) [(2,'a'), (3,'b'), (1,'c')]\n[(1,'c'),(2,'a'),(3,'b')]\n</code></pre>\n\n<p>Of course, that's only if you only want sorting to be on the first element of the pair.</p>\n\n<pre><code>\u03bb insert_sort_high ((&lt;) `on` fst) [(2,'a'), (3,'b'), (1, 'a'), (1,'b'), (1,'c'), (1,'a')]\n[(1,'a'),(1,'c'),(1,'b'),(1,'a'),(2,'a'),(3,'b')]\n</code></pre>\n\n<p>If you want to sort by the entire pair, you can do that too</p>\n\n<pre><code>\u03bb (1,'a') &lt; (1,'b')\nTrue\n\u03bb (1,'z') &lt; (2,'a')\nTrue\n\u03bb insert_sort_high (&lt;) [(2,'a'), (3,'b'), (1,'a'),(1,'b'),(1,'c'), (1,'a')]\n[(1,'a'),(1,'a'),(1,'b'),(1,'c'),(2,'a'),(3,'b')]\n</code></pre>\n\n<p>But I digress.</p>\n\n<p>With that in mind all you really need to do is delete your tuple case, and clean up some typos.</p>\n\n<pre><code>insert_high :: (a -&gt; a -&gt; Bool) -&gt; a -&gt; [a] -&gt; [a]                   \ninsert_high _ x [] = [x]                                             \ninsert_high f x (y:ys)                                               \n            | f x y = x:y:ys                                         \n            | otherwise = y : insert_high f x ys                     \n\ninsert_sort_high _ [] = []                                           \ninsert_sort_high f (x:xs) = insert_high f x (insert_sort_high f xs)  \n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 4526666, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MIUPY.png?s=128&g=1", "display_name": "Carrot", "link": "https://stackoverflow.com/users/4526666/carrot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1430274989, "creation_date": 1430272912, "question_id": 29933069, "link": "https://stackoverflow.com/questions/29933069/how-can-i-make-insert-sort-high-order-function-in-haskell", "title": "How can i make Insert_sort high-order-function in Haskell", "body": "<p>plz watch my code</p>\n\n<pre><code>insert x [] = [x]\ninsert x (y:ys)\n    | x &lt; y = x:y:ys\n    | x == y = y:ys ++ [x]\n    | otherwise = y:insert x ys\n\ninsert_sort [] = []\ninsert_sort (x:xs) = insert x (insert_sort xs)\n\ninsert_pair (x,y) [] = [(x,y)]\ninsert_pair (x,y) ((a,b):yd)\n                     | x &gt; a = (a,b):insert_pair (x,y) yd\n                     | otherwise = (x,y):(a,b):yd\n\ninsert_sort_pair [] = []\ninsert_sort_pair (x:xs) = insert_pair x (insert_sort_pair xs)\n\ninsert_high f [] = []\ninsert_high f (x:y:ys)\n            | f x y = x:y:ys\n            | otherwise = y:insert x ys\ninsert_high f ((a,b):(c,d):yd)\n            | f a c = (a,b):insert_pair (c,d) yd\n            | otherwise = (a,b):(c,d):yd\n\ninsert_sort_high f [] = []\ninsert_sort_high f (x:xs) = insert_high (f) x (insert_sort_high (f) xs)\n</code></pre>\n\n<p>I want to make insert_sort-high can do both insert_sort and insert_pair_sort.\n\"insert_sort_pair\" compare the number in (number,symbol).\nFor example:</p>\n\n<pre><code>insert_sort_high (&lt;) [3,5,2,1,4] -&gt; [1,2,3,4,5]\ninsert_sort_high (&gt;) [(2,'a'),(3,'b'),(1,'c')] -&gt; [(1,'c'),(2,'a'),(3,'b')]\n</code></pre>\n\n<p>But, it doesn't work... how can i fix it?</p>\n"}, {"tags": ["json", "haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1430271997, "post_id": 29932879, "comment_id": 47988135, "body": "There&#39;s the popular <code>aeson</code> library for turning JSON into Haskell types, either generically into a <code>Value</code> type representing plain JSON or deserialized into a custom type."}, {"owner": {"reputation": 4190, "user_id": 883571, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/101a7f7286ea9c1de403a063b7a09740?s=128&d=identicon&r=PG", "display_name": "jiyinyiyong", "link": "https://stackoverflow.com/users/883571/jiyinyiyong"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430272841, "post_id": 29932879, "comment_id": 47988351, "body": "@bheklilr I did read some examples on <code>JSON.Text</code> and <code>Aeson</code> but all of them are showing showing how to decode records. While my question is how to decode a recursive JSON array."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430273947, "post_id": 29932879, "comment_id": 47988622, "body": "<code>decode &quot;[[\\&quot;a\\&quot;,\\&quot;b\\&quot;,[\\&quot;c\\&quot;]]]&quot; :: Maybe Value</code> returns <code>Just (Array (fromList [Array (fromList [String &quot;a&quot;,String &quot;b&quot;,Array (fromList [String &quot;c&quot;])])]))</code>.  You can then pattern match on this like any other data type (<a href=\"http://hackage.haskell.org/package/aeson-0.8.0.2/docs/Data-Aeson-Types.html#t:Value\" rel=\"nofollow noreferrer\">documentation</a>].  You could write an instance for <code>FromJSON</code> where you just use <code>parseJSON</code> recursively <a href=\"https://gist.github.com/bheklilr/079b06f21c02d5094d26\" rel=\"nofollow noreferrer\">like this</a>."}], "answers": [{"comments": [{"owner": {"reputation": 4190, "user_id": 883571, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/101a7f7286ea9c1de403a063b7a09740?s=128&d=identicon&r=PG", "display_name": "jiyinyiyong", "link": "https://stackoverflow.com/users/883571/jiyinyiyong"}, "edited": false, "score": 0, "creation_date": 1430357281, "post_id": 29933661, "comment_id": 48035619, "body": "Thanks. By the way can <code>Text.JSON</code> do this?"}, {"owner": {"reputation": 4190, "user_id": 883571, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/101a7f7286ea9c1de403a063b7a09740?s=128&d=identicon&r=PG", "display_name": "jiyinyiyong", "link": "https://stackoverflow.com/users/883571/jiyinyiyong"}, "edited": false, "score": 0, "creation_date": 1430357572, "post_id": 29933661, "comment_id": 48035700, "body": "strange, <code>traverse p a</code> but what is <code>p</code>?"}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "reply_to_user": {"reputation": 4190, "user_id": 883571, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/101a7f7286ea9c1de403a063b7a09740?s=128&d=identicon&r=PG", "display_name": "jiyinyiyong", "link": "https://stackoverflow.com/users/883571/jiyinyiyong"}, "edited": false, "score": 0, "creation_date": 1430360373, "post_id": 29933661, "comment_id": 48036480, "body": "Oh, it was a copy and paste error, apologies. I&#39;ve fixed <code>p</code> now."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "reply_to_user": {"reputation": 4190, "user_id": 883571, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/101a7f7286ea9c1de403a063b7a09740?s=128&d=identicon&r=PG", "display_name": "jiyinyiyong", "link": "https://stackoverflow.com/users/883571/jiyinyiyong"}, "edited": false, "score": 0, "creation_date": 1430360402, "post_id": 29933661, "comment_id": 48036493, "body": "I&#39;ve actually honestly never used <code>Text.JSON</code>. I&#39;m sure it is possible, but I&#39;d have to go look up how."}, {"owner": {"reputation": 4190, "user_id": 883571, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/101a7f7286ea9c1de403a063b7a09740?s=128&d=identicon&r=PG", "display_name": "jiyinyiyong", "link": "https://stackoverflow.com/users/883571/jiyinyiyong"}, "edited": false, "score": 0, "creation_date": 1430410721, "post_id": 29933661, "comment_id": 48065489, "body": "Hi can you look at this too: <code>test.hs:7:40: Not in scope: type constructor or class \u2018Text\u2019</code>?"}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "reply_to_user": {"reputation": 4190, "user_id": 883571, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/101a7f7286ea9c1de403a063b7a09740?s=128&d=identicon&r=PG", "display_name": "jiyinyiyong", "link": "https://stackoverflow.com/users/883571/jiyinyiyong"}, "edited": false, "score": 0, "creation_date": 1430418070, "post_id": 29933661, "comment_id": 48069756, "body": "Yup, sorry, it&#39;s a little nicer that way but unnecessary. Add <code>import Data.Text (Text)</code> to the top of the file."}], "tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": true, "score": 3, "last_activity_date": 1430360382, "last_edit_date": 1430360382, "creation_date": 1430277122, "answer_id": 29933661, "question_id": 29932879, "link": "https://stackoverflow.com/questions/29932879/how-to-decode-recursive-json-arrays-in-haskell/29933661#29933661", "title": "How to decode recursive JSON arrays in Haskell?", "body": "<p>You can do something a little like this</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Aeson\nimport Data.Traversable (traverse)\nimport Data.Foldable (toList)\nimport Control.Applicative\n\ndata CValue = CList [CValue] | CString Text deriving Show\n\ninstance FromJSON CValue where\n  parseJSON v = \n        withText \"CString\" (pure . CString) v\n    &lt;|&gt; withArray \"CList\" (\\a -&gt; CList . toList &lt;$&gt; traverse parseJSON a) v\n</code></pre>\n\n<p>With this instance set you can use <code>decode :: FromJSON a =&gt; Data.ByteString.Lazy.Internal.ByteString -&gt; Maybe a</code></p>\n\n<pre><code>&gt; decode \"[[\\\"a\\\",\\\"b\\\",[\\\"c\\\"]]]\" :: Maybe CValue\nJust (CList [CList [CString \"a\",CString \"b\",CList [CString \"c\"]]])\n</code></pre>\n"}], "owner": {"reputation": 4190, "user_id": 883571, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/101a7f7286ea9c1de403a063b7a09740?s=128&d=identicon&r=PG", "display_name": "jiyinyiyong", "link": "https://stackoverflow.com/users/883571/jiyinyiyong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "accepted_answer_id": 29933661, "answer_count": 1, "score": 0, "last_activity_date": 1430360382, "creation_date": 1430271376, "last_edit_date": 1430273004, "question_id": 29932879, "link": "https://stackoverflow.com/questions/29932879/how-to-decode-recursive-json-arrays-in-haskell", "title": "How to decode recursive JSON arrays in Haskell?", "body": "<p>For such a piece of JSON:</p>\n\n<pre><code>[\n  [\n    \"a\",\n    \"b\",\n    [\n      \"c\"\n    ]\n  ]\n]\n</code></pre>\n\n<p>How to decode it in Haskell?</p>\n\n<p>And this is a recursive array in JSON:</p>\n\n<pre><code>data CValue = CList [CValue] | CString String\n</code></pre>\n\n<p>I've read demos on parsing records with <code>JSON.text</code> and <code>Aeson</code>, but those code does not work on recursive data types.</p>\n"}, {"tags": ["haskell", "pipe"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1430271487, "post_id": 29932852, "comment_id": 47987996, "body": "I think you need the <a href=\"http://hackage.haskell.org/package/pipes-3.2.0/docs/Control-Proxy-Prelude-Base.html#g:7\" rel=\"nofollow noreferrer\"><code>ArrowChoice</code> proxies</a>. <a href=\"http://www.haskellforall.com/2013/03/pipes-32-listt-codensity-arrowchoice.html\" rel=\"nofollow noreferrer\">Some discussion here</a>"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1430277695, "post_id": 29932852, "comment_id": 47989570, "body": "See <code>(+++)</code> in <a href=\"http://hackage.haskell.org/package/pipes-extras-1.0.0/docs/Pipes-Extras.html#g:1\" rel=\"nofollow noreferrer\">pipes-extras</a> Keep in mind a <code>Consumer</code> is a <code>Pipe</code> (to nowhere), so <code>P.toHandle IO.stderr +++ P.stdoutLn :: MonadIO m =&gt; Pipe (Either String String) (Either b d) m ()</code> To get a <code>Consumer</code>, you would have to get rid of the <code>Left</code>s e.g with <code>&gt;-&gt; P.concat</code> or <code>&gt;-&gt; P.drain</code>  There are more robust and handsome ways of doing this with Folds."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1430279232, "post_id": 29932852, "comment_id": 47990054, "body": "Sorry, maybe that was more confusing than: <code>merge p q = p +++ q &gt;-&gt; P.concat</code> .  (Here, <code>P.concat</code> is acting like <code>Data.Either.rights</code>)"}, {"owner": {"reputation": 111, "user_id": 4179594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b47be26101e06a8d4ae443e8adcdb4a?s=128&d=identicon&r=PG&f=1", "display_name": "ilyaletre", "link": "https://stackoverflow.com/users/4179594/ilyaletre"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1430304376, "post_id": 29932852, "comment_id": 48003585, "body": "@rampion I found out that what I want to do is not &quot;merging consumers&quot; but &quot;choose consumers&quot;. You gave me the point. I&#39;ll check it. Thanks."}, {"owner": {"reputation": 111, "user_id": 4179594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b47be26101e06a8d4ae443e8adcdb4a?s=128&d=identicon&r=PG&f=1", "display_name": "ilyaletre", "link": "https://stackoverflow.com/users/4179594/ilyaletre"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1430304588, "post_id": 29932852, "comment_id": 48003735, "body": "@Michael concise combinator +++! It looks useful. I&#39;ll try it. Thanks."}, {"owner": {"reputation": 11412, "user_id": 617159, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc43cf2d76ce0981a21c0e5a817f96f5?s=128&d=identicon&r=PG", "display_name": "Lambda Fairy", "link": "https://stackoverflow.com/users/617159/lambda-fairy"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1439688406, "post_id": 29932852, "comment_id": 51963320, "body": "@Michael would you like to write that up as an answer? :P"}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 1, "last_activity_date": 1470693510, "creation_date": 1470693510, "answer_id": 38839149, "question_id": 29932852, "link": "https://stackoverflow.com/questions/29932852/how-to-merge-two-consumer-into-one-in-haskell-pipes/38839149#38839149", "title": "How to merge two Consumer into one in Haskell Pipes?", "body": "<p>(This is @Michael's answer, but I'd like to write it up here so we can move the question out of the unanswered queue for the Haskell tag.)</p>\n\n<p>See <code>(+++)</code> in <a href=\"http://hackage.haskell.org/package/pipes-extras-1.0.4/docs/Pipes-Extras.html\" rel=\"nofollow\">pipes-extras</a>. Keep in mind a <code>Consumer</code> is a <code>Pipe</code> (to nowhere), so <code>P.toHandle IO.stderr +++ P.stdoutLn :: MonadIO m =&gt; Pipe (Either String String) (Either b d) m ()</code>.</p>\n\n<p>To get a <code>Consumer</code>, you would have to get rid of the <code>Lefts</code> e.g with <code>&gt;-&gt; P.concat</code> or <code>&gt;-&gt; P.drain</code>. There are more robust and handsome ways of doing this with <code>Fold</code>s.</p>\n"}], "owner": {"reputation": 111, "user_id": 4179594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b47be26101e06a8d4ae443e8adcdb4a?s=128&d=identicon&r=PG&f=1", "display_name": "ilyaletre", "link": "https://stackoverflow.com/users/4179594/ilyaletre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 2, "answer_count": 1, "score": 11, "last_activity_date": 1470693510, "creation_date": 1430271059, "question_id": 29932852, "link": "https://stackoverflow.com/questions/29932852/how-to-merge-two-consumer-into-one-in-haskell-pipes", "title": "How to merge two Consumer into one in Haskell Pipes?", "body": "<p>I use Haskell stream processing library <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"noreferrer\">pipes</a> to write a command line tool. Each command line actions may output result to <code>stdout</code> and logs to <code>stderr</code> with <code>pipes</code> API.</p>\n\n<p>I need <code>Consumer</code> which has type as <code>Consumer (Either String String) m r</code> to print chunk of data (<code>Left</code> to <code>stderr</code>, <code>Right</code> to <code>stdout</code>) with single <code>Consumer</code>.</p>\n\n<h3>Code I wrote (should be improved)</h3>\n\n<p>This function <code>consumeEither</code> doesn't have flexibility so I want to improve it.</p>\n\n<pre><code>consumeEither :: (MonadIO m) =&gt; Consumer (Either String String) m ()\nconsumeEither = do\n  eitherS &lt;- await\n  case eitherS of\n    (Left l)  -&gt; for (yield l) (liftIO . (IO.hPutStrLn IO.stderr))\n    (Right r) -&gt; for (yiled r) (liftIO . putStrLn)\n</code></pre>\n\n<p>Furthermore it would be useful to provide a function which takes two <code>Consumer</code>s and merge them into one <code>Consumer</code>.</p>\n\n<h3>Question</h3>\n\n<p><em>Does anybody know good example or implementation of the following interface?</em></p>\n\n<pre><code>merge :: (Monad m) =&gt; Consumer a m r -&gt; Consumer b m r -&gt; Consumer (Either a b) m r\n</code></pre>\n\n<ul>\n<li>1st argument as <code>stderr</code></li>\n<li>2nd argument as <code>stdout</code></li>\n</ul>\n\n<h3>Usage of the function</h3>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import           Pipes\nimport qualified Pipes.Prelude as P\nimport qualified System.IO as IO\n\nstdoutOrErr :: Consumer (Either String String) IO ()\nstdoutOrErr = merge (P.toHandle IO.stderr) P.stdoutLn\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1430270685, "post_id": 29932708, "comment_id": 47987778, "body": "What have you done to find out the syntax to do this? There are lots of resources to learn haskell on the Internet (learn you a haskell is a popular one), but stackoverflow is meant to be a place to get help with a particular problem with code, not somewhere to get free tutoring."}, {"owner": {"reputation": 1473, "user_id": 204305, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4fa6165d3bcb50e58e60304807f4090a?s=128&d=identicon&r=PG", "display_name": "Sage Mitchell", "link": "https://stackoverflow.com/users/204305/sage-mitchell"}, "edited": false, "score": 2, "creation_date": 1430271055, "post_id": 29932708, "comment_id": 47987884, "body": "It helps if you can break the problem into pieces. If you could remove all trailing 0&#39;s would you know what to do? Would it help to remove just one trailing 0 (if there is one)?"}, {"owner": {"reputation": 9, "user_id": 4844326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863458c9b7ae85bdc5039e6b7c794e52?s=128&d=identicon&r=PG&f=1", "display_name": "John Marley", "link": "https://stackoverflow.com/users/4844326/john-marley"}, "edited": false, "score": 0, "creation_date": 1430275796, "post_id": 29932708, "comment_id": 47989051, "body": "@bheklir  I know exactly what to do conceptually and have looked through multiple pages through syntax for hours. Haskell syntax is a problem for me for whatever reason. :/"}, {"owner": {"reputation": 9, "user_id": 4844326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863458c9b7ae85bdc5039e6b7c794e52?s=128&d=identicon&r=PG&f=1", "display_name": "John Marley", "link": "https://stackoverflow.com/users/4844326/john-marley"}, "reply_to_user": {"reputation": 1473, "user_id": 204305, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4fa6165d3bcb50e58e60304807f4090a?s=128&d=identicon&r=PG", "display_name": "Sage Mitchell", "link": "https://stackoverflow.com/users/204305/sage-mitchell"}, "edited": false, "score": 0, "creation_date": 1430275936, "post_id": 29932708, "comment_id": 47989094, "body": "@JakeMitchell I thought I could define it recursively somehow. e.g. P a == P a++[0] = True."}, {"owner": {"reputation": 1473, "user_id": 204305, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4fa6165d3bcb50e58e60304807f4090a?s=128&d=identicon&r=PG", "display_name": "Sage Mitchell", "link": "https://stackoverflow.com/users/204305/sage-mitchell"}, "edited": false, "score": 0, "creation_date": 1430278150, "post_id": 29932708, "comment_id": 47989732, "body": "<code>removeLeadingZeros (0 : xs) = removeLeadingZeros xs</code>"}, {"owner": {"reputation": 1473, "user_id": 204305, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4fa6165d3bcb50e58e60304807f4090a?s=128&d=identicon&r=PG", "display_name": "Sage Mitchell", "link": "https://stackoverflow.com/users/204305/sage-mitchell"}, "edited": false, "score": 0, "creation_date": 1430278233, "post_id": 29932708, "comment_id": 47989764, "body": "And then <code>removeLeadingZeros xs = xs</code> (I&#39;m on my phone. Pardon the concision.)"}], "answers": [{"tags": [], "owner": {"reputation": 1473, "user_id": 204305, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4fa6165d3bcb50e58e60304807f4090a?s=128&d=identicon&r=PG", "display_name": "Sage Mitchell", "link": "https://stackoverflow.com/users/204305/sage-mitchell"}, "is_accepted": false, "score": 2, "last_activity_date": 1430278547, "creation_date": 1430278547, "answer_id": 29933874, "question_id": 29932708, "link": "https://stackoverflow.com/questions/29932708/creating-eq-instances-for-polynomials/29933874#29933874", "title": "Creating Eq instances for polynomials", "body": "<p><code>\nremoveLeadingZeros (0 : xs) = removeLeadingZeros xs\nremoveLeadingZeros xs = xs\n</code></p>\n\n<p>Reverse the list, remove leading zeros, and then reverse again.</p>\n\n<p><code>\n(reverse . removeLeadingZeros . reverse) [3, 2, 1, 0, 0, 0]\n</code></p>\n\n<p>Do the same operation to both polynomials and compare using <code>==</code>.</p>\n\n<p>(Untested for now, but I think this is right.)</p>\n"}, {"comments": [{"owner": {"reputation": 1473, "user_id": 204305, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4fa6165d3bcb50e58e60304807f4090a?s=128&d=identicon&r=PG", "display_name": "Sage Mitchell", "link": "https://stackoverflow.com/users/204305/sage-mitchell"}, "edited": false, "score": 0, "creation_date": 1430282565, "post_id": 29934390, "comment_id": 47991084, "body": "Thanks for elaborating."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 1473, "user_id": 204305, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4fa6165d3bcb50e58e60304807f4090a?s=128&d=identicon&r=PG", "display_name": "Sage Mitchell", "link": "https://stackoverflow.com/users/204305/sage-mitchell"}, "edited": false, "score": 0, "creation_date": 1430282741, "post_id": 29934390, "comment_id": 47991134, "body": "no problem - the important parts are still all yours ;)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 4, "last_activity_date": 1430282711, "last_edit_date": 1430282711, "creation_date": 1430281736, "answer_id": 29934390, "question_id": 29932708, "link": "https://stackoverflow.com/questions/29932708/creating-eq-instances-for-polynomials/29934390#29934390", "title": "Creating Eq instances for polynomials", "body": "<h2>implementing <code>Eq</code></h2>\n\n<p>Just to extend on Jakes answer so you get a complete one:</p>\n\n<p>I like the idea of just removing the leading zeros and with this you soon end up with:</p>\n\n<pre><code>newtype Poly a = P [a]\n\ninstance (Num a, Eq a) =&gt; Eq (Poly a) where\n  P xs == P ys =\n    removeLeadingZeros (reverse xs) == removeLeadingZeros (reverse ys)\n\nremoveLeadingZeros :: (Eq a, Num a) =&gt; [a] -&gt; [a]\nremoveLeadingZeros (0 : xs) = removeLeadingZeros xs\nremoveLeadingZeros xs = xs\n</code></pre>\n\n<p>mind, that you don't really have to <code>reverse</code> again to just look for equality (as <code>xs == ys &lt;=&gt; reverse xs == reverse ys</code>)</p>\n\n<p>here is a short test session in ghci:</p>\n\n<pre><code>\u03bb&gt; let p1 = P[1,2,3,0,0]\n\u03bb&gt; let p2 = P[1,2,3]\n\u03bb&gt; let p3 = P[1,2,3,0,4]\n\n\u03bb&gt; p1 == p2\nTrue\n\n\u03bb&gt; p1 == p3\nFalse\n\n\u03bb&gt; p2 == p3\nFalse\n</code></pre>\n\n<h2>using <em>smart</em> constructors</h2>\n\n<p>Another possibility is to not publish the <code>P</code> constructor and get the polynoms into a normalized form at construction - this has the advantage that you can just use <code>deriving Eq</code></p>\n\n<pre><code>module Poly\n       ( Poly, fromList\n       ) where\n\nnewtype Poly a = P [a]\n                 deriving Eq\n\nfromList :: (Num a, Eq a) =&gt; [a] -&gt; Poly a\nfromList = P . reverse . removeLeadingZeros . reverse\n</code></pre>\n\n<h3>example</h3>\n\n<pre><code>\u03bb&gt; let p1 = fromList [1,2,3,0,0]\n\u03bb&gt; let p2 = fromList [1,2,3]\n\n\u03bb&gt; p1 == p2\nTrue\n</code></pre>\n\n<h3>hiding it all</h3>\n\n<p>As you already seem to have implemented <code>Num (Poly a)</code> you can even remove the <code>fromList</code> from the exports - so users have to use arithmetic operators instead to construct polynoms.</p>\n\n<p>You basically just have to export an <code>x</code> instead:</p>\n\n<pre><code>x :: (Eq a, Num a) =&gt; Poly a\nx = fromList [0,1]\n</code></pre>\n\n<h2>remarks</h2>\n\n<p>Depending on if <code>P []</code> is ok for the zero polynom or if you rather have <code>P [0]</code> in this case instead you might want to rewrite <code>removeLeadingZeros</code> to</p>\n\n<pre><code>removeLeadingZeros :: (Eq a, Num a) =&gt; [a] -&gt; [a]\nremoveLeadingZeros [0] = [0]\nremoveLeadingZeros (0 : xs) = removeLeadingZeros xs\nremoveLeadingZeros xs = xs\n</code></pre>\n\n<p>or something like it</p>\n"}], "owner": {"reputation": 9, "user_id": 4844326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863458c9b7ae85bdc5039e6b7c794e52?s=128&d=identicon&r=PG&f=1", "display_name": "John Marley", "link": "https://stackoverflow.com/users/4844326/john-marley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "accepted_answer_id": 29934390, "answer_count": 2, "score": 0, "last_activity_date": 1430282711, "creation_date": 1430270032, "last_edit_date": 1430281005, "question_id": 29932708, "link": "https://stackoverflow.com/questions/29932708/creating-eq-instances-for-polynomials", "title": "Creating Eq instances for polynomials", "body": "<p>Representing polynomials in Haskell:</p>\n\n<pre><code>newtype Poly a = P [a]\nx :: Num a =&gt; Poly a\nx = P [1]\n\ninstance (Num a, Eq a) =&gt; Eq (Poly a) where\n</code></pre>\n\n<p>E.g. <code>P[1,2,3] = 3x^2 + 2x + 1</code></p>\n\n<p>I want to say that two polynomials are equal if the lists they have are equal (e.g. <code>P[1,2,3]</code> is equal to <code>P[1,2,3]</code>). They are also equal if the lists are the same except the last elements are 0's (e.g. <code>P[1,2,3]</code> is equal to <code>P[1,2,3,0,0]</code>).</p>\n\n<p>However, I don't know the syntax for how to do this.</p>\n"}, {"tags": ["haskell", "subclass", "typeclass", "adhoc-polymorphism"], "comments": [{"owner": {"reputation": 555, "user_id": 4108393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1616347e88a4828ad7b5eaf6dff2337?s=128&d=identicon&r=PG&f=1", "display_name": "G Philip", "link": "https://stackoverflow.com/users/4108393/g-philip"}, "edited": false, "score": 1, "creation_date": 1430263807, "post_id": 29931647, "comment_id": 47985722, "body": "What do you mean by &quot;<code>Num a</code> is no shorter than <code>ICycle a</code> and hence the compiler can not finish type checking&quot;? <i>Shorter</i> in what sense?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1430264592, "post_id": 29931647, "comment_id": 47985968, "body": "The fact that the last instance may cause constraint checking to be undecidable is not a real issue. But the last instance is overlapping with the previous ones -- and this <i>is</i> an issue. Consider what should happen if one adds <code>instance Num Bool</code> or <code>instance Num [a]</code>: the code would be ambiguous."}, {"owner": {"reputation": 31, "user_id": 4844075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31e09c991b93320c076d3a7706eeb646?s=128&d=identicon&r=PG", "display_name": "Sergey", "link": "https://stackoverflow.com/users/4844075/sergey"}, "edited": false, "score": 0, "creation_date": 1430264715, "post_id": 29931647, "comment_id": 47986013, "body": "I mean, shorter as a term tree. This has been discussed here: <a href=\"http://stackoverflow.com/questions/7198907/haskell-constraint-is-no-smaller-than-the-instance-head\" title=\"haskell constraint is no smaller than the instance head\">stackoverflow.com/questions/7198907/&hellip;</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1430269282, "post_id": 29931647, "comment_id": 47987398, "body": "There is a simple solution: use DefaultSignatures to write a default implementation of <code>cycle n = n + 1</code> and then add instances for all of the <code>Num</code> types."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 4844075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31e09c991b93320c076d3a7706eeb646?s=128&d=identicon&r=PG", "display_name": "Sergey", "link": "https://stackoverflow.com/users/4844075/sergey"}, "edited": false, "score": 0, "creation_date": 1430335644, "post_id": 29932835, "comment_id": 48026390, "body": "So, the message is: if you need something specific, you first need to go and implement something generic (even if you do not believe in it). And it is especially welcome to rationalize the fact that the byproducts of this work are to be useful. That seems to be one of those philosophical points behind Haskell I am not very good at."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 3, "last_activity_date": 1430270966, "creation_date": 1430270966, "answer_id": 29932835, "question_id": 29931647, "link": "https://stackoverflow.com/questions/29931647/declaring-a-subclass-in-haskell/29932835#29932835", "title": "Declaring a &quot;subclass&quot; in Haskell", "body": "<p>For this particular example, I think you're best off using a <code>newtype</code> to wrap the instance:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\nimport Prelude hiding (cycle)\n\nclass ICycle a where\n    cycle :: a -&gt; a\n\nnewtype Succ a = Succ { runSucc :: a }\n  deriving (Num, Eq, Ord, Bounded, Enum, Show, Read)\n\nnewtype Pred a = Pred { runPred :: a }\n  deriving (Num, Eq, Ord, Bounded, Enum, Show, Read)\n\ninstance Enum a =&gt; ICycle (Succ a) where\n    cycle = Succ . succ . runSucc\n\ninstance Enum a =&gt; ICycle (Pred a) where\n    cycle = Pred . pred . runPred\n\nmain = do\n    print $ cycle $ (42 :: Succ Int)\n    print $ cycle $ (42 :: Pred Int)\n</code></pre>\n\n<p>There are multiple ways one could cycle through numbers - by succ, by pred, by doubling, by halving. The advantage of using a <code>newtype</code> for the instance\n(making the RHS \"bigger\", as you noted in your question) is that it lets us have ALL of them.</p>\n\n<p>The standard library does the same trick with <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Monoid.html#v:Product\" rel=\"nofollow\"><code>Product</code></a>\nand <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Monoid.html#v:Sum\" rel=\"nofollow\"><code>Sum</code></a> for <code>Monoid</code>.</p>\n\n<p>Looking at it another way, if it were possible to define a new superclass for <code>Num</code>, adding a default implementation for all instances of\n<code>Num</code>, then you'd be taking that choice away from all those implementations. In possibly a way that doesn't make sense.</p>\n"}, {"comments": [{"owner": {"reputation": 708, "user_id": 4553930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/308c878dca0a01a80bc9b5b9b19c7ab6?s=128&d=identicon&r=PG&f=1", "display_name": "Abhay", "link": "https://stackoverflow.com/users/4553930/abhay"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430283954, "post_id": 29933347, "comment_id": 47991565, "body": "@CarstenK&#246;nig Did you delete your comments? Without those, mine look like I am talking to a wall! :)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430284070, "post_id": 29933347, "comment_id": 47991598, "body": "yeah I did - they made no sense (sorry again) - I was under the impression that the OP was using <code>FlexibleInstance</code> and some other extensions but never mentioned it really - so shame on me"}, {"owner": {"reputation": 708, "user_id": 4553930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/308c878dca0a01a80bc9b5b9b19c7ab6?s=128&d=identicon&r=PG&f=1", "display_name": "Abhay", "link": "https://stackoverflow.com/users/4553930/abhay"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430284170, "post_id": 29933347, "comment_id": 47991624, "body": "No! They made perfect sense, and I had to look up the manual once more to see what all can come under type constructor, just to be sure. Thanks for making me look at the manual!"}], "tags": [], "owner": {"reputation": 708, "user_id": 4553930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/308c878dca0a01a80bc9b5b9b19c7ab6?s=128&d=identicon&r=PG&f=1", "display_name": "Abhay", "link": "https://stackoverflow.com/users/4553930/abhay"}, "is_accepted": false, "score": 2, "last_activity_date": 1430274965, "creation_date": 1430274965, "answer_id": 29933347, "question_id": 29931647, "link": "https://stackoverflow.com/questions/29931647/declaring-a-subclass-in-haskell/29933347#29933347", "title": "Declaring a &quot;subclass&quot; in Haskell", "body": "<p>According to the Haskell report 2010, chapter 4, <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-750004.3\" rel=\"nofollow\">Declarations and Bindings</a>, the thing that is to be defined as an instance needs to be a type constructor. Thus,</p>\n\n<pre><code>instance Num a =&gt; ICycle a where\n    ...\n</code></pre>\n\n<p>is invalid, because <code>a</code> is a type variable, not a type constructor.</p>\n\n<p>Therefore the valid way to do it is, unfortunately, type by type. One has to say:</p>\n\n<pre><code>instance ICycle Int where\n    ...\n\ninstance ICycle Double where\n    ...\n</code></pre>\n\n<p>and so on.</p>\n"}], "owner": {"reputation": 31, "user_id": 4844075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31e09c991b93320c076d3a7706eeb646?s=128&d=identicon&r=PG", "display_name": "Sergey", "link": "https://stackoverflow.com/users/4844075/sergey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1590, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1430274965, "creation_date": 1430263383, "question_id": 29931647, "link": "https://stackoverflow.com/questions/29931647/declaring-a-subclass-in-haskell", "title": "Declaring a &quot;subclass&quot; in Haskell", "body": "<p>I have troubles with the following simple code in Haskell:</p>\n\n<pre><code>import Prelude hiding (cycle).\n\nclass ICycle a where\n    cycle :: a -&gt; a\n\ninstance ICycle [a] where\n    cycle [] = []\n    cycle (x:xs) = xs ++ [x]\n\ninstance ICycle Bool where\n    cycle True = False\n    cycle False = True\n\ninstance Num a =&gt; ICycle a where\n    cycle n = n+1\n\nmain = do\n    print $ cycle $ [1,2,3]\n    print $ cycle $ True\n    print $ cycle $ 42\n</code></pre>\n\n<p>Here the first two instance declarations work as expected, but the third one triggers various sorts of errors depending on flag combinations. </p>\n\n<p>I know that <code>Num a</code> is no shorter than <code>ICycle a</code> and hence the compiler can not finish type checking. In the examples, I have seen this is circumvented by either making the right-hand side a bigger term or by declaring a class of interest a subclass of other classes in the first place. Here, to the contrary, I essentially want to declare an existing class to be a subclass of a new one.</p>\n\n<p>I wonder if there are objections against this kind of use of type classes.  Or else, if there is a natural solution.</p>\n"}, {"tags": ["postgresql", "haskell"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "edited": false, "score": 0, "creation_date": 1430259913, "post_id": 29930931, "comment_id": 47984379, "body": "Regarding your two suggestions, I tried to use that solution as well, but GHC complains: <code>Illegal instance declaration for \u2018FromRow (UserRep (CredentialsRep u p) (NameRep f l))\u2019 (All instance types must be of the form (T a1 ... an) where a1 ... an are *distinct type variables*, ....</code>. The reason I am using such polymorphic types is so I can represent user validation by swapping out <code>String</code>s that represent the actual values with <code>Maybe String</code>s that represent a potential error (for example a weak password)."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430260020, "post_id": 29930931, "comment_id": 47984425, "body": "@broma0 I believe you can get that error to go away with the <code>FlexibleInstances</code> extension, which is entirely non-controversial and very common in practice.  Just put <code>{-# LANGUAGE FlexibleInstances #-}</code> at the top of your source file."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "edited": false, "score": 0, "creation_date": 1430260631, "post_id": 29930931, "comment_id": 47984639, "body": "You got it. I edited your answer to mention <code>FlexibleInstances</code>. Thank you!"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 4, "last_activity_date": 1430316539, "last_edit_date": 1430316539, "creation_date": 1430259452, "answer_id": 29930931, "question_id": 29930717, "link": "https://stackoverflow.com/questions/29930717/fromrow-instance-for-nested-type-with-postgresql-simple/29930931#29930931", "title": "FromRow instance for nested type with postgresql-simple", "body": "<p>(Disclaimer: I haven't used this library at all)</p>\n\n<p>You're trying to define <code>FromRow</code> for all <code>UserRep a b</code>, but in the definition of <code>fromRow</code> you're explicitly constructing a <code>UserRep (CredentialsRep u p) (NameRep f l)</code>, hence the error saying it can't match <code>a</code> with <code>CredentialsRep u p</code> and <code>b</code> with <code>NameRep f l</code> (modulo type variable names).  Instead, I believe you can do something like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance (FromField u, FromField p, FromField f, FromField l) =&gt; FromRow (UserRep (CredentialsRep u p) (NameRep f l)) where\n    fromRow = do\n        username  &lt;- field\n        password  &lt;- field\n        firstname &lt;- field\n        lastname  &lt;- field\n        return $ User (Credentials username password) (Name firstname lastname)\n</code></pre>\n\n<p>Or just</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance FromRow (UserRep (CredentialsRep String String) (NameRep String String)) where\n    ...\n</code></pre>\n\n<p>with the same <code>fromRow</code> definition. With this approach you may have to enable the <code>FlexibleInstances</code> extension.</p>\n\n<p>In addition, it looks like you may be making your types too polymorphic (but your situation might be unique, take this advice with a grain of salt), you could just get rid of the type parameters altogether and have</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data CredentialsRep = Credentials\n    { username :: String\n    , password :: String\n    } deriving (Show)\n\ndata NameRep = Name\n    { first :: String\n    , last :: String\n    } deriving (Show)\n\ndata UserRep = User\n    { credentials :: CredentialsRep\n    , name :: NameRep\n    } deriving (Show)\n</code></pre>\n\n<p>In which case you would just need</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance FromRow UserRep where\n    ...\n</code></pre>\n\n<p>with the same <code>fromRow</code> definition.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 357, "favorite_count": 1, "accepted_answer_id": 29930931, "answer_count": 1, "score": 2, "last_activity_date": 1430316539, "creation_date": 1430258414, "last_edit_date": 1430316513, "question_id": 29930717, "link": "https://stackoverflow.com/questions/29930717/fromrow-instance-for-nested-type-with-postgresql-simple", "title": "FromRow instance for nested type with postgresql-simple", "body": "<p>I am using the following types to represent a user:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data CredentialsRep uType pType = Credentials { username :: uType\n                                              , password :: pType } deriving (Show)\n\ndata NameRep fType lType = Name { first :: fType\n                                , last  :: lType } deriving (Show)\n\ndata UserRep cType nType = User { credentials :: cType\n                                , name        :: nType} deriving (Show)\n</code></pre>\n\n<p>How can I write the <code>FromRow</code> instance for <code>UserRep</code> so that <code>postgresql-simple</code> can turn my queries into useful types? So far, I have this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance FromRow (UserRep a b) where\n  fromRow = do\n    username &lt;- field\n    password &lt;- field\n    fname &lt;- field\n    lname &lt;- field\n    return $ (User (Credentials username password) (Name fname lname))\n</code></pre>\n\n<p>Which results in this error:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>src/PSQLTEST.hs:30:5:\n    Couldn't match type \u2018a\u2019 with \u2018CredentialsRep uType0 pType0\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the instance declaration at src/PSQLTEST.hs:24:10\n    Expected type: RowParser (UserRep a b)\n      Actual type: RowParser\n                     (UserRep (CredentialsRep uType0 pType0) (NameRep fType0 lType0))\n    Relevant bindings include\n      password :: pType0 (bound at src/PSQLTEST.hs:27:5)\n      username :: uType0 (bound at src/PSQLTEST.hs:26:5)\n      fromRow :: RowParser (UserRep a b) (bound at src/PSQLTEST.hs:25:3)\n    In a stmt of a 'do' block:\n      return $ (User (Credentials username password) (Name fname lname))\n    In the expression:\n      do { username &lt;- field;\n           password &lt;- field;\n           fname &lt;- field;\n           lname &lt;- field;\n           .... }\n    In an equation for \u2018fromRow\u2019:\n        fromRow\n          = do { username &lt;- field;\n                 password &lt;- field;\n                 fname &lt;- field;\n                 .... }\n\nsrc/PSQLTEST.hs:30:5:\n    Couldn't match type \u2018b\u2019 with \u2018NameRep fType0 lType0\u2019\n      \u2018b\u2019 is a rigid type variable bound by\n          the instance declaration at src/PSQLTEST.hs:24:10\n    Expected type: RowParser (UserRep a b)\n      Actual type: RowParser\n                     (UserRep (CredentialsRep uType0 pType0) (NameRep fType0 lType0))\n    Relevant bindings include\n      lname :: lType0 (bound at src/PSQLTEST.hs:29:5)\n      fname :: fType0 (bound at src/PSQLTEST.hs:28:5)\n      fromRow :: RowParser (UserRep a b) (bound at src/PSQLTEST.hs:25:3)\n    In a stmt of a 'do' block:\n      return $ (User (Credentials username password) (Name fname lname))\n    In the expression:\n      do { username &lt;- field;\n           password &lt;- field;\n           fname &lt;- field;\n           lname &lt;- field;\n           .... }\n    In an equation for \u2018fromRow\u2019:\n        fromRow\n          = do { username &lt;- field;\n                 password &lt;- field;\n                 fname &lt;- field;\n                 .... }\n</code></pre>\n"}, {"tags": ["haskell", "typeclass", "newtype"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1430258689, "post_id": 29929600, "comment_id": 47983825, "body": "Minor style comment: the code <code>if e then True else False</code> is equivalent to simply <code>e</code>."}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 1, "creation_date": 1430284683, "post_id": 29929600, "comment_id": 47991815, "body": "BTW <code>chop</code> has quadratic complexity, it can be done in linear time <i>O(n)</i>."}], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 4830380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cbc9e7697000acd5eb3a067616f72b6?s=128&d=identicon&r=PG&f=1", "display_name": "dman", "link": "https://stackoverflow.com/users/4830380/dman"}, "edited": false, "score": 0, "creation_date": 1430255555, "post_id": 29929755, "comment_id": 47982204, "body": "TOTALLY WORKS. One minor change had to be made though (&quot;P&quot; instead of &quot;Poly&quot;)   m == n = let P m&#39; = chop m; P n&#39; = chop n in m&#39; == n&#39;"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1430258035, "last_edit_date": 1430258035, "creation_date": 1430254532, "answer_id": 29929755, "question_id": 29929600, "link": "https://stackoverflow.com/questions/29929600/how-to-add-equality-comparisons-to-a-newtype-in-haskell/29929755#29929755", "title": "How to add equality comparisons (==) to a newtype in Haskell", "body": "<p>The problem is that you have defined <code>(==)</code> to be recursive on itself. Simplifying your definition a little, you have:</p>\n\n<pre><code>m == n = chop m == chop n\n</code></pre>\n\n<p>This evaluates like so:</p>\n\n<pre><code>m == n\n-&gt; { definition of (==) }\nchop m == chop n\n-&gt; { definition of (==) }\nchop (chop m) == chop (chop n)\n-&gt; { definition of (==) }\nchop (chop (chop m)) == chop (chop (chop n))\n-&gt; { ... }\n</code></pre>\n\n<p>Instead of dispatching your equality test back to the equality test for polynomials, you should dispatch to the equality for lists. For example, one might write</p>\n\n<pre><code>m == n = let P m' = chop m; P n' = chop n in m' == n'\n</code></pre>\n\n<p>instead.</p>\n"}], "owner": {"reputation": 77, "user_id": 4830380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cbc9e7697000acd5eb3a067616f72b6?s=128&d=identicon&r=PG&f=1", "display_name": "dman", "link": "https://stackoverflow.com/users/4830380/dman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 29929755, "answer_count": 1, "score": 2, "last_activity_date": 1430262969, "creation_date": 1430254039, "last_edit_date": 1430262969, "question_id": 29929600, "link": "https://stackoverflow.com/questions/29929600/how-to-add-equality-comparisons-to-a-newtype-in-haskell", "title": "How to add equality comparisons (==) to a newtype in Haskell", "body": "<p>I'm trying to define a newtype called \"Poly\" in Haskell, where the type is a list of a \"Num\"s that represents a polynomial expression. [1,2,3] corresponds to 3x^2 + 2x + 1, so therefore [4,5,6,0,0...0] is the same polynomial as [4,5,6].</p>\n\n<p>I've created a helper function called \"chop\" to remove 0's from the end of the list, but I'm having trouble comparing two lists. Any ideas why my use of \"instance\" does not work here? </p>\n\n<p>It compiles, but when you try to compare 2 instances of Poly, WinGHCi hangs. </p>\n\n<pre><code>newtype Poly a = P [a]\nx :: Num a =&gt; Poly a\n\nchop :: (Eq a, Num a) =&gt; Poly a -&gt; Poly a\nchop (P l) = if (last l) == 0 then chop (P $ init l) else P l\n\ninstance (Num a, Eq a) =&gt; Eq (Poly a) where\n    (==) m n = if (chop m) == (chop n) then True else False\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 1063, "user_id": 2443833, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lL91m.jpg?s=128&g=1", "display_name": "Langston", "link": "https://stackoverflow.com/users/2443833/langston"}, "edited": false, "score": 0, "creation_date": 1543613974, "post_id": 29927594, "comment_id": 93996381, "body": "<code>cabal add-source</code> produces <code>cabal: unrecognised command: add-source (try --help)</code> on version <code>compiled using version 2.2.0.1 of the Cabal library</code>"}], "tags": [], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "is_accepted": false, "score": 3, "last_activity_date": 1430247178, "creation_date": 1430247178, "answer_id": 29927594, "question_id": 29927529, "link": "https://stackoverflow.com/questions/29927529/how-to-reference-local-cabal-library-from-a-local-cabal-executable-project/29927594#29927594", "title": "How to reference local Cabal library from a local Cabal executable project?", "body": "<p>You refer to the library simply as <code>my-cabal-library</code> in your Cabal file. You add it to your sandbox with <code>cabal add-source ../my-cabal-library</code> which will make Cabal aware of where it can get the dependency you created.</p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1430247178, "creation_date": 1430246968, "question_id": 29927529, "link": "https://stackoverflow.com/questions/29927529/how-to-reference-local-cabal-library-from-a-local-cabal-executable-project", "title": "How to reference local Cabal library from a local Cabal executable project?", "body": "<p>I have the following folder structure:</p>\n\n<pre><code>~/scm/my-cabal-library\n~/scm/my-cabal-executable\n</code></pre>\n\n<p>Each folder contains a Cabal sandbox and Cabal project. The first is a library and the second is an executable. I'd like for the executable to use the modules from <code>my-cabal-library</code>.</p>\n\n<p>The <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html\" rel=\"nofollow\">Cabal documentation</a> doesn't discuss how to do this. </p>\n\n<p>How do I tell Cabal about the library so that it can import the modules in my executable project?</p>\n"}, {"tags": ["haskell", "floating-point", "formatting", "floating-point-precision", "scientific-notation"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1430254741, "post_id": 29925928, "comment_id": 47981717, "body": "This does not seem to conform to the specification, &quot;whose exponent is a multiple of 3&quot;. Specifically, <code>expt 0 10</code> gives <code>&quot;1e2&quot;</code>, and 2 is not a multiple of 3."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1430289631, "post_id": 29925928, "comment_id": 47993975, "body": "@DanielWagner that&#39;s odd; in the library, it says it&#39;s in enginerring notation. That might be a bug."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 0, "last_activity_date": 1430241622, "creation_date": 1430241622, "answer_id": 29925928, "question_id": 29924683, "link": "https://stackoverflow.com/questions/29924683/engineering-notation-with-haskell/29925928#29925928", "title": "Engineering notation with Haskell", "body": "<p>In <a href=\"https://hackage.haskell.org/package/text-format-0.3.0.7/docs/Data-Text-Format.html\" rel=\"nofollow\"><code>Data.Text.Format</code></a> there's an <code>expt</code> function that will help format numbers in that way, though it's in a hugely obfuscated library, I'm afraid, and you'll have to convert from <code>Text</code> to <code>String</code>.</p>\n\n<p>It seems that this is the only one available, but you could always make one yourself.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1430255061, "creation_date": 1430255061, "answer_id": 29929898, "question_id": 29924683, "link": "https://stackoverflow.com/questions/29924683/engineering-notation-with-haskell/29929898#29929898", "title": "Engineering notation with Haskell", "body": "<p>I don't know of a standard function. Adding something to <code>printf</code> would be one way to go, but it would be a bit annoying to use (since you would need to add a new type for engineering-notation-formatted numbers, and convert numbers to this type before handing them off). Simply writing a standalone function with a type like</p>\n\n<pre><code>showEngineer :: Double -&gt; String\n</code></pre>\n\n<p>may be a simpler and more readable solution in the long-term.</p>\n"}, {"tags": [], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "is_accepted": true, "score": 2, "last_activity_date": 1431156537, "creation_date": 1431156537, "answer_id": 30137281, "question_id": 29924683, "link": "https://stackoverflow.com/questions/29924683/engineering-notation-with-haskell/30137281#30137281", "title": "Engineering notation with Haskell", "body": "<p>After some research, I manage to get what I want.\nThe function to get the engineering format work in a few steps : </p>\n\n<p><strong>1. Dissociate the exponent from the mantissa</strong></p>\n\n<p>It's necessary to get the exponent apart of the mantissa.\nThe function <code>decodeFloat</code> (provided by <code>base</code>) decode a floating point number and return both the mantissa and the exponent <strong>in power of 2</strong> (mant2 * 2 ^ ex2).</p>\n\n<p><strong>2. Get the mantissa and exponent expressed in the correct base</strong></p>\n\n<p>A conversion in <strong>power of 10</strong> is required. This is the role of this function.</p>\n\n<pre><code>decompose :: Double -&gt; (Double,Int)\ndecompose val = if mant2 &gt; 0 \n                     then (mant10,ex10)\n                     else (-mant10,ex10)\n  where\n        (mant2,ex2) = decodeFloat val\n        res = logBase 10 (fromIntegral (abs mant2)::Double) + logBase 10 (2 ** (fromIntegral ex2::Double)) \n        ex10 = floor res\n        mant10 = 10**(res - (fromIntegral ex10::Double))\n</code></pre>\n\n<p><strong>3. Set the exponent at a multiple of 3</strong></p>\n\n<p>The function <code>ingen</code> test the result of the integer division of the exponent and perform the adjustement on mantissa and exponent.</p>\n\n<pre><code>ingen :: Double -&gt; (Double,Int)\ningen val \n  | mod ex 3 == 0 = (mant,ex)\n  | mod ex 3 == 1 = (mant*10,ex-1)\n  | mod ex 3 == 2 = (mant*100,ex-2)\n  where\n        (mant,ex) = decompose val\n</code></pre>\n\n<p>Here are some conversions : </p>\n\n<pre><code>Prelude&gt; ingen 10e7\n(99.99999999999979,6)\nPrelude&gt; ingen 10e-41\n(100.0,-42)\nPrelude&gt; ingen (-72364e81)\n(-72.36399999999853,84)\n</code></pre>\n\n<hr>\n\n<p>I performed some tests with quickCheck on a wide range and a large amount of value. The conversion <strong>seems</strong> to work well despite a <strong>very small</strong> difference of value (rounding during the calculations due to the precision?).</p>\n\n<p>However, another verifications should be made.</p>\n\n<p>If you find a mistake or an improvement in these functions, please share.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 522, "favorite_count": 4, "accepted_answer_id": 30137281, "answer_count": 3, "score": 7, "last_activity_date": 1431157527, "creation_date": 1430237844, "last_edit_date": 1431157527, "question_id": 29924683, "link": "https://stackoverflow.com/questions/29924683/engineering-notation-with-haskell", "title": "Engineering notation with Haskell", "body": "<p>Is there a existing Haskell function which provide an <strong>engineering notation</strong> formatting (as String)?</p>\n\n<p>If not, I read that <code>printf</code> can be extended by adding an instance to <code>PrintfArg</code>. Do you believe this is a good solution ?</p>\n\n<hr>\n\n<p><em>By engineering notation, I mean an exponent notation whose exponent is a <strong>multiple of 3</strong>.</em></p>\n"}, {"tags": ["haskell", "lenses"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430238211, "post_id": 29924256, "comment_id": 47971155, "body": "Can&#39;t you just use <code>mapM_ (`add2Map` cs) ids</code>?  Seems like the easiest way to me."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1430238471, "post_id": 29924256, "comment_id": 47971354, "body": "Did you mean <code>traverseSome :: [Int] -&gt; Int -&gt; Traversal&#39; DB CharSet</code>?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1430238644, "post_id": 29924256, "comment_id": 47971479, "body": "Also, what does <code>Int</code> do in the type of <code>traverseSome</code>?"}, {"owner": {"reputation": 55, "user_id": 1449236, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JBKFb.jpg?s=128&g=1", "display_name": "Andrew Condon", "link": "https://stackoverflow.com/users/1449236/andrew-condon"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430253061, "post_id": 29924256, "comment_id": 47980741, "body": "@bheklilr: i missed that possibility too but i was really looking to see how to do it with lenses."}, {"owner": {"reputation": 55, "user_id": 1449236, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JBKFb.jpg?s=128&g=1", "display_name": "Andrew Condon", "link": "https://stackoverflow.com/users/1449236/andrew-condon"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1430253095, "post_id": 29924256, "comment_id": 47980761, "body": "@Andr&#225;sKov&#225;cs - the code in comments was just a sketch of what i thought it might look like, including wrong sig (MapOfSets) and the idea that i might need to pass the index into the traversal somehow (Int)."}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 1449236, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JBKFb.jpg?s=128&g=1", "display_name": "Andrew Condon", "link": "https://stackoverflow.com/users/1449236/andrew-condon"}, "edited": false, "score": 0, "creation_date": 1430253253, "post_id": 29926511, "comment_id": 47980853, "body": "wonderfully comprehensive answer thanks so much! Lots to learn from this."}], "tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 1, "last_activity_date": 1430245681, "last_edit_date": 1430245681, "creation_date": 1430243466, "answer_id": 29926511, "question_id": 29924256, "link": "https://stackoverflow.com/questions/29924256/how-to-use-lenses-to-traverse-and-assign-to-some-but-not-all-elements-in-a-map/29926511#29926511", "title": "How to use Lenses to traverse and assign to some (but not all) elements in a Map", "body": "<p>I'm assuming you mean</p>\n\n<pre><code>traverseSome :: [Int] -&gt; Traversal' DB CharSet\n</code></pre>\n\n<p>Here's a more general version</p>\n\n<pre><code>keys :: Ord k =&gt; [k] -&gt; IndexedTraversal' k (Map.Map k a) a\nkeys ks f m = go ks &lt;&amp;&gt; \\m' -&gt; foldr (uncurry M.insert) m m'\n  where\n    go []     = pure []\n    go (i:is) = case Map.lookup i m of\n                  Just a  -&gt; (:) . (,) i &lt;$&gt; indexed f i a &lt;*&gt; go is\n                  Nothing -&gt; go is\n</code></pre>\n\n<p>which is very similar to <code>ordinals</code> from <code>Data.Vector.Lens</code> (my version doesn't nub duplicates, so make sure the list doesn't have duplicates). <code>go</code> goes through the list of indices and looks them up in the map, adding the index as it goes. The <code>foldr</code> bit goes through the list of edited elements and <code>inserts</code> them back into the original map.</p>\n\n<p>You can write your's as</p>\n\n<pre><code>traverseSome :: [Int] -&gt; IndexedTraversal' Int DB CharSet\ntraverseSome is = mos . keys is\n\nadd2MapsSome :: [Int] -&gt; CharSet -&gt; State DB ()\nadd2MapsSome is cs = traverseSome is %= Set.union cs\n</code></pre>\n\n<hr>\n\n<p>If you did want</p>\n\n<pre><code>traverseSome :: [Int] -&gt; Lens' DB MapOfSets\n</code></pre>\n\n<p>this can be written as (note you shouldn't add new keys to the <code>Map</code> or you'll break the lens laws)</p>\n\n<pre><code>submap :: Ord k =&gt; [k] -&gt; Lens' (Map.Map k a) (Map.Map k a)\nsubmap ks f m = f (Map.fromList as) &lt;&amp;&gt; (&lt;&gt; m)\n  where as = Maybe.mapMaybe (\\i -&gt; (,) i &lt;$&gt; Map.lookup i m) ks\n</code></pre>\n\n<p>which could be used to write <code>keys</code> (but would be less efficient because you make an intermediate <code>Map</code>):</p>\n\n<pre><code>keys :: Ord k =&gt; [k] -&gt; IndexedTraversal' k (Map k a) a\nkeys ks = submap ks . itraversed\n</code></pre>\n\n<hr>\n\n<p>edit: version without intermediate lists:</p>\n\n<pre><code>keys :: Ord k =&gt; [k] -&gt; IndexedTraversal' k (Map.Map k a) a\nkeys ks f m = go ks\n  where\n    go []     = pure m\n    go (i:is) =\n      case Map.lookup i m of\n        Just a  -&gt; Map.insert i &lt;$&gt; indexed f i a &lt;*&gt; go is\n        Nothing -&gt; go is\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 0, "creation_date": 1430247485, "post_id": 29927333, "comment_id": 47977180, "body": "Ah yes, I meant to mention this. Note that you need traverse the whole map in this solution (whereas mine only picks out the chosen elements)."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 1, "last_activity_date": 1430246656, "last_edit_date": 1430246656, "creation_date": 1430246303, "answer_id": 29927333, "question_id": 29924256, "link": "https://stackoverflow.com/questions/29924256/how-to-use-lenses-to-traverse-and-assign-to-some-but-not-all-elements-in-a-map/29927333#29927333", "title": "How to use Lenses to traverse and assign to some (but not all) elements in a Map", "body": "<p>Map is an <a href=\"http://traverseSome%20::%20[Int]%20-%3E%20Traversal&#39;%20DB%20CharSet%20traverseSome%20ids%20=%20mos%20.%20itraversed%20.%20indices%20(%60Set.member%60%20idSet)%20where%20%20%20idSet%20=%20Set.fromList%20ids\" rel=\"nofollow\">instance of <code>TraversableWithIndex</code></a>, so you can use <code>itraversed</code> to also traverse the keys. <a href=\"https://hackage.haskell.org/package/lens-4.9.1/docs/Control-Lens-Indexed.html#v:indices\" rel=\"nofollow\"><code>indices</code></a> can be used to narrow down the range of keys.</p>\n\n<pre><code>traverseSome :: [Int] -&gt; Traversal' DB CharSet\ntraverseSome ids = mos . itraversed . indices (`Set.member` idSet) where\n  idSet = Set.fromList ids\n</code></pre>\n\n<p>Note that <code>itraversed</code> is different from <code>traversed</code> here. <code>traversed</code> is always indexed by the ordinal positions of the elements, while <code>itraversed</code> may be indexed by a variety of key types depending on the data structure.</p>\n"}], "owner": {"reputation": 55, "user_id": 1449236, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JBKFb.jpg?s=128&g=1", "display_name": "Andrew Condon", "link": "https://stackoverflow.com/users/1449236/andrew-condon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 889, "favorite_count": 0, "accepted_answer_id": 29926511, "answer_count": 2, "score": 2, "last_activity_date": 1430246656, "creation_date": 1430236685, "question_id": 29924256, "link": "https://stackoverflow.com/questions/29924256/how-to-use-lenses-to-traverse-and-assign-to-some-but-not-all-elements-in-a-map", "title": "How to use Lenses to traverse and assign to some (but not all) elements in a Map", "body": "<p>I've been trying to use lenses and containers together with some success but i have hit the limitations of my understanding trying to use filtering traversals of Data.Map - i can change individual instances in the map or traverse all instances but i can't work out how to act on some identifiable partition (ie keys in a range).</p>\n\n<p>Essentially i'm trying to do something similar with maps to what Gabriel Gonzalez excellent lenses tutorial does with lists [1]</p>\n\n<p>Here's a working skeleton of my code with the <code>traverseSome</code> function which i don't know how to write commented out. Any help gratefully received!</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE DeriveGeneric   #-}\n{-# LANGUAGE RankNTypes      #-}\n\nimport Control.Lens\nimport Control.Monad.State\nimport qualified Data.Map.Strict as Map\nimport qualified Data.Set as Set\n\ntype CharSet = Set.Set Char\ntype MapOfSets = Map.Map Int CharSet\n\ndata DB = DB { _mos  :: MapOfSets } deriving (Show, Eq)\n\nmakeLenses ''DB\n\ninitDB :: DB\ninitDB =  DB { _mos  = Map.fromList (zip [1..5] (repeat Set.empty)) }\n\nadd2Map :: Int -&gt; CharSet -&gt; State DB ()\nadd2Map i cs = mos.ix i %= (Set.union cs)\n\ntraverseAll :: Traversal' DB CharSet\ntraverseAll = mos.traversed\n\nadd2MapsAll :: CharSet -&gt; State DB ()\nadd2MapsAll cs = traverseAll %= (Set.union cs)\n\n--        &lt;problematic part&gt;          \n{-\ntraverseSome :: [Int] -&gt; Int -&gt; Traversal' DB MapOfSets\ntraverseSome ids i = _\n\nadd2MapsSome :: [Int] -&gt; CharSet -&gt; State DB ()\nadd2MapsSome ids cs = mos.(traverseSome ids 2) %= (Set.union cs)\n-}         \n--        &lt;/problematic part&gt;\n\nmain :: IO ()\nmain = do\n  let db = initDB\n  let bar = Set.fromList ['a'..'g'] :: CharSet\n  let baz = Set.fromList ['f'..'m'] :: CharSet\n  let quux = Set.fromList ['n'..'z'] :: CharSet\n\n  let db2 = execState (add2Map 5 bar) db\n  let db3 = execState (add2MapsAll baz) db\n  -- let db4 = execState (add2MapsSome [1,3] quux) db\n\n  print db2\n  print db3\n  -- print db4\n</code></pre>\n\n<p>[1] <a href=\"http://www.haskellforall.com/2013/05/program-imperatively-using-haskell.html\" rel=\"nofollow\">http://www.haskellforall.com/2013/05/program-imperatively-using-haskell.html</a></p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1430236581, "post_id": 29924108, "comment_id": 47969983, "body": "The pattern looks fine to me. If the pattern isn&#39;t being accepted, is the data being accepted?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 3, "creation_date": 1430236592, "post_id": 29924108, "comment_id": 47969989, "body": "Are you sure you need the tuple syntax? That is, does writing <code>myfunc (LNode (TypedL c d)) = c</code> rather than <code>myfunc (LNode (TypedL(c, d))) = c</code> type check?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 3, "creation_date": 1430236648, "post_id": 29924108, "comment_id": 47970023, "body": "What is the definition of <code>LNode</code> and <code>TypedL</code>?  Without those we can&#39;t really tell you why the pattern match fails."}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 4, "last_activity_date": 1430237496, "creation_date": 1430237496, "answer_id": 29924561, "question_id": 29924108, "link": "https://stackoverflow.com/questions/29924108/how-can-i-match-this-pattern-in-haskell/29924561#29924561", "title": "How can I match this pattern in haskell", "body": "<p>The problem is the way you're calling your function. In Haskell, functions and constructors are called like this:</p>\n\n<pre><code>function arg1 arg2 arg3\n</code></pre>\n\n<p>So, when it says it wants two arguments, it means this:</p>\n\n<pre><code>myfunc (LNode (TypedL c d)) = c\n--                    ~~~ \n</code></pre>\n\n<p>Tuples (<code>(a, b, c)</code>) are separate datatypes. They can be used as function arguments if defined, but that's generally seen as unidiomatic Haskell.</p>\n"}], "owner": {"reputation": 2550, "user_id": 1366643, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/QFRXO.jpg?s=128&g=1", "display_name": "Herokiller", "link": "https://stackoverflow.com/users/1366643/herokiller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 29924561, "answer_count": 1, "score": 0, "last_activity_date": 1430238298, "creation_date": 1430236349, "last_edit_date": 1430238298, "question_id": 29924108, "link": "https://stackoverflow.com/questions/29924108/how-can-i-match-this-pattern-in-haskell", "title": "How can I match this pattern in haskell", "body": "<p>I've got data</p>\n\n<pre><code>LNode(TypedL(2.72489e12,\"http://www.w3.org/2001/XMLSchema#double\"))\n</code></pre>\n\n<p>I want an anonymous function to match from this to 2.72489e12</p>\n\n<pre><code>myfunc (LNode(TypedL(c, d))) = c\n</code></pre>\n\n<p>gives </p>\n\n<pre><code>Constructor `TypedL' should have 2 arguments, but has been given 1.\n</code></pre>\n\n<p>Is my syntax with this function wrong?</p>\n"}, {"tags": ["excel", "haskell", "vba"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1430235264, "post_id": 29923623, "comment_id": 47968983, "body": "I&#39;ve tried this before and have hit road blocks due to VBA&#39;s antiquated type system.  There aren&#39;t really function pointers in the language at all, so good luck. (Also, yes, there are a few of us who are competent in Haskell and VBA =P)"}, {"owner": {"reputation": 3845, "user_id": 4288101, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O0Xld.jpg?s=128&g=1", "display_name": "Byron Wall", "link": "https://stackoverflow.com/users/4288101/byron-wall"}, "edited": false, "score": 1, "creation_date": 1430236927, "post_id": 29923623, "comment_id": 47970248, "body": "Excel offers the <code>Table</code> which can provide a calculation that is based on values in the current row.  Those formulas will automatically extend when rows are added (or removed).  In VBA, this can be done by hooking into the WorksheetChange event and adding new formulas if changes to a given range are noticed.  It might be possible to create a class module with these events built in to allow for reuse of the code within a workbook."}, {"owner": {"reputation": 2666, "user_id": 914053, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f04559cae8e356d725fd1b381d8193d9?s=128&d=identicon&r=PG", "display_name": "Bastl", "link": "https://stackoverflow.com/users/914053/bastl"}, "reply_to_user": {"reputation": 3845, "user_id": 4288101, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O0Xld.jpg?s=128&g=1", "display_name": "Byron Wall", "link": "https://stackoverflow.com/users/4288101/byron-wall"}, "edited": false, "score": 0, "creation_date": 1430237677, "post_id": 29923623, "comment_id": 47970786, "body": "@Byron Wall:  interesting, but events and WorksheetCHange does not sound very &quot;functional&quot;? Or do I miss the point? can you give an example?"}, {"owner": {"reputation": 3845, "user_id": 4288101, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O0Xld.jpg?s=128&g=1", "display_name": "Byron Wall", "link": "https://stackoverflow.com/users/4288101/byron-wall"}, "edited": false, "score": 0, "creation_date": 1430237956, "post_id": 29923623, "comment_id": 47970972, "body": "You might be able to hide some of the event code in a class module which could then be instantiated as needed.  You are likely going to be disappointed with your options implementing this though."}, {"owner": {"reputation": 2666, "user_id": 914053, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f04559cae8e356d725fd1b381d8193d9?s=128&d=identicon&r=PG", "display_name": "Bastl", "link": "https://stackoverflow.com/users/914053/bastl"}, "edited": false, "score": 0, "creation_date": 1430297322, "post_id": 29923623, "comment_id": 47998518, "body": "Regarding the first &quot;PS&quot; it seems array formula (multi-cell) is the answer. When I add it to the complete target column with &quot;Ctrl-SHift-Enter&quot;, Excel auto-reevaluates the formula when the definition column changes. But: It seems to be very inefficient / imperformant !?"}, {"owner": {"reputation": 1991, "user_id": 447485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e4e2946c3270f4a20e60ec3d3c8f552?s=128&d=identicon&r=PG", "display_name": "airstrike", "link": "https://stackoverflow.com/users/447485/airstrike"}, "edited": false, "score": 0, "creation_date": 1585426859, "post_id": 29923623, "comment_id": 107756741, "body": "Apparently there are hacky ways to get around the lack or first-class function pointers. See <a href=\"http://unlimitedexcel.blogspot.com/2011/12/pointers-in-vba-huhh-delegates-in-vba.html\" rel=\"nofollow noreferrer\">unlimitedexcel.blogspot.com/2011/12/&hellip;</a>"}], "owner": {"reputation": 2666, "user_id": 914053, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f04559cae8e356d725fd1b381d8193d9?s=128&d=identicon&r=PG", "display_name": "Bastl", "link": "https://stackoverflow.com/users/914053/bastl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 921, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1430235011, "creation_date": 1430235011, "last_edit_date": 1531164843, "question_id": 29923623, "link": "https://stackoverflow.com/questions/29923623/how-to-implement-higher-order-function-map-in-vba", "title": "How to implement higher-order function &quot;map&quot; in VBA", "body": "<p>In <a href=\"https://stackoverflow.com/questions/28363180/clean-code-in-excel\">Clean Code in Excel?</a> I looked for a cleaner way to implement complex user defined functions (UDF) in Excel/VBA.</p>\n\n<p>So, assume I have implemented a function <code>f: A -&gt; B</code> as a UDF in Excel. Lets further assume I have 10 A-values in cells A1:A10 and <code>\"=f(A1)\"</code> in cell B1, autocompleted down to cell B10.</p>\n\n<p>Now, when a new A-value arrives, then I have to do two things: </p>\n\n<ol>\n<li>add the value to new cell A11 and </li>\n<li><strong>extend the autocompletion in column B by a call to A11</strong>.</li>\n</ol>\n\n<p>Because I have many functions in my workbook that refer back to A-values, I would like to automate the second step.</p>\n\n<p>In my functional/Haskell thinking I would have a list of <code>as</code> and would represent the list of bs as</p>\n\n<pre><code>bs = map f as\n</code></pre>\n\n<p>so when ever I have a changed set of <code>as</code>, <code>bs</code> would be updated whenever it's reevaluated.</p>\n\n<p>I am quite sure this can be implemented cleanly in standard Excel/VBA with named ranges. I imagine the following:</p>\n\n<ul>\n<li>have a named range NamedAs:=\"A1:A10\"    </li>\n<li>in cell B1 only one call to the VBA version of <code>map f NamedAs</code>   </li>\n<li>this call automagically autocompletes down foreach element of \"NamedAs\"</li>\n</ul>\n\n<p>Then, when I add a new A-value to the range \"NamedAs\" and reevaluate the worksheet, I would be all done. ( I would not need to change the call in column B, only force reevaluation )</p>\n\n<p><strong>How can the VBA version of \"map f NamedRange\" be implemented ??</strong></p>\n\n<p><em>PS: While writing, it seems to me that this question is more about the definition / usage of functions that return ranges - higher-orderness might be a secondary yet interesting topic ...</em></p>\n\n<p><em>PPS: I wonder if there are people that are verbose both in FP / Haskell and in VBA :-)</em></p>\n\n<p><em>PPPS: No, I cannot use FCell.</em></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 5, "creation_date": 1430234114, "post_id": 29923104, "comment_id": 47968038, "body": "Think of it as <code>{ let xx = 2 * x in result } where { result = replicate xx 3 }</code>.  The braces show you the scopes.  You could just do <code>let { xx = 2 * x; result = replicate xx 3 } in result</code>, it&#39;d be a lot easier to read anyway."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430234121, "post_id": 29923104, "comment_id": 47968043, "body": "there is a really good article on the <a href=\"https://wiki.haskell.org/Let_vs._Where\" rel=\"nofollow noreferrer\">haskellWiki</a> explaining that"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430243927, "post_id": 29923104, "comment_id": 47974975, "body": "@bheklilr you shoud make it an answer, as it is THE answer to the question (the title at laest)."}], "answers": [{"tags": [], "owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "is_accepted": false, "score": 1, "last_activity_date": 1430235699, "creation_date": 1430235699, "answer_id": 29923868, "question_id": 29923104, "link": "https://stackoverflow.com/questions/29923104/why-would-i-get-a-xx-not-in-scope-error-for-this-haskell-code/29923868#29923868", "title": "why would I get a &quot;xx not in scope error&quot; for this haskell code?", "body": "<pre><code>nthElement :: (Ord b)=&gt;(a-&gt;b)-&gt;Int-&gt;[a]-&gt;[a]\nnthElement _ _ []  = []\nnthElement _ _ [x] = [x]\nnthElement op k vals@(x:xs)\n    | k &gt; (length vals) = vals\n    | otherwise = let left    = [p | p&lt;-vals, (op p) &lt; (op x)]\n                      midd    = [p | p&lt;-vals, (op p) == (op x)]\n                      right   = [p | p&lt;-vals, (op p) &gt; (op x)]\n                      leftLen = length left\n                      middLen = length midd\n                      result | leftLen &gt;= k             = (nthElement op k left) ++ midd ++ right\n                             | (leftLen + middLen) &gt;= k = left ++ midd ++ right\n                             | otherwise                = left ++ midd ++ nthElement op (k-middLen-leftLen) right\n                   in result\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 3, "last_activity_date": 1430245853, "creation_date": 1430245853, "answer_id": 29927207, "question_id": 29923104, "link": "https://stackoverflow.com/questions/29923104/why-would-i-get-a-xx-not-in-scope-error-for-this-haskell-code/29927207#29927207", "title": "why would I get a &quot;xx not in scope error&quot; for this haskell code?", "body": "<p>You should think of this code more as</p>\n\n<pre><code>test x = {\n    let {\n        xx = 2 * x\n    } in {\n        result\n    }\n} where {\n    result = replicate xx 3\n}\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>test x = {\n    let {\n        xx = 2 * x\n    } in {\n        result where {\n            result = replicate xx 3\n        }\n    }\n}\n</code></pre>\n\n<p>The <code>where</code> clause covers the entire definition of the function body and can only use names defined outside the function body (which arguments to <code>test</code> and <code>test</code> itself).  The best way to fix this would be to move all definitions to the <code>let</code> or to the <code>where</code>.  For your case, you'll probably want to move them all into the <code>let</code>:</p>\n\n<pre><code>test x =\n    let xx = 2 * x\n        result = replicate xx 3\n    in result\n</code></pre>\n\n<p>Or for your actual use case:</p>\n\n<pre><code>nthElement :: (Ord b) =&gt; (a -&gt; b) -&gt; Int -&gt; [a] -&gt; [a]\nnthElement _ _ []  = []\nnthElement _ _ [x] = [x]\nnthElement op k vals@(x:xs)\n    | k &gt; (length vals) = vals\n    | otherwise = let left    = [p | p&lt;-vals, (op p) &lt; (op x)]\n                      midd    = [p | p&lt;-vals, (op p) == (op x)]\n                      right   = [p | p&lt;-vals, (op p) &gt; (op x)]\n                      leftLen = length left\n                      middLen = length midd\n                      result | leftLen &gt;= k             = (nthElement op k left) ++ midd ++ right\n                             | (leftLen + middLen) &gt;= k = left ++ midd ++ right\n                             | otherwise                = left ++ midd ++ nthElement op (k-middLen-leftLen) right\n                   in result\n</code></pre>\n\n<p>But, as this marches right off the side of the page, I would refactor it a bit to just use a single guard and a <code>where</code>:</p>\n\n<pre><code>nthElement :: (Ord b) =&gt; (a -&gt; b) -&gt; Int -&gt; [a] -&gt; [a]\nnthElement _ _ []  = []\nnthElement _ _ [x] = [x]\nnthElement op k vals@(x:xs)\n    | k &gt; length vals  = vals\n    | k &lt;= leftLen     = nth k left ++ midd ++        right\n    | k &lt;= leftMiddLen =       left ++ midd ++        right\n    | otherwise        =       left ++ midd ++ nth kR right\n    where\n        opx         = op x\n        left        = [p | p &lt;- vals, op p &lt;  opx]\n        midd        = [p | p &lt;- vals, op p == opx]\n        right       = [p | p &lt;- vals, op p &gt;  opx]\n        leftLen     = length left\n        middLen     = length midd\n        leftMiddLen = leftLen + middLen\n        nth         = nthElement op\n        kR          = k - leftMiddLen\n</code></pre>\n\n<p>98% of this is just stylistic, you may not like it this way, but I find it a lot easier to read.  In particuarly, I would say that the 2% that isn't just style is collapsing the guards down to a single level, it makes your intentions much more clear.  Since Haskell is lazy you also don't have to worry about computing anything until the value is actually used.</p>\n"}], "owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 29927207, "answer_count": 2, "score": 1, "last_activity_date": 1430245853, "creation_date": 1430233729, "question_id": 29923104, "link": "https://stackoverflow.com/questions/29923104/why-would-i-get-a-xx-not-in-scope-error-for-this-haskell-code", "title": "why would I get a &quot;xx not in scope error&quot; for this haskell code?", "body": "<p>I write such a code, but get an error when compiling saying that \"xx is not in scope\". </p>\n\n<pre><code>test x =\n    let xx = 2 * x\n     in result \n       where result = replicate xx 3\n</code></pre>\n\n<p>I know I can fix it by using <code>in replicate xx 3</code>, however, code above is just a demo, the real code I am dealing with is like below:</p>\n\n<pre><code>nthElement :: (Ord b)=&gt;(a-&gt;b)-&gt;Int-&gt;[a]-&gt;[a]\nnthElement _ _ []  = []\nnthElement _ _ [x] = [x]\nnthElement op k vals@(x:xs)\n    | k &gt; (length vals) = vals\n    | otherwise = let left    = [p | p&lt;-vals, (op p) &lt; (op x)]\n                      midd    = [p | p&lt;-vals, (op p) == (op x)]\n                      right   = [p | p&lt;-vals, (op p) &gt; (op x)]\n                      leftLen = length left\n                      middLen = length midd\n                   in result where result | leftLen &gt;= k             = (nthElement op k left) ++ midd ++ right\n                                          | (leftLen + middLen) &gt;= k = left ++ midd ++ right\n                                          | otherwise                = left ++ midd ++ nthElement op (k-middLen-leftLen) right\n</code></pre>\n\n<p>It seems that if I don't use the <code>where</code> clause, I have to use deeply nested if like this:</p>\n\n<pre><code>nthElement :: (Ord b)=&gt;(a-&gt;b)-&gt;Int-&gt;[a]-&gt;[a]\nnthElement _ _ []  = []\nnthElement _ _ [x] = [x]\nnthElement op k vals@(x:xs)\n    | k &gt; (length vals) = vals\n    | otherwise = let left   = [p | p&lt;-vals, (op p) &lt; (op x)]\n                      midd   = [p | p&lt;-vals, (op p) == (op x)]\n                      right  = [p | p&lt;-vals, (op p) &gt; (op x)]\n                      leftLen = length left\n                      middLen = length midd\n                   in if leftLen &gt;= k \n                         then (nthElement op k left) ++ midd ++ right\n                         else if (leftLen + middLen) &gt;= k \n                                then left ++ midd ++ right\n                                else left ++ midd ++ nthElement op (k-middLen-leftLen) right\n</code></pre>\n\n<p>So, how could I change my code to fix the compiling bug as well as avoide using nested if?</p>\n"}, {"tags": ["haskell", "polymorphism", "ghc"], "comments": [{"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 10, "creation_date": 1430196957, "post_id": 29910433, "comment_id": 47943321, "body": "Note that doing this just by <code>xor</code>ring the underlying bits doesn&#39;t work: <code>9 `xor` 4</code> is <code>13</code>.  This sort of thing is why the constructor for <code>Mod</code> is hidden, and why the derived instance wouldn&#39;t work."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1430197720, "post_id": 29910433, "comment_id": 47943600, "body": "Also if the modulus is not a power of 2 then the result will depend on which representative Integer you choose, and if you choose the smallest nonnegative representative then this operation will not be associative (unlike xor), because the &quot;convert back&quot; operation loses information. This is really a strange operation; what are you using it for, out of curiosity?"}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 4, "creation_date": 1430198155, "post_id": 29910433, "comment_id": 47943777, "body": "@AntalS-Z- D&#39;oh, you are correct!  Your comment resonated with me, indicating that I was doing something wrong.  I looked back at the algorithm, and in fact, I had it wrong....  I need to convert my mod values to Integers, and output an Integer....  If you turn your comment into an answer, I would be happy to award you the credit...."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1430232808, "post_id": 29910433, "comment_id": 47967067, "body": "@jamshidh: Done (with a little more detail, because I have a natural tendency to be verbose\u2026).  Interestingly, though, I didn&#39;t get notified from your ping, so I&#39;m glad I saw it :-)  Perhaps it&#39;s treating the trailing <code>-</code> as part of the username it&#39;s looking for?"}, {"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1430240529, "post_id": 29910433, "comment_id": 47972746, "body": "@AntalS-Z thanks for letting me know about the &quot;-&quot;....  I&#39;ve probably done this many times in the past too, and never realized that my messages weren&#39;t getting though."}], "answers": [{"comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1430240559, "post_id": 29922641, "comment_id": 47972767, "body": "Good answer!  Thanks for the extra info."}], "tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 4, "last_activity_date": 1430232704, "last_edit_date": 1495535049, "creation_date": 1430232704, "answer_id": 29922641, "question_id": 29910433, "link": "https://stackoverflow.com/questions/29910433/how-do-i-add-data-bits-to-data-modular-automatically/29922641#29922641", "title": "How do I add Data.Bits to Data.Modular, automatically?", "body": "<p>You can't implement <code>xor</code> for modular numbers just by xorring the underlying bits; you'll get out-of-range numbers.  For example:</p>\n\n<pre><code>ghci&gt; 9 `xor` 4 :: Integer\n13\n</code></pre>\n\n<p>This is what the derived instance would do, which means it wouldn't work anyway.  This sort of thing is why the constructor for <code>Mod</code> is hidden: so that the \"is less than <code>n</code>\" invariant can be maintained via smart constructors.</p>\n\n<p>But the situation here is worse: <em>modular numbers really <strong>aren't</strong> a sensible instance of <code>Bits</code>!</em>  In general, in a case like this, the code you write instead of automatic type class instantiations just uses a bunch of lifting functions such as</p>\n\n<pre><code>mapMod :: (KnownNat n, Integral j) =&gt; (i -&gt; j) -&gt; i `Mod` n -&gt; j `Mod` n\nmapMod f = toMod . f . unMod\n\nliftMod2 :: (KnownNat n, Integral k)\n         =&gt; (i -&gt; j -&gt; k) -&gt; i `Mod` n -&gt; j `Mod` n -&gt; k `Mod` n\nliftMod2 f x y = toMod $ f (unMod x) (unMod y)\n</code></pre>\n\n<p>and then implementing a whole bunch of methods as <code>(.&amp;.) = liftMod2 (.&amp;.)</code> and so on (including <code>xor = liftMod2 xor</code>).</p>\n\n<p>Unfortunately, that produces a whole bunch of issues.  Here's a not-necessarily exhaustive list.  Given an instance <code>Bits (i `Mod` n)</code>:</p>\n\n<ol>\n<li><p><code>bitSizeMaybe</code> doesn't really have a great definition.  It probably should be the number of bits it takes to represent <code>n-1</code>, but consider <code>n = 10</code>: then we'll claim to have a 4-bit number, but that seems like a claim there are 16 possible numbers mod 10!  Perhaps we should claim to be a log\u2082 10 = 3.32\u2026-bit number?  (This lack of an integral bit size is arguably the root of the problem.)</p></li>\n<li><p><code>bit</code> needs to be modulus-aware, so it can't just be lifted: consider <code>n = 10</code>, again, where <code>bit 3 == 8</code> but <code>bit 4 == 0</code>.  This would be OK, but\u2026</p></li>\n<li><p><code>setBit</code> gets weird.  Again, consider <code>n = 10</code>, and <code>3 = 0b0011</code>.  Then <code>setBit 3 3</code> can't just compute <code>0b1011 = 11</code>; it instead has to work out to <code>0b0001 = 1</code>, which has even <em>fewer</em> bits set.  That last bit isn't fully there!</p></li>\n<li><p><code>complement</code> is similarly wonky: in four bits, we have <code>complement 3 = complement 0b0011 = 0b1100 = 12</code>.  So when working mod 10, should <code>complement 3 = 2</code>, so that <code>complement 0b0011 = 0b0010</code>?  Ugh.</p></li>\n<li><p><a href=\"https://stackoverflow.com/questions/29910433/how-do-i-add-data-bits-to-data-modular-automatically#comment47943600_29910433\">As Reid Barton said in a comment</a>, the resulting <code>xor</code> operation isn't associative.  Given <code>xorM = liftMod2 xor</code>, we have</p>\n\n<pre><code>ghci&gt; (9 `xorM` 4) `xorM` 3 :: Integer `Mod` 10\n0\nghci&gt; 9 `xorM` (4 `xorM` 3) :: Integer `Mod` 10\n4\n</code></pre>\n\n<p>Bitwise or similarly breaks (although bitwise and is fine, I believe).  This is because bitwise (x)or can produce larger numbers, whose remainders are then taken, and this remainder-taking is not associative over bitwise operations.</p></li>\n</ol>\n\n<p>The only case where this instance <em>does</em> make sense, as (once again) <a href=\"https://stackoverflow.com/questions/29910433/how-do-i-add-data-bits-to-data-modular-automatically#comment47943600_29910433\">mentioned by Reid Barton in a comment</a>, is when <code>n</code> is a power of 2.  Then you would essentially have a mod-based encoding of a computer-style binary number, just of a potentially different size (128-bit? 256-bit? 1024-bit?), the simple liftings would work fine, and the weird behavior would go away, because your type would really have a whole number of bits.</p>\n"}], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 0, "accepted_answer_id": 29922641, "answer_count": 1, "score": 2, "last_activity_date": 1430241291, "creation_date": 1430195846, "last_edit_date": 1430241291, "question_id": 29910433, "link": "https://stackoverflow.com/questions/29910433/how-do-i-add-data-bits-to-data-modular-automatically", "title": "How do I add Data.Bits to Data.Modular, automatically?", "body": "<p>I need to <code>xor</code> a couple of mod numbers (from Data.Modular)....</p>\n\n<pre><code>let x = 4 :: Integer `Mod` 10\n    y = 6 :: Integer `Mod` 10\n\nprint $ x `xor` y\n</code></pre>\n\n<p>....but, this doesn't work, because <code>Mod x y</code> is not an instance of Data.Bits.</p>\n\n<p>I can, or course, convert the values to Integers, xor it, and convert back.  Or, I could even make <code>Mod x y</code> an instance of Bits by hand by writing all the class functions, but this is all ugly boilerplate code, which should be automated.  The StandaloneDeriving extension would be the way to achieve this, but it doesn't seem to work....</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeOperators, TypeSysonymInstances, FlexibleInstances, StandaloneDeriving #-}\n\nimport Data.Bits\nimport Data.Modular\nimport GHC.TypeLits\n\nderiving instance Bits (Int `Mod` 10)\n</code></pre>\n\n<p>yields</p>\n\n<p>\"Can't make a derived instance of 'Bits (Mod Int 10)': The data constructors of 'Mod' are not all in scope so you cannot derive an instance for it\"</p>\n\n<p>I am not married to StandaloneDeriving, I just would like any solution that gives my xor'able modular numbers (minus a bunch of boilerplate)....</p>\n"}, {"tags": ["list", "function", "haskell", "recursion"], "comments": [{"owner": {"reputation": 7579, "user_id": 453261, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PfNvQ.jpg?s=128&g=1", "display_name": "The Internet", "link": "https://stackoverflow.com/users/453261/the-internet"}, "edited": false, "score": 0, "creation_date": 1430185460, "post_id": 29908796, "comment_id": 47940171, "body": "What you&#39;re missing is that the type of <code>f</code> is <code>(a -&gt; b -&gt; c)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 99, "user_id": 3053042, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/73939e8691a110c04849733907b401ca?s=128&d=identicon&r=PG&f=1", "display_name": "user3053042", "link": "https://stackoverflow.com/users/3053042/user3053042"}, "edited": false, "score": 0, "creation_date": 1430185737, "post_id": 29908849, "comment_id": 47940225, "body": "Technically I know that, but it won&#39;t compile (even after defining miZipWith with zipWith&#39;s definition.)."}, {"owner": {"reputation": 99, "user_id": 3053042, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/73939e8691a110c04849733907b401ca?s=128&d=identicon&r=PG&f=1", "display_name": "user3053042", "link": "https://stackoverflow.com/users/3053042/user3053042"}, "edited": false, "score": 0, "creation_date": 1430185825, "post_id": 29908849, "comment_id": 47940253, "body": "&lt;interactive&gt;:263:1:     Could not deduce (Num (b0 -&gt; c))       arising from the ambiguity check for \u2018it\u2019     from the context (Num (b -&gt; c), Num b)       bound by the inferred type for \u2018it\u2019: (Num (b -&gt; c), Num b) =&gt; [c]       at &lt;interactive&gt;:263:1-32     The type variable \u2018b0\u2019 is ambiguous     When checking that \u2018it\u2019       has the inferred type \u2018forall b c. (Num (b -&gt; c), Num b) =&gt; [c]\u2019     Probable cause: the inferred type is ambiguous"}, {"owner": {"reputation": 7579, "user_id": 453261, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PfNvQ.jpg?s=128&g=1", "display_name": "The Internet", "link": "https://stackoverflow.com/users/453261/the-internet"}, "reply_to_user": {"reputation": 99, "user_id": 3053042, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/73939e8691a110c04849733907b401ca?s=128&d=identicon&r=PG&f=1", "display_name": "user3053042", "link": "https://stackoverflow.com/users/3053042/user3053042"}, "edited": false, "score": 1, "creation_date": 1430185870, "post_id": 29908849, "comment_id": 47940264, "body": "<code>miZipWith (*2) [1,2,3,4] [5,6,1]</code> should now be <code>miZipWith (*) [1,2,3,4] [5,6,1]</code>"}], "tags": [], "owner": {"reputation": 7579, "user_id": 453261, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PfNvQ.jpg?s=128&g=1", "display_name": "The Internet", "link": "https://stackoverflow.com/users/453261/the-internet"}, "is_accepted": true, "score": 5, "last_activity_date": 1430185273, "creation_date": 1430185273, "answer_id": 29908849, "question_id": 29908796, "link": "https://stackoverflow.com/questions/29908796/how-to-create-a-recursive-zipwith-function-in-haskell/29908849#29908849", "title": "How to create a recursive zipWith function in Haskell?", "body": "<p>The <code>zipWith</code> function goes like this:</p>\n\n<pre><code>zipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nzipWith f (x:xs) (y:ys) = f x y : zipWith f xs ys\nzipWith _ _ _ = []\n</code></pre>\n\n<p>Your assumption is that the function <code>f</code> takes only one argument, but it in fact takes two (the head of both lists).</p>\n"}], "owner": {"reputation": 99, "user_id": 3053042, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/73939e8691a110c04849733907b401ca?s=128&d=identicon&r=PG&f=1", "display_name": "user3053042", "link": "https://stackoverflow.com/users/3053042/user3053042"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 854, "favorite_count": 0, "accepted_answer_id": 29908849, "answer_count": 1, "score": 0, "last_activity_date": 1430185273, "creation_date": 1430184967, "question_id": 29908796, "link": "https://stackoverflow.com/questions/29908796/how-to-create-a-recursive-zipwith-function-in-haskell", "title": "How to create a recursive zipWith function in Haskell?", "body": "<p>So far I have:</p>\n\n<pre><code>miZipWith f [] [] = []\nmiZipWith f (x:xs) [] = []\nmiZipWith f [] (y:ys) = []\nmiZipWith f (x:xs) (y:ys) = f y: miZipWith f xs ys\n\n----miZipWith f (x:xs) (y:ys) = f x : f y : miZipWith f xs ys\n</code></pre>\n\n<p>But this only \"zips\" the function f with the second list. How do I include the first list too?</p>\n\n<pre><code>*Main&gt; miZipWith (*2) [1,2,3,4] [5,6,1]\n[10,12,2]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1430183345, "post_id": 29908413, "comment_id": 47939579, "body": "It seems you have gathered some good answers here giving you good hints. So just on a general side-track: any time you start thinking <code>IO foo -&gt; bar</code> you should be squinting nervously. You can&#39;t (<i>cough, cough</i>) get out of IO once you&#39;re in, and that&#39;s a good thing."}, {"owner": {"reputation": 505, "user_id": 4447304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4099f8ed408aa8d467a65c00ec6dec56?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/4447304/daniel"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1430184211, "post_id": 29908413, "comment_id": 47939808, "body": "I am not sure I understand... I figured Haskell works like: <code>Input -&gt; [Purely Functional Magic] -&gt; Output</code> where safely gluing pure code and impure data was the whole point. Or is there simply a more idiomatic way I could have expressed this problem?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1430185319, "post_id": 29908413, "comment_id": 47940125, "body": "@Daniel Yes, that is about right. But...you can&#39;t <i>really</i> go from <code>IO a</code> to <code>a</code>, except in a function that actually returns type <code>IO a</code>; rather, the way you do things is write a function <code>f x = y</code>, and then inside of <code>main</code> you do something like <code>x &lt;- readX; putStrLn (f x)</code>. Here, <code>x</code> is &quot;extracted&quot; from <code>IO</code> and passed to your pure program (<code>f</code>), so the rest of your code can be pure. But you can only do this sort of thing inside of a function that can do IO; you can&#39;t <i>in general</i> convert <code>IO a</code> to <code>a</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1430185680, "post_id": 29908413, "comment_id": 47940217, "body": "@Daniel Well, you can program your computation with a type like <code>Input -&gt; Output</code>; but you need to hook that computation up to some widget that actually interacts with the world and generates a value of type <code>Input</code>, then interacts with the world in a way that displays the value of type <code>Output</code>. The collection of <code>IO</code> types do this -- and GHC has a special symbol, <code>main</code>, which kicks things off. But you can&#39;t get &quot;out&quot; of IO. <code>IO foo -&gt; IO bar</code> is okay; <code>IO foo -&gt; bar</code> where <code>bar</code> doesn&#39;t have <code>IO</code> in it doesn&#39;t have many interesting implementations."}, {"owner": {"reputation": 505, "user_id": 4447304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4099f8ed408aa8d467a65c00ec6dec56?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/4447304/daniel"}, "edited": false, "score": 0, "creation_date": 1430188099, "post_id": 29908413, "comment_id": 47940898, "body": "Yeah it looks like I have a good amount to learn about binding encapsulated data. It&#39;s starting to seem like that Haskell makes hard things (refactoring code, unit testing, etc.) easy, and easy things (IO, printing multi-line, formatted strings, library management, etc.) tricky."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1430199110, "post_id": 29908413, "comment_id": 47944138, "body": "The easy things you mention are very easy in Haskell."}], "answers": [{"comments": [{"owner": {"reputation": 9485, "user_id": 20371, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/32c7a412ad0caf812ae974df5eb8ffcd?s=128&d=identicon&r=PG", "display_name": "Yawar", "link": "https://stackoverflow.com/users/20371/yawar"}, "edited": false, "score": 4, "creation_date": 1430182803, "post_id": 29908437, "comment_id": 47939431, "body": "@Daniel This answer is technically correct but the thing to understand here is that when you do <code>arg &lt;- getLine</code>, <code>arg</code> has type <code>String</code> because the binding operation &#39;extracts&#39; the value from inside the <code>IO</code> container. Then you can just <code>read arg</code> and send that as the argument to <code>pizzas</code>, at which time Haskell will infer the correct type."}, {"owner": {"reputation": 505, "user_id": 4447304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4099f8ed408aa8d467a65c00ec6dec56?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/4447304/daniel"}, "edited": false, "score": 0, "creation_date": 1430183076, "post_id": 29908437, "comment_id": 47939501, "body": "I am getting: <code>parse error on input \u2018=\u2019</code> with both solutions :~/"}, {"owner": {"reputation": 505, "user_id": 4447304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4099f8ed408aa8d467a65c00ec6dec56?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/4447304/daniel"}, "edited": false, "score": 0, "creation_date": 1430183925, "post_id": 29908437, "comment_id": 47939740, "body": "It compiles! Thanks for the solution and the explanation."}], "tags": [], "owner": {"reputation": 25744, "user_id": 2089675, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/sBz5q.jpg?s=128&g=1", "display_name": "smac89", "link": "https://stackoverflow.com/users/2089675/smac89"}, "is_accepted": true, "score": 4, "last_activity_date": 1430183232, "last_edit_date": 1430183232, "creation_date": 1430182249, "answer_id": 29908437, "question_id": 29908413, "link": "https://stackoverflow.com/questions/29908413/basic-haskell-io-io-string-int/29908437#29908437", "title": "Basic Haskell IO (IO String -&gt; Int)?", "body": "<p>Using read will convert the type from a string to the appropriate type if possible</p>\n\n<p>And using show will convert the integer to it's string representation</p>\n\n<pre><code>arg &lt;- getLine\nlet num = pizzas (read arg)\nputStrLn $ \"You will need to order \" ++ (show num) ++ \" pizzas.\"\n</code></pre>\n\n<p>Or do this:</p>\n\n<pre><code>arg &lt;- readLn :: IO Int\nlet num = pizzas arg\nputStrLn $ \"You will need to order \" ++ (show num) ++ \" pizzas.\"\n</code></pre>\n"}], "owner": {"reputation": 505, "user_id": 4447304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4099f8ed408aa8d467a65c00ec6dec56?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/4447304/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3575, "favorite_count": 0, "accepted_answer_id": 29908437, "answer_count": 1, "score": 3, "last_activity_date": 1430183232, "creation_date": 1430182005, "question_id": 29908413, "link": "https://stackoverflow.com/questions/29908413/basic-haskell-io-io-string-int", "title": "Basic Haskell IO (IO String -&gt; Int)?", "body": "<p>Beginner Haskeller here. I am trying to represent the <a href=\"http://gawker.com/how-many-pizzas-should-you-order-the-pizza-equation-wi-1697815579/+whitsongordon\" rel=\"nofollow\">pizza equation</a> with a simple command line program that takes a number of people and returns an appropriate number of pizzas to order. I know I need to convert my input (<code>IO String</code>) to an Int and then convert the result to a string using <code>show</code>. How do I <code>IO String -&gt; Int</code>? Or am I skinning this cat all wrong?</p>\n\n<pre><code>import System.Environment\nimport System.IO\n\npizzas :: Integral a =&gt; a -&gt; a\npizzas x = div (x * 3) 8\n\nmain = do\n    putStrLn \"How many people are you going to feed?\"\n    arg &lt;- getLine\n    -- arg needs to IO String -&gt; Int\n    -- apply pizzas function\n    -- Int -&gt; String\n    putStrLn \"You will need to order \" ++ string ++ \" pizzas.\"\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 4738, "user_id": 917635, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2365756407af40c28c05d4d30182dbac?s=128&d=identicon&r=PG", "display_name": "artella", "link": "https://stackoverflow.com/users/917635/artella"}, "edited": false, "score": 1, "creation_date": 1430199561, "post_id": 29908063, "comment_id": 47944337, "body": "You can use <code>v2</code> or <code>v3</code> during <code>cabal install</code> to give a detailed output and that might help. For example <a href=\"https://gist.github.com/artella-coding/ad2de89c2b198f504da9\" rel=\"nofollow noreferrer\">gist.github.com/artella-coding/ad2de89c2b198f504da9</a> gives the detailed output of <code>cabal install network -j1 -v2</code> on windows"}], "owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1430179626, "creation_date": 1430179626, "last_edit_date": 1495540247, "question_id": 29908063, "link": "https://stackoverflow.com/questions/29908063/haskell-linking-failure-conflicting-packages", "title": "Haskell linking failure conflicting packages", "body": "<p>I have a ghci session that crashes on run due to a runtime link failure.\nThe error is as follows:</p>\n\n<pre><code>GHCi runtime linker: fatal error: I found a duplicate definition for symbol\n   __hs_text_memcpy\nwhilst processing object file\n   C:\\Users\\trbauer\\AppData\\Roaming\\cabal\\i386-windows-ghc-7.8.3\\text-1.2.0.4\\HStext-1.2.0.4.o\nThis could be caused by:\n   * Loading two different object files which export the same symbol\n   * Specifying the same object file twice on the GHCi command line\n   * An incorrect `package.conf' entry, causing some object to be\n loaded twice.\nGHCi cannot safely continue in this situation.  Exiting now.  Sorry.\n</code></pre>\n\n<p>The list of packages loaded is as follows:</p>\n\n<pre><code>...\nLoading package text-1.2.0.0 ... linking ... done.\nLoading package parsec-3.1.7 ... linking ... done.\nLoading package process-1.2.0.0 ... linking ... done.\nLoading package text-1.2.0.4 ...\n...\n</code></pre>\n\n<p>It seems that text is tripping over itself (1.2.0.0 and 1.2.0.4 are both being loaded).  </p>\n\n<p>My question: <em>How do I debug this</em>? That is how do I determine which package is loading each version of text?  <code>cabal info</code> doesn't seem to list direct or indirect dependencies.  The only question I could find regarding inferring package dependencies had no tractable solution. Hence, I am suspecting that everyone else approaches this differently.</p>\n\n<p>Once I can figure out who depends on what can use a solution like <a href=\"https://stackoverflow.com/questions/25592699/haskell-package-version-conflict-trips-up-linker-how-to-solve\">this</a> (rebuilding the dependents on a common text version).</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "indentation", "ghc", "cabal"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1430174495, "post_id": 29906010, "comment_id": 47936960, "body": "You could try specifically installing <code>hindent-4.4.0</code> which has more lax <code>base</code> version requirements. Also, GHC 7.6.3 is now two major versions behind the current stable release, so it might be time to upgrade."}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 146, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1430169141, "creation_date": 1430169141, "question_id": 29906010, "link": "https://stackoverflow.com/questions/29906010/building-trouble-with-hindent-on-debian-8", "title": "Building trouble with hindent on Debian 8", "body": "<p>I tried to build <strong>hindent-4.4.0</strong> on debian 8 with GHC-7.6.3 by performing a <code>cabal install hindent</code> and I had the following problems : </p>\n\n<p><strong>1. First problem</strong></p>\n\n<p>My build stop with this errors : </p>\n\n<pre><code>src/Descriptive/JSON.hs:199:33: Not in scope: `floatingOrInteger'\nsrc/Descriptive/JSON.hs:213:39: Not in scope: `toRealFloat'\n</code></pre>\n\n<p>After some research, I reinstalled <code>scientific-0.3.3.8</code> lib with <code>cabal install scientific</code> (The lib provided with Debian 8 seems to have a problem )</p>\n\n<p>After that, The build of <strong>hindent</strong> has continue until the...</p>\n\n<p><strong>2. Second problem</strong></p>\n\n<p>I get this error message : </p>\n\n<pre><code>src/HIndent/Pretty.hs:88:31:\n    Expecting one more argument to `ast'\n    In the class declaration for `Pretty'\n</code></pre>\n\n<p>I suspected a mismatching module version number and tried to install the most recent version of <code>hindent-4.4.2</code> manually by downloading the archive from <strong>hackage</strong>. </p>\n\n<p>I performed the standard <code>cabal install</code> which leads me to the ...</p>\n\n<p><strong>3. Third problem</strong></p>\n\n<p>Cabal is rejecting the package due to incompatible <strong>base</strong> version : </p>\n\n<pre><code>rejecting: base-4.6.0.1/installed-8aa... (conflict: hindent =&gt; base&gt;=4.7 &amp;&amp; &lt;5)\n</code></pre>\n\n<p>and most other versions of <strong>hindent</strong> seems incompatible with base-4.6.</p>\n\n<p><strong>Do you know how to build any version of hindent on debian 8?</strong></p>\n"}, {"tags": ["haskell", "constraints", "ghc", "vinyl"], "comments": [{"owner": {"reputation": 17993, "user_id": 125361, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4972963194d678c0d284a00159e2ebd3?s=128&d=identicon&r=PG", "display_name": "Jonathan Sterling", "link": "https://stackoverflow.com/users/125361/jonathan-sterling"}, "edited": false, "score": 0, "creation_date": 1430173072, "post_id": 29905159, "comment_id": 47936487, "body": "I think at least part of the problem is that the <code>c</code> is quantified in the wrong place..."}], "answers": [{"tags": [], "owner": {"reputation": 775, "user_id": 3286185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a141681120ffb0004d8d60bb191f89b8?s=128&d=identicon&r=PG", "display_name": "gelisam", "link": "https://stackoverflow.com/users/3286185/gelisam"}, "is_accepted": true, "score": 12, "last_activity_date": 1430194092, "creation_date": 1430194092, "answer_id": 29910145, "question_id": 29905159, "link": "https://stackoverflow.com/questions/29905159/weakening-vinyls-recall-constraint-through-entailment/29910145#29910145", "title": "Weakening vinyl&#39;s RecAll constraint through entailment", "body": "<p>Let's begin by reviewing how <code>Dict</code> and <code>(:-)</code> are meant to be used.</p>\n\n<pre><code>ordToEq :: Dict (Ord a) -&gt; Dict (Eq a)\nordToEq Dict = Dict\n</code></pre>\n\n<p>Pattern matching on a value <code>Dict</code> of type <code>Dict (Ord a)</code> brings the constraint <code>Ord a</code> into scope, from which <code>Eq a</code> can be deduced (because <code>Eq</code> is a superclass of <code>Ord</code>), so <code>Dict :: Dict (Eq a)</code> is well-typed.</p>\n\n<pre><code>ordEntailsEq :: Ord a :- Eq a\nordEntailsEq = Sub Dict\n</code></pre>\n\n<p>Similarly, <code>Sub</code> brings its input constraint into scope for the duration of its argument, allowing this <code>Dict :: Dict (Eq a)</code> to be well-typed as well.</p>\n\n<p>However, whereas pattern-matching on <code>Dict</code> brings a constraint into scope, pattern-matching on <code>Sub Dict</code> does not bring into scope some new constraint conversion rule. In fact, unless the input constraint is already in scope, you can't pattern-match on <code>Sub Dict</code> at all.</p>\n\n<pre><code>-- Could not deduce (Ord a) arising from a pattern\nconstZero :: Ord a :- Eq a -&gt; Int\nconstZero (Sub Dict) = 0\n\n-- okay\nconstZero' :: Ord a =&gt; Ord a :- Eq a -&gt; Int\nconstZero' (Sub Dict) = 0\n</code></pre>\n\n<p>So that explains your first type error, <code>\"Could not deduce (a c) arising from a pattern\"</code>: you have tried to pattern-match on <code>Sub Dict</code>, but the input constraint <code>a c</code> was not already in scope.</p>\n\n<p>The other type error, of course, is saying that the constraints you did manage to get into scope were not sufficient to satisfy the <code>RecAll f rs b</code> constraint. So, which pieces are needed, and which ones are missing? Let's look at the definition of <code>RecAll</code>.</p>\n\n<pre><code>type family RecAll f rs c :: Constraint where\n  RecAll f [] c = ()     \n  RecAll f (r : rs) c = (c (f r), RecAll f rs c)\n</code></pre>\n\n<p>Aha! <code>RecAll</code> is a type family, so unevaluated as it is, with a completely abstract <code>rs</code>, the constraint <code>RecAll f rs c</code> is a black box which could not be satisfied from any set of smaller pieces. Once we specialize <code>rs</code> to <code>[]</code> or <code>(r : rs)</code>, it becomes clear which pieces we need:</p>\n\n<pre><code>recAllNil :: Dict (RecAll f '[] c)\nrecAllNil = Dict\n\nrecAllCons :: p rs\n           -&gt; Dict (c (f r))\n           -&gt; Dict (RecAll f rs c)\n           -&gt; Dict (RecAll f (r ': rs) c)\nrecAllCons _ Dict Dict = Dict\n</code></pre>\n\n<p>I'm using <code>p rs</code> instead of <code>Proxy rs</code> because it's more flexible: if I had a <code>Rec f rs</code>, for instance I could use that as my proxy with <code>p ~ Rec f</code>.</p>\n\n<p>Next, let's implement a version of the above with <code>(:-)</code> instead of <code>Dict</code>:</p>\n\n<pre><code>weakenNil :: RecAll f '[] c1 :- RecAll f '[] c2\nweakenNil = Sub Dict\n\nweakenCons :: p rs\n           -&gt; c1 (f r) :- c2 (f r)\n           -&gt; RecAll f rs c1 :- RecAll f rs c2\n           -&gt; RecAll f (r ': rs) c1 :- RecAll f (r ': rs) c2\nweakenCons _ entailsF entailsR = Sub $ case (entailsF, entailsR) of\n    (Sub Dict, Sub Dict) -&gt; Dict\n</code></pre>\n\n<p><code>Sub</code> brings its input constraint <code>RecAll f (r ': rs) c1</code> into scope for the duration of its argument, which we've arranged to include the rest of the function's body. The equation for the type family <code>RecAll f (r ': rs) c1</code> expands to <code>(c1 (f r), RecAll f rs c1)</code>, which are thus both brought into scope as well. The fact that they are in scope allows us to pattern-match on the two <code>Sub Dict</code>, and those two <code>Dict</code> bring their respective constraints into scope: <code>c2 (f r)</code>, and <code>RecAll f rs c2</code>. Those two are precisely what the target constraint <code>RecAll f (r ': rs) c2</code> expands to, so our <code>Dict</code> right-hand side is well-typed.</p>\n\n<p>To complete our implementation of <code>weakenAllRec</code>, we will need to pattern-match on <code>rs</code> in order to determine whether to delegate the work to <code>weakenNil</code> or <code>weakenCons</code>. But since <code>rs</code> is at the type level, we cannot pattern-match on it directly. The <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\">Hasochism</a> paper explains how in order to pattern-match on a type-level <code>Nat</code>, we need to create a wrapper datatype <code>Natty</code>. The way in which <code>Natty</code> works is that each of its constructors is indexed by a corresponding <code>Nat</code> constructor, so when we pattern-match on a <code>Natty</code> constructor at the value level, the corresponding constructor is implied at the type level as well. We could define such a wrapper for type-level lists such as <code>rs</code>, but it just so happens that <code>Rec f rs</code> already has constructors corresponding to <code>[]</code> and <code>(:)</code>, and the callers of <code>weakenAllRec</code> are likely to have one lying around anyway.</p>\n\n<pre><code>weakenRecAll :: Rec f rs\n             -&gt; (forall a. c1 a :- c2 a)\n             -&gt; RecAll f rs c1 :- RecAll f rs c2\nweakenRecAll RNil       entails = weakenNil\nweakenRecAll (fx :&amp; rs) entails = weakenCons rs entails\n                                $ weakenRecAll rs entails\n</code></pre>\n\n<p>Note that the type of <code>entails</code> must be <code>forall a. c1 a :- c2 a</code>, not merely <code>c1 a :- c2 a</code>, because we don't want to claim that <code>weakenRecAll</code> will work for any <code>a</code> of the caller's choosing, but rather, we want to require the caller to prove that <code>c1 a</code> entails <code>c2 a</code> for every <code>a</code>.</p>\n"}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 413, "favorite_count": 1, "accepted_answer_id": 29910145, "answer_count": 1, "score": 7, "last_activity_date": 1430194092, "creation_date": 1430165876, "question_id": 29905159, "link": "https://stackoverflow.com/questions/29905159/weakening-vinyls-recall-constraint-through-entailment", "title": "Weakening vinyl&#39;s RecAll constraint through entailment", "body": "<p>In the <a href=\"https://hackage.haskell.org/package/vinyl\">vinyl</a> library, there is a <code>RecAll</code> type family, which let's us ask that a partially applied constraint is true for every type in a type level list. For example, we can write this:</p>\n\n<pre><code>myShowFunc :: RecAll f rs Show =&gt; Rec f rs -&gt; String\n</code></pre>\n\n<p>And that's all lovely. Now, if we have the constraint <code>RecAll f rs c</code> where <code>c</code> is unknown, and we know the <code>c x</code> entails <code>d x</code> (to borrow language from ekmett's <a href=\"https://hackage.haskell.org/package/constraints\">contstraints</a> package), how can we get <code>RecAll f rs d</code>?</p>\n\n<p>The reason I ask is that I'm working with records in some functions that require satisfying several typeclass constraints. To do this, I am using the <code>:&amp;:</code> combinator from the <a href=\"https://hackage.haskell.org/package/exists-0.2/docs/Control-Constraint-Combine.html\">Control.Constraints.Combine</a> module in the <a href=\"https://hackage.haskell.org/package/exists-0.2\">exists</a> package. (Note: the package won't build if you have other things installed because it depends on a super-old version of <code>contravariant</code>. You can just copy the one module I mentioned though.) With this, I can get some really beautiful constraints while minimizing typeclass broilerplate. For example:</p>\n\n<pre><code>RecAll f rs (TypeableKey :&amp;: FromJSON :&amp;: TypeableVal) =&gt; Rec f rs -&gt; Value\n</code></pre>\n\n<p>But, inside the body of this function, I call another function that demands a weaker constraint. It might look like this:</p>\n\n<pre><code>RecAll f rs (TypeableKey :&amp;: TypeableVal) =&gt; Rec f rs -&gt; Value\n</code></pre>\n\n<p>GHC can't see that the second statement follows from the first. I assumed that would be the case. What I can't see is how to prove it for reify it and help GHC out. So far, I've got this:</p>\n\n<pre><code>import Data.Constraint\n\nweakenAnd1 :: ((a :&amp;: b) c) :- a c                                                                    \nweakenAnd1 = Sub Dict -- not the Dict from vinyl. ekmett's Dict.\n\nweakenAnd2 :: ((a :&amp;: b) c) :- b c                                                                    \nweakenAnd2 = Sub Dict\n</code></pre>\n\n<p>These work fine. But this is where I am stuck:</p>\n\n<pre><code>-- The two Proxy args are to stop GHC from complaining about AmbiguousTypes\nweakenRecAll :: Proxy f -&gt; Proxy rs -&gt; (a c :- b c) -&gt; (RecAll f rs a :- RecAll f rs b)\nweakenRecAll _ _ (Sub Dict) = Sub Dict\n</code></pre>\n\n<p>This does not compile. Is anyone aware of a way to get the effect I am looking for. Here are the errors if they are helpful. Also, I have <code>Dict</code> as a qualified import in my actual code, so that's why it mentions <code>Constraint.Dict</code>:</p>\n\n<pre><code>Table.hs:76:23:\n    Could not deduce (a c) arising from a pattern\n    Relevant bindings include\n      weakenRecAll :: Proxy f\n                      -&gt; Proxy rs -&gt; (a c :- b c) -&gt; RecAll f rs a :- RecAll f rs b\n        (bound at Table.hs:76:1)\n    In the pattern: Constraint.Dict\n    In the pattern: Sub Constraint.Dict\n    In an equation for \u2018weakenRecAll\u2019:\n        weakenRecAll _ _ (Sub Constraint.Dict) = Sub Constraint.Dict\n\nTable.hs:76:46:\n    Could not deduce (RecAll f rs b)\n      arising from a use of \u2018Constraint.Dict\u2019\n    from the context (b c)\n      bound by a pattern with constructor\n                 Constraint.Dict :: forall (a :: Constraint).\n                                    (a) =&gt;\n                                    Constraint.Dict a,\n               in an equation for \u2018weakenRecAll\u2019\n      at Table.hs:76:23-37\n    or from (RecAll f rs a)\n      bound by a type expected by the context:\n                 (RecAll f rs a) =&gt; Constraint.Dict (RecAll f rs b)\n      at Table.hs:76:42-60\n    Relevant bindings include\n      weakenRecAll :: Proxy f\n                      -&gt; Proxy rs -&gt; (a c :- b c) -&gt; RecAll f rs a :- RecAll f rs b\n        (bound at Table.hs:76:1)\n    In the first argument of \u2018Sub\u2019, namely \u2018Constraint.Dict\u2019\n    In the expression: Sub Constraint.Dict\n    In an equation for \u2018weakenRecAll\u2019:\n        weakenRecAll _ _ (Sub Constraint.Dict) = Sub Constraint.Dict\n</code></pre>\n"}, {"tags": ["haskell", "readfile"], "comments": [{"owner": {"reputation": 1144, "user_id": 4245823, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-czWZC6KwKYU/AAAAAAAAAAI/AAAAAAAAAYI/yBtPVyZjU4M/photo.jpg?sz=128", "display_name": "felipez", "link": "https://stackoverflow.com/users/4245823/felipez"}, "edited": false, "score": 3, "creation_date": 1430164656, "post_id": 29904746, "comment_id": 47932297, "body": "the function getDirectoryContents  returns also the directories [&quot;.&quot;,&quot;..&quot;], so you need to filter them  <code>filter (flip notElem [&quot;.&quot;, &quot;..&quot;])</code>"}, {"owner": {"reputation": 3, "user_id": 4839233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/827b4dbcf047984587c4619592278dad?s=128&d=identicon&r=PG&f=1", "display_name": "HaskellFan", "link": "https://stackoverflow.com/users/4839233/haskellfan"}, "reply_to_user": {"reputation": 1144, "user_id": 4245823, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-czWZC6KwKYU/AAAAAAAAAAI/AAAAAAAAAYI/yBtPVyZjU4M/photo.jpg?sz=128", "display_name": "felipez", "link": "https://stackoverflow.com/users/4245823/felipez"}, "edited": false, "score": 0, "creation_date": 1430166715, "post_id": 29904746, "comment_id": 47933448, "body": "Thanks ! it was indeed a problem of filtering the list which I didn&#39;t figure out in first place &quot;visually&quot; taking into consideration the important number of txt files to be processed."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1430165031, "post_id": 29904818, "comment_id": 47932508, "body": "That&#39;s the problem. <code>..</code> is not a file but a directory (the up-link to the parent directory). Directories can&#39;t be opened with <code>readFile</code>. FWIW, I get a clearer error message: <code>*** Exception: .: openFile: inappropriate type (is a directory)</code>. I suspect the OP is on Windows, which isn&#39;t so explainative about such issues."}, {"owner": {"reputation": 3, "user_id": 4839233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/827b4dbcf047984587c4619592278dad?s=128&d=identicon&r=PG&f=1", "display_name": "HaskellFan", "link": "https://stackoverflow.com/users/4839233/haskellfan"}, "edited": false, "score": 0, "creation_date": 1430166408, "post_id": 29904818, "comment_id": 47933276, "body": "Thanks ! I&#39;m using windows, the directory contains so many txt files that&#39;s why I didn&#39;t catch the problem (..) in the returned list.  With list filtered it&#39;s now working."}], "tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": true, "score": 5, "last_activity_date": 1430164659, "creation_date": 1430164659, "answer_id": 29904818, "question_id": 29904746, "link": "https://stackoverflow.com/questions/29904746/haskell-read-multiple-files/29904818#29904818", "title": "Haskell read multiple files", "body": "<p>Are you sure all of the files are actually files? It looks like you're trying to open a file called <code>..</code>. </p>\n\n<p>Filter the results to only include actual files first.</p>\n"}], "owner": {"reputation": 3, "user_id": 4839233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/827b4dbcf047984587c4619592278dad?s=128&d=identicon&r=PG&f=1", "display_name": "HaskellFan", "link": "https://stackoverflow.com/users/4839233/haskellfan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 498, "favorite_count": 0, "accepted_answer_id": 29904818, "answer_count": 1, "score": 0, "last_activity_date": 1430164659, "creation_date": 1430164407, "question_id": 29904746, "link": "https://stackoverflow.com/questions/29904746/haskell-read-multiple-files", "title": "Haskell read multiple files", "body": "<p>I'm trying to read multiples files at once using the following code. \nThe code compiles, however when executed I get the following exception:</p>\n\n<p>*** Exception: ..: openFile: permission denied (Permission denied).</p>\n\n<p>I have all the permissions as system administrator. Also, I was able to do the same in C# with no problem, meaning/suspecting that it's an issue with the code itself.</p>\n\n<p>Thanks for help.</p>\n\n<pre><code>main :: IO()\nmain = do \n   putStrLn \" Enter file path:\"\n   content &lt;- getLine &gt;&gt;= getDirectoryContents\n   x &lt;- mapM readFile content\n   print x\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430169830, "post_id": 29904170, "comment_id": 47935090, "body": "I believe the first one is best solved using <code>pack</code> and <code>unpack</code>, and with <code>Data.Function</code> and <code>Data.Composition</code> can be simply implemented with <code>f1 operator = pack .: on operator unpack</code>.  The other two are similarly simple: <code>f1 f = fmap pack . f . unpack</code> and <code>f3 f = pack . f . fmap unpack</code>.  In fact, <code>f2</code> and <code>f3</code> are halfway-between versions of <code>over</code> and <code>overF</code>, both of which are implemented with <code>pack</code> and <code>unpack</code> in the <code>newtype</code> package.  I&#39;d follow the example of the authors and keep it simple."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1430170951, "post_id": 29904170, "comment_id": 47935596, "body": "Are there any downsides to making instances for <code>Newtype (Maybe n) (Maybe o)</code>, <code>Newtype [n] [o]</code> and <code>Newtype (o -&gt; o&#39;) (n -&gt; n&#39;)</code>?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430171003, "post_id": 29904170, "comment_id": 47935625, "body": "Can you even define those instances in general?"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430171843, "post_id": 29904170, "comment_id": 47936016, "body": "For <code>Maybe</code> and <code>[]</code>, <code>pack = fmap pack</code> and <code>unpack = fmap unpack</code>. For the function, it&#39;s just <code>pack f = pack . f . unpack</code>. I think that&#39;s fairly general."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430233017, "post_id": 29904170, "comment_id": 47967202, "body": "You can, but you have to turn on <code>UndecidableInstances</code> and add the constraint <code>Newtype n o</code>.  I think you&#39;d be better served just using <code>fmap pack</code> over <code>Maybe o</code> than trying to force <code>Maybe o</code> to be castable to <code>Maybe n</code> directly using <code>pack</code>.  You&#39;d end up having to put a lot of extra type signatures in your code because the compiler wouldn&#39;t be able to figure them out."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430245425, "post_id": 29904170, "comment_id": 47975937, "body": "@bheklilr Can you give an example where inference would fail?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430246095, "post_id": 29904170, "comment_id": 47976338, "body": "What is the type of <code>pack (Just 1)</code>?  Is it <code>Maybe (Sum Int)</code> or <code>First Int</code>? Personally I&#39;d rather see <code>pack (Just 1)</code> being <code>First Int</code> and <code>fmap pack (Just 1)</code> being <code>Maybe (Sum Int)</code>, those concepts will be much more familiar to most Haskellers.  In the first you&#39;re converting a type to a corresponding newtype, in the second you&#39;re converting the type inside a functor to a corresponding newtype."}], "answers": [{"tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 1, "last_activity_date": 1430235040, "creation_date": 1430235040, "answer_id": 29923628, "question_id": 29904170, "link": "https://stackoverflow.com/questions/29904170/using-the-newtype-package/29923628#29923628", "title": "Using the Newtype package", "body": "<p>Based on the comments above, it seems there may be no clean way to write the functions I need using the hofs supplied by <code>Control.Newtype</code>. However, there seems to be another option: creating instances for <em>non</em>-newtypes.</p>\n\n<p>An example with the <a href=\"https://hackage.haskell.org/package/newtype-0.2\" rel=\"nofollow\">newtype</a> package:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, UndecidableInstances,\n             FlexibleInstances #-}\n\nimport Control.Newtype\n\ninstance (Newtype n o) =&gt; Newtype [n] [o] where\n  pack = map pack\n  unpack = map unpack\n\ninstance (Newtype n o) =&gt; Newtype (Maybe n) (Maybe o) where\n  pack = fmap pack\n  unpack = fmap unpack\n\ninstance (Newtype n o, Newtype n' o') =&gt; Newtype (n -&gt; n') (o -&gt; o') where\n  pack f = pack . f . unpack\n  unpack f = unpack . f . pack\n\n-- a newtype wrapper for Nums\nnewtype NNum a = NNum {unNNum :: a}\ninstance Newtype (NNum a) a where\n  pack = NNum\n  unpack = unNNum\n\nntimes5 :: (Num a) =&gt; NNum a -&gt; NNum a\nntimes5 = pack sum . replicate 5\n\nfoo :: a -&gt; Maybe [a]\nfoo = undefined\n\nbar :: NNum a -&gt; Maybe [NNum a]\nbar = pack foo\n</code></pre>\n\n<p>As bheklilr mentioned, this requires <code>UndecidableInstances</code>, but it doesn't seem to require undue signatures. However, we can do better using the <a href=\"https://hackage.haskell.org/package/newtype-generics\" rel=\"nofollow\">newtype-generics</a> package:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, DeriveGeneric #-}\n\nimport Control.Newtype\nimport GHC.Generics\n\ninstance (Newtype a) =&gt; Newtype [a] where\n  type O [a] = [O a]\n  pack = map pack\n  unpack = map unpack\n\ninstance (Newtype a) =&gt; Newtype (Maybe a) where\n  type O (Maybe a) = Maybe (O a)\n  pack = fmap pack\n  unpack = fmap unpack\n\ninstance (Newtype a, Newtype b) =&gt; Newtype (a -&gt; b) where\n  type O (a -&gt; b) = (O a -&gt; O b)\n  pack f = pack . f . unpack\n  unpack f = unpack . f . pack\n\nnewtype NNum a = NNum {unNNum :: a} deriving (Generic)\ninstance Newtype (NNum a)\n\nntimes5 :: (Num a) =&gt; NNum a -&gt; NNum a\nntimes5 = pack sum . replicate 5\n\nfoo :: a -&gt; Maybe [a]\nfoo = undefined\n\nbar :: NNum a -&gt; Maybe [NNum a]\nbar = pack foo\n</code></pre>\n\n<p>(Of course you can always manually derive the <code>Newtype</code> instance here, too, saving on extension and one import.) Thus any issues that would have arisen due to <code>UndecidableInstances</code> or <code>FlexibleInstances</code> are now moot. The comparison of type families vs fundeps is summarized <a href=\"https://wiki.haskell.org/Functional_dependencies_vs._type_families\" rel=\"nofollow\">here</a> and <a href=\"https://ghc.haskell.org/trac/ghc/wiki/TFvsFD\" rel=\"nofollow\">here</a>. This example seems to be a case where type families provide a clear win.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1430235040, "creation_date": 1430162330, "last_edit_date": 1430169835, "question_id": 29904170, "link": "https://stackoverflow.com/questions/29904170/using-the-newtype-package", "title": "Using the Newtype package", "body": "<p>I'm very confused about how to use the <a href=\"https://hackage.haskell.org/package/newtype-0.2\" rel=\"nofollow\">newtype</a> package. Its documentation seems to hint that is very powerful, but I can't figure out how to use the functions provided (rather than the interface) to create some functions I need. For example, I'd like a functions with the signatures:</p>\n\n<pre><code>(Newtype n o) =&gt; (o -&gt; o -&gt; o) -&gt; n -&gt; n -&gt; n\n\n(Newtype n o, Functor f) =&gt; (o -&gt; f o) -&gt; n -&gt; f n\n\n(Newtype n o, Functor f) =&gt; (f o -&gt; o) -&gt; f n -&gt; n\n</code></pre>\n\n<p>Writing these with combinations of <code>fmap</code>, <code>pack</code> and <code>unpack</code> is doable, but I'm hoping it's possible and cleaner with the mysterious <code>ala</code> or <code>ala'</code> functions (or slight variations that \"lift\" a function to the newtypes rather than \"unlifting\" them from newtypes). Should it matter, the functors I'm specifically interested in are <code>Maybe</code> and <code>[]</code>. </p>\n"}, {"tags": ["haskell", "maybe", "either"], "answers": [{"comments": [{"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1430161937, "post_id": 29903909, "comment_id": 47930743, "body": "Also note that the new version is only using total methods making it safer. Pattern matching <code>x&#47;y</code> avoids having to decide whether <code>head</code> or <code>!!1</code> is safe to do later. Even though it is safe after analysis, it is nice to avoid the analysis."}, {"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1430162148, "post_id": 29903909, "comment_id": 47930861, "body": "@Ruhrpottpatriot: Understanding the <code>Maybe</code> monad requires understanding monads. In this case the transformation is simple, you can remove the <code>return</code>/<code>do</code> and replace <code>end &lt;- decode rest</code> with the snippet he provided and you will have identical execution. I always think of the <code>Maybe</code> monad as &quot;if <code>&lt;-</code> return <code>Nothing</code> you end up with <code>Nothing</code> and <code>return</code> is a synonym for <code>Just</code>&quot;"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1430162203, "post_id": 29903909, "comment_id": 47930894, "body": "@Ruhrpottpatriot the <code>Maybe</code> type is defined as <code>data Maybe a = Nothing | Just a</code>.  There isn&#39;t anything special to it really, the type just has two constructors: <code>Nothing :: Maybe a</code> and <code>Just :: a -&gt; Maybe a</code>.  In order to construct a value of type <code>Maybe a</code>, you use one of these two constructors.  Applying <code>Just</code> to a value of type <code>a</code> constructs a new value of type <code>Maybe a</code>, and using <code>Nothing</code> just constructs a value of type <code>Maybe a</code>, no inputs needed."}, {"owner": {"reputation": 922, "user_id": 1922663, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b62abe78741a1c5c6d2adf8cefe8dace?s=128&d=identicon&r=PG", "display_name": "Ruhrpottpatriot", "link": "https://stackoverflow.com/users/1922663/ruhrpottpatriot"}, "edited": false, "score": 0, "creation_date": 1430162239, "post_id": 29903909, "comment_id": 47930906, "body": "Even though I deleted my comment accidentally. Thanks for the infos on <code>Maybe</code>"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 922, "user_id": 1922663, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b62abe78741a1c5c6d2adf8cefe8dace?s=128&d=identicon&r=PG", "display_name": "Ruhrpottpatriot", "link": "https://stackoverflow.com/users/1922663/ruhrpottpatriot"}, "edited": false, "score": 0, "creation_date": 1430162316, "post_id": 29903909, "comment_id": 47930948, "body": "@Ruhrpottpatriot If you haven&#39;t seen it yet I would recommend reading through <a href=\"http://www.learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">Learn You a Haskell</a>, it covers <code>Maybe</code> and a lot of other concepts in more depth, and eventually monads, functors, and the like."}, {"owner": {"reputation": 922, "user_id": 1922663, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b62abe78741a1c5c6d2adf8cefe8dace?s=128&d=identicon&r=PG", "display_name": "Ruhrpottpatriot", "link": "https://stackoverflow.com/users/1922663/ruhrpottpatriot"}, "edited": false, "score": 0, "creation_date": 1430162435, "post_id": 29903909, "comment_id": 47931011, "body": "@bheklilr No I haven&#39;t seen it yet. Thanks for the tip! However: If I take your solution and try it, I simply get <code>Nothing</code> when I type in [I,O,O,I] ...strange."}, {"owner": {"reputation": 922, "user_id": 1922663, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b62abe78741a1c5c6d2adf8cefe8dace?s=128&d=identicon&r=PG", "display_name": "Ruhrpottpatriot", "link": "https://stackoverflow.com/users/1922663/ruhrpottpatriot"}, "edited": false, "score": 0, "creation_date": 1430162566, "post_id": 29903909, "comment_id": 47931082, "body": "I might also add, that I run ghci with -Wall and -Werror and thus had to replace the <code>decode [x] = Nothing</code> with <code>decode [ _ ] = Nothing</code> If I understood my tutorials correctly, this can be done, right?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 922, "user_id": 1922663, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b62abe78741a1c5c6d2adf8cefe8dace?s=128&d=identicon&r=PG", "display_name": "Ruhrpottpatriot", "link": "https://stackoverflow.com/users/1922663/ruhrpottpatriot"}, "edited": false, "score": 0, "creation_date": 1430162839, "post_id": 29903909, "comment_id": 47931237, "body": "@Ruhrpottpatriot Yes, that&#39;s perfectly all right.  The difference between <code>[x]</code> and <code>[_]</code> in a pattern is that they both match a list with 1 element, in the first one the value of that element is assigned to the name <code>x</code> and in the second one the value of that element isn&#39;t assigned to anything, the <code>_</code> is only there to force the pattern to match a list with one element.  It could be said that <code>_</code> is used for matching structures only, not the data itself.  For example <code>[_, _, _]</code> would match a 3 element list, but <code>[x, y, z]</code> would match the only 3 elements of a list with <code>x</code>, <code>y</code>, and <code>z</code>."}, {"owner": {"reputation": 922, "user_id": 1922663, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b62abe78741a1c5c6d2adf8cefe8dace?s=128&d=identicon&r=PG", "display_name": "Ruhrpottpatriot", "link": "https://stackoverflow.com/users/1922663/ruhrpottpatriot"}, "edited": false, "score": 0, "creation_date": 1430163064, "post_id": 29903909, "comment_id": 47931369, "body": "Ok. That I got right at least :) But why is the program spewing out nothing for each possible combination. It does not matter why I type in, I always get nothing."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 922, "user_id": 1922663, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b62abe78741a1c5c6d2adf8cefe8dace?s=128&d=identicon&r=PG", "display_name": "Ruhrpottpatriot", "link": "https://stackoverflow.com/users/1922663/ruhrpottpatriot"}, "edited": false, "score": 1, "creation_date": 1430163128, "post_id": 29903909, "comment_id": 47931410, "body": "@Ruhrpottpatriot As for the problem with <code>[I, O, O, I]</code> returning <code>Nothing</code>, that&#39;s because it decodes the <code>I</code> and <code>O</code>, then the <code>O</code> and <code>I</code>, then <code>[]</code>, which returns <code>Nothing</code>.  This is actually a mistake on my part (that&#39;s what I get for not running the code first =P), but I think you can turn it into a good exercise.  Consider matching the patterns <code>[]</code>, <code>[_]</code>, <code>[x, y]</code>, and then <code>(x:y:rest)</code>.  Does this give you any ideas on how to fix it?"}, {"owner": {"reputation": 922, "user_id": 1922663, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b62abe78741a1c5c6d2adf8cefe8dace?s=128&d=identicon&r=PG", "display_name": "Ruhrpottpatriot", "link": "https://stackoverflow.com/users/1922663/ruhrpottpatriot"}, "edited": false, "score": 0, "creation_date": 1430163604, "post_id": 29903909, "comment_id": 47931660, "body": "@bheklilr Since if one part of the equation is evalued to <code>Nothing</code> the rest is also nothing, my first thought would be to replace the <code>decode [] = Nothing</code> with <code>decode [] = []</code> and <code>decode [_] = Nothing</code> with <code>decode [_] = Just []</code>. That ensures we don&#39;t get a <code>Nothing</code> back, but rather en empty list which we can concat, since swapping the order of evaluations does not work. However now the result is something along <code>Just [Left False,Right False]</code> and I think I have an error of thought somewhere in that."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 922, "user_id": 1922663, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b62abe78741a1c5c6d2adf8cefe8dace?s=128&d=identicon&r=PG", "display_name": "Ruhrpottpatriot", "link": "https://stackoverflow.com/users/1922663/ruhrpottpatriot"}, "edited": false, "score": 0, "creation_date": 1430163863, "post_id": 29903909, "comment_id": 47931811, "body": "@Ruhrpottpatriot your reasoning is sound (although it should be <code>decode [] = Just []</code>, so maybe you just have a typo in your code or test input somewhere?"}, {"owner": {"reputation": 922, "user_id": 1922663, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b62abe78741a1c5c6d2adf8cefe8dace?s=128&d=identicon&r=PG", "display_name": "Ruhrpottpatriot", "link": "https://stackoverflow.com/users/1922663/ruhrpottpatriot"}, "edited": false, "score": 0, "creation_date": 1430163979, "post_id": 29903909, "comment_id": 47931871, "body": "@bheklilr It&#39;s a typo on SO. My source has <code>decode [] = Just []</code>"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 5, "last_activity_date": 1430161741, "last_edit_date": 1430161741, "creation_date": 1430161358, "answer_id": 29903909, "question_id": 29903846, "link": "https://stackoverflow.com/questions/29903846/haskell-beginner-cannot-match-expected-type/29903909#29903909", "title": "Haskell beginner cannot match expected type", "body": "<p>You need to put a <code>Just</code> before your <code>case</code> statement to convert those values to <code>Maybe [Either Bool Bool]</code> instead of just <code>[Either Bool Bool]</code>:</p>\n\n<pre><code>decode :: [Bit] -&gt; Maybe [Either Bool Bool]\ndecode []   = Nothing\ndecode [x]  = Nothing\ndecode l = if isNothing (decode (tail (tail l)))\n  then Nothing\n  else Just $ case head l of\n    I -&gt; if l!!1 == I\n          then [Left False]  ++ decode (tail (tail l))\n          else [Left True]  ++ decode (tail (tail l))\n    O -&gt; if l!!1 == I\n          then [Right False]  ++ decode (tail (tail l))\n          else [Right True] ++ decode (tail (tail l))\n</code></pre>\n\n<p>But this won't solve all of it.  You also have <code>decode</code> embedded in that computation, and its type is <code>Maybe [Either Bool Bool]</code>, but to use <code>++</code> you need just the <code>[Either Bool Bool]</code> as <code>++</code> only works with lists.  This is where the <code>Maybe</code> monad comes in handy:</p>\n\n<pre><code>decode [] = Nothing\ndecode [x] = Nothing\ndecode (x:y:rest) = do\n    end &lt;- decode rest\n    let this = case (x, y) of\n            (I, I) -&gt; Left False\n            (I, O) -&gt; Left True\n            (O, I) -&gt; Right False\n            (O, O) -&gt; Right True\n    return (this : end)\n</code></pre>\n\n<p>The case statement here is really just a different way of writing your case/nested-ifs.  I also used pattern matching to avoid all the uses of <code>head</code>, <code>!!</code>, and <code>tail</code> since those functions should usually be avoided (they call <code>error</code> instead of doing proper error handling using <code>Maybe</code>).  The <code>&lt;-</code> syntax for <code>Maybe</code> will exit the computation early if <code>Nothing</code> is returned, so <code>end &lt;- decode rest</code> is the same as saying <code>if isNothing (decode rest) then Nothing else &lt;continue&gt;</code>.  Then, instead of building the entire result in each branch of the case/ifs, just compute the single result from <code>x</code> and <code>y</code>, then build the result list at the end.</p>\n"}], "owner": {"reputation": 922, "user_id": 1922663, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b62abe78741a1c5c6d2adf8cefe8dace?s=128&d=identicon&r=PG", "display_name": "Ruhrpottpatriot", "link": "https://stackoverflow.com/users/1922663/ruhrpottpatriot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 613, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1430161741, "creation_date": 1430161112, "question_id": 29903846, "link": "https://stackoverflow.com/questions/29903846/haskell-beginner-cannot-match-expected-type", "title": "Haskell beginner cannot match expected type", "body": "<p>I need to write a program which decodes a list of four values, which can be either I or O into a list of <code>[Either Bool Bool]</code>. I know I have to use maybe, but I simply cannot wrap my head around it. Right now I am totally desperate because I simply cannot solve this problem.</p>\n\n<p>An example input and output might look like this: [I,O,O,I] => [Left True, Right False]</p>\n\n<p>Here is the current code I have:</p>\n\n<pre><code>module Blueprint where\nimport Prelude\nimport Data.Maybe\n\ndata Bit = O | I  deriving (Eq, Show)\n\nencode :: [Either Bool Bool] -&gt; [Bit]\nencode [] = []\nencode l  = case head l of\n            Left  False -&gt; [I, I] ++ encode (tail l)\n            Left  True  -&gt; [I, O] ++ encode (tail l)\n            Right False -&gt; [O, I] ++ encode (tail l)\n            Right True  -&gt; [O, O] ++ encode (tail l)\n\ndecode :: [Bit] -&gt; Maybe [Either Bool Bool]\ndecode []   = Nothing\ndecode [x]  = Nothing\ndecode l = if isNothing (decode (tail (tail l)))\n  then Nothing\n  else case  head l of\n    I -&gt; if l!!1 == I\n          then [Left False]  ++ decode (tail (tail l))\n          else [Left True]  ++ decode (tail (tail l))\n    O -&gt; if l!!1 == I\n          then [Right False]  ++ decode (tail (tail l))\n          else [Right True] ++ decode (tail (tail l))\n</code></pre>\n\n<p>and these are the errors I get:</p>\n\n<pre><code>Prelude&gt; :load serialise\n[1 of 1] Compiling Blueprint        ( serialise.hs, interpreted )\n\nserialise.hs:22:16:\n    Couldn't match expected type `Maybe [Either Bool Bool]'\n                with actual type `[Either Bool b0]'\n    In the expression: [Left False] ++ decode (tail (tail l))\n    In the expression:\n      if l !! 1 == I then\n          [Left False] ++ decode (tail (tail l))\n      else\n          [Left True] ++ decode (tail (tail l))\n    In a case alternative:\n        I -&gt; if l !! 1 == I then\n                 [Left False] ++ decode (tail (tail l))\n             else\n                 [Left True] ++ decode (tail (tail l))\n\nserialise.hs:22:33:\n    Couldn't match expected type `[Either Bool b0]'\n                with actual type `Maybe [Either Bool Bool]'\n    In the second argument of `(++)', namely `decode (tail (tail l))'\n    In the expression: [Left False] ++ decode (tail (tail l))\n\nserialise.hs:23:16:\n    Couldn't match expected type `Maybe [Either Bool Bool]'\n                with actual type `[Either Bool b1]'\n    In the expression: [Left True] ++ decode (tail (tail l))\n    In the expression:\n      if l !! 1 == I then\n          [Left False] ++ decode (tail (tail l))\n      else\n          [Left True] ++ decode (tail (tail l))\n    In a case alternative:\n        I -&gt; if l !! 1 == I then\n                 [Left False] ++ decode (tail (tail l))\n             else\n                 [Left True] ++ decode (tail (tail l))\n\nserialise.hs:23:32:\n    Couldn't match expected type `[Either Bool b1]'\n                with actual type `Maybe [Either Bool Bool]'\n    In the second argument of `(++)', namely `decode (tail (tail l))'\n    In the expression: [Left True] ++ decode (tail (tail l))\n\nserialise.hs:25:16:\n    Couldn't match expected type `Maybe [Either Bool Bool]'\n                with actual type `[Either a0 Bool]'\n    In the expression: [Right False] ++ decode (tail (tail l))\n    In the expression:\n      if l !! 1 == I then\n          [Right False] ++ decode (tail (tail l))\n      else\n          [Right True] ++ decode (tail (tail l))\n    In a case alternative:\n        O -&gt; if l !! 1 == I then\n                 [Right False] ++ decode (tail (tail l))\n             else\n                 [Right True] ++ decode (tail (tail l))\n\nserialise.hs:25:34:\n    Couldn't match expected type `[Either a0 Bool]'\n                with actual type `Maybe [Either Bool Bool]'\n    In the second argument of `(++)', namely `decode (tail (tail l))'\n    In the expression: [Right False] ++ decode (tail (tail l))\n\nserialise.hs:26:16:\n    Couldn't match expected type `Maybe [Either Bool Bool]'\n                with actual type `[Either a1 Bool]'\n    In the expression: [Right True] ++ decode (tail (tail l))\n    In the expression:\n      if l !! 1 == I then\n          [Right False] ++ decode (tail (tail l))\n      else\n          [Right True] ++ decode (tail (tail l))\n    In a case alternative:\n        O -&gt; if l !! 1 == I then\n                 [Right False] ++ decode (tail (tail l))\n             else\n                 [Right True] ++ decode (tail (tail l))\n\nserialise.hs:26:32:\n    Couldn't match expected type `[Either a1 Bool]'\n                with actual type `Maybe [Either Bool Bool]'\n    In the second argument of `(++)', namely `decode (tail (tail l))'\n    In the expression: [Right True] ++ decode (tail (tail l))\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Right now <strong>anything</strong> that helps me solve this problem is welcome. I have tried this for the better part of the day and I simply can't solve it.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 3, "creation_date": 1430159213, "post_id": 29903213, "comment_id": 47929105, "body": "You must store the bound <i>somewhere</i>. If it&#39;s not known compile time, then  it must be present runtime, either as a field of a structure or passed in as an argument to a function."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1430160001, "post_id": 29903213, "comment_id": 47929575, "body": "If I&#39;m understanding, you want to turn a runtime value into a type essentially? So that you would be able to something like <code>newtype WrapInt n = WrapInt Int;   wrapInt :: Int -&gt; Int -&gt; WrapInt n</code>, where <code>n</code> represents the runtime value and then let the other functions act accordingly?"}, {"owner": {"reputation": 1635, "user_id": 2254489, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b9c417017130602fd4561958e6840a2c?s=128&d=identicon&r=PG", "display_name": "Sventimir", "link": "https://stackoverflow.com/users/2254489/sventimir"}, "edited": false, "score": 0, "creation_date": 1430160362, "post_id": 29903213, "comment_id": 47929826, "body": "Yes, that&#39;s exactly what I want."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1430160515, "post_id": 29903213, "comment_id": 47929912, "body": "In haskell, types exist only at compile time. If you have the range available at compile time, you can use a type. If you have it available only at runtime, it needs a runtime representation."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1430160904, "post_id": 29903213, "comment_id": 47930120, "body": "What is your use case for this? Generally, types represent things that are available at compile time and a field in a record represents something that is only available at run time, so I&#39;m wondering why the last bit of code you have in your question isn&#39;t what you&#39;re looking for."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1430162374, "post_id": 29903213, "comment_id": 47930973, "body": "You are looking for <a href=\"http://stackoverflow.com/questions/7209100/a-definition-for-finite-sets-in-agda\">finite sets</a> (see also <a href=\"http://stackoverflow.com/questions/18726164/how-can-finite-numbers-work-dependent-types\">here</a>), probably. I wrote some <a href=\"http://stackoverflow.com/a/27070207/3237465\">explanations</a> a while ago, which involved them."}, {"owner": {"reputation": 1635, "user_id": 2254489, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b9c417017130602fd4561958e6840a2c?s=128&d=identicon&r=PG", "display_name": "Sventimir", "link": "https://stackoverflow.com/users/2254489/sventimir"}, "edited": false, "score": 0, "creation_date": 1430170649, "post_id": 29903213, "comment_id": 47935457, "body": "The use case is simply this: I need an Integer-like type where <code>succ n = 0</code> for some arbitrary value of <code>n</code>, which is unknown at compile time. It would serve as a counter, which I would like to be able to increment fearlessly without checking if I get out of range. I don&#39;t like storing the boundary inside the value, because it&#39;s really a property of a whole type. I understand, though, it can&#39;t be done in Haskell. I&#39;ll have a look at the finite sets thing. Thanks."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1430178392, "post_id": 29903213, "comment_id": 47938167, "body": "Consider that because the type would be created at runtime, there could be more than one of them (different values of n). So logically each wrapped int needs to contain some information identifying which type it&#39;s actually a member of, so that operations on it can use the correct implementation for the type. Isn&#39;t that <code>boundary</code> field basically just such type information? You could make another data type representing the &quot;type&quot;, and have each <code>WrapInt</code> instead store a reference to its &quot;type object&quot;... But what data would <code>WrapIntType</code> contain? Exactly the <code>boundary</code> value!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1430182779, "post_id": 29903213, "comment_id": 47939425, "body": "Does <code>reflection</code> have anything to offer? This sounds a lot like what Oleg et al called the configuration problem."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1430182943, "post_id": 29907579, "comment_id": 47939467, "body": "I can&#39;t help wondering if some kind signatures would make this look a bit less mysterious."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1430184824, "post_id": 29907579, "comment_id": 47939988, "body": "@dfeuer, I used the <code>DataKinds</code>extension, which allows to treat datatypes as kinds, so everything (<code>Bounded</code>, <code>Natty</code> and <code>NATTY</code>) receives a <code>Nat</code>. The <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\" rel=\"nofollow noreferrer\">Hasochism</a> paper describes dependently typed programming in Haskell properly. <b>pigworker</b> also gave great explanations <a href=\"http://stackoverflow.com/questions/28713994/why-is-the-type-system-refusing-my-seemingly-valid-program\">here</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1430196721, "post_id": 29907579, "comment_id": 47943247, "body": "I&#39;m just suggesting that if you add kind signatures to everything in the <code>Nat</code> kind, that might make the code easier to read."}, {"owner": {"reputation": 1635, "user_id": 2254489, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b9c417017130602fd4561958e6840a2c?s=128&d=identicon&r=PG", "display_name": "Sventimir", "link": "https://stackoverflow.com/users/2254489/sventimir"}, "edited": false, "score": 0, "creation_date": 1430200630, "post_id": 29907579, "comment_id": 47944839, "body": "Thank you very much for your broad and detailed answer. But now, that I think of it, what Ben wrote under my initial post is quite right. Storing the boundary at value level is not very nice to my taste, but is a whole lot simpler solution, so I&#39;ll employ it. But this stuff I should analyze anyway just to learn something new. Thanks again."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1430212648, "post_id": 29907579, "comment_id": 47952002, "body": "@dfeuer, OK, I added them."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 1635, "user_id": 2254489, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b9c417017130602fd4561958e6840a2c?s=128&d=identicon&r=PG", "display_name": "Sventimir", "link": "https://stackoverflow.com/users/2254489/sventimir"}, "edited": false, "score": 0, "creation_date": 1430212889, "post_id": 29907579, "comment_id": 47952180, "body": "@Sventimir, you&#39;re welcome. I understand your choice: this solution might be overkill even in a properly typed language. In Haskell you will quickly run in a situation, where you need to use <code>TypeFamilies</code>, enable <code>UndecidableInstances</code> and then guess what GHC can and what not."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 4, "last_activity_date": 1430212179, "last_edit_date": 1495541700, "creation_date": 1430176334, "answer_id": 29907579, "question_id": 29903213, "link": "https://stackoverflow.com/questions/29903213/dynamically-generate-haskell-types-at-runtime/29907579#29907579", "title": "Dynamically generate Haskell types at runtime?", "body": "<p>It's not impossible \u2014 just very ugly. We'll need natural numbers</p>\n\n<pre><code>data Nat = Z | S Nat\n</code></pre>\n\n<p>and bounded natural numbers</p>\n\n<pre><code>data Bounded (n :: Nat) where\n    BZ :: Bounded n\n    BS :: Bounded n -&gt; Bounded (S n)\n</code></pre>\n\n<p>Then your function should be something like</p>\n\n<pre><code>succ :: Bounded n -&gt; Bounded n\nsucc bn = fromMaybe BZ $ go bn where\n    go :: Bounded n -&gt; Maybe (Bounded n)\n    go = ...\n</code></pre>\n\n<p>In <code>go</code> we need to</p>\n\n<ol>\n<li>map <code>BZ</code> to <code>Nothing</code>, if <code>n</code> is <code>Z</code> (i.e. if a <code>Bounded</code> achieved its maximum and has overflowed)</li>\n<li>map <code>BZ</code> to <code>Just (BS BZ)</code>, if <code>n</code> is not <code>Z</code> (i.e. if a <code>Bounded</code> didn't achieve its maximum). </li>\n<li>call <code>go</code> recursively for the <code>BS</code> case.</li>\n</ol>\n\n<p>The problem however is that there is no way to get <code>n</code> at the value level. Haskell is not that dependent. The usual hack is to use <a href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.305.2136\" rel=\"nofollow noreferrer\">singletons</a>. Writing it manually</p>\n\n<pre><code>data Natty (n :: Nat) where\n    Zy :: Natty Z\n    Sy :: Natty n -&gt; Natty (S n)\n\nclass NATTY (n :: Nat) where\n    natty :: Natty n\n\ninstance NATTY Z where\n    natty = Zy\n\ninstance NATTY n =&gt; NATTY (S n) where\n    natty = Sy natty\n</code></pre>\n\n<p>Now we can get a value-level representation of <code>n</code> in the <code>Bounded n</code> in <code>go</code>:</p>\n\n<pre><code>succ :: NATTY n =&gt; Bounded n -&gt; Bounded n\nsucc bn = fromMaybe BZ $ go natty bn where\n    go :: Natty n -&gt; Bounded n -&gt; Maybe (Bounded n)\n    go  Zy      BZ     = Nothing\n    go (Sy ny)  BZ     = Just (BS BZ)\n    go (Sy ny) (BS bn) = BS &lt;$&gt; go ny bn\n</code></pre>\n\n<p>And the <code>NATTY</code> type class is used to infer this value automatically.</p>\n\n<p>Some tests:</p>\n\n<pre><code>instance Eq (Bounded n) where\n    BZ    == BZ    = True\n    BS bn == BS bm = bn == bm\n    _     == _     = False\n\nzero :: Bounded (S (S Z))\nzero = BZ\n\none :: Bounded (S (S Z))\none = BS BZ\n\ntwo :: Bounded (S (S Z))\ntwo = BS (BS BZ)\n\nmain = do\n    print $ succ zero == zero -- False\n    print $ succ zero == one  -- True\n    print $ succ one  == two  -- True\n    print $ succ two  == zero -- True\n</code></pre>\n\n<p>The <a href=\"http://ideone.com/KeVMV9\" rel=\"nofollow noreferrer\">code</a>.</p>\n\n<hr>\n\n<p>Using the <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow noreferrer\">singletons</a> library we can define <code>succ</code> as</p>\n\n<pre><code>$(singletons [d| data Nat = Z | S Nat deriving (Eq, Show) |])\n\ndata Bounded n where\n    BZ :: Bounded n\n    BS :: Bounded n -&gt; Bounded (S n)\n\nsucc :: SingI n =&gt; Bounded n -&gt; Bounded n\nsucc bn = fromMaybe BZ $ go sing bn where\n    go :: Sing n -&gt; Bounded n -&gt; Maybe (Bounded n)\n    go  SZ      BZ     = Nothing\n    go (SS ny)  BZ     = Just (BS BZ)\n    go (SS ny) (BS bn) = BS &lt;$&gt; go ny bn\n</code></pre>\n\n<hr>\n\n<p>As to lifting runtime stuff to the type level, there are two approaches: <a href=\"https://stackoverflow.com/questions/27029564/how-do-i-build-a-list-with-a-dependently-typed-length/27070207#27070207\">CPS</a> and <a href=\"https://stackoverflow.com/a/13246864/3237465\">existential types</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 1635, "user_id": 2254489, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b9c417017130602fd4561958e6840a2c?s=128&d=identicon&r=PG", "display_name": "Sventimir", "link": "https://stackoverflow.com/users/2254489/sventimir"}, "edited": false, "score": 0, "creation_date": 1430288597, "post_id": 29929718, "comment_id": 47993449, "body": "That&#39;s exactly what I was looking for. Thanks!"}, {"owner": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "edited": false, "score": 0, "creation_date": 1564697819, "post_id": 29929718, "comment_id": 101126681, "body": "<code>reify (a :: k)</code> is a lot of magic, wow! First of all, behind the scene&#39;s it is implemented using <code>unsafeCoerce</code> - and I don&#39;t see another way. The idea of the implementation is that to fulfill the claim we would have to know some type <code>s</code> such that <code>reflect (Proxy :: Proxy s) = a</code>. Of course, this is impossible. But it such an s would exist, we can find a runtime representation of <code>Reifies s k</code> - which is after all simply <code>proxy s -&gt; k</code>. <code>const a</code> fits the bill and is unsafeCoerced into place. And since <code>s</code> is existentially quantified it doesn&#39;t matter, can not escape, compare <code>ST s</code>."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 8, "last_activity_date": 1430254432, "last_edit_date": 1495541312, "creation_date": 1430254432, "answer_id": 29929718, "question_id": 29903213, "link": "https://stackoverflow.com/questions/29903213/dynamically-generate-haskell-types-at-runtime/29929718#29929718", "title": "Dynamically generate Haskell types at runtime?", "body": "<p>The <a href=\"http://hackage.haskell.org/package/reflection-1.5.1.2\" rel=\"nofollow noreferrer\"><code>reflection</code></a> package lets you generate new \"local\" instances of a typeclass at runtime.</p>\n\n<p>For example, suppose we have the following typeclass of values that can \"wrap around\":</p>\n\n<pre><code>{-# LANGUAGE Rank2Types, FlexibleContexts, UndecidableInstances #-}\n\nimport Data.Reflection\nimport Data.Proxy\n\nclass Wrappy w where\n   succWrappy :: w -&gt; w\n</code></pre>\n\n<p>We define this newtype that carries a phantom type parameter:</p>\n\n<pre><code>data WrapInt s = WrapInt { getValue :: Int } deriving Show\n</code></pre>\n\n<p>An make it an instance of <code>Wrappy</code>:</p>\n\n<pre><code>instance Reifies s Int =&gt; Wrappy (WrapInt s) where\n    succWrappy w@(WrapInt i) = \n        let bound = reflect w \n        in\n        if i == bound\n            then WrapInt 0\n            else WrapInt (succ i)\n</code></pre>\n\n<p>The interesting part is the <code>Reifies s Int</code> constraint. It means: \"the phantom type <code>s</code> represents a value of type <code>Int</code> at the type level\". Users never define an instance for <code>Reifies</code>, this is done by the internal machinery of the <code>reflection</code> package.</p>\n\n<p>So, <code>Reifies s Int =&gt; Wrappy (WrapInt s)</code> means: \"whenever <code>s</code> represent a value of type <code>Int</code>, we can make <code>WrapInt s</code> an instance of <code>Wrappy</code>\".</p>\n\n<p>The <a href=\"http://hackage.haskell.org/package/reflection-1.5.1.2/docs/Data-Reflection.html#v:reflect\" rel=\"nofollow noreferrer\"><code>reflect</code></a> function takes a proxy value that matches the phantom type and brings back an actual <code>Int</code> value, which is used when implementing the <code>Wrappy</code> instance.</p>\n\n<p>To actually \"assign\" a value to the phantom type, we use <a href=\"http://hackage.haskell.org/package/reflection-1.5.1.2/docs/Data-Reflection.html#v:reify\" rel=\"nofollow noreferrer\">reify</a>:</p>\n\n<pre><code>-- Auxiliary function to convice the compiler that\n-- the phantom type in WrapInt is the same as the one in the proxy\nlikeProxy :: Proxy s -&gt; WrapInt s -&gt; WrapInt s\nlikeProxy _ = id\n\nmain :: IO ()\nmain = print $ reify 5 $ \\proxy -&gt; \n    getValue $ succWrappy (likeProxy proxy (WrapInt 5))\n</code></pre>\n\n<p>Notice that the signature of <code>reify</code> forbids the phantom type from escaping the callback, that's why we must unwrap the result with <code>getValue</code>.</p>\n\n<p>See more examples in <a href=\"https://stackoverflow.com/questions/28649854/function-from-mappend-function-to-monoid-instance/28651952#28651952\">this</a> answer, on in the <a href=\"https://github.com/ekmett/reflection/tree/master/examples\" rel=\"nofollow noreferrer\">reflection GitHub repo</a>.</p>\n"}], "owner": {"reputation": 1635, "user_id": 2254489, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b9c417017130602fd4561958e6840a2c?s=128&d=identicon&r=PG", "display_name": "Sventimir", "link": "https://stackoverflow.com/users/2254489/sventimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1563, "favorite_count": 0, "accepted_answer_id": 29929718, "answer_count": 2, "score": 7, "last_activity_date": 1430254432, "creation_date": 1430158964, "question_id": 29903213, "link": "https://stackoverflow.com/questions/29903213/dynamically-generate-haskell-types-at-runtime", "title": "Dynamically generate Haskell types at runtime?", "body": "<p>Can one define a Haskell type at runtime from a given template? Here's what I mean by this. Suppose I need an integer type that is restricted to some range (unknown precisely at compile time). I also want a feature that:</p>\n\n<pre><code>succ 0 = 1\nsucc 1 = 2\n...\nsucc n = 0\n</code></pre>\n\n<p><code>n</code> being unknown at compile time. I could do something like this:</p>\n\n<pre><code>data WrapInt = WrapInt {\n        value       :: Int,\n        boundary    :: Int\n}\n\nwrapInt :: Int -&gt; Int -&gt; WrapInt\nwrapInt boundary value = WrapInt value boundary\n</code></pre>\n\n<p>Now what I would like to have is to preserve the <code>wrapInt</code> function as it is, but to avoid storing the boundary as a value inside WrapInt type. Instead I would like it to be stored somehow in type definition, which of course means that the type would have to be defined dynamically at runtime.</p>\n\n<p>Is it possible to achieve this in Haskell?</p>\n"}, {"tags": ["haskell", "yesod", "persistent", "esqueleto"], "comments": [{"owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 0, "creation_date": 1430233177, "post_id": 29901261, "comment_id": 47967327, "body": "Your question seems quite similar to <a href=\"http://stackoverflow.com/questions/21686579/haskell-persistent-joins-with-esqueleto\" title=\"haskell persistent joins with esqueleto\">stackoverflow.com/questions/21686579/&hellip;</a>, but I don&#39;t think you&#39;ll like the answers (-:"}, {"owner": {"reputation": 440, "user_id": 2705125, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e25bc1b870c32ecc4381c14000e90342?s=128&d=identicon&r=PG&f=1", "display_name": "cschneid", "link": "https://stackoverflow.com/users/2705125/cschneid"}, "reply_to_user": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 0, "creation_date": 1430236602, "post_id": 29901261, "comment_id": 47969992, "body": "I wouldn&#39;t mind doing this manually, except it seems to grow in complexity very quickly.  A 3 table join here is 7 lines of query and 80 lines of deserialization.  There must be a better way to handle this."}, {"owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 0, "creation_date": 1430236775, "post_id": 29901261, "comment_id": 47970124, "body": "I think you should only have deserialization code for the attributes, and obtain a Meal without Recipes, a Recipe without Food in tuples: (Meal,Recipe,Food) then group all the result in one method, it&#39;d be much simpler."}, {"owner": {"reputation": 440, "user_id": 2705125, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e25bc1b870c32ecc4381c14000e90342?s=128&d=identicon&r=PG&f=1", "display_name": "cschneid", "link": "https://stackoverflow.com/users/2705125/cschneid"}, "reply_to_user": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 0, "creation_date": 1430237027, "post_id": 29901261, "comment_id": 47970318, "body": "Sorry? I don&#39;t follow.  The issue is that the <code>(Meal</code> part of the tuple is repeated, once per unique recipe/food. So most of the <code>groupBy</code> junk is fixing that up.  Is there a nicer approach to it?"}, {"owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 0, "creation_date": 1430240426, "post_id": 29901261, "comment_id": 47972675, "body": "I was just thinking that you&#39;re conflating deserializing from the DB and grouping results. It may be easier to have basic functions to convert from Entity DbMeal to Meal, etc., and then have a function that perform the grouping without any DB ([(Meal,Recipe,Food)]-&gt;[Meal]. You may be able to abstract more and reduce the amount of boilerplate."}], "answers": [{"tags": [], "owner": {"reputation": 440, "user_id": 2705125, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e25bc1b870c32ecc4381c14000e90342?s=128&d=identicon&r=PG&f=1", "display_name": "cschneid", "link": "https://stackoverflow.com/users/2705125/cschneid"}, "is_accepted": true, "score": 1, "last_activity_date": 1430796816, "creation_date": 1430796816, "answer_id": 30043822, "question_id": 29901261, "link": "https://stackoverflow.com/questions/29901261/simplifying-persistent-esqueleto-code/30043822#30043822", "title": "Simplifying Persistent &amp; Esqueleto code", "body": "<p>Thanks to @JPMoresmau's hinting, I ended up with a much shorter, and I think simpler approach.  It may be slower on large datasets due to <code>nub</code>, but on small datasets it returns far faster than I need it to.</p>\n\n<p>I still hate that I have so much manual plumbing to build a tree structure out of the data coming back from the database. I wonder if there's a good way to do this generically?</p>\n\n<pre><code>module Grocery.Database.Calendar where\n\nimport Grocery.DatabaseSchema\nimport Grocery.Types.Meal\nimport Grocery.Types.Recipe\nimport Grocery.Types.Food\nimport Database.Persist\nimport Database.Persist.Sqlite\nimport qualified Database.Esqueleto      as E\nimport           Database.Esqueleto      ((^.), (?.))\nimport Data.Time\nimport Control.Monad.Trans -- for MonadIO\nimport Data.List\nimport Data.Maybe\nimport Data.Tuple3\n\ngetMeals :: (MonadIO m) =&gt; Key DbUser -&gt; SqlPersistT m [Meal]\ngetMeals user =\n  fmap deserializeDb $ E.select $\n        E.from $ \\(m `E.InnerJoin` u `E.LeftOuterJoin` r `E.LeftOuterJoin` f) -&gt; do\n          E.on     (r ?. DbRecipeId E.==. f ?. DbFoodRecipeId)\n          E.on     (E.just (m ^. DbMealId) E.==. r ?. DbRecipeMealId)\n          E.on     (m ^. DbMealUserId      E.==. u ^. DbUserId)\n          E.where_ (m ^. DbMealUserId      E.==. E.val user )\n          return (m, r, f)\n\ndeserializeDb :: [(Entity DbMeal, Maybe (Entity DbRecipe), Maybe (Entity DbFood))] -&gt; [Meal]\ndeserializeDb results = makeMeals results\n  where\n    makeMeals :: [(Entity DbMeal, Maybe (Entity DbRecipe), Maybe (Entity DbFood))] -&gt; [Meal]\n    makeMeals dupedMeals = map makeMeal (nub $ map fst3 dupedMeals)\n\n    makeMeal :: Entity DbMeal -&gt; Meal\n    makeMeal (Entity k m) = let d = dbMealDay m\n                                n = dbMealName m\n                                r = makeRecipesForMeal k\n                            in  Meal Nothing (utctDay d) n r\n\n    makeRecipesForMeal :: Key DbMeal -&gt; [Recipe]\n    makeRecipesForMeal mealKey = map makeRecipe $ appropriateRecipes mealKey\n\n    appropriateRecipes :: Key DbMeal -&gt; [Entity DbRecipe]\n    appropriateRecipes mealKey = nub $ filter (\\(Entity _ v) -&gt; dbRecipeMealId v == mealKey) $ mapMaybe snd3 results\n\n    makeRecipe :: Entity DbRecipe -&gt; Recipe\n    makeRecipe (Entity k r) = let n = dbRecipeName r\n                                  f = makeFoodForRecipe k\n                              in  Recipe Nothing n f\n\n    makeFoodForRecipe :: Key DbRecipe -&gt; [Food]\n    makeFoodForRecipe rKey = map makeFood $ appropriateFoods rKey\n\n    appropriateFoods :: Key DbRecipe -&gt; [Entity DbFood]\n    appropriateFoods rKey = nub $ filter (\\(Entity _ v) -&gt; dbFoodRecipeId v == rKey) $ mapMaybe thd3 results\n\n    makeFood :: Entity DbFood -&gt; Food\n    makeFood (Entity _ f) = Food (dbFoodName f)\n</code></pre>\n"}], "owner": {"reputation": 440, "user_id": 2705125, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e25bc1b870c32ecc4381c14000e90342?s=128&d=identicon&r=PG&f=1", "display_name": "cschneid", "link": "https://stackoverflow.com/users/2705125/cschneid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 426, "favorite_count": 0, "accepted_answer_id": 30043822, "answer_count": 1, "score": 0, "last_activity_date": 1432319058, "creation_date": 1430152330, "last_edit_date": 1432319058, "question_id": 29901261, "link": "https://stackoverflow.com/questions/29901261/simplifying-persistent-esqueleto-code", "title": "Simplifying Persistent &amp; Esqueleto code", "body": "<p>I have a fairly simple query that does two outer joins.  (A meal has many recipes which in turn have many foods).</p>\n\n<pre><code>getMeals :: (MonadIO m) =&gt; Key DbUser -&gt; SqlPersistT m [Meal]\ngetMeals user =\n  fmap deserializeDb $ E.select $\n        E.from $ \\(m `E.InnerJoin` u `E.LeftOuterJoin` r `E.LeftOuterJoin` f) -&gt; do\n          E.on     (r ?. DbRecipeId E.==. f ?. DbFoodRecipeId)\n          E.on     (E.just (m ^. DbMealId) E.==. r ?. DbRecipeMealId)\n          E.on     (m ^. DbMealUserId      E.==. u ^. DbUserId)\n          E.where_ (m ^. DbMealUserId      E.==. E.val user )\n          return (m, r, f)\n</code></pre>\n\n<p>This query is great, it says what it needs, without anything more.  But, because of how SQL works, it gives me back a table with lots of repeated meals, for each outer join that matched.</p>\n\n<p>For instance, a meal with two recipes, each with two foods turns into 4 tuples.</p>\n\n<pre><code>(m1, r1, f1)\n(m1, r1, f2)\n(m1, r2, f3)\n(m1, r2, f4)\n</code></pre>\n\n<p>I want to roll these back up into a single <code>Meal</code> data type. (simplified here to show structure, other fields of course are stored in the DB).</p>\n\n<pre><code>data Meal   = Meal   { recipes :: [Recipe] }\ndata Recipe = Recipe { foods :: [Food]   }\ndata Food   = Food   { name :: String }\n</code></pre>\n\n<p>I seem to have to do this merging entirely manually, and it ended up being 2 or so pages of code for this single query.</p>\n\n<p>Ignoring the fact that typeclasses aren't supposed to be used like this, it looks like a lot of instances of a (silly) typeclass <code>DeserializeDb</code>:</p>\n\n<pre><code>class DeserializeDb a r | a -&gt; r where\n  deserializeDb :: a -&gt; r\n\ninstance DeserializeDb [(Entity DbMeal, Maybe (Entity DbRecipe))] [Meal] where\n  deserializeDb items = let grouped = groupBy (\\a b -&gt; entityKey (fst a) == entityKey (fst b)) items\n                            joined  = map (\\list -&gt; ( (fst . head) list\n                                                    ,  mapMaybe snd list\n                                                    )) grouped\n                        in (map deserializeDb joined)\n</code></pre>\n\n<p>SNIPPED LOTS OF INSTANCES OF VARIOUS COMPLEXITY (code: <a href=\"https://gist.github.com/cschneid/2989057ec4bb9875e2ae\" rel=\"nofollow\">https://gist.github.com/cschneid/2989057ec4bb9875e2ae</a>) </p>\n\n<pre><code>instance DeserializeDb (Entity DbFood) Food where\n  deserializeDb (Entity _ val) = Food (dbFoodName val)\n</code></pre>\n\n<h3>Question:</h3>\n\n<p>The only thing I want to expose is the query signature. The rest of this is implementation junk.  Is there a trick to using Persistent that I've not noticed?  Do I have to manually merge joins back into haskell types?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1430155708, "post_id": 29901094, "comment_id": 47927123, "body": "Does that <code>MonadWeblog</code> help you though?  It seems like you want a generic version of <code>runXHere</code>; you might make a class which includes as methods whatever assumptions you need to implement <code>runXHere</code>.  It&#39;s not so unreasonable to have to implement this for each monad, though. Every monad usually comes with an eliminator into regular Haskell values, which you have to write. It is no crime for your eliminators to go into <code>AppM</code> instead."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1430155899, "post_id": 29901094, "comment_id": 47927227, "body": "Oh I think I see where you were going with the class.  Are all your monads going to be <code>ReaderT r (ErrorT e IO)</code>?  You might consider abstracting that as say <code>GenApp r e a</code>, basing all your monads on this, then writing combinators such as <code>embed :: (r&#39; -&gt; r) -&gt; (e -&gt; e&#39;) -&gt; GenApp r e a -&gt; GenApp r&#39; e&#39; a</code>, which makes <code>runXHere</code> trivial."}, {"owner": {"reputation": 2207, "user_id": 575152, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5e0170ce985a52a6af02b95baa38e1ae?s=128&d=identicon&r=PG", "display_name": "Savanni D&#39;Gerinel", "link": "https://stackoverflow.com/users/575152/savanni-dgerinel"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1430156942, "post_id": 29901094, "comment_id": 47927816, "body": "Yes to both questions.  I forget what exactly <code>WeblogM</code> is, but <code>runWeblog</code> returns <code>IO (Either WeblogError a)</code>.  The contract for each of my domains is that I can run it to get <code>IO (Either error a)</code>.  And that may be the key point for me to abstract things better."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 3, "last_activity_date": 1430249649, "last_edit_date": 1430249649, "creation_date": 1430164969, "answer_id": 29904924, "question_id": 29901094, "link": "https://stackoverflow.com/questions/29901094/what-is-a-clean-way-to-handle-one-monad-calling-into-another/29904924#29904924", "title": "What is a clean way to handle one monad calling into another?", "body": "<p>If we ignore the newtypes, and convert both error transformers to <code>ExceptT</code>, the two monads stacks share a similar structure:</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Trans.Except (ExceptT, catchE)\nimport Control.Monad.Trans.Reader\n\ntype M env err r = ReaderT env (ExceptT err IO) r\n</code></pre>\n\n<p>Using the <a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Reader.html#v:withReaderT\" rel=\"nofollow\"><code>withReaderT</code></a> and <a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Reader.html#v:mapReaderT\" rel=\"nofollow\"><code>mapReaderT</code></a> functions, we we can define:</p>\n\n<pre><code>changeMonad :: (env' -&gt; env) \n            -&gt; (err -&gt; ExceptT err' IO r) \n            -&gt; M env err r \n            -&gt; M env' err' r \nchangeMonad envLens handler = withReaderT envLens . mapReaderT (flip catchE handler)  \n</code></pre>\n\n<p><strong>Edit:</strong> To ease the wrapping and unwrapping of the newtypes, we can make them instances of <a href=\"http://hackage.haskell.org/package/lens-4.9.1/docs/Control-Lens-Wrapped.html#g:1\" rel=\"nofollow\"><code>Wrapped</code></a> from the <code>lens</code> library, and define a more general conversion function:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nnewtype N1 r = N1 { getN1 :: M (Int,Int) String r }\n\n$(makeWrapped ''N1)\n\n--instance Wrapped (N1 r) where\n--  type Unwrapped (N1 r) = M (Int,Int) String r \n--  _Wrapped' = iso getN1 N1\n\nnewtype N2 r = N2 { getN2 :: M Int Char r }\n\n$(makeWrapped ''N2)\n\nchangeMonad' :: (Wrapped (n1 r), \n                 Unwrapped (n1 r) ~ M env' err' r, \n                 Wrapped (n2 r), \n                 Unwrapped (n2 r) ~ M env err r) \n             =&gt; (env' -&gt; env)\n             -&gt; (err -&gt; ExceptT err' IO r) \n             -&gt; n2 r \n             -&gt; n1 r  \nchangeMonad' envLens handler = \n     view _Unwrapped' . changeMonad envLens handler . view _Wrapped'\n\nchangeN2N1 :: N2 r -&gt; N1 r\nchangeN2N1 = changeMonad' fst (\\c -&gt; throwE [c]) \n</code></pre>\n\n<p><code>Wrapped</code> is a typeclass that says: \"I'm actually a newtype, here's a generic way to add/remove the newtype constructor\".</p>\n\n<p>If the <code>lens</code> dependency is too heavy, the <a href=\"http://hackage.haskell.org/package/newtype\" rel=\"nofollow\"><code>newtype</code></a> package provides similar functionality.</p>\n"}], "owner": {"reputation": 2207, "user_id": 575152, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5e0170ce985a52a6af02b95baa38e1ae?s=128&d=identicon&r=PG", "display_name": "Savanni D&#39;Gerinel", "link": "https://stackoverflow.com/users/575152/savanni-dgerinel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "accepted_answer_id": 29904924, "answer_count": 1, "score": 7, "last_activity_date": 1430249649, "creation_date": 1430151762, "question_id": 29901094, "link": "https://stackoverflow.com/questions/29901094/what-is-a-clean-way-to-handle-one-monad-calling-into-another", "title": "What is a clean way to handle one monad calling into another?", "body": "<p>Here is an issue of gluing together monads.  Not in a stack form, but in a form of needing to unwrap one monad to run the operation inside another.</p>\n\n<p>Two domains: Weblog and App.  But, keep in mind that the App domain will be calling into additional ones in the same way that it currently calls in to Weblog.  Both have their own monad stacks.  Both keep track of their own state.</p>\n\n<pre><code>newtype WeblogM a = WeblogM (ReaderT Weblog (ErrorT WeblogError IO) a)\n    deriving (Monad, MonadIO, Reader.MonadReader Weblog, Error.MonadError WeblogError)\n\nnewtype AppM a = AppM (ReaderT App (EitherT AppError IO) a)\n    deriving ( Functor, Applicative, Monad\n             , MonadReader App, MonadError AppError)\n</code></pre>\n\n<p>In order to run a <code>WeblogM</code> operation inside of an <code>AppM</code> function, I'm finding that I have to unwrap the <code>WeblogM</code> and rewrap it, using functions like this:</p>\n\n<pre><code>runWeblogHere :: forall a. Weblog.Weblog -&gt; Weblog.WeblogM a -&gt; AppM a\nrunWeblogHere weblog action =\n    runIO (left . WeblogError) (Weblog.runWeblog weblog action)\n\nrunIO :: (e -&gt; EitherT AppError IO a) -&gt; IO (Either e a) -&gt; AppM a\nrunIO handler = AppM . lift . handleT handler . EitherT\n</code></pre>\n\n<p>However, that does leave my actual passthrough operations quite simple:</p>\n\n<pre><code>getPage :: Weblog.PageId -&gt; AppM Weblog.WikiPage\ngetPage pageid = do\n    App{weblog} &lt;- ask\n    runWeblogHere weblog $ Weblog.getWikiPage pageid\n</code></pre>\n\n<p>This bothers me already because I have other monadic libraries that I already know that I'm going to plug in to the <code>AppM</code> architecture, and I'm worried about writing a <code>runXHere</code> method, which is really boilerplate, for each one of them.</p>\n\n<p>I have a suggestion to create a <code>MonadWeblog</code> class to correspond to <code>WeblogM</code>, in much the same way that <code>MonadReader</code> corresponds to <code>ReaderT</code>.  That appeals to me more because I can start isolating the monad glue into my instance of <code>MonadWeblog</code> (or, really, <code>MonadX</code>).</p>\n"}, {"tags": ["haskell", "recursion", "binary", "calculator"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1430149603, "post_id": 29900108, "comment_id": 47923198, "body": "What are you imagining the types of these functions to be?  Are you wanting to turn an <code>Int</code> into its binary representation as a <code>String</code>?  An <code>Int</code> is an <code>Int</code> to a computer regardless of what base you are concerned with.  Decimal, binary, etc are just ways of representing a number as a sequence of characters, it&#39;s not how a computer actually stores the number."}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430149872, "post_id": 29900108, "comment_id": 47923371, "body": "yeah actually thats my question, for example &#39;21&#39; -&gt; 10101 ... so I have to work with strings?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430149963, "post_id": 29900108, "comment_id": 47923435, "body": "You will need to work with strings or some other ordered sequence type.  Since strings are just lists of <code>Char</code>s (literally <code>type String = [Char]</code>) that&#39;s the easiest to work with."}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430150508, "post_id": 29900108, "comment_id": 47923835, "body": "so i return a string, which means i need to put the result in the string..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430150752, "post_id": 29900108, "comment_id": 47924013, "body": "to you want a full spoiler or just a hint? A possible hint would be to go and look at <code>quotRem</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430150877, "post_id": 29900108, "comment_id": 47924099, "body": "also you probably want to use <code>++</code> or <code>:</code> instead of <code>&amp;&amp;</code> ;)"}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "edited": false, "score": 0, "creation_date": 1430151397, "post_id": 29900108, "comment_id": 47924466, "body": "where is the difference, i thought i could link with &amp;&amp; operations"}], "answers": [{"tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": false, "score": 0, "last_activity_date": 1430149292, "creation_date": 1430149292, "answer_id": 29900187, "question_id": 29900108, "link": "https://stackoverflow.com/questions/29900108/haskell-binary-calculator-recursion-and-return-values/29900187#29900187", "title": "haskell: binary calculator recursion and return values?", "body": "<p>binary, decimal, hexadecimal etc. are representation systems for numbers. They only matter when you deal with strings containing numbers, not when you deal with numbers on the programming language level.</p>\n"}, {"comments": [{"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "edited": false, "score": 0, "creation_date": 1430151355, "post_id": 29900811, "comment_id": 47924434, "body": "well how does those &quot;|&quot; work and &quot;otherwise&quot; ? and if i want to divide my variable i guess i have to chose x<code>div</code>2 over x/2 right?"}, {"owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "reply_to_user": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "edited": false, "score": 0, "creation_date": 1430151441, "post_id": 29900811, "comment_id": 47924494, "body": "Those are guards, please have a look here for example <a href=\"https://en.wikibooks.org/wiki/Haskell/Control_structures\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/Control_structures</a>"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430151463, "post_id": 29900811, "comment_id": 47924505, "body": "The <code>|</code> and <code>otherwise</code> are showing how to use <a href=\"http://learnyouahaskell.com/syntax-in-functions#guards-guards\" rel=\"nofollow noreferrer\">guards</a>, which basically turn into big if-then-else statements.  So it&#39;d be equivalent to <code>if x &gt; 0 then binary x else []</code> and <code>if x `mod` 2 &gt; 0 = binary2 .. ++ [1] else binary2 ... [0]</code>."}, {"owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "edited": false, "score": 0, "creation_date": 1430151520, "post_id": 29900811, "comment_id": 47924540, "body": "The difference between <code>div</code> and <code>(&#47;)</code> is that the former is for Integral and the latter for Fractional."}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "edited": false, "score": 0, "creation_date": 1430151567, "post_id": 29900811, "comment_id": 47924567, "body": "alright, but one benefit might be i can skip &quot;if then else&quot; with those guards right?"}, {"owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "edited": false, "score": 0, "creation_date": 1430151621, "post_id": 29900811, "comment_id": 47924603, "body": "Yes, if-then-else is not very haskell and only preferred in e.g. anonymous functions or something where guards don&#39;t fit very well."}], "tags": [], "owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "is_accepted": true, "score": 1, "last_activity_date": 1430150989, "creation_date": 1430150989, "answer_id": 29900811, "question_id": 29900108, "link": "https://stackoverflow.com/questions/29900108/haskell-binary-calculator-recursion-and-return-values/29900811#29900811", "title": "haskell: binary calculator recursion and return values?", "body": "<p>Something like</p>\n\n<pre><code>binary2 :: Int -&gt; [Int]\nbinary2 x\n  | x &gt; 0 = binary x\n  | otherwise = []\n\n\nbinary :: Int -&gt; [Int]\nbinary x\n  | x `mod` 2 &gt; 0 = binary2 (x `div` 2) ++ [1]\n  | otherwise     = binary2 (x `div` 2) ++ [0]\n</code></pre>\n\n<p>So I'd just choose a list of Ints.</p>\n"}], "owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 0, "accepted_answer_id": 29900811, "answer_count": 2, "score": 0, "last_activity_date": 1430158928, "creation_date": 1430149054, "last_edit_date": 1430158928, "question_id": 29900108, "link": "https://stackoverflow.com/questions/29900108/haskell-binary-calculator-recursion-and-return-values", "title": "haskell: binary calculator recursion and return values?", "body": "<p>I wanted to change decimal numbers into binary numbers per recursion and if else!</p>\n\n<pre><code>binary2 x =\n   if x &gt; 0\n       then binary x\n       else 999\n\nbinary x =\n    if x `mod` 2 &gt; 0\n      then 1 &amp;&amp; binary2 (x/2)\n      else 0 &amp;&amp; binary2 (x/2)\n</code></pre>\n\n<p>well returning <code>0</code> or <code>1</code> in combination with boolean does not work, I want to return whether <code>0</code> or <code>1</code> and then referate again to the function but with half the value as before until <code>x &lt; 1</code>! Therefore <code>x/2</code>...</p>\n"}, {"tags": ["haskell", "recursion", "lazy-evaluation"], "comments": [{"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 2, "creation_date": 1430146444, "post_id": 29898999, "comment_id": 47920928, "body": "If you take the question literally, the correct definition is of course <code>xs = [0..]</code>, since the sum of the squares of all entries before the first is 0, and therefore so is every subsequent sum."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1430146467, "post_id": 29898999, "comment_id": 47920946, "body": "Un related to your question, but you could have written <code>let xs = 1 : [sum (map (^2) ys) | ys &lt;- tail (inits s)]</code> instead."}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1430146882, "post_id": 29898999, "comment_id": 47921243, "body": "@augustss I was looking for something like that but didn&#39;t think about it. That is much cleaner!"}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "reply_to_user": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1430146899, "post_id": 29898999, "comment_id": 47921252, "body": "@SebastianRedl I guess that depends on whether or not you consider 0 to be a natural number..."}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1430146930, "post_id": 29898999, "comment_id": 47921268, "body": "@kqr I don&#39;t see natural numbers mentioned in the question."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 1, "creation_date": 1430147155, "post_id": 29898999, "comment_id": 47921411, "body": "@SebastianRedl: you mean <code>[0,0..]</code> (or <code>repeat 0</code>)."}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1430147185, "post_id": 29898999, "comment_id": 47921431, "body": "@leftaroundabout You&#39;re right. Brain fart."}, {"owner": {"reputation": 133729, "user_id": 98117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4704a2a1d16b276070962ee01fb6149f?s=128&d=identicon&r=PG", "display_name": "hammar", "link": "https://stackoverflow.com/users/98117/hammar"}, "edited": false, "score": 5, "creation_date": 1430147504, "post_id": 29898999, "comment_id": 47921638, "body": "Another alternative: <code>xs = 1 : scanl1 (+) (map (^2) xs)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 0, "creation_date": 1430212000, "post_id": 29899920, "comment_id": 47951579, "body": "Thanks. Viewing <code>tail (inits xs)</code> as the infinite list of increasing <code>take</code>s was inventive and actually helpful to fundamentally understand what the code does. I still have a hard time linking it to the actual execution of the Haskell machine, but I guess that&#39;s where Sebastians answer is a nice complement. Thanks for the answer!"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "reply_to_user": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 0, "creation_date": 1430212653, "post_id": 29899920, "comment_id": 47952006, "body": "@kqr One thing I&#39;ve learned about the actual execution of Haskell is that thinking about it very hard doesn&#39;t help that much ;-)  <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/slpj-book-1987/PAGES/III.HTM\" rel=\"nofollow noreferrer\">The Implementation of Functional Programming Languages</a> [Peyton-Jones et al] is available online if you want to dig really deep. It&#39;s very readable."}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 0, "creation_date": 1430213386, "post_id": 29899920, "comment_id": 47952507, "body": "So true! In some cases my curiosity wins, though... And ach, That book is expensive for someone who prefers the dead-tree format. :("}], "tags": [], "owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "is_accepted": false, "score": 3, "last_activity_date": 1430148607, "creation_date": 1430148607, "answer_id": 29899920, "question_id": 29898999, "link": "https://stackoverflow.com/questions/29898999/how-does-this-list-comprehension-over-the-inits-of-itself-work/29899920#29899920", "title": "How does this list comprehension over the inits of itself work?", "body": "<p>OK, I'll try.</p>\n\n<p>(I'm not sure what \"intermediate\" level you're looking for, so I'll explain this to myself in the hope that it's not too \"sub-intermediate\".)</p>\n\n<p><code>sum (map (^2) ys)</code> is easy: the sum of squares of a list.</p>\n\n<p>The generator is also easy: <code>y</code> takes on all the non-empty initial sequences of <code>xs</code>, i.e. (abusing notation a little) <code>y &lt;- [take 1 xs, take 2 xs, take 3 xs,...]</code>.</p>\n\n<p>(I'll keep the <code>take</code> notation in the following, as I think it's pretty clear. It's most likely not what happens internally in your shiny Haskell machine.)</p>\n\n<p>The only tricky thing is combining them, as <code>xs</code> is the value we're defining.<br>\nThis is not a huge problem, because we know the first element of <code>xs</code> - it's <code>1</code>.<br>\nIt's not much, but it's everything that's needed to get the ball rolling with <code>take 1 xs</code>.</p>\n\n<p>Handwaving a bit more, <code>xs</code> is </p>\n\n<pre><code>1 : (sum (map (^2) (take 1 xs))) : (sum (map (^2) (take 2 xs))) : ...\n</code></pre>\n\n<p>that is (because we know that the first element is <code>1</code>):</p>\n\n<pre><code>xs = 1 : (sum (map (^2) [1])) : (sum (map (^2) (take 2 xs))) : ...\n\nxs = 1 : 1 : (sum (map (^2) (take 2 xs))) : (sum (map (^2) (take 3 xs))) : ...\n</code></pre>\n\n<p>where we have the second element, and we can continue:</p>\n\n<pre><code>xs = 1 : 1 : (sum (map (^2) [1,1])) : (sum (map (^2) (take 3 xs))) : ...\n\nxs = 1 : 1 : 2 : (sum (map (^2) (take 3 xs))) : (sum (map (^2) (take 4 xs))) : ...\n\nxs = 1 : 1 : 2 : (sum (map (^2) [1,1,2])) : (sum (map (^2) (take 4 xs))) : ...\n</code></pre>\n\n<p>and so on.</p>\n\n<p>The reason this works at all is that every element in the list only depends on the previous elements - you can always rely on the past to tell you what's happened; the future is less reliable.  </p>\n"}, {"comments": [{"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 0, "creation_date": 1430211846, "post_id": 29900144, "comment_id": 47951469, "body": "Thanks a tonne. I&#39;ve read this a couple of times since yesterday and it&#39;s starting to make sense. No flash insight yet, but understanding creeps up on me slowly. I think I might have to re-do your work but with a pen and paper for myself, and really think of the evaluation order and sharing that happens. Thanks for a lengthy and thorough exposition."}], "tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": true, "score": 5, "last_activity_date": 1430149173, "creation_date": 1430149173, "answer_id": 29900144, "question_id": 29898999, "link": "https://stackoverflow.com/questions/29898999/how-does-this-list-comprehension-over-the-inits-of-itself-work/29900144#29900144", "title": "How does this list comprehension over the inits of itself work?", "body": "<p>It comes down to lazy evaluation. Let's go with augustss's definition, since it is just slightly simpler, but call it <code>big</code> instead of <code>xs</code>, since that identifier is commonly used in utilities.</p>\n\n<p>Haskell only evaluates code as immediately necessary. If something isn't necessary, there is a stub there, basically a pointer to a function closure that can calculate the value if needed.</p>\n\n<p>Let's say I want to evaluate <code>big !! 4</code>. The definition of <code>!!</code> is something like this:</p>\n\n<pre><code>[] !! _ = error \"Prelude.(!!): index too large\"\n(x:_) !! 0 = x\n(_:xs) !! n = xs !! (n-1)\n</code></pre>\n\n<p>The definition of <code>big</code> is</p>\n\n<pre><code>big = 1 : [sum (map (^2) ys) | ys &lt;- tail (inits big)]\n</code></pre>\n\n<p>So in evaluating the index access, the first thing that happens is that the correct function variant must be chosen. The list data type has two constructors, <code>[]</code> and <code>first : rest</code>. The call is <code>big !! 4</code>, and the first branch of <code>!!</code> just checks whether the list is <code>[]</code>. Since the list explicitly starts with <code>1 : stub1</code>, the answer is no, and the branch is skipped.</p>\n\n<p>The second branch wants to know whether the <code>first : rest</code> form was chosen. The answer is yes, with <code>first</code> being <code>1</code> and <code>rest</code> being that big comprehension (<code>stub1</code>), its value irrelevant. But the second argument is not <code>0</code>, so this branch is skipped as well.</p>\n\n<p>The third branch also matches against <code>first : last</code>, but accepts anything for the second argument, so it applies. It ignores <code>first</code>, binds <code>xs</code> to the unevaluated comprehension <code>stub1</code>, and <code>n</code> to <code>4</code>. It then recursively calls itself with the first argument being the comprehension and the second <code>3</code>. (Technically, that's <code>(4-1)</code> and isn't yet evaluated, but as a simplification we will assume it is.)</p>\n\n<p>The recursive call again has to evaluate its branches. The first branch checks whether the first argument is empty. Since the argument so far is an unevaluated stub, it will need to be evaluated. But only far enough to decide whether the branch is empty. So let's start evaluating the comprehension:</p>\n\n<pre><code>stub1 = [sum (map (^2) ys) | ys &lt;- tail (inits big)]\n</code></pre>\n\n<p>The first thing we need is <code>ys</code>. It's set to <code>tail (inits big)</code>. <code>tail</code> is simple:</p>\n\n<pre><code>tail [] = []\ntail (_:xs) = xs\n</code></pre>\n\n<p><code>inits</code> is rather complex to implement, but the important thing is that it generates its result list lazily, i.e. if you give it <code>(x:unevaluated)</code>, it will generate <code>[]</code> and <code>[x]</code> before evaluating the rest of the list. In other words, if you don't look beyond those, it won't ever evaluate the rest.</p>\n\n<p>So, so far <code>big</code> is known to be <code>(1 : stub1)</code>, so <code>inits</code> returns <code>[] : stub2</code>. <code>tail</code> matches against this, chooses its second branch, and returns <code>stub2</code>. <code>stub2</code> is the list of inits of <code>big</code> after the omnipresent empty list, and it hasn't yet been generated.</p>\n\n<p>The list comprehension then tries to give <code>ys</code> the value of the first element of <code>stub2</code>, so it has to be evaluated. The second result of <code>inits</code> is still known, it's <code>[1]</code>. <code>ys</code> gets that value. At this point, then, <code>big</code> is known to be <code>1 : stub3 : stub4</code>, where <code>stub3 = sum (map (^2) [1])</code> and <code>stub4</code> is the list comprehension after the first iteration.</p>\n\n<p>Since <code>big</code> is now evaluated further, so is <code>stub1</code>. It is now known to be <code>stub3 : stub4</code>, and we can finally advance in <code>!!</code>. The first branch doesn't apply, since the list isn't empty. The second branch doesn't apply because <code>3 /= 0</code>. The third branch applies, binding <code>xs</code> to <code>stub4</code> and <code>n</code> to <code>3</code>. The recursive call is <code>stub4 !! 2</code>.</p>\n\n<p>We need to evaluate a bit of <code>stub4</code>. This means we enter the next iteration of the comprehension. We need the third element of <code>inits big</code>. Since <code>big</code> is by now known to be <code>1 : stub3 : stub4</code>, the third element can be calculated without further evaluation as <code>[1, stub3]</code>. <code>ys</code> is bound to this value, and <code>stub4</code> evaluates to <code>stub5 : stub6</code>, where <code>stub5 = sum (map (^2) [1, stub3])</code> and <code>stub6</code> is the comprehension after the first two iterations. With <code>stub4</code> evaluated, we now know that <code>big = 1 : stub3 : stub5 : stub6</code>.</p>\n\n<p>So <code>stub4</code> still doesn't match the first branch of <code>!!</code> (nothing ever will, since we're dealing with an infinite list). <code>2</code> still doesn't match the second branch. We have another recursive call, and then another, following the same pattern as we had so far. When the index finally reaches 0, we have:</p>\n\n<pre><code>big = 1 : stub3 : stub5 : stub7 : stub9 : stub10\nstub3 = sum (map (^2) [1])\nstub5 = sum (map (^2) [1, stub3])\nstub7 = sum (map (^2) [1, stub3, stub5])\nstub9 = sum (map (^2) [1, stub3, stub5, stub7])\nstub10 = whatever remains of the list comprehension\n</code></pre>\n\n<p>Our current call is <code>(stub9 : stub10) !! 0</code>, which finally matches the second branch. <code>x</code> is bound to <code>stub9</code> and returned.</p>\n\n<p>And only now, if you actually try to print or otherwise process <code>x</code>, are all of these stubs finally evaluated to an actual number.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1453327891, "creation_date": 1453327891, "answer_id": 34911633, "question_id": 29898999, "link": "https://stackoverflow.com/questions/29898999/how-does-this-list-comprehension-over-the-inits-of-itself-work/34911633#34911633", "title": "How does this list comprehension over the inits of itself work?", "body": "<p>Shaking your code a bit until it settles into a more comprehensible form, we get</p>\n\n<pre><code>xs = 1 : [sum (map (^2) ys) | ys &lt;- inits xs, not (null ys)]\n   = 1 : (map (sum . map (^2)) . map (`take` xs)) [1..]\n   = 1 : map (sum . map (^2) . (`take` xs)) [1..]\n   = 1 : scanl1 (\\a b-&gt; a+b^2) xs\n   = x1 : xs1\n              where { x1  = 1; \n                      xs1 = scanl1 g xs \n                          = scanl g x1 xs1;   -- by scanl1 definition\n                      g a x = a+x^2 }\n</code></pre>\n\n<p><code>scanl</code> works for non-empty lists as </p>\n\n<pre><code>scanl g a xs = a : case xs of (h:t) -&gt; scanl g (g a h) t\n</code></pre>\n\n<p>so <code>xs1 = scanl g a xs1</code> will first put the currently known accumulating value at its output's head (<code>xs1 = (a:_)</code>), and only then will it read that output, so this definition is productive. We also see that <code>h = a</code>, so <code>g a h = g a a = a+a^2 = a*(a+1)</code> and we can code this stream purely iteratively, as</p>\n\n<pre><code>xs = 1 : iterate (\\a -&gt; a*(a+1)) 1\n</code></pre>\n"}], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 1, "accepted_answer_id": 29900144, "answer_count": 3, "score": 9, "last_activity_date": 1453327891, "creation_date": 1430146123, "question_id": 29898999, "link": "https://stackoverflow.com/questions/29898999/how-does-this-list-comprehension-over-the-inits-of-itself-work", "title": "How does this list comprehension over the inits of itself work?", "body": "<p>In the #haskell IRC channel someone asked</p>\n\n<blockquote>\n  <p>Is there a succinct way to define a list where the nth entry is the sum of the squares of all entries before?</p>\n</blockquote>\n\n<p>I thought this sounded like a fun puzzle, and defining infinite lists recursively is one of those things I really need to practise. So I fired up GHCi and started playing around with recursive definitions. Eventually, I managed to get to</p>\n\n<pre><code>\u03bb&gt; let xs = 1 : [sum (map (^2) ys) | ys &lt;- inits xs, not (null ys)]\n</code></pre>\n\n<p>which seems to produce the correct results:</p>\n\n<pre><code>\u03bb&gt; take 9 xs\n[1,1,2,6,42,1806,3263442,10650056950806,113423713055421844361000442]\n</code></pre>\n\n<p>Unfortunately, I have no idea how the code I wrote works. Is it possible to explain what happens when this code is executed in a way that an intermediate Haskell user would understand?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430139148, "post_id": 29896327, "comment_id": 47915215, "body": "who says that this <b>is</b> the correct implementation - <i>correct</i> in what sense? I think you have seen this somewhere where you want to make an functor out of a pair for the first component rather than the second (or something like this) right?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430139319, "post_id": 29896327, "comment_id": 47915350, "body": "@CarstenK&#246;nig: Probably <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\" rel=\"nofollow noreferrer\">LYAH</a>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1430139355, "post_id": 29896327, "comment_id": 47915386, "body": "@Zeta exactly - was to lazy to search for it - thanks :D"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430139398, "post_id": 29896327, "comment_id": 47915415, "body": "@jcm - yeah but it works with <code>fmap f (x,y) = (x,f y)</code> ;)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430139501, "post_id": 29896327, "comment_id": 47915482, "body": "it does not work with <code>Pair a b</code> because now you define a functor <code>Pair a</code> with <b>fixed</b> a - but you want to keep <code>b</code> <i>fixed</i> - it&#39;s always the last part/type-variable ;) (just as in partial-application of functions)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430139599, "post_id": 29896327, "comment_id": 47915544, "body": "straight from LYAH: &quot;But it seems like there&#39;s no way to do something like that with (a,b) so that the type parameter a ends up being the one that changes when we use fmap.&quot; &lt;- this is the reason for the <code>newtype</code> ;)"}, {"owner": {"reputation": 4829, "user_id": 1852230, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1c009726dbacdd3e428afeb48d9eef63?s=128&d=identicon&r=PG", "display_name": "jcm", "link": "https://stackoverflow.com/users/1852230/jcm"}, "edited": false, "score": 0, "creation_date": 1430139614, "post_id": 29896327, "comment_id": 47915554, "body": "I guess I just don&#39;t understand why you would define Pair b a with the first component (a) in the second position and the second component (b) in the first position?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430139734, "post_id": 29896327, "comment_id": 47915631, "body": "because when you define something as an instance of <code>Functor</code> you need something of kind <code>* -&gt; *</code> (meaning you put in a type and get a type) - <code>Pair</code> is such a thing but of kind <code>* -&gt; * -&gt; *</code> (= <code>* -&gt; (* -&gt; *)</code>) and so you need to fix the first parameter - but of course the thing fixed should be the second component of your <i>pair</i> - therefore the flip - <b>think</b> of it as in curried functions and partial application but for types"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1430140105, "post_id": 29896327, "comment_id": 47915909, "body": "Reminder: kinds where <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses#kinds-and-some-type-foo\" rel=\"nofollow noreferrer\">introduced in chapter 8</a>."}, {"owner": {"reputation": 4829, "user_id": 1852230, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1c009726dbacdd3e428afeb48d9eef63?s=128&d=identicon&r=PG", "display_name": "jcm", "link": "https://stackoverflow.com/users/1852230/jcm"}, "edited": false, "score": 0, "creation_date": 1430140274, "post_id": 29896327, "comment_id": 47916047, "body": "I&#39;m finding this really mind bending. Any suggestions on how to really grok this stuff?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430140585, "post_id": 29896327, "comment_id": 47916314, "body": "yeah it can be hard - make sure you get the curryied/parital applied function stuff and then reread said chapter 8"}, {"owner": {"reputation": 4829, "user_id": 1852230, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1c009726dbacdd3e428afeb48d9eef63?s=128&d=identicon&r=PG", "display_name": "jcm", "link": "https://stackoverflow.com/users/1852230/jcm"}, "edited": false, "score": 0, "creation_date": 1430140857, "post_id": 29896327, "comment_id": 47916547, "body": "Will do - thanks for your help."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1430143192, "post_id": 29896327, "comment_id": 47918421, "body": "@jcm: You shouldn&#39;t edit answers into a question. If you think that the GHCi commands provide more information than any current answer, feel free to post it and accept it (although you might need to wait for a certain amount of time). However, I think that the GHCi session shows the difference much better than my current answer."}], "answers": [{"comments": [{"owner": {"reputation": 4829, "user_id": 1852230, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1c009726dbacdd3e428afeb48d9eef63?s=128&d=identicon&r=PG", "display_name": "jcm", "link": "https://stackoverflow.com/users/1852230/jcm"}, "edited": false, "score": 0, "creation_date": 1430139234, "post_id": 29896348, "comment_id": 47915286, "body": "What do you mean by &#39;the type of the second element comes first&#39;?"}], "tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": false, "score": 0, "last_activity_date": 1430139126, "creation_date": 1430139126, "answer_id": 29896348, "question_id": 29896327, "link": "https://stackoverflow.com/questions/29896327/correct-newtype-definition/29896348#29896348", "title": "Correct newtype definition", "body": "<p>Both <code>newtype Pair a b</code> and <code>newtype Pair b a</code> are correct (as in, they type check). In the latter the type of the second element comes first, which is counterintuitive, although it may be more appropriate in your use case.</p>\n"}, {"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430140639, "post_id": 29896660, "comment_id": 47916372, "body": ":D ... he will get that badge eventually ;)"}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 0, "creation_date": 1430141279, "post_id": 29896660, "comment_id": 47916875, "body": "@Zeta It tripped me up as a non-native speaker, and when I finally figured out what it meant I thought I should spare other simple minds like myself. It may seem silly but from my experience teaching even the little things are important when you want to convey knowledge. :)"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 0, "creation_date": 1430142178, "post_id": 29896660, "comment_id": 47917578, "body": "@kqr: It&#39;s fine. I thought that &quot;oh oh&quot; was more or less the same around the world."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1430142137, "last_edit_date": 1430142137, "creation_date": 1430139870, "answer_id": 29896660, "question_id": 29896327, "link": "https://stackoverflow.com/questions/29896327/correct-newtype-definition/29896660#29896660", "title": "Correct newtype definition", "body": "<p>You're talking about the <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\" rel=\"nofollow\">definition in LYAH</a>:</p>\n\n<pre><code>newtype Pair b a = Pair { getPair :: (a,b) }  \n</code></pre>\n\n<p>Note the paragraph that precedes it (emphasis mine):</p>\n\n<blockquote>\n  <p>It turns out that writing the instance for that is kind of hard. With <code>Maybe</code>, we just say instance Functor Maybe where because only type constructors that take exactly one parameter can be made an instance of Functor. <strong>But it seems like there's no way to do something like that with <code>(a,b)</code> so that the type parameter a ends up being the one that changes when we use <code>fmap</code>. To get around this, we can newtype our tuple in such a way that the second type parameter represents the type of the first component in the tuple:</strong>  </p>\n</blockquote>\n\n<p>So, in this case we want the type of the (underlying) pair's <em>first</em> element  being the <em>last</em> type in the type constructor <code>Pair</code>. After all, we want to use <code>fmap</code> on the first argument in LYAH:</p>\n\n<pre><code>--                     b \n--                     |\n--                     v  a isn't here\u2026 \ninstance Functor (Pair c) where  \n  -- but here!\n  --fmap :: (a -&gt; x) -&gt; Pair c a -&gt; Pair c x                        \n    fmap f (Pair (x,y)) = Pair (f x, y)  \n</code></pre>\n\n<p>You can of course change the definition to <code>newtype Pair b a = Pair { getPair :: (a,b) }</code>. But what happens in this case?</p>\n\n<pre><code>--                     a \n--                     |\n--                     v  b isn't here\u2026 \ninstance Functor (Pair c) where  \n\n  -- but here!               v---- c ----v--------------------------+\n  --fmap :: (b -&gt; x) -&gt; Pair c b -&gt; Pair c x                        |\n    fmap f (Pair (x,y)) = Pair (f x, y)                   --        |\n                             -- ^^^ uh-oh - that doesn't seem right-+\n</code></pre>\n\n<p>Remember, your underlying type is now <code>(a,b)</code>. However, in your <code>Functor</code> instance <code>a</code> is now fixed, yet you try to apply <code>fmap</code> on that. That does not work. Instead, you have to use <code>fmap</code> on the second entry, which corresponds to <code>b</code> from the type constructor <code>Pair a b</code>:</p>\n\n<pre><code>--                     a \n--                     |\n--                     v  b isn't here\u2026 \ninstance Functor (Pair c) where  \n  -- but here!\n  --fmap :: (b -&gt; x) -&gt; Pair c b -&gt; Pair c x\n    fmap f (Pair (x,y)) = Pair (x, f y) \n                 --                ^^^ everything fine now.\n</code></pre>\n\n<p>But at this point, we're back at the original <code>(a,b)</code> instance.</p>\n"}], "owner": {"reputation": 4829, "user_id": 1852230, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1c009726dbacdd3e428afeb48d9eef63?s=128&d=identicon&r=PG", "display_name": "jcm", "link": "https://stackoverflow.com/users/1852230/jcm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 29896660, "answer_count": 2, "score": 3, "last_activity_date": 1430142137, "creation_date": 1430139067, "last_edit_date": 1430140825, "question_id": 29896327, "link": "https://stackoverflow.com/questions/29896327/correct-newtype-definition", "title": "Correct newtype definition", "body": "<p>I am wondering why the following is the correct implementation of the Pair type. Specifically, why <code>Pair b a</code> and not <code>Pair a b</code>?</p>\n\n<pre><code>newtype Pair b a = Pair { getPair :: (a,b) } \n</code></pre>\n\n<p>To clarify, <code>Pair a b</code> doesn't work for the following:</p>\n\n<pre><code>instance Functor (Pair c) where  \nfmap f (Pair (x,y)) = Pair (f x, y) \n</code></pre>\n\n<p>and I don't understand why.</p>\n\n<p>In addition to a lot of the great answers below, I found doing the following in ghci helpful:</p>\n\n<pre><code>*Main&gt; newtype Pair b a = Pair (a, b) deriving (Show, Eq)\n*Main&gt; :t Pair(True, \"cat\")\nPair(True, \"cat\") :: Pair [Char] Bool\n\n*Main&gt; newtype Pair a b = Pair (a, b) deriving (Show, Eq)\n*Main&gt; :t Pair(True, \"cat\")\nPair(True, \"cat\") :: Pair Bool [Char]\n</code></pre>\n"}, {"tags": ["c#", "haskell", "newtype"], "comments": [{"owner": {"reputation": 41117, "user_id": 1864167, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/WalEV.jpg?s=128&g=1", "display_name": "Jeroen Vannevel", "link": "https://stackoverflow.com/users/1864167/jeroen-vannevel"}, "edited": false, "score": 2, "creation_date": 1430133710, "post_id": 29894266, "comment_id": 47911525, "body": "Can you provide some background on why you want to do this?"}, {"owner": {"reputation": 5181, "user_id": 3257165, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b8fb0f063a874c9b72694597a2246541?s=128&d=identicon&r=PG&f=1", "display_name": "Georg", "link": "https://stackoverflow.com/users/3257165/georg"}, "edited": false, "score": 0, "creation_date": 1430134032, "post_id": 29894266, "comment_id": 47911714, "body": "Why would you want to compile your code every x minutes?"}, {"owner": {"reputation": 4083, "user_id": 2748412, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/EZ1jT.png?s=128&g=1", "display_name": "Franck", "link": "https://stackoverflow.com/users/2748412/franck"}, "edited": false, "score": 1, "creation_date": 1430134289, "post_id": 29894266, "comment_id": 47911865, "body": "What&#39;s the use of hiding a type under another type name ?"}, {"owner": {"reputation": 5181, "user_id": 3257165, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b8fb0f063a874c9b72694597a2246541?s=128&d=identicon&r=PG&f=1", "display_name": "Georg", "link": "https://stackoverflow.com/users/3257165/georg"}, "reply_to_user": {"reputation": 4083, "user_id": 2748412, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/EZ1jT.png?s=128&g=1", "display_name": "Franck", "link": "https://stackoverflow.com/users/2748412/franck"}, "edited": false, "score": 9, "creation_date": 1430134398, "post_id": 29894266, "comment_id": 47911919, "body": "@Franck a possible reason could be to save Ariane5 rockets..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430137437, "post_id": 29894266, "comment_id": 47913928, "body": "I cannot help but point to F# - while there is no <code>newtype</code> in F# you can use single-case discriminated unions (like <code>type UserId = UserId of int</code>) and you get the real deal with type-synonyms too (in C# you have to fully qualify them, cannot use generics and have to redo them at the beginning of every file) - <b>disclaimer</b>: sadly F#s DUs are not compiled into structs but classes though - so there <i>is</i> a performance hit - but usually that does not matter to much in .net land anyway ;)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 5181, "user_id": 3257165, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b8fb0f063a874c9b72694597a2246541?s=128&d=identicon&r=PG&f=1", "display_name": "Georg", "link": "https://stackoverflow.com/users/3257165/georg"}, "edited": false, "score": 0, "creation_date": 1430137543, "post_id": 29894266, "comment_id": 47914002, "body": "@Georg - in .net we all use &quot;by-the-book&quot; TDD and of course we compile&amp;run all tests every minute or so ;)"}, {"owner": {"reputation": 842, "user_id": 4737779, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/009c3f05f9273268e5d530785ef14327?s=128&d=identicon&r=PG&f=1", "display_name": "Beerend Lauwers", "link": "https://stackoverflow.com/users/4737779/beerend-lauwers"}, "reply_to_user": {"reputation": 4083, "user_id": 2748412, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/EZ1jT.png?s=128&g=1", "display_name": "Franck", "link": "https://stackoverflow.com/users/2748412/franck"}, "edited": false, "score": 7, "creation_date": 1430139295, "post_id": 29894266, "comment_id": 47915330, "body": "@Franck and @Jeroen Vannevel : It makes the types clearer: compare a delegate with type <code>Func&lt;Int,Int,Double&gt;</code> and a delegate with type <code>Func&lt;UserId,DeviceID,DeviceLeasingTime&gt;</code>. Which one will help you grok the code faster? It&#39;s also nice that you can refactor the code to change the internal representation if desired or add extra checks such as that as UserId can only be a natural number."}, {"owner": {"reputation": 4083, "user_id": 2748412, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/EZ1jT.png?s=128&g=1", "display_name": "Franck", "link": "https://stackoverflow.com/users/2748412/franck"}, "edited": false, "score": 0, "creation_date": 1430142177, "post_id": 29894266, "comment_id": 47917577, "body": "@BeerendLauwers i would rather pass a class or struct and it&#39;s reusable and don&#39;t have to set in every single files."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "reply_to_user": {"reputation": 4083, "user_id": 2748412, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/EZ1jT.png?s=128&g=1", "display_name": "Franck", "link": "https://stackoverflow.com/users/2748412/franck"}, "edited": false, "score": 0, "creation_date": 1430149502, "post_id": 29894266, "comment_id": 47923127, "body": "@Franck: I think the consensus pretty much is that newtypes are equivalent to structs with a single field."}], "answers": [{"comments": [{"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 2, "creation_date": 1430140212, "post_id": 29894514, "comment_id": 47915991, "body": "An important thing about newtypes in Haskell are that they are a very cheap abstraction (in fact they are optimised away completely after type checking). In this sense, too, structs are the correct answer."}, {"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 0, "creation_date": 1600085423, "post_id": 29894514, "comment_id": 112967550, "body": "So how do you do <code>deriving Eq</code> with this?"}, {"owner": {"reputation": 128, "user_id": 4012426, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000105441681/picture?type=large", "display_name": "Hutch Moore", "link": "https://stackoverflow.com/users/4012426/hutch-moore"}, "reply_to_user": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 0, "creation_date": 1608246568, "post_id": 29894514, "comment_id": 115532646, "body": "@unhammer you don&#39;t. You have to implement operators manually (you can delegate to the inner value&#39;s operators tho)"}, {"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 0, "creation_date": 1608365352, "post_id": 29894514, "comment_id": 115565861, "body": "I found out :( And what&#39;s worse, some operators are implicitly defined. E.g. if you don&#39;t explicitly define <code>ToString</code>, one is defined for you (whereas in Haskell the compiler would tell you if anything tried using it as a string without defining/deriving an instance) \u2013 this lead to a bug in my C# where now the name of the struct was used as string instead of the contents."}], "tags": [], "owner": {"reputation": 5181, "user_id": 3257165, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b8fb0f063a874c9b72694597a2246541?s=128&d=identicon&r=PG&f=1", "display_name": "Georg", "link": "https://stackoverflow.com/users/3257165/georg"}, "is_accepted": true, "score": 18, "last_activity_date": 1430134235, "creation_date": 1430134235, "answer_id": 29894514, "question_id": 29894266, "link": "https://stackoverflow.com/questions/29894266/what-is-cs-equivalent-to-haskells-newtype/29894514#29894514", "title": "What is C#&#39;s equivalent to Haskell&#39;s newtype?", "body": "<p>No, C# does not have such a feature. The closest you can get to this are structs.</p>\n\n<pre><code>public struct UserId\n{\n    public int Id { get; private set; }\n\n    public UserId(int id) : this() { Id = id; }\n}\n</code></pre>\n\n<p>This way, the compiler indeed treats <code>UserId</code> and <code>int</code> as different types. Furthermore, you can add more methods to <code>UserId</code> that make sense given the fact that your <code>int</code> is effectively a user id. Note as well that this does not have any effect on the runtime, using a struct with a single <code>int</code> field does not cause any overhead against using <code>int</code> directly.</p>\n\n<p><em>Edit:</em> Because you asked about T4, if you are working with Visual Studio, you can easily create a new T4 Text template that will expand to (C#)-code and will be compiled automatically. The template will be executed everytime you save it.</p>\n"}], "owner": {"reputation": 842, "user_id": 4737779, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/009c3f05f9273268e5d530785ef14327?s=128&d=identicon&r=PG&f=1", "display_name": "Beerend Lauwers", "link": "https://stackoverflow.com/users/4737779/beerend-lauwers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1327, "favorite_count": 2, "accepted_answer_id": 29894514, "answer_count": 1, "score": 12, "last_activity_date": 1439556386, "creation_date": 1430133487, "last_edit_date": 1439556386, "question_id": 29894266, "link": "https://stackoverflow.com/questions/29894266/what-is-cs-equivalent-to-haskells-newtype", "title": "What is C#&#39;s equivalent to Haskell&#39;s newtype?", "body": "<p>In Haskell, there's two ways of providing an alias for types: <code>type</code> and <code>newtype</code>. <code>type</code> provides a <em>type synonym</em>, which means the synonym is regarded by the type checker as exactly the same as the original type:</p>\n\n<pre><code>type UserId = Int\nhasAccess :: UserId -&gt; Bool\nhasAccess id = {-- stuff --}\n\n-- Elsewhere in the program\nlogin :: Int -&gt; Bool\nlogin n = hasAccess n -- Typechecker won't complain\n</code></pre>\n\n<p>A <code>newtype</code> is similar, but is regarded by the type checker as a different type:</p>\n\n<pre><code>newtype UserId = UserId Int\nhasAccess :: UserId -&gt; Bool\nhasAccess (UserId id) = {-- stuff --}\n\n-- Elsewhere in the program\nlogin :: Int -&gt; Bool\nlogin n = hasAccess n -- Typechecker will complain, n isn't a UserId !\n</code></pre>\n\n<p>In C#, you can define type synonyms with a top-level <code>using</code> declaration:</p>\n\n<pre><code>using UserId = Int;\n</code></pre>\n\n<p>However, a strongly-typed, compiler-checked type alias does not seem to be present in C# by default. I've looked into automatic code generation with T4 templates and CodeDOM to generate a class wrapper, but I don't really know how I could cleanly integrate those into my programming flow.</p>\n\n<p>Ideally, I would like to be able to say on a top-level:</p>\n\n<pre><code>// Something like this?\nusing Int.UserId;\n\n/* Elsewhere */\nvar id = new UserId(5);\n\npublic bool HasAccess( UserId id )\n{\n    /* Stuff */\n}\n</code></pre>\n\n<p>This kicks the code generation into gear <em>at compile-time</em>. If that's not possible or provides a chicken-and-egg issue for IntelliSense, an automatic compilation option that runs every <em>x</em> minutes (or a button or whatever) would be nice.</p>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 2, "creation_date": 1430129084, "post_id": 29892381, "comment_id": 47908450, "body": "&quot;I need to&quot; - so this is homework. Pay attention in class, ask your fellow students (perhaps they did), ask your teacher/instructor/lecturer (I&#39;m sure he explained very well what to do)."}], "answers": [{"tags": [], "owner": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "is_accepted": true, "score": 8, "last_activity_date": 1430129072, "creation_date": 1430129072, "answer_id": 29892699, "question_id": 29892381, "link": "https://stackoverflow.com/questions/29892381/robertson%c2%b4s-weekday-function-in-haskell/29892699#29892699", "title": "Robertson&#180;s weekday function in Haskell", "body": "<p>1) Values cannot be defined starting with a capital letter.</p>\n\n<p>2) Infix operators should be surrounded with a single quotes like that:</p>\n\n<pre><code>robertson :: Integer -&gt; Integer -&gt; Integer -&gt; Integer\nrobertson tag monat jahr = d + tag + 77 +e + (b `quot` 400) - 2 * (b `quot` 100) `mod` 77 where\n\n                        a = monat + 10\n                        b = ((monat - 14) `quot` 12) + jahr\n                        c = a - 12 * (a `quot` 13)\n                        d = (( 13 * c - 1) `quot` 5)\n                        e = 5 * ( b `mod` 100) `quot` 4\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 4834712, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a69f8d4d9673764d127b0f1a08d9c2db?s=128&d=identicon&r=PG&f=1", "display_name": "Hans", "link": "https://stackoverflow.com/users/4834712/hans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 0, "accepted_answer_id": 29892699, "answer_count": 1, "score": 0, "last_activity_date": 1430129072, "creation_date": 1430128235, "question_id": 29892381, "link": "https://stackoverflow.com/questions/29892381/robertson%c2%b4s-weekday-function-in-haskell", "title": "Robertson&#180;s weekday function in Haskell", "body": "<p>I need to program a function for the weekday Robertson formula in Haskell.\nCurrently I receive an error message(\"Not in scope\" when each variables(A, B, C, D, E). However, I do not know what the error is? Is it perhaps \"where\"?</p>\n\n<pre><code>wochentag :: Integer -&gt; Integer -&gt; Integer -&gt; String\nwochentag tag monat jahr = wochentage !! fromInteger (robertson tag monat jahr) where\n\n\nwochentage :: [String]\nwochentage = [\"Sonntag\",\"Montag\",\"Dienstag\",\"Mittwoch\",\"Donnerstag\",\"Freitag\",\"Samstag\"]\n\n\n\nrobertson :: Integer -&gt; Integer -&gt; Integer -&gt; Integer\n\nrobertson tag monat jahr = D + tag +77 +E + (B quot 400) - 2 * (B quot 100) mod 77 where\n\n                        A = monat + 10\n                        B = ((monat - 14) quot 12) + jahr\n                        C = A - 12 * (A quot 13)\n                        D = (( 13 * C - 1) quot 5)\n                        E = 5 * ( B mod 100) quot 4\n</code></pre>\n\n<p>Can someone help me? </p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 2, "creation_date": 1430127981, "post_id": 29892022, "comment_id": 47907721, "body": "I would have thought that if you <code>build-depend</code> on <code>foo</code>, you only need those build-dependencies that are actually used by the tests in <code>test&#47;</code>, which may be less."}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1430128071, "post_id": 29892022, "comment_id": 47907780, "body": "@JoachimBreitner I don&#39;t think it works that way. I just had to add all dependencies to a test-suite, prompting this question."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430128150, "post_id": 29892022, "comment_id": 47907827, "body": "I too think that it should work - there was <a href=\"https://github.com/haskell/cabal/issues/2032\" rel=\"nofollow noreferrer\">this issue with <code>cabal repl</code> though</a>"}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430138153, "post_id": 29892022, "comment_id": 47914437, "body": "@CarstenK&#246;nig possibly i am running into that. Do you want to create an answer from that?"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 1, "last_activity_date": 1430139025, "creation_date": 1430139025, "answer_id": 29896311, "question_id": 29892022, "link": "https://stackoverflow.com/questions/29892022/do-i-have-to-repeat-all-dependencies-in-the-test-configuration/29896311#29896311", "title": "Do I have to repeat all dependencies in the test configuration?", "body": "<p>It should work as is but there is a <a href=\"https://github.com/haskell/cabal/issues/2032\" rel=\"nofollow\">reported bug</a> when you use it with <code>cabal repl</code></p>\n\n<p>Overall it seems work with <code>cabal test</code> but if you try to load the test-file into <code>cabal repl</code> you might get an error like this:</p>\n\n<pre><code>Could not find module \u2018XYZ\u2019\n    It is a member of the hidden package \u2018XZY-[ver]\u2019.\n    Perhaps you need to add \u2018XYZ\u2019 to the build-depends in your .cabal file.\n    Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>So right now it might be a good idea to indeed copy the dependencies but hopefully this will get resolved shortly</p>\n"}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 29896311, "answer_count": 1, "score": 3, "last_activity_date": 1430139025, "creation_date": 1430127339, "question_id": 29892022, "link": "https://stackoverflow.com/questions/29892022/do-i-have-to-repeat-all-dependencies-in-the-test-configuration", "title": "Do I have to repeat all dependencies in the test configuration?", "body": "<p>This bugs me time and again, basically if I create a <code>test-suite</code> in the cabal configuration I add the projects <code>src</code> folder to the test suites <code>hs-source-dirs</code> section and repeat all dependencies in <code>build-depends</code>. A typical project might look like:</p>\n\n<pre><code>-- in file \"foo.cabal\"\nlibrary\n  build-depends: a, b, c\n  exposed-modules: Foo, Bar\n  hs-source-dirs: src\n\ntest-suite tests\n  build-depends: foo, a, b, c\n  hs-source-dirs: test\n</code></pre>\n\n<p>The other option is to include <code>src</code> in the test suites <code>hs-source-dirs</code> as well.</p>\n\n<p>Both of them require me to specify all build dependencies in the test case, as far as I know. Is there a way around this?</p>\n"}, {"tags": ["function", "loops", "haskell", "recursion"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 4, "creation_date": 1430124234, "post_id": 29890822, "comment_id": 47905489, "body": "Do you really want recursion? It seems so much easier with a list comprehension in this case: <code>head [(x + y + z) | x &lt;- [0..99], y &lt;- [0..99], z &lt;- [0..99], tresor x y z]</code>. Although this doesn&#39;t do exactly the same as you intended. Also, I suggest you to return a <code>Maybe (Int, Int, Int)</code> instead, after all, the tresor might have a broken lock."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1430124297, "post_id": 29890822, "comment_id": 47905517, "body": "Do you need to return the sum or instead want the triple <code>(x,y,z)</code> ?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1430124474, "post_id": 29890822, "comment_id": 47905604, "body": "If you want to fully scan <code>x</code> values before incrementing <code>y</code>, you can adapt @Zeta&#39;s code reversing the generators: <code>head [(x + y + z) | z &lt;- [0..100], y &lt;- [0..100], x &lt;- [0..100], tresor x y z]</code>"}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "edited": false, "score": 0, "creation_date": 1430124966, "post_id": 29890822, "comment_id": 47905882, "body": "yeah unfortunately i need the recursion task, because i want to improve it! Moreover thanks for your replies! and yeah i want to return x, y, z seperated and clearly :)"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1430125036, "post_id": 29890822, "comment_id": 47905934, "body": "@satubus: Your title states that you want to to this &quot;parallely&quot;. However, there is no parallelism in your code at all. Do you <i>really</i> want parallelism?"}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1430125250, "post_id": 29890822, "comment_id": 47906089, "body": "@Zeta i didn&#39;t know how to be exactlier, i just want to iterate through recursion every single combination of x y z values, to hit the true variable for the function!"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1430125642, "post_id": 29890822, "comment_id": 47906331, "body": "@satubus: Well, your question seems like you want to return <code>x,y,z</code> separately. Is this just about returning a tuple? By the way, you probably want to use English function names instead of German ones when you&#39;re on an international site."}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1430126003, "post_id": 29890822, "comment_id": 47906543, "body": "@Zeta Yep! Oh your right, I should do that! Any idea how I can return x,y,z seperately?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1430127744, "post_id": 29890822, "comment_id": 47907584, "body": "Use <code>(x,y,z)</code> (with the parentheses included) instead of <code>x+y+z</code>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1430127918, "post_id": 29890822, "comment_id": 47907679, "body": "based on @chi s two superb answers you should just use <code>head [(x, y, z) | z &lt;- [0..100], y &lt;- [0..100], x &lt;- [0..100], tresor x y z]</code> ;)"}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430127974, "post_id": 29890822, "comment_id": 47907717, "body": "@CarstenK&#246;nig yes i know"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1430128002, "post_id": 29890822, "comment_id": 47907739, "body": "@chi you should probably make this into an answer ;)"}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "edited": false, "score": 0, "creation_date": 1430128027, "post_id": 29890822, "comment_id": 47907754, "body": "well, now i get this error, and i really dont know the meaning : &quot;No instance for (show(t0-&gt;t10-&gt;t20-&gt;(t0,t10,t20)))) arising froma use of print In a stmt of an interactive GHCi command: print it"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1430128082, "post_id": 29890822, "comment_id": 47907786, "body": "You are trying to print a function in GHCi: supply all the arguments to print the result."}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1430128269, "post_id": 29890822, "comment_id": 47907904, "body": "@Chi well, i thought i did so... now I am confused"}], "answers": [{"tags": [], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "is_accepted": false, "score": 2, "last_activity_date": 1430127900, "creation_date": 1430127900, "answer_id": 29892246, "question_id": 29890822, "link": "https://stackoverflow.com/questions/29890822/how-do-i-return-three-variables/29892246#29892246", "title": "How do I return three variables?", "body": "<p>You can return three variables by using a tuple of three numbers instead of a single number, as in:</p>\n\n<pre><code>crack tresor = (5,2,13)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "edited": false, "score": 0, "creation_date": 1430128952, "post_id": 29892523, "comment_id": 47908357, "body": "thanks alot! Now I get a parse error on &quot;module tresor where&quot; :S"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "edited": false, "score": 0, "creation_date": 1430129340, "post_id": 29892523, "comment_id": 47908587, "body": "@satubus Make it uppercase as in <code>Tresor</code>."}, {"owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "edited": false, "score": 0, "creation_date": 1430130040, "post_id": 29892523, "comment_id": 47909029, "body": "nvm lol i found the problem! I was always entering &quot;crackthe tresor1 &quot;instead of crack tresor1, so there i was fooling myself lol... thank you all for your great support :)"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1430130966, "post_id": 29892523, "comment_id": 47909648, "body": "@chi: He can make it up if he publishes another Church encoding kata on Codewars."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1430131148, "post_id": 29892523, "comment_id": 47909762, "body": "@Zeta me? Not till the thing is fixed - but I did not look there for quite some time ;9"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 2, "last_activity_date": 1430128620, "creation_date": 1430128620, "answer_id": 29892523, "question_id": 29890822, "link": "https://stackoverflow.com/questions/29890822/how-do-i-return-three-variables/29892523#29892523", "title": "How do I return three variables?", "body": "<p>step-by-step solution:</p>\n\n<p>open your favorite editor and paste in this:</p>\n\n<pre><code>module Tresor where\n\ncrack tresor =     \n    crackthe tresor 0 0 0\n\ncrackthe tresor x y z =    \n    if tresor x y z == False\n        then if x &lt; 100 \n            then crackthe tresor (x+1) (y) (z)\n            else if x == 100 &amp;&amp; y &lt; 100\n                then crackthe tresor (x-100) (y+1) (z)\n                else if y == 100 &amp;&amp; x == 100 &amp;&amp; z &lt; 100\n                    then crackthe tresor (x-100) (y-100) (z+1)\n                    else (x,y,z)\n        else (x,y,z)\n</code></pre>\n\n<p>this is just your code with <code>(x,y,z)</code> instead of <code>(x+y+z)</code></p>\n\n<p>Now save it as \"tresor.hs\", start ghci and load it with <code>:l tresor.hs</code> you should now be able to do something like this:</p>\n\n<pre><code>\u03bb&gt; crack (\\ x y z -&gt; 2*x + y - z -5 == 0)\n(2,1,0)\n</code></pre>\n\n<p>as you can see for the <code>tresor</code> function <code>2*x+y-z-5==0</code> the first found solution will be <code>(2,1,0)</code> meaning <code>x=2, y=1, z=0</code> which works ;)</p>\n\n<h2>simpler approach</h2>\n\n<p>is to use list comprehensions as mentioned by @chi</p>\n\n<pre><code>crackThe :: (Int -&gt; Int -&gt; Int -&gt; Bool) -&gt; (Int, Int, Int)\ncrackThe tresor = head [(x, y, z) | z &lt;- [0..100], y &lt;- [0..100], x &lt;- [0..100], tresor x y z]\n</code></pre>\n\n<h3>usage</h3>\n\n<pre><code>\u03bb&gt; crackThe (\\ x y z -&gt; 2*x + y - z -5 == 0)\n(2,1,0)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1430137745, "post_id": 29894011, "comment_id": 47914151, "body": "Note: the imperative variant wasn&#39;t originally in the author&#39;s question. But since he accepted your answer, I guess he&#39;s fine with it, although it isn&#39;t recursive at all."}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1430138288, "post_id": 29894011, "comment_id": 47914540, "body": "@Zeta Yeah, I just now saw the &quot;through recursion&quot; bit. Maybe that&#39;s just a terminology mistake by the author (based on the frequent misunderstanding that &quot;in Haskell you must use recursion to iterate&quot;), or maybe the author is going to learn a lesson about copying homework solutions blindly from the internets. :)"}], "tags": [], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "is_accepted": true, "score": 3, "last_activity_date": 1430137141, "last_edit_date": 1430137141, "creation_date": 1430132730, "answer_id": 29894011, "question_id": 29890822, "link": "https://stackoverflow.com/questions/29890822/how-do-i-return-three-variables/29894011#29894011", "title": "How do I return three variables?", "body": "<p>An implementation that will look a lot like your imperative loop is the following:</p>\n\n<pre><code>crackthe tresor = do         -- function crackthe tresor:\n  z &lt;- [0..100]              --   for z = 0 to 100:\n  y &lt;- [0..100]              --     for y = 0 to 100:\n  x &lt;- [0..100]              --       for x = 0 to 100:\n  guard (tresor x y z)       --         if tresor x y z:\n  return (x, y, z)           --           return (x,y,z)\n</code></pre>\n\n<p>This relies on the fact that, in <code>do</code> notation for lists, <code>&lt;-</code> is like a loop over all the list elements, and <code>guard</code> is like <code>break</code> if the condition isn't satisfied.</p>\n"}], "owner": {"reputation": 27, "user_id": 4836824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca55c44c665f2db5bb93d6b8f071dfb?s=128&d=identicon&r=PG&f=1", "display_name": "satubus", "link": "https://stackoverflow.com/users/4836824/satubus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 29894011, "answer_count": 3, "score": 0, "last_activity_date": 1430137141, "creation_date": 1430123602, "last_edit_date": 1430127639, "question_id": 29890822, "link": "https://stackoverflow.com/questions/29890822/how-do-i-return-three-variables", "title": "How do I return three variables?", "body": "<p>My task is to identify on what arguments <code>x</code>, <code>y</code>, and <code>z</code> a function <code>tresor</code> will return <code>True</code>. I want to iterate through recursion every variable from <code>0</code> to <code>100</code>, similarly to the following imperative loop:</p>\n\n<pre><code>for z = 0 to 100:\n  for y = 0 to 100:\n    for x = 0 to 100:\n      if tresor x y z:\n        return (x,y,z)\n</code></pre>\n\n<p>So first I would like to check all <code>x</code> from 0 to 100, then if x = 100, set x = 0 and y+1 and again x to 100, and so on for z\u2026</p>\n\n<p>However, I don't know how to return <code>x,y,z</code> separately.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>crack tresor =     \n    crackthe tresor 0 0 0\n\ncrackthe tresor x y z =    \n    if tresor x y z == False\n        then if x &lt; 100 \n            then crackthe tresor (x+1) (y) (z)\n            else if x == 100 &amp;&amp; y &lt; 100\n                then crackthe tresor (x-100) (y+1) (z)\n                else if y == 100 &amp;&amp; x == 100 &amp;&amp; z &lt; 100\n                    then crackthe tresor (x-100) (y-100) (z+1)\n                    else (x+y+z)\n        else (x+y+z)\n</code></pre>\n"}, {"tags": ["haskell", "ghci", "parsec"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430112565, "post_id": 29887560, "comment_id": 47899426, "body": "why don&#39;t you constraint it to <code>transformers &lt; 0.4.3.0</code> or even to <code>0.3.0.0</code>?  It&#39;s hard to give you good advice if we don&#39;t see the &quot;scary looking warning&quot; - btw: did you start up ghci in your sandbox <code>cabal repl</code>?"}, {"owner": {"reputation": 275, "user_id": 1953221, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2949d31fc450441a1fa42423eb931ac0?s=128&d=identicon&r=PG", "display_name": "user1953221", "link": "https://stackoverflow.com/users/1953221/user1953221"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430114512, "post_id": 29887560, "comment_id": 47900220, "body": "Tried constraining it but didn&#39;t work also. I&#39;ve edited the original post to include the warning. Starting with <code>cabal repl</code> worked but had some other problems, like not being able to see other modules in my project (trying to figure out why). I guess my question is: in general, how do I use newer versions of libraries and resolve such conflicts?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430114761, "post_id": 29887560, "comment_id": 47900325, "body": "the problem is that normally you are not allowed have multiple versions of the same lib installed - you can in a sandbox but then you should tell GHCi to look there (<code>cabal repl</code> basically)"}, {"owner": {"reputation": 275, "user_id": 1953221, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2949d31fc450441a1fa42423eb931ac0?s=128&d=identicon&r=PG", "display_name": "user1953221", "link": "https://stackoverflow.com/users/1953221/user1953221"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430115222, "post_id": 29887560, "comment_id": 47900520, "body": "Okay, <code>cabal repl</code> worked after <code>cabal configure</code>. It respects all the settings in my <code>.cabal</code> file too, so that&#39;s awesome. Should I always prefer it over just using <code>ghci</code> and a <code>.ghci</code> file in the project root? Edit: ah, I get it. Thanks!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1430116101, "post_id": 29887560, "comment_id": 47900922, "body": "yes you should prefer it if you are using sandboxes :D"}], "owner": {"reputation": 275, "user_id": 1953221, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2949d31fc450441a1fa42423eb931ac0?s=128&d=identicon&r=PG", "display_name": "user1953221", "link": "https://stackoverflow.com/users/1953221/user1953221"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "closed_date": 1458438823, "answer_count": 0, "score": 0, "last_activity_date": 1430114479, "creation_date": 1430111048, "last_edit_date": 1430114479, "question_id": 29887560, "link": "https://stackoverflow.com/questions/29887560/ghci-cant-resolve-names-in-two-versions-of-the-same-package", "closed_reason": "Duplicate", "title": "GHCi can&#39;t resolve names in two versions of the same package", "body": "<p>I'm trying to use Parsec's <code>OperatorTable</code> with the following:</p>\n\n<pre><code>table :: Ex.OperatorTable String () Identity Expr\ntable = [[]]\n</code></pre>\n\n<p><code>cabal build</code> and <code>cabal run</code> work, but loading <code>Main</code> into GHCi gives me this weird error:</p>\n\n<pre><code>Parser.hs:127:33:\n    Couldn't match type \u2018Identity\u2019\n                  with \u2018transformers-0.3.0.0:Data.Functor.Identity.Identity\u2019\n    NB: \u2018Identity\u2019\n          is defined in \u2018Data.Functor.Identity\u2019\n              in package \u2018transformers-0.4.3.0\u2019\n        \u2018transformers-0.3.0.0:Data.Functor.Identity.Identity\u2019\n          is defined in \u2018Data.Functor.Identity\u2019\n              in package \u2018transformers-0.3.0.0\u2019\n    Expected type: Ex.OperatorTable\n                     String () transformers-0.3.0.0:Data.Functor.Identity.Identity Expr\n      Actual type: Ex.OperatorTable String () Identity Expr\n    In the first argument of \u2018Ex.buildExpressionParser\u2019, namely \u2018table\u2019\n    In the expression: Ex.buildExpressionParser table factor\n</code></pre>\n\n<p>So I deleted <code>~/.cabal</code> and <code>.cabal-sandbox</code> and reinstalled <code>mtl</code>, both globally and in a new sandbox Same error.</p>\n\n<p><code>ghc-pkg list | grep trans</code> gives:</p>\n\n<pre><code>transformers-0.3.0.0\ntransformers-0.4.3.0\n</code></pre>\n\n<p>so I tried <code>ghc-pkg unregister transformers-0.3.0.0</code> but got a scary-looking warning message about how a bunch of other packages would break:</p>\n\n<pre><code>ghc-pkg: unregistering transformers-0.3.0.0 would break the following\npackages: regex-posix-0.95.2 regex-compat-0.95.1 regex-base-0.93.2\nparsec-3.1.5 network-2.4.2.3 mtl-2.1.3.1 fgl-5.5.0.1 HTTP-4000.2.10\nghc-7.8.3 haskeline-0.7.1.2 (use --force to override)\n</code></pre>\n\n<p>Didn't proceed.</p>\n\n<p>Also tried <code>ghci -package transformers-0.4.3.0</code> and got the same error.</p>\n\n<p>What do I do now? :\\</p>\n\n<p>My <code>.cabal</code> file contains <code>transformers &lt;= 0.4.3.0</code>. I'm on GHC 7.8.3 on OS X 10.10.2.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 1, "creation_date": 1430106986, "post_id": 29886852, "comment_id": 47897750, "body": "Perhaps this will help: <a href=\"http://stackoverflow.com/questions/20638893/how-can-non-determinism-be-modeled-with-a-list-monad\" title=\"how can non determinism be modeled with a list monad\">stackoverflow.com/questions/20638893/&hellip;</a>"}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 3, "creation_date": 1430132195, "post_id": 29886852, "comment_id": 47910465, "body": "In short, there are two kinds of non-deterministic computations: in one the result is chosen at random; in the other all possible answers are generated by the computation, and then you can later on decide if you want to randomly choose one of them or keep analysing all of them."}, {"owner": {"reputation": 123, "user_id": 434432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/374456d3d004807ee1664fd98167854e?s=128&d=identicon&r=PG", "display_name": "Loki Clock", "link": "https://stackoverflow.com/users/434432/loki-clock"}, "edited": false, "score": 0, "creation_date": 1430156370, "post_id": 29886852, "comment_id": 47927479, "body": "If you use do notation to write the computations in terms of the list monad, the declarations have nondeterministic syntax in the same way as the transitions of a nondeterministic finite automaton. I like to think of the <code>val &lt;- list :: [a]</code> as declaring a formal value <code>val</code> of type <code>a</code>, or declaring <code>val</code> to be the formal <code>a</code> value inside the <code>[a]</code> called <code>list</code>."}], "answers": [{"comments": [{"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 2, "creation_date": 1430124336, "post_id": 29887076, "comment_id": 47905537, "body": "&quot;In fact, <code>(+) &lt;$&gt; [1,2] &lt;*&gt; [4,5,6]</code> is exactly equivalent to <code>[x + y | x &lt;- [1,2], y &lt;- [4,5,6]]</code>&quot; aaahhh and suddenly I understand monad comprehensions on a deeper level."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 0, "creation_date": 1430151375, "post_id": 29887076, "comment_id": 47924448, "body": "@kqr: I thought about mentioning that :-)  But in a rare moment of concision, I decided my answer was long enough already!"}], "tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": false, "score": 23, "last_activity_date": 1430107971, "creation_date": 1430107971, "answer_id": 29887076, "question_id": 29886852, "link": "https://stackoverflow.com/questions/29886852/why-is-the-following-haskell-code-non-deterministic/29887076#29887076", "title": "Why is the following Haskell code non-deterministic?", "body": "<p>In this context, what's nondeterministic isn't the computation that Haskell is <em>performing</em>, but instead the computation that is being <em>represented</em>.  When viewed as a monad (or applicative functor), lists represent nondeterministic computation: just as a <code>Maybe a</code> is a computation of an <code>a</code> that might have failed, or an <code>IO a</code> is computation of an <code>a</code> that did some I/O, a <code>[a]</code> is a nondeterministic computation of an <code>a</code>.  Thus the list <code>[1,2]</code>, under this interpretation, represents a computation that nondeterministically returns <code>1</code> or <code>2</code>, and similarly for <code>[4,5,6]</code>.  Or again, by way of analogy: computing <code>Nothing</code> in Haskell succeeds, even though that value represents failure; computing <code>[1,2]</code> in Haskell is deterministic (and pretty boring), but that value encodes a form of nondeterminism.</p>\n\n<p>Thus, <code>(+) &lt;$&gt; [1,2] &lt;*&gt; [4,5,6]</code> computes <em><code>x + y</code></em> nondeterministically.  Again, that's not what's written in the code \u2013 that's what the code <em>represents</em>.  The code itself deterministically computes the representation of a nondeterministic computation!</p>\n\n<p>The way this works is that <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> functions lift computations inside an applicative functor, so that snippet says to compute <code>(+)</code> inside the list applicative functor, which means it computes <code>(+)</code> nondeterministically:</p>\n\n<ul>\n<li><code>[1,2]</code> represents a computation that could return either <code>1</code> or <code>2</code>.  Call its result <code>x</code>.</li>\n<li><code>[4,5,6]</code> represents a computation that could return any of <code>4</code>, <code>5</code>, or <code>6</code>.  Call its result <code>y</code>.</li>\n<li>Thus, adding the results of those computations together \u2013 computing <code>x + y</code> \u2013 could evaluate to the sum of any of the possible values for <code>x</code> and <code>y</code>.</li>\n</ul>\n\n<p>This is what the quote is saying, just in slightly more and different words :-)</p>\n\n<p>In fact, <code>(+) &lt;$&gt; [1,2] &lt;*&gt; [4,5,6]</code> is exactly equivalent to <code>[x + y | x &lt;- [1,2], y &lt;- [4,5,6]]</code>, where the \"nondeterminism\" is instead <code>x</code> and <code>y</code> each iterating over their respective lists.  This is all that's meant by nondeterminism, in the end!</p>\n\n<p>As for how you were thinking about understanding this: remember, Haskell code is <em>guaranteed</em> to be deterministic in its results, thanks to Haskell's purely functional nature.  The order of computation, however, doesn't affect this, so is left fairly unconstrained, as long as functions don't fail too early (e.g., <code>const () undefined</code> must evaluate to <code>()</code>).  We only get nondeterminism by representing it as an effect; lists are one encoding of this (and <code>IO</code> can be another, for a very different kind of nondeterminism).</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 37, "last_activity_date": 1430109306, "creation_date": 1430109306, "answer_id": 29887275, "question_id": 29886852, "link": "https://stackoverflow.com/questions/29886852/why-is-the-following-haskell-code-non-deterministic/29887275#29887275", "title": "Why is the following Haskell code non-deterministic?", "body": "<p>The book is using a different sense of \"non-deterministic computation\" than you are.</p>\n\n<p>You're thinking \"non-deterministic computation\" as in \"a program which doesn't fully determine its output\". This kind of non-determinism is common when using multiple parallel threads of execution; there are many possible outputs, and which one you get is arbitrarily determined by the precise order in which things happen at runtime.</p>\n\n<p>The paragraph you're quoting from LYAH is talking about viewing lists as a model of \"non-deterministic computation\", in a sense that is meant by the logic programming paradigm (if you've ever done much programming using the Prolog language, you'd probably be familiar with this). Non-deterministic programs in this sense have multiple (or zero!) outputs <em>because they are specifically programmed to do so</em>, rather than because they do not fully specify what their output should be.</p>\n\n<p>If \"non-determinsitic code\" is just code that has \"zero or more outputs of type t\", this sounds a lot like a function returning a list of t. The list Applicative (and Functor and Monad) instances are just the obvious way of saying how to combine such \"non-determinstic values\" with each other, and with pure functions. For example, the Functor instance says that if you can apply a function to an A to get a B, then you can also map that function to work on a \"non-deterministic A\" to get a \"non-determinstic B\" (by applying the unmapped function to every possible value of the \"non-deterministic A\").</p>\n\n<p><code>(+) &lt;$&gt; [1,2] &lt;*&gt; [4,5,6]</code> seen this way is an example of \"non-deterministic addition\". You add a number that could be 1 or 2, to another number that could be 4, 5, or 6; the result could be 5, 6, 7, 6, 7, or 8 (some possibilities are repeated because there's more than one way to generate them).</p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 15, "last_activity_date": 1430187027, "last_edit_date": 1430187027, "creation_date": 1430110636, "answer_id": 29887492, "question_id": 29886852, "link": "https://stackoverflow.com/questions/29886852/why-is-the-following-haskell-code-non-deterministic/29887492#29887492", "title": "Why is the following Haskell code non-deterministic?", "body": "<p>In the list monad, I like to think of <code>[1, 2]</code> as representing a set of possible choices: 1 or 2. When we do operations on such a set, we produce a set of possible results. What is \u201c1 or 2\u201d plus 4? Naturally, \u201c5 or 6\u201d. In Haskell, we can phrase that question as <code>(+ 4) &lt;$&gt; [1, 2]</code> and get the expected answer <code>[5, 6]</code>.</p>\n\n<p>The list monad represents nondeterminism in that it lets us talk about the whole tree of possible choices, without actually committing to any of those choices. So what is \u201c1 or 2\u201d plus \u201c4, 5, or 6\u201d? Well, that could be:</p>\n\n<ul>\n<li>1\n<ul>\n<li>+ 4 = 5</li>\n<li>or + 5 = 6</li>\n<li>or + 6 = 7</li>\n</ul></li>\n<li>or 2\n<ul>\n<li>+ 4 = 6</li>\n<li>or + 5 = 7</li>\n<li>or + 6 = 8</li>\n</ul></li>\n</ul>\n\n<p>We can encode the question in Haskell with the list monad (as exhaustive calculation of all the solutions, in order):</p>\n\n<pre><code>do\n  x &lt;- [1, 2]     -- if x is 1 or 2\n  y &lt;- [4, 5, 6]  -- and y is 4, 5, or 6\n  return (x + y)  -- then what are the possible values of x + y?\n</code></pre>\n\n<p>Or with the list applicative (doing the same):</p>\n\n<pre><code>(+) &lt;$&gt; [1, 2] &lt;*&gt; [4, 5, 6]\n</code></pre>\n\n<p>And the answer is of course <code>[5, 6, 7, 6, 7, 8]</code>. </p>\n\n<p>If it helps, you can also think of the list monad, or list comprehensions, as performing a sort of Cartesian product.</p>\n\n<p>A different way of encoding this is to start an independent concurrent computation for each of the choices, at once,   producing the final results without any inherent order.</p>\n"}], "owner": {"reputation": 4829, "user_id": 1852230, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1c009726dbacdd3e428afeb48d9eef63?s=128&d=identicon&r=PG", "display_name": "jcm", "link": "https://stackoverflow.com/users/1852230/jcm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2568, "favorite_count": 5, "answer_count": 3, "score": 29, "last_activity_date": 1430187027, "creation_date": 1430106470, "last_edit_date": 1430106840, "question_id": 29886852, "link": "https://stackoverflow.com/questions/29886852/why-is-the-following-haskell-code-non-deterministic", "title": "Why is the following Haskell code non-deterministic?", "body": "<p>I've been learning Haskell from <a href=\"http://learnyouahaskell.com/chapters\">Learn You A Haskell</a> and <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\">just came across the following statement</a>:</p>\n\n<blockquote>\n  <p>Doing <code>(+) &lt;$&gt; [1,2] &lt;*&gt; [4,5,6]</code> results in a non-deterministic\n  computation <code>x + y</code> where <code>x</code> takes on every value from <code>[1,2]</code> and <code>y</code> takes\n  on every value from <code>[4,5,6]</code>.</p>\n</blockquote>\n\n<p>I don't think I understand what is non-deterministic about this. Is it just that the order of the results or the order of computation is not guaranteed to be the same every time?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 3, "creation_date": 1430107730, "post_id": 29886844, "comment_id": 47897963, "body": "Not entirely sure, but could it be that <code>Just</code> is being treated like <code>Nothing</code> i.e. as a constructor without any parameters? That would explain the issue."}], "answers": [{"tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 11, "last_activity_date": 1430114437, "creation_date": 1430114437, "answer_id": 29888248, "question_id": 29886844, "link": "https://stackoverflow.com/questions/29886844/different-numbers-of-arguments-when-pattern-matching-maybe/29888248#29888248", "title": "Different numbers of arguments when pattern matching Maybe", "body": "<p>You're correct, there's not ambiguity about whether or not <code>Just</code> is a constructor \u2013 but constructors can have no arguments!  Haskell's pattern matching doesn't look up the names involved, it's strictly syntactic, and <code>foo Just x = x</code> is a perfectly well-formed function definition clause.  It's ill-<em>typed</em>:</p>\n\n<pre><code>Prelude&gt; let foo Just x = x\n\n&lt;interactive&gt;:2:9:\n    Constructor \u2018Just\u2019 should have 1 argument, but has been given none\n    In the pattern: Just\n    In an equation for \u2018foo\u2019: foo Just x = x\n</code></pre>\n\n<p>but with different data types around, it'd be fine:</p>\n\n<pre><code>Prelude&gt; data Justice = Just\nPrelude&gt; let foo Just x = x\nPrelude&gt; :t foo\nfoo :: Justice -&gt; t -&gt; t\nPrelude&gt; foo Just ()\n()\n</code></pre>\n\n<p><code>Just</code> could be a nullary constructor (as in the second example), and since function application is left-associative, the compiler parses <code>Just</code> and <code>x</code> as separate arguments and you get the \"different numbers of arguments\" error.  (And as you can see above, if there weren't the <code>Nothing</code> case, you'd actually get the type error for code of that form.)</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 4, "last_activity_date": 1430138680, "creation_date": 1430138680, "answer_id": 29896163, "question_id": 29886844, "link": "https://stackoverflow.com/questions/29886844/different-numbers-of-arguments-when-pattern-matching-maybe/29896163#29896163", "title": "Different numbers of arguments when pattern matching Maybe", "body": "<p>The idea is that pattern syntax should mirror application syntax. If I was <em>calling</em> <code>foo</code> I couldn't write <code>foo Just x</code>, because that means something else (and if <code>foo</code> had type <code>(Int -&gt; Maybe Int) -&gt; Int -&gt; Int</code> then it would even work). Having patterns have different rules for where parentheses are needed than expressions would be very weird.</p>\n\n<p>Writing compound patterns without parentheses and trusting the compiler to automatically group things also falls apart in more complex situations. What should this mean?</p>\n\n<pre><code>foo Just x : xs = ...\n</code></pre>\n"}], "owner": {"reputation": 2728, "user_id": 453273, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1a9ce578cf1f56e53ae38d1b0476d7e?s=128&d=identicon&r=PG", "display_name": "Rose Kunkel", "link": "https://stackoverflow.com/users/453273/rose-kunkel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1694, "favorite_count": 0, "accepted_answer_id": 29888248, "answer_count": 2, "score": 4, "last_activity_date": 1430138680, "creation_date": 1430106383, "question_id": 29886844, "link": "https://stackoverflow.com/questions/29886844/different-numbers-of-arguments-when-pattern-matching-maybe", "title": "Different numbers of arguments when pattern matching Maybe", "body": "<p>I've run into a problem I don't really understand. I thought that I would be able to write code like this in Haskell:</p>\n\n<pre><code>foo :: Maybe Int -&gt; Int\nfoo Nothing = 0\nfoo Just x = x\n</code></pre>\n\n<p>But when I try to compile it, I get the error:</p>\n\n<blockquote>\n  <p>Equations for \u2018foo\u2019 have different numbers of arguments</p>\n</blockquote>\n\n<p>I can fix it by changing my code to the following:</p>\n\n<pre><code>foo :: Maybe Int -&gt; Int\nfoo Nothing = 0\nfoo (Just x) = x\n</code></pre>\n\n<p>Which makes me think that GHC is interpreting <code>Just</code> as an argument to <code>foo</code>. But Haskell forbids using uppercase letters to start variable names, so I wouldn't think there should be any ambiguity here. What's going on?</p>\n"}, {"tags": ["haskell", "types", "fold"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430111265, "post_id": 29885983, "comment_id": 47898937, "body": "Hi - I added the default-trick to the answer to your original question to show you how you could fix your <code>zip</code> there - you should be able to use this to get this working too (but you will have to puzzle quite a bit more with the types, definitions, etc.)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430128962, "post_id": 29885983, "comment_id": 47908367, "body": "@CarstenK&#246;nig no matter; but won&#39;t I need <i>mutually</i> recursive types here? is it much different from what you&#39;ve added there? (btw I assumed the &quot;weaving&quot; instead of zipping in that OP&#39;s code was an error on their part)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430131410, "post_id": 29885983, "comment_id": 47909946, "body": "I did not really try it and it might be easier to cheat the different types in there with an Either, use the strange <code>zipCat</code> and then just take it&#39;s output to <code>unzip</code> inline (if you get what I mean)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430282936, "post_id": 29885983, "comment_id": 47991192, "body": "@WillNess that&#39;s actually what I wanted (equivalent to <code>(\\a b -&gt; concat (zipWith (\\a b-&gt;[a,b]) a b))</code>), since I noticed it would look so good without the tuple constructor! Not really trying to implement <code>zip</code> but gain an insight."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430278215, "post_id": 29930561, "comment_id": 47989753, "body": "Neat. Also, not sure why zipp would be more efficient."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 5, "creation_date": 1430344830, "post_id": 29930561, "comment_id": 48031448, "body": "@Viclib Oleg&#39;s version is O(n^2), while <code>zipp</code> is O(N). Actually, <code>zipp</code> and your <code>zip</code> really piqued my interest because I initially thought that it was impossible to do this in O(N), and I suspected the functions to be wrong somehow.  But alas, I managed to prove them OK in Agda. It&#39;s neat how your wacky untyped lambda term turned out to have a type. I think it could be worthwhile to further investigate <code>zipp</code> and other functions like it, I think there is more than meets the eye here."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1430448646, "post_id": 29930561, "comment_id": 48081433, "body": "at Oleg&#39;s link that you gave in your answer, he mentions a previous version of his, &quot;with a recursive type&quot;. I think what he referred to is <a href=\"https://mail.haskell.org/pipermail/haskell/2005-October/016577.html\" rel=\"nofollow noreferrer\">this</a>. There&#39;s an <code>szip</code> function there, near the end; it looks like my code does something that is very similar to it."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1430450454, "post_id": 29930561, "comment_id": 48081841, "body": "and here&#39;s <a href=\"https://mail.haskell.org/pipermail/haskell/2005-October/016693.html\" rel=\"nofollow noreferrer\">another post from that thread</a> discussing possible relevance of this to fusion optimizations for <code>zip</code>, as you mentioned."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1434318272, "post_id": 29930561, "comment_id": 49714252, "body": "If you have an induction principle, you can always emulate case expressions. And if you can emulate case expressions, zipping is <a href=\"https://github.com/effectfully/random-stuff/blob/master/stuff/Lists/zipWith-via-elim.agda\" rel=\"nofollow noreferrer\">not a problem</a>."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1434350623, "post_id": 29930561, "comment_id": 49721758, "body": "@user3237465 that&#39;s the &quot;standard&quot; O(N^2) solution; the implementation in the question and my answer is O(N), which makes it rather more interesting, as I commented above."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1434361140, "post_id": 29930561, "comment_id": 49727447, "body": "No, it&#39;s O(n). <code>caseList</code> truly deconstructs a list, much like in the <a href=\"https://github.com/effectfully/random-stuff/blob/master/stuff/Lists/PList.hs\" rel=\"nofollow noreferrer\">PLists</a> approach, which is a mix of <a href=\"https://github.com/effectfully/random-stuff/blob/master/stuff/Lists/ChurchScott.hs\" rel=\"nofollow noreferrer\">Church and Scott encoding</a>. You can rewrite every function, that doesn&#39;t exploit the axiom K, using just eliminators. And it will have the same computational complexity (but you will need to rewrite functions like Berry\u2019s majority in sequential form). That&#39;s what Epigram <a href=\"http://strictlypositive.org/vfl.pdf\" rel=\"nofollow noreferrer\">did</a>."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1434366631, "post_id": 29930561, "comment_id": 49730651, "body": "@user3237465 my fault, that&#39;s O(n) indeed in Agda. I note though that by making use of the <code>{xs}</code> argument in <code>elimList</code>, you use it effectively as a paramorphism (repairing the asymptotics), and we can&#39;t translate that to an untyped lambda term that works on pure Church-encoded lists and runs in O(n)."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1434368475, "post_id": 29930561, "comment_id": 49731809, "body": "In pure lambda calculus we can convert Church-encoded lists to Scott-encoded lists, zip and convert back. All operations are O(n). However there is no way to zip two lists in O(n) in pure system F, as <a href=\"http://www.sciencedirect.com/science/article/pii/0304397591900395\" rel=\"nofollow noreferrer\">proved</a> by Lo&#239;c Colson."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1479349937, "post_id": 29930561, "comment_id": 68523385, "body": "@Andr&#225;sKov&#225;cs Coming back to this answer 1 year later it makes more sense now... I almost get it. Just wondering, assuming that <code>self-types</code> system we discussed previously is strongly normalizing, then is the original solution using <code>fix</code> an acceptable answer here? I&#39;ve posted a follow-up question on typing this in Morte."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544656960, "post_id": 29930561, "comment_id": 94358603, "body": "Now you&#39;re making me wonder: what are the corresponding problem and solution for <i>coinductive</i> (potentially infinite) lists?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544695759, "post_id": 29930561, "comment_id": 94370768, "body": "@dfeuer colists can be always zipped efficiently."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1544726632, "post_id": 29930561, "comment_id": 94388280, "body": "I mean... what&#39;s the equivalent of the &quot;zip with <code>foldr</code> only&quot; condition for colists? You can easily &quot;unzip with <code>unfoldr</code> only&quot; using the <code>unzip xs = (fmap fst xs, fmap snd xs)</code>, but maybe there&#39;s some more interesting analogue?"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 7, "last_activity_date": 1430344127, "last_edit_date": 1430344127, "creation_date": 1430257782, "answer_id": 29930561, "question_id": 29885983, "link": "https://stackoverflow.com/questions/29885983/infinite-type-error-when-defining-zip-with-foldr-only-can-it-be-fixed/29930561#29930561", "title": "Infinite type error when defining zip with foldr only; can it be fixed?", "body": "<p>My issue with using <code>Fix</code> to type <code>zipp</code> (as I pointed out in the comments to Carsten's answer to the <a href=\"https://stackoverflow.com/questions/29879944/why-haskell-doesnt-accept-my-combinatoric-zip-definition\">prior question</a>) is that no total language contains the <code>Fix</code> type:</p>\n\n<pre><code>newtype Fix a = Fix { unFix :: Fix a -&gt; [a] }\n\nfixList :: ([a] -&gt; [a]) -&gt; [a]\nfixList f = (\\g -&gt; f (unFix g g)) $ Fix (\\g -&gt; f (unFix g g))\n\ndiverges :: [a]\ndiverges = fixList id\n</code></pre>\n\n<p>This may seem to be an obscure issue, but it really is nice to have an implementation in a total language, because that also constitutes a formal proof of termination. So let's find a type for <code>zipp</code> in Agda. </p>\n\n<p>First, let's stick for a while with Haskell. If we manually unfold the definitions of <code>zip1</code> and <code>zip2</code> for some fixed lists, we find that all of the unfoldings have proper types, and we can apply any unfolding of <code>zip1</code> to any unfolding of <code>zip2</code>, and the types line up (and we get the correct results). </p>\n\n<pre><code>-- unfold zip1 for [1, 0]\nf0 k = []        -- zip1 []\nf1 k = k 0 f0    -- zip1 [0]\nf2 k = k 1 f1    -- zip1 [1, 0]\n\n-- unfold zip2 for [5, 3]\ng0 x r = []               -- zip2 []\ng1 x r = (x, 3) : r g0    -- zip2 [3]\ng2 x r = (x, 5) : r g1    -- zip2 [3, 5]\n\n-- testing\nf2 g2 -- [(1, 5), (0, 3)]\nf2 g0 -- []\n\n-- looking at some of the types in GHCI\nf0 :: t -&gt; [t1]\nf1 :: Num a =&gt; (a -&gt; (t1 -&gt; [t2]) -&gt; t) -&gt; t\ng0 :: t -&gt; t1 -&gt; [t2]\ng1 :: Num t1 =&gt; t -&gt; ((t2 -&gt; t3 -&gt; [t4]) -&gt; [(t, t1)]) -&gt; [(t, t1)]\n</code></pre>\n\n<p>We conjecture that the types can be unified for any <em>particular</em> combination of <code>zip1</code>-s and <code>zip2</code>-s, but we can't express this with the usual <code>foldr</code>, because there is an infinite number of different types for all the unfoldings. So we switch to Agda now. </p>\n\n<p>Some preliminaries and the usual definition for dependent <code>foldr</code>:</p>\n\n<pre><code>open import Data.Nat\nopen import Data.List hiding (foldr)\nopen import Function\nopen import Data.Empty\nopen import Relation.Binary.PropositionalEquality\nopen import Data.Product\n\nfoldr :\n    {A : Set}\n    (B : List A \u2192 Set)\n  \u2192 (\u2200 {xs} x \u2192 B xs \u2192 B (x \u2237 xs))\n  \u2192 B []    \n  \u2192 (xs : List A)\n  \u2192 B xs\nfoldr B f z []       = z\nfoldr B f z (x \u2237 xs) = f x (foldr B f z xs)\n</code></pre>\n\n<p>We notice that the types of the unfoldings depend on the length of the to-be-zipped list, so we concoct two functions to generate these types. <code>A</code> is the type of the elements of the first list, <code>B</code> is the type of the elements of the second list and <code>C</code> is a parameter for the argument that we ignore when we get to the end of the list. <code>n</code> is the length of the list, of course.</p>\n\n<pre><code>Zip1 : Set \u2192 Set \u2192 Set \u2192 \u2115 \u2192 Set\nZip1 A B C zero    = C \u2192 List (A \u00d7 B)\nZip1 A B C (suc n) = (A \u2192 Zip1 A B C n \u2192 List (A \u00d7 B)) \u2192 List (A \u00d7 B)\n\nZip2 : Set \u2192 Set \u2192 Set \u2192 \u2115 \u2192 Set\nZip2 A B C zero    = A \u2192 C \u2192 List (A \u00d7 B)\nZip2 A B C (suc n) = A \u2192 (Zip2 A B C n \u2192 List (A \u00d7 B)) \u2192 List (A \u00d7 B)\n</code></pre>\n\n<p>We need to prove now that we can indeed apply any <code>Zip1</code> to any <code>Zip2</code>, and get back a <code>List (A \u00d7 B)</code> as result. </p>\n\n<pre><code>unifyZip : \u2200 A B n m \u2192 \u2203\u2082 \u03bb C\u2081 C\u2082 \u2192 Zip1 A B C\u2081 n \u2261 (Zip2 A B C\u2082 m \u2192 List (A \u00d7 B))\nunifyZip A B zero    m       = Zip2 A B \u22a5 m , \u22a5 , refl\nunifyZip A B (suc n) zero    = \u22a5 , Zip1 A B \u22a5 n , refl\nunifyZip A B (suc n) (suc m) with unifyZip A B n m\n... | C\u2081 , C\u2082 , p = C\u2081 , C\u2082 , cong (\u03bb t \u2192 (A \u2192 t \u2192 List (A \u00d7 B)) \u2192 List (A \u00d7 B)) p\n</code></pre>\n\n<p>The type of <code>unifyZip</code> in English: \"for all <code>A</code> and <code>B</code> types and <code>n</code> and <code>m</code> natural numbers, there exist some <code>C\u2081</code> and <code>C\u2082</code> types such that <code>Zip1 A B C\u2081 n</code> is a function from <code>Zip2 A B C\u2082 m</code> to <code>List (A \u00d7 B)</code>\".</p>\n\n<p>The proof itself is straightforward; if we hit the end of either zippers, we instantiate the input type of the empty zipper to the type of the other zipper. The use of the empty type (\u22a5) communicates that the choice of type for that parameter is arbitrary. In the recursive case we just bump the equality proof by one step of iteration. </p>\n\n<p>Now we can write <code>zipp</code>:</p>\n\n<pre><code>zip1 : \u2200 A B C (as : List A) \u2192 Zip1 A B C (length as)\nzip1 A B C = foldr (Zip1 A B C \u2218 length) (\u03bb x r k \u2192 k x r) (\u03bb _ \u2192 [])\n\nzip2 : \u2200 A B C (bs : List B) \u2192 Zip2 A B C (length bs)\nzip2 A B C = foldr (Zip2 A B C \u2218 length) (\u03bb y k x r \u2192 (x , y) \u2237 r k) (\u03bb _ _ \u2192 [])\n\nzipp : \u2200 {A B : Set} \u2192 List A \u2192 List B \u2192 List (A \u00d7 B)\nzipp {A}{B} xs ys with unifyZip A B (length xs) (length ys)\n... | C\u2081 , C\u2082 , p with zip1 A B C\u2081 xs | zip2 A B C\u2082 ys\n... | zxs | zys rewrite p = zxs zys\n</code></pre>\n\n<p>If we squint a bit and try to ignore ignore the proofs in the code, we find that <code>zipp</code> is indeed operationally the same as the Haskell definition. In fact, the code becomes <em>exactly</em> the same after all the erasable proofs have been erased. Agda probably doesn't do this erasure, but the Idris compiler certainly does. </p>\n\n<p>(As a side note, I wonder if we could make use of clever functions like <code>zipp</code> in fusion optimizations. <code>zipp</code> seems to be more efficient than Oleg Kiselyov's <a href=\"http://okmij.org/ftp/Algorithms.html#zip-folds\" rel=\"noreferrer\">fold zipping.</a> But <code>zipp</code> doesn't seem to have a System F type; maybe we could try encoding data as dependent eliminators (induction principles) instead of the usual eliminators, and try to fuse those representations?)</p>\n"}, {"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 2, "creation_date": 1430315806, "post_id": 29945884, "comment_id": 48012602, "body": "Oh - that&#39;s awesome. Something I&#39;d not be able to come up with, at all. Congratulations! :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430315853, "post_id": 29945884, "comment_id": 48012644, "body": "@Viclib Thanks a lot, for asking the question too!!"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 4, "last_activity_date": 1544227899, "last_edit_date": 1544227899, "creation_date": 1430315739, "answer_id": 29945884, "question_id": 29885983, "link": "https://stackoverflow.com/questions/29885983/infinite-type-error-when-defining-zip-with-foldr-only-can-it-be-fixed/29945884#29945884", "title": "Infinite type error when defining zip with foldr only; can it be fixed?", "body": "<p>Applying the insight from <a href=\"https://stackoverflow.com/a/29944707/849891\">my other answer</a>, I was able to <a href=\"http://ideone.com/tgAK0A\" rel=\"nofollow noreferrer\">solve it</a>, by defining two mutually-recursive types:</p>\n\n<pre><code>-- tr ~ tq -&gt; [(a,b)]\n-- tq ~ a -&gt; tr -&gt; [(a,b)]\n\nnewtype Tr a b = R { runR ::  Tq a b -&gt; [(a,b)] }\nnewtype Tq a b = Q { runQ ::  a -&gt; Tr a b -&gt; [(a,b)] }\n\nzipp :: [a] -&gt; [b] -&gt; [(a,b)]\nzipp xs ys = runR (zip1 xs) (zip2 ys)\n  where\n     zip1 = foldr (\\ x r -&gt; R $ \\q -&gt; runQ q x r ) n \n     n = R (\\_ -&gt; [])\n\n     zip2 = foldr (\\ y q -&gt; Q $ \\x r -&gt; (x,y) : runR r q ) m \n     m = Q (\\_ _ -&gt; [])\n\nmain = print $ zipp [1..3] [10,20..]\n-- [(1,10),(2,20),(3,30)]\n</code></pre>\n\n<p>The translation from type equivalency to type definition was purely mechanical, so maybe compiler could do this for us, too!</p>\n"}], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 658, "favorite_count": 5, "accepted_answer_id": 29945884, "answer_count": 2, "score": 7, "last_activity_date": 1544227899, "creation_date": 1430099972, "last_edit_date": 1430105880, "question_id": 29885983, "link": "https://stackoverflow.com/questions/29885983/infinite-type-error-when-defining-zip-with-foldr-only-can-it-be-fixed", "title": "Infinite type error when defining zip with foldr only; can it be fixed?", "body": "<p>(for the context to this see <a href=\"https://stackoverflow.com/questions/29879944/why-haskell-doesnt-accept-my-combinatoric-zip-definition\">this recent SO entry</a>).</p>\n\n<p>I tried to come up with the definition of <code>zip</code> using <code>foldr</code> only:</p>\n\n<pre><code>zipp :: [a] -&gt; [b] -&gt; [(a,b)]\nzipp xs ys = zip1 xs (zip2 ys)\n  where\n     -- zip1 :: [a] -&gt; tq -&gt; [(a,b)]          -- zip1 xs :: tr ~ tq -&gt; [(a,b)]\n     zip1 xs q = foldr (\\ x r q -&gt; q x r ) n xs q \n                       -------- c --------\n     n    q  = []\n\n     -- zip2 :: [b] -&gt; a -&gt; tr -&gt; [(a,b)]     -- zip2 ys :: tq ~ a -&gt; tr -&gt; [(a,b)]\n     zip2 ys x r = foldr (\\ y q x r -&gt; (x,y) : r q ) m ys x r  \n                         ---------- k --------------\n     m  x r  = []\n{-\n      zipp [x1,x2,x3] [y1,y2,y3,y4]\n\n    = c x1 (c x2 (c xn n)) (k y1 (k y2 (k y3 (k y4 m))))\n           ---------------       ----------------------\n            r                    q\n\n    = k y1 (k y2 (k y3 (k y4 m))) x1 (c x2 (c xn n))\n           ----------------------    ---------------\n           q                         r\n-}\n</code></pre>\n\n<p>It \"works\" on paper, but gives two \"infinite type\" errors:</p>\n\n<pre><code>Occurs check: cannot construct the infinite type:\n  t1 ~ (a -&gt; t1 -&gt; [(a, b)]) -&gt; [(a, b)]             -- tr\n\nOccurs check: cannot construct the infinite type:\n  t0 ~ a -&gt; (t0 -&gt; [(a, b)]) -&gt; [(a, b)]             -- tq\n</code></pre>\n\n<p>Evidently, each type <code>tr</code>, <code>tq</code>, depends on the other, in a circular manner.</p>\n\n<p>Is there any way to make it work, by some type sorcery or something? </p>\n\n<p>I use  Haskell Platform 2014.2.0.0 with GHCi 7.8.3 on Win7.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "edited": false, "score": 0, "creation_date": 1430090569, "post_id": 29884768, "comment_id": 47893632, "body": "could you please show what exactly are you trying to print? what is <code>it</code>?"}, {"owner": {"reputation": 269, "user_id": 1084637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/745239e23061d746727436ec06e5dd2e?s=128&d=identicon&r=PG", "display_name": "asp5", "link": "https://stackoverflow.com/users/1084637/asp5"}, "reply_to_user": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "edited": false, "score": 0, "creation_date": 1430090664, "post_id": 29884768, "comment_id": 47893652, "body": "Hi I&#39;m trying to print<code>*Main&gt; [3 : [[]]]  &lt;interactive&gt;:17:1:     No instance for (Num [t0]) arising from a use of \u2018it\u2019     In a stmt of an interactive GHCi command: print it </code>"}, {"owner": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "edited": false, "score": 0, "creation_date": 1430090771, "post_id": 29884768, "comment_id": 47893674, "body": "Well, I guess that problem is <code>[3 : [[]]]</code> expression could not be typed by ghci well, because first element is <code>Num a</code> and second element is list of lists, not lists of Nums. This is what compiler is trying to say to you"}, {"owner": {"reputation": 269, "user_id": 1084637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/745239e23061d746727436ec06e5dd2e?s=128&d=identicon&r=PG", "display_name": "asp5", "link": "https://stackoverflow.com/users/1084637/asp5"}, "reply_to_user": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "edited": false, "score": 0, "creation_date": 1430091001, "post_id": 29884768, "comment_id": 47893733, "body": "Thanks for your quick response, so its just a problem with GHCI not able to figure out the type of the expression? Is the rest of my understanding correct, other than the print issue? what would x_start be [[3]] or [[3, []]]"}], "answers": [{"comments": [{"owner": {"reputation": 269, "user_id": 1084637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/745239e23061d746727436ec06e5dd2e?s=128&d=identicon&r=PG", "display_name": "asp5", "link": "https://stackoverflow.com/users/1084637/asp5"}, "edited": false, "score": 0, "creation_date": 1430092012, "post_id": 29884962, "comment_id": 47894014, "body": "Hi Wouldn&#39;t *Main&gt; [[3] : (combinations 0 [4]) ] be [[[3],[]]] And if we [[[3],[]]]  ++ combinations 1 [4] be  <code>[[3],[],[4]]</code> which is NOT [[3], [4]]...."}, {"owner": {"reputation": 269, "user_id": 1084637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/745239e23061d746727436ec06e5dd2e?s=128&d=identicon&r=PG", "display_name": "asp5", "link": "https://stackoverflow.com/users/1084637/asp5"}, "edited": false, "score": 0, "creation_date": 1430092906, "post_id": 29884962, "comment_id": 47894267, "body": "I&#39;m just trying to understand how <code>combinations 1 [3,4]</code> is giving <code>[[3],[4]]</code> instead of <code>[[3], [], [4], []]</code> how is the empty list avoided and not inserted in the final list constructed."}, {"owner": {"reputation": 269, "user_id": 1084637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/745239e23061d746727436ec06e5dd2e?s=128&d=identicon&r=PG", "display_name": "asp5", "link": "https://stackoverflow.com/users/1084637/asp5"}, "edited": false, "score": 0, "creation_date": 1430093291, "post_id": 29884962, "comment_id": 47894365, "body": "Thanks a lot for the explanation."}], "tags": [], "owner": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "is_accepted": true, "score": 3, "last_activity_date": 1430093323, "last_edit_date": 1430093323, "creation_date": 1430091528, "answer_id": 29884962, "question_id": 29884768, "link": "https://stackoverflow.com/questions/29884768/haskell-list-append-operation/29884962#29884962", "title": "Haskell: List append operation", "body": "<blockquote>\n  <p>We will start with computing x_start which will be x_start = [3 : combinations 0 [4]]</p>\n</blockquote>\n\n<p>This is not true, because <code>x_start</code> and <code>others</code> are of type <code>[[a1]]</code>. So it's more likely that <code>x_start = [3] : rest</code>, where <code>rest</code> is coming (since list comprehension here is just a syntax sugar with List Monad <code>&lt;-</code> usage) from the <code>combinations 0 [4]</code>. Because of definition <code>combinations 0 [4]</code> is a <code>[[]]</code>, thus there is only one value came from it - <code>[]</code>. Finally,  <code>[3] : []</code> is <code>[[3]]</code>.</p>\n\n<p>As it mentioned in the comments, <code>[3 : [[]]]</code> expression could not be typed by ghci well, because first element is Num a and second element is list of lists, not lists of <code>Num</code>s. This is what compiler is trying to say.</p>\n"}], "owner": {"reputation": 269, "user_id": 1084637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/745239e23061d746727436ec06e5dd2e?s=128&d=identicon&r=PG", "display_name": "asp5", "link": "https://stackoverflow.com/users/1084637/asp5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 29884962, "answer_count": 1, "score": 0, "last_activity_date": 1430093323, "creation_date": 1430090241, "question_id": 29884768, "link": "https://stackoverflow.com/questions/29884768/haskell-list-append-operation", "title": "Haskell: List append operation", "body": "<p>I'm looking at <a href=\"https://wiki.haskell.org/99_questions/Solutions/26\" rel=\"nofollow\">99 problems solved in Haskell</a>. I'm trying to understand few basics here.</p>\n\n<pre><code>    combinations :: Int -&gt; [a] -&gt; [[a]]\n    combinations _ [] = [[]]\n    combinations 0 _  = [[]]\n    combinations k (x:xs) = x_start ++ others\n    where x_start = [ x : rest | rest &lt;- combinations (k-1) xs ]\n          others  = if k &lt;= length xs then combinations k xs else []\n</code></pre>\n\n<p>consider, <code>combinations 1 [3, 4]</code></p>\n\n<p>pattern matches with the <code>combinations k (x:xs)</code>. We will start with computing x_start which will be <code>x_start = [3 : combinations 0 [4]]</code></p>\n\n<p><code>combinations 0 [4]</code> will pattern match with <code>combinations 0 [4]</code> and \"return\" <code>[[]]</code> (a list of 1 elem empty list)</p>\n\n<p>we now see <code>x_start = [3 : combinations 0 [4]] ===&gt; x_start = [3 : [[]]]</code>. Is this correct? if so what would x_start be at this point, going by list prepend operator <code>:</code>, will <code>x_start = [[3, []]]</code> which is not same as [[3]]? </p>\n\n<p>when I try to print this in ghci, it complains</p>\n\n<pre><code>No instance for (Num [t0]) arising from a use of \u2018it\u2019\nIn a stmt of an interactive GHCi command: print it\n</code></pre>\n"}, {"tags": ["string", "haskell", "count", "int", "range"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430084248, "post_id": 29883838, "comment_id": 47891701, "body": "maybe you can use <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#v:concatMap\" rel=\"nofollow noreferrer\"><code>concatMap</code></a> and <code>show</code> somehow ... (you idea was/is not far of - only that <code>read</code> is the other way around - better use <code>show</code> and <code>map</code> alone will not make you happy - but good start)"}, {"owner": {"reputation": 15, "user_id": 4835464, "user_type": "registered", "profile_image": "https://graph.facebook.com/465402496946461/picture?type=large", "display_name": "Saulius Kriauza", "link": "https://stackoverflow.com/users/4835464/saulius-kriauza"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430084565, "post_id": 29883838, "comment_id": 47891800, "body": "I&#39;ll try, thank you."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1430084780, "creation_date": 1430084780, "answer_id": 29883952, "question_id": 29883838, "link": "https://stackoverflow.com/questions/29883838/haskell-make-single-string-from-integer-set/29883952#29883952", "title": "Haskell, make single string from integer set?", "body": "<blockquote>\n  <p>I tried something like this, but it wouldn't work. <code>let intList = map (read::Int-&gt;String) [15..22]</code></p>\n</blockquote>\n\n<p>Well... the purpose of <code>read</code> is to parse strings to read-able values. Hence it has a type signature <code>String -&gt; a</code>, which obviously doesn't unify with <code>Int -&gt; String</code>. What you want here is the <em>inverse</em><sup>1</sup> of <code>read</code>, it's called <code>show</code>.</p>\n\n<p>Indeed <code>map show [15..22]</code> gives almost the result you asked for &ndash; the numbers as decimal-encoded strings &ndash; but still each number as a seperate list element, i.e. type <code>[String]</code> while you want only <code>String</code>. Well, how about <a href=\"https://www.haskell.org/hoogle/?hoogle=[String]+-%3E+String\" rel=\"nofollow\">asking Hoogle</a>? It gives the function you need as the fifth hit: <code>concat</code>.</p>\n\n<p>If you want to get fancy you can then combine the <code>map</code> and <code>concat</code> stages: both the <code>concatMap</code> function and the <code>&gt;&gt;=</code> operator do that. The most compact way to achieve the result: <code>[15..22]&gt;&gt;=show</code>.</p>\n\n<hr>\n\n<p><sup>1</sup><sub><code>show</code> is only the <em>right inverse</em> of <code>read</code>, to be precise.</sub></p>\n"}], "owner": {"reputation": 15, "user_id": 4835464, "user_type": "registered", "profile_image": "https://graph.facebook.com/465402496946461/picture?type=large", "display_name": "Saulius Kriauza", "link": "https://stackoverflow.com/users/4835464/saulius-kriauza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 0, "accepted_answer_id": 29883952, "answer_count": 1, "score": 1, "last_activity_date": 1430084780, "creation_date": 1430083993, "question_id": 29883838, "link": "https://stackoverflow.com/questions/29883838/haskell-make-single-string-from-integer-set", "title": "Haskell, make single string from integer set?", "body": "<p>I'd greatly appreciate if you could tell me how to make a single string from a range between two ints. Like [5..10] i would need to get a \"5678910\". And then I'd have to calculate how many (zeroes, ones ... nines) there are in a string. </p>\n\n<p>For example: if i have a range from [1..10] i'd need to print out</p>\n\n<p>1 2 1 1 1 1 1 1 1 1 </p>\n\n<p>For now i only have a function to search for a element in string.</p>\n\n<pre><code>`countOfElem elem list = length $ filter (\\x -&gt; x == elem) list`\n</code></pre>\n\n<p>But the part how to construct such a string is bugging me out, or maybe there is an easier way? Thank you.</p>\n\n<p>I tried something like this, but it wouldn't work. \n<code>let intList = map (read::Int-&gt;String) [15..22]</code></p>\n"}, {"tags": ["haskell", "tcplistener"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430081626, "post_id": 29883326, "comment_id": 47890747, "body": "first please add the error-message you get - thanks"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430082942, "post_id": 29883326, "comment_id": 47891261, "body": "<b>btw</b>: most of the first stuff is from the <i>indentation</i>  problem I thought was introduced with your copy&amp;pasting the code into Stack-Overflow - but it seems you really intended it all to the level of <code>acceptFork</code> (and I wrongly edited out ;) )"}], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 4676799, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-y648oz0HCX0/AAAAAAAAAAI/AAAAAAAAAN0/xL7ihGVzOjI/photo.jpg?sz=128", "display_name": "Cristian Balint", "link": "https://stackoverflow.com/users/4676799/cristian-balint"}, "edited": false, "score": 0, "creation_date": 1430083299, "post_id": 29883609, "comment_id": 47891402, "body": "Thank you. And two more questions: 1. What should I do with the thread&#39;s id? Do I even need it? 2. Where should I call this function recursively to be able to handle the next client?"}, {"owner": {"reputation": 147, "user_id": 4676799, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-y648oz0HCX0/AAAAAAAAAAI/AAAAAAAAAN0/xL7ihGVzOjI/photo.jpg?sz=128", "display_name": "Cristian Balint", "link": "https://stackoverflow.com/users/4676799/cristian-balint"}, "edited": false, "score": 0, "creation_date": 1430083404, "post_id": 29883609, "comment_id": 47891441, "body": "BTW, now I get only one error:  <code>Couldn&#39;t match type </code>ThreadId&#39; with <code>()&#39; Expected type: IO ()   Actual type: IO ThreadId</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 147, "user_id": 4676799, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-y648oz0HCX0/AAAAAAAAAAI/AAAAAAAAAN0/xL7ihGVzOjI/photo.jpg?sz=128", "display_name": "Cristian Balint", "link": "https://stackoverflow.com/users/4676799/cristian-balint"}, "edited": false, "score": 0, "creation_date": 1430083458, "post_id": 29883609, "comment_id": 47891464, "body": "if you don&#39;t need the id just ignore it - and on how you should call it? Well maybe you might want to call it recursively to wait for the next caller - but this will depend on your problem"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 147, "user_id": 4676799, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-y648oz0HCX0/AAAAAAAAAAI/AAAAAAAAAN0/xL7ihGVzOjI/photo.jpg?sz=128", "display_name": "Cristian Balint", "link": "https://stackoverflow.com/users/4676799/cristian-balint"}, "edited": false, "score": 0, "creation_date": 1430083507, "post_id": 29883609, "comment_id": 47891482, "body": "you get the new error either because you did not change the signature of <code>acceptFork</code> or where you are using it - I will edit out the <code>ThreadId</code>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 147, "user_id": 4676799, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-y648oz0HCX0/AAAAAAAAAAI/AAAAAAAAAN0/xL7ihGVzOjI/photo.jpg?sz=128", "display_name": "Cristian Balint", "link": "https://stackoverflow.com/users/4676799/cristian-balint"}, "edited": false, "score": 0, "creation_date": 1430083710, "post_id": 29883609, "comment_id": 47891541, "body": "btw: why write your own HTTP server anyway? There are plenty out there (look for <a href=\"https://hackage.haskell.org/package/scotty\" rel=\"nofollow noreferrer\">Scotty</a> if you need a very lightweigth one) - I understand it if you want to experiment but if you want results quickly better look for a framework"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 0, "last_activity_date": 1430084060, "last_edit_date": 1430084060, "creation_date": 1430082769, "answer_id": 29883609, "question_id": 29883326, "link": "https://stackoverflow.com/questions/29883326/haskell-acceptfork-for-http-server/29883609#29883609", "title": "haskell acceptFork for http server", "body": "<p>ok, I copied what you have and added the missing parts (for network > 2.6 and &lt; 2.7):</p>\n\n<pre><code>import qualified Network.Socket as NS\nimport System.IO (Handle, hSetBuffering, hSetNewlineMode, BufferMode(..), Newline(..), NewlineMode(..), IOMode(..))\nimport Control.Concurrent (forkIO, ThreadId)\n\nacceptFork :: NS.Socket -&gt; (Handle -&gt; IO ()) -&gt; IO ThreadId\nacceptFork lsock k = do\n    (csock,_) &lt;- NS.accept lsock\n    hsock &lt;- NS.socketToHandle csock ReadWriteMode\n    hSetBuffering hsock NoBuffering\n    hSetNewlineMode hsock (NewlineMode CRLF CRLF)\n    forkIO (k hsock)\n</code></pre>\n\n<p>basically you have:</p>\n\n<ul>\n<li>lot's of missing imports</li>\n<li>need to get the handle from the socket via <code>NS.socketToHandle</code></li>\n<li>watch out for the result of <code>forkIO</code> (the new thread's id)</li>\n</ul>\n\n<p>this compiles under:</p>\n\n<pre><code> base &gt;=4.8 &amp;&amp; &lt;4.9, network &gt;=2.6 &amp;&amp; &lt;2.7\n</code></pre>\n\n<h3>disclaimer</h3>\n\n<p>I did <strong>not</strong> run this code so I have no clue if it works - but it will compile (on my system ;) )</p>\n\n<h3>without <code>ThreadId</code>:</h3>\n\n<p>just change the signature and last lines:</p>\n\n<pre><code>acceptFork :: NS.Socket -&gt; (Handle -&gt; IO ()) -&gt; IO ()\nacceptFork lsock k = do\n    -- ... same as above\n    _ &lt;- forkIO (k hsock)\n    return ()\n</code></pre>\n\n<h3>fork and wait for the next connection:</h3>\n\n<p>just call <code>acceptFork</code> recursively</p>\n\n<pre><code>acceptFork :: NS.Socket -&gt; (Handle -&gt; IO ()) -&gt; IO ()\nacceptFork lsock k = do\n    (csock,_) &lt;- NS.accept lsock\n    hsock &lt;- NS.socketToHandle csock ReadWriteMode\n    hSetBuffering hsock NoBuffering\n    hSetNewlineMode hsock (NewlineMode CRLF CRLF)\n    _ &lt;- forkIO (k hsock)\n    acceptFork lsock k\n</code></pre>\n\n<p>or use <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Monad.html#v:forever\" rel=\"nofollow\"><code>forever</code></a></p>\n\n<pre><code>...\nimport Control.Monad (forever)\n\nacceptFork :: NS.Socket -&gt; (Handle -&gt; IO ()) -&gt; IO ()\nacceptFork lsock k = ...\n\nacceptAll :: NS.Socket -&gt; (Handle -&gt; IO ()) -&gt; IO ()\nacceptAll sock = forever . acceptFork sock \n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 4676799, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-y648oz0HCX0/AAAAAAAAAAI/AAAAAAAAAN0/xL7ihGVzOjI/photo.jpg?sz=128", "display_name": "Cristian Balint", "link": "https://stackoverflow.com/users/4676799/cristian-balint"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 29883609, "answer_count": 1, "score": 0, "last_activity_date": 1430084060, "creation_date": 1430081255, "last_edit_date": 1430082585, "question_id": 29883326, "link": "https://stackoverflow.com/questions/29883326/haskell-acceptfork-for-http-server", "title": "haskell acceptFork for http server", "body": "<p>I have to create a http server in haskell. For this I have to define an acceptFork function which handles the incoming TCP connections, which has the following type:</p>\n\n<pre><code>acceptFork :: Socket -&gt; (Handle -&gt; IO ()) -&gt; IO ()\n</code></pre>\n\n<p>The way how this should work is the following:</p>\n\n<ul>\n<li>use the accept function to accept an incoming connection, which returns a Handle</li>\n<li>disable buffering with hSetBuffering function (set value to NoBuffering)</li>\n<li>set new line char with hSetNewlineMode function (use parameter (NewlineMode CRLF CRLF))</li>\n<li>start a new thread which runs the input action on the handle value</li>\n<li>recurisvely wait for the next connection</li>\n</ul>\n\n<p>What I've came up with so far is this:</p>\n\n<pre><code>import qualified Network.Socket as NS\n\nacceptFork :: Socket -&gt; (Handle -&gt; IO ()) -&gt; IO ()\nacceptFork lsock k = do\n    (csock,_) &lt;- NS.accept lsock\n    hSetBuffering lsock NoBuffering\n    hSetNewlineMode lsock (NewlineMode CRLF CRLF)\n    forkIO (k csock) \n</code></pre>\n\n<p>The problem is that it doesn't even compile. Can someone please explain what I'm doing wrong? Thanks!</p>\n\n<p>This is the error that I get:</p>\n\n<pre><code>bead2.hs:31:23:\nCouldn't match expected type `(Handle -&gt; BufferMode -&gt; IO ())\n                              -&gt; Socket\n                              -&gt; BufferMode\n                              -&gt; (Handle -&gt; NewlineMode -&gt; IO ())\n                              -&gt; Socket\n                              -&gt; NewlineMode\n                              -&gt; IO (Handle, t0)'\n            with actual type `IO (Socket, NS.SockAddr)'\nThe function `NS.accept' is applied to 7 arguments,\nbut its type `Socket -&gt; IO (Socket, NS.SockAddr)' has only one\nIn a stmt of a 'do' block:\n  conn@(csock, _) &lt;- NS.accept\n                       lsock\n                       hSetBuffering\n                       lsock\n                       NoBuffering\n                       hSetNewlineMode\n                       lsock\n                       (NewlineMode CRLF CRLF)\nIn the expression:\n  do { conn@(csock, _) &lt;- NS.accept\n                            lsock\n                            hSetBuffering\n                            lsock\n                            NoBuffering\n                            hSetNewlineMode\n                            lsock\n                            (NewlineMode CRLF CRLF);\n       forkIO (k csock) }\n\nbead2.hs:34:5:\nCouldn't match type `ThreadId' with `()'\nExpected type: IO ()\n  Actual type: IO ThreadId\nIn a stmt of a 'do' block: forkIO (k csock)\nIn the expression:\n  do { conn@(csock, _) &lt;- NS.accept\n                            lsock\n                            hSetBuffering\n                            lsock\n                            NoBuffering\n                            hSetNewlineMode\n                            lsock\n                            (NewlineMode CRLF CRLF);\n       forkIO (k csock) }\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1430077114, "post_id": 29881897, "comment_id": 47889083, "body": "Did you run <code>ghc-pkg</code> check as the log suggests? That being said, I have no experience with GHC on Mac. Did you follow the installation guide at <a href=\"https://www.haskell.org/downloads/osx\" rel=\"nofollow noreferrer\">haskell.org/downloads/osx</a>?"}], "owner": {"reputation": 6742, "user_id": 91144, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0e3640d5d6cfd6f0e720501636d90c18?s=128&d=identicon&r=PG", "display_name": "Michael Barton", "link": "https://stackoverflow.com/users/91144/michael-barton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 0, "closed_date": 1457748714, "answer_count": 0, "score": 1, "last_activity_date": 1430073803, "creation_date": 1430073803, "question_id": 29881897, "link": "https://stackoverflow.com/questions/29881897/cant-install-haskell-exceptions-library-through-cabal-because-of-missing-files", "closed_reason": "Duplicate", "title": "Can&#39;t install haskell exceptions library through cabal because of missing files", "body": "<p>I'm a beginner starting with Haskell and I'm struggling with <code>cabal install</code> of the dependencies I need. I'm specifically trying to use <code>Data.YAML</code> which is part of <code>yaml</code>. Here is the error message I'm getting:</p>\n\n<pre><code>cabal sandbox init\ncabal install --only-dependencies --enable-tests\n\n[1 of 1] Compiling Main             ( /var/folders/4c/hs_zlv716_z8b25hd8_z60cm0000gn/T/exceptions-0.8.0.2-7178/exceptions-0.8.0.2/dist/dist-sandbox-f7008b70/setup/setup.hs, /var/folders/4c/hs_zlv716_z8b25hd8_z60cm0000gn/T/exceptions-0.8.0.2-7178/exceptions-0.8.0.2/dist/dist-sandbox-f7008b70/setup/Main.o )\nLinking /var/folders/4c/hs_zlv716_z8b25hd8_z60cm0000gn/T/exceptions-0.8.0.2-7178/exceptions-0.8.0.2/dist/dist-sandbox-f7008b70/setup/setup ...\nConfiguring exceptions-0.8.0.2...\nBuilding exceptions-0.8.0.2...\nPreprocessing library exceptions-0.8.0.2...\n\nsrc/Control/Monad/Catch.hs:87:8:\n    Could not find module \u2018Control.Monad.STM\u2019\n    There are files missing in the \u2018stm-2.4.4\u2019 package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\n\nsrc/Control/Monad/Catch.hs:91:8:\n    Could not find module \u2018Control.Monad.Trans.Except\u2019\n    There are files missing in the \u2018transformers-compat-0.4.0.3\u2019 package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\n\nsrc/Control/Monad/Catch.hs:94:8:\n    Could not find module \u2018Control.Monad.Reader\u2019\n    There are files missing in the \u2018mtl-2.1.3.1\u2019 package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\n\nsrc/Control/Monad/Catch/Pure.hs:58:8:\n    Could not find module \u2018Control.Monad.RWS\u2019\n    There are files missing in the \u2018mtl-2.1.3.1\u2019 package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>Here are my system details:</p>\n\n<pre><code>uname -a\nDarwin mbarton-lm.local 13.4.0 Darwin Kernel Version 13.4.0: Wed Mar 18 16:20:14 PDT 2015; root:xnu-2422.115.14~1/RELEASE_X86_64 x86_64 i386 MacBookPro9,1 Darwin\n\nghc -v\nGlasgow Haskell Compiler, Version 7.8.4, stage 2 booted by GHC version 7.8.3\nUsing binary package database: /usr/local/Cellar/ghc/7.8.4/lib/ghc-7.8.4/package.conf.d/package.cache\nwired-in package ghc-prim mapped to ghc-prim-0.3.1.0 a24f9c14c632d75b683d0f93283aea37\nwired-in package integer-gmp mapped to integer-gmp-0.5.1.0-26579559b3647acf4f01d5edd9491a46\nwired-in package base mapped to base-4.7.0.2-99f2b20e2491b27225d4c673401d826f\nwired-in package rts mapped to builtin_rts\nwired-in package template-haskell mapped to template-haskell-2.9.0.0-c0be869a24cf2c4fa8e8cbf52d0324ff\nwired-in package dph-seq not found.\nwired-in package dph-par not found.\n\ncabal -V\ncabal-install version 1.22.0.0\nusing version 1.22.0.0 of the Cabal library\n</code></pre>\n"}, {"tags": ["haskell", "monad-transformers", "state-monad"], "answers": [{"comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1430075387, "post_id": 29881819, "comment_id": 47888443, "body": "Yes, I can write <code>modify</code> but it affect to my underlying state not to my application state. Be able to write <code>modify</code> is not the matter, the matter is write the proper <code>modify</code> (and, in my example, if my application use one <code>StateT</code> must be able to use <code>modify</code> without <code>lift</code> to access to their <code>StateT</code>, he cannot, why? how?) :)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1430077641, "post_id": 29881819, "comment_id": 47889291, "body": "@josejuan I see. Check if the updated answer is what you wanted."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1430117221, "post_id": 29881819, "comment_id": 47901466, "body": "I tried to avoid the <code>MonadState</code> derivation but I thought that wrap all instances is not correct but, anyway, no too much instances would have to be. It might work! Thank you :)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1430077582, "last_edit_date": 1430077582, "creation_date": 1430073384, "answer_id": 29881819, "question_id": 29881538, "link": "https://stackoverflow.com/questions/29881538/create-my-own-state-monad-transformer-module-hiding-underlying-state-monad/29881819#29881819", "title": "Create my own state monad transformer module hiding underlying state monad", "body": "<p>I think that if you can write an instance of <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Class.html#t:MonadState\" rel=\"nofollow\"><code>MonadState</code></a> for your transformer you can use <code>modify</code> without the <code>lift</code>:</p>\n\n<pre><code>instance Monad m =&gt; MonadState (ZipperT s m a) where\n   ...\n</code></pre>\n\n<p>I must confess I am not sure about what part of the state <code>modify</code> should affect, though.</p>\n\n<hr>\n\n<p>I've looked at the complete code. It seems that you already define </p>\n\n<pre><code>MonadState (ZipperState s) (ZipperT s m)\n</code></pre>\n\n<p>This already provides a <code>modify</code> which however modifies the wrong underlying state. What you actually wanted was to expose the state wrapped in <code>m</code>, provided that is a <code>MonadState</code> itself. This could theoretically be done with</p>\n\n<pre><code>instance MonadState s m =&gt; MonadState s (ZipperT s m) where\n   ...\n</code></pre>\n\n<p>But now we have two <code>MonadState</code> instances for the same monad, causing a conflict.</p>\n\n<hr>\n\n<p>I think I somehow solved this.</p>\n\n<p>Here's what I did:</p>\n\n<p>First, I removed the original <code>deriving MonadState</code> instance. I instead wrote</p>\n\n<pre><code>getZ :: Monad m =&gt; ZipperT s m (ZipperState s)\ngetZ = ZipperT_ get\n\nputZ :: Monad m =&gt; ZipperState s -&gt; ZipperT s m ()\nputZ = ZipperT_ . put\n\nmodifyZ :: Monad m =&gt; (ZipperState s -&gt; ZipperState s) -&gt; ZipperT s m ()\nmodifyZ = ZipperT_ . modify\n</code></pre>\n\n<p>and replaced previous occurrences of <code>get,put,modify</code> in the <code>ZipperT</code> library with the above custom functions.</p>\n\n<p>Then I added the new instance:</p>\n\n<pre><code>-- This requires UndecidableInstances\ninstance MonadState s m =&gt; MonadState s (ZipperT a m) where\n   get = lift get\n   put = lift . put\n</code></pre>\n\n<p>And now, the client code works without lifts:</p>\n\n<pre><code>length' :: [a] -&gt; Int\nlength' xs = runIdentity (execStateT (runZipperT contar ([], xs)) 0)\n    where contar :: ZipperT a (StateT Int Identity) ()\n          contar = headR &gt;&gt;= \\x -&gt; case x of\n                     Nothing -&gt; return ()\n                     Just  _ -&gt; do\n                                    right2left\n                                    modify (+ (1::Int))\n                                 -- ^^^^^^^\n                                    contar\n</code></pre>\n"}], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 29881819, "answer_count": 1, "score": 3, "last_activity_date": 1430077582, "creation_date": 1430072164, "last_edit_date": 1430072478, "question_id": 29881538, "link": "https://stackoverflow.com/questions/29881538/create-my-own-state-monad-transformer-module-hiding-underlying-state-monad", "title": "Create my own state monad transformer module hiding underlying state monad", "body": "<p>I'm learning about mtl and I wish learn the proper way to create new monads as modules (not as typical application usage).</p>\n\n<p>As a simple example I have written a <code>ZipperT</code> monad (<a href=\"https://gist.github.com/josejuan/4211a9c9e3fc08e64e00\" rel=\"nofollow\">complete code here</a>):</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, FunctionalDependencies, MultiParamTypeClasses, GeneralizedNewtypeDeriving #-}\nmodule ZipperT (\n  MonadZipper (..)\n, ZipperT\n, runZipperT\n) where\n\nimport Control.Applicative\nimport Control.Monad.State\n\nclass Monad m =&gt; MonadZipper a m | m -&gt; a where\n    pushL :: a -&gt; m ()\n    pushR :: a -&gt; m ()\n    ...\n\ndata ZipperState s = ZipperState { left :: [s], right :: [s] }\n\nnewtype ZipperT s m a = ZipperT_ { runZipperT_ :: StateT (ZipperState s) m a }\n                        deriving ( Functor, Applicative\n                                 , Monad, MonadIO, MonadTrans\n                                 , MonadState (ZipperState s))\n\ninstance (Monad m) =&gt; MonadZipper s (ZipperT s m) where\n    pushL x = modify $ \\(ZipperState left right) -&gt; ZipperState (x:left) right\n    pushR x = modify $ \\(ZipperState left right) -&gt; ZipperState left (x:right)\n    ...\n\nrunZipperT :: (Monad m) =&gt; ZipperT s m a -&gt; ([s], [s]) -&gt; m (a, ([s], [s]))\nrunZipperT computation (left, right) = do\n    (x, ZipperState left' right') &lt;- runStateT (runZipperT_ computation) (ZipperState left right)\n    return (x, (left', right'))\n</code></pre>\n\n<p>it's works and I can compose with other monads</p>\n\n<pre><code>import Control.Monad.Identity\nimport Control.Monad.State\nimport ZipperT\n\nlength' :: [a] -&gt; Int\nlength' xs = runIdentity (execStateT (runZipperT contar ([], xs)) 0)\n    where contar = headR &gt;&gt;= \\x -&gt; case x of\n                     Nothing -&gt; return ()\n                     Just  _ -&gt; do\n                                    right2left\n                                    (lift . modify) (+1)\n                                 -- ^^^^^^^\n                                    contar\n</code></pre>\n\n<p>But I wish to avoid the explicit <code>lift</code>.</p>\n\n<ul>\n<li>What is the correct way to create modules like this?</li>\n<li>Can I avoid the explicit <code>lift</code>? (I wish to hide the internal <code>StateT</code> structure of my <code>ZipperT</code>)</li>\n</ul>\n\n<p>Thank you!</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 0, "creation_date": 1430064313, "post_id": 29879944, "comment_id": 47884122, "body": "What&#39;s the error Haskell gives you?"}, {"owner": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 0, "creation_date": 1430064448, "post_id": 29879944, "comment_id": 47884172, "body": "If all you&#39;re stuck with is the pattern matching just use <code>(,)</code> as a function, and <code>head</code> and <code>tail</code> instead of (y:ys) and maybe an if/else?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430064556, "post_id": 29879944, "comment_id": 47884221, "body": "It complains about not being able to construct an infinite type. Maybe it has to do with the fact that I&#39;m creating a continuator which expects a continuator."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430065429, "post_id": 29879944, "comment_id": 47884583, "body": "btw: a very similar question was asked some time ago: <a href=\"https://stackoverflow.com/questions/235148/implement-zip-using-foldr\" title=\"implement zip using foldr\">stackoverflow.com/questions/235148/implement-zip-using-foldr</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1430066073, "post_id": 29879944, "comment_id": 47884807, "body": "<a href=\"http://okmij.org/ftp/Haskell/zip-folds.lhs\" rel=\"nofollow noreferrer\">Oleg did it, Oleg did it!</a>"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1430257874, "post_id": 29879944, "comment_id": 47983391, "body": "FYI, I added an <a href=\"http://stackoverflow.com/questions/29885983/infinite-type-error-when-defining-zip-with-foldr-only-can-it-be-fixed/\">answer</a> to a follow-up question that could technically pass as an answer for this one too."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430276858, "post_id": 29879944, "comment_id": 47989343, "body": "Well, I can only hope someone who understands Agda (one of the other 11 of you) benefits of it...! Heh. Certainly above my reach now. But I&#39;m still amazed. Thank you!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1431918888, "post_id": 29879944, "comment_id": 48685437, "body": "@DanielWagner, I believe ski also did it, independently. And there was a paper about such things not too long ago."}], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1430114401, "post_id": 29880293, "comment_id": 47900183, "body": "Use of <code>Fix</code> is equivalent to using general recursion or a fixpoint combinator, so I think this is at odds with OP&#39;s &quot;no recursion&quot; criterion."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1430114624, "post_id": 29880293, "comment_id": 47900265, "body": "@Andr&#225;sKov&#225;cs quite possible yes (although you could argue about types vs. function or that <code>foldr</code> might be recursive too, ...) - do you see another way to get the compiler to accept the OP&#39;s <code>zip</code> that don&#39;t stray away to much from the code?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1430115136, "post_id": 29880293, "comment_id": 47900489, "body": "I haven&#39;t looked at OP&#39;s code yet... As to <code>foldr</code>, it&#39;s about as non-recursive as it can get, since it corresponds to both Church encoded lists in System F (and everything provably terminates there), and the computation rule for lists in type theory."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1430115517, "post_id": 29880293, "comment_id": 47900650, "body": "@Andr&#225;sKov&#225;cs tbh: I think this is not the place to argue but AFAIK <code>foldr</code> is still <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/src/Data-Foldable.html#foldr\" rel=\"nofollow noreferrer\">implemented</a> in a recursive fashion (in Haskell) - but again that&#39;s not really the point here is it?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430183878, "post_id": 29880293, "comment_id": 47939729, "body": "It kinda is, actually, but I&#39;m impressed you managed to type it."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1430313656, "post_id": 29880293, "comment_id": 48010817, "body": "@Andr&#225;sKov&#225;cs (and the others...) Hi, I&#39;ve added a new answer, maybe you&#39;d like to check it out. It uses a simpler recursive type (<code>t</code> is actually redundant), and Haskell already has recursive types, so I don&#39;t need to think about &quot;Fix&quot; myself!"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 6, "last_activity_date": 1430112197, "last_edit_date": 1430112197, "creation_date": 1430065823, "answer_id": 29880293, "question_id": 29879944, "link": "https://stackoverflow.com/questions/29879944/why-haskell-doesnt-accept-my-combinatoric-zip-definition/29880293#29880293", "title": "Why Haskell doesn&#39;t accept my combinatoric &quot;zip&quot; definition?", "body": "<p>As to why your definition is not accepted: look at this:</p>\n\n<pre><code>\u03bb&gt; :t \\ x xs cont -&gt; x : cont xs\n ... :: a -&gt; r -&gt; ((r -&gt; [a]) -&gt; [a])\n\n\u03bb&gt; :t foldr\nfoldr :: (a' -&gt; b' -&gt; b') -&gt; b' -&gt; [a'] -&gt; b'\n</code></pre>\n\n<p>so if you want to use the first function as an argument for <code>foldr</code> you get (if you match the types of <code>foldr</code>s first <em>argument</em>:</p>\n\n<pre><code>a' := a\nb' := r\nb' := (r -&gt; [a]) -&gt; [a]\n</code></pre>\n\n<p>which of course is a problem (as <code>r</code> and <code>(r -&gt; [a]) -&gt; [a]</code> mutual-recursive and should both be equal to <code>b'</code> ) </p>\n\n<p>That is what the compiler tells you</p>\n\n<h2>how to repair it</h2>\n\n<p>You can repair your idea using </p>\n\n<pre><code>newtype Fix a t = Fix { unFix :: Fix a t -&gt; [a] }\n</code></pre>\n\n<p>which I <em>borrowed</em> form it <a href=\"https://hackage.haskell.org/package/data-fix-0.0.1/docs/Data-Fix.html\" rel=\"nofollow\">original use</a>.</p>\n\n<p>With this you can write:</p>\n\n<pre><code>zipCat :: [a] -&gt; [a] -&gt; [a]\nzipCat a b = (unFix $ zipper a) (zipper b) where\n  zipper = foldr foldF (Fix $ const [])\n  foldF x xs = Fix (\\ cont -&gt; x : (unFix cont $ xs))\n</code></pre>\n\n<p>and you get:</p>\n\n<pre><code>\u03bb&gt; zipCat [1..4] [5..8]\n[1,5,2,6,3,7,4,8]\n</code></pre>\n\n<p>which is (what I think) you wanted.</p>\n\n<p><strong>BUT</strong> obvious here both of your lists needs to be of the same type so I don't know if this will really help you</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1594362660, "last_edit_date": 1594362660, "creation_date": 1430091484, "answer_id": 29884955, "question_id": 29879944, "link": "https://stackoverflow.com/questions/29879944/why-haskell-doesnt-accept-my-combinatoric-zip-definition/29884955#29884955", "title": "Why Haskell doesn&#39;t accept my combinatoric &quot;zip&quot; definition?", "body": "<p>We can eliminate the explicit pattern matching by defining a function that will do it for us.</p>\n<p>Is it cheating? Not if <a href=\"http://hackage.haskell.org/package/base/docs/Data-Maybe.html#v:maybe\" rel=\"nofollow noreferrer\"><code>maybe</code></a> and <a href=\"http://hackage.haskell.org/package/base/docs/Data-Bool.html#v:bool\" rel=\"nofollow noreferrer\"><code>bool</code></a> are allowed, as they are; then we should also allow <a href=\"http://hackage.haskell.org/package/extra/docs/Data-List-Extra.html#v:list\" rel=\"nofollow noreferrer\"><code>list</code></a> (also in <a href=\"http://hackage.haskell.org/package/extra\" rel=\"nofollow noreferrer\"><code>extra</code></a>'s <code>Data.List.Extra</code>),</p>\n<pre><code>list :: b -&gt; (a -&gt; [a] -&gt; b) -&gt; [a] -&gt; b \nlist n c []     = n\nlist n c (x:xs) = c x xs\n</code></pre>\n<p>just the same; so that we can have, in your <code>zip'</code> definition,</p>\n<pre><code>cons h t = list [] (\\y ys -&gt; (h,y) : t ys)\n</code></pre>\n<p>or e.g.</p>\n<pre><code>         = list [] (uncurry ((:).(h,).fst &lt;*&gt; t.snd))\n         = list [] (curry $ uncurry (:) . ((h,) *** t))\n         = list [] (flip ((.) . (:) . (h,)) t)\n         = list [] ((. t) . (:) . (h,))\n</code></pre>\n<p>if you prefer this kind of thing.</p>\n<p>About your error, &quot;infinite type&quot; often indicates self application; indeed, whatever your <code>zipper</code> returns, you're self-applying it, in your</p>\n<pre><code>zip a b = (zipper a) (zipper b)  where ....\n</code></pre>\n<hr />\n<p>I tried to tweak your definition and came up with</p>\n<pre><code>zipp :: [a] -&gt; [b] -&gt; [(a,b)]\nzipp xs ys = zip1 xs (zip2 ys)\n  where\n     -- zip1 :: [a] -&gt; tq -&gt; [(a,b)]          -- zip1 xs :: tr ~ tq -&gt; [(a,b)]\n     zip1 xs q = foldr (\\ x r q -&gt; q x r ) n xs q \n                       -------- c --------\n     n    q  = []\n\n     -- zip2 :: [b] -&gt; a -&gt; tr -&gt; [(a,b)]     -- zip2 ys :: tq ~ a -&gt; tr -&gt; [(a,b)]\n     zip2 ys x r = foldr (\\ y q x r -&gt; (x,y) : r q ) m ys x r  \n                         ---------- k --------------\n     m  x r  = []\n\n{-\n  zipp [x1,x2,x3] [y1,y2,y3,y4]\n\n= c x1 (c x2 (c xn n)) (k y1 (k y2 (k y3 (k y4 m))))\n       ---------------       ----------------------\n        r                     q\n\n= k y1 (k y2 (k y3 (k y4 m))) x1 (c x2 (c xn n))\n       ----------------------    ---------------\n        q                         r\n-}\n</code></pre>\n<p>It seems to reduce correctly on paper, but still I got the infinite type errors here too.</p>\n<p>There is no (immediately apparent) self-application now, but the type of the continuation that the first zip gets, depends on the type of that first zip itself; so still there's a circular dependency: <code>tq</code> is on both sides of the type equivalency in <code>tq ~ a -&gt; tr -&gt; [(a,b)] ~ a -&gt; (tq -&gt; [(a,b)]) -&gt; [(a,b)]</code>.</p>\n<p>Indeed that's the two type errors that I get, (the first one is about the <code>tr</code> type),</p>\n<pre><code>Occurs check: cannot construct the infinite type:\n  t1 ~ (a -&gt; t1 -&gt; [(a, b)]) -&gt; [(a, b)]          -- tr\n\nOccurs check: cannot construct the infinite type:\n  t0 ~ a -&gt; (t0 -&gt; [(a, b)]) -&gt; [(a, b)]          -- tq\n</code></pre>\n<p>In the usual definitions using <code>foldr</code> with continuations, the type of those continuations is independent; that's the reason that it works there, I guess.</p>\n<ul>\n<li>See also my <a href=\"https://stackoverflow.com/a/29944707/849891\">second answer</a> here, and <a href=\"https://stackoverflow.com/q/29885983/849891\">this follow-up Q&amp;A</a></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430314245, "post_id": 29944707, "comment_id": 48011279, "body": "nice - yeah the <code>t</code> is redundant - tbh: I just used the quick <code>copy&amp;paste</code> the compiler output and <code>Fix</code> it solution ;)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430314548, "post_id": 29944707, "comment_id": 48011521, "body": "@CarstenK&#246;nig thanks; :) I thought to use this insight in the other problem; no luck for  now. the types are more complex..."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430314869, "post_id": 29944707, "comment_id": 48011790, "body": "yeah guess so - but it should be really easy to translate [a,b,c,d,e] -&gt; [(a,b),(c,d),...] and mix in some ADT (Either comes to mind)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430315351, "post_id": 29944707, "comment_id": 48012192, "body": "@CarstenK&#246;nig I got it! I define two mutually-recursive types: <a href=\"http://ideone.com/tgAK0A\" rel=\"nofollow noreferrer\">ideone.com/tgAK0A</a>. Will post the answer shortly!!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430315684, "post_id": 29944707, "comment_id": 48012499, "body": "nice - good work - but you should really not add yet another answer - just add it to the one you got - don&#39;t get me wrong you would get yet another upvote from me put some people here on SO really get pissed of at this stuff"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430316271, "post_id": 29944707, "comment_id": 48013047, "body": "@CarstenK&#246;nig I think it&#39;s ok to add second answer that is different; I think my answer is different enough from yours, mainly in the insight of turning type equivalency into recursive type definition. I couldn&#39;t make out what all that Fix stuff was/is. Also, it is a <i>long</i> answer. (and if you meant <i>my</i> other answer, it&#39;s long too) :) :) -- But what I meant, I&#39;m adding it not here of course; but on my followup question."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430316642, "post_id": 29944707, "comment_id": 48013356, "body": "no offense meant - I have no problem if you add another answer - it just looks strange to have 4 answers where 3 are from the same person - but congrats - good job"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430316675, "post_id": 29944707, "comment_id": 48013379, "body": "@CarstenK&#246;nig you&#39;re absolutely right about the three answers. and thanks! this was nice. :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430316813, "post_id": 29944707, "comment_id": 48013491, "body": "@CarstenK&#246;nig As I wrote there, the translation from type equivalencies to newtype definitions was purely mechanical. Maybe the compiler should be doing this for us, do you think? (though the types namespace would be littered... but it could use some garbled names there...)"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1431910542, "last_edit_date": 1431910542, "creation_date": 1430312847, "answer_id": 29944707, "question_id": 29879944, "link": "https://stackoverflow.com/questions/29879944/why-haskell-doesnt-accept-my-combinatoric-zip-definition/29944707#29944707", "title": "Why Haskell doesn&#39;t accept my combinatoric &quot;zip&quot; definition?", "body": "<p>I can offer you a slightly different perspective (I think) to arrive at a similar solution as Carsten's (but with simpler types). </p>\n\n<p>Here's your code again, for your \"weaving zip\" (I'm writing <code>tr</code> for \"the type of <code>r</code>\", similarly <code>tq</code> for \"the type of <code>q</code>\"; I always use \"<code>r</code>\" for the <em>recursive result</em> argument of combining function in <code>foldr</code> definitions, as a mnemonic device):</p>\n\n<pre><code>zipw :: [a] -&gt; [a] -&gt; [a]\nzipw xs ys = (zipper xs) (zipper ys) where\n    zipper xs q = foldr (\\ x r q -&gt; x : q r) (const []) xs q\n                        --- c -------------- --- n ----\n\n -- zipper [x1,x2,x3] (zipper ys) =\n -- c x1 (c x2 (c x3 n)) (zipper ys)\n         --- r --------  --- q -----  tr ~ tq ; q r :: [a]\n                                      --     =&gt; r r :: [a]\n                                      -- =&gt; r :: tr -&gt; [a] \n                                      --   tr ~  tr -&gt; [a]    \n</code></pre>\n\n<p>So, this is the infinite type. Haskell doesn't allow this for an arbitrary type (which is what type variables stand for).    </p>\n\n<p>But Haskell's datatypes do actually admit recursion. Lists, trees, etc. &mdash; all the usual types are recursive. This <em>is</em> allowed:</p>\n\n<pre><code>data Tree a = Branch (Tree a) (Tree a)\n</code></pre>\n\n<p>Here we <em>do</em> have the same type on both sides of the equation, just as we have <code>tr</code> on both sides of the type equivalency, <code>tr ~ tr -&gt; [a]</code>. But it's a specific type, not an arbitrary one.</p>\n\n<p>So we just declare it so, following the above \"equation\":</p>\n\n<pre><code>newtype TR a = Pack { unpack :: TR a -&gt; [a] } \n           -- unpack :: TR a -&gt; TR a -&gt; [a]\n</code></pre>\n\n<p>What's a <code>Tree a</code> type? It's \"something\" that goes into a <code>Branch</code>, which is a <code>Tree a</code>. A given tree doesn't have to be infinitely constructed, because <code>undefined</code> has type <code>Tree a</code> too.</p>\n\n<p>What's a <code>TR a</code> type? It's \"something\" that goes into <code>TR a -&gt; [a]</code>, which is a <code>TR a</code>. A given <code>TR a</code> doesn't have to be infinitely constructed, because <code>const []</code> can be of type <code>TR a</code> too.</p>\n\n<p>Our wannabe recursive type <code>tr ~ tr -&gt; [a]</code> has become bona fide recursive type definition <code>newtype TR a = Pack { TR a -&gt; [a] }</code>, hiding behind the data constructor, <code>Pack</code> (which will be gotten rid of by the compiler, thanks to the <code>newtype</code> keyword being used, but that's an extraneous detail; it works with <code>data</code> too). </p>\n\n<p>Haskell handles the recursivity for us here. Type theoreticians love to deal with this themselves, with <code>Fix</code> and whatnot; but a Haskell user already has this available to them, in the language. We don't have to understand how it is implemented, to be able to use it. No need to reinvent the wheel until we want to build it ourselves. </p>\n\n<p>So, <code>zipper xs</code> had type <code>tr</code>; now it becomes <code>TR a</code>, so this is what the new <code>zipper xs</code> must return &mdash; the \"packed\" list-producing function. The <code>foldr</code> combining function must return what the <code>zipper</code> call returns (by the virtues of <code>foldr</code> definition). To apply the packed function we now need to <code>unpack</code> it first:</p>\n\n<pre><code>zipw :: [a] -&gt; [a] -&gt; [a]\nzipw xs ys = unpack (zipper xs) (zipper ys)\n    where\n    zipper :: [a] -&gt; TR a\n    zipper = foldr (\\ x r -&gt; Pack $ \\q -&gt; x : unpack q r)\n                   (Pack $ const [])\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 475, "favorite_count": 1, "accepted_answer_id": 29880293, "answer_count": 3, "score": 8, "last_activity_date": 1594362660, "creation_date": 1430063976, "last_edit_date": 1430087074, "question_id": 29879944, "link": "https://stackoverflow.com/questions/29879944/why-haskell-doesnt-accept-my-combinatoric-zip-definition", "title": "Why Haskell doesn&#39;t accept my combinatoric &quot;zip&quot; definition?", "body": "<p>This is the textbook zip function:</p>\n\n<pre><code>zip :: [a] -&gt; [a] -&gt; [(a,a)]\nzip [] _ = []\nzip _ [] = []\nzip (x:xs) (y:ys) = (x,y) : zip xs ys\n</code></pre>\n\n<p>I asked on #haskell earlier wether \"zip\" could be implemented using \"foldr\" alone, no recursion, no pattern matching. After some thinking, we noticed the recursion could be eliminated using continuations:</p>\n\n<pre><code>zip' :: [a] -&gt; [a] -&gt; [(a,a)]\nzip' = foldr cons nil\n    where\n        cons h t (y:ys) = (h,y) : (t ys)\n        cons h t []     = []\n        nil             = const []\n</code></pre>\n\n<p>We are still left with pattern matching. After some more neuron toasting I came up with an incomplete answer that I thought was logical:</p>\n\n<pre><code>zip :: [a] -&gt; [a] -&gt; [a]\nzip a b = (zipper a) (zipper b) where\n    zipper = foldr (\\ x xs cont -&gt; x : cont xs) (const [])\n</code></pre>\n\n<p>It returns a flat list, but does the zipping. I was certain it made sense, but Haskell complained about the type. I proceeded to test it on a untyped lambda calculator, and it worked. Why can't Haskell accept my function?</p>\n\n<p>The error is:</p>\n\n<pre><code>zip.hs:17:19:\n    Occurs check: cannot construct the infinite type:\n      t0 ~ (t0 -&gt; [a]) -&gt; [a]\n    Expected type: a -&gt; ((t0 -&gt; [a]) -&gt; [a]) -&gt; (t0 -&gt; [a]) -&gt; [a]\n      Actual type: a\n                   -&gt; ((t0 -&gt; [a]) -&gt; [a]) -&gt; (((t0 -&gt; [a]) -&gt; [a]) -&gt; [a]) -&gt; [a]\n    Relevant bindings include\n      b \u2237 [a] (bound at zip.hs:17:7)\n      a \u2237 [a] (bound at zip.hs:17:5)\n      zip \u2237 [a] -&gt; [a] -&gt; [a] (bound at zip.hs:17:1)\n    In the first argument of \u2018foldr\u2019, namely \u2018cons\u2019\n    In the expression: ((foldr cons nil a) (foldr cons nil b))\n\nzip.hs:17:38:\n    Occurs check: cannot construct the infinite type:\n      t0 ~ (t0 -&gt; [a]) -&gt; [a]\n    Expected type: a -&gt; (t0 -&gt; [a]) -&gt; t0 -&gt; [a]\n      Actual type: a -&gt; (t0 -&gt; [a]) -&gt; ((t0 -&gt; [a]) -&gt; [a]) -&gt; [a]\n    Relevant bindings include\n      b \u2237 [a] (bound at zip.hs:17:7)\n      a \u2237 [a] (bound at zip.hs:17:5)\n      zip \u2237 [a] -&gt; [a] -&gt; [a] (bound at zip.hs:17:1)\n    In the first argument of \u2018foldr\u2019, namely \u2018cons\u2019\n    In the fourth argument of \u2018foldr\u2019, namely \u2018(foldr cons nil b)\u2019\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "hackage"], "comments": [{"owner": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 0, "creation_date": 1430062273, "post_id": 29879499, "comment_id": 47883309, "body": "Did you read <a href=\"https://wiki.haskell.org/Package_versioning_policy\" rel=\"nofollow noreferrer\">wiki.haskell.org/Package_versioning_policy</a> ?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 0, "creation_date": 1430062427, "post_id": 29879499, "comment_id": 47883383, "body": "@BenjaminGruenbaum I did. How does that help me to know which of several dozen versions added the function I want?"}, {"owner": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 0, "creation_date": 1430062795, "post_id": 29879499, "comment_id": 47883517, "body": "So to be clear, you want to get the minimal version of a library containing a specific function with a given signature?"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 5, "creation_date": 1430062847, "post_id": 29879499, "comment_id": 47883543, "body": "I find Luite\u2019s git repositories created from hackage very useful, e.g.: <a href=\"http://hdiff.luite.com/cgit/lens/\" rel=\"nofollow noreferrer\">hdiff.luite.com/cgit/lens</a>. You can probably solve your problem by cloning the corresponding repo and applying some git-foo (<code>git blame</code>, <code>git log -G</code>)."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 0, "creation_date": 1430062931, "post_id": 29879499, "comment_id": 47883567, "body": "@BenjaminGruenbaum Yep, that&#39;s what I&#39;m after."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1439629907, "post_id": 32022914, "comment_id": 51948144, "body": "That&#39;s a nice find... though I have to say, that tool looks a bit brute-force-ish seeing as it has to invoke <code>cabal</code> on temporary directories."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1439631557, "post_id": 32022914, "comment_id": 51948500, "body": "Obviously it&#39;s not perfect, but that&#39;s the only partial approach I&#39;m aware of. Best would be maintainers adding <i>Since x.y.z</i> annotations to new exports."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1439631826, "post_id": 32022914, "comment_id": 51948570, "body": "I&#39;m not sure... I&#39;d rather just browse <a href=\"http://hdiff.luite.com/cgit/\" rel=\"nofollow noreferrer\">the git repo</a> to find a particular change. With <code>hackage-diff</code> you basically need to manually bisect for that purpose, and when it always needs to completely build the package that ain&#39;t too nice."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1439631947, "post_id": 32022914, "comment_id": 51948602, "body": "Ah, I thought it fetches <a href=\"https://wiki.haskell.org/Hoogle#Installing_databases_from_Hackage\" rel=\"nofollow noreferrer\">hoogle dbs from hackage</a>"}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1439629542, "last_edit_date": 1439629542, "creation_date": 1439626938, "answer_id": 32022914, "question_id": 29879499, "link": "https://stackoverflow.com/questions/29879499/find-earliest-package-version-with-function-x/32022914#32022914", "title": "Find earliest package version with function X", "body": "<p><a href=\"https://hackage.haskell.org/package/hackage-diff\" rel=\"nofollow\">hackage-diff</a> is probably the tool you are looking for.</p>\n\n<p>N.B. I never tried it myself.</p>\n"}], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 13, "last_activity_date": 1439629542, "creation_date": 1430061727, "question_id": 29879499, "link": "https://stackoverflow.com/questions/29879499/find-earliest-package-version-with-function-x", "title": "Find earliest package version with function X", "body": "<p>So I'm sitting here wondering why the hell I can't find the function I'm looking for, and it turns out it doesn't exist in the version of the package I have installed.</p>\n\n<p>So how do I make Hackage tell me what version that function was added in?</p>\n\n<p>(In particular, so I can specify the correct package bounds in my Cabal description.)</p>\n"}, {"tags": ["function", "haskell", "addition"], "answers": [{"tags": [], "owner": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "is_accepted": true, "score": 5, "last_activity_date": 1430061847, "creation_date": 1430061847, "answer_id": 29879522, "question_id": 29879458, "link": "https://stackoverflow.com/questions/29879458/programming-using-only-succ-and-pred/29879522#29879522", "title": "Programming * using only succ and pred", "body": "<p>This construction is hardly <em>special</em>. You just have to understand the basic logic of what multiplication is x*y is adding x to itself y times.</p>\n\n<p>Multiplying x by 0 is 0</p>\n\n<p>Multiplying x by 1 is x</p>\n\n<p>Multiplying x by N is adding x to multiplying x by N-1.</p>\n\n<p>Assuming performance is not an issue here so there is no reason to be tail recursive, a simple definition would be:</p>\n\n<pre><code>mul :: Integer -&gt; Integer -&gt; Integer\nmul x 0 = 0\nmul 0 y = 0\nmul x 1 = x\nmul x n = x + mul x (n - 1) -- use plus instead of + if you were asked to\n</code></pre>\n\n<p>This can be further compacted - we don't <em>really</em> need the 1 case, or the zero case for both sides since adding zeros is just zero, and multiplying by 1 is x + multiplying by zero.</p>\n\n<pre><code>mul x 0 = 0\nmul x y = x + mul x (n-1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 326, "user_id": 5544720, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-kV2rbwEidgA/AAAAAAAAAAI/AAAAAAAAANE/IEq7eIHu490/photo.jpg?sz=128", "display_name": "Michael Tamillow", "link": "https://stackoverflow.com/users/5544720/michael-tamillow"}, "is_accepted": false, "score": 0, "last_activity_date": 1564421161, "creation_date": 1564421161, "answer_id": 57258708, "question_id": 29879458, "link": "https://stackoverflow.com/questions/29879458/programming-using-only-succ-and-pred/57258708#57258708", "title": "Programming * using only succ and pred", "body": "<p><code>plus :: Integer -&gt; Integer -&gt; Integer\n plus a 0 = a\n plus a b = plus (succ a) (pred b)\n</code></p>\n\n<p>a goes to a + b -> b goes to zero</p>\n\n<p><code>mult :: Integer -&gt; Integer -&gt; Integer\n mult a 0 = 0\n mult a b = plus a (mult a (pred b))\n</code></p>\n\n<p>this unfolds to a added b times.</p>\n"}], "owner": {"reputation": 35, "user_id": 4834712, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a69f8d4d9673764d127b0f1a08d9c2db?s=128&d=identicon&r=PG&f=1", "display_name": "Hans", "link": "https://stackoverflow.com/users/4834712/hans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 804, "favorite_count": 0, "accepted_answer_id": 29879522, "answer_count": 2, "score": 2, "last_activity_date": 1564421161, "creation_date": 1430061504, "last_edit_date": 1430068106, "question_id": 29879458, "link": "https://stackoverflow.com/questions/29879458/programming-using-only-succ-and-pred", "title": "Programming * using only succ and pred", "body": "<p>How can I make a multiplication function using only <code>succ</code> and <code>pred</code>?</p>\n\n<p>The function for the addition I already have:</p>\n\n<pre><code>plus :: Integer -&gt; Integer -&gt; Integer\nplus a b | a == 0    = b\n         | otherwise = succ (pred a \u00b4plus\u00b4 b)\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1430069137, "post_id": 29880217, "comment_id": 47885963, "body": "so basically, in my example, <code>process</code> is polymorphic. Am I right ?"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 1, "creation_date": 1430070612, "post_id": 29880217, "comment_id": 47886523, "body": "It&#39;s not the monomorphism restriction that makes <code>let</code> and <code>where</code> capable of binding values at polymorphic types, but instead &quot;<code>let</code> generalization&quot;: unlike for function arguments, the to-be-determined type variables in a <code>let</code> (or <code>where</code>) binding are made polymorphic instead of being instantiated. So your <code>x</code> will always be <code>x :: a -&gt; a</code>. This is the only place where Hindley-Milner type inference will produce polymorphic types. The MR is only about type classes, and non-constrained type variables can still be generalized: <code>let f = \\x y = (x,y*y)</code> produces <code>f :: t -&gt; Integer -&gt; (t,Integer)</code>."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 2, "creation_date": 1430071556, "post_id": 29880217, "comment_id": 47886897, "body": "(Though the story is slightly complicated in GHC: the <code>-XGADTs</code> and <code>-XTypeFamilies</code> flags turn on the <code>-XMonoLocalBinds</code> flag, which <a href=\"https://downloads.haskell.org/~ghc/7.10.1/docs/html/users_guide/other-type-extensions.html#mono-local-binds\" rel=\"nofollow noreferrer\">disables <code>let</code>-generalization</a> for local bindings!  This is important for type inference reasons, apparently, but I don&#39;t understand the details.)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1430071997, "post_id": 29880217, "comment_id": 47887075, "body": "@AntalS-Z You are right: unconstrained type variables are indeed unaffected by the DMR. Thank you. I corrected the answer accordingly."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1430071752, "last_edit_date": 1430071752, "creation_date": 1430065354, "answer_id": 29880217, "question_id": 29879257, "link": "https://stackoverflow.com/questions/29879257/type-hole-in-where-clause-not-working/29880217#29880217", "title": "Type hole in where clause not working", "body": "<p>In the  following code</p>\n\n<pre><code>let x = something\nin f x\n</code></pre>\n\n<p>type inference of <code>x = something</code> does not consider <code>f</code>. That is, the type of <code>something</code> is inferred, generalized to polymorphic types, and <code>x</code> gets that type. This might assign <code>x</code> a type which is more general than the type needed by <code>f</code>. </p>\n\n<p>More concretely, in</p>\n\n<pre><code>let x = \\y-&gt;y\nin  x \"hello\"\n</code></pre>\n\n<p>we infer the polymorphic binding <code>x :: forall a. a-&gt;a</code>.\nNote that <code>String</code> does not show up, yet.</p>\n\n<p>I guess GHC prints type hole information at that time, just after having performed type inference on the <code>let</code> definition. In the posted example,</p>\n\n<pre><code>do one\n   two\nwhere process = _\n</code></pre>\n\n<p>we infer <code>_ :: t</code> without looking at the context and print that type. If you instead want a more specialized (monomorphic) type, try instead</p>\n\n<pre><code>(\\process -&gt; do\n   one\n   two\n) _\n</code></pre>\n\n<p>Above, we do not use <code>let</code> or <code>where</code>, so only monomorphic types will be inferred.</p>\n"}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 2, "accepted_answer_id": 29880217, "answer_count": 1, "score": 4, "last_activity_date": 1430071752, "creation_date": 1430060551, "question_id": 29879257, "link": "https://stackoverflow.com/questions/29879257/type-hole-in-where-clause-not-working", "title": "Type hole in where clause not working", "body": "<p>I have the following</p>\n\n<pre><code>readStatement :: String -&gt; IO  [Transaction]\nreadStatement path = do\n   csvData &lt;- readFile path\n   return $ catMaybes (map _ (splitOn \"\\r\" csvData))\n</code></pre>\n\n<p>The GHC find the following type for the hole <code>[Char] -&gt; Maybe Transaction</code>.\nNow, if I give a name to this hole and move into a where clause</p>\n\n<pre><code>readStatement :: String -&gt; IO  [Transaction]\nreadStatement path = do\n   csvData &lt;- readFile path\n   return $ catMaybes (map process (splitOn \"\\r\" csvData))\n   where process = _ \n</code></pre>\n\n<p>GHC can't find the type of the new line but gives :</p>\n\n<pre><code>Found hole \u2018_\u2019 with type: t\nWhere: \u2018t\u2019 is a rigid type variable bound by\n           the inferred type of process :: t at Statement.hs:63:11\nRelevant bindings include\n  process :: t (bound at Statement.hs:63:11)\n  path :: String (bound at Statement.hs:60:15)\n  readStatement :: String -&gt; IO [Transaction]\n    (bound at Statement.hs:60:1)\nIn the expression: _\nIn an equation for \u2018process\u2019: process = _\nIn an equation for \u2018readStatement\u2019:\n    readStatement path\n      = do { csvData &lt;- readFile path;\n             return $ catMaybes (map process (splitOn \"\\r\" csvData)) }\n      where\n          process = _\n</code></pre>\n\n<p>The code is strictly equivalent, so how comes the type inference doesn't give the same result ? (I'm using GHC 7.8.3)</p>\n"}, {"tags": ["haskell", "function-composition"], "comments": [{"owner": {"reputation": 1733, "user_id": 293735, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/6fe5bc171f84a440181f7274c5065443?s=128&d=identicon&r=PG", "display_name": "berdario", "link": "https://stackoverflow.com/users/293735/berdario"}, "edited": false, "score": 3, "creation_date": 1430056974, "post_id": 29878545, "comment_id": 47881211, "body": "I think you&#39;re a bit confused, <code>.</code> is right associative, but <code>h = f . g</code> is indeed equivalent to <code>h x = f (g x)</code>:  <code>h = (*3) . (+2)</code>. <code>h 2</code> yields <code>12</code>, as you&#39;d expect if <code>(+2)</code> would be evaluated before"}, {"owner": {"reputation": 1733, "user_id": 293735, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/6fe5bc171f84a440181f7274c5065443?s=128&d=identicon&r=PG", "display_name": "berdario", "link": "https://stackoverflow.com/users/293735/berdario"}, "edited": false, "score": 0, "creation_date": 1430057070, "post_id": 29878545, "comment_id": 47881244, "body": "Also, the associative property is meaningful when you have more than 1 operation (and thus more than 2 operands): <a href=\"https://en.wikipedia.org/wiki/Associative_property\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Associative_property</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1430058230, "post_id": 29878545, "comment_id": 47881685, "body": "Why <code>h x = f (g x)</code> and not <code>h x = g (f x)</code> isn&#39;t a question of the associativity of composition, but rather how the operands to <code>.</code> are treated. A question of associativity would be why <code>f . g . h</code> is parsed as <code>f . (g . h)</code> and not <code>(f . g) . h</code>, but in fact, composition is fully associative and both parenthesizations are correct. Composition is the same as addition in this sense."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1430058326, "post_id": 29878545, "comment_id": 47881730, "body": "See <a href=\"http://stackoverflow.com/q/20342860/1126841\">stackoverflow.com/q/20342860/1126841</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 8, "creation_date": 1430058895, "post_id": 29878668, "comment_id": 47881961, "body": "Traditional it is; intuitive it is not. It makes the order of the text the opposite of the order of the diagram, which is extremely annoying."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1430059937, "post_id": 29878668, "comment_id": 47882341, "body": "which diagram? and couldn&#39;t you then also say that <code>f x</code> is unintuitive to start with? compared to <code>x.f()</code>, that is."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1430060045, "post_id": 29878668, "comment_id": 47882387, "body": "&quot;diagram&quot; in the serse of category theory. That is: if you have a function <code>f:a-&gt;b</code> and another <code>g:b-&gt;c</code>, it feels unnatural to write <code>g.f</code> composing arrows/functions/morphisms in the opposite order."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 3, "creation_date": 1430060154, "post_id": 29878668, "comment_id": 47882429, "body": "yes, but perhaps it should be <code>f:b&lt;-a</code> in the first place, because we also apply the argument from right to left (<code>f x</code> not <code>x f</code>)... therefore, I&#39;d say that <code>(f . g) x == f (g x)</code> is at least consistent with <code>f x</code> because the argument &quot;flows through&quot; the function from right to left."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 4, "creation_date": 1430060293, "post_id": 29878668, "comment_id": 47882483, "body": "in other words, if the types flow left to right (like in <code>f:a-&gt;b</code> and <code>g:b-&gt;c</code>) then we should also have <code>(x)f</code> (vs <code>f(x)</code>), and <code>(x)(f . g) : a -&gt; b</code>; then everything would be truly consistent and intuitive."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1430060345, "post_id": 29878668, "comment_id": 47882505, "body": "Indeed, we should reverse application notation as well to be consistent."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 3, "creation_date": 1430060384, "post_id": 29878668, "comment_id": 47882522, "body": "...which is probably why so many people like the OO style: <code>x.f().g()</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1430069313, "post_id": 29878668, "comment_id": 47886022, "body": "@ErikAllik Richard Bird&#39;s <i>The Algebra of Programming</i> uses flipped composition and flipped arrows in type signatures, so there is some precedent."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1498526053, "post_id": 29878668, "comment_id": 76522528, "body": "@chi I don&#39;t think reversing one or the other notation can make everything consistent. If you have <code>f :: a -&gt; b -&gt; c -&gt; d</code>, then you can have <code>f x y z</code>, and read the types of the arguments <code>x :: a</code>, <code>y :: b</code>, <code>z :: c</code> in left-to-right order. If you reverse application order, you&#39;d end up with <code>z y x f</code>; now we&#39;re writing arguments in the opposite order to the order their types appear in the signature. Reversing the arrows instead gives you the same problem. You can only line up 2 of the 3 (directions of arrows, order of arguments in function type, order of arguments in function application)."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1498553369, "post_id": 29878668, "comment_id": 76532342, "body": "@Ben you could go <code>f :: c &lt;- b &lt;- a </code> (or even <code>c &lt;- b &lt;- a :: f</code>)"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1498605130, "post_id": 29878668, "comment_id": 76563428, "body": "@ErikAllik  Sorry, it&#39;s not the direction of arrows I meant to write (that&#39;s basically the same thing as the order of types in the function signature), but the direction in which arguments &quot;flow&quot; through functions (the thing that many people like being left-to-right in OO style method invocation)."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1498605698, "post_id": 29878668, "comment_id": 76563595, "body": "@ErikAllik But thinking about it now, I realise my point is less interesting than I thought it was yesterday. &quot;Direction of data flow&quot; simply is nothing more than the opposite of the order in which you write arguments. So naturally you can&#39;t get both of those in the same order (unless you go the OO route and treat one argument specially, and then only think about &quot;flows&quot; of the special arguments... that syntax design is actually cleverer than I had realised)."}], "tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": true, "score": 15, "last_activity_date": 1430058561, "last_edit_date": 1430058561, "creation_date": 1430057358, "answer_id": 29878668, "question_id": 29878545, "link": "https://stackoverflow.com/questions/29878545/why-does-the-dot-compose-from-right-to-left-in-haskell/29878668#29878668", "title": "Why does the dot compose from right to left in Haskell?", "body": "<p>First of all, there's a mistake in your [original, unedited] question:</p>\n\n<blockquote>\n  <p>h = f . g is equivalent to h x = g(f x)</p>\n</blockquote>\n\n<p>\u2014 that's not true: <code>h = f . g</code> is equivalent to <code>h x = f (g x)</code>.</p>\n\n<p>However, as to why it's that way and not the other way around, it's most likely because that's how it works and has worked in math; see <a href=\"http://en.wikipedia.org/wiki/Function_composition\">http://en.wikipedia.org/wiki/Function_composition</a>:</p>\n\n<blockquote>\n  <p>[...] <em>composite</em> function is denoted <em>g\u2009\u2218\u2009f : X \u2192 Z</em>, defined by <em>(g\u2009\u2218\u2009f\u2009)(x) = g(f(x))</em> for all <em>x</em> in <em>X</em>.</p>\n</blockquote>\n\n<p>It's also intuitive because of the equality <code>(f . g) x == f (g x)</code> \u2014 as you can see, the order of <code>f</code> and <code>g</code> is the same on both sides.</p>\n\n<hr>\n\n<p>Moreover, it's trivial to create your own \"reverse composition\" operator if you desire one for reasons of e.g. readability:</p>\n\n<pre><code>(.&gt;) = flip (.)\n</code></pre>\n\n<p>so that</p>\n\n<pre><code>Prelude&gt; ((+1) .&gt; (*2)) 3\n8\nPrelude&gt; ((+1) . (*2)) 3\n7\n</code></pre>\n\n<hr>\n\n<p>In fact, you can just use <code>Control.Arrow.(&gt;&gt;&gt;)</code> which does the same for functions but is more general and works for other things as well:</p>\n\n<pre><code>Prelude Control.Arrow&gt; ((+1) &gt;&gt;&gt; (*2)) 3\n8\n</code></pre>\n"}], "owner": {"reputation": 5480, "user_id": 532901, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5581aede1e72c9bbadf038129896b809?s=128&d=identicon&r=PG", "display_name": "Tiddo", "link": "https://stackoverflow.com/users/532901/tiddo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2035, "favorite_count": 2, "accepted_answer_id": 29878668, "answer_count": 1, "score": 8, "last_activity_date": 1430058561, "creation_date": 1430056654, "last_edit_date": 1430057934, "question_id": 29878545, "link": "https://stackoverflow.com/questions/29878545/why-does-the-dot-compose-from-right-to-left-in-haskell", "title": "Why does the dot compose from right to left in Haskell?", "body": "<p>If we have two functions, <code>f</code> and <code>g</code>, then in Haskell <code>h = f . g</code> is equivalent to <code>h x = f(g x)</code>. I.e. the functions are applied from right to left to the input. Is there any fundamental reason why it goes from right to left, and not from left to right? I.e. why didn't they make <code>h = f . g</code> equivalent to <code>h x = g(f x)</code> instead?</p>\n\n<p>EDIT: as others pointed out my equivalent functions where the wrong way around, so I fixed those.</p>\n"}, {"tags": ["haskell", "ghc", "pragma"], "answers": [{"tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 7, "last_activity_date": 1430055507, "creation_date": 1430055507, "answer_id": 29878355, "question_id": 29877714, "link": "https://stackoverflow.com/questions/29877714/do-ghc-rewrite-pragmas-have-to-be-type-preserving/29878355#29878355", "title": "Do GHC REWRITE pragmas have to be type preserving?", "body": "<p>No, this wouldn't work. Rewrite rules are only applied if the types check. In this case the rule would only fire if you ran <code>castVar :: Term c Void -&gt; Term c Void</code>, which isn't very helpful. (See <a href=\"https://downloads.haskell.org/~ghc/7.10.1/docs/html/users_guide/rewrite-rules.html\">https://downloads.haskell.org/~ghc/7.10.1/docs/html/users_guide/rewrite-rules.html</a> for more info on rewrite rules)</p>\n\n<p>What you want is to coerce the type. It's safe to do this because you know there's no <code>Void</code> in the <code>Term</code>. You could either do this by importing <code>Unsafe.Coerce</code> and <code>castVar = unsafeCoerce</code> or make <code>Term</code> an instance of <code>Functor</code> (you can derive it for this simple version) and use <code>unsafeVacuous</code> from <code>Data.Void.Unsafe</code>.</p>\n"}], "owner": {"reputation": 3702, "user_id": 312692, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7095c2c6e64c9147a017300fff9864d7?s=128&d=identicon&r=PG", "display_name": "wen", "link": "https://stackoverflow.com/users/312692/wen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 29878355, "answer_count": 1, "score": 5, "last_activity_date": 1430055507, "creation_date": 1430051873, "question_id": 29877714, "link": "https://stackoverflow.com/questions/29877714/do-ghc-rewrite-pragmas-have-to-be-type-preserving", "title": "Do GHC REWRITE pragmas have to be type preserving?", "body": "<pre><code>import Data.Void (Void,absurd)\n</code></pre>\n\n<p>Say I have a small term language:</p>\n\n<pre><code>data Term c v where\n  Var :: v               -&gt; Term c v\n  Con :: c -&gt; [Term c v] -&gt; Term c v\n</code></pre>\n\n<p>If I want to combine terms of the type <code>Term c Void</code> and <code>Term c Int</code>, that should be possible, since I have the guarantee that the first term does not contain any variables. Therefore, I can write the function:</p>\n\n<pre><code>castVar :: Term c Void -&gt; Term c v\ncastVar (Var i   ) = absurd i\ncastVar (Con x xs) = Con x (map castVar xs)\n</code></pre>\n\n<p>However, it'd be a shame to actually run this function, since I know for a fact that it doesn't actually change anything. Is it safe to add the following pragmas:</p>\n\n<pre><code>{-# NOINLINE castVar #-}\n{-# RULES \"castVar/id\" forall x. castVar x = x; #-}\n</code></pre>\n\n<p>And will this actually achieve the desired result?</p>\n\n<p>Are there better ways of doing this?</p>\n"}, {"tags": ["haskell", "data-structures", "memory-leaks", "sdl"], "comments": [{"owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "edited": false, "score": 0, "creation_date": 1430054965, "post_id": 29877689, "comment_id": 47880543, "body": "shot in the dark, but did you test the same with Data.Vector.Unboxed?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "edited": false, "score": 0, "creation_date": 1430055306, "post_id": 29877689, "comment_id": 47880634, "body": "@hasufell OP&#39;s storing <code>[Tile]</code>-s in the vector, which can&#39;t be unboxed."}, {"owner": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "edited": false, "score": 0, "creation_date": 1430056521, "post_id": 29877689, "comment_id": 47881052, "body": "yes I thought about it but like Andr&#225;s said it seems I can only store basic types with unboxed vectors."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1430078475, "post_id": 29877689, "comment_id": 47889619, "body": "Tip that may or may not help: use <code>Vector [Tile]</code> instead of <code>Vector (Vector [Tile])</code>. You can index it as though it was 2D. You could also use <code>Vec.map</code> and <code>Vec.mapM</code> for update instead of indexing, <code>Vec.fromList</code> and <code>sequence</code>."}], "answers": [{"comments": [{"owner": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "edited": false, "score": 0, "creation_date": 1430085893, "post_id": 29883902, "comment_id": 47892221, "body": "Brilliant, that did it! But what would happen if I only needed to look at a small part of the current vector to construct the next one? would the necessity to reduce all the &#233;lements to WHNF force me to go through the whole vector?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "edited": false, "score": 0, "creation_date": 1430111912, "post_id": 29883902, "comment_id": 47899174, "body": "If you&#39;re using vectors, then the whole vector must be copied on every update anyway. So whnf-ing all the elements doesn&#39;t add much overhead, and it can&#39;t be skipped either, because skipping it for any single element brings back the memory leak."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "edited": false, "score": 0, "creation_date": 1430112473, "post_id": 29883902, "comment_id": 47899393, "body": "If you want efficient update, you have to use something else than vectors. <code>Data.IntMap</code> or <code>Data.HashMap</code> are likely the fastest for this, but note that they have considerable space-time overheads. Perhaps you could try a <code>Map</code> containing vector blocks of some size (16-32); with that you get much better space efficiency. You must copy at least one whole block on every update, but it&#39;s a a bounded and possibly tolerable amount, unlike with vectors."}, {"owner": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "edited": false, "score": 0, "creation_date": 1430150992, "post_id": 29883902, "comment_id": 47924178, "body": "This time I defined the functions <code>vImap&#39; f = whnfElements.Vec.imap f</code> and <code>update m (i,j,v) = vImap&#39; (\\k v&#39; -&gt; if k == i                                     then vImap&#39; (\\l v&#39;&#39; -&gt; if l == j then v else v&#39;&#39;) v&#39;                                     else v&#39;) m </code> in order to allow update based on indexing. Using it brings back the memory leak, even though I used @ Andr&#225;s <code>whnfElements</code> in the definition of vImap&#39;.  I don&#39;t see where the thunks are accumulating this time."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "edited": false, "score": 0, "creation_date": 1430160217, "post_id": 29883902, "comment_id": 47929726, "body": "Look at the <code>else v&#39;</code> part. You&#39;re not doing <code>whnfElement</code> there."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "edited": false, "score": 0, "creation_date": 1430160283, "post_id": 29883902, "comment_id": 47929764, "body": "BTW, I think you should use <code>Vector [Tile]</code> instead of <code>Vector (Vector [Tile])</code>. It&#39;s faster, smaller and more convenient with library functions."}, {"owner": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "edited": false, "score": 0, "creation_date": 1430162834, "post_id": 29883902, "comment_id": 47931232, "body": "Ok, It&#39;s working again, lazy evaluation is hurting my brain! :) I am going to try to switch to Vector [Tile]. Thank you for your help!"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1430084390, "creation_date": 1430084390, "answer_id": 29883902, "question_id": 29877689, "link": "https://stackoverflow.com/questions/29877689/haskell-data-vector-huge-memory-leak/29883902#29883902", "title": "Haskell Data.Vector, huge memory leak", "body": "<p>The problem is indeed that vectors are lazy in the elements. First, let's look at why your example doesn't work.</p>\n\n<pre><code>let !m' = [id $! [(tail $! (m \u00a7 (i,j))) | j &lt;- [0..wid]] | i &lt;- [0..hei]]\n</code></pre>\n\n<p>The bang pattern in <code>!m</code> doesn't do much. All <code>!</code> does is ensure that a variable is a constructor or a lambda, instead of a function application. Here <code>!m</code> can be discerned to be either an <code>[]</code> or a <code>(:)</code> without evaluating any elements. Similarly, the <code>\u012fd $!</code>-s don't force any actual elements of the inner lists. </p>\n\n<pre><code>return ch { chLand = fromMat m' }\n</code></pre>\n\n<p><code>fromMat</code> is the next culprit. <code>fromMat</code> doesn't force the inner vectors, and also doesn't force the elements. As a result, references to old vectors stick around in the thunks indefinitely.</p>\n\n<p>Often the correct solution is to import <code>Control.DeepSeq</code>, and use <code>force</code> or <code>$!!</code> to fully evaluate vectors. Unfortunately, we can't do that here because of the cyclic lists (trying to force one results in an infinite loop).</p>\n\n<p>What we really need is a function that brings all the elements of a vector to weak head normal form:</p>\n\n<pre><code>whnfElements :: Vector a -&gt; Vector a\nwhnfElements v = V.foldl' (flip seq) () v `seq` v\n</code></pre>\n\n<p>We can use this to define a strict <code>map</code> for vectors:</p>\n\n<pre><code>vmap' :: (a -&gt; b) -&gt; Vector a -&gt; Vector b\nvmap' f = whnfElements . V.map f\n</code></pre>\n\n<p>Now updating becomes:</p>\n\n<pre><code>update :: Mat [Tile] -&gt; Mat [Tile]\nupdate = (vmap' . vmap') tail\n</code></pre>\n"}], "owner": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 1, "accepted_answer_id": 29883902, "answer_count": 1, "score": 1, "last_activity_date": 1430084390, "creation_date": 1430051740, "question_id": 29877689, "link": "https://stackoverflow.com/questions/29877689/haskell-data-vector-huge-memory-leak", "title": "Haskell Data.Vector, huge memory leak", "body": "<p>I am trying to make a basic 2D engine with haskell and the SDL1.2 bindings (for fun, I am just learning).\nIdeally the world is to be procedurally generated, chunk by chunk, allowing free exploration.</p>\n\n<p>Right now my chunk is composed of 200*200 tiles which I represent using a type:</p>\n\n<p><code>Mat [Tile] = Vec.Vector (Vec.Vector [Tile])</code></p>\n\n<p>and these functions:</p>\n\n<pre><code>fromMat :: [[a]] -&gt;  Mat a\nfromMat xs = Vec.fromList [Vec.fromList xs' | xs' &lt;- xs]\n\n(\u00a7) :: Mat a -&gt; (Int, Int) -&gt; a\nv \u00a7 (r, c) = (v Vec.! r) Vec.! c\n</code></pre>\n\n<p>I am using cyclic list of tiles in order to allow for sprite animation, and later for dynamic behaviour.  </p>\n\n<p>Each frame of the game loop, the program reads the part of the vector relevant to the current camera position, display the corresponding tiles and return a new vector in which every of these cyclic lists has been replaced by it's tail.</p>\n\n<p>Here is the code responsible for this:</p>\n\n<pre><code>applyTileMat :: Chunk -&gt; SDL.Surface -&gt; SDL.Surface -&gt; IO Chunk\napplyTileMat ch src dest = \n  let m = chLand $! ch\n      (x,y) = chPos ch\n      wid = Vec.length (m Vec.! 0) - 1\n      hei = (Vec.length m) - 1\n      (canW,canH) = canvasSize ch in\n\n  do sequence $ [ applyTile (head (m \u00a7 (i,j))) (32*(j-x), 32*(i-y)) src dest | i &lt;- [y..(y+canH)], j &lt;- [x..(x+canW)]]\n     m' &lt;-sequence $ [sequence [(return $! tail (m \u00a7 (i,j))) | j &lt;- [0..wid]] | i &lt;- [0..hei]] --weird :P\n     return ch { chLand = fromMat m' }\n</code></pre>\n\n<p>the first sequence does the display part, the second one returns the new vector m'.</p>\n\n<p>At first I was using the following comprehension to get m'</p>\n\n<pre><code>let !m' = [id $! [(tail $! (m \u00a7 (i,j))) | j &lt;- [0..wid]] | i &lt;- [0..hei]]\n</code></pre>\n\n<p>but doing so results in ever increasing memory usage. I think it has to do with lazy evaluation preventing the data to be properly garbage collected, but I don't really understand why. </p>\n\n<p>In this particular case, it doesn't really mater since I have to look at the whole vector. But I don't know how I should do if I wanted to only \"update\" part of my chunk each frame, thus making a new chunk with only part of the data from the previous one.</p>\n\n<p>I am probably not using Data.Vector the way it's intended, but it's the simplest data structure I found with O(n) random access.</p>\n\n<p>The whole code is there:\n<a href=\"https://github.com/eniac314/wizzard/blob/master/tiler.hs\" rel=\"nofollow\">https://github.com/eniac314/wizzard/blob/master/tiler.hs</a></p>\n"}, {"tags": ["sorting", "haskell", "insertion-sort"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 4834267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/764fbd35d072d6c106fa9a9ad8ee8597?s=128&d=identicon&r=PG&f=1", "display_name": "Princeps", "link": "https://stackoverflow.com/users/4834267/princeps"}, "edited": false, "score": 0, "creation_date": 1430051167, "post_id": 29877562, "comment_id": 47879290, "body": "Thanks for your help :) but Is there other way to implement function in ghci directly?"}, {"owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "edited": false, "score": 0, "creation_date": 1430051778, "post_id": 29877562, "comment_id": 47879489, "body": "see <a href=\"http://stackoverflow.com/questions/2846050/how-to-define-a-function-in-ghci-across-multiple-lines\" title=\"how to define a function in ghci across multiple lines\">stackoverflow.com/questions/2846050/&hellip;</a>"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "edited": false, "score": 0, "creation_date": 1430052539, "post_id": 29877562, "comment_id": 47879749, "body": "@hasufell why not - maybe the OP will like that - I usually don&#39;t recommend this because you will learn to hate this quite quickly (when you reentered the thing the 3rd time) and writing a quick file (or even using emacs/vim) is much faster and better to experiment in the long run - after all it will take some time for Princeps to finish his insert-sort"}, {"owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "edited": false, "score": 0, "creation_date": 1430054402, "post_id": 29877562, "comment_id": 47880399, "body": "I agree, I also rather load files via ghci and benefit from the power of my editor (syntax highlighting, hlint support etc.)."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1430051681, "last_edit_date": 1430051681, "creation_date": 1430050912, "answer_id": 29877562, "question_id": 29877403, "link": "https://stackoverflow.com/questions/29877403/have-some-troubles-in-implementing-insertion-sort-function-in-haskell/29877562#29877562", "title": "Have some troubles in implementing Insertion Sort function in Haskell", "body": "<p>you are overwriting your first function <code>let insert x [] = x:[]</code> with another one (in your next <code>let insert ...</code> - this happens because you use <code>let ...</code> inside GHCi) </p>\n\n<p>Instead you should create <em>.hs</em> file and load this into <em>GHCi</em> instead.</p>\n\n<p>So fire up your favorite editor and insert this:</p>\n\n<pre><code>module MyInsertSort where\n\ninsert :: Ord a =&gt; a -&gt; [a] -&gt; [a]\ninsert x []     = x:[]\ninsert x (y:ys) = if x &lt; y then x:y:ys else y : insert x ys\n</code></pre>\n\n<p>save it (I did as <code>MyInsert.hs</code>), start <code>ghci</code> and load it into it:</p>\n\n<pre><code>\u03bb&gt; :l MyInsert.hs\n[1 of 1] Compiling MyInsertSort     ( MyInsert.hs, interpreted )\nOk, modules loaded: MyInsertSort.\n\u03bb&gt; insert 4 ([1,2,3])\n[1,2,3,4]\n\n\u03bb&gt; insert 1 ([2,3])\n[1,2,3]\n</code></pre>\n\n<p>now it should work :D</p>\n\n<h2>remarks</h2>\n\n<p>you had a small error in your second line <code>insert ys</code> instead of  <code>insert x ys</code></p>\n"}], "owner": {"reputation": 3, "user_id": 4834267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/764fbd35d072d6c106fa9a9ad8ee8597?s=128&d=identicon&r=PG&f=1", "display_name": "Princeps", "link": "https://stackoverflow.com/users/4834267/princeps"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "accepted_answer_id": 29877562, "answer_count": 1, "score": 0, "last_activity_date": 1431700543, "creation_date": 1430050053, "last_edit_date": 1431700543, "question_id": 29877403, "link": "https://stackoverflow.com/questions/29877403/have-some-troubles-in-implementing-insertion-sort-function-in-haskell", "title": "Have some troubles in implementing Insertion Sort function in Haskell", "body": "<p>I am beginner level of the Haskell Language and I was trying to implement Insertion Sort function in Haskell in ghci environment.</p>\n\n<p>here's my code.</p>\n\n<pre><code>prelude&gt; let insert x [] = x:[]\n\ninsert :: t1 -&gt; [t] -&gt; [t1]\n\nprelude&gt; let insert x (y:ys) = \nif x &lt; y then x:y:ys else y : insert ys\n\n\ninsert :: Ord a =&gt; a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>I tried</p>\n\n<pre><code>insert 1 []\n</code></pre>\n\n<p>the result was [1], It worked well.</p>\n\n<p>and I tried</p>\n\n<pre><code>insert 1 ([2,3]) \n</code></pre>\n\n<p>the result was [1,2,3], Still it works well.</p>\n\n<p>(Actually, I don't know why I have to parse on second argument list.\n but if I try insert 1 [2,3], it doesn't work.)</p>\n\n<p>it worked well until this. but when I tried</p>\n\n<pre><code>insert 4 ([1,2,3]) \n</code></pre>\n\n<p>It happened like this.</p>\n\n<pre><code>[1,2,3*** Exception: &lt;interactive&gt;:165:5-61: Non-exhaustive patterns in function \n</code></pre>\n\n<p>I don't why it did happen like this.please help me.</p>\n"}, {"tags": ["ruby", "haskell", "math"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1430050932, "post_id": 29877381, "comment_id": 47879215, "body": "<a href=\"http://stackoverflow.com/questions/14027865/modulus-remainder-function-for-non-integers\" title=\"modulus remainder function for non integers\">stackoverflow.com/questions/14027865/&hellip;</a>"}, {"owner": {"reputation": 656, "user_id": 2067248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8259a621b065428d8756fda25da84adc?s=128&d=identicon&r=PG", "display_name": "lokulin", "link": "https://stackoverflow.com/users/2067248/lokulin"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1430087292, "post_id": 29877381, "comment_id": 47892666, "body": "@AJFarmar thanks, funny how many times using different words gets the correct answer. :-)"}], "owner": {"reputation": 656, "user_id": 2067248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8259a621b065428d8756fda25da84adc?s=128&d=identicon&r=PG", "display_name": "lokulin", "link": "https://stackoverflow.com/users/2067248/lokulin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "closed_date": 1430051638, "answer_count": 0, "score": 1, "last_activity_date": 1430052452, "creation_date": 1430049901, "last_edit_date": 1430052452, "question_id": 29877381, "link": "https://stackoverflow.com/questions/29877381/does-haskell-have-an-equivalent-of-rubys-and-others-mod-operator", "closed_reason": "Duplicate", "title": "Does Haskell have an equivalent of Ruby&#39;s (and others) % (mod) operator?", "body": "<p>Ruby's mod operator (%) is defined as a floored division:</p>\n\n<pre><code>x.modulo(y) means x-y*(x/y).floor\n</code></pre>\n\n<p>This gives results like:</p>\n\n<pre><code>irb(main):001:0&gt; -0.5 % 2\n=&gt; 1.5\n</code></pre>\n\n<p>Does Haskell have a built in equivalent operator/function?</p>\n\n<p>So far I can only find reference to mod, divMod, rem and the like, all of which only seem to operate on Integral types, or am I missing something?</p>\n\n<p>At the moment I've just defined a function:</p>\n\n<pre><code>fmod :: Float -&gt; Float -&gt; Float\nfmod a b = a - b * fromIntegral(floor (a/b))\n</code></pre>\n\n<p>But I'd like to use something built in if available.</p>\n"}, {"tags": ["haskell", "functional-programming", "traversal"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1430046562, "post_id": 29876772, "comment_id": 47877938, "body": "The two traversals will likely be fused to one when you turn on optimisations in GHC. But, yeah, in principle you&#39;re right, though the second traversal is only over the shorter, filtered list, so it would often not matter that much anyway."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1430047563, "post_id": 29876772, "comment_id": 47878197, "body": "The second version is not tail recursive and will probably lead to more memory being used than the first. You can use a (strict) accumulator instead to keep it in constant memory. Or you could use <code>foldl&#39; (\\c a -&gt; if p a then succ c else c) 0</code>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430053071, "post_id": 29876772, "comment_id": 47879935, "body": "you might like the <a href=\"https://hackhands.com/guide-lazy-evaluation-haskell/\" rel=\"nofollow noreferrer\">guide to lazy evaluation</a> :D"}], "answers": [{"comments": [{"owner": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "edited": false, "score": 0, "creation_date": 1430051501, "post_id": 29877318, "comment_id": 47879400, "body": "Is my understanding correct? <code>filter</code> constructs the filtered list one-by-one as requested by <code>length</code> which in turn deconstructs it. This intermediate construction/deconstruction might be called &quot;second traversal&quot;, but the compiler can optimize it away."}, {"owner": {"reputation": 708, "user_id": 4553930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/308c878dca0a01a80bc9b5b9b19c7ab6?s=128&d=identicon&r=PG&f=1", "display_name": "Abhay", "link": "https://stackoverflow.com/users/4553930/abhay"}, "reply_to_user": {"reputation": 3137, "user_id": 1862339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7e1fdbdf79034c63bd0fb1b51e48695f?s=128&d=identicon&r=PG", "display_name": "stholzm", "link": "https://stackoverflow.com/users/1862339/stholzm"}, "edited": false, "score": 0, "creation_date": 1430052027, "post_id": 29877318, "comment_id": 47879575, "body": "@stholzm Right. I would put it this way: the first and the second traversals are interleaved due to laziness. An optimizing compiler can remove the second one because all it is doing is constructing and destructing (and adding one to some other number)."}], "tags": [], "owner": {"reputation": 708, "user_id": 4553930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/308c878dca0a01a80bc9b5b9b19c7ab6?s=128&d=identicon&r=PG&f=1", "display_name": "Abhay", "link": "https://stackoverflow.com/users/4553930/abhay"}, "is_accepted": false, "score": 3, "last_activity_date": 1430051037, "last_edit_date": 1430051037, "creation_date": 1430049531, "answer_id": 29877318, "question_id": 29876772, "link": "https://stackoverflow.com/questions/29876772/isnt-this-a-double-traversal/29877318#29877318", "title": "Isn&#39;t this a double traversal?", "body": "<p>Either way, you have to perform one or two operations per item. The necessary one is the checking of the predicate. The second one of adding 1 depends on the result of the predicate.</p>\n\n<p>So, if you don't consider the effects of cache etc., both cases generate equal number of operations.</p>\n\n<p>The picture that one gets is that there are two separate traversals in the first case, one gathering the elements, and one counting them. Given a list bigger than the cache can handle, this will slow down the processing. And this actually happens in a <em>strict</em> language.</p>\n\n<p>However Haskell's laziness comes into picture here. The list generated by <code>filter</code> is evaluated (comes into existence) element-by-element, as the counting function <code>length</code> needs it. And then as <code>length</code> uses them just for counting and does not preserve references to the newly created list, the elements are immediately free to be garbage-collected. So at any time, there is only <code>O(1)</code> memory occupied during the calculation.</p>\n\n<p>There is a slight overhead of constructing the resultant \"filtered\" list in the first version. But this is usually negligible compared with cache effects which come in when the lists are large. (For small lists it may matter; this needs to be tested.) Further, it may be optimized away depending upon the compiler and the optimization level chosen.</p>\n\n<p><strong>Update.</strong> The second version will actually consume memory as is pointed out in one of the comments. For a fair comparison ,you need to write it with accumulating parameter and strictness annotator at the right place, because (I expect) <code>length</code> is already written this way.</p>\n"}, {"comments": [{"owner": {"reputation": 708, "user_id": 4553930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/308c878dca0a01a80bc9b5b9b19c7ab6?s=128&d=identicon&r=PG&f=1", "display_name": "Abhay", "link": "https://stackoverflow.com/users/4553930/abhay"}, "edited": false, "score": 0, "creation_date": 1430050398, "post_id": 29877342, "comment_id": 47879017, "body": "Thanks for the timings! Just wondering why the number 93823249?"}, {"owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "reply_to_user": {"reputation": 708, "user_id": 4553930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/308c878dca0a01a80bc9b5b9b19c7ab6?s=128&d=identicon&r=PG&f=1", "display_name": "Abhay", "link": "https://stackoverflow.com/users/4553930/abhay"}, "edited": false, "score": 0, "creation_date": 1430051136, "post_id": 29877342, "comment_id": 47879282, "body": "That is a random number."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 1, "creation_date": 1430072324, "post_id": 29877342, "comment_id": 47887219, "body": "Why profiling? Profiling is useful to figure out <i>where</i> in a single program the time is spent. It&#39;s not a good tool for benchmarking. Better use a library such as <code>criterion</code> for benchmarking."}, {"owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "edited": false, "score": 0, "creation_date": 1430075205, "post_id": 29877342, "comment_id": 47888380, "body": "Do you have references why profiling isn&#39;t suitable to do basic benchmarking? I&#39;m not a haskell guru."}], "tags": [], "owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "is_accepted": false, "score": 2, "last_activity_date": 1430049679, "creation_date": 1430049679, "answer_id": 29877342, "question_id": 29876772, "link": "https://stackoverflow.com/questions/29876772/isnt-this-a-double-traversal/29877342#29877342", "title": "Isn&#39;t this a double traversal?", "body": "<p>You can test which version is faster with <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html\" rel=\"nofollow\">profiling</a>, e.g.:</p>\n\n<pre><code>module Main where\n\n\nmain :: IO ()\nmain = print countme'\n\ncount' :: (a -&gt; Bool) -&gt; [a] -&gt; Int\ncount' p = length . filter p\n\ncount :: (a -&gt; Bool) -&gt; [a] -&gt; Int\ncount _ [] = 0\ncount p (x:xs)\n   | p x       = 1 + count p xs\n   | otherwise =     count p xs\n\n\nlist = [0..93823249]\n\ncountme' = count' (\\x -&gt; x `mod` 15 == 0) list\ncountme = count (\\x -&gt; x `mod` 15 == 0) list\n</code></pre>\n\n<p>Then run <code>ghc -O2 -prof -fprof-auto -rtsopts Main.hs</code> and <code>./Main +RTS -p</code>. It will yield the file <em>Main.prof</em>. Then change the main function to use <code>countme</code> instead and compare the results. Mine are:</p>\n\n<ul>\n<li><strong>4.12s</strong> for the implicit version</li>\n<li><strong>6.34s</strong> for the explicit version</li>\n</ul>\n\n<p>If you turn off optimization, then the implicit one is still slightly (but not much) faster.</p>\n\n<p>Apart from the fusion and laziness which was already explained by others, I guess another reason could be that <code>length</code> and <code>filter</code> are Prelude functions and can be better optimized by the compiler.</p>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 11, "last_activity_date": 1430052176, "last_edit_date": 1495541766, "creation_date": 1430052176, "answer_id": 29877771, "question_id": 29876772, "link": "https://stackoverflow.com/questions/29876772/isnt-this-a-double-traversal/29877771#29877771", "title": "Isn&#39;t this a double traversal?", "body": "<p>So to see what the optimizer actually does, let's <a href=\"https://wiki.haskell.org/Performance/GHC#Looking_at_the_Core\" rel=\"nofollow noreferrer\">look at the core</a>:</p>\n\n<pre><code>% ghc -O2 -ddump-simpl Temp.hs\n[1 of 1] Compiling Temp             ( Temp.hs, Temp.o )\n\n==================== Tidy Core ====================\nResult size of Tidy Core = {terms: 29, types: 26, coercions: 0}\n\nTemp.count\n  :: forall a_arN.\n     (a_arN -&gt; GHC.Types.Bool) -&gt; [a_arN] -&gt; GHC.Types.Int\n[GblId,\n Arity=2,\n Caf=NoCafRefs,\n Str=DmdType &lt;L,C(U)&gt;&lt;S,1*U&gt;,\n Unf=Unf{Src=&lt;vanilla&gt;, TopLvl=True, Arity=2, Value=True,\n         ConLike=True, WorkFree=True, Expandable=True,\n         Guidance=IF_ARGS [60 0] 191 0}]\nTemp.count =\n  \\ (@ a_aMA)\n    (p_arV :: a_aMA -&gt; GHC.Types.Bool)\n    (eta_B1 :: [a_aMA]) -&gt;\n    letrec {\n      go_aNr [Occ=LoopBreaker]\n        :: [a_aMA] -&gt; GHC.Prim.Int# -&gt; GHC.Types.Int\n      [LclId, Arity=1, Str=DmdType &lt;S,1*U&gt;]\n      go_aNr =\n        \\ (ds_aNs :: [a_aMA]) -&gt;\n          case ds_aNs of _ [Occ=Dead] {\n            [] -&gt; GHC.Types.I#;\n            : y_aNx ys_aNy -&gt;\n              case p_arV y_aNx of _ [Occ=Dead] {\n                GHC.Types.False -&gt; go_aNr ys_aNy;\n                GHC.Types.True -&gt;\n                  let {\n                    g_a10B [Dmd=&lt;L,C(U)&gt;] :: GHC.Prim.Int# -&gt; GHC.Types.Int\n                    [LclId, Str=DmdType]\n                    g_a10B = go_aNr ys_aNy } in\n                  \\ (x_a10C :: GHC.Prim.Int#) -&gt; g_a10B (GHC.Prim.+# x_a10C 1)\n              }\n          }; } in\n    go_aNr eta_B1 0\n</code></pre>\n\n<p>Cleaning it up a bit:</p>\n\n<pre><code>Temp.count :: forall aType.  (aType -&gt; Bool) -&gt; [aType] -&gt; Int\nTemp.count = \\(@ aType) (p :: aType -&gt; Bool) (as :: [aType]) -&gt;\n  letrec {\n    go :: [aType] -&gt; GHC.Prim.Int# -&gt; Int\n    go = \\(xs :: [aType]) -&gt;\n      case xs of _ {\n        [] -&gt; I#; -- constructor to make a GHC.Prim.Int# into an Int\n        : y ys -&gt;\n          case p y of _ {\n            False -&gt; go ys;\n            True -&gt;\n              let {\n                go' :: GHC.Prim.Int# -&gt; Int\n                go' = go ys \n              } in \\(x :: GHC.Prim.Int#) -&gt; go' (GHC.Prim.+# x 1)\n          }\n      }; \n  } in go as 0\n</code></pre>\n\n<p>Since we're operating on the unboxed type <code>GHC.Prim.Int#</code>, <a href=\"https://stackoverflow.com/questions/3131554/what-is-the-relationship-between-unboxed-types-and-strictness\">all the additions are strict</a>, so we only have one loop through the data.</p>\n"}], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 29877771, "answer_count": 3, "score": 3, "last_activity_date": 1430052176, "creation_date": 1430046009, "question_id": 29876772, "link": "https://stackoverflow.com/questions/29876772/isnt-this-a-double-traversal", "title": "Isn&#39;t this a double traversal?", "body": "<p>In the \"programming tips\" section of the <a href=\"https://wiki.haskell.org/Haskell_programming_tips#Avoid_explicit_recursion\" rel=\"nofollow\">haskell wiki</a>, I found this example:</p>\n\n<pre><code>count :: (a -&gt; Bool) -&gt; [a] -&gt; Int\ncount p = length . filter p\n</code></pre>\n\n<p>This was said to be a better alternative to</p>\n\n<pre><code>count :: (a -&gt; Bool) -&gt; [a] -&gt; Int\ncount _ [] = 0\ncount p (x:xs)\n   | p x       = 1 + count p xs\n   | otherwise =     count p xs\n</code></pre>\n\n<p>Which, in terms of readability, I entirely agree with.</p>\n\n<p>However, isn't that a double traversal, and therefore actually worse than the explicit-recursion function? Does laziness in GHC mean that this is equivalent to a single traverse after optimisation? Which implementation is faster, and why?</p>\n"}, {"tags": ["performance", "haskell", "optimization"], "comments": [{"owner": {"reputation": 49888, "user_id": 721644, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KSRQT.jpg?s=128&g=1", "display_name": "Vladimir F", "link": "https://stackoverflow.com/users/721644/vladimir-f"}, "edited": false, "score": 6, "creation_date": 1430041036, "post_id": 29875886, "comment_id": 47876276, "body": "Just a comment, it is not woth to compare any run-time below 1 second. Maybe the libraries loading takes time? Who knows. Try timing specific parts of the code and use larger problems or compute them multiple times."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1430041082, "post_id": 29875886, "comment_id": 47876285, "body": "Have you tried profiling?"}, {"owner": {"reputation": 612, "user_id": 1526408, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/W2hNT.jpg?s=128&g=1", "display_name": "Minsheng Liu", "link": "https://stackoverflow.com/users/1526408/minsheng-liu"}, "reply_to_user": {"reputation": 49888, "user_id": 721644, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KSRQT.jpg?s=128&g=1", "display_name": "Vladimir F", "link": "https://stackoverflow.com/users/721644/vladimir-f"}, "edited": false, "score": 1, "creation_date": 1430041441, "post_id": 29875886, "comment_id": 47876386, "body": "@VladimirF Since I have used -O2 optimization, I think even 0.1 second means a lot. @n.m. I lack experience in profiling Haskell programs. I googled a little and checked the GHC manual. The simple time profiling turns out that 73.3% time is spent in <code>collatzLen.collatzIter</code>, while 24.3% in <code>collatzNext</code>. I am sorry but that&#39;s the only thing I can get with my current understanding of Haskell profiling..."}, {"owner": {"reputation": 49888, "user_id": 721644, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KSRQT.jpg?s=128&g=1", "display_name": "Vladimir F", "link": "https://stackoverflow.com/users/721644/vladimir-f"}, "edited": false, "score": 0, "creation_date": 1430041550, "post_id": 29875886, "comment_id": 47876416, "body": "It may be a lot, but you must time specific parts of the code, not the OS overhead, to be sure. O2 does not mean too much by itself."}, {"owner": {"reputation": 612, "user_id": 1526408, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/W2hNT.jpg?s=128&g=1", "display_name": "Minsheng Liu", "link": "https://stackoverflow.com/users/1526408/minsheng-liu"}, "reply_to_user": {"reputation": 49888, "user_id": 721644, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KSRQT.jpg?s=128&g=1", "display_name": "Vladimir F", "link": "https://stackoverflow.com/users/721644/vladimir-f"}, "edited": false, "score": 4, "creation_date": 1430041914, "post_id": 29875886, "comment_id": 47876516, "body": "@VladimirF OS overhead can be measured approximately: by reducing n from 1000000 to 100, the time used by this program is <code>.&#47;a  0.00s user 0.00s system 29% cpu 0.013 total</code>, when n = 1000000, the time is <code>.&#47;a  1.14s user 0.01s system 99% cpu 1.157 total</code>. I also checked RTS&#39;s GC report, time used in GC is less than 1%."}, {"owner": {"reputation": 49888, "user_id": 721644, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KSRQT.jpg?s=128&g=1", "display_name": "Vladimir F", "link": "https://stackoverflow.com/users/721644/vladimir-f"}, "edited": false, "score": 0, "creation_date": 1430042055, "post_id": 29875886, "comment_id": 47876561, "body": "Good to know, I was just telling you to be careful and go more int the details. Just comparing the result of <code>time .&#47;a.out</code> is dangerous below 1 second."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 3, "creation_date": 1430042574, "post_id": 29875886, "comment_id": 47876698, "body": "You should note that division operation with powers of <code>2</code> is generally faster with unsigned int rather than signed int. And that may be the case why your <code>Word</code> instance is faster because <code>Word</code> represents unsigned integer."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 3, "creation_date": 1430044313, "post_id": 29875886, "comment_id": 47877244, "body": "The <code>div</code> function is slower for Int than Word.  For speed you should use <code>quot</code> with Int."}, {"owner": {"reputation": 593, "user_id": 513106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/015f7f81037bcf697798468085100e59?s=128&d=identicon&r=PG", "display_name": "Overmind Jiang", "link": "https://stackoverflow.com/users/513106/overmind-jiang"}, "edited": false, "score": 0, "creation_date": 1430048934, "post_id": 29875886, "comment_id": 47878590, "body": "Changing <code>quot</code> into <code>div</code> and adding <code>-fllvm</code> seem to do the trick."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1430049859, "post_id": 29875886, "comment_id": 47878836, "body": "BTW, the <code>collatzNext</code> function is wrong here and in the linked blog post. It should be <code>3 *  n + 1</code> rather than <code>(3 * n + 1) &#47; 2</code> in the odd case."}], "answers": [{"comments": [{"owner": {"reputation": 612, "user_id": 1526408, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/W2hNT.jpg?s=128&g=1", "display_name": "Minsheng Liu", "link": "https://stackoverflow.com/users/1526408/minsheng-liu"}, "edited": false, "score": 0, "creation_date": 1430064644, "post_id": 29879538, "comment_id": 47884256, "body": "Thanks! Would you mind me translating this answer into Chinese and putting it on a Chinese website? I asked my question there too. Of course, your name and link to this answer will be explicitly put. I just hope to make this answer read by more people."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 612, "user_id": 1526408, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/W2hNT.jpg?s=128&g=1", "display_name": "Minsheng Liu", "link": "https://stackoverflow.com/users/1526408/minsheng-liu"}, "edited": false, "score": 0, "creation_date": 1430065533, "post_id": 29879538, "comment_id": 47884618, "body": "I don&#39;t mind. BTW, the posts belong to SO under Creative Commons Share Alike license, AFAIK, so you don&#39;t necessarily need my permission (but thanks for asking anyway)."}, {"owner": {"reputation": 206, "user_id": 3943027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b609c6568ccf94f887297f33ebc9f62?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre R", "link": "https://stackoverflow.com/users/3943027/pierre-r"}, "edited": false, "score": 0, "creation_date": 1430335780, "post_id": 29879538, "comment_id": 48026479, "body": "Is the performance bug with GHC 7.10 (no inline of <code>even</code> with Word) a known issue that would hopefully get fixed in GHC 7.10.2 ?"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 22, "last_activity_date": 1430063190, "last_edit_date": 1495535459, "creation_date": 1430061946, "answer_id": 29879538, "question_id": 29875886, "link": "https://stackoverflow.com/questions/29875886/haskell-why-does-int-perform-worse-than-word64-and-why-is-my-program-far-slowe/29879538#29879538", "title": "Haskell: Why does Int perform worse than Word64, and why is my program far slower than C?", "body": "<p>The performance of this program depends on several factors. If we get all of them right, the performance becomes the same as that of the C program. Going through these factors:</p>\n\n<p><strong>1. Using and comparing the right word sizes</strong></p>\n\n<p>The posted C code snippet is not exactly right; it uses 32-bit integers on all architectures, while the Haskell <code>Int</code>-s are 64 bit on a 64-bit machine. Before anything else, we should make sure to use the same word size in both programs. </p>\n\n<p>Also, we should always use <em>native-sized</em> integral types in our Haskell code. So if we're on a 64-bit system, we should use 64-bit numbers, and steer clear of <code>Int32</code>-s and <code>Word32</code>-s, unless there is a specific need for them. This is because operations on non-native integers are mostly implemented as <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/GHC-Prim.html\" rel=\"noreferrer\">foreign calls rather than primops</a>, so they're significantly slower. </p>\n\n<p><strong>2. Division in <code>collatzNext</code></strong></p>\n\n<p><code>div</code> is slower than <code>quot</code> for <code>Int</code>, because <code>div</code> handles negative numbers <a href=\"https://stackoverflow.com/questions/8111120/integral-operators-quot-vs-div\">differently</a>. If we use <code>div</code> and switch to <code>Word</code>, the program gets faster, because <code>div</code> is the same as <code>quot</code> for <code>Word</code>. <code>quot</code> with <code>Int</code> works just as fine. However, this is still not as fast as C. We can divide by two by shifting bits to the right. For some reason not even LLVM does this particular strength reduction in this example, so we're best off doing it  by hand, replacing <code>quot n 2</code> by <code>shiftR n 1</code>. </p>\n\n<p><strong>3. Checking evenness</strong></p>\n\n<p>The fastest way to check this is by checking the least significant bit. LLVM can optimize <code>even</code> to this, while the native codegen cannot. So, if we're on native codegen, <code>even n</code> could be replaced with <code>n .&amp;. 1 == 0</code>, and this gives a nice performance boost.</p>\n\n<p>However, I found something of a performance bug with GHC 7.10. Here we don't get an inlined <code>even</code> for <code>Word</code>, which wrecks performance (calling a function with a heap-allocated <code>Word</code> box in the hottest part of the code does this). So here we should use <code>rem n 2 == 0</code> or <code>n .&amp;. 1 == 0</code> instead of <code>even</code>. The <code>even</code> for <code>Int</code> gets inlined fine though. </p>\n\n<p><strong>4. Fusing away lists in <code>collatzLen</code></strong></p>\n\n<p>This is a crucial factor. The linked blog post is a bit out-of-date with regards to this. GHC 7.8 can't do fusion here, but 7.10 can. This means that with GHC 7.10 and LLVM we can conveniently get C-like performance without significantly modifying the original code. </p>\n\n<pre><code>collatzNext a = (if even a then a else 3*a+1) `quot` 2\ncollatzLen a0 = length $ takeWhile (/= 1) $ iterate collatzNext a0\nmaxColLen n   = maximum $ map collatzLen [1..n]\n\nmain = do\n    [n] &lt;- getArgs\n    print $ maxColLen (read n :: Int) \n</code></pre>\n\n<p>With <code>ghc-7.10.1 -O2 -fllvm</code> and <code>n = 10000000</code>, the above program runs in <strong>2.8</strong> seconds, while the equivalent C program runs in <strong>2.4</strong> seconds. If I compile the same code without LLVM, then I instead get <strong>12.4</strong> second runtime. This slowdown is entirely because of the lack of optimization on <code>even</code>. If we use <code>a .&amp;. 1 == 0</code>, then the slowdown disappears.</p>\n\n<p><strong>5. Fusing away lists when computing the maximum length</strong></p>\n\n<p>Not even GHC 7.10 can do this, so we have to resort to manual loop-writing.</p>\n\n<pre><code>collatzNext a = (if a .&amp;. 1 == 0 then a else 3*a+1) `shiftR` 1\ncollatzLen    = length . takeWhile (/= 1) . iterate collatzNext\n\nmaxCol :: Int -&gt; Int\nmaxCol = go 1 1 where\n  go ml i n | i &gt; n = ml\n  go ml i n = go (max ml (collatzLen i)) (i + 1) n\n\nmain = do\n  [n] &lt;- getArgs\n  print $ maxCol (read n :: Int)\n</code></pre>\n\n<p>Now, for <code>ghc-7.10.1 -O2 -fllvm</code> and <code>n = 10000000</code>, the above code runs in <strong>2.1</strong> seconds, while the C program runs in <strong>2.4</strong> seconds. If we want to achieve similar performance without LLVM and GHC 7.10, we just have to manually apply the important missing optimizations:</p>\n\n<pre><code>collatzLen :: Int -&gt; Int\ncollatzLen = go 0 where\n  go l 1 = l\n  go l n | n .&amp;. 1 == 0 = go (l + 1) (shiftR n 1)\n         | otherwise    = go (l + 1) (shiftR (3 * n + 1) 1)\n\nmaxCol :: Int -&gt; Int\nmaxCol = go 1 1 where\n  go ml i n | i &gt; n = ml\n  go ml i n = go (max ml (collatzLen i)) (i + 1) n\n\nmain = do\n  [n] &lt;- getArgs\n  print $ maxCol (read n :: Int)\n</code></pre>\n\n<p>Now, with <code>ghc-7.8.4 -O2</code> and <code>n = 10000000</code>, our code runs in <strong>2.6</strong> seconds. </p>\n"}], "owner": {"reputation": 612, "user_id": 1526408, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/W2hNT.jpg?s=128&g=1", "display_name": "Minsheng Liu", "link": "https://stackoverflow.com/users/1526408/minsheng-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1149, "favorite_count": 5, "accepted_answer_id": 29879538, "answer_count": 1, "score": 17, "last_activity_date": 1582189373, "creation_date": 1430040357, "last_edit_date": 1582189373, "question_id": 29875886, "link": "https://stackoverflow.com/questions/29875886/haskell-why-does-int-perform-worse-than-word64-and-why-is-my-program-far-slowe", "title": "Haskell: Why does Int perform worse than Word64, and why is my program far slower than C?", "body": "<p>I was reading an article of <a href=\"http://www.mit.edu/~mtikekar/posts/stream-fusion.html\" rel=\"nofollow noreferrer\">how slow Haskell is in playing with Collatz conjecture</a>, which basically states if you keep multiplying by three and adding one to an odd number, or dividing an even one with two, you will eventually get one. For instance, 3 -> 10 -> 5 -> 16 -> 8 -> 4 -> 2 -> 1.</p>\n\n<p>The program given in this article is to calculate the longest Collatz sequence in a given range. The C version is:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(int argc, char **argv) {\n   int max_a0 = atoi(argv[1]);\n   int longest = 0, max_len = 0;\n   int a0, len;\n   unsigned long a;\n\n   for (a0 = 1; a0 &lt;= max_a0; a0++) {\n      a = a0;\n      len = 0;\n\n      while (a != 1) {\n         len++;\n         a = ((a%2==0)? a : 3*a+1)/2;\n      }\n\n      if (len &gt; max_len) {\n         max_len = len;\n         longest = a0;\n      }\n   }\n   printf(\"(%d, %d)\\n\", max_len, longest);\n   return 0;\n}\n</code></pre>\n\n<p>Compiling with Clang O2, it runs on my computer for 0.2s.</p>\n\n<p>The Haskell version given in that article generates the whole sequence as a list explicitly, and then calculate the length of the intermediate list. It is 10x slower than the C version. However, since the author used LLVM as a backend, which I haven't installed, I couldn't reproduce this. Using GHC 7.8 and the default backend, it runs 10s on my Mac, which is 50x slower than the C version.</p>\n\n<p>Then, I wrote a version using tail recursion and not generating an intermediate list:</p>\n\n<pre><code>collatzNext :: Int -&gt; Int\ncollatzNext a\n  | even a    = a `div` 2\n  | otherwise = (3 * a + 1) `div` 2\n\ncollatzLen :: Int -&gt; Int\ncollatzLen n = collatzIter n 0\n  where\n    collatzIter 1 len = len\n    collatzIter n len = collatzIter (collatzNext n) (len + 1)\n\nmain = do\n  print $ maximum $ [collatzLen x | x &lt;- [1..1000000]]\n</code></pre>\n\n<p>Compiled with GHC 7.8 and O2, it runs for 2s, 10x slower than the C version.</p>\n\n<p>Interestingly, when I changed <code>Int</code> in the type annotation to <code>Word</code>, it only spent 1s, 2x faster!</p>\n\n<p>I have tried BangPatterns for explicit strict evaluation, but no significant performance gain could be noticed \u2014 I guess GHC's strict analysis is smart enough to handle such a simple scenario.</p>\n\n<p>My questions are:</p>\n\n<ol>\n<li>Why is the <code>Word</code> version so much faster compared with the <code>Int</code> one?</li>\n<li>Why is this Haskell program so slow compared with that written in C?</li>\n</ol>\n"}, {"tags": ["haskell", "pandoc"], "answers": [{"tags": [], "owner": {"reputation": 1382, "user_id": 881615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/943dbfa87d0013cbd6018bea321ed6da?s=128&d=identicon&r=PG", "display_name": "Will Angley", "link": "https://stackoverflow.com/users/881615/will-angley"}, "is_accepted": false, "score": 2, "last_activity_date": 1431141848, "creation_date": 1431141848, "answer_id": 30135610, "question_id": 29875831, "link": "https://stackoverflow.com/questions/29875831/missing-attributes-for-links-and-other-types-of-elements-in-pandoc/30135610#30135610", "title": "Missing attributes for links and other types of elements in pandoc", "body": "<p>Image and link attributes are documented as a feature 'not in Pandoc' on the <a href=\"https://github.com/jgm/pandoc/wiki/Pandoc-vs-Multimarkdown#image-and-link-attributes\" rel=\"nofollow\">Pandoc vs Multimarkdown Wiki</a> page. </p>\n\n<p>There are open issues around this, like <a href=\"https://github.com/jgm/pandoc/issues/684\" rel=\"nofollow\">Permit adding attributes to all Markdown elements #684</a>. I didn't see attached code/pull requests to implement them when I looked.</p>\n\n<p>If you want to add a <code>target=\"_blank\"</code> attribute to auto-generated links, I think you'll need to use a workaround in the meantime. (And note that you might not need to use raw string processing if you post-process the HTML with a non-Pandoc HTML parser.)</p>\n"}, {"tags": [], "owner": {"reputation": 749, "user_id": 1253735, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/s6FxZ.jpg?s=128&g=1", "display_name": "Bruno", "link": "https://stackoverflow.com/users/1253735/bruno"}, "is_accepted": false, "score": 0, "last_activity_date": 1475040662, "last_edit_date": 1475040662, "creation_date": 1475039076, "answer_id": 39738451, "question_id": 29875831, "link": "https://stackoverflow.com/questions/29875831/missing-attributes-for-links-and-other-types-of-elements-in-pandoc/39738451#39738451", "title": "Missing attributes for links and other types of elements in pandoc", "body": "<p>You should be able to do this with a <a href=\"http://github.com/jgm/pandocfilters\" rel=\"nofollow\">pandoc filter</a>. </p>\n\n<p>The <a href=\"http://github.com/aaren/pandoc-attributes\" rel=\"nofollow\">pandoc-attributes</a> filter can read and write attributes in both <code>markdown</code> and <code>html</code></p>\n"}], "owner": {"reputation": 5058, "user_id": 1653187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3942782a314cdc7d6a7364cd32bfd3b3?s=128&d=identicon&r=PG", "display_name": "nickie", "link": "https://stackoverflow.com/users/1653187/nickie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 565, "favorite_count": 0, "answer_count": 2, "score": 11, "last_activity_date": 1475040662, "creation_date": 1430040048, "question_id": 29875831, "link": "https://stackoverflow.com/questions/29875831/missing-attributes-for-links-and-other-types-of-elements-in-pandoc", "title": "Missing attributes for links and other types of elements in pandoc", "body": "<p>I am trying to use <a href=\"https://hackage.haskell.org/package/pandoc\" rel=\"noreferrer\"><code>pandoc</code></a> (with <a href=\"http://jaspervdj.be/hakyll/\" rel=\"noreferrer\"><code>hakyll</code></a>, but this is probably not important) to achieve the following:</p>\n\n<ol>\n<li>Read a markdown file.</li>\n<li>Convert it to HTML.</li>\n<li>Add a <code>target=\"_blank\"</code> attribute to every link that is automatically produced.</li>\n</ol>\n\n<p>The problem is that the <a href=\"http://hackage.haskell.org/package/pandoc-types/docs/Text-Pandoc-Definition.html#t:Inline\" rel=\"noreferrer\">definition of <code>Inline</code></a> in <code>pandoc</code> seems to support attributes only for some types of <code>Inline</code>s, e.g., for <code>Span</code> and <code>Code</code>, and not for others, e.g., for <code>Link</code> and <code>Image</code>. </p>\n\n<p>Is this an arbitrary limitation of <code>pandoc</code>, or was it made on purpose for some reason that I do not understand?  Furthermore, is there a way to achieve what I want, without resorting to low-level string processing or to using the <code>RawInline</code> constructor?</p>\n\n<hr>\n\n<p>Here is a MWE:</p>\n\n<pre><code>import Text.Pandoc\nimport Text.Pandoc.Walk\n\nfixLinks :: Pandoc -&gt; Pandoc\nfixLinks = walk fixLink\n  where fixLink (Link inlines (url, title)) =\n          Link inlines (url, \"I want to add a target=_blank to this link!\")\n        fixLink inline = inline\n\nmain = do\n  let md = \"This is a link to [StackOverflow](http://stackoverflow.com/).\"\n  (putStrLn . writeHtmlString def . fixLinks . readMarkdown def) md\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1430039479, "post_id": 29875684, "comment_id": 47875858, "body": "W h a t   H a v e   Y o u   T r i e d ?"}, {"owner": {"reputation": 75, "user_id": 4333950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cff0f9fa0dbe8138e17ba4129d906d4?s=128&d=identicon&r=PG&f=1", "display_name": "Jan kowalski", "link": "https://stackoverflow.com/users/4333950/jan-kowalski"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1430039787, "post_id": 29875684, "comment_id": 47875943, "body": "i know that (.) :: (b-&gt;c)-&gt;(a-&gt;b) -&gt; (a-&gt;c)."}, {"owner": {"reputation": 75, "user_id": 4333950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cff0f9fa0dbe8138e17ba4129d906d4?s=128&d=identicon&r=PG&f=1", "display_name": "Jan kowalski", "link": "https://stackoverflow.com/users/4333950/jan-kowalski"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1430039836, "post_id": 29875684, "comment_id": 47875956, "body": "I think that (.)(.) should be (d-&gt;c)-&gt;(b-&gt;c)-&gt;(a-&gt;b)-&gt;(a-&gt;d) but it is wrong"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1430040217, "post_id": 29875684, "comment_id": 47876048, "body": "Alright, but how did you come by that conjecture?"}], "answers": [{"comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1430039504, "post_id": 29875750, "comment_id": 47875868, "body": "I think the OP wants to know how to figure this out using pen &amp; paper."}, {"owner": {"reputation": 75, "user_id": 4333950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cff0f9fa0dbe8138e17ba4129d906d4?s=128&d=identicon&r=PG&f=1", "display_name": "Jan kowalski", "link": "https://stackoverflow.com/users/4333950/jan-kowalski"}, "edited": false, "score": 0, "creation_date": 1430039644, "post_id": 29875750, "comment_id": 47875902, "body": "Yes, i want solution without computer (as i wrote above)."}, {"owner": {"reputation": 75, "user_id": 4333950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cff0f9fa0dbe8138e17ba4129d906d4?s=128&d=identicon&r=PG&f=1", "display_name": "Jan kowalski", "link": "https://stackoverflow.com/users/4333950/jan-kowalski"}, "edited": false, "score": 0, "creation_date": 1430039964, "post_id": 29875750, "comment_id": 47875985, "body": "Why you need to substitute c with (a&#39; -&gt; b&#39;) -&gt; a&#39; -&gt; c&#39;) ?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1430040035, "post_id": 29875750, "comment_id": 47876004, "body": "becase this is the second argument of the function I put into <code>(.)</code> (the second <code>(.)</code>)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430040124, "post_id": 29875750, "comment_id": 47876025, "body": "see: you can look at <code>(.)</code> of beeing a function, that waits for a function <code>b -&gt; c</code> and then returns a function <code>((a -&gt; b) -&gt; a -&gt; c)</code> now this <i>function</i>  is <code>(.)</code> again and I don&#39;t want to mess up the types and so added ticks (<code>&#39;</code>) to differentiate"}, {"owner": {"reputation": 75, "user_id": 4333950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cff0f9fa0dbe8138e17ba4129d906d4?s=128&d=identicon&r=PG&f=1", "display_name": "Jan kowalski", "link": "https://stackoverflow.com/users/4333950/jan-kowalski"}, "edited": false, "score": 0, "creation_date": 1430040135, "post_id": 29875750, "comment_id": 47876029, "body": "isn&#39;t it wrong? For fun b-&gt;c you use type (b&#39; -&gt;c&#39;)-&gt;( (a&#39;-&gt;b&#39;)-&gt;(a&#39;-&gt;c&#39;)). Why it is correct? I don&#39;t understand it :/"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430040284, "post_id": 29875750, "comment_id": 47876070, "body": "because I apply <code>(.) :: (b -&gt; c) -&gt; ((a-&gt;b) -&gt; a -&gt; c))</code>  to <code>(.) :: (b&#39; -&gt; c&#39;) -&gt; ((a&#39;-&gt;b&#39;) -&gt; a&#39; -&gt; c&#39;)</code> - so this <b>is</b> the <code>b -&gt; c</code> and now I have to substitute the parts for <code>b</code> and <code>c</code> in <code>((a -&gt; b) -&gt; a -&gt; c)</code> accordingly"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1430040316, "post_id": 29875750, "comment_id": 47876079, "body": "it&#39;s really just <i>find/replace</i> with type-variables - you can do it in your editor if you like ;)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 5, "last_activity_date": 1430040472, "last_edit_date": 1430040472, "creation_date": 1430039471, "answer_id": 29875750, "question_id": 29875684, "link": "https://stackoverflow.com/questions/29875684/calculating-type-haskell/29875750#29875750", "title": "Calculating type Haskell", "body": "<h2>by (manual) pattern-<em>matching</em> and rewriting <em>types-variables</em></h2>\n\n<p><code>(.)</code> has type <code>(b -&gt; c) -&gt; ((a -&gt; b) -&gt; a -&gt; c</code>) so the first argument should have type <code>b -&gt; c</code>.\nNow if we use it again we have to substitute <code>b</code> with <code>b' -&gt; c'</code> and <code>c</code> with <code>(a' -&gt; b') -&gt; a' -&gt; c')</code> (the second <code>(.)</code> should have type <code>(b' -&gt; c') -&gt; ((a' -&gt; b') -&gt; a' -&gt; c')</code>) and we get</p>\n\n<pre><code>(a -&gt; b' -&gt; c') -&gt; a -&gt; (a' -&gt; b') -&gt; a' -&gt; c'\n</code></pre>\n\n<p>which is (after renaming) the same as above.</p>\n\n<p>Note that I used <code>a -&gt; b -&gt; c = a -&gt; (b -&gt; c)</code> here</p>\n\n<h2>using <em>GHCi</em></h2>\n\n<p>yeah I know - you want it by hand - but <em>GHCi</em> is such a valuable tool that you really should use it to confirm your manual labor.</p>\n\n<p>Here from a terminal:</p>\n\n<pre><code>$ ghci\nGHCi, version 7.10.1: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :t (.)(.)\n(.)(.) :: (a -&gt; b -&gt; c) -&gt; a -&gt; (a1 -&gt; b) -&gt; a1 -&gt; c\nPrelude&gt; \n</code></pre>\n\n<p>as you can see the type is <code>(a -&gt; b -&gt; c) -&gt; a -&gt; (a1 -&gt; b) -&gt; a1 -&gt; c</code></p>\n\n<p>btw: <code>:t</code> is short for <code>:type</code> and you can see all commands with <code>:help</code> from inside a GHCi session.</p>\n"}, {"tags": [], "owner": {"reputation": 2133, "user_id": 2494576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69dcf21a7cf379c1f25476d80a73338f?s=128&d=identicon&r=PG", "display_name": "felix-eku", "link": "https://stackoverflow.com/users/2494576/felix-eku"}, "is_accepted": true, "score": 8, "last_activity_date": 1430040510, "creation_date": 1430040510, "answer_id": 29875905, "question_id": 29875684, "link": "https://stackoverflow.com/questions/29875684/calculating-type-haskell/29875905#29875905", "title": "Calculating type Haskell", "body": "<pre><code>(.)    :: (b        -&gt; c                     ) -&gt; ((a -&gt; b)        -&gt; (a -&gt; c))\n   (.) :: ((e -&gt; f) -&gt; ((d -&gt; e) -&gt; (d -&gt; f)))\n(.)(.) ::                                         ((a -&gt; (e -&gt; f)) -&gt; (a -&gt; ((d -&gt; e) -&gt; (d -&gt; f))))\n(.)(.) :: (a -&gt; (e -&gt; f)) -&gt; (a -&gt; ((d -&gt; e) -&gt; (d -&gt; f)))\n(.)(.) :: (a -&gt; e -&gt; f) -&gt; a -&gt; ((d -&gt; e) -&gt; (d -&gt; f))\n(.)(.) :: (a -&gt; e -&gt; f) -&gt; a -&gt; (d -&gt; e) -&gt; (d -&gt; f)\n(.)(.) :: (a -&gt; e -&gt; f) -&gt; a -&gt; (d -&gt; e) -&gt; d -&gt; f\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "is_accepted": false, "score": 0, "last_activity_date": 1430046821, "creation_date": 1430046821, "answer_id": 29876897, "question_id": 29875684, "link": "https://stackoverflow.com/questions/29875684/calculating-type-haskell/29876897#29876897", "title": "Calculating type Haskell", "body": "<p>Since I wasn't particularly satisfied with the missing explanations in the accepted answer, I give my POV as well:</p>\n\n<pre><code>-- this is the original type signature\n(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n\n-- now because of haskell polymorphism,\n-- even 'b' and 'c' and so on could be functions\n--\n-- (.)(.) means we shove the second function composition\n-- into the first as an argument.\n-- Let's give the second function a distinct type signature, so we\n-- don't mix up the types:\n(.) :: (e -&gt; f) -&gt; (d -&gt; e) -&gt; d -&gt; f\n\n-- Since the first argument of the initial (.) is of type (b -&gt; c)\n-- we could say the following if we apply the second (.) to it:\n(b -&gt; c) == (e -&gt; f) -&gt; (d -&gt; e) -&gt; d -&gt; f\n\n-- further, because of how currying works, as in\n(e -&gt; f) -&gt; (d -&gt; e) -&gt; d -&gt; f == (e -&gt; f) -&gt; ((d -&gt; e) -&gt; d -&gt; f)\n-- we can conclude\nb == (e -&gt; f)\nc == (d -&gt; e) -&gt; d -&gt; f\n\n-- since we passed one argument in, the function arity changes,\n-- so we'd actually only have (a -&gt; b) -&gt; a -&gt; c left, but that\n-- doesn't represent the types we have now, so we have to substitute\n-- for b and c, so\n(a -&gt; b) -&gt; a -&gt; c\n-- becomes\n(.)(.) :: (a -&gt; (e -&gt; f)) -&gt; a -&gt; (d -&gt; e) -&gt; d -&gt; f\n-- and again because of currying we can also write\n(.)(.) :: (a -&gt; e -&gt; f) -&gt; a -&gt; (d -&gt; e) -&gt; d -&gt; f\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 4333950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cff0f9fa0dbe8138e17ba4129d906d4?s=128&d=identicon&r=PG&f=1", "display_name": "Jan kowalski", "link": "https://stackoverflow.com/users/4333950/jan-kowalski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 29875905, "answer_count": 3, "score": 4, "last_activity_date": 1430046821, "creation_date": 1430039023, "question_id": 29875684, "link": "https://stackoverflow.com/questions/29875684/calculating-type-haskell", "title": "Calculating type Haskell", "body": "<p>How to calculate type of (.)(.) in Haskell? \nI know that it should be</p>\n\n<pre><code>(.)(.) :: (a -&gt; b -&gt; c) -&gt; a -&gt; (a1 -&gt; b) -&gt; a1 -&gt; c\n</code></pre>\n\n<p>But how to calculate it without computer?</p>\n"}, {"tags": ["haskell", "shake-build-system"], "answers": [{"comments": [{"owner": {"reputation": 3078, "user_id": 841477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/123951c133ee402a988c1993c68bfb81?s=128&d=identicon&r=PG", "display_name": "Christophe Biocca", "link": "https://stackoverflow.com/users/841477/christophe-biocca"}, "edited": false, "score": 0, "creation_date": 1430051595, "post_id": 29877171, "comment_id": 47879429, "body": "Silly me, I tried approach 1 first, and felt it was too clunky, so I went and generalized with a different technique, not realizing I could generalize this one.  I will try that."}], "tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": true, "score": 3, "last_activity_date": 1430048632, "creation_date": 1430048632, "answer_id": 29877171, "question_id": 29873635, "link": "https://stackoverflow.com/questions/29873635/dynamically-generating-rules-from-the-content-of-an-action-a/29877171#29877171", "title": "Dynamically generating Rules from the content of an (Action a)", "body": "<p>First off, using <code>priority</code> would not work, as that picks a rule statically then runs it - it doesn't backtrack. It's also important that Shake doesn't run any <code>Action</code> operations to produce <code>Rules</code> (as per the two functions you propose) since the <code>Action</code> might call <code>need</code> on a <code>Rule</code> that it itself defines, or is defined by another action rule, thus making the ordering of those <code>Action</code> calls visible. You could add <code>IO (Rules ()) -&gt; Rules ()</code>, which might be enough for what you are thinking of (directory listing), but it isn't currently exposed (I have an internal function that does exactly that).</p>\n\n<p>To give a few example approaches it's useful to define plausible commands to convert <code>.js</code>/<code>.coffee</code> files:</p>\n\n<pre><code>cmdCoffee :: FilePath -&gt; FilePath -&gt; Action ()\ncmdCoffee src out = do\n    need [src]\n    cmd \"coffee-script-convertor\" [src] [out]\n\ncmdJavascript :: FilePath -&gt; FilePath -&gt; Action ()\ncmdJavascript = copyFile'\n</code></pre>\n\n<p><strong>Approach 1: Use <code>doesFileExist</code></strong></p>\n\n<p>This would be my standard approach, writing something like:</p>\n\n<pre><code>\"build/*.js\" %&gt; \\out -&gt; do\n    let srcJs = \"static\" &lt;/&gt; dropDirectory1 out\n    let srcCf = srcJs -&lt;.&gt; \"coffee\"\n    b &lt;- doesFileExist srcCf\n    if b then cmdCoffee srcCf out else cmdJavascript srcJs out\n</code></pre>\n\n<p>This accurately captures the dependency that if the user adds a <code>.coffee</code> file in the directory then the rule should be rerun. You could imagine sugaring up the <code>doesFileExist</code> if this is a common pattern for you. You could even drive it from you list of <code>StaticFileMapping</code> structures (do a <code>group</code> on the <code>oExt</code> field to add one rule per <code>oExt</code> than calls <code>doesFileExists</code> on each <code>iExt</code> in turn). An advantage of this approach is that if you do <code>shake build/out.js</code> it doesn't need to do a directory listing, although likely that cost is negligible.</p>\n\n<p><strong>Approach 2: List the files <em>before</em> calling <code>shake</code></strong></p>\n\n<p>Instead of writing <code>main = shakeArgs ...</code> do:</p>\n\n<pre><code>import System.Directory.Extra(listFilesRecursive) -- from the \"extra\" package\n\nmain = do\n    files &lt;- listFilesRecursive \"static\"\n    shakeArgs shakeOptions $ do\n        forM_ files $ \\src -&gt; case takeExtension src of\n            \".js\" -&gt; do\n                 let out = \"build\" &lt;/&gt; takeDirectory1 src\n                 want [out]\n                 out %&gt; \\_ -&gt; cmdJavascript src out\n            -- rules for all other types you care about\n            _ -&gt; return ()\n</code></pre>\n\n<p>Here you operate in IO to get the list of files, then can add rules by referring to that previously captured value. Adding <code>rulesIO :: IO (Rules ()) -&gt; Rules ()</code> would allow you to list the files inside <code>shakeArgs</code>.</p>\n\n<p><strong>Approach 3: List the files <em>inside</em> the rules</strong></p>\n\n<p>You can define a mapping between file names and outputs, driven from the directory listing:</p>\n\n<pre><code>buildJs :: Action (Map FilePath (Action ()))\nbuildJs = do\n    js &lt;- getDirectoryFiles \"static\" [\"*.js\"]\n    cf &lt;- getDirectoryFiles \"static\" [\"*.coffee\"]\n    return $ Map.fromList $\n        [(\"build\" &lt;/&gt; j, cmdJavascript (\"static\" &lt;/&gt; j) (\"build\" &lt;/&gt; j)) | j &lt;- js] ++\n        [(\"build\" &lt;/&gt; c, cmdCoffee (\"static\" &lt;/&gt; c) (\"\")) | c &lt;- cf]\n</code></pre>\n\n<p>Then lift that into a set of rules:</p>\n\n<pre><code>action $ do\n    mpJs &lt;- buildJs\n    need $ Map.keys mpJs\n\"//*.js\" %&gt; \\out -&gt; do\n    mpJs &lt;- buildJs\n    mpJs Map.! out\n</code></pre>\n\n<p>However, that recomputes the directory listing for every file we build, so we should cache it and make sure it's only computed once:</p>\n\n<pre><code>mpJs &lt;- newCache $ \\() -&gt; buildJs\naction $ do\n    mpJs &lt;- mpJs ()\n    need $ Map.keys mpJs\n\"//*.js\" %&gt; \\out -&gt; do\n    mpJs &lt;- mpJs ()\n    mpJs Map.! out\n</code></pre>\n\n<p>This solution is probably closest to your original approach, but I find it the most complex.</p>\n"}], "owner": {"reputation": 3078, "user_id": 841477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/123951c133ee402a988c1993c68bfb81?s=128&d=identicon&r=PG", "display_name": "Christophe Biocca", "link": "https://stackoverflow.com/users/841477/christophe-biocca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 1, "accepted_answer_id": 29877171, "answer_count": 1, "score": 2, "last_activity_date": 1430048632, "creation_date": 1430021550, "question_id": 29873635, "link": "https://stackoverflow.com/questions/29873635/dynamically-generating-rules-from-the-content-of-an-action-a", "title": "Dynamically generating Rules from the content of an (Action a)", "body": "<p>I'm currently testing porting our build system from make to shake and have hit a roadblock:</p>\n\n<p>Given the following project structure:</p>\n\n<pre><code>static/a.js\nstatic/b.coffee\n\nbuild/a.js\nbuild/b.js\n</code></pre>\n\n<p>That is, various input extensions map to identical output extensions, so a straightforward <code>\"build//*.js\" %&gt;</code> rule isn't going to work.</p>\n\n<p>I wanted to avoid using priority if possible, and writing an ad-hoc build rule that checks for the existence of either possible input felt clunky (especially since this situation occurs with other filetypes as well), so I wrote the following:</p>\n\n<pre><code>data StaticFileMapping a = StaticFileMapping String String (FilePath -&gt; FilePath -&gt; Action a)\n\nstaticInputs :: FilePath -&gt; StaticFileMapping a -&gt; Action [FilePath]\nstaticInputs dir (StaticFileMapping iExt _ _) = (findFiles (dir &lt;/&gt; \"static\") [iExt])\n\nstaticInputToOutput :: StaticFileMapping a -&gt; FilePath -&gt; FilePath\nstaticInputToOutput (StaticFileMapping _ oExt _) = (remapDir [\"build\"]) . (-&lt;.&gt; oExt)\n\nstaticTargets :: FilePath -&gt; StaticFileMapping a -&gt; Action [FilePath]\nstaticTargets dir sfm = (map $ staticInputToOutput sfm) &lt;$&gt; staticInputs dir sfm\n\nrules :: FilePath -&gt; StaticFileMapping a -&gt; Rules ()\nrules dir sfm@(StaticFileMapping _ _ process) = join $ mconcat . (map buildInputRule) &lt;$&gt; staticInputs dir sfm\n    where buildInputRule :: FilePath -&gt; Rules ()\n          buildInputRule input = (staticInputToOutput sfm input) %&gt; (process input)\n</code></pre>\n\n<p>That way I can define a mapping for each input type (<code>.coffee -&gt; .js</code>, <code>.svg -&gt; .png</code>) and so on, with only a tiny amount of code implementing the transformation for each. And it almost works.</p>\n\n<p>But it seems impossible to go from <code>(Action a)</code> to <code>Rules _</code> without throwing the value inside the <code>Action</code> away first, as far as I can tell.</p>\n\n<p>Is there a function with type <code>(Action a) -&gt; (a -&gt; Rules ()) -&gt; Rules ()</code> or <code>(Action a) -&gt; (Rules a)</code>? Can I implement either one myself, or do I need to modify the library's code?</p>\n\n<p>Or is this entire approach hare-brained and I should take some other route?</p>\n"}, {"tags": ["haskell", "compiler-construction", "grammar", "cup"], "comments": [{"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1430020675, "post_id": 29873519, "comment_id": 47872025, "body": "You might find <a href=\"http://www.reddit.com/r/haskell/comments/2ig8ml/where_can_i_find_the_complete_bnf_syntax_of/\" rel=\"nofollow noreferrer\">this thread</a> highly relevant"}, {"owner": {"reputation": 779, "user_id": 3570575, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/30a2edfaac6b765c148187caf22de160?s=128&d=identicon&r=PG&f=1", "display_name": "Halawa", "link": "https://stackoverflow.com/users/3570575/halawa"}, "reply_to_user": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1430022760, "post_id": 29873519, "comment_id": 47872409, "body": "unfortunately , no one give the BNF grammar which is in the form mentioned above . but thank you anyways ."}, {"owner": {"reputation": 779, "user_id": 3570575, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/30a2edfaac6b765c148187caf22de160?s=128&d=identicon&r=PG&f=1", "display_name": "Halawa", "link": "https://stackoverflow.com/users/3570575/halawa"}, "reply_to_user": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1430026610, "post_id": 29873519, "comment_id": 47873141, "body": "@GabrielGonzalez now my cup is semi finished but when i compile i got this error   <code>.&#47;Lexer.java:4: error: Lexer is not abstract and does not override abstract method next_token() in Scanner</code>  which leads to many errors of the same type   <code>.&#47;Lexer.java:377: error: incompatible types \treturn new Symbol(sym.EOF, null); \t       ^   required: String   found:    Symbol</code> , any help ?"}], "owner": {"reputation": 779, "user_id": 3570575, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/30a2edfaac6b765c148187caf22de160?s=128&d=identicon&r=PG&f=1", "display_name": "Halawa", "link": "https://stackoverflow.com/users/3570575/halawa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1430020395, "creation_date": 1430020395, "question_id": 29873519, "link": "https://stackoverflow.com/questions/29873519/haskell-grammar-for-cup-file", "title": "haskell grammar for cup file", "body": "<p>i am working on a haskell compiler written in java using JLex and cup .i finished my lexer file and now i am working on my parser.cup file where i should define my terminals , non-terminals and the grammar. i have already finished the terminal and non-terminal part but now i am stuck in the grammar part so can anyone help or redirect me to any link where i can find a grammar for haskell in this form :</p>\n\n<pre><code>Variable ::= Nonterminal:name Terminal:name \n{:RESULT = /* code to execute when the rule is \nmatched and the result to be printed out */ ;:} \n| blablabla ;\n</code></pre>\n\n<p>any help would be appreciated . </p>\n"}, {"tags": ["haskell", "types", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1430014380, "post_id": 29872739, "comment_id": 47870905, "body": "You need to have <code>instance Error PwdError where ...</code> somewhere in your code.  Look at the <code>Error</code> class&#39; documentation to figure out what functions you need to implement."}], "answers": [{"tags": [], "owner": {"reputation": 3113, "user_id": 1193741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be1d97fc244eaa2bfd3d7d64c1717f9f?s=128&d=identicon&r=PG", "display_name": "jtobin", "link": "https://stackoverflow.com/users/1193741/jtobin"}, "is_accepted": true, "score": 1, "last_activity_date": 1430014551, "creation_date": 1430014551, "answer_id": 29872924, "question_id": 29872739, "link": "https://stackoverflow.com/questions/29872739/no-instance-for-myclass-arising-from-a-use-of-throwerror/29872924#29872924", "title": "No instance for MyClass arising from a use of `throwError&#39;", "body": "<p>You need to make <code>PwdError</code> an instance of <a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Error.html#t:Error\" rel=\"nofollow\">the <code>Error</code> typeclass</a>.</p>\n\n<p>The following should be sufficient, though I haven't tried to compile it:</p>\n\n<pre><code>instance Error PwdError where\n  strMsg = PwdError\n</code></pre>\n"}], "owner": {"reputation": 634, "user_id": 4697270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7884aed17ee40cfaae6b53e6966b29ea?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4697270/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 29872924, "answer_count": 1, "score": 0, "last_activity_date": 1430039938, "creation_date": 1430012425, "last_edit_date": 1430039938, "question_id": 29872739, "link": "https://stackoverflow.com/questions/29872739/no-instance-for-myclass-arising-from-a-use-of-throwerror", "title": "No instance for MyClass arising from a use of `throwError&#39;", "body": "<p>I have a problem with typing. I started to study Monad transformers with <a href=\"http://en.wikibooks.org/wiki/Haskell/Monad_transformers\" rel=\"nofollow\">this article</a>. Then I little changed them example. Now, my code is:</p>\n\n<pre><code>data PwdError = PwdError String\n\ntype PwdErrorMonad = ErrorT PwdError IO\n\nisValid :: String -&gt; ErrorT String PwdErrorMonad Bool\nisValid s\n    | length s &lt; 5 = throwError \"password is short!\"\n    | otherwise = return True\n</code></pre>\n\n<p>Now, I have the error: </p>\n\n<pre><code>No instance for (Error PwdError) arising from a use of `throwError'\nIn the expression: throwError \"password is short!\"\nIn an equation for `isValid':\n    isValid s\n      | length s &lt; 5 = throwError \"password is too short!\"\n      | otherwise = return True\n</code></pre>\n\n<p>Could you help me to compile this program?</p>\n"}, {"tags": ["postgresql", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 3113, "user_id": 1193741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be1d97fc244eaa2bfd3d7d64c1717f9f?s=128&d=identicon&r=PG", "display_name": "jtobin", "link": "https://stackoverflow.com/users/1193741/jtobin"}, "is_accepted": true, "score": 3, "last_activity_date": 1430015219, "creation_date": 1430015219, "answer_id": 29872991, "question_id": 29872728, "link": "https://stackoverflow.com/questions/29872728/haskell-postgres-connect-parameter-is-not-a-query/29872991#29872991", "title": "haskell-postgres --&gt; connect parameter is not a Query", "body": "<p>From <a href=\"https://hackage.haskell.org/package/postgresql-simple-0.4.10.0/docs/Database-PostgreSQL-Simple.html\" rel=\"nofollow\">the docs</a>:</p>\n\n<blockquote>\n  <p>To most easily construct a query, enable GHC's OverloadedStrings language extension and write your query as a normal literal string.</p>\n</blockquote>\n\n<p><code>OverloadedStrings</code> will let you write what appears to be a <code>String</code> and have GHC auto-coerce it to the appropriate type (<code>ByteString</code>, <code>Text</code>, <code>Query</code>).  It's a useful extension to keep in your toolbox.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "accepted_answer_id": 29872991, "answer_count": 1, "score": 1, "last_activity_date": 1430015219, "creation_date": 1430012301, "question_id": 29872728, "link": "https://stackoverflow.com/questions/29872728/haskell-postgres-connect-parameter-is-not-a-query", "title": "haskell-postgres --&gt; connect parameter is not a Query", "body": "<p>My program:</p>\n\n<pre><code>import Database.PostgreSQL.Simple\n\nmain :: IO ()\nmain = do\n  conn &lt;- connect defaultConnectInfo\n    { connectUser = \"postgres\"\n      , connectPassword = \"password\"\n      , connectDatabase = \"postgres\"\n    }\n  execute conn \"create table users (id INT, fname VARCHAR(80), lname VARCHAR(80))\" ()\n  close conn\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>Couldn't match expected type \u2018Query\u2019 with actual type \u2018[Char]\u2019\n    In the second argument of \u2018execute\u2019, namely\n      \u2018\"create table users (id INT, fname VARCHAR(80), lname VARCHAR(80))\"\u2019\n</code></pre>\n\n<p>Does the user need to make the above psql string into a Query typed object and send it as a parameter to <code>connect</code> function? The tutorial is not written this way but the error is meaning otherwise.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 4, "creation_date": 1430012253, "post_id": 29872648, "comment_id": 47870491, "body": "What&#39;s wrong with <code>let xs = if null parsed_list then [1, 2, 3] else parsed_list</code>?"}, {"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 0, "creation_date": 1430036228, "post_id": 29872648, "comment_id": 47875119, "body": "If you want a similar presentation, just create a function : <code>nullOr [] d = d; nullOr xs _ = xs</code>. You can even use it infix."}], "answers": [{"tags": [], "owner": {"reputation": 3113, "user_id": 1193741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be1d97fc244eaa2bfd3d7d64c1717f9f?s=128&d=identicon&r=PG", "display_name": "jtobin", "link": "https://stackoverflow.com/users/1193741/jtobin"}, "is_accepted": false, "score": 1, "last_activity_date": 1430014963, "creation_date": 1430014963, "answer_id": 29872971, "question_id": 29872648, "link": "https://stackoverflow.com/questions/29872648/supply-a-list-of-default-values-if-list-is-empty-in-haskell/29872971#29872971", "title": "Supply a list of default values if list is empty in Haskell?", "body": "<p>Just check and see if the parsed argument list is empty and supply the defaults if so.  Ex:</p>\n\n<pre><code>import System.Environment\n\ndefaults = undefined\n\nfoo = do\n  args &lt;- getArgs\n  return $ case args of\n    [] -&gt; defaults\n    xs -&gt; xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1430036345, "creation_date": 1430036345, "answer_id": 29875310, "question_id": 29872648, "link": "https://stackoverflow.com/questions/29872648/supply-a-list-of-default-values-if-list-is-empty-in-haskell/29875310#29875310", "title": "Supply a list of default values if list is empty in Haskell?", "body": "<p>Using guards:</p>\n\n<pre><code>xs | null parsed_list = [1,2,3]\n   | otherwise        = parser_list\n</code></pre>\n\n<p>Using <code>if</code>: (as @Mephy suggested)</p>\n\n<pre><code>xs = if null parsed_list then [1,2,3] else parsed_list\n</code></pre>\n\n<p>Using pattern matching: (see @jtobin's answer)</p>\n\n<p>Using <code>foldr</code> (not recommended):</p>\n\n<pre><code>xs = foldr (\\_ _ -&gt; parsed_list) [1,2,3] parsed_list\n</code></pre>\n\n<p>Using a custom operator:</p>\n\n<pre><code>ifEmpty :: [a] -&gt; [a] -&gt; [a]\nifEmpty [] def = def\nifEmpty ys _   = ys\n\nxs = parsed_list `ifEmpty` [1,2,3]\n</code></pre>\n"}], "owner": {"reputation": 1196, "user_id": 1397625, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2dacce7b139f255257907e939f6795ba?s=128&d=identicon&r=PG", "display_name": "RodericDay", "link": "https://stackoverflow.com/users/1397625/rodericday"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 558, "favorite_count": 0, "accepted_answer_id": 29875310, "answer_count": 2, "score": 0, "last_activity_date": 1430036345, "creation_date": 1430011489, "question_id": 29872648, "link": "https://stackoverflow.com/questions/29872648/supply-a-list-of-default-values-if-list-is-empty-in-haskell", "title": "Supply a list of default values if list is empty in Haskell?", "body": "<p>I'm parsing command line arguments to determine which value I want my program to return</p>\n\n<p>But if I supply no values, I want to add a bunch of default values to the list.</p>\n\n<p>Kind of exactly like Python's <code>xs = parsed_list or [1,2,3]</code></p>\n"}, {"tags": ["debugging", "haskell", "logging", "formatting", "typeclass"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1429992801, "post_id": 29870082, "comment_id": 47865329, "body": "I&#39;m not familiar with pretty-printing combinator libraries, but they might offer a nice solution for this task. Try to search Hackage for some usable one."}, {"owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "edited": false, "score": 0, "creation_date": 1429993014, "post_id": 29870082, "comment_id": 47865406, "body": "Can you add the definition of your data type and the Show instance to your question, please?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1429995663, "post_id": 29870082, "comment_id": 47866243, "body": "chi@ is right, you want a pretty-printing library.  The most popular is <a href=\"https://hackage.haskell.org/package/pretty-1.0.1.0/docs/Text-PrettyPrint-HughesPJ.html\" rel=\"nofollow noreferrer\"><code>Text.PrettyPrint.HughesPJ</code></a>.  The <code>Show</code> class isn&#39;t quite good enough for this though, you need a class which takes <code>a -&gt; Doc</code> instead, then convert the <code>Doc</code> to a <code>String</code> at the very end."}], "owner": {"reputation": 3918, "user_id": 1305540, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/3ee433f66d0b4a0e2dbe10bb560e1f93?s=128&d=identicon&r=PG", "display_name": "exists-forall", "link": "https://stackoverflow.com/users/1305540/exists-forall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 163, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1429992033, "creation_date": 1429992033, "question_id": 29870082, "link": "https://stackoverflow.com/questions/29870082/implementing-show-for-multi-line-content-in-haskell", "title": "Implementing show for multi-line content in Haskell", "body": "<p>I have a small matrix type in Haskell that is that is most appropriately displayed across multiple lines.  My current implementation of <code>show</code> formats matrices like this:</p>\n\n<pre><code>matFromRows [[1,2]\n            ,[3,4]]\n</code></pre>\n\n<p>This works well on its own (IE for seeing the contents of a matrix in <code>ghci</code>), but whenever a matrix is displayed as part of a larger structure, it generates very awkwardly formatted and difficult to read content.  For example, the tuple <code>(matFromRows [[1, 2], [3, 4]], matFromRows [[5, 6], [7, 8]])</code> will display as</p>\n\n<pre><code>(matFromRows [[1,2]\n            ,[3,4]],matFromRows [[5,6]\n            ,[7,8]]\n</code></pre>\n\n<p>What is the most graceful way to handle <code>show</code>ing multi-line content in Haskell, so that its formatting isn't destroyed when you display it as part of a larger structure?</p>\n"}, {"tags": ["haskell", "lambda", "functional-programming", "lazy-evaluation", "lambda-calculus"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1429989818, "post_id": 29869068, "comment_id": 47864388, "body": "Very interesting subject, though I have my doubts whether this question is on topic according to StackOverflow guidelines."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1429990919, "post_id": 29869068, "comment_id": 47864742, "body": "@leftaroundabout Actually, I have some doubts as well. Yet, I think it can be regarded as a programming question, since the question at the bottom asks about how to adapt the code to fit several strategies (possibly in an elegant way). It is not (only) about the lambda-calculus."}], "answers": [{"tags": [], "owner": {"reputation": 17464, "user_id": 2040251, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UsW2G.jpg?s=128&g=1", "display_name": "kraskevich", "link": "https://stackoverflow.com/users/2040251/kraskevich"}, "is_accepted": true, "score": 1, "last_activity_date": 1429990753, "last_edit_date": 1429990753, "creation_date": 1429989863, "answer_id": 29869672, "question_id": 29869068, "link": "https://stackoverflow.com/questions/29869068/is-it-possible-to-showcase-the-different-strategies-of-evaluation-by-modifying-t/29869672#29869672", "title": "Is it possible to showcase the different strategies of evaluation by modifying this simple reducer?", "body": "<p>Call-by-name requires only a few changes:</p>\n\n<ol>\n<li><p>Not evaluating the body of a lambda abstraction: <code>reduce (Lam body) = (Lam body)</code>.</p></li>\n<li><p>Not evaluating the argument of the application. Instead, we should substitute it as is:</p>\n\n<pre><code>reduce (App left right) = case reduce left of\n    Lam body -&gt; reduce (substitute right body)\n</code></pre></li>\n</ol>\n\n<p>Call-by-need(aka lazy evaluation) seems harder(or maybe impossible) to implement in a fully declarative manner because we need to memoize values of expressions. I do not see a way to achieve it with minor changes. </p>\n\n<p>Call by-sharing is not applicable to simple lambda calculus because we do not have objects and assignments here. </p>\n\n<p>We could also use full beta reduction, but we need to chose some deterministic order of evaluation(we cannot pick an \"arbitrary\" redex and reduce it using the code we have now). This choice will yield some evaluation strategy(possible one of the described above). </p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1429991009, "last_edit_date": 1429991009, "creation_date": 1429990343, "answer_id": 29869762, "question_id": 29869068, "link": "https://stackoverflow.com/questions/29869068/is-it-possible-to-showcase-the-different-strategies-of-evaluation-by-modifying-t/29869762#29869762", "title": "Is it possible to showcase the different strategies of evaluation by modifying this simple reducer?", "body": "<p>The topic is quite broad. I'll just write about a few ideas.</p>\n\n<p>The proposed <code>reduce</code> performs parallel rewriting. That is, it maps <code>App t1 t2</code> to <code>App t1' t2'</code> (provided <code>t1'</code> is not an abstraction). Some strategies such as CBV and CBN are more sequential, in that they only have a single redex.</p>\n\n<p>To describe them, I would modify <code>reduce</code> so that it returns whether a reduction was actually done, or if instead the term was a normal form. This can be done by returning a <code>Maybe Term</code>, where <code>Nothing</code> means normal form.</p>\n\n<p>In that way, CBN would be</p>\n\n<pre><code>reduce :: Term -&gt; Maybe Term\nreduce (Var index)            = Nothing   -- Vars are NF\nreduce (Lam body)             = Nothing   -- no reduction under Lam\nreduce (App (Lam body) right) = Just $ substitute right body\nreduce (App left right) = \n      (flip App right &lt;$&gt; reduce left) &lt;|&gt;  -- try reducing left\n      (App left       &lt;$&gt; reduce right)     -- o.w., try reducing right\n</code></pre>\n\n<p>while CBV would be</p>\n\n<pre><code>reduce :: Term -&gt; Maybe Term\nreduce (Var index)            = Nothing\nreduce (Lam body)             = Nothing   -- no reduction under Lam\nreduce (App (Lam body) right) \n     | reduce right == Nothing            -- right must be a NF\n     = Just $ substitute right body\nreduce (App left right) = \n      (flip App right &lt;$&gt; reduce left) &lt;|&gt;\n      (App left       &lt;$&gt; reduce right)\n</code></pre>\n\n<p>Lazy evaluation (with sharing) can not be expressed using terms, if I remember correctly. It requires graphs to denote that a subterm is being shared.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 1, "accepted_answer_id": 29869672, "answer_count": 2, "score": 11, "last_activity_date": 1429991009, "creation_date": 1429986736, "last_edit_date": 1429989870, "question_id": 29869068, "link": "https://stackoverflow.com/questions/29869068/is-it-possible-to-showcase-the-different-strategies-of-evaluation-by-modifying-t", "title": "Is it possible to showcase the different strategies of evaluation by modifying this simple reducer?", "body": "<p>I am the kind that prefers learning by looking at code instead of reading long explanations. This might be one of the reasons I dislike long academic papers. Code is unambiguous, compact, noise-free and if you don't get something you can just play with it - no need to ask the author. </p>\n\n<p>This is a complete definition of the Lambda Calculus:</p>\n\n<pre><code>-- A Lambda Calculus term is a function, an application or a variable.\ndata Term = Lam Term | App Term Term | Var Int deriving (Show,Eq,Ord)\n\n-- Reduces lambda term to its normal form.\nreduce :: Term -&gt; Term\nreduce (Var index)      = Var index\nreduce (Lam body)       = Lam (reduce body)\nreduce (App left right) = case reduce left of\n    Lam body  -&gt; reduce (substitute (reduce right) body)\n    otherwise -&gt; App (reduce left) (reduce right)\n\n-- Replaces bound variables of `target` by `term` and adjusts bruijn indices.\n-- Don't mind those variables, they just keep track of the bruijn indices.\nsubstitute :: Term -&gt; Term -&gt; Term\nsubstitute term target = go term True 0 (-1) target where\n    go t s d w (App a b)             = App (go t s d w a) (go t s d w b)\n    go t s d w (Lam a)               = Lam (go t s (d+1) w a) \n    go t s d w (Var a) | s &amp;&amp; a == d = go (Var 0) False (-1) d t \n    go t s d w (Var a) | otherwise   = Var (a + (if a &gt; d then w else 0))\n\n-- If the evaluator is correct, this test should print the church number #4.\nmain = do\n    let two = (Lam (Lam (App (Var 1) (App (Var 1) (Var 0)))))\n    print $ reduce (App two two)\n</code></pre>\n\n<p>In my opinion, the \"reduce\" function above says much more about the Lambda Calculus than pages of explanations and I wish I could just look at it when I started learning. You can also see it implements a very strict evaluation strategy that goes even inside abstractions. On that spirit, <strong>how could that code be modified in order to illustrate the many different evaluation strategies that the LC can have (call-by-name, lazy evaluation, call-by-value, call-by-sharing, partial evaluation and so on)?</strong></p>\n"}, {"tags": ["haskell", "filter", "pandoc", "hakyll"], "answers": [{"comments": [{"owner": {"reputation": 182, "user_id": 2929058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f84747fe5455d4ac1dd84edfe924e34?s=128&d=identicon&r=PG&f=1", "display_name": "Fang Hung-chien", "link": "https://stackoverflow.com/users/2929058/fang-hung-chien"}, "edited": false, "score": 0, "creation_date": 1430041849, "post_id": 29872369, "comment_id": 47876498, "body": "Thank you very much for your answer. But I still have a question. If I understood correctly, your solution is doing something like <code>pandoc | pandoc -t json | .&#47;filter.py | pandoc -f json</code>Pandoc process twice (Markdown ---&gt; HTML ---&gt; JSON ---&gt; JSON ---&gt; HTML) before the filter, the result is a little bit different from that of <code>pandoc -t | .&#47;filter.py | pandoc -f json</code> (Markdown ---&gt; JSON ---&gt;JSON ---&gt; HTML) by looking at the pandoc native output. However, I could modify my filter a bit to get my desired result. Thank you again."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 182, "user_id": 2929058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f84747fe5455d4ac1dd84edfe924e34?s=128&d=identicon&r=PG&f=1", "display_name": "Fang Hung-chien", "link": "https://stackoverflow.com/users/2929058/fang-hung-chien"}, "edited": false, "score": 0, "creation_date": 1430072187, "post_id": 29872369, "comment_id": 47887157, "body": "Oh wait, above I was thinking you were using hakyll which will itself process these things using the pandoc haskell libraries, rather than using the <code>pandoc</code> executable. I was in any case imagining <code>md -&gt; json -&gt; json -&gt; html</code> where python is doing the <code>json -&gt; json</code>  bit -- which is what the script does. If you are making html by hand with the <code>pandoc</code> executable then as you say just do <code>cat myfile.md | pandoc -t json | .&#47;filter.py | pandoc -f json -t html -s</code> (using <code>-s</code> for a standalone html)."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 182, "user_id": 2929058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f84747fe5455d4ac1dd84edfe924e34?s=128&d=identicon&r=PG&f=1", "display_name": "Fang Hung-chien", "link": "https://stackoverflow.com/users/2929058/fang-hung-chien"}, "edited": false, "score": 0, "creation_date": 1430072355, "post_id": 29872369, "comment_id": 47887232, "body": "It is true that the hakyll process I was describing will convert the markdown to pandoc&#39;s &#39;native&#39; representation, then go to json, then re-read the python-altered json into pandoc&#39;s native representation and then to html.  However, the native haskell representation in the <code>Pandoc</code> type is barely different from the json your filter reads and writes.  If you had a filter written in haskell of course it would be able to skip the json step which is for the sake of the python filter."}, {"owner": {"reputation": 182, "user_id": 2929058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f84747fe5455d4ac1dd84edfe924e34?s=128&d=identicon&r=PG&f=1", "display_name": "Fang Hung-chien", "link": "https://stackoverflow.com/users/2929058/fang-hung-chien"}, "edited": false, "score": 0, "creation_date": 1430073246, "post_id": 29872369, "comment_id": 47887609, "body": "Sorry, I didn&#39;t understand what you said (maybe because I didn&#39;t understand how Hakyll deal with the markdown files). I am not using the <code>pandoc</code> executable. I am using Hakyll with pandoc libraries. I thought what you described is converting markdown to HTML (as <code>pandocCompiler</code> does). Then the <code>trasformer</code> reads HTML and write to JSON (<code>writeJSON</code>). After filtered by my filter, the JSON goes to the reader (<code>readJSON</code>). Finally, <code>pandocCompiler</code> converts the JSON to HTML."}, {"owner": {"reputation": 182, "user_id": 2929058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f84747fe5455d4ac1dd84edfe924e34?s=128&d=identicon&r=PG&f=1", "display_name": "Fang Hung-chien", "link": "https://stackoverflow.com/users/2929058/fang-hung-chien"}, "edited": false, "score": 0, "creation_date": 1430073357, "post_id": 29872369, "comment_id": 47887650, "body": "The reason why I think so is my filter didn&#39;t work in this workflow. I am sure I am using correct pandoc extensions and options."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 182, "user_id": 2929058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f84747fe5455d4ac1dd84edfe924e34?s=128&d=identicon&r=PG&f=1", "display_name": "Fang Hung-chien", "link": "https://stackoverflow.com/users/2929058/fang-hung-chien"}, "edited": false, "score": 0, "creation_date": 1430073452, "post_id": 29872369, "comment_id": 47887685, "body": "I see, are you doing all this on the command line? Or via a hakyll program written in haskell?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 182, "user_id": 2929058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f84747fe5455d4ac1dd84edfe924e34?s=128&d=identicon&r=PG&f=1", "display_name": "Fang Hung-chien", "link": "https://stackoverflow.com/users/2929058/fang-hung-chien"}, "edited": false, "score": 0, "creation_date": 1430073639, "post_id": 29872369, "comment_id": 47887768, "body": "Hm hm. I am baffled why in the hakyll as I was imagining it there would seem to be an intermediate production of html.  It may be that the double application of <code>readerOptions</code> or <code>writerOptions</code> is messing things up. That make make it appear that html is produced in the middle."}, {"owner": {"reputation": 182, "user_id": 2929058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f84747fe5455d4ac1dd84edfe924e34?s=128&d=identicon&r=PG&f=1", "display_name": "Fang Hung-chien", "link": "https://stackoverflow.com/users/2929058/fang-hung-chien"}, "edited": false, "score": 0, "creation_date": 1430074669, "post_id": 29872369, "comment_id": 47888204, "body": "I will try to figure out why my filer does not work. At least you gave me some ideas on how to solve this. Thank you!"}, {"owner": {"reputation": 182, "user_id": 2929058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f84747fe5455d4ac1dd84edfe924e34?s=128&d=identicon&r=PG&f=1", "display_name": "Fang Hung-chien", "link": "https://stackoverflow.com/users/2929058/fang-hung-chien"}, "edited": false, "score": 0, "creation_date": 1430075781, "post_id": 29872369, "comment_id": 47888575, "body": "I am sorry for the puzzling updates. Now I find out what&#39;s going wrong. It&#39;s my fault that I din&#39;t use the same test input but wrote a new one. My filter is dealing with LaTeX math/environment (as indicated in my description of my question, I want to draw commutative diagram using <code>tikzcd</code>). But markdown has some restrictions how to write math: <code>\\[ \\begin{tikcd}</code> must be in the same line but <code>\\[ \\sum</code> need not be. Because of this mistake, I didn&#39;t get what I expected."}, {"owner": {"reputation": 182, "user_id": 2929058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f84747fe5455d4ac1dd84edfe924e34?s=128&d=identicon&r=PG&f=1", "display_name": "Fang Hung-chien", "link": "https://stackoverflow.com/users/2929058/fang-hung-chien"}, "edited": false, "score": 0, "creation_date": 1430076003, "post_id": 29872369, "comment_id": 47888652, "body": "Thanks for your updates. It really helps. I hope your answer will help others who have similar problems as me."}], "tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 4, "last_activity_date": 1430093501, "last_edit_date": 1430093501, "creation_date": 1430008729, "answer_id": 29872369, "question_id": 29868096, "link": "https://stackoverflow.com/questions/29868096/how-to-use-pandoc-filter-within-hakyll/29872369#29872369", "title": "How to use Pandoc filter within Hakyll?", "body": "<p>In the end I think you would use both. Using this <a href=\"https://github.com/listx/listx_blog/blob/master/blog.hs\" rel=\"nofollow\">https://github.com/listx/listx_blog/blob/master/blog.hs</a> as a model, the following will have the same shape as <a href=\"https://github.com/listx/listx_blog/blob/master/blog.hs#L185\" rel=\"nofollow\"><code>transformer</code> has in it</a>. <code>transformer</code> is used on <a href=\"https://github.com/listx/listx_blog/blob/master/blog.hs#L74\" rel=\"nofollow\">lines 69-80 for 'posts'</a> -- that is as the third argument to <code>pandocCompilerWithTransformM</code>, which is a <code>(Pandoc -&gt; Compiler Pandoc)</code> Here you would need to add the absolute path to your python filter -- or the name if it's in $PATH -- and reader and writer options (e.g. <code>defaultHakyllReaderOptions</code> and  <code>defaultHakyllWriterOptions</code>)</p>\n\n<pre><code>import Text.Pandoc\nimport Hakyll\n\ntype Script = String \n\ntransformer\n  :: Script         -- e.g. \"/absolute/path/filter.py\"\n  -&gt; ReaderOptions  -- e.g.  defaultHakyllReaderOptions\n  -&gt; WriterOptions  -- e.g.  defaultHakyllWriterOptions\n  -&gt; (Pandoc -&gt; Compiler Pandoc)\ntransformer script reader_opts writer_opts pandoc = \n    do let input_json = writeJSON writer_opts pandoc\n       output_json &lt;- unixFilter script [] input_json\n       return $ \n          -- either (error.show) id $  -- this line needs to be uncommented atm.\n          readJSON reader_opts output_json \n</code></pre>\n\n<p>similarly, <code>(transformer \"/usr/local/bin/myfilter.py\" defaultHakyllReaderOptions defaultHakyllWriterOptions)</code> might be used where <code>(return . pandocTransform)</code> is used, on line 125 of this <a href=\"https://gist.github.com/simonmichael/cf8577ec73e8a288aac9\" rel=\"nofollow\">example gist</a></p>\n\n<hr>\n\n<p>For debugging you might outsource everything to <code>unixFilter</code>:</p>\n\n<pre><code>transform :: Script -&gt; String -&gt; Compiler String\ntransform script md = do json0 &lt;- unixFilter pandoc input_args md\n                         json1 &lt;- unixFilter script [] json0\n                         unixFilter pandoc output_args json1\n where\n   pandoc = \"pandoc\"\n   input_args = words \"-f markdown -t json\" -- add others\n   output_args = words \"-f json -t html\"    -- add others\n</code></pre>\n\n<p>The three lines of the <code>do</code> block are the equivalent of the stages of unix piping in  <code>pandoc -t json | filter.py | pandoc -f json</code> with whatever additional arguments. </p>\n\n<hr>\n\n<p>I think maybe you are right there is an extra layer of pandoc back and forth here.  The <code>pandocCompilerWithTransform(M)</code> functions are for a direct Pandoc-> Pandoc function - it will be applied to the Pandoc hakyll comes up with. I think we should dispense with this and use the Pandoc libraries directly.  A use of <code>unixCompile</code> might be like this.</p>\n\n<pre><code>transformXLVI :: Script -&gt; ReaderOptions -&gt; WriterOptions -&gt; String  -&gt; Compiler Html\ntransformXLVI script ropts wopts = fmap fromJSON . unixFilter script [] . toJSON \n  where \n    toJSON   = writeJSON wopts \n    --           . either (error . show) id -- for pandoc &gt; 1.14\n               . readMarkdown ropts \n    fromJSON = writeHtml wopts\n    --           . either (error . show) id\n               . readJSON ropts \n</code></pre>\n\n<p>I hope the principles are emerging from these variations! This should be pretty much the same as the preceding <code>transform</code>; we are using the pandoc library in place of calls to the <code>pandoc</code> executable.</p>\n"}], "owner": {"reputation": 182, "user_id": 2929058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f84747fe5455d4ac1dd84edfe924e34?s=128&d=identicon&r=PG&f=1", "display_name": "Fang Hung-chien", "link": "https://stackoverflow.com/users/2929058/fang-hung-chien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 773, "favorite_count": 0, "accepted_answer_id": 29872369, "answer_count": 1, "score": 5, "last_activity_date": 1430093501, "creation_date": 1429981068, "last_edit_date": 1430074819, "question_id": 29868096, "link": "https://stackoverflow.com/questions/29868096/how-to-use-pandoc-filter-within-hakyll", "title": "How to use Pandoc filter within Hakyll?", "body": "<p>I am sorry to ask such a question. But I am really new to Haskell. I searched the Internet for a whole day but didn't find any example.</p>\n\n<p>I have a pandoc filter written in python (<code>tikzcd.py</code>). I want to use that filter to process my blog posts. </p>\n\n<p>I guess I need to use <code>unixFilter</code> or <code>pandocCompileWithTransform</code> but my knowledge to Haskell is really not enough to find a solution myself.</p>\n\n<p>So, could someone provide me an example?</p>\n\n<p>-----------U--P--D--A--T--E--S---------------</p>\n\n<p><del>@Michael gives an solution using <code>pandocCompileWithTransformM</code> and <code>unixFilter</code>. It works. But there is a problem.</del></p>\n\n<p><del>When using a filter from command line, what I will do is </del></p>\n\n<pre><code>pandoc -t json -READEROPTIONS input.markdown | ./filter.py | pandoc -f JSON -WRITEROPTIONS -o output.html\n</code></pre>\n\n<blockquote>\n  <p><del>or equivalently</del></p>\n\n<pre><code>pandoc --filter ./filter.py -READEROPTIONS -WRITEROPTIONS -o html\n</code></pre>\n  \n  <p><del>This command is shorter but it doesn't show the procedures.</del></p>\n</blockquote>\n\n<p><del>But with <code>pandocCompilerTransformM</code>, it does something like</del></p>\n\n<pre><code>pandoc -t html -READEROPTIONS -WRITEROPTIONS input.mardown | pandoc -t JSON | ./filter.py | pandoc -f JSON -WRITEROPTIONS -o output.html\n</code></pre>\n\n<p><del>The difference is that the text that passed to <code>filter.py</code> is different: one is the contents directly produced from markdown, while the other is some texts produced from HTML that was produced from markdown. As you know, to convert something back and forth will always produce unexpected problem. So I think there may be a better solution.</del></p>\n\n<p>PS. I've stared to learn Haskell. I hope I could solve this problem myself someday. Thank you!</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1429982504, "post_id": 29867387, "comment_id": 47861680, "body": "Maybe try installing <code>cabal install bytestring-lexing</code> and then try again with <code>hedis</code> installation ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1430010131, "post_id": 29867387, "comment_id": 47870031, "body": "Sibi, that solved it da.... please make this as answer. in btw, <code>bytestring-lexing</code> needed <code>alex</code> which i solved by the same way."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 0, "last_activity_date": 1430011551, "creation_date": 1430011551, "answer_id": 29872655, "question_id": 29867387, "link": "https://stackoverflow.com/questions/29867387/bytestring-lexing-0-4-3-2-failed-during-the-configure-step/29872655#29872655", "title": "bytestring-lexing-0.4.3.2 failed during the configure step", "body": "<p>The error message is simply indicating that it's not able to find the package <code>bytestring-lexing</code>. So try installing that package first:</p>\n\n<pre><code>cabal install bytestring-lexing\n</code></pre>\n\n<p>And then try again the installation of <code>hedis</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 29872655, "answer_count": 1, "score": 0, "last_activity_date": 1430011551, "creation_date": 1429977127, "question_id": 29867387, "link": "https://stackoverflow.com/questions/29867387/bytestring-lexing-0-4-3-2-failed-during-the-configure-step", "title": "bytestring-lexing-0.4.3.2 failed during the configure step", "body": "<pre><code>cabal install hedis\n</code></pre>\n\n<p>This failed due to its dependency - <code>bytestring-lexing</code> not getting installed. The error message is,</p>\n\n<pre><code>bytestring-lexing-0.4.3.2 failed during the configure step. The exception was:\nExitFailure 1\nhedis-0.6.5 depends on bytestring-lexing-0.4.3.2 which failed to install.\n</code></pre>\n\n<p>To reason why this package failed, I grep-ed for local installations of <code>bytestring-lexing</code> using this command,</p>\n\n<pre><code> ghc-pkg field bytestring-lexing depends                                                                                                   \n</code></pre>\n\n<p>But there are no local packages,</p>\n\n<pre><code>ghc-pkg: cannot find package bytestring-lexing\n</code></pre>\n\n<p>Now it is not the version conflict, what else could cause this error?</p>\n"}, {"tags": ["haskell", "module", "hierarchy", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 668, "user_id": 2155544, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/caae6ef08bc308aaa3c34324286bad6d?s=128&d=identicon&r=PG", "display_name": "Michael restore Monica Cellio", "link": "https://stackoverflow.com/users/2155544/michael-restore-monica-cellio"}, "edited": false, "score": 0, "creation_date": 1430028471, "post_id": 29865105, "comment_id": 47873461, "body": "This is becoming infuriating.  I have Foundation.hs thus:  <i>-- | The foundation object data JRState = JRState { \t\t... \t}  YC.mkYesodData &quot;JRState&quot; RouteData.routeData  instance YA.YesodAuth JRState where    ...</i>  along with all the other instance declarations, then in Main.hs:  <i>import Foundation  Y.mkYesodDispatch &quot;JRState&quot; resourcesJRState</i>  but the compiler warns &quot;Orphan instance: instance Y.YesodDispatch JRState&quot; and dispatching (e.g., new account creation via the route &quot;\t/auth AuthR YA.Auth Yesod.Auth.getAuth&quot;) doesn&#39;t work.  Help !"}, {"owner": {"reputation": 668, "user_id": 2155544, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/caae6ef08bc308aaa3c34324286bad6d?s=128&d=identicon&r=PG", "display_name": "Michael restore Monica Cellio", "link": "https://stackoverflow.com/users/2155544/michael-restore-monica-cellio"}, "edited": false, "score": 0, "creation_date": 1430029887, "post_id": 29865105, "comment_id": 47873719, "body": "I note that you simply suppress the warning in mangopay&#39;s Application.hs so maybe my suspicion about the warning is misplaced.  The full horror is at <a href=\"https://github.com/mounty1/JackRose.git\" rel=\"nofollow noreferrer\">github.com/mounty1/JackRose.git</a>"}, {"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 0, "creation_date": 1430037142, "post_id": 29865105, "comment_id": 47875307, "body": "An orphan instance is not a problem here : orphan instances are instances that are created in another module than the data type declaration and the risk is that someone else declare another instance in another module so you get a conflict with two such orphans... But here your instance is for your own data type, specific to your application thus it won&#39;t be declared in another of your import !"}, {"owner": {"reputation": 668, "user_id": 2155544, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/caae6ef08bc308aaa3c34324286bad6d?s=128&d=identicon&r=PG", "display_name": "Michael restore Monica Cellio", "link": "https://stackoverflow.com/users/2155544/michael-restore-monica-cellio"}, "edited": false, "score": 0, "creation_date": 1430046294, "post_id": 29865105, "comment_id": 47877865, "body": "Sorry for the noise everyone.  The problem was entirely specific to my application and not related to routing.  Just in case anyone else encounters it, I&#39;d enabled SSL-only connections in my <i>instance Yesod App</i> declaration, but was connecting via port 3000 which I think my local firewalld or iptables was blocking."}], "tags": [], "owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "is_accepted": true, "score": 7, "last_activity_date": 1429964570, "creation_date": 1429964570, "answer_id": 29865105, "question_id": 29864470, "link": "https://stackoverflow.com/questions/29864470/how-to-break-up-the-monolithic-mkyesod-block-safely/29865105#29865105", "title": "how to break up the monolithic mkYesod block safely", "body": "<p>You are correct, but that point is also addressed in the yesod book. For example have a look at <a href=\"http://www.yesodweb.com/book/scaffolding-and-the-site-template\">http://www.yesodweb.com/book/scaffolding-and-the-site-template</a>, the section called \"Foundation and Application modules\". Usually you have a Foundation module that defines route types and handler functions, and an Application module that defines the dispatching. So all your handler modules import Foundation, and Application imports all your handle modules and Foundation. No cycles!</p>\n\n<p>You may be also interested in reading <a href=\"http://www.yesodweb.com/blog/2012/10/yesod-pure\">http://www.yesodweb.com/blog/2012/10/yesod-pure</a>, about using Yesod without  TH.</p>\n\n<p>Look at samples yesod applications in Github. For example, I've developed a simple Yesod app to demonstrate electronic payments at <a href=\"https://github.com/JPMoresmau/mangopay/tree/master/yesod-mangopay/app\">https://github.com/JPMoresmau/mangopay/tree/master/yesod-mangopay/app</a>. You'll see that multi module approach there.</p>\n"}], "owner": {"reputation": 668, "user_id": 2155544, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/caae6ef08bc308aaa3c34324286bad6d?s=128&d=identicon&r=PG", "display_name": "Michael restore Monica Cellio", "link": "https://stackoverflow.com/users/2155544/michael-restore-monica-cellio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 29865105, "answer_count": 1, "score": 2, "last_activity_date": 1429964570, "creation_date": 1429960866, "question_id": 29864470, "link": "https://stackoverflow.com/questions/29864470/how-to-break-up-the-monolithic-mkyesod-block-safely", "title": "how to break up the monolithic mkYesod block safely", "body": "<p>This question is more to help my understanding of Yesod than anything else.  Take the example at <a href=\"http://www.yesodweb.com/book/basics\" rel=\"nofollow\">http://www.yesodweb.com/book/basics</a> and in particular the code generated by the <em>mkYesod</em> <strong>TH</strong> function.</p>\n\n<p>The problem that I perceive is that this <strong>TH</strong> generates both the route data type (<em>data Route HelloWorld = HomeR</em>) and the <em>yesodDispatch</em> function which calls <em>getHomeR</em> etc.</p>\n\n<p>The difficulty there is that in a larger project you can't split out the definition of <em>getHomeR</em> into a separate module because Haskell's simple module system is strictly hierarchical;  so if <em>getHomeR</em> simply called <em>getHomeRimplementation</em> which were defined in another module (say <strong>HomeImplementation</strong>) then that module would need to import the definition of <em>data Route HelloWorld</em> and there would be a circular dependency.</p>\n\n<p>It seems to me that this could be avoided if the <em>RenderRoute</em>, <em>ParseRoute</em> and <em>YesodDispatch</em> instances could be declared in separate modules;  then <em>RenderRoute</em> could be at the bottom of the importation hierarchy, and <em>YesodDispatch</em>, at the top.  Does that make sense ?  Maybe the fact that I ask this question shows that I don't understand something about the <em>mkYesod</em> <strong>TH</strong>;  e.g., that there is some crucial interrelationship and they should not be separated.</p>\n"}, {"tags": ["haskell", "slice", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": false, "score": 3, "last_activity_date": 1429960464, "last_edit_date": 1429960464, "creation_date": 1429958686, "answer_id": 29864154, "question_id": 29863379, "link": "https://stackoverflow.com/questions/29863379/how-to-take-an-2d-slice-with-lens/29864154#29864154", "title": "How to take an 2D slice with Lens", "body": "<p>This should do it</p>\n\n<pre><code>insliced :: Int -&gt; Int -&gt; Lens' (V.Vector (V.Vector a)) (V.Vector (V.Vector a))\ninsliced i n f m = f (V.map (V.slice i n) m)\n    &lt;&amp;&gt; V.zipWith (\\a b -&gt; a V.// zip [i..i+n-1] (V.toList b)) m\n</code></pre>\n\n<p>then</p>\n\n<pre><code>\u03bb v ^. sliced 1 2 . insliced 0 2\nfromList [fromList [4,5],fromList [7,8]]\n</code></pre>\n\n<p>This has similar requirements to <code>sliced</code> to be valid.</p>\n\n<p>It's worth mentioning there's a general version of this called <code>column</code> from <code>linear</code>. It can't be used with <code>Vector</code> because <code>Vector</code>s aren't <code>Representable</code> (because because it's size isn't statically known). But with something like <code>V3</code>:</p>\n\n<pre><code>\u03bb V3 (V3 1 2 3) (V3 4 5 6) (V3 7 8 9) ^. _yz . column _xy\nV2 (V2 4 5) (V2 7 8)\n</code></pre>\n\n<p>You could write your own (less safe) version for vectors:</p>\n\n<pre><code>vcolumn :: ALens' a b -&gt; Lens' (V.Vector a) (V.Vector b)\nvcolumn l f m = f (V.map (^# l) m) &lt;&amp;&gt; V.zipWith (\\a b -&gt; a &amp; l #~ b) m\n</code></pre>\n"}], "owner": {"reputation": 103, "user_id": 4429970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79b8c5e6dba911ce00c539e51764b833?s=128&d=identicon&r=PG&f=1", "display_name": "Alex K.", "link": "https://stackoverflow.com/users/4429970/alex-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1429960464, "creation_date": 1429954002, "question_id": 29863379, "link": "https://stackoverflow.com/questions/29863379/how-to-take-an-2d-slice-with-lens", "title": "How to take an 2D slice with Lens", "body": "<pre><code>import qualified Data.Vector as V\nimport Control.Lens\nimport Data.Vector.Lens\n\nv = V.fromList [V.fromList [1..3], V.fromList [4..6], V.fromList [7..9]]\n</code></pre>\n\n<p>1D slice (for example) :</p>\n\n<pre><code>*Main&gt; v ^. sliced 1 2\nfromList [fromList [4,5,6],fromList [7,8,9]]\n</code></pre>\n\n<p>2D sclice:  What should I write to get this result?</p>\n\n<pre><code>*Main&gt; v ^. sliced 1 2 {- ??????? -}  sliced 0 2   --  Or not so?\nV.fromList [V.fromList [4,5], V.fromList [7,8]]\n</code></pre>\n"}, {"tags": ["haskell", "lazy-evaluation", "memoization"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1429934215, "post_id": 29860661, "comment_id": 47847428, "body": "What package is <code>Data.Function.Memoize</code> from?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1429934281, "post_id": 29860661, "comment_id": 47847443, "body": "@DanielWagner <a href=\"https://hackage.haskell.org/package/memoize\" rel=\"nofollow noreferrer\">memoize</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1429934335, "post_id": 29860661, "comment_id": 47847454, "body": "FWIW, I see a very different behavior with your code than what you report. I think perhaps your actual code is using <code>3</code> as the last argument rather than <code>5</code>."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1429934080, "creation_date": 1429934080, "answer_id": 29860821, "question_id": 29860661, "link": "https://stackoverflow.com/questions/29860661/how-do-i-force-a-function-to-be-called-immediately-in-haskell/29860821#29860821", "title": "How do I force a function to be called immediately in Haskell?", "body": "<p>Like this:</p>\n\n<pre><code>main = let f = foo 0 in do\n    print $ f 5\n    print $ f 5\n    print $ f 5\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 9, "last_activity_date": 1429934524, "creation_date": 1429934524, "answer_id": 29860856, "question_id": 29860661, "link": "https://stackoverflow.com/questions/29860661/how-do-i-force-a-function-to-be-called-immediately-in-haskell/29860856#29860856", "title": "How do I force a function to be called immediately in Haskell?", "body": "<p>The problem is that the memotable is created for <em>each</em> parameter value, <code>foo 0</code> etc., not for the whole of <code>foo</code>.  And then those memotables are not shared from one invocation of <code>foo</code> to the next.  The solution is to make sure to <em>also</em> memoize the whole of <code>foo</code>:</p>\n\n<pre><code>import Data.Function.Memoize\nimport Debug.Trace\n\nfoo :: Int -&gt; Int -&gt; Int\nfoo = memoize foo1 where\n    foo1 a = memoFix fooMemo where \n        fooMemo f x = a + (trace (show x) cont) where\n            cont = if x == 0 then 0 else x + f (x - 1)\n\nmain = do\n    print $ foo 0 5\n    print $ foo 0 5\n    print $ foo 0 5\n</code></pre>\n\n<p>BTW I find the following way of writing it easier than using <code>memoFix</code>:</p>\n\n<pre><code>foo :: Int -&gt; Int -&gt; Int\nfoo = memoize2 $ \\a x -&gt;\n    let cont = if x == 0 then 0 else x + foo a (x - 1)\n    in a + (trace (show x) cont)\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 29860856, "answer_count": 2, "score": 2, "last_activity_date": 1429971543, "creation_date": 1429932499, "last_edit_date": 1429971543, "question_id": 29860661, "link": "https://stackoverflow.com/questions/29860661/how-do-i-force-a-function-to-be-called-immediately-in-haskell", "title": "How do I force a function to be called immediately in Haskell?", "body": "<p>This is my code:</p>\n\n<pre><code>import Data.Function.Memoize\nimport Debug.Trace\n\nfoo :: Int -&gt; Int -&gt; Int\nfoo a = memoFix fooMemo where \n    fooMemo f x = a + (trace (show x) cont) where\n        cont = if x == 0 then 0 else x + f (x - 1)\n\nmain = do\n    print $ foo 0 5\n    print $ foo 0 5\n    print $ foo 0 5\n</code></pre>\n\n<p>I expected it to print:</p>\n\n<pre><code>3\n2\n1\n0\n6\n6\n6\n</code></pre>\n\n<p>But, instead, it prints this:</p>\n\n<pre><code>3\n2\n1\n0\n6\n3\n2\n1\n0\n6\n3\n2\n1\n0\n6\n</code></pre>\n\n<p>In other words, the function is not memoized as I expected it to be. This is probably because each time \"foo 0\" is called, a new memo-table is created for \"foo\". How can I force GHC to evaluate \"memoFix fooMemo\" only once, so that it doesn't create more than one memotable?</p>\n"}, {"tags": ["haskell", "vector", "traversable"], "answers": [{"comments": [{"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1430011509, "post_id": 29859967, "comment_id": 47870353, "body": "I just had a shot and it seems like the larger obstacle is that the <code>Vector</code> consumers, fundamentally, can only fuse with data types that can be efficiently turned into the library&#39;s <code>Stream</code> type. So I don&#39;t think you can fuse <code>Vector</code> consumers with an arbitrary <code>Foldable</code>s for reasons similar to why you can&#39;t implement <code>uncons :: [a] -&gt; Maybe (a, [a])</code> efficiently with just <code>foldr</code>. (Try writing <code>toVector</code> in terms of <code>Foldable.foldr</code> and <code>Stream.unfoldr</code>, without effectively reimplementing <code>Foldable.toList</code>\u2014I don&#39;t think it can be done...) So your solution may well be optimal."}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 11, "last_activity_date": 1429938611, "last_edit_date": 1429938611, "creation_date": 1429925245, "answer_id": 29859967, "question_id": 29859929, "link": "https://stackoverflow.com/questions/29859929/how-to-convert-a-haskell-traversable-into-a-vector/29859967#29859967", "title": "How to convert a Haskell Traversable into a Vector?", "body": "<p>All <code>Traversable</code> instances are also <code>Foldable</code>, so you can write something like</p>\n\n<pre><code>toVector :: Foldable t =&gt; t a -&gt; Vector a\ntoVector = Vector.fromList . Foldable.toList\n{-# INLINE toVector #-}\n</code></pre>\n\n<p>This might make an intermediate list though, if that doesn't get fused away. The inlining should help make fusion more likely.</p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 374, "favorite_count": 0, "answer_count": 1, "score": 11, "last_activity_date": 1429938611, "creation_date": 1429924854, "question_id": 29859929, "link": "https://stackoverflow.com/questions/29859929/how-to-convert-a-haskell-traversable-into-a-vector", "title": "How to convert a Haskell Traversable into a Vector?", "body": "<p>If I have a <a href=\"https://hackage.haskell.org/package/base-4.6.0.1/docs/Data-Traversable.html\" rel=\"noreferrer\"><code>Traversable</code></a> instance, <code>xs</code>, how do I convert it into a <a href=\"http://hackage.haskell.org/package/vector\" rel=\"noreferrer\"><code>Vector</code></a>?</p>\n"}, {"tags": ["list", "haskell", "concat"], "answers": [{"comments": [{"owner": {"reputation": 25744, "user_id": 2089675, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/sBz5q.jpg?s=128&g=1", "display_name": "smac89", "link": "https://stackoverflow.com/users/2089675/smac89"}, "edited": false, "score": 0, "creation_date": 1429924107, "post_id": 29859820, "comment_id": 47845525, "body": "What is that <code>&lt;$&gt;</code> symbol?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 25744, "user_id": 2089675, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/sBz5q.jpg?s=128&g=1", "display_name": "smac89", "link": "https://stackoverflow.com/users/2089675/smac89"}, "edited": false, "score": 0, "creation_date": 1429924158, "post_id": 29859820, "comment_id": 47845539, "body": "@Smac89 It&#39;s operator symbol for <code>fmap</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 25744, "user_id": 2089675, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/sBz5q.jpg?s=128&g=1", "display_name": "smac89", "link": "https://stackoverflow.com/users/2089675/smac89"}, "edited": false, "score": 1, "creation_date": 1429924184, "post_id": 29859820, "comment_id": 47845545, "body": "@Smac89 <code>(&lt;$&gt;)</code> can be spelled many other ways, one of which may be familiar to you: <code>fmap</code>, <code>liftA</code>, <code>liftM</code>. You may also think of it as <code>\\f ma -&gt; do { a &lt;- ma; return (f a) }</code>, though it is slightly more general than that."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1429923706, "creation_date": 1429923706, "answer_id": 29859820, "question_id": 29859790, "link": "https://stackoverflow.com/questions/29859790/haskell-append-to-a-list-conditionally/29859820#29859820", "title": "Haskell append to a list conditionally", "body": "<p>Here is a short ghci session that may give you some ideas:</p>\n\n<pre><code>&gt; :m + Control.Monad Data.Either\n&gt; partitionEithers &lt;$&gt; replicateM 3 readLn :: IO ([Int], [Bool])\nLeft 5\nRight True\nLeft 7\n([5,7],[True])\n</code></pre>\n\n<p>The answer to your second question is that let is recursive; so the two <code>g</code>s in <code>let g = 1:g</code> are referring to the same in-memory object.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1429950255, "creation_date": 1429950255, "answer_id": 29862814, "question_id": 29859790, "link": "https://stackoverflow.com/questions/29859790/haskell-append-to-a-list-conditionally/29862814#29862814", "title": "Haskell append to a list conditionally", "body": "<p>You are thinking in term of mutable variables: you are \"initializing\" <code>l1,l2</code> to the empty list and then reasoning about updating them with longer lists. This design works fine in imperative programming, but not so simply in pure functional programming since it involves mutation.</p>\n\n<p>Now, even in pure functional programming we have ways to simulate mutation, through monads. For instance, once can achieve mutation here through <code>IORefs</code> or <code>StateT IO</code>. In this case, though, is would be an unnecessarily complex way to solve the task.</p>\n\n<p>You want to append data to form two lists. You want to use <code>replicateM</code>, which is fine. The point is that <code>replicateM</code> will build just one list, instead of two. The question now is: how can we create a list which is easily split into two?</p>\n\n<p>A first ugly attempt is to generate a list of tagged values, i.e. a list of pairs:</p>\n\n<pre><code>case line of\n   \"Yes\" -&gt; let value = ... in\n            return (\"for l1\", value)\n   \"No\"  -&gt; let value = ... in\n            return (\"for l2\", value)\n</code></pre>\n\n<p>Doing this would make <code>replicateM</code> produce a list such as</p>\n\n<pre><code>[(\"for l1\", value1), (\"for l1\", value2), (\"for l2\", value3), ...]\n</code></pre>\n\n<p>which we can then split into two lists.</p>\n\n<p>The use of strings for tags looks however a bit unelegant, since a boolean would suffice:</p>\n\n<pre><code>case line of\n   \"Yes\" -&gt; let value = ... in\n            return (True, value)\n   \"No\"  -&gt; let value = ... in\n            return (False, value)\n</code></pre>\n\n<p>An even better approach would be to use the <code>Either a b</code> type:</p>\n\n<pre><code>case line of\n   \"Yes\" -&gt; let value1 = ... in\n            return (Left value1)\n   \"No\"  -&gt; let value2 = ... in\n            return (Right value2)\n</code></pre>\n\n<p>The nice consequence of the above is that <code>value1</code> and <code>value2</code> can even be of different types. The previous snippets forced them to share their type: since we build a list of pairs each pair must have the same type. The new list is now instead of type <code>[Either a b]</code> where <code>a</code> is the type of values to be put in <code>l1</code>, and <code>b</code> that for <code>l2</code>.</p>\n\n<p>Once you get a <code>[Either a b]</code> you want to split it in <code>[a]</code> and <code>[b]</code>. As @DanielWagner suggests in his answer, you can exploit <code>partitionEithers</code> for this.</p>\n"}], "owner": {"reputation": 25744, "user_id": 2089675, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/sBz5q.jpg?s=128&g=1", "display_name": "smac89", "link": "https://stackoverflow.com/users/2089675/smac89"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 849, "favorite_count": 0, "accepted_answer_id": 29859820, "answer_count": 2, "score": 0, "last_activity_date": 1429973105, "creation_date": 1429923455, "last_edit_date": 1429973105, "question_id": 29859790, "link": "https://stackoverflow.com/questions/29859790/haskell-append-to-a-list-conditionally", "title": "Haskell append to a list conditionally", "body": "<p>I have 2 lists which I am trying to fill will items. While reading from stdin, depending on the value of one of the things read, I want to append to a different list. Example,</p>\n\n<pre><code>import Control.Monad(replicateM)\n\nmain = do\n    n &lt;- getLine\n    let l1 = [], l2 = []\n        in replicateM (read n) (getLine &gt;&gt;= (\\line -&gt;\n            case line of \"Yes\" -&gt;\n                -- do something with line\n                -- and append value of that thing to l1\n                          \"No\" -&gt;\n                -- do something else\n                -- append this value to l2\n            putStrLn line))\n</code></pre>\n\n<p>I realise the above code has syntax errors and such, but hopefully you can see what I am trying to and suggest something.</p>\n\n<p>This is the answer I came up with</p>\n\n<p>While we are at it, can someone explain why this gives me an infinite list:</p>\n\n<pre><code>let g = []\nlet g = 1:g\n-- g now contains an infinite list of 1's\n</code></pre>\n\n<hr>\n\n<p>This is what I finally came up with:</p>\n\n<pre><code>import Control.Monad(replicateM)\nimport Data.Either\n\ngetEither::[String] -&gt; [Either Double Double]\ngetEither [] = []\ngetEither (line:rest) = let [n, h] = words line\n                            fn = read f :: Double\n                            e = case heist of \"Yes\" -&gt; Left fn\n                                              \"No\"  -&gt; Right fn\n                            in e : getEither rest\n\nmain = do\n    n &lt;- getLine\n    lines &lt;- replicateM (read n) getLine\n    let tup = partitionEithers $ getEither lines :: ([Double], [Double])\n    print tup\n</code></pre>\n\n<p>Not sure how <code>fmap</code> could have been used in this instance</p>\n"}, {"tags": ["haskell", "shake-build-system"], "answers": [{"tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": true, "score": 0, "last_activity_date": 1429971970, "creation_date": 1429971970, "answer_id": 29866425, "question_id": 29859218, "link": "https://stackoverflow.com/questions/29859218/how-to-delete-unbuildable-goal/29866425#29866425", "title": "How to delete unbuildable goal?", "body": "<p>Using <a href=\"https://hackage.haskell.org/package/shake-0.15.1/docs/Development-Shake-Util.html#v:shakeArgsPrune\" rel=\"nofollow\"><code>shakeArgsPrune</code></a> you can define a function that gets passed the live files afterwards. You can then write something like:</p>\n\n<pre><code>import Development.Shake\nimport Development.Shake.FilePath\nimport Development.Shake.Util\nimport System.Directory.Extra\nimport Data.List\nimport System.IO\n\npruner :: [FilePath] -&gt; IO ()\npruner live = do\n    present &lt;- listFilesRecursive \"output\"\n    mapM_ removeFile $ map toStandard present \\\\ map toStandard live\n\nmain :: IO ()\nmain = shakeArgsPrune shakeOptions pruner $ do\n    ... rules go here ...\n</code></pre>\n\n<p>This deletes all files in <code>output</code> that are not generated and up-to-date according to the build system as it stands. For a complete example see \n<a href=\"http://neilmitchell.blogspot.co.uk/2015/04/cleaning-stale-files-with-shake.html\" rel=\"nofollow\">http://neilmitchell.blogspot.co.uk/2015/04/cleaning-stale-files-with-shake.html</a>.</p>\n\n<p>The <code>shakeArgsPrune</code> function is only available in shake-0.15.1 and above, but is based on the <code>shakeLiveFiles</code> feature which has been available for longer and can be used directly if you so desire.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 29866425, "answer_count": 1, "score": 1, "last_activity_date": 1430865323, "creation_date": 1429918533, "last_edit_date": 1430865323, "question_id": 29859218, "link": "https://stackoverflow.com/questions/29859218/how-to-delete-unbuildable-goal", "title": "How to delete unbuildable goal?", "body": "<p>I would like to remove files that no longer have source but without cleaning.</p>\n\n<p>Is there support for partially cleaning an incremental build? In this case, I guess I could compare against set of source files that were consumed in previous builds and define how to clean those that are gone.</p>\n\n<pre><code>main = shakeArgs shakeOptions { shakeVerbosity = Diagnostic } $ do\n    want [\".build\"]\n    phony \".build\" $ do\n      files &lt;- getDirectoryFiles \".\" [\"//*.txt\"]\n      let goals = map (-&lt;.&gt; \"\") files\n      need goals\n    \"*\" %&gt; \\out -&gt; do\n      Stdout o &lt;- cmd $ \"sort \" ++ (out ++ \".txt\")\n      writeFile' out o\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "haddock"], "comments": [{"owner": {"reputation": 3611, "user_id": 1029158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YmuXk.jpg?s=128&g=1", "display_name": "DiegoNolan", "link": "https://stackoverflow.com/users/1029158/diegonolan"}, "edited": false, "score": 0, "creation_date": 1429948940, "post_id": 29858285, "comment_id": 47850642, "body": "I&#39;m not completely sure but I think if you change the flag in your <code>~&#47;.cabal&#47;config</code> file for Documentation to True and uncomment it, clean the sandbox and reinstall it should work."}], "answers": [{"tags": [], "owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "is_accepted": false, "score": 1, "last_activity_date": 1430119453, "creation_date": 1430119453, "answer_id": 29889607, "question_id": 29858285, "link": "https://stackoverflow.com/questions/29858285/how-to-get-cabal-sandbox-to-install-correctly-linked-html-documentation/29889607#29889607", "title": "How to get Cabal Sandbox to install correctly linked HTML documentation?", "body": "<p>It's not your fault, this is a <a href=\"https://github.com/haskell/haddock/issues/385\" rel=\"nofollow\">known bug</a> in haddock.\nIt only affects ghc 7.10, so a workaround could be to use ghc 7.8.4 until this is fixed.</p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1430119453, "creation_date": 1429912978, "last_edit_date": 1429922713, "question_id": 29858285, "link": "https://stackoverflow.com/questions/29858285/how-to-get-cabal-sandbox-to-install-correctly-linked-html-documentation", "title": "How to get Cabal Sandbox to install correctly linked HTML documentation?", "body": "<p>I created a cabal library inside a sandbox with the following commands:</p>\n\n<pre><code>cabal sandbox init\ncabal init\n</code></pre>\n\n<p>I added the line <code>documentation: True</code> to <code>cabal.config</code> to make sure that documentation is generated, and I added a dependency to the <code>vector</code> package in <code>mylib.cabal</code>. Then I ran:</p>\n\n<pre><code>cabal install --only-dependencies\n</code></pre>\n\n<p>I got the following output:</p>\n\n<pre><code>/scm/hs-proj/.cabal-sandbox\nConfiguring primitive-0.6...\nBuilding primitive-0.6...\nInstalled primitive-0.6\nConfiguring vector-0.10.12.3...\nBuilding vector-0.10.12.3...\nInstalled vector-0.10.12.3\nUpdating documentation index\n/scm/hs-proj/.cabal-sandbox/share/doc/x86_64-osx-ghc-7.10.1/index.html\n</code></pre>\n\n<p>So far so good.</p>\n\n<p>When I opened the index file it contained links to a lot of packages, like:</p>\n\n<pre><code>file:///scm/hs-proj/.cabal-sandbox/share/doc/x86_64-osx-ghc-7.10.1/Data-List.html\nfile:///scm/hs-proj/.cabal-sandbox/share/doc/x86_64-osx-ghc-7.10.1/Data-Vector.html\n</code></pre>\n\n<p>But of these links pointed to any real files. Note that this is the case for the extra dependencies like <code>vector</code> and also for built-in packages list <code>Data.List</code>. </p>\n\n<p>So I think I've installed the documentation incorrectly. Can someone point out how I've installed the documentation incorrectly and how to do it correctly?</p>\n"}, {"tags": ["haskell", "types", "newtype"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1429912868, "post_id": 29858217, "comment_id": 47842412, "body": "Same answer as <a href=\"http://stackoverflow.com/q/12018959/791604\">stackoverflow.com/q/12018959/791604</a>, though I hesitate to mark this as a duplicate: <code>Poly a</code> is a type, so use it as one. <code>chop :: Poly a -&gt; Poly a</code>. There may be other problems to fix after that."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1429995825, "post_id": 29858409, "comment_id": 47866303, "body": "<code>Eq</code> is no longer a superclass of <code>Num</code>.  If you want it to be equality-comparable to numbers you need <code>(Eq a, Num a) =&gt;</code>"}], "tags": [], "owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "is_accepted": true, "score": 10, "last_activity_date": 1429913970, "last_edit_date": 1429913970, "creation_date": 1429913643, "answer_id": 29858409, "question_id": 29858217, "link": "https://stackoverflow.com/questions/29858217/how-to-define-a-haskell-function-with-an-argument-of-newtype/29858409#29858409", "title": "How to define a Haskell function with an argument of &quot;newtype&quot;?", "body": "<p>In Haskell, the <code>=&gt;</code> character in a type signature denotes a type restriction. This is used in conjunction with Haskell typeclasses in order to abstract away implementation details about functions that can be used at a high level of abstraction.</p>\n\n<p>In your example, <code>Poly a</code> is a completely new type according to the type system, not a typeclass, so your function <code>chop</code> likely is intended to operate on it directly:</p>\n\n<pre><code>chop :: Poly a -&gt; Poly a\nchop (P l) = if (last l) == 0 then chop (P $ init l) else P l\n</code></pre>\n\n<p>But wait, this doesn't compile! The restriction comes from the comparison to 0: <code>(last l) == 0</code>. Here we're implicitly saying that we want the elements of our <code>Poly a</code> to be comparable to zero, or in other words <code>a</code> must be an instance of <code>Num a</code>. After all, you wouldn't be able to chop a polynomial of type <code>Poly (Maybe String)</code>. Our revised type signature is:</p>\n\n<pre><code>chop :: Num a =&gt; Poly a -&gt; Poly a\nchop (P l) = if (last l) == 0 then chop (P $ init l) else P l\n</code></pre>\n\n<p>One thing to take into consideration: because you are using a <code>newtype</code> and not a plain old <code>type</code>, Haskell is treating your <code>Poly a</code> as a completely new type. In order to make it interchangeable with lists, you can use a <em>type synonym</em>:</p>\n\n<pre><code>type Poly a = [a]\n</code></pre>\n\n<p>This will simplify the implementation of chop:</p>\n\n<pre><code>chop :: Num a =&gt; Poly a -&gt; Poly a\nchop l = if (last l) == 0 then chop (init l) else l\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 4830380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cbc9e7697000acd5eb3a067616f72b6?s=128&d=identicon&r=PG&f=1", "display_name": "dman", "link": "https://stackoverflow.com/users/4830380/dman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 658, "favorite_count": 0, "accepted_answer_id": 29858409, "answer_count": 1, "score": 4, "last_activity_date": 1429950078, "creation_date": 1429912696, "last_edit_date": 1429915759, "question_id": 29858217, "link": "https://stackoverflow.com/questions/29858217/how-to-define-a-haskell-function-with-an-argument-of-newtype", "title": "How to define a Haskell function with an argument of &quot;newtype&quot;?", "body": "<p>I've defined a newtype called Poly. Poly is a list representation of a polynomial (a list of Num's), and I'm trying to define a function \"chop\" that takes off excess 0's from the end of a Poly. </p>\n\n<p>Chop takes one Poly as an argument, and then returns a Poly. For some reason I'm getting the following error message: </p>\n\n<blockquote>\n  <p>Expected a constraint, but \u2018Poly a\u2019 has kind \u2018*\u2019\n      In the type signature for \u2018chop\u2019: chop :: Poly a => a -> a</p>\n</blockquote>\n\n<pre><code>newtype Poly a = P [a]\n\nchop :: Poly a =&gt; a -&gt; a\nchop l = if (last l) == 0 then chop (init l) else l\n</code></pre>\n"}, {"tags": ["haskell", "polymorphism", "type-families"], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 12, "last_activity_date": 1429906073, "creation_date": 1429906073, "answer_id": 29856547, "question_id": 29856315, "link": "https://stackoverflow.com/questions/29856315/type-family-polymorphism/29856547#29856547", "title": "Type Family Polymorphism", "body": "<blockquote>\n  <p>So I have a function <code>apply :: proxy tf -&gt; tf Int -&gt; tf Int</code> which takes a Proxy intended to carry a type family</p>\n</blockquote>\n\n<p>You can't do this. Type families must always be fully applied, like the type synonyms of which they are a generalization. A type variable can never be instantiated to a under-saturated type family.</p>\n\n<p>It's a bug in GHC 7.8.3 that it did not already reject your program starting at</p>\n\n<pre><code>f :: Proxy F\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 4826340, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26492b59a83616126a6b4e14080ece9e?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Vladimiroff", "link": "https://stackoverflow.com/users/4826340/nick-vladimiroff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "accepted_answer_id": 29856547, "answer_count": 1, "score": 8, "last_activity_date": 1429906073, "creation_date": 1429905226, "question_id": 29856315, "link": "https://stackoverflow.com/questions/29856315/type-family-polymorphism", "title": "Type Family Polymorphism", "body": "<p>So I have a function <code>apply :: proxy tf -&gt; tf Int -&gt; tf Int</code> which takes a Proxy intended to carry a type family and applies Int to that type family to determine the type of the second argument and return value.\nHowever, I'm getting some confusing responses from GHC.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nimport Data.Proxy\n\ntype family F (a :: *) :: * where\n    F Int = ()\n\nf :: Proxy F\nf = Proxy\n\napply :: proxy tf -&gt; tf Int -&gt; tf Int\napply _ x = x\n\n-- Doesn't typecheck.\ntest1 :: ()\ntest1 = apply f ()\n\n-- Typechecks fine\ntest2 :: ()\ntest2 = let g = apply f in g ()\n</code></pre>\n\n<p><code>test1</code> refuses to compile with GHC spitting out this error:</p>\n\n<pre><code>tftest.hs:16:9:\n    Couldn't match expected type \u2018()\u2019 with actual type \u2018F Int\u2019\n    In the expression: apply f ()\n    In an equation for \u2018test1\u2019: test1 = apply f ()\n\ntftest.hs:16:17:\n    Couldn't match expected type \u2018F Int\u2019 with actual type \u2018()\u2019\n    In the second argument of \u2018apply\u2019, namely \u2018()\u2019\n    In the expression: apply f ()\n</code></pre>\n\n<p>Confusingly, commenting out <code>test1</code> and using a let binding in <code>test2</code> makes GHC happy and everything compiles fine. Can anyone explain what's going on here?</p>\n"}, {"tags": ["haskell", "vim", "indentation", "tabular", "vim-tabular"], "answers": [{"comments": [{"owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "edited": false, "score": 0, "creation_date": 1429908967, "post_id": 29855855, "comment_id": 47840464, "body": "Brilliant solution! Thanks."}, {"owner": {"reputation": 39152, "user_id": 438329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4b5b093781b8d97da6b9c21cf2706d7?s=128&d=identicon&r=PG", "display_name": "Peter Rincker", "link": "https://stackoverflow.com/users/438329/peter-rincker"}, "edited": false, "score": 1, "creation_date": 1429911823, "post_id": 29855855, "comment_id": 47841953, "body": "You can also use <code>\\u</code> instead the character class. Also if you want to have the aliases line up you can do something like this: <code>:Tabularize&#47;\\u\\S\\+&#47;</code>"}], "tags": [], "owner": {"reputation": 28343, "user_id": 1890567, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NSohE.png?s=128&g=1", "display_name": "FDinoff", "link": "https://stackoverflow.com/users/1890567/fdinoff"}, "is_accepted": true, "score": 2, "last_activity_date": 1429903561, "creation_date": 1429903561, "answer_id": 29855855, "question_id": 29855496, "link": "https://stackoverflow.com/questions/29855496/align-haskell-import-statements-in-vim-using-tabular-plugin/29855855#29855855", "title": "Align Haskell import statements in Vim using Tabular plugin?", "body": "<p>Assuming you want to just align the first uppercase character so that they are on top of each other, this appears to work on your test case</p>\n\n<pre><code>:%Tabularize /\\C[A-Z].*/\n</code></pre>\n\n<p>The <code>\\C</code> forces case sensitive comparison. </p>\n"}, {"tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 1, "last_activity_date": 1429907035, "creation_date": 1429907035, "answer_id": 29856821, "question_id": 29855496, "link": "https://stackoverflow.com/questions/29855496/align-haskell-import-statements-in-vim-using-tabular-plugin/29856821#29856821", "title": "Align Haskell import statements in Vim using Tabular plugin?", "body": "<p>You don't necessarily need a plugin for this; You could just run <a href=\"https://github.com/jaspervdj/stylish-haskell\" rel=\"nofollow\">stylish-haskell</a> - or a similar code formatter, if there is one by now - on your source.</p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 29855855, "answer_count": 2, "score": 1, "last_activity_date": 1429907035, "creation_date": 1429902215, "question_id": 29855496, "link": "https://stackoverflow.com/questions/29855496/align-haskell-import-statements-in-vim-using-tabular-plugin", "title": "Align Haskell import statements in Vim using Tabular plugin?", "body": "<p>I'd like to format Haskell import statements into style I usually see in published source code. </p>\n\n<p>From this:</p>\n\n<pre><code>import Data.Map\nimport qualified Data.Vector as V\n</code></pre>\n\n<p>To this:</p>\n\n<pre><code>import           Data.Map\nimport qualified Data.Vector as V\n</code></pre>\n\n<p>I'd like to not have to install any plugins that specialize in just doing this. Just <a href=\"https://github.com/godlygeek/tabular\" rel=\"nofollow\">Tabular</a>. Could someone help me with the regexp needed to make this happen?</p>\n"}, {"tags": ["haskell", "compiler-construction"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1429916435, "post_id": 29854658, "comment_id": 47843619, "body": "It&#39;s a nice and readable description of your current thinking. What&#39;s the question you want answered?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1429958613, "post_id": 29854658, "comment_id": 47853386, "body": "It seems to me that your confusion stems from the fact that you&#39;re treating addition as a special case. I&#39;d be inclined to parse <i>infix operators in general</i> into some &quot;infix function call&quot; AST element, and use some other (more explicit, and syntax-directed) mechanism to denote whether a function should be inlined. I&#39;m not a compiler guy so take my thoughts with a pinch of salt ;)"}, {"owner": {"reputation": 1746, "user_id": 1083697, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/38016b5caf736ce69755c8abcf2d2cdf?s=128&d=identicon&r=PG", "display_name": "andrybak", "link": "https://stackoverflow.com/users/1083697/andrybak"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1429959740, "post_id": 29854658, "comment_id": 47853709, "body": "@BenjaminHodgson With those changes to the AST, how the operation precedence and associativity are handled?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1429971366, "post_id": 29854658, "comment_id": 47857441, "body": "@andrybak Isn&#39;t precedence/associativity fundamentally a <i>parsing</i> concern? The parser effectively inserts parentheses for you according to what it knows about operator precedence, but <i>the resulting AST is the same</i> as if you&#39;d written the parentheses yourself. (Again, not an expert, someone will probably come and tell me everything I&#39;ve said is wrong)"}], "answers": [{"comments": [{"owner": {"reputation": 1746, "user_id": 1083697, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/38016b5caf736ce69755c8abcf2d2cdf?s=128&d=identicon&r=PG", "display_name": "andrybak", "link": "https://stackoverflow.com/users/1083697/andrybak"}, "edited": false, "score": 0, "creation_date": 1429903608, "post_id": 29854894, "comment_id": 47837606, "body": "This would mean that llvm code of every program that uses binary operators will contain several <code>alwaysinline</code> functions, which are usually (I assume) inlined on the previous step of compilation."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1429900029, "creation_date": 1429900029, "answer_id": 29854894, "question_id": 29854658, "link": "https://stackoverflow.com/questions/29854658/type-checking-of-infix-operators-in-compiler/29854894#29854894", "title": "Type checking of infix operators in compiler", "body": "<p>LLVM supports <a href=\"http://llvm.org/docs/LangRef.html#function-attributes\" rel=\"nofollow\">inline attributes</a> e.g.</p>\n\n<pre><code>define void @f() alwaysinline { ... }\n</code></pre>\n\n<p>so one option is to treat <code>+</code> as a normal function call and let LLVM do its optimization job.</p>\n"}], "owner": {"reputation": 1746, "user_id": 1083697, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/38016b5caf736ce69755c8abcf2d2cdf?s=128&d=identicon&r=PG", "display_name": "andrybak", "link": "https://stackoverflow.com/users/1083697/andrybak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1429982965, "creation_date": 1429899243, "last_edit_date": 1429982965, "question_id": 29854658, "link": "https://stackoverflow.com/questions/29854658/type-checking-of-infix-operators-in-compiler", "title": "Type checking of infix operators in compiler", "body": "<p>I'm writing a compiler (in Haskell) and in the grammar of the language there are rules to add infix operators (addition is used as an example):</p>\n\n<pre><code>EAdd . Expr ::= Expr \"+\" Expr\n</code></pre>\n\n<p>which means <code>EAdd</code> is an expression, it's consist of expression, string <code>\"+\"</code> and another expression.</p>\n\n<p>Parser returns abstract syntax tree (AST):</p>\n\n<pre><code>data Expr = ... | EAdd Expr Expr\n</code></pre>\n\n<p>I want to make a typechecker if checks that calls of the functions are given arguments of correct types.</p>\n\n<p>Note, that \"+\" is a function that takes two integers and returns an integer. Other operators are similar.</p>\n\n<p>At the moment I came up with three approaches to typechecking <code>EAdd</code>, all of them include adding \"+\" as a function to the initial symbol table:</p>\n\n<ol>\n<li><p>Declare that infix plus is syntax sugar for calling function \"+\" with two arguments. Put \"desugarizer\" which converts AST from parser into <em>another</em> data type (without <code>EAdd</code>) in between parser and typechecker.</p></li>\n<li><p>(similar to the first) Declare that infix plus is syntax sugar, but desugarizer uses same AST data type. Typechecker returns an error when it's given <code>EAdd</code>.</p></li>\n<li><p>Inline \"desugarizer\" into typechecker. Similar to this:</p>\n\n<pre><code>...\ntypecheck (EAdd a b) = typecheck (ECall infixPlus [a, b])\n...\n</code></pre></li>\n</ol>\n\n<p>Note, that all binary infix operators are subject to this (other arithmetic, boolean operations, comparison operators).</p>\n\n<p>It seems that first approach is the correct one. But it means that later in the compiler pipeline, particularly in the <em>code generator</em>,  those <code>ECalls</code> should be handled as special cases, because in the compilers output (in my case \u2014 llvm) these functions  are supposed to be inlined (unlike usual function calls).\nIt means that codegen has a list of functions whose calls are be handled differently from other function calls.</p>\n\n<p>What is the best approach to this issue?</p>\n\n<p><strong>UPD</strong></p>\n\n<p>How this similar issue is handled in Haskell (from <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/Renamer\" rel=\"nofollow\">https://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/Renamer</a>):</p>\n\n<blockquote>\n  <p>... renamer does the following things:</p>\n  \n  <ul>\n  <li>Sort out fixities. The parser parses all infix applications as left-associative, regardless of fixity. For example \"a + b * c\" is parsed as \"(a + b) * c\". The renamer re-associates such nested operator applications, using the fixities declared in the module. </li>\n  </ul>\n</blockquote>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429890429, "post_id": 29851871, "comment_id": 47829742, "body": "nope it&#39;s not common - but very common for beginners. Indeed the easiest way for beginners is IMHO to setup a clean environment and use sandboxes. There is <a href=\"http://www.stackage.org/install\" rel=\"nofollow noreferrer\">a nice tutorial on how to do it here</a> (you don&#39;t have to use the stackage parts if you don&#39;t want to - if you have GHC 7.10.1 you actually cannot AFAIK) - btw: did you use cabal-1.22 on purpose (i.e. with GHC 7.10.1?) because using Haskell plattform I would not right now)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429890654, "post_id": 29851871, "comment_id": 47829891, "body": "btw: just curious - how does maven handle the situation where Package X depends on A-Vers1 and Y on a-Vers2 (not compatible) and you want to use both X and Y?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429890831, "post_id": 29851871, "comment_id": 47830020, "body": "Inside <code>M2_HOME</code> repository, maven will create two folders like <code>A&#47;1.0.0&#47;*</code> and <code>A&#47;2.0.0&#47;*</code>. Since the global repository uses seperate folders based on versions, different versions of same <code>archetype&#47;jar</code> can sit inside your system in one place."}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 1, "creation_date": 1429891375, "post_id": 29851871, "comment_id": 47830374, "body": "@MadhavanKumar That&#39;s nice for the packages for just sitting there, but what if I want to actually use those libraries? Java doesn&#39;t allow you to load multiple classes of the same name into the VM at the same time, or when you can make it do that, you will get really weird exceptions when you use them."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 1, "creation_date": 1429891442, "post_id": 29851871, "comment_id": 47830418, "body": "@SebastianRedl exactly - the problem is still there you just get at it a bit later"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1429893576, "post_id": 29851871, "comment_id": 47831732, "body": "As for your first error, what does <code>ghc-pkg list Cabal</code> say? I hope you didn&#39;t remove libraries from <code>&#47;opt&#47;ghc&#47;7.8.4&#47;lib&#47;ghc-7.8.4</code>!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1429895288, "post_id": 29851871, "comment_id": 47832751, "body": "@ReidBarton, for God&#39;s sake don&#39;t even ask someone to remove lib files in /opt/ghc/7.8.4/lib. cabal marks package constraints for ghc&#39;s packages as <code>installed</code> in <code>.config</code> file. And you touch those libraries, all those <code>cabal install</code> will sincerely fail...."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429898539, "post_id": 29851871, "comment_id": 47834751, "body": "@CarstenK&#246;nig It will print out a warning, and IIRC use the version that appeared the earliest in the POM. Gradle allows you to handle this explicitly (by making one package have its dependencies override that of others, or by disabling transitive dependencies for specific packages etc), which is nice."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1429903094, "post_id": 29851871, "comment_id": 47837316, "body": "I didn&#39;t suggest that anyone should remove those libraries. But what you wrote could be interpreted as saying that you did so. In any case something seems to have been broken with your setup when you built cabal-db the first time, since you should have had Cabal installed already but apparently Cabal built itself again for some reason and then complained that it could not find Cabal."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1429913738, "post_id": 29851871, "comment_id": 47842754, "body": "@ReidBarton, thanks Reid. I removed the line about /opt/ghc/7.8.4/lib. thanks. i have cabal 1.22.0 in my system but the error still says <code>&#39;ansi-terminal&#39; requires Cabal library version -any &amp;&amp; &gt;=1.6 but no suitable version is installed</code>.. i am not sure, how this error arose since i am already using the latest version of cabal"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1429914171, "post_id": 29851871, "comment_id": 47842889, "body": "@ReidBarton, thanks Reid. I removed the line about /opt/ghc/7.8.4/lib. thanks. i have cabal 1.22.0 in my system but the error still says <code>&#39;ansi-terminal&#39; requires Cabal library version -any &amp;&amp; &gt;=1.6 but no suitable version is installed</code>.. i see this line, <code>Cabal-Version:       &gt;= 1.6</code> inside <code>ansi-terminal.cabal</code> but i am already using the latest cabal in my system."}], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1429892633, "post_id": 29852398, "comment_id": 47831130, "body": "Not only does the OP have a more recent version of process installed, but ghc-pkg-autofix also depends on Cabal, and the OP&#39;s version of Cabal requires a more recent version of process than the one ghc-pkg-autofix (supposedly) requires, so this is a real diamond dependency problem."}], "tags": [], "owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "is_accepted": false, "score": 5, "last_activity_date": 1429891748, "creation_date": 1429891748, "answer_id": 29852398, "question_id": 29851871, "link": "https://stackoverflow.com/questions/29851871/dependency-hell-in-cabal-it-is-really-a-hell/29852398#29852398", "title": "Dependency hell in cabal. It is really a hell", "body": "<p>\"And for sandbox where there are absolutely no external dependencies\" this is not true. A sandbox still has dependencies on the global package database. Things like Cabal, GHC, process are typically installed in the global package database. Here you want to install ghc-pkg-autofix which requires process 1.0, but you have a more recent version of process already installed. Are you sure you need ghc-pkg-autofix, it seems to be quite old.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1630, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1575006123, "creation_date": 1429890221, "last_edit_date": 1429913624, "question_id": 29851871, "link": "https://stackoverflow.com/questions/29851871/dependency-hell-in-cabal-it-is-really-a-hell", "title": "Dependency hell in cabal. It is really a hell", "body": "<p>Different programming languages use different packaging systems. </p>\n\n<p>In their varied approach, Java's <code>Maven</code> looks like the best bet for me since it maintains different version of jar files in seperately versioned folders and hence, there is no way one will end up in conflicting versions of a library. </p>\n\n<p>Next comes python. Python's <code>pip</code> puts its packages into <code>/usr/local/lib/python/dist-packages/site-packages</code>. When there is a version conflict, one can use its <code>virtualenv</code> and live with it.</p>\n\n<p>Nodejs supports installing packages both in local folders and global folders. Till date for me, i never had a dependency conflict in the global libraries.</p>\n\n<p>Then I got fascinated by the haskell's style and started using <code>cabal</code>. First, i was installing my libraries inside <code>/home/user1/.cabal</code>. Then when the package system broke, one friend suggested me to remove two folders - <code>/home/user1/.cabal &amp;&amp; /home/user1/.ghc</code>. Now, my first confusion arose, why does cabal's library files sit in two folders <code>.cabal &amp;&amp; .ghc</code>. I cleaned the library folders, <code>~/.ghc and ~/.cabal</code> and did <code>cabal install</code> from a package source for <code>cabal-db-0.1.12</code>.  Now, there was a new error and i was surprised, because i had sanitized all local repositories. The error was, </p>\n\n<pre><code>Configuring Cabal-1.22.2.0...\nBuilding Cabal-1.22.2.0...\nInstalled Cabal-1.22.2.0\ncabal: Error: some packages failed to install:\nansi-terminal-0.6.2.1 failed during the configure step. The exception was:\nuser error (The package 'ansi-terminal' requires Cabal library version -any &amp;&amp;\n&gt;=1.6 but no suitable version is installed.)\n</code></pre>\n\n<p>Then I tried the safest bet - <code>sandbox</code> for <code>cabal-db</code>. It worked. Then i repeated sandboxing for another pacakge, ghc-pkg-autofix. I did,</p>\n\n<pre><code>cd ghc-pkg-autofix-0.2.0.1\ncabal sandbox init\ncabal install\n</code></pre>\n\n<p>And for sandbox where there are absolutely no external dependencies,  there are errors again,</p>\n\n<pre><code>cabal: Could not resolve dependencies:\ntrying: ghc-pkg-autofix-0.2.0.1 (user goal)\ntrying: Cabal-1.22.2.0 (dependency of ghc-pkg-autofix-0.2.0.1)\nnext goal: process (dependency of ghc-pkg-autofix-0.2.0.1)\nrejecting: process-1.2.0.0/installed-06c..., 1.2.3.0, 1.2.2.0, 1.2.1.0,\n1.2.0.0, 1.1.0.2, 1.1.0.1, 1.1.0.0 (conflict: ghc-pkg-autofix =&gt; process&gt;=1.0\n&amp;&amp; &lt;1.1)\nrejecting: process-1.0.1.5, 1.0.1.4, 1.0.1.3, 1.0.1.2, 1.0.1.1, 1.0.0.0\n(conflict: Cabal =&gt; process&gt;=1.1.0.1 &amp;&amp; &lt;1.3)\nDependency tree exhaustively searched.\n\nNote: when using a sandbox, all packages are required to have consistent\ndependencies. Try reinstalling/unregistering the offending packages or\nrecreating the sandbox.\n</code></pre>\n\n<p>Am i doing something wrong (or) this kind of dependency conflicts are quite common in cabal? I see, managing dependencies in other languages are a lot simpler.</p>\n\n<p>Note: I use <code>cabal-install version 1.22.0.0</code> &amp;&amp; <code>The Glorious Glasgow Haskell Compilation System, version 7.8.4</code></p>\n"}, {"tags": ["haskell", "conditional-operator"], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1429886307, "post_id": 29850321, "comment_id": 47826661, "body": "Sure, but note that <code>if</code>-<code>then</code>-<code>else</code> is a built-in construct of the language, not an operator. For instance, it doesn&#39;t make sense to ask for the type of <code>if</code>."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1429887079, "post_id": 29850321, "comment_id": 47827265, "body": "Yes, but... user defined functions... <code>ifelse p a b = if p then a else b</code>.  Or tupling as in R <code>ifelse (p,a,b) = if p then a else b</code>."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1429888321, "post_id": 29850321, "comment_id": 47828252, "body": "@Jubobs <code>?:</code> in C++ is a built-in construct of the language, too."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1429889497, "post_id": 29850321, "comment_id": 47829075, "body": "The fact that <code>if</code> is lazy in Haskell is not peculiar at all: <code>if</code> is lazy in virtually any language. That is, there is practically no language where <code>if True then something else someLongComputation</code> causes the long computation to be evaluated."}, {"owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1429889889, "post_id": 29850321, "comment_id": 47829348, "body": "@chi Oops, I meant to talk about <code>bool</code>. Thanks for pointing this."}], "tags": [], "owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "is_accepted": true, "score": 27, "last_activity_date": 1429889862, "last_edit_date": 1429889862, "creation_date": 1429886226, "answer_id": 29850321, "question_id": 29850240, "link": "https://stackoverflow.com/questions/29850240/does-haskell-have-a-conditional-operator-such-as-x-y-a-b-in-c-or-ifel/29850321#29850321", "title": "Does haskell have a conditional operator such as &quot;x == y ? a : b&quot; in C++ or ifelse(x==y, a, b) in R?", "body": "<p>Haskell's <code>if</code> performs exactly as you want.</p>\n\n<pre><code>if x == y then a else b\n</code></pre>\n\n<hr>\n\n<p>As Lee mentioned, there is a <code>bool</code> function in <code>Data.Bool</code> that does the same thing. Also, thanks to Haskell's lazyness, <code>bool someLongComputation something True</code> does not run the long computation..</p>\n"}, {"comments": [{"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "edited": false, "score": 1, "creation_date": 1429886523, "post_id": 29850405, "comment_id": 47826829, "body": "is there a reason to use this vs &quot;if then else&quot; besides terseness? is there any performance difference or difference in corner cases?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "edited": false, "score": 0, "creation_date": 1429886664, "post_id": 29850405, "comment_id": 47826925, "body": "@daj Based on <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/src/Data-Bool.html#bool\" rel=\"nofollow noreferrer\">its definition</a>, <code>bool</code> shouldn&#39;t be associated with any prohibitive overhead."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "edited": false, "score": 9, "creation_date": 1429887086, "post_id": 29850405, "comment_id": 47827270, "body": "@daj: The only reason to use <code>bool</code> would be to pass an under-applied form to a higher-order function, like <code>map (bool b a) xs</code>."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 14, "last_activity_date": 1429886778, "last_edit_date": 1429886778, "creation_date": 1429886419, "answer_id": 29850405, "question_id": 29850240, "link": "https://stackoverflow.com/questions/29850240/does-haskell-have-a-conditional-operator-such-as-x-y-a-b-in-c-or-ifel/29850405#29850405", "title": "Does haskell have a conditional operator such as &quot;x == y ? a : b&quot; in C++ or ifelse(x==y, a, b) in R?", "body": "<p>There is the <code>bool</code> function in <code>Data.Bool</code>:</p>\n\n<pre><code>import Data.Bool\nbool b a (x == y)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1429889463, "post_id": 29850505, "comment_id": 47829050, "body": "I like this definition of <code>?</code>, <code>c ? (t,e) = if c then t else e</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1429889589, "post_id": 29850505, "comment_id": 47829151, "body": "Nice abuse of <code>$</code> and precedence."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 17, "last_activity_date": 1429886692, "creation_date": 1429886692, "answer_id": 29850505, "question_id": 29850240, "link": "https://stackoverflow.com/questions/29850240/does-haskell-have-a-conditional-operator-such-as-x-y-a-b-in-c-or-ifel/29850505#29850505", "title": "Does haskell have a conditional operator such as &quot;x == y ? a : b&quot; in C++ or ifelse(x==y, a, b) in R?", "body": "<p>Apart from <code>if</code> or <code>Data.Bool.bool</code>, which do indeed just what you want, you can also define such an operator yourself in Haskell!</p>\n\n<pre><code>infixr 1 ?\n(?) :: Bool -&gt; a -&gt; a -&gt; a\n(True ? a) _ = a\n(False ? _) b = b\n</code></pre>\n\n\n\n<blockquote>\n  <p>GHCi> 3==2 ? \"equal\" $ \"nonequal\"<br>\n             \"nonequal\"<br>GHCi> 3==3 ? \"equal\" $ \"nonequal\"<br>\"equal\"</p>\n</blockquote>\n"}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4315, "favorite_count": 0, "accepted_answer_id": 29850321, "answer_count": 3, "score": 10, "last_activity_date": 1429889862, "creation_date": 1429886028, "question_id": 29850240, "link": "https://stackoverflow.com/questions/29850240/does-haskell-have-a-conditional-operator-such-as-x-y-a-b-in-c-or-ifel", "title": "Does haskell have a conditional operator such as &quot;x == y ? a : b&quot; in C++ or ifelse(x==y, a, b) in R?", "body": "<p>Does haskell have a conditional operator that performs as</p>\n\n<pre><code>x == y ? a : b\n</code></pre>\n\n<p>in C++ or</p>\n\n<pre><code>ifelse(x==y, a, b)\n</code></pre>\n\n<p>in R ?</p>\n"}, {"tags": ["regex", "haskell"], "comments": [{"owner": {"reputation": 982, "user_id": 2135043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83d3466bbc8f604f37ae6a2891c9e8c3?s=128&d=identicon&r=PG", "display_name": "Gabriel Ciubotaru", "link": "https://stackoverflow.com/users/2135043/gabriel-ciubotaru"}, "edited": false, "score": 0, "creation_date": 1429884942, "post_id": 29848981, "comment_id": 47825639, "body": "1st solved. thanks Brian Stephens :D"}], "answers": [{"comments": [{"owner": {"reputation": 982, "user_id": 2135043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83d3466bbc8f604f37ae6a2891c9e8c3?s=128&d=identicon&r=PG", "display_name": "Gabriel Ciubotaru", "link": "https://stackoverflow.com/users/2135043/gabriel-ciubotaru"}, "edited": false, "score": 0, "creation_date": 1429884616, "post_id": 29849561, "comment_id": 47825404, "body": "I need to capture from this &quot;6000      60B  109743043 0008 27 FB D9 59 50 56 6C 8A &quot; and my full regex is &quot;^([0-9A-Fa-f]+)\\\\ +([0-9A-Fa-f]+)\\\\ +([0-9]+)\\\\ +([0-9A-Fa-f]+)(\\\\ ([0-9A-Fa-f]{2}))&quot;. I can use a workaround to capture the last part and then make another regex for extract the bytes, but want to know if it&#39;s possible, not a workaround"}, {"owner": {"reputation": 4842, "user_id": 2257675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WjuUd.jpg?s=128&g=1", "display_name": "Brian Stephens", "link": "https://stackoverflow.com/users/2257675/brian-stephens"}, "reply_to_user": {"reputation": 982, "user_id": 2135043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83d3466bbc8f604f37ae6a2891c9e8c3?s=128&d=identicon&r=PG", "display_name": "Gabriel Ciubotaru", "link": "https://stackoverflow.com/users/2135043/gabriel-ciubotaru"}, "edited": false, "score": 0, "creation_date": 1429885550, "post_id": 29849561, "comment_id": 47826094, "body": "@GabrielCiubotaru, You could use your full regex for a first pass: <code>^([\\dA-F]+) +([\\dA-F]+) +(\\d+) +([\\dA-F]+)(( [\\dA-F]{2})+)</code>, then use the regex I gave in my answer to break down the ` 27 FB D9 59 50 56 6C 8A` that was captured in the last group. If this solves your problem, don&#39;t forget to mark it as the &quot;accepted answer&quot;. Thanks!"}, {"owner": {"reputation": 982, "user_id": 2135043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83d3466bbc8f604f37ae6a2891c9e8c3?s=128&d=identicon&r=PG", "display_name": "Gabriel Ciubotaru", "link": "https://stackoverflow.com/users/2135043/gabriel-ciubotaru"}, "edited": false, "score": 0, "creation_date": 1429887684, "post_id": 29849561, "comment_id": 47827804, "body": "This solve my first problem, but still, how can i make non capute grouping in haskell ? And btw, \\d is not working in haskell."}, {"owner": {"reputation": 4842, "user_id": 2257675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WjuUd.jpg?s=128&g=1", "display_name": "Brian Stephens", "link": "https://stackoverflow.com/users/2257675/brian-stephens"}, "reply_to_user": {"reputation": 982, "user_id": 2135043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83d3466bbc8f604f37ae6a2891c9e8c3?s=128&d=identicon&r=PG", "display_name": "Gabriel Ciubotaru", "link": "https://stackoverflow.com/users/2135043/gabriel-ciubotaru"}, "edited": false, "score": 0, "creation_date": 1429888836, "post_id": 29849561, "comment_id": 47828618, "body": "@GabrielCiubotaru: I don&#39;t know if that&#39;s available in the library you&#39;re using, but you shouldn&#39;t need it to use my solution. On the first pass, just ignore the last match, which will contain the last byte."}, {"owner": {"reputation": 4842, "user_id": 2257675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WjuUd.jpg?s=128&g=1", "display_name": "Brian Stephens", "link": "https://stackoverflow.com/users/2257675/brian-stephens"}, "reply_to_user": {"reputation": 982, "user_id": 2135043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83d3466bbc8f604f37ae6a2891c9e8c3?s=128&d=identicon&r=PG", "display_name": "Gabriel Ciubotaru", "link": "https://stackoverflow.com/users/2135043/gabriel-ciubotaru"}, "edited": false, "score": 0, "creation_date": 1429889906, "post_id": 29849561, "comment_id": 47829364, "body": "@GabrielCiubotaru: I updated my answer to lay out all the steps."}, {"owner": {"reputation": 982, "user_id": 2135043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83d3466bbc8f604f37ae6a2891c9e8c3?s=128&d=identicon&r=PG", "display_name": "Gabriel Ciubotaru", "link": "https://stackoverflow.com/users/2135043/gabriel-ciubotaru"}, "edited": false, "score": 0, "creation_date": 1429946695, "post_id": 29849561, "comment_id": 47850009, "body": "This is exactly the workaround i made (but i use for second one split, no reason to use regex again). Seems like noone know how to make non capturing group like this:^([\\dA-F]+) +([\\dA-F]+) +(\\d+) +([\\dA-F]+)((?: [\\dA-F]{2})+)."}], "tags": [], "owner": {"reputation": 4842, "user_id": 2257675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WjuUd.jpg?s=128&g=1", "display_name": "Brian Stephens", "link": "https://stackoverflow.com/users/2257675/brian-stephens"}, "is_accepted": true, "score": 2, "last_activity_date": 1429889878, "last_edit_date": 1429889878, "creation_date": 1429884218, "answer_id": 29849561, "question_id": 29848981, "link": "https://stackoverflow.com/questions/29848981/haskell-regex-non-capture-group/29849561#29849561", "title": "Haskell Regex non capture group", "body": "<p>When you attach a multiplier to a capture group, the engine returns only the last match. See <a href=\"http://rexegg.com/regex-capture.html#groupnumbers\" rel=\"nofollow noreferrer\">rexegg.com/regex-capture.html#groupnumbers</a> for a good explanation.</p>\n\n<p>On the first pass, use this regex, similar to what you were already using (using a case-insensitive option):</p>\n\n<p><code>^([\\dA-F]+) +([\\dA-F]+) +(\\d+) +([\\dA-F]+)(( [\\dA-F]{2})+)</code></p>\n\n<p>You'll get the following matching groups:</p>\n\n<p><img src=\"https://i.stack.imgur.com/AX4Sx.png\" alt=\"enter image description here\"></p>\n\n<p>Use the 5th one as the target of a second pass, to extract each individual byte (using a \"global\" option):</p>\n\n<p><code>([0-9A-Fa-f]{2})</code></p>\n\n<p>Then each match will be returned separately.</p>\n\n<p><strong>Note:</strong> you don't need to escape the spaces, as you had in your original regex.</p>\n"}], "owner": {"reputation": 982, "user_id": 2135043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83d3466bbc8f604f37ae6a2891c9e8c3?s=128&d=identicon&r=PG", "display_name": "Gabriel Ciubotaru", "link": "https://stackoverflow.com/users/2135043/gabriel-ciubotaru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 1, "accepted_answer_id": 29849561, "answer_count": 1, "score": 3, "last_activity_date": 1429889878, "creation_date": 1429882612, "question_id": 29848981, "link": "https://stackoverflow.com/questions/29848981/haskell-regex-non-capture-group", "title": "Haskell Regex non capture group", "body": "<p>I'm using Text.Regex.TDFA on Lazy ByteString for extract some infomation from a file.</p>\n\n<p>I have to extract each byte from this string:</p>\n\n<pre><code> 27 FB D9 59 50 56 6C 8A\n</code></pre>\n\n<p>Here is what i've tried (my string begins with space):</p>\n\n<pre><code>(\\\\ ([0-9A-Fa-f]{2}))+\n</code></pre>\n\n<p>but i have 2 problems:</p>\n\n<ul>\n<li>Only last match is returned [[\" 27 FB D9 59 50 56 6C 8A\",\" 8A\",\"8A\"]]</li>\n<li>I want to make the outer group non caputing one (like ?: in other engines)</li>\n</ul>\n\n<p>Here is my minimal code:</p>\n\n<pre><code>import System.IO ()\nimport Data.ByteString.Lazy.Char8 as L\nimport Text.Regex.TDFA\n\n\nmain::IO()\nmain = do\n    let input = L.pack \" 27 FB D9 59 50 56 6C 8A\"\n    let entries = input =~ \"(\\\\ ([0-9A-Fa-f]{2}))+\" :: [[L.ByteString]]\n    print  entries\n</code></pre>\n"}, {"tags": ["xml", "haskell", "hxt"], "answers": [{"tags": [], "owner": {"reputation": 65, "user_id": 1434646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb9f7ce7a0768f8dabb66eb7764a678?s=128&d=identicon&r=PG", "display_name": "malpka", "link": "https://stackoverflow.com/users/1434646/malpka"}, "is_accepted": false, "score": 0, "last_activity_date": 1429883935, "last_edit_date": 1495541662, "creation_date": 1429883935, "answer_id": 29849466, "question_id": 29848629, "link": "https://stackoverflow.com/questions/29848629/how-to-extract-a-specific-branch-of-a-xml-tree-in-hxt/29849466#29849466", "title": "How to extract a specific branch of a XML tree in HXT", "body": "<p>Try using <a href=\"https://hackage.haskell.org/package/hxt-xpath\" rel=\"nofollow noreferrer\" title=\"Haskell xpath\">Haskell XPath</a> and:</p>\n\n<pre><code>/*/pou[body[SFC]]\n</code></pre>\n\n<p>Further reference <a href=\"https://stackoverflow.com/questions/10881179/xpath-find-all-elements-with-specific-child-node\" title=\"XPath find all elements with specific child node\">\"XPath find all elements with specific child node\"</a></p>\n"}, {"comments": [{"owner": {"reputation": 135, "user_id": 3135456, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000722165744/picture?type=large", "display_name": "Yoanribeiro", "link": "https://stackoverflow.com/users/3135456/yoanribeiro"}, "edited": false, "score": 0, "creation_date": 1430044746, "post_id": 29850138, "comment_id": 47877381, "body": "I adapted your idea in my code and it has done the trick. Thank you very much!! :)"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 1, "last_activity_date": 1429890765, "last_edit_date": 1429890765, "creation_date": 1429885761, "answer_id": 29850138, "question_id": 29848629, "link": "https://stackoverflow.com/questions/29848629/how-to-extract-a-specific-branch-of-a-xml-tree-in-hxt/29850138#29850138", "title": "How to extract a specific branch of a XML tree in HXT", "body": "<p>You want to use <code>filterA</code> for this example</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>application\n    = processChildren\n    $ getChildren                    -- Gets the children of \"pous\"\n    &gt;&gt;&gt; filterA hasSFC\n    where hasSFC =  hasName \"pou\"    -- Include all \"pou\" elements\n                &gt;&gt;&gt; getChildren      -- that have children\n                &gt;&gt;&gt; getChildren      -- that have children\n                &gt;&gt;&gt; hasName \"SFC\"    -- that have a \"SFC\" element\n\nmain = do\n    runX $\n        readDocument [] \"input.xml\" &gt;&gt;&gt;\n        application                 &gt;&gt;&gt;\n        writeDocument [withIndent yes] \"output.xml\"\n</code></pre>\n"}], "owner": {"reputation": 135, "user_id": 3135456, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000722165744/picture?type=large", "display_name": "Yoanribeiro", "link": "https://stackoverflow.com/users/3135456/yoanribeiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 29850138, "answer_count": 2, "score": 2, "last_activity_date": 1429890765, "creation_date": 1429881623, "question_id": 29848629, "link": "https://stackoverflow.com/questions/29848629/how-to-extract-a-specific-branch-of-a-xml-tree-in-hxt", "title": "How to extract a specific branch of a XML tree in HXT", "body": "<p>Giving the example:</p>\n\n<pre><code>&lt;pous&gt;\n  &lt;pou&gt;\n    &lt;interface&gt;\n      ...\n    &lt;/interface&gt;\n    &lt;body&gt;\n      &lt;FBD&gt;\n        ...\n      &lt;/FBD&gt;\n    &lt;/body&gt;\n  &lt;/pou&gt;\n  &lt;pou&gt;\n    &lt;interface&gt;\n      ...\n    &lt;/interface&gt;\n    &lt;body&gt;\n      &lt;SFC&gt;\n        ...\n      &lt;/SFC&gt;\n    &lt;/body&gt;\n  &lt;/pou&gt;\n&lt;/pous&gt;\n</code></pre>\n\n<p>I know how to obtain all the \"pou\" using the function atTag:</p>\n\n<pre><code>atTag:: (ArrowXml a) =&gt; String -&gt; a XmlTree XmlTree\natTag tag = deep (isElem &gt;&gt;&gt; hasName tag)\n</code></pre>\n\n<p>But how to I extract only the \"pou\" with the the SFC tag? Is there a clean way to do it?</p>\n\n<p>Thank you in advance!</p>\n"}]