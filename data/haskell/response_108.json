[{"tags": ["haskell", "grammar", "parser-generator", "happy", "ambiguous-grammar"], "comments": [{"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1485993925, "post_id": 41992036, "comment_id": 71161258, "body": "I think you missed some of the productions. As presented, there is no conflict (and no constant_expression)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1485994178, "post_id": 41992036, "comment_id": 71161344, "body": "@rici That may very well be the case. If so, I&#39;ll delete the question and review it more carefully before reposting! There is not supposed to be a <code>constant_expression</code> production - that is just the message I chose to print having encountered the <code>expr_path</code> variant of <code>pattern</code>. And I think there should be at least one shift/reduce conflict - given just an <code>Ident</code>, I can shift from <code>pattern</code> into the <code>expr_path</code> variant, or reduce <code>binding_mode ident at_pat</code> altogether."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1485997247, "post_id": 41992036, "comment_id": 71162229, "body": "Ok, it would have been clearer for me had you characterized the results as productions rather than actions; i tend to ignore actions. Is your intention that an unadorned identifier be a pattern? Why don&#39;t you just write the grammar to say that?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1485997484, "post_id": 41992036, "comment_id": 71162280, "body": "Yes, it was my intention that unadorned identifiers be patterns. I didn&#39;t write it as such because I wasn&#39;t convinced those other parts weren&#39;t part of the problem. Please feel free to edit the question to make it clearer - I don&#39;t pretend to have any real experience in writing grammars, let alone debugging them."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485999753, "post_id": 41992923, "comment_id": 71162876, "body": "Yeah. This is generally the idea I was going to try (the <code>complex_expr_path</code>). I think I can somehow make this work with my grammar. Thank you for such a detailed answer!"}], "tags": [], "owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "is_accepted": true, "score": 5, "last_activity_date": 1486007324, "last_edit_date": 1486007324, "creation_date": 1485999536, "answer_id": 41992923, "question_id": 41992036, "link": "https://stackoverflow.com/questions/41992036/shift-reduce-conflict-in-happy-grammar/41992923#41992923", "title": "Shift/reduce conflict in Happy grammar", "body": "<p>First, it's important to understand what a shift is. A shift is the result of accepting the next input token, and putting it on the parser stack (where it will eventually be part of a production, but it is not necessary to know which one yet.) A reduction is taking zero or more tokens off the top of the stack which match the right-hand side of some production, and replacing them with the left-hand side.</p>\n\n<p>When the parser decides to create an <code>identifier pattern</code> out of <code>binding_mode ident at_pat</code> where <code>at_pat</code> is empty, it is not shifting; it is reducing. In fact, it reduces twice: first it reduces zero stacked symbols into an empty <code>at_pat</code> and then it reduces the top three stack symbols into an <code>identifier pattern</code>. Had there been no <code>binding_mode</code>, it could have reduced <code>ident</code> to <code>expr_path</code> and then reduced the <code>expr_path</code> into a <code>constant_expression</code>. So that would be a reduce/reduce conflict.</p>\n\n<p>But there is another issue, precisely because <code>binding_mode</code> is nullable. When the parser sees an <code>ident</code>, it does not know whether or not a <code>binding_mode</code> would be possible, so it doesn't know whether to reduce an empty <code>binding_mode</code> or to shift the <code>ident</code>. That is a shift/reduce conflict. Since it prefers shift to reduce, it chooses to shift the <code>ident</code>, which means that an empty <code>binding_mode</code> cannot be produced , which in turn precludes the reduce/reduce conflict (and prevents <code>ident @ pat</code> from being recognized at all.)</p>\n\n<p>So to untangle all of that, we need to start by avoiding the necessity to reduce an empty <code>binding_mode</code>. We do that by the usual nullable-production elimination algorithm, which involves making two copies of the right-hand side, one with the nullable nonterminal, and the other without; we then remove the nullable production. Once we do that, the reduce/reduce conflict appears.</p>\n\n<p>To avoid the reduce/reduce conflict, we need to be explicit about which production is preferred. Reduce/reduce conflicts cannot be resolved through precedence declarations because the precedence algorithm always involves the comparison between a production (which could be reduced) and a terminal (which could be shifted). So the resolution must be explicit, and that means that we need to say that a bare <code>ident</code> is a pattern, while an <code>expr_path</code> which is not an <code>ident</code> is a constant expression. That leaves us with the following:</p>\n\n<p>(Note that I've used non-terminals to label the three different productions for <code>pattern</code>, rather than relying on actions. For me that makes it easier to think about, and read.)</p>\n\n<pre><code>pattern: identifier_pattern | constant_expression | struct_pattern\n</code></pre>\n\n<p>Here is the null production elimination:</p>\n\n<pre><code>identifier_pattern:   ident at_pat \n                  |   binding_mode ident at_pat\n</code></pre>\n\n<p>Here is the explicit prohibition on idents:</p>\n\n<pre><code>constant_expression:  complex_expr_path \n\nstruct_pattern:       expr_path '{' '..' '}'\n</code></pre>\n\n<p><code>binding_mode</code> is no longer nullable:</p>\n\n<pre><code>binding_mode: mut\n\nat_pat\n   : '@' pat\n   | %empty\n</code></pre>\n\n<p>Here we create the two different expr_paths:</p>\n\n<pre><code>complex_expr_path\n   : complex_expr_path '::' ident\n   | ident '::' ident\n\nexpr_path: ident | complex_expr_path\n</code></pre>\n\n<p>I hope that solution has some relationship to your original grammar.</p>\n"}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "accepted_answer_id": 41992923, "answer_count": 1, "score": 2, "last_activity_date": 1486007324, "creation_date": 1485993174, "question_id": 41992036, "link": "https://stackoverflow.com/questions/41992036/shift-reduce-conflict-in-happy-grammar", "title": "Shift/reduce conflict in Happy grammar", "body": "<p>I've got the following (heavily stripped down) Happy grammar</p>\n\n<pre><code>%token\n   '{'   { Langle }\n   '}'   { Rangle }\n   '..'  { DotDot }\n   '::'  { ColonColon }\n   '@'   { At }\n   mut   { Mut }\n   ident { Ident }\n\n %%\n\n pattern\n   : binding_mode ident at_pat  { error \"identifier pattern\" }\n   | expr_path                  { error \"constant expression\" }\n   | expr_path '{' '..' '}'     { error \"struct pattern\" }\n\n binding_mode\n   : mut                        { }\n   |                            { }\n\n at_pat\n   : '@' pat                    { }\n   |                            { }\n\n expr_path\n   : expr_path '::' ident       { }\n   | ident                      { }\n</code></pre>\n\n<p>Which has shift/reduce conflicts around identifiers in patterns. By default, Happy chooses to shift, but in this case that isn't what I want: it tries to shoe-horn everything into <code>constant expression</code> even when it could be an <code>identifier pattern</code>.</p>\n\n<p>I've read that precedence/associativity is the way to solve this sort of problem, but nothing I've added has been able to budge the grammar in the right direction (to be fair, I've been taking mostly shots in the dark).</p>\n\n<p>Using some obvious tokenization, I would like to have:</p>\n\n<ul>\n<li><code>x</code> to yield <code>identifier pattern</code></li>\n<li><code>mut x</code> to yield <code>identifier pattern</code></li>\n<li><code>std::pi</code> to yield <code>constant expression</code></li>\n<li><code>point{..}</code> to yield <code>struct pattern</code></li>\n<li><code>std::point{..}</code> to yield <code>struct pattern</code></li>\n</ul>\n\n<p>Basically, unless there is a <code>{</code> or <code>::</code> token waiting to be consumed, an identifier should go to the <code>identifier pattern</code> case.</p>\n\n<hr>\n\n<p>I apologize if my question is unclear - part of the problem is that I'm having a tough time pinpointing what the problem even is. :(</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1485987650, "post_id": 41990231, "comment_id": 71158983, "body": "You&#39;ve already derived <code>Read</code>. Doesn&#39;t that give you a parser for free? Or, more to the point: What did you try, what did you expect to happen, and what happened instead?"}, {"owner": {"reputation": 221, "user_id": 5479762, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f6035533ea8d02b602ae5c3145b39a9f?s=128&d=identicon&r=PG&f=1", "display_name": "Morticia A. Addams", "link": "https://stackoverflow.com/users/5479762/morticia-a-addams"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485991653, "post_id": 41990231, "comment_id": 71160509, "body": "I edit my post!"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1485992064, "post_id": 41990231, "comment_id": 71160649, "body": "You cannot return a pure value from the <code>main</code> function. Also, <code>return</code> is not the <code>return</code> from languages like C or Java, it&#39;s a function from a type class called <code>Monad</code>, a very powerful tool of abstraction."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1485992291, "post_id": 41990231, "comment_id": 71160721, "body": "Furthermore, looking at your code, you write <code>animals :: [Tree] = fileString</code>, which is syntactically incorrect, but you never use the value <code>animals</code> anywhere is your code."}, {"owner": {"reputation": 221, "user_id": 5479762, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f6035533ea8d02b602ae5c3145b39a9f?s=128&d=identicon&r=PG&f=1", "display_name": "Morticia A. Addams", "link": "https://stackoverflow.com/users/5479762/morticia-a-addams"}, "edited": false, "score": 0, "creation_date": 1485994124, "post_id": 41990231, "comment_id": 71161322, "body": "Ok,thank you! <code>animals :: [Tree] = fileString</code> is incorect. How can i cast read content to Tree and print it in console?"}, {"owner": {"reputation": 221, "user_id": 5479762, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f6035533ea8d02b602ae5c3145b39a9f?s=128&d=identicon&r=PG&f=1", "display_name": "Morticia A. Addams", "link": "https://stackoverflow.com/users/5479762/morticia-a-addams"}, "edited": false, "score": 0, "creation_date": 1485997593, "post_id": 41990231, "comment_id": 71162314, "body": "I put all code in post!"}], "answers": [{"comments": [{"owner": {"reputation": 221, "user_id": 5479762, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f6035533ea8d02b602ae5c3145b39a9f?s=128&d=identicon&r=PG&f=1", "display_name": "Morticia A. Addams", "link": "https://stackoverflow.com/users/5479762/morticia-a-addams"}, "edited": false, "score": 0, "creation_date": 1485998482, "post_id": 41992728, "comment_id": 71162553, "body": "You are hero! Thank you! Just save my life! ^.^"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1485998071, "creation_date": 1485998071, "answer_id": 41992728, "question_id": 41990231, "link": "https://stackoverflow.com/questions/41990231/parse-binary-tree-from-file-in-haskell/41992728#41992728", "title": "Parse binary tree from file in Haskell", "body": "<p>This looks like a great start! I only needed to add <code>readFile</code> to your <code>main</code> function to get it to compile:</p>\n\n<pre><code>main = do root &lt;- readFile \"database.txt\"\n</code></pre>\n\n<p>It is possible that you may need to switch from <code>readFile</code> to explicitly opening the file for reading, doing the reading, and closing the file. This is because <code>readFile</code> does not guarantee when it will close the file, and <code>writeFile</code> is allowed to fail if it is given a path to a file that's already open.</p>\n\n<p>You can read the documentation for <code>openFile</code>, <code>hGetLine</code>, and <code>hClose</code> for further details on how to do this (but beware <code>hGetContents</code>, as it has the same caveats <code>readFile</code> does).</p>\n"}], "owner": {"reputation": 221, "user_id": 5479762, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f6035533ea8d02b602ae5c3145b39a9f?s=128&d=identicon&r=PG&f=1", "display_name": "Morticia A. Addams", "link": "https://stackoverflow.com/users/5479762/morticia-a-addams"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 41992728, "answer_count": 1, "score": 1, "last_activity_date": 1485998102, "creation_date": 1485985007, "last_edit_date": 1485998102, "question_id": 41990231, "link": "https://stackoverflow.com/questions/41990231/parse-binary-tree-from-file-in-haskell", "title": "Parse binary tree from file in Haskell", "body": "<p>I have task to write Quiz Animal game. I have to read Tree data from file (the structure of file is free). After end of game is possible to be added new data in tree(actually (Animal) to be replace by (Node (Animal) (Animal)). </p>\n\n<p>My problem is that i can't parse content of \"database.txt\" in AnimalsTree</p>\n\n<p>Example \"database.txt\" (this content is generated with writing before call 'New Game'):</p>\n\n<blockquote>\n  <p>Question \"Is it fly?\" (Animal \"Bird\") (Question \"Is it swim?\" (Animal \"Fish\") (Animal \"Dog\"))</p>\n</blockquote>\n\n<p><strong>EDIT</strong>\nThis is full code:</p>\n\n<pre><code>module Main where\nimport System.IO\ndata AnimalsTree = Animal String | Question String AnimalsTree AnimalsTree deriving (Read, Show)\n-- \u0412\u0438\u0434\u043e\u0432\u0435\u0442\u0435 \u043e\u0442\u0433\u043e\u0432\u043e\u0440\u0438 \u043d\u0430 \u043f\u043e\u0442\u0440\u0435\u0431\u0438\u0442\u0435\u043b\u044f\ndata Answer = Yes | No\n\nmain :: IO ()\nmain = do root &lt;- \"database.txt\"\n          play (read root)\n          return ()\n\nplay :: AnimalsTree -&gt; IO AnimalsTree\nplay root = do putStrLn \"Think of an animal, I will try to guess what it is...\"\n               newRoot &lt;- play' root\n               writeFile \"database.txt\" (show newRoot)\n               playAgain &lt;- ask \"Do you want to play again?\"\n               case playAgain of\n                   Yes -&gt; play newRoot\n                   No  -&gt; do putStrLn \"Bye!\"\n                             return newRoot\n\nplay' :: AnimalsTree -&gt; IO AnimalsTree\nplay' question@(Question q l r) = do ans &lt;- ask q\n                                     case ans of\n                                        Yes -&gt; do y &lt;- play' l\n                                                  return $ Question q y r\n                                        No  -&gt; do n &lt;- play' r\n                                                  return $ Question q l n\n\nplay' animal@(Animal _) = do ans &lt;- ask $ \"Are you thinking of \" ++ show' animal ++ \"?\"\n                             case ans of\n                                Yes -&gt; do putStrLn \"I win! :)\"\n                                          return animal\n                                No  -&gt; do putStrLn \"I give up, you win!\"\n                                          getNewAnimal animal\n\n\ngetNewAnimal :: AnimalsTree -&gt; IO AnimalsTree\ngetNewAnimal animal = do putStrLn \"Please help me!\"\n                         putStrLn \"What is name of yout animal?\"\n                         name &lt;- getLine\n                         let newAnimal = Animal name\n                         putStrLn $ \"Now please enter a question that answers yes for \" ++ show' newAnimal ++ \" and no for \" ++ show' animal\n                         question &lt;- getLine\n                         return $ Question question newAnimal animal\n\nask :: String -&gt; IO Answer\nask s = do putStrLn $ s ++ \" (Yes/No)\"\n           getAnswer\n\ngetAnswer :: IO Answer\ngetAnswer = do ans &lt;- getLine\n               putStrLn \"\"\n               case ans of\n                   \"y\" -&gt; return Yes\n                   \"Y\" -&gt; return Yes\n                   \"yes\" -&gt; return Yes\n                   \"Yes\" -&gt; return Yes\n                   \"n\" -&gt; return No\n                   \"N\" -&gt; return No\n                   \"no\" -&gt; return No\n                   \"No\" -&gt; return No\n                   _   -&gt; putStrLn \"This is incorect answer! Please try again with value in 'Yes' or 'No'!\" &gt;&gt; getAnswer\n\nshow' (Animal name) = (if elem (head name) \"AEIOUaeiou\" then \"an \" else \"a \") ++ name\nshow' (Question q _ _) = q\n</code></pre>\n\n<p>But I get following error:</p>\n\n<pre><code>test3.hs:10:19:\n    No instance for (Read (IO AnimalsTree))\n      arising from a use of \u2018read\u2019\n    In a stmt of a 'do' block: root &lt;- read \"database.txt\"\n    In the expression:\n      do { root &lt;- read \"database.txt\";\n           play (root);\n           return () }\n    In an equation for \u2018main\u2019:\n        main\n          = do { root &lt;- read \"database.txt\";\n                 play (root);\n                 return () }\n</code></pre>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "answers": [{"tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": false, "score": 2, "last_activity_date": 1485978080, "creation_date": 1485978080, "answer_id": 41988284, "question_id": 41987908, "link": "https://stackoverflow.com/questions/41987908/convenient-ways-to-initialize-nested-fields-with-lenses/41988284#41988284", "title": "Convenient ways to initialize nested fields with lenses", "body": "<p>You can define your own <code>?=</code> with the same precedence as <code>$</code> to make them play nice together:</p>\n\n<pre><code>import Control.Lens hiding ((?=))\nimport qualified Control.Lens as L\n\n(?=)\n  :: MonadState s m\n  =&gt; ASetter s s a (Maybe b) -&gt; b -&gt; m ()\n(?=) = (L.?=)\n\ninfixr 0 ?=\n</code></pre>\n\n<p>With this your example works.</p>\n"}, {"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 2, "creation_date": 1485991783, "post_id": 41990616, "comment_id": 71160564, "body": "Thanks! I tried this approach and it works like magic. If anybody interested: utility function to help me with zooming (<a href=\"https://github.com/serokell/log-warper/blob/91d82ed1b3a331ed4a8e0f458390f985028d1817/src/System/Wlog/LoggerConfig.hs#L120\" rel=\"nofollow noreferrer\">github.com/serokell/log-warper/blob/&hellip;</a>) and here how I use it (<a href=\"https://github.com/serokell/log-warper/blob/91d82ed1b3a331ed4a8e0f458390f985028d1817/test/Test/Wlog/RollingSpec.hs#L69\" rel=\"nofollow noreferrer\">github.com/serokell/log-warper/blob/&hellip;</a>)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1485986491, "creation_date": 1485986491, "answer_id": 41990616, "question_id": 41987908, "link": "https://stackoverflow.com/questions/41987908/convenient-ways-to-initialize-nested-fields-with-lenses/41990616#41990616", "title": "Convenient ways to initialize nested fields with lenses", "body": "<p><a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Zoom.html#v:zoom\" rel=\"nofollow noreferrer\"><code>zoom</code></a> is tailor-made for handling nested state updates. In your case, unfortunately, the <code>Maybe</code>-ness makes using it slightly awkward:</p>\n\n<pre><code>example :: NestedTree\nexample = flip execState (NT 0 mempty) $ do\n    dummy .= 3\n    zoom (tree.at \"foo\") $ do\n        put (Just (NT 0 mempty))\n        _Just.dummy .= 10\n        _Just.tree.at \"foo nested\" ?= NT 5 mempty\n    -- Or, using zoom one more time:\n    zoom (tree.at \"bar\") $ do\n        put (Just (NT 0 mempty))\n        zoom _Just $ do\n            dummy .= 15\n            tree.at \"bar nested\" ?= NT (-3) mempty\n</code></pre>\n\n<p>For the sake of comparison, if you didn't need to insert new keys at the outer level, you would be able to use <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-At.html#v:ix\" rel=\"nofollow noreferrer\"><code>ix</code></a> instead of <code>at</code> and drop all the <code>Maybe</code>-related boilerplate:</p>\n\n<pre><code>    zoom (tree.ix \"foo\") $ do\n        dummy .= 10\n        tree.at \"foo nested\" ?= NT 5 mempty\n</code></pre>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 41990616, "answer_count": 2, "score": 1, "last_activity_date": 1485986593, "creation_date": 1485976815, "last_edit_date": 1485986593, "question_id": 41987908, "link": "https://stackoverflow.com/questions/41987908/convenient-ways-to-initialize-nested-fields-with-lenses", "title": "Convenient ways to initialize nested fields with lenses", "body": "<p>I have some data type which is very similar to ordinary trees, just some specialized form.</p>\n\n<pre><code>data NestedTree = NT\n    { _dummy :: Int\n    , _tree  :: HashMap String NestedTree\n    } deriving (Show)\n\nmakeLenses ''NestedTree\n</code></pre>\n\n<p>I want to initialize instances of my data type imperatively using lenses. Here is what I got now:</p>\n\n<pre><code>example :: NestedTree\nexample = flip execState (NT 0 mempty) $ do\n    dummy .= 3\n    tree.at \"foo\" ?= flip execState (NT 0 mempty) (dummy .= 10)\n</code></pre>\n\n<p>You can observe in this example that I can replace first <code>(NT 0 mempty)</code> with <code>(NT 3 mempty)</code> but this is not the point. What I want is too be able to initialize nested <code>HashMap</code>s using this nice imperative style. More precise, I want to be able to write something like this:</p>\n\n<pre><code>example :: NestedTree\nexample = flip execState (NT 0 mempty) $ do\n    dummy .= 3\n    tree.at \"foo\" ?= flip execState (NT 0 mempty) $ do\n        dummy .= 10\n        tree.at \"foo nested\" ?= NT 5 mempty\n    tree.at \"bar\" ?= flip execState (NT 0 mempty) $ do\n        dummy .= 15\n        tree.at \"bar nested\" ?= NT (-3) mempty\n</code></pre>\n\n<p>My real data structure is more complex and it very soon becomes really ugly to initialize it using just simple records. Thus I want to use some kind of DSL, and lenses fit quite good for my need. But you can notice that code above doesn't compile.</p>\n\n<p>It's because <code>($)</code> has lowest precedence and I can't just write <code>tree.at \"foo\" ?= flip execState (NT 0 mempty) $ do</code>. But I really don't want to add <code>()</code> around nested <code>do</code>s.</p>\n\n<p>Is there any nice ways to mix arbitrary operators with <code>$</code> and <code>do</code> in order to write such functions? I really don't want to introduce some helper like <code>wordsAssign = (?=)</code> and call functions like</p>\n\n<p><code>wordsAssign (tree.at \"foo\") $ flip execState (NT 0 mempty) $ do</code></p>\n\n<p>because I like <code>?=</code> operator. Maybe I'm doing everything wrong and this kind of things I want to do can be done without lenses with some hand-written operators?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "edited": false, "score": 0, "creation_date": 1485981503, "post_id": 41986481, "comment_id": 71155849, "body": "This is extremely cool and GADTs seem to be a lot more versatile than I&#39;ve been giving them credit for. Do I understand this correctly that TypeEnum basically pattern matches types to values and TypeDict kind of does existential quantification?  Is there somewhere were  could read up on how this is implemented? I&#39;d guess that TypeDict captures the implementation of the type class and implicitly passes it along, which means that only the things touching it directly have to be copied to extend this to other type classes?  Anyway, thanks for your extensive and super interesting answer!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "edited": false, "score": 1, "creation_date": 1485986660, "post_id": 41986481, "comment_id": 71158486, "body": "@Taren Yes, <code>TypeDict</code> and <code>Number</code> are both existentials. Yes, <code>TypeDict</code> captures the implementation of the type class; in the desugared version, the whole typeclass mechanism gets converted into a dictionary passing mechanism, and the single constructor for <code>TypeDict</code> holds such a dictionary. As you say it should be easy to extend to other type classes. The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#generalised-algebraic-data-types-gadts\" rel=\"nofollow noreferrer\">GHC user manual</a> has a broad overview of GADTs and many links to further reading."}, {"owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "edited": false, "score": 0, "creation_date": 1486077813, "post_id": 41986481, "comment_id": 71203770, "body": "After playing around with this <a href=\"https://gist.github.com/Tarmean/f47d880663e35e8c82165bc443bfb202\" rel=\"nofollow noreferrer\">some more</a> I think I got it. Weirdly enough I found it much easier to understand what each type does after rewriting TypeDict and Number into explicit existential quantification syntax. Also reading the ghc manual section three times. Anyway, thanks for your help!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 12, "last_activity_date": 1485978268, "last_edit_date": 1485978268, "creation_date": 1485971769, "answer_id": 41986481, "question_id": 41985470, "link": "https://stackoverflow.com/questions/41985470/haskell-type-promotion/41986481#41986481", "title": "Haskell Type Promotion", "body": "<p>Here's a proposal. The primary thing we want your <code>typeEnum</code> function to do that it doesn't yet is bring a <code>Num a</code> dictionary into scope. So let's use GADTs to make that happen. I'll simplify a few things to make it easier to explain the idea and write the code, but nothing essential: I'll focus on <code>Number</code> rather than <code>LispVal</code> and I won't report detailed errors when things go wrong. First some boilerplate:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE Rank2Types #-}\nimport Control.Applicative\nimport Data.Complex\n</code></pre>\n\n<p>Now, you didn't give your definition of a type enumeration. But I'll give mine, because it's part of the secret sauce: my type enumeration is going to have a connection between Haskell's term level and Haskell's type level via a GADT.</p>\n\n<pre><code>data TypeEnum a where\n    Integer  :: TypeEnum Integer\n    Rational :: TypeEnum Rational\n    Real     :: TypeEnum Double\n    Complex  :: TypeEnum (Complex Double)\n</code></pre>\n\n<p>Because of this connection, my <code>Number</code> type won't need to repeat each of these cases again. (I suspect your <code>TypeEnum</code> and <code>Number</code> types are quite repetitive compared to each other.)</p>\n\n<pre><code>data Number where\n    Number :: TypeEnum a -&gt; a -&gt; Number\n</code></pre>\n\n<p>Now we're going to define a new type that you didn't have, which will tie a <code>TypeEnum</code> together with a <code>Num</code> dictionary for the appropriate type. This will be the return type of our <code>typeEnum</code> function.</p>\n\n<pre><code>data TypeDict where\n    TypeDict :: Num a =&gt; TypeEnum a -&gt; TypeDict\n\nordering :: TypeEnum a -&gt; Int\nordering Integer  = 0 -- lowest\nordering Rational = 1\nordering Real     = 2\nordering Complex  = 3 -- highest\n\ninstance Eq  TypeDict where TypeDict l == TypeDict r = ordering l == ordering r\ninstance Ord TypeDict where compare (TypeDict l) (TypeDict r) = compare (ordering l) (ordering r)\n</code></pre>\n\n<p>The <code>ordering</code> function reflects (my guess at) the direction that casts can go. If you try to implement <code>Eq</code> and <code>Ord</code> yourself for this type, without peeking at my solution, I suspect you will discover why GHC balks at deriving these classes for GADTs. (At the very least, it took me a few tries! The obvious definitions don't type-check, and the slightly less obvious definitions had the wrong behavior.)</p>\n\n<p>Now we are ready to write a function that produces a dictionary for a number.</p>\n\n<pre><code>typeEnum :: Number -&gt; TypeDict\ntypeEnum (Number Integer  _) = TypeDict Integer\ntypeEnum (Number Rational _) = TypeDict Rational\ntypeEnum (Number Real     _) = TypeDict Real\ntypeEnum (Number Complex  _) = TypeDict Complex\n</code></pre>\n\n<p>We will also need the casting function; you can essentially just concatenate your definitions of <code>toComplex</code> and friends here:</p>\n\n<pre><code>-- combines toComplex, toFrac, toReal, toInt\nto :: TypeEnum a -&gt; Number -&gt; Maybe a\nto Rational (Number Integer  n) = Just (fromInteger n)\nto Rational (Number Rational n) = Just n\nto Rational _ = Nothing\n-- etc.\nto _ _ = Nothing\n</code></pre>\n\n<p>Once we have this machinery in place, <code>liftNum</code> is surprisingly short. We just find the appropriate type to cast to, get a dictionary for that type, and perform the casts and the operation.</p>\n\n<pre><code>liftNum :: (forall a. Num a =&gt; a -&gt; a -&gt; a) -&gt; Number -&gt; Number -&gt; Maybe Number\nliftNum f a b = case typeEnum a `max` typeEnum b of\n    TypeDict ty -&gt; Number ty &lt;$&gt; liftA2 f (to ty a) (to ty b)\n</code></pre>\n\n<p>At this point you may be complaining: your ultimate goal was to not have one case per class instance in <code>liftNum</code>, and we've achieved that goal, but it looks like we just pushed it off into the definition of <code>typeEnum</code>, where there is one case per class instance. However, I defend myself: you have not shown us your <code>typeEnum</code>, which I suspect already had one case per class instance. So we have not incurred any <em>new</em> cost in functions other than <code>liftNum</code>, and have indeed significantly simplified <code>liftNum</code>. This also gives a smooth upgrade path for more complex <code>Complex</code> manipulations: extend the <code>TypeEnum</code> definition, the cast <code>ordering</code>, and the <code>to</code> function and you're good to go; <code>liftNum</code> may stay the same. (If it turns out that types are not linearly ordered but instead some kind of lattice or similar, then you can switch away from the <code>Ord</code> class.)</p>\n"}], "owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 435, "favorite_count": 1, "accepted_answer_id": 41986481, "answer_count": 1, "score": 8, "last_activity_date": 1485978268, "creation_date": 1485968585, "question_id": 41985470, "link": "https://stackoverflow.com/questions/41985470/haskell-type-promotion", "title": "Haskell Type Promotion", "body": "<p>I am currently working my way through <a href=\"https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours\">Write Yourself a Scheme in 48 Hours</a> and am stuck on type promotion.</p>\n\n<p>In short, scheme has a numerical tower (Integer->Rational->Real->Complex) with the numeric promotions one would expect. I modeled numbers with the obvious</p>\n\n<pre><code>data Number = Integer Integer | Rational Rational | Real Double | Complex (Complex Double)\n</code></pre>\n\n<p>so using Rank2Types seemed like an easy way to make functions work over this range of types. For <code>Num a</code> this looks like</p>\n\n<pre><code>liftNum :: (forall a . Num a =&gt; a -&gt; a -&gt; a) -&gt; LispVal -&gt; LispVal -&gt; ThrowsError LispVal\nliftNum f a b = case typeEnum a `max` typeEnum b of\n  ComplexType  -&gt; return . Number . Complex $ toComplex a `f` toComplex b\n  RealType     -&gt; return . Number . Real $ toReal a `f` toReal b\n  RationalType -&gt; return . Number . Rational $ toFrac a `f` toFrac b\n  IntType      -&gt; return . Number . Integer $ toInt a `f` toInt b\n  _            -&gt; typeErr a b \"Number\"\n</code></pre>\n\n<p>which works but quickly becomes verbose because a separate block is required for each type class.<br>\nEven worse, this implementation of Complex is simplified since scheme can use separate types for the real and complex part. Implementing this would require a custom version holding two <code>Number</code>'s which would make the verbosity even worse if I wanted to avoid making the type recursive.</p>\n\n<p>As far as I know there is no way to abstract over the context so I am hoping for a cleaner way to implement this number logic.</p>\n\n<p>Thanks for reading!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485964712, "post_id": 41984027, "comment_id": 71146109, "body": "When reloading <code>:r</code> in GHCi, it looks that all <code>let x</code> statements are removed (the variable no longer exists)."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485965037, "post_id": 41984027, "comment_id": 71146368, "body": "That solves the problem, but is a decision that works only well for an interpreter, such as GHCi. It will not work in general, because most other programs have no way to track what are the pending computations waiting for evaluation that should be disposed upon module reloading. On the contrary, GHCi knows where pending computations are: they are all referenced by the variables the user created in the console, so its easy to dispose them all."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1485967649, "post_id": 41984027, "comment_id": 71148051, "body": "I guess most systems that support hot-upgrading introduce a layer of indirection at basically every function call or so, namely: look up the most recently loaded version of this function. I see no reason a Haskell implementation couldn&#39;t adopt this solution, too, though presumably at each thunk evaluation rather than at each function call."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485967874, "post_id": 41984027, "comment_id": 71148205, "body": "As a side note, there appears to be a potentially unwarranted assumption in the argument as posed, namely, that other systems that support hot upgrades are easy to debug because old code is never in the system. But this seems incredibly unlikely; e.g. what happens if the upgrade happens while a function is still executing? Presumably it continues executing, still using the old code path (even if subsequent calls made by this old path are to new functions) for the remainder of that function call."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485968174, "post_id": 41984027, "comment_id": 71148394, "body": "@DanielWagner Doing as you say would result in the pending computation to use the semantics of the new version not the semantics of the old version the programmer expects at the time the computation was constructed ... That is why I think laziness is incompatible with hot code swapping / code reloading, that is, you have to have to throw away all pending computations, which in a lazy language seems not only unpractical, but also result in unpredictable behavior when calling the evaluation of those pending computations."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485968234, "post_id": 41984027, "comment_id": 71148428, "body": "@DanielWagner In contrast, in imperative languages this is conceptually trivial because there are no such pending computations, so new computations will simply use the new function definition."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1485968401, "post_id": 41984027, "comment_id": 71148544, "body": "@mljrg I don&#39;t believe your claim that &quot;in imperative languages there are no pending computations&quot;. If I write <code>f(int i) { i = i+1; return g(i); }</code> and do an upgrade after entering <code>f</code> but before entering <code>g</code>, there is a pending computation of <code>f</code>. It seems inevitable to me that you must now choose whether to use the old or new <code>g</code>, and it&#39;s not at all clear to me that this decision should be significantly different in a strict or lazy language: in both cases, the pros and cons are as you say (new <code>g</code> may change the meaning of <code>f</code>, old <code>g</code> ignores the upgrade and may keep an old bug)."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485969608, "post_id": 41984027, "comment_id": 71149230, "body": "@DanielWagner That is a good example, and the reasonable behavior should be to have the semantics of both <code>f</code> and <code>g</code> and whatever other functions <code>g</code> calls underneath, as that semantics was the expected by the time the computation was put on hold. However, the new versions of <code>f</code> and <code>g</code> may have been in effect for quite a while by the time the old computation needs to be evaluated, so even the old semantics is not expected anymore. That is why I think laziness and code reloading do not play well conceptually, because of this time lapse imposed by laziness."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485970342, "post_id": 41984027, "comment_id": 71149729, "body": "@DanielWagner In imperative languages the old computation may take a while to reach an internal function that was upgraded (say <code>g</code>), which is a situation similar to the laziness case that also results in the same conceptual issue. However, in imperative languages, programmers can easily control such situations, but not in Haskell. (Note: I am not banging on Haskell, I love it, however this issue came along to my mind today. In fact, there must be a reason why hot code upgrading is not a feature in Haskell as much it is in Erlang, and both languages have evolved on par along the years.)"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1486004511, "post_id": 41984027, "comment_id": 71164041, "body": "I&#39;ve voted to close this as &quot;opinion based&quot; since any answer is clearly going to depend on a lot of specifics and viewpoints.  A more rigidly formalized variant of the question might be more objectively answerable (and the Haskell S.O. crowd would be good people to ask), but it still would fit better with the topics and discussion style of cs.stackexchange or quora than stackoverflow."}], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 140, "favorite_count": 2, "answer_count": 0, "score": 4, "last_activity_date": 1485982994, "creation_date": 1485964240, "last_edit_date": 1485982994, "question_id": 41984027, "link": "https://stackoverflow.com/questions/41984027/are-code-reloading-and-laziness-two-incompatible-features-in-haskell", "title": "Are code reloading and laziness two incompatible features in Haskell?", "body": "<p>One of Haskell's best known feature is its laziness, which permits to write more elegant and reusable code. Internally, laziness builds computations in memory for execution only when needed, which can happen much later at another place in the code. Also, the GHC API can reload new module versions, a feature that some programs use, most notably GHCi.</p>\n\n<p>Now suppose that a lazy computation holds a reference to a function in a module, and the module is reloaded. Which version of the function will be executed when the lazy computation is evaluated to its full extent?</p>\n\n<p>It seems natural that the old version should be executed, because its semantics was the one intended by the time the lazy computation was created, and so running the new version instead seems unreasonable. However, if the old version fails, subsequent debugging will be problematic because the code that failed no longer exists in the system, making it hard to track the cause of the failure.</p>\n\n<p>All this reasoning leads me to think that laziness and code reloading (i.e. hot upgrades) are incompatible at a conceptual level. Is this really so, or is there some design decision in Haskell or GHC that solves this conceptual incompatibility?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485962380, "post_id": 41983125, "comment_id": 71144284, "body": "(The situation in the suggested question is slightly different, but the root problem is the same: yor expression is equivalent to <code>print (getElement ([1, 2, 3, 4, 5] 2))</code>, which is not what you want and leads to the two type errors.)"}, {"owner": {"reputation": 1162, "user_id": 4383264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f11355e49bca53dab7b593dee15cf4c?s=128&d=identicon&r=PG", "display_name": "Abhishek Jaisingh", "link": "https://stackoverflow.com/users/4383264/abhishek-jaisingh"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485966610, "post_id": 41983125, "comment_id": 71147411, "body": "thanx @duplode. the <b>$</b> was messing things up. It was making Haskell evaluate the expression  <i>([1, 2, 3, 4, 5] 2)</i>"}], "owner": {"reputation": 1162, "user_id": 4383264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f11355e49bca53dab7b593dee15cf4c?s=128&d=identicon&r=PG", "display_name": "Abhishek Jaisingh", "link": "https://stackoverflow.com/users/4383264/abhishek-jaisingh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 32, "favorite_count": 0, "closed_date": 1485962278, "answer_count": 0, "score": 0, "last_activity_date": 1485962087, "creation_date": 1485961837, "last_edit_date": 1485962087, "question_id": 41983125, "link": "https://stackoverflow.com/questions/41983125/write-function-to-get-kth-element", "closed_reason": "Duplicate", "title": "Write function to get kth element", "body": "<p>I wrote the following code:</p>\n\n<pre><code>getElement :: [a] -&gt; Integer -&gt; a\ngetElement (x:xs) 1 = x\ngetElement (x:xs) n = getElement $ xs (n-1)\n\nmain :: IO()\nmain = print $ getElement $ [1, 2, 3, 4, 5] 2\n</code></pre>\n\n<p>but it keeps giving me the following error:</p>\n\n<pre><code>/home/jaisingh/cs/Course/POPL/Assignment/Assignment 1/problem3.hs:3:36:\n    Couldn't match expected type \u2018Integer -&gt; [a0]\u2019\n                with actual type \u2018[a]\u2019\n    Relevant bindings include\n      xs :: [a]\n        (bound at /home/jaisingh/cs/Course/POPL/Assignment/Assignment 1/problem3.hs:3:15)\n      x :: a\n        (bound at /home/jaisingh/cs/Course/POPL/Assignment/Assignment 1/problem3.hs:3:13)\n      getElement :: [a] -&gt; Integer -&gt; a\n        (bound at /home/jaisingh/cs/Course/POPL/Assignment/Assignment 1/problem3.hs:2:1)\n    The function \u2018xs\u2019 is applied to one argument,\n    but its type \u2018[a]\u2019 has none\n    In the second argument of \u2018($)\u2019, namely \u2018xs (n - 1)\u2019\n    In the expression: getElement $ xs (n - 1)\n\n/home/jaisingh/cs/Course/POPL/Assignment/Assignment 1/problem3.hs:6:29:\n    Couldn't match expected type \u2018Integer -&gt; [a1]\u2019\n                with actual type \u2018[Integer]\u2019\n    The function \u2018[1, 2, 3, 4, ....]\u2019 is applied to one argument,\n    but its type \u2018[Integer]\u2019 has none\n    In the second argument of \u2018($)\u2019, namely \u2018[1, 2, 3, 4, 5] 2\u2019\n    In the second argument of \u2018($)\u2019, namely\n      \u2018getElement $ [1, 2, 3, 4, 5] 2\u2019\n</code></pre>\n\n<p>I think that there is some problem int the function signature in using the <strong>a</strong> type variable. Help me!</p>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 7500874, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/2a505759aeda973b2072d25e64b885e1?s=128&d=identicon&r=PG&f=1", "display_name": "sgman", "link": "https://stackoverflow.com/users/7500874/sgman"}, "edited": false, "score": 0, "creation_date": 1485959621, "post_id": 41982239, "comment_id": 71142346, "body": "ah yes i got it finally (thought a bit more), thanks."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 89, "user_id": 7500874, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/2a505759aeda973b2072d25e64b885e1?s=128&d=identicon&r=PG&f=1", "display_name": "sgman", "link": "https://stackoverflow.com/users/7500874/sgman"}, "edited": false, "score": 0, "creation_date": 1485959691, "post_id": 41982239, "comment_id": 71142392, "body": "@Sg587565: I also considered the case you give it negative numbers and zero."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 1, "last_activity_date": 1485960312, "last_edit_date": 1485960312, "creation_date": 1485959406, "answer_id": 41982239, "question_id": 41982139, "link": "https://stackoverflow.com/questions/41982139/finding-result-of-a-recursive-function/41982239#41982239", "title": "Finding result of a recursive function", "body": "<p>It is a very inefficient way to calculate the double <code>(2*)</code> of a number. Because you feed <code>g n (n+1)</code>.</p>\n\n<p><code>g</code> is given two numbers and as long as <code>(mod i m) == 0</code> fails (<code>i</code> is not dividable by <code>m</code>) it will <strong>increment <code>i</code></strong>. From the moment it succeeds, it returns <code>i</code>. Now the lowest <code>n</code> larger than <code>k</code> that is dividable by <code>k</code> is obviously <code>2*k</code>.</p>\n\n<p>So <code>f</code> is equivalent to:</p>\n\n<pre><code>-- equivalent to\nf' = (2*)\n</code></pre>\n\n<p>In case <strong>negative numbers are also considered</strong>, it will always return <code>0</code>, for the strictly negative numbers since the first such number to satisfy the modulo relation is <code>0</code>. Finally if <code>0</code> is given, it will error. So when considering zero and negative numbers, the full definition is:</p>\n\n<pre><code>-- equivalent (with negative numbers and zero)\nf' n | n &gt; 0 = 2*n\n     | n &lt; 0 = 0\n     -- n == 0 should error\n</code></pre>\n\n<p>Since the algorithm increments <code>i</code> each time, the program will run linear with <code>n</code> (given increment and modulo can be checked in constant time) so <em>O(n)</em>. The equivalent definition runs of course in constant time (given multiplication and comparisons can be done in constant time, this is not the case for <code>Integer</code> for instance).</p>\n"}], "owner": {"reputation": 89, "user_id": 7500874, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/2a505759aeda973b2072d25e64b885e1?s=128&d=identicon&r=PG&f=1", "display_name": "sgman", "link": "https://stackoverflow.com/users/7500874/sgman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1485960312, "creation_date": 1485959154, "last_edit_date": 1485959441, "question_id": 41982139, "link": "https://stackoverflow.com/questions/41982139/finding-result-of-a-recursive-function", "title": "Finding result of a recursive function", "body": "<p>The given question is: \"What is the value of <code>f 572</code> for the following definition of <code>f</code>?\"</p>\n\n<pre><code>f :: Int -&gt; Int\nf n = g n (n+1)\n\ng :: Int -&gt; Int -&gt; Int\ng m i\n    | (mod i m) == 0 = i\n    | otherwise = g m (i+1)\n</code></pre>\n\n<p>To me this looks like a recursive function and the answer should be that the values keep adding up from <code>572</code> till <code>1044</code> (that's when <code>mod 1044 572</code> will be <code>0</code>).</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1485958969, "post_id": 41981611, "comment_id": 71141876, "body": "I&#39;d get rid of the first half of the question, to be honest. You can reproduce that behaviour with <code>data Two a b = T</code> completely. Also, please make sure to include links to the packages. By the way, <a href=\"https://stackoverflow.com/questions/2335967/manipulating-the-order-of-arguments-to-type-constructors\" title=\"manipulating the order of arguments to type constructors\">stackoverflow.com/questions/2335967/&hellip;</a> is close to what you&#39;re looking for."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1486005906, "post_id": 41981611, "comment_id": 71164355, "body": "The <code>Elem</code> class has a functional dependency, so it expresses a functional relation. Functional dependencies have been around a lot longer than type families, and also offer better APIs in some cases (though I think probably not in this case)."}, {"owner": {"reputation": 1004, "user_id": 3088265, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/99c2e5db7086c4dc0a5bd9aada58f162?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Vock", "link": "https://stackoverflow.com/users/3088265/richard-vock"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1486042273, "post_id": 41981611, "comment_id": 71183121, "body": "@dfeuer: That is quite interesting. I kind of assumed that functional maps on types is too fundamental to simply not exist ;). Note also that equivalency relations are simply wrong in these cases. Nothing prevents me from having multiple instances of (Elem Float Anything). Of course the compiler wouldn&#39;t allow the ambiguity, but it still seems more reasonable to me to restrict the functional dependency to actual functions (in a mathematical sense). Wouldn&#39;t have thought that on type level early haskell was more of a Prolog than a Haskell..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1486135684, "post_id": 41981611, "comment_id": 71229348, "body": "Who said anything about equivalence relations? The functional dependency means you won&#39;t be allowed to have more than one <code>Elem Float</code> instance. The second parameter is determined by the first. Today, that&#39;s only used for type checking, but I&#39;m hopeful that functional dependencies will ultimately be implemented more like type families, so as to provide proper evidence."}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 5, "last_activity_date": 1485960344, "creation_date": 1485960344, "answer_id": 41982554, "question_id": 41981611, "link": "https://stackoverflow.com/questions/41981611/bind-type-parameter/41982554#41982554", "title": "Bind type parameter", "body": "<p>You're nearly there. The one missing piece is that <code>type</code> synonyms must be used <em>saturated</em> - that is, you have to supply all of its arguments. <code>MatX</code> on its own is not a valid type, only <code>MatX a</code>. The reason for this is that <code>type</code> synonyms are just synonyms - they're expanded at compile time, which means that the compiler needs to know all of the <code>type</code> synonym's arguments in order to get a valid type after expansion.</p>\n\n<p>The fix is to change your <code>type</code> synonym to a <code>newtype</code>.</p>\n\n<pre><code>newtype MatX a = MatX { getMatX :: Matrix a (CType a) }\n</code></pre>\n\n<p><code>newtype</code>s <em>can</em> be partially applied, because <code>MatX a</code> is now a different type to <code>Matrix a (CType a)</code>.</p>\n\n<pre><code>type instance Key MatX = (Int, Int)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1004, "user_id": 3088265, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/99c2e5db7086c4dc0a5bd9aada58f162?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Vock", "link": "https://stackoverflow.com/users/3088265/richard-vock"}, "edited": false, "score": 0, "creation_date": 1486041872, "post_id": 41993174, "comment_id": 71182850, "body": "I instantly accepted the other answer since I expect to reuse that mapping (MatX) at some other point and it therefore perfectly fit my use case. Your answer however definitely felt more like learning something fundamental and should be the preferred solution in cases where the order of type params is correct. So thanks for sharing."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1486002115, "last_edit_date": 1486002115, "creation_date": 1486001727, "answer_id": 41993174, "question_id": 41981611, "link": "https://stackoverflow.com/questions/41981611/bind-type-parameter/41993174#41993174", "title": "Bind type parameter", "body": "<p>The other answer shows the general case for converting type synonyms into things that can be used in instance declarations. But in this specific case it can be much simpler: since the index type is the same for all different matrices, you can supply just the arguments needed to get the kind correct. Thus:</p>\n\n<pre><code> type instance Key (Matrix a) = (Int, Int)\n</code></pre>\n\n<p>No extra type families relating Haskell and C types needed, no new types needed. This will also make working with the keys' library's API much simpler, as you won't need to do any newtype wrapping and unwrapping around each call.</p>\n"}], "owner": {"reputation": 1004, "user_id": 3088265, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/99c2e5db7086c4dc0a5bd9aada58f162?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Vock", "link": "https://stackoverflow.com/users/3088265/richard-vock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 1, "accepted_answer_id": 41982554, "answer_count": 2, "score": 1, "last_activity_date": 1486002115, "creation_date": 1485957518, "last_edit_date": 1485959994, "question_id": 41981611, "link": "https://stackoverflow.com/questions/41981611/bind-type-parameter", "title": "Bind type parameter", "body": "<p>I am currently working with the quite nice <a href=\"https://hackage.haskell.org/package/eigen\" rel=\"nofollow noreferrer\" title=\"haskell-eigen\">haskell-eigen</a> library and stumbled upon a fundamental yet probably basic problem (I am quite new to practical haskell development).</p>\n\n<p>I use their basic matrix type</p>\n\n<pre><code>data Matrix a b :: * -&gt; * -&gt; *\n</code></pre>\n\n<p>where a denotes the haskell and b the internal C type. This is realized via the restriction</p>\n\n<pre><code>Elem a b\n</code></pre>\n\n<p>with</p>\n\n<pre><code>Elem Double CDouble\nElem Float CFloat\n-- more for complex types...\n</code></pre>\n\n<p>Although not really the question I want to ask here I kind of don't understand why this is done this way. Since it is obviously a kind of functional mapping I already don't understand why this is formulated as an equivalency relation, but anyway...</p>\n\n<p>I now want to define (as a simple example - I got several) an instance of <a href=\"https://hackage.haskell.org/package/keys-3.11/docs/Data-Key.html%20Key\" rel=\"nofollow noreferrer\">Key</a> from the <a href=\"https://hackage.haskell.org/package/keys\" rel=\"nofollow noreferrer\" title=\"keys\">keys</a> package. It defines the index key for a given container, for example</p>\n\n<pre><code>type instance [] = Int\n</code></pre>\n\n<p>So instances of Key are defined over types of kind * -> *.</p>\n\n<p>However due to that requirement, this won't work:</p>\n\n<pre><code>type instance Key Matrix = (Int, Int)\n</code></pre>\n\n<p>I have to in some way make Matrix be of kind * -> *. So (coming from c++ where I would do this using traits classes), I tried this:</p>\n\n<pre><code>type family CType a where\n    CType Double = CDouble\n    CType Float = CFloat\n\ntype MatX a = Matrix a (CType a)\n</code></pre>\n\n<p>In other words I tried to use type synonyms as a means of realizing that above mentioned functional type map.</p>\n\n<p>Now I tried the following:</p>\n\n<pre><code>type instance Key MatX = (Int, Int)\n</code></pre>\n\n<p>which gives me \"The type synonym \u2018MatX\u2019 should have 1 argument, but has been given none\" and I even tried the obviously wrong</p>\n\n<pre><code>type instance Key (MatX a) = (Int, Int)\n</code></pre>\n\n<p>which gives me \"Expected kind * -> *, but MatX a has kind *\". This sounds to me like \"I the compiler expect a type with more than 0 but - being a type synonym - less than 1 argument\".</p>\n\n<p>So my question is: How does one commonly map types in haskell in order to solve such a kind mismatch or get rid of it in another way.</p>\n\n<p>P.S.: I am well aware that the eigen matrix has an indexing function, but </p>\n\n<ol>\n<li>I want it to be a common one with other data types</li>\n<li>I have this problem in other variants for other type instances.</li>\n</ol>\n\n<p><strong>Edit:</strong> Added reference links to mentioned packages.</p>\n"}, {"tags": ["haskell", "types", "type-kinds"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1485957907, "post_id": 41981432, "comment_id": 71141131, "body": "Tangential note: if you want to compare <code>floop</code> to the builtin generalisation, I suggest looking at the more general <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Traversable.html#v:sequenceA\" rel=\"nofollow noreferrer\"><code>sequenceA</code></a> rather than at <code>sequence</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1485958687, "post_id": 41981432, "comment_id": 71141689, "body": "Relevant: <a href=\"http://stackoverflow.com/q/31770710/2751851\"><i>What can we do with Alternative but cannot do with Monoid?</i></a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485959111, "post_id": 41981432, "comment_id": 71141987, "body": "(There are quite a few interesting questions about the relationship beetween <code>Alternative</code>, <code>MonadPlus</code> and <code>Monoid</code> that you might want to check as well. I linked to this one in particular because it is realtively brief and more clearly related to your concrete problem.)"}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485995001, "post_id": 41981432, "comment_id": 71161576, "body": "@duplode Thanks for the link, it helped me realise what I was doing wrong with <code>Monoid t</code>. I hadn&#39;t realised that <code>Monoid a</code> is a &#39;concrete&#39; type, not a type constructor like <code>Foldable t</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1486000818, "post_id": 41981432, "comment_id": 71163101, "body": "For what it&#39;s worth, you can <i>also</i> fix this just by changing <code>Monoid t</code> to <code>Monoid (t a)</code> everywhere (and upgrading <code>Functor t</code> to <code>Applicative t</code> everywhere, but that&#39;s not relevant to your actual question)."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1486001656, "post_id": 41981432, "comment_id": 71163321, "body": "Thanks, yeah, that would have worked too. I actually noticed that t doesn&#39;t even need to be a <code>Functor</code>. I use <code>fmap</code> on the <code>Maybe</code>, not on <code>t</code>"}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 9, "last_activity_date": 1485958872, "creation_date": 1485958872, "answer_id": 41982040, "question_id": 41981432, "link": "https://stackoverflow.com/questions/41981432/restricting-type-parameter-to-monoid/41982040#41982040", "title": "Restricting type parameter to Monoid", "body": "<p>Monoidal applicatives are described by the <code>Alternative</code> class, using <code>(&lt;|&gt;)</code> and <code>empty</code> instead of <code>mappend</code> and <code>mempty</code>:</p>\n\n<pre><code>floop :: (Foldable t, Alternative t) =&gt; t (Maybe a) -&gt; Maybe (t a)\nfloop xs = let\n                f :: (Foldable t, Alternative t) =&gt; Maybe a -&gt; Maybe (t a) -&gt; Maybe (t a)\n                f Nothing _ = Nothing\n                f (Just x) ys = fmap ((&lt;|&gt;) $ pure x) ys\n            in\n                foldr f (Just empty) xs \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 1, "creation_date": 1485994173, "post_id": 41986867, "comment_id": 71161339, "body": "This works perfectly, and I love that it is considerably more general; however I don&#39;t quite understand how <code>step</code> and <code>liftA2</code> work. Is <code>liftA2</code> similar to <code>fmap</code>? (though I notice that it has a higher arity)"}, {"owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 1, "creation_date": 1486033535, "post_id": 41986867, "comment_id": 71177449, "body": "Lets look at the signature of fmap, with some brackets added for clarity: <code>(a -&gt; b) -&gt; (f a -&gt; f b)</code>. We could see that as lifting a function so that it works over f&#39;s. This only works for functions with 1 argument, though. If we fmap <code>+1</code> over <code>Just 1</code> we get  <code>Just (+1)</code> and can&#39;t continue with fmap. So instead we use the function <code>&lt;*&gt;</code> from Applicative which unpacks both sides before applying: <code>Just (+1) &lt;*&gt; Just 2 == Just 3</code>. There is also an operator form for fmap, <code>&lt;$&gt;</code>. Then we get <code>liftA2 f a b = f &lt;$&gt; a &lt;*&gt; b</code>! So your intuition is correct, liftA2 is basically fmap for two arguments."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1486119447, "post_id": 41986867, "comment_id": 71219212, "body": "I presume in that first example you mean to fmap <code>+</code> over <code>Just 1</code>. As for <code>&lt;*&gt;</code>, am I correct in thinking that <code>(Just f) &lt;*&gt; (Just x) == f &lt;$&gt; (Just x)</code>?   So <code>liftA2 f a b</code> conceptually maps <code>f</code> over <code>a</code>, unwraps the result, then maps that over <code>b</code>?"}, {"owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 1, "creation_date": 1486148035, "post_id": 41986867, "comment_id": 71236734, "body": "You got it! Similarly you could also implement fmap/&lt;$&gt; using only applicative, as <code>fmap f a = pure f &lt;*&gt; a</code>."}], "tags": [], "owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "is_accepted": false, "score": 3, "last_activity_date": 1485973167, "creation_date": 1485973167, "answer_id": 41986867, "question_id": 41981432, "link": "https://stackoverflow.com/questions/41981432/restricting-type-parameter-to-monoid/41986867#41986867", "title": "Restricting type parameter to Monoid", "body": "<p>This might be a good place to bring up <a href=\"https://www.haskell.org/hoogle/?hoogle=t+%28m+a%29-%3E+m+%28t+a%29\" rel=\"nofollow noreferrer\">hoogle</a>.</p>\n\n<p>Searching for <code>t (m a)-&gt; m (t a)</code> returns <code>sequenceA :: (Traversable t, Applicative f) =&gt; t (f a) -&gt; f (t a)</code> as the first result. This then leads to the Traversable type class which is fairly close to what you are looking for.</p>\n\n<p>As Lee said you could use the Alternative class which is the Applicative equivalent of Monoid. Slightly more generalized:</p>\n\n<pre><code>sequence' :: (Alternative t, Foldable t, Applicative a) =&gt; t (a b) -&gt; a (t b)\nsequence' = foldr step (pure empty)\n  where step = liftA2 prepend\n        prepend = (&lt;|&gt;) . pure\n</code></pre>\n\n<p>Here prepend first wraps some single element into t so it can use (&lt;|>) to prepend it. liftA2 lets us abstract over the applicative a, you can imagine it as unwrapping two arguments, applying them to prepend and wrapping the result back up.</p>\n"}], "owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 41982040, "answer_count": 2, "score": 3, "last_activity_date": 1485973167, "creation_date": 1485956980, "question_id": 41981432, "link": "https://stackoverflow.com/questions/41981432/restricting-type-parameter-to-monoid", "title": "Restricting type parameter to Monoid", "body": "<p>I've previously defined a function which takes a list of <code>Maybe</code>s and turns it into a <code>Maybe</code> of a list, like so:</p>\n\n<pre><code>floop :: [Maybe a] -&gt; Maybe [a]\nfloop [] = Just []\nfloop (Nothing:_) = Nothing\nfloop (Just x:xs) = fmap (x:) $ floop xs\n</code></pre>\n\n<p>Now I want to redefine it to be compatible with a larger class of containers, not just lists, and I've found that it needs to implement the functions <code>foldr</code>, <code>mappend</code>, <code>mempty</code>, <code>fmap</code> , and <code>pure</code>; so I figure that the following type line would be appropriate:</p>\n\n<pre><code>floop :: (Foldable t, Functor t, Monoid t) =&gt; t (Maybe a) -&gt; Maybe (t a)\n</code></pre>\n\n<p>As (I think) it ensures that those functions are implemented for the given container, however it leads to the following error:</p>\n\n<pre><code>Expecting one more argument to \u2018t\u2019\nThe first argument of \u2018Monoid\u2019 should have kind \u2018*\u2019,\n  but \u2018t\u2019 has kind \u2018* -&gt; *\u2019\nIn the type signature for \u2018floop'\u2019:\n  floop' :: (Foldable t, Functor t, Monoid t) =&gt;\n            t (Maybe a) -&gt; Maybe (t a)\n</code></pre>\n\n<p>After looking into it, I found <code>Monoid</code>'s kind is different to that of <code>Functor</code> and <code>Foldable</code>, but I can't see why that would be the case, nor how to correct the error.</p>\n\n<p>For those interested, here's the current implementation:</p>\n\n<pre><code>floop :: (Foldable t, Functor t, Monoid t) =&gt; t (Maybe a) -&gt; Maybe (t a)\nfloop xs = let\n                f :: (Foldable t, Functor t, Monoid t) =&gt; Maybe a -&gt; Maybe (t a) -&gt; Maybe (t a)\n                f Nothing _ = Nothing\n                f (Just x) ys = fmap (mappend $ pure x) ys\n            in\n                foldr f (Just mempty) xs\n</code></pre>\n\n<p>Note: I have been made aware that this already exists as a builtin function (<code>sequence</code>), but I intend to implement it as a learning exercise.</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1485956137, "post_id": 41980356, "comment_id": 71139871, "body": "This is an interesting question about typeclass trickery. However, in your concrete use case you might want to consider ditching the <code>Slide</code> class, giving <code>Coordinate x</code> a <code>Num</code> instance and writing <code>newX 2 + newX 3</code>, or even <code>2 + 3 :: Coordinate X</code>."}, {"owner": {"reputation": 2322, "user_id": 33841, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/5xaqb.jpg?s=128&g=1", "display_name": "kmelvn", "link": "https://stackoverflow.com/users/33841/kmelvn"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485957191, "post_id": 41980356, "comment_id": 71140648, "body": "@duplode I&#39;m translating some Python code and would like to keep the same API, but add some type safety on top. Now that I see the answer, it doesn&#39;t look that terribly tricky actually (compared to some other things I&#39;ve seen :&gt;)."}], "answers": [{"comments": [{"owner": {"reputation": 2322, "user_id": 33841, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/5xaqb.jpg?s=128&g=1", "display_name": "kmelvn", "link": "https://stackoverflow.com/users/33841/kmelvn"}, "edited": false, "score": 0, "creation_date": 1485957013, "post_id": 41981168, "comment_id": 71140527, "body": "Thanks, this is just what I came up with few minutes ago, with the help from #haskell channel. Seems to work just fine! Btw, <code>FlexibleInstances</code> are also required, right?"}, {"owner": {"reputation": 2322, "user_id": 33841, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/5xaqb.jpg?s=128&g=1", "display_name": "kmelvn", "link": "https://stackoverflow.com/users/33841/kmelvn"}, "edited": false, "score": 0, "creation_date": 1485957098, "post_id": 41981168, "comment_id": 71140587, "body": "My use case is in converting some Python code to Haskell, I wanted to keep the API the same but add some type safety. Thanks once again..."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 2322, "user_id": 33841, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/5xaqb.jpg?s=128&g=1", "display_name": "kmelvn", "link": "https://stackoverflow.com/users/33841/kmelvn"}, "edited": false, "score": 1, "creation_date": 1485960074, "post_id": 41981168, "comment_id": 71142651, "body": "added the missing extensions"}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 5, "last_activity_date": 1485976056, "last_edit_date": 1485976056, "creation_date": 1485956180, "answer_id": 41981168, "question_id": 41980356, "link": "https://stackoverflow.com/questions/41980356/type-class-instance-with-more-restrictive-signature/41981168#41981168", "title": "Type class instance with more restrictive signature", "body": "<p>Consider what this class declaration is stating:</p>\n\n<pre><code>class Slide a where\n  slide :: Coordinate x -&gt; a -&gt; Coordinate x\n</code></pre>\n\n<p>for <em>any</em> type <code>x</code>, an instance of <code>Slide</code> promises that given a <code>Coordinate x</code> and an <code>a</code>, it will give you back a <code>Coordinate x</code>. Right there is your problem. You don't want <em>any</em> <code>x</code> all the time.</p>\n\n<p>I think the easiest way to achieve what you want is with a second type class parameter for the coordinate type:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nclass Slide x a where\n  slide :: Coordinate x -&gt; a -&gt; Coordinate x\n\ninstance Slide X Int64 where\n  slide = slideByInt\n\ninstance Slide Y Int64 where\n  slide = slideByInt\n\ninstance Slide X (Coordinate X) where\n  slide = slideByCoord\n\ninstance Slide Y (Coordinate Y) where\n  slide = slideByCoord\n</code></pre>\n\n<p>The last two instances can actually be replaced with this more general instance:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\ninstance (a ~ b) =&gt; Slide a (Coordinate b) where\n  slide = slideByCoord\n</code></pre>\n\n<p>For what it's worth, I like to avoid using typeclasses in this manner. I don't think the immediate convenience of overloaded functions is worth the boilerplate and long-term maintenance burden. But that's just my opinion.</p>\n"}], "owner": {"reputation": 2322, "user_id": 33841, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/5xaqb.jpg?s=128&g=1", "display_name": "kmelvn", "link": "https://stackoverflow.com/users/33841/kmelvn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 41981168, "answer_count": 1, "score": 2, "last_activity_date": 1485976056, "creation_date": 1485953666, "last_edit_date": 1485955358, "question_id": 41980356, "link": "https://stackoverflow.com/questions/41980356/type-class-instance-with-more-restrictive-signature", "title": "Type class instance with more restrictive signature", "body": "<p>Let's say I'm writing a data type to represent a coordinate in a cartesian coordinate system. I'd like to define functions on that data type and use Haskell type checking to prevent mixing up numbers that lie on x axis with the numbers on the y axis.</p>\n\n<p>Here's the data type definition, with a phantom type that tracks the coordinate axis and two functions to construct the values:</p>\n\n<pre><code>data X\ndata Y\n\nnewtype Coordinate axis = Coordinate Int64 deriving (Show)\n\nnewX :: Int64 -&gt; Coordinate X\nnewX = Coordinate\n\nnewY :: Int64 -&gt; Coordinate Y\nnewY = Coordinate\n</code></pre>\n\n<p>Let's define a sliding function that slides the coordinate, either by Int value or another Coordinate value. In the first case the coordinate should keep its axis and in the second case both arguments should have the same axis:</p>\n\n<pre><code>slideByInt :: Coordinate a -&gt; Int64 -&gt; Coordinate a\nslideByInt (Coordinate x) y = Coordinate $ x + y\n\nslideByCoord :: Coordinate a -&gt; Coordinate a -&gt; Coordinate a\nslideByCoord (Coordinate x) (Coordinate y) = Coordinate (x + y)\n</code></pre>\n\n<p>This all works great and it prevents me from confusing X and Y axis in functions that manipulate Coordinates.</p>\n\n<p>My question is: how would I wrap <code>slideByInt</code> and <code>slideByCoord</code> functionality behind a class, so that I can have just with the <code>slide</code> function. This compiles:</p>\n\n<pre><code>class Slide a where\n  slide :: Coordinate x -&gt; a -&gt; Coordinate x\n\ninstance Slide Int64 where\n  slide (Coordinate x) y = Coordinate (x + y)\n\ninstance Slide (Coordinate x) where\n  slide (Coordinate x) (Coordinate y) = Coordinate (x + y)\n</code></pre>\n\n<p>but it's not as type safe as the standalone functions: <code>slide (newX 1) (newY 1)</code> should not type check! How would one go about fixing this, in a sense, how can I make the instance for two Coordinates less permissive than it is?</p>\n\n<p>I've tried with a bunch of extensions (InstanceSigs, FunctionalDependencies, type constraints...) but nothing compiles and it's hard to tell if that's the wrong way completely or I just have to tweak my code a little bit.</p>\n\n<p>Thanks...</p>\n"}, {"tags": ["haskell", "gtk", "glade"], "comments": [{"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1485956486, "post_id": 41977418, "comment_id": 71140113, "body": "<code>read</code> from Prelude converts a string into whatever you want. You&#39;ll have to slap on a type annotation to tell the compiler which type you expect to get from it."}, {"owner": {"reputation": 17, "user_id": 3602752, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/98Jow.jpg?s=128&g=1", "display_name": "Saidar", "link": "https://stackoverflow.com/users/3602752/saidar"}, "reply_to_user": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1486123428, "post_id": 41977418, "comment_id": 71221613, "body": "thanks .... now i have another error........ let x = (read credit1 :: Float)+(read credit2 :: Float) set creditText [ entryText := &quot;&quot;+(read x :: String) ] ....... Couldn&#39;t match type Float with [Char]"}, {"owner": {"reputation": 17, "user_id": 3602752, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/98Jow.jpg?s=128&g=1", "display_name": "Saidar", "link": "https://stackoverflow.com/users/3602752/saidar"}, "reply_to_user": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1486123870, "post_id": 41977418, "comment_id": 71221897, "body": "problem solved by using <code>show</code> ....... my fixed code is: <code>let x = (read credit1 :: Float)+(read credit2 :: Float)         set creditText [ entryText := &quot;&quot;++(show x) ]</code>"}], "owner": {"reputation": 17, "user_id": 3602752, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/98Jow.jpg?s=128&g=1", "display_name": "Saidar", "link": "https://stackoverflow.com/users/3602752/saidar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1485945066, "creation_date": 1485945066, "question_id": 41977418, "link": "https://stackoverflow.com/questions/41977418/haskell-gtk-glade-read-strings-from-entrys-and-then-print-the-sum", "title": "(Haskell/GTK/Glade) read strings from entrys and then print the sum", "body": "<p>i created a gui program using haskell + GTK + Glade</p>\n\n<p>the gui looks like this:\n<a href=\"https://i.stack.imgur.com/WRXIf.png\" rel=\"nofollow noreferrer\">https://i.stack.imgur.com/WRXIf.png</a></p>\n\n<p>i want to display the sum of the credit hours but the problem is it concatenates the numbers instead of calculating the sum (screenshot: <a href=\"https://i.stack.imgur.com/WRXIf.png\" rel=\"nofollow noreferrer\">https://i.stack.imgur.com/WRXIf.png</a> )</p>\n\n<p>my code:</p>\n\n<pre><code>import Graphics.UI.Gtk\nimport Graphics.UI.Gtk.Glade\n\nmain = do\n    initGUI\n    Just xml    &lt;- xmlNew \"program.glade\"\n    window      &lt;- xmlGetWidget xml castToWindow \"window1\"\n    onDestroy window mainQuit\n\n    closeButton &lt;- xmlGetWidget xml castToButton \"button2\"\n    onClicked closeButton $ do\n        widgetDestroy window\n\n\n    entry1credit       &lt;- xmlGetWidget xml castToEntry \"entry13\"\n\n    entry2credit       &lt;- xmlGetWidget xml castToEntry \"entry14\"\n\n    entry3credit       &lt;- xmlGetWidget xml castToEntry \"entry15\"\n\n    entry4credit       &lt;- xmlGetWidget xml castToEntry \"entry16\"\n\n    entry5credit       &lt;- xmlGetWidget xml castToEntry \"entry17\"\n\n    entry6credit       &lt;- xmlGetWidget xml castToEntry \"entry18\"\n\n    creditText       &lt;- xmlGetWidget xml castToEntry \"entry19\"\n    calcButton &lt;- xmlGetWidget xml castToButton \"button1\"\n\n    onClicked calcButton $ do\n        credit1 &lt;- get entry1credit entryText\n        credit2 &lt;- get entry2credit entryText\n        credit3 &lt;- get entry3credit entryText\n        credit4 &lt;- get entry4credit entryText\n        credit5 &lt;- get entry5credit entryText\n        credit6 &lt;- get entry6credit entryText\n    let a = credit1++credit2++credit3++credit4++credit5++credit6\n        set creditText [ entryText := \"\"++a ]\n    widgetShowAll window\n    mainGUI\n</code></pre>\n\n<p>the problem is at this part ,,, i don't know how to convert string to int in haskell :</p>\n\n<pre><code>onClicked calcButton $ do\n            credit1 &lt;- get entry1credit entryText\n            credit2 &lt;- get entry2credit entryText\n            credit3 &lt;- get entry3credit entryText\n            credit4 &lt;- get entry4credit entryText\n            credit5 &lt;- get entry5credit entryText\n            credit6 &lt;- get entry6credit entryText\n        let a = credit1++credit2++credit3++credit4++credit5++credit6\n            set creditText [ entryText := \"\"++a ]\n</code></pre>\n"}, {"tags": ["haskell", "type-constraints", "gadt"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1485985960, "post_id": 41976077, "comment_id": 71158135, "body": "\u201cThe key point about GADTs is that pattern matching causes type refinement.\u201d \u2014 <a href=\"https://downloads.haskell.org/~ghc/8.0.1-rc2/docs/html/users_guide/glasgow_exts.html#generalised-algebraic-data-types-gadts\" rel=\"nofollow noreferrer\">GHC Users Guide</a>. When you use pattern matching with an equation or <code>case</code>, the typechecker has an obvious scope in which to locally refine the type and add constraints to the context. The record accessor doesn\u2019t \u201cleak\u201d the constraints to the surrounding context."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485944234, "post_id": 41976251, "comment_id": 71131933, "body": "Indeed: pattern matching against <code>T</code> forces evaluation, so the typeclass dictionary can be extracted. Instead, application such as <code>f (getT y)</code> does not force the evaluation of <code>y</code>, since <code>f</code> might be lazy. So, in order to accept this, the compiler should either 1) evaluate the argument and break laziness (programmers will be astonished to discover this!) or 2) proceed with a &quot;lazy dictionary&quot;, that would evaluate the argument as soon it is accessed (still somewhat astonishing). It&#39;s better to reject the code (or at least to introduce special types for this behavior)."}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485989922, "post_id": 41976251, "comment_id": 71159933, "body": "@chi, I&#39;m not so sure that this has to do with evaluation. More that the <code>T</code> constructor actually contains the dictionary for the <code>C a</code> while <code>getT</code> only extracts the <code>a</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485993433, "post_id": 41976251, "comment_id": 71161087, "body": "Well, you can&#39;t extract the dictionary until you reduce the expression to WHNF and expose the <code>T</code> constructor."}], "tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": false, "score": 7, "last_activity_date": 1485942699, "last_edit_date": 1485942699, "creation_date": 1485941552, "answer_id": 41976251, "question_id": 41976077, "link": "https://stackoverflow.com/questions/41976077/gadt-record-function-fails-where-deconstruction-succeeds/41976251#41976251", "title": "GADT record function fails where deconstruction succeeds", "body": "<p>What happens here is that the pattern match</p>\n\n<pre><code>g (T x) = f x\n</code></pre>\n\n<p>tells the typechecker that you have satisfied the constraint <code>C a</code> so you can use <code>f</code>. Without the pattern match you never introduce <code>C a</code> so it cannot satisfy the constraint.</p>\n\n<p>It works such that a value <code>T something :: T a</code> also includes the dictionary for <code>C a</code> and makes it available when pattern matching on <code>T</code>. However, using <code>getT</code> does not give you any way to get at the dictionary for <code>C a</code> (as you can see from the type of <code>getT :: T a -&gt; a</code>).</p>\n\n<hr>\n\n<p>For posterity the error is</p>\n\n<pre><code>\u2022 No instance for (C a) arising from a use of \u2018f\u2019\n  Possible fix:\n    add (C a) to the context of\n      the type signature for:\n        g :: T a -&gt; ()\n\u2022 In the expression: f (getT x)\n  In an equation for \u2018g\u2019: g x = f (getT x)\n  In the instance declaration for \u2018D T\u2019\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1485942699, "creation_date": 1485941061, "question_id": 41976077, "link": "https://stackoverflow.com/questions/41976077/gadt-record-function-fails-where-deconstruction-succeeds", "title": "GADT record function fails where deconstruction succeeds", "body": "<p>I'm trying to wrap my head around GADTs, and I suspect some magic is going on I don't understand.</p>\n\n<p>Consider the following:</p>\n\n<pre><code>class C t\n\ndata T a where\n  T :: (C a) =&gt; { getT :: a } -&gt; T a\n\nf :: C a =&gt; a -&gt; ()\nf = undefined\n\nclass D t where\n  g :: t a -&gt; ()\n\ninstance D T where\n  g (T x) = f x\n</code></pre>\n\n<p>This is all good and compiles successfully.</p>\n\n<p>Now consider a slightly different instance definition for T:</p>\n\n<pre><code>instance D T where\n  g x = f (getT x)\n</code></pre>\n\n<p>This looks exactly the same as above, but there's a compile error. What's happening here? The data type <code>T</code> has no existential variables, it does have a simple constraint for it's only constructor but that's it. </p>\n"}, {"tags": ["haskell", "rank-n-types"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485941302, "post_id": 41975874, "comment_id": 71130042, "body": "Ignore the first argument altogether: <code>f3 _ = id</code>."}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485941402, "post_id": 41975874, "comment_id": 71130100, "body": "Something slightly more complicated, possibly with all the parameters defined."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1485941665, "post_id": 41975874, "comment_id": 71130273, "body": "Here is the thing: <code>forall a. a -&gt; a</code> has only one (non-diverging) member: <code>id</code>. Then, there isn&#39;t anything interesting to do with the argument in <code>(forall a. a -&gt; a) -&gt; Int</code>  - you already know it can only be <code>id</code>, so <code>(forall a. a -&gt; a) -&gt; Int</code> has to be some constant function. There is a bijection between the interesting (non-diverging) implementations of <code>f3</code> and implementations of <code>f3&#39; :: Int -&gt; Bool -&gt; Bool</code>."}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485941996, "post_id": 41975874, "comment_id": 71130502, "body": "Yes, you are right. Indeed I was not able to pass a meaningful parameter to it unless using some constant as you said. How can I change the signature to something more interesting? Replacing <code>Int</code> with a generic <code>b</code> I guess? and then eventually passing <code>b</code> as Bool and do a simple <code>&amp;&amp;</code> with the other <code>Bool</code> parameter right?"}], "answers": [{"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1485946175, "post_id": 41976729, "comment_id": 71133326, "body": "actually how do you call <code>f3</code>, <code>f4</code> and <code>f5</code>? Which parameters you pass them?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1485950234, "post_id": 41976729, "comment_id": 71135928, "body": "@Randomize Added a few examples."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1485950218, "last_edit_date": 1485950218, "creation_date": 1485943060, "answer_id": 41976729, "question_id": 41975874, "link": "https://stackoverflow.com/questions/41975874/rank-3-types-function-example/41976729#41976729", "title": "Rank 3 Types function example", "body": "<pre><code>f3 :: ((forall a. a -&gt; a) -&gt; Int) -&gt; Bool -&gt; Bool\nf3 f b = (f id == 3) &amp;&amp; b\n\nf3_ex :: Bool\nf3_ex = f3 f True where\n   f :: (forall a. a -&gt; a) -&gt; Int\n   f g = g 3\n</code></pre>\n\n<p>Changing the type to be more interesting, as mentioned in the comments:</p>\n\n<pre><code>f4 :: ((forall a. a -&gt; a -&gt; a) -&gt; Int) -&gt; Bool -&gt; Bool\nf4 f b = (f const == 3) &amp;&amp; b\n\nf4_ex :: Bool\nf4_ex = f4 f True where\n   f :: (forall a. a -&gt; a -&gt; a) -&gt; Int\n   f g = g 3 5\n\n\nf5 :: ((forall a. a -&gt; a -&gt; a) -&gt; Int) -&gt; Bool -&gt; Bool\nf5 f b = f (if b then const else const id) == 42\n\nf5_ex :: Bool\nf5_ex = f5 f True where\n   f :: (forall a. a -&gt; a -&gt; a) -&gt; Int\n   f g = g 3 5 + 39\n</code></pre>\n\n<p>Here <code>f</code> is essentially of type <code>(Int, Int)</code>, the first component given by <code>f const</code> and the other one given by <code>f (const id)</code> or equivalently <code>f (flip const)</code>.</p>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "accepted_answer_id": 41976729, "answer_count": 1, "score": 0, "last_activity_date": 1485950218, "creation_date": 1485940391, "question_id": 41975874, "link": "https://stackoverflow.com/questions/41975874/rank-3-types-function-example", "title": "Rank 3 Types function example", "body": "<p>I have this Rank 3 Type function definition:</p>\n\n<pre><code>f3 :: ((forall a. a -&gt; a) -&gt; Int) -&gt; Bool -&gt; Bool\nf3 .... = ?\n</code></pre>\n\n<p>and I am struggling to write a simple example for it. Can you help?</p>\n"}, {"tags": ["haskell", "if-statement"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1485921760, "post_id": 41971659, "comment_id": 71121610, "body": "Hint 1: why don&#39;t you write <code>if (y%2 = 0) { ... }</code> in Java? \u2014 Hint 2: 1\u22600 \u2014 Hint 3: there&#39;s a reason you need that integer cast in Java. As it stands, you&#39;d need that in Haskell to (though you could well change the algorithm so this woundn&#39;t be necessary)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1485921948, "post_id": 41971659, "comment_id": 71121668, "body": "Is <code>x `mod` 1</code> a typo?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1485922004, "post_id": 41971659, "comment_id": 71121686, "body": "The equality operator is <code>==</code>, not <code>=</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1485922031, "post_id": 41971659, "comment_id": 71121690, "body": "I mean, why don&#39;t you write <code>if (y%2</code> <b><code>=</code></b> <code>0)</code> in Java? (And I meant 1\u22602, not 1\u22600.)"}, {"owner": {"reputation": 173, "user_id": 1491774, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/V6fYt.jpg?s=128&g=1", "display_name": "dark_st3alth", "link": "https://stackoverflow.com/users/1491774/dark-st3alth"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1485922291, "post_id": 41971659, "comment_id": 71121754, "body": "@chepner do you mean <code>if y &#39;mod&#39; 2 = 1</code> should be <code>if y &#39;mod&#39; 2 == 1</code> ?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 2, "creation_date": 1485922859, "post_id": 41971659, "comment_id": 71121913, "body": "Yes. Exactly as in Java, double <code>==</code> is an operator for testing equality (computing a boolean value), while single <code>=</code> is dedicated syntax (in Java it&#39;s for an assignment operation, in Haskell it&#39;s for providing a definition)."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485941655, "post_id": 41971659, "comment_id": 71130270, "body": "Aren&#39;t you supposed to call <code>fastExp1</code> recursively instead of calling <code>Math.pow</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1485923830, "post_id": 41971896, "comment_id": 71122207, "body": "And here&#39;s how it would better be written: <code>fastExp2 x y | (y&#39;,0) &lt;- y`divMod`2     = (x^y&#39;)^2</code> <code>| otherwise = x * x^(y-1)</code>."}, {"owner": {"reputation": 173, "user_id": 1491774, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/V6fYt.jpg?s=128&g=1", "display_name": "dark_st3alth", "link": "https://stackoverflow.com/users/1491774/dark-st3alth"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1485924085, "post_id": 41971896, "comment_id": 71122275, "body": "@leftaroundabout I should have formatted that correctly, tell me if I got it wrong."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1485943838, "post_id": 41971896, "comment_id": 71131684, "body": "In <code>if</code>s indentation is semantically irrelevant, and the compiler will be happy with anything. However, for humans, indenting <code>else 0</code> the same as the first <code>if</code> looks misleading since that is the <code>else</code> for the second <code>if</code>. I would indent such a chain of <code>if&#47;then&#47;else</code> at the same level."}], "tags": [], "owner": {"reputation": 173, "user_id": 1491774, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/V6fYt.jpg?s=128&g=1", "display_name": "dark_st3alth", "link": "https://stackoverflow.com/users/1491774/dark-st3alth"}, "is_accepted": true, "score": 2, "last_activity_date": 1485925718, "last_edit_date": 1485925718, "creation_date": 1485923234, "answer_id": 41971896, "question_id": 41971659, "link": "https://stackoverflow.com/questions/41971659/haskell-if-statement-condition/41971896#41971896", "title": "Haskell If Statement Condition", "body": "<p>As pointed out in the comments (chepner &amp; Ben), Haskell uses <code>==</code> for comparison where as <code>=</code> is used for definitions.</p>\n\n<p>For future readers, here is the completed code:</p>\n\n<pre><code>fastExp1 :: Integer -&gt; Integer -&gt; Integer\nfastExp1 x y =\n    if y `mod` 2 == 1\n      then x * x^(y-1)\n      else if y `mod` 2 == 0\n      then (x^(y `div` 2))^2\n    else 0\n\nfastExp2 :: Integer -&gt; Integer -&gt; Integer\nfastExp2 x y | (y `mod` 2 == 0)     = (x^(y `div` 2))^2\n             | (y `mod` 2 == 1)     = x * x^(y-1)\n             | otherwise = 0\n</code></pre>\n\n<p>As suggested by <em>leftaroundabout</em>, fastExp2 can also be done by:</p>\n\n<pre><code>fastExp2 x y | (y',0) &lt;- y`divMod`2 = (x^y')^2\n             | otherwise = x * x^(y-1)\n</code></pre>\n"}], "owner": {"reputation": 173, "user_id": 1491774, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/V6fYt.jpg?s=128&g=1", "display_name": "dark_st3alth", "link": "https://stackoverflow.com/users/1491774/dark-st3alth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2694, "favorite_count": 0, "accepted_answer_id": 41971896, "answer_count": 1, "score": 0, "last_activity_date": 1485925718, "creation_date": 1485921617, "question_id": 41971659, "link": "https://stackoverflow.com/questions/41971659/haskell-if-statement-condition", "title": "Haskell If Statement Condition", "body": "<p>This is my first time getting into the more \"academic\" programming languages. Coming from the land of Java/C, I'm having quite some issues with If statements in Haskell. It seems all the examples use a single argument, and a simple gt, ls, or eq for comparisons.</p>\n\n<p>What I'm attempting to do is check if a function's argument is even or odd, then return a value based off that result. This is to speed up the calculation of an exponent, as:</p>\n\n<blockquote>\n  <p>n^k = (n^(k/2))^2 if k is even</p>\n  \n  <p>n^k = n * n^(k-1) if k is odd</p>\n</blockquote>\n\n<p>Here's what I have so far:</p>\n\n<pre><code>fastExp1 :: Integer -&gt; Integer\nfastExp1 x y =\n    if y `mod` 2 = 1\n        then x * x^(y-1)\n    else if y `mod` 2 = 0\n        then (x^(y/2))^2\n    else 0\n</code></pre>\n\n<p>I've tried to build it using guarded equations, but I just can't seem to get my head around how to build it:</p>\n\n<pre><code>fastExp2 :: Integer -&gt; Integer\nfastExp2 x y | (x `mod` 1) = 0     = (x^(y/2))^2\n             | (x `mod` 1) = 1     = x * x^(y-1)\n             | otherwise = 0\n</code></pre>\n\n<p>In Java, this isn't really any issue:</p>\n\n<pre><code>public static int fastExp1 (int x, int y) {\n    if (y%2 == 0) {\n        // The exponent was even.\n        return (int) Math.pow((Math.pow(x,(y/2))), 2);\n    } else if (y%2 == 1) {\n        // The exponent was odd.\n        return (int) Math.pow((x*x), (y-1));\n    } else {\n        return 0;\n    }\n}\n</code></pre>\n\n<p>I can confirm that the Java code works as intended, but with the Haskell I get:</p>\n\n<blockquote>\n  <p>C:\\hello.hs:16:5:</p>\n  \n  <p>parse error in if statement: missing required then and else clauses </p>\n  \n  <p>Failed, modules loaded: none.</p>\n</blockquote>\n"}, {"tags": ["haskell", "mapping"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1485895864, "post_id": 41967182, "comment_id": 71113244, "body": "Because Haskell is static, you can also check the type in GHCi. Notice that <code>:t fun2</code> gives you just a number - not a function. It turns out <code>-</code> is special (it is the only special operator in the language). <code>(-3)</code> is sugar for <code>negate 3</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485896037, "post_id": 41967182, "comment_id": 71113351, "body": "Another relevant question: <a href=\"http://stackoverflow.com/questions/6224212/no-instance-for-error\">stackoverflow.com/questions/6224212/no-instance-for-error</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485909771, "post_id": 41967182, "comment_id": 71118624, "body": "A general comment on the attitude displayed here: <a href=\"http://www.catb.org/~esr/faqs/smart-questions.html#symptoms\" rel=\"nofollow noreferrer\">you don&#39;t know what&#39;s wrong, so how do you know it is the static nature of Haskell that is giving you this headache</a>?"}, {"owner": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485912968, "post_id": 41967182, "comment_id": 71119402, "body": "@DanielWagner It&#39;s the error message that really shows the static nature. In a dynamic language it would probably result in an error message like &quot;Tried to call a non-function&quot;, which would be much more self-explanatory, instead of speaking of constraints and &quot;non-type variable arguments&quot;."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1485915531, "post_id": 41967182, "comment_id": 71120087, "body": "@hgiesel The reason the error message is so terrible combines many parts of Haskell&#39;s nature -- chiefly its polymorphism, section syntax, and a small wart around number literal syntax -- but not really its statically-typed nature. Compare e.g. the error from <code>map True [1,2,3]</code>, which does essentially say &quot;tried to call a non-function&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1485898761, "post_id": 41967239, "comment_id": 71114682, "body": "The <code>Prelude</code> function <code>subtract</code> was added precisely to achieve what <code>(-3)</code> would be if it were a section. One can <code>map (subtract 3) xs</code> for instance."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1485897266, "last_edit_date": 1485897266, "creation_date": 1485895825, "answer_id": 41967239, "question_id": 41967182, "link": "https://stackoverflow.com/questions/41967182/mapping-over-a-list-in-haskell-non-type-variable-argument-in-constraint/41967239#41967239", "title": "Mapping over a list in Haskell: Non-type variable argument in constraint", "body": "<p>Actually it is more the syntax than the type system here that gives you a headache. That's because <code>(-3)</code> actually is the number \"<em>minus three</em>\":</p>\n\n<pre><code>fun2 :: Num a =&gt; a\n</code></pre>\n\n<p>So the problem is you do not really provide a function, but more a constant.</p>\n\n<p>You could for instance solve it by writing:</p>\n\n<pre><code>let fun2 = \\x -&gt; x-3\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>let fun2 = (+) (-3)\n</code></pre>\n\n<blockquote>\n  <p>The static nature of Haskell really gives me headaches...</p>\n</blockquote>\n\n<p>Actually I sleep a lot better when programs are written in Haskell since in dynamically typed languages you often have \"<em>werewolf-days</em>\": days where all goes wrong.</p>\n"}], "owner": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "closed_date": 1485895789, "accepted_answer_id": 41967239, "answer_count": 1, "score": 2, "last_activity_date": 1485897266, "creation_date": 1485895595, "question_id": 41967182, "link": "https://stackoverflow.com/questions/41967182/mapping-over-a-list-in-haskell-non-type-variable-argument-in-constraint", "closed_reason": "Duplicate", "title": "Mapping over a list in Haskell: Non-type variable argument in constraint", "body": "<pre><code>let fun1  = (+3)\nlet fun2  = (-3)\nlet range = [1,2,3,3]\nlet a = map fun1 range\nlet b = map fun2 a\n</code></pre>\n\n<p>This gives me an error:</p>\n\n<blockquote>\n  <p>Non-type variable argument in the constraint: Num (a -> b)</p>\n</blockquote>\n\n<p>The static nature of Haskell really gives me headaches...</p>\n"}, {"tags": ["haskell", "exception-handling", "monad-transformers"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1485980858, "post_id": 41966893, "comment_id": 71155515, "body": "Readers interested in this question should also consider Snoyman&#39;s <a href=\"https://www.fpcomplete.com/blog/2016/11/exceptions-best-practices-haskell\" rel=\"nofollow noreferrer\"><i>Exceptions Best Practices in Haskell</i></a> for an opinion on why <code>IO (Either String a)</code> is simply not a type one should be using."}, {"owner": {"reputation": 1200, "user_id": 62657, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24e30ea2f4bfda89a9a915dd18247d05?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/62657/jeremy"}, "edited": false, "score": 0, "creation_date": 1526136832, "post_id": 41966893, "comment_id": 87630985, "body": "Note that an instance is available since exceptions-0.9.0."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "reply_to_user": {"reputation": 1200, "user_id": 62657, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24e30ea2f4bfda89a9a915dd18247d05?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/62657/jeremy"}, "edited": false, "score": 0, "creation_date": 1526233032, "post_id": 41966893, "comment_id": 87653489, "body": "New question: <a href=\"https://stackoverflow.com/questions/50318471\">Why is there a MonadMask instance for ExceptT?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1485910375, "post_id": 41969824, "comment_id": 71118771, "body": "Isn&#39;t my <code>IOEither</code> isomorphic to <code>ExceptT String IO</code> - meaning the &quot;underlying monad&quot; <i>is</i> <code>IO</code>? You can end the computation in the <code>IOEither</code> monad with <code>throwIO</code> or with <code>return . Left</code>."}], "tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": false, "score": 2, "last_activity_date": 1485975689, "last_edit_date": 1485975689, "creation_date": 1485907836, "answer_id": 41969824, "question_id": 41966893, "link": "https://stackoverflow.com/questions/41966893/why-is-there-no-monadmask-instance-for-exceptt/41969824#41969824", "title": "Why is there no MonadMask instance for ExceptT?", "body": "<blockquote>\n  <p>A class for <strong>monads which provide for the ability to account for all possible exit points from a computation</strong>, and to mask asynchronous exceptions. Continuation-based monads, and stacks such as <code>ErrorT e IO</code> which provide for multiple failure modes, are invalid instances of this class.</p>\n</blockquote>\n\n<p>When you use <code>ErrorT</code>/<code>ExceptT</code> with <code>IO</code>, having \"multiple exit points\" refers to the fact that you can have either a runtime exception or an exception thrown in the Monad. Either of which would end the computation.</p>\n\n<pre><code>runExceptT $ do\n  error \"This is an exit point.\"\n  throwError \"This is another exit point.\"\n  return 23\n</code></pre>\n\n<p>It would be possible to write a <code>MonadMask</code> for <code>ExceptT</code> that would be valid for all <code>ExceptT e m a</code> with the precondition that the underlying monad <code>m</code> is <em>not</em> IO. Hence the huge warning about using <code>CatchT</code> with <code>IO</code> (Doing so invalidates the <code>MonadMask</code> instance).</p>\n"}, {"comments": [{"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1486451791, "post_id": 41977629, "comment_id": 71338162, "body": "Exactly right. This is why we skipped the instance. We wracked our brains over ways to fix it and it&#39;d have been nice to have but it doesn&#39;t pass the obvious finalizer law. In the end we decided against having an illegal (if &quot;obvious&quot;) instance or figuring out phrasing that would allow us to weaken the laws in ways prone to user error."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1498723215, "post_id": 41977629, "comment_id": 76618877, "body": "@Edward KMETT It seems that we could write a specialized bracket-like operation like <code>bracketE :: IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; ExceptT e IO c) -&gt; ExceptT e IO c</code>, couldn&#39;t we? One that didn&#39;t depend on <code>MonadMask</code>s functions and used <code>IO</code>&#39;s <code>bracket</code> directly."}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1498844443, "post_id": 41977629, "comment_id": 76685011, "body": "@danidiaz: See the HEAD branch. <a href=\"https://github.com/ekmett/exceptions/commit/e8cd863ebaf1357091dc7df331bf5c9e73ac21a7\" rel=\"nofollow noreferrer\">github.com/ekmett/exceptions/commit/&hellip;</a> from a little while back added something vaguely in this vein. We&#39;re currently shaking that out to see if we like it."}], "tags": [], "owner": {"reputation": 701, "user_id": 3877993, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbce6b7e90ceede184992bfefb3b5f85?s=128&d=identicon&r=PG", "display_name": "cocreature", "link": "https://stackoverflow.com/users/3877993/cocreature"}, "is_accepted": true, "score": 7, "last_activity_date": 1485974889, "last_edit_date": 1485974889, "creation_date": 1485945622, "answer_id": 41977629, "question_id": 41966893, "link": "https://stackoverflow.com/questions/41966893/why-is-there-no-monadmask-instance-for-exceptt/41977629#41977629", "title": "Why is there no MonadMask instance for ExceptT?", "body": "<p>Below is a program that demonstrates the problem with your instances: You can exit early with <code>Left</code> and thereby cause the finalizer to never be run. This is in contrast to the law stated in the docs for <code>MonadMask</code> which require that for <code>f `finally` g</code> <code>g</code> is executed regardless of what happens in <code>f</code>. The reason why the finalizer is never run is quite simple: If no exception is thrown <code>finally</code> (or <code>bracket</code> which is how <code>finally</code> is implemented) just uses <code>&gt;&gt;=</code> to run the finalizer afterwards but <code>&gt;&gt;=</code> does not execute the right argument if the left returns <code>Left</code>.</p>\n\n<pre><code>data IOEither a = IOEither { unIOEither :: IO (Either String a) }\n    deriving Functor\n\ninstance Applicative IOEither where\n    pure = IOEither . return . Right\n    IOEither fIO &lt;*&gt; IOEither xIO = IOEither $\n        fIO &gt;&gt;= either (return . Left) (\\f -&gt; (fmap . fmap) f xIO)\n\ninstance Monad IOEither where\n    IOEither xIO &gt;&gt;= f = IOEither $\n        xIO &gt;&gt;= either (return . Left) (\\x -&gt; unIOEither (f x))\n\ninstance MonadThrow IOEither where\n    throwM e = IOEither (throwM @IO e)\n\ninstance MonadCatch IOEither where\n    catch (IOEither aIO) f = IOEither $ catch @IO aIO (unIOEither . f)\n\ninstance MonadMask IOEither where\n    mask f = IOEither $ mask @IO $ \\restore -&gt;\n        unIOEither $ f (IOEither . restore . unIOEither)\n    uninterruptibleMask f = IOEither $ uninterruptibleMask @IO $ \\restore -&gt;\n        unIOEither $ f (IOEither . restore . unIOEither)\n\ninstance MonadIO IOEither where\n  liftIO x = IOEither (Right &lt;$&gt; x)\n\nmain :: IO ()\nmain = void $ unIOEither $ finally (IOEither (return (Left \"exit\")))\n                                   (liftIO (putStrLn \"finalizer\"))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 711, "user_id": 774228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60d85066d4024c48c64b05f6d149833f?s=128&d=identicon&r=PG", "display_name": "unclechu", "link": "https://stackoverflow.com/users/774228/unclechu"}, "is_accepted": false, "score": 0, "last_activity_date": 1569255250, "last_edit_date": 1569255250, "creation_date": 1569254518, "answer_id": 58066204, "question_id": 41966893, "link": "https://stackoverflow.com/questions/41966893/why-is-there-no-monadmask-instance-for-exceptt/58066204#58066204", "title": "Why is there no MonadMask instance for ExceptT?", "body": "<p>It seems it's no longer true since <a href=\"http://hackage.haskell.org/package/exceptions-0.9.0/docs/Control-Monad-Catch.html#t:MonadMask\" rel=\"nofollow noreferrer\"><strong>exceptions</strong> <em>v0.9.0</em></a> which has been uploaded to the <strong>hackage</strong> 25 Feb 2018.</p>\n\n<p>P.S. <em>0.9.0</em> is considered deprecated, <em>0.10.0</em> is recommended to use (see <a href=\"http://hackage.haskell.org/package/exceptions-0.10.0/changelog\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/exceptions-0.10.0/changelog</a>).</p>\n"}], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 669, "favorite_count": 2, "accepted_answer_id": 41977629, "answer_count": 3, "score": 14, "last_activity_date": 1569255250, "creation_date": 1485894440, "last_edit_date": 1485980715, "question_id": 41966893, "link": "https://stackoverflow.com/questions/41966893/why-is-there-no-monadmask-instance-for-exceptt", "title": "Why is there no MonadMask instance for ExceptT?", "body": "<p>Edward Kmett's <em>exceptions</em> library does not provide a <a href=\"https://www.stackage.org/haddock/lts-7.18/exceptions-0.8.3/Control-Monad-Catch.html#t:MonadMask\" rel=\"noreferrer\">MonadMask</a> instance for <a href=\"https://www.stackage.org/haddock/lts-7.18/transformers-0.5.2.0/Control-Monad-Trans-Except.html#t:ExceptT\" rel=\"noreferrer\">ExceptT</a>.</p>\n\n<p><a href=\"https://github.com/ekmett/exceptions/issues/35\" rel=\"noreferrer\">Ben Gamari once asked about this</a> and then concluded that it was explained by the documentation. This is the closest relevant-looking passage I can find:</p>\n\n<blockquote>\n  <p>Note that this package does provide a <code>MonadMask</code> instance for <code>CatchT</code>. This instance is <em>only</em> valid if the base monad provides no ability to provide multiple exit. For example, <code>IO</code> or <code>Either</code> would be invalid base monads, but <code>Reader</code> or <code>State</code> would be acceptable.</p>\n</blockquote>\n\n<p>But its meaning is not self-evident to me. What does \"multiple exit\" mean and why does it prohibit a <code>MonadMask</code> instance?</p>\n\n<p><a href=\"http://www.yesodweb.com/blog/2014/06/exceptions-transformers\" rel=\"noreferrer\">Michael Snoyman also writes</a>:</p>\n\n<blockquote>\n  <p>[...] 'MonadMask', which allows you to guarantee that certain actions are run, even in the presence of exceptions (both synchronous and asynchronous). In order to provide that guarantee, the monad stack must be able to control its flow of execution. In particular, this excludes instances for [...] Monads with multiple exit points, such as <code>ErrorT</code> over <code>IO</code>.</p>\n</blockquote>\n\n<p>Perhaps it would be more clear to ask this alternative question: If we set aside transformers and consider the slightly simpler type:</p>\n\n<pre><code>data IOEither a = IOEither { unIOEither :: IO (Either String a) }\n    deriving Functor\n</code></pre>\n\n<p>It <em>seems</em> that we can in fact write a <code>MonadMask</code> instance:</p>\n\n<pre><code>instance Applicative IOEither where\n    pure = IOEither . return . Right\n    IOEither fIO &lt;*&gt; IOEither xIO = IOEither $\n        fIO &gt;&gt;= either (return . Left) (\\f -&gt; (fmap . fmap) f xIO)\n\ninstance Monad IOEither where\n    IOEither xIO &gt;&gt;= f = IOEither $\n        xIO &gt;&gt;= either (return . Left) (\\x -&gt; unIOEither (f x))\n\ninstance MonadThrow IOEither where\n    throwM e = IOEither (throwM @IO e)\n\ninstance MonadCatch IOEither where\n    catch (IOEither aIO) f = IOEither $ catch @IO aIO (unIOEither . f)\n\ninstance MonadMask IOEither where\n    mask f = IOEither $ mask @IO $ \\restore -&gt;\n        unIOEither $ f (IOEither . restore . unIOEither)\n    uninterruptibleMask f = IOEither $ uninterruptibleMask @IO $ \\restore -&gt;\n        unIOEither $ f (IOEither . restore . unIOEither)\n</code></pre>\n\n<p>Does this instance I've written not work properly?</p>\n"}, {"tags": ["haskell", "purely-functional"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1485894625, "post_id": 41966416, "comment_id": 71112552, "body": "I think the question can be flipped on its head - I am just as bewildered as to how Java programmers manage to shoehorn everything into classes :). In general, one spends much more time in Haskell thinking about functions and transitions from things of one type to things of another. That aside, this question seems a bit broad and un-answerable right now by SO standards. Maybe you could add a specific example of something you can&#39;t imagine being done in Haskell?"}, {"owner": {"reputation": 591, "user_id": 6149198, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/7ef2632eb55cc8c5d0b8123ddd3ebb4d?s=128&d=identicon&r=PG&f=1", "display_name": "chedy najjar", "link": "https://stackoverflow.com/users/6149198/chedy-najjar"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485894737, "post_id": 41966416, "comment_id": 71112606, "body": "@Alec I am not arguing about using object or not, I am just wondering how design is expressed, I don&#39;t have anything against Functional programming"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485894799, "post_id": 41966416, "comment_id": 71112633, "body": "I would say <code>data</code> is more what &quot;class/struct&quot; is in an imperative programming language."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1485894876, "post_id": 41966416, "comment_id": 71112674, "body": "You must&#39;ve misunderstood my comment - I wasn&#39;t making a point for or against functional programming, only on the difficulty of conveying how different the paradigms are. I still think the question isn&#39;t really answerable without an example..."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1485895271, "post_id": 41966416, "comment_id": 71112889, "body": "I&#39;d be glad to add a &quot;translation&quot; of a given uml/class architecture to my answer"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1485898114, "post_id": 41966416, "comment_id": 71114407, "body": "This is an interesting question. Perhaps there&#39;s no widespread standard design process for Haskell development. It surely &quot;helps&quot; that most Haskellers usually talk about the connections with math and formal semantics, which is more objective than, say, code style, which are the best language idioms/patterns, and so on. Some Haskellers (including me, to be honest) feel a bit uncomfortable with UML for its informal nature. Also, architecture documents are for large dev groups -- I&#39;m not sure how large Haskell dev groups (on the same project) are around the globe."}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1485905022, "post_id": 41966416, "comment_id": 71117183, "body": "Is this not a duplicate of <a href=\"http://stackoverflow.com/questions/3077866/large-scale-design-in-haskell\" title=\"large scale design in haskell\">stackoverflow.com/questions/3077866/&hellip;</a>  ?"}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1485913564, "post_id": 41966416, "comment_id": 71119556, "body": "There was(is?) <a href=\"https://kar.kent.ac.uk/13634/\" rel=\"nofollow noreferrer\">FAD</a>, but I&#39;m pretty sure essentially no one uses it."}], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 4, "last_activity_date": 1485900898, "last_edit_date": 1485900898, "creation_date": 1485894652, "answer_id": 41966942, "question_id": 41966416, "link": "https://stackoverflow.com/questions/41966416/how-does-pure-functional-languagehaskell-users-make-designwhat-alternative-to/41966942#41966942", "title": "How does pure functional language(haskell) users make Design?what alternative to uml they use?", "body": "<p>I don't know of any formal(ized) notion of drawing or describing architecture.</p>\n\n<h2>Nevertheless you can structure your application</h2>\n\n<p>The most basic way is using the expressiveness of the type system:</p>\n\n<ul>\n<li>wrapping simple types in <code>newtype</code>s - or using <code>type</code> synonyms to - distinguish between say an <code>Int</code> and an <code>Age</code> value, e.g. <code>newtype Age = Age Int</code>.</li>\n<li>composing more complex types as products of existing e.g. <code>data Person = Person { name :: String, age :: Age}</code></li>\n<li>or by using sum types <code>data Employee = Chef Person | Waiter Person</code></li>\n</ul>\n\n<p>All these data types - which can be made much more elaborate - can be accessed/modified* via record syntax or lenses. I tend to think of the data types as my skeleton of the application I write - and use the compiler to stay true to the ideas I had when starting and <em>never</em> subvert the types by using <code>unsafeXX</code> functions.</p>\n\n<h2>Lack of OO/Encapsulation</h2>\n\n<p>I have never had - having functions attached to objects is not necessary (utterly wrong in my opinion, but that is not up for discussion here).</p>\n\n<p>A basic form of encapsulation can be done via <code>newtype</code> and modules with their exports.</p>\n\n<h2>Polymorphism</h2>\n\n<p>A lot can already be done with typeclasses, which if you have not yet worked with them, are somewhat like interfaces, (but with less typing) - but there is a lot more you can accomplish with advanced things like type families.</p>\n\n<hr>\n\n<h2>Conclusion</h2>\n\n<p>So if I would like to draw a structure/architecture of my program, I would start with my data-types as boxes and use arrows as functions between them. And maybe use \"special\" boxes for container types.</p>\n\n<p>*: technically one usually doesn't modify stuff, but create new values from old values as (almost) everything is immutable.</p>\n"}], "owner": {"reputation": 591, "user_id": 6149198, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/7ef2632eb55cc8c5d0b8123ddd3ebb4d?s=128&d=identicon&r=PG&f=1", "display_name": "chedy najjar", "link": "https://stackoverflow.com/users/6149198/chedy-najjar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "closed_date": 1485907043, "accepted_answer_id": 41966942, "answer_count": 1, "score": 2, "last_activity_date": 1485900898, "creation_date": 1485892668, "last_edit_date": 1485894764, "question_id": 41966416, "link": "https://stackoverflow.com/questions/41966416/how-does-pure-functional-languagehaskell-users-make-designwhat-alternative-to", "closed_reason": "Needs more focus", "title": "How does pure functional language(haskell) users make Design?what alternative to uml they use?", "body": "<p>giving that haskell doesn't have the notion objects(even it has the keyword <code>class</code>) How does Haskell developer design their code? how do they represent interaction/entities? does they have alternative to uml? or class equivalent?(or do they even care?)</p>\n"}, {"tags": ["haskell", "serialization", "bytestring"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1485890627, "post_id": 41965508, "comment_id": 71110438, "body": "Isn&#39;t it just <code>length uid + length req</code> (assuming those values are <code>Foldable</code>)?"}, {"owner": {"reputation": 4424, "user_id": 34996, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ca2e2c3442a73f84394abb35d6236b12?s=128&d=identicon&r=PG", "display_name": "Magnus", "link": "https://stackoverflow.com/users/34996/magnus"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1485891337, "post_id": 41965508, "comment_id": 71110788, "body": "Unfortunately they are not, in the example above uid is a <code>Word8</code> and <code>req</code> is a serializable type."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1485899940, "post_id": 41965508, "comment_id": 71115236, "body": "Just <code>let reqBS = runPut put req</code> first and you can calculate the length then later <code>putByteString reqBS</code>.  That or find a knot tying solution."}, {"owner": {"reputation": 4424, "user_id": 34996, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ca2e2c3442a73f84394abb35d6236b12?s=128&d=identicon&r=PG", "display_name": "Magnus", "link": "https://stackoverflow.com/users/34996/magnus"}, "edited": false, "score": 0, "creation_date": 1487665744, "post_id": 41965508, "comment_id": 71874432, "body": "Well, a knot-tying solution would be pretty much what I&#39;m asking for ;)"}], "owner": {"reputation": 4424, "user_id": 34996, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ca2e2c3442a73f84394abb35d6236b12?s=128&d=identicon&r=PG", "display_name": "Magnus", "link": "https://stackoverflow.com/users/34996/magnus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1485889447, "creation_date": 1485889447, "question_id": 41965508, "link": "https://stackoverflow.com/questions/41965508/building-a-bytestring-containing-the-length-size", "title": "Building a bytestring containing the length/size?", "body": "<p>This isn't the first time I run into this issue, but I haven't found a really nice solution for it so I thought I'd ask how others approach it.</p>\n\n<p>Many protocols include the size of the message (or a part of it) inside the message itself. For instance, right now I'm looking at <em>ModbusTCP</em> where bytes 5 and 6 should hold the length of the remaining part of the message. Is there some nice and elegant way to deal with this?</p>\n\n<p>The straight-forward builder would look something like this (using <code>Serialize</code> from <em>cereal</em>):</p>\n\n<pre><code>put (ModTcpRequestFrame tid pid uid req)= do\n  putWord16be tid\n  putWord16be pid\n  putWord16be len\n  putWord8 uid\n  put req\n\n  where\n    len = .... -- what to put here?\n</code></pre>\n\n<p>Can it be done?</p>\n"}, {"tags": ["haskell", "floating-point", "fractions"], "comments": [{"owner": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 0, "creation_date": 1485885176, "post_id": 41964228, "comment_id": 71107446, "body": "They&#39;re right next to each other in the Prelude."}, {"owner": {"reputation": 225, "user_id": 7222740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f90d44093611c5fa4c8848ca59eea09?s=128&d=identicon&r=PG&f=1", "display_name": "joseabp91", "link": "https://stackoverflow.com/users/7222740/joseabp91"}, "reply_to_user": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 0, "creation_date": 1485885340, "post_id": 41964228, "comment_id": 71107548, "body": "What do you want to say exactly?"}, {"owner": {"reputation": 11950, "user_id": 576746, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fd655b00d23f25a744dbd630b7fdd09d?s=128&d=identicon&r=PG", "display_name": "Blackbam", "link": "https://stackoverflow.com/users/576746/blackbam"}, "edited": false, "score": 0, "creation_date": 1485885614, "post_id": 41964228, "comment_id": 71107706, "body": "Is there really no info on the docs?"}, {"owner": {"reputation": 225, "user_id": 7222740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f90d44093611c5fa4c8848ca59eea09?s=128&d=identicon&r=PG&f=1", "display_name": "joseabp91", "link": "https://stackoverflow.com/users/7222740/joseabp91"}, "edited": false, "score": 0, "creation_date": 1485885754, "post_id": 41964228, "comment_id": 71107787, "body": "No more information is needed for this question."}, {"owner": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "edited": false, "score": 1, "creation_date": 1485886451, "post_id": 41964228, "comment_id": 71108143, "body": "Docs are indeed very poor"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485890297, "post_id": 41964228, "comment_id": 71110278, "body": "Potential close voters: this question is <i>definitely</i> not unclear."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 8, "last_activity_date": 1485890345, "last_edit_date": 1485890345, "creation_date": 1485885789, "answer_id": 41964457, "question_id": 41964228, "link": "https://stackoverflow.com/questions/41964228/whats-the-difference-between-the-classes-floating-and-fractional-in-haskell/41964457#41964457", "title": "What&#39;s the difference between the classes Floating and Fractional in Haskell?", "body": "<p>The definitions of <code>Fractional</code> and <code>Floating</code> can be found in the documentation of the <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#t:Fractional\" rel=\"noreferrer\">Prelude</a>:</p>\n\n<blockquote>\n<pre><code>class Num a =&gt; Fractional a where\n    (/) :: a -&gt; a -&gt; a\n    recip :: a -&gt; a\n    fromRational :: Rational -&gt; a \n</code></pre>\n  \n  <p>Fractional numbers, supporting real division.</p>\n  \n  <p>[...]</p>\n\n<pre><code>class Fractional a =&gt; Floating a where\n    pi :: a\n    exp :: a -&gt; a\n    log :: a -&gt; a\n    sqrt :: a -&gt; a\n    (**) :: a -&gt; a -&gt; a\n    logBase :: a -&gt; a -&gt; a\n    sin :: a -&gt; a\n    cos :: a -&gt; a\n    tan :: a -&gt; a\n    asin :: a -&gt; a\n    acos :: a -&gt; a\n    atan :: a -&gt; a\n    sinh :: a -&gt; a\n    cosh :: a -&gt; a\n    tanh :: a -&gt; a\n    asinh :: a -&gt; a\n    acosh :: a -&gt; a\n    atanh :: a -&gt; a\n</code></pre>\n  \n  <p>Trigonometric and hyperbolic functions and related functions.</p>\n  \n  <p>[...]</p>\n</blockquote>\n\n<p>So to translate that into English: A <code>Fractional</code> is any kind of number for which I can define a division:</p>\n\n<pre><code>(/) :: Fractional a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>That can for instance be the case for <em>floating point</em> numbers, but also for <em>fractions</em> (where a fraction has a <em>numerator</em> and <em>denominator</em>). This is not the case for <code>Int</code> because if dividing an <code>Int</code> by an <code>Int</code> does not always produce an <code>Int</code> (well technically floating point division on a computer is not exact, but that is another story).</p>\n\n<p>A subset of <code>Fractional</code> numbers are <code>Floating</code> numbers where trigonometric are defined. It is for instance impossible that the <code>sin</code> of a fraction always produces a fraction: a <code>sin</code> is defined as an sum over an infinite sequence. Only for a very limited number of cases (like <code>sin 0</code>) it holds. Basically the only numbers on a computer for which trigonometric are defined (approximatively) are floating point numbers.</p>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485887303, "post_id": 41964659, "comment_id": 71108589, "body": "Isn&#39;t it a bit misleading to say &quot;<i><code>Fractional</code> types are not connected</i>&quot; since the set of <code>Floating</code> types is a subset of <code>Fractional</code> types (since <code>class Fractional a =&gt; Floating a</code>)? It&#39;s like saying &quot;things that carry DNA/RNA are living&quot; and forgetting about viruses (that have RNA but no metabolism)."}, {"owner": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485887607, "post_id": 41964659, "comment_id": 71108812, "body": "@WillemVanOnsem If a fractional type is floating, then it&#39;s connected, but if it&#39;s not connected, then it&#39;s not floating."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 0, "creation_date": 1485887690, "post_id": 41964659, "comment_id": 71108870, "body": "@JoshLee: Yeah, I know that: but I think the answer can be a bit confusing to that point..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485887901, "post_id": 41964659, "comment_id": 71109010, "body": "@WillemVanOnsem I said <i>some</i> <code>Fractional</code> types are not connected, and gave <code>Rational</code> as an example."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485887978, "post_id": 41964659, "comment_id": 71109068, "body": "@leftaroundabout: Yeah for some reason the first time I looked I did not spotted the <i>some</i> :( Probably bit overworked because of the <i>Berlinade</i> deadline :)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 8, "last_activity_date": 1485890397, "last_edit_date": 1485890397, "creation_date": 1485886489, "answer_id": 41964659, "question_id": 41964228, "link": "https://stackoverflow.com/questions/41964228/whats-the-difference-between-the-classes-floating-and-fractional-in-haskell/41964659#41964659", "title": "What&#39;s the difference between the classes Floating and Fractional in Haskell?", "body": "<p>Very roughly:</p>\n\n<ul>\n<li><p><code>Fractional</code> is the class of types that can represent (exactly or at least in a decent approximation) any <a href=\"https://en.wikipedia.org/wiki/Rational_number\" rel=\"nofollow noreferrer\">rational number</a>. It may ad lib also be able to represent other numbers, but that's not important.<br>In other terms, it's just the class of number types that have a division operation; since it's a subclass of <code>Num</code> it follows from this that the types must contain the rational numbers.</p></li>\n<li><p><code>Floating</code> is the class of number types that are closed under limits in the Cauchy sense, i.e. <a href=\"https://en.wikipedia.org/wiki/Complete_metric_space\" rel=\"nofollow noreferrer\">complete spaces</a>. This is necessary to do any sort of calculus. The methods of the <code>Floating</code> class are functions that are mathematically defined as limits, namely infinite sums (which are the limits of the sequence of partial sums of taylor series).<br>Since you can define the real numbers as limits of sequences of rational numbers and because again <code>Floating</code> is a subclass of <code>Fractional</code>, any <code>Floating</code> type is able to represent (again, at least <em>to a decent approximation</em>) any <a href=\"https://en.wikipedia.org/wiki/Real_number\" rel=\"nofollow noreferrer\">real number</a>.</p></li>\n</ul>\n\n<p>A good way to visualise the difference is through topology: <code>Floating</code> types are <a href=\"https://en.wikipedia.org/wiki/Connected_space\" rel=\"nofollow noreferrer\">connected spaces</a>, i.e. they form a continuum. What this means for floating point numbers is: every value is understood as a whole <em>interval</em> of real numbers (because floating-point always has some uncertainty). When you lay these intervals side by side, you tile the entire real numbers (at least to \u00b110<sup>300</sup>) without gaps.</p>\n\n<p>By contrast, some <code>Fractional</code> types are not connected. In particular, <code>Rational</code> can <em>exactly</em> represent all its (rational-number) values, so each value is just an \u201cinfinitely small point\u201d. You can never cover the entire real line with such points, and you can not compute functions like <code>sin</code> or <code>log</code> since the result of these functions is usually a non-rational real number.</p>\n\n<hr>\n\n<p>It's worth pondering a bit what this \u201cdecent approximation\u201d means. The Haskell standard doesn't define this. This story about every floating point number representing a whole interval of real numbers captures it quite well IMO. More generally, we might say: <code>Num</code>/<code>Fractional</code>/<code>Floating</code> are the classes of types that represent <a href=\"https://en.wikipedia.org/wiki/Equivalence_class\" rel=\"nofollow noreferrer\">equivalance classes</a> of integer/rational/real numbers. In fact, these classes need not even be \u201csmall\u201d intervals: in particular the finite types like <code>Word32</code> or the standard <code>Int</code> can be understood in a <a href=\"https://en.wikipedia.org/wiki/Modular_arithmetic\" rel=\"nofollow noreferrer\">modular arithmetic</a> sense, manifesting in results like <code>(2^70 :: Int) == 0</code>, i.e. the equivalence classes are then numbers spaces by a multiple of 2<sup>64</sup>.</p>\n\n<p>In cases like <code>Integer</code> or <code>Rational</code>, the equivalence classes actually contain only a single element, i.e. the numbers are represented <em>exactly</em>. For real numbers, this is actually also possible, but much more tricky, it's called <em>exact real arithmetic</em>. There are libraries such as <a href=\"http://michalkonecny.github.io/aern/_site/index.html\" rel=\"nofollow noreferrer\">aern</a> that do this.</p>\n"}], "owner": {"reputation": 225, "user_id": 7222740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f90d44093611c5fa4c8848ca59eea09?s=128&d=identicon&r=PG&f=1", "display_name": "joseabp91", "link": "https://stackoverflow.com/users/7222740/joseabp91"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5883, "favorite_count": 1, "accepted_answer_id": 41964457, "answer_count": 2, "score": 12, "last_activity_date": 1485890665, "creation_date": 1485885035, "last_edit_date": 1485890665, "question_id": 41964228, "link": "https://stackoverflow.com/questions/41964228/whats-the-difference-between-the-classes-floating-and-fractional-in-haskell", "title": "What&#39;s the difference between the classes Floating and Fractional in Haskell?", "body": "<p>What is the difference is between the <code>Floating</code> and <code>Fractional</code> classes in Haskell?</p>\n"}, {"tags": ["haskell", "escaping", "ascii"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485881628, "post_id": 41962751, "comment_id": 71105167, "body": "Haskell escapes are not terribly different from other programming languages. <code>&quot;\\123&quot;</code> is a representation of Unicode codepoint 123 (decimal). <code>&quot;\\x3f&quot;</code> is codepoint 0x3f (hexadecimal). And so on. What confuses you, exactly?"}, {"owner": {"reputation": 111, "user_id": 4586632, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1ef8a257abcede4daee9fba747dad5cc?s=128&d=identicon&r=PG&f=1", "display_name": "brander", "link": "https://stackoverflow.com/users/4586632/brander"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1486492758, "post_id": 41962751, "comment_id": 71365307, "body": "I ran into some test code that appeared to treat \\250 as four characters but treated \\ACK as a character, so I wasnt sure if unicode was somehow treated differently than ASCII escape."}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 6, "last_activity_date": 1485881089, "creation_date": 1485881089, "answer_id": 41962880, "question_id": 41962751, "link": "https://stackoverflow.com/questions/41962751/how-should-one-interpret-the-haskell-character-250/41962880#41962880", "title": "How should one interpret the Haskell character &#39;\\250&#39;", "body": "<p><code>'\\250'</code> is whatever Unicode character has code point (decimal) 250, in this case LATIN SMALL LETTER U WITH ACUTE (\u00fa).</p>\n"}, {"tags": [], "owner": {"reputation": 580, "user_id": 2466383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550ba434909acd5357b9defb56e7254a?s=128&d=identicon&r=PG", "display_name": "Mike Spivey", "link": "https://stackoverflow.com/users/2466383/mike-spivey"}, "is_accepted": false, "score": 8, "last_activity_date": 1485881729, "creation_date": 1485881729, "answer_id": 41963153, "question_id": 41962751, "link": "https://stackoverflow.com/questions/41962751/how-should-one-interpret-the-haskell-character-250/41963153#41963153", "title": "How should one interpret the Haskell character &#39;\\250&#39;", "body": "<p>The string <code>\"\\250\\218\"</code> consists of two numeric escapes, each denoting one character, with the character codes given in decimal.  Applying <code>head</code> returns the first of these, printed <code>'\\250'</code>.  If you apply <code>Data.Char.ord</code> to this, you will see that it has numeric code 250 (decimal).  You can make a similar character using <code>Data.Char.chr</code>.</p>\n\n<p>As you can see below, printing the characters with these codes results in accented letters according to Unicode.</p>\n\n<p>Using GHCi:</p>\n\n<pre><code>GHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; head \"\\250\\218\"\n'\\250'\nPrelude&gt; Data.Char.ord (head \"\\250\\218\")\n250\nPrelude&gt; Data.Char.chr 251\n'\\251'\nPrelude&gt; putStrLn \"\\250\\218\"\n\u00fa\u00da\nPrelude&gt; \n</code></pre>\n\n<p>For more information:</p>\n\n<p><a href=\"http://book.realworldhaskell.org/read/characters-strings-and-escaping-rules.html#id689632\" rel=\"noreferrer\">http://book.realworldhaskell.org/read/characters-strings-and-escaping-rules.html#id689632</a></p>\n"}], "owner": {"reputation": 111, "user_id": 4586632, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1ef8a257abcede4daee9fba747dad5cc?s=128&d=identicon&r=PG&f=1", "display_name": "brander", "link": "https://stackoverflow.com/users/4586632/brander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1485881729, "creation_date": 1485880699, "question_id": 41962751, "link": "https://stackoverflow.com/questions/41962751/how-should-one-interpret-the-haskell-character-250", "title": "How should one interpret the Haskell character &#39;\\250&#39;", "body": "<p>I am trying to understand how escapes work in Haskell.</p>\n\n<p><code>head \"\\250\\218\"</code>\nreturns\n<code>'\\250'</code></p>\n\n<p>So Haskell thinks \\250 is a character. What exactly is going on here?</p>\n"}, {"tags": ["haskell", "vector", "hashmap"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1485875015, "post_id": 41960585, "comment_id": 71100318, "body": "I don&#39;t think you should be worried about the overhead of an intermediate list \u2013 <code>Map</code> contains the same kind of indirections, you&#39;ll never get as good bandwidth as <code>vector</code> would manage. Unless you&#39;re starting out with a sorted array, map construction is anyways <i>O</i> (<i>n</i> &#183; log <i>n</i>), so the list overhead is in fact amortised! \u2014 You can however quite easily check it by directly folding <code>insert</code> over a vector. I don&#39;t reckon it&#39;ll give better performance than converting to and from list."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485875157, "post_id": 41960585, "comment_id": 71100409, "body": "The intermediate list should be either deforested or garbage-collected in a &quot;streaming&quot; fashion, using O(1) memory. So, it&#39;s not a big problem. But if you strongly want to avoid that, we have <code>Foldable Vector</code> so we could use <code>foldr</code> over the <code>Vector</code> and insert each element in a <code>Map</code>. This might be slower or faster -- try both and see which approach is the fastest."}, {"owner": {"reputation": 101, "user_id": 4211172, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5n7vP.jpg?s=128&g=1", "display_name": "Rik", "link": "https://stackoverflow.com/users/4211172/rik"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1485876670, "post_id": 41960585, "comment_id": 71101464, "body": "@leftaroundabout So if I understand you correctly, using Map is so slow so it does matter to convert to intermediate structure anymore? But converting directly from Vector to Map instead of Vector to List, then List to Map should be faster says my common sense :-)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1485877054, "post_id": 41960585, "comment_id": 71101757, "body": "@Rik: yeah, but the tradeoff is likely something like: eliminating the list gives you 0.1% better performance in some specific program, but including <code>vector</code> as an extra dependency for <code>containers</code> and writing an optimised list-free construction function would prolong the build times of some projects by perhaps 20%. \u2014 If you&#39;re so concerned with micro-optimisation, you should probably not use <code>Map</code> at all but e.g. ordered unboxed vectors."}, {"owner": {"reputation": 101, "user_id": 4211172, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5n7vP.jpg?s=128&g=1", "display_name": "Rik", "link": "https://stackoverflow.com/users/4211172/rik"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1485878320, "post_id": 41960585, "comment_id": 71102752, "body": "@leftaroundabout I already use Vector package because Hasql package. I want to add containers package for Map. The point is that I do not want to convert to List everytime. Not only because of performance but also because it feels like boilerplate code. Good idea, I can try to code without Map and stay with Vector."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1485879286, "post_id": 41960585, "comment_id": 71103513, "body": "Boilerplate? Just define <code>fromVector = fromList . toList :: Vector (a,b) -&gt; Map a b</code> somewhere in your module... \u2014 As for performance: always remember the <a href=\"https://en.wikiquote.org/wiki/Donald_Knuth#Computer_Programming_as_an_Art_.281974.29\" rel=\"nofollow noreferrer\">root of all evil</a>."}, {"owner": {"reputation": 101, "user_id": 4211172, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5n7vP.jpg?s=128&g=1", "display_name": "Rik", "link": "https://stackoverflow.com/users/4211172/rik"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1485880369, "post_id": 41960585, "comment_id": 71104253, "body": "@leftaroundabout Thanks! Yeah, I&#39;m aware of the <code>root of all evil</code> :-)"}], "owner": {"reputation": 101, "user_id": 4211172, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5n7vP.jpg?s=128&g=1", "display_name": "Rik", "link": "https://stackoverflow.com/users/4211172/rik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 443, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1485874376, "creation_date": 1485874376, "question_id": 41960585, "link": "https://stackoverflow.com/questions/41960585/how-to-create-map-from-vector", "title": "How to create Map from Vector", "body": "<p>The containers package already contains functions to convert Set and List to  Map but it's missing one for Vector from vector package. </p>\n\n<p>Is this because package developers do not want to have dependencies on other (similar) packages? </p>\n\n<p>Shouldn't be some general package which converts between data structures? In this way I always have to convert to List to convert to other structures. But I want to minimize use because of performance.</p>\n"}, {"tags": ["haskell", "gadt", "type-families"], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 7, "last_activity_date": 1485871938, "last_edit_date": 1485871938, "creation_date": 1485871566, "answer_id": 41959585, "question_id": 41959171, "link": "https://stackoverflow.com/questions/41959171/compile-error-with-type-families-gadts-and-named-records/41959585#41959585", "title": "Compile error with type families, GADTs and named records", "body": "<p>Let's forget about <code>T2</code> and <code>T3</code>, and just try to define an extractor function for <code>T1</code>. What should the type be?</p>\n\n<pre><code>x1 :: ???\nx1 (T1 a) = a\n</code></pre>\n\n<p>Well, you might guess <code>x1 :: T1 (F a) -&gt; a</code>. But that's not right, and if you try it then you will get the same error you got for defining <code>T3</code>.</p>\n\n<p>The problem is that if someone hands you a <code>T1 T</code>, and you happen to know a type <code>A</code> such that <code>F A</code> is <code>T</code>, you cannot conclude that the <code>T1 T</code> contains a value of type <code>A</code>, since it could instead contain another type <code>B</code> with <code>F B</code> equal to <code>T</code>. As an extreme case, suppose we have</p>\n\n<pre><code>type instance F _ = ()\n</code></pre>\n\n<p>Then if we took our guess <code>x1 :: T1 (F a) -&gt; a</code>, we'd have</p>\n\n<pre><code>T1 :: a -&gt; T1 ()\nx1 :: T1 () -&gt; b\n</code></pre>\n\n<p>and composing these would let us write <code>a -&gt; b</code>, which is bad.</p>\n\n<p>The real type of <code>x1</code> is something like an existential-providing-constraint</p>\n\n<pre><code>T1 t -&gt; (exists a. (F a ~ t) *&gt; a)\n</code></pre>\n\n<p>which GHC doesn't support.</p>\n\n<p>The issue with <code>T3</code> is effectively the same as if you had</p>\n\n<pre><code>data T3' where T3' :: { x3' :: a } -&gt; T3'\n</code></pre>\n\n<p>You can extract the field with a pattern match (which might be useful if there were more fields or a constraint), but not with a record selector or function.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 41959585, "answer_count": 1, "score": 3, "last_activity_date": 1485871938, "creation_date": 1485870332, "question_id": 41959171, "link": "https://stackoverflow.com/questions/41959171/compile-error-with-type-families-gadts-and-named-records", "title": "Compile error with type families, GADTs and named records", "body": "<p>In the following code, <code>T1</code> and <code>T2</code> compile fine, but <code>T3</code> fails:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TypeFamilies #-}\n\ntype family F a\n\ndata T1 b where\n  T1 :: a -&gt; T1 (F a)\n\ndata T2 b where\n  T2 :: { x2 :: a } -&gt; T2 a\n\ndata T3 b where\n  T3 :: { x3 :: a } -&gt; T3 (F a)\n</code></pre>\n\n<p>I'm trying to understand why. <code>T3</code> is just <code>T1</code> but with a named record. This doesn't seem to be all that special, as one could use constructor syntax to extract it anyway. </p>\n\n<p>These examples probably look silly, but in my code there is a constraint on <code>a</code>, e.g. <code>(Show a)</code>, so these values can be used when they're extracted.</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1485867412, "post_id": 41956812, "comment_id": 71094997, "body": "I don&#39;t understand the question ..."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1485868874, "post_id": 41956812, "comment_id": 71096003, "body": "I think you&#39;re essentially asking about <a href=\"http://conal.net/blog/posts/semantic-editor-combinators\" rel=\"nofollow noreferrer\">conal.net/blog/posts/semantic-editor-combinators</a>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485870279, "post_id": 41956812, "comment_id": 71096981, "body": "Can&#39;t you use <i>template Haskell</i> for that?"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485870386, "post_id": 41956812, "comment_id": 71097045, "body": "@WillemVanOnsem I guess so, but I&#39;d rather not reinvent the wheel, and this just feels lensy, but I&#39;m not exactly sure how to use them in this case."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1485871145, "post_id": 41956812, "comment_id": 71097552, "body": "There are lenses that act like Cona&#39;s semantic editor combinators, if you must use lens.  But I&#39;d start bv looking at how they address the issue, because as far as I can tell, they do."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1485872224, "post_id": 41956812, "comment_id": 71098281, "body": "Bah, *Conal.  Didn&#39;t notice the typo in time to edit."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1485872395, "post_id": 41956812, "comment_id": 71098441, "body": "I&#39;ve reread the article, but I&#39;m still struggling to understand how the ideas he&#39;s presented generalise to functions of many arguments. Could you provide an example e.g. an implementation of &#39;f4change3&#39; above?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1485907334, "post_id": 41956812, "comment_id": 71117927, "body": "Actually there are not quadratically many functions: <code>f4change3</code> works just fine on five- and more-argument functions. You only need one function per argument position."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485908760, "post_id": 41956812, "comment_id": 71118349, "body": "@Clinton Re: &quot;I&#39;m struggling to understand how the ideas he&#39;s presented generalise to functions of many arguments&quot;. What is this &quot;functions of many arguments&quot; you speak of? I know not of such. This is partly a joke, and partly not: part of the zen of Haskell is embracing and internalizing the &quot;functions take exactly one argument&quot; worldview, and speaking of multi-argument functions only as an occasionally convenient shorthand for functions that return functions."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485913964, "post_id": 41956812, "comment_id": 71119715, "body": "@DanielWagner your answer has made it very clear (as always). Thank you again. You win the tick mark!"}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485895173, "post_id": 41966374, "comment_id": 71112830, "body": "This doesn&#39;t answer the question. Your implementation is just a point-free version of the <code>f4change</code> in the question. The OP is looking for a way to generalise it."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485896878, "post_id": 41966374, "comment_id": 71113853, "body": "Someone doesn&#39;t get jokes and irony... You guys shouldn&#39;t be too serious here :)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485897219, "post_id": 41966374, "comment_id": 71114004, "body": "Well, that isn&#39;t entirely fair: I was going to write a comment specifically about the second paragraph, but stopped myself in time :)"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485898748, "post_id": 41966374, "comment_id": 71114677, "body": "@duplode Well, the only thing I lied about is probably that several years of training is not enough :D After 4 years of learning Haskell I still cannot understand such point-free notations in finite amount of time..."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": -3, "last_activity_date": 1485892459, "creation_date": 1485892459, "answer_id": 41966374, "question_id": 41956812, "link": "https://stackoverflow.com/questions/41956812/using-lenses-to-compose-functions/41966374#41966374", "title": "Using lenses to compose functions", "body": "<p>This library is called <code>base</code>. And you don't even need to import anything, everything is already in <code>Prelude</code>. All you need is a little imagination and creativity. And then you can easily write your function in next way:</p>\n\n<pre><code>f4change3 ::\n  (a1 -&gt; a2 -&gt; a3 -&gt; a4 -&gt; r) -&gt;\n  (s -&gt; a3) -&gt;\n  a1 -&gt; a2 -&gt; s -&gt; a4 -&gt; r\nf4change3 = flip . ((flip . ((.) .)) .)\n</code></pre>\n\n<p>After several years of training and reading such code you will fill yourself comfortable with such kind of code. And it will require only couple hours from you to understand what this implementation actually does. But guru Haskell programmers don't read implementations because everything is obviously clear from type.</p>\n"}, {"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 1, "last_activity_date": 1485901559, "creation_date": 1485901559, "answer_id": 41968607, "question_id": 41956812, "link": "https://stackoverflow.com/questions/41956812/using-lenses-to-compose-functions/41968607#41968607", "title": "Using lenses to compose functions", "body": "<p>Okay, here is the real answer. If you don't want to just laugh and want to solve problem, you can go next way.</p>\n\n<p>Your implementation can be shorten a little:</p>\n\n<pre><code>f4change3 ::\n  (a1 -&gt; a2 -&gt; a3 -&gt; a4 -&gt; r) -&gt;\n  (s -&gt; a3) -&gt;\n  a1 -&gt; a2 -&gt; s -&gt; a4 -&gt; r\nf4change3 f g x1 x2 = f x1 x2 . g\n</code></pre>\n\n<p>This is not very useful and you can go full point-free (see my earlier answer).</p>\n\n<p>I wish Haskell had named arguments so you can simply just write similar to <code>-XRecordWildCards</code>:</p>\n\n<pre><code>f4change3 ::\n  ((a1 :: a1) -&gt; (a2 :: a2) -&gt; (a3 :: a3) -&gt; (a4 :: a4) -&gt; r) -&gt;\n  ((s :: s) -&gt; a3) -&gt;\n  (a1 :: a1) -&gt; (a2 :: a2) -&gt; (s :: s) -&gt; (a4 :: a4) -&gt; r\nf4change3 f g = f{ a3 = g{..}, .. }\n</code></pre>\n\n<p>For such particular cases when we want names of arguments be the same as names of type variables syntax can be even much-much shorter. But unfortunately we won't see such sweet features in nearest future (or ever).</p>\n\n<p>But you asked about solution with lenses. You indeed can achieve something similar using lenses. Only thing you need to change in your type signatures is to represent arguments for <code>f</code> as data type with four fields. Here is complete code:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport           Control.Lens (makeLenses, (%~))\n\ndata FArg a1 a2 a3 a4 = FArg\n    { _a1 :: a1\n    , _a2 :: a2\n    , _a3 :: a3\n    , _a4 :: a4\n    }\n\nmakeLenses ''FArg\n\nf4change3 ::\n  (FArg a1 a2 a3 a4 -&gt; r) -&gt;\n  (s -&gt; a3) -&gt;\n  FArg a1 a2 s a4 -&gt; r\nf4change3 f g = f . (a3 %~ g)\n</code></pre>\n\n<p>Maybe some sophisticated solution using lenses is acceptable but here we at least achieve understandability (if you familiar with lenses of course). But usually nobody do this.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1485912314, "last_edit_date": 1485912314, "creation_date": 1485908022, "answer_id": 41969856, "question_id": 41956812, "link": "https://stackoverflow.com/questions/41956812/using-lenses-to-compose-functions/41969856#41969856", "title": "Using lenses to compose functions", "body": "<p>As mentioned in the comments, <a href=\"http://conal.net/blog/posts/semantic-editor-combinators\" rel=\"nofollow noreferrer\">Conal Elliott's semantic editor combinators</a> give a quite beautiful tool for writing these functions. Let's review just two of his combinators:</p>\n\n<pre><code>argument :: (a' -&gt; a) -&gt; ((a -&gt; b) -&gt; (a' -&gt; b))\nargument = flip (.)\n\nresult :: (b -&gt; b') -&gt; ((a -&gt; b) -&gt; (a -&gt; b'))\nresult = (.)\n</code></pre>\n\n<p>In words: <code>argument</code> modifies a function's argument before the function is called, and <code>result</code> modifies a function's return value after it is called. (See the blog post itself for further intuition-bolstering explanations of these combinators.) Let's say we have a function with a type like</p>\n\n<pre><code>a1 -&gt; a2 -&gt; a3 -&gt; a4 -&gt; a5 -&gt; b\n</code></pre>\n\n<p>and we want to change <code>a5</code>. Note that we can parenthesize this, of course:</p>\n\n<pre><code>a1 -&gt; (a2 -&gt; (a3 -&gt; (a4 -&gt; (a5 -&gt; b))))\n</code></pre>\n\n<p>So if we want to reach <code>a5</code>, how should we reach into this structure? Well, we will do it by repeatedly reaching into the <code>result</code>, then acting on the <code>argument</code>: the result type of this function is <code>a2 -&gt; (a3 -&gt; (a4 -&gt; (a5 -&gt; b)))</code>, whose result is <code>a3 -&gt; (a4 -&gt; (a5 -&gt; b))</code>, whose result is <code>a4 -&gt; (a5 -&gt; b)</code>, whose result is <code>a5 -&gt; b</code>, whose argument is <code>a5</code>. This gives us the code directly:</p>\n\n<pre><code>arg5 :: (a5' -&gt; a5)\n     -&gt; (a1 -&gt; a2 -&gt; a3 -&gt; a4 -&gt; a5  -&gt; b)\n     -&gt; (a1 -&gt; a2 -&gt; a3 -&gt; a4 -&gt; a5' -&gt; b)\narg5 = result . result . result . result . argument\n</code></pre>\n\n<p>Hopefully it is quite clear how to generalize this to modify other arguments: just vary the number of times you call <code>result</code>.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 1, "accepted_answer_id": 41969856, "answer_count": 3, "score": 2, "last_activity_date": 1485912314, "creation_date": 1485863313, "question_id": 41956812, "link": "https://stackoverflow.com/questions/41956812/using-lenses-to-compose-functions", "title": "Using lenses to compose functions", "body": "<p>Consider \"composition\" functions with the following (pseudo) signature:</p>\n\n<pre><code>(a1 -&gt; a2 -&gt; ... -&gt; an -&gt; r) -&gt; \n(s -&gt; ai) -&gt; \na1 -&gt; a2 -&gt; ... -&gt; ai -&gt; ... an -&gt; r\nwhere i in [1..n]\n</code></pre>\n\n<p>Of course we can't write what's above in Haskell, but here's a concrete example:</p>\n\n<pre><code>f4change3 :: \n  (a1 -&gt; a2 -&gt; a3 -&gt; a4 -&gt; r) -&gt; \n  (s -&gt; a3) -&gt; \n  a1 -&gt; a2 -&gt; s -&gt; a4 -&gt; r\nf4change3 f g x1 x2 x3 x4 = f x1 x2 (g x3) x4\n</code></pre>\n\n<p>As you can see, there's a collection of <code>n</code> functions for each function of arity <code>n</code>, so the number of functions we need grows quadratically with arity. </p>\n\n<p>I could just write the ones I need, but firstly, I don't want to reinvent the wheel, so it would be nice to know if library has already done this. But also, whilst I have barely used lenses, I've read a bit about them, and this sort of problem seems right up their ally, but I'm not sure exactly how to do it. Some example code would be great if it's possible.</p>\n"}, {"tags": ["function", "haskell", "definition"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1485863685, "post_id": 41955199, "comment_id": 71092482, "body": "Writing <code>f x = g x . h x</code> is the same as writing <code>f x y = g x (h x y)</code>, by definition of the composition operator <code>.</code>. The first style is referred to as &quot;point-free style&quot; (or, jokingly, point-less style)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1485872932, "post_id": 41955199, "comment_id": 71098817, "body": "One word: currying."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1485863579, "post_id": 41955509, "comment_id": 71092414, "body": "I&#39;d avoid the section <code>(5+)</code> for this, since it exploits a special syntax, and instead use plain application <code>(+) 5</code> which follows the spirit of the argument."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485865403, "post_id": 41955509, "comment_id": 71093595, "body": "@chi: that is indeed a good suggestion: modified. Thanks."}, {"owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "edited": false, "score": 0, "creation_date": 1485873024, "post_id": 41955509, "comment_id": 71098894, "body": "Thank you for your good explanations, however,I would like to get an answer for the following: Given (from your example that two (different?) functions:f x y = g (x+1) y and f x = g (x+1), how does the second function( f x = g (x+1)) &quot;Know&quot; that a second parameter (y) is expected?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "edited": false, "score": 0, "creation_date": 1485873160, "post_id": 41955509, "comment_id": 71098986, "body": "@Atir: because Haskell knows the type signature of <code>g</code> and <code>g :: a -&gt; (b -&gt; c)</code> means <code>g (x+1)</code> will &quot;collapse&quot; to <code>g (x+1) :: b -&gt; c</code>, so it reasons it needs a <code>b</code> to generate a <code>c</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "edited": false, "score": 0, "creation_date": 1485901532, "post_id": 41955509, "comment_id": 71115892, "body": "@Atir when you define <code>f x = g (x+1)</code>, you get two types inferred, <code>f :: Num x =&gt; x -&gt; a</code> and <code>g :: Num x =&gt; x -&gt; a</code>. Depending on <i>later/other</i> uses of both/either <code>f</code> and <code>g</code> in your code, that <code>a</code> may get instantiated yet further; in particular, if <code>g x y</code> is found, <code>a</code> would become <code>b -&gt; c</code> for some <code>b</code> and <code>c</code>. You can even try this at the GHCi prompt: try <code>let f x = g (x+1) ; g y = g (y-1)</code> and then e.g. <code>let f x = g (x+1) ; g y z = g z (y+1)</code> (with <code>:set +t</code> enabled to see the types). <i>This</i> is what is referred to by &quot;every function has one argument&quot;."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1485902690, "post_id": 41955509, "comment_id": 71116350, "body": "@WillemVanOnsem terminology: we &quot;bind&quot; a value to a <i>name</i>; we <i>apply</i> a value to a function."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1485902947, "post_id": 41955509, "comment_id": 71116435, "body": "@WillNess: usually when people are rather strict about terminology I think about <a href=\"https://xkcd.com/747/\" rel=\"nofollow noreferrer\">this xkcd comic</a>. But nevertheless in order to keep the blood pressure of my fellow Haskellers acceptable, (modified) ;P"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1485903037, "post_id": 41955509, "comment_id": 71116471, "body": "using wrong terms quickly gets very confusing unless a reader <i>knows</i> already what you mean. newcomers <i>don&#39;t</i>, yet."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1485903075, "post_id": 41955509, "comment_id": 71116487, "body": "@WillNess: yeah, I was joking, I hope you got that :) I hope you&#39;re not angery, usually I appreciate people being able to put things in perspective :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1485903109, "post_id": 41955509, "comment_id": 71116502, "body": ":) ___________________"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1485902948, "last_edit_date": 1485902948, "creation_date": 1485859307, "answer_id": 41955509, "question_id": 41955199, "link": "https://stackoverflow.com/questions/41955199/haskell-function-definition-missing-argument/41955509#41955509", "title": "Haskell function definition, missing argument?", "body": "<p>One of the fundamental aspects of Haskell is that <em>conceptually</em> a function <strong>always takes one argument</strong>. Indeed take for instance the function <code>(+)</code>:</p>\n\n<pre><code>(+) :: Int -&gt; Int -&gt; Int\n</code></pre>\n\n<p>(technically it is <code>(+) :: Num a =&gt; a -&gt; a -&gt; a</code>, but let us keep things simple).</p>\n\n<p>Now you can argue that <code>(+)</code> takes two arguments, but conceptually it takes one argument. Indeed: the signature is in fact</p>\n\n<pre><code>(+) :: Int -&gt; (Int -&gt; Int)\n</code></pre>\n\n<p>So you feed it <strong>one integer</strong> and now it returns a function, for instance:</p>\n\n<pre><code>(+) 5 :: Int -&gt; Int\n</code></pre>\n\n<p>So you have, by giving it a <code>5</code>, constructed a function that will add 5 to a given operand (again a function that takes one argument).</p>\n\n<p>Now applying this to your question, the signature of <code>all'</code> is in fact:</p>\n\n<pre><code>all' :: (a -&gt; Bool) -&gt; ([a] -&gt; Bool)\n</code></pre>\n\n<p>So if you apply <code>all'</code> with one argument, it <strong>returns a function that maps a list <code>[a]</code> to a <code>Bool</code></strong>. Say for the sake of argument that we set <code>p</code> to <code>\\_ -&gt; True</code>, then we return:</p>\n\n<pre><code>foldr (&amp;&amp;) True . map (\\_ -&gt; True) :: [a] -&gt; Bool\n</code></pre>\n\n<p>so indeed a function that takes a list <code>[a]</code> and maps it on a <code>Bool</code>. In a <strong>next phase</strong> you apply a list to <strong>that</strong> (returning) function.</p>\n\n<p>In other words, functional programming can be seen as a long chain of specializing a function further and further until it is fully grounded and can be evaluated.</p>\n\n<p>Haskell only provides this in an elegant way such that you do not have to think about functions generating functions. But conceptually, this happens all the time. Given you want to implement a function <code>f :: a -&gt; b -&gt; c</code>, you can do this like:</p>\n\n<pre><code>f x y = g (x+1) y\n</code></pre>\n\n<p>(with <code>g :: a -&gt; b -&gt; c</code>), but you can also decide to leave a parameter out, and define it as:</p>\n\n<pre><code>f x = g (x+1)\n</code></pre>\n\n<p>since <code>g (x+1)</code> will return a function that can apply with the <code>y</code> eventually.</p>\n"}], "owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "closed_date": 1485884807, "answer_count": 1, "score": 2, "last_activity_date": 1485902948, "creation_date": 1485858519, "last_edit_date": 1485858876, "question_id": 41955199, "link": "https://stackoverflow.com/questions/41955199/haskell-function-definition-missing-argument", "closed_reason": "Duplicate", "title": "Haskell function definition, missing argument?", "body": "<pre><code>module Tf0 where\n\nall' :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nall' p = foldr (&amp;&amp;) True . map p \n\nmain :: IO()\n\nxs = [1,3,5,7,9]\nxs1 = [1,3,11,4,15]\n\nk1 = all' (&lt;10) xs\nk2 = all' (&lt;10) xs1\nk3 = all' (&lt;10)\n\nmain = print k1\n</code></pre>\n\n<p>Questions:</p>\n\n<ol>\n<li><p>In the function definition (<code>all' p = foldr (&amp;&amp;) True . map p</code>) there is no list as an input while the function Type shows a list as an input (<code>[a]</code>), yet trying to check the function (see bellow <code>k1</code>, <code>k2</code>, <code>k3</code>) shows that a list is needed.</p></li>\n<li><p>How can the function be defined without the list?</p></li>\n</ol>\n"}, {"tags": ["haskell", "haskell-snap-framework"], "answers": [{"comments": [{"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "edited": false, "score": 0, "creation_date": 1485865534, "post_id": 41957179, "comment_id": 71093701, "body": "I was hoping snap support it, but apparently I must use a library. I will check it out."}, {"owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "edited": false, "score": 2, "creation_date": 1485916761, "post_id": 41957179, "comment_id": 71120416, "body": "Snap is an HTTP server, not a client.  There are a number of HTTP client libraries you could use.  The one that is probably the &quot;closest&quot; to snap is <a href=\"http://hackage.haskell.org/package/http-streams\" rel=\"nofollow noreferrer\">http-streams</a>.  Both snap and http-streams are built on top of <a href=\"http://hackage.haskell.org/package/io-streams\" rel=\"nofollow noreferrer\">io-streams</a>."}], "tags": [], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "is_accepted": true, "score": 2, "last_activity_date": 1486049558, "last_edit_date": 1486049558, "creation_date": 1485864388, "answer_id": 41957179, "question_id": 41954692, "link": "https://stackoverflow.com/questions/41954692/how-to-send-an-http-request-using-snap-framework/41957179#41957179", "title": "How to send an http request using snap-framework?", "body": "<p>Have you looked at using <a href=\"https://hackage.haskell.org/package/wreq-0.4.1.0/docs/Network-Wreq.html\" rel=\"nofollow noreferrer\"><code>Network.Wreq</code></a>?</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as LAZ\nimport qualified Data.ByteString.Lazy.Char8 as CHA\n\nmakeRequest :: IO (Network.Wreq.Response LAZ.ByteString)\nmakeRequest = do\n   res &lt;- get \"https://www.example.com\"\n   let resBody = res ^. responseBody :: CHA.ByteString\n   return (resBody)\n</code></pre>\n\n<p>Uses simple lens syntax and supports HTTP and HTTPS.</p>\n"}], "owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 1, "accepted_answer_id": 41957179, "answer_count": 1, "score": 2, "last_activity_date": 1486049616, "creation_date": 1485857171, "last_edit_date": 1486049616, "question_id": 41954692, "link": "https://stackoverflow.com/questions/41954692/how-to-send-an-http-request-using-snap-framework", "title": "How to send an http request using snap-framework?", "body": "<p>I want to send an http request to an external API using the Snap framework. Does Snap support it? If not, how to go about it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1485860250, "post_id": 41954482, "comment_id": 71090357, "body": "&quot;I tried many things but I run into type errors.&quot; - Like what? Instead of asking Stack Overflow to write a whole function for you from scratch, show some things you have tried and what errors you encountered while trying them."}, {"owner": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1485861533, "post_id": 41954482, "comment_id": 71091127, "body": "@amalloy, I understand the problem but do not know how I can fix it - I am a newbie to Haskell. Here is what I figured: If I have data of <code>[FilePath]</code> I can use the function <code>doesFileExist::FilePath-&gt;IO Bool</code> and get <code>[IO Bool]</code> in output. But, my data is not <code>[FilePath]</code>. Its <code>IO [FilePath]</code>.  As far as I see, my data is enclosed in a monad which is inside a monad(IO monad wraps the List monad in my case). I think I need some way to apply a function on that data."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1485879631, "post_id": 41954482, "comment_id": 71103773, "body": "If you want to differentiate filepaths to files from filepaths to directories, I recommend that you take a look at the <code>path-io</code> package, in your case particularly the <a href=\"http://hackage.haskell.org/package/path-io-1.2.2/docs/Path-IO.html#v:listDir\" rel=\"nofollow noreferrer\"><code>listDir</code></a> function."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1485863171, "creation_date": 1485863171, "answer_id": 41956762, "question_id": 41954482, "link": "https://stackoverflow.com/questions/41954482/extract-files-and-directories-separately-using-system-directory/41956762#41956762", "title": "Extract files and directories separately using System.Directory", "body": "<p>The first component of such pair should be something like</p>\n\n<pre><code>getOnlyFiles :: FilePath -&gt; IO (Either IOException [FilePath])\ngetOnlyFiles fp = do\n   efs &lt;- getListOfFiles fp\n   case efs of\n      Left err -&gt; return (Left err)\n      Right fs -&gt; Rigth &lt;$&gt; filterM doesFileExist fs\n</code></pre>\n\n<p>The second component is the same, except you want <code>fmap not . doesFileExist</code> instead of <code>doesFileExist</code>.</p>\n\n<p>However, note that using such pair would require to scan the directory twice. A better design, IMO, would be using a function returning a (wrapped) pair such as</p>\n\n<pre><code>getFilesAndDirs :: FilePath -&gt; IO (Either IOException ([FilePath],[FilePath]))\n</code></pre>\n\n<p>If the library provided a <code>partitionM</code> we could exploit it. Sadly it does not, but we can always define it ourselves.</p>\n"}], "owner": {"reputation": 172, "user_id": 3677377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/351e009e9fe02e583159fb4f03a3d064?s=128&d=identicon&r=PG&f=1", "display_name": "Chetan Yewale", "link": "https://stackoverflow.com/users/3677377/chetan-yewale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1485898083, "creation_date": 1485856615, "last_edit_date": 1485898083, "question_id": 41954482, "link": "https://stackoverflow.com/questions/41954482/extract-files-and-directories-separately-using-system-directory", "title": "Extract files and directories separately using System.Directory", "body": "<p>I am new to Haskell. I am familiar with monads, but not proficient. I am getting the contents of a directory and returning them. Now, I need to separate the files which are directories from the ones which are not.</p>\n\n<p><code>System.Directory</code> has a function called </p>\n\n<pre><code>doesFileExist :: FilePath -&gt; IO Bool\n</code></pre>\n\n<p>I have already created a function which returns the contents of a directory. Here's the type signature:</p>\n\n<pre><code>getListOfFiles :: FilePath -&gt; IO (Either IOException [FilePath])\n</code></pre>\n\n<p>Now, I want to create a function which will return a pair. The first element of the pair should contain only the filepaths which are not directories; the second should contain only those filepaths which are directories.</p>\n\n<p>To summarize, given the functions:</p>\n\n<pre><code>doesFileExist :: FilePath -&gt; IO Bool\ngetListOfFiles :: FilePath -&gt; IO (Either IOException [FilePath])\n</code></pre>\n\n<p>how can I obtain a function:</p>\n\n<pre><code>getFilesAndDirs :: (FilePath -&gt; IO (Either IOException [FilePath]),  FilePath -&gt; IO (Either IOException [FilePath]))\n</code></pre>\n\n<p>The first element of the pair should contain only the files which are not directories; the second should contain only those which are directories. The function <code>doesFileExist</code> helps in determining if a file is a directory or not.</p>\n\n<p>Since I am new to Haskell, I have found it very hard to formulate the code for this. I have tried many things but I run into type errors.</p>\n"}, {"tags": ["haskell", "functional-programming", "distributed-computing"], "answers": [{"tags": [], "owner": {"reputation": 54, "user_id": 7317815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12c992f37946da8a3240042a90c0f65e?s=128&d=identicon&r=PG&f=1", "display_name": "XGoVoid", "link": "https://stackoverflow.com/users/7317815/xgovoid"}, "is_accepted": false, "score": 1, "last_activity_date": 1487011259, "creation_date": 1487011259, "answer_id": 42211210, "question_id": 41952486, "link": "https://stackoverflow.com/questions/41952486/which-combinations-of-cap-does-gdh-support/42211210#42211210", "title": "Which combinations of CAP does GdH support?", "body": "<p>From what I've read it's essentially RMI only you're communicating using Mvars, there in my experience aren't really any limitations that any ecosystem for CAP, so much as in the problems in themselves for example YOU can use more than 5 nodes in ETCD or Zookeeper, but all of the election messages, the fact that the leader commits to all nodes, the request forwarding, the checks you have to make before applying the log, doesn't exactly make it performant well does it. </p>\n\n<p>Nobody should be using RMI for a new application in 2017,honestly you would be better off using an RPC package.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/courier\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/courier</a> which is a light weight message passing lib, Zeromq, and Best for last </p>\n\n<p><a href=\"http://haskell-distributed.github.io/\" rel=\"nofollow noreferrer\">http://haskell-distributed.github.io/</a>  which is basically the closest thing you get to OTP on haskell.</p>\n"}], "owner": {"reputation": 95, "user_id": 4342337, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X6GXo.png?s=128&g=1", "display_name": "raviqqe", "link": "https://stackoverflow.com/users/4342337/raviqqe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1487011259, "creation_date": 1485849807, "question_id": 41952486, "link": "https://stackoverflow.com/questions/41952486/which-combinations-of-cap-does-gdh-support", "title": "Which combinations of CAP does GdH support?", "body": "<p>I'm interested in the implementation of GdH (Glasgow Distributed Haskell).\nHowever, I could not find out which combinations in CAP theorem GdH supports.\nCan we choose one of them or do programs in GdH consist of explicit processes like Erlang?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1485842999, "post_id": 41950524, "comment_id": 71081107, "body": "Why does anything special need to be done? What&#39;s wrong with having L&#39;s API include functions like <code>fooWithCallback :: (a -&gt; CmdRequest -&gt; (a, CmdResponse)) -&gt; {- type of foo actions -}</code>? The type of foo actions will have to have a parameter for <code>a</code>, but it really shouldn&#39;t require any tricks or hard work."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1485843614, "post_id": 41950524, "comment_id": 71081336, "body": "For an example of this kind of API, check out <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-IORef.html#v:atomicModifyIORef\" rel=\"nofollow noreferrer\"><code>atomicModifyIORef</code></a>. It has type <code>IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b</code>, which is essentially the same as the type <code>(a -&gt; () -&gt; (a, b)) -&gt; IORef a -&gt; IO b</code>; squinting at this you can see <code>()</code> as a sort of (especially boring) <code>CmdRequest</code>, <code>b</code> as a sort of <code>CmdResponse</code>, and <code>IORef a -&gt; IO b</code> as the type of foo actions to make this fit the shape I proposed in my previous comment."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485852500, "post_id": 41950524, "comment_id": 71085449, "body": "I can see no problem with this. Just keep in mind that if A defines <code>f</code> and <code>CmdRequest</code> is opaque, then <code>f</code> can act on its <code>CmdRequest</code> argument only using the functions exported by L."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1485871906, "post_id": 41950524, "comment_id": 71098060, "body": "There could be a real question here, depending on what is meant by L &quot;storing <code>a</code>&quot;. Presumably it has to do so in a structure which is fed in to L by A, which could be parameterized on <code>a</code>, but what if the same structure needs to be used for varying types <code>a</code>? But the question as it stands is unanswerably broad, I think."}, {"owner": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1485877486, "post_id": 41950524, "comment_id": 71102086, "body": "@ReidBarton Their is a storage structure, but A does not know about it. I added more info and a sequence diagram to the question to hopefully narrow it down."}, {"owner": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485877692, "post_id": 41950524, "comment_id": 71102258, "body": "@DanielWagner I was trying to make <code>a</code> &quot;invisible&quot; to the library but open to the application.  Perhaps it is a simple as adding an <code>a</code> type parameter to the declaration of storage."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1485880959, "post_id": 41950524, "comment_id": 71104697, "body": "Well, a library L cannot have &quot;state&quot; aside from what it is fed by the application A, unless you are using <code>unsafePerformIO</code> or something similar."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1485937250, "post_id": 41950524, "comment_id": 71127662, "body": "&quot;functions with types opaque to a library but specific to an application&quot;. This is the essence of polymorphism."}], "answers": [{"comments": [{"owner": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "edited": false, "score": 0, "creation_date": 1486000001, "post_id": 41967276, "comment_id": 71162926, "body": "You are right that what I was calling L is not really a library.  But it is not a client/server either. For now I just changed (above) what I was calling L/Libary to S/System.  So S is an independent running system that is given callbacks.  You are also right that this is simple parametric polymorphism - just adding a type parameter to S solves the &quot;problem&quot;.  I have added a link to such a parametric solution.  My real question (which admittedly I did not formulate too well) was if there was a way to do this without a type parameter (see my edited/updated question)."}, {"owner": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "edited": false, "score": 0, "creation_date": 1486000020, "post_id": 41967276, "comment_id": 71162932, "body": "FWIW: I do use the haskell binding to ZeroMQ"}, {"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "reply_to_user": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "edited": false, "score": 0, "creation_date": 1486050808, "post_id": 41967276, "comment_id": 71189167, "body": "@haroldcarr, I updated the answer based on updated question. I hope it helps. It is a broad question, so I&#39;m not sure how to address it. I have played with the language extensions a bit. Usually it is interesting, but rarely have I actually opted to use them."}], "tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": false, "score": 0, "last_activity_date": 1486050333, "last_edit_date": 1486050333, "creation_date": 1485895941, "answer_id": 41967276, "question_id": 41950524, "link": "https://stackoverflow.com/questions/41950524/functions-with-types-opaque-to-a-library-but-specific-to-an-application/41967276#41967276", "title": "functions with types opaque to a library but specific to an application", "body": "<p>Having a function opaque to a library but specific to an application is Haskell's bread and butter. For instance, consider <a href=\"https://hackage.haskell.org/package/containers-0.5.9.1/docs/Data-Map-Lazy.html%20Data.Map\" rel=\"nofollow noreferrer\">Data.Map</a> from the \"containers\" package. </p>\n\n<p>A map, <code>m :: Map k a</code>, is a piece of data which associates keys, <code>k</code>, to values <code>a</code>. The Data.Map library doesn't need to know the structure of its values, in fact, keeping the definition of <code>Map</code> polymorphic in <code>k</code> and <code>a</code> precludes the library from doing <em>anything</em> to the contents of the keys and values. Well, almost anything. Typeclases change the conversation a little, and if a user supplies a function on keys or values then they can be changed. The important point remains, however, the polymorphic parametricity restricts what can be done within the library.</p>\n\n<p>You could try to rid yourself of that polymorphic parameter using ExistentialTypes. In terms of your GitHub Code, you could define state using something like:</p>\n\n<pre><code>{-# Language ExistentialQuantification #-}\nimport           Control.Concurrent.MVar\n\ndata State = forall a . State\n  {\n    _nextValue     :: MVar a\n  , _applyLogEntry :: a -&gt; CmdRequest -&gt; (a, CmdResponse)\n  }\n</code></pre>\n\n<p>Where I have removed the monad parameter from your <code>data State m a</code> for the sake of clarity. The value parameter, <code>a</code>, is now hidden by the existential quantification. Ever retrieving the stored value becomes a sticking point. The below code,</p>\n\n<pre><code>getStVal :: State -&gt; IO a\ngetStVal st@(State mva f) = takeMVar mva\n</code></pre>\n\n<p>throws a compilation error, mentioning how the expected type of the function is <code>IO a</code> (due to the <code>getStVal</code> signature) but the actual type is <code>IO a1</code> (due to <code>State</code> type). This is because <code>getStVal</code> is asking for a specific (although unknown at compile time) type, whereas the data definition says the value could be any type (but that we can't assume any particular type at compile time.) </p>\n\n<p>Passing the stored value of <code>a</code> to App doesn't help either, as there is no way for App to vary it's behavior depending on the value of a. The state value can be updated, but never directly inspected. (You can include typeclass information to signal that certain methods, e.g, show, can be applied to the type. <a href=\"https://en.wikibooks.org/wiki/Haskell/Existentially_quantified_types\" rel=\"nofollow noreferrer\">more info</a>)</p>\n\n<p>There are other extensions which you could try. Ultimately, I'm not sure GADTs or RankNTypes will fare any better. You will have to convince the compiler--somehow--that your programs will be able to use the unknown type. But really, polymorphic parameters are usually the best way to do this.   </p>\n"}], "owner": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 148, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1486050333, "creation_date": 1485841804, "last_edit_date": 1486049774, "question_id": 41950524, "link": "https://stackoverflow.com/questions/41950524/functions-with-types-opaque-to-a-library-but-specific-to-an-application", "title": "functions with types opaque to a library but specific to an application", "body": "<p>I want to pass a function:</p>\n\n<pre><code>f :: a -&gt; CmdRequest -&gt; (a, CmdResponse)\n</code></pre>\n\n<p>from an application A to a system S.</p>\n\n<p>S</p>\n\n<ul>\n<li>defines CmdRequest and CmdResponse</li>\n<li>at initialization: given/stores <code>f</code></li>\n<li>at initialization: stores an initial value of <code>a</code> (as an opaque value, S cannot see any <code>a</code> structure)</li>\n<li>calls <code>f</code> (as part of system operation)</li>\n<li>passing it <code>a</code> values it previously stored (from previous calls or system initialization)</li>\n<li>stores the resulting first <code>a</code> component of the return type</li>\n</ul>\n\n<p>A</p>\n\n<ul>\n<li>defines <code>f</code></li>\n<li>at initialization: passes <code>f</code> to S</li>\n<li>at initialization: passes initial value of <code>a</code> to S</li>\n<li>can use specific types for <code>a</code> (e.g., Data.HashMap)</li>\n<li>when <code>f</code> is called it can see the internal structure (e.g., Data.HashMap) of <code>a</code></li>\n</ul>\n\n<p>How can this be done in Haskell/GHC?</p>\n\n<p><strong>What would be the type signature of S's State?\nI think it can be as simple as</strong></p>\n\n<pre><code>State a :: ...\n</code></pre>\n\n<p><strong>but is there a way to hide <code>a</code> ? (where \"hide\" means not specify a type parameter to <code>State</code>)</strong></p>\n\n<p>I initially tried type-classes and existential types, but got stuck.</p>\n\n<p><a href=\"https://github.com/haroldcarr/snippets/tree/master/storage-callbacks\" rel=\"nofollow noreferrer\">example on github</a></p>\n\n<pre><code>A                              S                   S's State\n  initialization\n.                              .                       .\n.                              .                       .\n.                              .                       .\n|                              |                       |\nx---------- pass f -----------&gt;|                       |\n|                              x----- store f --------&gt;|\nx--------------- a -----------&gt;|                       |\n|                              x----- store a --------&gt;|\n                               |                       |\n                               .                       .\n                               .                       .\n                               .                       .\n  system operation\n                               |                       |\n                               |                       |\n                               x------- get f --------&gt;|\n                               |                       |\n                               x------- get a --------&gt;|\n                               |                       |\n|&lt;---- call f a CmdRequest ----|                       |\n|                              |                       |\n|-- return (a', CmdResponse) -&gt;|                       |\n|                              |                       |\n|                              x----- store a' -------&gt;|\n|                              |                       |\n.                              .                       .\n.                              .                       .\n.                              .                       .\n|&lt;--- call f a' CmdRequest ----|                       |\n|                              |                       |\n|- return (a'', CmdResponse) -&gt;|                       |\n|                              |                       |\n|                              x----- store a'' ------&gt;|\n|                              |                       |\n.                              .                       .\n.                              .                       .\n.                              .                       .\n</code></pre>\n"}, {"tags": ["haskell", "sign", "absolute-value"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1485821775, "post_id": 41947663, "comment_id": 71075636, "body": "Looks to me that zero is just a different case. You cannot say the <i>sign</i> of zero is &quot;+&quot;. It is both &quot;+&quot; and &quot;-&quot; at the same time since <code>-0 == +0</code>. (No i did not dv)."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 4, "creation_date": 1485826363, "post_id": 41947663, "comment_id": 71076792, "body": "I think this question could be posed in a more &quot;neutral&quot; fashion."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1485826878, "post_id": 41947663, "comment_id": 71076923, "body": "The Haskell 2010 report only requires that <code>abs x * signum x == x</code>; it says nothing about the size of the codomain of <code>signum</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1485838644, "post_id": 41947663, "comment_id": 71079585, "body": "Let&#39;s suppose this is just a &quot;definition made by academic mathematicians, who don&#39;t worry about computational costs of operations&quot;, then why does Java do the same thing? For types like int, keeping them on the stack (even if you multiply it) is often more efficient than having a cache-miss from the indirection of extra boxed types."}, {"owner": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1485906757, "post_id": 41947663, "comment_id": 71117746, "body": "@Reid, I edited the post following your suggestion."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1486196150, "post_id": 41947663, "comment_id": 71249836, "body": "The Bool option means you only have 2 cases when 3 might be needed ... Also your main concern seems  to be about efficiency vs usefulness. That looks like premature optimisation for me especially as numeric operation are fairly quick on today&#39;s computer."}, {"owner": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "edited": false, "score": 0, "creation_date": 1486209683, "post_id": 41947663, "comment_id": 71253671, "body": "The sign in signed types is just one bit, that is the main motivation to consider it <code>Bool</code>. I was working with a data list where I wanted to save the sign of polynomial terms paired with the exponent of the term, for large number of terms. I was not comfortable saving <code>[(Integer, Integer)]</code> (terms should be <code>Integer</code>) when I just need <code>[(Int, Bool)]</code>. On the other side, testing always 3 cases when you need 2 cases more often than not, is not the optimal way of working. For the requirement  of <code>x == abs x * signum x</code>, it is enough a 2 valued <code>signum</code> function, it is simpler and faster."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1486224399, "post_id": 41947663, "comment_id": 71258112, "body": "Well, if you don&#39;t need 3 values but only 2, you can just use <code>(&gt;=0)</code> instead and you get your Bool. I&#39;m not sure we need to modify signum for that. If you really have a special need because of performance issue, then rolling your own function is acceptable."}, {"owner": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "edited": false, "score": 0, "creation_date": 1486339164, "post_id": 41947663, "comment_id": 71289984, "body": "That is what I was always, always, doing, but not just for performance. So I started to think on a more structured way of treating sign. Finally, with all the help here, I wrote <a href=\"http://lpaste.net/352118\" rel=\"nofollow noreferrer\">this class</a> for my own use, that I share for the interested. It makes my project easier, as some patterns of use are repeated in my work. I choosed Reid example as the best for helping to think."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1485825090, "post_id": 41947761, "comment_id": 71076423, "body": "True, but that raises the question why this is called \u201csignum\u201d. Arguably this operation should be called <code>normalise</code> or something similar, and it should not map 0 to 0 (as that does not have unit modulus)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1485857510, "post_id": 41947761, "comment_id": 71088519, "body": "@leftaroundabout I&#39;d prefer the shorter <code>norm</code>. That aside, the <code>sgn</code> function is a <a href=\"https://en.wikipedia.org/wiki/Sign_function\" rel=\"nofollow noreferrer\">thing in math</a>, and its usual generalization in complex numbers assigns <code>sgn(0) = 0</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485859616, "post_id": 41947761, "comment_id": 71089952, "body": "@Alec <code>norm</code> would be even more misleading \u2013 a <a href=\"https://en.wikipedia.org/wiki/Norm_(mathematics)\" rel=\"nofollow noreferrer\">norm</a> is basically the generalisation of <code>abs</code> to metric vector spaces`."}, {"owner": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "edited": false, "score": 0, "creation_date": 1486074635, "post_id": 41947761, "comment_id": 71202590, "body": "It seems that my approach only works for &quot;signed&quot; types ;-). In fact, it can be seen on the signatures that it is only for ordered types. But ok, what I am dealing with is not applicable to generalized signum function (that is why I used another name, <code>sgn</code>, for a boolean sign). Thank you, your comments and answer helped me."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 10, "last_activity_date": 1485822208, "creation_date": 1485822208, "answer_id": 41947761, "question_id": 41947663, "link": "https://stackoverflow.com/questions/41947663/use-cases-of-signum-for-ordered-numeric-types-in-haskell/41947761#41947761", "title": "Use cases of &#39;signum&#39; for ordered numeric types in Haskell", "body": "<p>You are assuming that \"positive\" and \"negative\" are the only two possible signs. But for e.g. <code>Complex Double</code>, the <code>signum</code> operation returns a complex number with the same \"direction\" but magnitude 1:</p>\n\n<pre><code>Data.Complex&gt; signum (3 :+ 4)\n0.6 :+ 0.8\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "edited": false, "score": 0, "creation_date": 1485911682, "post_id": 41948368, "comment_id": 71119068, "body": "Good example. But you are computing <code>signum</code> on each recursion, which is redundant as the sign is the same while it is not zero. For large inputs you should better try to precompute the sign out of the recursion, as well as <code>abs x</code> and <code>abs y</code>, and treat apart the cases of one of the coordinates being zero. And then, the apparent advantage of <code>signum</code> for this case is in doubt (I think is not)."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "edited": false, "score": 0, "creation_date": 1485998958, "post_id": 41948368, "comment_id": 71162679, "body": "@enrique If you profile the code and see that results in a large bottleneck for input that you are running it on, you can avoid that recomputation <a href=\"http://lpaste.net/351956\" rel=\"nofollow noreferrer\">by using the common Haskell idiom of a &quot;<code>go</code>&quot; function</a>. I&#39;m not sure why it would be necessary to compute the absolute values here, though."}, {"owner": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1486078305, "post_id": 41948368, "comment_id": 71203923, "body": "@David, your code is incomplete, as it needs the separate cases of one coordinate becoming zero when the other one is not zero. But you are right, we don&#39;t need <code>abs</code> if we use <code>signum</code>. This example is good."}, {"owner": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "edited": false, "score": 0, "creation_date": 1486211164, "post_id": 41948368, "comment_id": 71254139, "body": "<a href=\"http://lpaste.net/352015\" rel=\"nofollow noreferrer\">Here</a> is the optimized version of this example using <code>signum</code>, based on the incorrect <a href=\"http://lpaste.net/351956\" rel=\"nofollow noreferrer\">@David solution</a>, and the one using my approach. You can see that first solution doesn&#39;t really use the return value <code>0</code> from <code>signum</code>, as we both need explicit code lines for the cases of one only coordinate becoming zero."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 4, "last_activity_date": 1485826326, "creation_date": 1485826326, "answer_id": 41948368, "question_id": 41947663, "link": "https://stackoverflow.com/questions/41947663/use-cases-of-signum-for-ordered-numeric-types-in-haskell/41948368#41948368", "title": "Use cases of &#39;signum&#39; for ordered numeric types in Haskell", "body": "<p>I've used a function like this to navigate a cursor to a target offset in a square grid by a series of moves to (orthogonally and diagonally) adjacent cells.</p>\n\n<pre><code>move :: (Int, Int) -&gt; [(Int, Int)]\nmove (0, 0) = []\nmove (x, y) = (dx, dy) : move (x - dx, y - dy)\n  where dx = signum x\n        dy = signum y\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "edited": false, "score": 0, "creation_date": 1485912441, "post_id": 41951598, "comment_id": 71119265, "body": "What about the type of <code>x</code> being different than the types of <code>y</code> and <code>z</code> in your example?. In my proposed approach it is not a problem, as all of them have to be instances of <code>Num</code> (and type of <code>x</code> an instance of <code>Ord</code>). I mean, efficiency is not the only, not the main, issue, it is consistency."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "edited": false, "score": 0, "creation_date": 1485920721, "post_id": 41951598, "comment_id": 71121345, "body": "@enrique I&#39;m not sure I see what you mean. Ultimately, things must be the same type if you are going to use <code>*</code>, <code>&#47;</code> and <code>+</code> on them, as in an example like this. You will need conversion functions in either approach if they are different types. The presence or absence of <code>signum</code> doesn&#39;t change that. And you can also be consistent by using <code>signum</code> everywhere..."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "edited": false, "score": 2, "creation_date": 1485923737, "post_id": 41951598, "comment_id": 71122174, "body": "I would argue that <code>signum</code> is also conceptually simpler, because it only requires one, pretty simple, function. Only one function name to remember, it&#39;s clear which results correspond to positive and negative (it would be easier to forget what <code>True</code> means) and zero and you can use it directly with other mathematical operations like the <code>+</code> without requiring some sort of <code>if</code>, guard or <code>case</code>. And incidentally zero is neither negative nor positive so which <code>Bool</code> value should that be? And how should you remember that?"}, {"owner": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "edited": false, "score": 0, "creation_date": 1485980737, "post_id": 41951598, "comment_id": 71155448, "body": "Think of <code>setSgn s y</code> as an overloaded <code>(*) s y</code>, where <code>s</code> is <code>Bool</code> and <code>y</code> can be any type of class <code>Num</code>. So, you don&#39;t need conversion. I would call that function <code>(*)</code> if ad-hoc polymorphism would be possible in Haskell. The conceptual simplicity for me is that <code>signum</code> and <code>abs</code> should be really two faces of the same operation (which is not, see sources), the descomposition of any number into both (also for zero), in a similar fashion as <code>quotRem</code>, so that you shouldn&#39;t need to call two functions if you need <code>signum</code> and <code>abs</code>, which is a usual case."}, {"owner": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "edited": false, "score": 0, "creation_date": 1485993999, "post_id": 41951598, "comment_id": 71161289, "body": "There should be also a composition operation, inverse of that decomposition (which is <code>(*)</code>, ok, despite not being polymorphic). Often, <code>signum</code> is used as a conditional, and this is the main motivation for thinking that it would be convenient to be a Bool value, adding the fact that the information of sign is enclosed in just one bit for signed types. Besides, <code>{*,+1,-1}</code> is a cyclic group, while <code>{*,+1,0,-1}</code> is not. So, finally, the main thing which doesn&#39;t fit is the value zero, as correctly points leftaround in a comment to Daniel answer."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "edited": false, "score": 0, "creation_date": 1485998079, "post_id": 41951598, "comment_id": 71162449, "body": "@enrique That&#39;s not the conversion I mean. If you want something like <code>a + (s * b)</code>, the types will need to be the same for <code>+</code>. Usually, there are more arithmetic operations involved when <code>signum</code> is used than just multiplying by the result. Overall, I can find real world use cases for <code>signum</code> from implementing mathematical concepts (this is what the question title is asking). I would also pose a counter-question: what is a use case of your method that is an improvement over something that uses <code>signum</code> (not just an example of how it works, something that implements a &quot;real world&quot; thing)?"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "edited": false, "score": 0, "creation_date": 1485998084, "post_id": 41951598, "comment_id": 71162451, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/134635/discussion-between-david-young-and-enrique\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 4, "last_activity_date": 1485846530, "last_edit_date": 1495539924, "creation_date": 1485846530, "answer_id": 41951598, "question_id": 41947663, "link": "https://stackoverflow.com/questions/41947663/use-cases-of-signum-for-ordered-numeric-types-in-haskell/41951598#41951598", "title": "Use cases of &#39;signum&#39; for ordered numeric types in Haskell", "body": "<p>To address the question of time complexity:</p>\n\n<p>Branches are not free and if you have to (in concept) multiply values by the result of signum of the same value in several different spots, it would likely be more efficient to have <code>let s = signum x in ...</code> or have that binding in a <code>where</code>-clause. You no longer have to go through a branch every time. Also keep in mind that <a href=\"https://stackoverflow.com/questions/11227809/why-is-it-faster-to-process-a-sorted-array-than-an-unsorted-array\">in some cases, code can slow down due to branching behavior that goes against what the branch predictor expects</a>.</p>\n\n<p>For example, say you have code like this:</p>\n\n<pre><code>f x y z = (s * y) / (1 + (s * z))\n  where\n    s = signum x\n</code></pre>\n\n<p>Analysis of efficiency is often not as clear cut as you might expect and can be <em>highly</em> dependent on very specific aspects of a particular program, as can be seen in the question I linked above, hence the oft quoted advice of \"profile before optimizing\". In the question I linked  to, the version of the code which executes more instructions actually runs <em>faster</em> than the version that executes <em>fewer</em> instructions (I can verify these results on my machine, even if I include the extra instructions of sorting in the profiling)!</p>\n"}], "owner": {"reputation": 418, "user_id": 2124786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07784bb9df5501d79fe7d6692aa56262?s=128&d=identicon&r=PG", "display_name": "enrique", "link": "https://stackoverflow.com/users/2124786/enrique"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1283, "favorite_count": 0, "accepted_answer_id": 41948368, "answer_count": 3, "score": 0, "last_activity_date": 1486167630, "creation_date": 1485821439, "last_edit_date": 1486167630, "question_id": 41947663, "link": "https://stackoverflow.com/questions/41947663/use-cases-of-signum-for-ordered-numeric-types-in-haskell", "title": "Use cases of &#39;signum&#39; for ordered numeric types in Haskell", "body": "<p>The <code>signum</code> function is the implementation of the usual <a href=\"https://en.wikipedia.org/wiki/Sign_function\" rel=\"nofollow noreferrer\">mathematical definition of sign</a>, which conditionally returns a value in {-1,0,1}. It is a theoretical definition, and as such, it doesn't take into account computational costs of operations, or data type of values, so that multiplying by (-1) is a zero cost theoretical way of changing sign. Because of that, it is not the most useful treatment of sign for programming. </p>\n\n<p>The case <code>signum a == 0</code> is not really useful, as you can always test directly <code>a == 0</code>, without the extra cost of computing <code>signum a</code>. As for the other two values, I think that they are used in just 3 general ways: </p>\n\n<ul>\n<li><p>either you test if a value is positive or negative to launch different code conditionally, as in: </p>\n\n<pre><code>f x y | signum x == -1  = h x y\n      | otherwise       = g x y\n</code></pre></li>\n<li><p>or you multiply something by <code>1</code> or <code>-1</code> before operate with it, as in: </p>\n\n<pre><code>f x y = g x (y * b) where \n      b = signum x\n</code></pre></li>\n<li><p>or you add <code>1</code> or <code>-1</code> to something before operate with it, as in: </p>\n\n<pre><code>f x y = g x (y + b) where \n      b = signum x\n</code></pre></li>\n</ul>\n\n<p>In all cases, it would be better a <code>Bool</code> value for sign. So, we just need functions to decompose a <code>Num</code> into absolute value and boolean sign, and an inverse function, which changes the sign of a value depending of a boolean condition (which represents a sign). This function is the equivalent of multiplying <code>1</code> or <code>-1</code> by a number, so we define it as an operator similar to <code>(*)</code>. : </p>\n\n<pre><code>sgn  a      = a &gt;= 0\n(*.) a True = a\n(*.) a _    = -a\nabs  a      = a *. sgn a\nsignum1 a   = 1 *. sgn a\n</code></pre>\n\n<p>I added a dichotomous variant of <code>signum</code> which can only return \u00b4{-1,1}\u00b4. Notice that preceding it with <code>signum 0 = 0</code> we would get the usual <code>signum</code> function, but that third case is what I think that is not generally useful. </p>\n\n<p>We can code similarly an adding operator, because it is a very frequent case to add <code>1</code> or <code>-1</code> depending on the sign of something (you can see that these operators just treat <code>True</code> as <code>1</code> and <code>False</code> as <code>-1</code>): </p>\n\n<pre><code>(+.) a b    = a + 1 *. b\n(-.) a b    = a - 1 *. b\n</code></pre>\n\n<p>We could even enclose the declarations in a class called <code>Signed</code>, for easier use, including proper signatures and fixity.</p>\n\n<p>This way, the above general examples would simplify, not just in code, but also in execution time and space, because we avoid multiplication (using <code>(*.)</code> instead), we avoid extra comparison once we have a <code>Bool</code>, we can get the sign from one type of data and use it for another type without needing type conversion, and we use the short type <code>Bool</code> instead of a potentially long type of class <code>Num</code>. But we get more flexibility, while allowing some optimization of code and data types. </p>\n\n<p>My question, then, is if there are cases different than the three general use cases exposed here, that is, cases not easily covered by this approach, cases for which the current <code>signum</code> function is advantageous against a Bool sign approach. More precisely, can I avoid completely the use of the current <code>signum</code> function without losing efficiency or code clarity?</p>\n\n<hr>\n\n<p><strong>Edit</strong>: I modified the first paragraph to a more \"neutral\" fashion, following Reid Barton comment. </p>\n\n<hr>\n\n<p><strong>Progress update:</strong> the code for this approach was greatly improved for simplicity and clarity, with the great help of the current answers and comments. </p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1485821279, "post_id": 41945814, "comment_id": 71075523, "body": "The source tarballs are in <code>~&#47;.stack&#47;indices&#47;Hackage&#47;packages&#47;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 3, "last_activity_date": 1485814071, "creation_date": 1485814071, "answer_id": 41946264, "question_id": 41945814, "link": "https://stackoverflow.com/questions/41945814/stack-project-dependencies-source-code-location/41946264#41946264", "title": "Stack project dependencies source code location", "body": "<p>If i remember correctly there are source files in <code>$HOME/.stack</code> somewhere, except for the packages listed in dependencies, those should be in your <code>.stack-work</code>.</p>\n\n<p>But if you want to change some dependencies I would recommend putting those in a separate directory and put a reference to it in your packages section in the <code>stack.yaml</code></p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 41946264, "answer_count": 1, "score": 1, "last_activity_date": 1485819405, "creation_date": 1485812209, "last_edit_date": 1485819405, "question_id": 41945814, "link": "https://stackoverflow.com/questions/41945814/stack-project-dependencies-source-code-location", "title": "Stack project dependencies source code location", "body": "<p>Does stack save the project's dependencies source code? If so, where?</p>\n\n<p>I've done a textual search in the project's <code>.stack-work/</code> but didn't find anything there.</p>\n"}, {"tags": ["haskell", "x11", "haskell-stack", "xmonad"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1485803604, "post_id": 41943494, "comment_id": 71067509, "body": "Look at the config log. Can you run <code>pkg-config xft --libs</code>?"}, {"owner": {"reputation": 51, "user_id": 5006463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d6c834ab3d1eaf87d478c4ec79c357c?s=128&d=identicon&r=PG&f=1", "display_name": "brcul", "link": "https://stackoverflow.com/users/5006463/brcul"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1485804263, "post_id": 41943494, "comment_id": 71067851, "body": "Added. And log <code>.stack-work&#47;logs&#47;X11-xft-0.3.1.log</code>  has been printed."}, {"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1485804975, "post_id": 41943494, "comment_id": 71068222, "body": "Maybe using <code>--verbose</code> would be help."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1485807818, "post_id": 41943494, "comment_id": 71069667, "body": "Cabal and stack logs are known to be a bit terse. Have you looked at /home/suzumiya/.stack/global-project/.stack-work/logs/X11-xf&zwnj;&#8203;t-0.3.1.log? Try to rerun the &#39;cabal configure&#39; with more verbosity."}, {"owner": {"reputation": 51, "user_id": 5006463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d6c834ab3d1eaf87d478c4ec79c357c?s=128&d=identicon&r=PG&f=1", "display_name": "brcul", "link": "https://stackoverflow.com/users/5006463/brcul"}, "edited": false, "score": 0, "creation_date": 1485810193, "post_id": 41943494, "comment_id": 71070912, "body": "Sorry, I have solved this problem by upgrading freetype2 which was destroyed by new version harfbuzz provided by arch. It seems not related to haskell stack."}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 5006463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d6c834ab3d1eaf87d478c4ec79c357c?s=128&d=identicon&r=PG&f=1", "display_name": "brcul", "link": "https://stackoverflow.com/users/5006463/brcul"}, "is_accepted": true, "score": 2, "last_activity_date": 1485810597, "creation_date": 1485810597, "answer_id": 41945455, "question_id": 41943494, "link": "https://stackoverflow.com/questions/41943494/haskell-stack-missing-c-library-xft-when-using-stack-building-x11-xft/41945455#41945455", "title": "Haskell Stack: Missing C library Xft when using stack building X11-xft?", "body": "<p>Upgrade freetype2. It is simply caused by the broken old version of freetype2 package using old harfbuzz.</p>\n"}], "owner": {"reputation": 51, "user_id": 5006463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d6c834ab3d1eaf87d478c4ec79c357c?s=128&d=identicon&r=PG&f=1", "display_name": "brcul", "link": "https://stackoverflow.com/users/5006463/brcul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "accepted_answer_id": 41945455, "answer_count": 1, "score": 3, "last_activity_date": 1541950134, "creation_date": 1485802845, "last_edit_date": 1541950134, "question_id": 41943494, "link": "https://stackoverflow.com/questions/41943494/haskell-stack-missing-c-library-xft-when-using-stack-building-x11-xft", "title": "Haskell Stack: Missing C library Xft when using stack building X11-xft?", "body": "<pre><code>\u2693  ~  stack build X11-xft\nX11-xft-0.3.1: configure\n\n--  While building package X11-xft-0.3.1 using:\n      /home/suzumiya/.stack/setup-exe-cache/x86_64-linux-ncurses6/Cabal-simple_mPHDZzAJ_1.24.0.0_ghc-8.0.1 --builddir=.stack-work/dist/x86_64-linux-ncurses6/Cabal-1.24.0.0 configure --with-ghc=/home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc --with-ghc-pkg=/home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --user --package-db=clear --package-db=global --package-db=/home/suzumiya/.stack/snapshots/x86_64-linux-ncurses6/lts-7.18/8.0.1/pkgdb --package-db=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/pkgdb --libdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/lib --bindir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/bin --datadir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/share --libexecdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/libexec --sysconfdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/etc --docdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/doc/X11-xft-0.3.1 --htmldir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/doc/X11-xft-0.3.1 --haddockdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/doc/X11-xft-0.3.1 --dependency=X11=X11-1.6.1.2-22TNurK7nbm9YWNib5sChe --dependency=base=base-4.9.0.0 --dependency=utf8-string=utf8-string-1.0.1.1-2T8mBCuEDlXDo8zed8Onw4\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/suzumiya/.stack/global-project/.stack-work/logs/X11-xft-0.3.1.log\n\n    Configuring X11-xft-0.3.1...\n    Cabal-simple_mPHDZzAJ_1.24.0.0_ghc-8.0.1: Missing dependency on a foreign\n    library:\n    * Missing C library: Xft\n    This problem can usually be solved by installing the system package that\n    provides this library (you may need the \"-dev\" version). If the library is\n    already installed but in a non-standard location then you can use the flags\n    --extra-include-dirs= and --extra-lib-dirs= to specify where it is.\n \u2693  ~  ls /usr/include/X11/Xft/Xft.h \n/usr/include/X11/Xft/Xft.h\n \u2693  ~  ls /usr/lib/libXft.so \n/usr/lib/libXft.so@\n</code></pre>\n\n<p>I have installed the xft and can find it on default path. But it still says that there is a C library missing.\nusing arch x86_64, stack 1.3.2, sandboxed ghc</p>\n\n<pre><code> \u2693  ~  pkg-config --version\n0.29.1\n \u2693  ~  pkg-config xft --libs\n-lXft\n</code></pre>\n\n<p>and detailed debug info listed:</p>\n\n<pre><code> \u2693  ~  stack build X11-xft --verbose\nVersion 1.3.2 x86_64\nCompiled with:\n- Cabal-1.24.0.0\n- Glob-0.7.14\n- HUnit-1.5.0.0\n- MonadRandom-0.4.2.3\n- QuickCheck-2.9.2\n- SHA-1.6.4.2\n- StateVar-1.1.0.4\n- aeson-1.0.2.1\n- aeson-compat-0.3.6\n- annotated-wl-pprint-0.7.0\n- ansi-terminal-0.6.2.3\n- ansi-wl-pprint-0.6.7.3\n- array-0.5.1.1\n- asn1-encoding-0.9.4\n- asn1-parse-0.9.4\n- asn1-types-0.3.2\n- async-2.1.1\n- attoparsec-0.13.1.0\n- auto-update-0.1.4\n- base-4.9.0.0\n- base-compat-0.9.1\n- base-orphans-0.5.4\n- base16-bytestring-0.1.1.6\n- base64-bytestring-1.0.0.1\n- bifunctors-5.4.1\n- binary-0.8.3.0\n- binary-tagged-0.1.4.2\n- bitarray-0.0.1.1\n- blaze-builder-0.4.0.2\n- blaze-html-0.8.1.3\n- blaze-markup-0.7.1.1\n- byteable-0.1.1\n- bytestring-0.10.8.1\n- call-stack-0.1.0\n- case-insensitive-1.2.0.7\n- cereal-0.5.4.0\n- clock-0.7.2\n- comonad-5\n- conduit-1.2.8\n- conduit-extra-1.1.15\n- connection-0.2.6\n- constraints-0.8\n- containers-0.5.7.1\n- contravariant-1.4\n- cookie-0.4.2.1\n- cryptohash-0.11.9\n- cryptohash-conduit-0.1.1\n- cryptonite-0.21\n- data-default-class-0.1.2.0\n- deepseq-1.4.2.0\n- digest-0.0.1.2\n- directory-1.2.6.2\n- distributive-0.5.1\n- dlist-0.8.0.2\n- easy-file-0.2.1\n- either-4.4.1.1\n- enclosed-exceptions-1.0.2\n- errors-2.1.3\n- exceptions-0.8.3\n- extra-1.5.1\n- fast-logger-2.4.7\n- file-embed-0.0.10\n- filelock-0.1.0.1\n- filepath-1.4.1.0\n- foundation-0.0.3\n- free-4.12.4\n- fsnotify-0.2.1\n- generic-deriving-1.11.1\n- generics-sop-0.2.3.0\n- ghc-boot-th-8.0.1\n- ghc-prim-0.5.0.0\n- gitrev-1.2.0\n- hashable-1.2.5.0\n- hastache-0.6.1\n- hinotify-0.3.9\n- hit-0.6.3\n- hourglass-0.2.10\n- hpack-0.16.0\n- hpc-0.6.0.3\n- hspec-2.3.2\n- hspec-core-2.3.2\n- hspec-discover-2.3.2\n- hspec-expectations-0.8.2\n- hspec-smallcheck-0.4.1\n- http-api-data-0.3.5\n- http-client-0.5.5\n- http-client-tls-0.3.3.1\n- http-conduit-2.2.3\n- http-types-0.9.1\n- ieee754-0.7.9\n- integer-gmp-1.0.0.1\n- lifted-async-0.9.1\n- lifted-base-0.2.3.8\n- logict-0.6.0.2\n- memory-0.14\n- microlens-0.4.7.0\n- mime-types-0.1.0.7\n- mmorph-1.0.9\n- monad-control-1.0.1.0\n- monad-logger-0.3.20.1\n- monad-loops-0.4.3\n- monad-unlift-0.2.0\n- mono-traversable-1.0.1.1\n- mtl-2.2.1\n- network-2.6.3.1\n- network-uri-2.6.1.0\n- old-locale-1.0.0.7\n- old-time-1.1.0.3\n- open-browser-0.2.1.0\n- optparse-applicative-0.13.0.0\n- optparse-simple-0.0.3\n- parsec-3.1.11\n- path-0.5.11\n- path-io-1.2.2\n- path-pieces-0.2.1\n- patience-0.1.1\n- pem-0.2.2\n- persistent-2.6\n- persistent-sqlite-2.6\n- persistent-template-2.5.1.6\n- pid1-0.1.0.1\n- prelude-extras-0.4.0.3\n- pretty-1.1.3.3\n- primitive-0.6.1.0\n- process-1.4.2.0\n- profunctors-5.2\n- project-template-0.2.0\n- quickcheck-io-0.1.4\n- random-1.1\n- regex-applicative-0.3.3\n- regex-applicative-text-0.1.0.1\n- resource-pool-0.2.3.2\n- resourcet-1.1.9\n- retry-0.7.4.2\n- rts-1.0\n- safe-0.3.11\n- safe-exceptions-0.1.4.0\n- scientific-0.3.4.9\n- semigroupoids-5.1\n- semigroups-0.18.2\n- setenv-0.1.1.3\n- silently-1.2.5\n- smallcheck-1.1.1\n- socks-0.5.5\n- split-0.2.3.1\n- stm-2.4.4.1\n- stm-chans-3.0.0.4\n- store-0.3\n- store-core-0.3\n- streaming-commons-0.1.17\n- syb-0.6\n- system-fileio-0.3.16.3\n- system-filepath-0.4.13.4\n- tagged-0.8.5\n- tar-0.5.0.3\n- template-haskell-2.11.0.0\n- temporary-1.2.0.4\n- text-1.2.2.1\n- text-binary-0.2.1.1\n- text-metrics-0.2.0\n- tf-random-0.5\n- th-expand-syns-0.4.2.0\n- th-lift-0.7.6\n- th-lift-instances-0.1.11\n- th-orphans-0.13.3\n- th-reify-many-0.1.6\n- th-utilities-0.2.0.1\n- time-1.6.0.1\n- time-locale-compat-0.1.1.3\n- tls-1.3.9\n- transformers-0.5.2.0\n- transformers-base-0.4.4\n- transformers-compat-0.5.1.4\n- unexceptionalio-0.3.0\n- unicode-transforms-0.2.1\n- unix-2.7.2.0\n- unix-compat-0.4.3.1\n- unix-time-0.3.7\n- unordered-containers-0.2.7.2\n- uri-bytestring-0.2.2.1\n- utf8-string-1.0.1.1\n- uuid-types-1.0.3\n- vector-0.11.0.0\n- vector-algorithms-0.7.0.1\n- vector-binary-instances-0.2.3.4\n- void-0.7.1\n- x509-1.6.5\n- x509-store-1.6.2\n- x509-system-1.6.4\n- x509-validation-1.6.5\n- yaml-0.8.21.1\n- zip-archive-0.3.0.5\n- zlib-0.6.1.2\n- zlib-bindings-0.1.1.5\n\n2017-01-30 19:43:15.759454: [debug] Checking for project config at: /home/suzumiya/stack.yaml\n@(Stack/Config.hs:863:9)\n2017-01-30 19:43:15.759977: [debug] Checking for project config at: /home/stack.yaml\n@(Stack/Config.hs:863:9)\n2017-01-30 19:43:15.760139: [debug] Checking for project config at: /stack.yaml\n@(Stack/Config.hs:863:9)\n2017-01-30 19:43:15.760278: [debug] No project config file found, using defaults.\n@(Stack/Config.hs:885:13)\n2017-01-30 19:43:15.768047: [debug] Run from outside a project, using implicit global project config\n@(Stack/Config.hs:464:13)\n2017-01-30 19:43:15.769112: [debug] Using resolver: lts-7.18 from implicit global project's config file: /home/suzumiya/.stack/global-project/stack.yaml\n@(Stack/Config.hs:478:32)\n2017-01-30 19:43:15.769413: [debug] Trying to decode /home/suzumiya/.stack/build-plan-cache/x86_64-linux/lts-7.18.cache\n@(Data/Store/VersionTagged.hs:68:5)\n2017-01-30 19:43:15.783271: [debug] Success decoding /home/suzumiya/.stack/build-plan-cache/x86_64-linux/lts-7.18.cache\n@(Data/Store/VersionTagged.hs:72:13)\n2017-01-30 19:43:15.807020: [debug] Run process: /sbin/ldconfig -p\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:15.811417: [debug] Process finished in 4ms: /sbin/ldconfig -p\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:15.812074: [debug] Run process: /usr/bin/gcc -v\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:15.814212: [debug] Process finished in 1ms: /usr/bin/gcc -v\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:15.814849: [debug] PIE enabled\n@(Stack/Setup.hs:574:17)\n2017-01-30 19:43:15.816948: [debug] Did not find shared library libtinfo.so.5\n@(Stack/Setup.hs:564:38)\n2017-01-30 19:43:15.817373: [debug] Did not find shared library libtinfo.so.6\n@(Stack/Setup.hs:564:38)\n2017-01-30 19:43:15.817570: [debug] Found shared library libncursesw.so.6 in 'ldconfig -p' output\n@(Stack/Setup.hs:550:29)\n2017-01-30 19:43:15.817762: [debug] Found shared library libgmp.so.10 in 'ldconfig -p' output\n@(Stack/Setup.hs:550:29)\n2017-01-30 19:43:15.818056: [debug] Did not find shared library libgmp.so.3\n@(Stack/Setup.hs:564:38)\n2017-01-30 19:43:15.818220: [debug] Using ncurses6 GHC build\n@(Stack/Setup.hs:600:9)\n2017-01-30 19:43:15.830396: [debug] Getting global package database location\n@(Stack/GhcPkg.hs:55:5)\n2017-01-30 19:43:15.833333: [debug] Asking GHC for its version\n@(Stack/Setup/Installed.hs:103:13)\n2017-01-30 19:43:15.833807: [debug] Getting Cabal package version\n@(Stack/GhcPkg.hs:189:5)\n2017-01-30 19:43:15.833975: [debug] Run process: /home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --no-user-package-db list --global\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:15.836559: [debug] Run process: /home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc --numeric-version\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:15.839088: [debug] Run process: /home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --no-user-package-db field --simple-output Cabal version\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:15.908432: [debug] Process finished in 66ms: /home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --no-user-package-db field --simple-output Cabal version\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:15.943582: [debug] Process finished in 109ms: /home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --no-user-package-db list --global\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:15.981260: [debug] Process finished in 142ms: /home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc --numeric-version\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:15.981640: [debug] Resolving package entries\n@(Stack/Setup.hs:252:5)\n2017-01-30 19:43:15.982926: [debug] Starting to execute command inside EnvConfig\n@(Stack/Runners.hs:163:18)\n2017-01-30 19:43:15.983190: [debug] Parsing the cabal files of the local packages\n@(Stack/Build/Source.hs:298:5)\n2017-01-30 19:43:15.983322: [debug] Parsing the targets\n@(Stack/Build/Source.hs:235:5)\n2017-01-30 19:43:15.983505: [debug] Finding out which packages are already installed\n@(Stack/Build/Installed.hs:68:5)\n2017-01-30 19:43:15.983970: [debug] Run process: /home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --global --no-user-package-db dump --expand-pkgroot\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:16.045432: [debug] Process finished in 61ms: /home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --global --no-user-package-db dump --expand-pkgroot\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:16.069883: [debug] Ignoring package haskeline due to wanting version 0.7.3.0 instead of 0.7.2.3\n@(Stack/Build/Installed.hs:191:5)\n2017-01-30 19:43:16.070184: [debug] Ignoring package Cabal due to wanting version 1.24.2.0 instead of 1.24.0.0\n@(Stack/Build/Installed.hs:191:5)\n2017-01-30 19:43:16.070511: [debug] Run process: /home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --user --no-user-package-db --package-db /home/suzumiya/.stack/snapshots/x86_64-linux-ncurses6/lts-7.18/8.0.1/pkgdb dump --expand-pkgroot\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:16.137950: [debug] Process finished in 67ms: /home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --user --no-user-package-db --package-db /home/suzumiya/.stack/snapshots/x86_64-linux-ncurses6/lts-7.18/8.0.1/pkgdb dump --expand-pkgroot\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:16.138582: [debug] Run process: /home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --user --no-user-package-db --package-db /home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/pkgdb dump --expand-pkgroot\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:16.178161: [debug] Process finished in 39ms: /home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --user --no-user-package-db --package-db /home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/pkgdb dump --expand-pkgroot\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:16.179668: [debug] Trying to decode /home/suzumiya/.stack/indices/Hackage/00-index.cache\n@(Data/Store/VersionTagged.hs:68:5)\n2017-01-30 19:43:16.382636: [debug] Success decoding /home/suzumiya/.stack/indices/Hackage/00-index.cache\n@(Data/Store/VersionTagged.hs:72:13)\n2017-01-30 19:43:16.549706: [debug] Constructing the build plan\n@(Stack/Build/ConstructPlan.hs:159:5)\n2017-01-30 19:43:16.552510: [debug] Checking if we are going to build multiple executables with the same name\n@(Stack/Build.hs:196:5)\n2017-01-30 19:43:16.552797: [debug] Executing the build plan\n@(Stack/Build/Execute.hs:454:5)\n2017-01-30 19:43:16.553846: [debug] Getting global package database location\n@(Stack/GhcPkg.hs:55:5)\n2017-01-30 19:43:16.554005: [debug] Run process: /home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --no-user-package-db list --global\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:16.591687: [debug] Process finished in 37ms: /home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --no-user-package-db list --global\n@(System/Process/Read.hs:306:3)\n2017-01-30 19:43:16.596523: [debug] Exception ignored when attempting to load /tmp/stack2527/X11-xft-0.3.1/.stack-work/dist/x86_64-linux-ncurses6/Cabal-1.24.0.0/stack-config-cache: /tmp/stack2527/X11-xft-0.3.1/.stack-work/dist/x86_64-linux-ncurses6/Cabal-1.24.0.0/stack-config-cache: openBinaryFile: does not exist (No such file or directory)\n@(Data/Store/VersionTagged.hs:86:9)\n2017-01-30 19:43:16.596963: [debug] Exception ignored when attempting to load /tmp/stack2527/X11-xft-0.3.1/.stack-work/dist/x86_64-linux-ncurses6/Cabal-1.24.0.0/stack-cabal-mod: /tmp/stack2527/X11-xft-0.3.1/.stack-work/dist/x86_64-linux-ncurses6/Cabal-1.24.0.0/stack-cabal-mod: openBinaryFile: does not exist (No such file or directory)\n@(Data/Store/VersionTagged.hs:86:9)\n2017-01-30 19:43:16.597160: [info] X11-xft-0.3.1: configure\n@(Stack/Build/Execute.hs:826:23)\n2017-01-30 19:43:16.597834: [debug] Run process: /home/suzumiya/.stack/setup-exe-cache/x86_64-linux-ncurses6/Cabal-simple_mPHDZzAJ_1.24.0.0_ghc-8.0.1 --builddir=.stack-work/dist/x86_64-linux-ncurses6/Cabal-1.24.0.0 configure --with-ghc=/home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc --with-ghc-pkg=/home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --user --package-db=clear --package-db=global --package-db=/home/suzumiya/.stack/snapshots/x86_64-linux-ncurses6/lts-7.18/8.0.1/pkgdb --package-db=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/pkgdb --libdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/lib --bindir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/bin --datadir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/share --libexecdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/libexec --sysconfdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/etc --docdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/doc/X11-xft-0.3.1 --htmldir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/doc/X11-xft-0.3.1 --haddockdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/doc/X11-xft-0.3.1 --dependency=X11=X11-1.6.1.2-22TNurK7nbm9YWNib5sChe --dependency=base=base-4.9.0.0 --dependency=utf8-string=utf8-string-1.0.1.1-2T8mBCuEDlXDo8zed8Onw4\n@(System/Process/Read.hs:340:3)\n\n--  While building package X11-xft-0.3.1 using:\n      /home/suzumiya/.stack/setup-exe-cache/x86_64-linux-ncurses6/Cabal-simple_mPHDZzAJ_1.24.0.0_ghc-8.0.1 --builddir=.stack-work/dist/x86_64-linux-ncurses6/Cabal-1.24.0.0 configure --with-ghc=/home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc --with-ghc-pkg=/home/suzumiya/.stack/programs/x86_64-linux/ghc-ncurses6-8.0.1/bin/ghc-pkg --user --package-db=clear --package-db=global --package-db=/home/suzumiya/.stack/snapshots/x86_64-linux-ncurses6/lts-7.18/8.0.1/pkgdb --package-db=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/pkgdb --libdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/lib --bindir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/bin --datadir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/share --libexecdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/libexec --sysconfdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/etc --docdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/doc/X11-xft-0.3.1 --htmldir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/doc/X11-xft-0.3.1 --haddockdir=/home/suzumiya/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/lts-7.18/8.0.1/doc/X11-xft-0.3.1 --dependency=X11=X11-1.6.1.2-22TNurK7nbm9YWNib5sChe --dependency=base=base-4.9.0.0 --dependency=utf8-string=utf8-string-1.0.1.1-2T8mBCuEDlXDo8zed8Onw4\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/suzumiya/.stack/global-project/.stack-work/logs/X11-xft-0.3.1.log\n\n    Configuring X11-xft-0.3.1...\n    Cabal-simple_mPHDZzAJ_1.24.0.0_ghc-8.0.1: Missing dependency on a foreign\n    library:\n    * Missing C library: Xft\n    This problem can usually be solved by installing the system package that\n    provides this library (you may need the \"-dev\" version). If the library is\n    already installed but in a non-standard location then you can use the flags\n    --extra-include-dirs= and --extra-lib-dirs= to specify where it is.\n</code></pre>\n\n<hr>\n\n<p>I have solved it. It is simply caused by broken old version of freetype2 package using old harfbuzz. It is not about stack build at all.</p>\n"}, {"tags": ["haskell", "heist"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1485803333, "post_id": 41942302, "comment_id": 71067369, "body": "From its source code, it seems that it creates an unescaped <a href=\"http://hackage.haskell.org/package/xmlhtml-0.2.3.5/docs/Text-XmlHtml.html#t:Node\" rel=\"nofollow noreferrer\"><code>Text.XmlHtml.Node</code></a> value. The escaping is probably done elsewhere later on."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485805138, "post_id": 41942302, "comment_id": 71068298, "body": "Hmm, I should have tried an example of this function in isolation. Will modify the question once confirmed."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485823193, "post_id": 41945655, "comment_id": 71075959, "body": "But... the source says <code>textSplice t = return [X.TextNode t]</code> so <code>textSplice</code> already does not escape. The actual issue is probably somewhere else. Probably there&#39;s some serializer somewhere that assumes the text in the nodes is to be escaped (?)"}, {"owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485905098, "post_id": 41945655, "comment_id": 71117208, "body": "Everything in a <code>TextNode</code> gets escaped automatically.  If you don&#39;t want it to get escaped you need to parse it first.  Then don&#39;t call <code>textSplice</code>.  Return the nodes given to you by <code>parseHTML</code> directly."}], "tags": [], "owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "is_accepted": false, "score": 1, "last_activity_date": 1485811517, "creation_date": 1485811517, "answer_id": 41945655, "question_id": 41942302, "link": "https://stackoverflow.com/questions/41942302/is-there-an-alternative-to-textsplice-that-does-not-escape-the-content/41945655#41945655", "title": "Is there an alternative to textSplice that does not escape the content?", "body": "<p>You can avoid the escaping behavior by parsing the whatever you want to include into a list of <code>Node</code>s and then returning those directly.  Here's the function you want:</p>\n\n<p><a href=\"http://hackage.haskell.org/package/xmlhtml-0.2.3.5/docs/Text-XmlHtml.html#v:parseHTML\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/xmlhtml-0.2.3.5/docs/Text-XmlHtml.html#v:parseHTML</a></p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1515845964, "creation_date": 1485798666, "question_id": 41942302, "link": "https://stackoverflow.com/questions/41942302/is-there-an-alternative-to-textsplice-that-does-not-escape-the-content", "title": "Is there an alternative to textSplice that does not escape the content?", "body": "<p><a href=\"https://hackage.haskell.org/package/heist-1.0.1.0/docs/Heist-Interpreted.html#v:textSplice\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/heist-1.0.1.0/docs/Heist-Interpreted.html#v:textSplice</a>\n<code>textSplice</code> appears to escape the contents. It replaces <code>&lt;</code> to <code>&amp;lt;</code> for example.</p>\n\n<p>How can I avoid this escaping behaviour?</p>\n"}, {"tags": ["haskell", "tree"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1485819071, "post_id": 41941740, "comment_id": 71074924, "body": "I&#39;ve closed this question as a duplicate because it&#39;s an instance of the more general concept that the linked question is asking about. If you think this question is different enough to warrant a separate question then let me know, I&#39;ll be quite happy to reopen it :)"}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 3, "last_activity_date": 1485797989, "creation_date": 1485797989, "answer_id": 41942079, "question_id": 41941740, "link": "https://stackoverflow.com/questions/41941740/map-list-over-a-tree/41942079#41942079", "title": "Map List Over a Tree", "body": "<p>You could use <code>State</code> where the state contain the remaining list of values. You can then provide a function which transforms the values in the tree based on the current value and the next value in the input stream e.g.</p>\n\n<pre><code>data Tree a = Leaf a | Node [Tree a] deriving (Show)\n\ninput :: Tree String\ninput = Node [Leaf \"a\", Leaf \"b\", Node [Leaf \"c\", Leaf \"d\"]]\n\nlabelWithState :: (a -&gt; l -&gt; b) -&gt; Tree a -&gt; State [l] (Tree b)\nlabelWithState f (Leaf v) = do\n  (l : ls) &lt;- get\n  put ls\n  pure $ Leaf (f v l)\nlabelWithState f (Node ts) = do\n  lts &lt;- traverse (labelWithState f) ts\n  pure $ Node lts\n\nlabelWith :: (a -&gt; l -&gt; b) -&gt; [l] -&gt; Tree a -&gt; Tree b\nlabelWith f ls t = evalState (labelWithState f t) ls\n</code></pre>\n\n<p>then you can define <code>seqTree</code> as:</p>\n\n<pre><code>seqTree :: [b] -&gt; Tree a -&gt; Tree b\nseqTree = labelWith (\\_ l -&gt; l)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1485805283, "last_edit_date": 1485805283, "creation_date": 1485798313, "answer_id": 41942191, "question_id": 41941740, "link": "https://stackoverflow.com/questions/41941740/map-list-over-a-tree/41942191#41942191", "title": "Map List Over a Tree", "body": "<p>I do not really see why you need a \"finish\" so to speak. You can define a function:</p>\n\n<pre><code>seqTree' :: [b] -&gt; Tree a -&gt; ([b],Tree b)\n</code></pre>\n\n<p>that maps a part of the sequence on the given subtree and returns the resulting tree together with the <em>not</em> yet consumed elements. So you pass the list of elements through the function calls so to speak, each function \"eats\" some elements from it and returns the tail such that other functions can \"eat\" the next elements.</p>\n\n<p>Now as with most recursive functions, there is a base-case where the <code>Tree a</code> is a <code>Leaf x</code>:</p>\n\n<pre><code>seqTree' (x:xs) (Leaf _) = (xs,Leaf x)\n</code></pre>\n\n<p>Here you thus return a <code>Leaf x</code> with the given element of the sequence, and you return the remainder of the sequence.</p>\n\n<p>Next there is also the <code>seqTree'</code> case for the <code>Node</code>, in this case you feed your sequence to a call to <code>seqTree'</code> and that call consumes a part of the tree, the remainder is used in a call for the second child and so on. So for a tree with three children, it would look like:</p>\n\n<pre><code>--Example\nseqTree' xsa (Tree [na,nb,nc]) = (xsd,Tree [oa,ob,oc])\n    where (xsb,oa) = seqTree' xsa na\n          (xsc,ob) = seqTree' xsb nb\n          (xsd,oc) = seqTree' xsc nc\n</code></pre>\n\n<p>Nice thing is, there exists already such a function: <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#v:mapAccumL\" rel=\"nofollow noreferrer\"><code>mapAccumL</code></a>. So you can write:</p>\n\n<pre><code>seqTree' xsa (Node nodes) = (xsz,Node newnodes)\n    where (xsz,newnodes) = mapAccumL seqTree' xsa nodes\n</code></pre>\n\n<p>Or the full function:</p>\n\n<pre><code>seqTree' (x:xs) (Leaf _) = (xs,Leaf x)\nseqTree' xsa (Node nodes) = (xsz,Node newnodes)\n    where (xsz,newnodes) = mapAccumL seqTree' xsa nodes\n</code></pre>\n\n<p>Now we only need to construct a call from <code>seqTree</code> to <code>seqTree'</code> which is simply dropping the remaining feed:</p>\n\n<pre><code>seqTree xs tree = snd $ seqTree' xs tree\n</code></pre>\n\n<p>Or a bit shorter:</p>\n\n<pre><code>seqTree xs = snd . seqTree' xs\n</code></pre>\n\n<p>If I add <code>deriving Show</code> to your <code>Tree a</code> definition and I run the program, I got:</p>\n\n<pre><code>*Main&gt; seqTree [0..] input\nNode [Leaf 0,Leaf 1,Node [Leaf 2,Leaf 3]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 4, "last_activity_date": 1485818435, "last_edit_date": 1485818435, "creation_date": 1485798826, "answer_id": 41942347, "question_id": 41941740, "link": "https://stackoverflow.com/questions/41941740/map-list-over-a-tree/41942347#41942347", "title": "Map List Over a Tree", "body": "<p>I think there is a way to view this as a specific case of something more general: a stateful computation that produces a Tree as output by combining many smaller stateful computations at the original tree's leaves. Lee provides a good way to implement this by hand using State and a list of labels, but we can simplify things and reuse some built-in machinery from Applicative and State, by splitting the job into a two-step process: first, fmap over your tree, replacing each node with an identical value in the <code>State s</code> monad, and then using <code>sequenceA :: Tree (State s a) -&gt; State s (Tree a)</code> to run the stateful computation through each of the nodes in sequence.</p>\n\n<p>Of course, this means you will have to implement Foldable and Traversable for your tree type, but those are good instances to write for a tree type anyway. Supposing that those have been written, you could implement your function like this:</p>\n\n<pre><code>seqTree :: [b] -&gt; Tree a -&gt; Tree b\nseqTree labels = evalState labels . sequenceA . (nextLabel &lt;$)\n  where nextLabel = do\n    (x:xs) &lt;- get\n    put xs\n    pure x\n</code></pre>\n\n<p>Or alternatively, as pointed out in the comments on a previous version of this answer, instead of <code>sequenceA . (nextLabel &lt;$)</code>, it is probably cleaner to write <code>traverse (const nextLabel)</code>.</p>\n"}], "owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "closed_date": 1485818891, "accepted_answer_id": 41942191, "answer_count": 3, "score": 2, "last_activity_date": 1485818862, "creation_date": 1485796745, "last_edit_date": 1485818862, "question_id": 41941740, "link": "https://stackoverflow.com/questions/41941740/map-list-over-a-tree", "closed_reason": "Duplicate", "title": "Map List Over a Tree", "body": "<p>Consider the following definition of a tree:</p>\n\n<pre><code>data Tree a = Leaf a | Node [Tree a]\n</code></pre>\n\n<p>And a sample tree:</p>\n\n<pre><code>input :: Tree String\ninput = Node [Leaf \"a\", Leaf \"b\", Node [Leaf \"c\", Leaf \"d\"]]\n</code></pre>\n\n<p>I'm trying to 'map' a list over such a tree, whereas the values of the tree should be discarded. In the case of <code>[0..]</code> being the list, the result should look like:</p>\n\n<pre><code>output :: Tree Int\noutput = Node [Leaf 0, Leaf 1, Node [Leaf 2, Leaf 3]]\n</code></pre>\n\n<p>So I'm looking for a function..</p>\n\n<pre><code>seqTree :: [b] -&gt; Tree a -&gt; Tree b\nseqTree = undefined\n</code></pre>\n\n<p>.. for which the following holds: </p>\n\n<pre><code>seqTree [0..] input == output\n</code></pre>\n\n<p>I came to the conclusion that a function like this must wrap another function in order to keep track of list items which has not been 'taken' yet:</p>\n\n<pre><code>seqTree' :: [b] -&gt; Tree a -&gt; Tree ([b], b)\nseqTree' xxs@(x:xs) t = case t of\n  Leaf _  -&gt; Leaf (xs, x)\n--Node ts = the tricky part... maybe something with foldr?\nseqTree' [] t = error \"empty list.\"\n</code></pre>\n\n<p>With this I was hoping to implement <code>seqTree</code>, which would require some final mapping over the whole tree, I guess there are better ways to do this, here is a verbose version:</p>\n\n<pre><code>finish :: Tree (a,b) -&gt; Tree b\nfinish t = case t of\n  Leaf v  -&gt; Leaf $ snd v\n  Node ts -&gt; Node (map finish ts)\n</code></pre>\n\n<p>And finally:</p>\n\n<pre><code>seqTree xs t = finish $ seqTree' xs t \n</code></pre>\n\n<p>This compiles, however as marked with the comment, the function <code>seqTree'</code> is partial. Does anybody know how to fix this, and furthermore, what would be a more appropriate, less low level approach for solving this?</p>\n"}, {"tags": ["postgresql", "haskell", "hasql"], "comments": [{"owner": {"reputation": 97819, "user_id": 131874, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b3600796ab1d9e78c7545c91468c2e51?s=128&d=identicon&r=PG", "display_name": "Clodoaldo Neto", "link": "https://stackoverflow.com/users/131874/clodoaldo-neto"}, "edited": false, "score": 0, "creation_date": 1485794033, "post_id": 41940819, "comment_id": 71061970, "body": "The error messages indicate that the <code>$1</code> place holder is not being substituted."}, {"owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "reply_to_user": {"reputation": 97819, "user_id": 131874, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b3600796ab1d9e78c7545c91468c2e51?s=128&d=identicon&r=PG", "display_name": "Clodoaldo Neto", "link": "https://stackoverflow.com/users/131874/clodoaldo-neto"}, "edited": false, "score": 0, "creation_date": 1485804632, "post_id": 41940819, "comment_id": 71068056, "body": "I think error reporting is without variable substitution. Using <code>$1</code> placeholder format works for <code>select ($1 + 4)</code>, so that format seems ok."}], "answers": [{"comments": [{"owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "edited": false, "score": 0, "creation_date": 1485804095, "post_id": 41940959, "comment_id": 71067771, "body": "Since I&#39;m including <code>False</code> the query is for a parameterized query instead of a prepared statement (This function in <code>libpq</code>, <a href=\"https://www.postgresql.org/docs/9.5/static/libpq-exec.html#LIBPQ-PQEXECPARAMS\" rel=\"nofollow noreferrer\">postgresql.org/docs/9.5/static/&hellip;</a>). Running the <code>SET</code> query with single quotes returns <code>commandOk</code>."}, {"owner": {"reputation": 41209, "user_id": 485115, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/59693d66b96ca17ca9d2fdb2393e2be3?s=128&d=identicon&r=PG", "display_name": "Nikita Volkov", "link": "https://stackoverflow.com/users/485115/nikita-volkov"}, "reply_to_user": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "edited": false, "score": 1, "creation_date": 1485814442, "post_id": 41940959, "comment_id": 71073065, "body": "@Mikkel I guess what Laurenz means is that <code>SET</code> can&#39;t be used with a <i>parametric</i> statement. IOW, you need to hardcode the value into that statement. This limitation comes from Postgres, not Hasql."}], "tags": [], "owner": {"reputation": 125670, "user_id": 6464308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/12PVX.jpg?s=128&g=1", "display_name": "Laurenz Albe", "link": "https://stackoverflow.com/users/6464308/laurenz-albe"}, "is_accepted": true, "score": 2, "last_activity_date": 1485855399, "last_edit_date": 1485855399, "creation_date": 1485794165, "answer_id": 41940959, "question_id": 41940819, "link": "https://stackoverflow.com/questions/41940819/hasql-error-from-variable-substitution-in-set-statement/41940959#41940959", "title": "Hasql: Error from variable substitution in &#39;SET&#39; statement", "body": "<p>The <code>SET</code> command cannot be used with a prepared statement. This is a limitation of PostgreSQL. A <em>prepared statement</em> is a statement with optional parameters that can be executed several times with varying parameter values. All statements with parameters are prepared statements in PostgreSQL, regardless if you execute them only once or if you give them a name for reuse.</p>\n\n<p>You'll have to construct a query string with a constant value and execute that.</p>\n\n<p>Alternatively, you could write a function in PostgreSQL that runs the set command for you with dynamic SQL and call that function in a prepared <code>SELECT</code> statement with a parameter.</p>\n"}], "owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 41940959, "answer_count": 1, "score": 0, "last_activity_date": 1485855399, "creation_date": 1485793719, "last_edit_date": 1485806014, "question_id": 41940819, "link": "https://stackoverflow.com/questions/41940819/hasql-error-from-variable-substitution-in-set-statement", "title": "Hasql: Error from variable substitution in &#39;SET&#39; statement", "body": "<p>I'm trying to write a parameterized statement with Hasql to set a variable in PostgreSQL.</p>\n\n<pre><code>import qualified Hasql.Encoders as E\nimport qualified Hasql.Decoders as D\n\nsetOrganization :: Query Int64 ()\nsetOrganization = statement sql (E.value E.int8) D.unit False\n  where\n    sql = \"set my_session.organization_id = $1\"\n</code></pre>\n\n<p>The result from the above is:</p>\n\n<pre><code>ResultError (ServerError \"42601\" \"syntax error at or near \\\"$1\\\"\" Nothing Nothing)\n</code></pre>\n\n<p>Adding single quotes e.g.</p>\n\n<pre><code>    sql = \"set my_session.organization_id = '$1'\"\n</code></pre>\n\n<p>Gives this result when I run a query using the variable:</p>\n\n<pre><code>ResultError (ServerError \"22P02\" \"invalid input syntax for integer: \\\"$1\\\"\" Nothing Nothing)\n</code></pre>\n\n<p>Which does make sense since the <code>organization_id</code> is a <code>bigint</code> / <code>int8</code>.</p>\n\n<p>Hard-coding the <code>$1</code> value in either format works. I've tried different Hasql types e.g. <code>E.text</code> and <code>E.unknown</code> and that does not work.</p>\n\n<hr>\n\n<p>Update: Using the more primitive <code>execParams</code> function from <code>postgresql-libpq</code>.</p>\n\n<pre><code>execParams c \"SET my_session.organization_id = '$1'\" [Just (Oid 20, \"1\",Text)] Text\n</code></pre>\n\n<p>Unquoted variable gives <code>FatalError</code> result. Single-quoted variable gives <code>CommandOk</code>, but is wrong type  (not <code>bigint</code>) for later queries.</p>\n"}, {"tags": ["haskell", "monad-transformers", "parser-combinators", "attoparsec", "megaparsec"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1485794954, "post_id": 41939715, "comment_id": 71062506, "body": "I actually thought that the lack of overhead related to error messages was a key component of the improved performance. If you are going to add that overhead back in, why not just use a library that already does it (and may be better optimized than your implementation)?"}, {"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1485804694, "post_id": 41939715, "comment_id": 71068093, "body": "Yeah, I think you&#39;re right. But I&#39;m curious about the title nevertheless. If I can&#39;t use <code>megaparsec</code> for some reason? Or if I encounter similar situation sometime?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1485807466, "post_id": 41939715, "comment_id": 71069479, "body": "I&#39;m not sure what wrapping <code>Parser</code> in <code>StateT</code> would gain you, since you would have to somehow maintain the state in between <code>attoparsec</code> calls?"}, {"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1485808152, "post_id": 41939715, "comment_id": 71069837, "body": "I thought I could embed the parsing position, when I think again it is not. Now it is a just parser with a state."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1485808641, "post_id": 41939715, "comment_id": 71070082, "body": "Right so I think <code>Parser</code> throws away some information in the interest of performance (at the expense of usability). I think it would be quite tedious to try to recover that externally, you would probably be better off recreating the primitives. If there&#39;s any question about whether you need maximal speed, I would say use something more user friendly."}, {"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1485810911, "post_id": 41939715, "comment_id": 71071237, "body": "I can&#39;t understand what is external / recreating primitives. So can&#39;t I avoid implementation complexity?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1485818238, "post_id": 41939715, "comment_id": 71074644, "body": "@jeiea A little context that should hopefully help you make a decision: <code>attoparsec</code> is designed for high-performance low-level applications with a focus on byte-strings: networking protocols, binary file formats, that sort of thing. <code>attoparsec</code> trades some flexibility (and high-quality error-reporting) for speed. <code>megaparsec</code> is designed for user-facing stuff like compiler front-ends where very high performance is less of a concern. If you&#39;re writing a preprocessor I&#39;d definitely go for <code>megaparsec</code>."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1485869441, "post_id": 41939715, "comment_id": 71096385, "body": "@jeiea Per your edit, I think you could wrap <code>Parser</code> in <code>StateT</code>, but I think that would achieve something fundamentally different from what you&#39;re looking for. You would be able to manipulate the state in between and based on the result of parse calls, and use the state to determine what parses to try, but you wouldn&#39;t be able to recover position information unless you try to maybe discern how much was consumed based on the result of a parse?"}, {"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1485874572, "post_id": 41939715, "comment_id": 71099978, "body": "Yeah, that&#39;s what I mean when I wrote <i>when I think again it is not</i>. Can&#39;t I question without a practical example?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1485889538, "post_id": 41939715, "comment_id": 71109879, "body": "@jeiea As for the lifting, you might be able to create a <code>newtype</code> and maybe derive (or implement) <code>MonadState</code> and define things in terms of that type. I think asking without a practical example is fine, but mixing it in with a practical question became confusing. If you specifically want to know about using monad transformers without having to lift every operation, you could research that and ask any questions you may have, but I don&#39;t think <code>Parser</code> is unique since the whole point of a monad transformer is that it should work with <i>any</i> <code>Monad</code>."}], "answers": [{"tags": [], "owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "is_accepted": true, "score": 2, "last_activity_date": 1501412349, "last_edit_date": 1501412349, "creation_date": 1501411109, "answer_id": 45398917, "question_id": 41939715, "link": "https://stackoverflow.com/questions/41939715/can-i-easily-wrap-attoparsec-in-transformer/45398917#45398917", "title": "Can I easily wrap attoparsec in transformer?", "body": "<p>You can get the current parse position from <em>attoparsec</em>, without needing a transformer.  But there is no exported function to do it; you have to define it yourself:</p>\n\n<pre><code>import qualified Data.Attoparsec.Internal.Types as T\n\noffset :: T.Parser i T.Pos\noffset = T.Parser $ \\t pos more lose succ -&gt; succ t pos more pos\n</code></pre>\n\n<p>Example usage:</p>\n\n<pre><code>\u03bb&gt; parseOnly (many' (skipMany (word8 46) *&gt; offset &lt;* anyWord8)) \".a..a...a....a\"\nRight [Pos {fromPos = 1},Pos {fromPos = 4},Pos {fromPos = 8},Pos {fromPos = 13}]\n</code></pre>\n\n<p>This works as expected for incremental input, too.  It only gives you\nthe offset into the input, not <code>(line, column)</code>, but the offset is\nsufficient for many applications.</p>\n\n<p>Use <code>fromPos</code> to get the <code>Int</code> from a <code>Pos</code>:</p>\n\n<pre><code>\u03bb&gt; T.fromPos &lt;$&gt; parseOnly offset \"\"\nRight 0\n</code></pre>\n\n<p>Now, we can use <code>offset</code> to create a parser that reports the current\noffset when it fails.</p>\n\n<pre><code>reportOffsetOnError :: T.Parser i a -&gt; T.Parser i a\nreportOffsetOnError p =\n  p &lt;|&gt; (offset &gt;&gt;= \\pos -&gt;\n    fail (\"failed at offset: \" ++ show (T.fromPos pos)))\n</code></pre>\n\n<p>Example usage:</p>\n\n<pre><code>\u03bb&gt; parseOnly (word8 46 *&gt; word8 46 *&gt; reportOffsetOnError (word8 97)) \"..a\"\nRight 97\n\u03bb&gt; parseOnly (word8 46 *&gt; word8 46 *&gt; reportOffsetOnError (word8 97)) \"..b\"\nLeft \"Failed reading: failed at offset: 2\"\n</code></pre>\n\n<p>A final note: <a href=\"https://hackage.haskell.org/package/attoparsec/docs/Data-Attoparsec-Zepto.html\" rel=\"nofollow noreferrer\"><code>Data.Attoparsec.Zepto</code></a> does provide the <code>ZeptoT</code> transformer if you really need a transformer and want to stay with the <em>attoparsec</em> package, but this is a different parser type from the main parser in <em>attoparsec</em>.</p>\n"}], "owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 1, "accepted_answer_id": 45398917, "answer_count": 1, "score": 0, "last_activity_date": 1501412349, "creation_date": 1485790446, "last_edit_date": 1485875105, "question_id": 41939715, "link": "https://stackoverflow.com/questions/41939715/can-i-easily-wrap-attoparsec-in-transformer", "title": "Can I easily wrap attoparsec in transformer?", "body": "<p>I want to write code doing something like C preprocessing. So I looked for libraries and got two candidates, <code>attoparsec</code>, <code>megaparsec</code>.</p>\n\n<p>I need the feature reporting error position and <code>megaparsec</code> already has that. But <code>attoparsec</code> would be desirable for performance.</p>\n\n<p>If I add the error position feature to <code>attoparsec</code>'s <code>Parser</code> monad, then should I have to wrap it up in <code>StateT</code> transformer and lift all that library's function when I use them? I think it's tiresome work. Is there any better method?</p>\n\n<h3>EDIT</h3>\n\n<p>I will adopt <code>megaparsec</code> which is appropriate to this situation. But I still want to know how can I wrap <code>attoparsec</code>'s <code>Parser</code> monad. Is there anyone could tell me whether the method I mentioned above is the best one or not?</p>\n\n<p>I want to know just the monad wrapping method. In other words, whether lifting all inner monad function is the only solution or not.</p>\n"}, {"tags": ["haskell", "derived-instances"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1485790903, "last_edit_date": 1485790903, "creation_date": 1485790583, "answer_id": 41939757, "question_id": 41939280, "link": "https://stackoverflow.com/questions/41939280/how-to-create-standalonederiving-instances/41939757#41939757", "title": "How to create StandaloneDeriving instances", "body": "<p>The <code>a</code> is <code>LineItem a</code> is not a type, i.e. it has not kind <code>*</code>.\nInstead, it has kind <code>* -&gt; *</code>.</p>\n\n<p>This means that <code>a</code> is expected to be replaced with a type constructor. For instance, <code>LineItem Maybe</code> is well-kinded, but <code>LineItem (Maybe Int)</code> is not.</p>\n\n<p>The most general <code>Show</code> instance is then something like</p>\n\n<pre><code>deriving instance (Show (a String), Show (a Int), Show (a Float)) \n                  =&gt; Show (LineItem a)\n</code></pre>\n\n<p>but there the context involves more complex types than the head. This will surely require to turn on <code>UndecidableInstances</code> and possibly a few other extensions. </p>\n\n<p>Note that, since this instance does not \"simplify\" the head into smaller constraints, there's the chance that by adding further \"bad\" instances we can make the compiler to loop forever. In practice, this rarely happens, and I wouldn't worry too much about it.</p>\n\n<p>If you know <code>a</code> in subsequent uses has only a finite number of cases, you can list them one by one, providing an instance for each one, as you did in your edit.</p>\n\n<pre><code>deriving instance Show (LineItem TyCon1)\n...\nderiving instance Show (LineItem TyConN)\n</code></pre>\n"}], "owner": {"reputation": 8452, "user_id": 621427, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/0eFAm.png?s=128&g=1", "display_name": "robkuz", "link": "https://stackoverflow.com/users/621427/robkuz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 41939757, "answer_count": 1, "score": 1, "last_activity_date": 1485790903, "creation_date": 1485789225, "last_edit_date": 1485789609, "question_id": 41939280, "link": "https://stackoverflow.com/questions/41939280/how-to-create-standalonederiving-instances", "title": "How to create StandaloneDeriving instances", "body": "<p>Given the following code</p>\n\n<pre><code>{-# LANGUAGE StandaloneDeriving  #-}\n\ntype Date = Int\ndata Decision a = Decision a deriving (Show)  \n\ndata InProgress a = InProgress {progress :: a, decision :: Decision a } deriving (Show)\ndata Finished a = Finished {finished :: a, initial :: a, timestamp :: Date } deriving (Show)  \n\ndata LineItem a = LineItem {article :: a String, amount :: a Float, units :: a Int } deriving (Show)  \n</code></pre>\n\n<p>I get the following error </p>\n\n<pre><code>source_file.hs:11:96:\n    No instance for (Show (a Float))\n    arising from the second field of \u2018LineItem\u2019 (type \u2018a Float\u2019)\n    Possible fix:\n    use a standalone 'deriving instance' declaration,\n        so you can specify the instance context yourself\n    When deriving the instance for (Show (LineItem a))\n</code></pre>\n\n<p>I tried some variations like this below - but I cant get it run.</p>\n\n<pre><code>deriving instance Show a =&gt; Show (InProgress Float)\n</code></pre>\n\n<p>How can I fix this? (and some explanation would be really appreciated)</p>\n\n<p><strong>Edit</strong></p>\n\n<p>Okay, I have the solution</p>\n\n<pre><code>deriving instance Show (LineItem InProgress)\n</code></pre>\n\n<p>will do what I want. Still I dont get why its not</p>\n\n<pre><code>deriving instance Show a =&gt; Show (LineItem (InProgress a))\n</code></pre>\n"}, {"tags": ["haskell", "equality", "induction"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1485783602, "post_id": 41937113, "comment_id": 71054969, "body": "This might be more suited for the Math site if you can translate the code into proper notation."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 7, "last_activity_date": 1485790042, "last_edit_date": 1485790042, "creation_date": 1485784749, "answer_id": 41937704, "question_id": 41937113, "link": "https://stackoverflow.com/questions/41937113/to-prove-equality-of-functions/41937704#41937704", "title": "To prove equality of functions", "body": "<p>I think it's morally OK, but you should be more precise. As it is it's hard to follow -- e.g. where did you use the induction hypothesis?</p>\n\n<p>You should start by clearly stating the property you want to prove by induction, and be explicit on what you are inducing.</p>\n\n<p>In your case, I'd suggest to prove</p>\n\n<pre><code>p(m): forall k. sumOne m + k = helpSum k m\n</code></pre>\n\n<p>by induction on the natural <code>m</code>. Note the difference between <code>k</code> (universally quantified), and <code>m</code> (parameter of <code>p</code>). This step is very important.</p>\n\n<p>Then, by induction on <code>m</code>, we are left to prove <code>p(0)</code> and <code>p(m)=&gt;p(m+1)</code>, as usual.</p>\n\n<p>After proving <code>p(m)</code> for all <code>m</code>, one gets for free</p>\n\n<pre><code>sumOne m = helpSum 0 m = endSum m\n</code></pre>\n"}], "owner": {"reputation": 99, "user_id": 6414566, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5ed1971c96d5d73a8d964ea4c8a99799?s=128&d=identicon&r=PG&f=1", "display_name": "SOAP", "link": "https://stackoverflow.com/users/6414566/soap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1485790042, "creation_date": 1485782939, "last_edit_date": 1485783658, "question_id": 41937113, "link": "https://stackoverflow.com/questions/41937113/to-prove-equality-of-functions", "title": "To prove equality of functions", "body": "<p>Given the two functions:</p>\n\n<pre><code>sumOne 0 = 0                                     --   I.a\nsumOne m | m &gt; 0 = sumOne (m-1) + m              --  II.a\n\nendSum m = helpSum 0 m                           --   I.b\n where helpSum x 0 = x                           --  II.b\n       helpSum x m | m &gt; 0 = helpSum (x+m) (m-1) -- III.b\n</code></pre>\n\n<p>We have to prove sumOne = endSum by using induction.</p>\n\n<p>So I tried:</p>\n\n<p>For <code>n=0</code></p>\n\n<pre><code>sumOne 0=0 == endSum 0 = helpSum 0 0 = 0   True\n</code></pre>\n\n<p>Assumption:</p>\n\n<pre><code>sumOne m + k = helpSumm k m\n</code></pre>\n\n<p>Induction step:</p>\n\n<pre><code>-&gt; m=m+1\nhelpSum k (m+1)\nIII.b = helpSum (k+m+1) m \n</code></pre>\n\n<p>and by using the assumption</p>\n\n<pre><code>= sumOne m + (m+k+1)\nII.a = sumOne (m+1) + k  -&gt; True\n</code></pre>\n\n<p>Is that okay? Or completely wrong?</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 343, "user_id": 5085294, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TOFvi.png?s=128&g=1", "display_name": "Christof Schramm", "link": "https://stackoverflow.com/users/5085294/christof-schramm"}, "edited": false, "score": 1, "creation_date": 1485780085, "post_id": 41936092, "comment_id": 71052574, "body": "That question already has a very good answer, I would also say it&#39;s a duplicate."}, {"owner": {"reputation": 1164, "user_id": 1491639, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/03dd48d2070f11eb8613a48f36d43bc2?s=128&d=identicon&r=PG", "display_name": "Abdul Rahman", "link": "https://stackoverflow.com/users/1491639/abdul-rahman"}, "edited": false, "score": 0, "creation_date": 1485780181, "post_id": 41936092, "comment_id": 71052643, "body": "agreed, will mark this as solved. Thanks!"}], "owner": {"reputation": 1164, "user_id": 1491639, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/03dd48d2070f11eb8613a48f36d43bc2?s=128&d=identicon&r=PG", "display_name": "Abdul Rahman", "link": "https://stackoverflow.com/users/1491639/abdul-rahman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "closed_date": 1485780190, "answer_count": 0, "score": 1, "last_activity_date": 1485779706, "creation_date": 1485779706, "question_id": 41936092, "link": "https://stackoverflow.com/questions/41936092/symbol-in-haskell-in-front-of-a-variable-name-in-a-function", "closed_reason": "Duplicate", "title": "Symbol ! in haskell in front of a variable name in a function", "body": "<p>What does symbol ! in front of a variable name in a haskell function mean? For example</p>\n\n<pre><code>let f !x = x + 1\n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "error-handling", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485778411, "post_id": 41935616, "comment_id": 71051413, "body": "Since they throw different kinds of exceptions, this is going to be more troublesome."}, {"owner": {"reputation": 2442, "user_id": 3666302, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e9aed854fcd666aba1316ef908ad5913?s=128&d=identicon&r=PG&f=1", "display_name": "TomTom", "link": "https://stackoverflow.com/users/3666302/tomtom"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485788064, "post_id": 41935616, "comment_id": 71057949, "body": "I see. After some reading it seems I am trying to emulate functionality of <code>MonadThrow</code>?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1485788264, "post_id": 41935616, "comment_id": 71058104, "body": "For such a simple example, just use <a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Except.html#v:withExceptT\" rel=\"nofollow noreferrer\"><code>withExceptT</code></a> to change the type of one or both exceptions - <code>withExceptT Left</code> and <code>withExceptT Right</code> are &#39;simple&#39; choices."}], "answers": [{"tags": [], "owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "is_accepted": false, "score": 0, "last_activity_date": 1485812277, "creation_date": 1485812277, "answer_id": 41945831, "question_id": 41935616, "link": "https://stackoverflow.com/questions/41935616/chain-exceptt-with-different-left-in-do-block/41945831#41945831", "title": "Chain ExceptT with different Left in do block", "body": "<p>If you have two exception types <code>EOne</code> and <code>ETwo</code>, you could do it like this:</p>\n\n<pre><code>twoExceptions :: ExceptT (Either EOne ETwo) m a\ntwoExceptions = do\n    fmapL Left computationThatFailsWithEOne -- :: ExceptT EOne m b\n    fmapL Right computationThatFailsWithETwo -- :: ExceptT ETwo m c\n    ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 193, "user_id": 6523926, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kyKIt.png?s=128&g=1", "display_name": "Matthew", "link": "https://stackoverflow.com/users/6523926/matthew"}, "is_accepted": false, "score": 0, "last_activity_date": 1485841952, "creation_date": 1485841952, "answer_id": 41950559, "question_id": 41935616, "link": "https://stackoverflow.com/questions/41935616/chain-exceptt-with-different-left-in-do-block/41950559#41950559", "title": "Chain ExceptT with different Left in do block", "body": "<pre><code>comp :: (Exception ex1, Exception ex2) =&gt; IntComp ex1 -&gt; IntComp ex2 -&gt; IntComp SomeException\ncomp local web = do\n    res1 &lt;- withExceptT toException local\n    res2 &lt;- withExceptT toException web\n    return (res1 + res2)\n</code></pre>\n"}], "owner": {"reputation": 2442, "user_id": 3666302, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e9aed854fcd666aba1316ef908ad5913?s=128&d=identicon&r=PG&f=1", "display_name": "TomTom", "link": "https://stackoverflow.com/users/3666302/tomtom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1485841952, "creation_date": 1485778244, "question_id": 41935616, "link": "https://stackoverflow.com/questions/41935616/chain-exceptt-with-different-left-in-do-block", "title": "Chain ExceptT with different Left in do block", "body": "<p>I have a couple of computations to run which throw different kinds of exceptions. How can I chain them in a do block without evaluating every single one and then pattern matching the result as <code>Either ex result</code>?</p>\n\n<pre><code>type IntComp ex = ExceptT ex IO Int\n\nlocal :: IntComp IOException\nlocal = ExceptT $ map length &lt;$&gt; tryIO (readFile \"file\")\n\nweb :: IntComp WebException\nweb = ExceptT $ map length &lt;$&gt; tryAny (getWebsite \"file\")\n\ncomp :: (Exception ex) =&gt; IntComp ? -&gt; IntComp ? -&gt; IntComp ?\ncomp local web = ExceptT $ do\nres1 &lt;- local\nres2 &lt;- web\nreturn (res1 + res2)\n</code></pre>\n\n<p>Since they all have an instance of <code>Exception</code> I would think there must be some way to write a <code>comp</code> function in similar fashion?</p>\n"}, {"tags": ["haskell", "dependent-type"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1485771884, "creation_date": 1485771884, "answer_id": 41933546, "question_id": 41932975, "link": "https://stackoverflow.com/questions/41932975/can-i-check-instance-presence-at-runtime/41933546#41933546", "title": "Can I check instance presence at runtime?", "body": "<p>I don't think there's any easy way.</p>\n\n<p>Haskell is designed so that all the type-level stuff can be erased at runtime. The only way I know out of this is to exploit <code>KnownNat</code> and <code>Typeable</code> and manually check against each instance. E.g. something like:</p>\n\n<pre><code>get' :: forall n e. (Typeable e, KnownNat n) =&gt; Integer -&gt; Vec n e -&gt; Maybe e\nget' 0 v =\n    case sameNat (Proxy @n) (Proxy @2) of\n      Just Refl -&gt; case eqT :: Maybe (e :~: Float) of\n                     Just Refl -&gt; Just $ get @0 v\n                     Nothing -&gt; Nothing  -- TODO check for e/=Float\n      Nothing -&gt; case sameNat (Proxy @n) (Proxy @3) of\n         Just Refl -&gt; case eqT :: Maybe (e :~: Float) of\n            Just Refl -&gt; Just $ get @0 v\n            Nothing -&gt; Nothing  -- TODO check for e/=Float\n         Nothing -&gt; Nothing -- TODO check for n/=2,3\nget' i v = Nothing -- TODO check for i&gt;0\n</code></pre>\n\n<p>(This could probably use some factoring...)</p>\n\n<p>Probably a better approach would be to define a list (or whatever) of reified dictionaries, and loop over it. One would need to keep such list in sync with the actual instances, though.</p>\n\n<p>Perhaps in the future Haskell will get the typeclass search machinery at runtime as well. So far, this was not done, I guess, because moving to runtime type-level checks is quite unidiomatic in Haskell. However, after we got <code>DataKinds</code> and <code>KnownNat</code> and similar stuff, perhaps reification/\"reflection\" of static information at runtime has become more interesting.</p>\n"}, {"comments": [{"owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "edited": false, "score": 0, "creation_date": 1485854692, "post_id": 41953144, "comment_id": 71086764, "body": "What is <code>p</code> in the last line <code>return (get p v)</code>? Did you mean <code>iProx</code>?"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "edited": false, "score": 0, "creation_date": 1485854746, "post_id": 41953144, "comment_id": 71086799, "body": "@AlexeyVagarenko yes, sorry!  changed the name of the variable during an edit, and forgot to swap that instance."}], "tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": false, "score": 1, "last_activity_date": 1485854717, "last_edit_date": 1485854717, "creation_date": 1485852435, "answer_id": 41953144, "question_id": 41932975, "link": "https://stackoverflow.com/questions/41932975/can-i-check-instance-presence-at-runtime/41953144#41953144", "title": "Can I check instance presence at runtime?", "body": "<p>One issue right now is that <code>Get</code>'s instances are all kind of ad-hoc, so it's hard to provide a clean solution.  If you're willing to refactor <code>Get</code> a bit, it's a lot simpler:</p>\n\n<pre><code>class Get (n :: Nat) e where\n    get :: (KnownNat i, i &lt;= (n-1)) =&gt; Proxy i -&gt; Vec n e -&gt; e\n\ninstance Get 2 Float where\n    get :: (KnownNat i, i &lt;= 1) =&gt; Proxy i -&gt; Vec 2 Float -&gt; Float\n    get p (Vec2f x y) = case natVal p of\n      0 -&gt; x\n      1 -&gt; y\n      _ -&gt; error \":(\"\n</code></pre>\n\n<p>Then you can do</p>\n\n<pre><code>get' :: forall n e. (Get n e, KnownNat (n - 1)) =&gt; Integer -&gt; Vec n e -&gt; Maybe e\nget' i v = do\n    -- bring KnownNat i into context\n    SomeNat (iProx@Proxy) &lt;- someNatVal i           -- will be Nothing if i &lt; 0\n    -- bring i &lt;= (n - 1) into context\n    Refl          &lt;- iProx `isLE` (Proxy @(n - 1))  -- will be Nothing if i &gt;= n\n    return (get iProx v)\n</code></pre>\n\n<p>Using <a href=\"http://hackage.haskell.org/package/typelits-witnesses-0.2.3.0/docs/GHC-TypeLits-Compare.html\" rel=\"nofollow noreferrer\">GHC.TypeLits.Compare</a> from the typelits-witnesses library to bring the inequality constraint into the context for GHC to use.</p>\n"}], "owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1485854717, "creation_date": 1485770027, "question_id": 41932975, "link": "https://stackoverflow.com/questions/41932975/can-i-check-instance-presence-at-runtime", "title": "Can I check instance presence at runtime?", "body": "<p>I have a data family of finite vectors:</p>\n\n<pre><code>data family Vec (n :: Nat) e\ndata instance Vec 2 Float = Vec2f !Float !Float\ndata instance Vec 3 Float = Vec3f !Float !Float !Float\n-- and so on\n</code></pre>\n\n<p>I also have a family of getter functions:</p>\n\n<pre><code>class Get (i :: Nat) (n :: Nat) e where\n    get :: Vec n e -&gt; e\n\ninstance Get 0 2 Float where\n    get (Vec2f x _) = x\n\ninstance Get 1 2 Float where\n    get (Vec2f _ x) = x\n\ninstance Get 0 3 Float where\n    get (Vec3f x _ _) = x\n\ninstance Get 1 3 Float where\n    get (Vec3f _ x _) = x\n\ninstance Get 2 3 Float where\n    get (Vec3f _ _ x) = x\n-- and so on\n</code></pre>\n\n<p>This way, access to elements of a vector is checked at compile time, so this compiles: </p>\n\n<pre><code>get @0 (Vec2f 0 1)\n</code></pre>\n\n<p>and this doesn't: </p>\n\n<pre><code>get @4 (Vec2f 0 1)\n</code></pre>\n\n<p>Now, I wonder if I can write runtime range check using those functions.\nI tried this:</p>\n\n<pre><code>get' :: forall n e. (KnownNat n) =&gt; Integer -&gt; Vec n e -&gt; Maybe e\nget' i v =\n    if i &gt;= 0 &amp;&amp; i &lt; natVal (Proxy :: Proxy n)\n        then (flip fmap) (someNatVal i) $ \\(SomeNat (Proxy :: Proxy i)) -&gt;\n            get @i v -- Could not deduce (Get i n e)\n        else Nothing\n</code></pre>\n\n<p>I think I have to check presence of <code>Get i n e</code> instance at runtime, is there a way to do it?</p>\n"}, {"tags": ["haskell", "scope", "where-clause"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1485766406, "post_id": 41931695, "comment_id": 71044083, "body": "The <code>where</code> only applies to the definition immediately above it (so to <code>planetYearSecs Earth = 100</code>). This bites me all the time. :)"}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 3, "last_activity_date": 1485767183, "last_edit_date": 1485767183, "creation_date": 1485766798, "answer_id": 41932017, "question_id": 41931695, "link": "https://stackoverflow.com/questions/41931695/second-where-name-is-not-in-scope-of-the-previous-where-clause/41932017#41932017", "title": "second where name is not in scope of the previous where clause", "body": "<p>A <code>where</code> clause binds to a single pattern-match, and no wider. It <em>does</em> bind across multiple guard clauses, such as in:</p>\n\n<pre><code>foo :: Int -&gt; Int\nfoo 0 = 0\nfoo x | y &lt; 30 = 5\n      | otherwise = y\n  where y = x * x\n</code></pre>\n\n<p>Which may cause you to think it applies to a whole function definition. But you couldn't use <code>y</code> in the first equation here, just as you can't use <code>earthSecondsAYear</code> in the first equation of your question, because you have bound it to the last equation only.</p>\n\n<p>However, the fix is easy: instead of introducing a new <code>where</code> clause, simply add another definition to your existing <code>where</code> clause:</p>\n\n<pre><code>ageOn :: Planet -&gt; Float -&gt; Float\nageOn planet seconds = (seconds / 100) * planetYearSecs planet\n where planetYearSecs Mercury = (earthSecondsAYear / 100) * 0.2408\n       planetYearSecs Venus = 0.6151\n       planetYearSecs Mars = 1.8808\n       planetYearSecs Jupiter = 11.8626\n       planetYearSecs Saturn = 29.4474\n       planetYearSecs Uranus = 84.0168\n       planetYearSecs Neptune = 164.7913\n       planetYearSecs Earth = 100\n       earthSecondsAYear = 31557600\n</code></pre>\n\n<p>It is perfectly legal to define multiple bindings in a <code>where</code> clause, just by indenting them all to the same level. And when you do, all definitions inside the where clause can see all the bound values, so your first equation will happily use the value defined in your last equation.</p>\n"}], "owner": {"reputation": 4354, "user_id": 5967828, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/fJ7P2.jpg?s=128&g=1", "display_name": "xetra11", "link": "https://stackoverflow.com/users/5967828/xetra11"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 41932017, "answer_count": 1, "score": 0, "last_activity_date": 1485767183, "creation_date": 1485765589, "question_id": 41931695, "link": "https://stackoverflow.com/questions/41931695/second-where-name-is-not-in-scope-of-the-previous-where-clause", "title": "second where name is not in scope of the previous where clause", "body": "<p>I defined a where to define a name <strong>earthSecondsAYear</strong>. Sadly it does not manage to be in scope of the previous where clause.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>module SpaceAge (Planet(..), ageOn) where\n\ndata Planet = Mercury\n            | Venus\n            | Earth\n            | Mars\n            | Jupiter\n            | Saturn\n            | Uranus\n            | Neptune\n\nageOn :: Planet -&gt; Float -&gt; Float\nageOn planet seconds = (seconds / 100) * planetYearSecs planet\n where planetYearSecs Mercury = (earthSecondsAYear / 100) * 0.2408\n       planetYearSecs Venus = 0.6151\n       planetYearSecs Mars = 1.8808\n       planetYearSecs Jupiter = 11.8626\n       planetYearSecs Saturn = 29.4474\n       planetYearSecs Uranus = 84.0168\n       planetYearSecs Neptune = 164.7913\n       planetYearSecs Earth = 100\n         where earthSecondsAYear = 31557600\n</code></pre>\n\n<p>Error message:</p>\n\n<pre><code>:14:34: error:\n    Variable not in scope: earthSecondsAYear\n</code></pre>\n\n<p>What am I missing?</p>\n"}, {"tags": ["haskell", "akka", "ghc", "distributed-computing", "cloud-haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1486411064, "post_id": 41928502, "comment_id": 71323777, "body": "I&#39;m still looking for an authoritative answer, but having poked around a bit more: (1) it supports actors in the form of processes and lost messages are as in Erlang (there is a way of getting them, but really only for debugging), (3) very simple, just spawn new nodes and <a href=\"https://hackage.haskell.org/package/distributed-process-simplelocalnet\" rel=\"nofollow noreferrer\"><code>distributed-process-simplelocalnet </code></a> makes making a cluster very straightforward, (4) <a href=\"https://hackage.haskell.org/package/distributed-process-supervisor\" rel=\"nofollow noreferrer\"><code>distributed-process-supervisor</code></a> adds some pretty fine-grain fault tolerance."}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1089, "favorite_count": 5, "answer_count": 0, "score": 15, "last_activity_date": 1486410798, "creation_date": 1485745534, "last_edit_date": 1486410798, "question_id": 41928502, "link": "https://stackoverflow.com/questions/41928502/comparison-of-cloud-haskell-and-akka", "title": "Comparison of Cloud Haskell and Akka", "body": "<p>I didn't really think Haskell was in the running for things like message passing, but <a href=\"https://github.com/atemerev/skynet\" rel=\"noreferrer\">these results</a> (I'm looking at the Linux ones which are 4-5 times better than anything else) have made me question this. Some poking around has led me to <a href=\"http://haskell-distributed.github.io\" rel=\"noreferrer\">Cloud Haskell</a>, which really just seems to be a collection of useful well-written distributed-systems related libraries (serious kudos to Well-Typed and Tweag I/O for their work on this and static pointers).</p>\n\n<p>My experience with Actors and message passing is derived from my use of Akka. I'm trying to understand what Cloud Haskell is able to do to scope out whether I want to use it for a potential project where scalability, efficiency, and reliability are important. So:</p>\n\n<ul>\n<li>Does it support Actors? If not, what is the equivalent abstraction? How does it handle message passing / lost messages?</li>\n<li>How does it scale compared to Akka? Roughly how much better/worse is it in memory use and latency?</li>\n<li>How does it scale to multiple nodes (as in how <em>simple</em> is it to scale to multiple nodes)?</li>\n<li>How is it fault tolerant?</li>\n</ul>\n\n<p>I realize this question is a bit broad, but I reckon that if anyone has some experience with Cloud Haskell, they'll probably be able to rattle off all of these answers very easily - and the question will be more useful to those searching general information about Cloud Haskell vs. Akka in the future.</p>\n"}, {"tags": ["haskell", "types", "typeclass"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1485737716, "post_id": 41927624, "comment_id": 71035952, "body": "Why are you trying to put a <code>Value</code> into something that takes an <code>Int</code>? <code>Sum (Num 1) (Num 2)</code> doesn&#39;t work because <code>Num 1 :: Value</code> but <code>Sum</code> expects an <code>Int</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1485738789, "post_id": 41927624, "comment_id": 71036182, "body": "Apart from the correct answer you got, you may want to look into make <code>Value</code> an instance of <code>Num</code> - that way you can write <code>1 :: Value</code>."}, {"owner": {"reputation": 13, "user_id": 7487608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3ee4cc1bf8391675eb96d8c016f9c65?s=128&d=identicon&r=PG&f=1", "display_name": "Sinsarii", "link": "https://stackoverflow.com/users/7487608/sinsarii"}, "edited": false, "score": 1, "creation_date": 1485739554, "post_id": 41927624, "comment_id": 71036359, "body": "I completely overlooked that I was actually taking in Value types; I was in the wrong mindset AJFarmer (I&#39;ll blame it on lack of sleep). My post was edited but I am new to Haskell so I&#39;m succumbing to simple mistakes. Thanks for the tip Alec!"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 7487608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3ee4cc1bf8391675eb96d8c016f9c65?s=128&d=identicon&r=PG&f=1", "display_name": "Sinsarii", "link": "https://stackoverflow.com/users/7487608/sinsarii"}, "edited": false, "score": 1, "creation_date": 1485738292, "post_id": 41927664, "comment_id": 71036073, "body": "Thanks for that! I just re-read the section and realized what I had done. Your explanation was perfect though, thanks!"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 6, "last_activity_date": 1485737538, "creation_date": 1485737538, "answer_id": 41927664, "question_id": 41927624, "link": "https://stackoverflow.com/questions/41927624/matching-expected-type-with-actual-type/41927664#41927664", "title": "Matching expected type with actual type", "body": "<pre><code>data Value = Num Int\n           | Sum Int Int\n           | Dif Int Int\n           | Neg Int\n</code></pre>\n\n<p>Here you\u2019ve specified that the <code>Value</code> constructors work only on <code>Int</code> values, e.g., <code>Neg</code> has the type <code>Int -&gt; Value</code>. So you can\u2019t write something like <code>Neg (Neg 1)</code> or <code>Sum (Num 1) (Num 2)</code> because you\u2019re trying to use a tagged <code>Value</code> where an untagged <code>Int</code> is expected. In Lisp, it would be as if you passed <code>(Num . 1)</code> when a function expects just <code>1</code>.</p>\n\n<p>You can change the definition of your type to accept <code>Value</code>:</p>\n\n<pre><code>data Value = Num Int\n           | Sum Value Value\n           | Dif Value Value\n           | Neg Value\n</code></pre>\n\n<p>Now this represents expressions, where <code>Num</code> is a literal <code>Int</code> but the other constructors operate on <code>Value</code>s. Then the <code>eval</code> function changes accordingly:</p>\n\n<pre><code>eval :: Value -&gt; Int\neval (Num x) = x\neval (Sum x y) = eval x + eval y\n-- ...\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 7487608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3ee4cc1bf8391675eb96d8c016f9c65?s=128&d=identicon&r=PG&f=1", "display_name": "Sinsarii", "link": "https://stackoverflow.com/users/7487608/sinsarii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 41927664, "answer_count": 1, "score": 1, "last_activity_date": 1485737639, "creation_date": 1485736956, "last_edit_date": 1485737639, "question_id": 41927624, "link": "https://stackoverflow.com/questions/41927624/matching-expected-type-with-actual-type", "title": "Matching expected type with actual type", "body": "<p>What I am currently trying to do is create a type called <code>Value</code>:</p>\n\n<pre><code>data Value =  Num Int\n            | Sum Int Int\n            | Dif Int Int\n            | Neg Int\n              deriving (Eq)\n</code></pre>\n\n<p>With which I want to implement an eval function:</p>\n\n<pre><code>eval :: Value -&gt; Int\neval (Num x) = x\neval (Sum x y) = x + y\neval (Dif x y) = x - y\neval (Neg x) = -x\n</code></pre>\n\n<p>My expected results should be:</p>\n\n<pre><code>eval $ Dif (Sum (Num 3) (Num 6)) (Neg 4)\n&gt; 13\n</code></pre>\n\n<p>With my current code I am able to test each operator by themselves and they function. </p>\n\n<pre><code>eval (Dif 3 4)\n&gt;-1\n</code></pre>\n\n<p>The problem arises when I try to perform the nested operations in the expected input above as I then get the error:</p>\n\n<blockquote>\n  <p>\"Couldn't match expected type <code>Int</code> with actual type <code>Value</code>\"</p>\n</blockquote>\n\n<p>I'm trying to understand the problem as I thought my operation should return an <code>Int</code> and since my <code>Value</code> types take an <code>Int</code> the next operation should have the expected type. I have been testing various inputs to see what my current eval function is actually doing and found that if I do</p>\n\n<pre><code>eval (Dif (eval (Sum 3 5)) 4)\n&gt;4\n</code></pre>\n\n<p>I get the expected result. What am I doing wrong here?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1485735596, "post_id": 41927451, "comment_id": 71035505, "body": "<code>max3:: Integer -&gt; Integer -&gt; Integer -&gt; String</code> not <code>max3:: Integer -&gt; Integer -&gt; Integer -&gt; Integer</code>."}], "answers": [{"tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": false, "score": 3, "last_activity_date": 1485738124, "last_edit_date": 1485738124, "creation_date": 1485735988, "answer_id": 41927522, "question_id": 41927451, "link": "https://stackoverflow.com/questions/41927451/max3-in-haskell-im-getting-errors/41927522#41927522", "title": "Max3 in haskell, I&#39;m getting errors", "body": "<p>Your function is returning a <code>String</code>, but your type annotation indicates that it returns an <code>Integer</code>.</p>\n\n<p>If you would like a <code>String</code> error message, consider using <code>Either</code>.</p>\n\n<pre><code> max3:: Integer -&gt; Integer -&gt; Integer -&gt; Either String Integer\n max3 a b c\n   | a &gt; b &amp;&amp; a &gt; c = Right a\n   | b &gt; a &amp;&amp; b &gt; c = Right b\n   | c &gt; a &amp;&amp; c &gt; b = Right c\n   | otherwise = Left \"At least two numbers are the same\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1212, "user_id": 2455145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kazBZ.jpg?s=128&g=1", "display_name": "AlexJ136", "link": "https://stackoverflow.com/users/2455145/alexj136"}, "is_accepted": false, "score": 1, "last_activity_date": 1485765657, "creation_date": 1485765657, "answer_id": 41931712, "question_id": 41927451, "link": "https://stackoverflow.com/questions/41927451/max3-in-haskell-im-getting-errors/41931712#41931712", "title": "Max3 in haskell, I&#39;m getting errors", "body": "<p>As @Erik points out, your function is returning a <code>String</code>. If you want to keep the type you declared, you could have something like this:</p>\n\n<pre><code>max3 :: Integer -&gt; Integer -&gt; Integer -&gt; Integer\nmax3 a b c\n      | a &gt; b &amp;&amp; a &gt; c = a\n      | b &gt; a &amp;&amp; b &gt; c = b\n      | c &gt; a &amp;&amp; c &gt; b = c\n      | otherwise = error \"At least two numbers are the same\"\n</code></pre>\n\n<p>In the <code>otherwise</code> case, calling <code>error</code> will crash your program with the given error message. You could replace the call to <code>error</code> with something more sophisticated if it doesn't suit your needs.</p>\n\n<p>One possible replacement for the call to <code>error</code> would be to return the max value regardless of whether or not it's the same as other arguments:</p>\n\n<pre><code>      ...\n      | c &gt; a &amp;&amp; c == b = c\n      | a &gt; c &amp;&amp; a == b = a\n      | b &gt; a &amp;&amp; c == b = b\n      | c == a &amp;&amp; c == b = c\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 7487670, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-KjWMHTLjE1A/AAAAAAAAAAI/AAAAAAAAAHc/7Hr_0x5DcSw/photo.jpg?sz=128", "display_name": "Pedro Rodriguez", "link": "https://stackoverflow.com/users/7487670/pedro-rodriguez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1485765657, "creation_date": 1485735513, "last_edit_date": 1485750067, "question_id": 41927451, "link": "https://stackoverflow.com/questions/41927451/max3-in-haskell-im-getting-errors", "title": "Max3 in haskell, I&#39;m getting errors", "body": "<p>I'm getting a problem when I run my haskell program,</p>\n\n<pre><code>max3:: Integer -&gt; Integer -&gt; Integer -&gt; Integer\nmax3 a b c\n          | a &gt; b &amp;&amp; a &gt; c = show a\n          | b &gt; a &amp;&amp; b &gt; c = show b\n          | c &gt; a &amp;&amp; c &gt; b = show c\n          | otherwise = show \"At least two numbers are the same\"\n</code></pre>\n\n<p>I don't know why my GHCI doesn't compile this easy code. Please it's must not be that hard.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485735958, "post_id": 41927329, "comment_id": 71035564, "body": "I can think of no immediate method, however I&#39;d start writing <code>interleavings :: [a] -&gt; [a] -&gt; [[a]]</code>. After this, I&#39;d use something like (untested) <code>f n = go n where go m = interleavings (replicate n m) =&lt;&lt; go (m-1) ; go 0 = [replicate n 0]</code>. (Not very elegant, I concur.)"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1485751618, "creation_date": 1485751618, "answer_id": 41929156, "question_id": 41927329, "link": "https://stackoverflow.com/questions/41927329/how-to-efficiently-generate-all-lists-of-length-n2-containing-n-copies-of-e/41929156#41929156", "title": "How to efficiently generate all lists of length `n^2` containing `n` copies of every `x &lt; n`?", "body": "<p>Sure, it's not too hard. We'll start with a list of <code>n</code> copies of each number less than <code>n</code>, and repeatedly choose one to start our result with. First, a function for choosing an element from a list:</p>\n\n<pre><code>zippers :: [a] -&gt; [([a], a, [a])]\nzippers = go [] where\n    go l (h:r) = (l,h,r) : go (h:l) r\n    go _ [] = []\n</code></pre>\n\n<p>Now we'll write a function that produces all possible interleavings of some input lists. Internally we'll maintain the invariant that each <code>[a]</code> is non-empty; hence we'll have to establish that invariant before we start recursing. In fact, this will be wasted work in the way we intend to call this function, but for good abstraction we might as well handle all inputs correctly, right?</p>\n\n<pre><code>interleavings :: [[a]] -&gt; [[a]]\ninterleavings = go . filter (not . null) where\n    go [] = [[]]\n    go xss = do\n        (xssl, x:xs, xssr) &lt;- zippers xss\n        (x:) &lt;$&gt; interleavings ([xs | not (null xs)] ++ xssl ++ xssr)\n</code></pre>\n\n<p>And now we're basically done. All we have to do is feed in an appropriate starting list.</p>\n\n<pre><code>f :: Int -&gt; [[Int]]\nf n = interleavings (replicate n &lt;$&gt; [1..n])\n</code></pre>\n\n<p>Try it in ghci:</p>\n\n<pre><code>&gt; f 2\n[[1,1,2,2],[1,2,2,1],[1,2,1,2],[2,2,1,1],[2,1,1,2],[2,1,2,1]]\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 41929156, "answer_count": 1, "score": 6, "last_activity_date": 1485751618, "creation_date": 1485734303, "question_id": 41927329, "link": "https://stackoverflow.com/questions/41927329/how-to-efficiently-generate-all-lists-of-length-n2-containing-n-copies-of-e", "title": "How to efficiently generate all lists of length `n^2` containing `n` copies of every `x &lt; n`?", "body": "<p>Given an integer <code>n</code>, how can I build the list containing all lists of length <code>n^2</code> containing exactly <code>n</code> copies of each integer <code>x &lt; n</code>? For example, for <code>n = 2</code>, we have:</p>\n\n<pre><code>[0,0,1,1], [0,1,0,1], [1,0,0,1], [0,1,1,0], [1,0,1,0], [1,1,0,0]\n</code></pre>\n\n<p>This can be easily done combining <code>permutations</code> and <code>nub</code>:</p>\n\n<pre><code>f :: Int -&gt; [[Int]]\nf n = nub . permutations $ concatMap (replicate n) [0..n-1]\n</code></pre>\n\n<p>But that is way too inefficient. Is there any simple way to encode the efficient/direct algorithm?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485730713, "post_id": 41926897, "comment_id": 71034403, "body": "It&#39;s a bit confusing what you mean. Monads can be used for instance to carry a <i>hidden</i> state so to speak and indeed enforce order in execution. The IO monad has in my opinion much in common with the state monad except that it hides all kinds of undeterministic behavior an operating system inherently has."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485730841, "post_id": 41926897, "comment_id": 71034439, "body": "What I&#39;m saying is: from a GHC point of view, ioFunction first prints <code>str</code> and then prints &quot;2&quot;. Yet from a mathematical point of view, this function only take a <code>String</code> and returns <code>() :: IO ()</code>. Hence the fact that we happen to use the IO monad for side effects in Haskell is in some sense arbitrary, and has nothing to do with the intrinsic meaning of a (mathematical) monad (of type IO)."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1485730942, "post_id": 41926897, "comment_id": 71034462, "body": "No the function does not return <code>()</code>, it returns an IO monad (that is here a function) and that monad will eventually return <code>()</code>. That is something different. And in fact the IO has some <i>intrensic</i> mathematical meaning."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1485731018, "post_id": 41926897, "comment_id": 71034483, "body": "<code>() :: IO ()</code> is a type error. <code>()</code> has type <code>()</code>."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1485731081, "post_id": 41926897, "comment_id": 71034508, "body": "Yes -- you&#39;re right. It returns a value of type <code>IO ()</code>. So how is that value a function though? And from a purely mathematical point of view, what is this value?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485731125, "post_id": 41926897, "comment_id": 71034519, "body": "@WillemVanOnsem The function does not return &quot;an IO monad&quot;. There&#39;s only one IO monad, and it&#39;s not a value. It&#39;s a type constructor (of kind <code>* -&gt; *</code>) together with an <code>instance</code> declaration."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1485731176, "post_id": 41926897, "comment_id": 71034538, "body": "@melpomene: yeah indeed. I chose my words poorly."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1485731202, "post_id": 41926897, "comment_id": 71034550, "body": "@George I don&#39;t think it is a function."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1485731761, "post_id": 41926897, "comment_id": 71034703, "body": "@melpomene: From a mathematical perspective, does the value that is returned by this function encode anything that has anything to do with those <code>putStrLn</code> calls? I know that, from GHC&#39;s perspective, those <code>putStrLn</code> calls are definitely part of this function&#39;s meaning. But from the mathematical perspective, they could just as easily be ignored, isn&#39;t this the case?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1485793992, "post_id": 41926897, "comment_id": 71061938, "body": "Define &quot;mathematical perspective&quot;. There is more than one. The value returned by <code>putStrLn &quot;2&quot;</code> has  an action that prints <code>2</code> encoded in it (otherwise your program wouldn&#39;t be able to print anything).  It&#39;s a fact. You can build a mathematical apparatus to describe and study this and similar facts. It probably would be different from the one that deals with functions and pure computations."}, {"owner": {"reputation": 493, "user_id": 1930087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87d9113f3d9fb081a9cf01cc1e03cfdd?s=128&d=identicon&r=PG", "display_name": "tillmo", "link": "https://stackoverflow.com/users/1930087/tillmo"}, "edited": false, "score": 0, "creation_date": 1487249976, "post_id": 41926897, "comment_id": 71705345, "body": "All this discussion misses the point of the mathematical definition of &quot;monad&quot;, which is used to encapsulate side effects. See my answer how this definition can be brought in."}, {"owner": {"reputation": 243, "user_id": 13679816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b02acae66c6a347786eb93e8cbead85?s=128&d=identicon&r=PG", "display_name": "atravers", "link": "https://stackoverflow.com/users/13679816/atravers"}, "edited": false, "score": 0, "creation_date": 1602904847, "post_id": 41926897, "comment_id": 113874758, "body": "Possibly related: <a href=\"https://stackoverflow.com/questions/61798648/how-to-view-higher-order-functions-and-io-actions-from-a-mathematical-perspectiv\" title=\"how to view higher order functions and io actions from a mathematical perspectiv\">stackoverflow.com/questions/61798648/&hellip;</a> ."}], "answers": [{"comments": [{"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 0, "creation_date": 1485732184, "post_id": 41927080, "comment_id": 71034797, "body": "Well said. But isn&#39;t it true that, from a mathematical point of view, both <code>IOSeq (PutStr (str++&quot;\\n&quot;)) (PutStrLn &quot;2\\n&quot;)</code> and <code>IOPure ()</code> are in fact the same value? Or at the very least, how do we know they are different in this sense?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 1, "creation_date": 1485732679, "post_id": 41927080, "comment_id": 71034948, "body": "No, they are not mathematically speaking the same value. <i>How</i> we know they are different is indeed sort of an implementation detail \u2013 in such an explicit \u201cimperative code\u201d IO monad, we could simply pattern-match to tell the difference; in compiled GHC this is a bit trickier. You might even devise a \u201cdummy output\u201d implementation where they are in fact the same. At any rate, without knowledge of the implementation you can&#39;t <i>conclude</i> they are the same."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1485735473, "last_edit_date": 1485735473, "creation_date": 1485732017, "answer_id": 41927080, "question_id": 41926897, "link": "https://stackoverflow.com/questions/41926897/io-monads-ghc-implementation-meaning-vs-mathematical-meaning/41927080#41927080", "title": "IO Monads: GHC Implementation Meaning vs. Mathematical Meaning", "body": "<p>I always find it helpful to consider a simplified \u201cimperative-language source code\u201d implementation of the <code>IO</code> monad:</p>\n\n<pre><code>data IO :: * -&gt; * where\n   PutStr :: String -&gt; IO ()\n   GetLine :: IO String\n   IOPure :: a -&gt; IO a\n   IOSeq :: IO a -&gt; IO b -&gt; IO b\n   ...\n   LaunchMissiles :: IO ()\n</code></pre>\n\n<p>Then what <code>ioFunction</code> is quite clearly a proper, sensible function in the mathematical sense:</p>\n\n<pre><code>ioFunction str = do putStrLn str\n                    putStrLn \"2\"\n               = putStr (str++\"\\n\") &gt;&gt; putStrLn \"2\\n\"\n               = IOSeq (PutStr (str++\"\\n\")) (PutStrLn \"2\\n\")\n</code></pre>\n\n<p>This is simply a data structure representing effectively some source code of an imperative language. <code>ioFunction</code> places the given argument in a specific spot in the result structure, so it's mathematically very much not just a trivial <em>\u201creturn <code>()</code> and nothing else (something may happen but it's a GHC implementation detail)\u201d</em>.</p>\n\n<p>The value is indeed completely different for <code>ioFunction2</code>:</p>\n\n<pre><code>ioFunction2 str = do return ()\n                = return ()\n                = IOPure ()\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>how do we know they are different in this sense?</p>\n</blockquote>\n\n<p>That's a good question. Practically speaking, you know it by <em>executing</em> both programs and observing that they cause different effects, hence they <a href=\"https://en.wikipedia.org/wiki/Referential_transparency\" rel=\"nofollow noreferrer\">must have been different</a>. This is more than a little awkward of course \u2013 \u201cobserving what happens\u201d isn't maths, it's physics, and the observation would scientifically require that you execute twice under exact the same environment conditions.</p>\n\n<p>Worse, even with pure values that are generally taken to be mathematically the same you can observe different behaviour: <code>print 100000000</code> will immediately cause the side-effect, whereas <code>print $ last [0..100000000]</code> takes a significant pause (which, if you follow it with a time-printing command, can actually yield different text output).</p>\n\n<p>But these issues are unavoidable in a real-world context. It hence makes only sense that Haskell's does not specify any structure on IO that could with mathematical rigour be checked for equality from within the language. So, in quite some sense you really <em>can't</em> know that <code>putStrLn str &gt;&gt; putStrLn \"2\"</code> is not the same as <code>return ()</code>.</p>\n\n<p>And indeed they <em>might</em> be the same. It is conceivable to make a even simpler toy implementation of <code>IO</code> than the above thus:</p>\n\n<pre><code>data IO :: * -&gt; * where\n   IONop :: IO ()\n   IOHang :: IO a -&gt; IO a\n</code></pre>\n\n<p>and simply map any pure output operation to the no-op (and any input to an infinite loop). Then you would have</p>\n\n<pre><code>ioFunction str = do putStrLn str\n                    putStrLn \"2\"\n               = IONop &gt;&gt; IONop\n               = IONop\n</code></pre>\n\n<p>and</p>\n\n<pre><code>ioFunction2 str = return ()\n                = IONop\n</code></pre>\n\n<p>This is a bit as if we've imposed an additional axiom on the natural numbers, namely 1 = 0. From that you can then conclude that <em>every</em> number is zero.</p>\n\n<p>Clearly though, that would be a totally useless implementation. But something similar could actually make sense if you're running Haskell code in a sandbox environment and want to be utterly sure nothing bad happens. <a href=\"http://tryhaskell.org/\" rel=\"nofollow noreferrer\">http://tryhaskell.org/</a> does something like this.</p>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 2, "creation_date": 1485733976, "post_id": 41927274, "comment_id": 71035205, "body": "@George Yep. I am of the opinion this should be one of the first things discussed about <code>IO</code> - the fact you <i>can&#39;t</i> and <i>shouldn&#39;t</i> be able to say anything about what structurally makes up an <code>IO</code> action."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "edited": false, "score": 2, "creation_date": 1485736617, "post_id": 41927274, "comment_id": 71035698, "body": "@George I&#39;d say that, since IO is opaque, one could have an IO &quot;model&quot; (i.e. a semantics) where all IO actions (of the same type) are equal, e.g <code>print 5 === return ()</code>. Essentially, we take <code>IO a = Const () a</code>. This would be a trivial IO model which should satisfy all the wanted laws (I guess). This is what you seem to be mentioning in the question. However, IO does not have to be implemented in this (useless) way, and more meaningful models/semantics exist. When dealing with all the possible models, we can not regard <code>print 5</code> to be equivalent to <code>return ()</code>."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 5, "last_activity_date": 1485734079, "last_edit_date": 1485734079, "creation_date": 1485733637, "answer_id": 41927274, "question_id": 41926897, "link": "https://stackoverflow.com/questions/41926897/io-monads-ghc-implementation-meaning-vs-mathematical-meaning/41927274#41927274", "title": "IO Monads: GHC Implementation Meaning vs. Mathematical Meaning", "body": "<blockquote>\n  <p>Here, <code>ioFunction</code>, from a mathematical point of view, is a function that takes one input and returns a value of type <code>IO ()</code>. I presume it means nothing else. </p>\n</blockquote>\n\n<p>Yes. Exactly.</p>\n\n<blockquote>\n  <p>So does this mean that the way Haskell uses the <code>IO</code> monad for imperative side-effects (in this case: that running this function will first print str and then <code>print \"2\"</code>, in that order) is purely a GHC implementation detail that has nothing to do with the mathematical (and in some sense even the Haskell) meaning of the term?</p>\n</blockquote>\n\n<p>Not quite. From a mathematical (set-theory) standpoint, I would assume \"same\" means structurally identical. Since I don't know what makes up a value of <code>IO ()</code>, I can't say anything about whether two values of that type are the same or not.</p>\n\n<p>In fact, this is by design: by making <code>IO</code> opaque (in the sense that I don't know what constitutes an <code>IO</code>), GHC prevents me from ever being able to say that one value of type <code>IO ()</code> is equal to another. The only things I can do with <code>IO</code> is exposed through functions like <code>fmap</code>, <code>(&lt;*&gt;)</code>, <code>(&gt;&gt;=)</code>, <code>mplus</code>, etc. </p>\n"}, {"tags": [], "owner": {"reputation": 493, "user_id": 1930087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87d9113f3d9fb081a9cf01cc1e03cfdd?s=128&d=identicon&r=PG", "display_name": "tillmo", "link": "https://stackoverflow.com/users/1930087/tillmo"}, "is_accepted": false, "score": 0, "last_activity_date": 1605526105, "last_edit_date": 1605526105, "creation_date": 1486664523, "answer_id": 42144158, "question_id": 41926897, "link": "https://stackoverflow.com/questions/41926897/io-monads-ghc-implementation-meaning-vs-mathematical-meaning/42144158#42144158", "title": "IO Monads: GHC Implementation Meaning vs. Mathematical Meaning", "body": "<p>For simplicity, let us concentrate on the output aspect of the I/O monad. Mathematically speaking, the output (writer) monad is given by an endofunctor <em>T</em> with <em>T(A) = U* \u00d7 A</em>, where <em>U</em> is a fixed set of characters, and <em>U*</em> is the set of strings over <em>U</em>. Then <em>ioFunction : U* \u2192 T ()</em>, i.e. <em>ioFunction : U* \u2192 U* \u00d7 ()</em>, and <em>ioFunction(s)</em> = (s++&quot;\\n&quot;++&quot;2\\n&quot;, ()). By contrast, <em>ioFunction2(s)</em> = (&quot;&quot;, ()). Any implementation has to respect this difference. The difference is primarily a mathematical one, not an implementation detail.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1605526105, "creation_date": 1485730539, "last_edit_date": 1485731895, "question_id": 41926897, "link": "https://stackoverflow.com/questions/41926897/io-monads-ghc-implementation-meaning-vs-mathematical-meaning", "title": "IO Monads: GHC Implementation Meaning vs. Mathematical Meaning", "body": "<p>Consider</p>\n\n<pre><code>ioFunction :: String -&gt; IO ()\nioFunction str = do putStrLn str\n                    putStrLn \"2\"\n</code></pre>\n\n<p>Here, <code>ioFunction</code>, from a mathematical point of view, is a function that takes one input and returns a value of type <code>IO ()</code>. I presume it means nothing else. That is, from a mathematical point of view, this function returns a value and nothing else; in particular, it doesn't print anything.</p>\n\n<p>So does this mean that the way Haskell uses the IO monad for imperative side-effects (in this case: that running this function will first print <code>str</code> and then print \"2\", in that order) is <strong>purely a GHC implementation detail</strong> that has nothing to do with the mathematical (and in some sense even the Haskell) meaning of the term?</p>\n\n<p><strong>EDIT:</strong> To make this question clearer, what I mean to ask is, for example, is there any difference from the <strong>mathematical point of view</strong> between the following two functions:</p>\n\n<pre><code>ioFunction1 :: String -&gt; IO ()\nioFunction1 str = do putStrLn str\n                     putStrLn \"2\"\n\n\nioFunction2 :: String -&gt; IO ()\nioFunction2 str = do return ()\n</code></pre>\n\n<p>It seems the answer is no, for -- from the mathematical point of view -- they both take as input a <code>String</code> and return a value (presumably, the same value) of type <code>IO ()</code>. Is this not the case?</p>\n"}, {"tags": ["haskell", "dictionary", "integer", "int", "elm"], "answers": [{"comments": [{"owner": {"reputation": 966, "user_id": 1953120, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0d9384697ff55e412a6981211f661bed?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/1953120/adrian"}, "edited": false, "score": 2, "creation_date": 1485774440, "post_id": 41926797, "comment_id": 71048982, "body": "The essential part of the answer above is that the <code>Model</code> is defined as a <code>Dict</code> alias.  Please make sure your model definition is using <code>alias</code> keyword. Otherwise you define your Model as a single case discriminated union.      <code>type alias Model = Dict Int String</code>"}], "tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": true, "score": 4, "last_activity_date": 1485729737, "creation_date": 1485729737, "answer_id": 41926797, "question_id": 41926649, "link": "https://stackoverflow.com/questions/41926649/using-int-or-number-in-elm-dictionary/41926797#41926797", "title": "using Int or number in Elm dictionary", "body": "<p>Would you be able to provide the relevant code?</p>\n\n<p>The following compiles and works fine for me:</p>\n\n<pre><code>import Dict exposing (Dict, fromList, get)\n\ntype alias Model = Dict Int String\n\nmodel : Model\nmodel = fromList [(1, \"apple\"), (2, \"banana\"), (42, \"giraffe\")]\n\ntest : Maybe String\ntest = get 2 model\n</code></pre>\n"}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 41926797, "answer_count": 1, "score": 0, "last_activity_date": 1485729737, "creation_date": 1485728723, "question_id": 41926649, "link": "https://stackoverflow.com/questions/41926649/using-int-or-number-in-elm-dictionary", "title": "using Int or number in Elm dictionary", "body": "<p>I defined my model to be <code>Model = Dict Int String</code> however in compile time, I get <code>number</code> instead of <code>Int</code> so it is wrong:</p>\n\n<pre><code>The 2nd argument to function `get` is causing a mismatch.\n\n71|              Dict.get 3 model \n                            ^^^^^\nFunction `get` is expecting the 2nd argument to be:\n\n    Dict number v\n\nBut it is:\n\n    Model\n</code></pre>\n\n<p>and unfortunately Elm repl does the same thing returning <code>Dict number</code> instead of <code>Dict Int</code>.  </p>\n\n<pre><code>&gt; Dict.fromList [ (1, {a= 1} )]\nDict.fromList [(1,{ a = 1 })] : Dict.Dict number { a : number1 }\n</code></pre>\n\n<p>Certain languages such as Haskell expose <code>Int</code> as as well as <code>Integer</code> as well as <code>number</code>  How can I coerce it to be integer?</p>\n"}, {"tags": ["haskell", "find"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485722778, "post_id": 41925720, "comment_id": 71031907, "body": "What should be returned in the case of <code>Nothing</code>?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485722816, "post_id": 41925720, "comment_id": 71031921, "body": "Your question can be interpreted as either &quot;How do I embed the assumption that <code>x</code> has a first factor (so I can avoid <code>Maybe</code> altogether)&quot; or &quot;Why doesn&#39;t Haskell have the notion of untagged unions&quot;. Which is it?"}, {"owner": {"reputation": 1168, "user_id": 6845907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffbc2aee4f886b5983102f2ca8624e4b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Ziebert", "link": "https://stackoverflow.com/users/6845907/nick-ziebert"}, "edited": false, "score": 0, "creation_date": 1485722824, "post_id": 41925720, "comment_id": 71031923, "body": "x should be returned."}, {"owner": {"reputation": 1168, "user_id": 6845907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffbc2aee4f886b5983102f2ca8624e4b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Ziebert", "link": "https://stackoverflow.com/users/6845907/nick-ziebert"}, "edited": false, "score": 0, "creation_date": 1485722980, "post_id": 41925720, "comment_id": 71031981, "body": "I don&#39;t follow Alec.  I want it to either return the first factor of x or x."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485724387, "post_id": 41925720, "comment_id": 71032478, "body": "@NickZiebert I am so sorry - I completely misunderstood your question for a completely different common problem people have! Just make a second function <code>firstFactorOf&#39; x = maybe x (firstFactorOf x)</code>"}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485724970, "post_id": 41925720, "comment_id": 71032677, "body": "@Alec I think you mean <code>fromMaybe</code>. <code>maybe</code> takes 3 arguments."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 1, "creation_date": 1485725074, "post_id": 41925720, "comment_id": 71032709, "body": "@liminalisht Yes. Or <code>maybe x id (firstFactorOf x)</code>. I&#39;m all over the place. :)"}], "answers": [{"comments": [{"owner": {"reputation": 1168, "user_id": 6845907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffbc2aee4f886b5983102f2ca8624e4b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Ziebert", "link": "https://stackoverflow.com/users/6845907/nick-ziebert"}, "edited": false, "score": 0, "creation_date": 1485841895, "post_id": 41925819, "comment_id": 71080700, "body": "This was way overly complicated.  I posted my own solution that answers the question the way it was asked.  Why propose a new function for such an easy task??"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1168, "user_id": 6845907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffbc2aee4f886b5983102f2ca8624e4b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Ziebert", "link": "https://stackoverflow.com/users/6845907/nick-ziebert"}, "edited": false, "score": 0, "creation_date": 1485842726, "post_id": 41925819, "comment_id": 71081012, "body": "You do not need to propose a new function. You could for instance not return <code>Nothing</code> to start with, but simply <code>x</code>. Your question was titled &quot;<code>Just Int</code> to <code>Int</code>&quot;... Looks to me that you then look for a &quot;conversion&quot;. That&#39;s what people do when the <i>convert</i> a thing from <i>one type</i> to <i>another</i>. Furthermore it is considered <i>elegant</i> to return <code>Nothing</code> in case for instance a search fails."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1168, "user_id": 6845907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffbc2aee4f886b5983102f2ca8624e4b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Ziebert", "link": "https://stackoverflow.com/users/6845907/nick-ziebert"}, "edited": false, "score": 0, "creation_date": 1485842961, "post_id": 41925819, "comment_id": 71081092, "body": "Finally it thus looks that you simply copied the function from a textbook not knowing how it works (otherwise you would probably not let it return <code>Nothing</code> to begin with)..."}, {"owner": {"reputation": 1168, "user_id": 6845907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffbc2aee4f886b5983102f2ca8624e4b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Ziebert", "link": "https://stackoverflow.com/users/6845907/nick-ziebert"}, "edited": false, "score": 0, "creation_date": 1485843484, "post_id": 41925819, "comment_id": 71081278, "body": "Thanks, but I wrote it myself.  And thanks for making this personal and down voting all my stuff."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1168, "user_id": 6845907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffbc2aee4f886b5983102f2ca8624e4b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Ziebert", "link": "https://stackoverflow.com/users/6845907/nick-ziebert"}, "edited": false, "score": 0, "creation_date": 1485843566, "post_id": 41925819, "comment_id": 71081311, "body": "@NickZiebert: well it was some time ago I did downvote (usually I try to avoid arrogant people that use slang ;). Furthermore then I do not get why you introduced <code>Nothing</code> in the first place. What came into your mind to do that? I&#39;m quite curious..."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1168, "user_id": 6845907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffbc2aee4f886b5983102f2ca8624e4b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Ziebert", "link": "https://stackoverflow.com/users/6845907/nick-ziebert"}, "edited": false, "score": 0, "creation_date": 1485846562, "post_id": 41925819, "comment_id": 71082513, "body": "@NickZiebert: and since you&#39;re quite a fan of simplification, I&#39;ve constructed a <i>two-liner</i> that even totally omits the <code>fromJust</code>..."}, {"owner": {"reputation": 1168, "user_id": 6845907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffbc2aee4f886b5983102f2ca8624e4b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Ziebert", "link": "https://stackoverflow.com/users/6845907/nick-ziebert"}, "edited": false, "score": 0, "creation_date": 1485848134, "post_id": 41925819, "comment_id": 71083202, "body": "Nice.  However, I needed 2 if statements so I can create an edge condition or a recursive call.  This was first step in creating a function that prints all factors of a #"}, {"owner": {"reputation": 1168, "user_id": 6845907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffbc2aee4f886b5983102f2ca8624e4b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Ziebert", "link": "https://stackoverflow.com/users/6845907/nick-ziebert"}, "edited": false, "score": 0, "creation_date": 1485851182, "post_id": 41925819, "comment_id": 71084705, "body": "Would you like to see the finished function to understand why I was asking this question in such a specific way?  I see why you were confused."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1168, "user_id": 6845907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffbc2aee4f886b5983102f2ca8624e4b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Ziebert", "link": "https://stackoverflow.com/users/6845907/nick-ziebert"}, "edited": false, "score": 0, "creation_date": 1485853448, "post_id": 41925819, "comment_id": 71085948, "body": "@NickZiebert: as far as I know a simple <code>filter</code> would be sufficient to generate all (prime)-factors. But yeah,problem. The thing that makes me a bit annoyed is that you ask for help. Both answers provide you with some functions to solve your problem. You use these functions in your own answer, but apparently have a problem with the fact that we introduced new functions, which is like a minor aspect. It is like criticizing a paper on special relativity because you do not like the square root being factored out."}, {"owner": {"reputation": 1168, "user_id": 6845907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffbc2aee4f886b5983102f2ca8624e4b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Ziebert", "link": "https://stackoverflow.com/users/6845907/nick-ziebert"}, "edited": false, "score": 0, "creation_date": 1485916812, "post_id": 41925819, "comment_id": 71120426, "body": "I appreciate your response.  Unfortunately, the above wasn&#39;t the answer I was looking for.  Your comment about only having to check up to the square root of the range of x definitely did help when creating my  allPrimeFactorsOf function.  The suggestion made it much quicker.  Thanks. (:"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1485847048, "last_edit_date": 1485847048, "creation_date": 1485723146, "answer_id": 41925819, "question_id": 41925720, "link": "https://stackoverflow.com/questions/41925720/just-int-to-int/41925819#41925819", "title": "Just Int to Int", "body": "<p>Haskell is statically typed, meaning that you can define a function <code>Maybe a -&gt; a</code>, but the question is what to do with the <code>Nothing</code> case.</p>\n\n<p>Haskell has two functions that can be helpful here: <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Maybe.html#v:fromMaybe\" rel=\"nofollow noreferrer\"><code>fromMaybe</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Maybe.html#v:fromJust\" rel=\"nofollow noreferrer\"><code>fromJust</code></a>:</p>\n\n<pre><code>fromMaybe :: a -&gt; Maybe a -&gt; a\nfromJust :: Maybe a -&gt; a\n</code></pre>\n\n<p><code>fromJust</code> simply assumes that you will always provide it a <code>Just x</code>, and return <code>x</code>, in the other case, it will throw an exception.</p>\n\n<p><code>fromMaybe</code> on the other hand expects two parameters, the first - an <code>a</code> is the \"default case\" the value that should be returned in case of <code>Nothing</code>. Next it is given a <code>Maybe a</code> and in case it is a <code>Just x</code>, <code>x</code> is returned. In the other case (<code>Nothing</code>) as said before the default is returned.</p>\n\n<p>In your comment you say <code>x</code> should be returned in case no such factor exists. So I propose you define a new function:</p>\n\n<pre><code>firstFactorOfJust :: Integral a =&gt; a -&gt; a\nfirstFactorOfJust x = fromMaybe x $ firstFactorOf x\n</code></pre>\n\n<p>So this function <code>firstFactorOfJust</code> calls your <code>firstFactorOf</code> function and if the result is <code>Nothing</code>, <code>x</code> will be returned. In the other case, the outcome of <code>firstFactorOf</code> will be returned (but only the <code>Integral</code> part, not the <code>Just ...</code> part).</p>\n\n<p><strong>EDIT (simplified)</strong></p>\n\n<p>Based on your own answer that had the intend to simplify things a bit, I had the idea that you can simplify it a bit more:</p>\n\n<pre><code>firstFactorOf x | Just z &lt;- find ((0 ==) . mod x) [2..x-1] = z\n                | otherwise = x\n</code></pre>\n\n<p>and since we are all fan of optimization, you can already stop after <code>sqrt(x)</code> iterations (a well known optimization in prime checking):</p>\n\n<pre><code>isqrt :: Int -&gt; Int\nisqrt = floor . sqrt . fromIntegral\n\nfirstFactorOf x | Just z &lt;- find ((0 ==) . mod x) [2..isqrt x] = z\n                | otherwise = x\n</code></pre>\n\n<p><strong>Simplified question</strong></p>\n\n<p>For some reason there was some peculiarly complicated aspect in your question:</p>\n\n<pre><code>firstFactorOf x\n    <b>| m == Nothing = m</b>\n    <b>| otherwise = m</b>\n    where m =(find p [2..x-1])\n          p y = mod x y == 0</code></pre>\n\n<p>Why do you use guards to make a distinction between two cases that generate the exact same output? You can fold this into:</p>\n\n<pre><code>firstFactorOf x = <b>m</b>\n    where m = (find p [2..x-1])\n          p y = mod x y == 0</code></pre>\n\n<p>and even further:</p>\n\n<pre><code>firstFactorOf x = find p [2..x-1]\n               where p y = mod x y == 0</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "is_accepted": false, "score": 2, "last_activity_date": 1485723512, "creation_date": 1485723512, "answer_id": 41925890, "question_id": 41925720, "link": "https://stackoverflow.com/questions/41925720/just-int-to-int/41925890#41925890", "title": "Just Int to Int", "body": "<p>If you want it to return the first factor of <code>x</code>, or <code>x</code>, then this should work:</p>\n\n<pre><code>firstFactorOf x =\n  let\n    p y = mod x y == 0\n    m = (find p [2..x-1])\n  in\n  fromMaybe x m\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1168, "user_id": 6845907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffbc2aee4f886b5983102f2ca8624e4b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Ziebert", "link": "https://stackoverflow.com/users/6845907/nick-ziebert"}, "is_accepted": true, "score": 0, "last_activity_date": 1485841670, "creation_date": 1485841670, "answer_id": 41950499, "question_id": 41925720, "link": "https://stackoverflow.com/questions/41925720/just-int-to-int/41950499#41950499", "title": "Just Int to Int", "body": "<pre><code>import Data.List\nimport Data.Maybe\n\nfirstFactorOf x\n    | m == Nothing = x\n    | otherwise = fromJust m\n    where m =(find p [2..x-1])\n          p y = mod x y == 0\n</code></pre>\n\n<p>This was what I was after.  Not sure why you guys made this so complicated.</p>\n"}], "owner": {"reputation": 1168, "user_id": 6845907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffbc2aee4f886b5983102f2ca8624e4b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Ziebert", "link": "https://stackoverflow.com/users/6845907/nick-ziebert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2489, "favorite_count": 0, "accepted_answer_id": 41950499, "answer_count": 3, "score": -1, "last_activity_date": 1485847048, "creation_date": 1485722517, "last_edit_date": 1485843116, "question_id": 41925720, "link": "https://stackoverflow.com/questions/41925720/just-int-to-int", "title": "Just Int to Int", "body": "<p>This code either returns the first factor of an Integer starting from 2 or returns nothing if it's a prime.</p>\n\n<p>Example:  firstFactorOf 24 returns \"Just 2\"</p>\n\n<p>Example: firstFactorOf 11 returns \"Nothing\"</p>\n\n<p>My question is, how would I return the value 2 rather than \"Just 2\" if there is a factor or return the value x if there is no factor.</p>\n\n<pre><code>firstFactorOf x\n    | m == Nothing = m\n    | otherwise = m\n    where m =(find p [2..x-1])\n          p y = mod x y == 0\n\n//RETURNS:\nghci&gt; firstFactorOf 24\nJust 2\nghci&gt; firstFactorOf 11\nNothing\n</code></pre>\n"}, {"tags": ["macos", "haskell", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 2, "creation_date": 1485725157, "post_id": 41925449, "comment_id": 71032742, "body": "Why not using stack?"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1485757432, "post_id": 41925449, "comment_id": 71040398, "body": "What is stack exactly? And what is the difference?"}, {"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1485763672, "post_id": 41925449, "comment_id": 71042823, "body": "stack is <a href=\"https://github.com/commercialhaskell/stack/releases\" rel=\"nofollow noreferrer\">this</a>, and there&#39;s <a href=\"https://www.google.com/?#q=cabal+stack\" rel=\"nofollow noreferrer\">some differences</a>, tl;dr. if you didn&#39;t know stack, just use stack."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1485769201, "post_id": 41925449, "comment_id": 71045726, "body": "What is haskell stack exactly?"}, {"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 1, "creation_date": 1485770049, "post_id": 41925449, "comment_id": 71046195, "body": "<code>cabal</code> is the package description library. <code>cabal-install</code> is the build &amp; automation tool which utilize cabal. <code>stack</code> is somewhat like dependency manager, which eliminates the problem called <a href=\"http://www.yesodweb.com/blog/2012/11/solving-cabal-hell\" rel=\"nofollow noreferrer\">cabal hell</a>."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1485784455, "post_id": 41925449, "comment_id": 71055578, "body": "Where can I find a tutorial to intall ghc?"}, {"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1485785673, "post_id": 41925449, "comment_id": 71056356, "body": "There&#39;s nothing difficult. I&#39;ve never used Mac, but you may follow <a href=\"https://docs.haskellstack.org/en/stable/install_and_upgrade/#macos\" rel=\"nofollow noreferrer\">this</a>. If installation is successful, then maybe all you need to do is <code>stack install ghc-mod</code>. If you just need the ghc, run <code>stack setup &amp;&amp; stack exec ghci</code>."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1485788480, "post_id": 41925449, "comment_id": 71058255, "body": "Ok, I will try it out tonight. Thanks"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1485789427, "post_id": 41925449, "comment_id": 71058879, "body": "I am planing to <a href=\"https://github.com/rikvdkleij/intellij-haskell\" rel=\"nofollow noreferrer\">github.com/rikvdkleij/intellij-haskell</a> as IDE, it works well with stack?"}, {"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1485789671, "post_id": 41925449, "comment_id": 71059050, "body": "I&#39;m afraid I can&#39;t help you. I have once tried that too, but it didn&#39;t work as I thought. It might be because of the platform problem, but I don&#39;t know the reason anyway."}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 467, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1485721699, "creation_date": 1485720809, "last_edit_date": 1485721699, "question_id": 41925449, "link": "https://stackoverflow.com/questions/41925449/cabal-missing-packages", "title": "Cabal missing packages", "body": "<p>I try to install cabal with the command on terminal</p>\n\n<pre><code>cabal install cabal-install\nResolving dependencies...\nConfiguring hackage-security-0.5.2.2...\nBuilding hackage-security-0.5.2.2...\nFailed to install hackage-security-0.5.2.2\nBuild log ( /Users/developer/.cabal/logs/hackage-security-0.5.2.2.log ):\ncabal: Entering directory '/var/folders/2x/t_2cl03x2092dkzvc702d7lc0000gn/T/cabal-tmp-586/hackage-security-0.5.2.2'\nConfiguring hackage-security-0.5.2.2...\nBuilding hackage-security-0.5.2.2...\nPreprocessing library hackage-security-0.5.2.2...\n[ 1 of 42] Compiling Prelude          ( src/Prelude.hs, dist/build/Prelude.o )\n[ 2 of 42] Compiling Text.JSON.Canonical ( src/Text/JSON/Canonical.hs, dist/build/Text/JSON/Canonical.o )\nFailed to load interface for \u2018Data.Text\u2019\nThere are files missing in the \u2018text-1.2.2.1\u2019 package,\ntry running 'ghc-pkg check'.\nUse -v to see a list of the files searched for.\ncabal: Leaving directory '/var/folders/2x/t_2cl03x2092dkzvc702d7lc0000gn/T/cabal-tmp-586/hackage-security-0.5.2.2'\ncabal: Error: some packages failed to install:\ncabal-install-1.24.0.2 depends on hackage-security-0.5.2.2 which failed to\ninstall.\nhackage-security-0.5.2.2 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>I am using <code>macOS Sierra Version 10.12.1</code>. The Haskell installation package is from <a href=\"https://www.haskell.org/platform/mac.html\" rel=\"nofollow noreferrer\">https://www.haskell.org/platform/mac.html</a>. The installation was successful.  </p>\n\n<p>When I try to install <code>cabal install ghc-mod</code> I've got following error:</p>\n\n<pre><code>cabal install ghc-mod\nResolving dependencies...\nConfiguring haskell-src-exts-1.18.2...\nBuilding haskell-src-exts-1.18.2...\nFailed to install haskell-src-exts-1.18.2\nBuild log ( /Users/developer/.cabal/logs/haskell-src-exts-1.18.2.log ):\ncabal: Entering directory '/var/folders/2x/t_2cl03x2092dkzvc702d7lc0000gn/T/cabal-tmp-713/haskell-src-exts-1.18.2'\nConfiguring haskell-src-exts-1.18.2...\nBuilding haskell-src-exts-1.18.2...\nPreprocessing library haskell-src-exts-1.18.2...\n[ 1 of 17] Compiling Language.Haskell.Exts.Syntax ( src/Language/Haskell/Exts/Syntax.hs, dist/build/Language/Haskell/Exts/Syntax.o )\n[ 2 of 17] Compiling Language.Haskell.Exts.SrcLoc ( src/Language/Haskell/Exts/SrcLoc.hs, dist/build/Language/Haskell/Exts/SrcLoc.o )\n[ 3 of 17] Compiling Language.Haskell.Exts.ParseSyntax ( src/Language/Haskell/Exts/ParseSyntax.hs, dist/build/Language/Haskell/Exts/ParseSyntax.o )\n[ 4 of 17] Compiling Language.Haskell.Exts.Pretty ( src/Language/Haskell/Exts/Pretty.hs, dist/build/Language/Haskell/Exts/Pretty.o )\n[ 5 of 17] Compiling Language.Haskell.Exts.Fixity ( src/Language/Haskell/Exts/Fixity.hs, dist/build/Language/Haskell/Exts/Fixity.o )\n[ 6 of 17] Compiling Language.Haskell.Exts.Extension ( src/Language/Haskell/Exts/Extension.hs, dist/build/Language/Haskell/Exts/Extension.o )\n[ 7 of 17] Compiling Language.Haskell.Exts.ExtScheme ( src/Language/Haskell/Exts/ExtScheme.hs, dist/build/Language/Haskell/Exts/ExtScheme.o )\n[ 8 of 17] Compiling Language.Haskell.Exts.Comments ( src/Language/Haskell/Exts/Comments.hs, dist/build/Language/Haskell/Exts/Comments.o )\n[ 9 of 17] Compiling Language.Haskell.Exts.ExactPrint ( src/Language/Haskell/Exts/ExactPrint.hs, dist/build/Language/Haskell/Exts/ExactPrint.o )\n[10 of 17] Compiling Language.Haskell.Exts.ParseMonad ( src/Language/Haskell/Exts/ParseMonad.hs, dist/build/Language/Haskell/Exts/ParseMonad.o )\n[11 of 17] Compiling Language.Haskell.Exts.InternalLexer ( src/Language/Haskell/Exts/InternalLexer.hs, dist/build/Language/Haskell/Exts/InternalLexer.o )\n[12 of 17] Compiling Language.Haskell.Exts.Lexer ( src/Language/Haskell/Exts/Lexer.hs, dist/build/Language/Haskell/Exts/Lexer.o )\n[13 of 17] Compiling Language.Haskell.Exts.ParseUtils ( src/Language/Haskell/Exts/ParseUtils.hs, dist/build/Language/Haskell/Exts/ParseUtils.o )\n[14 of 17] Compiling Language.Haskell.Exts.InternalParser ( dist/build/Language/Haskell/Exts/InternalParser.hs, dist/build/Language/Haskell/Exts/InternalParser.o )\n[15 of 17] Compiling Language.Haskell.Exts.Parser ( src/Language/Haskell/Exts/Parser.hs, dist/build/Language/Haskell/Exts/Parser.o )\n[16 of 17] Compiling Language.Haskell.Exts.Build ( src/Language/Haskell/Exts/Build.hs, dist/build/Language/Haskell/Exts/Build.o )\n[17 of 17] Compiling Language.Haskell.Exts ( src/Language/Haskell/Exts.hs, dist/build/Language/Haskell/Exts.o )\n\nsrc/Language/Haskell/Exts.hs:55:1: error:\n    Failed to load interface for \u2018Language.Preprocessor.Unlit\u2019\n    There are files missing in the \u2018cpphs-1.20.2\u2019 package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\ncabal: Leaving directory '/var/folders/2x/t_2cl03x2092dkzvc702d7lc0000gn/T/cabal-tmp-713/haskell-src-exts-1.18.2'\ncabal: Error: some packages failed to install:\nghc-mod-5.7.0.0 depends on haskell-src-exts-1.18.2 which failed to install.\nhaskell-src-exts-1.18.2 failed during the building phase. The exception was:\nExitFailure 1\nhlint-1.9.40 depends on haskell-src-exts-1.18.2 which failed to install.\n</code></pre>\n\n<p>The following cabal version is installed:</p>\n\n<pre><code>cabal --version\ncabal-install version 1.24.0.2\ncompiled using version 1.24.2.0 of the Cabal library\n</code></pre>\n\n<p>I also tried to run <code>ghc-pkg check</code> and got a lot of package problems, few examples:</p>\n\n<pre><code>There are problems in package monad-journal-0.7.2:\n  Warning: library-dirs: /Users/developer/.cabal/lib/x86_64-osx-ghc-8.0.2/monad-journal-0.7.2-6mtwu36per6DTorptNDDzP doesn't exist or isn't a directory\n  Warning: dynamic-library-dirs: /Users/developer/.cabal/lib/x86_64-osx-ghc-8.0.2 doesn't exist or isn't a directory\n  Warning: haddock-interfaces: /Users/developer/.cabal/share/doc/x86_64-osx-ghc-8.0.2/monad-journal-0.7.2/html/monad-journal.haddock doesn't exist or isn't a file\n  Warning: haddock-html: /Users/developer/.cabal/share/doc/x86_64-osx-ghc-8.0.2/monad-journal-0.7.2/html doesn't exist or isn't a directory\n  import-dirs: /Users/developer/.cabal/lib/x86_64-osx-ghc-8.0.2/monad-journal-0.7.2-6mtwu36per6DTorptNDDzP doesn't exist or isn't a directory\n  cannot find any of [\"Control/Monad/Journal.hi\",\"Control/Monad/Journal.p_hi\",\"Control/Monad/Journal.dyn_hi\"]\n  cannot find any of [\"Control/Monad/Journal/Class.hi\",\"Control/Monad/Journal/Class.p_hi\",\"Control/Monad/Journal/Class.dyn_hi\"]\n  cannot find any of [\"Control/Monad/Trans/Journal.hi\",\"Control/Monad/Trans/Journal.p_hi\",\"Control/Monad/Trans/Journal.dyn_hi\"]\n  cannot find any of [\"libHSmonad-journal-0.7.2-6mtwu36per6DTorptNDDzP.a\",\"libHSmonad-journal-0.7.2-6mtwu36per6DTorptNDDzP.p_a\",\"libHSmonad-journal-0.7.2-6mtwu36per6DTorptNDDzP-ghc8.0.2.so\",\"libHSmonad-journal-0.7.2-6mtwu36per6DTorptNDDzP-ghc8.0.2.dylib\",\"HSmonad-journal-0.7.2-6mtwu36per6DTorptNDDzP-ghc8.0.2.dll\"] on library path\nThere are problems in package either-4.4.1.1:\n  Warning: library-dirs: /Users/developer/.cabal/lib/x86_64-osx-ghc-8.0.2/either-4.4.1.1-CrzaYJSOcIXAyUkEE7mRiL doesn't exist or isn't a directory\n  Warning: dynamic-library-dirs: /Users/developer/.cabal/lib/x86_64-osx-ghc-8.0.2 doesn't exist or isn't a directory\n  Warning: haddock-interfaces: /Users/developer/.cabal/share/doc/x86_64-osx-ghc-8.0.2/either-4.4.1.1/html/either.haddock doesn't exist or isn't a file\n  Warning: haddock-html: /Users/developer/.cabal/share/doc/x86_64-osx-ghc-8.0.2/either-4.4.1.1/html doesn't exist or isn't a directory\n  import-dirs: /Users/developer/.cabal/lib/x86_64-osx-ghc-8.0.2/either-4.4.1.1-CrzaYJSOcIXAyUkEE7mRiL doesn't exist or isn't a directory\n  cannot find any of [\"Control/Monad/Trans/Either.hi\",\"Control/Monad/Trans/Either.p_hi\",\"Control/Monad/Trans/Either.dyn_hi\"]\n  cannot find any of [\"Data/Either/Combinators.hi\",\"Data/Either/Combinators.p_hi\",\"Data/Either/Combinators.dyn_hi\"]\n  cannot find any of [\"Data/Either/Validation.hi\",\"Data/Either/Validation.p_hi\",\"Data/Either/Validation.dyn_hi\"]\n  cannot find any of [\"libHSeither-4.4.1.1-CrzaYJSOcIXAyUkEE7mRiL.a\",\"libHSeither-4.4.1.1-CrzaYJSOcIXAyUkEE7mRiL.p_a\",\"libHSeither-4.4.1.1-CrzaYJSOcIXAyUkEE7mRiL-ghc8.0.2.so\",\"libHSeither-4.4.1.1-CrzaYJSOcIXAyUkEE7mRiL-ghc8.0.2.dylib\",\"HSeither-4.4.1.1-CrzaYJSOcIXAyUkEE7mRiL-ghc8.0.2.dll\"] on library path\nThere are problems in package free-4.12.4:\n  Warning: library-dirs: /Users/developer/.cabal/lib/x86_64-osx-ghc-8.0.2/free-4.12.4-Hbi0FikbXDW7eNkrPW79mM doesn't exist or isn't a directory\n  Warning: dynamic-library-dirs: /Users/developer/.cabal/lib/x86_64-osx-ghc-8.0.2 doesn't exist or isn't a directory\n  Warning: haddock-interfaces: /Users/developer/.cabal/share/doc/x86_64-osx-ghc-8.0.2/free-4.12.4/html/free.haddock doesn't exist or isn't a file\n  Warning: haddock-html: /Users/developer/.cabal/share/doc/x86_64-osx-ghc-8.0.2/free-4.12.4/html doesn't exist or isn't a directory\n  import-dirs: /Users/developer/.cabal/lib/x86_64-osx-ghc-8.0.2/free-4.12.4-Hbi0FikbXDW7eNkrPW79mM doesn't exist or isn't a directory\n  cannot find any of [\"Control/Applicative/Free.hi\",\"Control/Applicative/Free.p_hi\",\"Control/Applicative/Free.dyn_hi\"]\n  cannot find any of [\"Control/Applicative/Free/Final.hi\",\"Control/Applicative/Free/Final.p_hi\",\"Control/Applicative/Free/Final.dyn_hi\"]\n  cannot find any of [\"Control/Applicative/Trans/Free.hi\",\"Control/Applicative/Trans/Free.p_hi\",\"Control/Applicative/Trans/Free.dyn_hi\"]\n  cannot find any of [\"Control/Alternative/Free.hi\",\"Control/Alternative/Free.p_hi\",\"Control/Alternative/Free.dyn_hi\"]\n  cannot find any of [\"Control/Alternative/Free/Final.hi\",\"Control/Alternative/Free/Final.p_hi\",\"Control/Alternative/Free/Final.dyn_hi\"]\n  cannot find any of [\"Control/Comonad/Cofree.hi\",\"Control/Comonad/Cofree.p_hi\",\"Control/Comonad/Cofree.dyn_hi\"]\n  cannot find any of [\"Control/Comonad/Cofree/Class.hi\",\"Control/Comonad/Cofree/Class.p_hi\",\"Control/Comonad/Cofree/Class.dyn_hi\"]\n  cannot find any of [\"Control/Comonad/Trans/Cofree.hi\",\"Control/Comonad/Trans/Cofree.p_hi\",\"Control/Comonad/Trans/Cofree.dyn_hi\"]\n  cannot find any of [\"Control/Comonad/Trans/Coiter.hi\",\"Control/Comonad/Trans/Coiter.p_hi\",\"Control/Comonad/Trans/Coiter.dyn_hi\"]\n  cannot find any of [\"Control/Monad/Free.hi\",\"Control/Monad/Free.p_hi\",\"Control/Monad/Free.dyn_hi\"]\n  cannot find any of [\"Control/Monad/Free/Church.hi\",\"Control/Monad/Free/Church.p_hi\",\"Control/Monad/Free/Church.dyn_hi\"]\n  cannot find any of [\"Control/Monad/Free/Class.hi\",\"Control/Monad/Free/Class.p_hi\",\"Control/Monad/Free/Class.dyn_hi\"]\n  cannot find any of [\"Control/Monad/Free/TH.hi\",\"Control/Monad/Free/TH.p_hi\",\"Control/Monad/Free/TH.dyn_hi\"]\n  cannot find any of [\"Control/Monad/Trans/Free.hi\",\"Control/Monad/Trans/Free.p_hi\",\"Control/Monad/Trans/Free.dyn_hi\"]\n  cannot find any of [\"Control/Monad/Trans/Free/Church.hi\",\"Control/Monad/Trans/Free/Church.p_hi\",\"Control/Monad/Trans/Free/Church.dyn_hi\"]\n  cannot find any of [\"Control/Monad/Trans/Iter.hi\",\"Control/Monad/Trans/Iter.p_hi\",\"Control/Monad/Trans/Iter.dyn_hi\"]\n  cannot find any of [\"libHSfree-4.12.4-Hbi0FikbXDW7eNkrPW79mM.a\",\"libHSfree-4.12.4-Hbi0FikbXDW7eNkrPW79mM.p_a\",\"libHSfree-4.12.4-Hbi0FikbXDW7eNkrPW79mM-ghc8.0.2.so\",\"libHSfree-4.12.4-Hbi0FikbXDW7eNkrPW79mM-ghc8.0.2.dylib\",\"HSfree-4.12.4-Hbi0FikbXDW7eNkrPW79mM-ghc8.0.2.dll\"] on library path\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": true, "score": 2, "last_activity_date": 1485740629, "last_edit_date": 1485740629, "creation_date": 1485738491, "answer_id": 41927753, "question_id": 41925244, "link": "https://stackoverflow.com/questions/41925244/manually-attaching-scc-to-an-entire-function/41927753#41927753", "title": "Manually attaching SCC to an entire function?", "body": "<p>It seems that this will be possible in the next major release of GHC (8.2), see this ticket <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12116\" rel=\"nofollow noreferrer\">#12116</a> (which shows the same workarounds and problems as you are having).</p>\n\n<p>According to the <a href=\"http://downloads.haskell.org/~ghc/master/users-guide/profiling.html#inserting-cost-centres-by-hand\" rel=\"nofollow noreferrer\">users guide</a> for the master branch of GHC you will be able to put the annotation at the same level as the declaration of <code>f</code>. Like</p>\n\n<pre><code>f x = g x y\n  where g = ...\n        y = ...\n{-# SCC f #-}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>f x = g x y\n  where g = ...\n        y = ...\n{-# SCC f \"some_cc_name\" #-}\n</code></pre>\n"}], "owner": {"reputation": 319, "user_id": 6531137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8fa00f21d96d6c6030c3c74d7fb26944?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/6531137/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 41927753, "answer_count": 1, "score": 3, "last_activity_date": 1485740629, "creation_date": 1485719481, "question_id": 41925244, "link": "https://stackoverflow.com/questions/41925244/manually-attaching-scc-to-an-entire-function", "title": "Manually attaching SCC to an entire function?", "body": "<p>Is it possible to manually attach an SCC to an entire function? For example, how do I attach an SCC to <code>f</code> in the following?</p>\n\n<pre><code>f x = g x\n  where g x = ...\n</code></pre>\n\n<p>If I write </p>\n\n<pre><code>f x = {-# SCC f #-} g x y\n  where g = ...\n        y = ...\n</code></pre>\n\n<p>Then <code>g</code> and <code>y</code> won't be included in the SCC. Instead, it seems like I have to write</p>\n\n<pre><code>f x = {-# SCC f #-}\n      let g = ...\n          y = ...\n      in  g x y\n</code></pre>\n\n<p>But this can be annoying because it requires rewriting <code>where</code> into <code>let</code> and guards into <code>case</code> statements. How can I get the same effect without doing all of this rewriting? -fprof-auto seems to be able to do this. But I only want to manually add SCC to a small number of functions.</p>\n"}, {"tags": ["haskell", "traversable"], "comments": [{"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 1, "creation_date": 1485706831, "post_id": 41922918, "comment_id": 71026597, "body": "Assuming the signature of your <code>predicate</code> function is correct, then your implementation of <code>filteredPowerSet</code> is incorrect. Why are you composing <code>filter predicate</code> with <code>sequence</code>? This doesn&#39;t typecheck. Shouldn&#39;t your implementation be <code>filteredPowerSet = filter predicate</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1485706949, "post_id": 41922918, "comment_id": 71026635, "body": "The declared type implies that you are already receiving (or at least expecting) a powerset, not a set, as the argument."}, {"owner": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "edited": false, "score": 0, "creation_date": 1485707056, "post_id": 41922918, "comment_id": 71026682, "body": "I am recieving a list of lists, like [[1,2],[3,4,5]], sequence produces the following: [[1,3],[1,4],[1,5],[2,3],[2,4],[2,5]]."}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1485707223, "post_id": 41922918, "comment_id": 71026733, "body": "BTW just so you understand the confusion, <code>sequence</code> is a very common function in Haskell found in <code>Prelude</code> and <code>Control.Monad</code>: <code>sequence :: Monad m =&gt; [m a] -&gt; m [a]</code>"}, {"owner": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "edited": false, "score": 0, "creation_date": 1485707315, "post_id": 41922918, "comment_id": 71026768, "body": "That is the function I am using. I&#39;ll edit my post to clarify this"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1485707416, "post_id": 41922918, "comment_id": 71026814, "body": "<code>sequence</code> doesn&#39;t create a powerset. For one, it produces a list of lists if equal length."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1485707496, "post_id": 41922918, "comment_id": 71026844, "body": "<code>sequence</code> computes the cartesian product -- perhaps this is what you mean?"}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1485707526, "post_id": 41922918, "comment_id": 71026856, "body": "<code>filter</code> makes a single pass, to answer your question."}, {"owner": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "edited": false, "score": 0, "creation_date": 1485707596, "post_id": 41922918, "comment_id": 71026889, "body": "Yeah.. I was thinking cartesian product of course. I do not know why I wrote powerset.. Sorry everyone for the confusion."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1485709066, "post_id": 41922918, "comment_id": 71027440, "body": "Is something about <code>filter predicate . sequence</code> multiple-pass-y?"}, {"owner": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "edited": false, "score": 0, "creation_date": 1485709312, "post_id": 41922918, "comment_id": 71027502, "body": "I think I was not clear again.. By &quot;one pass&quot; I meant eliminating intermediate list."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1485712590, "post_id": 41922918, "comment_id": 71028633, "body": "If your optimizer can&#39;t, rewrite <code>sequence</code> as an explicit list comprehension and stick the predicate in it."}, {"owner": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "edited": false, "score": 0, "creation_date": 1485714291, "post_id": 41922918, "comment_id": 71029169, "body": "I can not use list comprehension, since the input list has variable length."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1485762205, "post_id": 41922918, "comment_id": 71042246, "body": "<code>filtered_sequence _ [] = [[]]; filtered_sequence (x:xs) = [z|u&lt;-x, us&lt;-sequence xs, let z = u:us, f z]</code>. Note <code>f</code> doesn&#39;t propagate, i.e. to make this definition recursive one would write <code>filtered_sequence (const True) xs</code> inside the comprehension."}], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 1, "last_activity_date": 1485719739, "last_edit_date": 1485719739, "creation_date": 1485718759, "answer_id": 41925119, "question_id": 41922918, "link": "https://stackoverflow.com/questions/41922918/filtered-list-cartesian-product-without-intermediate-list/41925119#41925119", "title": "filtered list cartesian product without intermediate list", "body": "<p><code>traverse</code> here encodes the pattern that <code>predicate</code> has the form <code>all foo</code> for some <code>foo</code>. Then, <code>filteredCartesianProduct</code> is <code>traverse (filter foo)</code>.</p>\n\n<p>If <code>predicate</code> says yes for each prefix of any list on which it says yes, you've got the backtracking pattern:</p>\n\n<pre><code>filteredCartesianProduct = foldlM (\\accum factor -&gt; [new | x &lt;- factor, let new = accum ++ [x], predicate new]) []\n</code></pre>\n\n<p>I wonder how to get rid of the <code>++ [_]</code> smell.</p>\n"}], "owner": {"reputation": 437, "user_id": 6534153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/65594d05af54fa0c3797bee8aa4a811a?s=128&d=identicon&r=PG&f=1", "display_name": "lanskey", "link": "https://stackoverflow.com/users/6534153/lanskey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1485719739, "creation_date": 1485706055, "last_edit_date": 1485709536, "question_id": 41922918, "link": "https://stackoverflow.com/questions/41922918/filtered-list-cartesian-product-without-intermediate-list", "title": "filtered list cartesian product without intermediate list", "body": "<p>I am trying to create a filtered cartesian product from a given list of lists. The naive solution is the following:</p>\n\n<pre><code>import Data.Traversable (sequence)\n\npredicate :: [T] -&gt; Bool\npredicate = ...\n\nfilteredCartesianProduct :: [[T]] -&gt; [[T]]\nfilteredCartesianProduct = filter predicate . sequence\n</code></pre>\n\n<p>Is traversable powerful enough to do it without creating an intermediate list? Is there an idiomatic way to do this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1485697483, "post_id": 41921511, "comment_id": 71023805, "body": "Will the configurations be set once, or will they be dynamic?"}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1485697829, "post_id": 41921511, "comment_id": 71023897, "body": "@Carcigenicate they will be set once."}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1485697877, "post_id": 41921511, "comment_id": 71023911, "body": "it would be nice if you explain the situation that they will be dynamic. it can come in handy."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1485698123, "post_id": 41921511, "comment_id": 71023981, "body": "IIRC (it&#39;s been awhile since I&#39;ve written Haskell), Haskell has a delay mechanism, and atoms. Delays are used when you want to delay the initialization of something, but only set it once. Atoms are used when you need to update something more than once (I could be confusing terminology with a Clojure too. Pretty sure Haskell has equivalents though). Make sure it isn&#39;t fine to just set the configurations file in the main procedure, then thread it into any functions that need it, or use a state monad. I&#39;d prefer those options to a global any day."}], "answers": [{"tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": false, "score": 1, "last_activity_date": 1485698644, "creation_date": 1485698644, "answer_id": 41921736, "question_id": 41921511, "link": "https://stackoverflow.com/questions/41921511/haskell-global-variable-for-project-config/41921736#41921736", "title": "haskell global variable for project config", "body": "<p>For a complex configuration I would recommend to have a look at the reader Monad. An example can be found here: <a href=\"http://adit.io/posts/2013-06-10-three-useful-monads.html#the-reader-monad\" rel=\"nofollow noreferrer\">Three Useful Monads</a></p>\n"}], "owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1485698644, "creation_date": 1485697003, "last_edit_date": 1485697105, "question_id": 41921511, "link": "https://stackoverflow.com/questions/41921511/haskell-global-variable-for-project-config", "title": "haskell global variable for project config", "body": "<p>I have a project and I read the config from a file. I want these configurations to be available every where. </p>\n\n<p>What is the best way to do this in Haskell?</p>\n\n<p>Someone said I could write to <code>System.Environment</code>. Is this OK?</p>\n"}, {"tags": ["xml", "haskell", "types", "computer-science", "definition"], "answers": [{"comments": [{"owner": {"reputation": 929, "user_id": 4190925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f49e067e8fdca6c90df737a0d519f746?s=128&d=identicon&r=PG&f=1", "display_name": "jjj", "link": "https://stackoverflow.com/users/4190925/jjj"}, "edited": false, "score": 1, "creation_date": 1485705627, "post_id": 41921118, "comment_id": 71026175, "body": "Thanks for your answer, but the first part is clearly incorrect. There are some natural language contexts in which you can use <code>or</code> meaning <code>both</code> (e.g. &quot;Do you want an apple or a pear? -Both, please.&quot;). Even more, in language we use words as <code>or</code> and <code>and</code> in a way which allows to determine a &quot;truth value&quot;."}], "tags": [], "owner": {"reputation": 2708, "user_id": 383632, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MT9E1.png?s=128&g=1", "display_name": "Bartvbl", "link": "https://stackoverflow.com/users/383632/bartvbl"}, "is_accepted": false, "score": 1, "last_activity_date": 1485694497, "creation_date": 1485694497, "answer_id": 41921118, "question_id": 41921079, "link": "https://stackoverflow.com/questions/41921079/why-use-or-instead-of-xor-in-definitions/41921118#41921118", "title": "Why use &quot;or&quot; instead of &quot;xor&quot; in definitions?", "body": "<p>I think the meaning of \"or\" here is in a literal sense as opposed to a mathematical sense. Using the term \"or\" means that the value can have one value, or another. It is not an operator which aims to determine a truth value.</p>\n\n<p>While it may not be entirely logical to use an \"or\" operator sign for this, it does a good enough job at getting the point across for a reader. This clarity is ultimately the thing a language is striving for. As long as a greater proportion of readers is capable of interpreting it as a \"literal\" usage as opposed to a \"mathematical\" operator usage, using or in a literal sense means you, as a language, are doing a better job at getting your point across, making the method superior to using something such as XOR.</p>\n"}, {"comments": [{"owner": {"reputation": 929, "user_id": 4190925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f49e067e8fdca6c90df737a0d519f746?s=128&d=identicon&r=PG&f=1", "display_name": "jjj", "link": "https://stackoverflow.com/users/4190925/jjj"}, "edited": false, "score": 0, "creation_date": 1485705134, "post_id": 41921227, "comment_id": 71026020, "body": "Thanks for your reply, I should have seen a similarity to regex <code>|</code> operator. Silly me."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1485695281, "creation_date": 1485695281, "answer_id": 41921227, "question_id": 41921079, "link": "https://stackoverflow.com/questions/41921079/why-use-or-instead-of-xor-in-definitions/41921227#41921227", "title": "Why use &quot;or&quot; instead of &quot;xor&quot; in definitions?", "body": "<p>This <code>data X = A | B</code> notation should not really be understood as a logical OR at all (though that corresponds quite well to the intuitive meaning). What it really means is that <code>X</code> is a <em>sum type</em> of <code>A</code> and <code>B</code>, i.e. a <a href=\"https://en.wikipedia.org/wiki/Coproduct\">coproduct</a>. Now, the <em>product</em> operation on booleans is in fact AND, and so the dual would quite naturally be OR.</p>\n\n<p>Though then again, the sum operation on a vector space of booleans is actually XOR so we're turning circles a bit...</p>\n\n<p>I just wouldn't read too much into this. <code>|</code> is simply a symbol; in C-like languages it happens to also mean bitwise OR, but the actual logical OR is generally denoted differently, be it <code>||</code> or <code>\u2228</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1485704062, "creation_date": 1485704062, "answer_id": 41922602, "question_id": 41921079, "link": "https://stackoverflow.com/questions/41921079/why-use-or-instead-of-xor-in-definitions/41922602#41922602", "title": "Why use &quot;or&quot; instead of &quot;xor&quot; in definitions?", "body": "<p><code>|</code> has a long history of being used to separate items in a list of mutually exclusive choices:</p>\n\n<ol>\n<li><p>Regular expressions: <code>a* | b*</code> means a string can either be 0 or more <code>a</code>s or 0 or more <code>b</code>s, but not both.</p></li>\n<li><p>Backus-Naur form for representing context-free grammars:</p>\n\n<pre><code>Expr ::= Term | Expr AddOp Term\n</code></pre>\n\n<p>in which an expression can either be a single term, or another expression combined with a term with an addition operator. (It cannot be both simultaneously.)</p></li>\n<li><p>Usage messages for command-line programs:</p>\n\n<pre><code>git branch (-d | -D) [-r] &lt;branchname&gt;...\n</code></pre>\n\n<p>Here the <code>git branch</code> command can take either the <code>-d</code> or the <code>-D</code> option, but not both in the same invocation.</p></li>\n</ol>\n\n<p>The <code>data</code> statement in Haskell continues this tradition; it is unrelated to the use of <code>|</code> as a logical or bit-wise operator. </p>\n\n<p>(If anything, it is possible that the use of <code>|</code> for bitwise <code>OR</code> was inspired by Backus-Naur form, in which case you could be asking why <code>|</code> is used for <code>OR</code> instead of <code>XOR</code>.)</p>\n"}], "owner": {"reputation": 929, "user_id": 4190925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f49e067e8fdca6c90df737a0d519f746?s=128&d=identicon&r=PG&f=1", "display_name": "jjj", "link": "https://stackoverflow.com/users/4190925/jjj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 396, "favorite_count": 0, "accepted_answer_id": 41921227, "answer_count": 3, "score": 1, "last_activity_date": 1485704062, "creation_date": 1485694273, "question_id": 41921079, "link": "https://stackoverflow.com/questions/41921079/why-use-or-instead-of-xor-in-definitions", "title": "Why use &quot;or&quot; instead of &quot;xor&quot; in definitions?", "body": "<p>This might be a trivial question but I really can't find the answer anywhere. There is a convention in computer science which I find peculiar.</p>\n\n<p>In <a href=\"https://wiki.haskell.org/Type\" rel=\"nofollow noreferrer\">haskell datatypes</a> can be defined like this:</p>\n\n<pre><code>data Bool = False | True\n</code></pre>\n\n<p>In xml <a href=\"https://www.w3.org/TR/REC-xml-names/#ns-qualnames\" rel=\"nofollow noreferrer\">qualified names</a> are defined like this:</p>\n\n<pre><code>QName   ::=   PrefixedName | UnprefixedName\n</code></pre>\n\n<p>There are probably more similar examples but this should suffice.</p>\n\n<p>Usually <a href=\"https://wiki.haskell.org/Keywords#.7C\" rel=\"nofollow noreferrer\">it is well understood</a> that <code>|</code> (pipe or bar) should be read as <code>or</code>. But this seems strange. <code>A or B</code> is true also when both A and B are true. While it makes sense in the first example (there is a possibility that something is <code>True</code> and <code>False</code> at the same time, but we implicitly assume the law of non-contradiction), it doesn't in the second: something is either a <code>PrefixedName</code> or an <code>UnprefixedName</code> it can't be both. </p>\n\n<p>So why is this often put like this? Why not use exclusive or? Are there any non-conventional reasons?</p>\n"}, {"tags": ["unit-testing", "haskell"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1485690816, "post_id": 41920181, "comment_id": 71022029, "body": "Perhaps it would be better not to hardcode the address and store it in an environment variable instead, with different values in testing and production. Part III of the twelve-factor app Manifesto: <a href=\"https://12factor.net/config\" rel=\"nofollow noreferrer\">12factor.net/config</a>"}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1485691307, "post_id": 41920181, "comment_id": 71022164, "body": "@danidiaz that is exacly what I want. how can I instruct the ghc to read some options from a let&#39;s say yaml file and use it accordingly ? Is a yaml file standard in haskell ? you know, these kind of stuff I don&#39;t know."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1485691706, "post_id": 41920181, "comment_id": 71022270, "body": "The <code>aeson</code> package <a href=\"http://hackage.haskell.org/package/aeson\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/aeson</a> can be used to parse JSON. The <code>yaml</code> package uses the same in-memory representation as <code>aeson</code> and can read YAML files <a href=\"http://hackage.haskell.org/package/yaml-0.8.21.2/docs/Data-Yaml.html#v:decodeFile\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/yaml-0.8.21.2/docs/&hellip;</a>. You can also import <code>System.Environment</code> to read environment variables. <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/System-Environment.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.9.1.0/docs/&hellip;</a> See also the <code>configurator-ng</code> package <a href=\"https://hackage.haskell.org/package/configurator-ng\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/configurator-ng</a>"}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1485691872, "post_id": 41920181, "comment_id": 71022300, "body": "@danidiaz ok, I can read the config, how can I apply them? I run my tests with &#39;cabal test&#39;. how can I tell the program to use a different config when it is a test ?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1485692346, "post_id": 41920181, "comment_id": 71022408, "body": "According to <code>cabal test --help</code>, you can use <code>--test-option</code> to pass arguments to the test executable <a href=\"http://stackoverflow.com/questions/28902169/put-command-line-arguments-for-tests-in-cabal-file\" title=\"put command line arguments for tests in cabal file\">stackoverflow.com/questions/28902169/&hellip;</a> which you can then read using <code>getArgs</code> from <code>System.Environment</code>. The alternative <code>stack</code> tool will have similar options. I usually just use environment variables that I set using a wrapper .sh script, or from the command line itself."}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1485692565, "post_id": 41920181, "comment_id": 71022471, "body": "Thank you, but I think I need more info on this. I could not find anything useful on the internet and I don&#39;t want to re-invent the wheel. surely there are well-stablished methods and detailed description on how to use them!"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1485693099, "post_id": 41920181, "comment_id": 71022599, "body": "As an example, look at this test suite for a project of mine: <a href=\"https://github.com/danidiaz/users-mysql-haskell/tree/master/tests\" rel=\"nofollow noreferrer\">github.com/danidiaz/users-mysql-haskell/tree/master/tests</a> and the wrapper <code>.sh</code> file <a href=\"https://github.com/danidiaz/users-mysql-haskell/blob/master/tests.sh\" rel=\"nofollow noreferrer\">github.com/danidiaz/users-mysql-haskell/blob/master/tests.sh</a> The configuration is passed through environment variables here."}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1485693704, "post_id": 41920181, "comment_id": 71022765, "body": "OK, will look into it. thank you :)"}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1485694084, "post_id": 41920181, "comment_id": 71022864, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/134297/discussion-between-milad-zahedi-and-danidiaz\">continue this discussion in chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "edited": false, "score": 0, "creation_date": 1485699534, "post_id": 41921673, "comment_id": 71024366, "body": "one thing remains, how to make these configs available every where ?"}, {"owner": {"reputation": 71, "user_id": 6939062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c88cbf1754a2f7a346fe4d163e0028b?s=128&d=identicon&r=PG&f=1", "display_name": "J. Markiewicz", "link": "https://stackoverflow.com/users/6939062/j-markiewicz"}, "reply_to_user": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "edited": false, "score": 0, "creation_date": 1485699747, "post_id": 41921673, "comment_id": 71024423, "body": "You can read all data in main function and then just run functions that you&#39;re using in your program with additional params. Is it a good solution for you?"}, {"owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "edited": false, "score": 0, "creation_date": 1485700013, "post_id": 41921673, "comment_id": 71024485, "body": "not possible, I want these configs to be availabe every where for all functions and tests, I cannot run them all from the main."}], "tags": [], "owner": {"reputation": 71, "user_id": 6939062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c88cbf1754a2f7a346fe4d163e0028b?s=128&d=identicon&r=PG&f=1", "display_name": "J. Markiewicz", "link": "https://stackoverflow.com/users/6939062/j-markiewicz"}, "is_accepted": false, "score": 3, "last_activity_date": 1485698211, "creation_date": 1485698211, "answer_id": 41921673, "question_id": 41920181, "link": "https://stackoverflow.com/questions/41920181/haskell-automated-test-configuration/41921673#41921673", "title": "haskell automated test configuration", "body": "<p>So the concept is create file input.txt which looks like this:</p>\n\n<pre><code>fstParameterName:fstParameterValue\nsndParameterName:sndParameterValue\ntrdParameterName:trdParameterValue\n</code></pre>\n\n<p>Now inside main function you can easily set your params using construction like this:</p>\n\n<pre><code>main = do\ntext &lt;- readFile \"input.txt\"\nmongoHostAdress &lt;- (getConfigValue \"mongoHostAdress\" (lines text))\nprint(mongoHostAdress)\n\ngetConfigValue name (l:ls) = if(containsPrefix name l) \n  then (return(skipPrefix name l))\n  else (getConfigValue name ls)\n\ncontainsPrefix [] x = True\ncontainsPrefix (x:xs) (y:ys) = if(x==y) then (containsPrefix xs ys) else False\n\nskipPrefix [] (x:xs) = xs --x is just \":\" and ofc we dont want it\nskipPrefix (x:xs) (y:ys) = skipPrefix xs ys\n</code></pre>\n"}], "owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1485698211, "creation_date": 1485687947, "last_edit_date": 1485691650, "question_id": 41920181, "link": "https://stackoverflow.com/questions/41920181/haskell-automated-test-configuration", "title": "haskell automated test configuration", "body": "<p>I have set up a project and I want to write tests for it. Now the problem is my functions in production work with a database but in tests I want to direct them towards a fake database.</p>\n\n<p>for example I have the string <code>mongoHostAdress = \"192.168.0.1\"</code> which my functions use to access mongo database, and I when testing I want it to change to <code>mongoHostAdress = \"127.0.0.1\"</code>.</p>\n\n<p>how can I tell Haskell to automatically do this for me ?</p>\n\n<p><strong>Edit : more general outlook</strong> </p>\n\n<p>how can I create a config file for a project and use different params for different stages of the project?</p>\n"}, {"tags": ["haskell", "cabal", "cairo", "haskell-stack", "threadscope"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1485694265, "post_id": 41919686, "comment_id": 71022910, "body": "Can you try installing the development version of Stack (via <code>stack upgrade --git --source-only</code>)? There&#39;s support for the new <code>custom-setup</code> stuff in Cabal in the newest version. Also, <code>stack setup --upgrade-cabal</code> may help by providing the latest Cabal library, but is probably not necessary."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1485744448, "post_id": 41919686, "comment_id": 71037277, "body": "Thanks, @MichaelSnoyman.  Is there documentation for the new custom-setup stuff?  Googling only gave me github bug reports.  Also, the first error I got after executing <code>stack upgrade --git --source-only</code> was <code>Cabal file warning in &#47;tmp&#47;stack-upgrade25291&#47;stack&#47;stack.cabal: Ignoring unknown section type: custom-setup</code> which does not bode well."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1485746090, "post_id": 41919686, "comment_id": 71037633, "body": "@MichaelSnoyman, I installed with <code>stack upgrade --git --source-only</code> and still get the same errors in installing cairo, threadscope, and gtk2hs-buildtools."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1485778913, "post_id": 41919686, "comment_id": 71051786, "body": "This appears to be the official <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#custom-setup-scripts\" rel=\"nofollow noreferrer\">custom-setup documentation</a>. It&#39;s part of Cabal, not Stack. Regarding the Stack upgrade: can you confirm what <code>stack --version</code> now says?"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1485833884, "post_id": 41919686, "comment_id": 71078407, "body": "<code>$ stack --version Version 1.3.2, Git revision 3f675146590da4f3edf768b89355f798229da2a5 (4395 commits) x86_64 hpack-0.15.0</code> Huh. It did a bunch of installing when I ran that git command, but this is identical to the version I had beforehand."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1485835162, "post_id": 41919686, "comment_id": 71078720, "body": "I&#39;m gonna guess you don&#39;t have ~/.local/bin in your $PATH. You should have gotten a warning message about that during the upgrade. Can you try running <code>~&#47;.local&#47;bin&#47;stack --version</code>? And then try <code>~&#47;.local&#47;bin&#47;stack build cairo</code>?"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1485836215, "post_id": 41919686, "comment_id": 71078975, "body": "Ughhhh, I had /home/username/.cabal/bin/ on my path first... Completely, contravening your orders in:  <a href=\"https://docs.haskellstack.org/en/stable/install_and_upgrade/#upgrade\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/install_and_upgrade/#upgrade</a> and <a href=\"https://github.com/commercialhaskell/stack/issues/237#issuecomment-126793301\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/&hellip;</a> Thanks @MichaelSnoyman."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1485843180, "post_id": 41919686, "comment_id": 71081169, "body": "Awesome, glad it worked. I&#39;ll create an answer shortly."}], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1485833785, "post_id": 41935854, "comment_id": 71078384, "body": "<code>$ stack setup --upgrade-cabal Currently installed Cabal is 1.24.2.0, newest is 1.24.2.0. I&#39;m not upgrading Cabal.</code>"}], "tags": [], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "is_accepted": false, "score": 1, "last_activity_date": 1485840959, "last_edit_date": 1485840959, "creation_date": 1485778934, "answer_id": 41935854, "question_id": 41919686, "link": "https://stackoverflow.com/questions/41919686/stack-installing-cairo-for-threadscope/41935854#41935854", "title": "Stack installing cairo for threadscope", "body": "<p>I think this is the same problem I have <a href=\"https://github.com/gtk2hs/gtk2hs/issues/198\" rel=\"nofollow noreferrer\">recently</a></p>\n\n<p>Could you try</p>\n\n<p><code>stack setup --upgrade-cabal\n</code></p>\n\n<p>and see if it fix the problem.</p>\n\n<p><em>== Edit: ==</em></p>\n\n<p>However, to answer your first question, I can install threadscope via stack with following command,</p>\n\n<pre><code>$ stack --resolver=nightly install threadscope\nSelected resolver: nightly-2017-01-31\nCopying from /home/wizzup/.stack/global-project/.stack-work/install/x86_64-linux-ncurses6/nightly-2017-01-31/8.0.2/bin/threadscope to /home/wizzup/.local/bin/threadscope\n\nCopied executables to /home/wizzup/.local/bin/:\n- threadscope\n</code></pre>\n\n<p>but I am using Arch Linux.</p>\n"}, {"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1485843716, "creation_date": 1485843716, "answer_id": 41950938, "question_id": 41919686, "link": "https://stackoverflow.com/questions/41919686/stack-installing-cairo-for-threadscope/41950938#41950938", "title": "Stack installing cairo for threadscope", "body": "<p>In order to compile <code>cairo</code> successfully, you'll need support for the new <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#custom-setup-scripts\" rel=\"nofollow noreferrer\">custom-setup feature in Cabal 1.24</a>. The officially released Stack version does not support this yet, but support is available on <code>master</code>. In order to install it:</p>\n\n<ul>\n<li>Run <code>stack upgrade --git --source-only</code></li>\n<li>Ensure that the destination directory (usually <code>$HOME/.local/bin</code>) is on your <code>PATH</code></li>\n<li>To be extra sure, run <code>stack --version</code> and <code>which stack</code></li>\n</ul>\n\n<p>After this, <code>stack build cairo</code> should work.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 538, "favorite_count": 0, "accepted_answer_id": 41950938, "answer_count": 2, "score": 0, "last_activity_date": 1485843716, "creation_date": 1485684452, "last_edit_date": 1495542809, "question_id": 41919686, "link": "https://stackoverflow.com/questions/41919686/stack-installing-cairo-for-threadscope", "title": "Stack installing cairo for threadscope", "body": "<p>I started installing threadscope through stack (rather than cabal, is that OK? <a href=\"https://wiki.haskell.org/ThreadScope\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/ThreadScope</a>).  threadscope requires cairo.  </p>\n\n<pre><code>$ stack install cairo\ncairo-0.13.3.1: configure\n\n--  While building package cairo-0.13.3.1 using:\n      /home/username/.stack/programs/x86_64-linux/ghc-8.0.1/bin/ghc --make -odir /tmp/stack13291/cairo-0.13.3.1/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/setup -hidir /tmp/stack13291/cairo-0.13.3.1/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/setup -i -i. -package=Cabal-1.24.2.0 -clear-package-db -global-package-db -package-db=/home/username/.stack/snapshots/x86_64-linux/lts-7.10/8.0.1/pkgdb /tmp/stack13291/cairo-0.13.3.1/Setup.hs /home/username/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs -main-is StackSetupShim.mainOverride -o /tmp/stack13291/cairo-0.13.3.1/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/setup/setup -threaded\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/username/.stack/global-project/.stack-work/logs/cairo-0.13.3.1.log\n\n    [1 of 2] Compiling Main             ( /tmp/stack13291/cairo-0.13.3.1/Setup.hs, /tmp/stack13291/cairo-0.13.3.1/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/setup/Main.o )\n\n    /tmp/stack13291/cairo-0.13.3.1/Setup.hs:8:29: error:\n        \u2022 Couldn't match expected type \u2018Distribution.Simple.UserHooks.UserHooks\u2019\n                      with actual type \u2018Cabal-1.24.1.0:Distribution.Simple.UserHooks.UserHooks\u2019\n          NB: \u2018Cabal-1.24.1.0:Distribution.Simple.UserHooks.UserHooks\u2019\n                is defined in \u2018Distribution.Simple.UserHooks\u2019\n                    in package \u2018Cabal-1.24.1.0\u2019\n              \u2018Distribution.Simple.UserHooks.UserHooks\u2019\n                is defined in \u2018Distribution.Simple.UserHooks\u2019\n                    in package \u2018Cabal-1.24.2.0\u2019\n        \u2022 In the first argument of \u2018defaultMainWithHooks\u2019, namely\n            \u2018gtk2hsUserHooks\u2019\n          In the expression: defaultMainWithHooks gtk2hsUserHooks\n          In an equation for \u2018main\u2019:\n              main = defaultMainWithHooks gtk2hsUserHooks\n</code></pre>\n\n<p>And chasing further, I tried to install gtk build tools:</p>\n\n<pre><code>$ stack install gtk2hs-buildtools\nCopying from /home/username/.stack/snapshots/x86_64-linux/lts-7.10/8.0.1/bin/gtk2hsC2hs to /home/username/.local/bin/gtk2hsC2hs\nCopying from /home/username/.stack/snapshots/x86_64-linux/lts-7.10/8.0.1/bin/gtk2hsHookGenerator to /home/username/.local/bin/gtk2hsHookGenerator\nCopying from /home/username/.stack/snapshots/x86_64-linux/lts-7.10/8.0.1/bin/gtk2hsTypeGen to /home/username/.local/bin/gtk2hsTypeGen\n\nCopied executables to /home/username/.local/bin:\n- gtk2hsC2hs\n- gtk2hsHookGenerator\n- gtk2hsTypeGen\n</code></pre>\n\n<p>I kept getting the same error for cairo installation.  I'm running Ubuntu 14.04 and do have <code>libcairo2-dev</code> installed:</p>\n\n<pre><code>$ stack install threadscope\nglib-0.13.4.1: configure\ncairo-0.13.3.1: configure\nProgress: 2/6\n--  While building package cairo-0.13.3.1 using:\n      /home/username/.stack/programs/x86_64-linux/ghc-8.0.1/bin/ghc --make -odir /tmp/stack20456/cairo-0.13.3.1/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/setup -hidir /tmp/stack20456/cairo-0.13.3.1/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/setup -i -i. -package=Cabal-1.24.2.0 -clear-package-db -global-package-db -package-db=/home/username/.stack/snapshots/x86_64-linux/lts-7.10/8.0.1/pkgdb /tmp/stack20456/cairo-0.13.3.1/Setup.hs /home/username/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs -main-is StackSetupShim.mainOverride -o /tmp/stack20456/cairo-0.13.3.1/.stack-work/dist/x86_64-linux/Cabal-1.24.2.0/setup/setup -threaded\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>Stack version:</p>\n\n<pre><code>$ stack --version\nVersion 1.3.2, Git revision 3f675146590da4f3edf768b89355f798229da2a5 (4395 commits) x86_64 hpack-0.15.0\n</code></pre>\n\n<p>Cabal version:</p>\n\n<pre><code>$ stack exec cabal -- --version\ncabal-install version 1.24.0.1\ncompiled using version 1.24.1.0 of the Cabal library \n</code></pre>\n\n<p>Other versions:</p>\n\n<pre><code>$ sudo apt-get install libgtk2.0-dev libpango1.0-dev libglib2.0-dev libcairo2-dev libghc-gtk-dev\nReading package lists... Done\nBuilding dependency tree       \nReading state information... Done\nlibcairo2-dev is already the newest version.\nlibglib2.0-dev is already the newest version.\nlibglib2.0-dev set to manually installed.\nlibgtk2.0-dev is already the newest version.\nlibgtk2.0-dev set to manually installed.\nlibpango1.0-dev is already the newest version.\nlibpango1.0-dev set to manually installed.\nlibghc-gtk-dev is already the newest version.\n0 upgraded, 0 newly installed, 0 to remove\n</code></pre>\n\n<p>The reason I raise this here rather than superuser or ubuntu is that this error:</p>\n\n<pre><code>  \u2022 Couldn't match expected type \u2018Distribution.Simple.UserHooks.UserHooks\u2019\n                  with actual type \u2018Cabal-1.24.1.0:Distribution.Simple.UserHooks.UserHooks\u2019\n</code></pre>\n\n<p>Does seem to suggest there's something funky with the Haskell package code itself expecting this to be within a module that is somehow one level deeper, inside the cabal-*:, right?</p>\n\n<p>Other references that haven't cleared it up:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/40659148/building-project-dependent-on-gtk2hs-fails-on-lts-7-8-and-later\">Building project dependent on gtk2hs fails on lts-7.8 and later</a></li>\n<li><a href=\"https://github.com/commercialhaskell/stack/issues/2924\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/2924</a></li>\n<li><a href=\"https://github.com/commercialhaskell/stack/issues/2230\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/2230</a></li>\n<li><a href=\"https://github.com/commercialhaskell/stack/issues/2795\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/2795</a></li>\n<li><a href=\"https://stackoverflow.com/questions/27240733/missing-dependencies-for-chart-cairo-on-linux-mint-17\">Missing dependencies for chart-cairo on linux mint 17</a></li>\n</ul>\n"}, {"tags": ["haskell", "types", "typeclass", "functor", "bifunctor"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1485660694, "post_id": 41917301, "comment_id": 71015948, "body": "You can&#39;t, at least not directly. You could make a <code>newtype</code> wrapper for <code>Either</code>."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 6, "last_activity_date": 1485661244, "creation_date": 1485661244, "answer_id": 41917388, "question_id": 41917301, "link": "https://stackoverflow.com/questions/41917301/instance-declaration-with-type-variables/41917388#41917388", "title": "Instance declaration with type variables", "body": "<p>You can't, and you shouldn't. If you could do this, it would make it a lot tougher to know whether <code>fmap (+1) (Left 1)</code> should be <code>Left 1</code> or <code>Left 2</code>.</p>\n\n<h1><code>Bifunctor</code></h1>\n\n<p>That said, the abstraction you are looking for (something which can be mapped over on either side) exists and is called a <a href=\"https://hackage.haskell.org/package/bifunctors-3.2.0.1/docs/Data-Bifunctor.html\" rel=\"noreferrer\"><code>Bifunctor</code></a>. Then, depending on whether you want to map over the <code>Left</code>s or the <code>Right</code>s, you use <code>first</code> or <code>second</code>:</p>\n\n<pre><code>ghci&gt; first (+1) (Left 1)\nLeft 2\nghci&gt; second (+1) (Left 1)\nLeft 1\nghci&gt; first (+1) (Right 1)\nRight 1\nghci&gt; second (+1) (Right 1)\nRight 2\n</code></pre>\n\n<h1><code>Flip</code></h1>\n\n<p>Alternately, if you want to stick to <code>fmap</code> only and not be bothered with <code>first</code> and <code>second</code>, you can wrap your data type in the <a href=\"https://hackage.haskell.org/package/bifunctors-5.4.1/docs/Data-Bifunctor-Flip.html\" rel=\"noreferrer\"><code>Flip</code></a> newtype, which has the effect of looking for the functor instance of the second type variable. You still rely on the fact that <code>Either</code> is a <code>Bifunctor</code>, but you avoid <code>first</code> and <code>second</code>:</p>\n\n<pre><code>ghci&gt; fmap (+1) (Flip (Left 1))\nFlip (Left 2)\nghci&gt; fmap (+1) (Left 1)\nLeft 1\nghci&gt; fmap (+1) (Flip (Right 1))\nFlip (Right 2)\nghci&gt; fmap (+1) (Right 1)\nRight 1\n</code></pre>\n"}], "owner": {"reputation": 103, "user_id": 4663577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad45ec95c0369c3f849fd81f66e2984e?s=128&d=identicon&r=PG&f=1", "display_name": "Pireax", "link": "https://stackoverflow.com/users/4663577/pireax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1485740399, "creation_date": 1485660060, "last_edit_date": 1485740399, "question_id": 41917301, "link": "https://stackoverflow.com/questions/41917301/instance-declaration-with-type-variables", "title": "Instance declaration with type variables", "body": "<p>Writing something like this works fine:</p>\n\n<pre><code>data Either a b = Left a | Right b\n\ninstance Functor (Either a) where\n    fmap _ (Left x) = Left x\n    fmap f (Right x) = Right (f x)\n</code></pre>\n\n<p>Now lets say I want to invert this, Left applies f to value:</p>\n\n<pre><code>instance Functor (Either a) where\n    fmap _ (Right x) = Right x\n    fmap f (Left x) = Left (f x)\n</code></pre>\n\n<p>This doesn't compile, I suppose I need to have something like <code>Functor (Either _ b)</code>, how do I do this?</p>\n"}, {"tags": ["list", "haskell", "ghc"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1485659029, "post_id": 41917056, "comment_id": 71015716, "body": "Would <code>indexify = let f !i x = (i + 1, (i, x)) in snd . mapAccumL f 0</code> work? I believe <code>mapAccumL</code> is subject to fusion."}, {"owner": {"reputation": 369, "user_id": 3577289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f1787220565591f5ecb6aba686abb6?s=128&d=identicon&r=PG&f=1", "display_name": "gksato", "link": "https://stackoverflow.com/users/3577289/gksato"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485659606, "post_id": 41917056, "comment_id": 71015785, "body": "@Alec I was about to turn your comment into an answer and accept it, but it doesn&#39;t work. <code>mapAccumL</code> is defined in term of <code>traverse = mapM</code>, and it fuses in &quot;consumption&quot; direction (i.e. it uses <code>foldr</code>), but it doesn&#39;t fuse in &quot;production&quot; direction (i.e. it doesn&#39;t use <code>build</code>)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485659709, "post_id": 41917056, "comment_id": 71015799, "body": "Ah. Good point. Should&#39;ve thought about that. Still slightly better than <code>zip</code>. :)"}, {"owner": {"reputation": 369, "user_id": 3577289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f1787220565591f5ecb6aba686abb6?s=128&d=identicon&r=PG&f=1", "display_name": "gksato", "link": "https://stackoverflow.com/users/3577289/gksato"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485659884, "post_id": 41917056, "comment_id": 71015830, "body": "Yes, it&#39;s something to be pointed out: it&#39;s better than <code>zip</code>. Thank you."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1485660244, "post_id": 41917056, "comment_id": 71015881, "body": "I wonder if <code>mapAccumL</code> could be made to fuse in both directions. David Feuer is the expert on that."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1485660287, "post_id": 41917056, "comment_id": 71015889, "body": "Also see <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9495\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/9495</a> for some background."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1485660406, "post_id": 41917056, "comment_id": 71015904, "body": "I think <a href=\"https://www.stackage.org/haddock/lts-7.17/ilist-0.2.0.0/Data-List-Index.html#v:indexed\" rel=\"nofollow noreferrer\">this</a> should more or less answer your question. TL;DR: there doesn&#39;t seem to be a simpler implementation, you can import <code>build</code> from <code>GHC.Exts</code>."}, {"owner": {"reputation": 369, "user_id": 3577289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f1787220565591f5ecb6aba686abb6?s=128&d=identicon&r=PG&f=1", "display_name": "gksato", "link": "https://stackoverflow.com/users/3577289/gksato"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1485661576, "post_id": 41917056, "comment_id": 71016078, "body": "@JoachimBreitner My feeling is... &quot;If we were happy to throw away the final accumlated value, we could do the trick.&quot; For the background, it is the first time to see the talk page (though I&#39;ve read the background in the code). Thank you for reference."}, {"owner": {"reputation": 369, "user_id": 3577289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f1787220565591f5ecb6aba686abb6?s=128&d=identicon&r=PG&f=1", "display_name": "gksato", "link": "https://stackoverflow.com/users/3577289/gksato"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485661850, "post_id": 41917056, "comment_id": 71016121, "body": "@Alec Oh, it&#39;s done already. Thank you for pointing out. Would you like to make it an answer yourself? If not, shall I do it for you?"}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 6, "last_activity_date": 1485662324, "creation_date": 1485662324, "answer_id": 41917472, "question_id": 41917056, "link": "https://stackoverflow.com/questions/41917056/haskell-how-to-make-foldr-build-fusion-happen-in-zip-0/41917472#41917472", "title": "Haskell: How to make foldr/build fusion happen in (zip [0..])?", "body": "<p>This already exists in the <a href=\"https://www.stackage.org/lts-7.17/package/ilist-0.2.0.0\"><code>ilist</code></a> package, as <a href=\"https://www.stackage.org/haddock/lts-7.17/ilist-0.2.0.0/Data-List-Index.html#v:indexed\"><code>indexed</code></a>. The relevant source code snippets are </p>\n\n<pre><code>import GHC.Exts  -- exports `build`\n\nindexed :: [a] -&gt; [(Int, a)]\nindexed xs = go 0# xs\n  where\n    go i (a:as) = (I# i, a) : go (i +# 1#) as\n    go _ _ = []\n{-# NOINLINE [1] indexed #-}\n\nindexedFB :: ((Int, a) -&gt; t -&gt; t) -&gt; a -&gt; (Int# -&gt; t) -&gt; Int# -&gt; t\nindexedFB c = \\x cont i -&gt; (I# i, x) `c` cont (i +# 1#)\n{-# INLINE [0] indexedFB #-}\n\n{-# RULES\n\"indexed\"       [~1] forall xs.    indexed xs = build (\\c n -&gt; foldr (indexedFB c) (\\_ -&gt; n) xs 0#)\n\"indexedList\"   [1]  forall xs.    foldr (indexedFB (:)) (\\_ -&gt; []) xs 0# = indexed xs\n  #-}\n</code></pre>\n\n<p>As you'll probably notice, the rewrite rule makes use of pretty much the same definition you have, so that probably is the best way to do it. Also, <code>GHC.Exts</code> also exports <code>build</code>, so you don't need to import <code>GHC.Prim</code>.</p>\n"}], "owner": {"reputation": 369, "user_id": 3577289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f1787220565591f5ecb6aba686abb6?s=128&d=identicon&r=PG&f=1", "display_name": "gksato", "link": "https://stackoverflow.com/users/3577289/gksato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 1, "accepted_answer_id": 41917472, "answer_count": 1, "score": 10, "last_activity_date": 1486418566, "creation_date": 1485656788, "last_edit_date": 1486418566, "question_id": 41917056, "link": "https://stackoverflow.com/questions/41917056/haskell-how-to-make-foldr-build-fusion-happen-in-zip-0", "title": "Haskell: How to make foldr/build fusion happen in (zip [0..])?", "body": "<p>In Haskell, we can use this useful idiom to get from a list that of indexed elements in it:</p>\n\n<pre><code>indexify :: (Num i) =&gt; [a] -&gt; [(i,a)]\nindexify = zip [0..]\n</code></pre>\n\n<p>However, according to the implementation of <code>zip</code> in <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.List.html#zip\" rel=\"nofollow noreferrer\"><code>GHC.List</code> as of <code>base-4.9.1.0</code></a>, this will not completely perform list fusion, i.e. this will not actually generate the list [0..], but the argument list to <code>indexify</code> will be constructed.</p>\n\n<p>Of course, there is a definition that allows appropriate list fusion:</p>\n\n<pre><code>indexify' :: (Num i) =&gt; [a] -&gt; [(i,a)]\nindexify' xs = build $ \\c n -&gt;\n                foldr (\\x r !i -&gt; (i,x) `c` r (i+1)) (const n) xs 0\n</code></pre>\n\n<p>Do we need to <code>import GHC.Prim (build)</code> to do this? Or is there another implementation that simplifies to <code>indexify'</code>?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 2, "last_activity_date": 1485650516, "creation_date": 1485650516, "answer_id": 41916482, "question_id": 41916433, "link": "https://stackoverflow.com/questions/41916433/haskell-working-with-errors-exceptions-in-haskell/41916482#41916482", "title": "Haskell: Working with errors/exceptions in Haskell", "body": "<blockquote>\n  <p>With the other function <code>insertEnv</code> you can insert elements to <code>Env</code>. But therefore you need to check if <code>Env</code> is empty.</p>\n</blockquote>\n\n<p>Why do you need to check if an environment is empty before you insert something into it? An environment containing the variable <code>x</code> is just a function that, if given the name <code>x</code>, returns the value to which <code>x</code> was bound.</p>\n\n<pre><code>insertEnv s loc env = \\v -&gt; if v == s then loc else env v\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1485654480, "post_id": 41916498, "comment_id": 71014971, "body": "Thanks adamse. Quickly off-topic. Now I tried it just with <code>emptyEnv = \\_-&gt;(-1)</code> and <code>insert s loc env = \\inp -&gt;(if inp==s then loc else env s)</code> but now when I do this <code>env = insert &quot;x&quot; 42 (insert &quot;y&quot; 17 emptyEnv)</code> and then <code>env &quot;y&quot;</code> it gives me -1 so the vale of an empty Env. Whats going on there? It worked 5 minutes ago!?"}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1485654824, "post_id": 41916498, "comment_id": 71015046, "body": "You want <code>... else env inp</code>."}], "tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": false, "score": 3, "last_activity_date": 1485653430, "last_edit_date": 1485653430, "creation_date": 1485650703, "answer_id": 41916498, "question_id": 41916433, "link": "https://stackoverflow.com/questions/41916433/haskell-working-with-errors-exceptions-in-haskell/41916498#41916498", "title": "Haskell: Working with errors/exceptions in Haskell", "body": "<p>We usually handle failing functions in Haskell by them returning a <code>Maybe</code> type:</p>\n\n<pre><code>type Loc = Int\ntype Env = String -&gt; Maybe Loc -- Here\n\nemptyEnv :: Env\nemptyEnv _ = Nothing\n</code></pre>\n\n<p>And for <code>insertEnv</code> we would write:</p>\n\n<pre><code>insertEnv :: String -&gt; Loc -&gt; Env -&gt; Env\ninsertEnv s loc env inp =\n  case env inp of\n    Nothing -&gt;\n      if s == inp\n        then Just loc\n        else Nothing\n    Just loc' -&gt; Just loc'\n</code></pre>\n\n<p>Which follows your intended meaning by not making an insert update the <code>Env</code>. Another possibility for <code>insertEnv</code> is to \"update\" the environment:</p>\n\n<pre><code>insertEnv' :: String -&gt; Loc -&gt; Env -&gt; Env\ninsertEnv' key loc env inKey\n  | key == inKey = Just loc\n  | otherwise = env inKey\n</code></pre>\n\n<hr>\n\n<p>If you're interested, both versions can be implemented using the <a href=\"https://www.stackage.org/haddock/lts-7.15/base-4.9.0.0/Data-Monoid.html#t:First\" rel=\"nofollow noreferrer\"><code>First</code></a> and <a href=\"https://www.stackage.org/haddock/lts-7.15/base-4.9.0.0/Data-Monoid.html#t:Last\" rel=\"nofollow noreferrer\"><code>Last</code></a> wrappers from <code>Data.Monoid</code>.</p>\n\n<pre><code>import Data.Monoid\n\ntype Env' = String -&gt; First Loc -- Choose First or Last here\n\nemptyEnv' :: Env'\nemptyEnv' _ = mempty\n\ninsertEnv' :: String -&gt; Loc -&gt; Env' -&gt; Env'\ninsertEnv' s loc env inp =\n  env inp &lt;&gt;\n  if s == inp\n    then pure loc\n    else mempty\n</code></pre>\n\n<p>With some environment </p>\n\n<pre><code>env1 = insertEnv' \"1\" 2 (insertEnv' \"1\" 1 emptyEnv')\n</code></pre>\n\n<p>If you pick <code>First</code> with the above implementation you get</p>\n\n<pre><code>GHCI&gt; env1 \"1\"\nFirst {getFirst = Just 1}\n</code></pre>\n\n<p>or with <code>Last</code></p>\n\n<pre><code>GHCI&gt; env1 \"1\"\nLast {getLast = Just 2}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1485653430, "creation_date": 1485650065, "question_id": 41916433, "link": "https://stackoverflow.com/questions/41916433/haskell-working-with-errors-exceptions-in-haskell", "title": "Haskell: Working with errors/exceptions in Haskell", "body": "<p>He guys, I have a problem. I have two functions in my Haskell program. </p>\n\n<pre><code>type Env =  String -&gt; Int\n\nemptyEnv :: Env\nemptyEnv _ = error \"Failed\"\n\ninsertEnv :: String -&gt; Loc -&gt; Env -&gt; Env\ninsertEnv s loc env = case env s of\n                      (error \"Failed\") -&gt; (\\inp -&gt; (if inp==s then loc else env s))\n                      _ -&gt; env\n</code></pre>\n\n<p>So my emptyEnv should always give an error message. With the other function insertEnv you can insert elements to Env. But therefore you need to check if Env is empty and this will display an error on screen. Now my question: The code above doesn't work because error \"Failed\" is not a case of env s in the function insertEnv. Do you have an idea how I handle the error properly so that you can insert elements to env?</p>\n"}, {"tags": ["haskell", "haskell-stack", "threadscope"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1485650776, "post_id": 41916409, "comment_id": 71014344, "body": "<code>.&#47;mycoolprogram arg1 arg2 +RTS -N2 -l </code> or <code>.&#47;mycoolprogram +RTS -N2 -l -RTS arg1 arg2</code> should work."}], "answers": [{"tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": true, "score": 2, "last_activity_date": 1485657246, "creation_date": 1485657246, "answer_id": 41917087, "question_id": 41916409, "link": "https://stackoverflow.com/questions/41916409/profiling-with-threadscope-with-command-line-arguments-in-haskell/41917087#41917087", "title": "Profiling with ThreadScope with command line arguments in Haskell", "body": "<p>As @sjakobi said you can use the <code>+RTS ... -RTS other arguments</code> or <code>other arguments +RTS ...</code> forms but there is also the option to pass them in an environment variable <code>GHCRTS</code>:</p>\n\n<pre><code>GHCRTS='-N2 -l' ./mycoolprogram arg1 arg2\n</code></pre>\n\n<p>Lost of more info is available in the <a href=\"http://downloads.haskell.org/~ghc/master/users-guide/runtime_control.html#setting-rts-options\" rel=\"nofollow noreferrer\">GHC users guide</a>.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "accepted_answer_id": 41917087, "answer_count": 1, "score": 0, "last_activity_date": 1485657246, "creation_date": 1485649830, "last_edit_date": 1495539931, "question_id": 41916409, "link": "https://stackoverflow.com/questions/41916409/profiling-with-threadscope-with-command-line-arguments-in-haskell", "title": "Profiling with ThreadScope with command line arguments in Haskell", "body": "<p>I understand from <a href=\"https://wiki.haskell.org/ThreadScope#Using_ThreadScope\" rel=\"nofollow noreferrer\">here</a> that to use ThreadScope I need to compile with an eventlog and rtsoptions, eg \"<code>-rtsopts -eventlog -threaded</code>\"</p>\n\n<p>I am using Stack, so my compilation call looks like:</p>\n\n<pre><code>$ stack ghc -- -O2 -funfolding-use-threshold=16 -optc-O3 -rtsopts -eventlog -threaded mycoolprogram.hs\n</code></pre>\n\n<p>Whereas normally, I do:</p>\n\n<pre><code>$ stack ghc -- -O2 -funfolding-use-threshold=16 -optc-O3 -threaded mycoolprogram.hs\n</code></pre>\n\n<p>This compiles fine.  However, my program takes 2 and only 2 positional arguments:</p>\n\n<pre><code>./mycoolprogram arg1 arg2\n</code></pre>\n\n<p>I'm trying to add the RTS options <code>+RTS -N2 -l</code>, like so:</p>\n\n<pre><code>./mycoolprogram arg1 arg2 -- +RTS -N2 -l \n</code></pre>\n\n<p>Or</p>\n\n<pre><code>./mycoolprogram +RTS -N2 -l -- arg1 arg2\n</code></pre>\n\n<p>How can I simultaneously run my program with arguments going into <code>System.Environment.getArgs</code> (like eg <a href=\"https://stackoverflow.com/questions/41913695/simple-type-error-on-parsing-the-result-of-getargs\">here</a>) and also include these profiling flags?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 447, "user_id": 2812201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a5900e009117b30b90fb5bce64d6fd8e?s=128&d=identicon&r=PG&f=1", "display_name": "user2812201", "link": "https://stackoverflow.com/users/2812201/user2812201"}, "edited": false, "score": 0, "creation_date": 1485749808, "post_id": 41915656, "comment_id": 71038348, "body": "thanks! What a catch. The lazy ones work harder. Also I had to change to hSetBuffering to &quot;NoBuffering&quot; for my program to work properly."}], "tags": [], "owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "is_accepted": true, "score": 4, "last_activity_date": 1485646613, "last_edit_date": 1485646613, "creation_date": 1485643259, "answer_id": 41915656, "question_id": 41915463, "link": "https://stackoverflow.com/questions/41915463/really-weird-issue-with-bytestring-socket/41915656#41915656", "title": "Really weird issue with ByteString socket", "body": "<p>I would guess that it has to do with the differing behavior of the two <code>hGetContents</code> functions in question (the lazy version vs the strict version). </p>\n\n<p><a href=\"https://www.stackage.org/haddock/lts-7.17/bytestring-0.10.8.1/Data-ByteString.html#v:hGetContents\" rel=\"nofollow noreferrer\">The strict version</a> \"reads a handle's entire contents strictly into a ByteString.\" But you're trying to read from a stream, so the <code>EOF</code> is never encountered.</p>\n\n<p>Compare with the behavior of <a href=\"https://www.stackage.org/haddock/lts-7.17/bytestring-0.10.8.1/Data-ByteString-Lazy.html#v:hGetContents\" rel=\"nofollow noreferrer\">the lazy version</a>:</p>\n\n<blockquote>\n  <p>Read entire handle contents <em>lazily</em> into a <code>ByteString</code>. Chunks are read on demand, using the default chunk size.</p>\n  \n  <p>Once EOF is encountered, the Handle is closed.</p>\n</blockquote>\n"}], "owner": {"reputation": 447, "user_id": 2812201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a5900e009117b30b90fb5bce64d6fd8e?s=128&d=identicon&r=PG&f=1", "display_name": "user2812201", "link": "https://stackoverflow.com/users/2812201/user2812201"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 41915656, "answer_count": 1, "score": 1, "last_activity_date": 1485646613, "creation_date": 1485641910, "last_edit_date": 1485645898, "question_id": 41915463, "link": "https://stackoverflow.com/questions/41915463/really-weird-issue-with-bytestring-socket", "title": "Really weird issue with ByteString socket", "body": "<p>I had a weird problem with <code>ByteString</code> socket programming. I have minimized the issue to the following short scripts:</p>\n\n<pre><code>-- ByteString.hs\n{-# LANGUAGE OverloadedStrings #-}\nimport Network.Socket hiding (send, sendTo, recv, recvFrom)\nimport Network.Socket.ByteString\nimport Network.BSD\nimport System.IO\nimport qualified Data.ByteString as BS\nimport qualified Data.ByteString.Char8 as C8\n\nconnectMud :: HostName\n           -&gt; String\n           -&gt; IO Handle\nconnectMud hostname port = do\n          addrinfos &lt;- getAddrInfo Nothing (Just hostname) (Just port)\n          let serveraddr = head addrinfos\n          sock &lt;- socket (addrFamily serveraddr) Stream defaultProtocol\n          setSocketOption sock KeepAlive 1\n          connect sock (addrAddress serveraddr)\n          h &lt;- socketToHandle sock ReadWriteMode\n          hSetBuffering h (BlockBuffering Nothing)\n          return  h\n\nmain:: IO ()\nmain =\n     C8.putStrLn \"connecting, please wait\" &gt;&gt; connectMud \"aardwolf.org\" \"4000\"\n     &gt;&gt;= BS.hGetContents &gt;&gt;= C8.putStrLn\n</code></pre>\n\n<p>and</p>\n\n<pre><code>--ByteString_Lazy.hs\n{-# LANGUAGE OverloadedStrings #-}\nimport Network.Socket hiding (send, sendTo, recv, recvFrom)\nimport Network.Socket.ByteString\nimport Network.BSD\nimport System.IO\nimport qualified Data.ByteString.Lazy as BS\nimport qualified Data.ByteString.Lazy.Char8 as C8\n\nconnectMud :: HostName\n           -&gt; String\n           -&gt; IO Handle\nconnectMud hostname port = do\n          addrinfos &lt;- getAddrInfo Nothing (Just hostname) (Just port)\n          let serveraddr = head addrinfos\n          sock &lt;- socket (addrFamily serveraddr) Stream defaultProtocol\n          setSocketOption sock KeepAlive 1\n          connect sock (addrAddress serveraddr)\n          h &lt;- socketToHandle sock ReadWriteMode\n          hSetBuffering h (BlockBuffering Nothing)\n          return  h\n\nmain:: IO ()\nmain =\n     C8.putStrLn \"connecting, please wait\" &gt;&gt; connectMud \"aardwolf.org\" \"4000\"\n     &gt;&gt;= BS.hGetContents &gt;&gt;= C8.putStrLn\n</code></pre>\n\n<p>The only difference between these two short scripts is that one is using <code>Data.ByteString</code> and the other one <code>Data.ByteString.Lazy</code>. The lazy version works fine but the strict version does not seem to receive any output at all. Any thoughts?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485632361, "post_id": 41913975, "comment_id": 71009298, "body": "Shouldn&#39;t encode then work on a <code>Char</code> instead of a <code>String</code>?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1485632513, "post_id": 41913975, "comment_id": 71009332, "body": "I voted to close since there is no question and no error is presented."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1485633226, "post_id": 41913975, "comment_id": 71009600, "body": "The capitalised &quot;The&quot; in the middle of your first sentence looks suspiciously like the beginning of an assignment copied and pasted verbatim..."}], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 6917467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d2aa2193b4faf2f3a08b1faa9ec4aea?s=128&d=identicon&r=PG&f=1", "display_name": "Yassine Boutabia", "link": "https://stackoverflow.com/users/6917467/yassine-boutabia"}, "edited": false, "score": 1, "creation_date": 1485633485, "post_id": 41914073, "comment_id": 71009708, "body": "Thansk @willem. you are a brilliant. I missed the fact that I could use char from the begining."}, {"owner": {"reputation": 109, "user_id": 6917467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d2aa2193b4faf2f3a08b1faa9ec4aea?s=128&d=identicon&r=PG&f=1", "display_name": "Yassine Boutabia", "link": "https://stackoverflow.com/users/6917467/yassine-boutabia"}, "edited": false, "score": 0, "creation_date": 1485634621, "post_id": 41914073, "comment_id": 71010077, "body": "There is sth that I don&#39;t understand though. encode and cipher should take two parameter but in the code you worte only one parameter!! @Willem"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 109, "user_id": 6917467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d2aa2193b4faf2f3a08b1faa9ec4aea?s=128&d=identicon&r=PG&f=1", "display_name": "Yassine Boutabia", "link": "https://stackoverflow.com/users/6917467/yassine-boutabia"}, "edited": false, "score": 0, "creation_date": 1485634704, "post_id": 41914073, "comment_id": 71010105, "body": "That is because if <code>f x y = g x y</code> can be rewritten in haskell as <code>f x = g x</code>. You thus add the parameter both to the left and right implicitly so to speak."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 109, "user_id": 6917467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d2aa2193b4faf2f3a08b1faa9ec4aea?s=128&d=identicon&r=PG&f=1", "display_name": "Yassine Boutabia", "link": "https://stackoverflow.com/users/6917467/yassine-boutabia"}, "edited": false, "score": 0, "creation_date": 1485634743, "post_id": 41914073, "comment_id": 71010117, "body": "@YassineBoutabia: it is called <a href=\"https://wiki.haskell.org/Eta_conversion\" rel=\"nofollow noreferrer\"><i>eta-reduction / eta-conversion</i></a>."}, {"owner": {"reputation": 109, "user_id": 6917467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d2aa2193b4faf2f3a08b1faa9ec4aea?s=128&d=identicon&r=PG&f=1", "display_name": "Yassine Boutabia", "link": "https://stackoverflow.com/users/6917467/yassine-boutabia"}, "edited": false, "score": 0, "creation_date": 1485637867, "post_id": 41914073, "comment_id": 71011048, "body": "Thank you for your time and the clarification"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 1, "last_activity_date": 1485632966, "last_edit_date": 1485632966, "creation_date": 1485632647, "answer_id": 41914073, "question_id": 41913975, "link": "https://stackoverflow.com/questions/41913975/caesars-cipher-with-a-list-of-integers/41914073#41914073", "title": "Caesar&#39;s cipher with a list of integers", "body": "<p>Based on your problem statement, I think the <code>encode</code> function itself should operate on <code>Char</code> and not on <code>String</code>. You can thus adapt this to:</p>\n\n<pre><code>encode :: Int -&gt; Char -&gt; Char\nencode shift = chr . (+ shift) . ord\n</code></pre>\n\n<p>Next you can simply use <code>zipWith</code> and <code>cycle</code> to construct the string:</p>\n\n<pre><code>cipher :: [Int] -&gt; String -&gt; String\ncipher shifts = zipWith encode $ cycle shifts\n</code></pre>\n\n<p>When implementing these, I get:</p>\n\n<pre><code>*Main&gt; cipher [1,2,4] \"HelloWorld\"\n\"Igpmq[ptpe\"\n</code></pre>\n\n<p>in <code>ghci</code>.</p>\n\n<p>In case you want to write the recursion yourself, you could do this as follows:</p>\n\n<pre><code>cipher :: [Int] -&gt; String -&gt; String\ncipher shifts = cipher2 shifts shifts\n</code></pre>\n\n<p>and </p>\n\n<pre><code>cipher2 :: [Int] -&gt; [Int] -&gt; String -&gt; String\ncipher2 _ _      []     = []\ncipher2 s []     ts     = cipher2 s s ts\ncipher2 s (x:xs) (t:ts) = (encode x t):cipher2 s xs ts\n</code></pre>\n\n<p>You thus pass <code>cipher</code> to <code>cipher2</code> and <code>cipher2</code> has a first argument which is the entire sequence of shifts (such that it can restart when running out of shifts). Furthermore in case the string has reached its end, we return an empty list (string). Otherwise we simply call <code>encode</code> on the heads of both the string and the shift-list and call <code>cipther2</code> recursively on the tails.</p>\n\n<p>Finally there is a semantical issue: it is possible that for instance you provide <code>z</code> to the <code>encode</code> function. If you shift it, it will thus run out of the alphanumerical range which may not what you want. In that case you should probably use modulo.</p>\n"}], "owner": {"reputation": 109, "user_id": 6917467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d2aa2193b4faf2f3a08b1faa9ec4aea?s=128&d=identicon&r=PG&f=1", "display_name": "Yassine Boutabia", "link": "https://stackoverflow.com/users/6917467/yassine-boutabia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 0, "accepted_answer_id": 41914073, "answer_count": 1, "score": 0, "last_activity_date": 1485633188, "creation_date": 1485632109, "last_edit_date": 1485633188, "question_id": 41913975, "link": "https://stackoverflow.com/questions/41913975/caesars-cipher-with-a-list-of-integers", "title": "Caesar&#39;s cipher with a list of integers", "body": "<p>I still new in Haskell and I'm trying to write a function such that The input parameter for the cipher is a list of integers, instead of just one integer. The first character is ciphered using the first integer as the parameter, the second character with the second integer, etc. If you run out of integers, you start using them from the start. </p>\n\n<p>this is what I got so far:</p>\n\n<pre><code>import Data.Char\n\n--encode is for encoding one character with one interger\nencode :: Int -&gt; String -&gt; String  \nencode shift msg = \n    let ords = map ord msg  \n        shifted = map (+ shift) ords  \n    in  map chr shifted\n\n-- this is the troubling part, I try to use head to send the first element of string and the first element of intgers' list\ncipher :: [Int] -&gt; String -&gt; String\ncipher x str =\n    let splitedstr= (head str)\n        splitedint= (head x) -- parse error on input splitedint\n    in encode splitedint splitedstr ++ cipher x str\n</code></pre>\n\n<p>thanks for your help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1485630567, "post_id": 41913695, "comment_id": 71008764, "body": "<code>return</code> is a function from <code>a -&gt; m a</code>, where <code>m</code> is a monad; it\u2019s not part of the <code>do</code> syntax. Just write <code>(v1, v2)</code> to get the value <code>(v1, v2)</code>."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1485632026, "post_id": 41913695, "comment_id": 71009203, "body": "Thanks.  I only added return because when I only had the let statements, the compiler told me the last line of a do block had to be an expression, and that allowed it to compile.  I understand this behavior better now based on the answers below."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1485633436, "post_id": 41913695, "comment_id": 71009681, "body": "Note that <code>read</code> throws an error (and crashes the program) when given strings it can&#39;t parse into the appropriate type. If you want to improve on that, I suggest using <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Text-Read.html#v:readMaybe\" rel=\"nofollow noreferrer\"><code>readMaybe</code></a> from <code>Text.Read</code>, which gives out <code>Nothing</code> when it fails."}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 6, "last_activity_date": 1485631118, "creation_date": 1485631118, "answer_id": 41913829, "question_id": 41913695, "link": "https://stackoverflow.com/questions/41913695/simple-type-error-on-parsing-the-result-of-getargs/41913829#41913829", "title": "Simple type error on parsing the result of getArgs", "body": "<p>You don't need to use <code>do</code> notation here since that is for handling some monadic type. You can just match on the input list:</p>\n\n<pre><code>parseArgs :: [String] -&gt; (Double, Integer)\nparseArgs [d, i] = (read d, read i)\nparseArgs _ = (0.5, 5)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1485631521, "post_id": 41913833, "comment_id": 71009073, "body": "There actually is a <code>Monoid a =&gt; Monad ((,) a)</code> instance for pairs, which works just like <code>Writer</code>. That explains the counterintuitve type error the OP got, with the &quot;actual type&quot; reported by GHC being a nested pair."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1485631580, "post_id": 41913833, "comment_id": 71009091, "body": "@duplode: ah that explains. Still it is counterintuitive to use monads here since this is a pure function. Thanks."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1485631869, "post_id": 41913833, "comment_id": 71009155, "body": "Indeed -- the OP definitely doesn&#39;t need a writer monad here."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1485631664, "last_edit_date": 1495540891, "creation_date": 1485631143, "answer_id": 41913833, "question_id": 41913695, "link": "https://stackoverflow.com/questions/41913695/simple-type-error-on-parsing-the-result-of-getargs/41913833#41913833", "title": "Simple type error on parsing the result of getArgs", "body": "<p>It looks to me that you have some experience in the \"<em>imperative</em>\" world where <code>return</code> seems to be a keyword to return content from a function.</p>\n\n<p>In Haskell however, the <code>return</code> statement is used to define/use monads. The same for the <code>do</code> block by the way. Your type <code>(Int,Double)</code> can be used as a monadic type (kudos to <a href=\"https://stackoverflow.com/questions/41913695/haskell-simple-getargs-type-error/41913833?noredirect=1#comment71009073_41913833\">@duplode</a> for that). But in this context it does not look much like you want/have to use monads, because this looks like a simple function.</p>\n\n<p>So you can solve the problem with:</p>\n\n<pre><code>parseArgs :: [String] -&gt; (Double, Integer)\nparseArgs args =\n  if length(args) == 2 then\n    let v1 = read (args !! 0) :: Double\n        v2 = read (args !! 1) :: Integer\n    in (v1, v2)\n  else\n    let v1 = read (\"0.5\") :: Double \n        v2 = read (\"5\") :: Integer\n    in (v1, v2)\n</code></pre>\n\n<p>So you use <code>in</code> to say that you use the <code>v1</code> and <code>v2</code>, etc. in an expression. Still it is not very \"Haskell-ish\". A better way to do this is using guards (drop the <code>if-else</code>):</p>\n\n<pre><code>parseArgs :: [String] -&gt; (Double, Integer)\nparseArgs args | length args == 2 =\n                     let v1 = read (args !! 0) :: Double\n                         v2 = read (args !! 1) :: Integer\n                     in (v1, v2)\n               | otherwise =\n                     let v1 = read (\"0.5\") :: Double \n                         v2 = read (\"5\") :: Integer\n                     in (v1, v2)\n</code></pre>\n\n<p>Finally I do not really see why you use all these <code>let</code> statements and specify the types anyway. You can simply rewrite it to:</p>\n\n<pre><code>parseArgs :: [String] -&gt; (Double, Integer)\nparseArgs args | length args == 2 = (read (args !! 0), read (args !! 1))\n               | otherwise = (read \"0.5\", read \"5\")\n</code></pre>\n\n<p>Now we are still not done. Because of <code>args</code> has length two, that means it has the shape <code>[a,b]</code>. We can use that pattern in the head:</p>\n\n<pre><code>parseArgs :: [String] -&gt; (Double, Integer)\nparseArgs [a,b] = (read a, read b)\nparseArgs _     = (read \"0.5\", read \"5\")\n</code></pre>\n\n<p>The advantage is that you do no longer need to use <code>(!!)</code> to get the <em>i</em>-th element: checking and matching is done concurrently so to speak.</p>\n\n<p>A last improvement I propose is to omit the <code>read</code> in the second case: you can simply enter <code>0.5</code> and <code>5</code>:</p>\n\n<pre><code>parseArgs :: [String] -&gt; (Double, Integer)\nparseArgs [a,b] = (read a, read b)\nparseArgs _     = (0.5, 5)\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 41913833, "answer_count": 2, "score": 0, "last_activity_date": 1485633840, "creation_date": 1485630353, "last_edit_date": 1485633840, "question_id": 41913695, "link": "https://stackoverflow.com/questions/41913695/simple-type-error-on-parsing-the-result-of-getargs", "title": "Simple type error on parsing the result of getArgs", "body": "<p>I'm trying a very simple argument parser patterned off <a href=\"https://lotz84.github.io/haskellbyexample/ex/command-line-arguments\" rel=\"nofollow noreferrer\">this example</a>.\nThe first argument ought to be a double, the second ought to be an integer, and if they aren't both of those types, I'd like to use default arguments for both specified in the else.  Here's what I have:</p>\n\n<pre><code>parseArgs :: [String] -&gt; (Double, Integer)\nparseArgs args = do\n  if length(args) == 2 then do\n    let v1 = read (args !! 0) :: Double\n    let v2 = read (args !! 1) :: Integer\n    return (v1, v2)\n  else do\n    let v1 = read (\"0.5\") :: Double \n    let v2 = read (\"5\") :: Integer\n    return (v1, v2)\n</code></pre>\n\n<p>I understand there are more sophisticated ways to parse arguments with an optparse-inspired design using <code>Applicative</code>, but I'm not there yet.  </p>\n\n<p>Here's the error I get:</p>\n\n<pre><code>myscript.hs:186:5-31: error: \u2026\n    \u2022 Couldn't match type \u2018(Double, Integer)\u2019 with \u2018Integer\u2019\n      Expected type: (Double, Integer)\n        Actual type: (Double, (Double, Integer))\n    \u2022 In a stmt of a 'do' block: return (v1, v2)\n</code></pre>\n\n<p>I don't understand this.  Looking at the signature of <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/System-Environment.html#v:getArgs\" rel=\"nofollow noreferrer\"><code>getArgs</code></a>, I don't see anything weird that would suggest I can't get my int back, or that it should return <code>(Double,Integer)</code> rather than just <code>Integer</code>.</p>\n\n<p>How can I do this correctly?</p>\n"}, {"tags": ["haskell", "megaparsec"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1485629353, "post_id": 41913107, "comment_id": 71008339, "body": "There is no such thing as a UTF8-character. There is ASCII / Western / ... / Unicode characters, and there is <i>encodings</i> of such characters (UTF-8 is an encoding). <code>Text</code> actually uses UTF-16 at the moment, so you&#39;ll probably have that in megaparsec; but this needn&#39;t bother you because the interface completely abstracts over the encoding and you only deal with characters. This obviously works fine with ASCII (which sure includes numbers, what made you think otherwise?), but shouldn&#39;t also have any difficulty with general Unicode."}, {"owner": {"reputation": 3542, "user_id": 2984585, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d8b299670c2e1512831e7d2026a8d350?s=128&d=identicon&r=PG", "display_name": "ditoslav", "link": "https://stackoverflow.com/users/2984585/ditoslav"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1485631898, "post_id": 41913107, "comment_id": 71009162, "body": "I mean does <code>charLiteral</code> mean <code>([a-z] | [A-Z])</code> or is it all characters? It seems I&#39;m confusing &quot;characters&quot; and &quot;letters&quot;"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1485632524, "post_id": 41913107, "comment_id": 71009336, "body": "Indeed seems so! A character is simply any value of type <code>Char</code>, such as <code>&#39;a&#39;</code> or <code>&#39;2&#39;</code> or <code>&#39;\u03be&#39;</code> or <code>&#39;\u2663&#39;</code> or <code>&#39; &#39;</code> or even unprintable characters like <code>&#39;\\r&#39;</code>."}], "owner": {"reputation": 3542, "user_id": 2984585, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d8b299670c2e1512831e7d2026a8d350?s=128&d=identicon&r=PG", "display_name": "ditoslav", "link": "https://stackoverflow.com/users/2984585/ditoslav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 424, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1485627172, "creation_date": 1485627172, "question_id": 41913107, "link": "https://stackoverflow.com/questions/41913107/how-to-parse-string-literal-in-megaparsec", "title": "How to parse string literal in Megaparsec?", "body": "<p>So I've spent some time reading the docs but for anything but the most basic of languages the tutorials aren't enough and it's hard to go through the whole docs of the language. I get lost too easily.</p>\n\n<p>How would I create a <code>\"&amp;\"#someStringUtf8\"</code> parser?</p>\n\n<p>Does the <code>charLiteral</code> work only with ASCII chars or does it support any kind of UTF8 character (numbers etc.)?</p>\n"}, {"tags": ["haskell", "f#", "ocaml"], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 8, "last_activity_date": 1485624570, "creation_date": 1485624570, "answer_id": 41912687, "question_id": 41912656, "link": "https://stackoverflow.com/questions/41912656/convert-ocaml-haskell-type-definition-to-haskell-in-definition/41912687#41912687", "title": "convert Ocaml/Haskell type definition to Haskell: * in definition", "body": "<pre><code>data Func a b\n    = Empty\n    | Leaf Int [(a, b)]\n    | Branch Int Int (Func a b) (Func a b)\n</code></pre>\n"}], "owner": {"reputation": 2432, "user_id": 1433373, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c63d8742ad719cabbdf7bfa32be0bd17?s=128&d=identicon&r=PG", "display_name": "Ivan Kush", "link": "https://stackoverflow.com/users/1433373/ivan-kush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 41912687, "answer_count": 1, "score": -3, "last_activity_date": 1485624570, "creation_date": 1485624334, "question_id": 41912656, "link": "https://stackoverflow.com/questions/41912656/convert-ocaml-haskell-type-definition-to-haskell-in-definition", "title": "convert Ocaml/Haskell type definition to Haskell: * in definition", "body": "<p>trying to convert type definition from Ocaml/F# to Haskell, getting an error:</p>\n\n<pre><code>error: parse error on input `*'\n</code></pre>\n\n<p>How could I correct the code?</p>\n\n<p>current <strong>Haskell</strong> code:</p>\n\n<pre><code>data Func sa sb =\n    Empty\n    | Leaf Int * (sa * sb) List\n    | Branch Int * Int * (Func sa sb) * (Func sa sb)\n</code></pre>\n\n<p><strong>Ocaml:</strong></p>\n\n<pre><code>type ('a,'b)func =\nEmpty\n| Leaf of int * ('a*'b)list\n| Branch of int * int * ('a,'b)func * ('a,'b)func;;\n</code></pre>\n\n<p><strong>F#</strong></p>\n\n<pre><code>type func&lt;'a,'b&gt; =\n    | Empty\n    | Leaf of int * ('a * 'b) list\n    | Branch of int * int * func&lt;'a,'b&gt; * func&lt;'a,'b&gt;\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485613004, "post_id": 41910663, "comment_id": 71002746, "body": "Can you show the implementation of <code>sig</code>?"}, {"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485613192, "post_id": 41910663, "comment_id": 71002804, "body": "@WillemVanOnsem What do you mean with implementation? sig is just the parameter of type Sigma for the function"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1485613955, "post_id": 41910663, "comment_id": 71003051, "body": "Then what do you mean by <i>\u201cthen <code>sig (env &quot;x&quot;)</code> should return 45\u201d</i>?"}, {"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1485614567, "post_id": 41910663, "comment_id": 71003256, "body": "@leftaroundabout Oh right. This is just for the test case. Corrected it in my question"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1485615416, "post_id": 41910663, "comment_id": 71003520, "body": "Your test case is wrong. In addition, either your <code>assign</code> type signature or the <code>env</code> function in your test case is wrong. If the type signature is correct, your test case might look like <code>let { env x = case x of { &quot;test&quot; -&gt; 42; &quot;x&quot; -&gt; 43 }; sig = \\42 -&gt; 6 } in let { sig2 = assign &quot;x&quot; 45 env sig } in sig2 (env &quot;x&quot;)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1485623212, "post_id": 41911864, "comment_id": 71006170, "body": "if you mean this: <code>assign name value env sig = \\inp -&gt; (if (inp == (env s)) then val else (sig inp))</code> . I tried this also but I wonder if this is correct. I mean the String name must be already assigned to the specific Location in env to use this function properly."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1485628486, "post_id": 41911864, "comment_id": 71008016, "body": "@JohnDoe Looks good to me (apart from s being name). Yes, this requires <code>name</code> to be already assigned a location by <code>env</code>, but there&#39;s no way around that. Usually you have a &quot;declare&quot; function which provides you with a new <code>env</code>, allocating a new location for the new variable. But this function is meant to assign to an already defined variable."}, {"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1485629696, "post_id": 41911864, "comment_id": 71008465, "body": "Yeah s was just the parameter I used for the String. I thought about it again and put into the context of my task this should be the correct solution. So thanks a lot for your help :)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1485619540, "creation_date": 1485619540, "answer_id": 41911864, "question_id": 41910663, "link": "https://stackoverflow.com/questions/41910663/haskell-assigning-a-value-to-a-string/41911864#41911864", "title": "Haskell: Assigning a value to a String", "body": "<p>Hint:</p>\n\n<p>you need to start by comparing the <code>input</code> location to the location of <code>name</code>, i.e. <code>env name</code>.</p>\n\n<p>When these are equal, you know the new value to return.</p>\n\n<p>When these locations differ, you can access the old <code>Sigma</code> to retrieve the old value for the <code>input</code> location.</p>\n"}], "owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 403, "favorite_count": 1, "accepted_answer_id": 41911864, "answer_count": 1, "score": 0, "last_activity_date": 1485619540, "creation_date": 1485612194, "last_edit_date": 1485614459, "question_id": 41910663, "link": "https://stackoverflow.com/questions/41910663/haskell-assigning-a-value-to-a-string", "title": "Haskell: Assigning a value to a String", "body": "<p>My task consists in imitating features of an imperative programming language in Haskell. Now I'm struggling with assigning a value to a string. The point is that I have to do it with the types Env and Sigma. Env assigns a String (variable name) to a Location Loc. Sigma assigns the Location to a specific value. Here's the code:</p>\n\n<pre><code>type Loc = Int                 --Loc for Location\ntype Env =  String -&gt; Loc \ntype Sigma = Loc -&gt; Int\n\nassign :: String -&gt; Int -&gt; Env -&gt; Sigma -&gt; Sigma\nassign name value env sig = \\input -&gt; ??\n</code></pre>\n\n<p>Now I don't know how to do it in the function <code>assign</code> of my program. The function should store the String name and the Location loc in the function env and also store the same location loc and the Value val in the function sig which must be returned by the whole function 'assign'.</p>\n\n<p>Testing it with e.g. <code>env = \\\"test\"-&gt;42</code>, <code>sig= \\42-&gt;6</code> (sig and env just provisionally for test case),<code>assign \"x\" 45 env sig</code> and then <code>sig (env \"x\")</code> should return 45. I don't know how you manage it to do without assigning the Locations to env and sig. Can you help me and tell me what I should do?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1485608110, "post_id": 41909912, "comment_id": 71001244, "body": "Integral doesn&#39;t necessarily imply show membership. I could create my own integral type and not implement show."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 9, "last_activity_date": 1485608029, "creation_date": 1485608029, "answer_id": 41910006, "question_id": 41909912, "link": "https://stackoverflow.com/questions/41909912/in-haskell-does-integral-typeclass-imply-show-typeclass/41910006#41910006", "title": "In Haskell does Integral typeclass imply Show typeclass?", "body": "<blockquote>\n  <p>So I was thinking since every type in Integral is in Show</p>\n</blockquote>\n\n<p>But not every type in <code>Integral</code> is in <code>Show</code>. That used to be the case in Haskell98, due to</p>\n\n<pre><code>class Show n =&gt; Num n\n</code></pre>\n\n<p>But that superclass relation prevents an awful lot of useful number types (\u201cinfinite-precision numbers\u201d, global results of continuous functions, etc.). In modern Haskell, the classes <code>Show</code> and <code>Integral</code> have no relation at all, hence the compiler can't infer one from the other.</p>\n\n<p>It is, however, indeed possible to show any <em>integral</em> number type independently of the actual <code>Show</code> class; use the <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Numeric.html#v:showInt\"><code>showInt</code></a> function for this.</p>\n\n<pre><code>import Numeric (showInt)\nisPalindrome :: Integral a =&gt; a -&gt; Bool\nisPalindrome n = symmetric $ showInt n []\n</code></pre>\n"}], "owner": {"reputation": 154, "user_id": 2166741, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3bfda6406c2a2d1910eaa29141102dde?s=128&d=identicon&r=PG", "display_name": "Ibraheem Moosa", "link": "https://stackoverflow.com/users/2166741/ibraheem-moosa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 41910006, "answer_count": 1, "score": 4, "last_activity_date": 1485608029, "creation_date": 1485607328, "question_id": 41909912, "link": "https://stackoverflow.com/questions/41909912/in-haskell-does-integral-typeclass-imply-show-typeclass", "title": "In Haskell does Integral typeclass imply Show typeclass?", "body": "<p>I was trying to compile this code.</p>\n\n<pre><code>symmetric [] = True\nsymmetric [_] = True\nsymmetric l\n    | (head l) == (last l) = symmetric (tail (init l))\n    | otherwise = False\n\nisPalindrome :: Integral a =&gt; a -&gt; Bool\nisPalindrome n = symmetric (show n)\n</code></pre>\n\n<p>That code did not compile and I got a not very long \n  error message saying that it cannot deduce (Show a).</p>\n\n<pre><code>Could not deduce (Show a) arising from a use of \u2018show\u2019\nfrom the context (Integral a)\n  bound by the type signature for\n             isPalindrome :: Integral a =&gt; a -&gt; Bool\n  at 4.hs:7:17-39\nPossible fix:\n  add (Show a) to the context of\n    the type signature for isPalindrome :: Integral a =&gt; a -&gt; Bool\nIn the first argument of \u2018symmetric\u2019, namely \u2018(show n)\u2019\nIn the expression: symmetric (show n)\nIn an equation for \u2018isPalindrome\u2019:\n    isPalindrome n = symmetric (show n)\n</code></pre>\n\n<p>It worked after changing this line</p>\n\n<pre><code>isPalindrome :: Integral a =&gt; a -&gt; Bool\n</code></pre>\n\n<p>to</p>\n\n<pre><code>isPalindrome :: (Show a, Integral a) =&gt; a -&gt; Bool\n</code></pre>\n\n<p>So I was thinking since every type in Integral is in Show,a Haskell compiler should be able to deduce (Show a) from (Integral a).</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1485606836, "post_id": 41909423, "comment_id": 71000902, "body": "Did you read <a href=\"http://stackoverflow.com/questions/7198907/haskell-constraint-is-no-smaller-than-the-instance-head\">this question</a>? I believe you are breaking <a href=\"https://downloads.haskell.org/~ghc/7.0.1/docs/html/users_guide/type-class-extensions.html#instance-rules\" rel=\"nofollow noreferrer\">condition b in section 7.6.3.2 of the standard</a>: i.e. you have the assertion <code>MonadWriter [Statements] m</code> which contains 1 constructor+1 variable = size 2, and your instance head contains again one constructor and one variable = size 2. Adding an other <code>newtype</code> layer should make things work, or just use <code>UndecidableInstances</code>."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1485607048, "post_id": 41909423, "comment_id": 71000945, "body": "By the way, the name <code>UndecidableInstances</code> is frightining but it&#39;s actually a <i>harmless</i> extension: the only thing that might happen is that GHC enters an infinite loop during compilation, and once that happens you can just debug your code and find which declarations/instances cause the infinite loop and refactor your code to avoid it, but it doesn&#39;t do anything other than that, so if the program terminates compilation it works fine."}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 117, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1485603924, "creation_date": 1485603924, "question_id": 41909423, "link": "https://stackoverflow.com/questions/41909423/how-to-make-a-typeclass-instance-with-the-monadwriter-constraint", "title": "How to make a typeclass instance with the MonadWriter constraint?", "body": "<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE NoMonomorphismRestriction #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE RebindableSyntax #-}\n\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nmodule Main where\n\nimport Control.Monad.Writer hiding ((&gt;&gt;))\nimport qualified Prelude as P\nimport Data.String (fromString)\nimport qualified Data.ByteString.Char8 as B\nimport Data.ByteString.Char8 (ByteString)\nimport Prelude hiding ((+),(-),(*),(/),(&lt;=),(&lt;),(==),(&gt;),(&gt;=),negate,exp,log,tanh)\n\ninfixl 1 |&gt;\n(|&gt;) = flip ($)\n\nnewtype Method args = Method {method' :: (ByteString, args)}\n\nclass CudaOuter repr where\n  include :: ByteString -&gt; repr ()\n  externCBlock :: repr () -&gt; repr ()\n  method :: ByteString -&gt; repr (ins -&gt; outs) -&gt; repr (Method (ins -&gt; outs))\n\ndata Statements =\n  Statement ByteString\n  | Indent\n  | Dedent\n  deriving Show\n\nquote x = [\"\\\"\",x,\"\\\"\"] |&gt; B.concat\n\n-- type StatementsParser = Writer [Statements] -- Ok\n-- type StatementsParser = MonadWriter [Statements] m =&gt; m -- Error\nnewtype StatementsParser m x = StatementsParser {st :: m x}\n\ninstance MonadWriter [Statements] m =&gt; CudaOuter (StatementsParser m) where\n  include x = [quote x |&gt; Statement] |&gt; tell |&gt; StatementsParser\n\n--- The outer level of the Cuda compiler language.\ncuda_kernel_module kernel_name method_body_macro = do\n  include \"thrust/tuple.h\"\n  include \"thrust/functional.h\"\n  include \"cub/cub.cuh\"\n  externCBlock $ do\n    method kernel_name method_body_macro\n    return ()\n\nmain = print \"Hello\"\n</code></pre>\n\n<p>The code above gives me this error.</p>\n\n<pre><code>* The constraint `MonadWriter [Statements] m'\n    is no smaller than the instance head\n  (Use UndecidableInstances to permit this)\n* In the instance declaration for `CudaOuter (StatementsParser m)'\n</code></pre>\n\n<p>I am not sure what the error means, but am decently sure that <code>UndecidableInstances</code> is not what I want here.</p>\n\n<p>In the previous version of this, I used a writer instance, but I am not sure how to make it more generic with <code>MonadWriter</code> and <code>MonadState</code> constraints. I've tried putting typeclass constraints inside the <code>StatementsParser</code> newtype, but that did not work either.</p>\n\n<p>Right now I am thinking that maybe the constraints need to be put in during class declaration, but that does not strike me as it either.</p>\n\n<p>This is a bit confusing. </p>\n\n<p>1) How can more complex typeclass constraints be put in during instance declaration?</p>\n\n<p>2) Can typeclass constraints go into newtype declarations?</p>\n\n<p>3) Instead of using a newtype as in the code fragment, can a type synonim be used instead so I do not have to do packing and unpacking?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1485645396, "post_id": 41907855, "comment_id": 71013231, "body": "in <code>[[x,y]]</code> both <code>x</code> and <code>y</code> must have the same type -- in Haskell, all elements of a list must have the same type. But in <code>[x,[y]]</code>, <code>x</code> must be of the same type as <code>[y]</code>, i.e. a list, with elements of the same type as that of <code>y</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1533, "user_id": 7444219, "user_type": "registered", "profile_image": "https://graph.facebook.com/1901410040088581/picture?type=large", "display_name": "Jonathan von Schroeder", "link": "https://stackoverflow.com/users/7444219/jonathan-von-schroeder"}, "edited": false, "score": 1, "creation_date": 1485595225, "post_id": 41907983, "comment_id": 70998057, "body": "If you type <code>:i (:)</code> in ghci you can find out, that the fixity of <code>:</code> is infixr. Thus, if as supposed by the OP, <code>x</code> and <code>y</code> are integers then the expression x : [y] : [] is not well typed ... If you, however evaluated (x : [y]) : [] the result would be [[x,y]]."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1485597462, "post_id": 41907983, "comment_id": 70998573, "body": "The type cannot be used to answer OP&#39;s question, which is about fixity and parsing rules."}], "tags": [], "owner": {"reputation": 178, "user_id": 4556658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/176748782a450651ab1ef750943e5f35?s=128&d=identicon&r=PG&f=1", "display_name": "sdx23", "link": "https://stackoverflow.com/users/4556658/sdx23"}, "is_accepted": false, "score": 1, "last_activity_date": 1485593877, "creation_date": 1485593877, "answer_id": 41907983, "question_id": 41907855, "link": "https://stackoverflow.com/questions/41907855/haskell-list-syntax-with/41907983#41907983", "title": "Haskell List Syntax with :", "body": "<p>Look at the type</p>\n\n<pre><code>(:) :: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>In words: <code>(:)</code> takes an <code>a</code> and a list of <code>a</code>s and makes it a list of <code>a</code>s.</p>\n\n<p>Thereby, in <code>x : [y] : []</code>, the second part <code>[y] : []</code> is a list of lists with items of the same type as <code>y</code>. Thereby  <code>x</code> must be a list of items that have the same type as <code>y</code>. E.g.</p>\n\n<pre><code>y = 1\nx = [2,3]\nlist = x:[y]:[]\n</code></pre>\n\n<p>and <code>list</code> is <code>[[2,3],[1]]</code>.</p>\n\n<p>Edit: Overread that <code>x</code> and <code>y</code> should be integers. That of course would not work, see the explanation and try it in ghci.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1485598966, "last_edit_date": 1485598966, "creation_date": 1485597434, "answer_id": 41908454, "question_id": 41907855, "link": "https://stackoverflow.com/questions/41907855/haskell-list-syntax-with/41908454#41908454", "title": "Haskell List Syntax with :", "body": "<p>You can ask ghci about fixity information:</p>\n\n<pre><code>&gt; :i :\ndata [] a = ... | a : [a]   -- Defined in \u2018GHC.Types\u2019\ninfixr 5 :\n</code></pre>\n\n<p>Ignoring the first line for a moment, the second line says <code>infixr 5</code>, which means that <code>:</code> associates to the right and has precedence 5. \"Associates to the right\" means the operator groups \"towards the right\", so <code>e1 : e2 : e3</code> means <code>e1 : (e2 : e3)</code>.</p>\n\n<p>Other options include <code>infixl</code> (grouping \"toward the left\") and <code>infix</code> (if grouping would be needed, report an error). For example, <code>e1 + e2 + e3</code> means <code>(e1 + e2) + e3</code> because <code>+</code> is <code>infixl</code>:</p>\n\n<pre><code>&gt; :i +\nclass Num a where\n  (+) :: a -&gt; a -&gt; a\n  ...\n    -- Defined in \u2018GHC.Num\u2019\ninfixl 6 +\n</code></pre>\n\n<p>And <code>True == True == True</code> is a parse error because <code>==</code> is <code>infix</code>:</p>\n\n<pre><code>&gt; :i ==\nclass Eq a where\n  (==) :: a -&gt; a -&gt; Bool\n  ...\n    -- Defined in \u2018GHC.Classes\u2019\ninfix 4 ==\n</code></pre>\n\n<p>When there are multiple operators, the precedence is used to tell how they are grouped, but your expression involves only one operator, namely, <code>(:)</code>, so the precedence is not needed to decide what your expression means.</p>\n\n<p>Of course, you can always use explicit parentheses to disambiguate or to group operators \"the other way\"; e.g. <code>(e1 : e2) : e3</code> is also a valid expression and means something different from <code>e1 : (e2 : e3)</code>, and <code>(True == True) == True</code> is valid and evaluates to <code>True</code> even though <code>True == True == True</code> is not valid.</p>\n\n<p>Here are some examples showing the difference:</p>\n\n<pre><code>&gt; 1 : 2 : [3,4]\n[1,2,3,4]\n&gt; 1 : (2 : [3,4])\n[1,2,3,4]\n&gt; (1 : [2]) : [[3,4],[5]]\n[[1,2],[3,4],[5]]\n</code></pre>\n\n<p>Or, even more to the point:</p>\n\n<pre><code>&gt; let e1 = []; e2 = [\"ab\",\"cd\"]; e3 = [[\"ef\",\"gh\"],[\"ij\"]]\n&gt; e1 : e2 : e3\n[[],[\"ab\",\"cd\"],[\"ef\",\"gh\"],[\"ij\"]]\n&gt; e1 : (e2 : e3)\n[[],[\"ab\",\"cd\"],[\"ef\",\"gh\"],[\"ij\"]]\n&gt; (e1 : e2) : e3\n[[\"\",\"ab\",\"cd\"],[\"ef\",\"gh\"],[\"ij\"]]\n</code></pre>\n\n<p>(Cooking up values that make both of these expressions well-typed was fun!)</p>\n"}], "owner": {"reputation": 21, "user_id": 7482123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43bb2c62a8aa777c34bae993e33a34eb?s=128&d=identicon&r=PG&f=1", "display_name": "Kiwiwache", "link": "https://stackoverflow.com/users/7482123/kiwiwache"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1485645536, "creation_date": 1485592739, "last_edit_date": 1485645536, "question_id": 41907855, "link": "https://stackoverflow.com/questions/41907855/haskell-list-syntax-with", "title": "Haskell List Syntax with :", "body": "<p>Haskell; <code>x</code>,<code>y</code>: integers.</p>\n\n<pre><code>x : [y] : []\n</code></pre>\n\n<p>What happens in this case? Is <code>[y]</code> added to <code>[]</code> or is <code>x</code> added to <code>[y]</code> first? Is the result <code>[x,[y]]</code> or <code>[[x,y]]</code>?</p>\n\n<p>I'm sorry for my bad English and thank you for your help.</p>\n"}, {"tags": ["haskell", "functional-programming", "lambda-calculus"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1485572112, "post_id": 41905759, "comment_id": 70993934, "body": "You mean eta not alpha, right?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1485576349, "post_id": 41905759, "comment_id": 70994671, "body": "Yes sorry @ReidBarton"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1485579523, "post_id": 41905759, "comment_id": 70995120, "body": "I think specially-typed <code>id</code>s of all varieties -- not just eta equalities -- are very common in proof systems. Half the tactics in Coq end up translating into <code>id</code> spelled in an especially exciting way."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1485580786, "post_id": 41905759, "comment_id": 70995318, "body": "Church-encoded Sigma? I want to see this. Where is <code>l</code> from <code>List.length Nat l</code> bound? Instead of eta-reduction you can incorporate eta-expansion in your type checker: an attempt to unify <code>f</code> with <code>\\x -&gt; e</code> results in eta-expanding <code>f</code>, so the unification problem becomes <code>(\\x -&gt; f x) =?= (\\x -&gt; e)</code> and you can proceed further structurally. Ideally this machinery should be type-directed, so e.g. whenever two expressions of type <code>Top</code> are unified, you don&#39;t need to unify them structurally and can just conclude that they are the same."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1485582021, "post_id": 41905759, "comment_id": 70995534, "body": "@user3237465 all the code is <a href=\"https://github.com/maiavictor/sol\" rel=\"nofollow noreferrer\">here</a>, I learned how to encode arbitrary GADTs on CoC after a lot of help from Gabriel, Andr&#225;s etc. - I was trying to avoid messing with the compiler further, I thought it was really good and elegant that way, which is why this issue quite bothered me ):"}], "answers": [{"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1485599586, "post_id": 41907840, "comment_id": 70999065, "body": "&quot;Typed eta conversion is only really necessary for eta conversion of unit types&quot; \u2014 of any irrelevant propositions which can consist of <code>Bot</code>, <code>_-&gt;_</code>, <code>Sigma</code>, propositional truncation and even user-defined <code>data</code> (as opposed to <code>record</code>), e.g. you could have a system where you can prove that <code>Vec A n</code> is a <code>Prop</code> if <code>A</code> is a <code>Prop</code> (which works, because the shape of the <code>Vec A n</code> container is <code>Top</code>, i.e. statically known, so there is scope for further generalization (any container with propositional shape and positions, I guess?)) and reify unification with this knowledge."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1485602098, "post_id": 41907840, "comment_id": 70999725, "body": "@user3237465 those are advanced features even in the context of modern dep. languages, therefore I thought them out of question scope.  <code>Prop &lt; Type</code> subtyping, inference, or even instance resolution based <code>Prop</code> identification seems interesting to me as well. However, I currently think that it&#39;s worth to consider putting irrelevant things in boxes during elaboration, instead of having type-directed unification (for performance reasons)."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1485602354, "post_id": 41907840, "comment_id": 70999789, "body": "@user3237465 Also, I think propositional truncation is in a different league. Unification traditionally solves equations only up to definitional equality, which is proof irrelevant, but if we consider higher constructors as solutions, we need proof relevant unification. In Agda, proper <code>--without-K</code> for unification in patterns was quite a <a href=\"https://people.cs.kuleuven.be/~jesper.cockx/unifiers-as-equivalences/draft.pdf\" rel=\"nofollow noreferrer\">complexity jump</a>, and I imagine it would not be easier for unification on right-hand sides/implicits."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1485607087, "post_id": 41907840, "comment_id": 71000956, "body": "What&#39;s your strategy of unifying boxes? Two boxes are equal only if they are of the same type, right? In higher-order unification <code>(x y : || A ||), x =?= y</code> is solved by <code>()</code> \u2014 not by the higher constructor. In the same way type constructors in higher-order unification are injective unlike in &quot;pattern matching&quot; unification. This is discussed in the paragraph right before the &quot;9. Conclusion and future work&quot; section in the paper you linked."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1485609934, "post_id": 41907840, "comment_id": 71001742, "body": "Prop. truncation from HoTT and <code>Prop</code> boxes as in classic OTT are very different. In the latter case (which I referred to when I advocated boxes), contents are considered definitionally equal, and this kind of boxing is generally useful for implementation of eta for unit too, because there the contents are def. equal as well. With prop. truncation, <code>(| zero | =?= | suc zero |) : | Nat |</code> is only solvable with the higher constructor, and if  we solve it thus, subsequent code may need to be transported along truncation (which seems really complicated). I don&#39;t think I fully get you though."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1485612372, "post_id": 41907840, "comment_id": 71002520, "body": "Ah, indeed, I confused judgmental truncation (aka <code>Squash</code>) with propositional truncation. Sorry for the noise. My point about boxes is that <code>Top</code> and <code>A -&gt; Top</code> are both units (in a sense), so they both can be erased, but <code>erase tt == erase (const tt)</code> doesn&#39;t hold. So you have to keep some type information and perform type-directed unification anyway. Or did I just misunderstand you?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1485613744, "post_id": 41907840, "comment_id": 71002991, "body": "In the checking/unification algorithms I know we only ever conversion check terms with equal types (or maybe types that are equal modulo unsolved constraints - this is OK to do is some sytems). So, if <code>erase a =?= erase b</code> comes up, we know that <code>a</code> and <code>b</code> have the same <code>Prop</code> type."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 4, "last_activity_date": 1485602514, "last_edit_date": 1485602514, "creation_date": 1485592607, "answer_id": 41907840, "question_id": 41905759, "link": "https://stackoverflow.com/questions/41905759/is-it-usual-to-wrap-a-variable-in-an-useless-id-call-to-avoid-eta-conversion-i/41907840#41907840", "title": "Is it usual to wrap a variable in an useless `id` call to avoid eta-conversion issues on proofs?", "body": "<p>You need to add eta to your conversion checking algorithm. That can be done in several ways, the simplest two are</p>\n\n<ul>\n<li>Type-directed as in page 22 of <a href=\"http://www.cse.chalmers.se/~ulfn/papers/thesis.pdf\" rel=\"nofollow noreferrer\">Ulf Norell's thesis</a> and used in Agda</li>\n<li>Untyped as used in Coq AFAIK</li>\n</ul>\n\n<p>Untyped eta conversion is complete for functions, and it's also simpler and faster than the typed version (no need to recompute or cache types in neutral applications) in our case. The algorithm goes like this:</p>\n\n<p>We first check the case when both values are lambdas as usual. However, we check two additional cases after that, when only one side is lambda. In these cases, we apply the lambda body to a new generic variable (as usual), and also apply the other term to the same variable, and check equality of the  resulting values. </p>\n\n<p>That's all of it! It's actually very simple, and doesn't have much performance cost. Note that we don't need to implement eta reduction, or strong eta normalization, since eta conversion check is easily done on weak-head normal values on the fly.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1485602514, "creation_date": 1485570181, "last_edit_date": 1485576334, "question_id": 41905759, "link": "https://stackoverflow.com/questions/41905759/is-it-usual-to-wrap-a-variable-in-an-useless-id-call-to-avoid-eta-conversion-i", "title": "Is it usual to wrap a variable in an useless `id` call to avoid eta-conversion issues on proofs?", "body": "<p>Using a language similar to Morte/CoC, I'm trying to prove the simple statement <code>there are lists of arbitrary lengths</code>. For that, I wrote the following type:</p>\n\n<pre><code>\u2200 n:Nat -&gt;\n(ThereIs (List Nat)\n  (Equal Nat \n    (List.length Nat l) \n    n)))\n</code></pre>\n\n<p><code>ThereIs</code> is the dependent pair (Sigma). All is church-encoded. To prove it, I wrote the following proof:</p>\n\n<pre><code>\u03bb n:Nat -&gt;\n(ThereIs.this (List Nat)\n  (\u03bb l:(List Nat) -&gt; (Equal Nat (List.length Nat l) n))\n  (List.replicate Nat n Nat.Zero)\n  (Equal.refl Nat n))\n</code></pre>\n\n<p>Weirdly, I get a type mismatch error between <code>d</code> (i.e., the free variable of type Nat) and <code>\u03bb c:* -&gt; \u03bb b:(c -&gt; c) -&gt; \u03bb a:c -&gt; (d c b a)</code>. But that later term, when eta-reduced, is just <code>d</code>! Since I don't have an eta-reducer ready, I instead made this following \"useless identify\" function:</p>\n\n<pre><code>\u03bb n: Nat -&gt;\n\n\u03bb Nat:* -&gt;\n\u03bb Succ: (Nat -&gt; Nat) -&gt;\n\u03bb Zero: Nat -&gt;\n\n(n Nat Succ Zero)\n</code></pre>\n\n<p>Now, by applying that useless id to every occurence of <code>n</code>, I \"un-eta\" it, causing the proof to check. I'd like to gain any kind of insight of what is going on here. Is this \"useless id\" function a known/used pattern on writing proofs? Why isn't the calculus of contructions able to type-check this proof without this little help? Is there any deep reasoning behind this phenomena or is it just how things are for no special reason?</p>\n"}, {"tags": ["haskell", "streaming", "aeson"], "comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1485564852, "post_id": 41905139, "comment_id": 70992854, "body": "I suspect that GC just does not kick in, because you have plenty of RAM available, and not running GC is faster than running it needlessly. It&#39;s a pretty common pattern in GC-ed languages. Try limiting the heap available and see if it still fits."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 1, "creation_date": 1485568056, "post_id": 41905139, "comment_id": 70993409, "body": "@9000 That is unlikely to help. The OP is probably right about intermediate results being held for too long. The <code>mapM</code> in <code>propertiesWithGeocoding</code> is a likely culprit (and, if that&#39;s indeed the case, the answers here will likely involve streaming libraries such as <i>pipes</i> and <i>conduit</i>, which are commonly used to provide alternatives to <code>mapM</code> when dealing with large amounts of data)."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1485573653, "post_id": 41905139, "comment_id": 70994179, "body": "I wish I had a runnable fragment. The solution may partly be to use a streaming library like <code>streaming</code> or <code>conduit</code> or <code>pipes</code>. But there are other peculiarities. Keep in mind first that aeson does tend to accumulate the whole input in memory for parsing. (This is the only way to do it that would work for all json). There is a <code>json-stream</code> library can get around this in some cases depending what you are looking for in the json."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1485576708, "post_id": 41905139, "comment_id": 70994721, "body": "Another peculiarity is the way you use properties twice over in <code>propertiesWithGeocoding</code>, if I&#39;m following. First you run along it to get locations, then you chunk it, then you use <code>mapM</code> and <code>sequence</code> (these are where are streaming library like <code>streaming</code> helps and it would nice to have a runnable fragment to show how refactoring goes), All of this, so far, can be made to &#39;stream&#39; beautifully without <code>mapM</code> which tends to accumulate the whole list."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1485577014, "post_id": 41905139, "comment_id": 70994759, "body": "Finally though, you <code>zip</code> the result with <code>properties</code> again, if I follow. This is a problem for a properly streaming (= low memory use) program since it entails that the first time you went through <code>properties</code> everything has to be saved since the compiler sees it will need it again."}, {"owner": {"reputation": 9182, "user_id": 219449, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/70faf49f616436be935cb8b9512f7673?s=128&d=identicon&r=PG", "display_name": "Leonti", "link": "https://stackoverflow.com/users/219449/leonti"}, "edited": false, "score": 0, "creation_date": 1485592185, "post_id": 41905139, "comment_id": 70997386, "body": "I&#39;ve created a git repo here: <a href=\"https://github.com/Leonti/haskell-memory-so\" rel=\"nofollow noreferrer\">github.com/Leonti/haskell-memory-so</a>   This one reads list of addresses (the same amount as properties) and geocodes them. Strangely this one doesn&#39;t exibit any memory issues. I see 8 spikes up to 11M which correspond to 8 calls to MapQuest. Not even near to 800M. Program without geocoding consumes 30M, program with just geocoding consumes 11M. If I combine them I get 800M :("}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1485599821, "post_id": 41905139, "comment_id": 70999128, "body": "I see two possible problems: 1) you are using <code>Data.Aeson.decode</code> instead of the stricter <code>Data.Aeson.decode&#39;</code>, which builds less thunks. 2) You seem to be getting the response to the http request as a <code>String</code>. <code>String</code> is a very wasteful representation in Haskell. It would be more efficient to get the response as a <code>ByteString</code> and pipe it into <code>decode&#39;</code> without the need for <code>fromString</code>. What http library are you using?"}, {"owner": {"reputation": 9182, "user_id": 219449, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/70faf49f616436be935cb8b9512f7673?s=128&d=identicon&r=PG", "display_name": "Leonti", "link": "https://stackoverflow.com/users/219449/leonti"}, "edited": false, "score": 0, "creation_date": 1485603827, "post_id": 41905139, "comment_id": 71000125, "body": "Guys, here is the version which you can run and which has the memory problem: <a href=\"https://github.com/Leonti/haskell-memory-so\" rel=\"nofollow noreferrer\">github.com/Leonti/haskell-memory-so</a>"}, {"owner": {"reputation": 9182, "user_id": 219449, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/70faf49f616436be935cb8b9512f7673?s=128&d=identicon&r=PG", "display_name": "Leonti", "link": "https://stackoverflow.com/users/219449/leonti"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1485604066, "post_id": 41905139, "comment_id": 71000192, "body": "@danidiaz I think it might reduce the memory a little, but not by a lot.   Version that just geocodes the addresses consumes only 11M at peaks (using <code>String</code> and <code>Data.Aeson.decode</code>)."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1485604155, "post_id": 41905139, "comment_id": 71000220, "body": "When you were shocked by the memory use, I take it you were sending more than 7 or 8 batches of 100?"}, {"owner": {"reputation": 9182, "user_id": 219449, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/70faf49f616436be935cb8b9512f7673?s=128&d=identicon&r=PG", "display_name": "Leonti", "link": "https://stackoverflow.com/users/219449/leonti"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1485604411, "post_id": 41905139, "comment_id": 71000297, "body": "@Michael not really - those are the same addresses, so in high-consumption case it still processes around 780 addresses (8 batches). I&#39;ve updates the version on github which reproduces the bug. Could you take a look at it?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1485611310, "post_id": 41905139, "comment_id": 71002169, "body": "I can&#39;t run the new version but I made a patch <a href=\"https://github.com/Leonti/haskell-memory-so/pull/1\" rel=\"nofollow noreferrer\">github.com/Leonti/haskell-memory-so/pull/1</a> that helped reduce memory pile-up with the previous version you had on github.  I doubt it will have much effect but it will at least be able to get rid of one hypothesis about the problem."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1485611436, "post_id": 41905139, "comment_id": 71002212, "body": "One simple modernization like @danidiaz is talking about would be to use <a href=\"http://hackage.haskell.org/package/http-client-0.5.5/docs/Network-HTTP-Client.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/http-client-0.5.5/docs/&hellip;</a> <code>httpLbs</code> to get a lazy bytestring to feed directly to aeson."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 9182, "user_id": 219449, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/70faf49f616436be935cb8b9512f7673?s=128&d=identicon&r=PG", "display_name": "Leonti", "link": "https://stackoverflow.com/users/219449/leonti"}, "edited": false, "score": 0, "creation_date": 1485629711, "post_id": 41905139, "comment_id": 71008470, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/134269/discussion-between-michael-and-leonti\">continue this discussion in chat</a>."}], "answers": [{"tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 2, "last_activity_date": 1485787442, "last_edit_date": 1485787442, "creation_date": 1485785689, "answer_id": 41938047, "question_id": 41905139, "link": "https://stackoverflow.com/questions/41905139/reduce-memory-usage-of-a-haskell-program/41938047#41938047", "title": "Reduce memory usage of a Haskell program", "body": "<p>It might be worth recording that this turned out to be a <a href=\"https://github.com/Leonti/haskell-memory-so/pull/1\" rel=\"nofollow noreferrer\">simple streaming problem</a> arising from use of <code>mapM</code> and <code>sequence</code>, which with <code>replicateM</code> and <code>traverse</code> and other things that make you \"extract a list from IO\" always raise accumulation worries. So a little detour by a streaming library was needed. So in the repo it was necessary just to replace</p>\n\n<pre><code>processDate :: String -&gt; IO ()\nprocessDate date = do\n    allFiles &lt;- listFiles date\n    allProperties &lt;- mapM fileToProperties allFiles\n    let flattenedPropertiesWithPrice = filter hasPrice $ concat allProperties\n    geocodedProperties &lt;- propertiesWithGeocoding flattenedPropertiesWithPrice\n    print geocodedProperties\n\npropertiesWithGeocoding :: [ParsedProperty] -&gt; IO [(ParsedProperty, Maybe LatLng)]\npropertiesWithGeocoding properties = do\n    let batchProperties = chunksOf 100 properties\n    batchGeocodedLocations &lt;- mapM geocodeAddresses batchProperties\n    let geocodedLocations = fromJust $ concat &lt;$&gt; sequence batchGeocodedLocations\n    return geocodedLocations\n</code></pre>\n\n<p>with something like this</p>\n\n<pre><code>import Streaming\nimport qualified Streaming.Prelude as S\n\nprocessDate :: String -&gt; IO ()\nprocessDate date = do\n    allFiles &lt;- listFiles date   -- we accept an unstreamed list\n    S.print $ propertiesWithGeocoding -- this was the main pain point see below\n            $ S.filter hasPrice \n            $ S.concat \n            $ S.mapM fileToProperties -- this mapM doesn't accumulate\n            $ S.each allFiles    -- the list is converted to a stream\n\npropertiesWithGeocoding\n  :: Stream (Of ParsedProperty) IO r\n     -&gt; Stream (Of (ParsedProperty, Maybe LatLng)) IO r\npropertiesWithGeocoding properties =  \n    S.concat $ S.concat \n             $ S.mapM geocodeAddresses -- this mapM doesn't accumulate results from mapquest\n             $ S.mapped S.toList       -- convert segments to haskell lists\n             $ chunksOf 100 properties -- this is the streaming `chunksOf`\n    -- concat here flattens a stream of lists of as into a stream of as\n    -- and a stream of maybe as into a stream of as\n</code></pre>\n\n<p>Then the memory use looks like so, each peak corresponding to a trip to Mapquest promply followed by a little processing and a print, whereupon <code>ghc</code> forgets all about it and moves on:</p>\n\n<p><a href=\"https://i.stack.imgur.com/2AiEH.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2AiEH.png\" alt=\" \"></a></p>\n\n<p>Of course this could be done with <code>pipes</code> or <code>conduit</code>. But here we just need a little bit of simple <code>mapM</code> / <code>sequence</code>/ <code>traverse</code> / <code>replicateM</code> avoidance and  <code>streaming</code> is perhaps simplest for this sort of quick local refactoring. Note that this list is quite short so the thought 'but short lists are cool with <code>mapM</code>/<code>traverse</code>/etc !\" can be quite spectacularly false. Why not just get rid of them? Whenever you are about to write list <code>mapM f</code> it is a good idea to consider <code>S.mapM f . S.each</code> (or conduit or pipes equivalent) . You will now have a stream and can recover a list with <code>S.toList</code> or an equivalent, but it is likely that, as in this case, you will find you don't need a reified accumulated list but can e.g. use some streaming process like printing to file or stdout or writing things to a database, after making whatever list like manipulations are needed (here we use eg. streaming <code>filter</code> and also <code>concat</code> to flatten streamed lists and as a sort of <code>catMaybe</code>).</p>\n"}], "owner": {"reputation": 9182, "user_id": 219449, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/70faf49f616436be935cb8b9512f7673?s=128&d=identicon&r=PG", "display_name": "Leonti", "link": "https://stackoverflow.com/users/219449/leonti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 367, "favorite_count": 0, "accepted_answer_id": 41938047, "answer_count": 1, "score": 3, "last_activity_date": 1485788186, "creation_date": 1485563350, "last_edit_date": 1485788186, "question_id": 41905139, "link": "https://stackoverflow.com/questions/41905139/reduce-memory-usage-of-a-haskell-program", "title": "Reduce memory usage of a Haskell program", "body": "<p>I have a following program in Haskell:</p>\n\n<pre><code>processDate :: String -&gt; IO ()\nprocessDate date = do\n    ...\n    let newFlattenedPropertiesWithPrice = filter (notYetInserted date existingProperties) flattenedPropertiesWithPrice\n    geocodedProperties &lt;- propertiesWithGeocoding newFlattenedPropertiesWithPrice\n\npropertiesWithGeocoding :: [ParsedProperty] -&gt; IO [(ParsedProperty, Maybe LatLng)]\npropertiesWithGeocoding properties = do\n    let addresses = fmap location properties\n    let batchAddresses = chunksOf 100 addresses\n    batchGeocodedLocations &lt;- mapM geocodeAddresses batchAddresses\n    let geocodedLocations = fromJust $ concat &lt;$&gt; sequence batchGeocodedLocations\n    return (zip properties geocodedLocations)\n\ngeocodeAddresses :: [String] -&gt; IO (Maybe [Maybe LatLng])\ngeocodeAddresses addresses = do\n    mapQuestKey &lt;- getEnv \"MAP_QUEST_KEY\"\n    geocodeResponse &lt;- openURL $ mapQuestUrl mapQuestKey addresses\n    return $ geocodeResponseToResults geocodeResponse\n\ngeocodeResponseToResults :: String -&gt; Maybe [Maybe LatLng]\ngeocodeResponseToResults inputResponse =\n    latLangs\n    where\n        decodedResponse :: Maybe GeocodingResponse\n        decodedResponse = decodeGeocodingResponse inputResponse\n\n        latLangs = fmap (fmap geocodingResultToLatLng . results) decodedResponse\n\ndecodeGeocodingResponse :: String -&gt; Maybe GeocodingResponse\ndecodeGeocodingResponse inputResponse = Data.Aeson.decode (fromString inputResponse) :: Maybe GeocodingResponse  \n</code></pre>\n\n<p>It reads a list of properties (homes and apartments) from html files, parses them, geocodes the addresses and saves the results into sqlite db.<br>\nEverything works fine except for a very high memory usage (around 800M).<br>\nBy commenting code out I have pinpointed the problem to be the geocoding step.<br>\nI send 100 addresses at a time to MapQuest api (<a href=\"https://developer.mapquest.com/documentation/geocoding-api/batch/get/\" rel=\"nofollow noreferrer\">https://developer.mapquest.com/documentation/geocoding-api/batch/get/</a>).<br>\nThe response for 100 addresses is quite massive so it might be one of the culprits, but 800M?  I feel like it holds to all of the results until the end which drives the memory usage so high.  </p>\n\n<p>After commenting out the geocoding part of the program memory usage is around 30M which is fine.  </p>\n\n<p>You can get the full version which reproduces the issue here: <a href=\"https://github.com/Leonti/haskell-memory-so\" rel=\"nofollow noreferrer\">https://github.com/Leonti/haskell-memory-so</a>  </p>\n\n<p><a href=\"https://i.stack.imgur.com/50GCJ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/50GCJ.png\" alt=\"enter image description here\"></a></p>\n\n<p>I'm quite a newbie in Haskell, so not sure how I can optimize it.<br>\nAny ideas?  </p>\n\n<p>Cheers!</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485567048, "post_id": 41905124, "comment_id": 70993245, "body": "Please edit your question so that the syntax is correct (you probably intended to have a do-block in the first piece of code)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1485569032, "post_id": 41905124, "comment_id": 70993552, "body": "@duplode, To be fair this is a valid ghci session"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1485569322, "post_id": 41905124, "comment_id": 70993581, "body": "@luqui That does make sense. I will keep that in mind while reading questions from now on :)"}], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1526853643, "post_id": 41905593, "comment_id": 87893661, "body": "You can also use <code>liftA2</code>."}], "tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": false, "score": 8, "last_activity_date": 1485569157, "last_edit_date": 1485569157, "creation_date": 1485567956, "answer_id": 41905593, "question_id": 41905124, "link": "https://stackoverflow.com/questions/41905124/how-to-use-io-monad-output-on-fly/41905593#41905593", "title": "how to use IO monad output on fly", "body": "<p>You can, using the <code>IO</code> instance for <code>Applicative</code>:</p>\n\n<pre><code>p &lt;- Person &lt;$&gt; newIORef \"Boston\" &lt;*&gt; newIORef 100\n</code></pre>\n\n<p>If you're using an older version of <code>base</code> you might have to </p>\n\n<pre><code>import Control.Applicative\n</code></pre>\n\n<p>to get <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code>.</p>\n\n<p>As an aside, in other languages (Agda, Idris) there is a spicy notation called <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/she/idiom.html\">idiom brackets</a> which makes things such as this very nice. If we had them in <a href=\"https://ocharles.org.uk/IdiomBrackets.html\">GHC</a> we could write this code like this instead (which is just notation for the above code):</p>\n\n<pre><code>p &lt;- (| Person (newIORef \"Boston\") (newIORef 100) |)\n</code></pre>\n\n<p>Which one might think leads to nicer code.</p>\n"}], "owner": {"reputation": 697, "user_id": 5821028, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f02b2f13bdf83954535307af466460a7?s=128&d=identicon&r=PG&f=1", "display_name": "eii0000", "link": "https://stackoverflow.com/users/5821028/eii0000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1526824016, "creation_date": 1485563238, "last_edit_date": 1526824016, "question_id": 41905124, "link": "https://stackoverflow.com/questions/41905124/how-to-use-io-monad-output-on-fly", "title": "how to use IO monad output on fly", "body": "<p>This is what I am doing:</p>\n\n<pre><code>data Person = Person (IORef String) (IORef Int)\nname &lt;- newIORef \"Boston\"\nage &lt;- newIORef 100\np = Person name age\n</code></pre>\n\n<p>I am wondering if I can put them in one line, like:</p>\n\n<pre><code>p = Person (newIORef \"Boston\") (newIORef (100::Int))\n</code></pre>\n\n<p>Is there any way to put them in one line?</p>\n"}, {"tags": ["haskell", "hashmap"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485549149, "post_id": 41902441, "comment_id": 70987249, "body": "Calm down... Please first explain the problem. Apparently you want to process jobs, but want some kind of uniqueness filter. Right?"}, {"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485549321, "post_id": 41902441, "comment_id": 70987333, "body": "No, I don&#39;t need a uniqueness filter, because I must write an answer for every input. 10 jobs in, 10 answers out. In the same order. I simply need a cache."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485549348, "post_id": 41902441, "comment_id": 70987345, "body": "Ah memoization so to speak?"}, {"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485549496, "post_id": 41902441, "comment_id": 70987418, "body": "Exactly. And I thought, a HashMap would be the best solution for this."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1485549547, "post_id": 41902441, "comment_id": 70987448, "body": "You can definitely use a HashMap here, just check if the key is in the map yet, if it is then you&#39;re done, otherwise execute the action and store its result in the HashMap."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485549552, "post_id": 41902441, "comment_id": 70987450, "body": "@Hennes: are you allowed to use packages, because there are elegant solutions for this."}, {"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1485549611, "post_id": 41902441, "comment_id": 70987482, "body": "@bheklilr That was my intention indeed. But I&#39;m stuck with the syntax."}, {"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485549777, "post_id": 41902441, "comment_id": 70987565, "body": "@Willem Van Onsem: I have access to all &quot;standard&quot; packages, like e.g. Data.HashMap.Lazy but getting &quot;new&quot; packages in production is a very complicated (read: bureaucratic) procedure."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1485549862, "post_id": 41902441, "comment_id": 70987611, "body": "@Hennes: I suppose <code>memoize</code> (<code>Data.Function.Memoize</code>) is not one of them? <a href=\"http://hackage.haskell.org/package/memoize-0.8.1/docs/Data-Function-Memoize.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/memoize-0.8.1/docs/&hellip;</a>"}, {"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "edited": false, "score": 0, "creation_date": 1485549954, "post_id": 41902441, "comment_id": 70987664, "body": "Pity, no. Just checked..."}], "answers": [{"comments": [{"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "edited": false, "score": 0, "creation_date": 1485552951, "post_id": 41903004, "comment_id": 70989184, "body": "So I insert my putStrLn directly before each of the &quot;returns&quot;?"}, {"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "edited": false, "score": 0, "creation_date": 1485553167, "post_id": 41903004, "comment_id": 70989301, "body": "Just for my couriosity: Can you tell me, how to do the same thing with a State Monad?"}, {"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "reply_to_user": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "edited": false, "score": 0, "creation_date": 1485561438, "post_id": 41903004, "comment_id": 70992140, "body": "yes and yes. but i probably cant update you this weekend."}], "tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": false, "score": 1, "last_activity_date": 1485551213, "creation_date": 1485551213, "answer_id": 41903004, "question_id": 41902441, "link": "https://stackoverflow.com/questions/41902441/haskell-how-to-use-a-hashmap-in-a-main-function/41903004#41903004", "title": "Haskell: How to use a HashMap in a main function", "body": "<p>I hope i'm not too far off base, but first you need a way to carry around the past jobs with you. Easiest would be to use a foldM instead of a forM.</p>\n\n<pre><code>import Control.Monad\nimport Data.Maybe\n\nmain = do\n  jobsToProcess &lt;- fmap read getLine\n  foldM doJobAcc acc0 [1..jobsToProcess] \n  where\n    acc0 = --initial value of some type of accumulator, i.e. hash map\n    doJobAcc acc _ = do\n      [r, k] &lt;- fmap (map read . words) getLine :: IO [Int]\n      case getFromHash acc (r,k) of\n         Nothing -&gt; do \n           i &lt;-  doSomeReallyLongWorkingJob r k\n           return $ insertNew acc (r,k) i\n         Just i -&gt; do\n            return acc\n</code></pre>\n\n<p>Note, I don't actually use the interface for putting and getting the hash table key. It doesn't actually have to be a hash table, Data.Map from containers could work. Or even a list if its going to be a small one.</p>\n\n<p>Another way to carry around the hash table would be to use a State transformer monad. </p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1485555097, "creation_date": 1485555097, "answer_id": 41903860, "question_id": 41902441, "link": "https://stackoverflow.com/questions/41902441/haskell-how-to-use-a-hashmap-in-a-main-function/41903860#41903860", "title": "Haskell: How to use a HashMap in a main function", "body": "<p>It's pretty simple to make a stateful action that caches operations. First some boilerplate:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\nimport Control.Monad.State\nimport Data.Map (Map)\nimport qualified Data.Map as M\nimport Debug.Trace\n</code></pre>\n\n<p>I'll use <code>Data.Map</code>, but of course you can substitute in a hash map or any similar data structure without much trouble. My long-running computation will just add up its arguments. I'll use <code>trace</code> to show when this computation is executed; we'll hope not to see the output of the <code>trace</code> when we enter a duplicate input.</p>\n\n<pre><code>reallyLongRunningComputation :: [Int] -&gt; Int\nreallyLongRunningComputation args = traceShow args $ sum args\n</code></pre>\n\n<p>Now the caching operation will just look up whether we've seen a given input before. If we have, we'll return the precomputed answer; otherwise we'll compute the answer now and store it.</p>\n\n<pre><code>cache :: (MonadState (Map a b) m, Ord a) =&gt; (a -&gt; b) -&gt; a -&gt; m b\ncache f x = do\n    mCached &lt;- gets (M.lookup x)\n    case mCached of\n        -- depending on your goals, you may wish to force `result` here\n        Nothing -&gt; modify (M.insert x result) &gt;&gt; return result\n        Just cached -&gt; return cached\n    where\n    result = f x\n</code></pre>\n\n<p>The <code>main</code> function now just consists of calling <code>cache reallyLongRunningComputation</code> on appropriate inputs.</p>\n\n<pre><code>main = do\n    iterations &lt;- readLn\n    flip evalStateT M.empty . replicateM_ iterations\n        $   liftIO getLine\n        &gt;&gt;= liftIO . mapM readIO . words\n        &gt;&gt;= cache reallyLongRunningComputation\n        &gt;&gt;= liftIO . print\n</code></pre>\n\n<p>Let's try it in ghci!</p>\n\n<pre><code>&gt; main\n5\n1 2 3\n[1,2,3]\n6\n4 5\n[4,5]\n9\n1 2\n[1,2]\n3\n1 2\n3\n1 2 3\n6\n</code></pre>\n\n<p>As you can see by the bracketed outputs, <code>reallyLongRunningComputation</code> was called the first time we entered <code>1 2 3</code> and the first time we entered <code>1 2</code>, but not the second time we entered these inputs.</p>\n"}, {"tags": [], "owner": {"reputation": 116, "user_id": 6547624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08f75f218c20de8477dfe388ed8171af?s=128&d=identicon&r=PG&f=1", "display_name": "M&#246;r&#246;k&#246;lli", "link": "https://stackoverflow.com/users/6547624/m%c3%b6r%c3%b6k%c3%b6lli"}, "is_accepted": false, "score": 0, "last_activity_date": 1496228089, "creation_date": 1496228089, "answer_id": 44282854, "question_id": 41902441, "link": "https://stackoverflow.com/questions/41902441/haskell-how-to-use-a-hashmap-in-a-main-function/44282854#44282854", "title": "Haskell: How to use a HashMap in a main function", "body": "<p>I am just adding this answer since I feel like the other answers are diverging a bit from the original question, namely using hashtable constructs in Main function (inside IO monad).</p>\n\n<p>Here is a minimal hashtable example using <a href=\"https://hackage.haskell.org/package/hashtables-1.2.1.1/docs/Data-HashTable-IO.html\" rel=\"nofollow noreferrer\">hashtables</a> module. To install the module with cabal, simply use</p>\n\n<blockquote>\n  <p>cabal install hashtables</p>\n</blockquote>\n\n<p>In this example, we simply put some values in a hashtable and use lookup to print a value retrieved from the table.</p>\n\n<pre><code>import qualified Data.HashTable.IO as H\n\nmain :: IO ()\nmain = do\n        t &lt;- H.new :: IO (H.CuckooHashTable Int String)\n        H.insert t 22 \"Hello world\"\n        H.insert t 5 \"No problem\"\n        msg &lt;- H.lookup t 5\n        print msg\n</code></pre>\n\n<p>Notice that we need to use explicit type annotation to specify which implementation of the hashtable we wish to use.</p>\n"}], "owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 920, "favorite_count": 0, "accepted_answer_id": 41903860, "answer_count": 3, "score": 0, "last_activity_date": 1496228089, "creation_date": 1485548665, "last_edit_date": 1485549087, "question_id": 41902441, "link": "https://stackoverflow.com/questions/41902441/haskell-how-to-use-a-hashmap-in-a-main-function", "title": "Haskell: How to use a HashMap in a main function", "body": "<p>I beg for your help, speeding up the following program:</p>\n\n<pre><code>main = do\n  jobsToProcess &lt;- fmap read getLine\n  forM_ [1..jobsToProcess] $ \\_ -&gt; do\n    [r, k] &lt;- fmap (map read . words) getLine :: IO [Int]\n    putStrLn $ doSomeReallyLongWorkingJob r k\n</code></pre>\n\n<p>There could(!) be a lot of identical jobs to do, but it's not up to me modifying the inputs, so I tried to use <code>Data.HashMap</code> for backing up already processed jobs. I already optimized the algorithms in the <code>doSomeReallyLongWorkingJob</code> function, but now it seems, it's quite as fast as C.</p>\n\n<p>But unfortunately it seems, I'm not able to implement a simple cache without producing a lot of errors. I need a simple cache of Type <code>HashMap (Int, Int) Int</code>, but everytime I have too much or too few brackets. And IF I manage to define the cache, I'm stuck in putting data into or retrieving data from the cache cause of lots of errors.</p>\n\n<p>I already Googled for some hours but it seems I'm stuck. BTW: The result of the <code>longrunner</code> is an <code>Int</code> as well.</p>\n"}, {"tags": ["haskell", "command-line"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1485536721, "post_id": 41899108, "comment_id": 70980896, "body": "If you know up front all the choices for <code>PROGRAM</code> it&#39;s easy. Otherwise you&#39;re going to be writing most of the logic yourself, I think."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485537544, "post_id": 41899108, "comment_id": 70981353, "body": "Possibly relevant, although again only if you know upfront the possible <code>PROGRAM</code> values: <a href=\"https://wiki.haskell.org/Command_line_option_parsers\" rel=\"nofollow noreferrer\">wiki.haskell.org/Command_line_option_parsers</a>"}, {"owner": {"reputation": 1713, "user_id": 1121552, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tX32x.png?s=128&g=1", "display_name": "jonaprieto", "link": "https://stackoverflow.com/users/1121552/jonaprieto"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1485538159, "post_id": 41899108, "comment_id": 70981697, "body": "@DanielWagner No. I don&#39;t know the names, they constantly change."}], "answers": [{"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": false, "score": 2, "last_activity_date": 1485545065, "creation_date": 1485545065, "answer_id": 41901537, "question_id": 41899108, "link": "https://stackoverflow.com/questions/41899108/implementing-another-kind-of-flags-in-haskell/41901537#41901537", "title": "Implementing another kind of flags in Haskell", "body": "<p>In a recent project of mine I used an approach based on a 'Data.Tree' of option handling nodes. Of course, I haven't released this code so it's of very limited use, but I think the scheme might be helpful.</p>\n\n<pre><code>data OptHandle = Op { optSat :: String -&gt; Bool\n                    , opBuild :: [String] -&gt; State Env [String]\n                    }\n</code></pre>\n\n<p>The node fields: check to see if the argument satisfied the node; and incrementally built up an initial program environment based on the the remaining arguments (returning unused arguments to be processed by nodes lower in the tree.)</p>\n\n<p>An option processing tree is then hard coded, such as below.</p>\n\n<pre><code>pgmOptTree :: [Tree OptHandle] \npgmOptTree = [mainHelpT,pgmOptT,dbgT]\n\nmainHelpT :: Tree OptHandle\nmainHelpT = Node (Op sat bld) []\n  where\n    sat \"--help\" = True\n    sat _ = False\n    bld _ = do\n      mySetEnvShowHelp\n      return []\n\npgmOptT :: Tree OptHandle\npgmOptT = Node (Op sat bld) [dbgT]\n  where\n    sat = functionOn . someParse\n    bld ss = do\n       let (d,ss') = parsePgmOption ss\n       mySetEnvPgmOpt d \n       return ss' \n</code></pre>\n\n<p>You will also need a function which feeds the command line arguments to the tree, checking satisfiability of each node in a forest, executing the opBuild, and calling subforests. After running the handler in the state monad, you should be returned an initial starting environment which can be used to tell main the functionality you want to call.</p>\n\n<p>The option handler I used was actually a little more complicated than this, as my program communicated with Bash to perform tab completions, and included help for most major options. I found the benefit to the approach was that I could more easily keep in sync three command line concerns: enabling tab completions which could inform users the next available commands; providing help for incomplete commands; and actually running the program for complete commands.</p>\n\n<p>Maintaining a tree like this is nice because you can reuse nodes at different points, and add options that work with the others fairly easily.</p>\n"}], "owner": {"reputation": 1713, "user_id": 1121552, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tX32x.png?s=128&g=1", "display_name": "jonaprieto", "link": "https://stackoverflow.com/users/1121552/jonaprieto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1485545065, "creation_date": 1485536085, "last_edit_date": 1485536613, "question_id": 41899108, "link": "https://stackoverflow.com/questions/41899108/implementing-another-kind-of-flags-in-haskell", "title": "Implementing another kind of flags in Haskell", "body": "<p>We have the classic flags in the command line tools, those that enable something (without arguments, e.g <code>--help</code> or <code>--version</code>) and others kind of flags that accept arguments (e.g. <code>--output-dir=/home/</code> or <code>--input-file=\"in.a\"</code>, whatever).</p>\n\n<p>But this time, I would like to implement the following kind of.</p>\n\n<pre><code>$ myprogram --GCC-option=\"--stdlib 11\" --debug\n</code></pre>\n\n<p>In a general way, the flag is like <code>\"--PROGRAM-option=ARGUMENT\"</code>. Then, I keep from this flag, <code>PROGRAM</code> and <code>ARGUMENT</code> values, they are variables. In the example above, we have <code>PROG=GCC</code> and <code>ARGUMENT=--stdlib 11</code>.</p>\n\n<p>How should can I implement this feature in Haskell? I have some experience parsing options in the classic way.</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1485531232, "post_id": 41897248, "comment_id": 70977370, "body": "Please show in the question what went wrong in your attempt. (In this case, I was able to correctly guess the error you got, but in other questions it might be trickier to do that.)"}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 0, "creation_date": 1485532556, "post_id": 41897248, "comment_id": 70978272, "body": "If the problem is simply the error <code>Constraint is no smaller than the instance head</code>, here is a good explanation and solution (use a newtype) - <a href=\"http://stackoverflow.com/a/7198951/348716\">stackoverflow.com/a/7198951/348716</a>"}, {"owner": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485534400, "post_id": 41897248, "comment_id": 70979441, "body": "updated the question. It&#39;s not that error. Sorry taking so long @duplode"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1485535182, "post_id": 41897248, "comment_id": 70979902, "body": "No worries. If you turn on the <code>FlexibleInstances</code> extension as the error message suggests, you will get the &quot;Constraint is no smaller [...]&quot; error the other question discusses."}], "answers": [{"tags": [], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "is_accepted": false, "score": 2, "last_activity_date": 1485621708, "creation_date": 1485621708, "answer_id": 41912218, "question_id": 41897248, "link": "https://stackoverflow.com/questions/41897248/how-to-make-a-type-class-instance-of-another-type-class/41912218#41912218", "title": "How to make a type class instance of another type class", "body": "<p>I did three things to make your example working:</p>\n\n<p>1.) At the beginning, I added two Language extensions:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE UndecidableInstances #-}\n</code></pre>\n\n<p>2.) I removed the self reference to <code>Booleanizable a</code> in the definition of the class Booleanizable: </p>\n\n<p>Instead of </p>\n\n<pre><code>class Booleanizable a where\n    toBoolean :: (Booleanizable a) =&gt; a -&gt; Boolean\n</code></pre>\n\n<p>use</p>\n\n<pre><code>class Booleanizable a where\n    toBoolean :: a -&gt; Boolean\n</code></pre>\n\n<p>3.) I added an additional constraint <code>Eq a</code> to your last instance definition:</p>\n\n<pre><code>instance (Num a, Eq a) =&gt; Booleanizable a where\n    toBoolean 0 = Boolean 0\n    toBoolean _ = Boolean 1\n</code></pre>\n"}], "owner": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1485621708, "creation_date": 1485530243, "last_edit_date": 1485562715, "question_id": 41897248, "link": "https://stackoverflow.com/questions/41897248/how-to-make-a-type-class-instance-of-another-type-class", "title": "How to make a type class instance of another type class", "body": "<p>I'm making a <code>Boolean</code> data, that accepts others types as boolean values, just for fun. I have created the data <code>Boolean</code>, for representing the actual <code>Boolean</code> value, and I have made a class named <code>Booleanizable</code>, that represents values that can be turned into Boolean data. The problem is the following: I want to make a single <code>instance</code> statement for every type that belongs to <code>Num</code> class, instead of making a statement for each type. How do I do that?\nJust to make it clearer, the code:</p>\n\n<pre><code>module Boolean(\n    Boolean,\n    true,\n    false,\n    Booleanizable\n) where\n\n\n\ndata Boolean = Boolean Int\n\nfalse = Boolean 0\ntrue = Boolean 1\n\ninstance Show Boolean where\n    show (Boolean 0) = \"false\"\n    show (Boolean 1) = \"true\"\n\ninstance Eq Boolean where\n    (Boolean 0) == (Boolean 0) = True\n    (Boolean 0) == (Boolean 1) = False\n    (Boolean 1) == (Boolean 1) = True\n    (Boolean 1) == (Boolean 0) = False\n\n\n\nclass Booleanizable a where\n    toBoolean :: (Booleanizable a) =&gt; a -&gt; Boolean\n\ninstance Booleanizable Boolean where\n    toBoolean (Boolean x) = Boolean x\n\ninstance Booleanizable Bool where\n    toBoolean True = Boolean 1\n    toBoolean False = Boolean 0\n</code></pre>\n\n<p>And what I'm trying to do:</p>\n\n<pre><code>instance (Num a) =&gt; Booleanizable a where\n    toBoolean 0 = Boolean 0\n    toBoolean _ = Boolean 1\n</code></pre>\n\n<p>This is the error that appears:</p>\n\n<pre><code>Boolean.hs:37:21:\n    Illegal instance declaration for \u2018Booleanizable a\u2019\n      (All instance types must be of the form (T a1 ... an)\n       where a1 ... an are *distinct type variables*,\n       and each type variable appears at most once in the instance head.\n       Use FlexibleInstances if you want to disable this.)\n    In the instance declaration for \u2018Booleanizable a\u2019\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1485529676, "post_id": 41896211, "comment_id": 70976286, "body": "Is it relevant that you misspelled <code>&quot;instrumentedopaleye&quot;</code> in ghci?"}, {"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 0, "creation_date": 1485532877, "post_id": 41896211, "comment_id": 70978489, "body": "It&#39;s not getting confused, it&#39;s providing you helpful suggestions :) As Reid Burton pointed out, you have a typo in the module name in the package import statement."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1485536033, "post_id": 41896211, "comment_id": 70980472, "body": "@ReidBarton Thanks for pointing that out. Have updated my GHCi session output. GHCi is still getting confused with a different error."}], "answers": [{"tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 2, "last_activity_date": 1485539373, "creation_date": 1485539373, "answer_id": 41900061, "question_id": 41896211, "link": "https://stackoverflow.com/questions/41896211/how-to-use-packageimports-extension-to-shadow-a-module/41900061#41900061", "title": "How to use PackageImports extension to &quot;shadow&quot; a module?", "body": "<p>I'm seeing this behavior even <em>before</em> you do a package-qualified import. For example, if I have both <code>cryptonite</code> and <code>crypto-api</code> installed with stack previously, then</p>\n\n<pre><code>&gt; stack exec ghci\n$ :browse Crypto.Random\n</code></pre>\n\n<p>causes an <code>ambiguous module name</code> error. This is a problem I've run into a lot; my solution is to use the <code>-hide-package</code> flag:</p>\n\n<pre><code>&gt; stack exec ghci\n$ :set -hide-package cryptonite\n$ :browse Crypto.Random\n</code></pre>\n\n<p>As an added bonus, you no longer need <code>PackageImports</code> at all: ghci is completely ignoring <code>cryptonite</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "is_accepted": false, "score": 1, "last_activity_date": 1485579626, "creation_date": 1485579626, "answer_id": 41906492, "question_id": 41896211, "link": "https://stackoverflow.com/questions/41896211/how-to-use-packageimports-extension-to-shadow-a-module/41906492#41906492", "title": "How to use PackageImports extension to &quot;shadow&quot; a module?", "body": "<p>I was unable to make this work in GHCi without explicitly hiding <code>scotty</code> as per [crockeea's answer][1]</p>\n\n<p>Also, due to [Haskell's module limitation][2] one cannot re-export a qualified import. Therefore, here's how I managed to solve my original problem of shadowing scotty:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE PackageImports #-}\n\nmodule Web.Scotty.Trans\n  (\n    module Web.Scotty.Trans -- which is the current module\n  , module Web.Scotty.TransOriginal -- the original module MINUS the shadowed methods\n  )\nwhere\n\nimport Web.Scotty.TransOriginal\nimport qualified \"scotty\" Web.Scotty.Trans as S\n\nimport InstrumentedCore\nimport Control.Monad.Trans.Class(lift)\n\ninstrumentedAction original action = original action_\n  where\n    action_ = do\n      st &lt;- liftIO $ getCurrentTime\n      result &lt;- action\n      en &lt;- liftIO $ getCurrentTime\n      logInstrumentationData InstrumentationData{instrStart=st, instrEnd=en, instrPayload=Render}\n      return result\n\n\nget route action = instrumentedAction (S.get route) action\npost route action = instrumentedAction (S.post route) action\nput route action = instrumentedAction (S.put route) action\ndelete route action = instrumentedAction (S.delete route) action\npatch route action = instrumentedAction (S.patch route) action\noptions route action = instrumentedAction (S.options route) action\naddroute method route action = instrumentedAction (S.addroute method route) action\n</code></pre>\n\n<p>The <em>boilerplate</em> <code>Web.Scotty.TransOriginal</code> which is required only to get around Haskell's limitation around re-exporting qualified imports:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE PackageImports #-}\n\nmodule Web.Scotty.TransOriginal\n  (\n    module Web.Scotty.Trans\n  )\nwhere\n\nimport \"scotty\" Web.Scotty.Trans hiding (get, post, put, delete, patch, options, addroute)\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 344, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1485579626, "creation_date": 1485527095, "last_edit_date": 1485535934, "question_id": 41896211, "link": "https://stackoverflow.com/questions/41896211/how-to-use-packageimports-extension-to-shadow-a-module", "title": "How to use PackageImports extension to &quot;shadow&quot; a module?", "body": "<p>I'm trying to \"shadow\" the Scotty module using the <code>PackageImports</code> extension.</p>\n\n<p><strong>Use case:</strong> For someone using a library <code>X</code> make <code>instrumentedX</code> available. So, simply by changing <code>X</code> to <code>instrumentedX</code> in their cabal file, they can use the instrumented version of the library -- without any other change in code.</p>\n\n<p>Here's the module that I want to export, which has the same name, i.e. <code>Web.Scotty.Trans</code> as the original module exported by Scotty.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE PackageImports #-}\n\nmodule Web.Scotty.Trans\n  (\n    module OS\n  , get\n  , post\n  , put\n  , delete\n  , patch\n  , options\n  , addroute\n  )\nwhere\n\nimport qualified \"scotty\" Web.Scotty.Trans as OS hiding (get, post, put, delete, patch, options, addroute)\nimport qualified \"scotty\" Web.Scotty.Trans as S\n\nimport InstrumentedCore\nimport Control.Monad.Trans.Class(lift)\n\ninstrumentedAction original action = original action_\n  where\n    action_ = do\n      st &lt;- liftIO $ getCurrentTime\n      result &lt;- action\n      en &lt;- liftIO $ getCurrentTime\n      logInstrumentationData InstrumentationData{instrStart=st, instrEnd=en, instrPayload=Render}\n      return result\n\n\nget route action = instrumentedAction (S.get route) action\npost route action = instrumentedAction (S.post route) action\nput route action = instrumentedAction (S.put route) action\ndelete route action = instrumentedAction (S.delete route) action\npatch route action = instrumentedAction (S.patch route) action\noptions route action = instrumentedAction (S.options route) action\naddroute method route action = instrumentedAction (S.addroute method route) action\n</code></pre>\n\n<p>Here's what my cabal file looks like. While my package depends on <code>scotty</code> it uses a different package name for itself, i.e. <code>instrumentedopaleye</code> (don't get into the semantics -- I'm trying to shadow a lot of other modules as well!)</p>\n\n<pre><code>name:                instrumentedopaleye\nversion:             0.1.0.0\nsynopsis:            Initial project template from stack\ndescription:         Please see README.md\nhomepage:            https://github.com/githubuser/dashboard#readme\nlicense:             BSD3\nauthor:              Author name here\nmaintainer:          example@example.com\ncopyright:           2016 Author name here\ncategory:            Web\nbuild-type:          Simple\nextra-source-files:  README.md\ncabal-version:       &gt;=1.10\n\nlibrary\n  hs-source-dirs:      src\n  exposed-modules:     InstrumentedOpaleye\n                     , Instrumented\n                     , InstrumentedOpaleye.Internal.PGTypes\n                     , InstrumentedOpaleye.Internal.Column\n                     , InstrumentedOpaleye.Internal.RunQuery\n                     , InstrumentedOpaleye.Internal.HaskellDB.PrimQuery\n                     , InstrumentedLucid\n                     , Web.Scotty.Trans\n                     , InstrumentedCore\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                     , opaleye\n                     , profunctors\n                     , product-profunctors\n                     , postgresql-simple\n                     , mtl\n                     , time\n                     , stm\n                     , text\n                     , uuid\n                     , lucid\n                     , scotty\n                     , transformers\n  default-language:    Haskell2010\n</code></pre>\n\n<p><strong>The actual error</strong> </p>\n\n<p>And here's what happens when I try to import my version of <code>Web.Scotty.Trans</code> in the GHCi. Given that I have explicitly imported <strong>only</strong> my version of <code>Web.Scotty.Trans</code> why is GHCi getting confused in resolving the <code>get</code> function? Even <code>:browse Web.Scotty.Trans</code> is getting confused.</p>\n\n<pre><code>Saurabhs-MacBook-Pro:instrumentedopaleye saurabhnanda$ stack exec ghci\nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :set -fobject-code\nPrelude&gt; :set -XPackageImports\nPrelude&gt; import \"instrumentedopaleye\" Web.Scotty.Trans\nPrelude Web.Scotty.Trans&gt; :i get\n\n&lt;interactive&gt;:1:1: error:\n    Ambiguous interface for \u2018Web.Scotty.Trans\u2019:\n      it was found in multiple packages:\n      scotty-0.11.0 instrumentedopaleye-0.1.0.0\nPrelude Web.Scotty.Trans&gt; :browse Web.Scotty.Trans\n\n&lt;no location info&gt;: error:\n    Ambiguous module name \u2018Web.Scotty.Trans\u2019:\n      it was found in multiple packages:\n      scotty-0.11.0@scotty-0.11.0-2sNTuGP3mb3FV66hlreoEd instrumentedopaleye-0.1.0.0@instrumentedopaleye-0.1.0.0-EAOrgrhUGi83yaJJ8gDGX4\n</code></pre>\n"}, {"tags": ["algorithm", "haskell", "recursion", "memoization", "catalan"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1485513288, "post_id": 41890669, "comment_id": 70965762, "body": "Binary search trees <a href=\"https://github.com/haskell/containers/blob/master/Data/IntMap/Internal.hs#L347-L352\" rel=\"nofollow noreferrer\">like <code>IntMap</code></a> are slower than hash maps in terms of <i>asymptotic</i> performance, yes. Asymptotics aren&#39;t everything, though. <code>IntMap</code> has a number of other desirable properties, such as avoiding the overhead of hashing, behaving well when used in a persistent manner, etc. For normal usages <code>IntMap</code>&#39;s performance is competitive with a hash table."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 4, "creation_date": 1485529536, "post_id": 41890669, "comment_id": 70976193, "body": "It depends on the problem. If arrays are appropriate, for example when you will eventually have to evaluate the function on every value in a range, then they are probably the most efficient choice."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485543949, "post_id": 41890669, "comment_id": 70984731, "body": "As a side note, the last stack overflow answer you are linking to is written by Jon Harrop. <a href=\"https://www.reddit.com/r/haskell/comments/4ogle3/post_about_the_disadvantages_of_functional/d4clabv/\" rel=\"nofollow noreferrer\">Here</a> is a comment @sclv wrote a while back that I think is relevant."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485545066, "post_id": 41890669, "comment_id": 70985276, "body": "This question as it stands is much too broad because the memoization technique really depends on the situation - and there are many. If you edit your question to have a couple examples, you will have a better chance at getting an answer."}, {"owner": {"reputation": 511, "user_id": 1525027, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5d83f46a9e0de4cd812d95755e5b5d51?s=128&d=identicon&r=PG&f=1", "display_name": "Potato", "link": "https://stackoverflow.com/users/1525027/potato"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485552655, "post_id": 41890669, "comment_id": 70989019, "body": "@Alec I agree that it&#39;s too broad. Thanks for pointing that out. I added two concrete examples I&#39;m interested in. Does that improve things?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1485557589, "post_id": 41890669, "comment_id": 70991106, "body": "I just want to point out that in general you are better off looking for the mathematical solution in the Project Euler solutions. Sure,.you <i>can</i> theoretically speed up your code by letting your code run on a GPU, but is it really <i>necessary</i>? IMO it generally isn&#39;t."}, {"owner": {"reputation": 511, "user_id": 1525027, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5d83f46a9e0de4cd812d95755e5b5d51?s=128&d=identicon&r=PG&f=1", "display_name": "Potato", "link": "https://stackoverflow.com/users/1525027/potato"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1485562294, "post_id": 41890669, "comment_id": 70992308, "body": "@ThreeFx There are problems on there for which mathematics only helps so much. At some point you need a good algorithm, too, and I&#39;ve personally found memoization to be very helpful. But I don&#39;t know the best way to implement it, hence this question."}, {"owner": {"reputation": 511, "user_id": 1525027, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5d83f46a9e0de4cd812d95755e5b5d51?s=128&d=identicon&r=PG&f=1", "display_name": "Potato", "link": "https://stackoverflow.com/users/1525027/potato"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1485562629, "post_id": 41890669, "comment_id": 70992388, "body": "@ReidBarton Thanks for the input. I&#39;ve made the question more precise."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485587646, "post_id": 41890669, "comment_id": 70996412, "body": "I voted to close this before it edited. As it stands now, I think it is quite answerable and should be reopened"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1485691310, "post_id": 41890669, "comment_id": 71022165, "body": "You may be interested in this nice link with description how to perform lazy dynamic programming and kind of memoization you want: <a href=\"http://jelv.is/blog/Lazy-Dynamic-Programming/\" rel=\"nofollow noreferrer\">jelv.is/blog/Lazy-Dynamic-Programming</a>"}, {"owner": {"reputation": 511, "user_id": 1525027, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5d83f46a9e0de4cd812d95755e5b5d51?s=128&d=identicon&r=PG&f=1", "display_name": "Potato", "link": "https://stackoverflow.com/users/1525027/potato"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1485719028, "post_id": 41890669, "comment_id": 71030754, "body": "@Shersh That&#39;s really great. Thanks for the pointer!"}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1485725685, "post_id": 41890669, "comment_id": 71032922, "body": "Did you check out <code>monad-memo</code> and the performance chart for the fibonacci fn given <a href=\"https://github.com/EduardSergeev/monad-memo\" rel=\"nofollow noreferrer\">here</a>?"}, {"owner": {"reputation": 511, "user_id": 1525027, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5d83f46a9e0de4cd812d95755e5b5d51?s=128&d=identicon&r=PG&f=1", "display_name": "Potato", "link": "https://stackoverflow.com/users/1525027/potato"}, "reply_to_user": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1485726477, "post_id": 41890669, "comment_id": 71033169, "body": "@liminalisht I haven&#39;t! That&#39;s awesome. Thanks for the pointer. If you wanted to type a summary of that as an answer (I don&#39;t quite know enough to do a good job...) I could accept it."}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1485727464, "post_id": 41890669, "comment_id": 71033457, "body": "@Potato I don&#39;t know enough about memoization to write up a good answer unfortunately."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1485885508, "post_id": 41890669, "comment_id": 71107644, "body": "The best approach still depends on the situation: do you know up front the values you will need to memoize, are they a range of consecutive integers, what time/space tradeoffs do you want to make. The functions themselves aren&#39;t really the important thing."}, {"owner": {"reputation": 511, "user_id": 1525027, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5d83f46a9e0de4cd812d95755e5b5d51?s=128&d=identicon&r=PG&f=1", "display_name": "Potato", "link": "https://stackoverflow.com/users/1525027/potato"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1485903957, "post_id": 41890669, "comment_id": 71116813, "body": "@ReidBarton I&#39;m thinking of a problem like: find the sum of f(n) over all prime n less than some fixed large number (where we choose the number to make the benchmarking times reasonable). I&#39;m not knowledgable enough to have an opinion on time/space tradeoffs. I just want something that runs fast on my laptop."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1486004665, "post_id": 41890669, "comment_id": 71164075, "body": "I mean, why don&#39;t you write some simple criterion benchmarks and compare the approaches yourself?"}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1485722448, "post_id": 41920627, "comment_id": 71031792, "body": "&quot;I&#39;m aware there are explicit formulas for these, but let&#39;s ignore that, because the real point here is to use them to benchmark memoization techniques.&quot;"}, {"owner": {"reputation": 14766, "user_id": 483486, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/fcf225aa724d9bb05f6693dc8cf8c459?s=128&d=identicon&r=PG", "display_name": "OmnipotentEntity", "link": "https://stackoverflow.com/users/483486/omnipotententity"}, "edited": false, "score": 2, "creation_date": 1486265023, "post_id": 41920627, "comment_id": 71269190, "body": "The explicit formula for Fibonacci sequence is actually slower to evaluate, because you must evaluate it symbolically rather than numerically.  I implemented it once to see, and I think it wound up being O(n^2) or thereabouts."}], "tags": [], "owner": {"reputation": 777, "user_id": 5303318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh6.googleusercontent.com/-qykohYXsIz0/AAAAAAAAAAI/AAAAAAAAADc/G9CJWc1s3dM/photo.jpg?sz=128", "display_name": "milad zahedi", "link": "https://stackoverflow.com/users/5303318/milad-zahedi"}, "is_accepted": false, "score": 1, "last_activity_date": 1485691077, "creation_date": 1485691077, "answer_id": 41920627, "question_id": 41890669, "link": "https://stackoverflow.com/questions/41890669/whats-the-most-efficient-way-to-memoize-in-haskell/41920627#41920627", "title": "What&#39;s the most efficient way to memoize in Haskell?", "body": "<p>When Trying to find the nth fibonacci number the only numbers that you need to memoize are the two previous numbers. you can do it as a tuple like (f n-1, f n ) and on each loop update this tuple. note that updating the tuple is done through pointer manipulation and is not computationally expensive. </p>\n\n<p>a cleaner and slightly smarter alternative would be:</p>\n\n<pre><code>fibs :: [Integer]\nfibs = fibcreator 0 1\n  where\n    fibcreator a b = a : fibcreator b (a+b)\n\nnth = take n fibs\n</code></pre>\n\n<p>But one of the best algorithms that I have seen is this:</p>\n\n<ol>\n<li>let's define a matrix m = [e11 = 1,e12 =1,e21 = 1,e22 = 0]</li>\n<li>to get nth fibonacci number we compute m' = m ^ (n-1)</li>\n<li>e11 element in the matrix m' is the nth fibonacci number</li>\n</ol>\n\n<p>Now what is great here is that in order to get 17 fibonacci number we can do </p>\n\n<pre><code>m' = ((((m^2)^2)^2)^2) * m\n</code></pre>\n\n<p>This significantly reduces the computaion time and passively embeds the memoization within the algorithm. \nThe punchline is that Haskell already uses this algorithm to compute the power function, so you don't need to implement it. the full implementation is :</p>\n\n<pre><code>data Matrix = Matrix Integer Integer Integer Integer\n\ninstance Num Matrix where\n  (*) (Matrix a11 a12 a21 a22) (Matrix b11 b12 b21 b22)\n   = Matrix (a11*b11 + a12*b21) (a11*b12 + a12*b22) (a21*b11 + a22*b21) (a21*b12 + a22*b22)\n\nfib4 :: Integer -&gt; Integer\nfib4 0 = 0\nfib4 n = x\n  where\n    (Matrix x _ _ _) = Matrix 1 1 1 0 ^ (n-1)\n</code></pre>\n"}], "owner": {"reputation": 511, "user_id": 1525027, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5d83f46a9e0de4cd812d95755e5b5d51?s=128&d=identicon&r=PG&f=1", "display_name": "Potato", "link": "https://stackoverflow.com/users/1525027/potato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 911, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1485951546, "creation_date": 1485509458, "last_edit_date": 1495535370, "question_id": 41890669, "link": "https://stackoverflow.com/questions/41890669/whats-the-most-efficient-way-to-memoize-in-haskell", "title": "What&#39;s the most efficient way to memoize in Haskell?", "body": "<p>What's the fastest way to memoize a recursive function in Haskell?</p>\n\n<p>Background: Recently I have been solving Project Euler problems in Haskell. Many require many computations of a recursively defined combinatorial or number-theoretical function, for example the Fibonacci numbers. Performance improves dramatically if such functions are memoized, that is, the results of the function are cached for later use.</p>\n\n<p>I have seen many solutions to this problem. The most elegant seems to be <a href=\"https://stackoverflow.com/questions/11466284/how-is-this-fibonacci-function-memoized\">this.</a> One uses Data.IntMap (or hash tables) and the State monad. A tree based solution suggested in <a href=\"https://stackoverflow.com/a/3209189/1525027\">this answer</a>, and such solutions seem fairly common. To give another example, see <a href=\"http://conal.net/blog/posts/elegant-memoization-with-functional-memo-tries\" rel=\"nofollow noreferrer\">this blog post</a>. I've seen other solutions using built-in functions. There's one in section 2 <a href=\"https://stackoverflow.com/a/34647439/1525027\">here</a> with the <code>fix</code>, and further it seems that the compiler can sometimes be <a href=\"https://stackoverflow.com/a/34647439/1525027\">massaged into memoizing</a> without additional work. There's also several <a href=\"http://hackage.haskell.org/package/data-memocombinators\" rel=\"nofollow noreferrer\">prebuilt solutions</a>.</p>\n\n<p>I'm wondering which memoization method is fastest in practice for the kinds of functions used in Project Euler. My intuition says the hashtables library is, since hash tables seem to be the preferred dictionary structure in imperative languages. The purely functional tree solutions are cool, but my Googling tells me they're <a href=\"https://stackoverflow.com/a/10897664/1525027\">strictly worse than hash tables in terms of asymptotic performance.</a> </p>\n\n<h1>Edit</h1>\n\n<p>A few comments said this question is too broad to answer, and upon reflection I agree. So let me give two concrete examples of functions to memoize: a function that computes the n'th Fibonacci number recursively, and one that computes the Catalan numbers recursively. I would like to compute these functions many times for large n.</p>\n\n<p>I'm aware there are explicit formulas for these, but let's ignore that, because the real point here is to use them to benchmark memoization techniques. </p>\n"}, {"tags": ["haskell", "algebraic-data-types"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1485520734, "post_id": 41889738, "comment_id": 70970172, "body": "Maybe safe casts can help here reducing the wrap/unwrapping. Otherwise, one could define some custom pattern synonyms to allow pattern matching on <code>Dictionary</code> similarly to what happens for lists."}], "answers": [{"comments": [{"owner": {"reputation": 2379, "user_id": 5045375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/17ed0af705e0449fe49b74d8814a8ce2?s=128&d=identicon&r=PG", "display_name": "Filip Allberg", "link": "https://stackoverflow.com/users/5045375/filip-allberg"}, "edited": false, "score": 0, "creation_date": 1485509672, "post_id": 41890585, "comment_id": 70963522, "body": "Regarding <code>head</code> &amp; <code>tail</code>, I know but it is good that you mention it.  I&#39;ll look into <code>Monoid</code> and accept your answer if that seems to pan out.  The problem is that it&#39;s not a proper map. The data has to be sorted by <code>snd</code> primarily, and <code>fst</code> secondarily. I could (maybe) use <code>Data.Set</code>. But I still want to use list operations. Would <code>Monoid</code> (and possibly <code>Foldable</code>/<code>Traversable</code>) still be suitable?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1485509199, "creation_date": 1485509199, "answer_id": 41890585, "question_id": 41889738, "link": "https://stackoverflow.com/questions/41889738/retaining-list-ness-operations-for-a-data-type/41890585#41890585", "title": "Retaining list-ness operations for a data type", "body": "<p>Never use <code>head</code> and avoid using <code>tail</code>, for lists or else. These are unsafe and can always easily be replaced with pattern matching.</p>\n\n<p>But yes, there is a typeclass that supports list-like operations, or rather multiple classes. The simplest of these is <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Monoid.html#t:Monoid\"><code>Monoid</code></a>, which just implements concatenation and empty-initialisation. <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Foldable.html\"><code>Foldable</code></a>, allows you to deconstruct containers as if they were lists. <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Traversable.html\"><code>Traversable</code></a> additionally allows you to assemble them again as you go over the data.</p>\n\n<p>The latter two won't quite work with <code>Dictionary</code> because it's not parametric on the contained type. You can circumvent that by switching to the <a href=\"http://hackage.haskell.org/package/mono-traversable-1.0.1.1/docs/Data-MonoTraversable.html#t:MonoFoldable\">\u201cmonomorphic version\u201d</a>.</p>\n\n<p>However, I frankly don't think you should do any of this \u2013 just use the standard <a href=\"http://hackage.haskell.org/package/containers-0.5.9.1/docs/Data-Map-Lazy.html#t:Map\"><code>Map</code></a> type to store key-value associative data, instead of rolling your own dictionary type.</p>\n"}], "owner": {"reputation": 2379, "user_id": 5045375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/17ed0af705e0449fe49b74d8814a8ce2?s=128&d=identicon&r=PG", "display_name": "Filip Allberg", "link": "https://stackoverflow.com/users/5045375/filip-allberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 41890585, "answer_count": 1, "score": 0, "last_activity_date": 1485509199, "creation_date": 1485506063, "last_edit_date": 1485506138, "question_id": 41889738, "link": "https://stackoverflow.com/questions/41889738/retaining-list-ness-operations-for-a-data-type", "title": "Retaining list-ness operations for a data type", "body": "<p>I want to be able to define a custom data type as opposed to using a type alias to ensure that proper values are being passed around, below is a sketch of how that might look,</p>\n\n<pre><code>module Example (fromList) where\n\nimport Data.Ord (comparing, Down(..))\nimport Data.List (sort)\n\ndata DictEntry = DictEntry (String, Integer) deriving (Show, Eq)\n\ninstance Ord DictEntry where\n  (DictEntry (word1, freq1)) `compare` (DictEntry (word2, freq2))\n    | freq1 == freq2 = word1 `compare` word2\n    | otherwise = comparing Down freq1 freq2\n\ndata Dictionary = Dictionary [DictEntry] deriving (Show)\n\nfromList :: [(String, Integer)] -&gt; Dictionary\nfromList l = Dictionary $ sort $ map DictEntry l\n</code></pre>\n\n<p>However, I'd also like to retain the \"list-ness\" of the underlying type without having to unwrap and re-wrap <code>[DictEntry]</code>, and without having to define utility functions such as <code>head :: Dictionary -&gt; DictEntry</code> and <code>tail :: Dictionary -&gt; Dictionary</code>. Is that possible? Is there some type class that I could define an instance of or a language extension that enables this? </p>\n"}, {"tags": ["haskell", "lambda-calculus"], "answers": [{"comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1485508525, "post_id": 41889300, "comment_id": 70962799, "body": "Any free occurrences of x in t will be incorrectly captured by the above reduction. The \\x -&gt; x t might more safely become \\z -&gt; z t, where z has been chosen for freshness."}], "tags": [], "owner": {"reputation": 450, "user_id": 3711397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9adb9f05f4da9535fe896434488c828?s=128&d=identicon&r=PG&f=1", "display_name": "prof1990", "link": "https://stackoverflow.com/users/3711397/prof1990"}, "is_accepted": true, "score": 1, "last_activity_date": 1485531508, "last_edit_date": 1485531508, "creation_date": 1485504194, "answer_id": 41889300, "question_id": 41889006, "link": "https://stackoverflow.com/questions/41889006/how-to-reduce-lambda-calculus/41889300#41889300", "title": "How to reduce lambda calculus", "body": "<p>I took the liberty of rewriting it to haskell syntax</p>\n\n<pre><code>(\\y -&gt; x (\\x-&gt; x y))\n(\\y -&gt; x (\\x-&gt; x y)) t\n\nx (\\x -&gt; x t)\n</code></pre>\n\n<p>since the y is already bound to the input \\y all y will be substituted by t.</p>\n\n<p>Edit: As noted in the comment below if t where to contain a free x it would be important to rename the bound x in this scope to a \"fresh\" name. That is a name that has currently no meaning. If we say</p>\n\n<pre><code>let t = \\t -&gt; x t\n</code></pre>\n\n<p>Then the proper substitution would look like</p>\n\n<pre><code>x (\\z -&gt; z (\\t -&gt; x t))\n</code></pre>\n\n<p>Where as stated by <code>pigworker</code> some <code>z</code> is chosen for freshness as a fresh identifier to replace our bound x to prevent hiding the free x in t. </p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 41889300, "answer_count": 1, "score": 0, "last_activity_date": 1485531508, "creation_date": 1485502838, "last_edit_date": 1485502912, "question_id": 41889006, "link": "https://stackoverflow.com/questions/41889006/how-to-reduce-lambda-calculus", "title": "How to reduce lambda calculus", "body": "<p>I try to understand lambda calculus and read the wonderful <a href=\"http://www.inf.fu-berlin.de/inst/ag-ki/rojas_home/documents/tutorials/lambda.pdf\" rel=\"nofollow noreferrer\">article</a>.</p>\n\n<p>On the page 8, there is an expression:  </p>\n\n<pre><code>(\u03bby.(x(\u03bbx.xy)))\n</code></pre>\n\n<p>If I am going to substitute the left outer most<code>(\u03bby)</code> with <code>t</code>,</p>\n\n<pre><code>(\u03bby.(x(\u03bbx.xy))) t\n</code></pre>\n\n<p>then the result would be?</p>\n\n<pre><code>x(\u03bbx.xy)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485500228, "post_id": 41888354, "comment_id": 70958972, "body": "The question I suggested talks about <code>length</code>, but the underlying issue is the same. Both <code>length</code> and <code>minimum</code> are methods of the <code>Foldable</code> class, and the behaviour you describe arises from the <code>Foldable</code> instance for 2-tuples (and yes, <code>(1, 10)</code> is indeed a tuple)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1485500978, "post_id": 41888354, "comment_id": 70959267, "body": "(By the way, it is worth noting that, in your second example, obtaining <code>minimum (1, True)</code> could not possibly involve comparing <code>1</code> and <code>True</code>, as they have different types. danidiaz makes a similar point in his answer to the other question.)"}, {"owner": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485504562, "post_id": 41888354, "comment_id": 70960865, "body": "@duplode Thanks, it help me a lot. Now, I know how it works.         : D"}], "owner": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "closed_date": 1485500102, "answer_count": 0, "score": 2, "last_activity_date": 1485499876, "creation_date": 1485499876, "question_id": 41888354, "link": "https://stackoverflow.com/questions/41888354/is-this-a-tuple-minimum-1-10", "closed_reason": "Duplicate", "title": "Is this a tuple? minimum (1,10)", "body": "<p>Why it always return the second element?</p>\n\n<pre><code>\u03bb&gt; minimum (1, 10)\n10\nit :: (Ord a, Num a) =&gt; a\n\u03bb&gt; minimum (10, 1)\n1\nit :: (Ord a, Num a) =&gt; a\n</code></pre>\n\n<p>Also</p>\n\n<pre><code>\u03bb&gt; minimum (1, True)\nTrue\nit :: Bool\n\u03bb&gt; minimum (True, 1)\n1\nit :: (Ord a, Num a) =&gt; a\n</code></pre>\n\n<p>If it is a tuple, why it return the second element?\nIf not, why?</p>\n"}, {"tags": ["haskell", "functional-programming", "abstract-syntax-tree", "dsl", "gadt"], "comments": [{"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 3, "creation_date": 1485497888, "post_id": 41887499, "comment_id": 70958082, "body": "For your simple use case it can be simply - <code>Add :: Num a =&gt; Expr a -&gt; Expr a -&gt; Expr a</code>"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 0, "creation_date": 1485531245, "post_id": 41887499, "comment_id": 70977379, "body": "@AnupamJain That should probably be an answer"}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 1, "last_activity_date": 1485533983, "creation_date": 1485533983, "answer_id": 41898442, "question_id": 41887499, "link": "https://stackoverflow.com/questions/41887499/how-to-define-types-in-a-dsl-in-haskell/41898442#41898442", "title": "How to define types in a DSL in Haskell?", "body": "<p>You could generalize <code>Expr</code> a bit and use</p>\n\n<pre><code>data Expr a where\n  Lit :: a -&gt; Expr a                           -- why not just let anything in?\n  Add :: Num a =&gt; Expr a -&gt; Expr a -&gt; Expr a   -- only `a` w/ `Num a` can be added\n  Mul :: Num a =&gt; Expr a -&gt; Expr a -&gt; Expr a   -- only `a` w/ `Num a` can be multiplied\n  Eq  :: Eq a =&gt; Expr a -&gt; Expr a -&gt; Expr Bool -- only `a` w/ `Eq a` can be added\n</code></pre>\n\n<p>Then again, the question really is: <em>what are you trying to do with it</em>? If you just want to explicitly construct an AST that type-checks and then be able to evaluate it, the above works just fine.</p>\n\n<pre><code>eval :: Expr a -&gt; a\neval (Lit x) = x\neval (Add x y) = eval x + eval y\neval (Mul x y) = eval x * eval y\neval (Eq x y) = eval x == eval y\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 7477078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c144f20a2470e2b10c6d667a77dd7c8?s=128&d=identicon&r=PG&f=1", "display_name": "ArthurMG", "link": "https://stackoverflow.com/users/7477078/arthurmg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 41898442, "answer_count": 1, "score": 2, "last_activity_date": 1485533983, "creation_date": 1485495098, "question_id": 41887499, "link": "https://stackoverflow.com/questions/41887499/how-to-define-types-in-a-dsl-in-haskell", "title": "How to define types in a DSL in Haskell?", "body": "<p>I've been writing an AST to build a DSL in Haskell and, for that, I'm using GADTs to define expressions such as:</p>\n\n<pre><code>data Expr a where\n    I   :: Int  -&gt; Expr Int\n    B   :: Bool -&gt; Expr Bool\n    Add :: Expr Int -&gt; Expr Int -&gt; Expr Int\n    Mul :: Expr Int -&gt; Expr Int -&gt; Expr Int\n    Eq  :: Expr Int -&gt; Expr Int -&gt; Expr Bool\n</code></pre>\n\n<p>However, I would like for expressions like Add and Mul to also work with other numeric values, from types Float and Double.\nHow would I be able to achieve such results?</p>\n"}, {"tags": ["haskell", "recursion", "abstract-data-type"], "comments": [{"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 1, "creation_date": 1485492973, "post_id": 41886566, "comment_id": 70956579, "body": "At <code>minkey(App(k,v,init))=k</code>, <code>init</code> regarded as variable name, not <code>Empty</code>. I&#39;m afraid that overuse of parentheses makes your code look unnatural. And you could also use list."}, {"owner": {"reputation": 127, "user_id": 4092894, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/2146b59eb3906df67f0d1b5c327af46d?s=128&d=identicon&r=PG&f=1", "display_name": "Teo ", "link": "https://stackoverflow.com/users/4092894/teo"}, "reply_to_user": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1485504774, "post_id": 41886566, "comment_id": 70960950, "body": "Thank you ! I really didn&#39;t notice that...Now everything is working properly. I know that it doesn&#39;t look good . I just wanted to implement it by myself. Write is as an answer,so that  I can accept it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1485519388, "post_id": 41886566, "comment_id": 70969328, "body": "I strongly recommend you turn on warnings in GHC with the <code>-Wall</code> flag. Many common errors are reported by that, including this one."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1485519331, "post_id": 41890429, "comment_id": 70969300, "body": "Indeed. GHC should also warn about the shadowing of the global <code>init</code> by the local one."}], "tags": [], "owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "is_accepted": true, "score": 1, "last_activity_date": 1485508556, "creation_date": 1485508556, "answer_id": 41890429, "question_id": 41886566, "link": "https://stackoverflow.com/questions/41886566/implementing-a-table-adt-in-haskell-why-is-my-minkey-function-not-working/41890429#41890429", "title": "Implementing a Table ADT in Haskell -why is my minkey function not working?", "body": "<p><code>minkey</code>'s <code>init</code> is regarded as argument name, not <code>Empty</code>, so pattern always matches on that line. Maybe GHC might have warned you as <code>-Woverlapping-patterns</code>.</p>\n\n<p>If <code>init</code> can't be changed, then you may use case expression.</p>\n"}], "owner": {"reputation": 127, "user_id": 4092894, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/2146b59eb3906df67f0d1b5c327af46d?s=128&d=identicon&r=PG&f=1", "display_name": "Teo ", "link": "https://stackoverflow.com/users/4092894/teo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 41890429, "answer_count": 1, "score": -2, "last_activity_date": 1485508556, "creation_date": 1485487645, "last_edit_date": 1485497870, "question_id": 41886566, "link": "https://stackoverflow.com/questions/41886566/implementing-a-table-adt-in-haskell-why-is-my-minkey-function-not-working", "title": "Implementing a Table ADT in Haskell -why is my minkey function not working?", "body": "<p>I have implemented a Table data type in haskell,but my minkey function which is supposed to return the smallest key seems not to give the right result. I am just wondering why..</p>\n\n<pre><code>module Table where\nimport Prelude hiding (init,read,length)\n\ntype Key = Int\ntype Value = String\n\nerrorvalue = \"ERROR\"\n\nmaxentries = 5\ndata Table = Empty | App(Key,Value,Table)\nderiving Show\n\ninit   :: Table\ninsert :: (Key,Value,Table) -&gt; Table \nisin   :: (Key,Table) -&gt; Bool\nread   :: (Key,Table) -&gt; Value\nempty  :: Table -&gt; Bool\ndelete :: (Key,Table) -&gt; Table\nupdate :: (Key,Value,Table) -&gt; Table\nlength :: Table -&gt; Int\nfull :: Table -&gt; Bool\nminkey::Table-&gt;Key\n\ninit = Empty\n\nminkey(App(k,v,init))=k\nminkey(App(k,v,t))= if k&gt;minkey(t) then minkey(t) else k\n\ninsert(k,v,t) = if v == errorvalue then t\n            else if isin(k,t) then t\n    else if full(t) then t\n            else App(k,v,t)\n\nisin(x,Empty)      = False\nisin(x,App(k,v,t)) = if x == k then True\n             else isin(x,t)\n\nread(x,Empty)      = errorvalue\nread(x,App(k,v,t)) = if x == k then v\n             else read(x,t)\n\nempty(Empty)      = True\nempty(App(k,v,t)) = False\n\ndelete(x,Empty)      = Empty\ndelete(x,App(k,v,t)) = if x == k then t\n           else App(k,v,delete(x,t))\n\n update(k,v,Empty)        = Empty\n update(k,v,App(k2,v2,t)) = if k == k2 then App(k,v,t)\n           else App(k2,v2,update(k,v,t))\n\n length(Empty)      = 0\n length(App(k,v,t)) = 1 + length(t)\n\n full(t) = if length(t) == maxentries then True\n      else False\n</code></pre>\n\n<p>In another script I initialized a  table:</p>\n\n<pre><code> import Table\n import Prelude hiding (init,read,length)\n\n main :: IO ()\n\n main = do\n let k1 = 9\n let k2 = 8\n let k3 = 1\n let k4 = 6\n let k5 = 10\n\n\n let v1 = \"q\"\n let v2 = \"a\"\n let v3 = \"si\"\n let v4 = \"se\"\n let v5 = \"fu\"\n\n let i0 = init\n let i1 = insert(k1,v1,i0)\n let i2 = insert(k2,v2,i1)\n let i3 = insert(k3,v3,i2)\n let i4 = insert(k4,v4,i3)\n let i5 = insert(k5,v5,i4)  \n\n let m = minkey(i5)\n print m\n print i5\n</code></pre>\n\n<p>When I print m the output is not 1 as I expected,but the last key imported to the table (in this case 10)\nWhat am I doing wrong? Maybe the recursion?</p>\n"}, {"tags": ["function", "haskell", "recursion"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1485480858, "creation_date": 1485480858, "answer_id": 41885862, "question_id": 41885270, "link": "https://stackoverflow.com/questions/41885270/haskell-integer-odd-digits-checker/41885862#41885862", "title": "Haskell Integer Odd Digits Checker", "body": "<p>First off, this seems a pretty weird thing to check. Perhaps what you're doing wrong is to ever consider this problem...</p>\n\n<p><a href=\"https://what-if.xkcd.com/59/\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5NhKR.png\" alt=\"XKCD Wikipedia printer\"></a></p>\n\n<p>But if you persist you want to know the property of <em>an integer having an odd number of digits</em>... oh well. There's a lot that could be improved. For starters, <code>(x &lt; 0) || (x == 0)</code> doesn't need the parentheses \u2013 <code>&lt;</code> and <code>==</code> (infix 4) bind more tightly than <code>||</code>. If you're not sure about this, you can always ask GHCi:</p>\n\n<pre><code>Prelude&gt; :i ==\nclass Eq a where\n  (==) :: a -&gt; a -&gt; Bool\n  ...\n    -- Defined in \u2018GHC.Classes\u2019\ninfix 4 ==\nPrelude&gt; :i ||\n(||) :: Bool -&gt; Bool -&gt; Bool    -- Defined in \u2018GHC.Classes\u2019\ninfixr 2 ||\n</code></pre>\n\n<p>But here you don't need <code>||</code> anyway because there's a dedicated operator for less-than-or-equal. Hence you can just write</p>\n\n<pre><code>oddDigits x \n  | x &lt;= 0  = error \"bla bla\"\n  | ...\n</code></pre>\n\n<p>Then, <a href=\"https://www.haskell.org/hoogle/?hoogle=Integer+-%3E+String\" rel=\"nofollow noreferrer\">you <em>can</em></a> \u201cconvert\u201d the number to a string. Converting to string is generally a really frowned-upon thing to do because it throws all structure, typechecking etc. out of the window; however \u201cnumber of digits\u201d basically <em>is</em> a property of a string (the decimal expansion), rather than a number itself, so this is not entirely unsensible for this specific task. This would work:</p>\n\n<pre><code>oddDigits x \n | x &lt;= 0                      = error \"blearg\"\n | length (show x)`mod`2 /= 0  = True\n | otherwise                   = False \n</code></pre>\n\n<p>however it's a bit redundancy department redundant. You're checking if something is <code>True</code>, then give <code>True</code> as the result... why not just put it in one clause:</p>\n\n<pre><code>oddDigits x \n | x &lt;= 0     = error \"blearg\"\n | otherwise  = length (show x)`mod`2 /= 0\n</code></pre>\n\n<p>That's perhaps in fact the best implementation.</p>\n\n<p>For any <em>proper</em>, sensible task, I would not recommend going the string route. Recursion is better. Here's what it could look like:</p>\n\n<pre><code>oddDigits 1 = True\noddDigits x \n | x &lt;= 0     = error \"blearg\"\n | otherwise  = not . oddDigits $ x`div`10\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 42360, "user_id": 389146, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/zGYUq.jpg?s=128&g=1", "display_name": "Karl Bielefeldt", "link": "https://stackoverflow.com/users/389146/karl-bielefeldt"}, "is_accepted": false, "score": 3, "last_activity_date": 1485486243, "last_edit_date": 1495539932, "creation_date": 1485486243, "answer_id": 41886430, "question_id": 41885270, "link": "https://stackoverflow.com/questions/41885270/haskell-integer-odd-digits-checker/41886430#41886430", "title": "Haskell Integer Odd Digits Checker", "body": "<p>There's nothing wrong with your general approach of converting to a list of digits, then finding the length of the list.  Really where you went wrong is trying to cram everything into one function.  As you found out first hand, it makes it very difficult to debug.  Functional programming works best with <em>very</em> small functions.</p>\n\n<p>If you separate out the responsibility of converting an integer to a list of digits, using a <code>digs</code> function like the one from <a href=\"https://stackoverflow.com/a/3963286/389146\">this answer</a>, the rest of your algorithm simplifies to:</p>\n\n<pre><code>oddDigits x | x &lt;= 0 = error\noddDigits x = odd . length $ digs x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": false, "score": 0, "last_activity_date": 1485548701, "creation_date": 1485548701, "answer_id": 41902453, "question_id": 41885270, "link": "https://stackoverflow.com/questions/41885270/haskell-integer-odd-digits-checker/41902453#41902453", "title": "Haskell Integer Odd Digits Checker", "body": "<p>leftaroundabout's eventual answer is very nice, however it fails for numbers like 2,3 and 23. Here's a fix.</p>\n\n<pre><code>oddDigits x \n  | x &lt;= 0     = error \"blearg\"\n  | x &lt; 10     = True\n  | otherwise  = not . oddDigits $ x`div`10\n</code></pre>\n\n<p>Its much more elegant than my initial answer, below. I'm including it to introduce a common functional paradigm, a worker/wrapper transformation of the problem. Here the wrapper gives the interface and passes off the work to another function. Notice that the negativity check only needs to be done once now.</p>\n\n<pre><code>oddDigits :: Integer -&gt; Bool\noddDigits x\n   | x &lt;= 0 = False\n   | otherwise = oddDigits' True x\n\noddDigits' :: Bool -&gt; Integer -&gt; Bool\noddDigits' t x\n   | x &lt; 10 = t\n   | otherwise = oddDigits' (not t) $ x `div` 10\n</code></pre>\n\n<p><code>oddDigits'</code> carries a piece of internal data with it, the initial Bool. My first first thought was to have that Bool be a digit accumulator, counting the number of digits. In that case, an \"unwrapper\" needs to be supplied, in this case the standard \"odd\" function:</p>\n\n<pre><code>oddDigits x\n   | x &lt;= 0 = False\n   | otherwise = odd . oddDigits'' 1  $  x\n</code></pre>\n\n<p>where <code>oddDigits'' :: Integer -&gt; Integer -&gt; Integer</code>. </p>\n"}], "owner": {"reputation": 63, "user_id": 7476509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e6401b2f98bda73175e04e84c37bf4b?s=128&d=identicon&r=PG&f=1", "display_name": "M Scarn", "link": "https://stackoverflow.com/users/7476509/m-scarn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 726, "favorite_count": 0, "answer_count": 3, "score": 4, "last_activity_date": 1485548701, "creation_date": 1485476082, "question_id": 41885270, "link": "https://stackoverflow.com/questions/41885270/haskell-integer-odd-digits-checker", "title": "Haskell Integer Odd Digits Checker", "body": "<p>I seem to be stuck on a question and have no idea how to approach it or what Im doing wrong with my current code. </p>\n\n<p>I have to write a function called oddDigits which takes a single integer argument and returns a boolean result. It should return True if and only if the argument is a positive integer with an odd number of digits. If the argument is zero or negative, the function should stop with an error message.</p>\n\n<p>Also, cant convert the argument into a string. Have to use recursion. \nI have a feeling each digit could be stored in a list recursively and then the length of the list could determine the answer. </p>\n\n<p>So far, I have this: </p>\n\n<pre><code>oddDigits :: Integer -&gt; Bool \n\nlst = [] \n\noddDigits x \n    | (x &lt; 0) || (x == 0) = error \n    | x `mod` 10 ++ lst ++ oddDigits(x `div` 10) \n    | length(lst) `mod` 2 /= 0 = True\n    | otherwise = False \n</code></pre>\n\n<p>Sorry if the code looks horrible. I am new to Haskell and still learning. What exactly am I doing wrong and how could I correct it? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 4, "creation_date": 1485471968, "post_id": 41884350, "comment_id": 70951584, "body": "Looks like it&#39;s a problem with the derived <code>NFData</code> instance. If I use <code>whnf</code> instead of <code>nf</code> (you only need to weak headed since the type is strict anyway), or write your own <code>NFData</code> instance, I get the same times for both."}], "owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1485470824, "creation_date": 1485470824, "question_id": 41884350, "link": "https://stackoverflow.com/questions/41884350/performance-difference-with-unpacking", "title": "Performance difference with unpacking", "body": "<p>I'm using GHC 8.0.1.\nI've written simple matrix multiplication benchmark where I try two different approaches for matrix datatype:</p>\n\n<p>1) Matrix contains 4 vector of 4 float elements.</p>\n\n<p>2) Matrix contains 16 float elements.</p>\n\n<p>I suppose theses two should be identical because in first case vectors will be unpacked into matrix datatype. And indeed when I look into generated Core, it seems to be the case. Moreover, Core for <code>mult</code> functions seems to be identical.</p>\n\n<p>Nevertheless, second version runs 2 times slower than the first one.</p>\n\n<p><strong>main.hs:</strong></p>\n\n<pre><code>module Main where\n\nimport Criterion.Main\nimport Control.Monad\nimport System.Random.MWC\nimport qualified MatMul.Unrolled as U\nimport qualified MatMul.UnrolledFull as F\n\nmain :: IO ()\nmain = do\n    gen &lt;- create\n    elems1 &lt;- mkElems gen\n    elems2 &lt;- mkElems gen\n\n    defaultMain\n        [ bgroup \"matrix mult 4x4\"\n            [ bench \"unrolled\"     $ nf (U.mult (U.mkMat elems1)) (U.mkMat elems2)\n            , bench \"unrolledFull\" $ nf (F.mult (F.mkMat elems1)) (F.mkMat elems2) ]\n        ]\n    where\n        -- see http://hackage.haskell.org/package/mwc-random-0.13.5.0/docs/System-Random-MWC.html#v:uniform\n        mkElems gen = replicateM 16 (fmap (\\x -&gt; x - (2 :: Float) ^^ (-33 :: Int)) (uniform gen :: IO Float))\n</code></pre>\n\n<p><strong>unrolled.hs:</strong></p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE DeriveAnyClass #-}\n\nmodule MatMul.Unrolled where\n\nimport Control.DeepSeq\nimport GHC.Generics\n\ndata Vector4f = Vector4f\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    deriving (Show, Eq, Generic, NFData)\n\ndata Matrix4x4f = Matrix4x4f\n    {-# UNPACK #-} !Vector4f\n    {-# UNPACK #-} !Vector4f\n    {-# UNPACK #-} !Vector4f\n    {-# UNPACK #-} !Vector4f             \n    deriving (Show, Eq, Generic, NFData)\n\nmkMat :: [Float] -&gt; Matrix4x4f\nmkMat (a:b:c:d:e:f:g:h:i:j:k:l:m:n:o:p:_) = \n    Matrix4x4f\n        (Vector4f a b c d)\n        (Vector4f e f g h)\n        (Vector4f i j k l)\n        (Vector4f m n o p)\n\nmult :: Matrix4x4f -&gt; Matrix4x4f -&gt; Matrix4x4f\nmult\n    (Matrix4x4f \n        (Vector4f a0 a1 a2 a3)\n        (Vector4f b0 b1 b2 b3)\n        (Vector4f c0 c1 c2 c3)\n        (Vector4f d0 d1 d2 d3))\n    (Matrix4x4f \n        (Vector4f x0 x1 x2 x3)\n        (Vector4f y0 y1 y2 y3)\n        (Vector4f z0 z1 z2 z3)\n        (Vector4f w0 w1 w2 w3)) =\n    Matrix4x4f \n        (Vector4f (a0*x0+a1*y0+a2*z0+a3*w0) (a0*x1+a1*y1+a2*z1+a3*w1) (a0*x2+a1*y2+a2*z2+a3*w2) (a0*x3+a1*y3+a2*z3+a3*w3))\n        (Vector4f (b0*x0+b1*y0+b2*z0+b3*w0) (b0*x1+b1*y1+b2*z1+b3*w1) (b0*x2+b1*y2+b2*z2+b3*w2) (b0*x3+b1*y3+b2*z3+b3*w3))\n        (Vector4f (c0*x0+c1*y0+c2*z0+c3*w0) (c0*x1+c1*y1+c2*z1+c3*w1) (c0*x2+c1*y2+c2*z2+c3*w2) (c0*x3+c1*y3+c2*z3+c3*w3))\n        (Vector4f (d0*x0+d1*y0+d2*z0+d3*w0) (d0*x1+d1*y1+d2*z1+d3*w1) (d0*x2+d1*y2+d2*z2+d3*w2) (d0*x3+d1*y3+d2*z3+d3*w3))\n</code></pre>\n\n<p><strong>unrolledFull.hs:</strong></p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE DeriveAnyClass #-}\n\nmodule MatMul.UnrolledFull where\n\nimport Control.DeepSeq\nimport GHC.Generics\n\ndata Matrix4x4f = Matrix4x4f\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    {-# UNPACK #-} !Float\n    deriving (Show, Eq, Generic, NFData)\n\nmkMat :: [Float] -&gt; Matrix4x4f\nmkMat (a:b:c:d:e:f:g:h:i:j:k:l:m:n:o:p:_) =\n    Matrix4x4f a b c d e f g h i j k l m n o p\n\nmult :: Matrix4x4f -&gt; Matrix4x4f -&gt; Matrix4x4f\nmult\n    (Matrix4x4f a0 a1 a2 a3 b0 b1 b2 b3 c0 c1 c2 c3 d0 d1 d2 d3)\n    (Matrix4x4f x0 x1 x2 x3 y0 y1 y2 y3 z0 z1 z2 z3 w0 w1 w2 w3) =\n    Matrix4x4f \n        (a0*x0+a1*y0+a2*z0+a3*w0) (a0*x1+a1*y1+a2*z1+a3*w1) (a0*x2+a1*y2+a2*z2+a3*w2) (a0*x3+a1*y3+a2*z3+a3*w3)\n        (b0*x0+b1*y0+b2*z0+b3*w0) (b0*x1+b1*y1+b2*z1+b3*w1) (b0*x2+b1*y2+b2*z2+b3*w2) (b0*x3+b1*y3+b2*z3+b3*w3)\n        (c0*x0+c1*y0+c2*z0+c3*w0) (c0*x1+c1*y1+c2*z1+c3*w1) (c0*x2+c1*y2+c2*z2+c3*w2) (c0*x3+c1*y3+c2*z3+c3*w3)\n        (d0*x0+d1*y0+d2*z0+d3*w0) (d0*x1+d1*y1+d2*z1+d3*w1) (d0*x2+d1*y2+d2*z2+d3*w2) (d0*x3+d1*y3+d2*z3+d3*w3)\n</code></pre>\n\n<p>I get following results:</p>\n\n<pre><code>Running 1 benchmarks...\nBenchmark matMul: RUNNING...\nbenchmarking matrix mult 4x4/unrolled\ntime                 60.32 ns   (60.21 ns .. 60.43 ns)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 60.40 ns   (60.28 ns .. 60.55 ns)\nstd dev              457.6 ps   (352.8 ps .. 612.8 ps)\n\nbenchmarking matrix mult 4x4/unrolledFull\ntime                 137.6 ns   (137.4 ns .. 137.8 ns)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 137.7 ns   (137.5 ns .. 138.0 ns)\nstd dev              874.8 ps   (665.5 ps .. 1.194 ns)\n\nBenchmark matMul: FINISH\n</code></pre>\n"}, {"tags": ["arrays", "haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 3, "creation_date": 1485453481, "post_id": 41879870, "comment_id": 70941816, "body": "Your type annotation is for a thing called <code>array</code>, but your function is called <code>squares</code>. It looks like you should delete the type signature for <code>array</code> and import it from <code>Data.Array</code>, then possibly add an annotation for <code>squares</code>."}], "answers": [{"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1485453561, "post_id": 41879934, "comment_id": 70941872, "body": "The OP\u2019s type signature actually <i>is</i> the type signature for <code>array</code> from <code>Data.Array</code>, not <code>squares</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1485453585, "post_id": 41879934, "comment_id": 70941883, "body": "@AlexisKing: well that is the first point (the one why it crashes)."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1485453638, "post_id": 41879934, "comment_id": 70941911, "body": "Right, I\u2019m just saying I don\u2019t think \u201cdefine your type signature too broad\u201d is meaningful, since it doesn\u2019t look like the type signature provided was intended for <code>squares</code> at all."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1485453729, "post_id": 41879934, "comment_id": 70941967, "body": "@AlexisKing: well I was only giving a heads up that simply changing the name will not resolve the issue, otherwise within three minutes there is a new question. I don&#39;t think we should generate sequences of small problems we solve."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1485453806, "post_id": 41879934, "comment_id": 70942006, "body": "@AlexisKing: rewrote it. Better?"}, {"owner": {"reputation": 39, "user_id": 7459555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01f706aa3dd7c61ccafb02075137425a?s=128&d=identicon&r=PG&f=1", "display_name": "Kyrill96", "link": "https://stackoverflow.com/users/7459555/kyrill96"}, "edited": false, "score": 0, "creation_date": 1485454376, "post_id": 41879934, "comment_id": 70942343, "body": "Thanks to you both :)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1485454155, "last_edit_date": 1485454155, "creation_date": 1485453500, "answer_id": 41879934, "question_id": 41879870, "link": "https://stackoverflow.com/questions/41879870/why-is-this-haskell-array-code-not-working/41879934#41879934", "title": "Why is this Haskell array-code not working?", "body": "<p>Because you define a type signature <strong>for <a href=\"http://hackage.haskell.org/packages/archive/array/latest/doc/html/Data-Array-IArray.html#v:array\" rel=\"nofollow noreferrer\"><code>array</code></a></strong>, not <code>squares</code> (<code>array</code> is a library function, you cannot <em>redefine</em> it, you can of course <em>write your own</em>). Now the compiler thinks you aim to define your own <code>array</code> and says: \"<em>Got that, but where is your function definition?</em>\" it thus lacks a <em>binding</em> (implementation so to speak).</p>\n\n<p>The <strong>binding is thus its implementation</strong> (here <code>squares = array (1,100) [(i, i*i) | i &lt;- [1..100]]</code>). Furthermore between brackets the compiler also says that you cannot define the function where you want, it must be in the file where the function signature is (the <strong>signature</strong> is where you define its type so <code>:: (Ix a) =&gt; (a,a) -&gt; [(a,b)] -&gt; Array a b</code>).</p>\n\n<p>Given you meant to give a signature to <code>squares</code>, the <strong>type signature is too broad</strong>. The most generic type signature is:</p>\n\n<pre><code>squares :: (Enum e, Num e, Ix e) =&gt; Array e e\nsquares = array (1,100) [(i, i*i) | i &lt;- [1..100]]\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 7459555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01f706aa3dd7c61ccafb02075137425a?s=128&d=identicon&r=PG&f=1", "display_name": "Kyrill96", "link": "https://stackoverflow.com/users/7459555/kyrill96"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1485454155, "creation_date": 1485453304, "last_edit_date": 1485453356, "question_id": 41879870, "link": "https://stackoverflow.com/questions/41879870/why-is-this-haskell-array-code-not-working", "title": "Why is this Haskell array-code not working?", "body": "<p>I have tried this code in Haskell :</p>\n\n<pre><code>array :: (Ix a) =&gt; (a,a) -&gt; [(a,b)] -&gt; Array a b\nsquares = array (1,100) [(i, i*i) | i &lt;- [1..100]]\n</code></pre>\n\n<p>But when i run that Code i get this message by GHCi:</p>\n\n<pre><code>The type signature for array lacks an accompanying binding\n      (The type signature must be given where array is declared)\n</code></pre>\n\n<p>What exactly is meant with accompanying binding and how to fix that?</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485452613, "post_id": 41879455, "comment_id": 70941265, "body": "I think you can work something much smaller with <a href=\"https://hackage.haskell.org/package/aeson-lens-0.5.0.0\" rel=\"nofollow noreferrer\"><code>aeson-lens</code></a>..."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485452938, "post_id": 41879455, "comment_id": 70941483, "body": "<code>Data.Monoid</code> is a common thing to import, and <code>(&lt;&gt;)</code> is a common operator. The <code>fromList</code> is just a way of building the relevant hash map -- without it, the tutorial would need either to use the <a href=\"http://hackage.haskell.org/package/unordered-containers-0.2.7.2/docs/Data-HashMap-Lazy.html#v:fromList\" rel=\"nofollow noreferrer\"><code>fromList</code> from <code>Data.HashMap.Lazy</code></a> or to enable the <code>OverloadedLists</code> extension. As far as the imports go, I wouldn&#39;t say it is bloated."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1485454031, "post_id": 41879455, "comment_id": 70942132, "body": "To add on to @duplode&#39;s point, <code>(&lt;&gt;)</code> is (probably) going to be added to the Prelude in the next major version of <code>base</code> (<code>5.0.0</code>). At that point, you&#39;ll only need to turn on <code>OverloadedLists</code> and import <code>Data.Aeson</code>."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 2, "creation_date": 1485974259, "post_id": 41879455, "comment_id": 71151972, "body": "with lenses and the lens-aeson package (though it seems that would violate the spirit of the question): <code>toJSON russianName &amp; _Object . at &quot;patronymic&quot; ?~ toJSON russianPatronymic</code>"}, {"owner": {"reputation": 1075, "user_id": 1299428, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/330bcefb9bb0b6a8e071e5c8b2ff9d6b?s=128&d=identicon&r=PG&f=1", "display_name": "Sophie", "link": "https://stackoverflow.com/users/1299428/sophie"}, "edited": false, "score": 0, "creation_date": 1486064201, "post_id": 41879455, "comment_id": 71197152, "body": "I like the aeson-lens version since it seems to avoid the potential run time error and avoids adding a new function. I would accept it as an answer."}], "owner": {"reputation": 1075, "user_id": 1299428, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/330bcefb9bb0b6a8e071e5c8b2ff9d6b?s=128&d=identicon&r=PG&f=1", "display_name": "Sophie", "link": "https://stackoverflow.com/users/1299428/sophie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 255, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1485452022, "creation_date": 1485451923, "last_edit_date": 1485452022, "question_id": 41879455, "link": "https://stackoverflow.com/questions/41879455/aeson-add-a-single-key-to-tojson-result", "title": "aeson: Add a single key to toJSON result", "body": "<p>I found the following solution for my problem on <a href=\"https://artyom.me/aeson#extended-records\" rel=\"nofollow noreferrer\">artyom.me/aeson</a>. However, it looks a bit bloated for the task of adding a single key to a <code>toJSON</code> result. Shouldn't there be an easier solution?</p>\n\n<pre><code>instance ToJSON RussianName where\n  toJSON RussianName{..} = Object $\n    toObject russianName &lt;&gt;\n    fromList [\"patronymic\" .= russianPatronymic]\n\ntoObject :: ToJSON a =&gt; a -&gt; Object\ntoObject a = case toJSON a of\n  Object o -&gt; o\n  _        -&gt; error \"toObject: value isn't an Object\"\n</code></pre>\n\n<p>which at least also needs</p>\n\n<pre><code>import Data.Aeson\nimport Data.Monoid ((&lt;&gt;))\nimport GHC.Exts (fromList)\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "dynamic-linking"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1485452000, "post_id": 41879140, "comment_id": 70940863, "body": "You say you&#39;re new to Haskell. Those libraries which implement dynamic code loading are advanced libraries for expert users. The vast majority of people never need them in their entire career. I think you&#39;re trying to run before you can walk. What are you actually trying to do?"}, {"owner": {"reputation": 958, "user_id": 2175002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acda042586311777ce120faa0a9a78b3?s=128&d=identicon&r=PG", "display_name": "George Richardson", "link": "https://stackoverflow.com/users/2175002/george-richardson"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1485453166, "post_id": 41879140, "comment_id": 70941632, "body": "My overarching goal is to make a distributed MapReduce framework (university is fun). However this is, of course, a long way off. Right now my only goal is to load a plugin dynamically and call a function inside of it on some data. Honestly when I saw the package it seemed simple enough but I have now been staring at this for a very long time. Do you have any ideas as to why it is not working?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1485454198, "post_id": 41879140, "comment_id": 70942246, "body": "I think you have an <a href=\"http://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">XY problem</a> - that is to say, I don&#39;t think plugin-loader systems are likely to be a very effective way of achieving your goal of building a distributed MapReduce framework. What do you expect a hot code loader to be able to do for you (versus, say, a higher-order function)?"}, {"owner": {"reputation": 958, "user_id": 2175002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acda042586311777ce120faa0a9a78b3?s=128&d=identicon&r=PG", "display_name": "George Richardson", "link": "https://stackoverflow.com/users/2175002/george-richardson"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1485454333, "post_id": 41879140, "comment_id": 70942318, "body": "Distributing the user&#39;s map/reduce code to all the nodes in the cluster. The only other way would be recompilation on every node which seemed harder to me at first glance."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1485454978, "post_id": 41879140, "comment_id": 70942748, "body": "But you presumably don&#39;t want to allow the user to execute arbitrary Haskell code? That&#39;d be potentially dangerous. Map-reduce is a relatively small problem, in the sense that you don&#39;t need all the power of a general-purpose programming language (Haskell) to write programs in a map-reduce style. I would consider designing a domain-specific language."}, {"owner": {"reputation": 958, "user_id": 2175002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acda042586311777ce120faa0a9a78b3?s=128&d=identicon&r=PG", "display_name": "George Richardson", "link": "https://stackoverflow.com/users/2175002/george-richardson"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1485455298, "post_id": 41879140, "comment_id": 70942940, "body": "I was more trying to replicate something like Hadoop which takes in user compiled .jar. I am not worried about security so much because this is only a uni project that will be used by 2-3 people ever. The requirements require Haskell so that is what I am doing."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1485456263, "post_id": 41879140, "comment_id": 70943503, "body": "This is getting off-topic for SO, but have you looked at the <a href=\"http://haskell-distributed.github.io/\" rel=\"nofollow noreferrer\">Cloud Haskell</a> project?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1485457124, "post_id": 41879140, "comment_id": 70943964, "body": "I suspect it would help to build your program with <code>-dynamic</code> (not sure what the stacky way to say that is)."}, {"owner": {"reputation": 958, "user_id": 2175002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acda042586311777ce120faa0a9a78b3?s=128&d=identicon&r=PG", "display_name": "George Richardson", "link": "https://stackoverflow.com/users/2175002/george-richardson"}, "edited": false, "score": 0, "creation_date": 1485457696, "post_id": 41879140, "comment_id": 70944246, "body": "Cloud Haskell looks very interesting and relevant. Thanks for the link. I will try compiling with -dynamic when I get home."}, {"owner": {"reputation": 958, "user_id": 2175002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acda042586311777ce120faa0a9a78b3?s=128&d=identicon&r=PG", "display_name": "George Richardson", "link": "https://stackoverflow.com/users/2175002/george-richardson"}, "edited": false, "score": 0, "creation_date": 1485511737, "post_id": 41879140, "comment_id": 70964818, "body": "Sorry for the late reply. I have added the output when building with the -dynamic flag to the question. I don&#39;t know if this error takes me further away from or closer to my goals."}, {"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1485541556, "post_id": 41879140, "comment_id": 70983540, "body": "I&#39;ve been trying this all morning with no luck. Similar error happens when using plugins package. Perhaps seek out alternative approaches. Even with distributing object files, you will still need programs on other side to run the distributed code and will therefore need a deploy those programs. Instead, as @Benjamin suggested, higher order function/domain specific language (DSL). Briefly, that means you will pass a value to distributed nodes which they will then know what to do with. This value can be complex, e.g. &quot;DoX on Y then ReturnZ&quot;, this will be the DSL that you define. Good Luck."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1485798586, "post_id": 41879140, "comment_id": 71064636, "body": "You may be interested in <a href=\"http://haskell-distributed.github.io\" rel=\"nofollow noreferrer\">Cloud Haskell</a>. I don&#39;t think your current approach will be be fruitful..."}], "owner": {"reputation": 958, "user_id": 2175002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acda042586311777ce120faa0a9a78b3?s=128&d=identicon&r=PG", "display_name": "George Richardson", "link": "https://stackoverflow.com/users/2175002/george-richardson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 162, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1485795420, "creation_date": 1485450831, "last_edit_date": 1495539922, "question_id": 41879140, "link": "https://stackoverflow.com/questions/41879140/why-is-dynamic-loader-package-unable-to-resolve-functions", "title": "Why is Dynamic Loader package unable to resolve functions?", "body": "<p>I have been trying to use the <a href=\"https://hackage.haskell.org/package/dynamic-loader\" rel=\"nofollow noreferrer\" title=\"dynamic-loader\">dynamic loader</a> package which I found from <a href=\"https://stackoverflow.com/questions/30681954/out-of-the-box-haskell-plugin-system\">this question</a>. I am very new to Haskell so excuse me if I am making some incredibly rookie mistakes. My problem is that when I attempt to use the resolveFunctions function I get the following error: </p>\n\n<pre><code>DyanmicLoad-exe: /home/ubuntu/DynamicLoadTest/Plugin.o: unknown symbol `ghczmprim_GHCziCString_unpackCStringzh_closure'\nDyanmicLoad-exe: user error (Unable to resolve functions!)\n</code></pre>\n\n<p>I would love it if someone could tell me possibly where I am going wrong here.</p>\n\n<p>Here is my code (I am using the basic <code>stack new</code> structure):</p>\n\n<p><strong>app/Main.hs</strong>\nJust the main function.</p>\n\n<pre><code>module Main where\n\nimport Lib\n\nmain :: IO ()\nmain = libMain\n</code></pre>\n\n<p><strong>src/Lib.hs</strong>\nThe module is loaded in here.</p>\n\n<pre><code>module Lib\n    ( libMain\n    ) where\nimport System.Plugins.DynamicLoader\nimport System.Directory\nimport Interface\nlibMain :: IO ()\nlibMain = do currentDir &lt;- System.Directory.getCurrentDirectory\n             loadModuleFromPath (currentDir ++ \"/Interface.o\") Nothing\n             putStrLn \"Loaded Interface\"\n             loadedModule &lt;- loadModuleFromPath (currentDir ++ \"/Plugin.o\") (Just currentDir)\n             putStrLn \"Loaded Plugin Module!\"\n             resolveFunctions\n             putStrLn \"Resolved Functions\"\n             plugin &lt;- (loadFunction loadedModule \"getPlugin\") :: IO (JobInterface)\n             putStrLn \"Loaded Plugin\"\n             putStrLn (jobName plugin)\n</code></pre>\n\n<p><strong>src/Interface.hs</strong>\nThis file is the \"plugin interface\"</p>\n\n<pre><code>module Interface (\n   JobInterface (..)\n) where\n\ndata JobInterface =\n     JobInterface { jobName :: String\n              , runJob :: Int -&gt; Int\n                  }\n</code></pre>\n\n<p><strong>src/Plugin.hs</strong>\nAn example plugin. \n    module Plugin (\n        getPlugin\n    ) where</p>\n\n<pre><code>import Interface\n\ngetPlugin :: JobInterface\ngetPlugin = JobInterface \"Hello\" $ \\x -&gt; 1 * x\n</code></pre>\n\n<p>I am building with <code>stack build</code> followed by <code>stack ghc src/Plugin.hs src/Interface.hs</code>. I am running with <code>stack exec DyanmicLoad-exe</code>.</p>\n\n<p>GHC version is 8.0.1</p>\n\n<p>Full output:</p>\n\n<pre><code>$ stack exec DyanmicLoad-exe\nLoaded Interface\nLoaded Plugin Module!\nDyanmicLoad-exe: /home/ubuntu/DynamicLoadTest/Plugin.o: unknown symbol `ghczmprim_GHCziCString_unpackCStringzh_closure'\nDyanmicLoad-exe: user error (Unable to resolve functions!)\n</code></pre>\n\n<p>Edit 1:</p>\n\n<p>Error with the -dynamic flag on build.</p>\n\n<pre><code>$ stack exec DyanmicLoad-exe\nLoaded Interface\nLoaded Plugin Module!\nDyanmicLoad-exe: /home/ubuntu/DynamicLoadTest/Plugin.o: unhandled ELF relocation(RelA) type 42\n\nDyanmicLoad-exe: user error (Unable to resolve functions!)\n</code></pre>\n\n<p><strong>Edit 2 .cabal file</strong></p>\n\n<pre><code>name:                DyanmicLoad\nversion:             0.1.0.0\nsynopsis:            Initial project template from stack\ndescription:         Please see README.md\nhomepage:            https://github.com/githubuser/DyanmicLoad#readme\nlicense:             BSD3\nlicense-file:        LICENSE\nauthor:              Author name here\nmaintainer:          example@example.com\ncopyright:           2017 Author name here\ncategory:            Web\nbuild-type:          Simple\nextra-source-files:  README.md\ncabal-version:       &gt;=1.10\n\nlibrary\n  hs-source-dirs:      src\n  exposed-modules:     Lib\n                      , Interface\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                      , dynamic-loader\n                      , directory\n  default-language:    Haskell2010\n\nexecutable DyanmicLoad-exe\n  hs-source-dirs:      app\n  main-is:             Main.hs\n  ghc-options:         -dynamic -threaded -rtsopts -with-rtsopts=-N\n  build-depends:       base\n                     , DyanmicLoad\n  default-language:    Haskell2010\n\ntest-suite DyanmicLoad-test\n  type:                exitcode-stdio-1.0\n  hs-source-dirs:      test\n  main-is:             Spec.hs\n  build-depends:       base\n                     , DyanmicLoad\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n  default-language:    Haskell2010\n\nsource-repository head\n  type:     git\n  location: https://github.com/githubuser/DyanmicLoad\n</code></pre>\n"}, {"tags": ["haskell", "tuples", "monads", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "edited": false, "score": 0, "creation_date": 1485811066, "post_id": 41875524, "comment_id": 71071313, "body": "I don&#39;t understand your question in enough detail to answer it here.  It might be helpful to have a more in-depth conversation about this in IRC.  Try the #snapframework channel on Freenode.  There are a number of people there who might be able to help you."}], "owner": {"reputation": 11, "user_id": 1786000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9804a923910b29d5b59540e6d42ed6e?s=128&d=identicon&r=PG", "display_name": "Deckool", "link": "https://stackoverflow.com/users/1786000/deckool"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1485440323, "creation_date": 1485440323, "question_id": 41875524, "link": "https://stackoverflow.com/questions/41875524/snapframework-routes-from-csv", "title": "Snapframework routes from &#39;csv&#39;", "body": "<p>i am not sure if i should use <code>eval</code> for this but i want to dynamically load the routes in a <code>SnapFramework</code> from a <code>csv</code> file, like this:</p>\n\n<pre><code>csv file\n\nroute, file\nredirect, redirects.csv\nred, redirects2.csv\n</code></pre>\n\n<p>Now, i want to say to the framework which file should read in which ocasion</p>\n\n<pre><code>hs file\n\nstart = do\n    snapRoutes &lt;- readCsv \"routes.csv\"\n\nrut a = ((fst a ++ \"/:md5\"), redirectTo (snd a))\n\nskite :: Snap ()\nskite =\n    ifTop noHandler &lt;|&gt;\n    route (mapM_ rut start) &lt;|&gt;\n    fourOhFour\n</code></pre>\n\n<p>Now i want to inject the following <code>Snap monad</code> in the <code>tuple</code> needed for routes and it seems i can't figure out how. Can <code>liftM</code> or <code>unsafeEval</code> solve the problem? And how?</p>\n\n<pre><code>redirectTo :: String -&gt; Snap()\nredirectTo fileName = do\n    param &lt;- getParam \"md5\"\n    redirects &lt;- liftIO $ readCsv fileName\n    theParam &lt;- maybe (return \"oh no\")\n                    return param\n    writeBS redirects\n</code></pre>\n\n<p>Or any other ideas?</p>\n\n<p>Thanks :)</p>\n"}, {"tags": ["haskell", "applicative", "category-theory"], "comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1485434251, "post_id": 41872646, "comment_id": 70928747, "body": "This <code>coapp</code> smells of Kripke models."}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1485435415, "post_id": 41872646, "comment_id": 70929389, "body": "@pigworker: does that mean you see it as a kind of future-world quantification somehow?"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1485437783, "post_id": 41872646, "comment_id": 70930950, "body": "Yeah. In particular, taking q to be Maybe, you might be able to represent the formal parameter of the binding."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1485456245, "post_id": 41872646, "comment_id": 70943495, "body": "It&#39;s similar to the type of a <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Prism.html\" rel=\"nofollow noreferrer\"><code>Prism</code></a> from the lens library, but without universal quantification over the outer functor. <code>type Prism s t a b = forall p f. (Choice p, Applicative f) =&gt; p a (f b) -&gt; p s (f t)</code>. There&#39;s not a related type hanging around in <code>lens</code> for just the <code>Applicative q =&gt; p (q a) -&gt; p (q b)</code> part (a less general prism). If you had a general prism <code>f</code>, <code>Star</code> would transform any <code>Applicative p</code> into a compatible profunctor to be able to pass <code>f</code> to <code>coapp</code> or <code>afix</code>."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1485457037, "post_id": 41872646, "comment_id": 70943922, "body": "I don&#39;t know if any <i>interesting</i> prisms exist to pass to <code>coapp</code> or <code>afix</code>. It&#39;s likely that they&#39;re all trivial."}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1485634107, "post_id": 41872646, "comment_id": 71009932, "body": "@pigworker: representing the formal parameter somewhat corresponds to an intuition I had about how the <code>\u2200 q. Applicative q \u21d2 p (q a) \u2192 p (q a)</code> type enforced a kind of effect-values separation.  My intuition was that the dependency of the returned <code>p a</code> on the argument <code>p a</code> (call it x) should take the form of a tree whose leaves are either occurrences of x or constant ps (i.e. any <code>p t</code> that doesn&#39;t depend on x) and whose branch points are formed by applications of the applicative <code>&lt;*&gt;</code>."}], "owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 213, "favorite_count": 4, "answer_count": 0, "score": 11, "last_activity_date": 1485430733, "creation_date": 1485430733, "last_edit_date": 1495541803, "question_id": 41872646, "link": "https://stackoverflow.com/questions/41872646/a-categorical-analogue-for-some-applicative-infrastructure-i-used", "title": "A categorical analogue for some applicative infrastructure I used?", "body": "<p>I've been reading a bit about the category theoric interpretation of Haskell Applicative functors: apparently, they can be interpreted in category theoretic terms as either lax closed functors or lax monoidal functors (depending on who you ask, <a href=\"https://stackoverflow.com/questions/35013293/what-is-applicative-functor-definition-from-the-category-theory-pov\">it seems</a>), and this made me wonder about the following. </p>\n\n<p>A while ago, I wrote a paper (together with Ilya Sergey and our advisors Frank Piessens and Dave Clarke) about a recursion primitive for \"effect recursion\" in DSLs using Applicative functors, intended mainly for use in parser libraries. We found out that we needed a few quite special constructors that seem like they might be generalisable (somehow).  In summary, what I'm asking is: are some of the below constructions somehow connected to category theory and if so, how?</p>\n\n<p>Note that I will write <code>p \u25e6 q</code> for the composition of two applicative functors <code>p</code> and <code>q</code>.</p>\n\n<p>Here is a list of the primitives we needed along the way:</p>\n\n<ul>\n<li><p>afix: an effect recursion primitive. \n We really wanted a recursion primitive that looked like this:</p>\n\n<pre><code>afix :: (p a \u2192 p a) \u2192 p a\n</code></pre>\n\n<p>However, this was unimplementable for the more complex interpretations of <code>p</code> that we needed.  Instead, we ended up with the following:</p>\n\n<pre><code>afix :: (\u2200 q. Applicative q \u21d2 p (q a) \u2192 p (q a)) \u2192 p a\n</code></pre>\n\n<p>Apparently, wrapping values of the recursive occurrence in this parametrically quantified applicative functor q enforced a kind of value-effect separation in the function that we take the fixpoint of. Apparently, this was sufficient to make our more complex functions work.</p></li>\n<li><p>Deeper in the implementation, we needed a sort of coapplicative operator that looks like this:</p>\n\n<pre><code>coapp0 :: (p a \u2192 p b) \u2192 p (a \u2192 b)\n</code></pre>\n\n<p>However, requiring this as a general operator for <code>p</code>, seems like it would have restricted us to only trivial applicative functors p.  Instead, we noticed that we could make do with the following, which was implementable:</p>\n\n<pre><code>coapp :: Applicative p \u21d2 (\u2200 q . Applicative q \u21d2 (p \u25e6 q) a \u2192 (p \u25e6 q) b) \u2192 p (a \u2192 b)\n</code></pre></li>\n</ul>\n\n<p>So in summary: is any of the above somehow familiar-looking from a category-theoretic point of view?  Specifically, the restriction over functions of type <code>\u2200 q . Applicative q \u21d2 (p \u25e6 q) a \u2192 (p \u25e6 q) b</code> rather than <code>p a -&gt; p b</code> seems like it might be fundamental somehow? Are there any links that might help us make more sense of this stuff than we were able to do in the past?</p>\n\n<p>There are more details in <a href=\"http://dl.acm.org/citation.cfm?id=2426910\" rel=\"nofollow noreferrer\">the paper</a> about the above and how we used it, in case anyone is interested.</p>\n"}, {"tags": ["haskell", "lambda-calculus"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1485422987, "creation_date": 1485422987, "answer_id": 41870362, "question_id": 41870211, "link": "https://stackoverflow.com/questions/41870211/dissolve-lambda-calculus/41870362#41870362", "title": "Dissolve lambda calculus", "body": "<p>Yes, you always need to apply a lambda to its \"first\" (leftmost) argument.</p>\n\n<p>In theory, there is not such a thing as multiple arguments, there is only application of a single argument. Still, it is common to write\n<code>f M N O</code> for the repeated application <code>(((f M) N) O)</code>. Note how <code>f</code> takes <code>M</code> as its argument.</p>\n\n<p>In the general case, you will not get the same result if you do application in a different order. Your example was only an incident.</p>\n"}, {"tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 7, "last_activity_date": 1485423131, "creation_date": 1485423131, "answer_id": 41870399, "question_id": 41870211, "link": "https://stackoverflow.com/questions/41870211/dissolve-lambda-calculus/41870399#41870399", "title": "Dissolve lambda calculus", "body": "<p>The fact you got the same answer in this arithmetic example is a coincidence caused by the arithmetic rather than the lambda calculus.</p>\n\n<p>If you wrote more spaces to make the term structure clearer, it would be easier to see what's going on</p>\n\n<pre><code>(\\x. + (- x 1)) 9 3\n</code></pre>\n\n<p>means, with gratuitous extra parentheses showing the parse tree,</p>\n\n<pre><code>((\\x. (+ (- x 1))) 9) 3\n</code></pre>\n\n<p>because <strong>application associates to the left</strong> (\"rather as we all did in the sixties\" - Roger Hindley).</p>\n\n<p>So, the 3 is in the wrong place to be substituted for the x. We have only</p>\n\n<pre><code>( (\\x. (+ (- x 1))) 9 ) 3\n  =\n(+ (- 9 1)) 3\n  =\n(+ 8) 3\n  =\n11\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 41870399, "answer_count": 2, "score": 1, "last_activity_date": 1485503010, "creation_date": 1485422464, "last_edit_date": 1485503010, "question_id": 41870211, "link": "https://stackoverflow.com/questions/41870211/dissolve-lambda-calculus", "title": "Dissolve lambda calculus", "body": "<p>I have following lambda calculus:</p>\n\n<pre><code>(\u03bbx. + (- x 1)) 9 3\n</code></pre>\n\n<p>The right beta reduce is:</p>\n\n<pre><code>+ (- 9 1) 3\n</code></pre>\n\n<p>I made a mistake and took instead of 9 the number 3:</p>\n\n<pre><code>+ (- 3 1) 9\n</code></pre>\n\n<p>and I've got the same result.  </p>\n\n<p>I wasn't realize that was wrong, until compare it with the solution.</p>\n\n<p>Do I have to take the closest substitution, in this case is 9? </p>\n"}, {"tags": ["haskell", "random", "statistics"], "answers": [{"comments": [{"owner": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "edited": false, "score": 0, "creation_date": 1485427468, "post_id": 41869560, "comment_id": 70925183, "body": "I knew there was going to be some awkwardness. This is what I was looking for exactly. Thanks!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 8, "last_activity_date": 1485419968, "creation_date": 1485419968, "answer_id": 41869560, "question_id": 41869238, "link": "https://stackoverflow.com/questions/41869238/how-to-generate-n-random-numbers-from-a-normal-distribution-using-random-fu-has/41869560#41869560", "title": "How to generate n random numbers from a normal distribution using random-fu (Haskell)?", "body": "<p>There is the awkwardness here that is always present with randomness in Haskell - since Haskell is pure, you'll need to have some sort of \"random\" source. <code>random-fu</code> uses <a href=\"https://hackage.haskell.org/package/random-fu-0.2.7.0/docs/Data-Random.html#t:RandomSource\"><code>RandomSource</code></a> for this purpose, then you work inside this monad when you want to manipulate random values.</p>\n\n<pre><code>import Data.Random\nimport Control.Monad (replicateM)\n\naverage :: [Double] -&gt; Double\naverage xs = sum xs / fromIntegral (length xs)\n\nvariance :: [Double] -&gt; Double\nvariance xs = average [ (x - m)^2  | x &lt;- xs ] \n  where m = average xs\n\nmain :: IO ()\nmain = do\n  sample &lt;- runRVar (replicateM 10 (normal 10 1)) StdRandom :: IO [Double]\n  putStrLn $ \"Average: \" ++ show (average sample)\n  putStrLn $ \"Variance: \" ++ show (variance sample)\n</code></pre>\n\n<p>Trial runs seem to be giving me reasonable output:</p>\n\n<pre><code>ghci&gt; main\nAverage: 10.294887142436771\nVariance: 0.7129578122237161\nghci&gt; main\nAverage: 9.677325092160597\nVariance: 0.9894150286175698\nghci&gt; main\nAverage: 9.714089727813253\nVariance: 1.0279068711054316\nghci&gt; main\nAverage: 10.32028785267642\nVariance: 0.8574243439019995\nghci&gt; main\nAverage: 9.696843993234065\nVariance: 0.45301180269725994\n</code></pre>\n"}], "owner": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 450, "favorite_count": 0, "accepted_answer_id": 41869560, "answer_count": 1, "score": 4, "last_activity_date": 1485419968, "creation_date": 1485418543, "question_id": 41869238, "link": "https://stackoverflow.com/questions/41869238/how-to-generate-n-random-numbers-from-a-normal-distribution-using-random-fu-has", "title": "How to generate n random numbers from a normal distribution using random-fu (Haskell)?", "body": "<p>The question seems straightforward to me, yet I couldn't find easily an answer.</p>\n\n<p>Lets say that you want to take a sample of size n from a normal distribution with mean 10 and variance 1 and then get their average and variance to verify that the sample is from a normal distribution.</p>\n\n<p>It would be something like this, I suppose:</p>\n\n<pre><code>values = take n $ sample (normal 10 1)\n(avg values, variance values)\n</code></pre>\n\n<p>I'm trying to use the library random-fu, so if you can provide an answer using that lib, I would really appreciate it.</p>\n"}, {"tags": ["haskell", "gadt"], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 3, "last_activity_date": 1485427404, "last_edit_date": 1485427404, "creation_date": 1485426632, "answer_id": 41871470, "question_id": 41865466, "link": "https://stackoverflow.com/questions/41865466/library-for-existential-type-wrappers/41871470#41871470", "title": "Library for existential type wrappers", "body": "<p>I dunno whether this is in a library anywhere, but I like to use the following general-purpose existential:</p>\n\n<pre><code>data Ex f = forall a. Ex (f a)\n</code></pre>\n\n<p>With <code>PolyKinds</code> <code>Ex</code> can existentially wrap up the parameter of any type <code>f :: k -&gt; *</code>. How general-purpose is this? We can manipulate <code>f</code> until it's the right shape, and we can build in whatever extra information we need, with a little library of type combinators. Working with general-purpose types like this is a powerful way to program, but often it's simpler just to roll your own.</p>\n\n<hr>\n\n<p>Suppose we want to existentially quantify both halves of a two-parameter type <code>p</code>. One can use the following GADT to <em>uncurry</em> <code>p</code>, turning it from a two-parameter type <code>k1 -&gt; k2 -&gt; *</code> into a one-parameter type <code>(k1, k2) -&gt; *</code>.</p>\n\n<pre><code>data Uncurry p ij where\n    Uncurry :: { getUncurry :: p i j } -&gt; Uncurry p '(i, j)\n</code></pre>\n\n<p>Now <code>Uncurry p</code> can be existentially wrapped.</p>\n\n<pre><code>type ExP p = Ex (Uncurry p)\n</code></pre>\n\n<hr>\n\n<p>Suppose I want to pair up my existentially-wrapped type with some evidence such as a singleton, so that one can recover the existentially quantified index. I'll use the index-respecting product to pair up two functors <code>f</code> and <code>g</code>:</p>\n\n<pre><code>newtype (f :*: g) i = f i :*: g i\n</code></pre>\n\n<p>If, say, <code>f</code> is a GADT, pattern-matching on the <code>f</code>-half of the pair will tell you about <code>g</code>'s index. Now, <code>f :*: g</code> has the right kind to be existentially wrapped.</p>\n\n<pre><code>type ExPair f g = Ex (f :*: g)\n</code></pre>\n\n<p>In practice you might write <code>ExPair Sing f</code> to pair up <code>f</code> with a singleton.</p>\n\n<hr>\n\n<p>Suppose I need the aforementioned evidence in constraint form. I can replace <code>Sing</code> from above with the following type which reifies an instance dictionary for <code>c a</code> as a (visible) runtime value:</p>\n\n<pre><code>data Dict1 c a where\n    Dict1 :: c a =&gt; Dict1 c a\n</code></pre>\n\n<p>(or you could use <a href=\"https://hackage.haskell.org/package/constraints-0.9/docs/Data-Constraint.html\" rel=\"nofollow noreferrer\">the <code>constraints</code> package</a>: <code>newtype Dict1 c a = Dict1 { getDict1 :: Dict (c a) }</code>.) Now I just need to set the left-hand part of my pair to be <code>Dict1 c</code>:</p>\n\n<pre><code>type ExDictPair c f = ExPair (Dict1 c) f\n</code></pre>\n\n<p>So you might write <code>ExDictPair SingI f</code> to package up an implicit singleton.</p>\n\n<hr>\n\n<p>Suppose the thing I need to existentially quantify is at a higher kind, eg <code>* -&gt; *</code>. (I might want to talk about \"some instance of <code>Monad</code> containing an <code>Int</code>\".) <code>Ex</code> is poly-kinded, but it only existentially quantifies the right-most parameter of its argument. So we need the <code>* -&gt; *</code> part of the type to be the last argument of our datatype. I can write a type combinator for that too:</p>\n\n<pre><code>newtype RApp a f = RApp { getRApp :: f a }\n\ntype SomeMonadAppliedToInt = ExDictPair Monad (RApp Int)\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1485427404, "creation_date": 1485401205, "last_edit_date": 1485403729, "question_id": 41865466, "link": "https://stackoverflow.com/questions/41865466/library-for-existential-type-wrappers", "title": "Library for existential type wrappers", "body": "<p>Lets say I've got the following:</p>\n\n<pre><code>data T a\n\nf :: a -&gt; (exists t. T t)\ng :: T b -&gt; c\n\nh :: a -&gt; c\nh = g . f\n</code></pre>\n\n<p>As I know, the type signature for <code>f</code> is not valid Haskell. I can instead do this though:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata T a\n\ndata ExistsTA where\n  ExistsTA :: T a -&gt; ExistsTA\n\nf :: a -&gt; ExistsTA\ng :: T b -&gt; c\n\nh :: a -&gt; c\nh x = case (f x) of ExistsTA x' -&gt; g x'\n</code></pre>\n\n<p>Which compiles fine. I was wondering, is there a library that generalises the creation of the <code>ExistsTA</code> data type (perhaps takes <code>T</code> as a parameter), or do I have to roll my own everytime I want to do this (which is not a big deal, just don't want to reinvent the wheel if I don't need too). </p>\n\n<p>In particular, for my application, I would also like wrappers in this form:</p>\n\n<pre><code>data C where\n  C1 :: C\n  ...\n\ndata D (a :: C) where\n  D1 a :: D\n  ...\n\ndata T (d :: D) a\n\nf :: T (D1 C1) a -&gt; exists c. T (D1 c) a\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "is_accepted": true, "score": 3, "last_activity_date": 1485406943, "creation_date": 1485406943, "answer_id": 41867195, "question_id": 41865281, "link": "https://stackoverflow.com/questions/41865281/how-do-i-read-from-a-file-and-add-the-numbers-in-the-text-file-in-haskell/41867195#41867195", "title": "How do I read from a file and add the numbers in the text file in Haskell", "body": "<p>I can't sure your 'manipulate' means what, but I will assume you need integer calculation. It won't be difficult to manipulate as string.</p>\n\n<p>If you <a href=\"https://www.haskell.org/hoogle/?hoogle=String+-%3E+Int\" rel=\"nofollow noreferrer\">hoogle</a> the signature <code>String -&gt; Int</code> you can find the <code>read</code>.</p>\n\n<pre><code>-- | this fuction read first line in a file and write out +1 result\n--   to src file src \"src.txt\", des \"des.txt\"\neachPlusOne :: FilePath -- ^ path to input file\n            -&gt; FilePath -- ^ path to output file\n            -&gt; IO ()\neachPlusOne src dst = do\n  contect &lt;- readFile src\n  let lns = lines contect :: [String]\n      ints = map ((1+) . read) lns :: [Int]\n      outs = unlines . map show $ ints :: String\n  writeFile dst outs\n</code></pre>\n\n<p>If you are using sufficiently recent version of ghc, you can use <code>readMaybe</code> which is desirable.</p>\n"}], "owner": {"reputation": 61, "user_id": 6055914, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/bac13b3a6a5bc3c7adbf4f24c55d599a?s=128&d=identicon&r=PG&f=1", "display_name": "agarc", "link": "https://stackoverflow.com/users/6055914/agarc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "accepted_answer_id": 41867195, "answer_count": 1, "score": 2, "last_activity_date": 1485451063, "creation_date": 1485399777, "last_edit_date": 1485451063, "question_id": 41865281, "link": "https://stackoverflow.com/questions/41865281/how-do-i-read-from-a-file-and-add-the-numbers-in-the-text-file-in-haskell", "title": "How do I read from a file and add the numbers in the text file in Haskell", "body": "<p>I'm new to Haskell and IO is still a bit confusing. I have a txt file that I want to read, add the numbers in the text file, and then write it to a text file. the file looks like the following:</p>\n\n<pre><code>2\n3\n</code></pre>\n\n<p>the numbers are separated by a new line character I know how to read a file contents then write it to another file but I don't know how I can manipulate it or if I have to cast the information to an Int?</p>\n\n<pre><code>module Main where\n\nimport System.Environment\n\n-- | this fuction read first line in a file and write out to src file\n-- src \"src.txt\", des \"des.txt\"\ncopyFirstLine :: FilePath -- ^ path to input file\n              -&gt; FilePath -- ^ path to output file\n              -&gt; IO ()\ncopyFirstLine src dst = do\ncontect &lt;- readFile src \nlet (fst :rest) = (lines contect)\nwriteFile dst fst\n\nmain = do\n[src,dst] &lt;- getArgs \ncopyFirstLine src dst\n</code></pre>\n\n<p>Thanks in advance.</p>\n"}]