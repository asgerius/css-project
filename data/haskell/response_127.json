[{"tags": ["haskell", "ocaml", "continuations", "state-monad", "delimited-continuations"], "comments": [{"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1497494615, "post_id": 44555410, "comment_id": 76105383, "body": "@Bergi it&#39;s actually called OchaCaml. I am following the tutorial but I don&#39;t think languages in use impact the understanding of the concept in this case."}], "answers": [{"comments": [{"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1497494769, "post_id": 44557102, "comment_id": 76105423, "body": "that&#39;s the main part i don&#39;t get. should continuation be enough just by passing the current state already? i also don&#39;t understand how to step from the state monad version to cps version."}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1497495048, "post_id": 44557102, "comment_id": 76105473, "body": "also how can i know the type of continuation just by looking at the code? which part should i look, the hole or not the hole?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1497511068, "post_id": 44557102, "comment_id": 76111170, "body": "Think of what you would want to pass if the result of <code>get</code> was supposed to be the current state + 1 (fixing it to <code>State Int</code> for the sake of example). The subsequent state would still be the same as the incoming state, but the result would be different. So you&#39;d need to pass <code>state + 1</code> as the result argument and <code>state</code> as the new state argument to the continuation."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 4, "last_activity_date": 1497489910, "creation_date": 1497489910, "answer_id": 44557102, "question_id": 44555410, "link": "https://stackoverflow.com/questions/44555410/how-does-get-work-in-the-cps-version-of-the-state-monad/44557102#44557102", "title": "How does `get` work in the CPS version of the State monad?", "body": "<p>You apply <code>k</code> on <code>state</code> twice because the first one corresponds to the result of <code>get ()</code> (we want <code>get</code>'s effect to be retrieving the current state and returning it as the result) and the second one corresponds to passing the state after the <code>get</code> (which, because <code>get</code> doesn't change the state, is the same as the state before the <code>get</code>) to the next stateful computation.</p>\n\n<p>In other words, since the state monad is <code>State s a ~ s -&gt; (a, s)</code>, its CPS version is <code>State s r a ~ s -&gt; (a -&gt; s -&gt; r) -&gt; r</code>, and so for <code>get : State s s</code>, because <code>a ~ s</code>, the continuation will be a function of type <code>s -&gt; s -&gt; r</code>.</p>\n"}], "owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 1, "accepted_answer_id": 44557102, "answer_count": 1, "score": 5, "last_activity_date": 1498857552, "creation_date": 1497477678, "last_edit_date": 1498857552, "question_id": 44555410, "link": "https://stackoverflow.com/questions/44555410/how-does-get-work-in-the-cps-version-of-the-state-monad", "title": "How does `get` work in the CPS version of the State monad?", "body": "<p>I am trying to understand continuation in general following this <a href=\"http://okmij.org/ftp/continuations/#tutorial\" rel=\"nofollow noreferrer\">tutorial</a>.</p>\n\n<p>However, I am having difficulties to understand following example in section 2.10:</p>\n\n<pre><code># let get () =\n    shift (fun k -&gt; fun state -&gt; k state state) ;;\nget : unit =&gt; \u2019a = &lt;fun&gt;\n</code></pre>\n\n<p><code>state</code> is of type <code>int</code> I suppose. What I don't get is the type of <code>k</code>. According to my understanding, <code>k</code> captures all computation comes subsequently after <code>get ()</code>, and since we are talking about a state monad, <code>k</code> is reasonable to represent a computation that will be continued by taking an <code>int</code>, hence</p>\n\n<pre><code>k : int =&gt; 'a\n</code></pre>\n\n<p>but from the code, it doesn't seem to do that and it takes <code>state</code> for a second time, which actually implies:</p>\n\n<pre><code>k : int =&gt; int =&gt; 'a\n</code></pre>\n\n<p>but I don't get where the second one is coming from, and in which sense <code>get</code> is of type <code>unit =&gt; 'a</code> instead of <code>unit =&gt; int =&gt; 'a</code>?</p>\n\n<p>Compared to the actual state monad implementation, the confusion adds more:</p>\n\n<pre><code>newtype StateT s m a = StateT { runStateT :: s -&gt; m (a,s) }\n</code></pre>\n\n<p>i.e. state transition is represented as a function from state to a tuple of result and state, which matches my first understanding.</p>\n\n<p>Can anyone give a lead?</p>\n\n<p>Secondly, how am I supposed to implement <code>get</code> here using Haskell's <code>Control.Monad.Trans.Cont</code>? I am having problems comforting the type system.</p>\n\n<hr>\n\n<p>UPDATE</p>\n\n<p>It seems I got the second one:</p>\n\n<pre><code>Prelude Control.Monad.Trans.Cont&gt; let get () = shift $ \\k -&gt; return $ \\i -&gt; k i i\n</code></pre>\n\n<p>But I still don't get why I need to apply the state twice to the continuation.</p>\n"}, {"tags": ["haskell", "show", "deriving"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1497474926, "post_id": 44554200, "comment_id": 76100055, "body": "More related questions: <a href=\"https://stackoverflow.com/q/15823732/791604\">1</a>, <a href=\"https://stackoverflow.com/q/15015698/791604\">2</a>, <a href=\"https://stackoverflow.com/q/10551210/791604\">3</a>."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1497475005, "post_id": 44554243, "comment_id": 76100094, "body": "If the domain is small, <a href=\"http://hackage.haskell.org/package/universe-reverse-instances-1.0/docs/src/Data-Universe-Instances-Show.html\" rel=\"nofollow noreferrer\">Data.Universe.Instances.Show</a> is another alternative."}], "tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": true, "score": 3, "last_activity_date": 1497472681, "last_edit_date": 1497472681, "creation_date": 1497472378, "answer_id": 44554243, "question_id": 44554200, "link": "https://stackoverflow.com/questions/44554200/haskell-deriving-show-error/44554243#44554243", "title": "Haskell deriving Show error", "body": "<p><code>action</code> is of type <code>marking -&gt; [marking]</code> and there is no instance of typeclass <code>Show</code> for functions.</p>\n\n<p>You can import <code>Text.Show.Functions</code> for an typeclass instance of <code>Show</code> for functions, but I don't know, if it shows something useful or only <code>\"Function\"</code> for any function.</p>\n"}], "owner": {"reputation": 93, "user_id": 4136474, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e1S3E.jpg?s=128&g=1", "display_name": "Denis Visan", "link": "https://stackoverflow.com/users/4136474/denis-visan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 469, "favorite_count": 0, "closed_date": 1497474770, "accepted_answer_id": 44554243, "answer_count": 1, "score": 1, "last_activity_date": 1497472681, "creation_date": 1497472206, "question_id": 44554200, "link": "https://stackoverflow.com/questions/44554200/haskell-deriving-show-error", "closed_reason": "Duplicate", "title": "Haskell deriving Show error", "body": "<p>I did some research about Colored Petri Nets for a university assessment, and I need to implement them in Haskell. I used <a href=\"http://community.haskell.org/~claus/publications/HCPN.pdf\" rel=\"nofollow noreferrer\">this</a> document as a point of start.</p>\n\n<p>When I am trying to import this module in Haskell:</p>\n\n<pre><code>module SimpleHCPN where\n\nimport Data.List\nimport System.Random\n\ndata Net marking = Net {trans :: [Transition marking]}\n                   deriving (Show)\ndata Transition marking = Transition { name :: String\n                                     , action :: marking -&gt; [marking]\n                                     }\n                          deriving (Show)\n</code></pre>\n\n<p>I receive the following error:</p>\n\n<pre><code>SimpleHCPN.hs:11:37: error:\n    * No instance for (Show (marking -&gt; [marking]))\n        arising from the second field of `Transition'\n          (type `marking -&gt; [marking]')\n        (maybe you haven't applied a function to enough arguments?)\n      Possible fix:\n        use a standalone 'deriving instance' declaration,\n          so you can specify the instance context yourself\n    * When deriving the instance for (Show (Transition marking))\n</code></pre>\n\n<p>I'm still a newbie in Haskell, so a little bit of help would be appreciated.</p>\n\n<p>Thanks,\nDenis</p>\n"}, {"tags": ["haskell", "monad-transformers", "scotty"], "answers": [{"tags": [], "owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "is_accepted": true, "score": 3, "last_activity_date": 1497475782, "creation_date": 1497475782, "answer_id": 44555037, "question_id": 44552424, "link": "https://stackoverflow.com/questions/44552424/forking-new-threads-in-scotty-server/44555037#44555037", "title": "Forking new Threads in Scotty Server", "body": "<p>I think you need to move the call to <code>text result</code> out of the forked thread and use an <code>MVar</code> to communicate when the result is ready. So something like</p>\n\n<pre><code>get \"/add/:id\" $ do\n    taskId &lt;- fmap unpack (param \"id\")\n    let task = return \"Hello World\"\n    m &lt;- newEmptyMVar\n    tid &lt;- liftIO $ C.forkIO $ do\n        result &lt;- task\n        putMVar result\n        ...\n    r &lt;- takeMVar m\n    text r\n</code></pre>\n\n<p><code>takeMVar</code> will block until the <code>MVar</code> contains a value.</p>\n"}], "owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 44555037, "answer_count": 1, "score": 2, "last_activity_date": 1497475782, "creation_date": 1497465952, "question_id": 44552424, "link": "https://stackoverflow.com/questions/44552424/forking-new-threads-in-scotty-server", "title": "Forking new Threads in Scotty Server", "body": "<p>I am prototyping a Web server in Scotty with two APIs:</p>\n\n<ul>\n<li><code>/add/:id</code> starts an asyc task with the given Id.</li>\n<li><code>/cancel/:id</code> kills the task for the given Id.</li>\n</ul>\n\n<p>Basically clients start async tasks by providing some Ids and can also kill their current tasks by their Ids.</p>\n\n<p>I use <code>Control.Concurrent.forkIO</code> to start a thread, <code>forkIO</code> returns a <code>ThreadId</code> that I store in the Scotty global state which is a Map: <code>type AppState = Map TaskId ThreadId</code>.</p>\n\n<p><code>/add/:id</code> does not return immediately but it waits for the task to complete and returns the result to the client.</p>\n\n<p>My problem is mixing <code>forkIO</code> with <code>MonadIO m =&gt; ActionT Text m ()</code>. I need to be able to call <code>text :: Text -&gt; ActionT Text m ()</code> after the completion of the <code>IO ()</code> action that I passed <code>forkIO</code>.</p>\n\n<p>This requires going from <code>MonadIO m</code> to <code>IO</code> that is obviously an error, but I cannot get my head around it and find any solution. </p>\n\n<p>This is the full example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import qualified Control.Concurrent as C\nimport qualified Control.Concurrent.STM as STM\nimport Control.Monad.Trans.Reader (ReaderT(..), runReaderT)\nimport Control.Monad.Trans (MonadIO)\nimport Control.Monad.Reader (MonadReader, lift, liftIO, ask)\nimport qualified Data.Map as M\nimport Data.Text.Lazy (Text, pack, unpack)\nimport Web.Scotty.Trans\n\n\ntype TaskId = String\n\ntype AppState = M.Map TaskId C.ThreadId\n\nnewtype WebM a = WebM { runWebM :: ReaderT (STM.TVar AppState) IO a }\n  deriving (Applicative, Functor, Monad, MonadIO, MonadReader (STM.TVar AppState))\n\napp :: ScottyT Text WebM ()\napp = do\n  get \"/add/:id\" $ do\n    taskId &lt;- fmap unpack (param \"id\")\n    let task = return \"Hello World\" -- just a dummy IO\n    tid &lt;- liftIO $ C.forkIO $ do\n      result &lt;- task\n      -- Couldn't match type \u2018ActionT Text m\u2019 with \u2018IO\u2019\n      lift $ modify' $ M.delete taskId -- remove the completed task from the state\n      text result -- return the result to the client\n      return () -- forkIO :: IO () -&gt; IO ThreadId\n    lift $ modify' $ M.insert taskId tid -- immedialtey add the new task to the state\n\n  get \"/cancel/:id\" $ do\n    taskId &lt;- fmap unpack (param \"id\")\n    dic &lt;- lift $ gets id\n    maybe\n      (text $ pack (taskId ++ \" Not Found\"))\n      (\n        \\ tid -&gt; do\n          liftIO $ C.killThread tid\n          lift $ modify' $ M.delete taskId -- remove the cancelled task from the state\n          text $ pack (taskId ++ \" Cancelled\")\n      )\n      (M.lookup taskId dic)\n\ngets :: (AppState -&gt; b) -&gt; WebM b\ngets f = fmap f (ask &gt;&gt;= liftIO . STM.readTVarIO)\n\nmodify' :: (AppState -&gt; AppState) -&gt; WebM ()\nmodify' f = ask &gt;&gt;= liftIO . STM.atomically . flip STM.modifyTVar' f\n\nmain :: IO ()\nmain = do\n  dic &lt;- STM.newTVarIO M.empty\n  let runActionToIO m = runReaderT (runWebM m) dic\n  scottyT 3000 runActionToIO app\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1497457017, "post_id": 44548512, "comment_id": 76090362, "body": "Note that evaluation order and precedence are two different concepts, often wrongly identified. Even in an imperative language, <code>f() + g() * h()</code> could be evaluated by first calling <code>g()</code>, then <code>f()</code>, then <code>h()</code> (or any other order), and then performing the multiplication, and finally the addition."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 6, "last_activity_date": 1497453354, "creation_date": 1497453354, "answer_id": 44548652, "question_id": 44548512, "link": "https://stackoverflow.com/questions/44548512/why-the-evaluation-stops/44548652#44548652", "title": "Why the evaluation stops?", "body": "<blockquote>\n  <p>Why expression in the parentheses does not get evaluated as first?</p>\n</blockquote>\n\n<p>Haskell uses lazy evaluation. This means an argument is evaluated if and when it is used by the function. This differs from eager evaluation where all arguments of the function are executed before the function is called.</p>\n\n<blockquote>\n  <p>Because function application has higher precedence then parentheses?</p>\n</blockquote>\n\n<p>Precedence has nothing to do with it. Precedence just determines what's an operand to what (i.e. is \"x ??? y !!! z\" an application of the operator <code>???</code> to the operands <code>x</code> and <code>y !!! z</code> or of the operator <code>!!!</code> to <code>x ??? y</code> and <code>z</code>). It does not affect evaluation order.</p>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1497460938, "post_id": 44550581, "comment_id": 76092533, "body": "By &quot;above&quot;, do you mean sepp2k&#39;s answer? Don&#39;t assume any particular ordering of answers on a page."}], "tags": [], "owner": {"reputation": 555, "user_id": 1505475, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bc72887d0b9f71cdbc2eeb5f9899d8f?s=128&d=identicon&r=PG", "display_name": "simon1505475", "link": "https://stackoverflow.com/users/1505475/simon1505475"}, "is_accepted": false, "score": 2, "last_activity_date": 1497487314, "last_edit_date": 1497487314, "creation_date": 1497459272, "answer_id": 44550581, "question_id": 44548512, "link": "https://stackoverflow.com/questions/44548512/why-the-evaluation-stops/44550581#44550581", "title": "Why the evaluation stops?", "body": "<p>What I believe you are expecting what is called \"applicative evaluation order\". In other words, in <code>f (g x)</code>, you expect <code>g x</code> to be evaluated first, then <code>f</code> to be called on the result.</p>\n\n<p>In your example, that would mean that evaluation would start with evaluating <code>0</code>, <code>[1]</code> and <code>undefined</code> which is where I believe you expect the crash.</p>\n\n<p>Haskell has what is called \"call by need\" or \"lazy evaluation\". In <code>f (g x)</code>, <code>f</code> is evaluated first, providing it as an argument a program (often referred to as \"thunk\") to evaluate <code>g x</code>. That means that if the value of <code>g x</code> is never needed by <code>f</code>, it never gets evaluated.</p>\n\n<p>Here is how your example would get evaluated (I'm placing the definition of <code>foldr</code> below for reference):</p>\n\n<pre><code>  foldr const 0 ([1] ++ undefined)          -- one step of evaluation of ++\n= foldr const 0 (1 : ([] ++ undefined))     -- second equation of foldr\n= const 1 (foldr const 0 ([] ++ undefined)) -- evaluate const\n= 1\n</code></pre>\n\n<p>And here is the definitions of <code>foldr</code> and <code>(++)</code>:</p>\n\n<pre><code>foldr _ z []     =  z\nfoldr f z (x:xs) =  f x (foldr f z xs)\n\n(++) [] ys = ys\n(++) (x:xs) ys = x : (xs ++ ys)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 3, "last_activity_date": 1497462045, "last_edit_date": 1497462045, "creation_date": 1497461367, "answer_id": 44551163, "question_id": 44548512, "link": "https://stackoverflow.com/questions/44548512/why-the-evaluation-stops/44551163#44551163", "title": "Why the evaluation stops?", "body": "<p>To properly evaluate <code>const 1 (const undefined 0)</code>, we need to know the definition of <code>const</code>, the evaluation strategy used by GHC, and the behavior of currying in functions which (appear to) take multiple arguments. (Not necessarily in that order.)</p>\n\n<h3>Definition of <code>const</code></h3>\n\n<p>The definition of const is</p>\n\n<pre><code>const c _ = c\n</code></pre>\n\n<h3>Currying</h3>\n\n<p>Functions which seem to take multiple arguments are actually <em>curried</em>:</p>\n\n<pre><code>f x y = (f x) y\n</code></pre>\n\n<p>We can explicitly curry <code>const</code> using <em>eta abstraction</em> (<code>f x = y</code> becomes <code>f = \\x -&gt; y</code>), turning it into a function that takes an argument and gives another function:</p>\n\n<pre><code>const c _ = c\n= { eta abstraction }\nconst c = \\_ -&gt; c\n</code></pre>\n\n<p>Combining these two concepts means that whenever we see <code>const x y</code>, we can replace it with <code>(\\_ -&gt; x) y</code>:</p>\n\n<pre><code>const x y\n= { currying }\n(const x) y\n= { const c = \\_ -&gt; c }\n(\\_ -&gt; x) y\n</code></pre>\n\n<h3>Outermost Evaluation and Short Circuiting</h3>\n\n<p>Evaluation in Haskell* starts with the outermost reducible expression (redex) and is triggered by pattern matching. This means that in <code>f (g x)</code>, <code>f</code> is evaluated before <code>g x</code> (it is <em>outermost</em>). <code>g x</code> is then only evaluated if the evaluation of <code>f</code> demands it. Then, in turn, <code>x</code> is only evaluated if the evaluation of <code>g</code> demands it.</p>\n\n<p>One of the properties of outermost-first evaluation is *short-circuiting(: if the evaluation of an outer expression doesn't demand a result from an inner expression, the inner expression is never evaluated. In particular, this means that <code>(\\_ -&gt; x) y = x</code> regardless of what <code>y</code> is, because <code>\\_ -&gt; x</code> doesn't demand the evaluation of <code>y</code>.</p>\n\n<h3>Evaluating <code>const 1 (const undefined 0)</code></h3>\n\n<p>Putting these together, we can evaluate <code>const 1 (const undefined 0)</code></p>\n\n<pre><code>const 1 (const undefined 0)\n= { const x y = (\\_ -&gt; x) y }\n(\\_ -&gt; 1) (const undefined 0)\n= { (\\_ -&gt; x) y = x }\n1\n</code></pre>\n\n<p>Once you understand this, it's easy enough to skip over the currying and just write:</p>\n\n<pre><code>const 1 (const undefined 0)\n= { definition of const }\n1\n</code></pre>\n\n<p>because <code>const c _ = c</code>, <code>c = 1</code>, and we know the second argument is never evaluated.</p>\n\n<p>(You also asked about precedence but precedence is not relevant to the evaluation of <code>const 1 (const undefined 0)</code>.)</p>\n\n<hr>\n\n<p>* Strictly speaking**, Haskell does not define an evaluation order. It specifies that evaluation must be <em>non-strict</em> and leaves the implementation of this semantics up to Haskell implementations. GHC uses <em>lazy evaluation</em>, which is outermost-first evaluation combined with <em>sharing</em> (which says that <code>x</code> will be evaluated at most once in <code>let x = 1 + 1 in x * x</code>).</p>\n\n<p>** Yes, this is a pun.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1497487314, "creation_date": 1497452926, "question_id": 44548512, "link": "https://stackoverflow.com/questions/44548512/why-the-evaluation-stops", "title": "Why the evaluation stops?", "body": "<p>I have following code:</p>\n\n<pre><code>foldr const 0 ([1] ++ undefined)\n</code></pre>\n\n<p>and I've got as the result <code>1</code>.</p>\n\n<p>I know, that <code>foldr</code> is right associated. Writing out the example from above:</p>\n\n<pre><code>const 1 (const undefined 0)\n</code></pre>\n\n<p>Why expression in the parentheses does not get evaluated as first? </p>\n\n<p>Because function application has higher precedence then parentheses?</p>\n"}, {"tags": ["haskell", "haskell-turtle"], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1497450091, "creation_date": 1497450091, "answer_id": 44547449, "question_id": 44547216, "link": "https://stackoverflow.com/questions/44547216/finding-all-the-files-under-a-directory-in-turtle-that-match-a-pattern/44547449#44547449", "title": "Finding all the files under a directory in turtle that match a pattern", "body": "<p><a href=\"https://hackage.haskell.org/package/turtle-1.3.6/docs/Turtle-Prelude.html#v:lsif\" rel=\"nofollow noreferrer\"><code>lsif</code></a> sounds more like what you want. The documentation contains an example how to print the complete tree:</p>\n\n<blockquote>\n<pre><code>lstree = lsif (\\_ -&gt; return True)\n</code></pre>\n</blockquote>\n\n<p>So in your case, you would use</p>\n\n<pre><code>lstree \".\"\n</code></pre>\n\n<p>Note that the output between <code>find</code> and <code>lstree \".\"</code> differs slightly: the original path isn't duplicated in the latter.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 44547449, "answer_count": 1, "score": 2, "last_activity_date": 1545515471, "creation_date": 1497449414, "last_edit_date": 1545515471, "question_id": 44547216, "link": "https://stackoverflow.com/questions/44547216/finding-all-the-files-under-a-directory-in-turtle-that-match-a-pattern", "title": "Finding all the files under a directory in turtle that match a pattern", "body": "<p>I'd like to use the <a href=\"https://hackage.haskell.org/package/turtle-1.3.6/docs/Turtle-Prelude.html#v:find\" rel=\"nofollow noreferrer\">find</a> function from the turtle package such that it matches any file path (in order to get an equivalent behavior to <code>find .</code> in bash). However I cannot find a wildcard <a href=\"https://hackage.haskell.org/package/turtle-1.3.6/docs/Turtle-Pattern.html#t:Pattern\" rel=\"nofollow noreferrer\">pattern</a> that I can use with this function.</p>\n\n<pre><code>find :: Pattern a -&gt; FilePath -&gt; Shell FilePath\n</code></pre>\n\n<p>I guess I could construct a pattern that matches any character zero or more times, but I'd like to avoid re-inventing the wheel. </p>\n"}, {"tags": ["list", "haskell", "infinite"], "comments": [{"owner": {"reputation": 3946, "user_id": 1261166, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vL1Ud.jpg?s=128&g=1", "display_name": "Viktor Mellgren", "link": "https://stackoverflow.com/users/1261166/viktor-mellgren"}, "edited": false, "score": 1, "creation_date": 1497442551, "post_id": 44544214, "comment_id": 76079575, "body": "Maybe this is something to look at <a href=\"https://hackage.haskell.org/package/fixed-list-0.1.6/docs/Data-FixedList.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/fixed-list-0.1.6/docs/&hellip;</a>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1497443367, "post_id": 44544214, "comment_id": 76080158, "body": "Haskell doesn&#39;t feature a termination checker, so you can&#39;t distinguish a computation which runs for ever from one which terminates. All recursive data structures are potentially infinite. Total languages (eg Agda, Coq) often distinguish <i>inductive</i> (finite) datatypes from <i>coinductive</i> (possibly-infinite) datatypes, but Haskell is not a total language."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1497456789, "post_id": 44544214, "comment_id": 76090246, "body": "This definitely doesn&#39;t answer the question, but doing the exact opposite is quite a bit easier! This: <code>data Stream a = Cons a (Stream a)</code> cannot have finite lists (excluding things like <code>undefined</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1497445270, "post_id": 44545229, "comment_id": 76081621, "body": "Thanks a lot for these examples! I was not aware of the strict fields. I&#39;m trying to understand alternative 2 now: It seems that <code>Nat</code> basically implements the natural numbers. I don&#39;t quite understand the last two lines (<code>data MyList a where ...</code>),  what is going on there?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 1, "creation_date": 1497445630, "post_id": 44545229, "comment_id": 76081906, "body": "@flawr it&#39;s a <a href=\"https://en.wikibooks.org/wiki/Haskell/GADT\" rel=\"nofollow noreferrer\">Generalised Algebraic DataType</a>, in this case used to <i>existentially</i> encapsulate a type variable (namely, the type encoded length <code>n</code>). So, basically this packs a type-level number into a runtime value."}, {"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1497446016, "post_id": 44545229, "comment_id": 76082221, "body": "Thank you for the explanation and link, I&#39;ll probably have to look into that when I&#39;m a little bit more familiar with Haskell!"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1497451018, "post_id": 44545229, "comment_id": 76086223, "body": "Haskell types must be finite, which gives you a shortcut for proving the finiteness of all values in Alternative 2."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1497452995, "post_id": 44545229, "comment_id": 76087659, "body": "@flawr Yes, that would be advisable. Haskell type-level machinery is quite advanced, and some of its most powerful features, like GADTs + DataKinds + etc. can be a bit intimidating at first. It&#39;s indeed better to become familiar with the basic algebraic data types, and the rest of Haskell, first."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1497453300, "post_id": 44545229, "comment_id": 76087896, "body": "@rampion Probably that&#39;s enough, yes. Still, 1) type are erased at runtime,  2) the concrete values for the existentially quantified <code>n::Nat</code> are not known at compile time, 3) <code>n</code> would be known at runtime if it weren&#39;t erased. This makes me a little unconfortable, but I&#39;m probably paranoic here. I just need to convince myself that types <code>n</code> could be kept at runtime, and that erasure is only an optimization."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1497453868, "post_id": 44545229, "comment_id": 76088345, "body": "Consider <code>MyList (fix (Cons 1))</code>.  Even though the type of <code>fix (Cons 1)</code> is erased at runtime, it still must have <i>some</i> legal type, which is why the compiler complains <code>Occurs check: cannot construct the infinite type: n0 ~ &#39;S n0</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497527416, "post_id": 44545229, "comment_id": 76122036, "body": "Can&#39;t the first result in a <i>circular list</i>? Like <code>let x = Cons 1 x</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497531200, "post_id": 44545229, "comment_id": 76124606, "body": "@WillemVanOnsem That will diverge, it is equivalent to <code>let x = seq x (Cons 1 x)</code>, or to <code>let x=x</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1497444873, "last_edit_date": 1497444873, "creation_date": 1497444353, "answer_id": 44545229, "question_id": 44544214, "link": "https://stackoverflow.com/questions/44544214/finite-recursive-list-type/44545229#44545229", "title": "finite recursive &quot;List&quot; type", "body": "<h2>Alternative 1: lists with a strict tail</h2>\n\n<pre><code>data MyList a = Cons a !(MyList a) | Empty\n</code></pre>\n\n<p>Trying to build an infinite list will surely lead to a bottom element of <code>MyList a</code>.</p>\n\n<h2>Alternative 2: existentially-quantified fixed-length list</h2>\n\n<pre><code>data Nat = O | S Nat\ndata List a (n :: Nat) where\n   Nil :: List a O\n   Cons :: a -&gt; List a n -&gt; List a (S n)\ndata MyList a where\n   MyList :: List a n -&gt; MyList a\n</code></pre>\n\n<p>I would say that this does not allow for infinite lists as well.</p>\n\n<p>This is because we can't pattern match on a GADT with <code>where</code> (or lazy patterns in general).</p>\n\n<pre><code>-- fails to compile\ntest :: MyList Int\ntest = MyList (Cons 1 list)\n       where MyList list = test\n</code></pre>\n\n<p>The following would be too strict.</p>\n\n<pre><code>-- diverges\ntest2 :: MyList Int\ntest2 = case test2 of\n          MyList list -&gt; MyList (Cons 1 list)\n</code></pre>\n\n<p>The following makes the existentially quantified type variable \"escape\" the scope of the <code>case</code>:</p>\n\n<pre><code>-- fails to compile\ntest3 :: MyList Int\ntest3 = MyList $ case test3 of\n          MyList list -&gt; (Cons 1 list)\n</code></pre>\n"}], "owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 528, "favorite_count": 2, "accepted_answer_id": 44545229, "answer_count": 1, "score": 4, "last_activity_date": 1497444873, "creation_date": 1497441679, "last_edit_date": 1497442209, "question_id": 44544214, "link": "https://stackoverflow.com/questions/44544214/finite-recursive-list-type", "title": "finite recursive &quot;List&quot; type", "body": "<p>It is easy to reconstruct the list type in Haskell:</p>\n\n<pre><code>data MyList a = Cons a (MyList a)\n               | Empty\n               deriving (Show)\n\nsomeList = Cons 1 (Cons 2 (Cons 3 Empty)) -- represents [1,2,3]\n</code></pre>\n\n<p>This allows for constructing infinites lists. Is it possible to somehow define a list type, that only allows for <em>finite</em> (but still arbitrary length) lists?</p>\n\n<p>The example of lists here can replaced with any other potentially infinite data structures like trees etc. Note that I do not have any particular application in mind, so there is no need to question the usefullness of this, I'm just curious whether that would be possible.</p>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 3, "creation_date": 1497437091, "post_id": 44542460, "comment_id": 76075441, "body": "There&#39;s an instance <code>Utf8 Text ByteString</code>. Is something flipped around here? Do you actually need <code>decode</code> instead? I&#39;m not super familiar with conduit, but what direction does your last line flow (right to left or left to right)?"}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1497439738, "post_id": 44542460, "comment_id": 76077436, "body": "@BartekBanachewicz - hi. I updated my question with my understanding of the types. Thanks for your help!"}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 1, "creation_date": 1497451640, "post_id": 44542460, "comment_id": 76086687, "body": "Please post the output of <code>ghc-pkg list bytestring</code> and <code>ghc-pkg list mono-traversable</code>. Also, what version of ghc are you using? Newer one should produce better error message in such cases."}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "reply_to_user": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1497524932, "post_id": 44542460, "comment_id": 76120458, "body": "@Yuras - <code>$ghc-pkg list bytestring &#47;usr&#47;local&#47;Cellar&#47;ghc&#47;8.0.1_4&#47;lib&#47;ghc-8.0.1.20161213&#47;package&zwnj;&#8203;.conf.d     bytestring-0.10.8.1 $ghc-pkg list mono-traversable &#47;usr&#47;local&#47;Cellar&#47;ghc&#47;8.0.1_4&#47;lib&#47;ghc-8.0.1.20161213&#47;package&zwnj;&#8203;.conf.d</code>. How do I tell which <code>GHC</code> I&#39;m using on this <code>stack</code> project?"}], "answers": [{"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1497524683, "post_id": 44550856, "comment_id": 76120282, "body": "Thanks for this detailed answer. When you use <code>~</code>, e.g. <code>a ~ text</code>, can I read that to mean, <code>a</code> has type of <code>text</code>?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 2, "creation_date": 1497533499, "post_id": 44550856, "comment_id": 76126377, "body": "No, <code>a</code> and <code>type</code> are both type variables. It means <code>a = text</code>, at the type level."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1497460272, "creation_date": 1497460272, "answer_id": 44550856, "question_id": 44542460, "link": "https://stackoverflow.com/questions/44542460/resolving-no-instance-for-with-conduits-mono-traversable/44550856#44550856", "title": "Resolving &quot;No instance for ...&quot; with conduit&#39;s mono-traversable", "body": "<p>The <code>sourceFile</code> conduit produces a <code>ByteString</code>, that you need to <strong>decode</strong> into a <code>Text</code> for <code>x</code> to consume. <strong>Encoding</strong> refers to the opposite direction where you serialize <code>Text</code> to <code>ByteString</code> to be written to file.</p>\n\n<p>Use <a href=\"https://hackage.haskell.org/package/conduit-combinators-1.1.1/docs/Data-Conduit-Combinators.html#v:decodeUtf8\" rel=\"nofollow noreferrer\"><code>decodeUtf8</code></a>.</p>\n\n<hr>\n\n<h2>Why the types don't match</h2>\n\n<pre><code>-- Ignoring the `Monad` constraint.\n\n(=$=)      :: Conduit a m b -&gt; ConduitM b c m r -&gt; ConduitM a c m r\n\nencodeUtf8 :: Utf8 text binary\n           =&gt; Conduit text m binary\n\nx          :: ConduitM Text Void m ()\n</code></pre>\n\n<p>To apply <code>(=$=)</code> to <code>encodeUtf8</code>, you must unify <code>Conduit a m b</code> and <code>Conduit text m binary</code>, so we get the following type equalities:</p>\n\n<pre><code>a ~ text\nb ~ binary\n</code></pre>\n\n<p>Then we apply the result to <code>x</code>, unifying <code>ConduitM b c m r</code> and <code>ConduitM Text Void m ()</code>:</p>\n\n<pre><code>b ~ Text\nc ~ Void\n</code></pre>\n\n<p>Up to here the compiler doesn't complain, but we can already see a mismatch because of the two equalities involving <code>b</code>:</p>\n\n<pre><code>b ~ binary\nb ~ Text\n</code></pre>\n\n<p>In the <code>conduit-combinators</code> library, the type variable <code>binary</code> is used to refer to types that represent raw binary data, typically <code>ByteString</code>, as opposed to more structured data like <code>Text</code>.</p>\n\n<p>If we continue, the result has type <code>ConduitM a c m r</code>, and that is being passed as the second argument of <code>($$)</code>.</p>\n\n<pre><code>-- Expanding Source and Sink definitions, renaming type variables.\n\n($$) :: Monad m =&gt; ConduitM () d m () -&gt; ConduitM d Void m e -&gt; m e\n\nsourceFile infile\n     :: _ =&gt; ConduitM i ByteString m ()\n</code></pre>\n\n<p>Using <code>source infile</code> as the first argument, we unify <code>ConduitM () d m ()</code> with <code>ConduitM i ByteString m ()</code>.</p>\n\n<pre><code>i ~ ()\nd ~ ByteString\n</code></pre>\n\n<p>And with our previous <code>encodeUtf8C =$= x</code> as the second argument of <code>($$)</code>, we unify <code>ConduitM d Void m e</code> with <code>ConduitM a c m r</code>.</p>\n\n<pre><code>a ~ d\nc ~ Void\nr ~ e\n</code></pre>\n\n<p>Focus on <code>a</code> and <code>d</code>, we have the following:</p>\n\n<pre><code>a ~ text\na ~ d\nd ~ ByteString\n</code></pre>\n\n<p>Therefore <code>text ~ ByteString</code>, <code>binary ~ Text</code>. Now remember that to use <code>encodeUtf8</code>, we require a <code>Utf8 text binary</code> constraint, i.e., <code>Utf8 ByteString Text</code>, which is the wrong way around.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 44550856, "answer_count": 1, "score": 2, "last_activity_date": 1497460272, "creation_date": 1497436916, "last_edit_date": 1497441889, "question_id": 44542460, "link": "https://stackoverflow.com/questions/44542460/resolving-no-instance-for-with-conduits-mono-traversable", "title": "Resolving &quot;No instance for ...&quot; with conduit&#39;s mono-traversable", "body": "<p>Given the following code:</p>\n\n<pre><code>import           Data.Attoparsec.Text\nimport qualified Conduit as C\nimport qualified Data.Conduit.Combinators as CC\n\nf :: FilePath -&gt; FilePath -&gt; IO ()\nf infile outfile =\n  runResourceT $\n    CC.sourceFile infile $$ C.encodeUtf8C =$= x\n</code></pre>\n\n<p>where <code>x</code>'s type is <code>ConduitM Text Void (ResourceT IO) ()</code></p>\n\n<p>The following compile-time error occurs in my private github repo:</p>\n\n<pre><code>\u2022 No instance for (mono-traversable-1.0.2:Data.Sequences.Utf8\n                     ByteString Text)\n    arising from a use of \u2018C.encodeUtf8C\u2019\n\u2022 In the first argument of \u2018(=$=)\u2019, namely \u2018C.encodeUtf8C\u2019\n  In the second argument of \u2018($$)\u2019, namely \u2018C.encodeUtf8C =$= x\u2019\n  In the second argument of \u2018($)\u2019, namely\n    \u2018CC.sourceFile infile $$ C.encodeUtf8C =$= x\u2019\n</code></pre>\n\n<p>How can I resolve this compile-time error?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>My understanding of the types:</p>\n\n<pre><code>&gt; :t sourceFile\nsourceFile\n  :: MonadResource m =&gt;\n     FilePath\n     -&gt; ConduitM\n          i bytestring-0.10.8.1:Data.ByteString.Internal.ByteString m ()\n\n&gt; :t ($$)\n($$) :: Monad m =&gt; Source m a -&gt; Sink a m b -&gt; m b\n\n&gt; :t Conduit\ntype Conduit i (m :: * -&gt; *) o = ConduitM i o m ()\n\n&gt; :i Source\ntype Source (m :: * -&gt; *) o = ConduitM () o m ()\n\n&gt; :i Sink\ntype Sink i = ConduitM i Data.Void.Void :: (* -&gt; *) -&gt; * -&gt; *\n\n&gt; :t (=$=)\n(=$=)\n  :: Monad m =&gt; Conduit a m b -&gt; ConduitM b c m r -&gt; ConduitM a c m r\n</code></pre>\n\n<p><code>C.encodeUtf8C =$= x</code> boils down to, I think:</p>\n\n<pre><code>(mono-traversable-1.0.2:Data.Sequences.Utf8 text binary,\n      Monad m) =&gt;\n     Conduit text m binary () \n\n=$= \n\nConduitM Text Void binary () \n</code></pre>\n\n<p>yielding a return type of</p>\n\n<p><code>ConduitM text Void (ResourceT IO) ()</code></p>\n\n<p>And I suppose that this type, i.e. <code>C.encodeUtf8C =$= x</code>, does not unify to the expected second argument of <code>CC.sourceFile</code>?</p>\n"}, {"tags": ["haskell", "yesod", "monad-transformers", "quickcheck", "yesod-test"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1497430242, "post_id": 44539517, "comment_id": 76070396, "body": "Maybe I&#39;m reading something backwards here, but <code>liftIO</code> already has the type you&#39;re looking for: <code>MonadIO m =&gt; IO a -&gt; m a</code>. Your description of <code>liftIO</code> is exactly backwards."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1497430675, "post_id": 44539517, "comment_id": 76070736, "body": "Oh yes, of course, you are right. How embarrassing for me. And thank you for pointing it out. I&#39;ll correct it soon."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1497431341, "post_id": 44539517, "comment_id": 76071246, "body": "@Cubic It&#39;s fixed now, thanks again for pointing it out."}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1497431285, "creation_date": 1497429206, "last_edit_date": 1497431285, "question_id": 44539517, "link": "https://stackoverflow.com/questions/44539517/in-yesod-test-is-it-possible-to-get-into-specm-testapp-site-from-io-simi", "title": "In Yesod.Test, is it possible to get into `SpecM (TestApp site)` from `IO`, similarly to how `liftIO` allows the opposite?", "body": "<p>More specifically, I'm looking for a function of type:</p>\n\n<pre><code>f :: site -&gt; SpecM (TestApp site) b -&gt; IO b\n</code></pre>\n\n<p>or similar.</p>\n\n<p>In other words, I am looking for the inverse function of:</p>\n\n<pre><code>liftIO :: IO b -&gt; SpecM (TestApp _site) b\n</code></pre>\n\n<p>I've looked in the <code>Yesod.Test</code> <a href=\"https://hackage.haskell.org/package/yesod-test-1.5.6/docs/Yesod-Test.html\" rel=\"nofollow noreferrer\">docs</a> and <a href=\"https://hackage.haskell.org/package/yesod-test-1.5.6/docs/src/Yesod-Test.html#YesodExampleData\" rel=\"nofollow noreferrer\">source code</a> and tried to construct it myself too, but I don't seem to find it anywhere and it doesn't seem to be simple to construct either. Have I overlooked something, and might it exist somewhere? Or could it be simple to construct in a way I have not considered?</p>\n\n<h3>Background</h3>\n\n<p>I've run into the need for such a function multiple times, but so far I've always been able to workaround or do without. But in my latest situation it doesn't seem possible to work around: I want to write a Monadic QuickCheck property that would set up an arbitrary db environment (<code>runDB . insert</code>) and run some handlers on it to test for certain invariants of my application.</p>\n\n<p>This is the farthest I've gotten with my attempts:</p>\n\n<pre><code>propSpec = do\n  context \"qt\" $ do\n    it \"monadic\" $ property $ \\a b -&gt; monadicIO $ do\n      run $ withServer $ \\site -&gt; yesodSpec site $ runDB $ insert $ User{..}\n      assert $ a /= b\n\nwithServer cont = do\n  p &lt;- runLogging $ withSqlitePool \"database_test.db3\" 10 $ \\pool -&gt; do\n    runSqlPool (runMigration migrateAll) pool\n    return pool\n\n  wipeDB (MyApp p)\n\n  cont (MyApp p, id)\n</code></pre>\n\n<p>Which, somewhat understandably, results in the following type error:</p>\n\n<pre><code>/path/to/project/spec/Spec.hs:301:35: error:\n    \u2022 Couldn't match type \u2018hspec-core-2.2.4:Test.Hspec.Core.Spec.Monad.SpecM\n                             () ()\u2019\n                     with \u2018IO a0\u2019\n      Expected type: IO a0\n        Actual type: Spec\n    \u2022 In the expression:\n        yesodSpec site $ runDB $ insert $ User{..}\n      In the second argument of \u2018($)\u2019, namely\n        \u2018\\ site\n           -&gt; yesodSpec site $ runDB $ insert $ User{..}\u2019\n      In the second argument of \u2018($)\u2019, namely\n        \u2018withServer\n         $ \\ site\n             -&gt; yesodSpec site $ runDB $ insert $ User{..}\u2019\n\n/path/to/project/spec/Spec.hs:301:52: error:\n    \u2022 Couldn't match type \u2018ST.StateT\n                             (YesodExampleData MyApp) IO (Key User)\u2019\n                     with \u2018transformers-0.5.2.0:Control.Monad.Trans.Writer.Lazy.WriterT\n                             [YesodSpecTree (MyApp, a1 -&gt; a1)]\n                             Data.Functor.Identity.Identity\n                             ()\u2019\n      Expected type: YesodSpec (MyApp, a1 -&gt; a1)\n        Actual type: YesodExample MyApp (Key User)\n    \u2022 In the second argument of \u2018($)\u2019, namely\n        \u2018runDB $ insert $ User{..}\u2019\n      In the expression:\n        yesodSpec site $ runDB $ insert $ User{..}\n      In the second argument of \u2018($)\u2019, namely\n        \u2018\\ site\n           -&gt; yesodSpec site $ runDB $ insert $ User{..}\u2019\n    \u2022 Relevant bindings include\n        site :: (MyApp, a1 -&gt; a1)\n          (bound at /path/to/project/spec/Spec.hs:301:27)\n</code></pre>\n\n<p>Any ideas? </p>\n\n<p>Also, has anyone before used <code>Test.QuickCheck.Monadic</code> successfully in conjunction with <code>Yesod.Test</code>? Or if perhaps not successfully, at least attempted to do so?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1497429721, "post_id": 44538512, "comment_id": 76070017, "body": "If I read that correctly, you want to simply build your program? Then the command is <code>ghc</code>, not <code>ghci</code>, but I&#39;d recommend you use cabal instead."}, {"owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "edited": false, "score": 0, "creation_date": 1497527188, "post_id": 44538512, "comment_id": 76121897, "body": "I don&#39;t think using cabal is a good idea when you are just working through the examples in LYAH. I would definitely avoid that until you need to build a project with additional library dependencies."}], "answers": [{"tags": [], "owner": {"reputation": 1160, "user_id": 1395536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5feed9a5b3d1ace6ab77479fd5669139?s=128&d=identicon&r=PG&f=1", "display_name": "Ricky Han", "link": "https://stackoverflow.com/users/1395536/ricky-han"}, "is_accepted": false, "score": 1, "last_activity_date": 1497426301, "creation_date": 1497426301, "answer_id": 44538550, "question_id": 44538512, "link": "https://stackoverflow.com/questions/44538512/running-a-haskell-program-in-ghci/44538550#44538550", "title": "Running a haskell program in ghci", "body": "<p>Haskell can be compiled or interpreted. To use a python-like interpreter do <code>runhaskell</code> and you can use the same parameters as you would compile it.</p>\n\n<p>More information here:\n<a href=\"https://stackoverflow.com/questions/16432265/whats-the-difference-between-runghc-and-runhaskell\">What&#39;s the difference between runghc and runhaskell?</a></p>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 6859137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc70bd3bd50cedf06ab3d591c6dd8af1?s=128&d=identicon&r=PG&f=1", "display_name": "Lee Morgan", "link": "https://stackoverflow.com/users/6859137/lee-morgan"}, "edited": false, "score": 1, "creation_date": 1497510543, "post_id": 44539868, "comment_id": 76110856, "body": "Thanks a lot for the help.  You were exactly right and it fixed my problem.  I am reading from the physical book and it doesn&#39;t have in it that note about Linux.  Thanks for putting me straight.  And kudos to you for actually understanding what I needed help with, wasn&#39;t sure anybody could understand my babbling."}, {"owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "reply_to_user": {"reputation": 13, "user_id": 6859137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc70bd3bd50cedf06ab3d591c6dd8af1?s=128&d=identicon&r=PG&f=1", "display_name": "Lee Morgan", "link": "https://stackoverflow.com/users/6859137/lee-morgan"}, "edited": false, "score": 0, "creation_date": 1497527243, "post_id": 44539868, "comment_id": 76121933, "body": "Cool. Glad you got it working. Perhaps the author added that to the digital version after similar confusion elsewhere."}], "tags": [], "owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "is_accepted": true, "score": 1, "last_activity_date": 1497431993, "last_edit_date": 1497431993, "creation_date": 1497430113, "answer_id": 44539868, "question_id": 44538512, "link": "https://stackoverflow.com/questions/44538512/running-a-haskell-program-in-ghci/44539868#44539868", "title": "Running a haskell program in ghci", "body": "<p>It looks like you got confused between ghci and the command line. You can only type Haskell code in ghci. The command <code>./capslocker &lt; haiku.txt</code> is meant to be run from the command line and will run your compiled program <code>capslocker</code>. The <code>$</code> sign is the command prompt in Linux and you're not meant to type that in. The book suggests using</p>\n\n<pre><code>$ ghc --make capslocker \n</code></pre>\n\n<p>beforehand to compile the code. It doesn't actually use <code>ghci</code> in this section. If you're on Windows then some of the commands may not work, since it assumes you are using Linux (it explains this earlier in the \"input and output\" section and suggests cygwin as an alternative).</p>\n"}], "owner": {"reputation": 13, "user_id": 6859137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc70bd3bd50cedf06ab3d591c6dd8af1?s=128&d=identicon&r=PG&f=1", "display_name": "Lee Morgan", "link": "https://stackoverflow.com/users/6859137/lee-morgan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 973, "favorite_count": 0, "accepted_answer_id": 44539868, "answer_count": 2, "score": 0, "last_activity_date": 1497503313, "creation_date": 1497426187, "last_edit_date": 1497503313, "question_id": 44538512, "link": "https://stackoverflow.com/questions/44538512/running-a-haskell-program-in-ghci", "title": "Running a haskell program in ghci", "body": "<p>I am new to Haskell and trying to learn it from \"Learn you a Haskell.\"  I have run into a problem that I cannot find an answer to anywhere.  I have a simple program that I want to run, but nothing will I do will make it run.  What the book is telling me to do doesn't work.  I can compile the program and run individual functions, but I can't get main to run unless I call that particular function.  That seemed fine to me until I tried to pass a text file into it and it doesn't work.  </p>\n\n<p>So what do I do to run the program after typing :load program.hs?</p>\n\n<p>I have tried...\n$ ./program\n--make program\n--make program.exe\nand about a thousand variations of these things.  What the hell do I do to get my program running so that I can pass it a text file?\n<a href=\"https://i.stack.imgur.com/p693W.png\" rel=\"nofollow noreferrer\">Picture of results in GHCi</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/F5792.jpg\" rel=\"nofollow noreferrer\">cmd \"Assembler failure\"</a></p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 1160, "user_id": 1395536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5feed9a5b3d1ace6ab77479fd5669139?s=128&d=identicon&r=PG&f=1", "display_name": "Ricky Han", "link": "https://stackoverflow.com/users/1395536/ricky-han"}, "edited": false, "score": 1, "creation_date": 1497424470, "post_id": 44537838, "comment_id": 76066527, "body": "Haskell doesn&#39;t have the concept of tail recursion. It uses lazy evaluation or thunks."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 1160, "user_id": 1395536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5feed9a5b3d1ace6ab77479fd5669139?s=128&d=identicon&r=PG&f=1", "display_name": "Ricky Han", "link": "https://stackoverflow.com/users/1395536/ricky-han"}, "edited": false, "score": 0, "creation_date": 1497424670, "post_id": 44537838, "comment_id": 76066664, "body": "Aha ok, what does it mean? What is a thunks?"}, {"owner": {"reputation": 1160, "user_id": 1395536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5feed9a5b3d1ace6ab77479fd5669139?s=128&d=identicon&r=PG&f=1", "display_name": "Ricky Han", "link": "https://stackoverflow.com/users/1395536/ricky-han"}, "edited": false, "score": 1, "creation_date": 1497424716, "post_id": 44537838, "comment_id": 76066711, "body": "This link has information on how Haskell optimize recursions. <a href=\"https://stackoverflow.com/questions/13042353/does-haskell-have-tail-recursive-optimization\" title=\"does haskell have tail recursive optimization\">stackoverflow.com/questions/13042353/&hellip;</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1160, "user_id": 1395536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5feed9a5b3d1ace6ab77479fd5669139?s=128&d=identicon&r=PG&f=1", "display_name": "Ricky Han", "link": "https://stackoverflow.com/users/1395536/ricky-han"}, "edited": false, "score": 8, "creation_date": 1497427825, "post_id": 44537838, "comment_id": 76068796, "body": "@RickyHan I slightly disagree. Tail recursion (or tail call, in general) does exist in Haskell, except it&#39;s not a good idea as in strict functional languages. Indeed, if one is not careful with strictness, one might easily let its tail recursive function to accumulate huge thunks before starting to do the real job. Because of this, I&#39;d say that <code>foldl</code> is always a bad idea, and <code>foldl&#39;</code> is the &quot;real&quot; left fold, which gives control to the caller so that strictness can be controlled."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1497453428, "post_id": 44537838, "comment_id": 76088005, "body": "Tail recursion just means a function returns the value returned by a recursive call immediately without doing any further work. Tail call <i>optimization</i> (TCO) is the language implementation feature that reuses a stack frame for the recursive call because it is known not to be needed any more by the caller."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 2, "last_activity_date": 1497546256, "last_edit_date": 1497546256, "creation_date": 1497431599, "answer_id": 44540412, "question_id": 44537838, "link": "https://stackoverflow.com/questions/44537838/is-fold-left-tail-recursion/44540412#44540412", "title": "Is fold left tail recursion?", "body": "<p><code>foldl</code> expresses tail recursion when <code>f</code> is strict. you are correct, it is <em>much</em> preferable to have </p>\n\n<pre><code>foldl (*) 1 [1,2,3] = \nfoldl (*) 1 [2,3]   = \nfoldl (*) 2 [3]     = \nfoldl (*) 6 []      = \n6 \n</code></pre>\n\n<p>If <code>f</code> is not strict, i.e. leaves its argument expressions as they are, to be calculated later, you end up with the nested expressions like <code>(((1*1)*2)*3)</code>, which can even cause stack overflow, needlessly, when they are finally being evaluated, because to evaluate such nested expressions a stack has to be used:</p>\n\n<pre><code>(((1*1)*2)*3) \n=&gt; x * 3 where x = ((1*1)*2)\n            =&gt; x = y*2 where y = 1*1\n                             y &lt;= 1\n            =&gt; x = 1*2\n            &lt;= x = 2\n=&gt; 2 * 3\n&lt;= 6\n</code></pre>\n\n<p>and in any case it is a waste of much efforts when the intermediate results could already be evaluated in full. </p>\n\n<p>see also: <a href=\"https://stackoverflow.com/questions/13042353/does-haskell-have-tail-recursive-optimization/13052612#13052612\">Does Haskell have tail-recursive optimization?</a></p>\n\n<p><em>edit:</em> <code>foldl'</code> must always be used for that, <a href=\"https://stackoverflow.com/questions/44537838/is-fold-left-tail-recursion/44540412#comment76068796_44537838\">as noted</a> by <a href=\"https://stackoverflow.com/users/3234959/chi\">user:chi</a> in the comments.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 638, "favorite_count": 0, "accepted_answer_id": 44540412, "answer_count": 1, "score": 2, "last_activity_date": 1497546256, "creation_date": 1497424130, "question_id": 44537838, "link": "https://stackoverflow.com/questions/44537838/is-fold-left-tail-recursion", "title": "Is fold left tail recursion?", "body": "<p>I wanted to ask, if the function <code>foldl</code> is a tail recursion?   </p>\n\n<p>When I look at the source, how <code>foldl</code>is implemented:</p>\n\n<pre><code>foldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldl f acc [] = acc\nfoldl f acc (x:xs) = foldl f (f acc x) xs\n</code></pre>\n\n<p>it looks like a tail recursion.   </p>\n\n<p>Fold left is always left associated. Assumed I have following expression:</p>\n\n<pre><code>foldl (*) 1 [1..3]\n</code></pre>\n\n<p>then it will evaluate to:</p>\n\n<pre><code>((1 * 1) * 2) * 3\n</code></pre>\n\n<p>then write out the steps, I would do like:</p>\n\n<pre><code>foldl (*) 1 [1..3] =\nfoldl (*) (1 * 1) [2,3]\nfoldl (*) (1 * 2) [3]\nfoldl (*) (2 * 3) []\n6\n</code></pre>\n\n<p>not like <code>((1 * 1) * 2) * 3</code>, or am I wrong?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 92, "user_id": 8128470, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-t_Bca0CMEF8/AAAAAAAAAAI/AAAAAAAAACo/p_woNOR7h8o/photo.jpg?sz=128", "display_name": "Axel Jacobsen", "link": "https://stackoverflow.com/users/8128470/axel-jacobsen"}, "edited": false, "score": 0, "creation_date": 1497564225, "post_id": 44535872, "comment_id": 76144244, "body": "Marked as Duplicate! The problem was that I was not adding a zero infront of the &#39;.01&#39;, which must occur in Haskell. This is because in haskell, <code>.</code> is the concatenation function - i.e. (f . g) h = f (g ( h))"}], "owner": {"reputation": 92, "user_id": 8128470, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-t_Bca0CMEF8/AAAAAAAAAAI/AAAAAAAAACo/p_woNOR7h8o/photo.jpg?sz=128", "display_name": "Axel Jacobsen", "link": "https://stackoverflow.com/users/8128470/axel-jacobsen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "closed_date": 1497419332, "answer_count": 0, "score": 2, "last_activity_date": 1497416878, "creation_date": 1497416878, "question_id": 44535872, "link": "https://stackoverflow.com/questions/44535872/haskell-function-with-infinite-list-as-argument", "closed_reason": "Duplicate", "title": "Haskell function with infinite list as argument", "body": "<p>After poking around the other posts involving infinite lists and my error messages, I still can't solve my issues. </p>\n\n<p>I am just learning Haskell, and I thought that implementing the Newton-Raphson Square Root method would be an interesting first problem. Here is my code: </p>\n\n<pre><code>next_ ::  (Floating a) =&gt; a -&gt; a -&gt; a\nnext_ n x = (x + n/x)/2\n\nrepeat_ :: (Floating a) =&gt; ( a -&gt; a ) -&gt; a -&gt; [a]\nrepeat_ f a = a : (repeat_ f (f a))\n\nwithin :: (Ord a, Floating a) =&gt; a -&gt; [a] -&gt; a\nwithin eps (x:xs)\n  | (abs (x / b - 1.0)) &lt; eps = b\n  | otherwise = within eps (b:bs)\n  where b = head xs\n        bs = tail xs\n</code></pre>\n\n<p>The code is compiled by GHCi just fine. <code>eps</code> is the max distance between 2 successive square root approximations before the final answer is returned.</p>\n\n<p>I split the three parts into three functions, with the intention of writing a <code>sqrt</code> function which calls <code>within</code> with <code>repeat_</code> and <code>next_</code>. I have tested <code>repeat_</code> and <code>next_</code>, and both of them work as expected. However, when I run <code>within .01 (repeat_ (next_ 2.0) 2.5)</code>, I get this error message:</p>\n\n<pre><code>&lt;interactive&gt;:44:1: error:\n\u2022 Non type-variable argument\n    in the constraint: Num ([a] -&gt; a2 -&gt; a1)\n  (Use FlexibleContexts to permit this)\n\u2022 When checking the inferred type\n    it :: forall a a1 a2.\n          (Num ([a] -&gt; a2 -&gt; a1), Floating a, Floating a1, Ord a1) =&gt;\n          a2 -&gt; [a1] -&gt; a1\n</code></pre>\n\n<p>Reading through the error message and googling it, I am still lost. I have read through the similar questions here and couldn't fix the problem. The issue, I think, is the infinite list as an argument. I know that Haskell is Lazy, so it will only evaluate as many numbers as it needs until the return condition is met. I think that the above implementation is correct (i.e. <code>(x:xs)</code> for the inf. list), but I am not sure. The typeclasses are also an area of concern. After searching and reading, I am still shaky on the typeclass for <code>within</code>. Since the infinite list is being evaluated in the function, does within need a type declaration like <code>repeat_</code> where it is stated that <code>repeat_</code> takes in a function?</p>\n\n<p>Any help is much appreciated! Thanks!</p>\n"}, {"tags": ["haskell", "memory-leaks", "haskell-lens"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1497416535, "post_id": 44532493, "comment_id": 76062649, "body": "As I noted on the ticket, the problem is definitely not in <code>Bound</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1497416651, "post_id": 44532493, "comment_id": 76062682, "body": "The problem is definitely in <code>lens</code>. I&#39;ll comment further on the ticket."}], "answers": [{"comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1497562271, "post_id": 44571602, "comment_id": 76143388, "body": "To tag onto this with more information revealed in the ticket: sending ^C &quot;fixes&quot; this infinite loop because <code>uniplate</code> works by evaluating bottom, which throws an exception, which is then caught. (Crazy, but neat.) However <code>lens</code> is catching too broadly, and while the interrupt signal shouldn&#39;t count as one of those exceptions caught it unfortunately does."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 1, "last_activity_date": 1497540968, "creation_date": 1497540968, "answer_id": 44571602, "question_id": 44532493, "link": "https://stackoverflow.com/questions/44532493/space-leak-bug-in-interaction-of-control-lens-plated-and-bound/44571602#44571602", "title": "Space leak / Bug in interaction of Control.Lens.Plated and Bound", "body": "<p>I'm just gonna answer this with: it's a bug, dfeuer <a href=\"https://github.com/ekmett/lens/issues/742\" rel=\"nofollow noreferrer\">reported it</a> to <a href=\"https://github.com/ekmett/lens\" rel=\"nofollow noreferrer\"><code>ekmett/lens</code></a>.</p>\n\n<p>In the meantime using <code>tinplate</code> instead of <code>uniplate</code> is a feasible workaround.</p>\n"}], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 44571602, "answer_count": 1, "score": 4, "last_activity_date": 1497540968, "creation_date": 1497392308, "last_edit_date": 1497402302, "question_id": 44532493, "link": "https://stackoverflow.com/questions/44532493/space-leak-bug-in-interaction-of-control-lens-plated-and-bound", "title": "Space leak / Bug in interaction of Control.Lens.Plated and Bound", "body": "<p>Using the latest version of <code>Bound</code> and <code>Control.Lens.Plated</code>, the following <code>transform</code> call causes the programm to loop infinitely and happily munches away at my RAM. Terminating the program funnily causes the correct result to be printed, although I don't know why.</p>\n\n<p>I have traced the problem to the <code>Scope</code> data type. Removing it causes the program to behave as expected.</p>\n\n<p>Profiling with <code>./program +RTS -p -h</code> shows <code>Data.Data.Lens.insertHitMap.populate</code> to be the problematic part. Some of the profiling is attached.</p>\n\n<p>Is this expected behaviour with an official workaround or is this maybe a bug?</p>\n\n<p>I am using GHC version 8.0.2, all packages with exception of <code>bound-2</code> are part of stack <code>lts-8.17</code>. The program is compiled as <code>ghc test.hs</code>. Enabling or disabling optimizations doesn't affect the problem.</p>\n\n<p>As I suspect that this is a bug, I opened an <a href=\"https://github.com/ekmett/bound/issues/64\" rel=\"nofollow noreferrer\">issue</a> for this on <code>ekmett</code>'s <code>bound</code> repository (for crossreferencing purposes).</p>\n\n<hr>\n\n<pre><code>-- file: test.hs\n{-# LANGUAGE DeriveFunctor, DeriveFoldable, DeriveTraversable, \n             DeriveDataTypeable #-}\n{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE TemplateHaskell    #-}\n\nmodule Main (main) where\nimport           Bound\nimport           Control.Lens hiding (List)\nimport           Control.Lens.Plated\nimport           Data.Deriving (deriveShow1, deriveEq1)\nimport           Data.Data\nimport           Data.Data.Lens (uniplate)\n\ndata Expr a   = Var   a\n              | List  [Expr a]\n              | Apply (Expr a) (Expr a)\n              | Lam   (Scope () Expr a)\n              | Nop\n              deriving (Functor, Foldable, Traversable, Data)\n\nmain = do\n         print ex\n         print $ transform removeTest ex\n\nex :: Expr String\nex = List [Apply (Var \"test\") $ List [Var \"arg1\", Var \"arg2\"]\n          ,Apply (Var \"two\") (Var \"three\")]\n\nremoveTest :: Expr String -&gt; Expr String\nremoveTest = \\expr -&gt; case expr of\n                        Apply (Var \"test\") _ -&gt; Nop\n                        _ -&gt; expr\n\ninstance Data a =&gt; Plated (Expr a) where\n  plate = uniplate\n\nmakeLenses  ''Expr\nmakeBound   ''Expr\nderiveEq1   ''Expr\nderiveShow1 ''Expr\nderiving instance Show a =&gt; Show (Expr a)\nderiving instance Eq   a =&gt; Eq   (Expr a)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>List [Apply (Var \"test\") (List [Var \"arg1\",Var \"arg2\"])\n     ,Apply (Var \"two\") (Var \"three\")]\n^CList [Nop,Apply (Var \"two\") (Var \"three\")]\n</code></pre>\n\n<hr>\n\n<pre><code> -- profiterole stats\n TOT   INH   IND\n99.9  99.9    .1  MAIN MAIN (0)\n\n\n99.9  99.9    .1  MAIN MAIN (0)\n99.9  99.9  34.0    Main CAF (0)\n65.9  65.9     -      Data.Data.Lens fromOracle (35)\n65.9  65.9     -        Data.Data.Lens hitTest (0)\n65.9  65.9     -          Data.Data.Lens hitTest.\\ (35)\n65.9  65.9     -            Data.Data.Lens readCacheFollower (30)\n65.9  65.9     -              Data.Data.Lens readCacheFollower.\\ (30)\n65.9  65.9     -                Data.Data.Lens insertHitMap (1)\n65.9  65.9     -                  Data.Data.Lens insertHitMap.populate (1)\n65.9  65.9  56.4                    Data.Data.Lens insertHitMap.populate.f (1824891)\n 2.3   2.3   2.3                      Data.HashMap.Base clone16 (2682671)\n 2.1   2.1   2.1                      Data.HashMap.Base hash (6204631)\n 1.7   1.7    .4                      Data.HashMap.Array copy (1620382)\n 1.3   1.3   1.3                        Data.HashMap.Array copy.\\ (1620382)\n 1.1   1.1   1.1                      Data.Data.Lens insertHitMap.populate.fs (2189870)\n  .9    .9    .9                      Bound.Var gfoldl (364976)\n  .5    .5    .5                      Data.HashMap.Array new_ (810191)\n  .5    .5    .5                      Bound.Var gunfold (364976)\n  .3    .3    .3                      Data.HashMap.Base sparseIndex (3620621)\n  .2    .2    .2                      Bound.Scope gfoldl (182489)\n</code></pre>\n\n<hr>\n\n<p>Heap profile:</p>\n\n<p><a href=\"https://i.stack.imgur.com/RaI2L.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/RaI2L.png\" alt=\"heap profile\"></a></p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 21445, "user_id": 812818, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/bffad8ee5a559e7b747a839a1ed35416?s=128&d=identicon&r=PG", "display_name": "Daniel Lyons", "link": "https://stackoverflow.com/users/812818/daniel-lyons"}, "edited": false, "score": 1, "creation_date": 1497388707, "post_id": 44531586, "comment_id": 76055084, "body": "I think RWH was written before ghci supported import statements."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 11, "last_activity_date": 1497388457, "creation_date": 1497388457, "answer_id": 44531690, "question_id": 44531586, "link": "https://stackoverflow.com/questions/44531586/in-ghci-what-is-the-difference-between-module-and-import/44531690#44531690", "title": "In GHCi, what is the difference between &#39;:module&#39; and &#39;import&#39;?", "body": "<p>From the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#controlling-what-is-in-scope-with-the-module-command\" rel=\"noreferrer\">GHCi docs</a>:</p>\n\n<blockquote>\n  <p>The <code>:module</code> command provides a way to do two things that cannot be\n  done with ordinary <code>import</code> declarations:</p>\n  \n  <ul>\n  <li><code>:module</code> supports the <code>*</code> modifier on modules, which opens the full top-level scope of a module, rather than just its exports.</li>\n  <li>Imports can be removed from the context, using the syntax <code>:module -M</code>. The <code>import</code> syntax is cumulative (as in a Haskell module), so this is the only way to subtract from the scope.</li>\n  </ul>\n</blockquote>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 483, "favorite_count": 0, "closed_date": 1497443604, "accepted_answer_id": 44531690, "answer_count": 1, "score": 11, "last_activity_date": 1497388457, "creation_date": 1497388028, "question_id": 44531586, "link": "https://stackoverflow.com/questions/44531586/in-ghci-what-is-the-difference-between-module-and-import", "closed_reason": "Duplicate", "title": "In GHCi, what is the difference between &#39;:module&#39; and &#39;import&#39;?", "body": "<p>In GHCi, there appear to be two ways to include installed modules:</p>\n\n<pre><code>Prelude&gt; :module Database.HDBC\nPrelude Database.HDBC&gt;\n</code></pre>\n\n<p>and</p>\n\n<pre><code>Prelude&gt; import Database.HDBC\nPrelude Database.HDBC&gt;\n</code></pre>\n\n<p>Is there any difference between these? If not, why the duplicate commands?</p>\n\n<p>I've always used <code>import</code>, and now am noticing <code>:module</code> used in <a href=\"http://book.realworldhaskell.org/read/using-databases.html\" rel=\"noreferrer\">Real World Haskell's databases chapter</a>.</p>\n"}, {"tags": ["list", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497379558, "post_id": 44529191, "comment_id": 76050284, "body": "It&#39;s unclear to me what you aim to do. What are <code>cur</code>, <code>done</code> and <code>total</code> doing here?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1497379761, "post_id": 44529191, "comment_id": 76050398, "body": "@WillemVanOnsem I suspect most of the code as written is a red herring. Just looking at this snippet from the last line, <code>((last xs) ++ [[xs2!!total]])</code>, and matching that up with the question as asked, it seems clear to me what RicUfa is confused about. It seems kind of tricky to explain the mistake clearly (and explain how to fix it clearly), though..."}, {"owner": {"reputation": 21, "user_id": 7891281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5cc8d002013e418e0b62ba63f210168?s=128&d=identicon&r=PG&f=1", "display_name": "RicUfa", "link": "https://stackoverflow.com/users/7891281/ricufa"}, "edited": false, "score": 0, "creation_date": 1497379944, "post_id": 44529191, "comment_id": 76050501, "body": "This is additional parameters from a problem. I need to I need to add <code>xs2 !! total</code> to <code>last xs</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497380050, "post_id": 44529191, "comment_id": 76050560, "body": "@RicUfa: can you show some sample input/output to demonstrate what you aim to do?"}, {"owner": {"reputation": 21, "user_id": 7891281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5cc8d002013e418e0b62ba63f210168?s=128&d=identicon&r=PG&f=1", "display_name": "RicUfa", "link": "https://stackoverflow.com/users/7891281/ricufa"}, "edited": false, "score": 0, "creation_date": 1497380102, "post_id": 44529191, "comment_id": 76050594, "body": "My friend want me to help with home work. This is my first haskell program, so I am sorry if I&#39;m asking something stupid)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497380418, "post_id": 44529191, "comment_id": 76050766, "body": "@RicUfa: it is not stupid. But it would be nice if you demonstrate clearly what you want to do. What should be the output given the two lists are <code>[[1,2,3],[4,5,6]]</code> and <code>[7,8]</code>?"}, {"owner": {"reputation": 21, "user_id": 7891281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5cc8d002013e418e0b62ba63f210168?s=128&d=identicon&r=PG&f=1", "display_name": "RicUfa", "link": "https://stackoverflow.com/users/7891281/ricufa"}, "edited": false, "score": 0, "creation_date": 1497380662, "post_id": 44529191, "comment_id": 76050886, "body": "I have added an example to the question"}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1497380610, "creation_date": 1497380610, "answer_id": 44529613, "question_id": 44529191, "link": "https://stackoverflow.com/questions/44529191/haskell-trouble-with-list-of-lists/44529613#44529613", "title": "Haskell. Trouble with list of lists", "body": "<p>The easy way to deal with problems like this is to separate the problem into sub-problems. In this case, you want to change the last item in a list. The way you want to change it is by adding an item to it.</p>\n\n<p>First let's tackle changing the last item of a list. We'll do this by applying a function to the last item, but not to any other items.</p>\n\n<pre><code>onLast :: [a] -&gt; (a -&gt; a) -&gt; [a]\nonLast xs f = go xs\n  where\n    go [] = []\n    go [x] = [f x]\n    go (x:xs) = x:go xs\n</code></pre>\n\n<p>You want to change the last item in the list by adding an additional value, which you can do with <code>(++ [value])</code>.</p>\n\n<p>Combining the two with the value you want to add (<code>xs2!!total</code>) we get</p>\n\n<pre><code>(onLast xs (++ [xs2!!total]))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 0, "last_activity_date": 1497381454, "last_edit_date": 1497381454, "creation_date": 1497381117, "answer_id": 44529746, "question_id": 44529191, "link": "https://stackoverflow.com/questions/44529191/haskell-trouble-with-list-of-lists/44529746#44529746", "title": "Haskell. Trouble with list of lists", "body": "<p>You approach uses a <code>do</code> block, this is kind of weird since <code>do</code> blocks are usually used for <em>monads</em>. Furthermore it is rather unclear what <code>cur</code>, <code>done</code> and <code>total</code> are doing. Furthermore you use <code>(!!) :: [a] -&gt; Int -&gt; a</code> and <code>length :: [a] -&gt; Int</code>. The problem with these functions is that these run in <em>O(n)</em>, so it makes the code inefficient as well.</p>\n\n<p>Based on changed specifications, you want to <em>split</em> the list in buckets with length the <em>Fibonacci numbers</em>. In that case the signature should be:</p>\n\n<pre><code>f :: [a] -&gt; [[a]]\n</code></pre>\n\n<p>because as input you give a list of numbers, and as output, you return a list of numbers. We can then implement that as:</p>\n\n<pre><code>f :: [a] -&gt; [[a]]\nf = g 0 1\n    where g _ _ [] = []\n          g a b xs = xa : g b (a+b) xb\n              where (xa,xb) = splitAt b xs\n</code></pre>\n\n<p>This generates:</p>\n\n<pre><code>*Main&gt; f [1,2,3,4,5,6]\n[[1],[2],[3,4],[5,6]]\n*Main&gt; f [1,2,3,4,5,6,7]\n[[1],[2],[3,4],[5,6,7]]\n*Main&gt; f [1,2,3,4,5,6,7,8]\n[[1],[2],[3,4],[5,6,7],[8]]\n*Main&gt; f [1,2,3,4,5,6,7,8,9]\n[[1],[2],[3,4],[5,6,7],[8,9]]\n</code></pre>\n\n<p>The code works as follows: we state that <code>f = g 0 1</code> so we pass the arguments of <code>f</code> to <code>g</code>, but <code>g</code> also gets an <code>0</code> and a <code>1</code> (the first Fibonacci numbers).</p>\n\n<p>Each iteration <code>g</code> checks whether we reached the end of the list. If so, we return an empty list as well. Otherwise we determine the last Fibonacci number that far (<code>b</code>), and use a <code>splitAt</code> to obtain the first <code>b</code> elements of the list we process, as well as the remainder. We then emit the first part as head of the list, and for the tail we calculate the next Fibonacci number and pass that to <code>g</code> with the tail of <code>splitAt</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "is_accepted": false, "score": 0, "last_activity_date": 1497381340, "creation_date": 1497381340, "answer_id": 44529798, "question_id": 44529191, "link": "https://stackoverflow.com/questions/44529191/haskell-trouble-with-list-of-lists/44529798#44529798", "title": "Haskell. Trouble with list of lists", "body": "<pre><code>f :: [[Int]] -&gt; Int -&gt; [[Int]]                                                                                                                                                                                                   \nf [] _ = []                                                                                                                                                                                                                      \nf xs i = (take n xs) ++ [[x + i | x &lt;- last xs]]                                                                                                                                                                                 \n    where n = (length xs) - 1                                                                                                                                                                                                    \n          last = head . (drop n) \n</code></pre>\n\n<p>For example,</p>\n\n<pre><code>*Main&gt; f [[1, 2, 3], [], [4, 5, 6]] 5\n[[1,2,3],[],[9,10,11]]\n*Main&gt; f [[1, 2, 3]] 5\n[[6,7,8]]\n*Main&gt; f [] 3\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 7891281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5cc8d002013e418e0b62ba63f210168?s=128&d=identicon&r=PG&f=1", "display_name": "RicUfa", "link": "https://stackoverflow.com/users/7891281/ricufa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 44529613, "answer_count": 3, "score": -1, "last_activity_date": 1497381454, "creation_date": 1497379324, "last_edit_date": 1497381317, "question_id": 44529191, "link": "https://stackoverflow.com/questions/44529191/haskell-trouble-with-list-of-lists", "title": "Haskell. Trouble with list of lists", "body": "<p>I have list of lists of <code>Int</code> and I need to add an <code>Int</code> value to the last list from the list of lists. How can I do this? My attempt is below </p>\n\n<pre><code>f :: [[Int]] -&gt; [Int] -&gt; Int -&gt; Int -&gt; Int -&gt; [[Int]]\nf xs [] cur done total = [[]]\nf xs xs2 cur done total = do \n  if total &gt;= length xs2 then \n    xs\n  else \n    if done == fib cur then\n      f (xs ++ [[]]) xs2 (cur + 1) 0 total\n    else\n      f ((last xs) ++ [[xs2!!total]]) xs2 cur (done + 1) (total + 1)\n</code></pre>\n\n<p>The problem is:\nWe have a list <code>A</code> of Int \n<br>\nAnd we need to slpit it on <code>N</code> lists <code>B_1 ,..., B_n</code> , length of <code>B_i</code> is i-th Fibonacci  number.\n<br>\nIf we have list <code>[1 , 2 , 3 , 4 , 5 , 6 , 7]</code> (<code>xs2</code> in my code)<br>\nThe result should be <code>[[1] , [2] , [3 , 4] , [5 , 6 , 7]]</code></p>\n"}, {"tags": ["linux", "haskell", "xmonad"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1497379380, "post_id": 44526555, "comment_id": 76050184, "body": "I think some parts of the strut support have moved into the EWMH module. Can you try importing <code>XMonad.Hooks.EwmhDesktops</code> and changing the xmonad invocation to <code>xmonad . ewmh $ def ...</code>? If that works, I&#39;m happy to throw it in an answer. If not, my next test would be to check that xmobar is asking for the right amount of space by running <code>xprop | grep _NET_WM_STRUT</code> and clicking on xmobar."}, {"owner": {"reputation": 355, "user_id": 4911008, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JLdxew6DQ8o/AAAAAAAAAAI/AAAAAAAAANg/cbtQcMgBQyw/photo.jpg?sz=128", "display_name": "sivakov512", "link": "https://stackoverflow.com/users/4911008/sivakov512"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1497419189, "post_id": 44526555, "comment_id": 76063673, "body": "It must looks like this? <a href=\"https://gist.github.com/cryptomaniac512/3718cb18498f723c545794b7b4e74b1c\" rel=\"nofollow noreferrer\">gist.github.com/cryptomaniac512/&hellip;</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1497419717, "post_id": 44526555, "comment_id": 76063923, "body": "That looks right to me. Does it work?"}, {"owner": {"reputation": 355, "user_id": 4911008, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JLdxew6DQ8o/AAAAAAAAAAI/AAAAAAAAANg/cbtQcMgBQyw/photo.jpg?sz=128", "display_name": "sivakov512", "link": "https://stackoverflow.com/users/4911008/sivakov512"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1497419851, "post_id": 44526555, "comment_id": 76064000, "body": "No( Xmobar works, but hidden by other windows."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1497423007, "post_id": 44526555, "comment_id": 76065649, "body": "Then... did you run my proposed next test? What did it say?"}, {"owner": {"reputation": 355, "user_id": 4911008, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JLdxew6DQ8o/AAAAAAAAAAI/AAAAAAAAANg/cbtQcMgBQyw/photo.jpg?sz=128", "display_name": "sivakov512", "link": "https://stackoverflow.com/users/4911008/sivakov512"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1497423026, "post_id": 44526555, "comment_id": 76065660, "body": "When I run <code>xprop | grep _NET_WM_STRUT</code> I get this output: <code>_NET_WM_STRUT(CARDINAL) = 0, 0, 21, 0</code> <code>_NET_WM_STRUT_PARTIAL(CARDINAL) = 0, 0, 21, 0, 0, 0, 0, 0, 0, 1919, 0, 0</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1497423494, "post_id": 44526555, "comment_id": 76065931, "body": "Those struts look right to me. Does this happen on all workspaces? Does it persist if you reload the layout? (By default, mod+shift+space will reload the layout.)"}, {"owner": {"reputation": 355, "user_id": 4911008, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JLdxew6DQ8o/AAAAAAAAAAI/AAAAAAAAANg/cbtQcMgBQyw/photo.jpg?sz=128", "display_name": "sivakov512", "link": "https://stackoverflow.com/users/4911008/sivakov512"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1497423616, "post_id": 44526555, "comment_id": 76066001, "body": "Yes. No changes."}], "answers": [{"tags": [], "owner": {"reputation": 355, "user_id": 4911008, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JLdxew6DQ8o/AAAAAAAAAAI/AAAAAAAAANg/cbtQcMgBQyw/photo.jpg?sz=128", "display_name": "sivakov512", "link": "https://stackoverflow.com/users/4911008/sivakov512"}, "is_accepted": true, "score": 9, "last_activity_date": 1497424770, "creation_date": 1497424770, "answer_id": 44538041, "question_id": 44526555, "link": "https://stackoverflow.com/questions/44526555/xmobar-not-visible-when-using-with-xmonad/44538041#44538041", "title": "Xmobar not visible when using with Xmonad", "body": "<p>Solution founded at <a href=\"https://unix.stackexchange.com/questions/288037/\">https://unix.stackexchange.com/questions/288037/</a></p>\n\n<p>I add this <code>handleEventHook = handleEventHook defaultConfig &lt;+&gt; docksEventHook</code> and now Xmobar always visible.</p>\n"}, {"tags": [], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "is_accepted": false, "score": 0, "last_activity_date": 1578423213, "creation_date": 1578423213, "answer_id": 59634451, "question_id": 44526555, "link": "https://stackoverflow.com/questions/44526555/xmobar-not-visible-when-using-with-xmonad/59634451#59634451", "title": "Xmobar not visible when using with Xmonad", "body": "<p>Although many of the other solutions posted are also important, I had to add <code>lowerOnStart = False</code> to .xmobarrc, so it isn't sent to the bottom of the window stack on start.</p>\n"}], "owner": {"reputation": 355, "user_id": 4911008, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JLdxew6DQ8o/AAAAAAAAAAI/AAAAAAAAANg/cbtQcMgBQyw/photo.jpg?sz=128", "display_name": "sivakov512", "link": "https://stackoverflow.com/users/4911008/sivakov512"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2883, "favorite_count": 0, "accepted_answer_id": 44538041, "answer_count": 2, "score": 5, "last_activity_date": 1578423213, "creation_date": 1497369939, "question_id": 44526555, "link": "https://stackoverflow.com/questions/44526555/xmobar-not-visible-when-using-with-xmonad", "title": "Xmobar not visible when using with Xmonad", "body": "<p>Today I've started with Xmonad and can not get Xmobar to be visible on top of layouts\nAt my <code>.xmobarrc</code> I has these code:</p>\n\n<pre><code>...\n   , position =     TopW L 100\n   , lowerOnStart =     True\n   , hideOnStart =      False\n   , allDesktops =      True\n   , overrideRedirect = True\n   , pickBroadest =     False\n   , persistent =       True\n\n...\n</code></pre>\n\n<p>And this is my <code>xmonad.hs</code>:</p>\n\n<pre><code>import XMonad\nimport XMonad.Hooks.DynamicLog\nimport XMonad.Hooks.ManageDocks\nimport XMonad.Util.Run(spawnPipe)\nimport System.IO\n\nmain = do\n  xmproc &lt;- spawnPipe \"xmobar\"\n  xmonad $ defaultConfig\n    { manageHook = manageDocks &lt;+&gt; manageHook defaultConfig\n    , layoutHook = avoidStruts  $  layoutHook defaultConfig\n    , logHook = dynamicLogWithPP xmobarPP\n                    { ppOutput = hPutStrLn xmproc\n                    , ppTitle = xmobarColor \"green\" \"\" . shorten 50\n                    }\n    , terminal = \"urxvt\"\n    , modMask = mod4Mask\n    }\n</code></pre>\n\n<p>Xmobar is running with Xmonad but it's not visible. How can I solve it?\nI need that Xmobar always be visible at the top of monitor.</p>\n"}, {"tags": ["haskell", "yesod", "yesod-forms"], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 3403974, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f396d1a92446f49f4603c7feb8e9767c?s=128&d=identicon&r=PG&f=1", "display_name": "GeleiaDeMocoto", "link": "https://stackoverflow.com/users/3403974/geleiademocoto"}, "edited": false, "score": 0, "creation_date": 1497360830, "post_id": 44522937, "comment_id": 76038021, "body": "I&#39;m using postgresql, I&#39;ll look for a similar function if it has one."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 141, "user_id": 3403974, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f396d1a92446f49f4603c7feb8e9767c?s=128&d=identicon&r=PG&f=1", "display_name": "GeleiaDeMocoto", "link": "https://stackoverflow.com/users/3403974/geleiademocoto"}, "edited": false, "score": 0, "creation_date": 1497361879, "post_id": 44522937, "comment_id": 76038909, "body": "If you&#39;re using postgresql you&#39;re using a SQL backend. This is defined in <code>Persistent.SQL</code>, which you&#39;re using if you&#39;re using postgresql with <code>persistent</code>."}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 3, "last_activity_date": 1497360424, "creation_date": 1497360424, "answer_id": 44522937, "question_id": 44521942, "link": "https://stackoverflow.com/questions/44521942/yesod-passing-the-current-user-to-a-form/44522937#44522937", "title": "Yesod: Passing the current user to a form", "body": "<p>Assuming you're using a SQL backend, check out the <a href=\"https://hackage.haskell.org/package/persistent-2.7.0/docs/Database-Persist-Sql.html\" rel=\"nofollow noreferrer\"><code>persistent</code> SQL documentation</a>. You'll find the <code>toSqlKey :: ToBackendKey SqlBackend record =&gt; Int64 -&gt; Key record</code> function. Basically, you'll need to parse your <code>Text</code> to <code>Int64</code> and get a key using <code>toSqlKey</code>. You should <em>probably</em> also check if the key you're getting is actually valid.</p>\n\n<p>(You've apparently misread the error, your <code>uid</code> is just a <code>Text</code> value, but you need a <code>UserID</code> which is a <code>Key User</code>).</p>\n"}], "owner": {"reputation": 141, "user_id": 3403974, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f396d1a92446f49f4603c7feb8e9767c?s=128&d=identicon&r=PG&f=1", "display_name": "GeleiaDeMocoto", "link": "https://stackoverflow.com/users/3403974/geleiademocoto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 44522937, "answer_count": 1, "score": 1, "last_activity_date": 1497360424, "creation_date": 1497357915, "last_edit_date": 1497358570, "question_id": 44521942, "link": "https://stackoverflow.com/questions/44521942/yesod-passing-the-current-user-to-a-form", "title": "Yesod: Passing the current user to a form", "body": "<p>I've looked for this, but the answer found <a href=\"https://stackoverflow.com/questions/37714297/how-get-the-user-id-from-the-session-at-yesod-haskell-project\">here</a> ends up on a list containing the value. I'm wondering if there isn't another, more straightforward way to do what I need.</p>\n\n<p>I have a form:</p>\n\n<pre><code>formReview :: UserId -&gt; Form Review\nformReview uid = renderDivs $ Review &lt;$&gt;\n              areq textField \"Text\" Nothing &lt;*&gt;\n              areq intField \"Rating\" Nothing &lt;*&gt;\n              areq (selectField films) \"Film\" Nothing &lt;*&gt;\n              pure uid\n</code></pre>\n\n<p>as you can see I'm trying to pass an user ID to the form, because these are the fields for Review:</p>\n\n<pre><code>Review\n    text Text\n    rating Int\n    film FilmId\n    author UserId\n</code></pre>\n\n<p>it requires the ID of the author.\nThe way I'm trying to do this is by doing the following on postReviewsR:</p>\n\n<pre><code>postReviewsR :: Handler Html\npostReviewsR = do\n                uid &lt;- lookupSession \"_ID\"\n                case uid of\n                  Nothing -&gt; do\n                     defaultLayout [whamlet| &lt;h1&gt; User isn't logged in.|]\n                  Just uid -&gt; \n                     ((result, _), _) &lt;- runFormPost $ formReview uid\n                     case result of\n                        FormSuccess review -&gt; do\n                            runDB $ insert review\n                            defaultLayout [whamlet|\n                                &lt;h1&gt; Review posted. \n                            |]\n                        _ -&gt; redirect ReviewsR\n</code></pre>\n\n<p>it has to be a Maybe because in theory you could try to post something without being logged in, so uid could be empty. If I try to go straight to <code>((result, _), _) &lt;- runFormPost $ formReview uid</code> it says there's a <code>Maybe Text</code>.</p>\n\n<p>Now my problem is similar the other post, it's this error:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018Text\u2019 with \u2018Key User\u2019\n  Expected type: UserId\n    Actual type: Text\n\u2022 In the first argument of \u2018formReview\u2019, namely \u2018uid\u2019\n  In the second argument of \u2018($)\u2019, namely \u2018formReview uid\u2019\n  In a stmt of a 'do' block:\n    ((result, _), _) &lt;- runFormPost $ formReview uid\n</code></pre>\n\n<p>and the suggestion in the linked post is to use <code>keyToValues :: Key record -&gt; [PersistValue]</code> to turn the Key, which apparently is just Text, into what I need, the UserId. \nIt seems too clunky to me that I would need to do all this, then use <code>head</code> on that list to get the value within, all to get the ID into the form. There has to be another, more correct way, right? What am I missing here? How do I get the ID of the user who's making the Review in there?</p>\n\n<p>EDIT: I should point out that I'm not using Yesod.Auth so I can't use its functions.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1263, "user_id": 532647, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7c1caab91478136b1cc442569c7da085?s=128&d=identicon&r=PG", "display_name": "Iarek", "link": "https://stackoverflow.com/users/532647/iarek"}, "edited": false, "score": 1, "creation_date": 1497359272, "post_id": 44520938, "comment_id": 76036731, "body": "What exactly do you not understand about the code? What have you tried so far?"}], "answers": [{"tags": [], "owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "is_accepted": false, "score": 3, "last_activity_date": 1497361162, "creation_date": 1497361162, "answer_id": 44523237, "question_id": 44520938, "link": "https://stackoverflow.com/questions/44520938/haskell-conversion-of-ordered-list-into-a-balanced-tree-code-explanation/44523237#44523237", "title": "Haskell conversion of ordered list into a balanced tree ~ Code Explanation", "body": "<p>What this function does is taking the middle element in the list, putting it as the node and then recursing for every half of the list. <code>m</code> is the position of the middle element, <code>ltx</code> (which I believe mean \"lower than x\") are all the element lower, than <code>x</code> and <code>gtx</code> are all the elements higher than x.</p>\n"}, {"comments": [{"owner": {"reputation": 1816, "user_id": 6041389, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh3.googleusercontent.com/-kVVs5_frHmc/AAAAAAAAAAI/AAAAAAAAABM/SMcp3aPNlEY/photo.jpg?sz=128", "display_name": "csandreas1", "link": "https://stackoverflow.com/users/6041389/csandreas1"}, "edited": false, "score": 0, "creation_date": 1497371971, "post_id": 44526839, "comment_id": 76046088, "body": "after where, i can&#39;t understand how this code works, i need to remember this exercise for my test. But it is important to understand how it works"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1497370918, "creation_date": 1497370918, "answer_id": 44526839, "question_id": 44520938, "link": "https://stackoverflow.com/questions/44520938/haskell-conversion-of-ordered-list-into-a-balanced-tree-code-explanation/44526839#44526839", "title": "Haskell conversion of ordered list into a balanced tree ~ Code Explanation", "body": "<p>In order to test in GHCI, make <code>Tree</code> an instance of <code>Show</code>:</p>\n\n<pre><code>data Tree a = Leaf a\n          | Node a (Tree a) (Tree a)\n          | Null\n          deriving (Show)\n</code></pre>\n\n<p>Start GHCI from the command line, and load the file that contains <code>Tree</code> and <code>list2tree</code>. I called it <code>44520938.hs</code>:</p>\n\n<pre><code>Prelude&gt; :load 44520938.hs\n[1 of 1] Compiling Answer           ( 44520938.hs, interpreted )\nOk, modules loaded: Answer.\n</code></pre>\n\n<p>Now you can call the function with various input lists to test:</p>\n\n<pre><code>*Answer&gt; list2tree []\nNull\n*Answer&gt; list2tree [1]\nLeaf 1\n*Answer&gt; list2tree [1, 2]\nNode 2 (Leaf 1) Null\n*Answer&gt; list2tree [1, 2, 3]\nNode 2 (Leaf 1) (Leaf 3)\n</code></pre>\n"}], "owner": {"reputation": 1816, "user_id": 6041389, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh3.googleusercontent.com/-kVVs5_frHmc/AAAAAAAAAAI/AAAAAAAAABM/SMcp3aPNlEY/photo.jpg?sz=128", "display_name": "csandreas1", "link": "https://stackoverflow.com/users/6041389/csandreas1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1490, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1497370955, "creation_date": 1497355224, "last_edit_date": 1497370955, "question_id": 44520938, "link": "https://stackoverflow.com/questions/44520938/haskell-conversion-of-ordered-list-into-a-balanced-tree-code-explanation", "title": "Haskell conversion of ordered list into a balanced tree ~ Code Explanation", "body": "<p>I have the following exercise:</p>\n\n<p>Define the function list2tree which converts a given ordered list into a balanced tree \u2013 the height of the right and the left subtree for any node of this tree can differ at most by 1. </p>\n\n<p>Can anyone explain this code and how does it work ? Also how can i test the tree in console ?</p>\n\n<blockquote>\n  <p>Solution:</p>\n</blockquote>\n\n<pre><code>data Tree a = Leaf a\n          | Node a (Tree a) (Tree a)\n          | Null\n\nlist2tree [] = Null\nlist2tree [x] = Leaf x\nlist2tree list = Node x (list2tree ltx) (list2tree gtx)\n                 where \n                 m = length list `div` 2\n                 x = list !! m\n                 ltx = take m list\n                 gtx = drop (m+1) list\n</code></pre>\n"}, {"tags": ["javascript", "haskell", "functional-programming", "type-inference", "traversable"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1497353860, "post_id": 44518797, "comment_id": 76032530, "body": "The rookie mistake it is!"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1497353012, "post_id": 44519126, "comment_id": 76031881, "body": "I would laugh now if I hadn&#39;t put so much work into this question. Still don&#39;t know anything about Haskell. Thanks!"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1497367891, "post_id": 44519126, "comment_id": 76043353, "body": "So you&#39;re saying that the Traversable instance with this will not work?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1497373145, "post_id": 44519126, "comment_id": 76046730, "body": "@Bergi no, we just have (luckily?!?) no type defaulting in Javascript"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1497350281, "creation_date": 1497350281, "answer_id": 44519126, "question_id": 44518797, "link": "https://stackoverflow.com/questions/44518797/is-explicit-type-passing-not-equivalent-to-type-inference-in-terms-of-expressiv/44519126#44519126", "title": "Is explicit type passing not equivalent to type inference (in terms of expressiveness)?", "body": "<p>GHCi does not overlook any type error. It defaults an unconstrained <code>Applicative</code> to <code>IO</code>, but you only get this behavior in a GHCi prompt (and not a <code>.hs</code> source file). You can check</p>\n\n<pre><code>&gt; :t pure Nothing\npure Nothing :: Applicative f =&gt; f (Maybe b)\n</code></pre>\n\n<p>But still have</p>\n\n<pre><code>&gt; pure Nothing\nNothing\n</code></pre>\n\n<p>Your javascript implementation is fine; you passed in an <code>Applicative</code> instance for arrays and got what is expected.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 44519126, "answer_count": 1, "score": 4, "last_activity_date": 1497366909, "creation_date": 1497349389, "last_edit_date": 1497366909, "question_id": 44518797, "link": "https://stackoverflow.com/questions/44518797/is-explicit-type-passing-not-equivalent-to-type-inference-in-terms-of-expressiv", "title": "Is explicit type passing not equivalent to type inference (in terms of expressiveness)?", "body": "<p>I try to translate <code>traverse</code>/<code>sequenceA</code> to Javascript. Now the following behavior of the Haskell implementation gives me trouble:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>traverse (\\x -&gt; x) Nothing -- yields Nothing\nsequenceA Nothing -- yields Nothing\ntraverse (\\x -&gt; x) (Just [7]) -- yields [Just 7]\nsequenceA (Just [7]) -- yields [Just 7]\n</code></pre>\n\n<p>As a Haskell newbie I wonder why the first expression works at all:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Traversable Maybe where\n    traverse _ Nothing = pure Nothing\n    traverse f (Just x) = Just &lt;$&gt; f x\n</code></pre>\n\n<p><code>pure Nothing</code> shouldn't work in this case, since there is no minimal applicative context in which the value could be put in. It seems as if the compiler checks the type of this expression lazily and since mapping the id function over <code>Nothing</code> is a noop, it simply \"overlooks\" the type error, so to speak.</p>\n\n<p>Here is my Javascript translation:</p>\n\n<p>(Please note, that since Javascirpt's prototype system is insufficient for a couple of type classes and there is no strict type checking anyway, I work with Church encoding and pass type constraints to functions explicitly.)</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>// minimal type system realized with `Symbol`s\n\nconst $tag = Symbol.for(\"ftor/tag\");\nconst $Option = Symbol.for(\"ftor/Option\");\n\nconst Option = {};\n\n// value constructors (Church encoded)\n\nconst Some = x =&gt; {\n  const Some = r =&gt; {\n    const Some = f =&gt; f(x);\n    return Some[$tag] = \"Some\", Some[$Option] = true, Some;\n  };\n\n  return Some[$tag] = \"Some\", Some[$Option] = true, Some;\n};\n\nconst None = r =&gt; {\n  const None = f =&gt; r;\n  return None[$tag] = \"None\", None[$Option] = true, None;\n};\n\nNone[$tag] = \"None\";\nNone[$Option] = true;\n\n// Traversable\n\n// of/map are explicit arguments of traverse to imitate type inference\n// tx[$Option] is just duck typing to enforce the Option type\n// of == pure in Javascript\n\nOption.traverse = (of, map) =&gt; ft =&gt; tx =&gt;\n tx[$Option] &amp;&amp; tx(of(None)) (x =&gt; map(Some) (ft(x)));\n\n// (partial) Array instance of Applicative\n\nconst map = f =&gt; xs =&gt; xs.map(f);\nconst of = x =&gt; [x];\n\n// helpers\n\nconst I = x =&gt; x;\n\n// applying\n\nOption.traverse(of, map) (I) (None) // ~ [None]\nOption.traverse(of, map) (I) (Some([7])) // ~ [Some(7)]\n</code></pre>\n\n<p>Obviously, this translation deviates from the Haskell implementation, because  I get a <code>[None]</code> where I should get a <code>None</code>. Honestly, this behavior corresponds precisely to my intuition, but I guess intuition isn't that helpful in functional programming. Now my question is</p>\n\n<ul>\n<li>did I merely make a rookie mistake?</li>\n<li>or is explicit type passing not equivalent to type inference (in terms of expressiveness)?</li>\n</ul>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1497345502, "post_id": 44517237, "comment_id": 76026575, "body": "Why do you add <code>c</code> as a parameter?"}], "tags": [], "owner": {"reputation": 1404, "user_id": 5559663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sQiE2.gif?s=128&g=1", "display_name": "baxbaxwalanuksiwe", "link": "https://stackoverflow.com/users/5559663/baxbaxwalanuksiwe"}, "is_accepted": true, "score": 4, "last_activity_date": 1497345570, "last_edit_date": 1497345570, "creation_date": 1497345460, "answer_id": 44517237, "question_id": 44517167, "link": "https://stackoverflow.com/questions/44517167/how-to-generalize-code/44517237#44517237", "title": "How to generalize code?", "body": "<p>You can use a helper function:</p>\n\n<pre><code>cipherCeasar :: Char -&gt; Int -&gt; Char\ncipherCeasar c i\n  | isUpper c = cipherBetween 'A' 'Z'\n  | otherwise = cipherBetween 'a' 'z'\n  where cipherBetween min max = chr (isBiggerMax ((+) i $ ord c) (ord min) (ord max))\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 44517237, "answer_count": 1, "score": 0, "last_activity_date": 1497345570, "creation_date": 1497345299, "question_id": 44517167, "link": "https://stackoverflow.com/questions/44517167/how-to-generalize-code", "title": "How to generalize code?", "body": "<p>I am learning haskell and write for exercise following function:</p>\n\n<pre><code>  cipherCeasar :: Char -&gt; Int -&gt; Char\n  cipherCeasar c i\n    | isUpper c = chr (isBiggerMax ((+) i $ ord c) (ord 'A') (ord 'Z'))                    \n    | otherwise = chr (isBiggerMax ((+) i $ ord c) (ord 'a') (ord 'z'))\n</code></pre>\n\n<p>As you can see the two lines of codes after guard are almost the same.<br>\nHow can I generalize code or it is ok so?</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497347418, "post_id": 44516946, "comment_id": 76027997, "body": "<code>instance FromJSON (Reader Decimal)</code> or better: <code>newtype DecimalWithPrec = D (Reader Precision Decimal); instance FromJSON DecimalWithPrec</code>. This still would not allow you to make parsing choices based on the environment, but that isn&#39;t needed for your example."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497370460, "post_id": 44516946, "comment_id": 76045123, "body": "@user2407038 Sounds like that should be an answer :)"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497516658, "post_id": 44516946, "comment_id": 76114804, "body": "@user2407038 I tried going with your approach and got to the following - <a href=\"https://gist.github.com/saurabhnanda/6b2eaa437be9a2fff14540e0dcbbc334\" rel=\"nofollow noreferrer\">gist.github.com/saurabhnanda/6b2eaa437be9a2fff14540e0dcbbc33&zwnj;&#8203;4</a> - but how do I write the <code>ToJSON</code> instance?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497531967, "post_id": 44516946, "comment_id": 76125138, "body": "You either pick a default argument for the reader (probably <code>defaultPrecision</code>), or you don&#39;t have such an instance. I don&#39;t know what <code>Decimal</code> type you are talking about here, but if the need for a precision argument is due to the fact that the &#39;decimal&#39; in question is not (might not be) representable exactly as a finite sequence of digits, then you should see why you can&#39;t reliably serialize such a number, without arbitrarily picking a precision (you should probably elaborate where you got your <code>Decimal</code> and what the intended semantics of the instances are)."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497532873, "post_id": 44516946, "comment_id": 76125901, "body": "The <code>Decimal</code> type in question is from the <code>Data.Decimal</code> package. The precision for parsing will be provided by the user, which will be stored in the DB. Hence the need for a Reader environment."}, {"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1497645121, "post_id": 44516946, "comment_id": 76183370, "body": "Can you confirm how you want to use <code>parseJSON</code>? Is it to be able to call something like <code>decode &quot;4&quot; :: Data.Decimal.Decimal</code>, but use a precision found at runtime?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1497693912, "post_id": 44516946, "comment_id": 76193808, "body": "@MichalCharemza essentially, yes. The overall context is larger, but it boils down to this particular building block, i.e. being able to call <code>decode &quot;4&quot; :: Data.Decimal.Decimal</code> and use a precision that is known at the time <code>decode</code> is being called, i.e. runtime."}], "answers": [{"comments": [{"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1497640477, "post_id": 44596267, "comment_id": 76181032, "body": "Would the method using reflection work with <code>decode</code> from <code>Data.Aeson</code>?"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1497645938, "post_id": 44596267, "comment_id": 76183773, "body": "You should mention the original Functonal Pearl: Implicit Configurations <a href=\"http://okmij.org/ftp/Haskell/tr-15-04.pdf\" rel=\"nofollow noreferrer\">okmij.org/ftp/Haskell/tr-15-04.pdf</a>"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1497650268, "post_id": 44596267, "comment_id": 76185388, "body": "@MichalCharemza I think no... Because <code>decode</code> isn&#39;t a type class method."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1497650286, "post_id": 44596267, "comment_id": 76185395, "body": "@phadej I mentioned <code>reflection</code> library which contains link to this paper."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 5, "last_activity_date": 1497640241, "last_edit_date": 1497640241, "creation_date": 1497639706, "answer_id": 44596267, "question_id": 44516946, "link": "https://stackoverflow.com/questions/44516946/how-to-conditionally-parse-json-based-on-settings-in-a-reader-environment/44596267#44596267", "title": "How to conditionally parse JSON based on settings in a Reader environment?", "body": "<p>If instance depends on some runtime value then what you really want is an ability to create instances at runtime. You can implement <code>FromJSON</code> for <code>Reader</code> as it's done in your <a href=\"https://gist.github.com/saurabhnanda/6b2eaa437be9a2fff14540e0dcbbc334\" rel=\"noreferrer\">gist</a>. But as you correctly noticed, you can't do the same for <code>ToJSON</code> because you don't know this precision. The easiest solution would be just store precision as separate field in data type. Like this:</p>\n\n<pre><code>data DecimalWithPrecision = MkDWP\n    { value     :: Decimal\n    , precision :: Word8\n    }\n</code></pre>\n\n<p>If you store this data type in your data base and query it after user login, then this is the easiest solution and doesn't require type level tricks from you.</p>\n\n<p>If you don't know precision in advance, for example user inputs precision through console (I don't know why, but lets assume this), then this wouldn't work for you. As we all know that \u00abtype classes are just syntax sugar for data types\u00bb, you can replace <code>ToJSON/FromJSON</code> constraints with <code>JsonDict</code> for <code>Money_</code> in the following manner:</p>\n\n<pre><code>newtype Money_ = Money_ (Reader Word8 Decimal)\n\ndata JsonDict a = JsonDict\n    { jdToJSON    :: a -&gt; Value\n    , jdParseJSON :: Value -&gt; Parser a\n    }\n\nmkJsonDict :: Word8  -- precision\n           -&gt; JsonDict Money_\n</code></pre>\n\n<p>You can create such dictionary (or something similar to it) on-the-fly using <code>Word8</code> from context and just pass it to function which needs it. See <a href=\"http://www.haskellforall.com/2012/05/scrap-your-type-classes.html\" rel=\"noreferrer\">this blog post</a> by <a href=\"https://stackoverflow.com/users/1026598/gabriel-gonzalez\">Gabriel Gonzalez</a> for details.</p>\n\n<p>If you really want to have <code>toJSON</code> implementation inside instance, you can use <a href=\"https://hackage.haskell.org/package/reflection\" rel=\"noreferrer\"><code>reflection</code></a> library. Precision is a natural number which gives you ability to use this library. Using it you basically can create instances in runtime as in previous approach, but you still have your type classes. See <a href=\"http://newartisans.com/2017/02/a-case-of-reflection/\" rel=\"noreferrer\">this blog post</a> where similar technique was applied to make <code>Arbitrary</code> instances depend on runtime values. In your case this will look like this:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables  #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nimport           Control.Monad.Reader (Reader, ask)\n\nimport           Data.Aeson           (FromJSON (..), Result (..), ToJSON (..),\n                                       Value, fromJSON, withNumber)\nimport           Data.Aeson.Types     (Parser)\nimport           Data.Decimal         (Decimal, realFracToDecimal)\nimport           Data.Proxy           (Proxy (..))\nimport           Data.Reflection      (Reifies (reflect), reify)\nimport           Data.Word8           (Word8)\n\nnewtype PreciseDecimal s = PD Decimal\n\ninstance Reifies s Int =&gt; FromJSON (PreciseDecimal s) where\n    parseJSON = withNumber \"a number\" $ \\n -&gt; do\n      let precision = fromIntegral $ reflect (Proxy :: Proxy s)\n      pure $ PD $ realFracToDecimal precision n\n\ninstance Reifies s Int =&gt; ToJSON (PreciseDecimal s) where\n    toJSON (PD decimal) =\n        let precision = reflect (Proxy :: Proxy s)\n            ratDec    = realToFrac decimal :: Double\n        in toJSON ratDec -- use precision if needed\n\nmakeMoney :: Decimal -&gt; Reader Word8 (Value, Decimal)\nmakeMoney value = do\n    precision &lt;- fromIntegral &lt;$&gt; ask\n    let jsoned = reify precision $ \\(Proxy :: Proxy s) -&gt;\n                     toJSON (PD value :: PreciseDecimal s)\n    let parsed = reify precision $ \\(Proxy :: Proxy s) -&gt;\n                     let Success (PD res :: PreciseDecimal s)\n                           = fromJSON jsoned in res\n    pure (jsoned, parsed)\n</code></pre>\n\n<p>And then you can run it like this to test:</p>\n\n<pre><code>ghci&gt; runReader (makeMoney 3.12345) 2\n(Number 3.12345,3.12)\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1497640241, "creation_date": 1497344723, "question_id": 44516946, "link": "https://stackoverflow.com/questions/44516946/how-to-conditionally-parse-json-based-on-settings-in-a-reader-environment", "title": "How to conditionally parse JSON based on settings in a Reader environment?", "body": "<p>Is there any way to pass down a reader environment to the JSON (de)serialisation functions of Aeson? Here's a real-life example of why this could be required?</p>\n\n<pre><code>-- JSON instances for decimal -- ORPHAN instances\n\ndefaultPrecision :: Word8\ndefaultPrecision = fromInteger 2\n\ninstance ToJSON Data.Decimal.Decimal  where\n  toJSON d = toJSON $ show d\n\ninstance FromJSON Data.Decimal.Decimal  where\n  -- TODO: New problem! How do we get the precision dynamically, based on\n  -- the currency settings of the logged-in user\n  parseJSON (Number n) = return $ Data.Decimal.realFracToDecimal defaultPrecision n\n  parseJSON x = fail $ \"Expectig a number in the JSON to parse to a Decimal. Received \" ++ (show x)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1497339882, "post_id": 44515168, "comment_id": 76022919, "body": "You&#39;re trying to pass a number to a function that only accepts <code>Char</code>s. Try <code>isElemChar &#39;5&#39;</code>."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1497339969, "post_id": 44515168, "comment_id": 76022984, "body": "If the user would pass 5 instead &#39;5&#39; how to handle the exception?"}], "answers": [{"tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": true, "score": 11, "last_activity_date": 1497339977, "creation_date": 1497339977, "answer_id": 44515277, "question_id": 44515168, "link": "https://stackoverflow.com/questions/44515168/how-to-make-it-more-safe/44515277#44515277", "title": "How to make it more safe?", "body": "<p>Your function <em>is</em> safe. The \"exception\" you mention is actually a compile-time error, which is exactly the time you want errors.</p>\n\n<p>This is slightly hidden by the fact you're at an interactive prompt, but if you wrote the program <code>safe.hs</code>....</p>\n\n<pre><code>isElemChar :: Char -&gt; Bool\nisElemChar x = elem x ['A'..'Z'] || elem x ['a'..'z']\n\nmain = print $ isElemChar 5\n</code></pre>\n\n<p>... and you tried to compile it...</p>\n\n<pre><code>ghc safe.hs\n</code></pre>\n\n<p>... you would get a similar error</p>\n\n<pre><code>safe.hs:5:27: error:\n    \u2022 No instance for (Num Char) arising from the literal \u20185\u2019\n    \u2022 In the first argument of \u2018isElemChar\u2019, namely \u20185\u2019\n      In the second argument of \u2018($)\u2019, namely \u2018isElemChar 5\u2019\n      In the expression: print $ isElemChar 5\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 0, "last_activity_date": 1497340129, "creation_date": 1497340129, "answer_id": 44515343, "question_id": 44515168, "link": "https://stackoverflow.com/questions/44515168/how-to-make-it-more-safe/44515343#44515343", "title": "How to make it more safe?", "body": "<p>There is no need to make the function more safe, this is not python, the functions params have a type, so your code will just give you a <code>compile error</code>.\nIf you are dealing with <code>IO</code> you will always get an <code>IO([Char])</code> or a <code>IO(Char)</code>.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 44515277, "answer_count": 2, "score": 0, "last_activity_date": 1497340170, "creation_date": 1497339662, "last_edit_date": 1497340170, "question_id": 44515168, "link": "https://stackoverflow.com/questions/44515168/how-to-make-it-more-safe", "title": "How to make it more safe?", "body": "<p>I have following function:</p>\n\n<pre><code>isElemChar :: Char -&gt; Bool\nisElemChar x = elem x ['A'..'Z'] || elem x ['a'..'z']\n</code></pre>\n\n<p>When I try to use the function as follow:</p>\n\n<pre><code>isElemChar 5\n</code></pre>\n\n<p>Then I've got the exception:</p>\n\n<pre><code>&lt;interactive&gt;:73:12: error:\n    * No instance for (Num Char) arising from the literal `5'\n    * In the first argument of `isElemChar', namely `5'\n      In the expression: isElemChar 5\n      In an equation for `it': it = isElemChar 5\n*Cipher Data.Char&gt; isElemChar 'a'\n</code></pre>\n\n<p>How to make the function more safe? Which would be the right approach to make it to total function?   </p>\n\n<p>I could use the <code>Maybe</code> datatype, but do not know how to implement it.</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "memoization"], "answers": [{"comments": [{"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1497380606, "post_id": 44515364, "comment_id": 76050864, "body": "Why <code>=&lt;&lt;</code> instead of <code>&gt;&gt;=</code> (with the arguments reversed)?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1497403772, "post_id": 44515364, "comment_id": 76059278, "body": "@MichalCharemza, I usually prefer <code>=&lt;&lt;</code> to <code>&gt;&gt;=</code>, it&#39;s more similar to application.  E.g. <code>($) :: (a -&gt; b) -&gt; a -&gt; b</code> is analogous to <code>(=&lt;&lt;) :: (a -&gt; m b) -&gt; m a -&gt; m b</code>.  Then data consistently flows right-to-left, instead of switching directions depending on whether it&#39;s monadic or not."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1497428979, "post_id": 44515364, "comment_id": 76069519, "body": "@MichalCharemza I think it&#39;s depend on a code style. I choose the operator that is the most convenient. In this situation, both these operators are convenient, so I will use another rule, which <i>luqui</i> wrote about."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 3, "last_activity_date": 1497340182, "creation_date": 1497340182, "answer_id": 44515364, "question_id": 44515018, "link": "https://stackoverflow.com/questions/44515018/concise-way-to-conditionally-update-map-in-state-monad/44515364#44515364", "title": "Concise way to conditionally update map in State monad", "body": "<p>I think your code is in functional style, but you can bit simplify it.</p>\n\n<pre><code>myMemo f x = maybe work return =&lt;&lt; gets (Map.lookup x)\n  where\n    work = do\n        y &lt;- f x\n        modify $ Map.insert x y\n        return y\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": false, "score": 0, "last_activity_date": 1497382003, "creation_date": 1497382003, "answer_id": 44529972, "question_id": 44515018, "link": "https://stackoverflow.com/questions/44515018/concise-way-to-conditionally-update-map-in-state-monad/44529972#44529972", "title": "Concise way to conditionally update map in State monad", "body": "<p>This is alternative that uses <code>mapState</code>, as well as <code>&gt;&gt;=</code> and <code>maybe</code> from <a href=\"https://stackoverflow.com/a/44515364/1319998\">https://stackoverflow.com/a/44515364/1319998</a>, that avoids all the do notation</p>\n\n<pre><code>myMemo f x = gets (Map.lookup x) &gt;&gt;= maybe y' return\n  where\n    y' = mapState (\\(y, map) -&gt; (y, Map.insert x y map)) $ f x \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": false, "score": 0, "last_activity_date": 1497383317, "creation_date": 1497383317, "answer_id": 44530294, "question_id": 44515018, "link": "https://stackoverflow.com/questions/44515018/concise-way-to-conditionally-update-map-in-state-monad/44530294#44530294", "title": "Concise way to conditionally update map in State monad", "body": "<p>This is an alternative that expands on <a href=\"https://stackoverflow.com/a/44515364/1319998\">https://stackoverflow.com/a/44515364/1319998</a>, using more <code>&gt;&gt;=</code> that avoids all the do notation</p>\n\n<pre><code>myMemo :: Ord a =&gt; (a -&gt; MyMemo a b) -&gt; a -&gt; MyMemo a b\nmyMemo f x = gets (Map.lookup x) &gt;&gt;= maybe y' return\n  where\n    y' = f x &gt;&gt;= \\y -&gt; state $ \\map -&gt; (y, Map.insert x y map)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": false, "score": 0, "last_activity_date": 1497385605, "creation_date": 1497385605, "answer_id": 44530905, "question_id": 44515018, "link": "https://stackoverflow.com/questions/44515018/concise-way-to-conditionally-update-map-in-state-monad/44530905#44530905", "title": "Concise way to conditionally update map in State monad", "body": "<p>This is an alternative that expands on <a href=\"https://stackoverflow.com/a/44515364/1319998\">https://stackoverflow.com/a/44515364/1319998</a>, essentially de-sugaring the do-notation</p>\n\n<pre><code>myMemo f x = gets (Map.lookup x) &gt;&gt;= maybe y' return\n  where\n    y' = f x &gt;&gt;= \\y -&gt; modify (Map.insert x y) &gt;&gt; return y\n</code></pre>\n"}], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 425, "favorite_count": 0, "accepted_answer_id": 44515364, "answer_count": 4, "score": 0, "last_activity_date": 1497385605, "creation_date": 1497339119, "question_id": 44515018, "link": "https://stackoverflow.com/questions/44515018/concise-way-to-conditionally-update-map-in-state-monad", "title": "Concise way to conditionally update map in State monad", "body": "<p>Below is the code from <a href=\"https://stackoverflow.com/a/44508289/1319998\">an answer regarding memoization</a>, showing a memoization function used in the State monad, where the state is updated with the result of the passed function if the key is not already in the map.</p>\n\n<pre><code>type MyMemo a b = State (Map.Map a b) b\n\nmyMemo :: Ord a =&gt; (a -&gt; MyMemo a b) -&gt; a -&gt; MyMemo a b\nmyMemo f x = do\n  map &lt;- get\n  case Map.lookup x map of\n    Just y  -&gt; return y\n    Nothing -&gt; do\n      y &lt;- f x\n      modify $ \\map' -&gt; Map.insert x y map'\n      return y\n</code></pre>\n\n<p>It doesn't seem like idiomatic Haskell: it feels very imperative, with not really that much going on per line.</p>\n\n<p>Is there a way to do the above, but in a more concise/functional style? I've had a look around the functions available at <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-State-Lazy.html#v:state\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-State-Lazy.html#v:state</a>, but nothing really seems helpful.</p>\n"}, {"tags": ["json", "haskell", "aeson"], "comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1497346024, "post_id": 44514645, "comment_id": 76026933, "body": "I would just store the keys as additional values."}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1497346396, "post_id": 44514645, "comment_id": 76027205, "body": "What do you mean ? I have basically no idea of how Aeson works, I recently figured out how to use v .: &quot;stuff&quot; to use different names, maybe use a condition, but that&#39;s about it. And the doc is a bit hairy for me"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1497346710, "post_id": 44514645, "comment_id": 76027449, "body": "I&#39;m not too familiar with what Aeson supports. But one approach is to use <code>decode</code> into an <code>Object</code> type. And parse that object into your data types. The section &quot;Decoding a mixed-type object&quot; might be useful to look at."}, {"owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "edited": false, "score": 0, "creation_date": 1497347202, "post_id": 44514645, "comment_id": 76027820, "body": "Do you create this json object or is it created by some program? I mean, can you get rid of <code>X</code> suffix in <code>&quot;virtioX&quot;</code> and <code>&quot;ideX&quot;</code>?"}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1497347375, "post_id": 44514645, "comment_id": 76027958, "body": "Ah, no I have no control over the original json, it&#39;s the Proxmox API. As for &quot;Decoding a mixed-type object&quot; thanks, I&#39;ll take a look at that !"}, {"owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "edited": false, "score": 0, "creation_date": 1497347604, "post_id": 44514645, "comment_id": 76028140, "body": "Alright then. But, also, you might find handy <code>.:?</code> operator: it is the same as <code>.:</code> but it returns <code>Maybe a</code> if json field is missing. It allows you to parse data types with maybe fields like <code>data D = D (Maybe Int)</code>."}, {"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "edited": false, "score": 0, "creation_date": 1497349437, "post_id": 44514645, "comment_id": 76029452, "body": "You can modify the original JSON by a function first: standardize :: Value -&gt; Value. This function will turn all VirtioX to virtio, and ideX to ide. Then you can use <code>.:?</code> operator"}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1497350744, "post_id": 44514645, "comment_id": 76030324, "body": "My problem isn&#39;t the fact that there is a number, it&#39;s that there might be 9 virtio and 2 ide, for example. Depending on how many disks and what types of disks the VM has, that&#39;s why I&#39;d like to parse it as a list instead."}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1497351086, "post_id": 44514645, "comment_id": 76030568, "body": "I&#39;ve edited the json to show that, there could be multiple of each types"}], "answers": [{"comments": [{"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1497355707, "post_id": 44520975, "comment_id": 76033896, "body": "Well I can&#39;t tell how many there will be, could be 0, could be 10, could be 50. But I imagine I could have it loop on 99 iterations or something like that, I imagine there must be a maximum .."}], "tags": [], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "is_accepted": false, "score": 1, "last_activity_date": 1497355356, "creation_date": 1497355356, "answer_id": 44520975, "question_id": 44514645, "link": "https://stackoverflow.com/questions/44514645/fromjson-make-a-list-from-multiple-fields/44520975#44520975", "title": "FromJSON make a list from multiple fields", "body": "<p>If as you said there are only 9 virtio and 2 ide, one simple and perhaps not so elegent way to do is to use the asum function from Data.Foldable (which is generalised choice from various parsing libraries)</p>\n\n<pre><code>import Control.Applicative\n\n\ninstance FromJSON VM where\n  parseJSON = withObject \"VM\" $ \\o -&gt; do\n    cores &lt;- o .: \"cores\"\n    mem   &lt;- o .: \"mem\"\n    disk  &lt;- optional $ asum [\n      o .: \"virtio0\",\n      o .: \"virtio1\",\n      o .: \"virtio2\",\n    return VM{..}\n</code></pre>\n\n<p>I haven't tried the code yet. For further reference, see this <a href=\"https://artyom.me/aeson#more-interesting-choices\" rel=\"nofollow noreferrer\">link</a> for a comprehensive guide of haskell JSON parsing with the Aeson library. </p>\n"}, {"comments": [{"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1497455435, "post_id": 44526515, "comment_id": 76089386, "body": "Well, I just tested this and it does exactly what I need ! Thanks a lot for this, I can&#39;t say I understand it all so it looks like I have a bit of reading to do :)"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 5, "last_activity_date": 1497369809, "creation_date": 1497369809, "answer_id": 44526515, "question_id": 44514645, "link": "https://stackoverflow.com/questions/44514645/fromjson-make-a-list-from-multiple-fields/44526515#44526515", "title": "FromJSON make a list from multiple fields", "body": "<p>While I don't consider myself a Haskell expert, and even less of an Aeson expert, I think I've found something that works. Take it for what it is.</p>\n\n<p>The following code all makes use of this module declaration and these imports:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Control.Applicative ((&lt;$&gt;), (&lt;|&gt;))\nimport Data.Aeson\nimport Data.ByteString.Lazy (ByteString)\nimport Data.HashMap.Lazy (HashMap, foldlWithKey')\nimport Data.Foldable (toList)\nimport Data.Text (Text, stripPrefix, unpack)\nimport Text.Read (readMaybe)\n</code></pre>\n\n<p>I changed the type declarations slightly:</p>\n\n<pre><code>data DiskType = Virtio | Sata | IDE deriving (Show)\ndata Disk =\n  Disk { diskType :: DiskType, diskNumber :: Int, diskPath :: Text }\n  deriving (Show)\ndata VM = VM { cores :: Int, disks :: [Disk], mem :: Int } deriving (Show)\n</code></pre>\n\n<p>The most notable difference is that I added <code>diskNumber</code> to the <code>Disk</code> type, so that it can capture both the number after the disk type, as well as the text associated with the disk property.</p>\n\n<p>The other change was that I made all types be instances of <code>Show</code>. This was only to be able to test whether or not my code works.</p>\n\n<p>First, I defined a little helper function that can find the number after a given prefix:</p>\n\n<pre><code>findNumber :: Read a =&gt; Text -&gt; Text -&gt; Maybe a\nfindNumber prefix candidate =\n  stripPrefix prefix candidate &gt;&gt;= (readMaybe . unpack)\n</code></pre>\n\n<p>Examples:</p>\n\n<pre><code>*Main Data.Text&gt; findNumber (pack \"ide\") (pack \"ide2\") :: Maybe Int\nJust 2\n*Main Data.Text&gt; findNumber (pack \"sata\") (pack \"sata0\") :: Maybe Int\nJust 0\n*Main Data.Text&gt; findNumber (pack \"foo\") (pack \"bar\") :: Maybe Int\nNothing\n</code></pre>\n\n<p>This enabled me to write a function that finds all the disks in an <code>Object</code>:</p>\n\n<pre><code>findDisks :: HashMap Text Value -&gt; [Disk]\nfindDisks = foldlWithKey' folder []\n  where\n    findVirtio k s = flip (Disk Virtio) s &lt;$&gt; findNumber \"virtio\" k\n    findSata   k s = flip (Disk Sata)   s &lt;$&gt; findNumber \"sata\"   k\n    findIde    k s = flip (Disk IDE)    s &lt;$&gt; findNumber \"ide\"    k\n    folder acc k (String s) =\n      acc ++ toList (findVirtio k s &lt;|&gt; findSata k s &lt;|&gt; findIde k s)\n    folder acc _ _ = acc\n</code></pre>\n\n<p><code>Object</code> is a type alias for <code>HashMap Text Value</code>, so this function takes an <code>Object</code> as input, and returns a list of the <code>Disk</code> values that it could find.</p>\n\n<p>This is enough to define an instance of <code>FromJSON</code> for <code>VM</code>:</p>\n\n<pre><code>instance FromJSON VM where\n  parseJSON = withObject \"VM\" $ \\o -&gt; do\n    let disks = findDisks o\n    cores &lt;- o .: \"cores\"\n    mem   &lt;- o .: \"mem\"\n    return $ VM cores disks mem\n</code></pre>\n\n<p>In order to test that this works, I created this JSON string:</p>\n\n<pre><code>myJson :: ByteString\nmyJson =\n  \"[\\\n    \\{\\\n      \\\\\"virtio0\\\": \\\"some text\\\",\\\n      \\\\\"virtio1\\\": \\\"blah\\\",\\\n      \\\\\"ide2\\\": \\\"some other text\\\",\\\n      \\\\\"cores\\\": 1,\\\n      \\\\\"mem\\\": 512\\\n    \\}\\\n  \\]\"\n</code></pre>\n\n<p>and used it from <code>main</code>:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let vms = decode myJson :: Maybe [VM]\n  print vms\n</code></pre>\n\n<p>When executed, it prints the decoded value:</p>\n\n<pre><code>Just [VM {cores = 1, disks = [Disk {diskType = IDE, diskNumber = 2, diskPath = \"some other text\"},Disk {diskType = Virtio, diskNumber = 1, diskPath = \"blah\"},Disk {diskType = Virtio, diskNumber = 0, diskPath = \"some text\"}], mem = 512}]\n</code></pre>\n\n<p>Notice that the JSON parsed here is simply an array of VM objects. I didn't include the outer container object with the <code>data</code> property, but if you need help with that, I think that ought to be a separate question :)</p>\n"}], "owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 424, "favorite_count": 0, "accepted_answer_id": 44526515, "answer_count": 2, "score": 2, "last_activity_date": 1497369809, "creation_date": 1497338028, "last_edit_date": 1497351061, "question_id": 44514645, "link": "https://stackoverflow.com/questions/44514645/fromjson-make-a-list-from-multiple-fields", "title": "FromJSON make a list from multiple fields", "body": "<p>I have an object to parse that looks a bit like this :</p>\n\n<pre><code>{\n  \"data\":\n  [\n    {\n      \"virtio0\": \"some text\",\n      \"virtio1\": \"blah\",\n      \"ide2\": \"some other text\",\n      \"cores\": 1,\n      \"mem\": 512,\n      ...\n    },\n    {\n      // The same ...\n    }\n  ]\n}\n</code></pre>\n\n<p>Now I basically want to parse that into a [VM], but my problem is those numbered fields. Depending on the VM config, it might or might not have virtioX fields, ideX fields .. and I don't see a way to know in advance, nor to guess the numbers.\nI was thinking the best might be to define a Disk type that would contain something like Virtio | Sata | IDE and so on for the type, and a Text field for the value, then have each VM have a [Disk] in it's type. Something like this :</p>\n\n<pre><code>data DiskType = Virtio | Sata | IDE\ndata Disk     = Disk {diskType :: DiskType, diskPath :: Text}\ndata VM       = VM {cores :: Int, disks :: [Disk], mem :: Int, ...}\n</code></pre>\n\n<p>That would be great, but how do I parse those random fields that I have directly inside the VM json object into a list ?</p>\n"}, {"tags": ["c", "haskell", "ffi"], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 7994574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b56bb47526ed9b1d72c20a7bd284477?s=128&d=identicon&r=PG&f=1", "display_name": "Eddy JD", "link": "https://stackoverflow.com/users/7994574/eddy-jd"}, "edited": false, "score": 0, "creation_date": 1497393104, "post_id": 44512172, "comment_id": 76056864, "body": "Thanks! This was easy to understand. My problem now is that the return value is stuck in an IO Monad. Having to trace back through my code everywhere where I use this result is a nightmare. Is there a way that I can pull this result out? As an example I have:      do         result &lt;- func l1 l2         if result == 0 then False else True  But this now has type IO Bool. Is there a way to pull this out to just type Bool?"}, {"owner": {"reputation": 53, "user_id": 7994574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b56bb47526ed9b1d72c20a7bd284477?s=128&d=identicon&r=PG&f=1", "display_name": "Eddy JD", "link": "https://stackoverflow.com/users/7994574/eddy-jd"}, "edited": false, "score": 0, "creation_date": 1497395196, "post_id": 44512172, "comment_id": 76057402, "body": "Ok, unsafePerformIO does exactly what I want. It seems much vilified, but given that I&#39;m using FFI to C, I&#39;m not sure what else to do."}, {"owner": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "reply_to_user": {"reputation": 53, "user_id": 7994574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b56bb47526ed9b1d72c20a7bd284477?s=128&d=identicon&r=PG&f=1", "display_name": "Eddy JD", "link": "https://stackoverflow.com/users/7994574/eddy-jd"}, "edited": false, "score": 0, "creation_date": 1497410406, "post_id": 44512172, "comment_id": 76060852, "body": "@EddyJD If <code>c_func</code> is pure, using <code>unsafePerformIO</code> around it is reasonable. If it has side-effects, you really should thread <code>IO</code> everywhere. Among other issues, a function that looks pure to Haskell may be called a greater or fewer number of times than you expect due to optimizations and inlining."}], "tags": [], "owner": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "is_accepted": true, "score": 1, "last_activity_date": 1497326588, "creation_date": 1497326588, "answer_id": 44512172, "question_id": 44512077, "link": "https://stackoverflow.com/questions/44512077/haskell-ffi-passing-multiple-arrays-to-c/44512172#44512172", "title": "Haskell FFI passing multiple arrays to C", "body": "<p>The <code>withArray*</code> functions give you a <code>Ptr</code> within the scope of a function. You can write it as a lambda inline, like so:</p>\n\n<pre><code>func :: [CInt] -&gt; [CInt] -&gt; IO CInt\nfunc list1 list2 =\n    withArrayLen list1 $ \\len1 array1 -&gt;\n      withArrayLen list2 $ \\len2 array2 -&gt;\n        c_func (fromIntegral len1) array1 (fromIntegral len2) array2\n</code></pre>\n\n<p>You could also have computed the length separately, for example</p>\n\n<pre><code>func list1 list2 =\n    withArray list1 $ \\array1 -&gt;\n      withArray list2 $ \\array2 -&gt;\n        c_func len1 array1 len2 array2\n  where\n    len1 = genericLength list1\n    len2 = genericLength list2\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 7994574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b56bb47526ed9b1d72c20a7bd284477?s=128&d=identicon&r=PG&f=1", "display_name": "Eddy JD", "link": "https://stackoverflow.com/users/7994574/eddy-jd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 44512172, "answer_count": 1, "score": 0, "last_activity_date": 1497326588, "creation_date": 1497325968, "question_id": 44512077, "link": "https://stackoverflow.com/questions/44512077/haskell-ffi-passing-multiple-arrays-to-c", "title": "Haskell FFI passing multiple arrays to C", "body": "<p>I have a C function with type</p>\n\n<pre><code>int func(int len1, int *array1, int len2, int *array2);\n</code></pre>\n\n<p>that I'd like to call from Haskell. It doesn't modify its contents. I want to pass data from lists. I've been looking through Foreign.Marshal.Array, but I'm quite confused. Either newArray or withArray seems to do what I want, but withArray, for example, takes a function with type</p>\n\n<pre><code>Ptr a -&gt; IO b\n</code></pre>\n\n<p>And I'm not quite sure how to deal with that given the two arrays in my function. So far, I have:</p>\n\n<pre><code>foreign import ccall unsafe \"func.h func\"\n    c_func :: CInt -&gt; Ptr CInt -&gt; CInt -&gt; Ptr CInt -&gt; IO CInt\n</code></pre>\n\n<p>And I'm not sure how to call this. In the documentation (<a href=\"https://wiki.haskell.org/Foreign_Function_Interface#Arrays\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Foreign_Function_Interface#Arrays</a>), it just says to read Foreign.Marshall.Array.</p>\n\n<p>Thanks!</p>\n\n<p>Edit: typo.</p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1497327752, "post_id": 44511865, "comment_id": 76017274, "body": "<code>remainingLines &lt;- replicateM num getLine</code> gets you a <code>[String]</code> for the remaining lines."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1497333373, "post_id": 44511865, "comment_id": 76019329, "body": "I voted to close as &quot;unclear what you&#39;re asking&quot;. If you&#39;ve tried something and it failed, you need to tell us about it. Trying nothing and coming here first... well, that isn&#39;t how this site works."}, {"owner": {"reputation": 347, "user_id": 2154913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72205296aa8593ae9e5237a6a1ba6fcd?s=128&d=identicon&r=PG", "display_name": "ErisoHV", "link": "https://stackoverflow.com/users/2154913/erisohv"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1497357125, "post_id": 44511865, "comment_id": 76034934, "body": "@DanielWagner And I vote for the community to support me to improve my question... In the place of making empty criticisms"}, {"owner": {"reputation": 347, "user_id": 2154913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72205296aa8593ae9e5237a6a1ba6fcd?s=128&d=identicon&r=PG", "display_name": "ErisoHV", "link": "https://stackoverflow.com/users/2154913/erisohv"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1497377889, "post_id": 44511865, "comment_id": 76049341, "body": "@Alec thanks, that worked for me. I used <code>remainingLines &lt;- replicateM num readInts</code> where:   <code>readInts :: IO [Int] readInts = fmap (map read.words) getLine</code>"}], "answers": [{"tags": [], "owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "is_accepted": false, "score": 0, "last_activity_date": 1497361404, "creation_date": 1497361404, "answer_id": 44523330, "question_id": 44511865, "link": "https://stackoverflow.com/questions/44511865/how-do-i-read-n-lines-in-a-file-with-haskell/44523330#44523330", "title": "How do I read N lines in a file with Haskell?", "body": "<p>Have you looked into the function <code>lines</code>? It takes a string and returns the same string as a list separated by <code>\\n</code>. Using this function you don't even have to have the number of lines.</p>\n"}, {"comments": [{"owner": {"reputation": 347, "user_id": 2154913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72205296aa8593ae9e5237a6a1ba6fcd?s=128&d=identicon&r=PG", "display_name": "ErisoHV", "link": "https://stackoverflow.com/users/2154913/erisohv"}, "edited": false, "score": 0, "creation_date": 1497386047, "post_id": 44530009, "comment_id": 76053679, "body": "In my opinion, this is a useful and simple solution! thanks! For iterate over the &quot;list of lists&quot; I modified that, like this:  <code>readInts :: IO [Int] readInts = fmap (map read.words) getLine  main :: IO () main = do num &lt;- readLn           forM_ [1 .. num] $ \\i -&gt; do               compare &lt;- readInts               print compare</code>"}], "tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": true, "score": 2, "last_activity_date": 1497391726, "last_edit_date": 1497391726, "creation_date": 1497382180, "answer_id": 44530009, "question_id": 44511865, "link": "https://stackoverflow.com/questions/44511865/how-do-i-read-n-lines-in-a-file-with-haskell/44530009#44530009", "title": "How do I read N lines in a file with Haskell?", "body": "<p>The format of the input file looks a lot like the ones used in programming contests. Here is my standard setup for programming contests like that:</p>\n\n<pre><code>import Control.Monad\nimport Text.Printf\n\nmain :: IO ()\nmain = do\n    n &lt;- readLn\n    forM_ [1 .. n] $ \\i -&gt; do\n        printf \"Case %d: \" (i :: Int)\n        solve\n</code></pre>\n\n<p>An example of <code>solve</code> might be:</p>\n\n<pre><code>solve :: IO ()\nsolve = do\n    nums &lt;- map read . words &lt;$&gt; getLine\n    print (sum nums)\n</code></pre>\n"}], "owner": {"reputation": 347, "user_id": 2154913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72205296aa8593ae9e5237a6a1ba6fcd?s=128&d=identicon&r=PG", "display_name": "ErisoHV", "link": "https://stackoverflow.com/users/2154913/erisohv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 823, "favorite_count": 1, "accepted_answer_id": 44530009, "answer_count": 2, "score": 0, "last_activity_date": 1497391726, "creation_date": 1497324428, "last_edit_date": 1497357375, "question_id": 44511865, "link": "https://stackoverflow.com/questions/44511865/how-do-i-read-n-lines-in-a-file-with-haskell", "title": "How do I read N lines in a file with Haskell?", "body": "<p>I have a file in the form:</p>\n\n<pre><code>3\n1 2\n3 4\n5 7\n</code></pre>\n\n<p>Where the first line is the number of lines</p>\n\n<p>I know that:</p>\n\n<pre><code>getInt :: IO Int\ngetInt = readLn \n\nmain = do num &lt;- getInt\n          print (num)\n</code></pre>\n\n<p>Reads the first line.</p>\n\n<p>Next, I tried:</p>\n\n<pre><code>readInts :: IO [Int]\nreadInts = fmap (map read.words) getLine\n</code></pre>\n\n<p>For read a line and get a list: [a,b]. </p>\n\n<p>And I tried to use the above in a recursive loop</p>\n\n<pre><code>loop :: Int -&gt; IO()\nloop n = if 1 == n then do num &lt;- readInts \n                           print(num)\n        else loop (n-1)\n</code></pre>\n\n<p>I'm getting the first line only:</p>\n\n<pre><code>[5,3]\n</code></pre>\n\n<p>But I need to read the rest of lines, given N</p>\n"}, {"tags": ["haskell", "applicative"], "answers": [{"comments": [{"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1506286214, "post_id": 44511694, "comment_id": 79746709, "body": "Writing it as <code>\\a -&gt; wrapperOfA a $ pred a</code> makes the translation more clear, that <code>(&lt;*&gt;)</code> is function application threaded with environment <code>a</code>: <code>wrapperOfA &lt;*&gt; pred</code>"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 4, "last_activity_date": 1497322994, "creation_date": 1497322994, "answer_id": 44511694, "question_id": 44511359, "link": "https://stackoverflow.com/questions/44511359/example-of-functions-as-applicatives-in-foldmap-and-filter-for-foldables/44511694#44511694", "title": "Example of functions as applicatives, in foldMap and filter for foldables", "body": "<p>The <code>(&lt;*&gt;)</code> there uses the <a href=\"https://stackoverflow.com/q/11810889/2751851\"><code>Applicative</code> instance for functions</a>. In...</p>\n\n<pre><code>-- Writing it infix, for the sake of clarity. \nfilterF pred = foldMap (wrapperOfA &lt;*&gt; pred)\n</code></pre>\n\n<p>... <code>wrapperOfA</code> has type <code>a -&gt; (Bool -&gt; f a)</code>, and <code>pred</code> has type <code>a -&gt; Bool</code>. That being so, <code>wrapperOfA &lt;*&gt; pred</code> has type <code>a -&gt; f a</code>, as expected. If we substitute the implementation of <code>(&lt;*&gt;)</code> for functions (see the question linked to above for details), we get...</p>\n\n<pre><code>filterF pred = foldMap (\\a -&gt; wrapperOfA a (pred a))\n</code></pre>\n\n<p>... which makes it clear what is going on.</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1497465472, "post_id": 44527325, "comment_id": 76095104, "body": "I&#39;m not sure if I get your follow-up question. You can use <code>filterH</code> without specifying a concrete choice of <code>h</code> in the same way you can use <code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b</code> without specifying a concrete choice of <code>f</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1497465661, "post_id": 44527325, "comment_id": 76095198, "body": "(By the way, it&#39;s better not to add follow-up questions to answers. The usual thing to do is using comments for that; or, if the question drifts too far from the original topic, asking a new question.)"}], "tags": [], "owner": {"reputation": 89, "user_id": 3946502, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e7e3cebd731464354ae5bbd77692a46d?s=128&d=identicon&r=PG&f=1", "display_name": "dcl04", "link": "https://stackoverflow.com/users/3946502/dcl04"}, "is_accepted": true, "score": 0, "last_activity_date": 1497674408, "last_edit_date": 1497674408, "creation_date": 1497372627, "answer_id": 44527325, "question_id": 44511359, "link": "https://stackoverflow.com/questions/44511359/example-of-functions-as-applicatives-in-foldmap-and-filter-for-foldables/44527325#44527325", "title": "Example of functions as applicatives, in foldMap and filter for foldables", "body": "<p><code>&lt;*&gt;</code> uses the <a href=\"https://stackoverflow.com/a/11811057/3946502\">Applicative instance for functions</a></p>\n\n<pre><code> (&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>where <code>f</code> is a <code>(-&gt;) r</code> , namely a function from the <code>r</code> domain.</p>\n\n<p>Substituting, the first argument of <code>&lt;*&gt;</code>  becomes a <em>function from the <code>r</code> domain AND the <code>a</code> domain, then returning a <code>b</code></em> (a function of 2 arguments, since type r -> (a -> b) is equivalent to r -> a -> b), and the second argument becomes a <em>function from the <code>r</code> domain returning an <code>a</code></em>.</p>\n\n<p>To produce a <code>(-&gt;) r b</code>, we should apply the second-argument (a function) to the <code>r</code> parameter, and the resulting <code>a</code> is passed as a second argument to the thing in front of <code>&lt;*&gt;</code>. That is,</p>\n\n<pre><code>(&lt;*&gt;) wrapperOfA pred r = wrapperOfA r (pred r)\n</code></pre>\n\n<p>This leads me to a <strong>follow-up question/comment</strong> to bring the focus to <code>foldMap</code> and filterF which I now rename <code>filterH</code>. </p>\n\n<pre><code>    filterH :: (a -&gt; Bool) -&gt; t a -&gt; h a\n    foldMap :: (a -&gt; f a) -&gt; t a -&gt; f a\n    wrapperOfA &lt;*&gt; pred :: a -&gt; h a\n</code></pre>\n\n<p>where <code>h</code> is <em>any</em> applicative and monoid with corresponding pure and mempty but is as yet undefined. So I needed to request a return type eg <code>::[Int]</code> in order for it to compile&amp;evaluate. Can filterH be used without having to specify my own type <code>h</code>? Am I missing something in this solution?</p>\n\n<p>This is a question from the textbook \"haskell programming from first principles\", in the foldables section.</p>\n"}, {"tags": [], "owner": {"reputation": 6187, "user_id": 2834553, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/lRVAY.jpg?s=128&g=1", "display_name": "Kutyel", "link": "https://stackoverflow.com/users/2834553/kutyel"}, "is_accepted": false, "score": 0, "last_activity_date": 1568114452, "creation_date": 1568114452, "answer_id": 57869722, "question_id": 44511359, "link": "https://stackoverflow.com/questions/44511359/example-of-functions-as-applicatives-in-foldmap-and-filter-for-foldables/57869722#57869722", "title": "Example of functions as applicatives, in foldMap and filter for foldables", "body": "<p>Maybe you'll find easier this solution:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Conditional (select)\n\nfilterF :: (Applicative f, Foldable t, Monoid (f a)) =&gt; (a -&gt; Bool) -&gt; t a -&gt; f a\nfilterF f = foldMap (select f pure mempty)\n</code></pre>\n\n<p>Here, <code>select</code> is just a functional if-then-else, where you provide functions for the condition, the true case and the else case.</p>\n"}], "owner": {"reputation": 89, "user_id": 3946502, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e7e3cebd731464354ae5bbd77692a46d?s=128&d=identicon&r=PG&f=1", "display_name": "dcl04", "link": "https://stackoverflow.com/users/3946502/dcl04"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 393, "favorite_count": 1, "accepted_answer_id": 44527325, "answer_count": 3, "score": 1, "last_activity_date": 1568114452, "creation_date": 1497320352, "last_edit_date": 1497372960, "question_id": 44511359, "link": "https://stackoverflow.com/questions/44511359/example-of-functions-as-applicatives-in-foldmap-and-filter-for-foldables", "title": "Example of functions as applicatives, in foldMap and filter for foldables", "body": "<p>In the first hunk, <code>filterF</code> is implemented with <code>foldMap</code></p>\n\n<pre><code>import Data.List\n\npred :: a -&gt; Bool\npred = undefined\n\nwrapperOfA :: (Applicative f, Monoid (f a)) =&gt; a -&gt; Bool -&gt; f a \nwrapperOfA a condition = if condition then pure a else mempty\n\n-- foldMap :: (Foldable t, Monoid  f a) =&gt; (a -&gt; f a) -&gt; t a -&gt; f a\nfilterF :: (Applicative f, Foldable t, Monoid (f a)) =&gt; (a -&gt; Bool) -&gt; t a -&gt; f a \nfilterF pred = foldMap ((&lt;*&gt;) wrapperOfA  pred)\n</code></pre>\n\n\n\n<pre><code>filterF (&lt;3) [5,4,3,2,1] :: [Int]\n-- [2,1]\n</code></pre>\n\n<p>... which utilises some <code>Applicative</code>'s apply function, aka <code>&lt;*&gt;</code> typically infixed. Now, the type of <code>&lt;*&gt;</code> is:</p>\n\n<pre><code>:t (&lt;*&gt;)\n--(&lt;*&gt;) :: forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>But replacing it with a hole gives its type as </p>\n\n<pre><code>-- (a0 -&gt; Bool -&gt; f0 a0) -&gt; (a -&gt; Bool) -&gt; a -&gt; f a\n-- namely, from typechecking\nfilterF :: (Applicative f, Foldable t, Monoid (f a)) =&gt; (a -&gt; Bool) -&gt; t a -&gt; f a \nfilterF pred = foldMap (_ wrapperOfA pred)\n-- Found hole \u2018_\u2019 with type: (a0 -&gt; Bool -&gt; f0 a0) -&gt; (a -&gt; Bool) -&gt; a -&gt; f a\n-- Where: \u2018a\u2019 is a rigid type variable bound by the type signature for interactive:IHaskell136.filterF :: (Applicative f, Foldable t, Monoid (f a)) =&gt; (a -&gt; Bool) -&gt; t a -&gt; f a at :1:12\n--       \u2018f\u2019 is a rigid type variable bound by the type signature for interactive:IHaskell136.filterF :: (Applicative f, Foldable t, Monoid (f a)) =&gt; (a -&gt; Bool) -&gt; t a -&gt; f a at :1:12\n--       \u2018a0\u2019 is an ambiguous type variable\n--       \u2018f0\u2019 is an ambiguous type variable\n-- Relevant bindings include\n--   pred :: a -&gt; Bool (bound at :2:9)\n--   filterF :: (a -&gt; Bool) -&gt; t a -&gt; f a (bound at :2:1)\n-- In the expression: _\n-- In the first argument of \u2018foldMap\u2019, namely \u2018(_ wrapperOfA pred)\u2019\n-- In the expression: foldMap (_ wrapperOfA pred)\n</code></pre>\n\n<p>Basically, <code>wrapperOfA</code> does not look like <code>f (a -&gt; b)</code> as <code>&lt;*&gt;</code> would imply, nor does <code>pred</code> look like type <code>f a</code>. Yet it works and type checks - why? </p>\n"}, {"tags": ["haskell", "hoogle"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1497307005, "post_id": 44509682, "comment_id": 76012528, "body": "Here&#39;s the <a href=\"https://github.com/ndmitchell/hoogle/blob/master/README.md#scope\" rel=\"nofollow noreferrer\">Hoogle documentation</a> on how to do it."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1497307230, "post_id": 44509682, "comment_id": 76012590, "body": "Thanks, just found that!"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497545238, "post_id": 44509682, "comment_id": 76134379, "body": "You can also use stackage which allows you to search within the package from that particular packages&#39;s index page."}], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 0, "last_activity_date": 1498050778, "creation_date": 1498050778, "answer_id": 44677187, "question_id": 44509682, "link": "https://stackoverflow.com/questions/44509682/how-do-i-limit-my-search-to-a-particular-package-or-module-with-hoogle/44677187#44677187", "title": "How do I limit my search to a particular package or module with Hoogle?", "body": "<p>From <a href=\"https://wiki.haskell.org/Hoogle#Searches\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Hoogle#Searches</a>: </p>\n\n<blockquote>\n  <p>Packages: Searches can be restricted to a particular package with\n  +packagename, or to avoid a package with -package. By default Hoogle will search a standard set of packages.</p>\n</blockquote>\n\n<p>Example: <code>get +scotty</code></p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1498050778, "creation_date": 1497306747, "question_id": 44509682, "link": "https://stackoverflow.com/questions/44509682/how-do-i-limit-my-search-to-a-particular-package-or-module-with-hoogle", "title": "How do I limit my search to a particular package or module with Hoogle?", "body": "<p>I remember reading that you can limit your search query to a particular module or package. But I can't seem to find anything on Google.</p>\n"}, {"tags": ["haskell", "clojure", "hindley-milner"], "answers": [{"comments": [{"owner": {"reputation": 958, "user_id": 2041696, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/ZxyCX.jpg?s=128&g=1", "display_name": "grandinero", "link": "https://stackoverflow.com/users/2041696/grandinero"}, "edited": false, "score": 0, "creation_date": 1497305771, "post_id": 44509298, "comment_id": 76012192, "body": "You pointed me in the right direction. The problem was in how I was handling the free type variables in the environment. Thanks!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1497304424, "creation_date": 1497304424, "answer_id": 44509298, "question_id": 44509154, "link": "https://stackoverflow.com/questions/44509154/let-inference-in-hindley-milner/44509298#44509298", "title": "`Let` inference in Hindley-Milner", "body": "<p>It's hard to tell what's wrong, but I'd guess your let-generalization is wrong.</p>\n\n<p>Let's type the term manually.</p>\n\n<pre><code>\\a -&gt; let b = a in b + 1\n</code></pre>\n\n<p>First, we associate <code>a</code> with a fresh type variable, say <code>a :: t0</code>.</p>\n\n<p>Then we type <code>b = a</code>. We get <code>b :: t0</code> as well.</p>\n\n<p>However, and this is the key point, we should <em>not</em> generalize the type of <code>b</code> to <code>b :: forall t0. t0</code>. This is because we can only generalize over a tyvar which does not occur in the environment: here, instead, we do have <code>t0</code> in the environment since <code>a :: t0</code> is there.</p>\n\n<p>If you do generalize it, you will get a way too general type for <code>b</code>. then <code>b+1</code> becomes <code>b+1 :: forall t0. Num t0 =&gt; t0</code>, and the whole term gets <code>forall t0 t1. Num t1 =&gt; t0 -&gt; t1</code> since the types for <code>a</code> and <code>b</code> are unrelated (<code>t0</code>, once generalized, can be alpha-converted to <code>t1</code>).</p>\n"}], "owner": {"reputation": 958, "user_id": 2041696, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/ZxyCX.jpg?s=128&g=1", "display_name": "grandinero", "link": "https://stackoverflow.com/users/2041696/grandinero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 419, "favorite_count": 0, "accepted_answer_id": 44509298, "answer_count": 1, "score": 1, "last_activity_date": 1497306758, "creation_date": 1497303718, "last_edit_date": 1497306758, "question_id": 44509154, "link": "https://stackoverflow.com/questions/44509154/let-inference-in-hindley-milner", "title": "`Let` inference in Hindley-Milner", "body": "<p>I am trying to teach myself Hindley-Milner type inference by implementing Algorithm W in the language I usually use, Clojure. I am running into an issue with <code>let</code> inference, and I'm not sure if I'm doing something wrong, or if the result I'm expecting requires something outside of the algorithm.</p>\n\n<p>Basically, using Haskell notation, if I try to infer the type of this:</p>\n\n<pre><code>\\a -&gt; let b = a in b + 1\n</code></pre>\n\n<p>I get this:</p>\n\n<pre><code>Num a =&gt; t -&gt; a\n</code></pre>\n\n<p>But I should get this:</p>\n\n<pre><code>Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>Again, I'm actually doing this in Clojure, but I don't believe the problem is Clojure-specific, so I'm using Haskell notation to make it clearer.  When I do try it in Haskell, I get the expected result.</p>\n\n<p>Anyway, I can solve that particular problem by converting every <code>let</code> into a function application, for example:</p>\n\n<pre><code> \\a -&gt; (\\b -&gt; b + 1) a\n</code></pre>\n\n<p>But then I lose <code>let</code> polymorphism.  Since I don't have any prior knowledge of HM, my question is whether I am missing something here, or if this is just the way the algorithm works.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>In case anyone has a similar issue and wonders how I solved it, I was following <a href=\"https://github.com/wh5a/Algorithm-W-Step-By-Step/blob/master/AlgorithmW.pdf\" rel=\"nofollow noreferrer\">Algorith W Step By Step</a>.  At the bottom of Page 2, it says \"It will occasionally be useful to extend the <em>Types</em> methods to lists.\" Since it didn't sound mandatory to me, I decided to skip that part and revisit it later.</p>\n\n<p>I then translated the <code>ftv</code> function for <code>TypeEnv</code> directly into Clojure as follows: <code>(ftv (vals env))</code>. Since I had implemented <code>ftv</code> as a <code>cond</code> form and didn't have a clause for <code>seq</code>s, it simply returned <code>nil</code> for <code>(vals env)</code>.  This of course is exactly the kind of bug that a static type system is designed to catch!  Anyway, I just redefined the clause in <code>ftv</code> pertaining to the <code>env</code> map as <code>(reduce set/union #{} (map ftv (vals env)))</code> and it works.</p>\n"}, {"tags": ["haskell", "command-line-arguments", "stdin"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1497303832, "post_id": 44505728, "comment_id": 76011546, "body": "I&#39;ve never used <code>interact</code> before. Why is it a requirement?"}, {"owner": {"reputation": 5679, "user_id": 1878788, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fc54887ecbaba35e17251129e5b78c9a?s=128&d=identicon&r=PG", "display_name": "bli", "link": "https://stackoverflow.com/users/1878788/bli"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1497334894, "post_id": 44505728, "comment_id": 76019944, "body": "Using <code>interact</code> is not a requirement, it&#39;s just what I happened to have learned so far, and being able to extend my program with minimal modifications (in this case, still using <code>interact</code>) would be convenient."}], "answers": [{"tags": [], "owner": {"reputation": 5679, "user_id": 1878788, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fc54887ecbaba35e17251129e5b78c9a?s=128&d=identicon&r=PG", "display_name": "bli", "link": "https://stackoverflow.com/users/1878788/bli"}, "is_accepted": false, "score": 4, "last_activity_date": 1497289723, "creation_date": 1497289723, "answer_id": 44505729, "question_id": 44505728, "link": "https://stackoverflow.com/questions/44505728/how-to-read-stdin-in-a-haskell-program-with-command-line-arguments/44505729#44505729", "title": "How to read stdin in a Haskell program with command-line arguments?", "body": "<p>This can be done by \"sequencing\" IO computations with <code>do</code> and use <code>getArgs</code> before using <code>interact</code>:</p>\n\n<pre><code>import System.Environment (getArgs)\nmain :: IO ()\nmain = do\n    args &lt;- getArgs\n    interact (&lt;whatever using args&gt;)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": true, "score": 2, "last_activity_date": 1497368875, "creation_date": 1497368875, "answer_id": 44526167, "question_id": 44505728, "link": "https://stackoverflow.com/questions/44505728/how-to-read-stdin-in-a-haskell-program-with-command-line-arguments/44526167#44526167", "title": "How to read stdin in a Haskell program with command-line arguments?", "body": "<p>In most programs, <code>interact</code> is quickly replaced with the alternative of using <code>getContents</code> and <code>putStr</code>. This is because <code>interact</code> is very limiting in that you can only call a single function, and that single function must consume all of the input. As the complexity of the program rises, you will eventually want to break up the program into smaller functions that handle a piece of the input at a time, and the <code>do</code> notation makes sequencing these functions much easier.</p>\n\n<p>So to mimic <code>interact</code> but also use command-line arguments, you might initially do this:</p>\n\n<pre><code>import System.Environment\n\ndoStuff :: [String] -&gt; String -&gt; String\ndoStuff args input = undefined -- your code here\n\nmain :: IO ()\nmain = do\n    args &lt;- getArgs\n    contents &lt;- getContents\n    putStr (doStuff args contents)\n</code></pre>\n\n<p>Which, by the way, is the same as:</p>\n\n<pre><code>main = doStuff &lt;$&gt; getArgs &lt;*&gt; getContents &gt;&gt;= putStr\n</code></pre>\n\n<p>But later you may wish to add things like prompts, parsers, or file I/O:</p>\n\n<pre><code>import System.Environment\n\ndata Arg = Taco | Boring\n\nparseArg :: String -&gt; Arg\nparseArg arg = if arg == \"taco\" then Taco else Boring\n\ndoStuff :: Arg -&gt; String -&gt; String\ndoStuff Taco   input = \"Yum, tacos! \" ++ input\ndoStuff Boring input = \"Meh, \" ++ input\n\nmain :: IO ()\nmain = do\n    [arg] &lt;- map parseArg &lt;$&gt; getArgs\n    putStr \"Enter the file name: \"\n    fileName &lt;- getLine\n    fileContents &lt;- readFile fileName\n    writeFile (\"output-\" ++ fileName) (doStuff arg fileContents)\n</code></pre>\n"}], "owner": {"reputation": 5679, "user_id": 1878788, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fc54887ecbaba35e17251129e5b78c9a?s=128&d=identicon&r=PG", "display_name": "bli", "link": "https://stackoverflow.com/users/1878788/bli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1396, "favorite_count": 4, "accepted_answer_id": 44526167, "answer_count": 2, "score": 2, "last_activity_date": 1497368875, "creation_date": 1497289723, "last_edit_date": 1497335229, "question_id": 44505728, "link": "https://stackoverflow.com/questions/44505728/how-to-read-stdin-in-a-haskell-program-with-command-line-arguments", "title": "How to read stdin in a Haskell program with command-line arguments?", "body": "<p>I know I can use <code>interact :: (String -&gt; String) -&gt; IO ()</code> to conveniently read from stdin and write to stdout in a simple Haskell program (see <a href=\"http://learnyouahaskell.com/input-and-output\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/input-and-output</a>).</p>\n\n<p>Now I would like to add command-line arguments to make my simple program \"configurable\".</p>\n\n<p>Is there a way to do this and still use <code>interact</code> (so as to obtain a configurable program with minimum effort)?</p>\n"}, {"tags": ["haskell", "quickcheck"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 8150013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb07430f9115dad8d0bc76266b13864b?s=128&d=identicon&r=PG&f=1", "display_name": "89 Juan", "link": "https://stackoverflow.com/users/8150013/89-juan"}, "edited": false, "score": 0, "creation_date": 1497290628, "post_id": 44505655, "comment_id": 76005204, "body": "I have this error &quot;Ambiguous occurrence &#39;choose&#39;&quot; because we have a &#39;choose&#39; definition on probability.hs and we need it."}, {"owner": {"reputation": 3, "user_id": 8150013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb07430f9115dad8d0bc76266b13864b?s=128&d=identicon&r=PG&f=1", "display_name": "89 Juan", "link": "https://stackoverflow.com/users/8150013/89-juan"}, "edited": false, "score": 0, "creation_date": 1497291515, "post_id": 44505655, "comment_id": 76005681, "body": "And it request &quot;No instance for (Show BetweenOneAndTwo)&quot;"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3, "user_id": 8150013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb07430f9115dad8d0bc76266b13864b?s=128&d=identicon&r=PG&f=1", "display_name": "89 Juan", "link": "https://stackoverflow.com/users/8150013/89-juan"}, "edited": false, "score": 0, "creation_date": 1497292889, "post_id": 44505655, "comment_id": 76006385, "body": "@FilipeNunes You can use qualified imports to differentiate between the two <code>choose</code>s, and you can add <code>deriving Show</code> at the end of the newtype declaration to get an auto-generated <code>Show</code> instance. I&#39;ve updated the answer showing how to do these two things."}, {"owner": {"reputation": 3, "user_id": 8150013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb07430f9115dad8d0bc76266b13864b?s=128&d=identicon&r=PG&f=1", "display_name": "89 Juan", "link": "https://stackoverflow.com/users/8150013/89-juan"}, "edited": false, "score": 0, "creation_date": 1497293746, "post_id": 44505655, "comment_id": 76006869, "body": "Still have this:   *Main&gt; quickCheck prop_inv *** Failed! Falsifiable (after 2 tests and 1 shrink): BOAT 1.8863573 NonNegative {getNonNegative = 0}"}, {"owner": {"reputation": 3, "user_id": 8150013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb07430f9115dad8d0bc76266b13864b?s=128&d=identicon&r=PG&f=1", "display_name": "89 Juan", "link": "https://stackoverflow.com/users/8150013/89-juan"}, "edited": false, "score": 0, "creation_date": 1497294709, "post_id": 44505655, "comment_id": 76007371, "body": "It&#39;s possible to evaluate only some decimal place in float in expression  inv x (n+100) == 1/x ?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 3, "user_id": 8150013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb07430f9115dad8d0bc76266b13864b?s=128&d=identicon&r=PG&f=1", "display_name": "89 Juan", "link": "https://stackoverflow.com/users/8150013/89-juan"}, "edited": false, "score": 0, "creation_date": 1497296116, "post_id": 44505655, "comment_id": 76008088, "body": "@FilipeNunes, this is a whole different question.  Yes, but it&#39;s not built-in -- you have to program it using math tricks."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1497292875, "last_edit_date": 1497292875, "creation_date": 1497289448, "answer_id": 44505655, "question_id": 44505347, "link": "https://stackoverflow.com/questions/44505347/gave-up-quickcheck/44505655#44505655", "title": "&quot;Gave up&quot; - QuickCheck", "body": "<p>The usual way is to make a small newtype that only generates values in the desired range. For example:</p>\n\n<pre><code>newtype BetweenOneAndTwo = BOAT Float deriving Show\ninstance Arbitrary BetweenOneAndTwo where\n    arbitrary = BOAT &lt;$&gt; Test.QuickCheck.choose (1, 2)\n\nprop_inv (BOAT x) (NonNegative n) = inv x (n+100) == 1/x\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 8150013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb07430f9115dad8d0bc76266b13864b?s=128&d=identicon&r=PG&f=1", "display_name": "89 Juan", "link": "https://stackoverflow.com/users/8150013/89-juan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 0, "accepted_answer_id": 44505655, "answer_count": 1, "score": 0, "last_activity_date": 1497292875, "creation_date": 1497288378, "last_edit_date": 1497288547, "question_id": 44505347, "link": "https://stackoverflow.com/questions/44505347/gave-up-quickcheck", "title": "&quot;Gave up&quot; - QuickCheck", "body": "<p>I want use quickcheck in a function that tests if a Maclaurin series is equal to <code>1/x</code>, for <code>x&gt;1</code> and <code>x&lt;2</code>. However, for small values of n, quickcheck returns false tests. Additionally, if I put <code>n&gt;100</code> restriction, for example, quickcheck returns:</p>\n\n<blockquote>\n  <p>\"Gave up! Passed only 0 tests.\". </p>\n</blockquote>\n\n<p>Here's my code:</p>\n\n<pre><code>prop_inv :: Float -&gt; Int -&gt; Property\nprop_inv x n = (x&gt;1 &amp;&amp; x&lt;2) &amp;&amp; n&gt;100 ==&gt; inv x n == 1/x\n</code></pre>\n\n<p>(<code>inv x n</code> is the function that calculates the Maclaurin series.)</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1497285739, "post_id": 44504534, "comment_id": 76002648, "body": "Are you sure you can&#39;t use <code>unfoldr</code>? Or something else also? All of the fold functions need some list (or <code>Foldable</code>) as input to fold over..."}, {"owner": {"reputation": 277, "user_id": 380252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f0999e58687b0d2153c594616ceafc5c?s=128&d=identicon&r=PG", "display_name": "blue scorpion", "link": "https://stackoverflow.com/users/380252/blue-scorpion"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1497286022, "post_id": 44504534, "comment_id": 76002825, "body": "Alec, I was not familiar with unfold*. I think probably, that&#39;s the way to go (and what the problem requirement actually meant). Thank you."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1497287248, "post_id": 44504534, "comment_id": 76003487, "body": "You can get the digits backwards pretty easily with <code>list_digits = unfoldr (\\i -&gt; if i == 0 then Nothing else let (q,r) = quotRem i 10 in Just (r,q))</code>."}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 1, "last_activity_date": 1497317160, "creation_date": 1497317160, "answer_id": 44510989, "question_id": 44504534, "link": "https://stackoverflow.com/questions/44504534/using-fold-to-grow-a-list-in-haskell/44510989#44510989", "title": "Using fold* to grow a list in Haskell", "body": "<p>Is this a homework assignment? It's pretty strange for the assignment to require you to use <code>foldr</code>, because this is a natural use for <code>unfoldr</code>, not <code>foldr</code>. <code>unfoldr :: (b -&gt; Maybe (a, b)) -&gt; b -&gt; [a]</code> <em>builds</em> a list, whereas <code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b</code> <em>consumes</em> a list. An implementation of this function using <code>foldr</code> would be horribly contorted.</p>\n\n<pre><code>listDigits :: Int -&gt; [Int]\nlistDigits = unfoldr digRem\n    where digRem x\n              | x &lt;= 0 = Nothing\n              | otherwise = Just (x `mod` 10, x `div` 10)\n</code></pre>\n\n<p>In the language of imperative programming, this is basically a <code>while</code> loop. Each iteration of the loop appends <code>x `mod` 10</code> to the output list and passes <code>x `div` 10</code> to the next iteration. In, say, Python, this'd be written as</p>\n\n<pre><code>def list_digits(x):\n    output = []\n    while x &gt; 0:\n        output.append(x % 10)\n        x = x // 10\n    return output\n</code></pre>\n\n<p>But <code>unfoldr</code> allows us to express the loop at a much higher level. <code>unfoldr</code> captures the pattern of \"building a list one item at a time\" and makes it explicit. You don't have to think through the sequential behaviour of the loop and realise that the list is being built one element at a time, as you do with the Python code; you just have to know what <code>unfoldr</code> does. Granted, programming with folds and unfolds takes a little getting used to, but it's worth it for the greater expressiveness.</p>\n\n<p>If your assignment is marked by machine and it really does require you to type the word <code>foldr</code> into your program text, (you should ask your teacher why they did that and) you can play a sneaky trick with the following \"<code>id<sub>[]</sub></code>-as-<code>foldr</code>\" function:</p>\n\n<pre><code>obfuscatedId = foldr (:) []\nlistDigits = obfuscatedId . unfoldr digRem\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 0, "last_activity_date": 1497452716, "creation_date": 1497452716, "answer_id": 44548434, "question_id": 44504534, "link": "https://stackoverflow.com/questions/44504534/using-fold-to-grow-a-list-in-haskell/44548434#44548434", "title": "Using fold* to grow a list in Haskell", "body": "<p>Though <code>unfoldr</code> is probably what the assignment meant, you can write this using <code>foldr</code> if you use <code>foldr</code> as a <em>hylomorphism</em>, that is, building up one list while it tears another down.</p>\n\n<pre><code>digits :: Int -&gt; [Int]\ndigits n = snd $ foldr go (n, []) places where\n  places = replicate num_digits ()\n  num_digits | n &gt; 0     = 1 + floor (logBase 10 $ fromIntegral n)\n             | otherwise = 0\n  go () (n, ds) = let (q,r) = n `quotRem` 10 in (q, r : ds)\n</code></pre>\n\n<p>Effectively, what we're doing here is using <code>foldr</code> as \"map-with-state\". We know ahead of time\nhow many digits we need to output (using log10) just not what those digits are, so we use\nunit (<code>()</code>) values as stand-ins for those digits.</p>\n\n<p>If your teacher's a stickler for just having a <code>foldr</code> at the top-level, you can get\naway with making <code>go</code> partial:</p>\n\n<pre><code>digits' :: Int -&gt; [Int]\ndigits' n = foldr go [n] places where\n  places = replicate num_digits ()\n  num_digits | n &gt; 0     = floor (logBase 10 $ fromIntegral n)\n             | otherwise = 0\n  go () (n:ds) = let (q,r) = n `quotRem` 10 in (q:r:ds)\n</code></pre>\n\n<p>This has slightly different behaviour on non-positive numbers:</p>\n\n<pre><code>&gt;&gt;&gt; digits 1234567890\n[1,2,3,4,5,6,7,8,9,0]\n&gt;&gt;&gt; digits' 1234567890\n[1,2,3,4,5,6,7,8,9,0]\n&gt;&gt;&gt; digits 0\n[]\n&gt;&gt;&gt; digits' 0\n[0]\n&gt;&gt;&gt; digits (negate 1234567890)\n[]\n&gt;&gt;&gt; digits' (negate 1234567890)\n[-1234567890]\n</code></pre>\n"}], "owner": {"reputation": 277, "user_id": 380252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f0999e58687b0d2153c594616ceafc5c?s=128&d=identicon&r=PG", "display_name": "blue scorpion", "link": "https://stackoverflow.com/users/380252/blue-scorpion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 615, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1497452716, "creation_date": 1497285543, "question_id": 44504534, "link": "https://stackoverflow.com/questions/44504534/using-fold-to-grow-a-list-in-haskell", "title": "Using fold* to grow a list in Haskell", "body": "<p>I'm trying to solve the following problem in Haskell: given an integer return the list of its digits. The constraint is I have to only use one of the fold* functions (* = {r,l,1,l1}).</p>\n\n<p>Without such constraint, the code is simple:</p>\n\n<pre><code>list_digits :: Int -&gt; [Int]\nlist_digits 0 = []\nlist_digits n = list_digits r ++ [n-10*r] \n                where\n                     r = div n 10\n</code></pre>\n\n<p>But how do I use fold* to, essentially grow a list of digits from an empty list?</p>\n\n<p>Thanks in advance. </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1816, "user_id": 6041389, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh3.googleusercontent.com/-kVVs5_frHmc/AAAAAAAAAAI/AAAAAAAAABM/SMcp3aPNlEY/photo.jpg?sz=128", "display_name": "csandreas1", "link": "https://stackoverflow.com/users/6041389/csandreas1"}, "edited": false, "score": 0, "creation_date": 1497285375, "post_id": 44503756, "comment_id": 76002452, "body": "i didn&#39;t understand your first point, why should we skip the second one and add the first ?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 1816, "user_id": 6041389, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh3.googleusercontent.com/-kVVs5_frHmc/AAAAAAAAAAI/AAAAAAAAABM/SMcp3aPNlEY/photo.jpg?sz=128", "display_name": "csandreas1", "link": "https://stackoverflow.com/users/6041389/csandreas1"}, "edited": false, "score": 0, "creation_date": 1497291941, "post_id": 44503756, "comment_id": 76005901, "body": "@csandreas1 It&#39;s basically popping off 2 elements of the list at once, and keeping one of them. If you want the even indexed ones you keep the first, and if you want odd indexed you take the second (and the single element case also ignores the element). The <code>_</code> basically means ignore this element - since we&#39;re not naming it, we can&#39;t use it."}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 1, "last_activity_date": 1497282916, "creation_date": 1497282916, "answer_id": 44503756, "question_id": 44503539, "link": "https://stackoverflow.com/questions/44503539/haskell-function-list-find-even-indexes-and-add-them-code-explanation/44503756#44503756", "title": "Haskell function list (find even indexes and add them) ~ Code explanation", "body": "<p><code>sum2</code> looks like it sums all the <em>values</em> that are even. <code>x</code> is the \"current\" value (head of the list), and <code>xs</code> is the rest. If <code>mod x 2 == 0</code> (even), then add <code>x</code> to the sum of the rest of the list, otherwise skip it and sum the rest of the list.</p>\n\n<p><code>sum2'</code> chooses elements based on position rather than value.</p>\n\n<ol>\n<li>The last case, if there are <em>at least two</em> elements in the list, skip the second one and add the first one to the sum of the rest.</li>\n<li>If there is <em>exactly one</em>, that's the sum.</li>\n<li>If there are <em>zero</em>, the sum is 0.</li>\n</ol>\n\n<p>So it is dropping every second element, summing the first, third, fifth, etc. (index 0, 2, 4, etc.).</p>\n"}], "owner": {"reputation": 1816, "user_id": 6041389, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh3.googleusercontent.com/-kVVs5_frHmc/AAAAAAAAAAI/AAAAAAAAABM/SMcp3aPNlEY/photo.jpg?sz=128", "display_name": "csandreas1", "link": "https://stackoverflow.com/users/6041389/csandreas1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 730, "favorite_count": 0, "accepted_answer_id": 44503756, "answer_count": 1, "score": 0, "last_activity_date": 1497282916, "creation_date": 1497282222, "last_edit_date": 1497282893, "question_id": 44503539, "link": "https://stackoverflow.com/questions/44503539/haskell-function-list-find-even-indexes-and-add-them-code-explanation", "title": "Haskell function list (find even indexes and add them) ~ Code explanation", "body": "<p>The below code is a  function sum2 which as an\nargument takes a list of numbers and returns the sum of elements of even\nindexes. Can anyone explain how this code works? What are x and Xs and how does this find the even numbers and add them ?</p>\n\n<pre><code>sum2 :: [Integer] -&gt; Integer\nsum2 [] = 0\nsum2 (x:xs) | mod x 2 == 0 = x + sum2 xs\n            | otherwise = sum2 xs\n\nsum2' :: [Integer] -&gt; Integer\nsum2' [] = 0\nsum2' [x] = x\nsum2' (x:_:xs) = x + sum2' xs\n</code></pre>\n\n<p>so if you hit in the console sum2 [2,3,3,4,0,6] it will add only the even numbers and the result will be: 12</p>\n"}, {"tags": ["haskell", "lambda", "ghc"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1497281667, "post_id": 44503272, "comment_id": 76000295, "body": "In this case, no: the function is only being called once. Since Haskell is lazy,  it evaluates only by need. It is likely that the two computations returned in the tuple from <code>somefunction</code> are more or less independent so that when even after <code>a</code> has been evaluated (and <code>integer</code> printed) there is still work to do to evaluate <code>b</code>."}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1497281885, "post_id": 44503272, "comment_id": 76000451, "body": "@Alec The computation for <code>b</code> <i>requires</i> <code>a</code> to be computed, although the computation for <code>a</code> does not require <code>b</code> to be computed.  Is there some way I could force haskell to calculate them both at once?"}, {"owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1497281911, "post_id": 44503272, "comment_id": 76000466, "body": "what @Alec meant is that suppose <code>somefunction</code> is defined like this <code>somefunction args = (somefastfunction args,someslowfunction args)</code>, then <code>show a</code> evaluates <code>somefastfunction</code> which is fast but <code>show b</code> evaluates <code>someslowfunction</code> which is slow, yes friend lazy evaluation can be tricky"}, {"owner": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "edited": false, "score": 0, "creation_date": 1497282035, "post_id": 44503272, "comment_id": 76000556, "body": "if <code>b</code> requires <code>a</code> then <code>a</code> will be evaluated once then <code>b</code> will continue evaluation using the already evaluated <code>a</code>, can you show us actual code because without it we can only give you guesses"}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "reply_to_user": {"reputation": 2334, "user_id": 2397162, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/665b976c79d0c9c842b131a2df510c3c?s=128&d=identicon&r=PG", "display_name": "niceman", "link": "https://stackoverflow.com/users/2397162/niceman"}, "edited": false, "score": 0, "creation_date": 1497282647, "post_id": 44503272, "comment_id": 76000973, "body": "@niceman I&#39;ve added the definition now if it helps.  Thanks"}], "answers": [{"comments": [{"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1497282899, "post_id": 44503529, "comment_id": 76001128, "body": "Thanks for the answer! I&#39;ve added <code>somefunction</code> to my question above.  I don&#39;t believe that what you are suggesting is what is going on, but its still a possibility."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 1, "creation_date": 1497328291, "post_id": 44503529, "comment_id": 76017449, "body": "@EpsilonNeighborhoodWatch The problem (which luqui highlighted) is essentially the same \u2013 note that the solution still involves <code>seq</code>.  It&#39;s not literally two functions, but it&#39;s the same split between calculating one and the other."}], "tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": false, "score": 3, "last_activity_date": 1497282202, "creation_date": 1497282202, "answer_id": 44503529, "question_id": 44503272, "link": "https://stackoverflow.com/questions/44503272/why-is-my-function-outputting-different-parts-of-its-result-at-different-times/44503529#44503529", "title": "Why is my function outputting different parts of its result at different times?", "body": "<p>It's hard to say exactly what's going on without seeing <code>somefunction</code>, but in general, GHC\u00b9 is not going to duplicate work like that.  However, since Haskell is lazy, as soon as it has done enough work to generate the start of the string, it will print out <em>that portion</em> of the string.  So if you have</p>\n\n<pre><code>slow1 :: Args -&gt; String\nslow2 :: Args -&gt; Int\n\nsomefunction :: Args -&gt; (String, Int)\nsomefunction args = (slow1 args, slow2 args)\n</code></pre>\n\n<p>Then GHC will start by forcing just <code>slow1 args</code>, print that out, print out <code>\"\\ninteger: \"</code>, and <em>then</em> force <code>slow2 args</code>, <code>show</code> it, and print it out.  (And then print the trailing <code>\"\\n\"</code>.)</p>\n\n<p>You can test this as follows:</p>\n\n<pre><code>main :: IO ()\nmain =\n  let (a,b) = somefunction args\n  in putStr $ a `seq` b `seq` (a ++ \"\\ninteger: \" ++ show b ++ \"\\n\")\n</code></pre>\n\n<p>Here, <code>x `seq` y</code> is equal to <code>y</code>, but forcing <code>y</code> will force <em>both</em> <code>x</code> and <code>y</code> before evaluating to <code>y</code>.  This means that <code>a `seq` b `seq` ...</code> will ensure that <code>a</code> and <code>b</code> are fully computed before the string containing them is returned.</p>\n\n<p>This code using <code>seq</code> should print out everything all at once \u2013 but it'll probably wait just as long as your old code did, just all up front instead of in between printing <code>a</code> and <code>show b</code>.</p>\n\n<hr>\n\n<p>\u00b9 The Haskell Report doesn't specify that sort of detail about evaluation, so I'll be speaking about what GHC in particular does in this answer \u2013 which is usually what people are looking for.</p>\n"}, {"comments": [{"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1497297775, "post_id": 44507779, "comment_id": 76008851, "body": "Ok this makes sense.  Would forcing <code>c</code> make things faster or even more memory efficient? or would it just cause them to output simultaneously?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 2, "creation_date": 1497297809, "post_id": 44507779, "comment_id": 76008864, "body": "@EpsilonNeighborhoodWatch yes it should improve everything. Needless thunk build up is not good for performance."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1497328245, "post_id": 44507779, "comment_id": 76017431, "body": "@EpsilonNeighborhoodWatch As an extra approach, you could also enable <code>BangPatterns</code> and adjust the patterns to <code>(x,y,z,!c)</code>, but I agree with luqui that a data type is the way to go."}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1497366356, "post_id": 44507779, "comment_id": 76042329, "body": "I implemented the data type solution as you had suggested and was surprised to find it made the entire process just over 3 times slower.  Perhaps I am doing something wrong but I think that I will go with Antal&#39;s suggestion of <code>BangPatterns</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1497380870, "post_id": 44507779, "comment_id": 76050997, "body": "@EpsilonNeighborhoodWatch, that should not definitely not happen.  If you still have that code may I look?"}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1497381247, "post_id": 44507779, "comment_id": 76051159, "body": "Sure, the code can be found <a href=\"https://github.com/Flakheads/BrainHack\" rel=\"nofollow noreferrer\">here</a> in its entirety.  I&#39;ve implemented the data type on the master branch and the hack on the <code>dev</code> branch.  There is an IO wrapper here, but the <code>Interpreter.hs</code> is a modified version of the code provided in the original question.  Thanks for your continued concern!"}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1497550025, "post_id": 44507779, "comment_id": 76137032, "body": "It turns out that when using compiler optimizations <code>O2</code> and <code>O3</code> the difference in timing disappears."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1497596545, "post_id": 44507779, "comment_id": 76153649, "body": "@EpsilonNeighborhoodWatch oh man.  I&#39;ve heard <code>-O2</code> is even too much, but I&#39;m interested in your results.  <code>-O3</code> doesn&#39;t mean &quot;make it faster&quot;, it means &quot;do riskier things which might make the code faster, but could also make it slower&quot;, and I&#39;ve heard <code>-O</code> is best.  Though I&#39;m not really a performance junkie so I have little real-world experience of this."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 2, "last_activity_date": 1497297602, "creation_date": 1497297602, "answer_id": 44507779, "question_id": 44503272, "link": "https://stackoverflow.com/questions/44503272/why-is-my-function-outputting-different-parts-of-its-result-at-different-times/44507779#44507779", "title": "Why is my function outputting different parts of its result at different times?", "body": "<p>Not a direct answer, but a bit more about what's going on here: It looks like your <code>c</code> parameter in <code>dbf</code> is not being forced, which means that it's building up as a big thunk like <code>1+(1+(1+(1+(1+(1+(...</code> and only actually doing the addition when you show it, which takes time if it's large.  The way through this is to make sure that <code>c</code> gets evaluated at each recursive step of <code>dbf</code>.</p>\n\n<p>With the way you have written it this could be a little awkward.  One way would be to add as the first equation of <code>dbf</code>:</p>\n\n<pre><code>dbf _ (_,_,_,c) | c `seq` False = undefined\n</code></pre>\n\n<p>which feels like a bit of a hack, but allows you to experiment without changing every line of your interpreter.</p>\n\n<p>In the long run I'd probably define a data type for the state instead of a tuple, and make it a <a href=\"https://www.vex.net/~trebla/haskell/strict-field.xhtml\" rel=\"nofollow noreferrer\">strict field</a>:</p>\n\n<pre><code>data InterpState = InterpState {\n    stack1 :: [Integer],\n    stack2 :: [Integer],\n    stack3 :: [Integer],\n    instrCount :: !Int\n  }\n</code></pre>\n"}], "owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 44507779, "answer_count": 2, "score": 0, "last_activity_date": 1497549985, "creation_date": 1497281421, "last_edit_date": 1497549985, "question_id": 44503272, "link": "https://stackoverflow.com/questions/44503272/why-is-my-function-outputting-different-parts-of-its-result-at-different-times", "title": "Why is my function outputting different parts of its result at different times?", "body": "<p>Currently I have a function that takes a good deal of time to run, lets call it <code>somefunction</code>.  <code>somefunction</code> returns a tuple, for simplicity lets say its <code>(String,Int)</code>.  I wanted to output the result of this function in a neat fashion, so I wrote the following code (not exactly this code, but for simplicity we'll say it is):</p>\n\n<pre><code>main :: IO ()\nmain = do\n putStr$ (\\ (a,b) -&gt; a ++ \"\\ninteger: \" ++ (show b) ++ \"\\n\" ) (somefunction args)\n</code></pre>\n\n<p>So I started my code.  After a while it printed the <code>a</code> part of the tuple, without the <code>b</code>.  After another long period of time it output the <code>b</code> portion.</p>\n\n<p>Why is there so much lag before the second part of the tuple is outputted?  What's going on here? </p>\n\n<hr>\n\n<p>In my case <code>somefunction</code> is the function <code>debugbrainflak</code> in the following code:</p>\n\n<pre><code>module Interpreter (debugbrainflak) where\n\npop :: (Integral a) =&gt; [a] -&gt; a\npop [] = 0\npop (x:_) = x\n\nrest :: (Integral a) =&gt; [a] -&gt; [a]\nrest [] = []\nrest (_:x) = x\n\ntopadd :: [Integer] -&gt; Integer -&gt; [Integer]\ntopadd [] x = [x]\ntopadd (a:[]) x = [a+x]\ntopadd (a:b) x = (a+x):b\n\nir :: [Char] -&gt; Integer -&gt; [Char]\nir x 0 = \"\"\nir ('{':x) y = \"{\" ++ (ir x (y+1))\nir ('}':x) y = \"}\" ++ (ir x (y-1))\nir (a:x)   y = [a] ++ (ir x   y  )\n\ninterior :: [Char] -&gt; [Char]\ninterior x = init (ir x 1)\n\nex :: [Char] -&gt; Integer -&gt; [Char]\nex x 0 = x\nex ('{':x) y = ex x (y+1)\nex ('}':x) y = ex x (y-1)\nex  (a:x)  y = ex x y\n\nexterior :: [Char] -&gt; [Char]\nexterior x = ex x 1\n\n---\n\ndbf :: [Char] -&gt; ([Integer],[Integer],[Integer],Int) -&gt; ([Integer],[Integer],[Integer],Int)\ndbf []          (x,y,z,c)= (x,y,z,c)\ndbf ('(':')':a) (x,y,z,c)= dbf a (x,y,((pop z+1):rest z),c+1)\ndbf ('&lt;':'&gt;':a) (x,y,z,c)= dbf a (y,x,z,c+1)\ndbf ('{':'}':a) (x,y,z,c)= dbf a ((rest x),y,(topadd z (pop x)),c+1)\ndbf ('[':']':a) (x,y,z,c)= dbf a (x,y,(topadd z (toInteger (length x))),c+1)\ndbf ('(':a)     (x,y,z,c)= dbf a (x,y,(0:z),c+1)\ndbf ('&lt;':a)     (x,y,z,c)= dbf a (x,y,(0:z),c+1)\ndbf ('[':a)     (x,y,z,c)= dbf a (x,y,(0:z),c+1)\ndbf (')':a) (x,y,(h:z),c)= dbf a ((h:x),y,(topadd z h),c+1)\ndbf (']':a) (x,y,(h:z),c)= dbf a (x,y,(topadd z (-h)),c+1)\ndbf ('&gt;':a) (x,y,(_:z),c)= dbf a (x,y,z,c+1)\ndbf ('{':a)      t     = dbf (exterior a) (drun (interior a) t)\ndbf (_:a)        t     = dbf a t\n\ndrun :: [Char] -&gt; ([Integer],[Integer],[Integer],Int) -&gt; ([Integer],[Integer],[Integer],Int)\ndrun s ([],y,z,c)  = ([],y,z,c)\ndrun s (0:x,y,z,c) = (0:x,y,z,c)\ndrun s x         = drun s (dbf s x)\n\n--\n\nbl :: [Char] -&gt; [Char] -&gt; Bool\nbl [] [] = True\nbl [] _  = False\nbl ('(':x) y   = bl x (')':y) \nbl ('[':x) y   = bl x (']':y) \nbl ('&lt;':x) y   = bl x ('&gt;':y) \nbl ('{':x) y   = bl x ('}':y) \nbl  (a:x) []\n | elem a \")]&gt;}\" = False\n | otherwise     = bl x []\nbl (a:x) (b:y)\n | elem a \")]&gt;}\" = (a == b) &amp;&amp; (bl x y)\n | otherwise     = bl x (b:y)\n\nbalanced :: [Char] -&gt; Bool\nbalanced x = bl x []\n\nclean :: [Char] -&gt; [Char]\nclean [] = []\nclean ('#':'{':xs) = clean (exterior xs)\nclean (x:xs)\n | elem x \"()[]&lt;&gt;{}\" = x:(clean xs)\n | otherwise         = clean xs\n\ndebugbrainflak :: [Char] -&gt; [Integer] -&gt; ([Integer], Int)\ndebugbrainflak s x\n | balanced s = (\\(a,_,_,d) -&gt; (a,d)) (dbf (clean s) (x,[],[],0))\n | otherwise  = error \"Unbalanced braces.\"\n</code></pre>\n\n<p>If you would like a test case that emulates the behavior you can try (you can change how long it takes by increasing or decreasing the number):</p>\n\n<pre><code>debugbrainflak \"({({}[()])}{})\" [999999]\n</code></pre>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1497279928, "post_id": 44502555, "comment_id": 75999094, "body": "The linked question asks about <code>Show</code> particularly, but for what you really want to know I believe this doesn&#39;t matter. A brief answer is: <i>no</i>, Haskell does by design not allow to check that a type is not an instance of some class, because there is no way to prove somebody won&#39;t add such an instance later on. IOW, the default assumption is <i>every type is an instance of <b>every</b> class</i>, though to actually <i>use</i> an instance the compiler obviously needs to know where it is defined."}, {"owner": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1497282619, "post_id": 44502555, "comment_id": 76000956, "body": "@leftaroundabout Ok thank you. I missed that one when searching."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1497312324, "post_id": 44502555, "comment_id": 76013837, "body": "It&#39;s not just that someone might add an insurance later on, but there might already be an instance that is used in other modules of the same program, and merely isn&#39;t <i>visible</i> (not imported) rather than didn&#39;t exist. Unless we require that every other module in the final program is available for inspection when compiling each module, the compiler can&#39;t tell that situation apart from the instance actually not existing. So any decisions it makes based on not being able to see an instance could be made inconsistently in different modules; to prevent that, it just never makes any such decisions."}, {"owner": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "edited": false, "score": 0, "creation_date": 1497347970, "post_id": 44502555, "comment_id": 76028422, "body": "If I add <code>instance {-# OVERLAPS #-} Eq a where x == y = False</code> I can just implement <code>equals</code> as a regular function. Which does exactly what I want (since I&#39;m trying to lower false negatives, not eliminate them). However that pretty much ruins <code>Eq</code> everywhere else, so it would be nice if I could somehow encapsulate this."}], "owner": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "closed_date": 1497279705, "answer_count": 0, "score": 0, "last_activity_date": 1497287965, "creation_date": 1497279429, "last_edit_date": 1497287965, "question_id": 44502555, "link": "https://stackoverflow.com/questions/44502555/can-the-absence-of-a-class-instance-be-used-somehow", "closed_reason": "Duplicate", "title": "Can the absence of a class instance be used somehow?", "body": "<p>I've been messing about with stable names for a bit and want a function that checks for equivalence on the value level if an <code>Eq</code>-instance exists, but also on identity in general by using <code>StableName</code>. The following bit of code shows what I want to do, but this doesn't work because even with incoherent instances the given instances are duplicates:</p>\n\n<pre><code>import System.Mem.StableName\n\nclass Same a where\n  equals :: a -&gt; a -&gt; IO Bool\n\ninstance Same a where\n  equals = equalsStable\n\ninstance Eq a =&gt; Same a where\n  equals = do\n    b &lt;- equalsStable x y\n    return (x == y || b)\n\nequalsStable :: a -&gt; a -&gt; IO Bool\nequalsStable x y = do\n  n1 &lt;- makeStableName x\n  n2 &lt;- makeStableName y\n  return (n1 == n2)\n</code></pre>\n\n<p>Is there a way to specifically select on non-instances of a class? Or is there some other way to make this code work?</p>\n"}, {"tags": ["haskell", "monads", "maybe"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1497257697, "post_id": 44495169, "comment_id": 75983710, "body": "Does <code>Just &lt;$&gt; renames rule</code> work?"}, {"owner": {"reputation": 930, "user_id": 402141, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/CnMAG.png?s=128&g=1", "display_name": "David", "link": "https://stackoverflow.com/users/402141/david"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1497257771, "post_id": 44495169, "comment_id": 75983760, "body": "Well, it does :). How could I have missed <code>&lt;$&gt;</code>? Thanks, @Ryan! If you go through the trouble of posting that as an answer, I&#39;ll be happy to accept it."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 2, "creation_date": 1497265108, "post_id": 44495169, "comment_id": 75988456, "body": "You might want to change the definition of <code>Subst</code> to <code>type Subst = [(Term, Term)]</code> and then use <code>Maybe Subst</code> on the operations that can fail to produce a substitution, now that you\u2019ve discovered a case where <code>Subst</code> doesn\u2019t need the <code>Maybe</code> wrapper."}], "answers": [{"tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": true, "score": 5, "last_activity_date": 1497258253, "creation_date": 1497258253, "answer_id": 44495433, "question_id": 44495169, "link": "https://stackoverflow.com/questions/44495169/wrap-state-result-in-a-just/44495433#44495433", "title": "Wrap State result in a Just", "body": "<p>You can use <code>Just &lt;$&gt; renames rule</code>, where the <code>&lt;$&gt;</code> operation is <a href=\"https://en.wikibooks.org/wiki/Haskell/The_Functor_class\" rel=\"noreferrer\"><code>fmap</code></a>.</p>\n\n\n"}], "owner": {"reputation": 930, "user_id": 402141, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/CnMAG.png?s=128&g=1", "display_name": "David", "link": "https://stackoverflow.com/users/402141/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 44495433, "answer_count": 1, "score": 0, "last_activity_date": 1497258253, "creation_date": 1497257560, "question_id": 44495169, "link": "https://stackoverflow.com/questions/44495169/wrap-state-result-in-a-just", "title": "Wrap State result in a Just", "body": "<p>I have a Haskell function in my Prolog interpreter assignment that reads</p>\n\n<pre><code>renames :: Rule -&gt; State ExecState [(Term, Term)]\n</code></pre>\n\n<p>which produces (almost) a substitution of variables in a Prolog rule (so that variable names don't clash during unification).</p>\n\n<p>The pairs produced by this function are of the form <code>(Variable \"X\", Variable \"X_11\")</code>, meaning that the variable <em>X</em> should be renamed to <em>X_11</em>, etc. (the counter for the renames is contained within <code>ExecState</code>).</p>\n\n<p>The problem is that I've defined a substitution to be</p>\n\n<pre><code>type Subst = Maybe [(Term, Term)]\n</code></pre>\n\n<p>and that makes sense, because sometimes a substitution cannot be found which unifies two terms. (But the substitution to rename variables is always found.)</p>\n\n<p>I have tried</p>\n\n<pre><code>renames' :: Rule -&gt; State ExecState Subst\nrenames' rule = Just $ renames rule\n</code></pre>\n\n<p>but that won't work, obviously, because I wrap the <code>State</code> in the <code>Just</code>, not the computation result.</p>\n\n<p>How do I wrap the actual <code>[(Term, Term)]</code> result in the <code>Just</code>? And is there a name to what I am trying to do?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["performance", "haskell", "memory", "optimization"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497256462, "post_id": 44494694, "comment_id": 75982954, "body": "What functionalities of a <code>Vector</code> do you need?"}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497256545, "post_id": 44494694, "comment_id": 75982993, "body": "@WillemVanOnsem The standard Haskell List primitives (i.e. map, fold, filter, etc.) I also use <code>V.generate</code> to read all the samples form a file."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1497258126, "post_id": 44494694, "comment_id": 75983959, "body": "The C++ standard library includes <a href=\"http://en.cppreference.com/w/cpp/container/vector_bool\" rel=\"nofollow noreferrer\">a template specialisation for <code>bool</code></a> that uses the full content of the bytes for space efficiency... but this is <a href=\"https://isocpp.org/blog/2012/11/on-vectorbool\" rel=\"nofollow noreferrer\">widely considered a bad idea now</a>. Performance tends to be substantially <i>worse</i> for such vectors, because element accesses can not be performed directly with pointer arithmetic anymore. \u2014 If you want to efficiently represent only the sign of a continuous signal, you should consider storing only the <i>spots where the sign changes</i>."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1497258398, "post_id": 44494694, "comment_id": 75984140, "body": "@leftaroundabout I already first read all samples from the file and convert them to <code>Bool</code> values. Then I convert this <code>Vector</code> to a <code>Vector</code> of the spots where the sign changes. But at that point, I&#39;ve already stored the full <code>Vector</code> so I don&#39;t think it will give me an advantage. I don&#39;t know of a way to directly load the spots where the sign changes from a file. But I could think about that a little more carefully."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1497258530, "post_id": 44494694, "comment_id": 75984220, "body": "@leftaroundabout Also, for some applications I require to know where the sign changes from positive to negative, for other applications I require the opposite and for other applications I require to know both. That would mean that I have to save where the sign changes + the type of change. I curious as to how efficient that is."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1497262379, "post_id": 44494694, "comment_id": 75986714, "body": "Well, if you first need to read float values from a file there won&#39;t be much else you can usefully do to improve performance. To reduce <i>memory</i>, you can side-step the PCM vector entirely and deserialise the sign-changes information straight from a lazy bytestring (<a href=\"http://hackage.haskell.org/package/binary\" rel=\"nofollow noreferrer\"><code>binary</code></a> makes this easy); this will only require 1-2 <i>chunks</i> in memory at a time."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1497278500, "post_id": 44494694, "comment_id": 75998091, "body": "If you want <i>performance</i>, I think an <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector-Unboxed.html\" rel=\"nofollow noreferrer\">unboxed vector</a> of <code>Bool</code> is the way to go. The runtime representation has no pointers at all, and stores one boolean per word."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1497289993, "post_id": 44494694, "comment_id": 76004909, "body": "It&#39;s not totally clear to me what you&#39;re asking. You claim to want &quot;map, fold, filter, etc.&quot; which don&#39;t sound particularly useful for an abstract array of booleans."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1497335112, "post_id": 44494694, "comment_id": 76020049, "body": "@jberryman Yes, you&#39;re right. My mistake. I use these primitives when I work with <code>Float</code> values but I forgot that I never use them when working with <code>Bool</code> values. I just need to be able to iterate over the collection. I need things like the n-th intersection with the x-axis, average/max/min number of samples between intersections, etc."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1497366019, "post_id": 44494694, "comment_id": 76042074, "body": "@ThomasVanhelden How about an unboxed Vector Word32/64, with each word representing the length of the span? Even indexes and odd indexes respectively will have the same sign (I believe). n-th intersection is just <code>!</code>. And those aggregates could be maintained as you consume samples, but otherwise would just be <code>Vector.max</code> etc."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1497366240, "post_id": 44494694, "comment_id": 76042247, "body": "@jberryman That sounds like it could work! I will give it a try!"}], "answers": [{"comments": [{"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1497514175, "post_id": 44532261, "comment_id": 76113137, "body": "Thanks for the answer! I find it really interesting! Correct me if I&#39;m wrong but <code>Vector</code> is faster and <code>Array</code> is more memory-efficient for my problem?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1497531998, "post_id": 44532261, "comment_id": 76125172, "body": "Well, <code>Array</code> is certainly likely to be be much more memory-efficient than <code>Vector</code>, but as to the speed, that might depend a lot on the specific algorithm.  I think benchmarking will be the only way to answer that."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1497391041, "creation_date": 1497391041, "answer_id": 44532261, "question_id": 44494694, "link": "https://stackoverflow.com/questions/44494694/represent-of-a-collection-of-binary-data/44532261#44532261", "title": "Represent of a collection of binary data", "body": "<p>Both one-bool-per-byte and one-bool-per-bit options are available from the <code>vector</code> and <code>array</code> packages respectively.</p>\n\n<p>First, a <code>Vector Bool</code> from <code>Data.Vector.Unboxed</code> uses a byte array with one byte per <code>Bool</code>.  This can be verified from the source in module <code>Data.Vector.Unboxed.Base</code> where <code>Vector Bool</code> is defined as:</p>\n\n<pre><code>newtype instance Vector    Bool = V_Bool  (P.Vector    Word8)\n</code></pre>\n\n<p>and getting and setting are mediated through the functions:</p>\n\n<pre><code>fromBool :: Bool -&gt; Word8\ntoBool :: Word8 -&gt; Bool\n</code></pre>\n\n<p>Alternatively, it can be verified directly by profiling the program:</p>\n\n<pre><code>import Data.Vector.Unboxed as V\nmain = let v = V.replicate 1000000000 True\n  in print (v ! 5)\n</code></pre>\n\n<p>and observing that it allocates just over 1,000,000,000 bytes.</p>\n\n<p>Second, a <code>UArray Int Bool</code> from <code>Data.Array.Unboxed</code> is implemented as a bit vector, with one <code>Bool</code> per bit.  The relevant source is in <code>Data.Array.Base</code>, where you can see the bit manipulation used in the instance:</p>\n\n<pre><code>instance IArray UArray Bool where\n    ...\n    unsafeAt (UArray _ _ _ arr#) (I# i#) = isTrue#\n        ((indexWordArray# arr# (bOOL_INDEX i#) `and#` bOOL_BIT i#)\n        `neWord#` int2Word# 0#)\n</code></pre>\n\n<p>Again, this can be verified directly by profiling:</p>\n\n<pre><code>import Data.Array.Unboxed as A\nmain = let v = A.listArray (1,1000000000) (repeat True) :: UArray Int Bool\n  in print (v ! 5)\n</code></pre>\n\n<p>and verifying that it allocates approximately 125,000,000 bytes.</p>\n"}], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 44532261, "answer_count": 1, "score": 0, "last_activity_date": 1497391041, "creation_date": 1497255972, "question_id": 44494694, "link": "https://stackoverflow.com/questions/44494694/represent-of-a-collection-of-binary-data", "title": "Represent of a collection of binary data", "body": "<p>I'm working with signals in which the samples consist of <code>Float</code>s. Some of the algorithms I've written only require to know when the signal crosses the x-axis (i.e. positive value to a negative value and vice versa). When I'm doing these kinds of operations, I realized that I don't need to know the actual <code>Float</code> value of each sample. I just need to know whether the sample's value is positive or not. </p>\n\n<p>I originally represented the signal as a <code>Vector</code> of <code>Float</code>s. After my discovery, I started representing it as a <code>Vector</code> of <code>Boolean</code> values (i.e. <code>False</code> for a negative value and <code>True</code> for a positive value). This turned out to be a lot more efficient and I improved the program's performance both in terms of run-time and memory consumption. </p>\n\n<p>I'm still wondering if there isn't a more efficient way of representing this \"collection of binary data\". Something like a <code>Bit Vector</code> or <code>Bit Array</code>. I've found a <a href=\"https://hackage.haskell.org/package/bitarray-0.0.1.1/docs/Data-BitArray.html\" rel=\"nofollow noreferrer\">BitArray</a> on Hackage but it doesn't seem to support the same functionality that a <code>Vector</code> does.</p>\n\n<p>Is there a more efficient way of representing the data of my use case or should I stick to a <code>Vector</code> of <code>Boolean</code> values?  </p>\n"}, {"tags": ["haskell", "exception", "undefined", "lazy-evaluation"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1497265321, "post_id": 44494558, "comment_id": 75988603, "body": "Note that those two expressions aren\u2019t the same. Assuming <code>u = undefined</code> for brevity: <code>[u, u, u]</code> is <code>[u] ++ [u] ++ [u]</code>, not <code>[u] ++ u ++ [u]</code>. In your first example you have an undefined <i>list</i>, while in your second example you only have undefined <i>elements</i>, so <code>length</code> works fine."}], "answers": [{"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1497257084, "post_id": 44494688, "comment_id": 75983316, "body": "I can not imagine, how <code>++</code> work. Can you please expand for example <code>[1,2,3] ++ [3,4,5]</code>"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1497257505, "last_edit_date": 1497257505, "creation_date": 1497255957, "answer_id": 44494688, "question_id": 44494558, "link": "https://stackoverflow.com/questions/44494558/list-concatenation-with-exception/44494688#44494688", "title": "List concatenation with exception", "body": "<p>If you write:</p>\n\n<pre><code>let x = [1] ++ undefined ++ [3]\n</code></pre>\n\n<p>then <strong><code>x</code> is not evaluated</strong>. It is stored as an expression that has to be evaluated. But then you query <code>x</code>. In other words, you want to <strong><code>show x</code></strong>. Now <strong>in order to show a list, the entire list (and its elements) have to be evaluated</strong>.</p>\n\n<p>Now the concat operator <code>(++) :: [a] -&gt; [a] -&gt; [a]</code> is defined as:</p>\n\n<pre><code>(++) :: [a] -&gt; [a] -&gt; [a]\n(++) (x:xs) ys = x : xs ++ ys\n(++) [] ys = ys\n</code></pre>\n\n<p>For example <code>[1,2] ++ [3,4]</code>: will result in:</p>\n\n<pre><code>   [1,2] ++ [3,4]\n-&gt; 1 : ([2] ++ [3,4])\n-&gt; 1 : 2 : ([] ++ [3,4])\n-&gt; 1 : 2 : [3,4]\n</code></pre>\n\n<p>or when working with <code>undefined</code>:</p>\n\n<pre><code>   [1,2] ++ undefined\n-&gt; 1 : ([2] ++ undefined)\n-&gt; 1 : 2 : ([] ++ undefined)\n-&gt; 1 : 2 : undefined\n</code></pre>\n\n<p>Note that this is done <em>lazily</em>: you only concat further if you need more elements. Furthermore <code>(++)</code> does <em>not</em> care about the individual elements: if an element contains a computationally expensive operation, that operation is postponed until it is necessary to calculate it.</p>\n\n<p>So as long as the first list can still emit elements, we do not care about the second list. When the end of the first list is reached, we simply return the second list.</p>\n\n<p>We see that this partially works: the interpreter prints <code><b>[1</b>&#42;&#42;&#42; Exception: Prelude.undefined</code> so in the evaluation of the <code>(++)</code> operator, the <strong>first element of <code>[1]</code> is emitted</strong>, evaluated and printed. But then we reach <code>undefined</code> and Haskell cannot handle it in order to print it (its elements) and terminates.</p>\n\n<p>If you write <code>let x = [undefined,undefined,undefined]</code> on the other hand and you call <code>length x</code>, then <strong>the <em>elements</em> of the list are not evaluated</strong>. <code>length</code> is defined like:</p>\n\n<pre><code>length :: [a] -&gt; Int\nlength [] = 0\nlength (_:xs) = 1 + length xs\n</code></pre>\n\n<p>mind the underscore (<code>_</code>) in the function. <code>length</code> does not care about the individual elements. It will simply walk through the list until it hits the empty list <code>[]</code>, and return that count, so <code>3</code>.</p>\n\n<p>If on the other hand you would have written</p>\n\n<pre><code>length $ [1] ++ undefined ++ [2,3]\n</code></pre>\n\n<p>you would get the same problems:</p>\n\n<pre><code>Prelude&gt; length $ [1] ++ undefined ++ [2,3]\n*** Exception: Prelude.undefined\n</code></pre>\n\n<p>Because in order to walk through the list, we have to concat <code>[1]</code> with <code>undefined</code>.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 44494688, "answer_count": 1, "score": 2, "last_activity_date": 1497257505, "creation_date": 1497255464, "last_edit_date": 1497256281, "question_id": 44494558, "link": "https://stackoverflow.com/questions/44494558/list-concatenation-with-exception", "title": "List concatenation with exception", "body": "<p>I have following expression:</p>\n\n<pre><code>let x = [1] ++ undefined ++ [3]\n</code></pre>\n\n<p>I 've got following exception:</p>\n\n<pre><code>[1*** Exception: Prelude.undefined\nCallStack (from HasCallStack):\n  error, called at libraries\\base\\GHC\\Err.hs:79:14 in base:GHC.Err\n  undefined, called at &lt;interactive&gt;:39:16 in interactive:Ghci20\n</code></pre>\n\n<p>As the counterpart to the expression above: </p>\n\n<pre><code>Prelude&gt; let x = [undefined, undefined, undefined ]\nPrelude&gt; length x\n</code></pre>\n\n<p>Here, I've got as the result <code>3</code> not an exception, because values does not got evaluated until it got called. </p>\n\n<p>Why the earlier expression raised an exception?  </p>\n"}, {"tags": ["haskell", "generics"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1497260284, "post_id": 44494286, "comment_id": 75985347, "body": "What problem are you trying to solve? It&#39;s likely that an existing tool, like aeson, does what you want to do."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1497261562, "post_id": 44494286, "comment_id": 75986199, "body": "Aeson doesn&#39;t really solve <i>everything</i> that I want to do with generic functions. Although, I agree that this particular example does seem like something that can be done with Aeson. One basic problem with Aeson is that its data structures represent what is possible with a JSON (nested key-value pairs, arrays, etc), and one might not want all of that."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497266045, "post_id": 44494286, "comment_id": 75989057, "body": "There is no way to make <code>gFromMap</code> total. It will either produce an error or you must change the return type to e.g. <code>Maybe a</code>. If you want a total <code>gFromMap</code>, you will have to use a dependently typed language (faking it in Haskell here gives you nothing). This is probably the source of your runtime errors. (In any case, if you have code which almost works but produces errors, you should post that code instead of asking people to re-write it for you)"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497266411, "post_id": 44494286, "comment_id": 75989283, "body": "@user2407038 having a <code>Maybe a</code> is also fine. Changed the question, and also added the half-written deserialisation code in in EOT."}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497268615, "post_id": 44498516, "comment_id": 75990747, "body": "<code>deserialize :: String -&gt; Either String a </code> is required only for other data types like Int/Bool, etc, right? Otherwise there&#39;s no practical case why deserialisation of a String to a String would fail."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497268678, "post_id": 44498516, "comment_id": 75990793, "body": "Exactly, that&#39;s why the <code>deserialize</code> implementation for <code>String</code> always succeeds; it&#39;s just <code>Right . id</code>, which I guess has the more canonical name <code>return</code>."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497268874, "post_id": 44498516, "comment_id": 75990937, "body": "<code>class GMapSerializable k f where</code> , so <code>k</code> is the <i>type of key</i> , which is <code>String</code> in this example, but can be something else in the future? What is <code>f</code> the record-type being (de)serialised?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497269211, "post_id": 44498516, "comment_id": 75991167, "body": "<code>k</code> is always either <code>String</code> - a <code>String</code> key is required, or it&#39;s polymorphic over all types, no specific key is required. By asking the compiler to instantiate it to <code>GMapSerializable ()</code> we check that there isn&#39;t a <code>K1</code> sitting outside of an <code>M1 S</code>. It can&#39;t be something else in the future, the type of keys being <code>String</code>s is coded into the signatures of <code>gFromMap</code> and <code>gToMap</code>."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497269316, "post_id": 44498516, "comment_id": 75991244, "body": "thanks for posting this solution <b>and</b> following-up on the comments. Unfortunately, I have more follow-up questions. Can I go-ahed and ask, or is this too much already?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497269429, "post_id": 44498516, "comment_id": 75991323, "body": "Yes, <code>f</code> is in-essence the record type being (de)serialized. GHC.Generics converts types <code>to</code> and <code>from</code> a generic representation that&#39;s either a unit <code>U1</code>, a value of type <code>a</code>, <code>K1 i a</code>, metadata wrapped around another representation <code>f</code>, <code>M1 i c f</code>, a product <code>f :*: g</code>, a sum <code>f :+: g</code>, or a composition <code>f :.: g</code>."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497269734, "post_id": 44498516, "comment_id": 75991521, "body": "<code>gToMap _ m@(M1 x) = gToMap (selName m) x</code> is easier to understand than the corresponding <code>gFromMap</code> BUT, if <code>M1 x</code> has the ability to give us the selector name AND the corresponding value of that selector, can we define the entire function here itself, instead of depending upon the instance of <code>K1 i a</code> -- for argument sake?"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497269832, "post_id": 44498516, "comment_id": 75991589, "body": "This is where everything goes for a toss in my understanding -- <code>gFromMap _ map = fixProxy $ \\proxy -&gt; M1 &lt;$&gt; gFromMap (selName proxy) map</code> HOW exactly does this function know which key is being deserialised? It&#39;s not being passed to it!"}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497270369, "post_id": 44498516, "comment_id": 75992014, "body": "I <i>think</i> I&#39;m building an intuition of what&#39;s going on here. Can this be rewritten and simplified using <code>ScopedTypeVariables</code>? <code>gFromMap _ map = fixProxy $ \\proxy -&gt; M1 &lt;$&gt; gFromMap (selName proxy) map</code>"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1497273746, "post_id": 44498516, "comment_id": 75994570, "body": "There&#39;s a pesky extra type argument to <code>M1</code> that scoped type variables don&#39;t capture, but it doesn&#39;t matter what it is so <code>ScopedTypeVariables</code> would do the job. It&#39;s roughly equivalent to <code>let m = M1 ... (selName m) ... in m</code>. It knows which key is being deserialized from the type. <code>M1 S c</code> is metadata for a selector, the metadata is available from the type <code>c</code>. Encountering the field <code>title</code> in <code>Post {title :: ...}</code> is the point at which we know that we&#39;re deserializing the data in the <code>&quot;title&quot;</code> key."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 5, "last_activity_date": 1497267963, "last_edit_date": 1497267963, "creation_date": 1497267532, "answer_id": 44498516, "question_id": 44494286, "link": "https://stackoverflow.com/questions/44494286/how-to-write-a-generic-function-that-can-serialise-deserialize-any-record-from-a/44498516#44498516", "title": "How to write a generic function that can serialise/deserialize any record from a map-like structure?", "body": "<p>Here's a solution with <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/GHC-Generics.html\" rel=\"nofollow noreferrer\">GHC.Generics</a> following the style of the <a href=\"https://wiki.haskell.org/GHC.Generics\" rel=\"nofollow noreferrer\">GHC.Generics tutorial</a></p>\n\n<h3>Prerequisites</h3>\n\n<p>To start with, we need a few prerequisites. <code>DefaultSignatures, DeriveGeneric, TypeOperators, FlexibleContexts</code> are normal requirements for <code>GHC.Generics</code>. This particular problem uses <code>MultiParamTypeClasses</code> for a trick to figure out which types can be reliably converted to dictionaries, as well as <code>FlexibleInstances</code> (which follows <code>FlexibleContexts</code> around) and <code>TypeSynonymInstances</code> (because I'm lazy and typed <code>String</code> a few places).</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, DefaultSignatures, TypeOperators, MultiParamTypeClasses, FlexibleContexts, FlexibleInstances, TypeSynonymInstances #-}\n\nimport qualified Data.Map as Map\nimport GHC.Generics\n</code></pre>\n\n<p>To keep myself sane I added a class for things that can be serialized to strings. For your example we only need to support <code>String</code>s, but I suspect you will rapidly encounter <code>Bool</code>s or <code>Int</code>s.</p>\n\n<p>Any time we're deserializing (which can usually fail) it's nice to keep track of errors, so we have some idea of why it failed.</p>\n\n<pre><code>class Serializable a where\n    serialize :: a -&gt; String\n    deserialize :: String -&gt; Either String a   \n\ninstance Serializable String where\n    serialize = id\n    deserialize = Right . id\n</code></pre>\n\n<h3>Generic Class</h3>\n\n<p>The <code>GMapSerializable k</code> class represents the class of generic representations that can be converted to and from maps. Converting from maps can fail. The extra <code>k</code> parameter denotes the type of key required for serialization/deserialization to work, and the current key is explicitly passes to both methods.</p>\n\n<pre><code>class GMapSerializable k f where\n    gFromMap :: k -&gt; Map.Map String String -&gt; Either String (f a)\n    gToMap :: k -&gt; f a -&gt; Map.Map String String\n</code></pre>\n\n<p>Instances will either use a <code>String</code> key if they need to know where to read or write a field or will by polymorphic over all keys.</p>\n\n<p>For convenience we also make a corresponding non-generic class. It uses <code>()</code> for the key to signify that no key data is provided yet.</p>\n\n<pre><code>class MapSerializable a where\n    fromMap :: Map.Map String String -&gt; Either String a\n    toMap :: a -&gt; Map.Map String String\n\n    default fromMap :: (Generic a, GMapSerializable () (Rep a)) =&gt; Map.Map String String -&gt; Either String a\n    fromMap map = to &lt;$&gt; gFromMap () map\n\n    default toMap :: (Generic a, GMapSerializable () (Rep a)) =&gt; a -&gt; Map.Map String String\n    toMap x = gToMap () (from x)\n</code></pre>\n\n<h3>Generic Instances</h3>\n\n<p>On to the instances. We'll start with a good one, <code>K1 a</code>, a value of type <code>a</code> held somewhere in the representation. In order to convert a value to or from a dictionary we'll need to know what key it should be stored in or read from. The <code>GMapSerializable String</code> instance requires that it be passed a <code>String</code> key.</p>\n\n<pre><code>instance Serializable a =&gt; GMapSerializable String (K1 i a) where\n    gFromMap key map = K1 &lt;$&gt; (lookupE key map &gt;&gt;= deserialize)\n    gToMap key (K1 x) = Map.singleton key (serialize x)\n\nlookupE :: (Ord k, Show k) =&gt; k -&gt; Map.Map k v -&gt; Either String v\nlookupE k = maybe (Left $ \"Key not found: \" ++ show k) (Right) . Map.lookup k\n</code></pre>\n\n<p>These keys will be provided when we encounter a metadata node for a selector, <code>M1 S</code> and the metadata <code>c</code> contains the selector name. <code>fixProxy</code> is a hack to get a correctly typed proxy for <code>selName</code> out of the <code>Either String</code> error monad. Usually you pass to <code>selName</code> the whole <code>M1</code> node that you happen to have around (or are building).</p>\n\n<pre><code>instance (Selector c, GMapSerializable String f) =&gt; GMapSerializable k (M1 S \nc f) where\n    gFromMap _ map = fixProxy $ \\proxy -&gt; M1 &lt;$&gt; gFromMap (selName proxy) map\n    gToMap _ m@(M1 x) = gToMap (selName m) x\n\nfixProxy :: (a -&gt; f a) -&gt; f a\nfixProxy f = f undefined\n</code></pre>\n\n<p>The remaining metadata nodes, <code>M1 D</code> for datatypes and <code>M1 C</code> for constructors, don't care what kind of keys they deal with.</p>\n\n<pre><code>instance GMapSerializable k f =&gt; GMapSerializable k (M1 D c f) where\n    gFromMap key map = M1 &lt;$&gt; gFromMap key map\n    gToMap key (M1 x) = gToMap key x\n\ninstance GMapSerializable k f =&gt; GMapSerializable k (M1 C c f) where\n    gFromMap key map = M1 &lt;$&gt; gFromMap key map\n    gToMap key (M1 x) = gToMap key x\n</code></pre>\n\n<p>Dictionaries represent products of many values, indexed by keys. We can provide a <code>GMapSerializable</code> instance for products of two values, <code>f :*: g</code>. When converting to a dictionary it converts each part to a dictionary and takes the union of the dictionaries for each part. When converting from a dictionary it builds each part reading from the same dictionary and then combines the parts into the product.</p>\n\n<pre><code>instance (GMapSerializable k f, GMapSerializable k g) =&gt; GMapSerializable k (f :*: g) where\n    gFromMap key map = (:*:) &lt;$&gt; gFromMap key map &lt;*&gt; gFromMap key map\n    gToMap key (a :*: b) = Map.union (gToMap key a) (gToMap key b)\n</code></pre>\n\n<p>We can also provide an instance for the unit, <code>U1</code>. It doesn't need to read anything from a dictionary - there's only one possible value. It similarly doesn't need to write anything to a dictionary; the <code>empty</code> dictionary suffices.</p>\n\n<pre><code>instance GMapSerializable k U1 where\n    gFromMap _ map = return U1\n    gToMap _ U1 = Map.empty\n</code></pre>\n\n<p>We notably won't be providing instances for composition or for sums. Composition would result in nested keys, which a single dictionary can't represent. Sums would require tags for which branch of the sum is taken; again something a single dictionary can't represent.</p>\n\n<h3>Example</h3>\n\n<p>Your example compiles and runs, with minor differences because I used a <code>Map</code> instead of a list of key-value pairs.</p>\n\n<p>The data types derive <code>Generic</code> instances, and are given <code>MapSerializable</code> instances with the <code>default</code> implementation.</p>\n\n<pre><code>data User = User {name :: String, email :: String}\n  deriving (Generic, Show)\ninstance MapSerializable User\n\ndata Post = Post {title :: String, body :: String}\n  deriving (Generic, Show)\ninstance MapSerializable Post\n\nmain = do\n    print (fromMap . Map.fromList $ [(\"name\", \"Saurabh\"), (\"email\", \"redacted@redacted.com\")] :: Either String User)\n    print (fromMap . Map.fromList $ [(\"title\", \"Will this work?\"), (\"body\", \"I hope it does!\")] :: Either String Post)\n\n    print . Map.toList . toMap $ User{name=\"Saurabh\", email=\"redacted@redacted.com\"} -- [(\"name\", \"Saurabh\"), (\"email\", \"redacted@redacted.com\")]\n    print . Map.toList . toMap $ Post{title=\"Will this work?\", body=\"I hope it does!\"}\n\n    print (fromMap . Map.fromList $ [(\"title\", \"Will this work?\"), (\"not-the-body\", \"I hope it doesn't!\")] :: Either String Post)\n</code></pre>\n\n<p><a href=\"http://rextester.com/VNE12754\" rel=\"nofollow noreferrer\">Running Example</a></p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "accepted_answer_id": 44498516, "answer_count": 1, "score": 4, "last_activity_date": 1497267963, "creation_date": 1497254548, "last_edit_date": 1497266474, "question_id": 44494286, "link": "https://stackoverflow.com/questions/44494286/how-to-write-a-generic-function-that-can-serialise-deserialize-any-record-from-a", "title": "How to write a generic function that can serialise/deserialize any record from a map-like structure?", "body": "<p>I've been struggling with this using every single Generics library available (EOT, SOP, Data/SYB, and GHC.Generics). I have half-written code samples with every library, which either don't compile, or throw runtime errors.</p>\n\n<p>The core question is this:</p>\n\n<pre><code>type FieldName = String\ntype FieldValue = String\ntype MapType = [(String, String)] -- can be an actual HashMap as well, but doesn't really matter\ndata User = User {name :: String, email :: String}\ndata Post = User {title :: String, body :: String}\n\ngFromMap :: MapType -&gt; Maybe a\ngToMap :: a -&gt; MapType\n\n-- the following should work\ngFromMap [(\"name\", \"Saurabh\"), (\"email\", \"redacted@redacted.com\")] :: User -- Just (User{..})\ngFromMap [(\"title\", \"Will this work?\"), (\"body\", \"I hope it does!\")] :: Post -- Just (Post{..})\n\ngToMap User{name=\"Saurabh\", email=\"redacted@redacted.com\"} -- [(\"name\", \"Saurabh\"), (\"email\", \"redacted@redacted.com\")]\ngToMap Post{title=\"Will this work?\", body=\"I hope it does!\"} -- [(\"title\", \"Will this work?\"), (\"body\", \"I hope it does!)]\n</code></pre>\n\n<p>Here is my half-written, non-compiling code, using <code>Generics.EOT</code>:</p>\n\n<pre><code>import Generics.Eot\nimport Data.String.Conv\nimport Data.Text\n\nnewtype HStoreList = HStoreList [(Text, Text)] deriving (Eq, Show, Generic)\n\nlookupHStore :: HStoreList -&gt; Text -&gt; Maybe Text\n\nclass FromHStoreList meta eot where\n  fromHStoreList :: meta -&gt; HS.HStoreList -&gt; eot\n\ninstance FromHStoreList Datatype (Either a Void) where\n  fromHStoreList dtype@Datatype{constructors=[Constructor{fields=(Selectors fields)}]} h = Left $ fromHStoreList fields h\n  fromHStoreList dtype@Datatype{constructors=[Constructor{fields=(NoSelectors _)}]} h = error $ \"Target data type doesn't seem to have any record selectors, which is not supported: \" ++ (show dtype)\n  fromHStoreList dtype@Datatype{constructors=[Constructor{fields=(NoFields)}]} h = error $ \"Target data type doesn't seem to have any fields, which is not supported: \" ++ (show dtype)\n  fromHStoreList dtype@Datatype{constructors=constr:_} h = error $ \"Multiple constructors found, which is not supported: \"  ++ (show $ constructors dtype)\n\n\ninstance FromHStoreList [String] () where\n  fromHStoreList _ _ = ()\n\ninstance (FromHStoreList [String] xs) =&gt; FromHStoreList [String] (Maybe Text, xs) where\n  fromHStoreList [] h = error \"shouldn't happen\"\n  fromHStoreList (f:fs) h = (HS.lookupHStore h (toS f), fromHStoreList fs h)\n</code></pre>\n\n<p>This gives the following compilation error:</p>\n\n<pre><code>   185  99 error           error:\n     \u2022 No instance for (FromHStoreList [String] a)\n         arising from a use of \u2018fromHStoreList\u2019\n     \u2022 In the second argument of \u2018($)\u2019, namely \u2018fromHStoreList fields h\u2019\n       In the expression: Left $ fromHStoreList fields h\n       In an equation for \u2018fromHStoreList\u2019:\n           fromHStoreList\n             dtype@(Datatype {constructors = [Constructor {fields = (Selectors fields)}]})\n             h\n             = Left $ fromHStoreList fields h (intero)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1497266179, "post_id": 44494156, "comment_id": 75989138, "body": "You&#39;ve answered your own questions: 1) because &quot;the expression [is] fully evaluated&quot;. 2) because &quot;the expression [is not] evaluate[d] as far as necessary to reach to a data constructor&quot;. Perhaps you should state what about these definitions is unclear to you."}], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1497300166, "post_id": 44496964, "comment_id": 76009975, "body": "Actually, normal form of a lambda term traditionally has meant evaluating as much as possible under the lambda. <code>\\x -&gt; (1 + 1) + x</code> is not in normal form, as it could be reduced to <code>\\x -&gt; 2 + x</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1498787010, "post_id": 44496964, "comment_id": 76655377, "body": "Isn&#39;t there a requirement for the data constructor in WHNF to be <i>lazy</i>?"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 6, "last_activity_date": 1497262561, "creation_date": 1497262561, "answer_id": 44496964, "question_id": 44494156, "link": "https://stackoverflow.com/questions/44494156/weak-head-normal-form-and-normal-form/44496964#44496964", "title": "Weak head normal form and normal form", "body": "<p>WHNF evaluates far enough to reach a data constructor <em>or lambda function</em>.</p>\n\n<p>If you have a lambda function that hasn't been called with an argument, you cannot evaluate it any further anyway. So a lambda function is in WHNF, and indeed NF, since there is nothing to evaluate further. Now, if you <em>call</em> the lambda function with an argument, we can evaluate what the result might be. But the lambda function on its own? Nothing further to be done.</p>\n\n<p>Your first expression is a lambda function with no arguments. It is therefor in normal form.</p>\n\n<p>Your second expression is neither a data constructor nor a lambda, hence is not in any normal form. Now, if you evaluate it for one step, you obtain</p>\n\n<pre><code>'P' : (\"apu\" ++ \"chon\")\n</code></pre>\n\n<p>Which (although the syntax doesn't look like it) begins with a data constructor (namely <code>(:)</code>), and hence <em>is</em> in WHNF, but <em>not</em> NF (since it still contains the unevaluated <code>(++)</code> subexpression).</p>\n\n<p>Perhaps it's easier if we get rid on the infix syntax:</p>\n\n<pre><code>(++) \"Papu\" \"chon\"\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>(:) 'P' ( (++) \"apu\" \"chon\" )\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1497262849, "post_id": 44496969, "comment_id": 75987013, "body": "About the lambda expression, what does it mean <code>simplify</code>?"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 1, "creation_date": 1497263299, "post_id": 44496969, "comment_id": 75987324, "body": "You can <code>simplify</code> some expression if it has subexpression which is <code>lambda application</code> and you can reduce it (apply it). Or more simpler, you can call function and get result. In your example, you can&#39;t calculate <code>x * 10</code>, because you don&#39;t known an <code>x</code> value."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1497269790, "post_id": 44496969, "comment_id": 75991557, "body": "@zero_coding For instance, <code>\\x -&gt; 5+5</code> and <code>\\x -&gt; id x</code> can be simplifed / reduced, so they are not NF. <code>\\x -&gt; x (id 5)</code> can also be reduced, since <code>id 5</code> can. Instead, <code>\\x -&gt; x 5</code> can not be reduced, since we do not know what <code>x</code> is, so the lambda is in NF. <code>\\x -&gt; x+x</code> is also a NF."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1497281279, "post_id": 44496969, "comment_id": 76000046, "body": "@chi and MathematicalOrchid: you have two different notions of NF (chi is happy to reduce under lambdas when MathematicalOrchid is not). This could be confusing for the reader."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1497281351, "post_id": 44496969, "comment_id": 76000095, "body": "@freestyle <code>\\x -&gt; 5+5</code> I can simplify/reduce to <code>\\x -&gt; 10</code> right?"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 1, "creation_date": 1497281733, "post_id": 44496969, "comment_id": 76000333, "body": "@zero_coding Yes, you can. More over, you must to do that for transform to NF."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 2, "creation_date": 1497282019, "post_id": 44496969, "comment_id": 76000539, "body": "@zero_coding But in Haskell is convention that WHNF equivalent to NF for functions. (see <code>instance NFData (a -&gt; b)</code>)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1497293337, "post_id": 44496969, "comment_id": 76006644, "body": "@gallais Good point. I guess it depends on the context. In some theories, reductions under lambdas are allowed. In most implementations of functional languages, however, we don&#39;t reduce under lambdas."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1498782089, "post_id": 44496969, "comment_id": 76654314, "body": "can <code>&#39;P&#39; : &quot;apuchon&quot;</code> be simplified? isn&#39;t it in WHNF though?"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1498809355, "post_id": 44496969, "comment_id": 76663062, "body": "@WillNess <code>&quot;apuchon&quot;</code> its just syntactic sugar, so <code>&#39;P&#39; : &quot;apuchon&quot;</code> ~ <code>&#39;P&#39;:&#39;a&#39;:&#39;p&#39;:&#39;u&#39;:&#39;c&#39;:&#39;h&#39;:&#39;o&#39;:&#39;n&#39;:[]</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1498818711, "post_id": 44496969, "comment_id": 76668800, "body": "that&#39;s an irrelevant (here) detail. so, can <code>&#39;P&#39; : (&quot;apu&quot; ++ &quot;chon&quot;)</code> be simplified? is it in WHNF?"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1498820846, "post_id": 44496969, "comment_id": 76670056, "body": "@WillNess It can be simplified (it isn&#39;t in NF) and it&#39;s in WHNF (top redex is construct application and it cant be reduced to something)."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 3, "last_activity_date": 1497262574, "creation_date": 1497262574, "answer_id": 44496969, "question_id": 44494156, "link": "https://stackoverflow.com/questions/44494156/weak-head-normal-form-and-normal-form/44496969#44496969", "title": "Weak head normal form and normal form", "body": "<blockquote>\n<pre><code>\\x -&gt; x * 10\n</code></pre>\n  \n  <p>Why the expression above is in normal form?</p>\n</blockquote>\n\n<p>Because, you can't simplify it.</p>\n\n<hr>\n\n<blockquote>\n<pre><code>\"Papu\" ++ \"chon\"\n</code></pre>\n  \n  <p>Why the expression above is in neither WHNF nor NF?</p>\n</blockquote>\n\n<p>First of all, if some expression in NF - that means it's in WHNF. NF it's more restricted version of WHNF.</p>\n\n<p>So, We can restructure your question.\n<strong>Why the expression above isn't in WHNF?</strong></p>\n\n<p>Simple answer is: We can simplify it to <code>\"Papuchon\"</code>.</p>\n\n<hr>\n\n<p>If you want to know what difference between WHNF and NF, you can read, for example, <a href=\"https://stackoverflow.com/questions/6872898/haskell-what-is-weak-head-normal-form\">this</a>.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 502, "favorite_count": 0, "accepted_answer_id": 44496964, "answer_count": 2, "score": 0, "last_activity_date": 1497262574, "creation_date": 1497254058, "question_id": 44494156, "link": "https://stackoverflow.com/questions/44494156/weak-head-normal-form-and-normal-form", "title": "Weak head normal form and normal form", "body": "<p>I have question about weak head normal form and normal form.</p>\n\n<p><strong>Weak head normal form means, the expression will only evaluate as far as necessary to reach to a data constructor.</strong></p>\n\n<p><strong>Normal form means, the expression will be fully evaluated.</strong></p>\n\n<p>Now, I have following expression:</p>\n\n<pre><code>\\x -&gt; x * 10\n</code></pre>\n\n<p>Why the expression above is in normal form?</p>\n\n<pre><code>\"Papu\" ++ \"chon\"\n</code></pre>\n\n<p>Why the expression above is in neither WHNF nor NF?</p>\n"}, {"tags": ["haskell", "scotty"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1497229226, "post_id": 44489963, "comment_id": 75974283, "body": "What have you tried, can you include some code, <a href=\"https://stackoverflow.com/help/mcve\">etc.</a>. Aside: you probably want <a href=\"https://hackage.haskell.org/package/wai-3.2.1.1/docs/Network-Wai.html#v:requestHeaderReferer\" rel=\"nofollow noreferrer\">this</a>, but that requires you to parse the header yourself."}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 1, "creation_date": 1497238539, "post_id": 44489963, "comment_id": 75976006, "body": "Can&#39;t you use the <code>header</code> function provided in <code>scotty</code> <a href=\"https://hackage.haskell.org/package/scotty-0.11.0/docs/Web-Scotty.html#v:header\" rel=\"nofollow noreferrer\">here</a>? E.g. <code>url &lt;- header &quot;referer&quot;</code>? Note that <code>url</code> will then be of type <code>Maybe Text</code>."}, {"owner": {"reputation": 455, "user_id": 5252811, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/25f4662cd8d11abc2110cad00a9e2b52?s=128&d=identicon&r=PG&f=1", "display_name": "x4rkz", "link": "https://stackoverflow.com/users/5252811/x4rkz"}, "edited": false, "score": 0, "creation_date": 1497262770, "post_id": 44489963, "comment_id": 75986968, "body": "Thank you, it was just that. I didn&#39;t know this information was in the header so I didn&#39;t look in that direction."}, {"owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "reply_to_user": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1497787477, "post_id": 44489963, "comment_id": 76215867, "body": "@liminalisht can you please write an actual answer, then it can be accepted get taken off the unanswered list"}], "answers": [{"tags": [], "owner": {"reputation": 455, "user_id": 5252811, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/25f4662cd8d11abc2110cad00a9e2b52?s=128&d=identicon&r=PG&f=1", "display_name": "x4rkz", "link": "https://stackoverflow.com/users/5252811/x4rkz"}, "is_accepted": true, "score": 1, "last_activity_date": 1497789304, "creation_date": 1497789304, "answer_id": 44615020, "question_id": 44489963, "link": "https://stackoverflow.com/questions/44489963/retrieve-the-http-referrer-url-using-scotty/44615020#44615020", "title": "Retrieve the HTTP referrer URL using Scotty", "body": "<p>The <code>http_referer</code> is stored in the HTTP header, which means that you can retrieve it using the header <code>function</code> of <code>scotty</code> like this:</p>\n\n<pre><code>url &lt;- header \"referer\"\n</code></pre>\n"}], "owner": {"reputation": 455, "user_id": 5252811, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/25f4662cd8d11abc2110cad00a9e2b52?s=128&d=identicon&r=PG&f=1", "display_name": "x4rkz", "link": "https://stackoverflow.com/users/5252811/x4rkz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 44615020, "answer_count": 1, "score": 0, "last_activity_date": 1603286573, "creation_date": 1497227807, "last_edit_date": 1603286573, "question_id": 44489963, "link": "https://stackoverflow.com/questions/44489963/retrieve-the-http-referrer-url-using-scotty", "title": "Retrieve the HTTP referrer URL using Scotty", "body": "<p><code>$_SERVER[HTTP_REFERER]</code> allows one to retrieve the referring URL in PHP, how to do the same in Haskell?</p>\n"}, {"tags": ["haskell", "yesod", "haskell-stack"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497231283, "post_id": 44489668, "comment_id": 75974652, "body": "I think this is a bug with either <code>foundation</code> or even GHC - I distinctly remember <code>yesod</code> and friends working on older versions of GHC (but now I can confirm that <code>foundation</code> produces this linker error on 8.0). Your best bet is probably to try an older version or to report the bug."}, {"owner": {"reputation": 661, "user_id": 7720738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HccZv.png?s=128&g=1", "display_name": "James Burton", "link": "https://stackoverflow.com/users/7720738/james-burton"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497231960, "post_id": 44489668, "comment_id": 75974774, "body": "@user2407038 Ok, do I just need to uninstall GHC and install version 8.0 or do I also need to add some version numbers somewhere in the commands from the quickstart guide?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497232295, "post_id": 44489668, "comment_id": 75974829, "body": "With stack, you specify this in your projects <a href=\"https://docs.haskellstack.org/en/v1.0.2/yaml_configuration/#resolver\" rel=\"nofollow noreferrer\"><code>stack.yaml</code> file</a>. (Note that ghc 8.0 is the version that <i>has</i> the error. You will want at most 7.10.3)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497232957, "post_id": 44489668, "comment_id": 75974973, "body": "Alternatively, add <code>memory-0.14.2</code> to your <code>stack.yaml</code> file. <a href=\"https://hackage.haskell.org/package/memory-0.14.3\" rel=\"nofollow noreferrer\">This</a> appears to be the (only) package which pulls in the broken <code>foundation</code> dependency - <code>yesod</code> does not depend on it directly. Also you probably need <code>stack install yesod-bin --ghc-options &quot;--constraint=memory&lt;0.14.3&quot;</code> as well as the setting in the <code>stack.yaml</code> file. This should allow you to use any GHC you want."}, {"owner": {"reputation": 661, "user_id": 7720738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HccZv.png?s=128&g=1", "display_name": "James Burton", "link": "https://stackoverflow.com/users/7720738/james-burton"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497233198, "post_id": 44489668, "comment_id": 75975012, "body": "@user2407038 ok thanks, I&#39;m currently trying ghc version 7.10.3."}, {"owner": {"reputation": 661, "user_id": 7720738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HccZv.png?s=128&g=1", "display_name": "James Burton", "link": "https://stackoverflow.com/users/7720738/james-burton"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497234203, "post_id": 44489668, "comment_id": 75975175, "body": "@user2407038 I tried both options you gave however I get loads of messages like this <a href=\"https://gyazo.com/213019decb3123f06690ad9acb475280\" rel=\"nofollow noreferrer\">gyazo.com/213019decb3123f06690ad9acb475280</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497246039, "post_id": 44489668, "comment_id": 75977846, "body": "Try checking out the <code>stack</code> documentation for any errors which come from <code>stack</code> itself - it is pretty well documented. (For that error, probably <code>stack solver</code> but a single line of an error is not much to go on)."}, {"owner": {"reputation": 661, "user_id": 7720738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HccZv.png?s=128&g=1", "display_name": "James Burton", "link": "https://stackoverflow.com/users/7720738/james-burton"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497278004, "post_id": 44489668, "comment_id": 75997748, "body": "@user2407038 the console kept telling me to add various dependencies to the stack.yaml file so I did, eventually I got down to just this error <code>Error: While constructing the build plan, the following exceptions were encounte red:  In the dependencies for cabal-install-1.24.0.2:     Cabal-1.22.5.0 must match &gt;=1.24.2 &amp;&amp; &lt;1.25 (latest applicable is 1.24.2.0)</code>"}, {"owner": {"reputation": 532, "user_id": 660339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ba401042a68ed65c16f73c8cf3a15287?s=128&d=identicon&r=PG", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/660339/ivan-perez"}, "edited": false, "score": 0, "creation_date": 1497432011, "post_id": 44489668, "comment_id": 76071711, "body": "Hi James! The following is contrary to what 99% of people will recommend. I personally avoid stack: there&#39;s too much magic going on behind the scenes for my taste, and when there&#39;s an error like that I get stuck. I think that should <i>never</i> happen, especially to a beginner. Just so that you can get started asap: with GHC 7.10.3 and cabal 1.24, just doing <code>cabal sandbox init</code> and then <code>cabal install yesod --reorder-goals</code> in a new directory works for me. I can compile the hello world in the &#39;Basics&#39; chapter with <code>cabal exec -- ghc Example.hs</code> and it runs fine."}], "owner": {"reputation": 661, "user_id": 7720738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HccZv.png?s=128&g=1", "display_name": "James Burton", "link": "https://stackoverflow.com/users/7720738/james-burton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 172, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1517004687, "creation_date": 1497223907, "last_edit_date": 1517004687, "question_id": 44489668, "link": "https://stackoverflow.com/questions/44489668/yesod-installation-unable-to-load-package-foundation-0-0-10", "title": "Yesod Installation unable to load package `foundation-0.0.10&#39;", "body": "<p>Trying to get Yesod set up on Windows 7. I have been following the guide here <a href=\"http://www.yesodweb.com/page/quickstart\" rel=\"nofollow noreferrer\">http://www.yesodweb.com/page/quickstart</a>. I skipped step 1 as I already have stack installed.</p>\n\n<p>After step 3 - \"Install the yesod command line tool: stack build yesod-bin cabal-install --install-ghc\" the console said a Process exited with code: ExitFailure 1.</p>\n\n<p>The log that it directed me to had the following contents:</p>\n\n<pre><code>Configuring yesod-bin-1.5.2.3...\nBuilding yesod-bin-1.5.2.3...\nPreprocessing executable 'yesod' for yesod-bin-1.5.2.3...\n[1 of 7] Compiling Paths_yesod_bin  ( .stack-work\\dist\\ca59d0ab\\build\\autogen\\Paths_yesod_bin.hs, .stack-work\\dist\\ca59d0ab\\build\\yesod\\yesod-tmp\\Paths_yesod_bin.o )\n[2 of 7] Compiling Options          ( Options.hs, .stack-work\\dist\\ca59d0ab\\build\\yesod\\yesod-tmp\\Options.o )\n[3 of 7] Compiling Keter            ( Keter.hs, .stack-work\\dist\\ca59d0ab\\build\\yesod\\yesod-tmp\\Keter.o )\n[4 of 7] Compiling HsFile           ( HsFile.hs, .stack-work\\dist\\ca59d0ab\\build\\yesod\\yesod-tmp\\HsFile.o )\n[5 of 7] Compiling Devel            ( Devel.hs, .stack-work\\dist\\ca59d0ab\\build\\yesod\\yesod-tmp\\Devel.o )\nghc.EXE: unable to load package `foundation-0.0.10'\nghc.EXE: C:\\sr\\snapshots\\f4677c28\\lib\\x86_64-windows-ghc-8.0.2\\foundation-0.0.10-JGhHXvcRrtp6mVId9fjHXB\\HSfoundation-0.0.10-JGhHXvcRrtp6mVId9fjHXB.o: unknown symbol `clock_gettime'\n</code></pre>\n\n<p>Thanks in advance :)</p>\n"}, {"tags": ["string", "list", "haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1497214842, "post_id": 44488637, "comment_id": 75971553, "body": "If you turn warnings on with <code>-Wall</code>, GHC warns about this at compile time, and points out the missing case to be matched. Recommended."}], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 6473325, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/83a984b18bddba398c7bea7cfc0e3305?s=128&d=identicon&r=PG&f=1", "display_name": "Amateur", "link": "https://stackoverflow.com/users/6473325/amateur"}, "edited": false, "score": 1, "creation_date": 1497214546, "post_id": 44488667, "comment_id": 75971479, "body": "Thanks Eric. I added format (a:[]) = a : [] and it worked!!"}, {"owner": {"reputation": 674, "user_id": 1893155, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jvtf4.jpg?s=128&g=1", "display_name": "Eric Fulmer", "link": "https://stackoverflow.com/users/1893155/eric-fulmer"}, "reply_to_user": {"reputation": 49, "user_id": 6473325, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/83a984b18bddba398c7bea7cfc0e3305?s=128&d=identicon&r=PG&f=1", "display_name": "Amateur", "link": "https://stackoverflow.com/users/6473325/amateur"}, "edited": false, "score": 0, "creation_date": 1497214679, "post_id": 44488667, "comment_id": 75971515, "body": "Glad to help. Added in more details on how patterns work. Hopefully they are useful to you in future Haskell coding!"}], "tags": [], "owner": {"reputation": 674, "user_id": 1893155, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jvtf4.jpg?s=128&g=1", "display_name": "Eric Fulmer", "link": "https://stackoverflow.com/users/1893155/eric-fulmer"}, "is_accepted": false, "score": 4, "last_activity_date": 1497214624, "last_edit_date": 1497214624, "creation_date": 1497214373, "answer_id": 44488667, "question_id": 44488637, "link": "https://stackoverflow.com/questions/44488637/haskell-pattern-not-matched/44488667#44488667", "title": "Haskell pattern not matched [_]", "body": "<p>In the pattern <code>(a:b:xs)</code>, you're only matching lists of length >= 2. You're missing a pattern for a one-item list.</p>\n\n<p>For example, these match <code>(a:b:xs)</code>:</p>\n\n<ol>\n<li><code>\"AWUBBWUBC\"</code> -- <code>a</code> is bound to <code>\"A\"</code>, <code>b</code> is bound to <code>\"W\"</code>, and <code>xs</code> is bound to <code>\"UBBWUBC\"</code> (syntactic sugar for <code>'U':'B':'B':'W':'U':'B':'C':[]</code>).</li>\n<li><code>\"AWU\"</code> -- <code>a</code> and <code>b</code> are bound as above, but <code>xs</code> is now bound to <code>\"W\"</code>.</li>\n<li><code>\"AW\"</code> -- <code>a</code> and <code>b</code> are again bound to <code>\"A\"</code> and <code>\"W\"</code> respectively.</li>\n</ol>\n\n<p>Something like <code>\"A\"</code> wouldn't because you could bind <code>a</code> to <code>\"A\"</code> and <code>xs</code> to the empty list, but you don't have anything for <code>b</code>.</p>\n\n<p>I hope this explains it!</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1497217444, "last_edit_date": 1497217444, "creation_date": 1497216708, "answer_id": 44488980, "question_id": 44488637, "link": "https://stackoverflow.com/questions/44488637/haskell-pattern-not-matched/44488980#44488980", "title": "Haskell pattern not matched [_]", "body": "<p>Like <a href=\"https://stackoverflow.com/a/44488667/67579\">@EricFulmer</a> writes in his answer, <code>(a:b:xs)</code> matches lists with <em>two or more items</em>. So your function works as:</p>\n\n<pre><code>format [] = ...       -- empty list\nformat (a:b:xs) = ... -- two or more\n</code></pre>\n\n<p>And Haskell is warning that a list with one element <code>[_]</code> will not match any of these lines: both patterns will fail.</p>\n\n<p>You thus should add a clause, to specify what should happen in the case the list contains one element, for instance (and probably):</p>\n\n<pre><code>format a@[_] = a\n</code></pre>\n\n<p>Where <code>@</code> is an <em>alias operator</em> and it binds with a list with exactly one element.</p>\n\n<p>In full we then obtain:</p>\n\n<pre><code>format :: String -&gt; String\nformat [] = []\nformat a@[_] = a\nformat (a:b:xs)\n | a == 'W' &amp;&amp; b == 'U' = \" \" ++ format (drop 1 xs) \n | otherwise = a : format (b:xs)\n</code></pre>\n\n<p>We can make the function more elegantly, by by moving the comparisons into the pattern matching:</p>\n\n<pre><code>format :: String -&gt; String\nformat [] = []\nformat a@[_] = a\nformat ('W':'U':xs) = format $ drop 1 xs \nformat (a:b:xs) = a : format (b:xs)\n</code></pre>\n\n<p>Now the last case can be simplified into:</p>\n\n<pre><code>format (a:xs) = a : format xs\n</code></pre>\n\n<p>and now the second clause (our <code>format a@[_]</code>) becomes obsolete, since the last clause handles that case as well. So we turn the function into:</p>\n\n<pre><code>format :: String -&gt; String\nformat [] = []\nformat ('W':'U':xs) = format $ drop 1 xs \nformat (a:xs) = a : format xs\n</code></pre>\n\n<p>Personally I think this is is more elegant since here it is clear what you aim to match with the second pattern (you do not have to write a sequence of conditions). Furthermore one can almost syntactically see that the function handles all possible inputs.</p>\n"}], "owner": {"reputation": 49, "user_id": 6473325, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/83a984b18bddba398c7bea7cfc0e3305?s=128&d=identicon&r=PG&f=1", "display_name": "Amateur", "link": "https://stackoverflow.com/users/6473325/amateur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1308, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1497217444, "creation_date": 1497214161, "last_edit_date": 1497216865, "question_id": 44488637, "link": "https://stackoverflow.com/questions/44488637/haskell-pattern-not-matched", "title": "Haskell pattern not matched [_]", "body": "<p>I have been trying to make the following code work: </p>\n\n<pre><code>{-# OPTIONS_GHC -fwarn-incomplete-patterns #-}\nimport Data.List\nformat :: String -&gt; String\nformat [] = []\nformat (a:b:xs)\n | a == 'W' &amp;&amp; b == 'U' = \" \" ++ format (drop 1 xs) \n | otherwise = a : format (b:xs)\n\nsongDecoder :: String -&gt; String\nsongDecoder xs = unwords. words . format $ xs\n</code></pre>\n\n<p>When I test with: </p>\n\n<blockquote>\n  <p>songDecoder \"AWUBBWUBC\"</p>\n</blockquote>\n\n<p>I expect \"ABC\" as output. However, I'm getting an unusual pattern matching warning: </p>\n\n<pre><code>Pattern match(es) are non-exhaustive\nIn an equation for \u2018format\u2019: Patterns not matched: [_]\n</code></pre>\n\n<p>I'm not sure why I need to match [_] when I have</p>\n\n<pre><code>format (a:b:xs)\n</code></pre>\n\n<p>Please help.</p>\n"}, {"tags": ["list", "haskell", "indexing"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1497210977, "post_id": 44488132, "comment_id": 75970361, "body": "Correct, however I&#39;d remark that this is <i>quite</i> inefficient. List lookup being <i>O</i> (<i>n</i>), any repeated use of <code>!!</code> should be avoided."}, {"owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1497211154, "post_id": 44488132, "comment_id": 75970447, "body": "@leftaroundabout, well, yeah, but how else would one extract elements from a list given only indexes of these elements given that there seem to be no restrictions on the order of the indexes? If there were some, then improvements could&#39;ve been made."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1497211728, "post_id": 44488132, "comment_id": 75970656, "body": "Sorting is only <i>O</i> (<i>n</i> &#183; log <i>n</i>), so for sufficiently big lists it&#39;s more efficient to <i>impose</i> an ascending order (but also keep the information of how the order was originally), then use that to extract the elements, then sort back into the original order of requested indices."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1497211824, "post_id": 44488132, "comment_id": 75970684, "body": "...alternatively, you can also convert the list into a more indexing-friendly structure (<code>Vector</code> or <code>IntMap</code>) and look up the indices from that, instead of the values-list itself."}, {"owner": {"reputation": 73, "user_id": 8145540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f006ede3e7ad759c8bde2aa3dd68686d?s=128&d=identicon&r=PG&f=1", "display_name": "Agent_0f_things", "link": "https://stackoverflow.com/users/8145540/agent-0f-things"}, "edited": false, "score": 0, "creation_date": 1497212774, "post_id": 44488132, "comment_id": 75970949, "body": "I know about <code>!!</code> operator just couldn&#39;t wrap my head aroung how to use it here properly. As far as i know indexes always come in ascending order however there can be &quot;gaps&quot; so to speak. And they should not go out of boundaries."}], "tags": [], "owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "is_accepted": false, "score": 1, "last_activity_date": 1497210766, "creation_date": 1497210766, "answer_id": 44488132, "question_id": 44488080, "link": "https://stackoverflow.com/questions/44488080/extract-from-a-list-elements-with-indexes-given-in-another-list/44488132#44488132", "title": "Extract from a list elements with indexes given in another list", "body": "<p>You can access lists' elements with the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html\" rel=\"nofollow noreferrer\"><code>!!</code> operator</a> like this:</p>\n\n<pre><code>List!!index == value_at_that index\n</code></pre>\n\n<p>So, your function could look like the following:</p>\n\n<pre><code>search indexes list = [list!!x | x &lt;- indexes]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 8145540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f006ede3e7ad759c8bde2aa3dd68686d?s=128&d=identicon&r=PG&f=1", "display_name": "Agent_0f_things", "link": "https://stackoverflow.com/users/8145540/agent-0f-things"}, "edited": false, "score": 0, "creation_date": 1497212998, "post_id": 44488181, "comment_id": 75971015, "body": "Second version of the function does not compile, mismatched types."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 73, "user_id": 8145540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f006ede3e7ad759c8bde2aa3dd68686d?s=128&d=identicon&r=PG&f=1", "display_name": "Agent_0f_things", "link": "https://stackoverflow.com/users/8145540/agent-0f-things"}, "edited": false, "score": 0, "creation_date": 1497216009, "post_id": 44488181, "comment_id": 75971817, "body": "@Agent_0f_things: forgot an accent. Fixed now."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1497215992, "last_edit_date": 1497215992, "creation_date": 1497211080, "answer_id": 44488181, "question_id": 44488080, "link": "https://stackoverflow.com/questions/44488080/extract-from-a-list-elements-with-indexes-given-in-another-list/44488181#44488181", "title": "Extract from a list elements with indexes given in another list", "body": "<p>One can use the <code>(!!) :: [a] -&gt; Int -&gt; Int</code> operator and <em>list comprehension</em> to achieve this like:</p>\n\n<pre><code>search :: [Int] -&gt; [a] -&gt; [a]\nsearch js xs = [xs!!j | j &lt;- js]\n</code></pre>\n\n<p>But the <code>(!!)</code> operator works in <em>O(k)</em> with <em>k</em> the requested index, so this will be inefficient.</p>\n\n<p>Given the <strong>list of indices is ordered and does not go out of bounds</strong>, a pure Haskell function could be the following:</p>\n\n<pre><code>search :: [Int] -&gt; [a] -&gt; [a]\nsearch = search' 0\n    where search' _ []     _  = []\n          search' i (j:js) xs = y : search' (j+1) js ys\n              where (y:ys) = drop (j-i) xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 8145540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f006ede3e7ad759c8bde2aa3dd68686d?s=128&d=identicon&r=PG&f=1", "display_name": "Agent_0f_things", "link": "https://stackoverflow.com/users/8145540/agent-0f-things"}, "edited": false, "score": 0, "creation_date": 1497213649, "post_id": 44488234, "comment_id": 75971216, "body": "Indices are sorted so it&#39;s not a problem. Thank you for answer."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1497211406, "creation_date": 1497211406, "answer_id": 44488234, "question_id": 44488080, "link": "https://stackoverflow.com/questions/44488080/extract-from-a-list-elements-with-indexes-given-in-another-list/44488234#44488234", "title": "Extract from a list elements with indexes given in another list", "body": "<p>Assuming the indices are sorted, you can write your own explicit recursion.</p>\n\n<pre><code>search :: [Int] -&gt; [a] -&gt; [a]\nsearch indices xs = go indices 0 xs  -- start from index 0\n   where\n   go :: [Int] -&gt; Int -&gt; [a] -&gt; [a]\n   -- no more indices, we are done\n   go []     _ _                = []\n   -- more indices but no more elements -&gt; error\n   go _      _ []               = error \"index not found\"\n   -- if the wanted index i is the same as the current index j,\n   -- return the current element y, more to the next wanted index\n   go (i:is) j yys@(y:_) | i==j = y : go is  j     yys\n   -- otherwise, skip y and increment the current index j\n   go iis    j (_:ys)           =     go iis (j+1) ys\n</code></pre>\n\n<p>More high-level approaches exist, but this should be a basic efficient alternative. It runs in O(n), where n is the length of the lists.</p>\n\n<p>Note that repeatedly calling <code>!!</code> would instead require O(n^2) time, since each <code>!!</code> costs O(n).</p>\n\n<p>If the indices are not sorted, use <code>go (sort indices) 0 xs</code> instead. The cost increases to O(n log n).</p>\n"}], "owner": {"reputation": 73, "user_id": 8145540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f006ede3e7ad759c8bde2aa3dd68686d?s=128&d=identicon&r=PG&f=1", "display_name": "Agent_0f_things", "link": "https://stackoverflow.com/users/8145540/agent-0f-things"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1316, "favorite_count": 0, "accepted_answer_id": 44488234, "answer_count": 3, "score": 6, "last_activity_date": 1497215992, "creation_date": 1497210456, "last_edit_date": 1497210514, "question_id": 44488080, "link": "https://stackoverflow.com/questions/44488080/extract-from-a-list-elements-with-indexes-given-in-another-list", "title": "Extract from a list elements with indexes given in another list", "body": "<p>So I need to extract elements from given list with indexes that are given in another list.\nSignature supposed to be something like this:</p>\n\n<pre><code>search :: [Int] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>and the result</p>\n\n<pre><code>search [1,3,5] [34,65,67,34,23,43,54]\n[65,34,43]\n</code></pre>\n\n<p>As far as I know there is no standard functions for this, I can do this on more common languages with cycles, but I'm not that good with haskell.</p>\n"}, {"tags": ["haskell", "monads", "indentation"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1497209907, "post_id": 44487951, "comment_id": 75970003, "body": "This is not an indentation error. The problem is that you use a <code>IO</code> monad, but your last line is not a monadic line. Do you want to print something?"}], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 8061440, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc74d7907da751af5a276a621ad42c52?s=128&d=identicon&r=PG&f=1", "display_name": "Erich Melvin", "link": "https://stackoverflow.com/users/8061440/erich-melvin"}, "edited": false, "score": 0, "creation_date": 1497314141, "post_id": 44487984, "comment_id": 76014264, "body": "This is a very simple Test, like a debug, I have to study for  aplicate the functions in this code, I understood the explanation for the expression do, thanks!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1497209927, "creation_date": 1497209927, "answer_id": 44487984, "question_id": 44487951, "link": "https://stackoverflow.com/questions/44487951/an-indentation-error/44487984#44487984", "title": "an indentation error?", "body": "<p>You can't end a <code>do</code> block with a <code>let</code> (or a <code>x &lt;- ...</code>): there must be something you want to do with that variable you are binding.</p>\n\n<p>The easiest fix is to do nothing:</p>\n\n<pre><code>main = do \n   contents &lt;- readFile \"aaaa.txt\" \n   let s = map words (lines contents) \n   let cities = map stringsToCity s \n   return ()\n</code></pre>\n\n<p>Surely you have some better idea about how to continue your <code>main</code>. E.g. you could <code>print cities</code>, or do more computation.</p>\n"}], "owner": {"reputation": 7, "user_id": 8061440, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc74d7907da751af5a276a621ad42c52?s=128&d=identicon&r=PG&f=1", "display_name": "Erich Melvin", "link": "https://stackoverflow.com/users/8061440/erich-melvin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 44487984, "answer_count": 1, "score": 0, "last_activity_date": 1497209927, "creation_date": 1497209766, "last_edit_date": 1497209857, "question_id": 44487951, "link": "https://stackoverflow.com/questions/44487951/an-indentation-error", "title": "an indentation error?", "body": "<p>I think know how to use identantion in Haskell, but I has a problem in this code:  </p>\n\n<pre><code>module TestTSPGA where \n\nimport TSPGA -- in this we have the type used on the second function\nimport Data.List\n\nmain :: IO () \nmain = do \n          contents &lt;- readFile \"aaaa.txt\" \n          let s = map words (lines contents) \n          let cities = map stringsToCity s \n\nstringsToCity :: [String] -&gt; City \nstringsToCity [c, x, y] = (read c, (read x, read y)) \n</code></pre>\n\n<p>the error is the same of the n questions in StackOverflow, I tryed to fix this n times, but don't had sucess.</p>\n\n<p>the error: </p>\n\n<p>C:\\Users\\xxx\\Desktop\\TestTSPGA.hs:11:10: error:</p>\n\n<p>The last statement in a 'do' block must be an expression</p>\n\n<p>let cities = map stringsToCity s</p>\n\n<p>I'm a begginer in haskell, when I think I can had learning anything, the language show me a new error. </p>\n"}, {"tags": ["haskell", "unordered-containers"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1497197870, "last_edit_date": 1497197870, "creation_date": 1497197569, "answer_id": 44485957, "question_id": 44485633, "link": "https://stackoverflow.com/questions/44485633/how-can-i-inspect-a-hidden-hashmap-base-type/44485957#44485957", "title": "How can I inspect a hidden HashMap.Base type?", "body": "<p>Yes, in the <code>unordered-containers</code> package, the intention is that you either import <code>Data.HashMap.Lazy</code> or <code>Data.HashMap.Strict</code>.  Both variants have strict keys (evaluated to WHNF) and differ in whether values are also evaluated to WHNF or not.</p>\n\n<p>In the source package for <code>unordered-containers</code>, there is a hidden module <code>Data.HashMap.Base</code> that contains code shared by both the lazy and strict variants.  Because this module is hidden (technically, because it is listed in the package's Cabal file under the <code>other-modules</code> stanza instead of the <code>exposed-modules</code> stanza), it is not intended to be imported directly, but only indirectly via one of the other two modules.</p>\n\n<p>For <code>toList</code> in particular, the exposed modules <code>Data.HashMap.Lazy</code> and <code>Data.HashMap.Strict</code> both use (i.e., re-export) the same definition of <code>toList</code> defined in the hidden module <code>Data.HashMap.Base</code>, which is why you're seeing this in your GHCI browsing.</p>\n\n<p>If you import one of the modules in GHCI, then you should be able to inspect <code>toList</code> and its component types:</p>\n\n<pre><code>&gt; import Data.HashMap.Strict\n&gt; :t toList\ntoList :: HashMap k v -&gt; [(k, v)]\n&gt; :i HashMap\ntype role HashMap nominal representational\ndata HashMap k v\n  = unordered-containers-0.2.7.2:Data.HashMap.Base.Empty\n  ...\n</code></pre>\n\n<p>In fact, you'll discover that the same <code>HashMap</code> definition is used for both strict and lazy variants, so it's not an \"abstract\" type in the sense you're thinking:  both implementations use the same underlying concrete data structure and differ in how the functions operating on that data structure use it.</p>\n\n<p>This is true for the <code>Data.Map.Strict</code> and <code>Data.Map.Lazy</code> plain maps, too, by the way.  A \"strict\" map can be used with lazy operations and vice versa, because \"strict\" and \"lazy\" maps are the same object.  Quoting from the documentation for <code>Data.Map.Lazy</code>:</p>\n\n<blockquote>\n  <p>API of this module is strict in the keys, but lazy in the values. If you need value-strict maps, use Data.Map.Strict instead. The Map type itself is shared between the lazy and strict modules, meaning that the same Map value can be passed to functions in both modules (although that is rarely needed).</p>\n</blockquote>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 44485957, "answer_count": 1, "score": 1, "last_activity_date": 1497197870, "creation_date": 1497195545, "question_id": 44485633, "link": "https://stackoverflow.com/questions/44485633/how-can-i-inspect-a-hidden-hashmap-base-type", "title": "How can I inspect a hidden HashMap.Base type?", "body": "<p>I'm working on a project that references <code>unordered-containers-0.2.8.0:Data.HashMap.Base.HashMap</code>.</p>\n\n<p>The module containing value of that type does not state where it came from in import sections and I cannot import <code>Data.HashMap.Base</code>.</p>\n\n<p>However <code>:bro</code>wsing suggests that the type is intended to be abstract at least in some cases.</p>\n\n<pre><code>&gt; :bro Data.HashMap.Lazy\n[...]\nunordered-containers-0.2.8.0:Data.HashMap.Base.toList ::\n unordered-containers-0.2.8.0:Data.HashMap.Base.HashMap k v\n -&gt; [(k, v)]\n</code></pre>\n\n<p>Does it mean I can import functions from either <code>Lazy</code> or <code>Strict</code> variants?</p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 3, "creation_date": 1497195773, "post_id": 44485607, "comment_id": 75965259, "body": "In your first bit of code, the problem actually looks like <code>(head args)</code> isn&#39;t an IO action, but <code>(readFile (head args))</code> is. Youre returning 2 different types. Try just changing <code>(head args)</code> to <code>(return (head args))</code> to put the value in the IO monad."}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1497195909, "post_id": 44485607, "comment_id": 75965294, "body": "@Carcigenicate Thanks! this is exactly what I was looking for.  If you would like to post an answer detailing this I would be happy to accept."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1497196183, "post_id": 44485607, "comment_id": 75965396, "body": "Unrelated, but how do you know <code>args</code> isn&#39;t empty?"}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1497196295, "post_id": 44485607, "comment_id": 75965433, "body": "@chepner This code is abbreviated for the sake of clarity.  In the code shown I don&#39;t, but in my actual code I have more extensive handling, that ensures that the input provided is valid.  For the same reason the definition of <code>parseFlags</code> has been left out."}], "answers": [{"tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 1, "last_activity_date": 1497195889, "creation_date": 1497195889, "answer_id": 44485700, "question_id": 44485607, "link": "https://stackoverflow.com/questions/44485607/conditional-io-action/44485700#44485700", "title": "Conditional IO action", "body": "<p>You can use <code>return (head args)</code> to lift a type to the <code>IO</code> monad.</p>\n"}, {"tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": true, "score": 4, "last_activity_date": 1502323005, "last_edit_date": 1502323005, "creation_date": 1497196122, "answer_id": 44485731, "question_id": 44485607, "link": "https://stackoverflow.com/questions/44485607/conditional-io-action/44485731#44485731", "title": "Conditional IO action", "body": "<p>You were trying to treat <code>(head args)</code> as though it was in the IO monad. Since it's just a raw value, you need to place it into the monad before it can be used as an IO action. </p>\n\n<p>Just change <code>(head args)</code> to <code>(return (head args))</code>.</p>\n"}], "owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 44485731, "answer_count": 2, "score": 0, "last_activity_date": 1502323005, "creation_date": 1497195401, "last_edit_date": 1499454607, "question_id": 44485607, "link": "https://stackoverflow.com/questions/44485607/conditional-io-action", "title": "Conditional IO action", "body": "<p>I am writing a program that should be able to read input either from the command line directly or from a file depending on what args are passed.  For example.  However I am having trouble making the IO event conditional.  My first thought was to do:</p>\n\n<pre><code>import System.Environment\n\nmain :: IO ()\nmain = do\n cla &lt;- getArgs\n let flags = parseFlags (filter isFlag cla) []\n let args  = filter (not.isFlag) cla\n input &lt;- if (elem \"e\" flags) then (head args) else (readFile (head args))\n</code></pre>\n\n<p>However this doesn't work because <code>(head args)</code> is not a IO action.  My next thought was to do:</p>\n\n<pre><code>import System.Environment\n\nmain :: IO ()\nmain = do\n cla &lt;- getArgs\n let flags = parseFlags (filter isFlag cla) []\n let args  = filter (not.isFlag) cla\n file &lt;- (readFile (head args))\n let input = if (elem \"e\" flags) then (head args) else (file)\n</code></pre>\n\n<p>But this will error if the input is not the name of a file.  Is there a sensible way to do this? Am I approaching the problem incorrectly?</p>\n"}, {"tags": ["haskell", "syntax"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1497190054, "post_id": 44484597, "comment_id": 75963451, "body": "Why not? ;) you are basically correct, it kind of unpacks the rhs. This is the same pattern matching machinery that works for function definitions, like <code>natToInteger Zero = 0; natToInteger (Succ x) = 1 + natToInteger x</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1497191990, "post_id": 44484597, "comment_id": 75964040, "body": "Keep in mind that, even if <code>where Just x = ...</code> defines <code>x</code> via pattern matching, this can be dangerous: when <code>x</code> is demanded, if the pattern is not matched (e.g. because the recursive call returns <code>Nothing</code>), a runtime error will be raised, crashing the whole program. Of course, here it can never happen, yet the burden is on the programmer to ensure that."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user937999"}, "edited": false, "score": 0, "creation_date": 1497190246, "post_id": 44484731, "comment_id": 75963511, "body": "Got it. It means I can write less since where supports constructor matching...Thanks for clarifying."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1497190465, "post_id": 44484731, "comment_id": 75963581, "body": "@NirvinM: yes the <code>where</code> clause works like the pattern matching system in the head of a function works."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1497190505, "last_edit_date": 1497190505, "creation_date": 1497189841, "answer_id": 44484731, "question_id": 44484597, "link": "https://stackoverflow.com/questions/44484597/how-does-this-where-syntax-works/44484731#44484731", "title": "How does this where syntax works?", "body": "<p>The Haskell <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch10.html#x17-18000010.5\" rel=\"nofollow noreferrer\"><em>context free syntax</em></a>, has an entry about the <em>right hand side (rhs)</em> of a function:</p>\n\n<blockquote>\n  <p>rhs &rightarrow; <code>=</code> exp [<code>where</code> decls]<br>\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| gdrhs [<code>where</code>\n  decls]</p>\n</blockquote>\n\n<p>So that mean we have to take a look to <code>decls</code> to get the <code>where</code> syntax. <code>decls</code> is a sequence of <code>decl</code>s:</p>\n\n<blockquote>\n  <p>decls &rightarrow; { decl<sub>1</sub>; ...; decl<sub>n</sub> }</p>\n</blockquote>\n\n<p>And a <code>decl</code> has again two possible rules:</p>\n\n<blockquote>\n  <p>decl&rightarrow; gendecl<br>\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (funlhs | pat) rhs</p>\n</blockquote>\n\n<p>So that means we can declare patterns (pat) in the left hand side of a <code>where</code> clause. Actually in a <code>where a = 1</code>, <code>a</code> is already a pattern so to speak. The pattern consists out of one variable. But constructors, alias operators, etc. are all acceptable at the left hand side of a <code>where</code> clause.</p>\n\n<p>A pattern can be a variable, a generic constructor, a qualified constructor, a literatal, a wildcard, list pattern, tuple pattern, irrefutable pattern, etc. Then entire grammar for <em>patterns</em> can be found <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch10.html#dx17-180063\" rel=\"nofollow noreferrer\">here</a>. So in short it works like pattern matching in the head of the function.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user937999"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1497204749, "creation_date": 1497189035, "last_edit_date": 1497204749, "question_id": 44484597, "link": "https://stackoverflow.com/questions/44484597/how-does-this-where-syntax-works", "title": "How does this where syntax works?", "body": "<p>I was looking into this solution from GitHub for a problem asked in <em>Haskell from First Principles</em> book. Here is the code</p>\n\n<pre><code>data Nat =\n    Zero\n  | Succ Nat deriving (Eq, Show)\n\nintegerToNat :: Integer -&gt; Maybe Nat\nintegerToNat i\n  | i &lt; 0  = Nothing\n  | i == 0 = Just Zero\n  | i &gt; 0  = Just (Succ x) where (Just x) = integerToNat $ i-1\n</code></pre>\n\n<p>I'm confused at </p>\n\n<blockquote>\n  <p>where (Just x) = integerToNat $ i-1</p>\n</blockquote>\n\n<p>I thought I can only assign an expression to an identifier in <code>where</code>. But it looks like the <code>(Just x)</code> unpacks the value of the expression assigned and assigns <code>x</code> back to <code>(Succ x)</code>.</p>\n\n<p>Can somebody explain why this works?</p>\n"}, {"tags": ["sorting", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 3, "last_activity_date": 1497178847, "creation_date": 1497178847, "answer_id": 44483063, "question_id": 44482827, "link": "https://stackoverflow.com/questions/44482827/haskell-recursive-sort-function/44483063#44483063", "title": "Haskell recursive sort function", "body": "<pre><code>smallest (x:xs)\n  | x &lt; smallest xs = x\n  | otherwise = smallest xs\n</code></pre>\n\n<p>duplicates the number of <code>smallest</code> queries at each point in the list, blowing up exponentially. Instead:</p>\n\n<pre><code>smallest (x:xs) = min x (smallest xs)\n</code></pre>\n\n<p>, or even just <code>smallest</code> = <code>minimum</code>. Here are a few sorts I can see with your functions or similar ones:</p>\n\n<pre><code>insertionSort [] = []\ninsertionSort (x:xs) = insert x (insertionSort xs)\n</code></pre>\n\n<p>This one will need <code>smallest</code> to give back the remaining list as well:</p>\n\n<pre><code>selectSmallest :: [Int] -&gt; (Int, [Int])\nselectSmallest (x:xs) = let (y, ys) = smallest xs in if x &lt; y\n  then (x, xs)\n  else (y, x:ys)\n\nselectionSorta [] = []\nselectionSorta xs = let (y, ys) = smallest xs in\n  y : selectionSorta ys\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 8138142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/db1d0687a43f80c2caebe125dae26844?s=128&d=identicon&r=PG&f=1", "display_name": "Vajk", "link": "https://stackoverflow.com/users/8138142/vajk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 809, "favorite_count": 0, "accepted_answer_id": 44483063, "answer_count": 1, "score": 0, "last_activity_date": 1497178847, "creation_date": 1497177281, "question_id": 44482827, "link": "https://stackoverflow.com/questions/44482827/haskell-recursive-sort-function", "title": "Haskell recursive sort function", "body": "<p>I would like to implement a sort function in Haskell with these two functions:</p>\n\n<pre><code>smallest :: (Ord a) =&gt; [a] -&gt; a\nsmallest [] = error \"empty list\"\nsmallest [x] = x\nsmallest (x:xs)\n  | x &lt; smallest xs = x\n  | otherwise = smallest xs\n\ninsert :: Int -&gt; [Int] -&gt; [Int]\ninsert x [] = [x]\ninsert x (y:ys)\n  | x &lt;= y = x:y:ys\n  | otherwise = y:insert x ys\n</code></pre>\n\n<p>My idea is to insert the smallest value at the right position with a recursion but as I am new to Haskell I got some problems on how to implement that.</p>\n"}, {"tags": ["parsing", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1497186032, "last_edit_date": 1497186032, "creation_date": 1497177747, "answer_id": 44482893, "question_id": 44482767, "link": "https://stackoverflow.com/questions/44482767/designing-parsing-code-using-parsec/44482893#44482893", "title": "Designing parsing code using Parsec", "body": "<p>If the first argument of <code>(&lt;|&gt;)</code> fails after having consumed some input, then it fails immediately without trying the second alternative. If a failure in the first argument should lead to a retry with the second argument, you can use <code>try</code> to avoid consuming input. In <code>hexNumber</code> you must consume <code>'#'</code> only if the following character matches <code>'x'</code>.</p>\n\n<pre><code>hexNumber :: Parser Integer\nhexNumber = do\n  try $ char '#' &gt;&gt; char 'x'\n  s &lt;- many1 hexChar\n  return $ (fst . head) readHex s\n\n\noctNumber :: Parser Integer\noctNumber = do\n  try $ char '#' &gt;&gt; char 'o'\n  s &lt;- many1 hexChar\n  return $ (fst . head) readOct s\n</code></pre>\n\n<p>Note that this is somewhat inefficient since you parse <code>'#'</code> twice, and it gets worse as the common prefix gets longer and more complex.</p>\n"}], "owner": {"reputation": 1024, "user_id": 5339728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bc87e9ae4adff4d75b1ad9233e04bc54?s=128&d=identicon&r=PG&f=1", "display_name": "Sven Williamson", "link": "https://stackoverflow.com/users/5339728/sven-williamson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 44482893, "answer_count": 1, "score": 0, "last_activity_date": 1497186032, "creation_date": 1497176860, "last_edit_date": 1497177651, "question_id": 44482767, "link": "https://stackoverflow.com/questions/44482767/designing-parsing-code-using-parsec", "title": "Designing parsing code using Parsec", "body": "<p>In the course for following the tutorial <a href=\"https://upload.wikimedia.org/wikipedia/commons/a/aa/Write_Yourself_a_Scheme_in_48_Hours.pdf\" rel=\"nofollow noreferrer\">Write yourself a Scheme in 48 hours</a>, I was attempting to enhance my parsing code to create support for hexadecimal, octal, binary and decimal literals.</p>\n\n<pre><code>import Text.ParserCombinators.Parsec hiding (spaces)\nimport Control.Monad\nimport Numeric\n\nhexChar :: Parser Char\nhexChar = ...\n\noctChar :: Parser Char\noctChar = ...\n\nhexNumber :: Parser Integer\nhexNumber = do\n  char '#'\n  char 'x'\n  s &lt;- many1 hexChar\n  return $ (fst . head) readHex s\n\n\n octNumber :: Parser Integer\n octNumber = do\n  char '#'\n  char 'o'\n  s &lt;- many1 hexChar\n  return $ (fst . head) readOct s\n</code></pre>\n\n<p>If we forget about decimal and binary numbers in this discussion:</p>\n\n<pre><code>parseNumber :: Parse Integer\nparseNumber = hexNumber &lt;|&gt; octNumber\n</code></pre>\n\n<p>Then this parser will fail to recognize octal numbers. This seems to be related to the number of lookahead characters required to tell apart and octal from hexadecimal numbers (if we drop the leading '#' in the syntax, then the \nparser will work). Hence it seems we are forced to revisit the code and 'factorize' the leading '#' so to speak, by dropping the <code>char '#'</code> in the individual parsers and defining:</p>\n\n<pre><code>parseNumber = char '#' &gt;&gt; (hexNumber &lt;|&gt; octNumber)\n</code></pre>\n\n<p>This is fine but I find the code less pleasant. Somehow, if I have a function called <code>hexNumber</code> I would expect it to recognize <code>#xffff</code> (which is proper Scheme syntax) and not <code>xffff</code>. Is this something I have to live with, or are there ways to go around this 'forced factorization' of the leading character #?</p>\n"}, {"tags": ["haskell", "memoization"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1497121674, "post_id": 44476882, "comment_id": 75949391, "body": "I guess you may consider using a <a href=\"https://hackage.haskell.org/package/monad-memo-0.4.1/docs/Control-Monad-Memo.html#g:4\" rel=\"nofollow noreferrer\">map based memo monad</a>."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1497122269, "post_id": 44476882, "comment_id": 75949547, "body": "While that is a good solution, it is unlikely to be helpful to someone so new to Haskell and functional programming without a lot of explanation."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1497134379, "post_id": 44476882, "comment_id": 75952447, "body": "By the way, there is a <i>much</i> more efficient way to solve this problem that will completely eliminate the need for memoization. As in, so efficient you could probably do it by hand with pencil and paper in just a few minutes."}, {"owner": {"reputation": 2581, "user_id": 1234443, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9f4a7a9822caa42024e8e76b36e26964?s=128&d=identicon&r=PG", "display_name": "jchitel", "link": "https://stackoverflow.com/users/1234443/jchitel"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1497271422, "post_id": 44476882, "comment_id": 75992788, "body": "@Daniel I&#39;m sure that&#39;s true, but I&#39;d still like to have a generic memoization function for the future."}], "answers": [{"comments": [{"owner": {"reputation": 2581, "user_id": 1234443, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9f4a7a9822caa42024e8e76b36e26964?s=128&d=identicon&r=PG", "display_name": "jchitel", "link": "https://stackoverflow.com/users/1234443/jchitel"}, "edited": false, "score": 0, "creation_date": 1497123590, "post_id": 44477216, "comment_id": 75949915, "body": "Is there no way to simply store the values as they are computed? I don&#39;t see why I should have to store all solutions for all inputs when the problem itself will know exactly which inputs it needs as it goes along."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 2581, "user_id": 1234443, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9f4a7a9822caa42024e8e76b36e26964?s=128&d=identicon&r=PG", "display_name": "jchitel", "link": "https://stackoverflow.com/users/1234443/jchitel"}, "edited": false, "score": 0, "creation_date": 1497126263, "post_id": 44477216, "comment_id": 75950649, "body": "Unless the structure that stores the values is independent of the steps the the problem takes as it goes along evaluating those steps has a side effect-mutating the structure that stores the values."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 2581, "user_id": 1234443, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9f4a7a9822caa42024e8e76b36e26964?s=128&d=identicon&r=PG", "display_name": "jchitel", "link": "https://stackoverflow.com/users/1234443/jchitel"}, "edited": false, "score": 0, "creation_date": 1497127402, "post_id": 44477216, "comment_id": 75950920, "body": "With a good memo trie the number of nodes that are ever constructed is proportional to the total size of the inputs that are evaluated."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1497396956, "post_id": 44477216, "comment_id": 76057850, "body": "The <code>memoize</code> package implements this."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 1, "last_activity_date": 1497122578, "creation_date": 1497122578, "answer_id": 44477216, "question_id": 44476882, "link": "https://stackoverflow.com/questions/44476882/implementing-a-memoization-function-in-haskell/44477216#44477216", "title": "Implementing a memoization function in Haskell", "body": "<p>You won't be able to implement <code>memoize :: ((a -&gt; b) -&gt; a -&gt; b) -&gt; a -&gt; b</code>. In order to store the result for some <code>a</code> you're going to need a place in memory for that <code>a</code>, which means you're going to need to have some idea of what those <code>a</code>s are.</p>\n\n<p>A ham-fisted approach would be to add a type-class for the types you know all the values of, like <a href=\"https://hackage.haskell.org/package/universe-1.0/docs/Data-Universe.html\" rel=\"nofollow noreferrer\"><code>Universe</code></a>.</p>\n\n<pre><code>class Universe a where\n    universe :: [a]\n</code></pre>\n\n<p>You could then implement <code>memoize :: (Ord a, Universe a) =&gt; ((a -&gt; b) -&gt; a -&gt; b) -&gt; a -&gt; b</code> by building a <code>Map</code> that contains a <code>b</code> value for every <code>a</code> value in <code>universe :: [a]</code>, making the memoed function by passing the map lookup to the <code>func</code>, and populating the <code>b</code>s by declaring them to use the memoed function.</p>\n\n<p>This won't work for <code>Integer</code> because there aren't a finite number of them. It won't even work for <code>Int</code> because there are too many of them. To memoize types like <code>Integer</code> you can use the approach used in <a href=\"https://hackage.haskell.org/package/MemoTrie\" rel=\"nofollow noreferrer\">MemoTrie</a>. Build a lazy infinite data structure that holds the values at the leaf.</p>\n\n<p>Here's one possible structure for <code>Integer</code>s.</p>\n\n<pre><code>data IntegerTrie b = IntegerTrie {\n    negative :: [b],\n    zero :: b,\n    positive :: [b]\n}\n</code></pre>\n\n<p>A more efficient structure would allow for jumping deep into the trie to avoid exponential time lookup. For <code>Integers</code> MemoTrie takes the approach of converting the keys into lists of bits with some pair of function <code>a -&gt; [Bool]</code> and <code>[Bool] -&gt; a</code> and using approximately the following trie.</p>\n\n<pre><code>data BitsTrie b = BitsTrie {\n    nil :: b,\n    false :: BitsTrie b,\n    true :: BitsTrie b\n}\n</code></pre>\n\n<p>MemoTrie goes on to abstract over the types that have some associate trie that can be used to memoize them and provides ways to compose them together.</p>\n"}, {"tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": false, "score": 1, "last_activity_date": 1497129945, "creation_date": 1497129945, "answer_id": 44478219, "question_id": 44476882, "link": "https://stackoverflow.com/questions/44476882/implementing-a-memoization-function-in-haskell/44478219#44478219", "title": "Implementing a memoization function in Haskell", "body": "<p>This might not directly help you implement memoization, but you can use someone else's... <a href=\"https://hackage.haskell.org/package/monad-memo-0.4.1\" rel=\"nofollow noreferrer\">monad-memo</a>. Adapting one of their examples...</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nimport Control.Monad.Memo\n\nmain = print $ startEvalMemo (getNumberOfPaths 20 20)\n\ngetNumberOfPaths :: (MonadMemo (Integer, Integer) Integer m) =&gt; Integer -&gt; Integer -&gt; m Integer\ngetNumberOfPaths 0 _ = return 1\ngetNumberOfPaths _ 0 = return 1\ngetNumberOfPaths x y = do\n  n1 &lt;- for2 memo getNumberOfPaths (x-1) y\n  n2 &lt;- for2 memo getNumberOfPaths x (y-1)\n  return (n1 + n2)\n</code></pre>\n\n<p>... I suspect to implement something similar you can peek in their source <a href=\"https://github.com/EduardSergeev/monad-memo\" rel=\"nofollow noreferrer\">https://github.com/EduardSergeev/monad-memo</a></p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 3, "last_activity_date": 1497244645, "last_edit_date": 1497244645, "creation_date": 1497151545, "answer_id": 44480102, "question_id": 44476882, "link": "https://stackoverflow.com/questions/44476882/implementing-a-memoization-function-in-haskell/44480102#44480102", "title": "Implementing a memoization function in Haskell", "body": "<p>Provided your inputs are small enough, one thing you can do is allocate the memo table as an <code>Array</code> instead of a <code>Map</code>, containing all the results ahead of time, but calculated lazily:</p>\n\n<pre><code>import Data.Array ((!), array)\n\nnumPaths :: Integer -&gt; Integer -&gt; Integer\nnumPaths w h = get (w - 1) (h - 1)\n  where\n\n    table = array (0, w * h)\n      [ (y * w + x, go x y)\n      | y &lt;- [0 .. h - 1]\n      , x &lt;- [0 .. w - 1]\n      ]\n\n    get x y = table ! fromInteger (y * w + x)\n\n    go 0 _ = 1\n    go _ 0 = 1\n    go x y = get (x - 1) y + get x (y - 1)\n</code></pre>\n\n<p>You can also split this into separate functions if you prefer:</p>\n\n<pre><code>numPaths w h = withTable w h go (w - 1) (h - 1)\n  where\n    go mem 0 _ = 1\n    go mem _ 0 = 1\n    go mem x y = mem (x - 1) y + mem x (y - 1)\n\nwithTable w h f = f'\n  where\n    f' = f get\n    get x y = table ! fromInteger (y * w + x)\n    table = makeTable w h f'\n\nmakeTable w h f = array (0, w * h)\n  [ (y * w + x, f x y)\n  | y &lt;- [0 .. w - 1]\n  , x &lt;- [0 .. h - 1]\n  ]\n</code></pre>\n\n<p>And I won\u2019t spoil it for you, but there\u2019s also a non-recursive formula for the answer.</p>\n"}, {"tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": false, "score": 0, "last_activity_date": 1497251606, "last_edit_date": 1497251606, "creation_date": 1497248571, "answer_id": 44492608, "question_id": 44476882, "link": "https://stackoverflow.com/questions/44476882/implementing-a-memoization-function-in-haskell/44492608#44492608", "title": "Implementing a memoization function in Haskell", "body": "<blockquote>\n  <p>However, I don't want to introduce the Map into the return value of mem because then the function passed to memoize will have to handle the Map.</p>\n</blockquote>\n\n<p>If I'm understanding, you will have to do <em>something</em> like this, at least if your aim is to store the memoized values in a map that gets copied on each new value found. Drawing attention to something that I don't think makes sense in terms of memoization...</p>\n\n<pre><code>getNumberOfPaths' mem (x,y) = (mem (x-1,y)) + (mem (x,y-1))\n</code></pre>\n\n<p>... means that any memoization from one branch <code>mem (x-1,y)</code>, can't be used in the other <code>mem (x,y-1)</code>, because the same <code>mem</code> will be used in both, containing the same information, whatevever value/function <code>mem</code> ends up being. You have to, somehow, pass memoized values from one to the other. This means the function called to recurse can't just return an <code>Integer</code>: it has to return an <code>Integer</code> along with some knowledge of the memoized values found along with that <code>Integer</code>.</p>\n\n<p>There are a number of ways of doing this. Although perhaps undesirable due to the spread of the details of the memoization, you can pass the map about explicitly.</p>\n\n<pre><code>getNumberOfPaths :: (Integer, Integer) -&gt; Integer\ngetNumberOfPaths (x, y) = snd $ memoize Map.empty getNumberOfPaths' (x, y) \n\ngetNumberOfPaths' :: Map.Map (Integer, Integer) Integer -&gt; (Integer, Integer) -&gt; (Map.Map (Integer, Integer) Integer, Integer)\ngetNumberOfPaths' map (0,_) = (map, 1)\ngetNumberOfPaths' map (_,0) = (map, 1)\ngetNumberOfPaths' map (x,y) = (map'', first + second) where\n  (map',   first) = memoize map  getNumberOfPaths' (x-1, y)\n  (map'', second) = memoize map' getNumberOfPaths' (x, y-1)\n\nmemoize :: Ord a =&gt; Map.Map a b -&gt; (Map.Map a b -&gt; a -&gt; (Map.Map a b, b)) -&gt; a -&gt; (Map.Map a b, b)\nmemoize map f x = case Map.lookup x map of\n  (Just y) -&gt; (map, y)\n  Nothing  -&gt; (map'', y) where\n    (map', y) = f map x\n    map''     = Map.insert x y map'\n</code></pre>\n\n<p>The <code>getNumberOfPaths'</code> does need to pass the map about, and needs to know it's signature, but at least it doesn't need to interact with the map: this is done in <code>memoize</code>, so I don't think it's <em>that</em> bad. </p>\n\n<p>I think if you just wanted to be passing a function around, you can. You can use a chain of functions as a poor-man's map, but they do have to return a <code>Maybe</code>...</p>\n\n<pre><code>getNumberOfPaths :: (Integer, Integer) -&gt; Integer\ngetNumberOfPaths (x, y) = snd $ memoize (const Nothing) getNumberOfPaths' (x, y) \n\ngetNumberOfPaths' :: ((Integer, Integer) -&gt; Maybe Integer) -&gt; (Integer, Integer) -&gt; ((Integer, Integer) -&gt; Maybe Integer, Integer)\ngetNumberOfPaths' mem (0,_) = (mem, 1)\ngetNumberOfPaths' mem (_,0) = (mem, 1)\ngetNumberOfPaths' mem (x,y) = (mem'', first + second) where\n  (mem',   first) = memoize mem  getNumberOfPaths' (x-1, y)\n  (mem'', second) = memoize mem' getNumberOfPaths' (x, y-1)\n\nmemoize :: Eq a =&gt; (a -&gt; Maybe b) -&gt; ((a-&gt; Maybe b) -&gt; a -&gt; ((a -&gt; Maybe b), b)) -&gt; a -&gt; ((a -&gt; Maybe b), b)\nmemoize mem f x = case mem x of\n  (Just y) -&gt; (mem, y)\n  Nothing  -&gt; (mem'', y) where\n    (mem', y) = f mem x\n    mem''     = \\x' -&gt; if x' == x then Just y else mem' x'\n</code></pre>\n\n<p>I wonder if you wanted to both a) use a map to store the values, and b) pass a function about as <code>mem</code>. However, I suspect this would be tricky, as, while you <em>can</em> pass a function that extracts from a map and return the extracted value, you can't then extract the map from this function to insert something into the map.</p>\n\n<p>There is also the possibility of creating a monad for this (or using <code>State</code>). However, that may be left to another answer.</p>\n"}, {"tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": false, "score": 0, "last_activity_date": 1497381689, "last_edit_date": 1497381689, "creation_date": 1497299725, "answer_id": 44508289, "question_id": 44476882, "link": "https://stackoverflow.com/questions/44476882/implementing-a-memoization-function-in-haskell/44508289#44508289", "title": "Implementing a memoization function in Haskell", "body": "<blockquote>\n  <p>What I want is a generic memoize function that allows recursive calling exactly like in the definition of getNumberOfPaths, where the computation logic doesn't have to care exactly how the memoization is done.</p>\n</blockquote>\n\n<p>The State monad lends itself well to handling updates to a state, for example updates to a map of memoized values, without having to pass it around explicitly in the \"business logic\" part of the code, as the other answer at <a href=\"https://stackoverflow.com/a/44492608/1319998\">https://stackoverflow.com/a/44492608/1319998</a> does.</p>\n\n<p>In terms of separating the details of the memoization from the recursive function, you can hide the fact that a map, and even State, are being used behind a <code>type</code>. All the definition of the recursive function needs to know is that it must return a <code>MyMemo a b</code>, and instead of calling itself directly, it must pass itself and the next arguments to <code>myMemo</code></p>\n\n<pre><code>import qualified Data.Map as Map\nimport Control.Monad.State.Strict\n\nmain = print $ runMyMemo getNumberOfPaths (20, 20)\n\ngetNumberOfPaths :: (Integer, Integer) -&gt; MyMemo (Integer, Integer) Integer\ngetNumberOfPaths (0, _) = return 1\ngetNumberOfPaths (_, 0) = return 1\ngetNumberOfPaths (x, y) = do\n  n1 &lt;- myMemo getNumberOfPaths (x-1,y)\n  n2 &lt;- myMemo getNumberOfPaths (x,y-1)\n  return (n1 + n2)\n\n-------\n\ntype MyMemo a b = State (Map.Map a b) b\n\nmyMemo :: Ord a =&gt; (a -&gt; MyMemo a b) -&gt; a -&gt; MyMemo a b\nmyMemo f x = gets (Map.lookup x) &gt;&gt;= maybe y' return\n  where\n    y' = do\n      y &lt;- f x\n      modify $ Map.insert x y\n      return y\n\nrunMyMemo :: Ord a =&gt; (a -&gt; MyMemo a b) -&gt; a -&gt; b\nrunMyMemo f x = evalState (f x) Map.empty\n</code></pre>\n\n<p>The above is essentially a roll-your-own version of <a href=\"https://stackoverflow.com/a/44478219/1319998\">https://stackoverflow.com/a/44478219/1319998</a> (well, rolling on top of State).</p>\n\n<hr>\n\n<p>Thanks to <a href=\"https://stackoverflow.com/a/44515364/1319998\">https://stackoverflow.com/a/44515364/1319998</a> for suggestions on the code in <code>myMemo</code></p>\n"}], "owner": {"reputation": 2581, "user_id": 1234443, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9f4a7a9822caa42024e8e76b36e26964?s=128&d=identicon&r=PG", "display_name": "jchitel", "link": "https://stackoverflow.com/users/1234443/jchitel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 613, "favorite_count": 0, "answer_count": 5, "score": 1, "last_activity_date": 1497381689, "creation_date": 1497120322, "question_id": 44476882, "link": "https://stackoverflow.com/questions/44476882/implementing-a-memoization-function-in-haskell", "title": "Implementing a memoization function in Haskell", "body": "<p>I'm fairly new to Haskell, and I'm trying to implement a basic memoization function which uses a <code>Data.Map</code> to store computed values. My example is for Project Euler Problem 15, which involves computing the number of possible paths from 1 corner to the other in a 20x20 grid.</p>\n\n<p>This is what I have so far. I haven't tried compiling yet because I know it won't compile. I'll explain below.</p>\n\n<pre><code>import qualified Data.Map as Map\n\nmain = print getProblem15Value\n\ngetProblem15Value :: Integer\ngetProblem15Value = getNumberOfPaths 20 20\n\ngetNumberOfPaths :: Integer -&gt; Integer -&gt; Integer\ngetNumberOfPaths x y = memoize getNumberOfPaths' (x,y)\nwhere getNumberOfPaths' mem (0,_) = 1\n      getNumberOfPaths' mem (_,0) = 1\n      getNumberOfPaths' mem (x,y) = (mem (x-1,y)) + (mem (x,y-1))\n\nmemoize :: ((a -&gt; b) -&gt; a -&gt; b) -&gt; a -&gt; b\nmemoize func x = fst $ memoize' Map.Empty func x\n    where memoize' map func' x' = case (Map.lookup x' map) of (Just y) -&gt; (y, map)\n                                                              Nothing -&gt; (y', map'')\n           where y' = func' mem x'\n                 mem x'' = y''\n                 (y'', map') = memoize' map func' x''\n                 map'' = Map.insert x' y' map'\n</code></pre>\n\n<p>So basically, the way I have this structured is that <code>memoize</code> is a combinator (by my understanding). The memoization works because <code>memoize</code> provides a function (in this case <code>getNumberOfPaths'</code>) with a function to call (<code>mem</code>) for recursion, instead of having <code>getNumberOfPaths'</code> call itself, which would remove the memoization after the first iteration.</p>\n\n<p>My implementation of <code>memoize</code> takes a function (in this case <code>getNumberOfPaths'</code>) and an initial value (in this case a tuple <code>(x,y)</code> representing the number of grid cell distances from the other corner of the grid). It calls <code>memoize'</code> which has the same structure, but includes an empty <code>Map</code> to hold values, and returns a tuple containing the return value and a new computed <code>Map</code>. <code>memoize'</code> does a map lookup and returns the value and the original map if there is a value present. If there is no value present, it returns the computed value and a new map.</p>\n\n<p>This is where my algorithm breaks down. To compute the new value, I call <code>func'</code> (<code>getNumberOfPaths'</code>) with <code>mem</code> and <code>x'</code>. <code>mem</code> simply returns <code>y''</code>, where <code>y''</code> is contained in the result of calling <code>memoize'</code> again. <code>memoize'</code> also returns a new map, to which we then add the new value and use as the return value of <code>memoize'</code>.</p>\n\n<p>The issue here is that the line <code>(y'', map') = memoize' map func' x''</code> should be under <code>mem</code> because it's dependent on <code>x''</code>, which is a parameter of <code>mem</code>. I can certainly do that, but then I will lose the <code>map'</code> value, which I need because it contains memoized values from intermediate computations. However, I don't want to introduce the <code>Map</code> into the return value of <code>mem</code> because then the function passed to <code>memoize</code> will have to handle the <code>Map</code>.</p>\n\n<p>Sorry if that sounded confusing. A lot of this ultra-high-order functional stuff is confusing to me.</p>\n\n<p>I'm sure that there is a way to do this. What I want is a generic <code>memoize</code> function that allows recursive calling exactly like in the definition of <code>getNumberOfPaths</code>, where the computation logic doesn't have to care exactly how the memoization is done.</p>\n"}, {"tags": ["haskell", "polymorphism", "return-type"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1497120781, "post_id": 44476862, "comment_id": 75949166, "body": "Just to make sure the problem is clear: <code>TestClass a =&gt; Int -&gt; a</code> means the caller -- as opposed to you, the implementer -- gets to choose what <code>a</code> should be."}, {"owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1497122284, "post_id": 44476862, "comment_id": 75949553, "body": "No, the caller should only get &quot;something&quot; that implements <code>TestClass</code> he should have no way of knowing if he got <code>TestData0</code> or <code>TestData1</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1497122537, "post_id": 44476862, "comment_id": 75949623, "body": "See <a href=\"https://wiki.haskell.org/Existential_type\" rel=\"nofollow noreferrer\">existential types</a>, but I suppose that counts as a helper container. In which case the answer is no."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1497122601, "post_id": 44476862, "comment_id": 75949643, "body": "That&#39;s what you want to do; my point is that the signature <code>TestClass a =&gt; Int -&gt; a</code> doesn&#39;t express it. As luqui mentions, an existential wrapper addresses that by hiding the information from the caller."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1497122928, "post_id": 44476862, "comment_id": 75949721, "body": "I believe we see this universal/existential confusion with typeclasses roughly once a month or two. Probably this confusion is due to OOP subtyping, which programmers are trying to emulate. Perhaps we need a reference question/answer, so that these sort of questions can be closed as a duplicate."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1497133582, "creation_date": 1497133582, "answer_id": 44478649, "question_id": 44476862, "link": "https://stackoverflow.com/questions/44476862/haskell-return-type-polymorphism-with-class-restriction/44478649#44478649", "title": "Haskell return type polymorphism with class restriction", "body": "<p>No, you need a wrapper of some kind.</p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 4, "last_activity_date": 1497144443, "creation_date": 1497144443, "answer_id": 44479578, "question_id": 44476862, "link": "https://stackoverflow.com/questions/44476862/haskell-return-type-polymorphism-with-class-restriction/44479578#44479578", "title": "Haskell return type polymorphism with class restriction", "body": "<p>As has been answered in other questions before, you can use an existential wrapper:</p>\n\n<pre><code>{-# LANGUAGE ExistentialTypes #-}\n\ndata SomeTest = forall a. TestClass a =&gt; SomeTest a\n\ninstance TestClass SomeTest where\n  returnInt (SomeTest t) = returnInt t\n\ntestFunction :: Int -&gt; SomeTest\ntestFunction 0 = SomeTest TestData0\ntestFunction 1 = SomeTest TestData1\n</code></pre>\n\n<p>Then the usage is:</p>\n\n<pre><code>returnInt (testFunction 0) == 0\n</code></pre>\n\n<p>However, in answer to your specific question, it <em>is</em> possible to avoid this wrapper by turning your code \u201cinside out\u201d with <em>continuation-passing style</em>, converting the (rank-1) existential type into a (rank-2) universal type:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\ntestFunction :: Int -&gt; (forall a. TestClass a =&gt; a -&gt; r) -&gt; r\ntestFunction 0 k = k TestData0\ntestFunction 1 k = k TestData1\n</code></pre>\n\n<p>Then instead of consuming the result of <code>testFunction</code>, we pass a function that will accept its result. Crucially, this function must work <code>forall a. TestClass a</code>, so it doesn\u2019t know anything about the type <code>a</code> other than that it\u2019s an instance of <code>TestClass</code>. The usage changes to:</p>\n\n<pre><code>testFunction 0 returnInt == 0\n</code></pre>\n\n<p>Remember, top-level <code>forall</code> is implicit in type signatures, so this says that the caller of <code>testFunction</code> decides what <code>a</code> is:</p>\n\n<pre><code>testFunction ::           TestClass a =&gt; Int -&gt; a\ntestFunction :: forall a. TestClass a =&gt; Int -&gt; a\n</code></pre>\n\n<p>And that type is equivalent to this:</p>\n\n<pre><code>testFunction ::           Int -&gt; (forall a. TestClass a =&gt; a)\n</code></pre>\n\n<p>Moving the <code>forall</code> one level inward, so it applies to the continuation <code>k</code>, means that <code>testFunction</code>, the caller of <code>k</code>, now decides what <code>a</code> is. The caller of <code>testFunction</code> now decides what <code>r</code> (the result type) is by passing in a particular <code>k</code>.</p>\n\n<pre><code>testFunction :: forall r. Int -&gt; (forall a. TestClass a =&gt; a -&gt; r) -&gt; r\n</code></pre>\n"}], "owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 44479578, "answer_count": 2, "score": 0, "last_activity_date": 1497144443, "creation_date": 1497120216, "question_id": 44476862, "link": "https://stackoverflow.com/questions/44476862/haskell-return-type-polymorphism-with-class-restriction", "title": "Haskell return type polymorphism with class restriction", "body": "<p>Is there a way to achieve something like this without wrapping types in some kind of helper container?</p>\n\n<pre><code>class TestClass a where\n    returnInt :: a -&gt; Int\n\ndata TestData0 = TestData0\ndata TestData1 = TestData1\n\ninstance TestClass TestData0 where\n    returnInt _ = 0\n\ninstance TestClass TestData1 where\n    returnInt _ = 1\n\ntestisFunction :: (TestClass a) =&gt; Int -&gt; a\ntestisFunction 0 = TestData0\ntestisFunction 1 = TestData1\n</code></pre>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1497118145, "post_id": 44476514, "comment_id": 75948341, "body": "How would you have access to the previous results?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1497118228, "post_id": 44476514, "comment_id": 75948364, "body": "You should probably look at <code>Control.Monad.Trans.State</code>. It doesn&#39;t do quite what you asked, but I think it&#39;s probably what you want."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1497121963, "post_id": 44476514, "comment_id": 75949460, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/3208258/memoization-in-haskell\">Memoization in Haskell?</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1497133330, "post_id": 44476514, "comment_id": 75952260, "body": "I&#39;m half in favor of the duplicate, except that the answers are very specialized to functions that take numbers."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1497186684, "post_id": 44476514, "comment_id": 75962426, "body": "You should clarify if you want this functionality on a specific function or on any function."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1497119572, "last_edit_date": 1497119572, "creation_date": 1497118875, "answer_id": 44476636, "question_id": 44476514, "link": "https://stackoverflow.com/questions/44476514/how-to-save-the-results-of-a-function/44476636#44476636", "title": "How to save the results of a function?", "body": "<p>I suppose what you're asking is, <em>how to memoise</em> a function. Memoisation means when a (possibly expensive) function has once been evaluated with some arguments <code>x,y,z</code> and is at some later point evaluated with the exact same arguments again, the processor won't actually need to do all the computation again but just look up the result in some sort of table.</p>\n\n<p>There are simple libraries for doing that. With <a href=\"http://hackage.haskell.org/package/MemoTrie\" rel=\"nofollow noreferrer\"><code>MemoTrie</code></a>:</p>\n\n<pre><code>import Data.MemoTrie\n\nf :: Int -&gt; Int\nf x = ... -- some expensive computation\n\nfm :: Int -&gt; Int\nfm = memo f\n</code></pre>\n\n<p>Now if you call <code>f 0</code> twice in a row, it will twice spend a long to to finish. OTOH, <code>fm 0</code> will only take long the first time, the second time it'll give the result almost immediately.</p>\n\n<p>If you know you only want to use <code>f</code> memoised, you can also define it this way right away:</p>\n\n<pre><code>f :: Int -&gt; Int\nf = memo $ \\x -&gt; ...\n</code></pre>\n\n<p><code>Int -&gt; Int</code> is just an example signature. The result of such a function can have any type you desire, and the arguments can also be pretty much any \u201cdiscrete\u201d type (any integral number, tuples, strings...).</p>\n\n<hr>\n\n<p><code>MemoTrie</code>, like most such libraries, will only store the results in RAM. So when your program exists and you start it completely new, the memoised results will be gone and need to be computed anew, after all. Storing results <em>persistently</em> is more involved. I'm not aware of any library that does this in an automatic fashion. What's a bit problematic is that the state of which arguments have already been tried is not really part of the Haskell semantics.</p>\n\n<p>I have recently dabbled with a project that does something very related, though.</p>\n\n<p><a href=\"https://github.com/leftaroundabout/lazy-hash\" rel=\"nofollow noreferrer\">https://github.com/leftaroundabout/lazy-hash</a></p>\n"}], "owner": {"reputation": 21, "user_id": 8132852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/335d66f35a48f936d7b6395163283c15?s=128&d=identicon&r=PG&f=1", "display_name": "CovenantMan", "link": "https://stackoverflow.com/users/8132852/covenantman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 418, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1497119572, "creation_date": 1497118074, "question_id": 44476514, "link": "https://stackoverflow.com/questions/44476514/how-to-save-the-results-of-a-function", "title": "How to save the results of a function?", "body": "<p>Just a general question:</p>\n\n<p>I am rather new to Haskell (and to programming in general, for that matter) and I would like to know how it is possible to save the results of a function no matter how often that function is executed. When I execute my function, I want the result to be saved somewhere, so that no matter how often I call the function with different parameters, I have access to all the previous results.</p>\n\n<p>Any help would be appreciated.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1497155938, "post_id": 44473663, "comment_id": 75955544, "body": "Maybe playing around in GHCi with more concrete types would help? For example, <code>traverse (id :: Maybe Int -&gt; Maybe Int)</code> has the type <code>(Traversable t) =&gt; t (Maybe Int) -&gt; Maybe (t Int)</code>. The <code>a</code> type parameter of <code>id</code> is separate from the <code>a</code> of <code>traverse</code>\u2014they\u2019re two local (type) variables that happen to have the same name. And the <code>a</code> of <code>id</code> can stand for any type of kind <code>*</code>, even a type of the form <code>x y</code> (like <code>Maybe Int</code>) or <code>x y z</code> (like <code>Either String Int</code>, or even <code>Int -&gt; String</code> = <code>(-&gt;) Int String</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 181, "user_id": 3511511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f695d53cc3acd300a9e119b40c9d7ac?s=128&d=identicon&r=PG", "display_name": "user12457", "link": "https://stackoverflow.com/users/3511511/user12457"}, "edited": false, "score": 0, "creation_date": 1497104205, "post_id": 44473776, "comment_id": 75944219, "body": "How could the same c have both type a and f b"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 181, "user_id": 3511511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f695d53cc3acd300a9e119b40c9d7ac?s=128&d=identicon&r=PG", "display_name": "user12457", "link": "https://stackoverflow.com/users/3511511/user12457"}, "edited": false, "score": 1, "creation_date": 1497105750, "post_id": 44473776, "comment_id": 75944688, "body": "But <code>a</code>, <code>f</code> and <code>b</code> are generic type <i>variables</i> as well."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 181, "user_id": 3511511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f695d53cc3acd300a9e119b40c9d7ac?s=128&d=identicon&r=PG", "display_name": "user12457", "link": "https://stackoverflow.com/users/3511511/user12457"}, "edited": false, "score": 1, "creation_date": 1497107826, "post_id": 44473776, "comment_id": 75945246, "body": "@user12457 I can understand your confusion. This is about Haskell&#39;s <a href=\"https://wiki.haskell.org/Type_inference\" rel=\"nofollow noreferrer\">type inference</a>. In the type signature of the traverse function <code>(a -&gt; f b)</code> means that the function that&#39;s provided as the first argument to <code>traverse</code> should take a type <code>a</code> which can be <i>any</i> type and return an applicative type. However as you have declared <code>sequenceA :: Applicative f =&gt; t (f a) -&gt; f (t a)</code> Haskell compiler resolves the type parameter (<code>a</code>) of the <code>id</code> function <code>(a -&gt; a)</code> as an applicative type. So in this case <code>id</code>&#39;s type signature can be thought as <code>f a -&gt; f a</code>"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 181, "user_id": 3511511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f695d53cc3acd300a9e119b40c9d7ac?s=128&d=identicon&r=PG", "display_name": "user12457", "link": "https://stackoverflow.com/users/3511511/user12457"}, "edited": false, "score": 1, "creation_date": 1497109928, "post_id": 44473776, "comment_id": 75945848, "body": "@user12457 If it helps, think of it this way: We know <code>c</code> must be the same as <code>a</code>. We also separately know <code>c</code> must be the same as <code>f b</code>. The only way both can be true is if <code>a</code> is the same as <code>f b</code>."}, {"owner": {"reputation": 181, "user_id": 3511511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f695d53cc3acd300a9e119b40c9d7ac?s=128&d=identicon&r=PG", "display_name": "user12457", "link": "https://stackoverflow.com/users/3511511/user12457"}, "edited": false, "score": 0, "creation_date": 1497111793, "post_id": 44473776, "comment_id": 75946421, "body": "Can anyone write code to demonstrate how it works. Thanks."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1497129955, "post_id": 44473776, "comment_id": 75951580, "body": "Choose to demonstrate how it works is ... a type checker. You can learn about writing those in the book <i>Types and Programming Languages</i>, by Benjamin Pierce. Or search online for lecture notes about programming language design by Shriram Krishnamurthi."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1497131133, "post_id": 44473776, "comment_id": 75951800, "body": "<i>Code</i> to demonstrate, I meant."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1497110396, "last_edit_date": 1497110396, "creation_date": 1497100921, "answer_id": 44473776, "question_id": 44473663, "link": "https://stackoverflow.com/questions/44473663/implementation-of-sequencea-using-traverse/44473776#44473776", "title": "implementation of sequenceA using traverse", "body": "<p>Let's first of all say that <code>id</code> has the type <code>id :: c -&gt; c</code> to make things <em>less complicated</em>. The <code>a</code> in a type signature of a function is <em>local</em> in the sense that the <code>a</code> of <code>id :: a -&gt; a</code> has <em>nothing</em> to do with the <code>a</code> in <code>traverse :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)</code>. <code>a</code> is just a type parameter.</p>\n\n<p>So now we have the expression:</p>\n\n<pre><code>traverse id\n</code></pre>\n\n<p>with:</p>\n\n<pre><code>traverse :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\nid       ::                   c -&gt; c\n</code></pre>\n\n<p>I wrote the <code>c -&gt; c</code> part at the same columns of the <code>a -&gt; f b</code> part to show how the Haskell type system interacts. It now derives that:</p>\n\n<pre><code>a   ~ c\nf b ~ c\n</code></pre>\n\n<p>So that means that <code>a ~ c ~ f b</code> and since type equality, like every equality relationship is <em>transitive</em>, it thus also means that <code>a ~ f b</code>. So now Haskell specializes <code>traverse id</code> into:</p>\n\n<pre><code>traverse id :: Applicative f =&gt; t a -&gt; f (t b)\ntraverse id :: Applicative f =&gt; t (f b) -&gt; f (t b) -- a ~ f b\n</code></pre>\n\n<p>So hence the type. The <code>id</code> type <em>in</em> <code>traverse id</code> has type <code>id :: f b -&gt; f b</code>.</p>\n"}], "owner": {"reputation": 181, "user_id": 3511511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f695d53cc3acd300a9e119b40c9d7ac?s=128&d=identicon&r=PG", "display_name": "user12457", "link": "https://stackoverflow.com/users/3511511/user12457"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 1, "accepted_answer_id": 44473776, "answer_count": 1, "score": 5, "last_activity_date": 1497110396, "creation_date": 1497100182, "last_edit_date": 1497106745, "question_id": 44473663, "link": "https://stackoverflow.com/questions/44473663/implementation-of-sequencea-using-traverse", "title": "implementation of sequenceA using traverse", "body": "<p>sequenceA is implemented as following in Data.Traversable</p>\n\n<pre><code> sequenceA :: Applicative f =&gt; t (f a) -&gt; f (t a)\n sequenceA = traverse id\n</code></pre>\n\n<p>I have trouble understanding the type of <code>traverse id</code>. <code>traverse</code> has the type: <code>traverse :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)</code> Its first parameter is of type: <code>(a -&gt; f b)</code> But in the case of <code>sequenceA</code>, the type of the id function is <code>(a -&gt; a)</code>. Where is f? </p>\n"}, {"tags": ["json", "haskell", "http-conduit"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497090482, "post_id": 44472216, "comment_id": 75939972, "body": "Can&#39;t you make <code>Storage</code> be an instance <code>FromJSON</code> as well?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1497090682, "post_id": 44472216, "comment_id": 75940012, "body": "please include the definition of <code>Storage</code> - why not use a <code>newtype</code> and <code>derive (FromJSON)</code>, using <code>GeneralizedNewtypeDeriving</code> or if you must use a <code>data</code>-decaration - why not <code>derive Generic</code> and write the one-liner given in <a href=\"https://hackage.haskell.org/package/aeson-1.2.0.0/docs/Data-Aeson.html\" rel=\"nofollow noreferrer\"><code>Data.Aeson</code> docs</a> or make <code>StorageList</code> a simple <code>type StorageList = [Storage]</code>"}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1497092650, "post_id": 44472216, "comment_id": 75940612, "body": "I added Storage. It is already an instance of FromJSON, or it wouldn&#39;t work."}, {"owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "edited": false, "score": 0, "creation_date": 1497105274, "post_id": 44472216, "comment_id": 75944548, "body": "I&#39;ve read on it and I don&#39;t understand how newtype would help me. The current code I&#39;ve pasted works perfectly fine, what I want is to remove StorageList object, which is just an intermediary type I use to take care of that &quot;data&quot; field. Basically what I need is a way to tell how to parse [Storage] instead of Storage, but you apparently can&#39;t do &quot;instance FromJSON [Storage] where&quot;, it doesn&#39;t compile"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497125314, "post_id": 44472216, "comment_id": 75950409, "body": "@Ulrar You can indeed write <code>instance FromJSON [Storage] where ...</code> so if you get an error, either the error is unrelated, or you need to enable some extensions (<code>FlexibleInstances</code>)."}], "owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1497105566, "creation_date": 1497090323, "last_edit_date": 1497105566, "question_id": 44472216, "link": "https://stackoverflow.com/questions/44472216/fromjson-object-implementation", "title": "FromJSON [Object] implementation", "body": "<p>I have a project where I need to parse JSON. I get a list of objects, but it's all contained inside the \"data\" key. Currently I have a little object to help me :</p>\n\n<pre><code>data StorageList = StorageList { sl :: [Storage] }\n\ninstance FromJSON StorageList where\n  parseJSON = withObject \"StorageList\" $ \\v -&gt; StorageList\n    &lt;$&gt; v .: \"data\"\n</code></pre>\n\n<p>Then I just use \"sl\" to get my actual list from the result.</p>\n\n<p>It works perfectly fine, but I think we'll all agree that it's ugly.\nI imagine there must be an easier way to parse that [Storage] directly, somehow telling parseJSON to just start from inside data.\nOh, and I'm using httpJSONEither from http-conduit, but if there is no way to do it with that I can change, I suppose.</p>\n\n<p>EDIT : Here is storage :</p>\n\n<pre><code>data Storage = Storage { storageId     :: Text\n                       , storageName   :: Text\n                       , storageNode   :: Text\n                       , storageSize   :: Int\n                       , storageUsed   :: Int\n                       } deriving Show\n\ninstance FromJSON Storage where\n  parseJSON = withObject \"Storage\" $ \\v -&gt; Storage\n    &lt;$&gt; v .: \"id\"\n    &lt;*&gt; v .: \"storage\"\n    &lt;*&gt; v .: \"node\"\n    &lt;*&gt; v .: \"maxdisk\"\n    &lt;*&gt; v .: \"disk\"\n</code></pre>\n\n<p>EDIT 2 : What I'm trying to parse has this look :</p>\n\n<pre><code>{\n  \"data\":\n  [\n    {\n      \"id\": \"X\",\n      \"storage\": \"X\",\n      ...\n    },\n    {\n      \"id\": \"Y\",\n      \"storage\": \"Y\",\n      ...\n    },\n    ...\n  ]\n}\n</code></pre>\n\n<p>Hoping that'll be clearer. I'm using that ugly \"StorageList\" object to get rid of that data key wrapping everything, and it works, but I'm sure there must be a better way to handle it.</p>\n"}, {"tags": ["haskell", "either", "alternative-functor", "semigroup"], "comments": [{"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 0, "creation_date": 1497090900, "post_id": 44472008, "comment_id": 75940073, "body": "This looks related: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9588\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/9588</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1497108494, "post_id": 44472441, "comment_id": 75945449, "body": "This is a great answer. Thanks for taking the time!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1497109102, "post_id": 44472441, "comment_id": 75945622, "body": "Sorry, one issue remains: <code>Just &quot;a&quot; &lt;&gt; Just &quot;b&quot; == Just &quot;ab&quot;</code> as expected, but <code>Right &quot;a&quot; &lt;&gt; Right &quot;b&quot; == Right &quot;a&quot;</code>. Why this difference?"}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 0, "creation_date": 1497110624, "post_id": 44472441, "comment_id": 75946068, "body": "Right, so the instance for <code>Semigroup</code> of <code>Either a b</code> is actually not defined the way you wrote it. It is entirely independent of whether <code>b</code> has an instance of <code>Semigroup</code> or not. It basically just discards a <code>Left</code> value when it is the left term of <code>(&lt;&gt;)</code> and otherwise return the left term. Checkout the actual source code <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/Data.Semigroup.html#line-173\" rel=\"nofollow noreferrer\">here</a> :-) I am not sure what the rationale behind this definition is but it works out pretty well for you since you seemed to want an <code>Alternative</code> instance."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1497116267, "post_id": 44472441, "comment_id": 75947761, "body": "@basile-henry I don&#39;t understand what&#39;s the problem with <code>Either</code> having kind <code>* -&gt; * -&gt; *</code>. It&#39;s not an explanation why <code>Either</code> can&#39;t be <code>Alternative</code>. For example, <code>Monad</code> also requires type to have kind <code>* -&gt; *</code> but there&#39;s <code>Monad</code> instance for <code>Either</code> \u2014 it just implemented as <code>Monad (Either e)</code> \u2014 partially applying <code>Either</code>. For example this compiles and works as expected: <a href=\"https://hastebin.com/duyituzuda.hs\" rel=\"nofollow noreferrer\">hastebin.com/duyituzuda.hs</a> Probably not laws are satisfied, didn&#39;t check it. But this is valid code and should be explaned, why not an option."}, {"owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "edited": false, "score": 0, "creation_date": 1497117146, "post_id": 44472441, "comment_id": 75948026, "body": "Well you just added a constraint that <code>e</code> needs to have an identity. It is a perfectly fine solution, and I have mentioned it (using <code>Alternative</code> instead of <code>Monoid</code> to get <code>empty</code>). I don&#39;t think you can do it without this constraint. I admit that the sentence describing this is pretty unclear and I should try to reword it better."}], "tags": [], "owner": {"reputation": 1247, "user_id": 3485629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/640b2583577ec470ac273b27f78025d5?s=128&d=identicon&r=PG", "display_name": "basile-henry", "link": "https://stackoverflow.com/users/3485629/basile-henry"}, "is_accepted": true, "score": 14, "last_activity_date": 1497108680, "last_edit_date": 1497108680, "creation_date": 1497091745, "answer_id": 44472441, "question_id": 44472008, "link": "https://stackoverflow.com/questions/44472008/why-is-there-no-alternative-instance-for-either-but-a-semigroup-that-behaves-sim/44472441#44472441", "title": "Why is there no alternative instance for Either but a semigroup that behaves similarily to alternative?", "body": "<p>What would you expect an <code>Alternative</code> instance to give you. I think a good way for you to get a feel for how <code>Alternative</code> and <code>Semigroup</code> differ is to look at another type that has instances for both: for example <code>Maybe String</code>:</p>\n\n\n\n<pre><code>\u03bb &gt; Just \"a\" &lt;&gt; Just \"b\"\nJust \"ab\"\n\u03bb &gt; Just \"a\" &lt;&gt; Nothing\nJust \"a\"\n\u03bb &gt; Nothing &lt;&gt; Just \"b\"\nJust \"b\"\n\u03bb &gt; Nothing &lt;&gt; Nothing\nNothing\n\n\n\u03bb &gt; Just \"a\" &lt;|&gt; Just \"b\"\nJust \"a\"\n\u03bb &gt; Just \"a\" &lt;|&gt; Nothing\nJust \"a\"\n\u03bb &gt; Nothing &lt;|&gt; Just \"b\"\nJust \"b\"\n\u03bb &gt; Nothing &lt;|&gt; Nothing\nNothing\n</code></pre>\n\n<p>Alright, so the main difference seems to be for <code>Just \"a\"</code> and <code>Just \"b\"</code>. This makes sense since you are combining them in the case of the <code>Semigroup</code> rather than taking the left biased option in the case of <code>Alternative</code>.</p>\n\n<p>Now why couldn't you have an <code>Alternative</code> instance for <code>Either</code>. If you look at the functions which are part of the <code>Alternative</code> type class:</p>\n\n\n\n<pre><code>\u03bb &gt; :i Alternative\nclass Applicative f =&gt; Alternative (f :: * -&gt; *) where\n  empty :: f a\n  (&lt;|&gt;) :: f a -&gt; f a -&gt; f a\n  some :: f a -&gt; f [a]\n  many :: f a -&gt; f [a]\n  {-# MINIMAL empty, (&lt;|&gt;) #-}\n</code></pre>\n\n<p>It looks like it defines a notion of <code>empty</code>; this is the identity of the <code>(&lt;|&gt;)</code> operator. The identity in the case means that the alternative between the identity and something else is always that something else.</p>\n\n<p>Now, how would you construct an identity for <code>Either e a</code>? If you look at the constraint on the <code>Alternative</code> instance, you can see that it requires <code>f</code> to have an <code>Applicative</code> instance. That's fine, <code>Either</code> has an <code>Applicative</code> instance declared for <code>Either e</code>. As you can see the <code>Either</code> is only an applicative functor on the second type variable (<code>a</code> in the case of <code>Either e a</code>). So an identity for <code>Either e</code> would need <code>e</code> to also have an identity. While it is possible to construct a type where <code>e</code> has an instance of <code>Alternative</code> you can't make an instance for <code>Alternative</code> for <code>Either</code> with that <code>e</code> because no such constraint is in the type class definition (something along the lines of: <code>(Alternative e, Applicative (f e)) =&gt; Alternative (f e)</code>).</p>\n\n<p><strong>TL;DR</strong>: I am sorry if I lost you with my rambling, the short of it is that <code>f</code> in the case of <code>Either</code> is of the wrong <em>kind</em>, <code>Alternative</code> requires <code>f :: * -&gt; *</code> while <code>Either</code> is of <em>kind</em> <code>Either :: * -&gt; * -&gt; *</code></p>\n\n<p>So <code>Maybe</code> can have an instance of <code>Alternative</code> because it has <em>kind</em> <code>Maybe : * -&gt; *</code> and has a notion of identity (<code>Nothing</code>) that is required by <code>empty</code>. Have a look at all the instances of <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Applicative.html#t:Alternative\" rel=\"noreferrer\"><code>Alternative</code></a> and pay attention to the kind of each instance data type.</p>\n\n<p>You can find the kind of a data type in ghci with <code>:k</code>:</p>\n\n\n\n<pre><code>\u03bb &gt; :k Maybe\nMaybe :: * -&gt; *\n\u03bb &gt; :k Either\nEither :: * -&gt; * -&gt; *\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1497120199, "post_id": 44476365, "comment_id": 75948982, "body": "The alternative type class seems to frequently cause <a href=\"https://stackoverflow.com/questions/28681260/why-is-there-not-alternative-instance-for-control-applicative-const\">problems</a>, also because of the underlying laws. Thanks!"}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 4, "last_activity_date": 1497117856, "last_edit_date": 1497117856, "creation_date": 1497117134, "answer_id": 44476365, "question_id": 44472008, "link": "https://stackoverflow.com/questions/44472008/why-is-there-no-alternative-instance-for-either-but-a-semigroup-that-behaves-sim/44476365#44476365", "title": "Why is there no alternative instance for Either but a semigroup that behaves similarily to alternative?", "body": "<p>Per the <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9588\" rel=\"nofollow noreferrer\">ticket</a> Dietrich Epp posted above, the issue with <code>Alternative</code> is <code>empty</code>. If you have:</p>\n\n<pre><code>instance Alternative (Either a) where ...\n</code></pre>\n\n<p>You'd need to be able to pull some value <code>Either a b</code> \"out of thin air\" that was your identity object. One possible instance might be:</p>\n\n<pre><code>instance (Monoid a)=&gt; Alternative (Either a) where \n  empty = Left mempty\n  ...\n</code></pre>\n\n<p>You also ask why the <code>Semigroup</code> instance is defined the way it is, and frankly I don't understand it either. It would seem that the instance you propose would also permit a (compatible/lawful) <code>Monoid</code> instance as well:</p>\n\n<pre><code>instance Monoid b=&gt; Monoid (Either a b) where\n  mempty = Right mempty\n</code></pre>\n\n<p>And this would be consistent with the <code>Maybe</code> instance (the algebraic relationship between Maybe and Either being obvious).</p>\n\n<p>So the situation isn't good. Part of the issue is <code>Alternative</code> is sort of a second-class class if you will; it is a monoidal higher-kinded thingy, but its relation to <code>Monoid</code> and <code>Semigroup</code>, which obviously and explicitly (in the docs) form a hierarchy, is not defined.</p>\n\n<p>I'm sure there's been a large amount of discussion on the libraries mailing list, and if there are some obvious \"correct\" solutions it's likely that moving to them could cause (in the worst case silent) breakage. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2320, "favorite_count": 2, "accepted_answer_id": 44472441, "answer_count": 2, "score": 14, "last_activity_date": 1614318790, "creation_date": 1497088866, "last_edit_date": 1614318790, "question_id": 44472008, "link": "https://stackoverflow.com/questions/44472008/why-is-there-no-alternative-instance-for-either-but-a-semigroup-that-behaves-sim", "title": "Why is there no alternative instance for Either but a semigroup that behaves similarily to alternative?", "body": "<p>I am a Haskell newbie and I wonder why there is no alternative instance for <code>Either</code> but a semigroup, which behaves as I would expect it from alternative:</p>\n\n<pre><code>instance Semigroup (Either a b) where\nLeft _ &lt;&gt; b = b\na      &lt;&gt; _ = a\n</code></pre>\n\n<p>This instance discards or corrects \"errors\" and when both operands are tagged with <code>Right</code>, it takes the first. Isn't this exactly the \"choice\" that alternative offers?</p>\n\n<p>I would expect the semigroup instance to look roughly like:</p>\n\n<pre><code>instance (Semigroup b) =&gt; Semigroup (Either a b) where\nLeft e  &lt;&gt; _       = Left e\n_       &lt;&gt; Left e  = Left e\nRight x &lt;&gt; Right y = Right (x &lt;&gt; y)\n</code></pre>\n\n<p>That means it propagates errors and appends regular results.</p>\n\n<p>I guess I have either a wrong notion of <code>Either</code> or of the involved type classes.</p>\n"}, {"tags": ["haskell", "syntax", "state-machine", "algebraic-data-types"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 6, "creation_date": 1497081173, "post_id": 44470651, "comment_id": 75937574, "body": "Local data type definitions are unsupported. You have to lift them to the top level of the module."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "edited": false, "score": 2, "creation_date": 1497389257, "post_id": 44527924, "comment_id": 76055344, "body": "I wouldn&#39;t want to encode state identifiers implicitly in terms of booleans or numbers if I can use an explicit enumeration or data type. <i>Local</i> function definition is meant to enable modularity, to protect the integrity of descriptive namespaces from single-relation/use clutter. I don&#39;t understand why <code>data</code> definitions in that respect should be treated differently."}], "tags": [], "owner": {"reputation": 4009, "user_id": 1549476, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/dxQHN.png?s=128&g=1", "display_name": "k_g", "link": "https://stackoverflow.com/users/1549476/k-g"}, "is_accepted": true, "score": 3, "last_activity_date": 1497390299, "last_edit_date": 1497390299, "creation_date": 1497374745, "answer_id": 44527924, "question_id": 44470651, "link": "https://stackoverflow.com/questions/44470651/local-data-type-definitions/44527924#44527924", "title": "Local data type definitions", "body": "<p>You can't put <code>data</code> definitions locally, only at the top level. However you could use a <code>Bool</code> and <code>if</code> rather than a custom data type and <code>case</code>.</p>\n\n<p>Alternatively, you can put the function and data type in their own module if you don't want to export the <code>data</code> type.</p>\n\n<p>It <a href=\"https://www.reddit.com/r/haskell/comments/4k84go/data_declarations_in_where_statements/\" rel=\"nofollow noreferrer\">has been proposed</a> to include this feature, but it isn't a priority for some reason. I guess generally people view types as high-level protocols between top-level functions, not typically between <code>where</code>-level functions.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 654, "favorite_count": 1, "accepted_answer_id": 44527924, "answer_count": 1, "score": 4, "last_activity_date": 1503412279, "creation_date": 1497078743, "last_edit_date": 1503412279, "question_id": 44470651, "link": "https://stackoverflow.com/questions/44470651/local-data-type-definitions", "title": "Local data type definitions", "body": "<p>Implementing finite state automata in Haskell, I'd like to do this:</p>\n\n<pre><code>zigzag :: Int -&gt; Int -&gt; [Int]\nzigzag low upp = fsa Incr low\n\n   where\n      data State = Incr | Decr\n\n      fsa :: State -&gt; Int -&gt; [Int]\n      fsa state n\n         = n : case state of\n                  Incr | n &lt; upp   -&gt; fsa Incr (n + 1)\n                       | otherwise -&gt; fsa Decr (n - 1)\n\n                  Decr | n &gt; low   -&gt; fsa Decr (n - 1)\n                       | otherwise -&gt; fsa Incr (n + 1)\n</code></pre>\n\n<p>But I can't:</p>\n\n<pre><code>error: parse error on input \u2018data\u2019\n</code></pre>\n\n<p>Is there a better way than to separate the <code>State</code> definition from <code>zigzag</code>?</p>\n\n<hr>\n\n<p>I wouldn't want to encode state identifiers implicitly in terms of booleans or numbers if I can use an explicit enumeration or data type. Local function definition is meant to enable modularity, to protect the integrity of descriptive namespaces from single-relation/use clutter. I don't understand why data definitions in that respect should be treated differently.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2559, "user_id": 65569, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d50725477c532d3a972760f317cc169f?s=128&d=identicon&r=PG", "display_name": "Bruno Martinez", "link": "https://stackoverflow.com/users/65569/bruno-martinez"}, "edited": false, "score": 0, "creation_date": 1497117533, "post_id": 44470843, "comment_id": 75948160, "body": "Thanks, Andr&#225;s. It makes sense now. What I don&#39;t understand is the error message.  Shouldn&#39;t ghc complain that n is unbound in Sing n?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 2559, "user_id": 65569, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d50725477c532d3a972760f317cc169f?s=128&d=identicon&r=PG", "display_name": "Bruno Martinez", "link": "https://stackoverflow.com/users/65569/bruno-martinez"}, "edited": false, "score": 1, "creation_date": 1497118971, "post_id": 44470843, "comment_id": 75948572, "body": "@BrunoMartinez GHC considers unbound type variables as new variables in the context, and lets you refer to them in later type annotations. So, it considers the <code>n</code> is <code>Sing n</code> a new variable unrelated to the <code>n</code> in the signature for <code>foo</code>."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1497085041, "last_edit_date": 1497085041, "creation_date": 1497080425, "answer_id": 44470843, "question_id": 44469481, "link": "https://stackoverflow.com/questions/44469481/convert-nat-from-type-family-call-into-integer/44470843#44470843", "title": "Convert Nat from type family call into Integer", "body": "<p>There are two issues with your code. First, <code>(sing :: Sing n)</code> does not have <code>n</code> in scope. You need explicit <code>forall</code> to bring it to scope.</p>\n\n<p>Second, if you want <code>SingI</code>, you need to say so. GHC does not know and never checks that <code>N t</code> is <code>SingI</code> for all <code>t</code>, which is not actually true, by the way: <code>N Bool</code> has kind <code>Nat</code> but there is no <code>SingI (N Bool)</code>.</p>\n\n<p>Hence, the solution:</p>\n\n<pre><code>foo :: forall t. SingI (N t) =&gt; t -&gt; Integer\nfoo _ = fromSing (sing :: Sing (N t))\n</code></pre>\n\n<p>Or with type applications:</p>\n\n<pre><code>foo :: forall t. SingI (N t) =&gt; t -&gt; Integer\nfoo _ = fromSing (sing @_ @(N t))\n</code></pre>\n"}], "owner": {"reputation": 2559, "user_id": 65569, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d50725477c532d3a972760f317cc169f?s=128&d=identicon&r=PG", "display_name": "Bruno Martinez", "link": "https://stackoverflow.com/users/65569/bruno-martinez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 44470843, "answer_count": 1, "score": 3, "last_activity_date": 1497085041, "creation_date": 1497068520, "question_id": 44469481, "link": "https://stackoverflow.com/questions/44469481/convert-nat-from-type-family-call-into-integer", "title": "Convert Nat from type family call into Integer", "body": "<pre><code>import Data.Singletons\nimport Data.Singletons.TypeLits\n\ntype family N t :: Nat where\n  N Int = 42\n  N String = 9\n\nfoo :: (n ~ N t) =&gt; t -&gt; Integer\nfoo _ = fromSing (sing :: Sing n)\n</code></pre>\n\n<p>fails with</p>\n\n<pre><code>\u2022 Could not deduce: DemoteRep * ~ Integer\n  from the context: n ~ N t\n    bound by the type signature for:\n               foo :: n ~ N t =&gt; t -&gt; Integer\n    at mini.hs:16:1-32\n\u2022 In the expression: fromSing (sing :: Sing n)\n  In an equation for \u2018foo\u2019: foo _ = fromSing (sing :: Sing n)\n</code></pre>\n\n<p>How can I fix it?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 4, "creation_date": 1497040361, "post_id": 44466131, "comment_id": 75929339, "body": "There is no such thing as a &quot;two-kinded&quot; Monad. All Monad instances are of kind <code>* -&gt; *</code>."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1497041660, "post_id": 44466131, "comment_id": 75929882, "body": "Like function application, type constructors associate left. So if you have <code>type Foo a b c d</code>then e.g. <code>Foo Int Char Bool</code> would have kind <code>* -&gt; *</code> and you could define <code>instance Monad (Foo Int Char Bool)</code>. You can write types with redundant parens if you want, like <code>:: (((Foo Int) Char) Bool) Baz</code>"}, {"owner": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "edited": false, "score": 0, "creation_date": 1497042609, "post_id": 44466131, "comment_id": 75930195, "body": "@ReinHeinrichs Read &quot;two-kinded data types that have a Monad instance&quot;"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1497046423, "post_id": 44466131, "comment_id": 75931435, "body": "@hgiesel Is &quot;two-kinded data types that have a Monad instance&quot; a blog post or something? If so, you should give us a link; Google doesn&#39;t turn up anything when I try."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1497052130, "post_id": 44466131, "comment_id": 75932792, "body": "So to be clear, we don&#39;t have <code>instance Monad State where ...</code> since <code>State</code> has kind <code>* -&gt; * -&gt; *</code>. It is <code>instance Monad (State s) where ...</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1497111688, "post_id": 44466131, "comment_id": 75946382, "body": "Maybe look into <a href=\"https://stackoverflow.com/questions/13556314/biapplicative-and-bimonad\">Biapplicative and Bimonad</a>"}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 10, "last_activity_date": 1497039956, "creation_date": 1497039956, "answer_id": 44466197, "question_id": 44466131, "link": "https://stackoverflow.com/questions/44466131/join-function-for-two-kinded-monads/44466197#44466197", "title": "join function for two-kinded monads", "body": "<p>The state monad type is declared as <code>State s a</code>;\nit only unifies with <code>m a</code> if <code>m ~ State s</code>.</p>\n\n<pre><code>join :: State s (State s a) -&gt; State s a\n</code></pre>\n"}], "owner": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 44466197, "answer_count": 1, "score": 0, "last_activity_date": 1497039956, "creation_date": 1497039666, "question_id": 44466131, "link": "https://stackoverflow.com/questions/44466131/join-function-for-two-kinded-monads", "title": "join function for two-kinded monads", "body": "<p>I'm trying to get a better understanding of monads.\nSo I'm trying to write return, join, and bind implementations for several monads.</p>\n\n<p>However when coming to two-kinded monads, I'm kind of confused</p>\n\n<pre><code>join :: m (m a) -&gt; m a\n</code></pre>\n\n<p><code>m (m a)</code> Implies monad wrapped inside of monad, but what value is implied if using two-kinded monads.\nFor example with the State Monad: <code>s</code> or <code>a</code>? What would the correct signature of join for the State Monad look like?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1497036595, "post_id": 44465149, "comment_id": 75927621, "body": "Nice example. The issue is that you can take the left branch, then the right one, then left, then right, forever, and so you have <code>5-1+1-1+1....</code> which never falls outside the interval, so it generates an infinitely deep tree."}], "answers": [{"comments": [{"owner": {"reputation": 9806, "user_id": 382982, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9ZaxF.jpg?s=128&g=1", "display_name": "pdoherty926", "link": "https://stackoverflow.com/users/382982/pdoherty926"}, "edited": false, "score": 0, "creation_date": 1497038325, "post_id": 44465368, "comment_id": 75928400, "body": "Thanks for sharing this answer. I now see that 1) this function is behaving as expected and 2) why that is the expected behavior."}], "tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": true, "score": 2, "last_activity_date": 1497036341, "creation_date": 1497036341, "answer_id": 44465368, "question_id": 44465149, "link": "https://stackoverflow.com/questions/44465149/should-recursive-function-call-terminate-or-is-its-implementation-faulty/44465368#44465368", "title": "Should recursive function call terminate or is its implementation faulty?", "body": "<p>Your implementation generates infinitely many calls to <code>unfold</code>.</p>\n\n<p>Consider the first recursive call, where your initial seed value of <code>5</code> is split into <code>4</code> and <code>6</code> for the left and right subtree. There you split this new seed into <code>3</code> and <code>5</code> on the left and <code>5</code> and <code>7</code> on the right, hence you define an infinitely large tree.</p>\n"}, {"comments": [{"owner": {"reputation": 9806, "user_id": 382982, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9ZaxF.jpg?s=128&g=1", "display_name": "pdoherty926", "link": "https://stackoverflow.com/users/382982/pdoherty926"}, "edited": false, "score": 0, "creation_date": 1497038312, "post_id": 44465411, "comment_id": 75928395, "body": "I wish I could select both answers, but I chose mschmidt&#39;s because it was submitted first."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 3, "last_activity_date": 1497036551, "creation_date": 1497036551, "answer_id": 44465411, "question_id": 44465149, "link": "https://stackoverflow.com/questions/44465149/should-recursive-function-call-terminate-or-is-its-implementation-faulty/44465411#44465411", "title": "Should recursive function call terminate or is its implementation faulty?", "body": "<p>The reason the program never terminates can be understood if you try to invoke <code>func</code> outside <code>unfold</code>. Here, I renamed <code>func</code> to <code>unfolder</code>, because the Haskell linter didn't like that it had the same name as the <code>func</code> argument.</p>\n\n<p>Close to the boundaries, <code>unfolder</code> returns these values:</p>\n\n<pre><code>*So&gt; unfolder 1\nJust (0,1,2)\n*So&gt; unfolder 0\nJust (-1,0,1)\n*So&gt; unfolder (-1)\nNothing\n</code></pre>\n\n<p>For <code>unfolder 0</code>, the <em>left</em> branch clearly evaluates to <code>Nothing</code> the next time around, but the <em>right</em> branch is <code>unfolder 1</code>, which evaluates to <code>Just (0,1,2)</code>, and so on ad infinitum.</p>\n"}], "owner": {"reputation": 9806, "user_id": 382982, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9ZaxF.jpg?s=128&g=1", "display_name": "pdoherty926", "link": "https://stackoverflow.com/users/382982/pdoherty926"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 44465368, "answer_count": 2, "score": 3, "last_activity_date": 1497036551, "creation_date": 1497035373, "question_id": 44465149, "link": "https://stackoverflow.com/questions/44465149/should-recursive-function-call-terminate-or-is-its-implementation-faulty", "title": "Should recursive function call terminate or is its implementation faulty?", "body": "<p>I'm working my way through <em>Haskell Programming From First Principles</em> and am stuck proving that I've correctly answered question 1 of the <em>Finally something other than a list</em> exercise subsection. The following function invocation doesn't terminate and I can't tell if that's expected or if my implementation is faulty.</p>\n\n<pre><code>data BinaryTree a = Leaf \n                  | Node (BinaryTree a) a (BinaryTree a) \n                    deriving (Eq, Ord, Show)\n\nunfold :: (a -&gt; Maybe (a, b, a)) -&gt; a -&gt; BinaryTree b\nunfold func seed = \n  case (func seed) of\n    Just (l, m, r) -&gt; Node (unfold func l) m (unfold func r)\n    Nothing -&gt; Leaf\n</code></pre>\n\n<p>I would <em>think</em> that each <code>a</code>/<code>x</code> would eventually be decremented/incremented until it causes the <code>if</code> to take the <code>True</code> branch and return a <code>Nothing</code>/<code>Leaf</code>.</p>\n\n<pre><code>func = (\\x -&gt; if (x &lt; 0 || x &gt; 10) \n                then Nothing  \n                else Just (x - 1, x, x + 1))\nunfold func 5\n-- Node (Node (Node (Node (Node (Node Leaf 0 ... ad infinitum\n</code></pre>\n"}, {"tags": ["regex", "haskell", "permutation"], "comments": [{"owner": {"reputation": 1091, "user_id": 7963408, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/086ccd4f08c6258f6f4cdb1f3b259999?s=128&d=identicon&r=PG&f=1", "display_name": "Gawil", "link": "https://stackoverflow.com/users/7963408/gawil"}, "edited": false, "score": 0, "creation_date": 1497022916, "post_id": 44461587, "comment_id": 75920104, "body": "Can the string be more than 5 characters long ? Like <code>XXblablaX.X</code> ?"}, {"owner": {"reputation": 15, "user_id": 6763137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/22f38bf16cac8d462bd050ef97dcee66?s=128&d=identicon&r=PG&f=1", "display_name": "Enri", "link": "https://stackoverflow.com/users/6763137/enri"}, "reply_to_user": {"reputation": 1091, "user_id": 7963408, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/086ccd4f08c6258f6f4cdb1f3b259999?s=128&d=identicon&r=PG&f=1", "display_name": "Gawil", "link": "https://stackoverflow.com/users/7963408/gawil"}, "edited": false, "score": 0, "creation_date": 1497023317, "post_id": 44461587, "comment_id": 75920371, "body": "No, the string I&#39;m looking for is exactly 5 characters long."}], "answers": [{"comments": [{"owner": {"reputation": 1091, "user_id": 7963408, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/086ccd4f08c6258f6f4cdb1f3b259999?s=128&d=identicon&r=PG&f=1", "display_name": "Gawil", "link": "https://stackoverflow.com/users/7963408/gawil"}, "edited": false, "score": 0, "creation_date": 1497023843, "post_id": 44462068, "comment_id": 75920696, "body": "Wow... Nice work ! However I think it&#39;s a bit too much for his simple question ^^"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1091, "user_id": 7963408, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/086ccd4f08c6258f6f4cdb1f3b259999?s=128&d=identicon&r=PG&f=1", "display_name": "Gawil", "link": "https://stackoverflow.com/users/7963408/gawil"}, "edited": false, "score": 0, "creation_date": 1497023954, "post_id": 44462068, "comment_id": 75920781, "body": "@Gawil I think it&#39;s simpler to write readable code using a library that&#39;s fit for purpose than it is to abuse RE lookahead."}, {"owner": {"reputation": 1091, "user_id": 7963408, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/086ccd4f08c6258f6f4cdb1f3b259999?s=128&d=identicon&r=PG&f=1", "display_name": "Gawil", "link": "https://stackoverflow.com/users/7963408/gawil"}, "edited": false, "score": 0, "creation_date": 1497024082, "post_id": 44462068, "comment_id": 75920864, "body": "Abuse RE lookahead ? Don&#39;t over react like that."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1091, "user_id": 7963408, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/086ccd4f08c6258f6f4cdb1f3b259999?s=128&d=identicon&r=PG&f=1", "display_name": "Gawil", "link": "https://stackoverflow.com/users/7963408/gawil"}, "edited": false, "score": 0, "creation_date": 1497024444, "post_id": 44462068, "comment_id": 75921070, "body": "@Gawil Apologies. I just meant that regexes, even with lookahead, weren&#39;t designed for this, and while it&#39;s possible to do it with regexes the resulting expressions aren&#39;t exactly simple or readable."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 6, "last_activity_date": 1497335725, "last_edit_date": 1497335725, "creation_date": 1497023656, "answer_id": 44462068, "question_id": 44461587, "link": "https://stackoverflow.com/questions/44461587/finding-permutations-using-regular-expressions/44462068#44462068", "title": "Finding permutations using regular expressions", "body": "<p>That's called <em>permutation parsing</em>, and while \"pure\" regular expressions can't parse permutations it's possible if your regex engine supports lookahead. (See <a href=\"https://stackoverflow.com/a/24891932/1523776\">this answer</a> for an example.)</p>\n\n<p>However I find the regex in the linked answer difficult to understand. It's cleaner in my opinion to use a library designed for permutation parsing, such as <a href=\"https://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\"><code>megaparsec</code></a>.</p>\n\n<p>You use the <a href=\"https://hackage.haskell.org/package/megaparsec-5.3.0/docs/Text-Megaparsec-Perm.html\" rel=\"nofollow noreferrer\"><code>Text.Megaparsec.Perm</code></a> module by building a <a href=\"https://hackage.haskell.org/package/megaparsec-5.3.0/docs/Text-Megaparsec-Perm.html#t:PermParser\" rel=\"nofollow noreferrer\"><code>PermParser</code></a> in a quasi-<code>Applicative</code> style using the <a href=\"https://hackage.haskell.org/package/megaparsec-5.3.0/docs/Text-Megaparsec-Perm.html#v:-60--124--124--62-\" rel=\"nofollow noreferrer\"><code>&lt;||&gt;</code></a> operator, then converting it into a regular <a href=\"https://hackage.haskell.org/package/megaparsec-5.3.0/docs/Text-Megaparsec-Prim.html#t:MonadParsec\" rel=\"nofollow noreferrer\"><code>MonadParsec</code></a> action using <a href=\"https://hackage.haskell.org/package/megaparsec-5.3.0/docs/Text-Megaparsec-Perm.html#v:makePermParser\" rel=\"nofollow noreferrer\"><code>makePermParser</code></a>.</p>\n\n<p>So here's a parser which recognises any combination of four <code>X</code>s and one <code>.</code>:</p>\n\n<pre><code>import Control.Applicative\nimport Data.Ord\nimport Data.List\nimport Text.Megaparsec\nimport Text.Megaparsec.Perm\n\nfourXoneDot :: Parsec Dec String String\nfourXoneDot = makePermParser $ mkFive &lt;$$&gt; x &lt;||&gt; x &lt;||&gt; x &lt;||&gt; x &lt;||&gt; dot\n    where mkFive a b c d e = [a, b, c, d, e]\n          x = char 'X'\n          dot = char '.'\n</code></pre>\n\n<p>I'm applying the <code>mkFive</code> function, which just stuffs its arguments into a five-element list, to four instances of the <code>x</code> parser and one <code>dot</code>, combined with <code>&lt;||&gt;</code>.</p>\n\n<pre><code>ghci&gt; parse fourXoneDot \"\" \"XXXX.\"\nRight \"XXXX.\"\nghci&gt; parse fourXoneDot \"\" \"XX.XX\"\nRight \"XXXX.\"\nghci&gt; parse fourXoneDot \"\" \"XX.X\"\nLeft {- ... -}\n</code></pre>\n\n<p>This parser always returns <code>\"XXXX.\"</code> because that's the order I combined the parsers in: I'm mapping <code>mkFive</code> over the five parsers and it doesn't reorder its arguments. If you want the permutation parser to return its input string exactly, the trick is to <a href=\"https://hackage.haskell.org/package/megaparsec-5.3.0/docs/Text-Megaparsec.html#v:getPosition\" rel=\"nofollow noreferrer\">track the current position</a> within the component parsers, and then sort the output.</p>\n\n<pre><code>fourXoneDotSorted :: Parsec Dec String String\nfourXoneDotSorted = makePermParser $ mkFive &lt;$$&gt; x &lt;||&gt; x &lt;||&gt; x &lt;||&gt; x &lt;||&gt; dot\n\n    where mkFive a b c d e = map snd $ sortBy (comparing fst) [a, b, c, d, e]\n          x = withPos (char 'X')\n          dot = withPos (char '.')\n          withPos = liftA2 (,) getPosition\n\nghci&gt; parse fourXoneDotSorted \"\" \"XX.XX\"\nRight \"XX.XX\"\n</code></pre>\n\n<p>As <a href=\"https://hackage.haskell.org/package/megaparsec-5.3.0/docs/Text-Megaparsec-Perm.html\" rel=\"nofollow noreferrer\">the <code>megaparsec</code> docs</a> note, the implementation of the <code>Text.Megaparsec.Perm</code> module is based on <a href=\"http://foswiki.cs.uu.nl/foswiki/pub/USCS/InterestingPapers/PermutationsJFP.pdf\" rel=\"nofollow noreferrer\"><em>Parsing Permutation Phrases</em></a>; the idea is described in detail in the paper and <a href=\"http://www.cs.ox.ac.uk/jeremy.gibbons/wg21/meeting56/loeh-slides.pdf\" rel=\"nofollow noreferrer\">the accompanying slides</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 15, "user_id": 6763137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/22f38bf16cac8d462bd050ef97dcee66?s=128&d=identicon&r=PG&f=1", "display_name": "Enri", "link": "https://stackoverflow.com/users/6763137/enri"}, "edited": false, "score": 0, "creation_date": 1497026205, "post_id": 44462085, "comment_id": 75922096, "body": "Unfortunately, I have everything mixed, so the second regex won&#39;t work. The first one doesn&#39;t work with haskell: lexical error in string/character literal at character &#39;S&#39;"}, {"owner": {"reputation": 1091, "user_id": 7963408, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/086ccd4f08c6258f6f4cdb1f3b259999?s=128&d=identicon&r=PG&f=1", "display_name": "Gawil", "link": "https://stackoverflow.com/users/7963408/gawil"}, "reply_to_user": {"reputation": 15, "user_id": 6763137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/22f38bf16cac8d462bd050ef97dcee66?s=128&d=identicon&r=PG&f=1", "display_name": "Enri", "link": "https://stackoverflow.com/users/6763137/enri"}, "edited": false, "score": 0, "creation_date": 1497251911, "post_id": 44462085, "comment_id": 75980348, "body": "@Enri: Oh my bad... I thought Haskell would handle \\S. You can replace it easily though, I&#39;ll update my answer."}], "tags": [], "owner": {"reputation": 1091, "user_id": 7963408, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/086ccd4f08c6258f6f4cdb1f3b259999?s=128&d=identicon&r=PG&f=1", "display_name": "Gawil", "link": "https://stackoverflow.com/users/7963408/gawil"}, "is_accepted": false, "score": 0, "last_activity_date": 1497252166, "last_edit_date": 1497252166, "creation_date": 1497023700, "answer_id": 44462085, "question_id": 44461587, "link": "https://stackoverflow.com/questions/44461587/finding-permutations-using-regular-expressions/44462085#44462085", "title": "Finding permutations using regular expressions", "body": "<p>Try the following regex :<br />\n<code>(?&lt;=^| )(?=[^. ]*\\.)(?=(?:[^X ]*X){4}).{5}(?=$| )</code><br /><br /></p>\n\n<p>Demo <a href=\"https://regex101.com/r/YTmcCR/4\" rel=\"nofollow noreferrer\">here</a><br /><br />\nIf you have one word per string, you can simplify the regex by this one :<br />\n<code>^(?=[^. \\n]*\\.)(?=(?:[^X \\n]*X){4}).{5}$</code><br /><br />\nDemo <a href=\"https://regex101.com/r/YTmcCR/5\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1497112065, "post_id": 44465059, "comment_id": 75946510, "body": "+1, this is a nice and simple answer for the question as posed. But, <i>caveat lector</i>, the size of the regex blows up exponentially with the size of the alphabet, so I wouldn&#39;t recommend this approach for anything much more complex than this"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1497035060, "creation_date": 1497035060, "answer_id": 44465059, "question_id": 44461587, "link": "https://stackoverflow.com/questions/44461587/finding-permutations-using-regular-expressions/44465059#44465059", "title": "Finding permutations using regular expressions", "body": "<p>The other answers look quite complicated to me, given that there are only five strings in this language. Here's a perfectly fine and very readable regex for this:</p>\n\n<pre><code>\\.XXXX|X\\.XXX|XX\\.XX|XXX\\.X|XXXX\\.\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "is_accepted": false, "score": 2, "last_activity_date": 1497053509, "creation_date": 1497053509, "answer_id": 44468229, "question_id": 44461587, "link": "https://stackoverflow.com/questions/44461587/finding-permutations-using-regular-expressions/44468229#44468229", "title": "Finding permutations using regular expressions", "body": "<p>Are you attached to regex, or did you just end up at regex because this was a question you didn't want to try answering with applicative parsers?</p>\n\n<p>Here's the simplest possible attoparsec implementation I can think of:</p>\n\n<pre><code>parseDotXs :: Parser ()\nparseDotXs = do\n  dotXs &lt;- count 5 (satisfy (inClass \".X\"))\n  let (dots,xS) = span (=='.') . sort $ dotXs\n  if (length dots == 1) &amp;&amp; (length xS == 4) then do\n     return ()\n  else do\n     fail \"Mismatch between dots and Xs\"\n</code></pre>\n\n<p>You may need to adjust slightly depending on your input type.</p>\n\n<p>There are tons of fancy ways to do stuff in applicative parsing land, but there is no rule saying you can't just do things the rock-stupid simple way.</p>\n"}], "owner": {"reputation": 15, "user_id": 6763137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/22f38bf16cac8d462bd050ef97dcee66?s=128&d=identicon&r=PG&f=1", "display_name": "Enri", "link": "https://stackoverflow.com/users/6763137/enri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 0, "accepted_answer_id": 44462068, "answer_count": 4, "score": 1, "last_activity_date": 1497335725, "creation_date": 1497022073, "question_id": 44461587, "link": "https://stackoverflow.com/questions/44461587/finding-permutations-using-regular-expressions", "title": "Finding permutations using regular expressions", "body": "<p>I need to create a regular expression (for program in haskell) that will catch the strings containing \"X\" and \".\", assuming that there are 4 \"X\" and only one \".\". It cannot catch any string with other X-to-dot relations.\nI have thought about something like</p>\n\n<pre><code>[X\\.]{5}\n</code></pre>\n\n<p>But it catches also \"XXXXX\" or \".....\", so it isn't what I need.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1497018190, "post_id": 44460120, "comment_id": 75916853, "body": "I think (not sure) that stack will only use system ghc if dependency resolver finds it suitable. Check if one of your dependencies require ghc8."}, {"owner": {"reputation": 93, "user_id": 3623495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4HQRv.jpg?s=128&g=1", "display_name": "Stefano Cerruti", "link": "https://stackoverflow.com/users/3623495/stefano-cerruti"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1497019234, "post_id": 44460120, "comment_id": 75917669, "body": "thx for the comment. I&#39;ve checked with stack list-dependencies  ` stack list-dependencies base 4.9.1.0 ghc-prim 0.5.0.0 haskell-primer 0.1.0.0 integer-gmp 1.0.0.1 rts 1.0`"}, {"owner": {"reputation": 93, "user_id": 3623495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4HQRv.jpg?s=128&g=1", "display_name": "Stefano Cerruti", "link": "https://stackoverflow.com/users/3623495/stefano-cerruti"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1497021473, "post_id": 44460120, "comment_id": 75919270, "body": "overriding the resolver INTO the stack.yaml seems to work. I edited it to use lts-6.35 and now it map to the system-ghc.  But... I don&#39;t know if it&#39;s a solution to the problem. I don&#39;t want to manually edit all my stack.yaml files..."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1497062025, "post_id": 44460120, "comment_id": 75934305, "body": "Why do you need to use the system GHC? Specify your required <code>lts</code> in the <code>stack.yaml</code> file and stack will use whatever version of GHC you require. This is the correct way of picking a specific version of GHC for a specific project."}], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 15, "last_activity_date": 1586774586, "last_edit_date": 1592644375, "creation_date": 1497025011, "answer_id": 44462470, "question_id": 44460120, "link": "https://stackoverflow.com/questions/44460120/haskell-stack-doesnt-use-system-ghc/44462470#44462470", "title": "Haskell Stack doesn&#39;t use system Ghc", "body": "<p>Setting <code>system-ghc: true</code> <em>allows</em> Stack to use the system GHC if it matches the resolver's constraints. It will not <em>force</em> Stack to use the system GHC if it does not match the constraints. If your resolver requires GHC 8 but your system has GHC 7 then Stack will not use your system GHC no matter what value you give <code>system-ghc</code>. Conversely, if <code>system-ghc: false</code> then Stack will <em>never</em> use the system GHC, regardless of whether its version matches.</p>\n<p>From the <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/faq.md\" rel=\"noreferrer\">Stack FAQ</a>, emphasis mine:</p>\n<blockquote>\n<p>If you would like stack to use your system GHC installation, use the <code>--system-ghc</code> flag or run <code>stack config set system-ghc --global true</code> to make stack check your PATH for a suitable GHC by default.</p>\n<p>Note that <strong>stack can only use a system GHC installation if its version is compatible with the configuration of the current project, particularly the <code>resolver</code> setting</strong>.</p>\n</blockquote>\n"}], "owner": {"reputation": 93, "user_id": 3623495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4HQRv.jpg?s=128&g=1", "display_name": "Stefano Cerruti", "link": "https://stackoverflow.com/users/3623495/stefano-cerruti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2475, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1586774586, "creation_date": 1497017817, "last_edit_date": 1497019535, "question_id": 44460120, "link": "https://stackoverflow.com/questions/44460120/haskell-stack-doesnt-use-system-ghc", "title": "Haskell Stack doesn&#39;t use system Ghc", "body": "<p>I'm trying to use Haskell Stack to setup a project but using the stack provided ghc I am having a -fPIC error\n<a href=\"https://github.com/commercialhaskell/stack/issues/3203\" rel=\"noreferrer\">GitHub issue</a></p>\n\n<p>To bypass the fPIC problem I'm trying to use a package manager provided GHC using the 7.10.3 version (stack currently is using 8.0.2)</p>\n\n<p>When I try to force stack to use the systm ghc it simply ignores me. \nI've tried to override using /home/user/.stack/config.yaml and {project}/stack.yaml system-ghc : true option... but stack use the 8.0.2 version in the setup.</p>\n\n<p>Am I missing something?</p>\n\n<p>TL;DR</p>\n\n<p>Stack ignore the system-ghc : true option</p>\n\n<p>I'm runnig Sabayon 16</p>\n\n<hr>\n\n<p>\"haskell-primer\" is the project name</p>\n\n<pre><code>stack list-dependencies\n\nbase 4.9.1.0\nghc-prim 0.5.0.0\nhaskell-primer 0.1.0.0\ninteger-gmp 1.0.0.1\nrts 1.0\n</code></pre>\n"}, {"tags": ["haskell", "https", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1497187842, "post_id": 44459409, "comment_id": 75962777, "body": "This may be useful to look at too: <a href=\"https://stackoverflow.com/questions/36732299/how-to-redirect-requests-from-domain-com-to-www-domain-in-wai-warp-app\" title=\"how to redirect requests from domain com to www domain in wai warp app\">stackoverflow.com/questions/36732299/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 215, "user_id": 2035316, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b84b148152679b9172a63ebb10a64f69?s=128&d=identicon&r=PG", "display_name": "Deck Pope", "link": "https://stackoverflow.com/users/2035316/deck-pope"}, "edited": false, "score": 0, "creation_date": 1497363895, "post_id": 44484318, "comment_id": 76040478, "body": "If it&#39;s not possible to run multiple httpServe, you could potentially create a separate application just for this. Or possibly run it in an additional thread."}], "tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 1, "last_activity_date": 1497187294, "creation_date": 1497187294, "answer_id": 44484318, "question_id": 44459409, "link": "https://stackoverflow.com/questions/44459409/redirect-to-https-with-snap/44484318#44484318", "title": "Redirect to https with Snap", "body": "<p>I'm not too familiar with Snap, I'm guessing you could probably achieve this by adding an additional httpServe for port 80, and then doing a redirect if executed (to the https:// version). </p>\n"}], "owner": {"reputation": 215, "user_id": 2035316, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b84b148152679b9172a63ebb10a64f69?s=128&d=identicon&r=PG", "display_name": "Deck Pope", "link": "https://stackoverflow.com/users/2035316/deck-pope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1497187294, "creation_date": 1497015817, "question_id": 44459409, "link": "https://stackoverflow.com/questions/44459409/redirect-to-https-with-snap", "title": "Redirect to https with Snap", "body": "<p>i have this code to start a snap app over https:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  -- get the port from the ENV , it should be in /etc/profile as any other ENV variable or $ export BIND_PORT=8000\n  a &lt;- lookupEnv \"BIND_PORT\"\n  let port = displayResult a\n  liftIO $ createDirectoryIfMissing True \"img\"\n  httpServe (setPort (read port) config) Main.skite\n    where\n     config =\n         setSSLPort 443 $\n         setSSLCert \"/etc/letsencrypt/../cert.pem\" $\n         setSSLKey \"/etc/letsencrypt/../privkey.pem\" $\n         setSSLBind \"0.0.0.0\" $\n         setSSLChainCert False $\n         defaultConfig\n\nskite :: Snap ()\nskite = do\n    req &lt;- fmap rqHostName getRequest\n    reqPath &lt;- fmap rqPathInfo getRequest\n    routes req reqPath\n  where\n    routes req reqPath =\n        Rain.skite\n</code></pre>\n\n<p>Now, when i am browsing with <code>example.com</code> is not forwarded to <code>https://example.com</code>. Is there any builtin functionality to do this?</p>\n"}, {"tags": ["haskell", "tree", "purely-functional"], "answers": [{"comments": [{"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1497016933, "post_id": 44458910, "comment_id": 75915864, "body": "I&#39;ve already read it. They reimplemented <code>Tree</code>. You haven&#39;t answered my question though. Can <code>Set type is a Tree with ordered elements</code> be expressed in Haskell. Maybe not with type alias, but without reimplementing tree. Yes or no? And why yes or no."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1497025832, "post_id": 44458910, "comment_id": 75921899, "body": "No, because &quot;Set type is a Tree with ordered elements&quot; is not a true statement. It is possible to represent a Set as a Tree with ordered elements, but something like your imagined <code>type Set a = Ord a =&gt; Tree a</code> isn&#39;t sufficient. As Carl mentions above, you need further guarantees on the structure of the tree. In particular, you need invariants that can&#39;t be enforced (or even described) by Haskell&#39;s type system."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 2, "last_activity_date": 1497014360, "creation_date": 1497014360, "answer_id": 44458910, "question_id": 44458721, "link": "https://stackoverflow.com/questions/44458721/is-it-possible-to-represent-set-as-tree-in-haskell/44458910#44458910", "title": "Is it possible to represent Set as Tree in Haskell?", "body": "<p>This is exactly what <code>Data.Set</code> module from <code>containers</code> library does:</p>\n\n<p><a href=\"http://hackage.haskell.org/package/containers-0.5.10.2/docs/src/Data-Set-Internal.html#Set\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/containers-0.5.10.2/docs/src/Data-Set-Internal.html#Set</a></p>\n\n<p>You can try to read it's implementation. <code>type Set = Tree Ord</code> won't compile if you're not using some exotic language extensions. But you're probably don't want to use them and more interested in functions like:</p>\n\n<pre><code>insert :: Ord a =&gt; a -&gt; Tree a -&gt; Tree a\nfind   :: Ord a =&gt; a -&gt; Tree a -&gt; Maybe a\ndelete :: Ord a =&gt; a -&gt; Tree a -&gt; Tree a\n</code></pre>\n\n<p>This is how type classes meant to be used.</p>\n"}, {"comments": [{"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1497017143, "post_id": 44459193, "comment_id": 75916035, "body": "Hmm, well how about sharing traversable and other stuff? There must be something common right? They both trees, you know. I&#39;m not intended to do anything with it. It&#39;s just an exercise."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 1, "creation_date": 1497019056, "post_id": 44459193, "comment_id": 75917546, "body": "@user1685095 You can&#39;t even really write a <code>Traversable</code> instance for a BST. <code>runIdentity . traverse (pure . negate)</code>, for instance. Yeah, that&#39;s just a glorified <code>fmap negate</code>, but that just shows that the problem comes at a lower level than <code>Traversable</code>. You can even go further and ask if a structural <code>Eq</code> instance is what you want for a BST - wouldn&#39;t you rather have <code>Eq</code> test that they contain the same elements, rather than requiring identical structure as well?"}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1497026003, "post_id": 44459193, "comment_id": 75921999, "body": "Thanks for you answer!"}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 3, "last_activity_date": 1497015231, "creation_date": 1497015231, "answer_id": 44459193, "question_id": 44458721, "link": "https://stackoverflow.com/questions/44458721/is-it-possible-to-represent-set-as-tree-in-haskell/44459193#44459193", "title": "Is it possible to represent Set as Tree in Haskell?", "body": "<p>Do you intend to use the tree as a binary search tree (BST)?  For that to work, you need all operations to preserve the strong BST property: for each <code>Node</code> constructor in the BST, all <code>Node</code>s in the left subtree contain elements less than the one in the current <code>Node</code>, all <code>Node</code>s in the right subtree contain elements greater.</p>\n\n<p>You absolutely <em>need</em> to preserve that property. Once it's no longer true, all further BST operations lose correctness guarantees.  This conclusion has consequences. You can't expose the constructors of the type. You can't expose operations to work on it that don't preserve the BST property.</p>\n\n<p>So every operation that operates on a set needs to have access to the <code>Ord</code> instance for the type constrained in the node.  (Well, other than a couple special cases like checking if a set is empty or creating a singleton set, which never have to deal with the order of children.)</p>\n\n<p>At that point, what exactly can you share about the tree type with other uses?  You can't share operations.  You can't use the constructors. That leaves, well.. nothing useful. You could share the name of the type with no ways to do much of anything with it.</p>\n\n<p>So, no..  You can't share a binary search tree data type with other uses that just seek an arbitrary binary tree. Attempting to do so just results in a broken BST.</p>\n"}], "owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 444, "favorite_count": 0, "accepted_answer_id": 44459193, "answer_count": 2, "score": 0, "last_activity_date": 1497015231, "creation_date": 1497013816, "question_id": 44458721, "link": "https://stackoverflow.com/questions/44458721/is-it-possible-to-represent-set-as-tree-in-haskell", "title": "Is it possible to represent Set as Tree in Haskell?", "body": "<p>I'm reading Purely Functional Data Structres and trying to solve exercises they give in haskell.</p>\n\n<p>I've defined <code>Tree</code> in a standard way <code>data Tree a = Empty | Node a (Tree a) (Tree a)</code>\nI'd like to define <code>Set</code> as <code>Tree</code> where nodes are instance of <code>Ord</code>. Is there a way to express this in Haskell? Something like <code>type Set = Tree Ord</code> or I deemed to reimplement tree every time I want express some data structure as tree?</p>\n"}, {"tags": ["haskell", "ssl", "https", "lets-encrypt", "haskell-snap-framework"], "answers": [{"tags": [], "owner": {"reputation": 215, "user_id": 2035316, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b84b148152679b9172a63ebb10a64f69?s=128&d=identicon&r=PG", "display_name": "Deck Pope", "link": "https://stackoverflow.com/users/2035316/deck-pope"}, "is_accepted": true, "score": 0, "last_activity_date": 1497009461, "creation_date": 1497009461, "answer_id": 44457218, "question_id": 44456586, "link": "https://stackoverflow.com/questions/44456586/https-with-snap-in-production/44457218#44457218", "title": "HTTPS with Snap in production", "body": "<p>I did it:</p>\n\n<p>First of all i added this two lines to the config</p>\n\n<pre><code>     setSSLBind \"0.0.0.0\" $\n     setSSLChainCert False $\n</code></pre>\n\n<p>After this, is very important to build with <code>ghc -threaded</code> and this will get it up and running</p>\n"}], "owner": {"reputation": 215, "user_id": 2035316, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b84b148152679b9172a63ebb10a64f69?s=128&d=identicon&r=PG", "display_name": "Deck Pope", "link": "https://stackoverflow.com/users/2035316/deck-pope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 44457218, "answer_count": 1, "score": 3, "last_activity_date": 1497260491, "creation_date": 1497007497, "last_edit_date": 1497260491, "question_id": 44456586, "link": "https://stackoverflow.com/questions/44456586/https-with-snap-in-production", "title": "HTTPS with Snap in production", "body": "<p>I have the following configuration for my Snap</p>\n\n<pre><code>  Local.withPool 2 $ \\pool -&gt; do\nLocal.parallel_ pool [ httpServe (setPort (read port) config) Main.skite\n                     --, httpServe (setPort 8003 config) Ws.brz\n                     ]\n\n--httpServe (setPort 8003 config) Ws.brz\nwhere\n config =\n     setErrorLog  ConfigNoLog $\n     setAccessLog ConfigNoLog $\n     setSSLPort 443 $\n     setSSLCert \"/etc/letsencrypt/../cert.pem\" $\n     setSSLKey \"/etc/letsencrypt/../privkey.pem\" $\n     defaultConfig\n</code></pre>\n\n<p>After i am building and uploading, all the certs are in the place, yet the <code>https://</code> won't work. Do you have any clues?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 2, "creation_date": 1497004129, "post_id": 44455358, "comment_id": 75907142, "body": "What would the signature of <code>isa</code> be again? What&#39;s the signature of <code>goal_of_exercise</code> (specifically, what&#39;s <code>x</code> and <code>y</code>) Where&#39;s the <code>a</code> and <code>b</code> in the <code>X</code> constructor coming from - did you want a parametric or a higher-rank type?"}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1497004360, "post_id": 44455358, "comment_id": 75907281, "body": "Bartek, I don&#39;t know, so I&#39;m asking :) IMHO it&#39;s not possible without TH. But OK, may be another way to implement <code>goal_of_exercise</code> in simple way? A lot of permutations... What to do..."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1497004411, "post_id": 44455358, "comment_id": 75907316, "body": "You haven&#39;t answered any of my questions, and I can&#39;t answer yours without at least some explanation. What, <i>specifically</i>, is <code>goal_of_exercise</code> again?"}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1497004522, "post_id": 44455358, "comment_id": 75907381, "body": "Better is to have generic &quot;isa&quot;, which will work with any kind of types."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1497004547, "post_id": 44455358, "comment_id": 75907397, "body": "And what would that function do? What would it take, and what would it return? You&#39;re failing to describe your goal, so as a consequence your problem statement is entirely unclear."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1497004686, "post_id": 44455358, "comment_id": 75907469, "body": "as I said already, it can not get type like in dynamic languages, so it will take constructor which is 1st citizen. And it must return, sure, Bool. Imagine <code>isa X the_x == True</code> like in many other languages, like C# similar construct, may be F#."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1497004876, "post_id": 44455358, "comment_id": 75907581, "body": "Pattern matching happens in runtime, right? So there is type tag, in the box, right? So, there is such &quot;system&quot; function, and Haskell uses them."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1497004930, "post_id": 44455358, "comment_id": 75907623, "body": "Yes, and it&#39;s called pattern matching. You can just match for the constructor."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1497005061, "post_id": 44455358, "comment_id": 75907708, "body": "I think based on the question, the OP wants something similar as the <code>..=&#47;2</code> predicate in Prolog."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1497005202, "post_id": 44455358, "comment_id": 75907800, "body": "&quot;Pattern-matching&quot; is syntax construct only. But in runtime something is called. And this is function which gets type tag from boxed value IMHO."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1497005256, "post_id": 44455358, "comment_id": 75907841, "body": "OK, if it is not possible, how to implement functions based on pattern matching of its args when there are a lot of permutations? Should be a way..."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1497005555, "post_id": 44455358, "comment_id": 75908048, "body": "I don&#39;t see a load of permutations in your example. You have two constructors and you can just match for both, like in my 1st example."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 1, "creation_date": 1497005679, "post_id": 44455358, "comment_id": 75908130, "body": "ah, this is the snippet only. Actually I have sum of types, something like <code>data D = A ...|B ...|C ...|D ...|E|G</code> and try to write <code>Monoid</code> of it."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1497005839, "post_id": 44455358, "comment_id": 75908225, "body": "Well, if every constructor can hold different data, then you obviously need different matches. If they share the same data, consider splitting it into <code>data  DType = A | B | C ... | G</code> and <code>data DValues = Values ...</code>, and combining them into <code>data D = D Type Values</code>. That way you can have just one match. This whole question is an X/Y problem."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1497005856, "post_id": 44455358, "comment_id": 75908232, "body": "Bartek, I&#39;m newbie, so ask it, but I see that there is a <code>pat</code> construct in Haskell, also there is proposal for Active Patterns, also there is <code>ViewPatterns</code>, so may be there is some intelligent solution..."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1497005969, "post_id": 44455358, "comment_id": 75908300, "body": "And if what you <i>actually</i> had was &quot;a sum of types, something like data D = A ...|B ...|C ...|D ...|E|G&quot; and all you wanted was &quot; to write Monoid of it&quot;, <b>you should have asked that question</b>."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1497006501, "post_id": 44455358, "comment_id": 75908601, "body": "Answer on both my questions will solve the problem. One either second. Better is to have answer on generic problem... OK, I found this - <a href=\"https://web.cecs.pdx.edu/~mpj/thih/thih.pdf\" rel=\"nofollow noreferrer\">web.cecs.pdx.edu/~mpj/thih/thih.pdf</a>. It looks close but complex"}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1497076904, "post_id": 44455896, "comment_id": 75936587, "body": "(1) &quot;In Haskell every type is ... a tagged union&quot; -- false.  There are also function types and various non-algebraic built-in types.  (2) &quot;is it possible to change the behavior of <code>specialShow</code> for some particular <code>a</code>s?  Sure&quot;  -- false (unless you have some other signature in mind, or by &quot;possible&quot; you didn&#39;t mean &quot;possible within the language&quot;)"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1497080795, "post_id": 44455896, "comment_id": 75937445, "body": "@luqui 1) good point - I&#39;ll edit to reflect. 2) I meant &quot;possible, but not like you want it too&quot;, i.e. requires using the whole shebang I talk about later. Not sure I that needs clarification."}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 4, "last_activity_date": 1497080865, "last_edit_date": 1497080865, "creation_date": 1497005460, "answer_id": 44455896, "question_id": 44455358, "link": "https://stackoverflow.com/questions/44455358/is-it-possible-to-write-isa-match-function/44455896#44455896", "title": "Is it possible to write &quot;isa&quot;/&quot;match&quot; function", "body": "<p>The function you're asking for is not just impossible to write - it's absolutely nonsensical in the context of Haskell.</p>\n\n<p>In Haskell all (most of) your data types are indeed, as you've observed, tagged unions carrying type information in runtime. This allows pattern matching to work:</p>\n\n<pre><code>data D = A | B\n\nwhichD :: D -&gt; String\nwhichD A = \"it's an A\"\nwhichD B = \"it's a B\"\n</code></pre>\n\n<p>This works for constructors of <em>one particular type</em>, though. The signature of <code>whichD</code> specifically says it takes a <code>D</code>, which can be constructed using one of its constructors. If you wanted to extend it to, say, take an analogous <code>D'</code>, you could use a sum type for that:</p>\n\n<pre><code>data OneOf = OneD D | OneD' D'\n</code></pre>\n\n<hr>\n\n<p>Now, there are cases where this is not the case, namely parametrized contexts:</p>\n\n<pre><code>specialShow :: Show a =&gt; a -&gt; String\nspecialShow a = \"it's a special \" ++ show a\n</code></pre>\n\n<p>So now, is it possible to change the behavior of <code>specialShow</code> for some particular <code>a</code>s? Yes in principle, but not under that signature. Typically you'd introduce your own type class and provide specific instances for the types you want, and use generic code for all other types you want to bring in. This can pose some problems with overlapping instances, but that's solvable.</p>\n\n<hr>\n\n<p>What if you <em>insisted</em> on doing the runtime check? I don't think that would even work in all cases, but possibly using some compiler intrinsics you'd be able to force it to tell you more about the actual value. I am pretty sure there's no standard Haskell way to do that, as it's essentially breaking the type system abstraction.</p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1497080865, "creation_date": 1497003874, "question_id": 44455358, "link": "https://stackoverflow.com/questions/44455358/is-it-possible-to-write-isa-match-function", "title": "Is it possible to write &quot;isa&quot;/&quot;match&quot; function", "body": "<p>Is it possible to write \"isa\" or \"match\" function on Haskell without TH? It must get constructor and values and to match value with this constructor, but constructor can have multiple arguments. Example:</p>\n\n<pre><code>data X = X a b|Y {age::Int, name::String}\nisa c v = ???\ngoal_of_exercise x y|iff all (isa X) x y = 1\n                    |iff any (isa Y) x y = 2\n  where iff agg c a b = agg c [a, b]\n</code></pre>\n\n<p>Or may be exists another solution of goal-of-exercise... ?</p>\n"}, {"tags": ["haskell", "windows-xp", "haskell-platform"], "comments": [{"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1517905866, "post_id": 44451542, "comment_id": 84273390, "body": "This question lacks sufficient detail. what package are you trying to configure/install? Why not just run <code>cabal configure</code>  (which is the recommended route) instead of calling <code>runghc setup.hs configure</code>?"}], "owner": {"reputation": 402, "user_id": 5113878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22450ed9ca8fe2259ca9e4fae6f536d4?s=128&d=identicon&r=PG&f=1", "display_name": "Adhan Timothy Younes", "link": "https://stackoverflow.com/users/5113878/adhan-timothy-younes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1496992363, "creation_date": 1496992363, "question_id": 44451542, "link": "https://stackoverflow.com/questions/44451542/unable-to-install-haskell-packages-in-windows-xp-using-runhaskell-command", "title": "Unable to install Haskell packages in Windows XP using runhaskell command", "body": "<p>I just install Haskell 7.10.3 in my Windows XP computer but when I run the command like <strong><em>runhaskell setup.hs configure</em></strong> it shows the error <strong>unable to load package time-1.5.0.1</strong> but when I issue the command <strong><em>ghc-pkg list</em></strong> the package is there.. What should I do to fix this error?</p>\n\n<p>Thanks in advanced</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 9772, "user_id": 1786065, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/udTpS.png?s=128&g=1", "display_name": "Rogue", "link": "https://stackoverflow.com/users/1786065/rogue"}, "edited": false, "score": 1, "creation_date": 1496991261, "post_id": 44451151, "comment_id": 75899151, "body": "The definitions are recursive, there&#39;s a few good previous posts on it"}, {"owner": {"reputation": 2565, "user_id": 1108505, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a7e091fdb18efecace362189bc5f0bf5?s=128&d=identicon&r=PG", "display_name": "Tanner Swett", "link": "https://stackoverflow.com/users/1108505/tanner-swett"}, "edited": false, "score": 0, "creation_date": 1497038003, "post_id": 44451151, "comment_id": 75928265, "body": "&quot;My guess is that it keeps trying look itself up, recursing infinitely. Is this correct, and why does it not lead to an error when compiling?&quot; In short: yes, that&#39;s correct. It doesn&#39;t lead to an error when compiling because it&#39;s not prohibited for a definition to reference itself. And that&#39;s not prohibited because it&#39;s sometimes useful."}], "owner": {"reputation": 11, "user_id": 8135303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9b9c7b9e79904c00a6b4d1c4a28441a?s=128&d=identicon&r=PG", "display_name": "Dennis", "link": "https://stackoverflow.com/users/8135303/dennis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "closed_date": 1496991473, "answer_count": 0, "score": 1, "last_activity_date": 1496991037, "creation_date": 1496991037, "question_id": 44451151, "link": "https://stackoverflow.com/questions/44451151/what-is-a-a-doing-in-haskell", "closed_reason": "Duplicate", "title": "What is a = a doing in haskell?", "body": "<pre><code>a=b \n</code></pre>\n\n<p>leads to</p>\n\n<pre><code>error: Variable not in scope: b\n</code></pre>\n\n<p>Why doesn't the same happen with </p>\n\n<pre><code>a=a?\n</code></pre>\n\n<p>I've done a little testing, and every function that computes a gets stuck when computing it.</p>\n\n<pre><code>map (+1) a -- outputs nothing before getting stuck\ntoy x = 'f':x -- outputs \"f before getting stuck\n</code></pre>\n\n<p>and a bunch of others get stuck. </p>\n\n<p>However</p>\n\n<pre><code>Prelude&gt; :type a\na :: t\n</code></pre>\n\n<p>So a is a constant of a variable type, with no constraints. As far as I can tell, evaluating it leads to some kind of infinite loop. </p>\n\n<p>My guess is that it keeps trying look itself up, recursing infinitely. Is this correct, and why does it not lead to an error when compiling? </p>\n"}, {"tags": ["api", "haskell", "servant"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1496944260, "post_id": 44442224, "comment_id": 75882564, "body": "This is the <code>DataKinds</code> extension at work, allowing one to (roughly) lift values at the type level. Using that, one can define a type which depends on <i>values</i> rather than other types as usual. This is why strings can appear there. At the type level, <code>[T]</code> stands for the type list-of-T, while <code>&#39;[x]</code> stands for the (lifted) value &quot;list containing only one element <code>x</code>&quot;. One could even write <code>&#39;[x,y,z]</code>, for instance."}, {"owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "edited": false, "score": 1, "creation_date": 1497446280, "post_id": 44442224, "comment_id": 76082433, "body": "The paper does quite a good job of explaining in more detail how things are implemented in the later sections, without assuming too much knowledge, so I&#39;d recommend you keep reading :). I also found the <a href=\"http://www.well-typed.com/blog/2015/11/implementing-a-minimal-version-of-haskell-servant/\" rel=\"nofollow noreferrer\">Tiny Servant</a> article by Andres L&#246;h was a nice intoduction before reading the full paper."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 1, "last_activity_date": 1496958525, "last_edit_date": 1496958525, "creation_date": 1496956873, "answer_id": 44445766, "question_id": 44442224, "link": "https://stackoverflow.com/questions/44442224/understanding-echo-service-example-api-from-servant-paper/44445766#44445766", "title": "Understanding &#39;echo&#39; service example API from Servant paper", "body": "<blockquote>\n  <p>How is there a string literal in the definition of a type?</p>\n</blockquote>\n\n<p>The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#ghc-flag--XDataKinds\" rel=\"nofollow noreferrer\"><code>DataKinds</code></a> extension lets you use these string literals in type signatures. Each one of them represents a different type. They all belong to the kind <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/GHC-TypeLits.html#t:Symbol\" rel=\"nofollow noreferrer\"><code>Symbol</code></a>; we can test this using the <code>:kind</code> command in ghci:</p>\n\n<pre><code>Prelude&gt; :set -XDataKinds\nPrelude&gt; :kind \"foo\"\n\"foo\" :: GHC.Types.Symbol\n</code></pre>\n\n<p>Because in Haskell only types of kind <code>*</code> have values, these type-level strings are not inhabited. But there are <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/GHC-TypeLits.html#v:symbolVal\" rel=\"nofollow noreferrer\">functions</a> that let you obtain the corresponding term-level string anyway.</p>\n\n<blockquote>\n  <p>What is the symbol :>?</p>\n</blockquote>\n\n<p>The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#type-operators\" rel=\"nofollow noreferrer\"><code>TypeOperators</code></a> extension lets you define types with operator names. This is useful for parameterized types that are mostly used to combine other types. Notice that <code>:&gt;</code> has two  type parameters but no value-level constructors: it is only used at the type level.</p>\n\n<blockquote>\n  <p>What does the apostrophe before the list type mean?</p>\n</blockquote>\n\n<p><code>DataKinds</code> does more than enabling symbols. It lets you use value constructors as <em>types</em>, and the types of these constructors become <em>kinds</em> in its turn. For example:</p>\n\n<pre><code>Prelude&gt; :set -XDataKinds\nPrelude&gt; :kind True\nTrue :: Bool\n</code></pre>\n\n<p>These promoted constructors are not inhabited by any term (because they have kinds other than <code>*</code>).</p>\n\n<p>In particular, we can promote lists to the type-level. But this creates some ambiguity. What is <code>[Int]</code> in a signature? Is it the type of lists of <code>Int</code>s (that has kind <code>*</code>) or is it a type-level list with one element, the type <code>Int</code>? The apostrophe makes clear that we are talking about the type-level list.</p>\n\n<pre><code>Prelude&gt; :set -XDataKinds\nPrelude&gt; :kind [Int]\n[Int] :: *\nPrelude&gt; :kind '[Int]\n'[Int] :: [*]\nPrelude&gt; :kind '[True]\n'[True] :: [Bool]\n</code></pre>\n\n<p>Type-level lists of more than one element don't require the apostrophe, because there's no ambiguity:</p>\n\n<pre><code>Prelude&gt; :kind [Int,Int]\n[Int,Int] :: [*]\n</code></pre>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 44445766, "answer_count": 1, "score": 3, "last_activity_date": 1496958525, "creation_date": 1496943266, "last_edit_date": 1496944045, "question_id": 44442224, "link": "https://stackoverflow.com/questions/44442224/understanding-echo-service-example-api-from-servant-paper", "title": "Understanding &#39;echo&#39; service example API from Servant paper", "body": "<p>The introduction of the <a href=\"https://www.andres-loeh.de/Servant/servant-wgp.pdf\" rel=\"nofollow noreferrer\">servant paper</a> contains the following example API type:</p>\n\n<pre><code>type Echo = \"echo\"\n          :&gt; ReqBody \u2019[PlainText] String\n          :&gt; Get \u2019[PlainText] String\n</code></pre>\n\n<p>I am attempting to understand this example. It appears to be defining a type synonym, but seems to involve some things that I have not seen before.</p>\n\n<p>Here are three questions that I have about it:</p>\n\n<ol>\n<li><strong>How is there a string literal in the definition of a type?</strong></li>\n</ol>\n\n<p><code>\"echo\"</code> is a string literal. I thought these were only used to define specific strings and don't know what this means when used in a type declaration.</p>\n\n<ol start=\"2\">\n<li><strong>What is the symbol <code>:&gt;</code>?</strong></li>\n</ol>\n\n<p>The definition of this symbol in the 'servant' package appears to be <a href=\"http://hackage.haskell.org/package/servant-0.11/docs/Servant-API-Sub.html#t::-62-\" rel=\"nofollow noreferrer\">defined here</a> and looks like this:</p>\n\n<pre><code>data (path :: k) :&gt; a\n    deriving (Typeable)\ninfixr 9 :&gt;\n</code></pre>\n\n<p>I would guess that <code>:&gt;</code> corresponds to a <code>/</code> in an api string, but do not see how this definition would make that happen.</p>\n\n<p>This is the first time I am seeing a non-alphanumeric type other than  the function type <code>-&gt;</code>.</p>\n\n<ol start=\"3\">\n<li><strong>What does the apostrophe before the list type mean?</strong></li>\n</ol>\n\n<p><code>[PlainText]</code> I would understand to simply represent a list of PlainText elements, but in contrast I do not understand what <code>\u2019[PlainText]</code> means.</p>\n"}, {"tags": ["algorithm", "haskell", "optimization", "data-structures", "primes"], "comments": [{"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 1, "creation_date": 1496941601, "post_id": 44441627, "comment_id": 75881079, "body": "Could you please split the algorithm up to reasonably sized top level functions which can be reasoned about (seing types, etc. helps...) ? Thanks."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1496942165, "post_id": 44441627, "comment_id": 75881385, "body": "Change <code>Map</code> to <code>IntMap</code>."}, {"owner": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "reply_to_user": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 1, "creation_date": 1496942822, "post_id": 44441627, "comment_id": 75881751, "body": "@Centril I factored out <code>sieve</code>, <code>update</code>, <code>decrease</code> and <code>sumOfsieved</code>, hope it helps."}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 1, "creation_date": 1496943141, "post_id": 44441627, "comment_id": 75881937, "body": "How much of your algorithm is dominated by modifying Maps, and how much by reading? If you read a lot, then using <a href=\"http://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector-Unboxed.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/vector-0.12.0.1/docs/&hellip;</a> is great for numeric code. There&#39;s also <a href=\"http://hackage.haskell.org/package/array\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/array</a>"}, {"owner": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1496944316, "post_id": 44441627, "comment_id": 75882598, "body": "@ThomasM.DuBuisson Thank you, I also changed <code>Integer</code> to <code>Int</code>, code <a href=\"https://gist.github.com/AdamStelmaszczyk/52e3cf83322ac5f88aeb9e18dd068348\" rel=\"nofollow noreferrer\">here</a>. It brought run-time down to 5 seconds."}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 1, "creation_date": 1496945043, "post_id": 44441627, "comment_id": 75883019, "body": "I wonder if using <code>Data.IntMap.Strict</code> would decrease the number of allocations; I suspect that subtraction in <code>insertWith</code> mostly generates thunks."}, {"owner": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "reply_to_user": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1496945130, "post_id": 44441627, "comment_id": 75883068, "body": "@Centril There are 2 loops there, outer one iterating through possible primes p and inner one iterating through sufficient &quot;check-point&quot; integers for DP. It may be easier to look into Python <a href=\"https://math.stackexchange.com/questions/1378286/find-the-sum-of-all-primes-smaller-than-a-big-number/2283829#2283829\">code</a> to see that. In the outer loop there are 5 reads (from keys <code>p</code>, <code>p - 1</code>, <code>p - 1</code> again, <code>v</code>, <code>v &#47;&#47; p</code>) and 1 write, in the inner loop there 3 reads and 1 write. Thanks for the links, I&#39;m looking into them."}, {"owner": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1496946568, "post_id": 44441627, "comment_id": 75883790, "body": "@9000 I checked and it didn&#39;t."}], "answers": [{"comments": [{"owner": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "edited": false, "score": 0, "creation_date": 1497012032, "post_id": 44455627, "comment_id": 75912395, "body": "Thanks, I checked timings on my machine. Using <code>Map.Strict</code> gave 4s. Using <code>IntMap.Strict</code> 3.2s. Didn&#39;t change the time: helper function <code>go</code> with less arguments, <code>sp</code>, no <code>if</code>, <code>subtract</code>, no <code>map</code>, no <code>reverse</code>. But the last 4 make the code more readable IMO, so it&#39;s great to know, thanks. <a href=\"https://gist.github.com/AdamStelmaszczyk/e0e794e6392dd7ff9758fc64d5557622\" rel=\"nofollow noreferrer\">Code</a>. My feeling at the moment is that to get much better performance one needs to use mutable data structure. I&#39;m reading about mutable vectors, however it looks like understanding monads/arrows will take me some time."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "edited": false, "score": 1, "creation_date": 1497013118, "post_id": 44455627, "comment_id": 75913103, "body": "@AdamStelmaszczyk You could try to read this blog post. It might help you to come with imperative/mutable solution faster: <a href=\"https://www.reddit.com/r/haskell/comments/6e4wq8/imperative_haskell/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/6e4wq8/imperative_haskell</a>"}, {"owner": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "edited": false, "score": 0, "creation_date": 1497386026, "post_id": 44455627, "comment_id": 76053669, "body": "Thanks for the link, I updated my question. I <a href=\"https://gist.github.com/AdamStelmaszczyk/f9a5d156a752fbe6c71652866fed9770\" rel=\"nofollow noreferrer\">tried</a> using mutable <code>BasicHashTable</code>, but I&#39;m probably doing something wrong, since it&#39;s very slow..."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "edited": false, "score": 1, "creation_date": 1497796301, "post_id": 44455627, "comment_id": 76218184, "body": "@AdamStelmaszczyk I&#39;ve updated answer with mutable version with runs rather fast. Just directly translated Python code from your link."}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 1, "creation_date": 1497798725, "post_id": 44455627, "comment_id": 76219029, "body": "If I try your updated program it gives me a wrong result of <code>318504960</code>"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1497800136, "post_id": 44455627, "comment_id": 76219425, "body": "@Krom Yes, you&#39;re right :( I was in hurry and forgot to subtract result. Now implementation works correctly. But runs <code>5.5sec</code> instead. This is because extra lookup in hashtable in most inner loop. If instead <code>update</code> function was used (which is, unfortunately, not implemented for hashtable) then I think this can be done faster. I&#39;ll try to implement <code>update</code> function manually later."}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1497848632, "post_id": 44455627, "comment_id": 76230815, "body": "I plugged my hashmap into your code, see <a href=\"https://gist.github.com/erwo42/a455a80bfe1dac6203204665b71d48b6\" rel=\"nofollow noreferrer\">here</a> with that it runs in 0.6 seconds on my machine."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1497863024, "post_id": 44455627, "comment_id": 76238243, "body": "@Krom Nice! That&#39;s already faster than python implementation."}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1497863151, "post_id": 44455627, "comment_id": 76238318, "body": "I didn&#39;t test the python solution on my machine, as I am not proficient with python. Maybe you can check the python solution vs. our combined solution on your machine? (Otherwise, the numbers aren&#39;t comparable.)"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1497865139, "post_id": 44455627, "comment_id": 76239677, "body": "@Krom Yes, I will check both implementation on my machine. And, probably, I can optimize your solution as well. There&#39;s a room for performance boost as I can see."}, {"owner": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1497868374, "post_id": 44455627, "comment_id": 76241865, "body": "@Krom I timed combined solution, got 0.7s, well done, the fastest we got here so far. Running Python (assuming <code>python</code> is already installed, on a lot of distros it is by default, if not <code>sudo apt-get install python</code> should do it) is a quick thing, just <code>time python problem10.py</code>, where problem10.py is <a href=\"https://gist.github.com/AdamStelmaszczyk/d46faa15ba0c6d1432fd1fcbf7cc8a85\" rel=\"nofollow noreferrer\">this</a>. With Python 2.7.3 I got 1.2s, with Python 3.4.3 I got 1.5s."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "edited": false, "score": 0, "creation_date": 1497879044, "post_id": 44455627, "comment_id": 76249250, "body": "@AdamStelmaszczyk I&#39;ve make it even faster with another approach. See updated answer."}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1497883707, "post_id": 44455627, "comment_id": 76252851, "body": "@Shersh I don&#39;t consider my map to be cheating, as it can be expanded into a general purpose Int to Int map. Just add a safe lookup and some rehashing logic."}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 1, "creation_date": 1497883731, "post_id": 44455627, "comment_id": 76252869, "body": "@Shersh I applaud your clever solution and upvoted your answer!"}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1497883885, "post_id": 44455627, "comment_id": 76252981, "body": "Could you please post the code to your Judy Hashmap solution? I tried to plug Data.Judy into your code and it didn&#39;t give me a sub 0.6 second timings."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1497884714, "post_id": 44455627, "comment_id": 76253576, "body": "@Krom Regarding my code with Judy HashMap \u2014 I&#39;ve just used your solution from gist above. Probably my machine is a little bit faster."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1497884778, "post_id": 44455627, "comment_id": 76253620, "body": "@Krom Regarding cheating... Well, I thing your algo works better when key set is fixed or when we don&#39;t perform inserts and deletes often... And with rehashing it would be slower. But I agree it&#39;s fair."}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1497889426, "post_id": 44455627, "comment_id": 76256711, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/147098/discussion-between-krom-and-shersh\">continue this discussion in chat</a>."}, {"owner": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "edited": false, "score": 1, "creation_date": 1498169079, "post_id": 44455627, "comment_id": 76402988, "body": "I timed your sparse map - 0.2s, it&#39;s the fastest Haskell code given, well done. Others were also very helpful, thank you, but I can&#39;t split the bounty, so I think you should receive it. Out of curiosity, I <a href=\"https://gist.github.com/AdamStelmaszczyk/2e8ab8c1fc57c166c1ba99b6fb9615c4\" rel=\"nofollow noreferrer\">implemented</a> your idea in C++, I&#39;m just storing everything in one array <code>S</code>, it runs in 0.15s."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "edited": false, "score": 0, "creation_date": 1498204679, "post_id": 44455627, "comment_id": 76414336, "body": "@AdamStelmaszczyk <code>hashtables</code> might perform quite badly. But arrays should be close in performance to C++. Though, I&#39;m still surprised they are so close!"}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 7, "last_activity_date": 1497879379, "last_edit_date": 1497879379, "creation_date": 1497004656, "answer_id": 44455627, "question_id": 44441627, "link": "https://stackoverflow.com/questions/44441627/how-to-optimize-this-haskell-code-summing-up-the-primes-in-sublinear-time/44455627#44455627", "title": "How to optimize this Haskell code summing up the primes in sublinear time?", "body": "<p>I've done some small improvements so it runs in <code>3.4-3.5</code> seconds on my machine.\nUsing <code>IntMap.Strict</code> helped a lot. Other than that I just manually performed some <code>ghc</code> optimizations just to be sure. And make Haskell code more close to Python code from your link. As a next step you could try to use some mutable <code>HashMap</code>. But I'm not sure... <code>IntMap</code> can't be much faster than some mutable container because it's an immutable one. Though I'm still surprised about it's efficiency. I hope this can be implemented faster.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>import Data.List (foldl')\nimport Data.IntMap.Strict (IntMap, (!))\nimport qualified Data.IntMap.Strict as IntMap\n\np :: Int -&gt; Int\np n = (sieve (IntMap.fromList [(i, i * (i + 1) `div` 2 - 1) | i &lt;- vs]) 2 r vs) ! n\n               where vs = [n `div` i | i &lt;- [1..r]] ++ [n', n' - 1 .. 1]\n                     r  = floor (sqrt (fromIntegral n) :: Double)\n                     n' = n `div` r - 1\n\nsieve :: IntMap Int -&gt; Int -&gt; Int -&gt; [Int] -&gt; IntMap Int\nsieve m' p' r vs = go m' p'\n  where\n    go m p | p &gt; r               = m\n           | m ! p &gt; m ! (p - 1) = go (update m vs p) (p + 1)\n           | otherwise           = go m (p + 1)\n\nupdate :: IntMap Int -&gt; [Int] -&gt; Int -&gt; IntMap Int\nupdate s vs p = foldl' decrease s (takeWhile (&gt;= p2) vs)\n  where\n    sp = s ! (p - 1)\n    p2 = p * p\n    sumOfSieved v = p * (s ! (v `div` p) - sp)\n    decrease m  v = IntMap.adjust (subtract $ sumOfSieved v) v m\n\nmain :: IO ()\nmain = print $ p $ 2*10^(9 :: Int) \n</code></pre>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>Using mutable <code>hashtables</code> I've managed to make performance up to <code>~5.5sec</code> on Haskell with <a href=\"https://gist.github.com/ChShersh/062b4322a76cb74ecf3edfa1fef08237\" rel=\"noreferrer\">this implementation</a>.</p>\n\n<p>Also, I used unboxed vectors instead of lists in several places. <code>Linear</code> hashing seems to be the fastest. I think this can be done even faster. I noticed <a href=\"https://github.com/gregorycollins/hashtables/blob/7550c23b2f005af19b380625d78b669830130eb4/hashtables.cabal#L137\" rel=\"noreferrer\"><code>sse42</code> option</a> in <code>hasthables</code> package. Not sure I've managed to set it correctly but even without it runs that fast.</p>\n\n<p><strong>UPDATE 2</strong> (19.06.2017)</p>\n\n<p>I've managed to make it <code>3x</code> faster then best solution from @Krom (using my code + his map) by dropping judy hashmap at all. Instead just plain arrays are used. You can come up with the same idea if you notice that keys for <code>S</code> hashmap are either sequence from <code>1</code> to <code>n'</code> or <code>n div i</code> for <code>i</code> from <code>1</code> to <code>r</code>. So we can represent such HashMap as two arrays making lookups in array depending on searching key.</p>\n\n<p><strong><em>My code + Judy HashMap</em></strong></p>\n\n<pre><code>$ time ./judy\n95673602693282040\n\nreal    0m0.590s\nuser    0m0.588s\nsys     0m0.000s\n</code></pre>\n\n<p><strong><em>My code + my sparse map</em></strong></p>\n\n<pre><code>$ time ./sparse\n95673602693282040\n\nreal    0m0.203s\nuser    0m0.196s\nsys     0m0.004s\n</code></pre>\n\n<p>This can be done even faster if instead of <code>IOUArray</code> already generated vectors and <code>Vector</code> library is used and <code>readArray</code> is replaced by <code>unsafeRead</code>. But I don't think this should be done if only you're not really interested in optimizing this as much as possible. </p>\n\n<p>Comparison with this solution is cheating and is not fair. I expect same ideas implemented in Python and C++ will be even faster. But @Krom solution with closed hashmap is already cheating because it uses custom data structure instead of standard one. At least you can see that standard and most popular hash maps in <em>Haskell</em> are not that fast. Using better algorithms and better ad-hoc data structures can be better for such problems.</p>\n\n<p><a href=\"https://gist.github.com/ChShersh/35df251f98874e2d6a868880b68f60fa\" rel=\"noreferrer\">Here's resulting code.</a></p>\n"}, {"comments": [{"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 2, "creation_date": 1497852114, "post_id": 44617619, "comment_id": 76232040, "body": "When I am off work, I will post on reddit asking for help. It would be a bit whacky if there wasn&#39;t an off-the-shelf library that beats my naive approaches here."}], "tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": false, "score": 4, "last_activity_date": 1497872489, "last_edit_date": 1497872489, "creation_date": 1497806421, "answer_id": 44617619, "question_id": 44441627, "link": "https://stackoverflow.com/questions/44441627/how-to-optimize-this-haskell-code-summing-up-the-primes-in-sublinear-time/44617619#44617619", "title": "How to optimize this Haskell code summing up the primes in sublinear time?", "body": "<p>First as a baseline, the timings of the existing approaches\non my machine:</p>\n\n<ol>\n<li><p>Original program posted in the question:</p>\n\n<pre><code>time stack exec primorig\n95673602693282040\n\nreal    0m4.601s\nuser    0m4.387s\nsys     0m0.251s\n</code></pre></li>\n<li><p>Second the version using <code>Data.IntMap.Strict</code> from\n<a href=\"https://gist.github.com/AdamStelmaszczyk/f9a5d156a752fbe6c71652866fed9770\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code>time stack exec primIntMapStrict\n95673602693282040\n\nreal    0m2.775s\nuser    0m2.753s\nsys     0m0.052s\n</code></pre></li>\n<li><p>Shershs code with Data.Judy dropped in <a href=\"https://gist.github.com/erwo42/481669257f0e937dc47a4e5b1757a692\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code>time stack exec prim-hash2\n95673602693282040\n\nreal    0m0.945s\nuser    0m0.955s\nsys     0m0.028s\n</code></pre></li>\n<li><p>Your python solution.</p>\n\n<p>I compiled it with</p>\n\n<pre><code>python -O -m py_compile problem10.py\n</code></pre>\n\n<p>and the timing:</p>\n\n<pre><code>time python __pycache__/problem10.cpython-36.opt-1.pyc\n95673602693282040\n\nreal    0m1.163s\nuser    0m1.160s\nsys     0m0.003s\n</code></pre></li>\n<li><p>Your C++ version:</p>\n\n<pre><code>$ g++ -O2 --std=c++11 p10.cpp -o p10\n$ time ./p10\nsum(2000000000) = 95673602693282040\n\nreal    0m0.314s\nuser    0m0.310s\nsys     0m0.003s\n</code></pre></li>\n</ol>\n\n<p>I didn't bother to provide a baseline for slow.hs, as I didn't\nwant to wait for it to complete when run with an argument of\n<code>2*10^9</code>.</p>\n\n<h2>Subsecond performance</h2>\n\n<p>The following program runs in under a second on my machine.</p>\n\n<p>It uses a hand rolled hashmap, which uses closed hashing with\nlinear probing and uses some variant of knuths hashfunction,\nsee <a href=\"https://stackoverflow.com/questions/664014\">here</a>.</p>\n\n<p>Certainly it is somewhat tailored to the case, as the lookup\nfunction for example expects the searched keys to be present.</p>\n\n<p>Timings:</p>\n\n<pre><code>time stack exec prim\n95673602693282040\n\nreal    0m0.725s\nuser    0m0.714s\nsys     0m0.047s\n</code></pre>\n\n<p>First I implemented my hand rolled hashmap simply to hash\nthe keys with</p>\n\n<pre><code>key `mod` size\n</code></pre>\n\n<p>and selected a size multiple times higher than the expected\ninput, but the program took 22s or more to complete.</p>\n\n<p>Finally it was a matter of choosing a hash function which was\ngood for the workload.</p>\n\n<p>Here is the program:</p>\n\n<pre><code>import Data.Maybe\nimport Control.Monad\nimport Data.Array.IO\nimport Data.Array.Base (unsafeRead)\n\ntype Number = Int\n\ndata Map = Map { keys :: IOUArray Int Number\n               , values :: IOUArray Int Number\n               , size :: !Int \n               , factor :: !Int\n               }\n\nnewMap :: Int -&gt; Int -&gt; IO Map\nnewMap s f = do\n  k &lt;- newArray (0, s-1) 0\n  v &lt;- newArray (0, s-1) 0\n  return $ Map k v s f \n\nstoreKey :: IOUArray Int Number -&gt; Int -&gt; Int -&gt; Number -&gt; IO Int\nstoreKey arr s f key = go ((key * f) `mod` s)\n  where\n    go :: Int -&gt; IO Int\n    go ind = do\n      v &lt;- readArray arr ind\n      go2 v ind\n    go2 v ind\n      | v == 0    = do { writeArray arr ind key; return ind; }\n      | v == key  = return ind\n      | otherwise = go ((ind + 1) `mod` s)\n\nloadKey :: IOUArray Int Number -&gt; Int -&gt; Int -&gt; Number -&gt; IO Int\nloadKey arr s f key = s `seq` key `seq` go ((key *f) `mod` s)\n  where\n    go :: Int -&gt; IO Int\n    go ix = do\n      v &lt;- unsafeRead arr ix\n      if v == key then return ix else go ((ix + 1) `mod` s)\n\ninsertIntoMap :: Map -&gt; (Number, Number) -&gt; IO Map\ninsertIntoMap m@(Map ks vs s f) (k, v) = do\n  ix &lt;- storeKey ks s f k\n  writeArray vs ix v\n  return m\n\nfromList :: Int -&gt; Int -&gt; [(Number, Number)] -&gt; IO Map\nfromList s f xs = do\n  m &lt;- newMap s f\n  foldM insertIntoMap m xs\n\n(!) :: Map -&gt; Number -&gt; IO Number\n(!) (Map ks vs s f) k = do\n  ix &lt;- loadKey ks s f k\n  readArray vs ix\n\nmupdate :: Map -&gt; Number -&gt; (Number -&gt; Number) -&gt; IO ()\nmupdate (Map ks vs s fac) i f = do\n  ix &lt;- loadKey ks s fac i\n  old &lt;- readArray vs ix\n  let x' = f old\n  x' `seq` writeArray vs ix x'\n\nr' :: Number -&gt; Number\nr'  = floor . sqrt . fromIntegral\n\nvs' :: Integral a =&gt; a -&gt; a -&gt; [a]\nvs' n r = [n `div` i | i &lt;- [1..r]] ++ reverse [1..n `div` r - 1]  \n\nvss' n r = r + n `div` r -1\n\nlist' :: Int -&gt; Int -&gt; [Number] -&gt; IO Map\nlist' s f vs = fromList s f [(i, i * (i + 1) `div` 2 - 1) | i &lt;- vs]\n\nproblem10 :: Number -&gt; IO Number\nproblem10 n = do\n      m &lt;- list' (19*vss) (19*vss+7) vs\n      nm &lt;- sieve m 2 r vs\n      nm ! n\n    where vs = vs' n r\n          vss = vss' n r\n          r  = r' n\n\nsieve :: Map -&gt; Number -&gt; Number -&gt; [Number] -&gt; IO Map\nsieve m p r vs | p &gt; r     = return m\n               | otherwise = do\n                   v1 &lt;- m ! p\n                   v2 &lt;- m ! (p - 1)\n                   nm &lt;- if v1 &gt; v2 then update m vs p else return m\n                   sieve nm (p + 1) r vs\n\nupdate :: Map -&gt; [Number] -&gt; Number -&gt; IO Map\nupdate m vs p = foldM (decrease p) m $ takeWhile (&gt;= p*p) vs\n\ndecrease :: Number -&gt; Map -&gt; Number -&gt; IO Map\ndecrease p m k = do\n  v &lt;- sumOfSieved m k p\n  mupdate m k (subtract v)\n  return m\n\nsumOfSieved :: Map -&gt; Number -&gt; Number -&gt; IO Number\nsumOfSieved m v p = do\n  v1 &lt;- m ! (v `div` p)\n  v2 &lt;- m ! (p - 1)\n  return $ p * (v1 - v2)\n\nmain = do { n &lt;- problem10 (2*10^9) ; print n; } -- 2*10^9\n</code></pre>\n\n<p>I am not a professional with hashing and that sort of stuff, so\nthis can certainly be improved a lot. Maybe we Haskellers should\nimprove the of the shelf hash maps or provide some simpler ones.</p>\n\n<h2>My hashmap, Shershs code</h2>\n\n<p>If I plug my hashmap in Shershs (see answer below) code, see <a href=\"https://gist.github.com/erwo42/a455a80bfe1dac6203204665b71d48b6\" rel=\"nofollow noreferrer\">here</a>\nwe are even down to</p>\n\n<pre><code>time stack exec prim-hash2\n95673602693282040\n\nreal    0m0.601s\nuser    0m0.604s\nsys     0m0.034s\n</code></pre>\n\n<h2>Why is slow.hs slow?</h2>\n\n<p>If you read through the source\nfor the function <code>insert</code> in <code>Data.HashTable.ST.Basic</code>, you\nwill see that it deletes the old key value pair and inserts\na new one. It doesn't look up the \"place\" for the value and\nmutate it, as one might imagine, if one reads that it is\na \"mutable\" hashtable. Here the hashtable itself is mutable,\nso you don't need to copy the whole hashtable for insertion\nof a new key value pair, but the value places for the pairs\nare not. I don't know if that is the whole story of slow.hs\nbeing slow, but my guess is, it is a pretty big part of it.</p>\n\n<h2>A few minor improvements</h2>\n\n<p>So that's the idea I followed while trying to improve\nyour program the first time.</p>\n\n<p>See, you don't need a mutable mapping from keys to values.\nYour key set is fixed. You want a mapping from keys to mutable\nplaces. (Which is, by the way, what you get from C++ by default.)</p>\n\n<p>And so I tried to come up with that. I used <code>IntMap IORef</code> from\n<code>Data.IntMap.Strict</code> and <code>Data.IORef</code> first and got a timing\nof</p>\n\n<pre><code>tack exec prim\n95673602693282040\n\nreal    0m2.134s\nuser    0m2.141s\nsys     0m0.028s\n</code></pre>\n\n<p>I thought maybe it would help to work with unboxed values\nand to get that, I used <code>IOUArray Int Int</code> with 1 element\neach instead of <code>IORef</code> and got those timings:</p>\n\n<pre><code>time stack exec prim\n95673602693282040\n\nreal    0m2.015s\nuser    0m2.018s\nsys     0m0.038s\n</code></pre>\n\n<p>Not much of a difference and so I tried to get rid of bounds\nchecking in the 1 element arrays by using <code>unsafeRead</code> and\n<code>unsafeWrite</code> and got a timing of</p>\n\n<pre><code>time stack exec prim\n95673602693282040\n\nreal    0m1.845s\nuser    0m1.850s\nsys     0m0.030s\n</code></pre>\n\n<p>which was the best I got using <code>Data.IntMap.Strict</code>.</p>\n\n<p>Of course I ran each program multiple times to see if\nthe times are stable and the differences in run time aren't\njust noise.</p>\n\n<p>It looks like these are all just micro-optimizations.</p>\n\n<p>And here is the program that ran fastest for me without using a hand rolled data structure:</p>\n\n<pre><code>import qualified Data.IntMap.Strict as M\nimport Control.Monad\nimport Data.Array.IO\nimport Data.Array.Base (unsafeRead, unsafeWrite)\n\ntype Number = Int\ntype Place = IOUArray Number Number\ntype Map = M.IntMap Place\n\ntupleToRef :: (Number, Number) -&gt; IO (Number, Place)\ntupleToRef = traverse (newArray (0,0))\n\ninsertRefs :: [(Number, Number)] -&gt; IO [(Number, Place)]\ninsertRefs = traverse tupleToRef\n\nfromList :: [(Number, Number)] -&gt; IO Map \nfromList xs = M.fromList &lt;$&gt; insertRefs xs\n\n(!) :: Map -&gt; Number -&gt; IO Number\n(!) m i = unsafeRead (m M.! i) 0\n\nmupdate :: Map -&gt; Number -&gt; (Number -&gt; Number) -&gt; IO ()\nmupdate m i f = do\n  let place = m M.! i\n  old &lt;- unsafeRead place 0\n  let x' = f old\n  -- make the application of f strict\n  x' `seq` unsafeWrite place 0 x'\n\nr' :: Number -&gt; Number\nr'  = floor . sqrt . fromIntegral\n\nvs' :: Integral a =&gt; a -&gt; a -&gt; [a]\nvs' n r = [n `div` i | i &lt;- [1..r]] ++ reverse [1..n `div` r - 1]  \n\nlist' :: [Number] -&gt; IO Map\nlist' vs = fromList [(i, i * (i + 1) `div` 2 - 1) | i &lt;- vs]\n\nproblem10 :: Number -&gt; IO Number\nproblem10 n = do\n      m &lt;- list' vs\n      nm &lt;- sieve m 2 r vs\n      nm ! n\n    where vs = vs' n r\n          r  = r' n\n\nsieve :: Map -&gt; Number -&gt; Number -&gt; [Number] -&gt; IO Map\nsieve m p r vs | p &gt; r     = return m\n               | otherwise = do\n                   v1 &lt;- m ! p\n                   v2 &lt;- m ! (p - 1)\n                   nm &lt;- if v1 &gt; v2 then update m vs p else return m\n                   sieve nm (p + 1) r vs\n\nupdate :: Map -&gt; [Number] -&gt; Number -&gt; IO Map\nupdate m vs p = foldM (decrease p) m $ takeWhile (&gt;= p*p) vs\n\ndecrease :: Number -&gt; Map -&gt; Number -&gt; IO Map\ndecrease p m k = do\n  v &lt;- sumOfSieved m k p\n  mupdate m k (subtract v)\n  return m\n\nsumOfSieved :: Map -&gt; Number -&gt; Number -&gt; IO Number\nsumOfSieved m v p = do\n  v1 &lt;- m ! (v `div` p)\n  v2 &lt;- m ! (p - 1)\n  return $ p * (v1 - v2)\n\nmain = do { n &lt;- problem10 (2*10^9) ; print n; } -- 2*10^9\n</code></pre>\n\n<p>If you profile that, you see that it spends most of the time in the custom lookup function <code>(!)</code>,\ndon't know how to improve that further. Trying to inline <code>(!)</code> with <code>{-# INLINE (!) #-}</code>\ndidn't yield better results; maybe ghc already did this.</p>\n"}, {"comments": [{"owner": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "edited": false, "score": 0, "creation_date": 1497875748, "post_id": 44619788, "comment_id": 76246980, "body": "I tried it with n = 2\u22c510^9 to compare to other implementations, 71 seconds. From what I understand, the time complexity of segmented sieve is the same as non-segmented one. I appreciate that in reality, the locality of reference can improve the speed in segmented version, however my feeling is that it will be slower than <i>sub-linear</i> algorithm presented by Lucy_Hedgehog. My question is about optimizing Haskell code implementing Lucy&#39;s algorithm, I clarified the question now a bit, I can see how it could be a bit confusing, sorry. Nice blog, I will read it, I especially like your essays."}, {"owner": {"reputation": 16306, "user_id": 448810, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4b14d4a7503a55cb803c049700ed83b?s=128&d=identicon&r=PG", "display_name": "user448810", "link": "https://stackoverflow.com/users/448810/user448810"}, "reply_to_user": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "edited": false, "score": 0, "creation_date": 1497876333, "post_id": 44619788, "comment_id": 76247392, "body": "The segmented sieve has the same big-oh time complexity, but will be very much faster due to locality of reference. Thank you for your nice comments about my blog."}], "tags": [], "owner": {"reputation": 16306, "user_id": 448810, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4b14d4a7503a55cb803c049700ed83b?s=128&d=identicon&r=PG", "display_name": "user448810", "link": "https://stackoverflow.com/users/448810/user448810"}, "is_accepted": false, "score": 2, "last_activity_date": 1497870363, "last_edit_date": 1497870363, "creation_date": 1497821979, "answer_id": 44619788, "question_id": 44441627, "link": "https://stackoverflow.com/questions/44441627/how-to-optimize-this-haskell-code-summing-up-the-primes-in-sublinear-time/44619788#44619788", "title": "How to optimize this Haskell code summing up the primes in sublinear time?", "body": "<p>Try this and let me know how fast it is:</p>\n\n<pre><code>-- sum of primes\n\nimport Control.Monad (forM_, when)\nimport Control.Monad.ST\nimport Data.Array.ST\nimport Data.Array.Unboxed\n\nsieve :: Int -&gt; UArray Int Bool\nsieve n = runSTUArray $ do\n    let m = (n-1) `div` 2\n        r = floor . sqrt $ fromIntegral n\n    bits &lt;- newArray (0, m-1) True\n    forM_ [0 .. r `div` 2 - 1] $ \\i -&gt; do\n        isPrime &lt;- readArray bits i\n        when isPrime $ do\n            let a = 2*i*i + 6*i + 3\n                b = 2*i*i + 8*i + 6\n            forM_ [a, b .. (m-1)] $ \\j -&gt; do\n                writeArray bits j False\n    return bits\n\nprimes :: Int -&gt; [Int]\nprimes n = 2 : [2*i+3 | (i, True) &lt;- assocs $ sieve n]\n\nmain = do\n    print $ sum $ primes 1000000\n</code></pre>\n\n<p>You can run it on <a href=\"http://ideone.com/D8aBnJ\" rel=\"nofollow noreferrer\">ideone</a>. My algorithm is the Sieve of Eratosthenes, and it should be quite fast for small <em>n</em>. For <em>n</em> = 2,000,000,000, the array size may be a problem, in which case you will need to use a segmented sieve. See <a href=\"https://programmingpraxis.files.wordpress.com/2012/09/primenumbers.pdf\" rel=\"nofollow noreferrer\">my blog</a> for more information about the Sieve of Eratosthenes. See <a href=\"https://stackoverflow.com/a/10249801/448810\">this answer</a> for information about a segmented sieve (but not in Haskell, unfortunately).</p>\n"}, {"comments": [{"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1497889993, "post_id": 44634950, "comment_id": 76257019, "body": "doesn&#39;t compile for me, I tried that <a href=\"https://gist.github.com/erwo42/67b15b3643685d9f5e1c63a4748964bf\" rel=\"nofollow noreferrer\">here</a> and tried to compile it with <code>stack ghc -- -O 2 primediv.hs</code>. Got Errors like <code>force</code>, <code>primes</code> not in scope and <code>($!!)</code> not in scope."}, {"owner": {"reputation": 398, "user_id": 3236033, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/81b29b95c129cec714b31ee157dc47cb?s=128&d=identicon&r=PG", "display_name": "CarlEdman", "link": "https://stackoverflow.com/users/3236033/carledman"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1497892542, "post_id": 44634950, "comment_id": 76258529, "body": "Sorry for just copying from my standard library and not including all the imports.  <code>force</code> and <code>($!!)</code> are from Control.DeepSeq which is included with most distributions.  <code>primes</code> is just the list of primes, from whatever source.  I recommend the arithmoi package from Hackage."}, {"owner": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "edited": false, "score": 0, "creation_date": 1497902632, "post_id": 44634950, "comment_id": 76263940, "body": "@CarlEdman I <a href=\"https://gist.github.com/AdamStelmaszczyk/c433b09c79a54d8b6a3464a758aa15f8\" rel=\"nofollow noreferrer\">filled the blanks</a> in your code and tried it with n = 2\u22c510^9, it ran in 0.3s, impressive. Could you please describe your approach?"}, {"owner": {"reputation": 398, "user_id": 3236033, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/81b29b95c129cec714b31ee157dc47cb?s=128&d=identicon&r=PG", "display_name": "CarlEdman", "link": "https://stackoverflow.com/users/3236033/carledman"}, "reply_to_user": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "edited": false, "score": 0, "creation_date": 1497905166, "post_id": 44634950, "comment_id": 76265251, "body": "@AdamStelmaszczyk Happy to.  Will do so as edit of appendix of my post."}, {"owner": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "edited": false, "score": 0, "creation_date": 1497908618, "post_id": 44634950, "comment_id": 76266835, "body": "I think I wasn&#39;t precise enough with the previous question, sorry. I understand how Lucy&#39;s algorithm work. What I would like to understand is why your Haskell code is so fast and is it the same method as Shersh&#39;s &quot;my code + my map&quot; that achieved 0.2s? E.g. &quot;I used 2 mutable arrays, in the first one I store x... that is the same/not the same as Shersh, the difference is y&quot;."}, {"owner": {"reputation": 398, "user_id": 3236033, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/81b29b95c129cec714b31ee157dc47cb?s=128&d=identicon&r=PG", "display_name": "CarlEdman", "link": "https://stackoverflow.com/users/3236033/carledman"}, "reply_to_user": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "edited": false, "score": 1, "creation_date": 1497910912, "post_id": 44634950, "comment_id": 76267656, "body": "@AdamStelmaszczyk Beyond the algorithm, there is no magic to the performance beyond the usual trial-by-error hand-tuning.  It probably started with something like Shersh&#39;s and then was transformed bit-by-bit. Things that helped: Using a single mutable array; just modifying the array on each iteration, rather than copying to a new one, by performing the updates in careful order; unsafeRead/Write; custom inner loop rather than forM_; forcing results early via &#39;$!!&#39; and &#39;force&#39;."}, {"owner": {"reputation": 398, "user_id": 3236033, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/81b29b95c129cec714b31ee157dc47cb?s=128&d=identicon&r=PG", "display_name": "CarlEdman", "link": "https://stackoverflow.com/users/3236033/carledman"}, "reply_to_user": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "edited": false, "score": 0, "creation_date": 1497911023, "post_id": 44634950, "comment_id": 76267691, "body": "@AdamStelmaszczyk Also thanks for fixing up my TeX!  I keep forgetting which forums allow which syntax."}], "tags": [], "owner": {"reputation": 398, "user_id": 3236033, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/81b29b95c129cec714b31ee157dc47cb?s=128&d=identicon&r=PG", "display_name": "CarlEdman", "link": "https://stackoverflow.com/users/3236033/carledman"}, "is_accepted": false, "score": 4, "last_activity_date": 1497907749, "last_edit_date": 1497907749, "creation_date": 1497887467, "answer_id": 44634950, "question_id": 44441627, "link": "https://stackoverflow.com/questions/44441627/how-to-optimize-this-haskell-code-summing-up-the-primes-in-sublinear-time/44634950#44634950", "title": "How to optimize this Haskell code summing up the primes in sublinear time?", "body": "<p>This code of mine evaluates the sum to 2\u22c510^9 in 0.3 seconds and the sum to 10^12 (18435588552550705911377) in 19.6 seconds (if given sufficient RAM).</p>\n\n<pre><code>import Control.DeepSeq \nimport qualified Control.Monad as ControlMonad\nimport qualified Data.Array as Array\nimport qualified Data.Array.ST as ArrayST\nimport qualified Data.Array.Base as ArrayBase\n\nprimeLucy :: (Integer -&gt; Integer) -&gt; (Integer -&gt; Integer) -&gt; Integer -&gt; (Integer-&gt;Integer)\nprimeLucy f sf n = g\n  where\n    r = fromIntegral $ integerSquareRoot n\n    ni = fromIntegral n\n    loop from to c = let go i = ControlMonad.when (to&lt;=i) (c i &gt;&gt; go (i-1)) in go from\n\n    k = ArrayST.runSTArray $ do\n      k &lt;- ArrayST.newListArray (-r,r) $ force $\n        [sf (div n (toInteger i)) - sf 1|i&lt;-[r,r-1..1]] ++\n        [0] ++\n        [sf (toInteger i) - sf 1|i&lt;-[1..r]]\n      ControlMonad.forM_ (takeWhile (&lt;=r) primes) $ \\p -&gt; do\n        l &lt;- ArrayST.readArray k (p-1)\n        let q = force $ f (toInteger p)\n\n        let adjust = \\i j -&gt; do { v &lt;- ArrayBase.unsafeRead k (i+r); w &lt;- ArrayBase.unsafeRead k (j+r); ArrayBase.unsafeWrite k (i+r) $!! v+q*(l-w) }\n\n        loop (-1)         (-div r p)              $ \\i -&gt; adjust i (i*p)\n        loop (-div r p-1) (-min r (div ni (p*p))) $ \\i -&gt; adjust i (div (-ni) (i*p))\n        loop r            (p*p)                   $ \\i -&gt; adjust i (div i p)\n\n      return k\n\n    g :: Integer -&gt; Integer\n    g m\n      | m &gt;= 1 &amp;&amp; m &lt;= integerSquareRoot n                       = k Array.! (fromIntegral m)\n      | m &gt;= integerSquareRoot n &amp;&amp; m &lt;= n &amp;&amp; div n (div n m)==m = k Array.! (fromIntegral (negate (div n m)))\n      | otherwise = error $ \"Function not precalculated for value \" ++ show m\n\nprimeSum :: Integer -&gt; Integer\nprimeSum n = (primeLucy id (\\m -&gt; div (m*m+m) 2) n) n\n</code></pre>\n\n<p>If your <code>integerSquareRoot</code> function is buggy (as reportedly some are), you can replace it here with <code>floor . sqrt . fromIntegral</code>.</p>\n\n<p>Explanation:</p>\n\n<p>As the name suggests it is based upon a generalization of the famous method by \"Lucy Hedgehog\" eventually discovered by the original poster.</p>\n\n<p>It allows you to calculate many sums of the form <a href=\"https://i.stack.imgur.com/kqz1a.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/kqz1a.gif\" alt=\"sum\"></a> (with p prime) without enumerating all the primes up to N and in time O(N^0.75).  </p>\n\n<p>Its inputs are the function f (i.e., <code>id</code> if you want the prime sum), its summatory function over all the integers (i.e., in that case the sum of the first m integers or <code>div (m*m+m) 2</code>), and N. </p>\n\n<p><code>PrimeLucy</code> returns a lookup function <a href=\"https://i.stack.imgur.com/g6PvJ.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/g6PvJ.gif\" alt=\"eq\"></a> (with p prime) restricted to certain values of n: <a href=\"https://i.stack.imgur.com/MHCiP.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/MHCiP.gif\" alt=\"values\"></a>.</p>\n"}], "owner": {"reputation": 18825, "user_id": 1073386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dedaa598e511ee85ead4ed0bc25ea3d3?s=128&d=identicon&r=PG", "display_name": "Adam Stelmaszczyk", "link": "https://stackoverflow.com/users/1073386/adam-stelmaszczyk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1326, "favorite_count": 2, "accepted_answer_id": 44455627, "answer_count": 4, "score": 18, "last_activity_date": 1498315208, "creation_date": 1496941111, "last_edit_date": 1498315208, "question_id": 44441627, "link": "https://stackoverflow.com/questions/44441627/how-to-optimize-this-haskell-code-summing-up-the-primes-in-sublinear-time", "title": "How to optimize this Haskell code summing up the primes in sublinear time?", "body": "<p>Problem 10 from <a href=\"https://projecteuler.net\" rel=\"nofollow noreferrer\">Project Euler</a> is to find the sum of all the primes below given <em>n</em>.</p>\n\n<p>I solved it simply by summing up the primes generated by the sieve of Eratosthenes. Then I came across much more efficient <a href=\"https://math.stackexchange.com/questions/1378286/find-the-sum-of-all-primes-smaller-than-a-big-number/2283829#2283829\">solution by Lucy_Hedgehog</a> (sub-linear!).</p>\n\n<p>For <em>n = 2\u22c510^9</em>:</p>\n\n<ul>\n<li><p><a href=\"https://gist.github.com/AdamStelmaszczyk/d46faa15ba0c6d1432fd1fcbf7cc8a85\" rel=\"nofollow noreferrer\">Python code</a> (from the quote above) runs in 1.2 seconds in Python 2.7.3.</p></li>\n<li><p><a href=\"https://gist.github.com/AdamStelmaszczyk/a6661e53e34bbf8b10af0fa5a5e97395\" rel=\"nofollow noreferrer\">C++ code</a> (mine) runs in about 0.3 seconds (compiled with g++ 4.8.4).</p></li>\n</ul>\n\n<p>I re-implemented the same algorithm in Haskell, since I'm learning it:</p>\n\n<pre><code>import Data.List\n\nimport Data.Map (Map, (!))\nimport qualified Data.Map as Map\n\nproblem10 :: Integer -&gt; Integer\nproblem10 n = (sieve (Map.fromList [(i, i * (i + 1) `div` 2 - 1) | i &lt;- vs]) 2 r vs) ! n\n              where vs = [n `div` i | i &lt;- [1..r]] ++ reverse [1..n `div` r - 1]\n                    r  = floor (sqrt (fromIntegral n))\n\nsieve :: Map Integer Integer -&gt; Integer -&gt; Integer -&gt; [Integer] -&gt; Map Integer Integer\nsieve m p r vs | p &gt; r     = m\n               | otherwise = sieve (if m ! p &gt; m ! (p - 1) then update m vs p else m) (p + 1) r vs\n\nupdate :: Map Integer Integer -&gt; [Integer] -&gt; Integer -&gt; Map Integer Integer\nupdate m vs p = foldl' decrease m (map (\\v -&gt; (v, sumOfSieved m v p)) (takeWhile (&gt;= p*p) vs))\n\ndecrease :: Map Integer Integer -&gt; (Integer, Integer) -&gt; Map Integer Integer\ndecrease m (k, v) = Map.insertWith (flip (-)) k v m\n\nsumOfSieved :: Map Integer Integer -&gt; Integer -&gt; Integer -&gt; Integer\nsumOfSieved m v p = p * (m ! (v `div` p) - m ! (p - 1))\n\nmain = print $ problem10 $ 2*10^9\n</code></pre>\n\n<p>I compiled it with <code>ghc -O2 10.hs</code> and run with <code>time ./10</code>.</p>\n\n<p>It gives the correct answer, but takes about 7 seconds.</p>\n\n<p>I compiled it with <code>ghc -prof -fprof-auto -rtsopts 10</code> and run with <code>./10 +RTS -p -h</code>.</p>\n\n<p><a href=\"https://gist.github.com/AdamStelmaszczyk/81c443191b25a73e868d56ae3cae0994\" rel=\"nofollow noreferrer\">10.prof</a> shows that <code>decrease</code> takes 52.2% time and 67.5% allocations.</p>\n\n<p>After running <code>hp2ps 10.hp</code> I got such heap profile:</p>\n\n<p><img src=\"https://i.stack.imgur.com/OAvUM.png\" alt=\"hp\"></p>\n\n<p>Again looks like <code>decrease</code> takes most of the heap. GHC version 7.6.3.</p>\n\n<p>How would you optimize run time of this Haskell code?</p>\n\n<hr>\n\n<p>Update 13.06.17: </p>\n\n<p>I <a href=\"https://gist.github.com/AdamStelmaszczyk/f9a5d156a752fbe6c71652866fed9770\" rel=\"nofollow noreferrer\">tried</a> replacing immutable <code>Data.Map</code> with mutable <code>Data.HashTable.IO.BasicHashTable</code> from the <code>hashtables</code> package, but I'm probably doing something bad, since for tiny <em>n = 30</em> it already takes too long, about 10 seconds. What's wrong?</p>\n\n<p>Update 18.06.17:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/3058529/curious-about-the-hashtable-performance-issues\">Curious about the HashTable performance issues</a> is a good read. I took Sherh's <a href=\"https://gist.github.com/ChShersh/062b4322a76cb74ecf3edfa1fef08237\" rel=\"nofollow noreferrer\">code</a> using mutable <code>Data.HashTable.ST.Linear</code>, but <a href=\"https://gist.github.com/AdamStelmaszczyk/acaa98e81cbdd088c8b7f0394b3ccf97\" rel=\"nofollow noreferrer\">dropped <code>Data.Judy</code> in instead</a>. It runs in 1.1 seconds, still relatively slow.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1496930476, "post_id": 44435294, "comment_id": 75873149, "body": "Note that this algorithm just asks for <code>divMod</code> either way, e.g. <code>go num = case divMod num 10 of (0,r) -&gt; [r]; (q,r) -&gt; r : go q</code>."}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1496930883, "post_id": 44435294, "comment_id": 75873472, "body": "Valid point, however, it involves a semantic analysis of the algorithm, rather than the broader, and purely syntactic, which the answers discuss. =)"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1496930949, "post_id": 44435294, "comment_id": 75873530, "body": "It&#39;s just meant as an additional note, not as a critique of your answer :)"}], "tags": [], "owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "is_accepted": true, "score": 8, "last_activity_date": 1496993095, "last_edit_date": 1496993095, "creation_date": 1496923385, "answer_id": 44435294, "question_id": 44435078, "link": "https://stackoverflow.com/questions/44435078/is-it-possible-to-replace-parentheses-with/44435294#44435294", "title": "Is it possible to replace parentheses with $?", "body": "<h2>The problem</h2>\n\n<p>You can't use <code>$</code> for that. The purpose of <code>$</code> is to make function application bind as un-tighly as possible, as opposed to normal function application which binds most tightly,</p>\n\n<pre><code>&gt; :i $\n($) :: (a -&gt; b) -&gt; a -&gt; b\ninfixr 0 $\n</code></pre>\n\n<p>(some irrelevant stuff removed...)</p>\n\n<p>Here, <code>infixr</code> denotes that the operator is <strong>r</strong>ight associative, as opposed to <code>infixl</code> which denotes that the operator is <strong>l</strong>eft associative. <code>0</code> denotes the precedence of the operator. <code>0</code> binds least tightly and <code>9</code> binds most tightly.</p>\n\n<p>If we write <code>go $ div num 10 $ mod num 10 : acc</code>, this is interpreted as <code>go (div num 10 (mod num 10 : acc))</code>, i.e: passing <code>mod num 10 : acc</code> as the third argument of <code>div</code>, and the result of applying <code>div</code> as the only argument to <code>go</code>.</p>\n\n<h2>Solution: the <code>(&amp;)</code> operator</h2>\n\n<p>Instead of using the dollar sign, <code>$</code>, for the left hand side, you can instead use <code>&amp;</code>.</p>\n\n<pre><code>&gt; :i &amp;\n(&amp;) :: a -&gt; (a -&gt; b) -&gt; b       -- Defined in `Data.Function'\ninfixl 1 &amp;\n</code></pre>\n\n<p>And now we get:</p>\n\n<pre><code>import Data.Function ((&amp;))\n\ndigits :: Int -&gt; [Int]\ndigits n = go n []\n    where go num acc\n            | num &lt; 10 = num : acc\n            | otherwise = div num 10 &amp; go $ mod num 10 : acc\n</code></pre>\n\n<h2>Solution: apply <code>go</code> infix</h2>\n\n<p>You could also use <code>go</code> infix:</p>\n\n<pre><code>digits :: Int -&gt; [Int]\ndigits n = go n []\n    where go num acc\n            | num &lt; 10 = num : acc\n            | otherwise = div num 10 `go` (mod num 10 : acc)\n</code></pre>\n\n<p>In this case, the parenthesis on the right hand side is needed due to <code>(:)</code> which is also infix and interferes with <code>go</code>.</p>\n\n<h1>Which solution to use</h1>\n\n<p>In my opinion, if you can use infix application without parenthesizes, do that. In the case of having a parenthesis on any side such as in: <code>div num 10 `go` (mod num 10 : acc)</code>, it may still be warranted to use infix. This is mainly due to readability, as the average reader may not be familiar with <code>&amp;</code>. This notation is <em>(probably)</em> not very commonly used, which is why the average reader is not very familiar with it (and so we have a cycle...).</p>\n\n<h3>On the usage of <code>$$</code></h3>\n\n<p>I believe Alexey Romanov's operator, <code>$$</code> is quite neat as well. Unfortunately, it suffers the same problems as <code>&amp;</code> does: lack of familiarity. Hopefully, his operator can be added to <code>Data.Function</code> in due time and perhaps we can expand our toolbox.</p>\n"}, {"comments": [{"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1496926940, "post_id": 44436365, "comment_id": 75870247, "body": "That operator <code>$$</code> is arguably even neater than <code>&amp;</code>, nice one =)"}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 8, "last_activity_date": 1496926457, "creation_date": 1496926457, "answer_id": 44436365, "question_id": 44435078, "link": "https://stackoverflow.com/questions/44435078/is-it-possible-to-replace-parentheses-with/44436365#44436365", "title": "Is it possible to replace parentheses with $?", "body": "<p>In addition to the answers @Centril mentions, you can replace only the second pair: </p>\n\n<pre><code>go (div num 10) $ mod num 10 : acc\n</code></pre>\n\n<p>or both, but then you need parentheses in a different place:</p>\n\n<pre><code>(go $ div num 10) $ mod num 10 : acc\n</code></pre>\n\n<p>or declare another operator like <code>$</code> but left-associative:</p>\n\n<pre><code>f $$ x = f x\ninfixl 0 $$\n\ngo $$ div num 10 $$ mod num 10 : acc\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "accepted_answer_id": 44435294, "answer_count": 2, "score": 2, "last_activity_date": 1496993095, "creation_date": 1496922832, "last_edit_date": 1496941818, "question_id": 44435078, "link": "https://stackoverflow.com/questions/44435078/is-it-possible-to-replace-parentheses-with", "title": "Is it possible to replace parentheses with $?", "body": "<p>I have the following function:</p>\n\n<pre><code>digits :: Int -&gt; [Int]\ndigits n = go n []\n    where go num acc\n            | num &lt; 10 = num : acc\n            | otherwise = go (div num 10) (mod num 10 : acc)\n</code></pre>\n\n<p>Is it possible to replace the parentheses in the <code>otherwise</code> expression with <code>$</code>? </p>\n"}, {"tags": ["haskell", "recursion", "fixpoint-combinators"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1496918245, "post_id": 44432563, "comment_id": 75863997, "body": "In the 107 line there are too many <code>mc91</code> I think. There should be only three of them, right?. This is propagated to the subsequent lines."}], "tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": true, "score": 4, "last_activity_date": 1496918672, "last_edit_date": 1496918672, "creation_date": 1496916000, "answer_id": 44432563, "question_id": 44432362, "link": "https://stackoverflow.com/questions/44432362/how-mccarthy-91-function-works/44432563#44432563", "title": "How McCarthy 91 function works", "body": "<p>Lets expand your code:</p>\n\n<pre><code>mc91 85\nmc91 (mc91 96)\nmc91 (mc91 (mc91 107))\nmc91 (mc91 97)\nmc91 (mc91 (mc91 108))\nmc91 (mc91 98)\nmc91 (mc91 (mc91 109))\nmc91 (mc91 99)\nmc91 (mc91 (mc91 110))\nmc91 (mc91 100)\nmc91 (mc91 (mc91 111))\nmc91 (mc91 101)\nmc91 91... --It is a pattern here\n...\nmc91 101\n91\n</code></pre>\n\n<p>If you see the recrusive calls, you will realize that it will reduce it once it achieves 100 or higher, ending in a <code>(mc91 101)</code> call that will bring us the last <code>91</code> result. </p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1496920123, "creation_date": 1496920123, "answer_id": 44434048, "question_id": 44432362, "link": "https://stackoverflow.com/questions/44432362/how-mccarthy-91-function-works/44434048#44434048", "title": "How McCarthy 91 function works", "body": "<p>Let's first analyze the function. There are two cases:</p>\n\n<ul>\n<li>in the case <code>n &gt; 100</code>, then we return <code>n-10</code>; and</li>\n<li>in the case <code>n &lt;= 100</code>, then we calculate <code>n+11</code>, and we do <em>two</em> additional steps.</li>\n</ul>\n\n<p>There are thus two possible \"steps\": one where we decrement with 10, and one where we increment with 11. We can visualize this with a graph, like:</p>\n\n<p><a href=\"https://i.stack.imgur.com/dsA5e.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/dsA5e.png\" alt=\"graphical representation of the McCarthy91 function\"></a></p>\n\n<p>The edges of the first case are denoted in black, the edges of the latter case are denoted in red.</p>\n\n<p>What we notice is that there is a loop here: <code>92 -&gt; 103 -&gt; 93 -&gt; 104 -&gt; 94 -&gt; 105 -&gt; 95 -&gt; 106 -&gt; 96 -&gt; 107 -&gt; 97 -&gt; 108 -&gt; 98 -&gt; 109 -&gt; 99 -&gt; 110 -&gt; 100 -&gt; 111 -&gt; 101 -&gt; 91 -&gt; ...</code></p>\n\n<p>Let's assume for now that - regardless of the original value - we will always end up in that loop. Now the loop always interleaves a black edge, and a red edge, except for the <code>111 -&gt; 101 -&gt; 91</code> part, which consists out of two black edges.</p>\n\n<p>Since a red edge introduces two additional recursive calls, that means that, if we take a red hop, we get the next black and red hop for free. The next red hop will again add two recursive calls to the \"todo list\". So as a result, if we start in the loop, and we first take a red hop, we will keep running through the loop. This holds as long as we do not take the <code>111 -&gt; 101 -&gt; 91</code> part of the loop. Since those are two black edges, we can get out of recursive calls to perform and thus stop at <code>91</code> (since we always get two additional hops per red hop).</p>\n\n<p>As a result if we start at a certain node in the loop and we immediately take a red hop, regardless of the number of recursive calls we still need to do, we will eventually stop in 91: each time we do a complete loop, we \"lose\" one recursive call, so eventually we will run out of remaining recursive calls and stop in 91. So now we know that if we start, for instance at <code>94</code> with an arbitrary number of recursive calls, we will stop at 91.</p>\n\n<p>Now we still need to show that - given the number is less than 100 - we will end up in the loop, and that the first node we encounter in the loop is a node from which a red edge begins. We know that all numbers in the range of 91..100 are in the loop. Any number that is smaller than 91, will result in a red hop and will be incremented with 11. Therefore - as is partly shown in the graph - all numbers less than 91 will end up in the range of [91..100] eventually by always using red edges.</p>\n\n<p>Based on the above reasoning, a more efficient version of the function would be:</p>\n\n<pre><code>mc91' n | n &gt; 100 = n-10\n        | otherwise = 91\n</code></pre>\n\n<p>Now for your given sample input (85), we see that the program will evaluate to:</p>\n\n<pre><code>   mc91 85\n-&gt; mc91 (mc91 96) -- we are in the loop now\n-&gt; mc91 (mc91 (mc91 107))\n-&gt; mc91 (mc91 97)\n-&gt; mc91 (mc91 (mc91 108))\n-&gt; mc91 (mc91 98)\n-&gt; mc91 (mc91 (mc91 109))\n-&gt; mc91 (mc91 99)\n-&gt; mc91 (mc91 (mc91 110))\n-&gt; mc91 (mc91 100)\n-&gt; mc91 (mc91 (mc91 111))\n-&gt; mc91 (mc91 101)\n-&gt; mc91 91 -- we reached 91, and thus removed one recursive call\n-&gt; mc91 (mc91 102)\n-&gt; mc91 92\n-&gt; mc91 (mc91 103)\n-&gt; mc91 93\n-&gt; mc91 (mc91 104)\n-&gt; mc91 94\n-&gt; mc91 (mc91 105)\n-&gt; mc91 95\n-&gt; mc91 (mc91 106)\n-&gt; mc91 96\n-&gt; mc91 (mc91 107)\n-&gt; mc91 97\n-&gt; mc91 (mc91 108)\n-&gt; mc91 98\n-&gt; mc91 (mc91 109)\n-&gt; mc91 99\n-&gt; mc91 (mc91 110)\n-&gt; mc91 100\n-&gt; mc91 (mc91 111)\n-&gt; mc91 101\n-&gt; 91 -- we hit 91 a second time, and now the last recursive call is gone\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 554, "favorite_count": 2, "accepted_answer_id": 44432563, "answer_count": 2, "score": 2, "last_activity_date": 1562457286, "creation_date": 1496915470, "last_edit_date": 1562457286, "question_id": 44432362, "link": "https://stackoverflow.com/questions/44432362/how-mccarthy-91-function-works", "title": "How McCarthy 91 function works", "body": "<p>I have following function based on McCarthy 91 principle:</p>\n\n<pre><code>mc91 :: Integer -&gt; Integer\nmc91 n\n    | n &gt; 100 = n - 10\n    | otherwise = mc91 (mc91 (n + 11))\n</code></pre>\n\n<p>when I type in the prelude <code>mc91 85</code> I've got <code>91</code>.  </p>\n\n<p>I could not configure it out, how it is expanded and why do I've got <code>91</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "edited": false, "score": 3, "creation_date": 1496903576, "post_id": 44428214, "comment_id": 75854415, "body": "What are you trying to do?"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "edited": false, "score": 0, "creation_date": 1496903700, "post_id": 44428214, "comment_id": 75854489, "body": "Configure it out, why do I got an exception?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 4, "creation_date": 1496904205, "post_id": 44428214, "comment_id": 75854810, "body": "Because all <code>x</code> are the same above."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1496906178, "post_id": 44428214, "comment_id": 75855935, "body": "BTW this exception is a &quot;favor&quot; from the runtime, telling you that it caught what would otherwise be an infinite loop."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1496930845, "post_id": 44428214, "comment_id": 75873431, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/31816937/is-there-any-syntax-for-non-recursive-binding-in-haskell-just-like-the-differen\">is there any syntax for non-recursive binding in Haskell, just like the difference between `let` and `let rec` in similar languages?</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1496945595, "post_id": 44428214, "comment_id": 75883304, "body": "Why wouldn&#39;t the expression be recursive? What non-recursive meaning could there be for this?"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1496983628, "post_id": 44428214, "comment_id": 75895957, "body": "I&#39;m confused why you think it would  <b>not</b> be an infinite loop. What you&#39;ve said is that <code>x</code> is equal to <code>x</code>."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 7, "last_activity_date": 1496904742, "creation_date": 1496904742, "answer_id": 44428624, "question_id": 44428214, "link": "https://stackoverflow.com/questions/44428214/why-do-i-get-an-exception-loop/44428624#44428624", "title": "Why do I get an exception loop", "body": "<p><code>let</code> bindings in Haskell are (mutually) recursive, meaning that you can refer to any of the defined variables/functions (things to the left of the <code>=</code> signs) in any of their definitions (the stuff to the right of the <code>=</code> sign). For the case where you have arguments (functions), this is pretty much always the intuitive expected behaviour.</p>\n\n<pre><code>let fact n = if n == 0 then 1 else n * fact (n - 1) in fact 5\n</code></pre>\n\n<p>In the above, you probably are not surprised that <code>fact (n - 1)</code> can be used in the definition of <code>fact n</code>. In your example, you are using <code>x</code> in its own definition.</p>\n\n<p>When Haskell tries to evaluate <code>let x = x in x</code>, it keeps trying to expand <code>x</code> (into the RHS <code>x</code>) hence the loop.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 44428624, "answer_count": 1, "score": 1, "last_activity_date": 1496904742, "creation_date": 1496903399, "question_id": 44428214, "link": "https://stackoverflow.com/questions/44428214/why-do-i-get-an-exception-loop", "title": "Why do I get an exception loop", "body": "<p>I tried following expression in prelude:</p>\n\n<pre><code>let x = x in x\n</code></pre>\n\n<p>and I've got following exception</p>\n\n<pre><code>Exception: &lt;&lt;loop&gt;&gt;\n</code></pre>\n\n<p>Why is the expression recursive?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1496899568, "post_id": 44427220, "comment_id": 75852422, "body": "Are you looking for <code>map</code>?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1496901739, "post_id": 44427220, "comment_id": 75853453, "body": "Can you elaborate? For example show some sample input, and what you&#39;d expect the output to be."}, {"owner": {"reputation": 87, "user_id": 3277930, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4bb748494176361f0455535b75be77ca?s=128&d=identicon&r=PG&f=1", "display_name": "user3277930", "link": "https://stackoverflow.com/users/3277930/user3277930"}, "edited": false, "score": 0, "creation_date": 1496903628, "post_id": 44427220, "comment_id": 75854448, "body": "I added more information."}], "answers": [{"tags": [], "owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "is_accepted": false, "score": 2, "last_activity_date": 1496902346, "creation_date": 1496902346, "answer_id": 44427911, "question_id": 44427220, "link": "https://stackoverflow.com/questions/44427220/haskell-list-of-lists-operations/44427911#44427911", "title": "Haskell List of lists operations", "body": "<p>You can use <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:map\" rel=\"nofollow noreferrer\"><code>map</code></a> to apply a function to each element of a list - here's a complete example:</p>\n\n<pre><code>data Tribool = T | F | M deriving Show\n\nmy_data = [\n    [(\"vT\",T),(\"vF\",T)],\n    [(\"vT\",T),(\"vF\",F)],\n    [(\"vT\",F),(\"vF\",T)],\n    [(\"vT\",T),(\"vF\",M)],\n    [(\"vT\",M),(\"vF\",T)],\n    [(\"vT\",M),(\"vF\",M)],\n    [(\"vT\",F),(\"vF\",F)],\n    [(\"vT\",F),(\"vF\",M)],\n    [(\"vT\",M),(\"vF\",F)]\n  ]\n\nf x = reverse x -- example function\n\nprocessed_data = map f my_data\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 3277930, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4bb748494176361f0455535b75be77ca?s=128&d=identicon&r=PG&f=1", "display_name": "user3277930", "link": "https://stackoverflow.com/users/3277930/user3277930"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1496943800, "creation_date": 1496899258, "last_edit_date": 1496943800, "question_id": 44427220, "link": "https://stackoverflow.com/questions/44427220/haskell-list-of-lists-operations", "title": "Haskell List of lists operations", "body": "<p>I'm trying to traverse through a list of lists and perform an operation on each list.</p>\n\n<p>If I have a list like </p>\n\n<pre><code>[[(\"vT\",T),(\"vF\",T)],[(\"vT\",T),(\"vF\",F)],[(\"vT\",F),(\"vF\",T)],[(\"vT\",T),(\"vF\",M)],[(\"vT\",M),(\"vF\",T)],[(\"vT\",M),(\"vF\",M)],[(\"vT\",F),(\"vF\",F)],[(\"vT\",F),(\"vF\",M)],[(\"vT\",M),(\"vF\",F)]]\n</code></pre>\n\n<p>How can I create a function that sets an <code>x = [(\"vT\",T),(\"vF\",T)]</code>, so that I can use this x to perform an operation, and then set <code>x = [(\"vT\",T),(\"vF\",F)]</code> and so on and then have the answer of each returned in a list?</p>\n"}]