[{"tags": ["haskell", "vector", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 3, "last_activity_date": 1427326252, "creation_date": 1427326252, "answer_id": 29268489, "question_id": 29267759, "link": "https://stackoverflow.com/questions/29267759/accessing-vector-element-by-index-using-lens/29268489#29268489", "title": "Accessing vector element by index using lens", "body": "<p><code>clients.ix 0</code> is a traversal. In particular, traversals are setters, so setting and modifying should work fine:</p>\n\n<pre><code>clients.ix 0 .= updatedClient\n</code></pre>\n\n<p>Your problem is with <code>use</code>. Because a traversal doesn't necessarily contain exactly one value, when you <code>use</code> a traversal (or use some other getter function on it), it combines all the values assuming they are of a <code>Monoid</code> type.</p>\n\n<p>In particular,</p>\n\n<pre><code>use (clients.ix n)\n</code></pre>\n\n<p>would want to return <code>mempty</code> if <code>n</code> is out of bounds.</p>\n\n<p>Instead, you can use the <code>preuse</code> function, which discards all but the <em>first</em> target of a traversal (or more generally, a fold), and wraps it in a <code>Maybe</code>. E.g.</p>\n\n<pre><code>Just c &lt;- preuse (clients.ix n)\n</code></pre>\n\n<p>Note this will give a pattern match error if <code>n</code> is out of bounds, since <code>preuse</code> returns <code>Nothing</code> then.</p>\n"}], "owner": {"reputation": 550, "user_id": 3809223, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a86c2d7227577450956bbbe1ea6662d8?s=128&d=identicon&r=PG&f=1", "display_name": "ksaveljev", "link": "https://stackoverflow.com/users/3809223/ksaveljev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 1, "accepted_answer_id": 29268489, "answer_count": 1, "score": 3, "last_activity_date": 1427326252, "creation_date": 1427322605, "question_id": 29267759, "link": "https://stackoverflow.com/questions/29267759/accessing-vector-element-by-index-using-lens", "title": "Accessing vector element by index using lens", "body": "<p>I'm looking for a way to reference an element of a vector using lens library...</p>\n\n<p>Let me try to explain what I'm trying to achieve using a simplified example of my code.</p>\n\n<p>I'm working in this monad transformer stack (where StateT is the focus, everything else is not important)</p>\n\n<pre><code>newtype MyType a = MyType (StateT MyState (ExceptT String IO) a)\n</code></pre>\n\n<p><em>MyState</em> has a lot of fields but one of those is a vector of clients which is a data type I defined:</p>\n\n<pre><code>data MyState = MyState { ...\n                       , _clients :: V.Vector ClientT\n                       }\n</code></pre>\n\n<p>Whenever I need to access one of my clients I tend to do it like this:</p>\n\n<pre><code>import Control.Lens (use)\n\nc &lt;- use clients\nlet neededClient = c V.! someIndex\n... -- calculate something, update client if needed\nclients %= (V.// [(someIndex, updatedClient)])\n</code></pre>\n\n<p>Now, here is what I'm looking for: I would like my function to receive a \"reference\" to the client I'm interested in and use it (retrieve it from State, update it if needed).</p>\n\n<p>In order to clear up what I mean here is a snippet (that won't compile even in pseudo code):</p>\n\n<pre><code>...\nmyFunction (clients.ix 0)\n...\n\nmyFunction clientLens = do\n    c &lt;- use clientLens -- I would like to access a client in the vector\n    ... -- calculate stuff\n    clientLens .= updatedClient\n</code></pre>\n\n<p>Basically, I would like to pass to myFunction something from Lens library (I don't know what I'm passing here... Lens? Traversal? Getting? some other thingy?) which will allow me to point at particular element in the vector which is kept in my StateT. Is it at all possible? Currently, when using \"clients.ix 0\" I get an error that my ClientT is not an instance of Monoid.</p>\n\n<p>It is a very dumbed down version of what I have. In order to answer the question \"why I need it this way\" requires a lot more explanation. I'm interested if it is possible to pass this \"reference\" which will point to some element in my vector which is kept in State.</p>\n"}, {"tags": ["haskell", "head"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1427316448, "post_id": 29266072, "comment_id": 46734103, "body": "&quot;but only the first one runs&quot; - Does this mean that the second one hangs, or that it produces a different output, or that one results in an error?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 7, "creation_date": 1427316464, "post_id": 29266072, "comment_id": 46734112, "body": "You would need to call <code>head</code> in both cases, i.e. by changing <code>| board == [] = head []</code>. And then I hope you can see why <code>head</code> is a bad idea here."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1427317665, "post_id": 29266072, "comment_id": 46734772, "body": "In the vast majority of cases, prefer (exhaustive!) pattern matching to partial projections such as <code>head</code> or <code>tail</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1427321298, "post_id": 29266072, "comment_id": 46736477, "body": "By the way, you shouldn&#39;t use <code>==[]</code> to check for the empty list. That imposes an <code>Eq</code> constraint for no reason and just looks odd. You should usually use pattern matching in this sort of context, instead of guards.  <code>union [] ys = ys</code> and <code>union (x:xs) ys = union xs (x:ys)</code>, for instance. If you really want an &quot;is it empty&quot;, you should use <code>null</code>. Also, asking if the length of a list is 1 is potentially much less efficient than pattern matching it against the <code>[x]</code> or <code>[_]</code> pattern."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1427321466, "post_id": 29266072, "comment_id": 46736541, "body": "Also, in the future, it is very helpful if you tell us in English what the code is supposed to do and what it actually does, and to give an actual test case. Otherwise, figuring out how to fix it is like reading tea leaves."}], "answers": [{"tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": true, "score": 10, "last_activity_date": 1427316961, "creation_date": 1427316961, "answer_id": 29266342, "question_id": 29266072, "link": "https://stackoverflow.com/questions/29266072/in-haskell-how-do-you-use-head-without-creating-a-separate-function/29266342#29266342", "title": "In Haskell, how do you use &#39;head&#39; without creating a separate function?", "body": "<p><code>head</code> is <em>partial</em>. In particular, <code>head []</code> doesn't return normally (throws an exception). This can be difficult to handle in Haskell which is why people often suggest that you avoid partial functions.</p>\n\n<p>So how do we do that? We have to reflect failure <em>in the type</em>.</p>\n\n<pre><code>safeHead :: [a] -&gt; Maybe a\nsafeHead []     = Nothing\nsafeHead (a:as) = Just a\n</code></pre>\n\n<p>A similar function can be made for <code>tail</code></p>\n\n<pre><code>safeTail :: [a] -&gt; Maybe [a]\nsafeTail []     = Nothing\nsafeTail (a:as) = Just as\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 1, "last_activity_date": 1427322489, "creation_date": 1427322489, "answer_id": 29267738, "question_id": 29266072, "link": "https://stackoverflow.com/questions/29266072/in-haskell-how-do-you-use-head-without-creating-a-separate-function/29267738#29267738", "title": "In Haskell, how do you use &#39;head&#39; without creating a separate function?", "body": "<p>I think you need to take a step back and understand how pattern matching, recursion and single-linked lists work.  As various people have mentioned, the code you're writing is not going to work very well.</p>\n\n<p>As an illustration here's how I would write the various functions in your question:</p>\n\n<pre><code>single :: (a, [b]) -&gt; Bool    \nsingle (_, [_]) = True\nsingle _ = False\n\ntoList :: [(a, [b])] -&gt; [(a, [b])]\ntoList board = filter single board\n\nfindHead :: [(a, [b])] -&gt; Maybe (a, [b])\nfindHead [] = Nothing\nfindHead board = head (toList board)\n\n-- This one actually does the same thing as the built-in `++` operator,\n-- but for the sake of illustration, I'll implement it.\nunion :: [a] -&gt; [a] -&gt; [a]\nunion [] ys = ys\nunion (x:xs) ys = x : union xs ys\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 4713834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3986e4183c3b0845773dfb433aab5b24?s=128&d=identicon&r=PG&f=1", "display_name": "bananaruth", "link": "https://stackoverflow.com/users/4713834/bananaruth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1633, "favorite_count": 0, "accepted_answer_id": 29266342, "answer_count": 2, "score": 4, "last_activity_date": 1427322489, "creation_date": 1427316018, "question_id": 29266072, "link": "https://stackoverflow.com/questions/29266072/in-haskell-how-do-you-use-head-without-creating-a-separate-function", "title": "In Haskell, how do you use &#39;head&#39; without creating a separate function?", "body": "<p>I'm very new to using Haskell and I'm unsure about how 'head' works. From my understanding it returns the first element in a list. I've been trying to use it, but I keep getting errors. I added a workaround by creating a separate function that finds the head, however that seems like it should be unnecessary.</p>\n\n<p>I don't understand why calling findHead here:</p>\n\n<pre><code>single x = length (snd(x)) == 1\n\ntoList board\n    | board == [] = []\n    | otherwise = filter single board\n\nfindHead board = head (toList board)\n</code></pre>\n\n<p>is not equivalent to calling toList here:</p>\n\n<pre><code>single x = length (snd(x)) == 1\n\ntoList board\n    | board == [] = []\n    | otherwise =  head (filter single board)\n</code></pre>\n\n<p>It seems to me that the two should be the same, but only the first one runs. Why aren't they interpreted to be the same? Could you explain this to me? In the code above, 'board' is meant to be a list of tuples which are each the form (x, [a,b,...]). </p>\n\n<p>I've used 'head' in a few simpler things like:</p>\n\n<pre><code>union xs ys \n  | xs == [] = ys\n  | ys == [] = xs\n  | otherwise = union (tail xs)  (add (head xs) ys)\n</code></pre>\n\n<p>which seems to work as I would expect it would.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427315678, "post_id": 29265467, "comment_id": 46733698, "body": "There&#39;s no good reason to use type synonyms for the numerator and denominator. There&#39;s also no good reason to pair them. <code>data Fraction = Fraction Int Int</code> is a bit better. But integer overflow makes a mess of fractions, so you should consider <code>data Fraction = Fraction Integer Integer</code>.  Better still, <code>data Fraction = Fraction Integer Natural</code>, but I&#39;m not sure if <code>Natural</code> made it to GHC 7.10 and it&#39;s definitely not in earlier versions. By the way, don&#39;t forget to deal with division by zero."}, {"owner": {"reputation": 341, "user_id": 2124946, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2dcbb3b1808bf768d0868935eac39a54?s=128&d=identicon&r=PG&f=1", "display_name": "Phlex", "link": "https://stackoverflow.com/users/2124946/phlex"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427317211, "post_id": 29265467, "comment_id": 46734538, "body": "So the only reason I used the type synonyms was just force of habit, but that being said, I shall change it to Integer!"}], "answers": [{"comments": [{"owner": {"reputation": 341, "user_id": 2124946, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2dcbb3b1808bf768d0868935eac39a54?s=128&d=identicon&r=PG&f=1", "display_name": "Phlex", "link": "https://stackoverflow.com/users/2124946/phlex"}, "edited": false, "score": 0, "creation_date": 1427314324, "post_id": 29265543, "comment_id": 46732887, "body": "However, I am using a b within my code, it&#39;s just not at the part that is causing some errors. I use them in the Num functions such as addition and subtraction."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 341, "user_id": 2124946, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2dcbb3b1808bf768d0868935eac39a54?s=128&d=identicon&r=PG&f=1", "display_name": "Phlex", "link": "https://stackoverflow.com/users/2124946/phlex"}, "edited": false, "score": 1, "creation_date": 1427314489, "post_id": 29265543, "comment_id": 46732998, "body": "I would recommend looking at the implementation in <code>Data.Ratio</code> for ideas on how to structure your <code>Fraction</code> type.  My point is that your <code>a</code> and <code>b</code> type arguments to <code>Fraction</code> are phantom types, they aren&#39;t used by the only constructor for that type.  It&#39;d be like if I wrote <code>data Foo a b c = Bar</code>.  The type variables aren&#39;t used in the data constructor <code>Bar</code>, only in the type constructor <code>Foo</code>, so type checking is more ambiguous"}, {"owner": {"reputation": 341, "user_id": 2124946, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2dcbb3b1808bf768d0868935eac39a54?s=128&d=identicon&r=PG&f=1", "display_name": "Phlex", "link": "https://stackoverflow.com/users/2124946/phlex"}, "edited": false, "score": 0, "creation_date": 1427317060, "post_id": 29265543, "comment_id": 46734436, "body": "Okay, so reading into it, I tried working with your solution a little bit and seem to be running into the same issue when trying to recip. Would this be error on my end for writing out the Num instance?"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 2, "last_activity_date": 1427314110, "creation_date": 1427314110, "answer_id": 29265543, "question_id": 29265467, "link": "https://stackoverflow.com/questions/29265467/no-instance-for-fractional-numerator-denominator-fraction-a0-b0/29265543#29265543", "title": "No instance for (Fractional ((Numerator, Denominator) -&gt; Fraction a0 b0))", "body": "<p>The problem is that you aren't using the <code>a</code> or <code>b</code> in your <code>Fraction</code> data type, maybe you should just go with</p>\n\n<pre><code>data Fraction = Fraction (Numerator, Denominator)\n\ninstance Fractional Fraction where\n    recip (Fraction (a, b)) = Fraction (b, a)\n</code></pre>\n\n<p>But this also requires a <code>Num</code> instance:</p>\n\n<pre><code>instance Num Fraction where\n    ...\n</code></pre>\n\n<hr>\n\n<p>Basically, the reason for this error is because you specify that <code>a</code> and <code>b</code> must be fractional, but since that <code>a</code> and <code>b</code> aren't used in the constructor for <code>Fraction</code> the compiler has an arbitrary choice of which one to use.  It could do <code>Fractional (Fraction Float Double)</code>, or <code>Fractional (Fraction Double Float)</code>, or <code>Fractional (Fraction (Fraction Double Double) Float)</code>, so you see an error.</p>\n"}], "owner": {"reputation": 341, "user_id": 2124946, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2dcbb3b1808bf768d0868935eac39a54?s=128&d=identicon&r=PG&f=1", "display_name": "Phlex", "link": "https://stackoverflow.com/users/2124946/phlex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 29265543, "answer_count": 1, "score": 1, "last_activity_date": 1427314110, "creation_date": 1427313851, "question_id": 29265467, "link": "https://stackoverflow.com/questions/29265467/no-instance-for-fractional-numerator-denominator-fraction-a0-b0", "title": "No instance for (Fractional ((Numerator, Denominator) -&gt; Fraction a0 b0))", "body": "<p>I'm fairly new to Haskell and I seem to be stuck at one error in my code. I keep running into this error when I'm trying to override recip from fractional. My code is as follows:</p>\n\n<pre><code>type Numerator = Int\ntype Denominator = Int\ndata Fraction a b = Fraction (Numerator,Denominator)  deriving (Show, Eq)\ninstance (Fractional a, Fractional b) =&gt; Fractional (Fraction a b) where\n    recip (Fraction(a,b)) =\n        Fraction(b,a) \n</code></pre>\n\n<p>Is the problem due to the Numerator and Denominator are of type Int? I don't know what I'm doing wrong, but I have basic arithmetic operations that are in working order.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 302, "user_id": 4670927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jaKIv.jpg?s=128&g=1", "display_name": "Sumit Mahamuni", "link": "https://stackoverflow.com/users/4670927/sumit-mahamuni"}, "edited": false, "score": 0, "creation_date": 1427307193, "post_id": 29263211, "comment_id": 46728667, "body": "Why do you want composition?"}, {"owner": {"reputation": 302, "user_id": 4670927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jaKIv.jpg?s=128&g=1", "display_name": "Sumit Mahamuni", "link": "https://stackoverflow.com/users/4670927/sumit-mahamuni"}, "edited": false, "score": 0, "creation_date": 1427307298, "post_id": 29263211, "comment_id": 46728746, "body": "in my opinion this looks simple lambda expression. We can rewrite but depends what flexibility you want in the expression."}, {"owner": {"reputation": 127, "user_id": 218926, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/21a985fe3c4e1528feda7d81cdee3fc9?s=128&d=identicon&r=PG", "display_name": "Rohit", "link": "https://stackoverflow.com/users/218926/rohit"}, "reply_to_user": {"reputation": 302, "user_id": 4670927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jaKIv.jpg?s=128&g=1", "display_name": "Sumit Mahamuni", "link": "https://stackoverflow.com/users/4670927/sumit-mahamuni"}, "edited": false, "score": 1, "creation_date": 1427307348, "post_id": 29263211, "comment_id": 46728775, "body": "Hey @SumitMahamuni I am just a beginner, and I am curious to know if there is a clever way to write it."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1427323315, "post_id": 29263211, "comment_id": 46737241, "body": "Riffing on other answers, but just defining a function <code>xor a b = if b then not a else a</code>  looks fine.  If you don&#39;t need it all over the place, you can just stick it in a <code>where</code> declaration to the current function."}], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 218926, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/21a985fe3c4e1528feda7d81cdee3fc9?s=128&d=identicon&r=PG", "display_name": "Rohit", "link": "https://stackoverflow.com/users/218926/rohit"}, "edited": false, "score": 0, "creation_date": 1427307291, "post_id": 29263334, "comment_id": 46728737, "body": "It is xor, but I don&#39;t know how to implement it cleverly :(."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 127, "user_id": 218926, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/21a985fe3c4e1528feda7d81cdee3fc9?s=128&d=identicon&r=PG", "display_name": "Rohit", "link": "https://stackoverflow.com/users/218926/rohit"}, "edited": false, "score": 5, "creation_date": 1427307480, "post_id": 29263334, "comment_id": 46728841, "body": "@Rohit, great!  BTW, in Haskell it&#39;s spelled <code>&#47;=</code>.  And you can write the <code>(\\a b -&gt; a &#47;= b)</code> as simply <code>(&#47;=)</code>; it&#39;s a notation that works for all infix operators."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 12, "last_activity_date": 1427307143, "creation_date": 1427307143, "answer_id": 29263334, "question_id": 29263211, "link": "https://stackoverflow.com/questions/29263211/can-i-simplify-the-following-haskell-lambda/29263334#29263334", "title": "Can I simplify the following Haskell lambda?", "body": "<p>Let's look at the truth table:</p>\n\n<pre><code>   a    b      f\n------------+------- \nFalse False | False\nFalse True  | True\nTrue  False | True\nTrue  True  | False\n</code></pre>\n\n<p>That's interesting!  <code>f</code> is <code>True</code> whenever the inputs are not the same. Hmm......</p>\n"}, {"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1427308298, "post_id": 29263461, "comment_id": 46729355, "body": "<code>xor x x</code> doesn&#39;t check that the <code>x</code>s are the same, it just raises a conflicting definitions compile-time error."}], "tags": [], "owner": {"reputation": 777, "user_id": 3900056, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45ff0756018a3a41955b5d29e3ab63fb?s=128&d=identicon&r=PG&f=1", "display_name": "zcleghern", "link": "https://stackoverflow.com/users/3900056/zcleghern"}, "is_accepted": true, "score": 3, "last_activity_date": 1427309539, "last_edit_date": 1427309539, "creation_date": 1427307523, "answer_id": 29263461, "question_id": 29263211, "link": "https://stackoverflow.com/questions/29263211/can-i-simplify-the-following-haskell-lambda/29263461#29263461", "title": "Can I simplify the following Haskell lambda?", "body": "<p>As another user pointed out, this is an example of <code>xor</code>, so how would we define this function?</p>\n\n<p>If the inputs are equal, the result is false.\nIf the inputs are not equal, the result is true.</p>\n\n<pre><code>\\x y -&gt; x /= y\n</code></pre>\n\n<p>Edit: The commentor is correct, my bad! The definition I gave previously does not work.</p>\n"}], "owner": {"reputation": 127, "user_id": 218926, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/21a985fe3c4e1528feda7d81cdee3fc9?s=128&d=identicon&r=PG", "display_name": "Rohit", "link": "https://stackoverflow.com/users/218926/rohit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "accepted_answer_id": 29263461, "answer_count": 2, "score": 3, "last_activity_date": 1427309539, "creation_date": 1427306786, "question_id": 29263211, "link": "https://stackoverflow.com/questions/29263211/can-i-simplify-the-following-haskell-lambda", "title": "Can I simplify the following Haskell lambda?", "body": "<p>I want to simplify the following lambda using composition or some higher order magic,</p>\n\n<pre><code>(\\a b -&gt; if (b) then (not a) else a)\n</code></pre>\n\n<p>but I couldn't think of a clever way. Could you please help me out?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "dynamic-loading", "dynamic-compilation"], "comments": [{"owner": {"reputation": 3637, "user_id": 797637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1577f43a7c6eb01836e1758a2ba4df5?s=128&d=identicon&r=PG&f=1", "display_name": "firefrorefiddle", "link": "https://stackoverflow.com/users/797637/firefrorefiddle"}, "edited": false, "score": 0, "creation_date": 1427348558, "post_id": 29262888, "comment_id": 46743907, "body": "Can you show your cabal file?"}, {"owner": {"reputation": 71, "user_id": 4703841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bc44ea2b8927c40112d69ca59e3d1d0?s=128&d=identicon&r=PG&f=1", "display_name": "W. Davis", "link": "https://stackoverflow.com/users/4703841/w-davis"}, "reply_to_user": {"reputation": 3637, "user_id": 797637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1577f43a7c6eb01836e1758a2ba4df5?s=128&d=identicon&r=PG&f=1", "display_name": "firefrorefiddle", "link": "https://stackoverflow.com/users/797637/firefrorefiddle"}, "edited": false, "score": 0, "creation_date": 1427352771, "post_id": 29262888, "comment_id": 46745035, "body": "I assumed the plugins package uses plain ghc. I&#39;ve updated the question."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1433525296, "post_id": 29262888, "comment_id": 49406833, "body": "I&#39;d assume the <code>plugins</code> package no longer works. It was last updated in 2013, and the GHC API has changed several times since then."}, {"owner": {"reputation": 2890, "user_id": 3821009, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8c7fb1f9e34d1b461b185b16dd447cad?s=128&d=identicon&r=PG&f=1", "display_name": "levant pied", "link": "https://stackoverflow.com/users/3821009/levant-pied"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1445542770, "post_id": 29262888, "comment_id": 54378569, "body": "@Cubic Looks like it was just updated for GHC 7.10 <a href=\"https://github.com/stepcut/plugins/commit/53a0f5b97bb305140a076d866eeabe4b1875f34b\" rel=\"nofollow noreferrer\">github.com/stepcut/plugins/commit/&hellip;</a>"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 2890, "user_id": 3821009, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8c7fb1f9e34d1b461b185b16dd447cad?s=128&d=identicon&r=PG&f=1", "display_name": "levant pied", "link": "https://stackoverflow.com/users/3821009/levant-pied"}, "edited": false, "score": 0, "creation_date": 1445546302, "post_id": 29262888, "comment_id": 54380725, "body": "@levantpied Yep, but I know the guy who made those commits and I don&#39;t think he intends on maintaining it - I imagine he was just tinkering with plugins for a while."}], "owner": {"reputation": 71, "user_id": 4703841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bc44ea2b8927c40112d69ca59e3d1d0?s=128&d=identicon&r=PG&f=1", "display_name": "W. Davis", "link": "https://stackoverflow.com/users/4703841/w-davis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 507, "favorite_count": 0, "answer_count": 0, "score": 7, "last_activity_date": 1427352678, "creation_date": 1427305635, "last_edit_date": 1427352678, "question_id": 29262888, "link": "https://stackoverflow.com/questions/29262888/dynamic-code-loading-w-haskell", "title": "Dynamic code loading w/ Haskell", "body": "<p>I've been playing around with the <a href=\"https://hackage.haskell.org/package/plugins\" rel=\"nofollow\">plugins</a> package. I want a host application to dynamically compile and load Haskell source files in a sandboxed environment. Compilation works just fine. Loading fails as soon as the plugin  references modules available in the sandbox only. Here is what I've got for the plugin:</p>\n\n<pre><code>module Plugin (resource) where\n\nimport ServerAPI\nimport System.Plugins -- this module is only available in the sandbox\n\nresource = Interface { action = timesTwo }\n\ntimesTwo :: Integer -&gt; IO Integer\ntimesTwo n = return $ n * 2\n</code></pre>\n\n<p>Loading the plugin from the host application looks like this:</p>\n\n<pre><code>pkgConfDir = \"/home/me/plugins/.cabal-sandbox/x86_64-osx-ghc-7.8.4-packages.conf.d\nloadedOk &lt;- pdynload \"Plugin.o\" [\".\"] [pkgConfDir] \"ServerAPI.Interface\" \"resource\"\n</code></pre>\n\n<p>This is what I've got in the sandbox:</p>\n\n<pre><code>&gt; cabal sandbox hc-pkg list\n\u2026\n/home/me/plugins/.cabal-sandbox/x86_64-osx-ghc-7.8.4-packages.conf.d\n    plugins-1.5.4.0\n\u2026\n</code></pre>\n\n<p>This is what I get when running the host application:</p>\n\n<pre><code>Failed to load interface for \u2018System.Plugins.Env\u2019\nno package matching \u2018plugins-1.5.4.0\u2019 was found\n</code></pre>\n\n<p>As mentioned above, when I get rid of the <code>import System.Plugins</code> statement in the plugin the code does load. What am I missing?</p>\n\n<p>Edit:</p>\n\n<p>The cabal file:</p>\n\n<pre><code>name:                plugins\nversion:             0.1.0.0\n-- synopsis:\n-- description:\n-- license:\nlicense-file:        LICENSE\nauthor:              W. Davis\nmaintainer:          w.davis@spam.me.not\n-- copyright:\n-- category:\nbuild-type:          Simple\n-- extra-source-files:\ncabal-version:       &gt;=1.10\n\nexecutable plugins\n  main-is:             Main.hs\n  -- other-modules:       \n  -- other-extensions:\n  build-depends:       base &gt;=4.7 &amp;&amp; &lt;4.8, plugins &gt;=1.5 &amp;&amp; &lt;1.6\n  -- hs-source-dirs:\n  default-language:    Haskell2010\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "functional-programming", "parsec", "left-recursion"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427294663, "post_id": 29258681, "comment_id": 46719973, "body": "Could you explain why this combinator is needed? What makes it better than using <code>many</code> and then folding over the result? I&#39;m still trying to learn the basics of parsing too."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1427297865, "post_id": 29258681, "comment_id": 46722367, "body": "It&#39;s probably somewhat faster, but I think it&#39;s mostly convention and communication of intent. I think parser combinators should generally resemble &quot;pure&quot; CFG notation as much as possible, and should minimize the amount of post-facto AST manipulation. Readers of our code should be able to see the grammar clearly and be not overly burdened by operational details. Left recursion is one point where we must deviate from abstract notation, so we try to encapsulate it in <code>chainl</code>."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 5, "last_activity_date": 1427300318, "last_edit_date": 1427300318, "creation_date": 1427294206, "answer_id": 29258681, "question_id": 29257907, "link": "https://stackoverflow.com/questions/29257907/translate-grammar-production-to-parsec/29258681#29258681", "title": "Translate grammar production to Parsec", "body": "<p>Use <a href=\"https://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Combinator.html\" rel=\"nofollow\"><code>chainl1</code></a>. <code>chainl1 p op</code> parses one or more <code>p</code>-s separated by <code>op</code>-s in a left-associative way. <code>op</code> returns a binary function which is used to combine the results of the <code>p</code>-s on both sides into a single result. </p>\n\n<p>Since your grammar doesn't seem to have a separator, you can use <code>chainl1</code> with an <code>op</code> that just returns the combining function:</p>\n\n<pre><code>callExpr :: IParser Expr\ncallExpr = chainl1 primaryExpr (return CallExpr)\n</code></pre>\n\n<p>As to your <code>callExpr</code> implementation, I can spot two errors.</p>\n\n<p>First, you use <code>return $ callExpr' e</code>, but <code>callExpr' e</code> is already a monadic value, so just <code>callExpr' e</code> would be correct.</p>\n\n<p>Second, in <code>maybe e (\\e2 -&gt; callExpr' (CallExpr e e2)) e2m</code>, the default <code>e</code> should be monadic (or else how could we bind it to <code>e'</code>?), so it should be <code>return e</code>.</p>\n"}], "owner": {"reputation": 780, "user_id": 1315126, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/35561833646b79f4f817c343bacb7c78?s=128&d=identicon&r=PG", "display_name": "Mathias Vorreiter Pedersen", "link": "https://stackoverflow.com/users/1315126/mathias-vorreiter-pedersen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 29258681, "answer_count": 1, "score": 4, "last_activity_date": 1427300318, "creation_date": 1427292183, "last_edit_date": 1427292827, "question_id": 29257907, "link": "https://stackoverflow.com/questions/29257907/translate-grammar-production-to-parsec", "title": "Translate grammar production to Parsec", "body": "<p>I'm trying to convert the following grammar production</p>\n\n<pre><code>callExpr:\n    primaryExpr\n  | callExpr primaryExpr\n</code></pre>\n\n<p>to a Parsec expression in Haskell.</p>\n\n<p>Obviously the problem is that it's left-recursive, so I'm trying to parse it recursive-ascent style. The pseudocode I'm trying to implement is:</p>\n\n<pre><code>e = primaryExp\nwhile(true) {\n    e2 = primaryExp\n    if(e2 failed) break;\n    e = CallExpr(e, e2)\n}\n</code></pre>\n\n<p>and my attempt at translating this into Haskell is:</p>\n\n<pre><code>callExpr :: IParser Expr\ncallExpr = do\n    e &lt;- primaryExpr\n    return $ callExpr' e\n  where\n    callExpr' e = do\n        e2m &lt;- optionMaybe primaryExpr\n        e' &lt;- maybe e (\\e2 -&gt; callExpr' (CallExpr e e2)) e2m\n        return e'\n</code></pre>\n\n<p>where <code>primaryExpr</code> has type <code>IParser Expr</code>\nand IParser is defined as</p>\n\n<pre><code>type IParser a = ParsecT String () (State SourcePos) a\n</code></pre>\n\n<p>This however gives me the following type error:</p>\n\n<pre><code>Couldn't match type `ParsecT String () (State SourcePos) t0'\n              with `Expr'\nExpected type: ParsecT String () (State SourcePos) Expr\n  Actual type: ParsecT\n                 String\n                 ()\n                 (State SourcePos)\n                 (ParsecT String () (State SourcePos) t0)\nIn a stmt of a 'do' block: return $ callExpr' e\nIn the expression:\n  do { e &lt;- primaryExpr;\n       return $ callExpr' e }\nIn an equation for `callExpr':\n    callExpr\n      = do { e &lt;- primaryExpr;\n             return $ callExpr' e }\n      where\n          callExpr' e\n            = do { e2m &lt;- optionMaybe primaryExpr;\n                   .... }\n</code></pre>\n\n<p>How do I fix this type error?</p>\n"}, {"tags": ["haskell", "lambda", "functional-programming", "lambda-calculus"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1427300873, "post_id": 29257442, "comment_id": 46724450, "body": "So what have you tried? What&#39;s your encoding of the Church numbers in Haskell? How would you implement <code>1-tuple</code> and <code>1-tuple-fst</code> in Haskell?"}, {"owner": {"reputation": 163, "user_id": 3416793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hSVtV.jpg?s=128&g=1", "display_name": "blazej", "link": "https://stackoverflow.com/users/3416793/blazej"}, "edited": false, "score": 0, "creation_date": 1427301351, "post_id": 29257442, "comment_id": 46724795, "body": "Another question I would ask is what is your desired end-goal. Maybe there is another way of doing what you want without having to create generalized tuples. Plus, how would those tuples be used subsequently?"}, {"owner": {"reputation": 272, "user_id": 1482096, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90158cf95c807dee6178e02f69b65373?s=128&d=identicon&r=PG", "display_name": "amakarov", "link": "https://stackoverflow.com/users/1482096/amakarov"}, "edited": false, "score": 0, "creation_date": 1427301855, "post_id": 29257442, "comment_id": 46725141, "body": "Isn&#39;t it obvious that it&#39;s not possible?  Each of terms 1-tuple, ... n-tuple,... has different type.  What should be the type of the required function?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1427301937, "post_id": 29257442, "comment_id": 46725196, "body": "amakarov: depends. If each Church number has a different type, then it might be possible."}, {"owner": {"reputation": 272, "user_id": 1482096, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90158cf95c807dee6178e02f69b65373?s=128&d=identicon&r=PG", "display_name": "amakarov", "link": "https://stackoverflow.com/users/1482096/amakarov"}, "edited": false, "score": 2, "creation_date": 1427302086, "post_id": 29257442, "comment_id": 46725296, "body": "I was wrong, this question is for untyped lambda.  And not each correct term can be assigned a type."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 272, "user_id": 1482096, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90158cf95c807dee6178e02f69b65373?s=128&d=identicon&r=PG", "display_name": "amakarov", "link": "https://stackoverflow.com/users/1482096/amakarov"}, "edited": false, "score": 1, "creation_date": 1427302087, "post_id": 29257442, "comment_id": 46725298, "body": "@amakarov I think the type can be given in Calculus of Constructions or other dependent LC-s."}, {"owner": {"reputation": 272, "user_id": 1482096, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90158cf95c807dee6178e02f69b65373?s=128&d=identicon&r=PG", "display_name": "amakarov", "link": "https://stackoverflow.com/users/1482096/amakarov"}, "edited": false, "score": 0, "creation_date": 1427302392, "post_id": 29257442, "comment_id": 46725528, "body": "rampion: Is&#39;nt the type for Church numbers known (a -&gt; (a -&gt; a) -&gt; a)?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1427304323, "post_id": 29257442, "comment_id": 46726721, "body": "I have tried a lot of things, actually... do you want me to elaborate? I&#39;ve also managed to get half of the problem (the accessors) :) but the tuples themselves are proving to be really hard."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1427304764, "post_id": 29257442, "comment_id": 46727032, "body": "amakarov: It can be, but you <a href=\"https://gist.github.com/rampion/38d871a8f71eb7167282\" rel=\"nofollow noreferrer\">can give each church number a distinct type</a>"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1427304782, "post_id": 29257442, "comment_id": 46727040, "body": "Viclib: yes, please, elaborate."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1427306340, "post_id": 29257442, "comment_id": 46728102, "body": "@Andr&#225;sKov&#225;cs I concur. CoC should allow this, and one can code this in Agda or Coq exploiting dependent types. In the untyped lambda of course it&#39;s possible as well. In Haskell, we can not do this using plain integers, but if we allow ourselves to use singletons instead, I guess we should be able to simulate dependent types just enough to perform this."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1427308835, "post_id": 29257442, "comment_id": 46729689, "body": "@rampion alright, done."}], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1427306210, "post_id": 29262640, "comment_id": 46728027, "body": "A huge hint: <code>constN&#39;</code> could be written in terms of <code>constN</code> if you had a way to <code>flip</code> the first <code>n</code> arguments of an <code>n + 1</code> argument function past the last argument.That <code>flip</code> <i>is</i> tuple construction for <code>n</code>; it remembers <code>n</code>  things."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 2, "last_activity_date": 1427304946, "creation_date": 1427304946, "answer_id": 29262640, "question_id": 29257442, "link": "https://stackoverflow.com/questions/29257442/is-it-possible-to-implement-a-function-that-returns-an-n-tuple-on-the-lambda-cal/29262640#29262640", "title": "Is it possible to implement a function that returns an n-tuple on the lambda calculus?", "body": "<p>If you can construct the <code>n</code>-tuples, you can easily access the <code>i</code>th index.</p>\n\n<p>First, we need a type for the otherwise infinite untyped lambda functions. The extra <code>X</code> constructor allows us to inspect these functions by executing them.</p>\n\n<pre><code>import Prelude hiding (succ, pred)\n\ndata Value x = X x | F (Value x -&gt; Value x)\n\ninstance (Show x) =&gt; Show (Value x) where\n    show (X x) = \"X \" ++ show x\n    show _     = \"F\"\n</code></pre>\n\n<p>It's convenient to be able to apply functions to each other.</p>\n\n<pre><code>ap :: Value x -&gt; Value x -&gt; Value x\nap (F f) = f\nap _     = error \"Attempt to apply Value\"\n\ninfixl 1 `ap`\n</code></pre>\n\n<p>If you are going to encode numbers with Church numerals you need some church numerals. We will also need subtraction to figure out how many additional arguments to skip when indexing into an <code>n</code> tuple.</p>\n\n<pre><code>idF = F $ \\x -&gt; x\n\nzero = F $ \\f -&gt; idF\nsucc = F $ \\n -&gt; F $ \\f -&gt; F $ \\x -&gt; f `ap` (n `ap` f `ap` x)\n\none = succ `ap` zero\ntwo = succ `ap` one\nthree = succ `ap` two\nfour = succ `ap` three\n\npred = F $ \\n -&gt; F $ \\f -&gt; F $ \\x -&gt; n `ap` (F $ \\g -&gt; F $ \\h -&gt; h `ap` (g `ap` f)) `ap` (F $ \\u -&gt; x) `ap` idF\n\nsubtractF = F $ \\n -&gt; (n `ap` pred)\n</code></pre>\n\n<p>The constant function drops its first argument. If we iterate the constant function some numeral number of times, it drops that many first arguments.</p>\n\n<pre><code>--drops the first argument\nconstF = F $ \\f -&gt; F $ \\x -&gt; f\n-- drops i first arguments\nconstN = F $ \\i -&gt; i `ap` constF\n</code></pre>\n\n<p>We can make another constant function that drops its second argument. If we iterate it some numeral number of times, it drops that many second arguments.</p>\n\n<pre><code>-- drops the second argument\nconstF' = F $ \\f -&gt; F $ \\a -&gt; F $ \\b -&gt; f `ap` a\n-- drops n second arguments\nconstN' = F $ \\n -&gt; n `ap` constF'\n</code></pre>\n\n<p>To index into an <code>n</code> tuple's <code>i</code>th index (starting at <code>zero</code> for the first index), we need to drop <code>n-i-1</code> arguments off the end and drop <code>i</code> arguments off the start.</p>\n\n<pre><code>-- drops (n-i-1) last arguments and i first arguments\naccess = F $ \\n -&gt; F $ \\i -&gt; constN `ap` i `ap` (constN' `ap` (subtractF `ap` (succ `ap` i) `ap` n) `ap` idF)\n</code></pre>\n\n<p>We'll define few example tuples of fixed size</p>\n\n<pre><code>tuple1 = F $ \\a -&gt;                     F $ \\t -&gt; t `ap` a\ntuple2 = F $ \\a -&gt; F $ \\b           -&gt; F $ \\t -&gt; t `ap` a `ap` b\ntuple3 = F $ \\a -&gt; F $ \\b -&gt; F $ \\c -&gt; F $ \\t -&gt; t `ap` a `ap` b `ap` c\n</code></pre>\n\n<p>which we can use to demonstrate that <em>it is possible to generate the corresponding accessors</em>.</p>\n\n<pre><code>main = do\n    print $ tuple1 `ap` (X \"Example\")           `ap` (access `ap` one `ap` zero)\n\n    print $ tuple2 `ap` (X \"Hello\") `ap` (X \"World\") `ap` (access `ap` two `ap` zero)\n    print $ tuple2 `ap` (X \"Hello\") `ap` (X \"World\") `ap` (access `ap` two `ap` one)\n\n    print $ tuple3 `ap` (X \"Goodbye\") `ap` (X \"Cruel\") `ap` (X \"World\") `ap` (access `ap` three `ap` zero)\n    print $ tuple3 `ap` (X \"Goodbye\") `ap` (X \"Cruel\") `ap` (X \"World\") `ap` (access `ap` three `ap` one)\n    print $ tuple3 `ap` (X \"Goodbye\") `ap` (X \"Cruel\") `ap` (X \"World\") `ap` (access `ap` three `ap` two)\n</code></pre>\n\n<p>Running this outputs </p>\n\n<pre><code>X \"Example\"\nX \"Hello\"\nX \"World\"\nX \"Goodbye\"\nX \"Cruel\"\nX \"World\"\n</code></pre>\n\n<p>To construct tuples you will need to iterate some function that adds arguments to a function instead of dropping them.</p>\n"}, {"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1427328066, "post_id": 29267372, "comment_id": 46738889, "body": "Thank you very much! I haven&#39;t studied your answer yet but I will as soon as I get back to work. Since it uses recursion, it doesn&#39;t solve my problem (I can&#39;t use it!) but it is my fault as I forgot stating that on the question. If anyone knows how to implement it non-recursively, please post it too! In case nobody else answers I&#39;ll be accepting this one in a while."}], "tags": [], "owner": {"reputation": 272, "user_id": 1482096, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90158cf95c807dee6178e02f69b65373?s=128&d=identicon&r=PG", "display_name": "amakarov", "link": "https://stackoverflow.com/users/1482096/amakarov"}, "is_accepted": false, "score": 5, "last_activity_date": 1427369023, "last_edit_date": 1427369023, "creation_date": 1427320853, "answer_id": 29267372, "question_id": 29257442, "link": "https://stackoverflow.com/questions/29257442/is-it-possible-to-implement-a-function-that-returns-an-n-tuple-on-the-lambda-cal/29267372#29267372", "title": "Is it possible to implement a function that returns an n-tuple on the lambda calculus?", "body": "<p>Let </p>\n\n<pre><code>foldargs = \u03bb t n f z . (IsZero n) (t z) (\u03bb a . foldargs t (pred n) f (f a z))\n</code></pre>\n\n<p>Then function </p>\n\n<pre><code>listofargs = \u03bb n . foldargs id n pair null\n</code></pre>\n\n<p>returns reversed list of its args:</p>\n\n<pre><code>listofargs 5 a b c d e --&gt; (e . (d . (c . (b . (a . null))))) or [e d c b a]\n</code></pre>\n\n<p>Function </p>\n\n<pre><code>apply = \u03bb f l . (isnil l) f (apply (f (head l)) (tail l))\n</code></pre>\n\n<p>applies first argument (n-ary function) to arguments taken from the second argument (a list of length n):</p>\n\n<pre><code>apply f [a b c d e]  --&gt; f a b c d e\n</code></pre>\n\n<p>The rest is easy:</p>\n\n<pre><code>n-tuple = \u03bb n . foldargs n-tuple' (Succ n) pair null \n</code></pre>\n\n<p>where</p>\n\n<pre><code>n-tuple' = \u03bb l . apply (head l) (reverse (tail l))\n</code></pre>\n\n<p>Implementation of the other functions can be taken from <a href=\"https://en.wikipedia.org/wiki/Church_encoding\" rel=\"nofollow\">wikipedia</a>.\nRecursion can be eliminated by <a href=\"https://en.wikipedia.org/wiki/Fixed-point_combinator\" rel=\"nofollow\">Y-combinator</a>.\n<code>reverse</code> is simple.</p>\n\n<p>UPD: Nonrecursive versions of the functions:</p>\n\n<pre><code>foldargs = Y (\u03bb c t n f z . (IsZero n) (t z) (\u03bb a . c t (pred n) f (f a z)))\napply = Y (\u03bb c f l . (isnil l) f (c (f (head l)) (tail l)))\nY = \u03bb f (\u03bb x . f x x) (\u03bb x . f x x)\n</code></pre>\n\n<p>\ufffc\ufffc\n\ufffc</p>\n"}, {"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1427394239, "post_id": 29268393, "comment_id": 46769559, "body": "Are you sure this is correct? I&#39;m testing it over and over but it doesn&#39;t reduce to the expressions you posted. I&#39;ve reviewed it a few times. Feel like I&#39;m missing something obvious, but I can&#39;t figure out what? <a href=\"http://lpaste.net/129687\" rel=\"nofollow noreferrer\">lpaste.net/129687</a>"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1427396321, "post_id": 29268393, "comment_id": 46770735, "body": "Ah I noticed you are using a different convention for zero and succ, inverting the arguments. But even using it, <code>nTupCon (suc (suc (suc zero)))</code> reduces to <code>(\u03bb a b c t \u2192 (t (c (b a))))</code>, which is not the 3-tuple (it should be <code>(((t a) b) c)</code>)..."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1427397046, "post_id": 29268393, "comment_id": 46771128, "body": "It&#39;s possible I messed it up, I&#39;ll look into it. We should certainly benefit from a nice LC interpreter but I haven&#39;t found good ones on the internet on short notice."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1427397279, "post_id": 29268393, "comment_id": 46771238, "body": "Uh huh, absolutely agree on that. <i>If</i> you want, I&#39;m using <a href=\"http://lpaste.net/129692\" rel=\"nofollow noreferrer\">this one</a> which I made for this. Really wish we had an industrial strength optimal lambda evaluator."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1427398091, "post_id": 29268393, "comment_id": 46771676, "body": "I found one error, now it checks out for me fine. <code>compN</code> is correctly (hopefully) <code>\u03bb n. n (\u03bb f. f) (\u03bb hyp f g x. hyp f (g x))</code> See <a href=\"http://lpaste.net/129694\" rel=\"nofollow noreferrer\">this</a>  for the reduction."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1427403400, "post_id": 29268393, "comment_id": 46774611, "body": "Hm... indeed, that seems to work. That&#39;s impressive. Thank you very much. I will try to understand what you&#39;ve done now, but I guess I&#39;ll have to do that looking at the ULC expressions, since I don&#39;t understand Agda. Just a little question, why did you invert the church numbers? That is, you use <code>(\u03bb x f . f (f (f x))))</code> for 3, instead of <code>(\u03bb f x . f (f (f x))))</code>."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1427404653, "post_id": 29268393, "comment_id": 46775284, "body": "I think I used it that way because we usually do  <code>data Nat = Z | S Nat</code>, and in Haskell we tend to preserve the order of constructors when using Church-encoded forms. In type theory we also usually put the zero constructor first. Looking at the Wiki page for Church numerals I see now that they use the other ordering. It&#39;s pretty much arbitrary."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1427420502, "post_id": 29268393, "comment_id": 46780693, "body": "Do you have the right result here for <code>nTup 10</code>? I&#39;m not sure if my interpreter is broken because it doesn&#39;t work here :("}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1427437148, "post_id": 29268393, "comment_id": 46784950, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/73899/discussion-between-andras-kovacs-and-viclib\">continue this discussion in chat</a>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1427492011, "post_id": 29268393, "comment_id": 46814922, "body": "Hey! I&#39;m sorry for not answering you yesterday. Indeed, it was my mistake, sorry! Also, I really hope I didn&#39;t play the help-vampire here. There is a line between asking clarifications and requesting further help. Hope I didn&#39;t cross it. Thank you again!"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 5, "last_activity_date": 1427398133, "last_edit_date": 1495542809, "creation_date": 1427325831, "answer_id": 29268393, "question_id": 29257442, "link": "https://stackoverflow.com/questions/29257442/is-it-possible-to-implement-a-function-that-returns-an-n-tuple-on-the-lambda-cal/29268393#29268393", "title": "Is it possible to implement a function that returns an n-tuple on the lambda calculus?", "body": "<p>Let's try to implement the n-ary tuple constructor. I shall also aim for a simple implementation, meaning that I try sticking to the elimination of natural numbers and tuples, and try to avoid using other (Church encoded) data structures.</p>\n\n<p>My strategy is as follows:</p>\n\n<ol>\n<li>Write a well-typed version of the function in a dependent language.</li>\n<li>Translate it to untyped lambda calculus.</li>\n</ol>\n\n<p>The reason for this is that I quickly get lost in untyped lambda calculus and I'm bound to make quite a few mistakes along the way, while the dependently typed environment puts me on rails. Also, proof assistants are just great help for writing any kind of code.</p>\n\n<h3>Step one</h3>\n\n<p>I use Agda. I cheat a bit with <code>type-in-type</code>. It makes Agda inconsistent, but for this problem proper type universes would be a huge pain, and it's very unlikely that we actually run into an inconsistency here anyway. </p>\n\n<pre><code>{-# OPTIONS --type-in-type #-}\n\nopen import Data.Nat\nopen import Data.Vec\n</code></pre>\n\n<p>We need a notion of n-ary polymorphic functions. We store the argument types in a vector of length <code>n</code>:</p>\n\n<pre><code>NFun : \u2200 {n} \u2192 Vec Set n \u2192 Set \u2192 Set\nNFun []       r = r\nNFun (x \u2237 ts) r = x \u2192 NFun ts r\n-- for example, NFun (Nat \u2237 Nat \u2237 []) = \u03bb r \u2192 Nat \u2192 Nat \u2192 r\n</code></pre>\n\n<p>We have the usual Church encoding for tuples. The constructors for n-ary tuples are n-ary functions returning a tuple.</p>\n\n<pre><code>NTup : \u2200 {n} \u2192 Vec Set n \u2192 Set\nNTup ts = \u2200 {r} \u2192 NFun ts r \u2192 r\n\nNTupCons : \u2115 \u2192 Set\nNTupCons n = \u2200 ts \u2192 NFun {n} ts (NTup ts)\n</code></pre>\n\n<p>We'd like to have a function with type <code>\u2200 {n} \u2192 NTupCons n</code>. We recurse on the <code>Vec Set n</code> parameter for the tuple constructor. The empty case is simple enough, but the cons case is a bit trickier:</p>\n\n<pre><code>nTupCons : \u2200 {n} \u2192 NTupCons n\nnTupCons []       x = x\nnTupCons (t \u2237 ts) x = ?\n</code></pre>\n\n<p>We need a <code>NFun ts (NTup (t \u2237 ts))</code> in place of the question mark. We know that <code>nTupCons ts</code> has type <code>NFun ts (NTup ts)</code>, so we need to somehow get the former from the latter. We notice that what we need is just n-ary function composition, or in other words a functorial map over the return type of <code>NFun</code>:</p>\n\n<pre><code>compN : \u2200 {n A B} (ts : Vec Set n) \u2192 (A \u2192 B) \u2192 NFun ts A \u2192 NFun ts B\ncompN []       f     = f\ncompN (t \u2237 ts) f g x = compN ts f (g x)\n</code></pre>\n\n<p>Now, we only need to get an <code>NTup (t \u2237 ts)</code> from an <code>NTup ts</code>, and since we already have <code>x</code> with type <code>t</code> in scope, that's pretty easy:</p>\n\n<pre><code>nTupCons : \u2200 {n} \u2192 NTupCons n\nnTupCons []       x = x\nnTupCons (t \u2237 ts) x = compN ts consTup (nTupCons ts)\n  where\n  consTup : NTup ts \u2192 NTup (t \u2237 ts)\n  consTup tup con = tup (con x)\n</code></pre>\n\n<h3>Step two</h3>\n\n<p>We shall get rid of the <code>Vec Set n</code>-s and rewrite the functions so they iterate on the <code>n</code> parameters. However, simple iteration is not good for <code>nTupCons</code>, since that only provides us the recursive result (<code>nTupCons ts</code>), but we also need the current <code>n</code> index for <code>compN</code> (since we implement <code>compN</code> by iterating on <code>n</code>). So we write a helper that's a bit like a <a href=\"https://stackoverflow.com/questions/13317242/what-are-paramorphisms\">paramorphism</a>. We also need Church encoded pairs here to pass up the <code>Nat</code>-s through the iteration:</p>\n\n<pre><code>zero = \u03bb z s. z\nsuc  = \u03bb n z s. s (n z s)\nfst  = \u03bb p. p (\u03bb a b. a)\nsnd  = \u03bb p. p (\u03bb a b. b)\n\n-- Simple iteration has type \n-- \u2200 {A} \u2192 A \u2192 (A \u2192 A) \u2192 Nat \u2192 A\n\n-- In contrast, we may imagine rec-with-n having the following type\n-- \u2200 {A} \u2192 A \u2192 (A \u2192 Nat \u2192 A) \u2192 Nat \u2192 A\n-- We also pass the Nat index of the hypothesis to the \"cons\" case\n\nrec-with-n = \u03bb z f n . \n  fst (\n    n \n      (\u03bb p. p z zero)\n      (\u03bb hyp p. p (f (fst hyp) (snd hyp)) (suc (snd hyp))))\n\n-- Note: I use \"hyp\" for \"hypothesis\". \n</code></pre>\n\n<p>The rest is straightforward to translate:</p>\n\n<pre><code>compN = \u03bb n. n (\u03bb f. f) (\u03bb hyp f g x. hyp f (g x))\n\nnTupCon = \n  rec-with-n\n    (\u03bb x. x)\n    (\u03bb hyp n. \u03bb x. compN n (\u03bb f g. f (g x)) hyp)\n</code></pre>\n\n<p>Let's test it for simple cases:</p>\n\n<pre><code>nTupCon zero = \n(\u03bb t. t)\n\nnTupCon (suc zero) =\n(\u03bb hyp n. \u03bb x. compN n (\u03bb f g. f (g x)) hyp) (nTupCon zero) zero =\n\u03bb x. compN zero (\u03bb f g. f (g x)) (\u03bb t. t) =\n\u03bb x. (\u03bb f g. f (g x)) (\u03bb t. t) =\n\u03bb x. \u03bb g. (\u03bb t. t) (g x) =\n\u03bb x . \u03bb g. g x =\n\u03bb x g . g x\n\nnTupCon (suc (suc zero)) =\n(\u03bb hyp n. \u03bb x. compN n (\u03bb f g. f (g x)) hyp) (nTupCon (suc zero)) (suc zero) =\n\u03bb x. compN (suc zero) (\u03bb f g. f (g x)) (\u03bb a t. t a) =\n\u03bb x a. (\u03bb f g. f (g x)) ((\u03bb y t. t y) a) =\n\u03bb x a. (\u03bb f g. f (g x)) (\u03bb t. t a) =\n\u03bb x a g. (\u03bb t. t a) (g x) =\n\u03bb x a g. g x a\n</code></pre>\n\n<p>It seems to work.</p>\n"}, {"tags": [], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "is_accepted": false, "score": 3, "last_activity_date": 1428806512, "last_edit_date": 1428806512, "creation_date": 1427428271, "answer_id": 29292974, "question_id": 29257442, "link": "https://stackoverflow.com/questions/29257442/is-it-possible-to-implement-a-function-that-returns-an-n-tuple-on-the-lambda-cal/29292974#29292974", "title": "Is it possible to implement a function that returns an n-tuple on the lambda calculus?", "body": "<p>I found it! There you go:</p>\n\n<pre><code>nTup = (\u03bb n . (n (\u03bb f t k . (f (\u03bb e . (t (e k))))) (\u03bb x . x) (\u03bb x . x)))\n</code></pre>\n\n<p>Testing:</p>\n\n<pre><code>nTup n1 \u2192 (\u03bb (\u03bb (0 1)))\nnTup n2 \u2192 (\u03bb (\u03bb (\u03bb ((0 1) 2))))\nnTup n3 \u2192 (\u03bb (\u03bb (\u03bb (\u03bb (((0 1) 2) 3)))))\nnTup n4 \u2192 (\u03bb (\u03bb (\u03bb (\u03bb (\u03bb ((((0 1) 2) 3) 4))))))\n</code></pre>\n\n<p>And so on. It stores the elements backwards but I don't think I'm gonna fix that - it looks more natural like so. The challenge was getting that 0 on the leftmost innermost paren. As I said, I could easily get both <code>(0 (1 (2 (3 4))))</code> and <code>((((4 3) 2) 1) 0)</code>, but those don't work as tuples because that <code>0</code> is what holds the elements there. </p>\n\n<p>Thank you all! </p>\n\n<p>Edit: I've actually settled with this one:</p>\n\n<pre><code>nTup = (\u03bb a . (a (\u03bb b c d . (b (\u03bb b . (c b d)))) (\u03bb x . x) (\u03bb x . x)))\n</code></pre>\n\n<p>Which preserves the correct order.</p>\n\n<pre><code>nTup n4 \u2192 (\u03bb (\u03bb (\u03bb (\u03bb (\u03bb ((((0 4) 3) 2) 1))))))\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 789, "favorite_count": 2, "accepted_answer_id": 29268393, "answer_count": 4, "score": 5, "last_activity_date": 1428806512, "creation_date": 1427291025, "last_edit_date": 1427327869, "question_id": 29257442, "link": "https://stackoverflow.com/questions/29257442/is-it-possible-to-implement-a-function-that-returns-an-n-tuple-on-the-lambda-cal", "title": "Is it possible to implement a function that returns an n-tuple on the lambda calculus?", "body": "<p>An n-tuple on the lambda calculus is usually defined as:</p>\n\n<pre><code>1-tuple:     \u03bb a t . t a\n1-tuple-fst: \u03bb t . t (\u03bb a . a)\n\n2-tuple:     \u03bb a b t . t a b\n2-tuple-fst: \u03bb t . t (\u03bb a b . a)\n2-tuple-snd: \u03bb t . t (\u03bb a b . b)\n\n3-tuple:     \u03bb a b c t . t a b c\n3-tuple-fst: \u03bb t . t (\u03bb a b c . a)\n3-tuple-snd: \u03bb t . t (\u03bb a b c . b)\n3-tuple-trd: \u03bb t . t (\u03bb a b c . c)\n\n... and so on.\n</code></pre>\n\n<p>My question is: is it possible to implement a function that receives a church number <code>N</code> and returns the corresponding N-tuple for any N? Also, is it possible to extend this function so it also returns the corresponding accessors? <strong>The algorithm can't use any form of recursion, including fixed-point combinators.</strong></p>\n\n<p>~</p>\n\n<p><strong>Edit: as requested, elaborating on what I've tried.</strong></p>\n\n<p>I want that function not to depend on recursion / fixed point combinators, so, the obvious way to do it would be using church-numbers for repetition. Said that, I have tried randomly testing many expressions, in order to learn how they grow. For example:</p>\n\n<pre><code>church_4 (\u03bb a b c . a (b c))\n</code></pre>\n\n<p>Reduces to:</p>\n\n<pre><code>(\u03bb a b c d e f . a ((((e d) c) b) a)))))\n</code></pre>\n\n<p>I've compared the reduction of many similar combinations <code>church_4 (\u03bb a b c . (a (b c)))</code> to my desired results and noticed that I could implement the accessors as:</p>\n\n<pre><code>firstOf = (\u03bb max n . (firstOf (sub max n) (firstOf n)))\naccess = (\u03bb max idx t . (t (firstOf (sub max idx) (firstOf idx))))\n</code></pre>\n\n<p>Where <code>sub</code> is the subtraction operator and <code>access church_5 church_2</code> means accessing the 3rd (because 2 is the 3rd natural) element of a 6-tuple. </p>\n\n<p>Now, on the tuples. Notice that the problem is finding a term <code>my_term</code> such that, for example:</p>\n\n<pre><code>church_3 my_term\n</code></pre>\n\n<p>had the following normal form:</p>\n\n<pre><code>(\u03bb a b c d t . ((((t a) b) c) d))\n</code></pre>\n\n<p>As you can see, I've almost found it, since:</p>\n\n<pre><code>church_3 (\u03bb a b c . a (b c)) (\u03bb a . a)\n</code></pre>\n\n<p>Reduces to:</p>\n\n<pre><code>(\u03bb a b c d . (((a b) c) d))\n</code></pre>\n\n<p>Which is almost the result I need, except that<code>t</code> is missing. </p>\n\n<p>That is what I've tried so far.</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1427291578, "post_id": 29257180, "comment_id": 46717747, "body": "Do you get the same error if the file doesn&#39;t exist? If not, we need to see more code."}, {"owner": {"reputation": 216, "user_id": 2461210, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/26d2a8e1d82de52abdd3e93ac60d87c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias", "link": "https://stackoverflow.com/users/2461210/tobias"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427291869, "post_id": 29257180, "comment_id": 46717954, "body": "No if the file is non existent then i just get a &quot;openFile: does not exist (No such file or directory)&quot;"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1427292234, "post_id": 29257180, "comment_id": 46718236, "body": "It&#39;s encountering an error when parsing the file. We need to see the first expression (at least!) of the file (try to narrow it down as much as possible while still producing the error), and maybe the loading code."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1427294931, "post_id": 29258770, "comment_id": 46720197, "body": "Glad you found it. Next time, you should probably consider validating your test case with an established Scheme implementation first! Many people like Racket, particularly because it has a really nice IDE and debugger, but you can use Guile or whatever if you have it lying around."}], "tags": [], "owner": {"reputation": 216, "user_id": 2461210, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/26d2a8e1d82de52abdd3e93ac60d87c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias", "link": "https://stackoverflow.com/users/2461210/tobias"}, "is_accepted": false, "score": 1, "last_activity_date": 1427294416, "last_edit_date": 1495541883, "creation_date": 1427294416, "answer_id": 29258770, "question_id": 29257180, "link": "https://stackoverflow.com/questions/29257180/cant-get-parsec-to-parse/29258770#29258770", "title": "Can&#39;t get parsec to parse &quot;.&quot;", "body": "<p>Thanks to <a href=\"https://stackoverflow.com/users/1477667/dfeuer\">dfeuer</a> (In the comments above) I found the problem. It was a syntax error in the stdlib.shm file:</p>\n\n<pre><code>(define (list . lst) lst)\n</code></pre>\n"}], "owner": {"reputation": 216, "user_id": 2461210, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/26d2a8e1d82de52abdd3e93ac60d87c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias", "link": "https://stackoverflow.com/users/2461210/tobias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1427294416, "creation_date": 1427290400, "last_edit_date": 1427290774, "question_id": 29257180, "link": "https://stackoverflow.com/questions/29257180/cant-get-parsec-to-parse", "title": "Can&#39;t get parsec to parse &quot;.&quot;", "body": "<p>I was following along the Write yourself a scheme tut and was just about to complete it until i ran into an error where i can't load files.</p>\n\n<pre><code>=&gt; (load \"stdlib.shm\")\nParse error at \"lisp\" (line 33, column 15):\nunexpected \".\"\nexpecting space, letter, \"\\\"\", \"#\", \"'\", \"(\", \"#\\\\\" or digit\n</code></pre>\n\n<p>I have tried reworking the parsers but nothing seems to work.\nhere is the parser's code:</p>\n\n<pre><code>symbol :: Parser Char\nsymbol = oneOf \"!$%&amp;|*+-/:&lt;=&gt;?@^_~\"\n\nspaces :: Parser ()\nspaces = skipMany1 space\n\nescapedChars :: Parser Char\nescapedChars = char '\\\\' &gt;&gt;\n               oneOf \"\\\\\\\"nrt\" &gt;&gt;=\n               \\c -&gt; return $ case c of\n                                '\\\\' -&gt; c\n                                '\"'  -&gt; c\n                                'n'  -&gt; '\\n'\n                                'r'  -&gt; '\\r'\n                                't'  -&gt; '\\t'\n\nparseExpr :: Parser Lval\nparseExpr = parseAtom\n            &lt;|&gt; parseString\n            &lt;|&gt; parseBool\n            &lt;|&gt; parseQuoted\n            &lt;|&gt; parseListStructure\n            &lt;|&gt; try parseCharacter\n            &lt;|&gt; try parseFloat\n            &lt;|&gt; try parseNumber\n\n-- Parse String of syntax: \"&lt;chars | digits | symbols&gt;\"\nparseString :: Parser Lval\nparseString = do char '\"'\n                 s &lt;- many (escapedChars &lt;|&gt; (noneOf ['\\\\', '\"']))\n                 char '\"'\n                 (return . String) s\n\n-- Parse single character of syntax: '&lt;char&gt;'\nparseCharacter :: Parser Lval\nparseCharacter = string \"#\\\\\" &gt;&gt;\n                 many1 letter &gt;&gt;=\n                 \\s -&gt; return $ case (map toLower s) of\n                                 \"space\" -&gt; Character ' '\n                                 \"newline\" -&gt; Character '\\n'\n                                 [x] -&gt; Character x\n\n-- Parse Atom (Symbol) may contain any one of chars in symbols\nparseAtom :: Parser Lval\nparseAtom = do first &lt;- letter &lt;|&gt; symbol\n               rest &lt;- many $ letter &lt;|&gt; digit &lt;|&gt; symbol\n               (return . Atom) $ first:rest\n\n{- Parse any numerical form of these, where the prefix is sign of base.\n(36674...,\n #d36674...,\n #x8F42...,\n #o107502...,\n #b1000111101000010...) -}\nparseNumber :: Parser Lval\nparseNumber = parsePlainNumber &lt;|&gt; parseRadixNumber\n\nparsePlainNumber :: Parser Lval\nparsePlainNumber = many1 digit &gt;&gt;= (return . Number . read)\n\nparseRadixNumber :: Parser Lval\nparseRadixNumber = char '#' &gt;&gt;\n                   (parseDecimal\n                   &lt;|&gt; parseHex\n                   &lt;|&gt; parseOct\n                   &lt;|&gt; parseBin)\n\nparseDecimal :: Parser Lval\nparseDecimal = do  char 'd'\n                   x &lt;- many1 digit\n                   (return . Number . read) x\n\nparseHex :: Parser Lval\nparseHex = char 'x' &gt;&gt; many1 hexDigit &gt;&gt;=\n           \\x -&gt; (return . Number) $ hex2Int x\n\nparseOct :: Parser Lval\nparseOct = char 'o' &gt;&gt; many1 octDigit &gt;&gt;=\n           \\x -&gt; (return . Number) $ oct2Int x\n\nparseBin :: Parser Lval\nparseBin = char 'b' &gt;&gt; (many1 $ oneOf \"10\") &gt;&gt;=\n           \\x -&gt; (return . Number) $ bin2Int x\n\nhex2Int x = fst $ head $ readHex x\noct2Int x = fst $ head $ readOct x\nbin2Int s = sum $ map (\\(i,x) -&gt; i*(2^x)) $ zip [0..] $ map p (reverse s)\n  where p '0' = 0\n        p '1' = 1\n\n-- Parse floats of syntax: &lt;digits&gt;.&lt;digits&gt;\nparseFloat :: Parser Lval\nparseFloat = do x &lt;- many1 digit\n                char '.'\n                y &lt;- many1 digit\n                (return . Float . read) $ x ++ \".\" ++ y\n\n-- Parse booleans syntax: (#t, #f)\nparseBool :: Parser Lval\nparseBool = char '#' &gt;&gt; oneOf \"tf\" &gt;&gt;=\n             \\c -&gt; return (case c of\n                            't' -&gt; Bool True\n                            'f' -&gt; Bool False)\n\n-- Parsing anytype of list structure here\nparseListStructure = do char '('\n                        x &lt;- parseList &lt;|&gt; parseDottedList\n                        char ')'\n                        return x\n\nparseList :: Parser Lval\nparseList = liftM List $ sepBy parseExpr spaces\n\nparseDottedList :: Parser Lval\nparseDottedList = do x &lt;- endBy parseExpr spaces\n                     xs &lt;- char '.' &gt;&gt; spaces &gt;&gt; parseExpr\n                     return $ DottedList x xs\n\n-- Parsing quoted expressions\nparseQuoted :: Parser Lval\nparseQuoted = char '\\'' &gt;&gt; parseExpr &gt;&gt;=\n              \\x -&gt; return $ List [Atom \"quote\", x]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1427282794, "post_id": 29254194, "comment_id": 46711690, "body": "Does using <code>Data.Map.Strict</code> make any difference?"}, {"owner": {"reputation": 245, "user_id": 4711693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a271df1abe2c89ea8d72fb90e23b34?s=128&d=identicon&r=PG", "display_name": "Alexander Razorenov", "link": "https://stackoverflow.com/users/4711693/alexander-razorenov"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1427283975, "post_id": 29254194, "comment_id": 46712434, "body": "I&#39;ve tried <code>Data.Map.Strict</code> right now. Haskell version still use 544 MB."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1427290563, "post_id": 29254194, "comment_id": 46716984, "body": "This question is more appropriate on <a href=\"http://codereview.stackexchange.com/\">CR SE</a>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1427296705, "post_id": 29254194, "comment_id": 46721514, "body": "Quoting: <a href=\"http://hackage.haskell.org/package/text-1.2.0.4/docs/Data-Text.html\" rel=\"nofollow noreferrer\">internally, a Text value is represented as packed UTF-16 data</a>. If the input file is mostly ASCII, then this doubles the memory footprint wrt UTF-8."}, {"owner": {"reputation": 3637, "user_id": 797637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1577f43a7c6eb01836e1758a2ba4df5?s=128&d=identicon&r=PG&f=1", "display_name": "firefrorefiddle", "link": "https://stackoverflow.com/users/797637/firefrorefiddle"}, "edited": false, "score": 1, "creation_date": 1427314002, "post_id": 29254194, "comment_id": 46732698, "body": "Is the memory footprint important at all? That is, will the program have to run in an environment where memory is scarce, or will it have to process much bigger data? Otherwise, you should just ignore it and work on the runtime only. Because the difference between UTF-16 and UTF-8 alone can account for it but then it shouldn&#39;t hurt at all."}], "answers": [{"comments": [{"owner": {"reputation": 245, "user_id": 4711693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a271df1abe2c89ea8d72fb90e23b34?s=128&d=identicon&r=PG", "display_name": "Alexander Razorenov", "link": "https://stackoverflow.com/users/4711693/alexander-razorenov"}, "edited": false, "score": 1, "creation_date": 1427291586, "post_id": 29254764, "comment_id": 46717751, "body": "I&#39;ve tried non-lazy version of Data.Text and Data.Text.IO - memory usage is near 650MB I&#39;ve also tried hashtables - memory usage growth up to more than 800 MB You can download my file here: <a href=\"https://cloud.mail.ru/public/5eb11b6cb6d7/baseforms.txt\" rel=\"nofollow noreferrer\">link</a>"}, {"owner": {"reputation": 245, "user_id": 4711693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a271df1abe2c89ea8d72fb90e23b34?s=128&d=identicon&r=PG", "display_name": "Alexander Razorenov", "link": "https://stackoverflow.com/users/4711693/alexander-razorenov"}, "edited": false, "score": 1, "creation_date": 1427292247, "post_id": 29254764, "comment_id": 46718246, "body": "Optimizations (-O2) doesn&#39;t help."}], "tags": [], "owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "is_accepted": false, "score": 21, "last_activity_date": 1427283976, "creation_date": 1427283976, "answer_id": 29254764, "question_id": 29254194, "link": "https://stackoverflow.com/questions/29254194/haskell-requires-more-memory-than-python-when-i-read-map-from-file-why/29254764#29254764", "title": "Haskell requires more memory than Python when I read map from file. Why?", "body": "<p>There is a lot happening in the Haskell version that's not happening in the Python version.</p>\n\n<ul>\n<li><p><code>readFile</code> uses lazy IO, which is a bit weird in general.  I would generally avoid lazy IO.</p></li>\n<li><p>The file, as a bytestring, is broken into lines which are then decoded as UTF-8.  This seems a little unnecessary, given the existence of <code>Text</code> IO functions.</p></li>\n<li><p>The Haskell version is using a tree (<code>Data.Map</code>) whereas the Python version is using a hash table.</p></li>\n<li><p>The strings are all lazy, which is probably not necessary if they're relatively short.  Lazy strings have a couple words of overhead per string, which can add up.  You could fuse the lazy strings, or you could read the file all at once, or you could use something like conduit.</p></li>\n<li><p>GHC uses a copying collector, whereas the default Python implementation uses <code>malloc()</code> with reference counting and the occasional GC.  This fact alone can account for large differences in memory usage, depending on your program.</p></li>\n<li><p>Who knows how many thunks are getting created in the Haskell version.</p></li>\n<li><p>It's unknown whether you've enabled optimizations.</p></li>\n<li><p>It's unknown <em>how much</em> slower the Haskell version is.</p></li>\n<li><p>We don't have your data file so we can't really test it ourselves.</p></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 245, "user_id": 4711693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a271df1abe2c89ea8d72fb90e23b34?s=128&d=identicon&r=PG", "display_name": "Alexander Razorenov", "link": "https://stackoverflow.com/users/4711693/alexander-razorenov"}, "edited": false, "score": 0, "creation_date": 1427806927, "post_id": 29303319, "comment_id": 46920010, "body": "Result is <code>374 MB total memory in use (0 MB lost due to fragmentation)</code> with <code>-O2</code> optimization - it&#39;s great!"}], "tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 3, "last_activity_date": 1427509034, "last_edit_date": 1427509034, "creation_date": 1427467132, "answer_id": 29303319, "question_id": 29254194, "link": "https://stackoverflow.com/questions/29254194/haskell-requires-more-memory-than-python-when-i-read-map-from-file-why/29303319#29303319", "title": "Haskell requires more memory than Python when I read map from file. Why?", "body": "<p>It's a bit late, but I studied this a little and think Dietrich Epp's account is right, but can be simplified a little. Notice that there doesn't seem to be any real python <em>programming</em> going on in the python file: it is orchestrating a very simple sequence of calls to C string operations and then to a C hash table implementation. (This is often a problem with really simple python v. Haskell benchmarks.) The Haskell, by contrast, is building an immense persistent <code>Map</code>, which is a fancy tree. So the main points of opposition here are C vs Haskell, and hashtable-with-destructive-update vs persistent map. Since there is little overlap in the input file, the tree you are constructing includes all the information in the input string, some of it repeated, and then rearranged with a pile of Haskell constructors.  This is I think the source of the alarm you are experiencing, but it can be explained.</p>\n\n<p>Compare these two files, one using ByteString:</p>\n\n<pre><code>import qualified Data.Map as M\nimport qualified Data.ByteString.Char8 as B\nmain = do m &lt;- fmap proc (B.readFile \"baseforms.txt\")\n          print (M.lookup (B.pack \"sometext\") m)\n          print (M.size m)\nproc = M.fromList  . concatMap (\\(a:bs) -&gt; map (flip (,) a) bs) \n       . map B.words . B.lines\n</code></pre>\n\n<p>and the other a Text-ified equivalent: </p>\n\n<pre><code>import qualified Data.Map as M\nimport qualified Data.ByteString.Char8 as B\nimport Data.Text.Encoding(decodeUtf8)\nimport qualified Data.Text as T\n\nmain = do\n    m &lt;- fmap proc (B.readFile \"baseforms.txt\")\n    print (M.lookup (T.pack \"sometext\") m)\n    print (M.size m)\n\nproc = M.fromList  . concatMap (\\(a:bs) -&gt;  map (flip (,) a) bs)\n       . map T.words . T.lines  . decodeUtf8\n</code></pre>\n\n<p>On my machine, the python/C takes just under 6 seconds, the bytestring file takes 8 seconds, and the text file just over 10.  </p>\n\n<p>The bytestring implementation seems to use a bit more memory than the python, the text implementation distinctly more. The text implementation takes more time because, of course, it adds a conversion to text and then uses text operations to break the string and text comparisons to build the map.</p>\n\n<p>Here is a go at analyzing the memory phenomena in the text case. First we have the bytestring in memory (130m). Once the text is constructed (~250m, to judge unscientifically from what's going on in <code>top</code>), the bytestring is garbage collected while we construct the tree. In the end the text tree (~380m it looks like) uses more memory than the bytestring tree (~260m) because the text fragments in the tree are bigger. The program as a whole uses more because the text held in memory during the tree construction is itself bigger. To put it crudely: each bit of white-space is being turned into a tree constructor and two text constructors together with the text version of whatever the first 'word' of the line was and whatever the text representation next word is. The weight of the constructors seems in either case to be about 130m, so at the last moment of the construction of the tree we are using something like 130m + 130m + 130m = 390m in the bytestring case, and 250m + 130m + 250m = 630m in the text case. </p>\n"}], "owner": {"reputation": 245, "user_id": 4711693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a271df1abe2c89ea8d72fb90e23b34?s=128&d=identicon&r=PG", "display_name": "Alexander Razorenov", "link": "https://stackoverflow.com/users/4711693/alexander-razorenov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 339, "favorite_count": 1, "accepted_answer_id": 29303319, "answer_count": 2, "score": 8, "last_activity_date": 1427509034, "creation_date": 1427282330, "last_edit_date": 1427282874, "question_id": 29254194, "link": "https://stackoverflow.com/questions/29254194/haskell-requires-more-memory-than-python-when-i-read-map-from-file-why", "title": "Haskell requires more memory than Python when I read map from file. Why?", "body": "<p>I have this simple code in Python:</p>\n\n<pre><code>input = open(\"baseforms.txt\",\"r\",encoding='utf8')\nS = {}\nfor i in input:\n    words = i.split()\n    S.update( {j:words[0] for j in words} )\nprint(S.get(\"sometext\",\"not found\"))\nprint(len(S))\n</code></pre>\n\n<p>It requires 300MB for work. \"baseforms.txt\" size is 123M. \nI've wrote the same code in Haskell:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport qualified Data.Map as M\nimport qualified Data.ByteString.Lazy.Char8 as B\nimport Data.Text.Lazy.Encoding(decodeUtf8)\nimport qualified Data.Text.Lazy as T\nimport qualified Data.Text.Lazy.IO as I\nimport Control.Monad(liftM)\n\nmain = do\n    text &lt;- B.readFile \"baseforms.txt\"\n    let m = (M.fromList . (concatMap (parseLine.decodeUtf8))) (B.lines text)\n    print (M.lookup \"sometext\" m)\n    print (M.size m)\n    where\n        parseLine line = let base:forms = T.words line in [(f,base)| f&lt;-forms]\n</code></pre>\n\n<p>It requires 544 MB and it's slower than Python version. Why? Is it possible to optimise Haskell version?</p>\n"}, {"tags": ["haskell", "ghc", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 5480, "user_id": 532901, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5581aede1e72c9bbadf038129896b809?s=128&d=identicon&r=PG", "display_name": "Tiddo", "link": "https://stackoverflow.com/users/532901/tiddo"}, "edited": false, "score": 1, "creation_date": 1427282460, "post_id": 29254028, "comment_id": 46711493, "body": "Wouldn&#39;t it be sufficient in the above example to properly specify the MINIMAL pragma to fix a warning/error? I.e. in the above example adding <code>{-# MINIMAL _simpleFn | complexFn #-}</code> would make the compiler happy as well, and thus still not give a reason for missing methods to give a warning instead of an error."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 5480, "user_id": 532901, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5581aede1e72c9bbadf038129896b809?s=128&d=identicon&r=PG", "display_name": "Tiddo", "link": "https://stackoverflow.com/users/532901/tiddo"}, "edited": false, "score": 1, "creation_date": 1427285566, "post_id": 29254028, "comment_id": 46713414, "body": "@Tiddo: The real reason is probably a historic one. That being said, one could patch <a href=\"https://github.com/ghc/ghc/blob/33cfa5ff9db4e7886b3e7c2eed5ac1c75436bc4c/compiler/typecheck/TcInstDcls.hs#L1614-L1622\" rel=\"nofollow noreferrer\"><code>warnMissingMethodOrAT</code></a> to create your desired behaviour. You could file an issue/feature request."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 9, "last_activity_date": 1427281834, "creation_date": 1427281834, "answer_id": 29254028, "question_id": 29253477, "link": "https://stackoverflow.com/questions/29253477/why-does-ghc-only-warn-on-partial-implemented-classes-and-not-error/29254028#29254028", "title": "Why does GHC only warn on partial implemented classes, and not error?", "body": "<p>The <a href=\"https://downloads.haskell.org/~ghc/7.8.3/docs/html/users_guide/options-sanity.html\">GHC documentation</a> provides an example where a warning is sufficient:</p>\n\n<blockquote>\n  <p><code>-fwarn-missing-methods</code>:</p>\n  \n  <p>This option is on by default, and warns you whenever an instance declaration is missing one or more methods, and the corresponding class declaration has no default declaration for them.</p>\n  \n  <p>The warning is suppressed if the method name begins with an underscore. \n  Here's an example where this is useful:</p>\n\n<pre><code>class C a where\n  _simpleFn :: a -&gt; String\n  complexFn :: a -&gt; a -&gt; String\n  complexFn x y = ... _simpleFn ...\n</code></pre>\n  \n  <p>The idea is that: (a) users of the class will only call <code>complexFn</code>; never <code>_simpleFn</code>; and (b) instance declarations can define either <code>complexFn</code> or <code>_simpleFn</code>.</p>\n  \n  <p>The <code>MINIMAL</code> pragma can be used to change which combination of methods will be required for instances of a particular class. See <a href=\"https://downloads.haskell.org/~ghc/7.8.3/docs/html/users_guide/pragmas.html#minimal-pragma\">Section 7.20.5, \u201cMINIMAL pragma\u201d.</a></p>\n</blockquote>\n\n<p>That's the reason missing methods don't result in an error, but a warning. If you want to make warnings fatal, use <code>-Werror</code>. Since there is no <code>-ferr-missing-methods</code>, <code>-Werror</code> is the only way to make <code>-fwarn-missing-methods</code> a compiler error.</p>\n"}], "owner": {"reputation": 5480, "user_id": 532901, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5581aede1e72c9bbadf038129896b809?s=128&d=identicon&r=PG", "display_name": "Tiddo", "link": "https://stackoverflow.com/users/532901/tiddo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 0, "accepted_answer_id": 29254028, "answer_count": 1, "score": 11, "last_activity_date": 1430206019, "creation_date": 1427280351, "last_edit_date": 1430206019, "question_id": 29253477, "link": "https://stackoverflow.com/questions/29253477/why-does-ghc-only-warn-on-partial-implemented-classes-and-not-error", "title": "Why does GHC only warn on partial implemented classes, and not error?", "body": "<p>I think the title is already self explanatory, but here's an example anyway to show my point:</p>\n\n<pre><code>class Foo a where\n    someFunction :: a -&gt; a -&gt; Bool\n\ninstance Foo Bool\n</code></pre>\n\n<p>When I compile this the compiler gives a warning:</p>\n\n<pre><code>Warning:\n    No explicit method or default declaration for `someFunction'\n    in the instance declaration for `Foo Bool'\n</code></pre>\n\n<p>Calling the function will now result in a runtime error. Why is this a warning, and not a compile-time error? And is there any way to make this a compile-time error instead?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 19680, "user_id": 562222, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/jgGXb.jpg?s=128&g=1", "display_name": "qed", "link": "https://stackoverflow.com/users/562222/qed"}, "edited": false, "score": 2, "creation_date": 1427274351, "post_id": 29251065, "comment_id": 46706592, "body": "glorious lazy evaluation."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 8, "last_activity_date": 1427273618, "last_edit_date": 1427273618, "creation_date": 1427273367, "answer_id": 29251065, "question_id": 29250967, "link": "https://stackoverflow.com/questions/29250967/how-does-loeb-terminate-in-this-haskell-example/29251065#29251065", "title": "How does loeb terminate in this haskell example?", "body": "<p>try it:</p>\n\n<pre><code>loeb [length, (!! 0)]\n= xs where xs = fmap ($ xs) [length, (!! 0)]\n= xs where xs = [length xs, xs !! 0]\n</code></pre>\n\n<p>so of course <code>length xs</code> is just 2, and so the first element of <code>xs</code> (<code>length xs</code>) is 2 as well.</p>\n\n<p><em>remember</em>: <code>length xs</code> does not need to evaluate the items of the list:</p>\n\n<pre><code>length [undefined, undefined] = 2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1427274791, "last_edit_date": 1427274791, "creation_date": 1427273828, "answer_id": 29251237, "question_id": 29250967, "link": "https://stackoverflow.com/questions/29250967/how-does-loeb-terminate-in-this-haskell-example/29251237#29251237", "title": "How does loeb terminate in this haskell example?", "body": "<p>The reason is that <code>length</code> does not evaluate the elements of the list. It simply counts the elements. <code>length</code> is (semantically equivalent) defined as:</p>\n\n<pre><code>length (_:xs) = 1 + length xs\nlength _ = 0\n</code></pre>\n\n<p>Even if one of the elements thus comes down on calculating an expression that results in an infinite loop, that doesn't matter. Al long as the list itself is not infinite of course.</p>\n\n<p>Now of you call <code>loeb [length, (!! 0)]</code>, it will be evaluated as:</p>\n\n<pre><code>loeb [length, (!! 0)]\n    xs = fmap ($ xs) [length,(!! 0)]\n    xs = [length xs,xs !! 0]\n</code></pre>\n\n<p>Thus the <code>length xs</code> performs <strong>lazy evaluation</strong>: it is not interested in the value of the elements, so they remain <em>unsolved</em> when counting.</p>\n"}], "owner": {"reputation": 19680, "user_id": 562222, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/jgGXb.jpg?s=128&g=1", "display_name": "qed", "link": "https://stackoverflow.com/users/562222/qed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 1, "accepted_answer_id": 29251065, "answer_count": 2, "score": 3, "last_activity_date": 1427297279, "creation_date": 1427273037, "last_edit_date": 1427297279, "question_id": 29250967, "link": "https://stackoverflow.com/questions/29250967/how-does-loeb-terminate-in-this-haskell-example", "title": "How does loeb terminate in this haskell example?", "body": "<p>From <a href=\"https://www.youtube.com/watch?v=F7F-BzOB670\" rel=\"nofollow\">this <em>Youtube</em> video</a>:</p>\n\n<pre><code>&gt; let loeb fs = xs where xs = fmap ($ xs) fs\n&gt; loeb [length, (!! 0)]\n[2,2]\n</code></pre>\n\n<p>The <code>xs</code> here is recursively defined, and how loeb terminates is beyond me. </p>\n"}, {"tags": ["parsing", "haskell", "optimization", "thrift", "binary-data"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1427273186, "post_id": 29250014, "comment_id": 46705966, "body": "Isn&#39;t thrift a binary protocol? That&#39;s sounds like a job for cereal or binary, depending whether you&#39;re using strict or lazy bytestrings. <a href=\"http://np.reddit.com/r/haskell/comments/2z2f6f/benchmark_rustnom_vs_haskellattoparsec_vs_chammer/\" rel=\"nofollow noreferrer\">Here&#39;s a recent benchmark of parsing mp4, compared with C and Rust</a>, <a href=\"https://github.com/Codas/nom_benchmarks/tree/dev\" rel=\"nofollow noreferrer\">here are the results</a>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1427273339, "post_id": 29250014, "comment_id": 46706055, "body": "That being said, try to format your question so that the essence (<i>&quot;Is there a fundamental reason why [thrift] is performing so poorly and what is the more idiomatic and efficient way to do [thrift-compatible network messaging]?&quot;</i>) stands out."}, {"owner": {"user_type": "does_not_exist", "display_name": "user473305"}, "edited": false, "score": 1, "creation_date": 1427279585, "post_id": 29250014, "comment_id": 46709824, "body": "Also, you may be able to get more of a discussion going on one of <a href=\"http://thrift.apache.org/mailing\" rel=\"nofollow noreferrer\">the Thrift project&#39;s mailing lists</a>."}, {"owner": {"reputation": 3637, "user_id": 797637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1577f43a7c6eb01836e1758a2ba4df5?s=128&d=identicon&r=PG&f=1", "display_name": "firefrorefiddle", "link": "https://stackoverflow.com/users/797637/firefrorefiddle"}, "edited": false, "score": 0, "creation_date": 1427281275, "post_id": 29250014, "comment_id": 46710811, "body": "Did you try using <code>Transport.Framed</code>? Reading 1 byte at a time shouldn&#39;t be too much of a problem if the whole communication is buffered."}, {"owner": {"reputation": 12067, "user_id": 499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc0612ec9a2b6af96500cc6e4bfdc7c?s=128&d=identicon&r=PG", "display_name": "JensG", "link": "https://stackoverflow.com/users/499466/jensg"}, "edited": false, "score": 1, "creation_date": 1427299498, "post_id": 29250014, "comment_id": 46723542, "body": "Last not least, we accept patches :-)"}, {"owner": {"reputation": 1225, "user_id": 1553313, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c254d80f35c4c00cf529252f98f23fea?s=128&d=identicon&r=PG", "display_name": "m-renaud", "link": "https://stackoverflow.com/users/1553313/m-renaud"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1427304142, "post_id": 29250014, "comment_id": 46726601, "body": "@Zeta - I&#39;m using the Binary protocol here to get the numbers (updated the post to include them). I made a change where I used the Binary.Get monad to parse it but couldn&#39;t get it to function properly. If I tried to read all the contens into a lazy bytestring it would just hang, and if I used the method they use in runParser (i.e. read a byte, run the parser on it to get a partial parse, read another byte, repeat) it wouldn&#39;t work because Binary just fails if there isn&#39;t enough input to perform the read."}], "owner": {"reputation": 1225, "user_id": 1553313, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c254d80f35c4c00cf529252f98f23fea?s=128&d=identicon&r=PG", "display_name": "m-renaud", "link": "https://stackoverflow.com/users/1553313/m-renaud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 251, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1427303783, "creation_date": 1427269509, "last_edit_date": 1495541179, "question_id": 29250014, "link": "https://stackoverflow.com/questions/29250014/haskell-thrift-optimizing-binary-data-reading-and-parsing-from-a-network-connec", "title": "Haskell Thrift: Optimizing Binary Data Reading and Parsing from a Network Connection", "body": "<p>This is a follow up question to <a href=\"https://stackoverflow.com/questions/19512952/haskell-thrift-library-300x-slower-than-c-in-performance-test\">Haskell Thrift library 300x slower than C++ in performance test</a>.</p>\n\n<p>So recently I decided I was going to play around with Thrift and noticed that it was almost prohibitively slow and I stumbled upon the post mentioned above so I decide to deep dive :) The original question had some suggestions for improving the poster's code but there wasn't much in terms of suggestions for improving the library code. I'm not incredibly experienced with Haskell but thought I would give it a try.</p>\n\n<p>I got the source code for Thrift (<a href=\"https://github.com/apache/thrift/tree/master/lib/hs\" rel=\"nofollow noreferrer\">https://github.com/apache/thrift/tree/master/lib/hs</a>) and rebuilt it with profiling enabled so I could get an idea of how the library was performing... in a single word, <em>poorly</em>, but that may be too generous. I decided to just focus on the ping test since that appeared to be the biggest offender. Here's the profiler output (with a few cost centered added to break down the expensive method).</p>\n\n<p>First, here's how I built everything to get the times (and with profiling added to get the numbers below):</p>\n\n<ul>\n<li>GHC Version: 7.8.4</li>\n<li>Thrift Version: 0.9.2 (cloned from GitHub repo)</li>\n</ul>\n\n<p>Building Thrift:</p>\n\n<pre><code>runghc Setup.lhs configure --user -O2 &amp;&amp; runghc Setup.lhs build &amp;&amp; runghc Setup.lhs install\n</code></pre>\n\n<p>Building Main:</p>\n\n<pre><code>ghc Main -O2\n</code></pre>\n\n<p>Times:</p>\n\n<ul>\n<li>Haskell: 3960ms</li>\n<li>C++:        5ms</li>\n</ul>\n\n<p>... ouch :(</p>\n\n<p>Here's the profiler output (with a few cost centered added to break down the expensive method).</p>\n\n<pre><code>COST CENTRE                            MODULE                         %time %alloc\n\nSCC_readMessageBegin                   ItemStore                       24.0   29.8\nSCC_writeMessageBegin                  ItemStore                       24.0   18.9\nMAIN                                   MAIN                            20.0    2.7\nSCC_THRIFT_parseBinaryValue_ver        Thrift.Protocol.Binary           8.0    4.3\nCAF                                    GHC.Event.Thread                 4.0    0.0\nSCC_THRIFT_parseBinaryValue_s          Thrift.Protocol.Binary           4.0    9.3\nSCC_THRIFT_parseBinaryValue_decodeUtf8 Thrift.Protocol.Binary           4.0    1.5\nproc_                                  ItemStore                        4.0    1.9\nread_Ping_args                         ItemStore                        4.0    3.3\nmain                                   Main                             4.0    1.3\nunstreamChunks/inner                   Data.Text.Internal.Lazy.Fusion   0.0    1.6\nSCC_THRIFT_parseBinaryValue_sz         Thrift.Protocol.Binary           0.0    5.0\nprocess_ping                           ItemStore                        0.0    2.1\nwrite_Ping_result                      ItemStore                        0.0   14.2\n\nCOST CENTRE                                   MODULE                           no.     entries  %time %alloc   %time %alloc\n\nMAIN                                          MAIN                             124           0   20.0    2.7   100.0  100.0\n main                                         Main                             250           0    0.0    0.0    72.0   95.0\n  process                                     ItemStore                        251           1    0.0    0.8    72.0   94.9\n   SCC_readMessageEnd                         ItemStore                        282         100    0.0    0.1     0.0    0.1\n   SCC_proc_                                  ItemStore                        261         100    0.0    0.1    32.0   44.1\n    proc_                                     ItemStore                        262         100    4.0    1.9    32.0   44.0\n     process_ping                             ItemStore                        268         100    0.0    2.1    28.0   40.8\n      SCC_tFlush                              ItemStore                        281         100    0.0    0.7     0.0    0.7\n      SCC_writeMessageEnd                     ItemStore                        280         100    0.0    0.1     0.0    0.1\n      SCC_write_Ping_result                   ItemStore                        277         100    0.0    0.0     0.0   14.2\n       write_Ping_result                      ItemStore                        278         100    0.0   14.2     0.0   14.2\n        from_Ping_result                      ItemStore                        279         100    0.0    0.0     0.0    0.0\n      SCC_writeMessageBegin                   ItemStore                        273         100   24.0   18.9    24.0   20.2\n       unstreamChunks/outer                   Data.Text.Internal.Lazy.Fusion   274         100    0.0    0.1     0.0    1.3\n        unstreamChunks/inner                  Data.Text.Internal.Lazy.Fusion   275         400    0.0    0.8     0.0    1.2\n         unstreamChunks/resize                Data.Text.Internal.Lazy.Fusion   276         100    0.0    0.4     0.0    0.4\n      SCC_Iface.ping                          ItemStore                        271         100    0.0    0.0     0.0    0.1\n       ping                                   Main                             272         100    0.0    0.1     0.0    0.1\n      SCC_read_Ping_args                      ItemStore                        269         100    0.0    0.1     4.0    3.3\n       read_Ping_args                         ItemStore                        270         100    4.0    3.3     4.0    3.3\n     unstreamChunks/outer                     Data.Text.Internal.Lazy.Fusion   263         100    0.0    0.1     0.0    1.3\n      unstreamChunks/inner                    Data.Text.Internal.Lazy.Fusion   264         400    0.0    0.8     0.0    1.2\n       unstreamChunks/resize                  Data.Text.Internal.Lazy.Fusion   265         100    0.0    0.4     0.0    0.4\n   SCC_readMessageBegin                       ItemStore                        252           1   24.0   29.8    40.0   49.9\n    SCC_THRIFT_parseBinaryValue_ver           Thrift.Protocol.Binary           254           0    8.0    4.3    16.0   20.1\n     SCC_THRIFT_parseBinaryValue_s            Thrift.Protocol.Binary           255         100    4.0    9.3     8.0   15.8\n      SCC_THRIFT_parseBinaryValue_decodeUtf8  Thrift.Protocol.Binary           260           0    4.0    1.5     4.0    1.5\n      SCC_THRIFT_parseBinaryValue_sz          Thrift.Protocol.Binary           256         100    0.0    5.0     0.0    5.0\n       SCC_THRIFT_parseBinaryValue_decodeUtf8 Thrift.Protocol.Binary           259         100    0.0    0.0     0.0    0.0\n       SCC_THRIFT_parseBinaryValue_ver        Thrift.Protocol.Binary           257         100    0.0    0.0     0.0    0.0\n</code></pre>\n\n<p>Yikes. You'll see the largest offenders (readMessageBegin (containing SCC_THRIFT_parseBinaryVal_XYZ) and writeMessageBegin) constitute 64% of the total time. <strong>All that these methods do is read 2 ints and a string!</strong>. This is clearly unacceptable.</p>\n\n<p>If you look at Thrift/Protocol.hs (<a href=\"https://github.com/apache/thrift/blob/master/lib/hs/src/Thrift/Protocol.hs\" rel=\"nofollow noreferrer\">https://github.com/apache/thrift/blob/master/lib/hs/src/Thrift/Protocol.hs</a>) and Thrift/Protocol/Binary.hs (<a href=\"https://github.com/apache/thrift/\" rel=\"nofollow noreferrer\">https://github.com/apache/thrift/</a>\nblob/master/lib/hs/src/Thrift/Protocol/Binary.hs) you'll notice they are using Attoparsec to parse the binary header which consists of version :: Int32, a string, and the message size :: Int32.</p>\n\n<p>First off it's strange (is it?) to use Attoparsec to read data that you already know the exact structure of. Second, in Protocol.hs, runParser reads from whatever transport protocol is being used <strong>1 byte at a time!!</strong> and uses the Partial feature of Attoparsec and continuously reapplies the parser. Additionally, it appears they are going from a lazy ByteString to a strict ByteString then back to a lazy ByteString several times per parse. None of these things can be efficient.</p>\n\n<p>I tried to do some modifications such as reading more than 1 byte at a time (but that just caused it to hang), to use tReadAll (from Transport.hs) to read the entire contents from the handle, but that hangs as well. I also tried a few other things (such as using Data.Binary directly) that ended up causing exceptions to be thrown about \"no more data to read\" and other such things.</p>\n\n<p>Is there a fundamental reason why the Trift code is performing so poorly and what is the more idiomatic and efficient way to do this? Appologies for the long question, I just wanted to make sure there was enough context and I'm really interested in making libraries like this for Haskell better.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1427248875, "post_id": 29246108, "comment_id": 46697826, "body": "I made <code>x</code> an argument to <code>foo</code> and <code>bar</code> as this is my use case. It also prevents an ugly but correct answer of using a separate partitioning function to merge equivalent constructors into a common case (like <code>C1 -&gt; C1, C2 -&gt; C1, C3 -&gt; C1</code>, and then only match on <code>C1</code>)."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1564768088, "post_id": 29246108, "comment_id": 101152553, "body": "Note that there is a currently dormant <a href=\"https://github.com/ghc-proposals/ghc-proposals/pull/43\" rel=\"nofollow noreferrer\">proposal</a> to introduce &quot;or patterns&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 310, "user_id": 9615454, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EmKjY.png?s=128&g=1", "display_name": "Gark Garcia", "link": "https://stackoverflow.com/users/9615454/gark-garcia"}, "edited": false, "score": 1, "creation_date": 1564768483, "post_id": 29246203, "comment_id": 101152699, "body": "In case anyone is interested in <a href=\"https://www.reddit.com/r/haskell/comments/cl6uy0/why_arent_disjunctive_patterns_supported/\" rel=\"nofollow noreferrer\">further discussions</a>..."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 18, "last_activity_date": 1618435060, "last_edit_date": 1618435060, "creation_date": 1427248877, "answer_id": 29246203, "question_id": 29246108, "link": "https://stackoverflow.com/questions/29246108/how-to-combine-case-statement-patterns/29246203#29246203", "title": "How to combine case statement patterns", "body": "<p>These are called <em>disjunctive patterns</em>, and Haskell does not have them. (OCaml and F# do.) There are a few typical workarounds, however. If your type is an enumeration, you can use equality, with for example <code>elem</code>, using a <code>case</code> expression, guards, or <code>MultiWayIf</code>:</p>\n<pre><code>exampleCase cond = case cond of\n  c\n    | c `elem` [C1, C2, C3] -&gt; foo\n    | c `elem` [C10, C11, C12] -&gt; bar\n    | otherwise -&gt; baz\n</code></pre>\n<pre><code>exampleGuards c\n  | c `elem` [C1, C2, C3] -&gt; foo\n  | c `elem` [C10, C11, C12] -&gt; bar\n  | otherwise -&gt; baz\n</code></pre>\n<pre><code>exampleIf c\n  = additionalProcessing $ if\n    | c `elem` [C1, C2, C3] -&gt; foo\n    | c `elem` [C10, C11, C12] -&gt; bar\n    | otherwise -&gt; baz\n</code></pre>\n<p>And of course, if <code>foo</code> or <code>bar</code> are long expressions, thanks to laziness you can simply factor them into local definitions, so you only have to repeat the name and any pattern variables you need as arguments:</p>\n<pre><code>exampleWhere cond = case cond of\n  C1 x -&gt; foo x\n  C2 y -&gt; foo y\n  \u2026\n  C10 -&gt; bar\n  C11 -&gt; bar\n  \u2026\n  where\n    foo x = something long (involving x, presumably)\n    bar = if you please then something else quite long\n</code></pre>\n<p>If you frequently group constructors together in this way, you can use the <code>PatternSynonyms</code> language option, which is especially useful in conjunction with <code>ViewPatterns</code>, to make your own patterns for matching such groups:</p>\n<pre><code>{-# Language\n    LambdaCase,\n    PatternSynonyms,\n    ViewPatterns #-}\n\n-- Write one function to match each property.\n\nfooish :: T -&gt; Maybe X\nfooish = \\ case\n  C1 x -&gt; Just x\n  C2 x -&gt; Just x\n  \u2026\n  C10 -&gt; Nothing\n  C11 -&gt; Nothing\n  \u2026\n  -- May use a wildcard \u2018_\u2019 here; I prefer not to,\n  -- to require updating cases when a type changes.\n\nbarrish :: T -&gt; Bool\nbarrish = \\ case\n  C1{} -&gt; False\n  C2{} -&gt; False\n  \u2026\n  C10 -&gt; True\n  C11 -&gt; True\n  \u2026\n\n-- Create synonyms for matching those properties.\n-- (These happen to be unidirectional only.)\n\npattern Fooish :: T -&gt; Foo\npattern Fooish x &lt;- (fooish -&gt; Just x)\n\npattern Barrish :: T -&gt; Bar\npattern Barrish &lt;- (barrish -&gt; True)\n\n-- If they cover all cases, tell the compiler so.\n-- This helps produce useful warnings with \u2018-Wall\u2019.\n\n{-# Complete Fooish, Barrish #-}\n\n-- Use them just like normal patterns.\n\nexampleSynonyms x = case x of\n  Fooish x -&gt; \u2026\n  \u2026\n  Barrish -&gt; \u2026\n  \u2026\n</code></pre>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3860, "favorite_count": 4, "closed_date": 1427253509, "accepted_answer_id": 29246203, "answer_count": 1, "score": 14, "last_activity_date": 1618435060, "creation_date": 1427248141, "last_edit_date": 1427248745, "question_id": 29246108, "link": "https://stackoverflow.com/questions/29246108/how-to-combine-case-statement-patterns", "closed_reason": "Duplicate", "title": "How to combine case statement patterns", "body": "<p>I'm trying to match on many different constructors in a case statement. For simplicity, assume in half the cases we do the same thing, and in the other half we do something else. Even if I factor out the logic to another function, I still have to write:</p>\n\n<pre><code>case x of\n  C1 -&gt; foo x\n  C2 -&gt; foo x\n  ...\n  C10 -&gt; bar x\n  C11 -&gt; bar x\n  ...\n</code></pre>\n\n<p>Is there some way to make case statements behave more like <code>switch</code> statements in C (i.e. with fallthrough), or so that I can match on one of many patterns at once, like:</p>\n\n<pre><code>case x of\n  C1, C2, C3 -&gt; foo x\n  C10, C11, C12 -&gt; bar x\n</code></pre>\n\n<p>Or perhaps another way to clean this up?</p>\n"}, {"tags": ["haskell", "ghc", "recycle"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1427243957, "post_id": 29245338, "comment_id": 46696641, "body": "Haskell lists are implemented as singly linked lists. Two such lists can have different &quot;beginnings&quot; and share the same &quot;end&quot;, but the converse is impossible. Accordingly, when computing <code>print (ls ++ [1])</code>, Haskell has no other choice but to create a copy of the whole list <code>ls</code> in memory, only to stick <code>[1]</code> at the end, and then print the result."}, {"owner": {"reputation": 1987, "user_id": 3521733, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/1c10050f609cc75d086d2ba7e27067b5?s=128&d=identicon&r=PG&f=1", "display_name": "kec", "link": "https://stackoverflow.com/users/3521733/kec"}, "edited": false, "score": 1, "creation_date": 1427244223, "post_id": 29245338, "comment_id": 46696707, "body": "Yes, but in theory at least, it seems that an optimizing compiler could see that the original list is not needed anymore, and simplify modify the original."}, {"owner": {"reputation": 1231, "user_id": 2420695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e64653c7d72d11a7ab80ad5944456f2f?s=128&d=identicon&r=PG", "display_name": "Robert M. Lefkowitz", "link": "https://stackoverflow.com/users/2420695/robert-m-lefkowitz"}, "edited": false, "score": 3, "creation_date": 1427256197, "post_id": 29245338, "comment_id": 46699525, "body": "In this case, you&#39;re measuring the memory used by the print.  Compare: <code>print ls</code>  with   <code>print ls &gt;&gt; print ls</code>  with <code>print (ls++[1])</code>  with what you have ( <code>print ls &gt;&gt; print (ls++[1])</code> ) .    That said, the list isn&#39;t being recycled -- but the memory used by <code>ls</code> and <code>ls++[1]</code> is a small part of your measurement."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "reply_to_user": {"reputation": 1231, "user_id": 2420695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e64653c7d72d11a7ab80ad5944456f2f?s=128&d=identicon&r=PG", "display_name": "Robert M. Lefkowitz", "link": "https://stackoverflow.com/users/2420695/robert-m-lefkowitz"}, "edited": false, "score": 0, "creation_date": 1427289241, "post_id": 29245338, "comment_id": 46716006, "body": "@RobertM.Lefkowitz are you sure? I actually already tried this and if my memory serves me, even if I lifted <code>let ls&#39; = ls ++ [1]</code> and called print on that twice, the memory only increased by maybe 5mb (so the size was truly double because of the append operation). I&#39;ll investigate further"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "reply_to_user": {"reputation": 1231, "user_id": 2420695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e64653c7d72d11a7ab80ad5944456f2f?s=128&d=identicon&r=PG", "display_name": "Robert M. Lefkowitz", "link": "https://stackoverflow.com/users/2420695/robert-m-lefkowitz"}, "edited": false, "score": 0, "creation_date": 1427298851, "post_id": 29245338, "comment_id": 46723076, "body": "@RobertM.Lefkowitz see my edits"}, {"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "reply_to_user": {"reputation": 1987, "user_id": 3521733, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/1c10050f609cc75d086d2ba7e27067b5?s=128&d=identicon&r=PG&f=1", "display_name": "kec", "link": "https://stackoverflow.com/users/3521733/kec"}, "edited": false, "score": 0, "creation_date": 1427301825, "post_id": 29245338, "comment_id": 46725120, "body": "@kec: Actually it isn&#39;t that simple because Haskell allows references to be shared. Since <code>print</code> uses <code>IO</code> sharing can only be allowed if GHC knows exactly what <code>print</code> does. Otherwise it could get stuffed into a variable somewhere and accessed later."}, {"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1427301938, "post_id": 29245338, "comment_id": 46725197, "body": "Are you compiling with optimizations turned on? <code>print</code> calls <code>show</code> so would need to build the array of characters in memory unless optimizations were available. I don&#39;t know if GHC can stream <code>putStrLn</code> or now (which would allow it to avoiding building). Also <code>ls</code> likely has to be saved in full form since it is used twice. Also note that there exist several packages in Hackage that would not allocate the list twice by using a different data structure than a list for storage."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "reply_to_user": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1427303132, "post_id": 29245338, "comment_id": 46725985, "body": "@Guvante yes, I&#39;m compiling with optimizations. But wouldn&#39;t GHC know exactly what print does? Couldn&#39;t it tell that it wasn&#39;t shared? Also, yes it can avoid the building, see <a href=\"http://stackoverflow.com/questions/29153480/how-does-the-ghc-garbage-collector-runtime-know-that-it-can-create-an-array-i\">my other question</a>. I&#39;m aware of the hackage packages: my question is more along the lines of if there&#39;s been a general way to tackle this in the compiler, as apposed to offering simply other libraries."}, {"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1427307846, "post_id": 29245338, "comment_id": 46729076, "body": "@pdexter: Is there a reason you are focusing on allocations? The example is fairly performant from what I can tell and doesn&#39;t use much RAM due to laziness being utilized (well the latter kind of does but that is due to call by need, inlining the list would avoid that)."}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "reply_to_user": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1427320312, "post_id": 29245338, "comment_id": 46736071, "body": "@Guvante sure, but wouldn&#39;t the optimization proposed make it even more performant? Allocations take time, e.g. copying a list take O(n). A side-question of mine in this is whether an optimization like this could provide benefits to larger, more complex programs. This is of course a silly example to try to over-optimize, so I&#39;m trying to figure out if it would apply to larger problems."}, {"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 1, "creation_date": 1427320582, "post_id": 29245338, "comment_id": 46736208, "body": "@pdexter: Unfortunately inlining the ++ is a non-starter due to the way Haskell does call-by-need. Allowing mutation of things is never allowed to provide lots of other benefits. Sometimes mutation is possible but nothing complex like that ++. This exact optimization is one the user will need to do unfortunately."}], "owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 140, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1427301523, "creation_date": 1427242614, "last_edit_date": 1427301523, "question_id": 29245338, "link": "https://stackoverflow.com/questions/29245338/has-there-been-any-work-on-supporting-general-recycling-in-haskell", "title": "Has there been any work on supporting general recycling in Haskell", "body": "<p>Has there been any work on supporting vector-style recycling for general data in Haskell? For example running</p>\n\n<pre><code>main = do\n  let ls = [1..1000000]\n  print ls\n</code></pre>\n\n<p>with <code>-p</code> states that it allocates a total of 425mb. Running</p>\n\n<pre><code>main = do\n  let ls = [1..1000000]\n  print ls\n  print (ls ++ [1])\n</code></pre>\n\n<p>with <code>-p</code> states that it allocates ~twice that, at 820mb.</p>\n\n<p>I understand why this is happening, but I'm wondering why GHC does not perform this optimization. I suppose one reason is that it doesn't show up much in real code so the benefits are slight, if anything (but maybe a general way to recycle any inductive structure could give some benefit?). Usually people are told to use other data structures anyways (e.g. Data.Seq).</p>\n\n<p>ps - I've seen links to the 'Recycle Your Arrays!' paper by Roman Leshchinskiy, however all links on the web are now dead (and I don't want to pay to read it via Springer)</p>\n\n<p>edit:</p>\n\n<p>When I use <a href=\"https://hackage.haskell.org/package/deepseq\" rel=\"nofollow\">deepseq</a> instead of print, I get similar but less extreme results. Without the append I get 80mb and with the append is 136mb. Not as extreme but it's still a bit of memory that, in theory, could be saved.</p>\n"}, {"tags": ["haskell", "graphics", "haskell-diagrams"], "comments": [{"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 1, "creation_date": 1427242876, "post_id": 29243840, "comment_id": 46696335, "body": "Works for me.  What output format are you going to? What haskell compiler, what version, what version of diagrams, what OS?"}], "answers": [{"tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": false, "score": 1, "last_activity_date": 1427282836, "last_edit_date": 1427282836, "creation_date": 1427279792, "answer_id": 29253277, "question_id": 29243840, "link": "https://stackoverflow.com/questions/29243840/why-doesnt-this-diagrams-code-produce-expected-result/29253277#29253277", "title": "Why doesn&#39;t this diagrams code produce expected result?", "body": "<p>It looks like mac's svg renderer doesn't support spread methods. Here's screen shot from and Chrome (OS X 10.9.5, Chrome version 37) with the same svg:</p>\n\n<p><img src=\"https://i.stack.imgur.com/JNauq.png\" alt=\"gradients\"></p>\n\n<p>Tools like imagemagick don't render them at all but this is a bug in the SVG backend that should be fixed in the next version.</p>\n\n<p>I've actually been working on manually implementing spread methods for another backend so we'll probably add an option in the svg backend for this too, for better compatibility.</p>\n\n<p>The Rasterific and Cairo backend gradients should (mostly) work. (Cairo's svg output still doesn't work with Safari but it does with imagemagick)</p>\n"}], "owner": {"reputation": 19680, "user_id": 562222, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/jgGXb.jpg?s=128&g=1", "display_name": "qed", "link": "https://stackoverflow.com/users/562222/qed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1427282836, "creation_date": 1427235043, "last_edit_date": 1427274558, "question_id": 29243840, "link": "https://stackoverflow.com/questions/29243840/why-doesnt-this-diagrams-code-produce-expected-result", "title": "Why doesn&#39;t this diagrams code produce expected result?", "body": "<p>Here is the code from user manual:</p>\n\n<pre><code>&gt; stops = mkStops [(gray, 0, 1), (white, 0.5, 1), (purple, 1, 1)]\n&gt; gradient = mkLinearGradient stops ((-0.5) ^&amp; 0) (0.5 ^&amp; 0) GradPad\n&gt; sq1 = square 1 # fillTexture  gradient\n&gt; sq2 = square 1 # fillTexture (gradient &amp; _LG . lGradSpreadMethod .~ GradRepeat\n&gt;                                        &amp; _LG . lGradStart .~ (-0.1) ^&amp; 0\n&gt;                                        &amp; _LG . lGradEnd .~ 0.1 ^&amp; 0)\n&gt; sq3 = square 1 # fillTexture (gradient &amp; _LG . lGradSpreadMethod .~ GradReflect\n&gt;                                        &amp; _LG . lGradStart .~ (-0.1) ^&amp; 0\n&gt;                                        &amp; _LG . lGradEnd .~ 0.1 ^&amp; 0)\n&gt;\n&gt; example = hcat' (with &amp; sep .~ 0.25) [sq1, sq2, sq3]\n</code></pre>\n\n<p>Here is what I got:</p>\n\n<p><img src=\"https://i.stack.imgur.com/wUQVU.png\" alt=\"enter image description here\"></p>\n\n<p>Here is what it looks like in the manual:</p>\n\n<p><img src=\"https://i.stack.imgur.com/rfv9e.png\" alt=\"enter image description here\"></p>\n\n<p>They don't quite match. </p>\n\n<pre><code>ghc 7.8.3, OS X 10.10\ndiagrams 1.2\noutput: SVG\n</code></pre>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 3196387, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/12bf0af12fcdc25f6ccecd1db7ce0254?s=128&d=identicon&r=PG&f=1", "display_name": "srysry", "link": "https://stackoverflow.com/users/3196387/srysry"}, "edited": false, "score": 0, "creation_date": 1427230522, "post_id": 29242604, "comment_id": 46691392, "body": "aw sweet, thanks. How would I use acc in the function then? I presume simply doing acc + money (let money= Amount 5 EUR) wouldn&#39;t work."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1427230681, "post_id": 29242604, "comment_id": 46691477, "body": "Not quite, but you can do <code>let (accountNo, amount) = acc</code>, or not write <code>acc</code> at all and write <code>putAmount mon (accountNo, amount)</code> or whatever."}], "tags": [], "owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "is_accepted": false, "score": 6, "last_activity_date": 1427230160, "creation_date": 1427230160, "answer_id": 29242604, "question_id": 29242563, "link": "https://stackoverflow.com/questions/29242563/confusion-about-type-and-data-in-haskell/29242604#29242604", "title": "Confusion about &quot;type&quot; and &quot;data&quot; in haskell", "body": "<p><code>type</code> creates a <em>type synonym</em>; an <code>Account</code> is exactly the same as an <code>(Integer, MoneyAmount)</code>, and you write it the same way:</p>\n\n<pre><code>let acc = (1, moni)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 3, "last_activity_date": 1427230495, "creation_date": 1427230495, "answer_id": 29242696, "question_id": 29242563, "link": "https://stackoverflow.com/questions/29242563/confusion-about-type-and-data-in-haskell/29242696#29242696", "title": "Confusion about &quot;type&quot; and &quot;data&quot; in haskell", "body": "<p>A <code>type</code> is just an alias.  It doesn't define a new type but instead a new name for an existing type.  So you could do</p>\n\n<pre><code>type Money = Float\n</code></pre>\n\n<p>And you can use <code>Money</code> where ever you can use a <code>Float</code> and vice-versa.  If you had</p>\n\n<pre><code>foo :: Float -&gt; Float\nfoo x = 2 * x\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>&gt; foo (1 :: Float)\n2\n&gt; foo (1 :: Money)\n2\n</code></pre>\n\n<p>Both work fine.  In your case, <code>Account</code> is just an alias for <code>(Integer, MoneyAmount)</code>, so you would construct one just as you would any other tuple.</p>\n\n<p>A <code>data</code> defines an entirely new type, and this requires new constructors.  For example:</p>\n\n<pre><code>data Bool = False | True\n</code></pre>\n\n<p>defines the <code>Bool</code> type with the constructors <code>False</code> and <code>True</code>.  A more complicated example would be</p>\n\n<pre><code>data Maybe a = Nothing | Just a\n</code></pre>\n\n<p>which defines the <code>Maybe a</code> polymorphic type with constructors <code>Nothing :: Maybe a</code> and <code>Just :: a -&gt; Maybe a</code>.  I've included the types of these constructors to highlight that they exist as normal values and functions.  The difference between a function and a constructor is that you can do anything you want in a function, but a constructor is only allowed to take existing values and make a value of another type without performing any transformations to it.  Constructors are just wrappers around values.</p>\n"}], "owner": {"reputation": 133, "user_id": 3196387, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/12bf0af12fcdc25f6ccecd1db7ce0254?s=128&d=identicon&r=PG&f=1", "display_name": "srysry", "link": "https://stackoverflow.com/users/3196387/srysry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1447862228, "creation_date": 1427230038, "last_edit_date": 1447862228, "question_id": 29242563, "link": "https://stackoverflow.com/questions/29242563/confusion-about-type-and-data-in-haskell", "title": "Confusion about &quot;type&quot; and &quot;data&quot; in haskell", "body": "<pre><code>data MoneyAmount = Amount Float Currency\n     deriving (Show, Eq)\ndata Currency = EUR | GBP | USD | CHF \n     deriving (Show, Eq)     \ntype Account = (Integer, MoneyAmount)\n\nputAmount :: MoneyAmount -&gt; Account -&gt; Account\nputAmount mon acc = undefined\n</code></pre>\n\n<p>I need to write a function that adds money to an account (display error if money added is wrong currency in account).</p>\n\n<p>I know how to create an Amount </p>\n\n<pre><code>let moni = Amount 6.6 EUR\n</code></pre>\n\n<p>but i have no idea what to write to create an Account? (i hope that sentence makes sense) I don't know how to manipulate the input to do the whole add to account thing.</p>\n\n<p>I've tried things like</p>\n\n<pre><code>let acc = Account 1 moni\n</code></pre>\n\n<p>My question is more how to manipulate the Account so I can write the function.</p>\n"}, {"tags": ["haskell", "abstract-syntax-tree", "happy"], "answers": [{"comments": [{"owner": {"reputation": 806, "user_id": 4089216, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/4f8916dafeac70014e97d93ee43ecef2?s=128&d=identicon&r=PG&f=1", "display_name": "Aserian", "link": "https://stackoverflow.com/users/4089216/aserian"}, "edited": false, "score": 0, "creation_date": 1427389951, "post_id": 29250706, "comment_id": 46767143, "body": "Thank you, but wouldn&#39;t this return an data type of type M_fun (String,[(String,Int,M_type)],M_type,([M_decl],M_stmt])) instead of M_fun (String,[(String,Int,M_type)],M_type,[M_decl],[M_stmt])?  Or will haskell figure out that they aren&#39;t paired by the data type it&#39;s trying to make?"}, {"owner": {"reputation": 1212, "user_id": 2455145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kazBZ.jpg?s=128&g=1", "display_name": "AlexJ136", "link": "https://stackoverflow.com/users/2455145/alexj136"}, "reply_to_user": {"reputation": 806, "user_id": 4089216, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/4f8916dafeac70014e97d93ee43ecef2?s=128&d=identicon&r=PG&f=1", "display_name": "Aserian", "link": "https://stackoverflow.com/users/4089216/aserian"}, "edited": false, "score": 0, "creation_date": 1427894921, "post_id": 29250706, "comment_id": 46961104, "body": "It will return something of type <code>( [ A ], [ B ] ) where </code>A` is the type of <code>declarations</code> i.e. <code>$1</code>, and <code>B</code> is the type of <code>fun_body</code> i.e. <code>$2</code>. I don&#39;t know if this is the type that you want, because you haven&#39;t posted the type declaration for the <code>fun_block</code> production. In any case, you must make sure that the type of the expression in the haskell code of the <code>fun_block</code> production matches the type given in the type definition of <code>fun_block</code> (if any), and matches the type required in all places that make use of the <code>fun_block</code> definition."}, {"owner": {"reputation": 1212, "user_id": 2455145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kazBZ.jpg?s=128&g=1", "display_name": "AlexJ136", "link": "https://stackoverflow.com/users/2455145/alexj136"}, "reply_to_user": {"reputation": 806, "user_id": 4089216, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/4f8916dafeac70014e97d93ee43ecef2?s=128&d=identicon&r=PG&f=1", "display_name": "Aserian", "link": "https://stackoverflow.com/users/4089216/aserian"}, "edited": false, "score": 0, "creation_date": 1427895195, "post_id": 29250706, "comment_id": 46961262, "body": "Since you define the type of <code>fun_declaration</code> as <code>M_fun (String,[(String,Int,M_type)],M_type,[M_decl],[M_stmt])</code>, you cannot construct an <code>M_fun</code> with the expression <code>M_fun ($2, [$3], $5, $7)</code>, as the tuple given to <code>M_fun</code> should be 5-ary, not 4-ary. However, you may be able to fix this by changing the definition of <code>M_fun</code> to <code>M_fun (String,[(String,Int,M_type)],M_type,([M_decl],[M_stmt]))</code>. Note the additional brackets around what was previously the last two arguments to <code>M_fun</code>, making <code>M_fun</code> 4-ary rather than 5-ary, (I think) making it match the type that <code>fun_block</code> is passing it."}], "tags": [], "owner": {"reputation": 1212, "user_id": 2455145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kazBZ.jpg?s=128&g=1", "display_name": "AlexJ136", "link": "https://stackoverflow.com/users/2455145/alexj136"}, "is_accepted": false, "score": 1, "last_activity_date": 1427895441, "last_edit_date": 1427895441, "creation_date": 1427272094, "answer_id": 29250706, "question_id": 29241808, "link": "https://stackoverflow.com/questions/29241808/how-do-i-properly-format-happy-when-dealing-with-robust-ast-declarations/29250706#29250706", "title": "How do I properly format happy when dealing with robust AST declarations?", "body": "<p>If you want the <code>fun_block</code> production to return an <code>([M_decl], [M_stmt])</code>, you need to construct one properly in the associated haskell code. You have:</p>\n\n<pre><code>{ [$1] [$2] }\n</code></pre>\n\n<p>and this is not a valid expression. I believe you should have:</p>\n\n<pre><code>{ ( [$1], [$2] ) }\n</code></pre>\n\n<p>You then need to change the type definition of <code>M_fun</code> to</p>\n\n<pre><code>M_fun (String,[(String,Int,M_type)],M_type,([M_decl],[M_stmt]))\n</code></pre>\n\n<p>so that the last argument to <code>M_fun</code> (i.e. <code>$7</code> has the same type as that returned by <code>fun_block</code>).</p>\n"}], "owner": {"reputation": 806, "user_id": 4089216, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/4f8916dafeac70014e97d93ee43ecef2?s=128&d=identicon&r=PG&f=1", "display_name": "Aserian", "link": "https://stackoverflow.com/users/4089216/aserian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1427895441, "creation_date": 1427227310, "question_id": 29241808, "link": "https://stackoverflow.com/questions/29241808/how-do-i-properly-format-happy-when-dealing-with-robust-ast-declarations", "title": "How do I properly format happy when dealing with robust AST declarations?", "body": "<p>I am trying to create a lexxer and parser for a language and I'm having difficulty understanding the exact syntax when it comes to some more \"robust\" abstract syntax tree definitions.</p>\n\n<p>The issue in question is :</p>\n\n<pre><code>fun_declaration : FUN ID param_list ':' type '{' fun_block '}' \n                 { M_fun ($2, [$3], $5, $7) }\nfun_block : declarations fun_body                   { [$1] [$2] }\n</code></pre>\n\n<p>The definition of M_fun is as follows:</p>\n\n<pre><code>M_fun (String,[(String,Int,M_type)],M_type,[M_decl],[M_stmt])\n</code></pre>\n\n<p>So as you can see, $2 relates to string, $3 will return a [(String,Int,M_Type)], $5 will return an M_Type, but $7 is where the issue lies.  It's to return a [M_decl], [M_stmt].  Is the above syntax correct?  The happy file compiles without complaint, but when I compile the .hs file after, it explodes with ~2000 lines of errors, and I think things like this are the cause.</p>\n"}, {"tags": ["haskell", "graphics", "haskell-diagrams"], "answers": [{"comments": [{"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 1, "creation_date": 1427231761, "post_id": 29242040, "comment_id": 46692037, "body": "You got your <code>strutX</code> and <code>strutY</code> the wrong way round. When it&#39;s the right way round it behaves just like <code>frame</code>."}, {"owner": {"reputation": 19680, "user_id": 562222, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/jgGXb.jpg?s=128&g=1", "display_name": "qed", "link": "https://stackoverflow.com/users/562222/qed"}, "reply_to_user": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 0, "creation_date": 1427234778, "post_id": 29242040, "comment_id": 46693467, "body": "aha, glad to hear that. :-)"}], "tags": [], "owner": {"reputation": 19680, "user_id": 562222, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/jgGXb.jpg?s=128&g=1", "display_name": "qed", "link": "https://stackoverflow.com/users/562222/qed"}, "is_accepted": false, "score": 1, "last_activity_date": 1427272868, "last_edit_date": 1427272868, "creation_date": 1427228171, "answer_id": 29242040, "question_id": 29241477, "link": "https://stackoverflow.com/questions/29241477/margin-of-a-haskell-diagrams-svg-file/29242040#29242040", "title": "Margin of a Haskell diagrams SVG file", "body": "<p>I partly solved the problem by making a new function <code>addMargin</code>:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n\nimport Diagrams.Prelude\nimport Diagrams.Backend.SVG.CmdLine\n\n\n\nfuns          = map (flip (^)) [2..6]\nvisualize f   = stroke' (with &amp; vertexNames .~ [[0 .. 6 :: Int]] )\n                    p\n                  # lw none\n                  # showLabels\n                  # fontSize (Local 1.6)\n             &lt;&gt; star (StarFun f) p\n                  # stroke # lw thick # lc red\n             where\n               p = (regPoly 7 2)\n\nexample       = center . hcat' (with &amp; sep .~ 5) $ map visualize funs\n\naddMargin m a = c where\n  c = s === b === s where\n    s = strutY m\n    b = s' ||| a ||| s' where\n      s' = strutX m\n\n\nmain = mainWith (addMargin 33 example :: Diagram B R2)\n</code></pre>\n\n<p><img src=\"https://i.stack.imgur.com/LeHJL.png\" alt=\"enter image description here\"></p>\n\n<p>Everything looks fine except that the 0 on the right side is still covered by something, somehow. </p>\n"}, {"tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 9, "last_activity_date": 1427234050, "last_edit_date": 1427234050, "creation_date": 1427231598, "answer_id": 29242996, "question_id": 29241477, "link": "https://stackoverflow.com/questions/29241477/margin-of-a-haskell-diagrams-svg-file/29242996#29242996", "title": "Margin of a Haskell diagrams SVG file", "body": "<p>The problem is text doesn't have an envelope so it's size isn't taken into account. You can solve your problem by using the <code>frame</code> function which adds a border to the envelope.</p>\n\n<pre><code>example = frame 2 . center . hcat' (with &amp; sep .~ 5) $ map visualize funs\n</code></pre>\n\n<p><img src=\"https://i.stack.imgur.com/icgcY.png\" alt=\"example\"></p>\n"}], "owner": {"reputation": 19680, "user_id": 562222, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/jgGXb.jpg?s=128&g=1", "display_name": "qed", "link": "https://stackoverflow.com/users/562222/qed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "accepted_answer_id": 29242996, "answer_count": 2, "score": 3, "last_activity_date": 1476901557, "creation_date": 1427226186, "last_edit_date": 1476901557, "question_id": 29241477, "link": "https://stackoverflow.com/questions/29241477/margin-of-a-haskell-diagrams-svg-file", "title": "Margin of a Haskell diagrams SVG file", "body": "<p>I am trying this diagrams example:</p>\n\n<pre><code>funs          = map (flip (^)) [2..6]\nvisualize f   = stroke' (with &amp; vertexNames .~ [[0 .. 6 :: Int]] )\n                    (regPoly 7 1)\n                  # lw none\n                  # showLabels\n                  # fontSize (Local 0.6)\n             &lt;&gt; star (StarFun f) (regPoly 7 1)\n                  # stroke # lw thick # lc red\nexample       = center . hcat' (with &amp; sep .~ 0.5) $ map visualize funs\n</code></pre>\n\n<p>And here is the result:</p>\n\n<p><img src=\"https://i.stack.imgur.com/UW7RL.png\" alt=\"enter image description here\"></p>\n\n<p>Everything appears as expected that some of the numbers (or more precisely, the center of these numbers) are place near the edges of the image, so in the end they look like having been cut off.</p>\n\n<p>Is there a way to solve this?</p>\n"}, {"tags": ["string", "list", "function", "haskell", "types"], "comments": [{"owner": {"reputation": 258, "user_id": 1447186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Rbaro.png?s=128&g=1", "display_name": "Thanasi Poulos", "link": "https://stackoverflow.com/users/1447186/thanasi-poulos"}, "edited": false, "score": 0, "creation_date": 1427209687, "post_id": 29235879, "comment_id": 46678363, "body": "@Zeta, the code, as it stands, compiles. My various attempts to smash <code>remIgnored</code> together with <code>ig</code> <code>ls&#39;&#39;</code> have caused me some hilarious problems."}], "answers": [{"comments": [{"owner": {"reputation": 258, "user_id": 1447186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Rbaro.png?s=128&g=1", "display_name": "Thanasi Poulos", "link": "https://stackoverflow.com/users/1447186/thanasi-poulos"}, "edited": false, "score": 0, "creation_date": 1427210492, "post_id": 29236264, "comment_id": 46678980, "body": "I don&#39;t really understand either of those. How does <code>remAllIgnored</code> actually <i>do</i> anything? (In that first case, with <code>foldr</code>)"}, {"owner": {"reputation": 258, "user_id": 1447186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Rbaro.png?s=128&g=1", "display_name": "Thanasi Poulos", "link": "https://stackoverflow.com/users/1447186/thanasi-poulos"}, "edited": false, "score": 0, "creation_date": 1427210757, "post_id": 29236264, "comment_id": 46679180, "body": "It worked, but would you mind explaining what actually like, <i>happened</i>? Everything in Haskell seems like black magic to me at this stage."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 258, "user_id": 1447186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Rbaro.png?s=128&g=1", "display_name": "Thanasi Poulos", "link": "https://stackoverflow.com/users/1447186/thanasi-poulos"}, "edited": false, "score": 1, "creation_date": 1427213588, "post_id": 29236264, "comment_id": 46681291, "body": "Well, to understand the fold you should implement the recursive version, which is after all equivalent. And you&#39;ll really have to do that <i>yourself</i> I&#39;m afraid, to understand it properly. At least try \u2013 where do you get stuck? Step <code>[]</code>, step <code>1.</code> or step <code>2.</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 258, "user_id": 1447186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Rbaro.png?s=128&g=1", "display_name": "Thanasi Poulos", "link": "https://stackoverflow.com/users/1447186/thanasi-poulos"}, "edited": false, "score": 1, "creation_date": 1427214186, "post_id": 29236264, "comment_id": 46681734, "body": "@capncoolio Perhaps the <code>foldr</code> version is more understandable in a pointful style, i.e. <code>remAllIgnored toIgnore words = foldr remIgnored words toIgnore</code>. This roughly expands to <code>(remIgnored toIgn1 (... (remIgnored toIgnN words)))</code> where all the ignored words are removed from the <code>words</code> list one by one."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 258, "user_id": 1447186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Rbaro.png?s=128&g=1", "display_name": "Thanasi Poulos", "link": "https://stackoverflow.com/users/1447186/thanasi-poulos"}, "edited": false, "score": 0, "creation_date": 1427228515, "post_id": 29236264, "comment_id": 46690291, "body": "@capncoolio Have you used <code>foldr</code> before? This diagram, I feel, gives a good visual explanation of how it works. <code>foldr</code> turns the list its given (on the left of the image) into the nested function call on the right: <a href=\"http://commons.wikimedia.org/wiki/File:Right-fold-transformation.png\" rel=\"nofollow noreferrer\">commons.wikimedia.org/wiki/File:Right-fold-transformation.pn&zwnj;&#8203;g</a>. It &quot;replaces&quot; the list&#39;s  <code>:</code>s with <code>f</code> calls and the empty list with <code>z</code>. The list on the left is the long way of writing <code>[1,2,3,4,5]</code>. It would help to write out a small example by hand."}, {"owner": {"reputation": 258, "user_id": 1447186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Rbaro.png?s=128&g=1", "display_name": "Thanasi Poulos", "link": "https://stackoverflow.com/users/1447186/thanasi-poulos"}, "edited": false, "score": 0, "creation_date": 1427238865, "post_id": 29236264, "comment_id": 46695044, "body": "@leftaroundabout, I&#39;m currently stuck trying to understand how I would go about implementing the recursive version. You&#39;ve got <code>remAllIgnored (ign0:igns) words = let ??</code> there. Isn&#39;t <code>words</code> a function? Also, isn&#39;t <code>let</code>  generally used in the context of the <code>IO</code> monad?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1427244100, "post_id": 29236264, "comment_id": 46696677, "body": "Your&#39;re right, <code>words</code> is already a standard function, I shouldn&#39;t have used that name. (Mind, it&#39;ll still work: the local definition of the argument <code>words</code> simply shadows the global value <code>Prelude.words</code>.) As for <code>let</code>, there are two different syntaxes, one in a monadic context (without <code>in</code>), one <a href=\"https://wiki.haskell.org/Let_vs._Where\" rel=\"nofollow noreferrer\">in general functional expressions</a>. You don&#39;t need <code>let ... in ...</code> to implement that function, it&#39;s just what I would have written."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1427210055, "creation_date": 1427210055, "answer_id": 29236264, "question_id": 29235879, "link": "https://stackoverflow.com/questions/29235879/applying-a-function-of-type-string-string-string-to-two-strings/29236264#29236264", "title": "Applying a function of type String -&gt; [String] -&gt; [String] to two [String]s", "body": "<p>In reality, you should use a fold to do that.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>remAllIgnored :: [String] -&gt; [String] -&gt; [String]\nremAllIgnored = flip $ foldr remIgnored\n</code></pre>\n\n<p>yup, it's really that simple.</p>\n\n<p>If you're not comfortable with folds yet, you can code this explicitly with recursion of the ignore-list:</p>\n\n<pre><code>remAllIgnored [] words = ... -- nothing to ignore means: ?\nremAllIgnored (ign0:igns) words\n    = let ??  -- somehow you need to 1. apply the `ign0`-ignore-patch\n      in ??   --                     2. process the rest of the `igns`\n</code></pre>\n\n<p>Try it, and if there are any particular problems come back with those.</p>\n"}], "owner": {"reputation": 258, "user_id": 1447186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Rbaro.png?s=128&g=1", "display_name": "Thanasi Poulos", "link": "https://stackoverflow.com/users/1447186/thanasi-poulos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 29236264, "answer_count": 1, "score": 0, "last_activity_date": 1427210055, "creation_date": 1427209043, "last_edit_date": 1427209412, "question_id": 29235879, "link": "https://stackoverflow.com/questions/29235879/applying-a-function-of-type-string-string-string-to-two-strings", "title": "Applying a function of type String -&gt; [String] -&gt; [String] to two [String]s", "body": "<p>I struggled to come up with a good title for this.</p>\n\n<p>Here's the gist:</p>\n\n<p>I have a function (<code>remIgnored</code>) that intends to remove strings from a list of strings.</p>\n\n<pre><code>module Main(main) where\n\nimport System.Environment\nimport Data.List\nimport Data.Char\n\ngetLines :: FilePath -&gt; IO [String]\ngetLines path = do \n    ls &lt;- readFile path\n    return (lines ls)\n\ngetWords :: [String] -&gt; [String]\ngetWords ws = words (unlines ws)\n\nremIgnored :: String -&gt; [String] -&gt; [String]\nremIgnored _ []                 = []\nremIgnored x (y:ys) | x == y    = remIgnored x ys\n                    | otherwise = y : remIgnored x ys\n\nmain :: IO ()\nmain = do\n    args &lt;- getArgs\n    let path = args !! 0\n    let ignore = args !! 1\n    ig &lt;- getLines ignore\n    ls &lt;- getLines path\n    let ig'  = map (map toLower) (getWords ig)\n    let ls'  = map (map toLower) (getWords ls)\n    let ls'' = sort ls'\n    putStrLn \"Original Lines:\\n\"\n    mapM_ putStrLn ls\n    putStrLn \"\\nLower Cased Words:\\n\"\n    mapM_ putStrLn ls'\n    putStrLn \"\\nLower Cased Words + Sorted:\\n\"\n    mapM_ putStrLn ls''\n    putStrLn \"\\nLower Cased Words + Sorted + Sanitized:\\n\"\n    --Something nice goes here\n</code></pre>\n\n<p>(Please ignore the constant duplicating with minor changes to the lists, I am just hacking things about to see how they work).</p>\n\n<p>Basically, my question is this: How would I go about applying the function <code>remIgnored</code> to the list <code>ls''</code> with every element in <code>ig'</code>? I've been staring at type errors all night and I am making little progress (even what I have so far has caused me a great deal of annoyance).</p>\n\n<p>For reference, my input files:</p>\n\n<p><code>test.txt</code>:</p>\n\n<pre><code>The quick brown fox jumps over the lazy dog\nPeter picked a pail of pickled peppers\nShe sells sea shells by the sea shore\n</code></pre>\n\n<p><code>ignore.txt</code>:</p>\n\n<pre><code>a\nthe\nof\nby\n</code></pre>\n\n<p>Sample Output:</p>\n\n<pre><code>Original Lines:\nThe quick brown fox jumps over the lazy\nPeter picked a pail of pickled peppers\nShe sells sea shells by the sea shore\n\nLower Cased Words:\nthe\nquick\nbrown\nfox\njumps\nover\nthe\nlazy\ndog\npeter\npicked\na\npail\nof\npickled\npeppers\nshe\nsells\nsea\nshells\nby\nthe\nsea\nshore\n\nLower Cased Words + Sorted:\na\nbrown\nby\ndog\nfox\njumps\nlazy\nof\nover\npail\npeppers\npeter\npicked\npickled\nquick\nsea\nsea\nsells\nshe\nshells\nshore\nthe\nthe\nthe\n\nLower Cased Words + Sorted + Sanitized:\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1455905359, "post_id": 29234589, "comment_id": 58714748, "body": "Did you ever solve this? I&#39;m having the same problem."}, {"owner": {"reputation": 970, "user_id": 6464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0403a2339c5e4ae8cc7e22ddf3cf300d?s=128&d=identicon&r=PG", "display_name": "Anton", "link": "https://stackoverflow.com/users/6464/anton"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1457342018, "post_id": 29234589, "comment_id": 59345861, "body": "I eventually switched to Stack (<a href=\"http://haskellstack.org\" rel=\"nofollow noreferrer\">haskellstack.org</a>) and this solved a lot of headaches."}], "owner": {"reputation": 970, "user_id": 6464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0403a2339c5e4ae8cc7e22ddf3cf300d?s=128&d=identicon&r=PG", "display_name": "Anton", "link": "https://stackoverflow.com/users/6464/anton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 223, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1427205520, "creation_date": 1427205520, "question_id": 29234589, "link": "https://stackoverflow.com/questions/29234589/cabal-shared-sandboxes-and-sandbox-wide-cabal-config", "title": "Cabal shared sandboxes and sandbox-wide cabal.config", "body": "<p>I'm using cabal sandboxes feature to create an isolated build environment for my Haskell project, which has a plenty of packages. To do that I have a build script that first creates a sandbox by doing</p>\n\n<pre><code>cabal sandbox init\n</code></pre>\n\n<p>in a build directory and then calling</p>\n\n<pre><code>cabal sandbox add-source &lt;path-to-project&gt;\n</code></pre>\n\n<p>in that directory for every package of mine. In addition, to simplify the development process I launch</p>\n\n<pre><code>cabal sandbox init --sandbox &lt;path-to-sandbox&gt;\n</code></pre>\n\n<p>in every package directory I have. This allows me to do <code>cabal install</code> right from needed package directory and have all dependencies built and package installed to my sandbox.</p>\n\n<p>Now I have a problem with a configuration file. I've created <code>cabal.config</code> next to the <code>cabal.sandbox.config</code> in a build directory, which has a couple of cabal flags (and extra-include-dirs, etc). It works (and settings seem to be applied) when I launch, for example, <code>cabal install HsOpenSSL</code> and my current directory is a build one (the one I've called <code>cabal sandbox init</code> and where <code>cabal.config</code> resides).</p>\n\n<p>Now if I try launching <code>cabal install</code> from an HsOpenSSL project directory, <code>cabal.config</code> in my sandbox is ignored (despite the fact that <code>cabal sandbox init --sandbox &lt;path-to-sandbox&gt;</code> has been properly invoked previously and cabal gives a notice about installing to a sandbox).</p>\n\n<p>And the question is if I could specify cabal options for all packages that are added to my sandbox in such a way that these options will apply even if I just launch <code>cabal configure/build/install</code> from a package directory?</p>\n\n<p>I'm using Windows and cabal-install-1.22.0.0.</p>\n"}, {"tags": ["haskell", "tree", "proof", "induction"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1427203576, "post_id": 29233433, "comment_id": 46673725, "body": "You mean like <code>Foldable</code> and <code>Traversable</code>?  Using <code>-XDeriveFunctor</code>, <code>DeriveFoldable</code>, <code>DeriveTraversable</code> and <code>import Data.Foldable</code> and <code>import Data.Traversable</code> you can <code>derive (Functor, Foldable, Traversable)</code> on <code>RoseTree</code> to get a generic <code>fold</code> and <code>traverse</code> for it."}, {"owner": {"reputation": 1827, "user_id": 450706, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f88b53eac24db144b567a6ea9b17b795?s=128&d=identicon&r=PG", "display_name": "Rich Ashworth", "link": "https://stackoverflow.com/users/450706/rich-ashworth"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1427203745, "post_id": 29233433, "comment_id": 46673837, "body": "Thanks. I was really asking in terms of reasoning about the structures (as described in <a href=\"http://en.wikipedia.org/wiki/Structural_induction\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Structural_induction</a>), rather than doing anything with the trees themselves."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1427204805, "post_id": 29233433, "comment_id": 46674566, "body": "@RichAshworth I find your question unclear. If you&#39;re not interested in declaring a <code>Foldable</code> or <code>Traversable</code> instance for your tree and all you want is to reason about the (abstract) data structure, why show a Haskell implementation of it?"}, {"owner": {"reputation": 1827, "user_id": 450706, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f88b53eac24db144b567a6ea9b17b795?s=128&d=identicon&r=PG", "display_name": "Rich Ashworth", "link": "https://stackoverflow.com/users/450706/rich-ashworth"}, "edited": false, "score": 0, "creation_date": 1427208105, "post_id": 29233433, "comment_id": 46677092, "body": "Haskell implementation included so that this thread has a common language for talking about rose trees (I have come across a number of ways these can be represented). Agree this isn&#39;t really related to Haskell programming."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427208438, "post_id": 29234355, "comment_id": 46677371, "body": "Could you point me to an explanation of coinduction? Or explain it yourself?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427209142, "post_id": 29234355, "comment_id": 46677926, "body": "@dfeuer The topic is quite broad. To get an overview you can check wikipedia for it, corecursion, (Knaster-)Tarski&#39;s theorem, greatest fixed points, and final coalgebras. Also, bisimilarity between processes in a process algebra is a typical notion which involves proofs by coinduction. In the specific context of functional programming and codata, I guess it can be used, but I can&#39;t point to a typical example."}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1427260385, "post_id": 29234355, "comment_id": 46700669, "body": "@dfeuer Andy&#39;s brilliant paper from 1994 is the canonical reference for co-induction in FP, and it is highly readable: <a href=\"http://marcellodesales-cs-research.googlecode.com/svn/trunk/ms-cs-ufcg-brazil/functional-programming/docs/gordon94tutorial.pdf\" rel=\"nofollow noreferrer\">marcellodesales-cs-research.googlecode.com/svn/trunk/&hellip;</a>  Note that in the context of Haskell, it essentially amounts to proving P(bottom) holds, since data and co-data are the same in Haskell."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 0, "creation_date": 1427261208, "post_id": 29234355, "comment_id": 46700905, "body": "Thanks, @LeventErkok. I&#39;ll take a look."}, {"owner": {"reputation": 1827, "user_id": 450706, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f88b53eac24db144b567a6ea9b17b795?s=128&d=identicon&r=PG", "display_name": "Rich Ashworth", "link": "https://stackoverflow.com/users/450706/rich-ashworth"}, "edited": false, "score": 0, "creation_date": 1434723934, "post_id": 29234355, "comment_id": 49916114, "body": "could you point me to an example of induction being used like this? in the literature, I have only seen proofs using binary trees"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1427205236, "last_edit_date": 1427205236, "creation_date": 1427204895, "answer_id": 29234355, "question_id": 29233433, "link": "https://stackoverflow.com/questions/29233433/structural-induction-for-multi-way-rose-trees/29234355#29234355", "title": "Structural induction for multi-way (rose) trees", "body": "<p>To state that property <code>P</code> holds for all (*) rose trees, you have to prove that</p>\n\n<ul>\n<li>if <code>l :: [RoseTree]</code> is a list of rose trees whose elements satisfy <code>P</code>, and <code>x :: a</code> is arbitrary, then <code>Note x l</code> satisfies <code>P</code></li>\n</ul>\n\n<p>The part about <code>P</code> holding on the elements of <code>l</code> is the induction hypothesis, which you can use to prove <code>P(Node x l)</code>.</p>\n\n<p>There is no explicit base case here: this is because there's no explicit base case constructor. Yet, <code>Node x []</code> acts as an implicit base case for the trees,\nand indeed when <code>l</code> is empty we get a base case for induction implicitly. Concretely, the hypothesis \"all the elements of <code>l</code> satisfy <code>P</code>\" becomes vacuously true when <code>l</code> is empty, so we get <code>P(Node x [])</code> from the induction principle above.</p>\n\n<p>(*) More precisely, this principle proves <code>P</code> for every finite-depth rose tree. If you really have to consider infinite-depth ones (e.g. circular trees), you need coinduction.</p>\n"}], "owner": {"reputation": 1827, "user_id": 450706, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f88b53eac24db144b567a6ea9b17b795?s=128&d=identicon&r=PG", "display_name": "Rich Ashworth", "link": "https://stackoverflow.com/users/450706/rich-ashworth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 1, "accepted_answer_id": 29234355, "answer_count": 1, "score": 2, "last_activity_date": 1427205236, "creation_date": 1427202304, "question_id": 29233433, "link": "https://stackoverflow.com/questions/29233433/structural-induction-for-multi-way-rose-trees", "title": "Structural induction for multi-way (rose) trees", "body": "<p>Since multi-way trees can be defined as a recursive type: </p>\n\n<pre><code>data RoseTree a = Node {leaf :: a, subTrees :: [RoseTree a]}\n</code></pre>\n\n<p>is there a corresponding principle for performing structural induction on this type?</p>\n"}, {"tags": ["haskell", "selenium"], "comments": [{"owner": {"reputation": 15014, "user_id": 3821981, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/QKE9Z.jpg?s=128&g=1", "display_name": "Saifur", "link": "https://stackoverflow.com/users/3821981/saifur"}, "edited": false, "score": 1, "creation_date": 1427197477, "post_id": 29229873, "comment_id": 46669676, "body": "Where are you instantiating the <code>driver</code>?"}, {"owner": {"reputation": 309, "user_id": 3320256, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/NZCl4.png?s=128&g=1", "display_name": "daniel.kahlenberg", "link": "https://stackoverflow.com/users/3320256/daniel-kahlenberg"}, "reply_to_user": {"reputation": 15014, "user_id": 3821981, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/QKE9Z.jpg?s=128&g=1", "display_name": "Saifur", "link": "https://stackoverflow.com/users/3821981/saifur"}, "edited": false, "score": 0, "creation_date": 1427203946, "post_id": 29229873, "comment_id": 46673981, "body": "Good question, do you mean &quot;Started SocketListener on 0.0.0.0:4444&quot;? I compiled the tests coming with the hs-webdriver now and running <code>.\\dist\\build\\test-search-baidu\\test-search-baidu.exe</code> got me a: <code>test-search-baidu.exe: TimeoutTriggered</code>."}, {"owner": {"reputation": 309, "user_id": 3320256, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/NZCl4.png?s=128&g=1", "display_name": "daniel.kahlenberg", "link": "https://stackoverflow.com/users/3320256/daniel-kahlenberg"}, "reply_to_user": {"reputation": 15014, "user_id": 3821981, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/QKE9Z.jpg?s=128&g=1", "display_name": "Saifur", "link": "https://stackoverflow.com/users/3821981/saifur"}, "edited": false, "score": 1, "creation_date": 1427359034, "post_id": 29229873, "comment_id": 46747387, "body": "I could not reproduce the timeout on an ubuntu installation, there it works as expected. If I find the cause on the mswindows installation I will post it here."}, {"owner": {"reputation": 309, "user_id": 3320256, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/NZCl4.png?s=128&g=1", "display_name": "daniel.kahlenberg", "link": "https://stackoverflow.com/users/3320256/daniel-kahlenberg"}, "reply_to_user": {"reputation": 15014, "user_id": 3821981, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/QKE9Z.jpg?s=128&g=1", "display_name": "Saifur", "link": "https://stackoverflow.com/users/3821981/saifur"}, "edited": false, "score": 0, "creation_date": 1427456928, "post_id": 29229873, "comment_id": 46794719, "body": "<a href=\"http://superuser.com/a/536198/432066\">Seems like</a> the only workaround is to tell selenium-server to start its socketlistener at localhost."}], "owner": {"reputation": 309, "user_id": 3320256, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/NZCl4.png?s=128&g=1", "display_name": "daniel.kahlenberg", "link": "https://stackoverflow.com/users/3320256/daniel-kahlenberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1427192052, "creation_date": 1427192052, "question_id": 29229873, "link": "https://stackoverflow.com/questions/29229873/i-wonder-why-the-page-is-not-even-opened-in-my-webdriver-session", "title": "I wonder why the page is not even opened in my webdriver session", "body": "<p>I try to automate tests with the help of <a href=\"https://hackage.haskell.org/package/webdriver\" rel=\"nofollow\">hs-webdriver</a>, code see below. I have a selenium-server instance started. Everytime I run the <code>main</code> function in <code>ghci</code> I get an <code>*** Exception: TimeoutTriggered</code> and also the given page isn't opened. Do you have any idea, what's going wrong?</p>\n\n<pre><code>:set -XOverloadedStrings    \n:m + Test.WebDriver Control.Monad Test.WebDriver.Commands.Wait\nlet main :: IO() ; main = runSession defaultConfig $ do { openPage \"http://stackoverflow.com/questions/ask\" ; waitUntil 60 (findElem $ ByXPath \".//div\") ; return () }\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4039, "user_id": 667147, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/1iNND.png?s=128&g=1", "display_name": "jarandaf", "link": "https://stackoverflow.com/users/667147/jarandaf"}, "edited": false, "score": 0, "creation_date": 1427187076, "post_id": 29227806, "comment_id": 46663360, "body": "can you show us <code>priceOf</code> method?"}, {"owner": {"reputation": 53, "user_id": 1005614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdd9fcf3d8e8df633d142fcb986c5fa?s=128&d=identicon&r=PG", "display_name": "Christian Soronellas Vallesp&#237;", "link": "https://stackoverflow.com/users/1005614/christian-soronellas-vallesp%c3%ad"}, "reply_to_user": {"reputation": 4039, "user_id": 667147, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/1iNND.png?s=128&g=1", "display_name": "jarandaf", "link": "https://stackoverflow.com/users/667147/jarandaf"}, "edited": false, "score": 0, "creation_date": 1427198666, "post_id": 29227806, "comment_id": 46670424, "body": "I have added the definition of <code>priceOf</code>."}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 1005614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdd9fcf3d8e8df633d142fcb986c5fa?s=128&d=identicon&r=PG", "display_name": "Christian Soronellas Vallesp&#237;", "link": "https://stackoverflow.com/users/1005614/christian-soronellas-vallesp%c3%ad"}, "edited": false, "score": 0, "creation_date": 1427198749, "post_id": 29228892, "comment_id": 46670468, "body": "Thanks for the explanation. I&#39;ll try it! :)"}], "tags": [], "owner": {"reputation": 133729, "user_id": 98117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4704a2a1d16b276070962ee01fb6149f?s=128&d=identicon&r=PG", "display_name": "hammar", "link": "https://stackoverflow.com/users/98117/hammar"}, "is_accepted": true, "score": 7, "last_activity_date": 1427188948, "creation_date": 1427188948, "answer_id": 29228892, "question_id": 29227806, "link": "https://stackoverflow.com/questions/29227806/simple-arithmetic-in-haskell/29228892#29228892", "title": "Simple arithmetic in Haskell", "body": "<p>The problem here is that (deducing from the error message) <code>priceOf</code> returns an <code>Int</code> while <code>0.95 * 8 * 2</code> has the polymorphic type <code>Fractional a =&gt; a</code>, and <code>shouldBe</code> is forcing these types to be the same. But <code>Int</code> isn't a <code>Fractional</code> type, so you get \"No instance for <code>Fractional Int</code>\".</p>\n\n<p>Ways to solve this:</p>\n\n<ol>\n<li>Make <code>priceOf</code> return a <code>Fractional</code> type, e.g. <code>Double</code>, or</li>\n<li>Convert <code>0.95 * 8 * 2</code> to <code>Int</code> using one of <code>round</code>, <code>floor</code> or <code>ceiling</code> depending on your requirements.</li>\n</ol>\n"}], "owner": {"reputation": 53, "user_id": 1005614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdd9fcf3d8e8df633d142fcb986c5fa?s=128&d=identicon&r=PG", "display_name": "Christian Soronellas Vallesp&#237;", "link": "https://stackoverflow.com/users/1005614/christian-soronellas-vallesp%c3%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 374, "favorite_count": 0, "accepted_answer_id": 29228892, "answer_count": 1, "score": 3, "last_activity_date": 1427198627, "creation_date": 1427185220, "last_edit_date": 1427198627, "question_id": 29227806, "link": "https://stackoverflow.com/questions/29227806/simple-arithmetic-in-haskell", "title": "Simple arithmetic in Haskell", "body": "<p>I'm new to Haskell and in order to get familiar with it I'm doing some basic code katas. Currently, I'm doing the <a href=\"http://www.codingdojo.org/cgi-bin/index.pl?action=browse&amp;id=KataPotter&amp;revision=41\" rel=\"nofollow\">Kata Potter</a> and I have the following snippet of code that I don't know what's wrong in it.</p>\n\n<pre><code>import Test.Hspec\n\npriceOf :: [Int] -&gt; Int\npriceOf xs = 8 * (length xs) \n\nmain :: IO ()\nmain = hspec $ do\n  describe \"Harry Potter book prices\" $ do\n    context \"Simple discounts\" $ do\n      it \"should apply a discount to two different books\" $ do\n        priceOf [0, 1] `shouldBe` 0.95 * 8 * 2\n</code></pre>\n\n<p>And when trying to run it with cabal, it ends up throwing the following error</p>\n\n<pre><code>No instance for (Fractional Int) arising from the literal '0.95'\nIn the first argument of '(*)', namely '0.95'\nIn the first argument of '(*)', namely '0.95 * 8'\nIn the second argument of 'shouldBe', namely '0.95 * 8 * 2'\n</code></pre>\n\n<p>Reading further on similar topics here and the chapter about <code>Converting numbers</code> on the Haskell wiki, I've found the <code>fromIntegral</code> function but still don't get it and I don't know how should be the correct way to apply basic arithmetic between different types in Haskell.</p>\n\n<p>Can someone help?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "cabal", "quickcheck", "hspec"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1427189123, "post_id": 29227144, "comment_id": 46664450, "body": "Could you post an example? So far I didn&#39;t have any problems with hspec+QuickCheck."}, {"owner": {"reputation": 18550, "user_id": 699, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/82f061c8b1e54a6eff04275e54bef162?s=128&d=identicon&r=PG", "display_name": "Michael Neale", "link": "https://stackoverflow.com/users/699/michael-neale"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1427420448, "post_id": 29227144, "comment_id": 46780681, "body": "Turned out it was my implications being too specific - quickcheck actually gave up before it found anything that met my criteria - but I was confused by the message."}], "owner": {"reputation": 18550, "user_id": 699, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/82f061c8b1e54a6eff04275e54bef162?s=128&d=identicon&r=PG", "display_name": "Michael Neale", "link": "https://stackoverflow.com/users/699/michael-neale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1427182560, "creation_date": 1427182560, "question_id": 29227144, "link": "https://stackoverflow.com/questions/29227144/how-to-get-quickcheck-failure-details-from-hspec-being-run-with-cabal-test", "title": "How to get quickcheck failure details from hspec being run with cabal test", "body": "<p>I am using hspec with quickcheck, as per <a href=\"http://hspec.github.io/quickcheck.html\" rel=\"nofollow\">http://hspec.github.io/quickcheck.html</a></p>\n\n<p>however, on failures, I simply get that a failure happened in a spec, no details about the data used by quickcheck so I can start diagnosing the failure. How do I get this detail out when running tests via cabal? </p>\n"}, {"tags": ["function", "haskell", "recursion"], "comments": [{"owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "edited": false, "score": 0, "creation_date": 1427181608, "post_id": 29226868, "comment_id": 46661129, "body": "does the assignment have any restrictions on using the <code>filter</code> command?"}], "answers": [{"comments": [{"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "edited": false, "score": 1, "creation_date": 1427184328, "post_id": 29227258, "comment_id": 46662154, "body": "I think this probably needs another couple of paragraphs explaining why <code>number</code> doesn&#39;t make sense in this context, and clarifying what the <code>else</code> clause should look like (you have also renamed <code>allOcrDelete</code> to <code>delete&#39;</code> on the LHS but not on the RHS)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1427191993, "last_edit_date": 1427191993, "creation_date": 1427182930, "answer_id": 29227258, "question_id": 29226868, "link": "https://stackoverflow.com/questions/29226868/haskell-programming-simple-function-recurrsion/29227258#29227258", "title": "Haskell Programming simple function recurrsion", "body": "<p>First let me say, <em>don't use <code>head</code> and <code>tail</code>, ever</em>. ...Well, at least not until you've gathered so much experience that you can recognise the few cases when it actually makes something more concise. Usually pattern matching (or folding etc.) is not only much safer but also far more readable &amp; intuitive.</p>\n\n<p>So in your case, you're trying to get <code>head [a]</code>. What is <code>[a]</code>? You evidently mean, &ldquo;the argument of the function which has type <code>[a]</code>, but that's not possible to write in Haskell code. (What if there was yet another element of the same type?) To use an argument, you have to _bring it in scope, with some arbitrary name (only, names can't contain brackets), e.g.</p>\n\n<pre><code>delete' del xs = if head xs == number then delete'(tail xs)\n                  else del ++ [head xs] ++ delete'(tail xs)\n</code></pre>\n\n<p>would work. (Sort of. <code>number</code> also doesn't make sense there: you probably want to compare with <code>del</code>, instead of <em>inserting</em> that.)</p>\n\n<p>However, since the only thing you do with <code>xs</code> is call those <a href=\"https://en.wikipedia.org/wiki/Partial_function\" rel=\"nofollow\">evil</a> <code>head</code> and <code>tail</code> functions, you should rather write it this way:</p>\n\n<pre><code>delete' del (x:xs) = if x == number then delete' xs\n                      else del ++ [x] ++ delete' xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 16892, "user_id": 461499, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/OKnmM.png?s=128&g=1", "display_name": "RobAu", "link": "https://stackoverflow.com/users/461499/robau"}, "edited": false, "score": 0, "creation_date": 1427183962, "post_id": 29227263, "comment_id": 46662029, "body": "The <code>filter</code> solution is the most concise and clear solution. Please make it more prominent :)"}], "tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": false, "score": 4, "last_activity_date": 1427185471, "last_edit_date": 1427185471, "creation_date": 1427182941, "answer_id": 29227263, "question_id": 29226868, "link": "https://stackoverflow.com/questions/29226868/haskell-programming-simple-function-recurrsion/29227263#29227263", "title": "Haskell Programming simple function recurrsion", "body": "<p>As jamshidh mentioned, you can use <code>filter</code> and write:</p>\n\n<pre><code>allOcrDelete del = filter (/= del)\n</code></pre>\n\n<p>(<code>allOcrDelete</code> is a special case of <code>filter</code>)</p>\n\n<p>A naive implementation could be:</p>\n\n<pre><code>module Main where\n\nallOcrDelete :: Eq a =&gt; a -&gt; [a] -&gt; [a]\nallOcrDelete _ [] = []\nallOcrDelete del (x:xs)\n    | del == x  =   allOcrDelete del xs\n    | otherwise = x:allOcrDelete del xs\n\nmain = do\n    print $ allOcrDelete 2 [1,2,5,3,2,4,5,2]\n</code></pre>\n\n<p>Note:</p>\n\n<ul>\n<li>you don't need to use the <code>head</code> and <code>tail</code> functions in this case because pattern matching the list against <code>(x:xs)</code> will already split the list into the head <code>x</code> and the tail <code>xs</code> (this is a common pattern in Haskell)</li>\n</ul>\n"}], "owner": {"reputation": 11, "user_id": 4705496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab857728f5956b5a53d6e4d402fb9a43?s=128&d=identicon&r=PG&f=1", "display_name": "Stephanie", "link": "https://stackoverflow.com/users/4705496/stephanie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1427191993, "creation_date": 1427181358, "question_id": 29226868, "link": "https://stackoverflow.com/questions/29226868/haskell-programming-simple-function-recurrsion", "title": "Haskell Programming simple function recurrsion", "body": "<p>for this program an element and a list is taken in and a new list is returned. if there are any occurrences of the element in the list, they should be deleted in the list that is returned.</p>\n\n<pre><code>allOcrDelete :: Eq a =&gt; a -&gt; [a] -&gt; [a]\n\nallOcrDelete del = if head [a] == number then allOcrDelete(tail [a])\n               else del ++ [head [a]] ++ allOcrDelete(tail [a])\n</code></pre>\n\n<p>this is what i have so far. i'm not sure how to take an element and a list as parameters and how to take the head or tail and compare the head to the element to be deleted</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "edited": false, "score": 0, "creation_date": 1429075097, "post_id": 29226483, "comment_id": 47425557, "body": "Who is down voting this question? Please state your reason. I want to know."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 3, "last_activity_date": 1427181436, "creation_date": 1427181436, "answer_id": 29226884, "question_id": 29226483, "link": "https://stackoverflow.com/questions/29226483/circular-programming-replace-list-elements-by-minimum-value/29226884#29226884", "title": "Circular programming - replace list elements by minimum value", "body": "<p>I'm too tired to analyze your code, divine your intent and the bug.  However, I'll happily show you how I avoid having to think that hard when doing basic knot tying.</p>\n\n<p>Its this State Monad, yay!  My use of the State monad (below) is just a little plumbing that keeps track of a single current value in a manner that allows the value to be looked-up and updated.</p>\n\n<ul>\n<li><code>repMin</code> kicks off the computation by taking into account the empty list then running the state monad.</li>\n<li>Our worker action <code>f</code> is provided with the input list and the minimum element in the list (currently a thunk, do not evaluate!)</li>\n<li><code>f</code> traverses the list computing the minimum on the way and replacing each element with the soon-to-be-known-but-not-yet-evaluatable minimum value <code>m</code>.</li>\n</ul>\n\n<p>The code:</p>\n\n<pre><code>import Control.Monad.State\n\nrepMin :: [Int] -&gt; [Int]\nrepMin [] = []\nrepMin xs@(x:_) = let (v,m) = runState (f m xs) x in  v\n\nf :: Int -&gt; [Int] -&gt; State Int [Int]\nf m xs = mapM (\u03bbx -&gt; checkMin x &gt;&gt; return m) xs\n where\n    checkMin :: Int -&gt; State Int ()\n    checkMin x = modify (min x) \n</code></pre>\n\n<p>Notice there's a lazyness leak here wrt our huge thunk of <code>min a (min b ( min c ...)))</code>, but you get the picture.</p>\n"}, {"comments": [{"owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "edited": false, "score": 0, "creation_date": 1427187571, "post_id": 29226907, "comment_id": 46663595, "body": "is it impossible without feedforward?"}, {"owner": {"reputation": 4554, "user_id": 1385860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94d0e7a0bce722ce5017c9abdf997037?s=128&d=identicon&r=PG", "display_name": "Neil Forrester", "link": "https://stackoverflow.com/users/1385860/neil-forrester"}, "reply_to_user": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "edited": false, "score": 0, "creation_date": 1427217562, "post_id": 29226907, "comment_id": 46684073, "body": "Yes. However, shang&#39;s answer is actually better than mine, and is probably closer to what the author of the article intended. His <code>m</code> variable is the feedforward and his <code>m&#39;</code> variable is the feedback. The improvement is that he used the feedback channel to fill in the output list directly, rather than bringing it all the way back to the front and passing it along down the list one more time (the brown &quot;minimum&quot; arrow in my diagram)."}], "tags": [], "owner": {"reputation": 4554, "user_id": 1385860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94d0e7a0bce722ce5017c9abdf997037?s=128&d=identicon&r=PG", "display_name": "Neil Forrester", "link": "https://stackoverflow.com/users/1385860/neil-forrester"}, "is_accepted": false, "score": 4, "last_activity_date": 1427181517, "creation_date": 1427181517, "answer_id": 29226907, "question_id": 29226483, "link": "https://stackoverflow.com/questions/29226483/circular-programming-replace-list-elements-by-minimum-value/29226907#29226907", "title": "Circular programming - replace list elements by minimum value", "body": "<p>That's a pretty cool technique! Here's a working program that's inspired by yours (I didn't really read the article except to glance at the picture, so this may not be exactly what the author intended, but it works):</p>\n\n<pre><code>looper :: (inputT -&gt; feedfwdT -&gt; feedbackT -&gt; (feedbackT, outputT)) -&gt; inputT -&gt; feedfwdT -&gt; outputT\nlooper f input primer = output\n  where (feedback, output) = f input primer feedback\n\nmin_feedback :: (Ord a) =&gt; [a] -&gt; Maybe a -&gt; a -&gt; (a, [a])\nmin_feedback [] (Just p) _ = (p, [])\nmin_feedback (x:xs) partial_min minimum = (feedback, minimum:output)\n  where new_partial_min = case partial_min\n                of Nothing -&gt; Just x\n                   Just p -&gt; Just $ min x p\n    (feedback, output) = min_feedback xs new_partial_min minimum\n\nmin_looped :: (Ord a) =&gt; [a] -&gt; [a]\nmin_looped input = looper min_feedback input Nothing\n\nmain = print $ min_looped [1,4,6,2,6,3,-1,6,3,6,10]\n</code></pre>\n\n<p>The key here is that you need more than the feedback channel, you also need a feedforward channel to determine the minimum value on the first pass through the loop. My ASCII art skills are not up to the standard set in the article, so you'll just have to make do with this paint drawing:\n<img src=\"https://i.stack.imgur.com/kIVdE.png\" alt=\"Circular programming example\">\nThe feedforward is the minimum value seen so far in the list. The primer kickstarts the feedforward channel. The feedback channel takes the result value from the feedforward channel back up to the start of the list. Finally the feedback value becomes the minimum value that gets used to fill the output list.</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 4, "last_activity_date": 1427194048, "last_edit_date": 1427194048, "creation_date": 1427188786, "answer_id": 29228820, "question_id": 29226483, "link": "https://stackoverflow.com/questions/29226483/circular-programming-replace-list-elements-by-minimum-value/29228820#29228820", "title": "Circular programming - replace list elements by minimum value", "body": "<p>It's</p>\n\n<pre><code>repIIminList (x:[]) m' = ([m'], x)\nrepIIminList (x:xs) m' = (m' : xs', min x m) where (xs', m) = repIIminList xs m'\n</code></pre>\n\n<p><code>m</code> is a current minimum, <code>m'</code> is a final minimum, <code>xs</code> is a current list, <code>xs'</code> is a final list. That is, <code>repIIminList</code> receives a list and a number and recursively replaces every element in a list with this number. <code>repIIminList</code> also computes the minimum of the list. <code>trace</code> applies <code>repIIminList</code> to the minimum, computed by <code>repIIminList</code> itself.</p>\n\n<p>Using the state monad you can rewrite this in a pretty explicit way:</p>\n\n<pre><code>repminList :: [Int] -&gt; [Int]\nrepminList  []    = []\nrepminList (x:xs) = evalState (go xs) x where\n    go  []    = get &gt;&gt;= return . (:[])\n    go (x:xs) = modify (min x) &gt;&gt; flip (:) &lt;$&gt; go xs &lt;*&gt; get\n</code></pre>\n\n<p>Or using CPS style directly:</p>\n\n<pre><code>repminList :: [Int] -&gt; [Int]\nrepminList  []    = []\nrepminList (x:xs) = foldr (\\x r -&gt; (\\(x:xs) -&gt; x:x:xs) . r . min x) (:[]) xs x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 8, "last_activity_date": 1427195958, "creation_date": 1427195958, "answer_id": 29231227, "question_id": 29226483, "link": "https://stackoverflow.com/questions/29226483/circular-programming-replace-list-elements-by-minimum-value/29231227#29231227", "title": "Circular programming - replace list elements by minimum value", "body": "<p>Your problem is that you have two different <code>m</code> variables and one shadows over the other so you don't end up using the actual circular variable at all. Here's the fixed version of your <code>repIIminList</code>:</p>\n\n<pre><code>repIIminList [x] m = ([m], x)\nrepIIminList (a:as) m = let (replaced, m') = repIIminList as m\n                        in (m : replaced, min a m')\n</code></pre>\n\n<p>Here <code>m</code> is the final, smallest element of the list that you receive as circular parameter. The <code>m'</code> returned from the recursive call to <code>repIIminList</code> is the smallest value seen so far, so it's important that you append the <em>final</em> smallest value (i.e. <code>m</code>) to the result list and then update the current smallest value by returning <code>min a m'</code>.</p>\n"}], "owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 417, "favorite_count": 0, "accepted_answer_id": 29231227, "answer_count": 4, "score": 6, "last_activity_date": 1427195958, "creation_date": 1427179590, "question_id": 29226483, "link": "https://stackoverflow.com/questions/29226483/circular-programming-replace-list-elements-by-minimum-value", "title": "Circular programming - replace list elements by minimum value", "body": "<p>I've just read <a href=\"https://wiki.haskell.org/Circular_programming\">this article</a> about <code>circular programming</code>. It seems so alien to me. Although I can imagine the feedback as lazily evaluated thunk that will be evaluated to desired result later, just can't wrap my head around it. So I decided to write function that replaces every element of a list with it's minimum value.</p>\n\n<pre><code>trace :: (a -&gt; c -&gt; (b,c)) -&gt; a -&gt; b\ntrace f a = b\n    where (b,c) = f a c\n\nrepminList :: (Num a, Ord a) =&gt; [a] -&gt; [a]\nrepminList = trace repIIminList \n\nrepIIminList [x] m = ([m], x)\nrepIIminList (a:as) m = let (replaced, m) = repIIminList as m \n                        in (m : replaced, min a m)\n</code></pre>\n\n<p>But <code>repminList [1,2,3]</code> equals to <code>[2,3,3]</code>. What would be the correct version?</p>\n"}, {"tags": ["file", "parsing", "haskell", "line", "main"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4706184"}, "edited": false, "score": 0, "creation_date": 1427226760, "post_id": 29226894, "comment_id": 46689318, "body": "thanks, i&#39;m new to Haskell, but this method seem like a good standard way to work with files or is there a more preferred  way?"}, {"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1427226863, "post_id": 29226894, "comment_id": 46689368, "body": "Always depends on your usage. Are you asking if it&#39;s idiomatic? Not necessarily but that shouldn&#39;t matter.  Work with what you have now, and when you start becoming more advanced you&#39;ll end up refactoring it. Don&#39;t worry about it now if it works."}], "tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": true, "score": 3, "last_activity_date": 1427181472, "creation_date": 1427181472, "answer_id": 29226894, "question_id": 29226372, "link": "https://stackoverflow.com/questions/29226372/haskell-main-hs12119-parse-error-on-input/29226894#29226894", "title": "Haskell -- main.hs:121:19: parse error on input `&lt;-&#39;", "body": "<p>A <code>let</code> block should be followed either by more 'variable' assignments, or should be ended. In that case, you want to align the next actions under the <code>let</code>. All of this should be in a <code>do</code> statement.</p>\n\n<p>So.... You want to have a <code>do</code> right after your <code>then</code>, and you want to align the <code>list &lt;- ...</code> and <code>mapM_ ...</code> with the let command:</p>\n\n<pre><code>main = do\n    argv &lt;- getArgs\n    name &lt;- getProgName\n    if not (null argv)\n    then do\n       let file = head argv \n       list &lt;- getLines file\n       mapM_ putStrLn list\n    else hPutStr stderr $ \"usage: \" ++ name ++ \" number\\n\"\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4706184"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 29226894, "answer_count": 1, "score": 0, "last_activity_date": 1427181472, "creation_date": 1427179036, "last_edit_date": 1427180467, "question_id": 29226372, "link": "https://stackoverflow.com/questions/29226372/haskell-main-hs12119-parse-error-on-input", "title": "Haskell -- main.hs:121:19: parse error on input `&lt;-&#39;", "body": "<pre><code>import System.Environment\nimport Control.Monad\n\ngetLines = liftM lines . readFile\n\nmain = do\n    argv &lt;- getArgs\n    name &lt;- getProgName\n    if not (null argv)\n    then let file = head argv \n             list &lt;- getLines file\n             mapM_ putStrLn list\n    else hPutStr stderr $ \"usage: \" ++ name ++ \" number\\n\"\n</code></pre>\n\n<p>I'm not sure what I'm doing wrong and why I'm getting this error.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1427180352, "post_id": 29226030, "comment_id": 46660590, "body": "Can you give some more examples? What does the task description mean by &#39;getting digits&#39; right. In &#39;123456789&#39; and &#39;123465888&#39;, do you have four digits right (because the both start with the same four numbers) or six (because 1,2,3,4 and 8 are at the correct position) or even seven (because 1,2,3,4,5,6,8 appear in both numbers)?"}, {"owner": {"reputation": 15, "user_id": 4706069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfe5352504e4c8e0be59b44c5c169abe?s=128&d=identicon&r=PG&f=1", "display_name": "Giorgos", "link": "https://stackoverflow.com/users/4706069/giorgos"}, "reply_to_user": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1427209234, "post_id": 29226030, "comment_id": 46677993, "body": "in this instance you get 1,2,3,4 and 8 right because they are in the same position in both numbers so you have found 5 digits right out of 8"}], "answers": [{"tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": true, "score": 1, "last_activity_date": 1427180222, "creation_date": 1427180222, "answer_id": 29226636, "question_id": 29226030, "link": "https://stackoverflow.com/questions/29226030/compare-two-numbers-in-haskell/29226636#29226636", "title": "Compare two numbers in Haskell", "body": "<p>As there is no state in Haskell, you cannot have counters like you would in imperative languages.</p>\n\n<p>You will often use recursion for this matter. Here is an example:</p>\n\n<pre><code>module Main where\n\nmoneyWon :: Int -&gt; Int\nmoneyWon 8 = 1000000\nmoneyWon 7 = 100000\nmoneyWon 6 = 8000\nmoneyWon 5 = 300\nmoneyWon 4 = 20\nmoneyWon 3 = 5\nmoneyWon 2 = 1\nmoneyWon _ = 0\n\ndigits :: Int -&gt; Int -&gt; Int\ndigits 0 0 = 0\ndigits x y = digits dx dy + if mx == my then 1 else 0\n    where (dx, mx) = divMod x 10\n          (dy, my) = divMod y 10\n\nmain = do\n    print $ (moneyWon . digits 12345678) 12345668\n</code></pre>\n\n<p>Notes:</p>\n\n<ul>\n<li>counting corresponding digits and evaluating the prize are two different concerns, that's why I've separated them</li>\n<li>the <code>divMod x 10</code> is a way to get the lowest meaning digit in base 10</li>\n<li>in real life, you should not use an integer to hold the digits since it is more a list matter than a number matter (that's why the number starts at 10000000 and not at 0, forcing the user to enter the right number of digits).</li>\n<li>Using <code>Int</code> leaves with the task to check the number is valid.</li>\n</ul>\n"}], "owner": {"reputation": 15, "user_id": 4706069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfe5352504e4c8e0be59b44c5c169abe?s=128&d=identicon&r=PG&f=1", "display_name": "Giorgos", "link": "https://stackoverflow.com/users/4706069/giorgos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4998, "favorite_count": 0, "closed_date": 1427193820, "accepted_answer_id": 29226636, "answer_count": 1, "score": 0, "last_activity_date": 1427180222, "creation_date": 1427177154, "last_edit_date": 1427180065, "question_id": 29226030, "link": "https://stackoverflow.com/questions/29226030/compare-two-numbers-in-haskell", "closed_reason": "Needs details or clarity", "title": "Compare two numbers in Haskell", "body": "<p><a href=\"http://i.stack.imgur.com/71w9v.png\" rel=\"nofollow\">http://i.stack.imgur.com/71w9v.png</a></p>\n\n<p>I have to find how much money a player wins. </p>\n\n<p>This must be done by creating a function called digits <code>Int-&gt;Int-&gt;Int</code>. For example if the first input is <code>13758455</code> and the second input of the function is <code>13758455</code> then I should get <code>1000000</code> in the compiler. </p>\n\n<p>This is normally an easy task in Java but I wasn't able to find something like a counter to count up as I find more digits in a number.</p>\n"}, {"tags": ["haskell", "random"], "comments": [{"owner": {"reputation": 2725, "user_id": 2251058, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8ffc7bebb06ae9943708d99f3621c1b5?s=128&d=identicon&r=PG", "display_name": "Akshay Hazari", "link": "https://stackoverflow.com/users/2251058/akshay-hazari"}, "edited": false, "score": 0, "creation_date": 1427171310, "post_id": 29224907, "comment_id": 46658012, "body": "Does the question title suit the question appropriately."}, {"owner": {"reputation": 8858, "user_id": 186026, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/q1xfe.png?s=128&g=1", "display_name": "fjarri", "link": "https://stackoverflow.com/users/186026/fjarri"}, "edited": false, "score": 0, "creation_date": 1427171925, "post_id": 29224907, "comment_id": 46658205, "body": "So, do I understand it correctly that <code>randomFile</code> is supposed to write <code>noe</code> randoms in the range <code>[mind, maxd]</code> to <code>RFile.txt</code>? The <code>let l ...</code> line is a bit confusing."}, {"owner": {"reputation": 2725, "user_id": 2251058, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8ffc7bebb06ae9943708d99f3621c1b5?s=128&d=identicon&r=PG", "display_name": "Akshay Hazari", "link": "https://stackoverflow.com/users/2251058/akshay-hazari"}, "reply_to_user": {"reputation": 8858, "user_id": 186026, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/q1xfe.png?s=128&g=1", "display_name": "fjarri", "link": "https://stackoverflow.com/users/186026/fjarri"}, "edited": false, "score": 0, "creation_date": 1427172408, "post_id": 29224907, "comment_id": 46658342, "body": "Ok after multiple edits I kind of got to that. So after that comment I realized there was no need for a foldl. randomFile is supposed to write <code>noe ^2</code> (no of expressions) to the file, each expression will contain multiple no of  integers (yet to be done)."}], "answers": [{"comments": [{"owner": {"reputation": 2725, "user_id": 2251058, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8ffc7bebb06ae9943708d99f3621c1b5?s=128&d=identicon&r=PG", "display_name": "Akshay Hazari", "link": "https://stackoverflow.com/users/2251058/akshay-hazari"}, "edited": false, "score": 0, "creation_date": 1427175358, "post_id": 29225584, "comment_id": 46659084, "body": "I kind of know those concepts which I have freshly learnt but have lacked any coding practice to realize it practically. That is an excellently written answer. Thank you so much."}, {"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "reply_to_user": {"reputation": 2725, "user_id": 2251058, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8ffc7bebb06ae9943708d99f3621c1b5?s=128&d=identicon&r=PG", "display_name": "Akshay Hazari", "link": "https://stackoverflow.com/users/2251058/akshay-hazari"}, "edited": false, "score": 1, "creation_date": 1427263825, "post_id": 29225584, "comment_id": 46701743, "body": "The more I read, the more I find out that everyone learns about Monads differently. Glad you found a tutorial that works for you! If you want to test your knowledge, make sure you go through the 20 intermediate exercises."}], "tags": [], "owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "is_accepted": true, "score": 7, "last_activity_date": 1427243626, "last_edit_date": 1427243626, "creation_date": 1427174708, "answer_id": 29225584, "question_id": 29224907, "link": "https://stackoverflow.com/questions/29224907/write-list-of-random-numbers-to-file-no-instance-for-show-io-a0/29225584#29225584", "title": "Write list of random numbers to file. No Instance for (Show (IO a0))", "body": "<p>I think you have a misunderstanding of what IO is. If you haven't done it, I strongly recommend going through the <a href=\"http://learnyouahaskell.com/input-and-output\" rel=\"nofollow\">Input and Output section of Learn You a Haskell</a>.</p>\n\n<p><code>IO</code> doesn't necessarily have anything to do with <code>print</code>. In Haskell every entry in memory that was made by your own code is considered \"pure\" while any entry that touches the rest of the computer lives in IO (with some exceptions you will learn about over time).</p>\n\n<p>We model IO using something called a Monad. Which you will learn more about the longer you do Haskell. To understand this, let's look at an example of some code that does and doesn't use IO:</p>\n\n<pre><code>noIOused :: Int -&gt; Int\nnoIOused x = x + 5\n\nusesIO :: Int -&gt; IO Int\nusesIO x = print x &gt;&gt; return (x + 5)\n\nusesIO2 :: Int -&gt; IO Int\nusesIO2 x = do\n    print x\n    return (x + 5)\n</code></pre>\n\n<p>The first function is \"pure\". The second and third functions have an IO \"effect\" that comes in the form of printing to the screen. <code>usesIO</code> and <code>usesIO2</code> are just 2 different ways of doing the same thing (it's the same code but with different syntax). I'll use the second format, called <code>do</code> notation from here.</p>\n\n<p>Here are some other ways you could have had IO effects:</p>\n\n<pre><code>add5WithFile :: Int -&gt; IO Int\nadd5WithFile x = do\n    writeFile \"someFile.txt\" (show x)\n    return (x + 5)\n</code></pre>\n\n<p>Notice that in that function we didn't print anything, we wrote a file. But writing a file has a side effect and interacts with the rest of the system. So any value we return has to get wrapped in IO.</p>\n\n<pre><code>addRandom :: Int -&gt; IO Int\naddRandom x = do\n    y &lt;- randomRIO (1,10)\n    return (x + y)\n</code></pre>\n\n<p>In <code>addRandom</code> we called <code>randomRIO (1,10)</code>. But the problem is that randomRIO doesn't return an <code>Int</code>. It returns an <code>IO Int</code>. Why? Because in order to get true randomness we need to interact with the system in some way. To get around that, we have to temporarily strip away the IO. That's where this line comes in:</p>\n\n<pre><code>y &lt;- randomRIO (1,10)\n</code></pre>\n\n<p>That <code>&lt;-</code> arrow tells us that we want a <code>y</code> value outside of IO. For as long as we remain inside the <code>do</code> syntax that <code>y</code> value is going to be \"pure\". Now we can use it just like any other value.</p>\n\n<p>So for example we couldn't do this:</p>\n\n<pre><code>let w = x + (randomRIO (1,10))\n</code></pre>\n\n<p>Because that would be trying to add <code>Int</code> to <code>IO Int</code>. And unfortunately our <code>+</code> function doesn't know how to do that. So first we have to \"bind\" the result of <code>randomRIO</code> to <code>y</code> before we can add it to <code>x</code>.</p>\n\n<p>Now let's look at your code:</p>\n\n<pre><code>let l=(replicate (fromInteger(noe ^ noe)) ( mind `randNo` maxd))\nwriteFile \"RFile.txt\" (show l)\n</code></pre>\n\n<p>The type of <code>l</code> is actually <code>IO a0</code>. It's <code>a0</code> because you haven't told the compiler what kind of number you want. So it doesn't know if you want a fraction, a double, a big integer or whatever.</p>\n\n<p>So the first problem is to let the compiler know a little bit more about what kind of random number you want. We do this by adding a type annotation:</p>\n\n<pre><code>randNo :: Int -&gt; Int -&gt; IO Int\nrandNo mind maxd = randomRIO (mind,maxd)\n</code></pre>\n\n<p>Now both you and the compiler knows what kind of value <code>randNo</code> is.</p>\n\n<p>Now we need to \"bind\" that value inside of the <code>do</code> notation to temporarily escape IO. You might think that would be simple, like this:</p>\n\n<pre><code>randomFile mind maxd noe = do\n  l &lt;- replicate (fromInteger(noe ^ noe)) ( mind `randNo` maxd)\n  writeFile \"RFile.txt\" (show l)\n</code></pre>\n\n<p>Surely that will \"bind\" the <code>IO Int</code> to <code>l</code> right? Unfortunately not. The problem here is that <code>replicate</code> is a function of the form <code>Int -&gt; a -&gt; [a]</code>. That is, given a number and a type, it will give you a list of that type.</p>\n\n<p>If you give <code>replicate</code> an <code>IO Int</code> it's going to make <code>[IO Int]</code>. That actually looks more like this: <code>List (IO Int)</code> except we use <code>[]</code> as syntactic sugar for lists. Unfortunately if we want to \"bind\" an <code>IO</code> value to something with <code>&lt;-</code> it has to be the out-most type.</p>\n\n<p>So what you need is a way to turn an <code>[IO Int]</code> into an <code>IO [Int]</code>. There are two ways to do that. If we <a href=\"https://www.haskell.org/hoogle/?hoogle=%5BIO%20a%5D%20-%3E%20IO%20%5Ba%5D\" rel=\"nofollow\">put <code>\\[IO a\\] -&gt; IO \\[a\\]</code> into Hoogle</a> we get this:</p>\n\n<pre><code>sequence :: Monad m =&gt; [m a] -&gt; m [a]\n</code></pre>\n\n<p>As I mentioned before, we generalise IO to something called a Monad. Which isn't really that big a deal, we could pretend that <code>sequence</code> has this signature: <code>sequence :: [IO a] -&gt; IO [a]</code> and it would be the same thing just specialised to IO.</p>\n\n<p>Now your function would be done like this:</p>\n\n<pre><code>randomFile mind maxd noe = do\n  l &lt;- sequence (replicate (fromInteger(noe ^ noe)) ( mind `randNo` maxd))\n  writeFile \"RFile.txt\" (show l)\n</code></pre>\n\n<p>But a <code>sequence</code> followed by <code>replicate</code> is something people have to do all the time. So someone went and made a function called <code>replicateM</code>:</p>\n\n<pre><code>replicateM :: Monad m =&gt; Int -&gt; m a -&gt; m [a]\n</code></pre>\n\n<p>Now we can write your function like this:</p>\n\n<pre><code>randomFile mind maxd noe = do\n  l &lt;- replicateM (fromInteger(noe ^ noe)) ( mind `randNo` maxd)\n  writeFile \"RFile.txt\" (show l)\n</code></pre>\n\n<p>And for some real Haskell magic, you can write all 3 lines of code in a single line, like this:</p>\n\n<pre><code>randomFile mind maxd noe = randomRIO &gt;&gt;= writeFile \"RFile.txt\" . replicateM (fromInteger(noe ^ noe))\n</code></pre>\n\n<p>If that looks like gibberish to you, then there's a lot you need to learn. Here is the suggested path:</p>\n\n<ol>\n<li>If you haven't already, start from the beginning with <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow\">Learn You a Haskell</a></li>\n<li>Then learn about how <a href=\"http://blog.sigfpe.com/2006/08/you-could-have-invented-monads-and.html\" rel=\"nofollow\">You could have invented Monads</a> </li>\n<li>Then learn more about how to use <a href=\"http://en.wikibooks.org/wiki/Haskell/Libraries/Random\" rel=\"nofollow\">randomness in Haskell</a></li>\n<li>Finally see if you can complete the <a href=\"https://www.fpcomplete.com/user/DanBurton/20-intermediate-exercises\" rel=\"nofollow\">20 intermediate Haskell exercises</a></li>\n</ol>\n"}], "owner": {"reputation": 2725, "user_id": 2251058, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8ffc7bebb06ae9943708d99f3621c1b5?s=128&d=identicon&r=PG", "display_name": "Akshay Hazari", "link": "https://stackoverflow.com/users/2251058/akshay-hazari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "accepted_answer_id": 29225584, "answer_count": 1, "score": 1, "last_activity_date": 1427243626, "creation_date": 1427170414, "last_edit_date": 1427172208, "question_id": 29224907, "link": "https://stackoverflow.com/questions/29224907/write-list-of-random-numbers-to-file-no-instance-for-show-io-a0", "title": "Write list of random numbers to file. No Instance for (Show (IO a0))", "body": "<p>I am trying to write to file a list of random Integers in a file. There seems to be a problem with <code>writeFile</code> here. When I use my function <code>randomFile</code> it says <code>no instance for (Show (IO a0))</code>. I see <code>writeFile</code> doesn't print anything to screen but <code>IO()</code>, so when I call the function <code>randomFile 1 2 3</code> it says <code>no Instance for Show (IO a0)</code> but actually I just want to execute the function and not have to print anything but how can I avoid this problem. I might be making a lot of errors here. Any help.</p>\n\n<pre><code>import Control.Monad\nimport Control.Applicative\nimport System.Random\n\nrandNo mind maxd = randomRIO (mind,maxd)\nrandomFile mind maxd noe = do\n  let l=(replicate (fromInteger(noe ^ noe)) ( mind `randNo` maxd))\n  writeFile \"RFile.txt\" (show l)\n</code></pre>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 8858, "user_id": 186026, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/q1xfe.png?s=128&g=1", "display_name": "fjarri", "link": "https://stackoverflow.com/users/186026/fjarri"}, "edited": false, "score": 1, "creation_date": 1427167692, "post_id": 29224498, "comment_id": 46657165, "body": "Do you mean <code>else [] ++ array</code> (which would be the same as just <code>else array</code>)? <code>[] array</code> is parsed as function application, and <code>[]</code> is not a function."}, {"owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "edited": false, "score": 1, "creation_date": 1427168028, "post_id": 29224498, "comment_id": 46657239, "body": "Did you mean <code>Int</code> and <code>Char</code> instead of <code>int</code> and <code>char</code> respectively?"}, {"owner": {"reputation": 8858, "user_id": 186026, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/q1xfe.png?s=128&g=1", "display_name": "fjarri", "link": "https://stackoverflow.com/users/186026/fjarri"}, "edited": false, "score": 1, "creation_date": 1427169758, "post_id": 29224498, "comment_id": 46657651, "body": "Could you explain in words what the last line is supposed to do?"}, {"owner": {"reputation": 11, "user_id": 4705496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab857728f5956b5a53d6e4d402fb9a43?s=128&d=identicon&r=PG&f=1", "display_name": "Stephanie", "link": "https://stackoverflow.com/users/4705496/stephanie"}, "edited": false, "score": 0, "creation_date": 1427169977, "post_id": 29224498, "comment_id": 46657705, "body": "when the tail of the list has no more  values, i wanted the recursion to stop, so i tried to make the last list in the recursion equal to nothing"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1427189263, "post_id": 29224498, "comment_id": 46664536, "body": "@Stephanie: Do you know about <code>map</code>? If you do, write <code>gradeSingle :: Int -&gt; Char</code> instead."}], "answers": [{"tags": [], "owner": {"reputation": 8858, "user_id": 186026, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/q1xfe.png?s=128&g=1", "display_name": "fjarri", "link": "https://stackoverflow.com/users/186026/fjarri"}, "is_accepted": false, "score": 4, "last_activity_date": 1427248882, "last_edit_date": 1427248882, "creation_date": 1427170365, "answer_id": 29224897, "question_id": 29224498, "link": "https://stackoverflow.com/questions/29224498/haskell-greater-than-or-equal/29224897#29224897", "title": "Haskell greater than or equal", "body": "<p>The preferable way to achieve what you want is to use pattern matching:</p>\n\n<pre><code>grade [] = []\ngrade array = if 90 &lt;= head array then ['A'] ++ grade(tail array)\n          else if 80 &lt;= head array then ['B'] ++ grade(tail array)\n          else if 70 &lt;= head array then ['C'] ++ grade(tail array)\n          else if 60 &lt;= head array then ['D'] ++ grade(tail array)\n          else ['F'] ++ grade(tail array)\n</code></pre>\n\n<p>Also, you can use pattern matching to get rid of repeating <code>head</code>/<code>tail</code> calls:</p>\n\n<pre><code>grade [] = []\ngrade (x:xs) = if 90 &lt;= x then ['A'] ++ grade xs\n          else if 80 &lt;= x then ['B'] ++ grade xs\n          else if 70 &lt;= x then ['C'] ++ grade xs\n          else if 60 &lt;= x then ['D'] ++ grade xs \n          else ['F'] ++ grade(xs)\n</code></pre>\n\n<p>Edit: to haskellize even more, you can use guards:</p>\n\n<pre><code>grade [] = []\ngrade (x:xs)\n    | 90 &lt;= x   = ['A'] ++ grade xs\n    | 80 &lt;= x   = ['B'] ++ grade xs\n    | 70 &lt;= x   = ['C'] ++ grade xs\n    | 60 &lt;= x   = ['D'] ++ grade xs\n    | otherwise = ['F'] ++ grade xs\n</code></pre>\n\n<p>Edit #2: removed parentheses next to <code>grade</code>, per @rampion's comment.</p>\n"}], "owner": {"reputation": 11, "user_id": 4705496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab857728f5956b5a53d6e4d402fb9a43?s=128&d=identicon&r=PG&f=1", "display_name": "Stephanie", "link": "https://stackoverflow.com/users/4705496/stephanie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4522, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1427248882, "creation_date": 1427167373, "last_edit_date": 1427168498, "question_id": 29224498, "link": "https://stackoverflow.com/questions/29224498/haskell-greater-than-or-equal", "title": "Haskell greater than or equal", "body": "<p>I'm trying to convert a list of integers into a list of characters to resemble grades. Here is my code in Haskell:</p>\n\n<pre><code>grade :: [int] -&gt; [char]\n\ngrade array = if 90 &lt;= head array then ['A'] ++ grade(tail array)\n          else if 80 &lt;= head array then ['B'] ++ grade(tail array)\n          else if 70 &lt;= head array then ['C'] ++ grade(tail array)\n          else if 60 &lt;= head array then ['D'] ++ grade(tail array)\n          else if 60 &gt; head array then ['F'] ++ grade(tail array)\n          else [] array\n</code></pre>\n\n<p>The compiler GHCi gives me this error:</p>\n\n<pre><code> Couldn't match expected type \u2018[int] -&gt; [char]\u2019\n            with actual type \u2018[t0]\u2019\nRelevant bindings include\n  array :: [int] (bound at grade.hs:3:7)\n  grade :: [int] -&gt; [char] (bound at grade.hs:3:1)\nThe function \u2018[]\u2019 is applied to one argument,\nbut its type \u2018[t0]\u2019 has none\nIn the expression: [] array\nIn the expression:\n  if 60 &gt; head array then ['F'] ++ grade (tail array) else [] array\n</code></pre>\n\n<p>I'm not sure what '[t0]' means</p>\n\n<p>thanks in advance</p>\n\n<p>I changed my code to this:</p>\n\n<pre><code>grade :: [Int] -&gt; [Char]\n\ngrade array = if 90 &lt;= head array then ['A'] ++ grade(tail array)\n          else if 80 &lt;= head array then ['B'] ++ grade(tail array)\n          else if 70 &lt;= head array then ['C'] ++ grade(tail array)\n          else if 60 &lt;= head array then ['D'] ++ grade(tail array)\n          else if 60 &gt; head array then ['F'] ++ grade(tail array)\n          else [] = array\n</code></pre>\n\n<p>thanks for your recommendations, but now it is giving me a parse error at '='? I'm not sure what is wrong now</p>\n"}, {"tags": ["function", "haskell", "partial-functions"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1427153470, "post_id": 29222273, "comment_id": 46653517, "body": "Put <code>p2</code> in a <code>where</code> statement of <code>p1</code>."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1427154716, "post_id": 29222304, "comment_id": 46653861, "body": "This is a pet peeve of mine. Leaving out the case provides a useful error at runtime carrying file+line info, but triggers a compile time warning. Adding the case requires me to add such info manually to the error string. I&#39;d argue that <code>error</code> should always report file+line info. (I know there&#39;s some CPP macro that can do that, but I&#39;d like this to be the default)"}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 2, "last_activity_date": 1427162402, "last_edit_date": 1427162402, "creation_date": 1427153184, "answer_id": 29222304, "question_id": 29222273, "link": "https://stackoverflow.com/questions/29222273/how-to-write-haskell-partial-functions-that-will-never-have-invalid-values/29222304#29222304", "title": "How to write Haskell partial functions that will never have invalid values?", "body": "<p>The most common approach is to put in a final case like</p>\n\n<pre><code>p2 [] = error \"impossible! p2 received an empty list\"\n</code></pre>\n\n<p>It should include sufficient information to track down the source of the problem in the error message. It's not ideal, though. People (including me) do it because it's a practical solution to a real problem. But sometimes code evolves and you end up in that case, and figuring out why is a debugging mess.</p>\n\n<p>It's far better to eliminate the problem by changing the boundary conditions to total functions:</p>\n\n<pre><code>p1 :: Num a =&gt; [a] -&gt; [a]\np1 xs = zipWith (+) xs' $ tail xs'\n  where\n    xs' = [0] ++ xs ++ [0]\n</code></pre>\n\n<p>Now you know that no amount of refactoring can trigger a hidden error case, because there isn't a hidden error case.</p>\n\n<p>Of course this sort of transformation isn't always possible. But it often is, and it's always worth spending a minute searching for.  You'll either find a better approach, or have come up with a reason why the function is partial to include in the comments.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1427161426, "creation_date": 1427161426, "answer_id": 29223601, "question_id": 29222273, "link": "https://stackoverflow.com/questions/29222273/how-to-write-haskell-partial-functions-that-will-never-have-invalid-values/29223601#29223601", "title": "How to write Haskell partial functions that will never have invalid values?", "body": "<p>You can make <code>p2</code> total by using a non-empty list type. Or, inlining and uncurrying the standard non-empty list type <code>(a, [a])</code>, you can write something like:</p>\n\n<pre><code>p2 :: Num a =&gt; a -&gt; [a] -&gt; [a]\np2 x []      = [x]\np2 x (x':xs) = (x+x'):p2 x' xs\n</code></pre>\n\n<p>You will of course have to modify <code>p1</code> slightly to match:</p>\n\n<pre><code>p1 :: Num a =&gt; [a] -&gt; [a]\np1 []         = []\np1 (x:xs)     = x:p2 x xs -- the call to p2 on this line changed\n</code></pre>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1478383895, "creation_date": 1427152948, "last_edit_date": 1478383895, "question_id": 29222273, "link": "https://stackoverflow.com/questions/29222273/how-to-write-haskell-partial-functions-that-will-never-have-invalid-values", "title": "How to write Haskell partial functions that will never have invalid values?", "body": "<p>Let's say want a function, taking a list of numbers, that returns the sum of adjacent pairs of numbers, except at the two edges where it simply returns the edge numbers. For example:</p>\n\n<pre><code>[1,2,3,4,5] --&gt; [1,3,5,7,9,5]\n</code></pre>\n\n<p>I come up with the following function:</p>\n\n<pre><code>p1 :: Num a =&gt; [a] -&gt; [a]\np1 []         = []\np1 (x:xs)     = x:p2 (x:xs)\n\np2 :: Num a =&gt; [a] -&gt; [a]\np2 [x]        = [x]\np2 (x1:x2:xs) = (x1+x2):p2 (x2:xs)\n</code></pre>\n\n<p><em>(never mind if there is a better way to do this ...)</em></p>\n\n<p><code>p2</code> is only ever called by <code>p1</code>. <code>p2</code> will also never be called with an empty list, only with lists at least one element. However, <code>p2</code> is still a partial function, and it will trigger a non-exhaustive pattern match warning with <code>ghc -Wall</code>. </p>\n\n<p>What is the accepted way to deal with this? Do I just not write the <code>p2 []</code> case? Or <code>p2 [] = undefined</code>, or <code>p2 [] = unused_value</code>, or something else? </p>\n"}, {"tags": ["haskell", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1427149025, "post_id": 29221486, "comment_id": 46651868, "body": "The sandbox is exactly that. It contains no versions of anything. This is what gives it it&#39;s strength."}, {"owner": {"reputation": 2340, "user_id": 2068635, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/vFzWX.png?s=128&g=1", "display_name": "Stefan", "link": "https://stackoverflow.com/users/2068635/stefan"}, "edited": false, "score": 0, "creation_date": 1427149655, "post_id": 29221486, "comment_id": 46652135, "body": "Are you sure that you are running the updated version?"}, {"owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "reply_to_user": {"reputation": 2340, "user_id": 2068635, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/vFzWX.png?s=128&g=1", "display_name": "Stefan", "link": "https://stackoverflow.com/users/2068635/stefan"}, "edited": false, "score": 0, "creation_date": 1427149805, "post_id": 29221486, "comment_id": 46652200, "body": "@Stefan, in fact according to <code>cabal --version</code> I&#39;m not running the updated version. How&#39;d that happen?"}], "answers": [{"tags": [], "owner": {"reputation": 2340, "user_id": 2068635, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/vFzWX.png?s=128&g=1", "display_name": "Stefan", "link": "https://stackoverflow.com/users/2068635/stefan"}, "is_accepted": true, "score": 2, "last_activity_date": 1427149985, "creation_date": 1427149985, "answer_id": 29221690, "question_id": 29221486, "link": "https://stackoverflow.com/questions/29221486/why-do-i-need-to-cabal-install-cabal-install-in-every-new-sandbox/29221690#29221690", "title": "Why do I need to cabal install cabal-install in every new sandbox?", "body": "<p>Installing <code>cabal</code> via <code>cabal install cabal-install</code> globally results in a new binary in your home folder in <code>~/.cabal</code>.</p>\n\n<p>As long as this path is not included in <code>$PATH</code>, the default installed <code>cabal</code> from e.g. <code>/usr/bin</code> will get executed, which will result in the warning of a new available version.</p>\n"}], "owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 29221690, "answer_count": 1, "score": 1, "last_activity_date": 1427149985, "creation_date": 1427148990, "question_id": 29221486, "link": "https://stackoverflow.com/questions/29221486/why-do-i-need-to-cabal-install-cabal-install-in-every-new-sandbox", "title": "Why do I need to cabal install cabal-install in every new sandbox?", "body": "<p>Every time I make a new cabal sandbox and run <code>cabal update</code> to get the latest package list, I'm prompted about the availability of a new version of cabal. So I install it in the sandbox using <code>cabal install cabal-install</code>.</p>\n\n<p>I think to myself, I should install this new version globally too, outside of the sandbox. So I leave the sandbox and <code>cabal install cabal-install</code> again.</p>\n\n<p>I expected that this would carry over to the next new sandbox, but it doesn't. Is there any way to make it carry over to save the time of reinstalling it in every new sandbox?</p>\n"}, {"tags": ["haskell", "infinite-loop"], "comments": [{"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 4, "creation_date": 1427146347, "post_id": 29220765, "comment_id": 46650538, "body": "<code>cyclicRotation = drop</code> ?"}, {"owner": {"reputation": 634, "user_id": 4697270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7884aed17ee40cfaae6b53e6966b29ea?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4697270/david"}, "reply_to_user": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1427146451, "post_id": 29220765, "comment_id": 46650601, "body": "@mkrieger1, I&#39;m sorry, but I don&#39;t understand your question."}, {"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1427146451, "post_id": 29220765, "comment_id": 46650600, "body": "in an infinite list, it makes no difference whether you append the dropped items to the end or not, since you will never reach them later"}, {"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 1, "creation_date": 1427146481, "post_id": 29220765, "comment_id": 46650609, "body": "I meant that you can just use <code>drop</code> as your <code>cyclicRotation</code> function"}, {"owner": {"reputation": 634, "user_id": 4697270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7884aed17ee40cfaae6b53e6966b29ea?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4697270/david"}, "reply_to_user": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1427146506, "post_id": 29220765, "comment_id": 46650627, "body": "@mkrieger1, yep, you are right. But how I can determine infinity loops?"}, {"owner": {"reputation": 634, "user_id": 4697270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7884aed17ee40cfaae6b53e6966b29ea?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4697270/david"}, "reply_to_user": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1427146523, "post_id": 29220765, "comment_id": 46650639, "body": "@mkrieger1, no, I don&#39;t. There are finite lists."}, {"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1427146603, "post_id": 29220765, "comment_id": 46650685, "body": "hmm you&#39;re right, <code>drop</code> doesn&#39;t rotate <i>finite</i> lists..."}, {"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1427146943, "post_id": 29220765, "comment_id": 46650885, "body": "what about <a href=\"http://stackoverflow.com/a/16379034/4621513\">this</a>"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 2, "creation_date": 1427147058, "post_id": 29220765, "comment_id": 46650938, "body": "@mkrieger1 I would say that question makes this one look like a duplicate... Would you agree David?  If so, I&#39;ll close this as a dup."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1427147135, "post_id": 29220765, "comment_id": 46650974, "body": "Your code would be more readable with less parentheses. And if you use <code>length ls</code> not just two but four times (length is inefficient anyway!), it&#39;s definitely worth binding that to a local variable. <code>cyclicRotation n ls = let l = length ls in drop (l - num`mod`l) ls ++ take (l - num `mod`l) ls</code>. ...now... what exactly is your question anyway?"}, {"owner": {"reputation": 634, "user_id": 4697270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7884aed17ee40cfaae6b53e6966b29ea?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4697270/david"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1427147295, "post_id": 29220765, "comment_id": 46651055, "body": "@leftaroundabout, my question is about working with infinity lists. My test is failed."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1427147545, "post_id": 29220765, "comment_id": 46651171, "body": "@David Using <code>length</code> means you can&#39;t use infinite lists.  There is no way to detect an infinite list in Haskell, so you should avoid trying to do that and instead work only with the elements you need to pull off the front and stick on the end.  A solution using <code>Data.List.splitAt</code> is <code>rotate n ls = let (first, rest) = splitAt n ls in rest ++ first</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1427147615, "post_id": 29220765, "comment_id": 46651203, "body": "Indeed, <code>length</code> is the problem. (Again, not <i>only</i> for infinite lists \u2013 even for long finite lists it is just slow and often not necessary at all.)"}, {"owner": {"reputation": 634, "user_id": 4697270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7884aed17ee40cfaae6b53e6966b29ea?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4697270/david"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1427147806, "post_id": 29220765, "comment_id": 46651300, "body": "@leftaroundabout, yep, as I understand, length has perform O(N)."}], "answers": [{"tags": [], "owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "is_accepted": true, "score": 4, "last_activity_date": 1427147363, "creation_date": 1427147363, "answer_id": 29221084, "question_id": 29220765, "link": "https://stackoverflow.com/questions/29220765/how-to-implement-rotate-function-on-infinite-lists/29221084#29221084", "title": "How to implement rotate function on infinite lists?", "body": "<p>In order to work with infinite list you need to avoid non-lazy evaluating functions on it (such as length). Simple example implementation would be:</p>\n\n<pre><code>rotate :: Int -&gt; [a] -&gt; [a]\nrotate _ [] = []\nrotate 0 list = list\nrotate n (x:xs) = rotate (n-1) (xs ++ [x])\n</code></pre>\n\n<p>Here the <code>(xs ++ [x])</code> will work even for infinite lists, since <code>++</code> is lazy.</p>\n"}], "owner": {"reputation": 634, "user_id": 4697270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7884aed17ee40cfaae6b53e6966b29ea?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4697270/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "closed_date": 1427161706, "accepted_answer_id": 29221084, "answer_count": 1, "score": 0, "last_activity_date": 1427147363, "creation_date": 1427146114, "question_id": 29220765, "link": "https://stackoverflow.com/questions/29220765/how-to-implement-rotate-function-on-infinite-lists", "closed_reason": "Duplicate", "title": "How to implement rotate function on infinite lists?", "body": "<p>I try to implement <code>rotate</code> function, which can work with infinite lists. I have problem with <code>infinite lists</code>. </p>\n\n<p>My function is:</p>\n\n<pre><code>cyclicRotation:: Int -&gt; [a] -&gt; [a]\ncyclicRotation num ls = (drop ((length ls) - (mod num (length ls)))  ls) ++ ( take ((length ls) -(mod num (length ls))) ls)\n</code></pre>\n\n<p>I try use my function as:</p>\n\n<pre><code>take 2 (cyclicRotation 9 [1..])\n</code></pre>\n\n<p>And I want to get <code>[10, 11]</code>. </p>\n"}, {"tags": ["haskell", "lambda", "lambda-calculus"], "answers": [{"tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 3, "last_activity_date": 1427142540, "creation_date": 1427142540, "answer_id": 29219746, "question_id": 29219521, "link": "https://stackoverflow.com/questions/29219521/reading-a-lambda-terms-in-haskell/29219746#29219746", "title": "reading a lambda terms in Haskell", "body": "<p><code>read</code> throws an error if the second element in the tuple from <code>readsPrec</code> is nonempty. That second element represents the rest of the <code>String</code>, after what was parsed. </p>\n"}], "owner": {"reputation": 187, "user_id": 2302260, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8f97ff66bdfe5674beb4b843bdea852d?s=128&d=identicon&r=PG", "display_name": "EdZhavoronkov", "link": "https://stackoverflow.com/users/2302260/edzhavoronkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1427207002, "creation_date": 1427141770, "last_edit_date": 1427207002, "question_id": 29219521, "link": "https://stackoverflow.com/questions/29219521/reading-a-lambda-terms-in-haskell", "title": "reading a lambda terms in Haskell", "body": "<p>I have a lambda terms defined as follows:</p>\n\n<pre><code>type Symb = String\n\ninfixl 2 :@\n\ndata Expr = Var Symb\n        | Expr :@ Expr\n        | Lam Symb Expr\n        deriving Eq\n</code></pre>\n\n<p>And i need to write instances for <code>Read</code> and <code>Show</code> typeclasses, so that lambda-term will be shown as a valid term in Haskell syntax. </p>\n\n<p>I' ve done <code>Show</code> and it seems pretty easy. but i have some troubles in <code>Read</code> class.</p>\n\n<p>I wrote something like this, as a test</p>\n\n<pre><code>instance Read Expr where\n   readsPrec _ = myReadsExpr\n\nmyReadsExpr :: ReadS Expr\nmyReadsExpr s = [(Lam \"x\" (Var \"x\"), b) | (a, b) &lt;- lex s]\n</code></pre>\n\n<p>but in ghci i have </p>\n\n<pre><code>*Fp06&gt; myReadsExpr \"\\\\x -&gt; x\"\n[(\\x -&gt; x,\"x -&gt; x\")]\n</code></pre>\n\n<p>And it's ok, but when i do </p>\n\n<pre><code>*Fp06&gt; read \"\\\\x -&gt; x\" :: Expr\n</code></pre>\n\n<p>I get exception</p>\n\n<pre><code>*Fp06&gt; read \"\\\\x -&gt; x\" :: Expr\n*** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>Can you please tell me, what am i doing wrong? Thank you in advance! </p>\n\n<p>UPD: Can you also help me with further implementation? I need to parse them in my type so term <code>\\\\x y z -&gt; x (y z)</code> will be parsed in <code>Lam \"x\" (Lam \"y\" Lam \"z\" (Var \"x\" :@ (Var \"y\" :@ Var \"z\")))</code></p>\n\n<p>I do not understand, how to handle brackets, and how to parse the term. Right now i have <code>Read</code> implemented this way:</p>\n\n<pre><code>myReadsExpr :: ReadS Expr\nmyReadsExpr s = \n[(Lam var expr, thunk2) |   (\"\\\\\", rest)    &lt;- lex s,\n                            (var, thunk)    &lt;- lex rest,\n                            (\"-&gt;\", thunk1)  &lt;- lex thunk,\n                            (expr, thunk2)  &lt;- myReadsExpr thunk1]\n++\n[(Var sym, t)           |   (sym, t)        &lt;- reads s]\n++\n[(Var x :@ Var y, t1)   |   (x, t)          &lt;- lex s,\n                            (y, t1)         &lt;- lex t] \n</code></pre>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 11, "creation_date": 1427127836, "post_id": 29215111, "comment_id": 46639922, "body": "You have to operate on graphs to understand sharing.  Doing it on linear formulas is confusing."}], "answers": [{"comments": [{"owner": {"reputation": 3637, "user_id": 797637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1577f43a7c6eb01836e1758a2ba4df5?s=128&d=identicon&r=PG&f=1", "display_name": "firefrorefiddle", "link": "https://stackoverflow.com/users/797637/firefrorefiddle"}, "edited": false, "score": 1, "creation_date": 1427183730, "post_id": 29215881, "comment_id": 46661936, "body": "Thank for your great answer too! It helped me a lot. Had a hard time picking which one to accept."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 13, "last_activity_date": 1427130884, "last_edit_date": 1427130884, "creation_date": 1427129668, "answer_id": 29215881, "question_id": 29215111, "link": "https://stackoverflow.com/questions/29215111/understanding-structure-sharing-in-haskell/29215881#29215881", "title": "Understanding Structure Sharing in Haskell", "body": "<p>Loosely speaking: you are allowed to pretend, in the definition of <code>ns</code>, that <code>ns</code> has been evaluated completely. So what we actually get is, essentially,</p>\n\n<pre><code>successors n = let ns = n : map (+1) [n,n+1,n+2,n+3,n+4,...]\n</code></pre>\n\n<p>You only need to count the cost of this one <code>map</code>.</p>\n\n<p>Let's think about this operationally.</p>\n\n<pre><code>ns = n : map (+1) ns\n</code></pre>\n\n<p>What does this <em>do</em>? Well, it allocates a bit of memory to hold <code>ns</code>, and stores in it a <code>(:)</code> constructor that points to the value <code>n</code> and to a \"thunk\" representing <code>map (+1) ns</code>. But that thunk represents <code>ns</code> as a pointer to that very same bit of memory holding <code>ns</code>! So we actually have a circular structure in memory. When we ask for the second element of <code>ns</code>, that thunk is forced. This involves accessing <code>ns</code>, but the portion accessed has already been calculated. It doesn't need to be calculated again. The effect of this forcing is to replace <code>map (+1) ns</code> with <code>n+1:map (+1) ns'</code>, where <code>ns'</code> is a pointer to the (now-known) second element of <code>ns</code>. So as we proceed, we build a list whose last piece is always a little circular bit.</p>\n"}, {"comments": [{"owner": {"reputation": 3637, "user_id": 797637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1577f43a7c6eb01836e1758a2ba4df5?s=128&d=identicon&r=PG&f=1", "display_name": "firefrorefiddle", "link": "https://stackoverflow.com/users/797637/firefrorefiddle"}, "edited": false, "score": 1, "creation_date": 1427183698, "post_id": 29216309, "comment_id": 46661924, "body": "Thank you! I guess I understand it now!"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 10, "last_activity_date": 1427153695, "last_edit_date": 1427153695, "creation_date": 1427130942, "answer_id": 29216309, "question_id": 29215111, "link": "https://stackoverflow.com/questions/29215111/understanding-structure-sharing-in-haskell/29216309#29216309", "title": "Understanding Structure Sharing in Haskell", "body": "<p>To understand this, we need the definition of <code>map</code></p>\n\n<pre><code>map _ []     = []\nmap f (x:xs) = f x : map f xs\n</code></pre>\n\n<p>We will compute <code>successors 0</code>, pretending the spine of the resulting list is being forced as we compute it. We'll start by binding <code>n</code> to <code>0</code>.</p>\n\n<pre><code>successors 0 = let ns = 0 : map (+1) ns \n               in ns\n</code></pre>\n\n<p>Everywhere we hold on to the result of a computation - in a (non-strict) field of a constructor or a <code>let</code> or <code>where</code> binding, we are actually storing a thunk that will take on the value of the result of the computation when the thunk is evaluated. We can represent this placeholder in code by introducing a new variable name. For the eventual result of <code>map (+1) ns</code> being placed in the tail of the <code>:</code> constructor we'll introduce a new variable called <code>ns0</code>.</p>\n\n<pre><code>successors 0 = let ns = 0 : ns0 where ns0 = map (+1) ns \n               in ns\n</code></pre>\n\n<h3>The first expansion</h3>\n\n<p>Now let's expand</p>\n\n<pre><code>map (+1) ns\n</code></pre>\n\n<p>Using the definition of <code>map</code>. We know from  the <code>let</code> binding we just wrote that:</p>\n\n<pre><code>ns = 0 : ns0 where ns0 = map (+1) ns\n</code></pre>\n\n<p>Therefore</p>\n\n<pre><code>map (+1) (0 : ns0) = 0 + 1 : map (+1) ns0\n</code></pre>\n\n<p>When the second item is forced we have:</p>\n\n<pre><code>successors 0 = let ns = 0 : ns0 where ns0 = 0 + 1 : map (+1) ns0\n               in ns\n</code></pre>\n\n<p>We don't need the <code>ns</code> variable anymore, so we'll remove it to clean this up.</p>\n\n<pre><code>successors 0 = 0 : ns0 where ns0 = 0 + 1 : map (+1) ns0\n</code></pre>\n\n<p>We'll introduce new variable names <code>n1</code> and <code>ns1</code> for the computations <code>0 + 1</code> and  <code>map (+1) ns0</code>, the arguments to the rightmost <code>:</code> constructor.</p>\n\n<pre><code>successors 0 = 0 : ns0\n                   where\n                       ns0 = n1    : ns1\n                       n1  = 0 + 1\n                       ns1 =         map (+1) ns0\n</code></pre>\n\n<h3>The second expansion</h3>\n\n<p>We expand <code>map (+1) ns0</code>.</p>\n\n<pre><code>map (+1) (n1 : ns1) = n1 + 1 : map (+1) ns1\n</code></pre>\n\n<p>After the third item in the list's spine (but not yet its value) is forced, we have:</p>\n\n<pre><code>successors 0 = 0 : ns0\n                   where\n                       ns0 = n1    : ns1\n                       n1  = 0 + 1\n                       ns1 =         n1 + 1 : map (+1) ns1\n</code></pre>\n\n<p>We don't need the <code>ns0</code> variable anymore, so we'll remove it to clean this up.</p>\n\n<pre><code>successors 0 = 0 : n1 : ns1\n                   where\n                       n1  = 0 + 1\n                       ns1 = n1 + 1 : map (+1) ns1\n</code></pre>\n\n<p>We'll introduce new variable names <code>n2</code> and <code>ns2</code> for the computations <code>n1 + 1</code> and  <code>map (+1) ns1</code>, the arguments to the rightmost <code>:</code> constructor.</p>\n\n<pre><code>successors 0 = 0 : n1 : ns1\n                   where\n                       n1  = 0 + 1\n                       ns1 = n2     : ns2\n                       n2  = n1 + 1\n                       ns2 =          map (+1) ns1\n</code></pre>\n\n<h3>The third expansion</h3>\n\n<p>If we repeat the steps from the previous section again we have</p>\n\n<pre><code>successors 0 = 0 : n1 : n2 : ns2\n                   where\n                       n1  = 0 + 1\n                       n2  = n1 + 1\n                       ns2 = n3     : ns3\n                       n3  = n2 + 1\n                       ns3 =          map (+1) ns2\n</code></pre>\n\n<p>This is clearly growing linearly in the spine of the list and linearly in the thunks to calculate the values held in the list. As dfeuer describes, we are only ever dealing with the \"little circular bit\" at the <em>end</em> of the list.</p>\n\n<p>If we force any of the values held in the list, all of the remaining thunks that refer to it will now refer to the already computed value. For example, if we force <code>n2 = n1 + 1</code> it will force <code>n1 = 0 + 1 = 1</code>, and <code>n2 = 1 + 1 = 2</code>. The list will look like </p>\n\n<pre><code>successors 0 = 0 : n1 : n2 : ns2\n                   where\n                       n1  = 1           -- just forced\n                       n2  = 2           -- just forced\n                       ns2 = n3     : ns3\n                       n3  = n2 + 1\n                       ns3 =          map (+1) ns2\n</code></pre>\n\n<p>And we've only done two additions. The additions to count up to 2 will never be done again because the result of the computation is shared. We can (for free) replace <em>all</em> of the <code>n1</code>s and <code>n2</code>s with the just computed values, and forget about those variable names.</p>\n\n<pre><code>successors 0 = 0 : 1 : 2 : ns2\n                   where\n                       ns2 = n3   : ns3\n                       n3  = 2 + 1       -- n3 will reuse n2\n                       ns3 =        map (+1) ns2\n</code></pre>\n\n<p>When <code>n3</code> is forced it will use the result of <code>n2</code> that is already known (<code>2</code>), and those first two additions will never be done again.</p>\n"}], "owner": {"reputation": 3637, "user_id": 797637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1577f43a7c6eb01836e1758a2ba4df5?s=128&d=identicon&r=PG&f=1", "display_name": "firefrorefiddle", "link": "https://stackoverflow.com/users/797637/firefrorefiddle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 532, "favorite_count": 4, "accepted_answer_id": 29216309, "answer_count": 2, "score": 11, "last_activity_date": 1427153695, "creation_date": 1427127271, "question_id": 29215111, "link": "https://stackoverflow.com/questions/29215111/understanding-structure-sharing-in-haskell", "title": "Understanding Structure Sharing in Haskell", "body": "<p>In the paper \"Plugging a Space Leak with an Arrow\" by Liu and Hudak, it is claimed that this leads to O(n^2) runtime behaviour (for computing the nth term):</p>\n\n<pre><code> successors n = n : map (+1) (successors n)\n</code></pre>\n\n<p>, while this gives us linear time:</p>\n\n<pre><code>successors n = let ns = n : map (+1) ns\n               in ns\n</code></pre>\n\n<p>. This statement is certainly correct, as I can verify it easily with GHCi. However, I can't seem to understand why exactly, and how structure sharing helps in this case. I even tried to write out both expansions for computing the third term. </p>\n\n<p>Here is my try for the first variant:</p>\n\n<pre><code>successors 1 !! 2\n(1 : (map (+1) (successors 1))) !! 2\n     (map (+1) (successors 1)) !! 1\n     (map (+1) (1 : map (+1) (successors 1))) !! 1\n     2 : (map (+1) (map (+1) (successors 1))) !! 1\n         (map (+1) (map (+1) (successors 1))) !! 0\n         (map (+1) (map (+1) (1 : map (+1) (successors 1)))) !! 0\n         (map (+1) (2 : map (+1) (map (+1) (successors 1)))) !! 0\n         3 : map (+1) (map (+1) (map (+1) (successors 1))) !! 0\n         3\n</code></pre>\n\n<p>and the second:</p>\n\n<pre><code>successors 1 !! 2\n(let ns = 1 : map (+1) ns in ns) !! 2\n(1 : map (+1) ns) !! 2\n     map (+1) ns !! 1\n     map (+1) (1 : map (+1) ns) !! 1\n     2 : map (+1) (map (+1) ns) !! 1\n         map (+1) (map (+1) ns) !! 0\n         map (+1) (map (+1) (1 : map (+1) ns)) !! 0\n         map (+1) (2 : map (+1) (map (+1) ns)) !! 0\n         3 : map (+1) (map (+1) (map (+1) ns)) !! 0\n         3\n</code></pre>\n\n<p>As you see, my expansions look almost exactly the same and seem to suggest quadratic behaviour for both. Somehow structure sharing sets in in the latter definition and reuses earlier results, but it looks magical. Can anyone elaborate?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 2, "creation_date": 1427121211, "post_id": 29213313, "comment_id": 46636016, "body": "Don&#39;t ask questions like &quot;Has anybody gone through this book with ghc?&quot;  The answer is almost certainly yes.  Ask a different, more specific question, and <i>ask it on Stack Overflow.</i>"}, {"owner": {"reputation": 54872, "user_id": 1521179, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/MH7pk.png?s=128&g=1", "display_name": "amon", "link": "https://stackoverflow.com/users/1521179/amon"}, "edited": false, "score": 4, "creation_date": 1427121862, "post_id": 29213313, "comment_id": 46636017, "body": "You really need to state whether that error message is relevant or not \u2013 are you sure you meant <code>foldll</code> with a lower-case L at the end rather than <code>foldl1</code> with the trailing number one? If so, where did you define that function, and how did you load that code? If not, simply fix your mistake."}], "answers": [{"tags": [], "owner": {"reputation": 42360, "user_id": 389146, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/zGYUq.jpg?s=128&g=1", "display_name": "Karl Bielefeldt", "link": "https://stackoverflow.com/users/389146/karl-bielefeldt"}, "is_accepted": true, "score": 4, "last_activity_date": 1427124040, "creation_date": 1427124040, "answer_id": 29213956, "question_id": 29213313, "link": "https://stackoverflow.com/questions/29213313/haskell-the-implementation-of-functional-languages-book/29213956#29213956", "title": "Haskell &amp; The Implementation of Functional Languages book", "body": "<p>Look at Appendix A.5, which defines a number of functions to avoid compatibility problems with changing versions.  From that appendix:</p>\n\n<p><img src=\"https://i.stack.imgur.com/uxzaj.png\" alt=\"screenshot from appendix\"></p>\n\n<p>Also, that book was written with examples in Miranda, not Haskell.  You might find several cases with small incompatibilities where you need a deeper understanding than just copying and pasting.</p>\n"}], "migrated_from": {"other_site": {"aliases": ["http://programmer.stackexchange.com", "http://programmers.stackexchange.com"], "markdown_extensions": ["Prettify"], "launch_date": 1292524346, "open_beta_date": 1283972400, "closed_beta_date": 1283367600, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/softwareengineering/Img/apple-touch-icon@2.png", "twitter_account": "StackSoftEng", "favicon_url": "https://cdn.sstatic.net/Sites/softwareengineering/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/softwareengineering/Img/apple-touch-icon.png", "audience": "professionals, academics, and students working within the systems development life cycle", "site_url": "https://softwareengineering.stackexchange.com", "api_site_parameter": "softwareengineering", "logo_url": "https://cdn.sstatic.net/Sites/softwareengineering/Img/logo.png", "name": "Software Engineering", "site_type": "main_site"}, "on_date": 1427122270, "question_id": 277131}, "owner": {"reputation": 11, "user_id": 4703486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/285147ede67e15dc4a1016bf1651d4c9?s=128&d=identicon&r=PG&f=1", "display_name": "logic_programmer", "link": "https://stackoverflow.com/users/4703486/logic-programmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 29213956, "answer_count": 1, "score": 0, "last_activity_date": 1427124040, "creation_date": 1427121123, "question_id": 29213313, "link": "https://stackoverflow.com/questions/29213313/haskell-the-implementation-of-functional-languages-book", "title": "Haskell &amp; The Implementation of Functional Languages book", "body": "<p>I'm having trouble executing the chapters of the book <em>Implementing Functional Languages: a tutorial</em> by Simon L Peyton Jones and David R Lester.</p>\n\n<p>I'm using ghc on OSX and I'm using make to generate the input, e.g. \"make language.lhs\" and \"make utils.lhs\".  </p>\n\n<pre><code>peano:pj-lester-book bwat$ make utils.lhs\ncat utils.src | ./make-version 1 G &gt;utils.lhs\npeano:pj-lester-book bwat$ make language.lhs\nmake: *** No rule to make target `language-tutor.src', needed by `language.lhs'.    Stop.\npeano:pj-lester-book bwat$ touch language-tutor.src\npeano:pj-lester-book bwat$ make language.lhs\ncat language.src language-tutor.src | ./make-version 3 G &gt; language.lhs\npeano:pj-lester-book bwat$ ghci\nGHCi, version 7.8.4: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\nPrelude&gt; :load language\n[1 of 1] Compiling Main             ( language.lhs, interpreted )\n\nlanguage.lhs:708:23:\n    Not in scope: \u2018foldll\u2019\n    Perhaps you meant one of these:\n      \u2018foldl1\u2019 (imported from Prelude), \u2018foldl\u2019 (imported from Prelude),\n      \u2018foldr\u2019 (imported from Prelude)\n\n[Other similar errors deleted to save space]\n</code></pre>\n\n<p>Has anybody gone through this book with ghc? </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 4, "last_activity_date": 1427127535, "last_edit_date": 1427127535, "creation_date": 1427122075, "answer_id": 29213253, "question_id": 29212669, "link": "https://stackoverflow.com/questions/29212669/count-occurrence-of-any-element-in-haskell-list-and-return-max-sequence-using-wo/29213253#29213253", "title": "Count occurrence of any element in Haskell list and return max sequence using worker pattern", "body": "<p>You can generalize the function to work on any type that supports equality testing (is an instance of <code>Eq</code>) and thus you don't have to worry about the number of different constructors.</p>\n\n<pre><code>maxSeq :: Eq a =&gt; [a] -&gt; Int\nmaxSeq [] = 0\nmaxSeq (x:xs) = go 1 1 x xs where\n    go longest current _ [] = max longest current\n    go longest current prev (x:xs)\n        | x == prev = go longest (current + 1) prev xs\n        | otherwise = go (max longest current) 1 x xs\n</code></pre>\n\n<p>The <code>longest</code> parameter keeps track of the longest sequence we've encountered so far (regardless of value), <code>current</code> holds the length of the current sequence and <code>prev</code> is the value of the previous element so that we can check if the current sequence continues or not.</p>\n\n<p>However, the recommended approach is not to use a worker function but to compose existing standard library functionality:</p>\n\n<pre><code>import Data.List (group)\n\nmaxSeq :: Eq a =&gt; [a] -&gt; Int\nmaxSeq = maximum . map length . group\n</code></pre>\n\n<p>This groups sequential elements based on equality, calculates the length of each group and the picks the maximum length.</p>\n"}], "owner": {"reputation": 309, "user_id": 3320256, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/NZCl4.png?s=128&g=1", "display_name": "daniel.kahlenberg", "link": "https://stackoverflow.com/users/3320256/daniel-kahlenberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 685, "favorite_count": 0, "accepted_answer_id": 29213253, "answer_count": 1, "score": 0, "last_activity_date": 1427127535, "creation_date": 1427120493, "last_edit_date": 1495540250, "question_id": 29212669, "link": "https://stackoverflow.com/questions/29212669/count-occurrence-of-any-element-in-haskell-list-and-return-max-sequence-using-wo", "title": "Count occurrence of any element in Haskell list and return max sequence using worker pattern", "body": "<p>As a follow-up question to <a href=\"https://stackoverflow.com/q/29141786/3320256\">Count occurrence of an element in Haskell list and return max sequence</a> I\nplayed around with one of the <a href=\"https://stackoverflow.com/a/29142841/3320256\">given solutions</a> \nand came up with an extension to the original question:\nwould it be possible to determine the longest sequence\nof any be it either <code>Vanilla</code> or <code>Choco</code> whatsoever <code>Elem</code> using the\n<a href=\"https://wiki.haskell.org/Worker_wrapper\" rel=\"nofollow noreferrer\">worker pattern</a>.</p>\n\n<p>The only possibility I could come up so far is for the given two Elem data types but what I am interested in is one for arbitrary number of different types (in the example i. e. <code>Strawberries</code> etc).</p>\n\n<pre><code>data Elem = Vanilla | Choco deriving (Eq, Show)\nmaxStarSeq :: [Elem] -&gt; Int\nmaxStarSeq xs = aux xs 0 0 0 0\n    where aux [] acc prev bcc prev2 = max acc $ max prev $ max bcc prev2\n          aux (Vanilla:xs) acc prev bcc prev2 = aux xs (max acc prev) 0 bcc (prev2 + 1)\n          aux (Choco:xs) acc prev bcc prev2 = aux xs acc (prev + 1) (max bcc prev2) 0\n</code></pre>\n"}, {"tags": ["haskell", "testing", "quickcheck"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1427126180, "post_id": 29211513, "comment_id": 46638803, "body": "You can generate the trees by arbitrary operations on the tree. This  only requires an <code>Arbitrary</code> instance for <code>a</code> and doesn&#39;t require access to the implementation of those operations."}], "answers": [{"comments": [{"owner": {"reputation": 1778, "user_id": 117220, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6c5b9841f23e69b08f121b06df6ed1c8?s=128&d=identicon&r=PG", "display_name": "Petr Gladkikh", "link": "https://stackoverflow.com/users/117220/petr-gladkikh"}, "edited": false, "score": 0, "creation_date": 1427199482, "post_id": 29217135, "comment_id": 46670906, "body": "I see that suchThat is not very effective since it tries all available values until finds suitable one. That seems the cost of removing assumptions, acceptable for tests though."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 4, "last_activity_date": 1427133400, "creation_date": 1427133400, "answer_id": 29217135, "question_id": 29211513, "link": "https://stackoverflow.com/questions/29211513/minimal-restrictions-to-generate-arbitrary-in-range/29217135#29217135", "title": "Minimal restrictions to generate Arbitrary in range", "body": "<p>Since you want arbitrary <em>ordered</em> trees, there is no way to get rid of the <code>Ord a</code> constraint in the <code>Arbitrary (Tree a)</code> instance. However, you don't need <code>Enum</code> or <code>Random</code> (recall that <code>Arbitrary</code> is doing random value generation - so naturally you shouldn't need Random as well). </p>\n\n<p>Here is how I would implement the Arbitrary instance.</p>\n\n<pre><code>import Test.QuickCheck.Gen\nimport Test.QuickCheck\n\narbitraryTree :: (Ord a, Arbitrary a) =&gt; Gen (Tree a)\narbitraryTree = do \n  x &lt;- arbitrary \n  y &lt;- suchThat arbitrary (&gt;= x) \n  go x y \n   where \n    go mn mx = frequency [(1, return Leaf), (1, arbNode)] where\n\n      arbNode = do \n        a &lt;- suchThat arbitrary (\\x -&gt; x &gt;= mn &amp;&amp; x &lt;= mx)\n        l &lt;- go mn a\n        r &lt;- go a mx \n        return (Node l a r) \n\ninstance (Ord a, Arbitrary a) =&gt; Arbitrary (Tree a) where \n  arbitrary = arbitraryTree \n</code></pre>\n\n<p>Note that you could make this more reliable by using <code>suchThatMaybe</code> and supplying a default value if no suitable value in the range can be found within a certain amount of tries.</p>\n\n<p>As for your second question, you can indeed have the following instances:</p>\n\n<pre><code>{-# LANGUAGE OverlappingInstances, FlexibleInstances #-}\n\ninstance Arbitrary (Tree a)\ninstance Arbitrary (Tree Int)\n</code></pre>\n\n<p>and the compiler will select the <code>Tree a</code> instance only if <code>a</code> is not <code>Int</code>. However, I would advise against this - if you are mainly interested in testing <code>Tree Int</code> or even a small set of <code>Tree</code> types, just have instances for those types - no general instance for <code>Tree a</code>. </p>\n\n<hr>\n\n<p>As an aside, the generator I gave above is not very good - it generates a <code>Leaf</code> exactly half the time. In principle, I would like a generator for a type like this to always generate \"medium\" sized trees. A simple way to implement this is to have a high probability of generating a <code>Node</code> initially, and decrease that probability steadily as the tree grows:</p>\n\n<pre><code>arbitraryTree :: (Ord a, Arbitrary a) =&gt; Float -&gt; Float -&gt; Gen (Tree a)\narbitraryTree c' f = do \n  x &lt;- arbitrary \n  y &lt;- suchThat arbitrary (&gt;= x) \n  go x y c' \n   where \n    go mn mx c = frequency [(1000-q, return Leaf), (q, arbNode)] where\n      q = round (1000 * c)\n\n      arbNode = do \n        a &lt;- suchThat arbitrary (\\x -&gt; x &gt;= mn &amp;&amp; x &lt;= mx)\n        l &lt;- go mn a (c * f) \n        r &lt;- go a mx (c * f) \n        return (Node l a r) \n\ninstance (Ord a, Arbitrary a) =&gt; Arbitrary (Tree a) where \n  arbitrary = arbitraryTree 0.9 0.9 \n</code></pre>\n\n<p>You can play around with the parameters to <code>arbitraryTree</code> to get trees that you like. </p>\n"}], "owner": {"reputation": 1778, "user_id": 117220, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6c5b9841f23e69b08f121b06df6ed1c8?s=128&d=identicon&r=PG", "display_name": "Petr Gladkikh", "link": "https://stackoverflow.com/users/117220/petr-gladkikh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 351, "favorite_count": 0, "accepted_answer_id": 29217135, "answer_count": 1, "score": 2, "last_activity_date": 1427133400, "creation_date": 1427117369, "question_id": 29211513, "link": "https://stackoverflow.com/questions/29211513/minimal-restrictions-to-generate-arbitrary-in-range", "title": "Minimal restrictions to generate Arbitrary in range", "body": "<p>I would like to generate Arbitrary value for ordered tree-like structure whose type is, say  </p>\n\n<pre><code>data Tree a = Leaf | Node (Tree a) a (Tree a)\n</code></pre>\n\n<p>A function that inserts value into this tree while keeping it ordered would require that value should be Ord. But to generate ordered Trees for Arbitrary instance I would need to generate value in range \"[low,hi]\" and Ord is insufficient for that. So I also required that value is Enum since Enum allows getting  values from given boundary. The <code>choose</code> below also requires  System.Random.Random:</p>\n\n<pre><code>import Test.QuickCheck.Arbitrary\nimport System.Random\n\ngenerateTree :: (Arbitrary a, Ord a, Enum a, Random a) =&gt; a -&gt; a -&gt; Gen (Tree a)\ngenerateTree l u = do\n  genLeaf &lt;- arbitrary\n  if genLeaf\n    then return Leaf\n    else do\n      x &lt;- choose (l, u)\n      left &lt;- generateTree l (pred x)\n      right &lt;- generateTree (succ x) u\n      return $ Node left x right\n</code></pre>\n\n<p>So to use this for <code>arbitrary</code> implementation I should require the same classes in Arbitrary class: </p>\n\n<pre><code>instance (Arbitrary a, Ord a, Enum a, Rand.Random a) =&gt; Arbitrary (Tree a) where\n  arbitrary = do\n    l &lt;- arbitrary\n    u &lt;- arbitrary\n    generateTree l u\n</code></pre>\n\n<p>Here, while requirement <code>Ord a =&gt; Tree a</code> is enough for data structure itself, I require <code>(Arbitrary a, Ord a, Enum a, Rand.Random a) =&gt; Tree a</code> for it's generator. It looks like leaking implementation details into declaration - probably I look at this wrong way, I am learning Haskell. But still there are questions: </p>\n\n<ol>\n<li>Is there a way to declare more generic generator that does not have as much requirements? </li>\n<li>Is there a way to declare other instance for <code>Arbitrary (Tree a)</code> along with one above that would have different set of requirements, something like <code>Arbitrary (Tree Int)</code> that would be used for <code>Int</code>s only?</li>\n</ol>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1427115682, "post_id": 29210775, "comment_id": 46631404, "body": "I daresay it&#39;s good practise to just write out the signature and an <code>= undefined</code> for such functions... but, good question, I&#39;ve also sometimes wanted that for ideas so weird I&#39;m not sure it&#39;s worth trying to get them to type-check, since it might not even parse."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1427116329, "post_id": 29210775, "comment_id": 46631856, "body": "Another way just to check if it is correct syntax is to use something like <code>pointfree</code> and check for &quot;Parse error: EOF&quot;, but this makes it difficult to do anything more than a single-line expression."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1427116384, "post_id": 29210775, "comment_id": 46631889, "body": "@leftaroundabout In my case, I&#39;m building a parser. That means there&#39;s <i>hundreds</i> of non-existent identifiers, all of which should be parsers. When I eventually finish writing all the pieces, it should work. But it would be nice to catch syntax errors before I get to the end..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1427118349, "post_id": 29210775, "comment_id": 46633196, "body": "I&#39;ll secon @leftaroundabout&#39;s type signature+undefined approach. I use that all the time. If you want, you can even skip the type signature, leaving the variables fully polymorphic, but the more type signatures you can add, the better your type error messages are likely to be."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1427139275, "post_id": 29210775, "comment_id": 46646632, "body": "@leftaroundabout I am assuming OP really meant &quot;syntax and type check&quot;. If you really want just a syntax check, you don&#39;t need to define everything - getting out of scope errors means the module had to parse correctly first."}], "answers": [{"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1427117272, "post_id": 29211043, "comment_id": 46632506, "body": "So you&#39;re saying if I just start all identifiers with an underscore and turn on <code>-fdefer-type-errors</code>, I&#39;ll get roughly the behaviour I want?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1427117642, "post_id": 29211043, "comment_id": 46632728, "body": "@MathematicalOrchid More or less, if I&#39;m understanding what you want.  Your identifiers just have to start with <code>_</code> to make it a hole, GHC infers the type of that hole, GHC normally would emit a compile error for it but <code>-fdefer-type-errors</code> turns those into warnings so you can even run your program up to the point that a hole appears, so <code>let f = putStrLn &quot;test&quot; &gt;&gt; _foo; f</code> will print <code>test</code> then show an exception containing the exact error message you would have gotten at compile time without <code>-fdefer-type-errors</code>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1427118842, "post_id": 29211043, "comment_id": 46633516, "body": "@MathematicalOrchid As dfeuer and leftaroundabout have pointed out, defining them with type signatures and <code>undefined</code> doesn&#39;t require any extra flags to compile and will improve error messages as well as ensuring that your expressions have the desired types instead of whatever is required just to make it typecheck.  I imagine you could write a plugin for &lt;editor&gt; that could extract a named hole out of an expression with <code>error &quot;hole name&quot;</code> and the inferred type signature, then factoring the holes out would be a breeze with an &quot;extract all&quot; command."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 11, "last_activity_date": 1427115992, "creation_date": 1427115992, "answer_id": 29211043, "question_id": 29210775, "link": "https://stackoverflow.com/questions/29210775/make-ghc-ignore-not-in-scope-errors/29211043#29211043", "title": "Make GHC ignore not-in-scope errors", "body": "<p>Use named <code>TypedHoles</code>:</p>\n\n<pre><code>&gt; let f x = _g . _h x $ x\n    Found hole \u2018_g\u2019 with type: b0 -&gt; c\n    Where: \u2018b0\u2019 is an ambiguous type variable\n           \u2018c\u2019 is a rigid type variable bound by\n               the inferred type of f :: s -&gt; c at &lt;interactive&gt;:2:5\n    Relevant bindings include\n      x :: s (bound at &lt;interactive&gt;:2:7)\n      f :: s -&gt; c (bound at &lt;interactive&gt;:2:5)\n    In the first argument of \u2018(.)\u2019, namely \u2018_g\u2019\n    In the expression: _g . _h x\n    In the expression: _g . _h x $ x\n\n    Found hole \u2018_h\u2019 with type: s -&gt; s -&gt; b0\n    Where: \u2018b0\u2019 is an ambiguous type variable\n           \u2018s\u2019 is a rigid type variable bound by\n               the inferred type of f :: s -&gt; c at &lt;interactive&gt;:2:5\n    Relevant bindings include\n      x :: s (bound at &lt;interactive&gt;:2:7)\n      f :: s -&gt; c (bound at &lt;interactive&gt;:2:5)\n    In the expression: _h\n    In the second argument of \u2018(.)\u2019, namely \u2018_h x\u2019\n    In the expression: _g . _h x\n</code></pre>\n\n<p>So this gives you that <code>_g :: b0 -&gt; c</code> and <code>_h :: s -&gt; s -&gt; b0</code> with the context of <code>x :: s</code> and <code>f :: s -&gt; c</code>.  The type-checker can infer these types most of the time (this is the point of <code>TypedHoles</code>), and you can give them names.  If you want, you can define all your functions with a <code>_</code> as the first character of the symbol name, then later use your editor to replace <code>_(.+)\\b</code> with <code>\\1</code>.  If you want to work around the lens convention of using <code>_name</code> for a record field then just put 2 underscores on your hole name.</p>\n\n<p>This will still keep your code from compiling though, but if you use this in combination with <code>-fdefer-type-errors</code> they'll be reported as warnings instead, allowing your type errors to occur at runtime.</p>\n"}, {"tags": [], "owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "is_accepted": false, "score": 3, "last_activity_date": 1427139559, "last_edit_date": 1427139559, "creation_date": 1427123249, "answer_id": 29213665, "question_id": 29210775, "link": "https://stackoverflow.com/questions/29210775/make-ghc-ignore-not-in-scope-errors/29213665#29213665", "title": "Make GHC ignore not-in-scope errors", "body": "<p>My usual approach is to define missing functions or values as <code>undefined</code>. It's easy to define and leaves you with a convenient marker that the function in question isn't defined yet.</p>\n\n<p>I'm aware that this doesn't answer the OP's question, since the functions still have to be defined by hand, but I thought it could be useful anyway.</p>\n"}], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 29211043, "answer_count": 2, "score": 6, "last_activity_date": 1427139559, "creation_date": 1427115273, "question_id": 29210775, "link": "https://stackoverflow.com/questions/29210775/make-ghc-ignore-not-in-scope-errors", "title": "Make GHC ignore not-in-scope errors", "body": "<p>I'm building a module where every time I write a function, it calls a dozen other functions that don't exist yet. Obviously they'll exist eventually, but it would be nice to be able to do a syntax check before I've finished writing the code.</p>\n\n<p>Is there some combination of flags I can use to make GHC emit warnings rather than errors for \"name <code>foo</code> is not in scope\"?</p>\n\n<p>(It would be nice actually if GHC could just pick a type signature for the non-existent names, and confirm that it's still possible for the program to type-check. This is <em>nearly</em> what the \"type holes\" feature does &mdash; but to use that, you still have to manually <em>define</em> all the identifiers.)</p>\n"}, {"tags": ["haskell", "types", "polymorphism"], "answers": [{"comments": [{"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1427159085, "post_id": 29210694, "comment_id": 46655094, "body": "Thanks! That made sense, but could you also explain why <code>a b</code> works for Type constructors of 1 parameter or <i>more</i> and <code>a b c</code> works for type constructors of 2 parameters or <i>more</i>. (Emphasis is on the <i>more</i>) How does it know that extra parameters still satisfy the type rules?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1427182025, "post_id": 29210694, "comment_id": 46661288, "body": "Erm... it <i>doesn&#39;t</i> work, not in the sense that you could write signatures like, say, <code>Either Int -&gt; String</code>: every argument / result of a function must have kind <code>*</code>, but <code>Either Int :: * -&gt; *</code>. So... what do you mean?"}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1427185137, "post_id": 29210694, "comment_id": 46662463, "body": "Ok, to make this a bit clearer. I&#39;m confused as to what exactly <code>a b c</code> is. Is it <code>a (b c)</code> or <code>a (b (c))</code>? How does it choose? Furthermore, it seems that a signature like <code>fn :: (TC b) =&gt; a b -&gt; Int</code> accepts <code>(1, X)</code> and <code>(1, 2, X)</code> and <code>(&quot;string&quot;, &quot;string&quot;, &quot;string&quot;, X)</code> as long as X is constrained by TC. Why are all these types valid? I tried it in GHCI, and I could keep running <code>fn blah</code> where blah is all of those types I wrote above."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1427185216, "post_id": 29210694, "comment_id": 46662502, "body": "Also I didn&#39;t understand your last paragraph &quot;Rather more often than not... &quot;"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1427189510, "post_id": 29210694, "comment_id": 46664664, "body": "Ah. Well, types are <i>parsed</i> exactly the same way as expressions, i.e. <code>a b c</code> means <code>(a b) c</code>, i.e. <code>a</code> isn&#39;t literally a function of two type arguments: it&#39;s curried \u2013 a function of one type variable, yielding a function of of another type argument, yielding a type. So <code>a b c</code> is simply a special case of <code>d c</code>, with <code>d ~ a b</code>; in particular, <code>(Int,Int,a) ~ (,,) Int Int a ~ t a</code> with <code>t ~ (Int, Int, )</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1427189694, "post_id": 29210694, "comment_id": 46664796, "body": "With \u201crather more often than not\u201d I meant that most useful type constructors in Haskell are actually functors, so you can generally use at least that class (often also more powerfule ones) when writing functions that are polymorphic on an <code>* -&gt; *</code> argument."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1427115839, "last_edit_date": 1427115839, "creation_date": 1427115004, "answer_id": 29210694, "question_id": 29210315, "link": "https://stackoverflow.com/questions/29210315/haskell-type-signature-with-composite-multi-param-type-constructors/29210694#29210694", "title": "Haskell type signature with composite/multi-param type constructors", "body": "<p>Without further constraints, such types are useless &ndash; there's nothing you could really do with them, expect pass them right on. But that's actually the same situation with a signature <code>a -&gt; Int</code>: if nothing is known about <code>a</code>, there's nothing you can do with it either!</p>\n\n<p>However, like with e.g. <code>toInteger :: Integral a =&gt; a -&gt; Integer</code>, adding constraints to the arguments allows you to do stuff. For instance,</p>\n\n<pre><code>import Data.Foldable\nimport Prelude hiding (foldr)\n\nx' :: (Foldable a, Integral b) =&gt; a b -&gt; Integer\nx' = foldr ((+) . toInteger) 0\n</code></pre>\n\n<p>Rather more often than not, when you have a type of the form <code>a b ... n o p q</code>, then <code>a b ... p</code> is at least an instance of the <code>Functor</code> class, often also <code>Applicative</code> and <code>Monad</code>; sometimes <code>Foldable</code>, <code>Traversable</code>, or <code>Comonad</code>; sometimes <code>a b ... o</code> will be <code>Arrow</code>... These constraints allow you to do quite a lot with the composite types, without knowing what particular type constructors you're dealing with.</p>\n"}, {"tags": [], "owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "is_accepted": false, "score": 0, "last_activity_date": 1427449686, "creation_date": 1427449686, "answer_id": 29297655, "question_id": 29210315, "link": "https://stackoverflow.com/questions/29210315/haskell-type-signature-with-composite-multi-param-type-constructors/29297655#29297655", "title": "Haskell type signature with composite/multi-param type constructors", "body": "<p>After studying @leftaroundabout answer and experimenting in GHCI, I've come to an understanding with composite types. Their unification with applied types is based on both the evaluation order and their type variable's kind signature. The evaluation order is quite important as <code>a b c ~ (((a) b) c)</code> while <code>a (b c)</code> is <code>(a ((b) c)</code>. This makes <code>a b c</code> match composite types where <code>a</code> is matched with type constructors of kind <code>* -&gt; * -&gt; *</code>, and <code>a b</code> with <code>* -&gt; *</code> and <code>a b c</code> with <code>*</code>.</p>\n\n<p>I explained it fully with diagrams and GHCI code in this gist (<a href=\"https://gist.github.com/CMCDragonkai/2a1d3ecb67dcdabfc7e0\" rel=\"nofollow\">https://gist.github.com/CMCDragonkai/2a1d3ecb67dcdabfc7e0</a>) (it's too long for stack overflow)</p>\n"}], "owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 29210694, "answer_count": 2, "score": 4, "last_activity_date": 1427449686, "creation_date": 1427114009, "last_edit_date": 1427114453, "question_id": 29210315, "link": "https://stackoverflow.com/questions/29210315/haskell-type-signature-with-composite-multi-param-type-constructors", "title": "Haskell type signature with composite/multi-param type constructors", "body": "<p>I've discovered these kinds of type signatures:</p>\n\n<pre><code>x :: a b -&gt; Int\nx f = 3\n\ny :: a b c -&gt; Int\ny f = 3\n\nz :: a b c d -&gt; Int\nz f = 3\n\n&gt; x [1] -- 3\n&gt; y (1, 2) -- 3\n&gt; z (1, 2, 3) -- 3\n</code></pre>\n\n<p>Basically:</p>\n\n<ol>\n<li>x only accepts a value inhabiting a type constructor with 1 parameter or more.</li>\n<li>y only accepts a value inhabiting a type constructor with 2 parameters or more.</li>\n<li>z only accepts a value inhabiting a type constructor with 3 parameters or more.</li>\n</ol>\n\n<p>They are valid, but I'm not sure what they mean nor what they could be used for.</p>\n\n<p>They seem related to polytypic notions or polymorphism over type constructors, but enforce an invariant based on many parameters the type constructor accepts.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1427118872, "post_id": 29210248, "comment_id": 46633544, "body": "What is a deconstruction type-set?"}], "answers": [{"comments": [{"owner": {"reputation": 211, "user_id": 2349639, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1b2492ba410727a974b5b7e71ae20369?s=128&d=identicon&r=PG", "display_name": "Elad Shtiegmann", "link": "https://stackoverflow.com/users/2349639/elad-shtiegmann"}, "edited": false, "score": 0, "creation_date": 1427114980, "post_id": 29210372, "comment_id": 46630955, "body": "Thanks, but we&#39;re not-necessarily dealing with ordered types"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 211, "user_id": 2349639, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1b2492ba410727a974b5b7e71ae20369?s=128&d=identicon&r=PG", "display_name": "Elad Shtiegmann", "link": "https://stackoverflow.com/users/2349639/elad-shtiegmann"}, "edited": false, "score": 0, "creation_date": 1427115284, "post_id": 29210372, "comment_id": 46631148, "body": "I almost suspected so. Well, you might still be able to use this technique, just try to find some relation that serves the purpose of <code>&gt;</code> here."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1427131171, "post_id": 29210372, "comment_id": 46642030, "body": "You should be able to use any relation where <code>r x y</code> implies <code>not (r y x)</code> (asymmetry)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1427115274, "last_edit_date": 1427115274, "creation_date": 1427114187, "answer_id": 29210372, "question_id": 29210248, "link": "https://stackoverflow.com/questions/29210248/haskell-defining-commutative-functions-how-to-consider-actual-arguments-by-co/29210372#29210372", "title": "Haskell - defining commutative functions: How to consider actual arguments by combination, not permutation", "body": "<p>In a case like <code>Int</code>, you can simply order the arguments and feed them to a (local) partial function that only accepts the arguments in that canonically ordered form:</p>\n\n<pre><code>weirdCommutative x y\n  | x &gt; y      = f y x\n  | otherwise  = f x y\n where f 0 1 = 999\n       f x' y' = x' + y'\n</code></pre>\n\n<p>Now, obviously most types aren't in the <code>Ord</code> class &ndash; but if you're deconstructing the arguments by pattern-matching, chances are you can define at least some partial ordering. It doesn't really need to be <code>&gt;</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 6, "last_activity_date": 1427114834, "creation_date": 1427114834, "answer_id": 29210617, "question_id": 29210248, "link": "https://stackoverflow.com/questions/29210248/haskell-defining-commutative-functions-how-to-consider-actual-arguments-by-co/29210617#29210617", "title": "Haskell - defining commutative functions: How to consider actual arguments by combination, not permutation", "body": "<p>There is actually <a href=\"https://github.com/gelisam/commutative\" rel=\"noreferrer\">a package</a> that provides a monad and some scaffolding for defining and using commutative functions. Also see this <a href=\"http://gelisam.blogspot.hu/2013/07/the-commutative-monad.html\" rel=\"noreferrer\">blog post.</a> </p>\n"}], "owner": {"reputation": 211, "user_id": 2349639, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1b2492ba410727a974b5b7e71ae20369?s=128&d=identicon&r=PG", "display_name": "Elad Shtiegmann", "link": "https://stackoverflow.com/users/2349639/elad-shtiegmann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 2, "accepted_answer_id": 29210617, "answer_count": 2, "score": 3, "last_activity_date": 1427123169, "creation_date": 1427113786, "last_edit_date": 1427123169, "question_id": 29210248, "link": "https://stackoverflow.com/questions/29210248/haskell-defining-commutative-functions-how-to-consider-actual-arguments-by-co", "title": "Haskell - defining commutative functions: How to consider actual arguments by combination, not permutation", "body": "<p>I want to define a function that considers it's equally-typed arguments without considering their order. For example:</p>\n\n<pre><code>weirdCommutative :: Int -&gt; Int -&gt; Int\nweirdCommutative 0 1 = 999\nweirdCommutative x y = x + y\n</code></pre>\n\n<p>I would like this function to actually be commutative. \nOne option is adding the pattern:</p>\n\n<pre><code>weirdCommutative 1 0 = 999\n</code></pre>\n\n<p>or even better:</p>\n\n<pre><code>weirdCommutative 1 0 = weirdCommutative 0 1\n</code></pre>\n\n<p><strong>Now lets look at the general case:</strong> There could be more than two arguments and/or two values that need to be considered without order - So considering all possible cases becomes tricky.</p>\n\n<p>Does anyone know of a clean, natural way to define commutative functions in Haskell? </p>\n\n<p>I want to emphasize that the solution I am looking for is general and cannot assume anything about the type (nor its deconstruction type-set) except that values can be compared using <code>==</code> (meaning that the type is in the <code>Eq</code> typeclass but not necessarily in the <code>Ord</code> typeclass).</p>\n"}, {"tags": ["mysql", "haskell"], "comments": [{"owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 0, "creation_date": 1427114523, "post_id": 29206614, "comment_id": 46630686, "body": "Does it work if you replace <code>:: Day</code> with <code>:: UTCTime</code>?"}, {"owner": {"reputation": 23, "user_id": 2229657, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/1988137c135c15e32b305cc6ded3f3a4?s=128&d=identicon&r=PG", "display_name": "user2229657", "link": "https://stackoverflow.com/users/2229657/user2229657"}, "reply_to_user": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 0, "creation_date": 1427125961, "post_id": 29206614, "comment_id": 46638633, "body": "Regrettably no, I get the same error but with &#39;Result UTCTime&#39; in place of &#39;Result Day&#39;."}], "answers": [{"tags": [], "owner": {"reputation": 23, "user_id": 2229657, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/1988137c135c15e32b305cc6ded3f3a4?s=128&d=identicon&r=PG", "display_name": "user2229657", "link": "https://stackoverflow.com/users/2229657/user2229657"}, "is_accepted": false, "score": 1, "last_activity_date": 1427145463, "creation_date": 1427145463, "answer_id": 29220587, "question_id": 29206614, "link": "https://stackoverflow.com/questions/29206614/instance-declaration-of-result-day-using-mysql-simple/29220587#29220587", "title": "Instance Declaration of Result Day using MySQL-simple", "body": "<p>After some further exploration and trying to execute the code from ghci I recieved an error which stated that there was overlapping definitions in 2 different libraries and as GHCI could not figure out which was the appropriate one to use it had to bail out.  The message:</p>\n\n<pre><code>GHCi runtime linker: fatal error: I found a duplicate definition for symbol\n   get_current_timezone_seconds\nwhilst processing object file\n   /home/user/.cabal/lib/time-1.5.0.1/ghc-7.6.3/HStime-1.5.0.1.o\nThis could be caused by:\n   * Loading two different object files which export the same symbol\n   * Specifying the same object file twice on the GHCi command line\n   * An incorrect `package.conf' entry, causing some object to be\n     loaded twice.\nGHCi cannot safely continue in this situation.  Exiting now.  Sorry.\n</code></pre>\n\n<p>Looking at the 'Loading package' statements which preceded this error I noticed that the system was trying to load time-1.4.0.1 and then time-1.5.0.1.  As I've been trying to find the preferred library for accessing MySQL I had installed persistent-mysql, hdbc-mysql and a couple of others.  In turn I had uninstalled each but apparently some cruft got left behind.  After removing the time-1.5.0.1 library I recompiled my original code and ran it without issue.</p>\n\n<p>In the end it seems a case where ghc was outputting an appropriate error message but I didn't have enough information to determine the root cause (ie 2 different definitions of Day brought on by 2 different versions of the time package).  All fixed now though... yeesh.</p>\n"}], "owner": {"reputation": 23, "user_id": 2229657, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/1988137c135c15e32b305cc6ded3f3a4?s=128&d=identicon&r=PG", "display_name": "user2229657", "link": "https://stackoverflow.com/users/2229657/user2229657"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1427145463, "creation_date": 1427102237, "question_id": 29206614, "link": "https://stackoverflow.com/questions/29206614/instance-declaration-of-result-day-using-mysql-simple", "title": "Instance Declaration of Result Day using MySQL-simple", "body": "<p>I'm trying to retrieve a date from my MySQL table using the MySQL-simple package in Haskell and I keep getting the following error:</p>\n\n<pre><code>mysql-simple.hs:12:17:\n    No instance for (Database.MySQL.Simple.Result.Result Day)\n      arising from a use of `query_'\n</code></pre>\n\n<p>'record_date' is a column in the MySQL table with a type of Date and it is not allowed to be null.</p>\n\n<p>My source code is below, can anyone shed some light on the appropriate way to retrieve a date from MySQL in Haskell?</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Monad\nimport Data.Text\nimport Data.Time.Clock (UTCTime)\nimport Data.Time.Calendar (Day)\nimport Data.ByteString (ByteString)\nimport Database.MySQL.Simple\n\nmain = do\n        conn &lt;- connect defaultConnectInfo { connectUser = \"haskell\", connectPassword = \"hpasswd\", connectDatabase = \"hdbase\" }\n        rset &lt;- query_ conn \"select symbol, record_date, low, high, open, close from performance where symbol = 'AAPL' order by record_date desc limit 5\"\n        forM_ rset $ \\(s, r, l, h, o, c) -&gt; do\n                print $ unpack s ++ (show (l::Double)) ++ (show (h::Double)) ++ (show (o::Double)) ++  (show (c :: Double))\n                print $ show (r :: Day)\n</code></pre>\n"}, {"tags": ["haskell", "prolog"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1427102211, "post_id": 29206520, "comment_id": 46623810, "body": "The Haskell programs have too many arguments. The last argument is typically regarded as the output in prolog, so in Haskell it should disappear."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1427102269, "post_id": 29206520, "comment_id": 46623842, "body": "Also, all the names for Haskell parameters must be in <i>lowercase</i>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1812457"}, "edited": false, "score": 3, "creation_date": 1427110560, "post_id": 29206520, "comment_id": 46628292, "body": "You cannot write an <i>equivalent</i> Haskell program easily because Haskell has a different execution model. You can write a Haskell program that gives the same answers for a subset of the possible invocations of the Prolog program."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427122740, "post_id": 29207286, "comment_id": 46636378, "body": "Being completely unfamiliar with Prolog, I guessed that <code>:-</code> must be a turnstile symbol, but it seems to go in the opposite direction. Strange."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1812457"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427123575, "post_id": 29207286, "comment_id": 46636943, "body": "@dfeuer Yes. <code>a(X) :- b(X, Y), c(X, Y).</code> means rather &quot;<code>a(X)</code> is true when <code>b(X, Y)</code> is true, and <code>c(X, Y)</code> is also true&quot;. In &quot;pretty-printed&quot; code it is often represented by a short single arrow to the left."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1427123737, "post_id": 29207286, "comment_id": 46637039, "body": "FYI, there&#39;s a <code>logict</code> package for logic programming in Haskell, but I don&#39;t (yet) understand it at all."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1812457"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427124017, "post_id": 29207286, "comment_id": 46637223, "body": "@dfeuer Apparently, there is also miniKanren. There was a great answer some time ago by one of the authors: <a href=\"http://stackoverflow.com/questions/28467011/what-are-the-main-technical-differences-between-prolog-and-minikanren-with-resp\" title=\"what are the main technical differences between prolog and minikanren with resp\">stackoverflow.com/questions/28467011/&hellip;</a>"}, {"owner": {"reputation": 43, "user_id": 4702123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e301b214ba1567164d0341f80a21852d?s=128&d=identicon&r=PG&f=1", "display_name": "Kumar", "link": "https://stackoverflow.com/users/4702123/kumar"}, "edited": false, "score": 0, "creation_date": 1427137343, "post_id": 29207286, "comment_id": 46645482, "body": "Thank you so much. This works. My implementation wasn&#39;t reversing the list as it was supposed to. Plus thank you for correcting my syntax."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1812457"}, "is_accepted": true, "score": 3, "last_activity_date": 1427108594, "last_edit_date": 1427108594, "creation_date": 1427104591, "answer_id": 29207286, "question_id": 29206520, "link": "https://stackoverflow.com/questions/29206520/converting-a-prolog-program-to-a-haskell-program/29207286#29207286", "title": "Converting a Prolog program to a Haskell program", "body": "<p>The literal translation would be:</p>\n\n<pre><code>mix xs = remix xs []\nremix [] ys = ys\nremix (x:xs) ys = remix xs (x:ys)\n</code></pre>\n\n<p><strong>Assuming</strong> that the first argument to <code>mix/2</code> is strictly an input argument, and the last argument of both <code>mix/2</code> and <code>remix/3</code> are output argument. Then, the Haskell <em>functions</em> have as a return value the last argument of the Prolog <em>predicates</em> you are translating. Otherwise, the Haskell version is exactly the same as the Prolog, just correct Haskell syntax. Compare it to your attempt and you will see a lot of small differences (and I guess the Haskell compiler would tell you about these too?)</p>\n\n<p>(Haskellers please correct me if this is wrong)</p>\n\n<p>There are however some issues with this. The original Prolog program could be queried both ways:</p>\n\n<pre><code>?- mix([1,2,3], M).\nM = [3, 2, 1].\n\n?- mix(M, [3,2,1]).\nM = [1, 2, 3] .\n</code></pre>\n\n<p>or even:</p>\n\n<pre><code>?- mix(X, Y), numbervars(X-Y, 0, _).\nX = Y, Y = [] ;\nX = Y, Y = [A] ;\nX = [A, B],\nY = [B, A] ;\nX = [A, B, C],\nY = [C, B, A] ;\nX = [A, B, C, D],\nY = [D, C, B, A] . % and so on\n</code></pre>\n\n<p><strong>However</strong>, the second query leaves a choice point, and if you try to see what other solutions you might get (type Space or <code>;</code> instead of Enter), the program does not terminate. Does it say <em>how</em> the original Prolog program is meant to be used?</p>\n"}], "owner": {"reputation": 43, "user_id": 4702123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e301b214ba1567164d0341f80a21852d?s=128&d=identicon&r=PG&f=1", "display_name": "Kumar", "link": "https://stackoverflow.com/users/4702123/kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 721, "favorite_count": 0, "accepted_answer_id": 29207286, "answer_count": 1, "score": 1, "last_activity_date": 1427121856, "creation_date": 1427101889, "last_edit_date": 1427121856, "question_id": 29206520, "link": "https://stackoverflow.com/questions/29206520/converting-a-prolog-program-to-a-haskell-program", "title": "Converting a Prolog program to a Haskell program", "body": "<p>I've got this review question for one of my exams, and I need some guidance.</p>\n\n<blockquote>\n  <p>Using the following Prolog program as an executable specification,</p>\n\n<pre><code>mix(Xs,Ys):-remix(Xs,[],Ys).\n\nremix([],Ys,Ys).    \nremix([X|Xs],Ys,Zs):-remix(Xs,[X|Ys],Zs).\n</code></pre>\n  \n  <p>write an equivalent Haskell program.</p>\n</blockquote>\n\n<p>This is what I have so far for the Haskell code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>mix Xs Ys = remix Xs [] Ys\n\nremix [] Ys Zs = Zs\n\nremix (X:Xs) Ys Zs = x : (remix Xs Ys Zs)\n</code></pre>\n\n<p>Is this Haskell program be equivalent to the Prolog code above? If not, what am I doing wrong?</p>\n"}, {"tags": ["string", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 2725, "user_id": 2251058, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8ffc7bebb06ae9943708d99f3621c1b5?s=128&d=identicon&r=PG", "display_name": "Akshay Hazari", "link": "https://stackoverflow.com/users/2251058/akshay-hazari"}, "edited": false, "score": 0, "creation_date": 1427094841, "post_id": 29204880, "comment_id": 46620795, "body": "Oh mybad. I feel miserable looking at what I did ."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1427094935, "post_id": 29204880, "comment_id": 46620824, "body": "I would recommend writing this function using pattern matching; it is just much nicer and shorter: <code>substrIndex (&#39;-&#39;:&#39;}&#39;:_) = 0; substrIndex (_:xs) = 1 + substrIndex xs; substrIndex [] = 0</code>"}, {"owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1427095075, "post_id": 29204880, "comment_id": 46620882, "body": "@user2407038 I was coming up with something similar, but yours looks far better than mine. Thanks :-)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1427100123, "post_id": 29204880, "comment_id": 46622794, "body": "Can&#39;t help bike-shedding: <code>substrIndex = findIndex (&quot;-}&quot; `isPrefixOf`) . tails</code>... or maybe use <a href=\"http://hackage.haskell.org/package/KMP-0.1.0.2/docs/Data-Algorithms-KMP.html\" rel=\"nofollow noreferrer\">KMP</a>."}], "tags": [], "owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "is_accepted": true, "score": 4, "last_activity_date": 1427095034, "last_edit_date": 1427095034, "creation_date": 1427094696, "answer_id": 29204880, "question_id": 29204813, "link": "https://stackoverflow.com/questions/29204813/string-matching-with-newline-character-in-haskell/29204880#29204880", "title": "String Matching with newline character in Haskell", "body": "<p>Your program has a bug. You are checking every two characters. But, what if the <code>-</code> and <code>}</code> are in different pairs, for example <code>S-}</code>?</p>\n\n<ol>\n<li><p>It will first check <code>S</code> and <code>-</code> are equal to <code>-</code> and <code>}</code> respectively.</p></li>\n<li><p>Since they don't match, it will move on with <code>}</code> alone.</p></li>\n</ol>\n\n<p>So, you just need to change the logic a little bit, like this</p>\n\n<pre><code>substrIndex (s:t:str)\n  | s == '-' &amp;&amp; t == '}' = 0\n  | otherwise = 1 + (substrIndex (t:str))\n</code></pre>\n\n<p>Now, if the current pair doesn't match <code>-}</code>, then just skip the first character and proceed with the second character, <code>substrIndex (t:str)</code>. So, if <code>S-</code> doesn't match, your program will proceed with <code>-}</code>. Since we dropped only one character we add only <code>1</code>, instead of <code>2</code>.</p>\n\n<hr>\n\n<p>This can be shortened and written clearly, as suggested by user2407038, like this</p>\n\n<pre><code>substrIndex :: String -&gt; Int\nsubstrIndex [] = 0\nsubstrIndex ('-':'}':_) = 0\nsubstrIndex (_:xs) = 1 + substrIndex xs\n</code></pre>\n"}], "owner": {"reputation": 2725, "user_id": 2251058, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8ffc7bebb06ae9943708d99f3621c1b5?s=128&d=identicon&r=PG", "display_name": "Akshay Hazari", "link": "https://stackoverflow.com/users/2251058/akshay-hazari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 29204880, "answer_count": 1, "score": 1, "last_activity_date": 1427095034, "creation_date": 1427094380, "question_id": 29204813, "link": "https://stackoverflow.com/questions/29204813/string-matching-with-newline-character-in-haskell", "title": "String Matching with newline character in Haskell", "body": "<p>Here I am trying to find the index of '-' followed by '}' in a String. </p>\n\n<p>For an input like <code>sustringIndex \"abcd -} sad\"</code> it gives me an output of <code>10</code>\nwhich is giving me the entire string length.</p>\n\n<p>Also if I do something like <code>sustringIndex \"abcd\\n -} sad\"</code> it gives me <code>6</code></p>\n\n<p>Why is that so with \\n. What am I doing wrong. Please correct me I'm a noob.</p>\n\n<pre><code>substrIndex :: String -&gt; Int\nsubstrIndex \"\"=0\nsubstrIndex (s:\"\") = 0\nsubstrIndex (s:t:str)\n  | s== '-' &amp;&amp; t == '}' = 0\n  | otherwise = 2+(substrIndex str)\n</code></pre>\n"}, {"tags": ["haskell", "haskell-wai"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1427095228, "post_id": 29204653, "comment_id": 46620934, "body": "<code>Vault</code> is intentionally abstract so your code doesn&#39;t work because it would break abstraction. You cannot get a list of the keys of a vault because this function would not be well typed - what would its type be? <code>Vault -&gt; [Key a]</code>? How do you pick an <code>a</code>? What if the Vault contains values of different types? The output list then must be heterogeneous, and its type must depend on the value of the vault. Perhaps you can elaborate as to what problem you are actually trying to solve."}, {"owner": {"reputation": 699, "user_id": 1432412, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45b5c5bb9243d6d8b282ec473fadd439?s=128&d=identicon&r=PG", "display_name": "Julian.zhang", "link": "https://stackoverflow.com/users/1432412/julian-zhang"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1427097044, "post_id": 29204653, "comment_id": 46621606, "body": "dear  @user2407038,  I just want check which data wai had save in the Vault. So in your opinion the only way is find  the wai&#39;s code or doc?"}], "owner": {"reputation": 699, "user_id": 1432412, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45b5c5bb9243d6d8b282ec473fadd439?s=128&d=identicon&r=PG", "display_name": "Julian.zhang", "link": "https://stackoverflow.com/users/1432412/julian-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 209, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1427093528, "creation_date": 1427093528, "question_id": 29204653, "link": "https://stackoverflow.com/questions/29204653/how-to-get-data-from-vault", "title": "How to get data from Vault", "body": "<p>I'm use wai to build a web backend.</p>\n\n<p>And I want to know the which kind of data save in the requst's vault.</p>\n\n<p>But I don't know how to check which keys are already in this vault.</p>\n\n<p>I find the <a href=\"https://github.com/HeinrichApfelmus/vault/blob/master/src/Data/Vault/ST/ST.hs\" rel=\"nofollow\">https://github.com/HeinrichApfelmus/vault/blob/master/src/Data/Vault/ST/ST.hs</a></p>\n\n<p>and try with </p>\n\n<pre><code>import qualified Data.Vault.ST.Lazy as DV\n\ncheckVault (DV.Vault v) = do\n     putStrLn $ show $ v\n</code></pre>\n\n<p>But the ghc said \"Not in scope: data constructor \u2018DV.Vault\u2019\"</p>\n\n<p>Is there any way I can get the vault's Keys?</p>\n\n<p>Or where is the docs I can know which data wai save in this vault.</p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 685, "user_id": 3222117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uEbIs.jpg?s=128&g=1", "display_name": "Alexandre Lucchesi", "link": "https://stackoverflow.com/users/3222117/alexandre-lucchesi"}, "edited": false, "score": 0, "creation_date": 1427132398, "post_id": 29204518, "comment_id": 46642700, "body": "Thanks for the answer! I&#39;m glad to know that this is just another instance of the &quot;bug vs feature&quot; dilemma. :-) I certainly see the usefulness of <code>it</code>, but I wonder if there is a better way this feature could be implemented in GHCi in order to avoid such confusion... Maybe using a special keyword, rather than a valid Haskell function identifier? Or at least warning the user when loading functions named with reserved GHCi names... Finally, are there any other special names in GHCi that I should be aware of?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 685, "user_id": 3222117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uEbIs.jpg?s=128&g=1", "display_name": "Alexandre Lucchesi", "link": "https://stackoverflow.com/users/3222117/alexandre-lucchesi"}, "edited": false, "score": 1, "creation_date": 1427137666, "post_id": 29204518, "comment_id": 46645675, "body": "@alexandrelucchesi I recall from way back that Hugs used <code>$$</code> instead, although that could be confused with an operator. I think GHCi uses an ordinary identifier because the feature is implemented as normal code, see <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/interactive-evaluation.html#idp7106400\" rel=\"nofollow noreferrer\">the manual</a>. I&#39;m not aware of any other special names, <code>:show bindings</code> doesn&#39;t list any more."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 11, "last_activity_date": 1427093168, "last_edit_date": 1427093168, "creation_date": 1427092864, "answer_id": 29204518, "question_id": 29204453, "link": "https://stackoverflow.com/questions/29204453/strange-behaviour-in-ghci/29204518#29204518", "title": "Strange behaviour in GHCi", "body": "<p>Bad luck in naming: <code>it</code> is the name GHCi automatically binds to the result of your previous evaluation, so that you can conveniently refer to it again. So your first use immediately rebinds it, shadowing your definition.</p>\n\n<p>If <code>it</code> is defined in a module, you should still be able to refer to it reliably from GHCi with the module prefix, e.g. <code>Main.it</code>.</p>\n"}], "owner": {"reputation": 685, "user_id": 3222117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uEbIs.jpg?s=128&g=1", "display_name": "Alexandre Lucchesi", "link": "https://stackoverflow.com/users/3222117/alexandre-lucchesi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 29204518, "answer_count": 1, "score": 5, "last_activity_date": 1427093168, "creation_date": 1427092584, "question_id": 29204453, "link": "https://stackoverflow.com/questions/29204453/strange-behaviour-in-ghci", "title": "Strange behaviour in GHCi", "body": "<p>I wrote the following piece of code:</p>\n\n<pre><code>it :: Int -&gt; Int\nit n\n    | n &lt; 1     = error \"Invalid entry.\"\n    | n == 1    = 0\n    | otherwise = 1 + it (n `quot` 2)\n</code></pre>\n\n<p>When I load it into GHCi, something weird happens. The first time I call the function <code>it</code>, it works fine and returns the expected results. However, the next time, I get the following crash:</p>\n\n<pre><code>\u03bb: :t it\nit :: Int -&gt; Int\n\u03bb: it 2\n1\n\u03bb: it 2\n\n&lt;interactive&gt;:4:1:\n    Couldn't match expected type `a0 -&gt; t0' with actual type `Int'\n    The function `it' is applied to one argument,\n    but its type `Int' has none\n    In the expression: it 2\n    In an equation for `it': it = it 2\n\u03bb: :t it\nit :: Int\n\u03bb: it\n1\n</code></pre>\n\n<p>It seems that the type of <code>it</code> is being somehow modified after the first call. Things get even stranger when <code>it</code> is called multiple times from <code>main</code>, i.e. all the calls return the expected results, but in the end <code>()</code> is assigned as the type of <code>it</code>:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    let r1 = it 1\n        r2 = it 2\n        r3 = it 3\n    print r1\n    print r2\n    print r3\n\n\u03bb: main\n0\n1\n1\n\u03bb: :t it\nit :: ()\n</code></pre>\n\n<p>I believe this is a bug related to the identifier <code>it</code> and GHCi internals, since renaming the function to something else (as <code>it'</code>) completely solves the problem. Besides that, the body of the function appears to have no influence; doing <code>let it = (+) 2</code> and evaluating it multiple times is also problematic.</p>\n\n<p>Any insight would be appreciated. The output of <code>ghci --version</code> is \"version 7.6.3\".</p>\n"}, {"tags": ["haskell", "pointfree", "haskell-lens"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1427089463, "post_id": 29203844, "comment_id": 46619144, "body": "I don&#39;t know the details, but I&#39;m pretty sure it has something to do with higher ranked types causing some typing issues. Passing <code>Lens</code> arguments can cause that sort of issue. It will probably work if you use <code>ALens</code> instead of <code>Lens</code>, since that is designed to be passed around."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1427090585, "post_id": 29203844, "comment_id": 46619433, "body": "@DavidYoung You <i>can</i> do it with <code>ALens</code>, but then the called function has to explicitly <code>cloneLens</code> it back to a normal lens before using it. That&#39;s normally only appropriate for a function that really needs the full lens features of its argument."}, {"owner": {"reputation": 30828, "user_id": 239916, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/950ab2797f3012eeed28559fcdde8e1f?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Eding", "link": "https://stackoverflow.com/users/239916/thomas-eding"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1427090612, "post_id": 29203844, "comment_id": 46619442, "body": "@DavidYoung: I&#39;ll have to look into it. A quick google didn&#39;t give rise to any tutorials/examples for <code>ALens</code> over <code>Lens</code>, but I should be able to figure it out. Time to call the day quits for now."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1427097948, "post_id": 29203844, "comment_id": 46621919, "body": "@DavidYoung After a while I realized that <code>ALens</code> is better for lenses than my alternative <code>newtype</code> hack, if one insists on having a consistent type, so I&#39;ve now included them in my answer too. (I think it&#39;s still more &quot;idiomatic lens&quot; to use specific types at the usage sites.)"}], "answers": [{"comments": [{"owner": {"reputation": 30828, "user_id": 239916, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/950ab2797f3012eeed28559fcdde8e1f?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Eding", "link": "https://stackoverflow.com/users/239916/thomas-eding"}, "edited": false, "score": 0, "creation_date": 1427090452, "post_id": 29203979, "comment_id": 46619409, "body": "A case where the cure might be worse than the illness. Oh well, but thanks for the info!"}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 8, "last_activity_date": 1427097779, "last_edit_date": 1427097779, "creation_date": 1427089796, "answer_id": 29203979, "question_id": 29203844, "link": "https://stackoverflow.com/questions/29203844/point-free-lens-creation-does-not-type-check/29203979#29203979", "title": "Point-free lens creation does not type check", "body": "<p><code>Lens'</code> is a higher ranked type, and type inference is very brittle with those, and basically only works when all functions that take higher-rank arguments have explicit signatures to do so.  This works very badly with point-free code using <code>.</code> and the like, which don't have such signatures. (Only <code>$</code> has a special hack to sometimes work with this.)</p>\n\n<p>The <code>lens</code> library itself gets around this by making sure that all functions that <em>use</em> a lens argument don't have a fully general lens type for it, but only a type which indicates the precise lens feature they <em>use</em>.</p>\n\n<p>In your case, it's the <code>printHandle</code> function which is the culprit for this.  Your code will compile if you change its signature to the more precise</p>\n\n<pre><code>printHandle :: s -&gt; Getting Player s Player -&gt; IO ()\n</code></pre>\n\n<p>I found this signature by deleting the original one and using <code>:t printHandle</code>.</p>\n\n<p>EDIT (and EDIT again to add <code>ALens'</code>): If you think the \"cure is worse than the illness\", then depending on your needs another option, which doesn't require you to change your function signatures, but which <em>does</em> require you to do some explicit conversion, is to use the <code>ALens'</code> type instead.  You then need to change two lines:</p>\n\n<pre><code>type PlayerLens = ALens' GameState Player\n...\nprintHandle st playerLens = do\n    let player = st^.cloneLens playerLens\n...\n</code></pre>\n\n<p><code>ALens'</code> is a non-higher rank type that has been cleverly constructed so that it contains all the information needed to extract a general lens from it with <code>cloneLens</code>.  But it still <em>is</em> a special subtype of a lens (the <code>Functor</code> has just been particularly cleverly chosen) so you only need explicit conversion <em>from</em> <code>ALens'</code> to <code>Lens'</code>, not the other way.</p>\n\n<p>A third option, which may not be the best for lenses, but which usually works for higher-rank types in <em>general</em>, is to turn your <code>PlayerLens</code> into a <code>newtype</code>:</p>\n\n<pre><code>newtype PlayerLens = PL (Lens' GameState Player)\n</code></pre>\n\n<p>Of course this now needs both wrapping and unwrapping in several places in your code. <code>getPlayerLens</code> was particularly disrupted:</p>\n\n<pre><code>getPlayerLens :: PlayerHandle -&gt; PlayerLens\ngetPlayerLens handle = PL playerLens\n    where\n        playerLens f st = fmap put' get'\n            where\n                players = st^.gamePlayers\n                put' player = let\n                    g p = case p^.playerHandle == handle of\n                        True -&gt; player\n                        False -&gt; p\n                    in set gamePlayers (map g players) st\n                get' = f $ fromJust $ find (\\p -&gt; p^.playerHandle == handle) players\n</code></pre>\n"}], "owner": {"reputation": 30828, "user_id": 239916, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/950ab2797f3012eeed28559fcdde8e1f?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Eding", "link": "https://stackoverflow.com/users/239916/thomas-eding"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 1, "accepted_answer_id": 29203979, "answer_count": 1, "score": 5, "last_activity_date": 1427097779, "creation_date": 1427088894, "last_edit_date": 1427089273, "question_id": 29203844, "link": "https://stackoverflow.com/questions/29203844/point-free-lens-creation-does-not-type-check", "title": "Point-free lens creation does not type check", "body": "<p>In the function <code>test</code>, I traverse over a list, generate lenses from it's members, and then print some data. This works when I use a pointful call style. It fails to typecheck when I make it point-free.</p>\n\n<p>Why is this the case, and how can I solve this problem?</p>\n\n<p>It looks like to me that GHC is not retaining the information that the higher-ranked <code>f</code> (in the lens) is a <code>Functor</code> when using point-free style, but I'm not too sure.</p>\n\n<p>I'm using GHC 7.8.3</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport Control.Lens\nimport Control.Monad\nimport Data.List\nimport Data.Maybe\n\ntype PlayerHandle = String\n\ndata Player = Player { _playerHandle :: PlayerHandle }\nmakeLenses ''Player\n\ndata GameState = GameState { _gamePlayers :: [Player] }\nmakeLenses ''GameState\n\ntype PlayerLens = Lens' GameState Player\n\ngetPlayerLens :: PlayerHandle -&gt; PlayerLens\ngetPlayerLens handle f st = fmap put' get'\n    where\n        players = st^.gamePlayers\n        put' player = let\n            g p = case p^.playerHandle == handle of\n                True -&gt; player\n                False -&gt; p\n            in set gamePlayers (map g players) st\n        get' = f $ fromJust $ find (\\p -&gt; p^.playerHandle == handle) players\n\n\nprintHandle :: GameState -&gt; PlayerLens -&gt; IO ()\nprintHandle st playerLens = do\n    let player = st^.playerLens\n    print $ player^.playerHandle\n\n\ntest :: GameState -&gt; IO ()\ntest st = do\n    let handles = toListOf (gamePlayers.traversed.playerHandle) st\n    --\n    -- Works: Pointful\n    --forM_ handles $ \\handle -&gt; printHandle st $ getPlayerLens handle\n    --\n    -- Does not work: Point-free\n    forM_ handles $ printHandle st . getPlayerLens\n\n\nmain :: IO ()\nmain = test $ GameState [Player \"Bob\", Player \"Joe\"]\n</code></pre>\n\n<hr>\n\n<pre><code>Test.hs:45:38:\n    Couldn't match type `(Player -&gt; f0 Player)\n                         -&gt; GameState -&gt; f0 GameState'\n                  with `forall (f :: * -&gt; *).\n                        Functor f =&gt;\n                        (Player -&gt; f Player) -&gt; GameState -&gt; f GameState'\n    Expected type: PlayerHandle -&gt; PlayerLens\n      Actual type: PlayerHandle\n                   -&gt; (Player -&gt; f0 Player) -&gt; GameState -&gt; f0 GameState\n    In the second argument of `(.)', namely `getPlayerLens'\n    In the second argument of `($)', namely\n      `printHandle st . getPlayerLens'\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["performance", "haskell", "monad-transformers"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1427079836, "post_id": 29202605, "comment_id": 46617120, "body": "Did you compile with optimizations and profile it with criterion?  What were the profiling steps you took to find this slowdown?"}, {"owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1427080564, "post_id": 29202605, "comment_id": 46617268, "body": "Compiled with optimizations, enabled profiling and and ran it with +RTS -p, compared the outputs - the result suggested mostly nothing (apart from that it likely has something to do with the monads). I used the general &#39;time&#39; to check the performance, on my test data it took 2 seconds with &#39;hardcoded Identity&#39; and 3 seconds when allowed to set the Identity monad as a &#39;parameter&#39;."}, {"owner": {"reputation": 5755, "user_id": 394253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/985ef765f821b00d3b41ac5ca8aef6a0?s=128&d=identicon&r=PG", "display_name": "Ed&#39;ka", "link": "https://stackoverflow.com/users/394253/edka"}, "edited": false, "score": 0, "creation_date": 1427084084, "post_id": 29202605, "comment_id": 46617953, "body": "&quot;and using some extensions to get around the types&quot; &lt;- may indicate that something did change as a result. Extended code example in question could help to find explanation sooner."}, {"owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "edited": false, "score": 0, "creation_date": 1427096029, "post_id": 29202605, "comment_id": 46621216, "body": "I had to use Scoped Type variables, as I am internally passing some internal functions to <code>lift $ runST</code> and I needed to have &#39;rigid m&#39; but &#39;free s&#39;. It&#39;s really the type signature that changed."}], "answers": [{"comments": [{"owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "edited": false, "score": 0, "creation_date": 1427101184, "post_id": 29203325, "comment_id": 46623310, "body": "I tried to add it, it seems to have worked in the sense that ddump-simpl seems to show it is indeed specialized (had to add INLINABLE too). It had negligible effect on performance. The thing is I am building lots of lambda expressions running in this monad, maybe they do not get specialized?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "edited": false, "score": 1, "creation_date": 1427110654, "post_id": 29203325, "comment_id": 46628356, "body": "I think we&#39;d need to actually compare the original code to the generalized."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "edited": false, "score": 0, "creation_date": 1427118008, "post_id": 29203325, "comment_id": 46632962, "body": "@ondra, I meant to ping you on that last comment."}, {"owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "edited": false, "score": 0, "creation_date": 1427157036, "post_id": 29203325, "comment_id": 46654524, "body": "I tried to create my own Monad Transformer combining the layers; somehow hardwiring the Identity to original was fastest (1.9s), continuing with ST-like monad with hardwired Identity (2s), State hardwired (2.4s), State/ST-like generalized (2.7s) and the slowest is the original stack of Monads generalized (~3s). I will probably stick with the State-like monad (it&#39;s simplest). The -fdump-simpl is just HUGE (12M with the specialized version), I am not quite sure where to start. The generalized code differs from the non-generalized only by signature and some runIdentity/monadic details."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "edited": false, "score": 0, "creation_date": 1427172492, "post_id": 29203325, "comment_id": 46658359, "body": "@ondra, I was only suggesting dumping simplification in this particular case to see if you would get warning messages in the dump about rule LHS too complicated when you added <code>SPECIALIZE</code> pragmas. If you actually want to read that core, you generally need to use something like <code>-dsuppress-all -dno-suppress-type-signatures</code> to bring it down to a reasonable size."}, {"owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "edited": false, "score": 0, "creation_date": 1427187259, "post_id": 29203325, "comment_id": 46663447, "body": "I did, no warning was generated (compiled with -Wall -ddump-simpl). When I run it in IO monad (the exact same code), it gets to about 3.5s, but I would expect that this could happen."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "edited": false, "score": 0, "creation_date": 1427197498, "post_id": 29203325, "comment_id": 46669693, "body": "@ondra, you&#39;ve reached the limit of my ability to guess wildly without seeing actual code. Sorry."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "edited": false, "score": 0, "creation_date": 1427230292, "post_id": 29203325, "comment_id": 46691260, "body": "@ondra, could you link to the real before and after versions, that we could actually compile?"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 12, "last_activity_date": 1427085292, "creation_date": 1427085292, "answer_id": 29203325, "question_id": 29202605, "link": "https://stackoverflow.com/questions/29202605/when-generalizing-monad-performance-drops-nearly-50/29203325#29203325", "title": "When generalizing monad, performance drops nearly 50%", "body": "<p>This is not so unusual, no. You should try using <code>SPECIALIZE</code> pragmas to specialize to <code>Identity</code>, and maybe <code>IO</code> too. Use <code>-ddump-simpl</code> and watch for warnings about rule left hand sides being too complicated. When specialization doesn't happen as it should, GHC ends up passing around typeclass dictionaries at runtime. This is inherently somewhat inefficient, but more importantly it prevents GHC from inlining class methods to enable further simplification.</p>\n"}], "owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 445, "favorite_count": 3, "answer_count": 1, "score": 10, "last_activity_date": 1427226651, "creation_date": 1427079214, "last_edit_date": 1427226651, "question_id": 29202605, "link": "https://stackoverflow.com/questions/29202605/when-generalizing-monad-performance-drops-nearly-50", "title": "When generalizing monad, performance drops nearly 50%", "body": "<p>I have code that does some parsing of files according to specified rules. The whole parsing takes place in a monad that is a stack of ReaderT/STTrans/ErrorT. </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type RunningRule s a = ReaderT (STRef s LocalVarMap) (STT s (ErrorT String Identity)) a\n</code></pre>\n\n<p>Because it would be handy to run some IO in the code (e.g. to query external databases), I thought I would generalize the parsing, so that it could run both in Identity or IO base monad, depending on the functionality I would desire. This changed the signature to:</p>\n\n<pre><code>type RunningRule s m a = ReaderT (STRef s LocalVarMap) (STT s (ErrorT String m)) a\n</code></pre>\n\n<p>After changing the appropriate type signatures (and using some extensions to get around the types) I ran it again in the Identity monad and it was ~50% slower. Although essentially nothing changed, it is much slower. Is this normal behaviour? Is there some simple way how to make this faster? (e.g. combining the ErrorT and ReaderT (and possibly STT) stack into one monad transformer?)</p>\n\n<p>To add a sample of code - it is a thing that based on a parsed input (given in C-like language) constructs a parser. The code looks like this:</p>\n\n<pre><code>compileRule :: forall m. (Monad m, Functor m) =&gt;\n        -&gt; [Data -&gt; m (Either String Data)] -- For tying the knot\n        -&gt; ParsedRule -- This is the rule we are compiling \n        -&gt; Data -&gt; m (Either String Data) -- The real parsing\ncompileRule compiled (ParsedRule name parsedlines) = \n    \\input -&gt; runRunningRule input $ do\n         sequence_ compiledlines\n   where\n       compiledlines = map compile parsedlines\n       compile (Expression expr) = compileEx expr &gt;&gt; return ()\n       compile (Assignment var expr) = \n       ...\n       compileEx (Function \"check\" expr) = do\n           value &lt;- expr\n           case value of\n               True -&gt; return ()\n               False -&gt; fail \"Check failed\"\n           where\n                code = compileEx expr\n</code></pre>\n"}, {"tags": ["haskell", "ffi"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1427069845, "post_id": 29201318, "comment_id": 46614923, "body": "Maybe it&#39;s a <code>Ptr (Ptr (Ptr CChar))</code> since we have three <code>*</code> in front of <code>args</code> (and <code>CChar</code> is not <code>Char</code>)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1427086002, "post_id": 29201318, "comment_id": 46618305, "body": "I think the translation from C types to Haskell FFI types is pretty straightforward. <code>char***</code> is <code>Ptr (Ptr (Ptr CChar))</code>. As far as I know, there is no way to produce or consume a <code>Ptr [String]</code> (other than castPtr) because <code>[String]</code> is not <code>Storable</code>. So having your function take a <code>Ptr [String]</code> would be pretty silly - you can never actually call it from Haskell, unless you have some other FFI function specifically for creating a <code>Ptr [String]</code> for use with c_initialize."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1427097323, "post_id": 29201318, "comment_id": 46621716, "body": "Hint: A <code>char *</code> is usually a <code>CString</code>."}], "answers": [{"tags": [], "owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "is_accepted": true, "score": 2, "last_activity_date": 1427122052, "creation_date": 1427122052, "answer_id": 29213244, "question_id": 29201318, "link": "https://stackoverflow.com/questions/29201318/haskell-ffi-double-pointer-argument/29213244#29213244", "title": "Haskell FFI double pointer argument", "body": "<p>So, taking all these suggestions into account, it seems like the most fitting signature is something like</p>\n\n<pre><code>foreign import ccall unsafe \"lib.h Initialize\"\nc_initialize :: Ptr CInt \n             -&gt; Ptr (Ptr CString)\n             -&gt; IO (Ptr CInt)\n</code></pre>\n\n<p>Thank you all! will keep you posted</p>\n"}], "owner": {"reputation": 702, "user_id": 2890063, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/07aeeae7c14c12cefde16bf826eceb4a?s=128&d=identicon&r=PG", "display_name": "ocramz", "link": "https://stackoverflow.com/users/2890063/ocramz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "accepted_answer_id": 29213244, "answer_count": 1, "score": 1, "last_activity_date": 1427394938, "creation_date": 1427068302, "last_edit_date": 1427394938, "question_id": 29201318, "link": "https://stackoverflow.com/questions/29201318/haskell-ffi-double-pointer-argument", "title": "Haskell FFI double pointer argument", "body": "<p>I would like to wrap a set of C functions with the following sig.:</p>\n\n<pre><code>ErrorCode Initialize(int *argc,char ***args, ...)\n</code></pre>\n\n<p>How is the double pointer represented in the FFI call? It is a pointer to a list of strings; is the following plausible?</p>\n\n<pre><code>foreign import ccall unsafe \"lib.h Initialize\"\n    c_initialize :: Ptr CInt \n                 -&gt; Ptr [String]\n                 -&gt; IO (Ptr CInt)\n</code></pre>\n\n<p>Or is the second argument a <code>Ptr (Ptr Char)</code>? I can't find this case in the literature I've read so far (Real World Haskell and the Wikibook) and my C is a bit rusty. \nThanks in advance</p>\n\n<p>-- Correction :\nRWH actually shows the interface to <code>pcre_compile()</code>:</p>\n\n<pre><code>-- PCRE-compile.hs\nforeign import ccall unsafe \"pcre.h pcre_compile\"\n  c_pcre_compile :: CString\n                 -&gt; PCREOption\n                 -&gt; Ptr CString\n                 -&gt; Ptr CInt\n                 -&gt; Ptr Word8\n                 -&gt; IO (Ptr PCRE)\n</code></pre>\n\n<p>Which corresponds to:</p>\n\n<pre><code>-- pcre.h\npcre *pcre_compile(const char *pattern,\n               int options,\n               const char **errptr,\n               int *errofset,\n               const unsigned char *tableptr);\n</code></pre>\n"}, {"tags": ["haskell", "functor", "recursive-datastructures"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1427067873, "post_id": 29200492, "comment_id": 46614509, "body": "I would suggest the <a href=\"https://hackage.haskell.org/package/syntactic\" rel=\"nofollow noreferrer\">syntactic</a> library."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1427099814, "last_edit_date": 1427099814, "creation_date": 1427067934, "answer_id": 29201265, "question_id": 29200492, "link": "https://stackoverflow.com/questions/29200492/default-behavior-for-haskell-recursive-data-types/29201265#29201265", "title": "&#39;Default Behavior&#39; for Haskell recursive data types", "body": "<p>This looks as a nice case for <a href=\"http://hackage.haskell.org/package/recursion-schemes\" rel=\"nofollow\">recursion-schemes</a>.</p>\n\n<p>First, we describe your <code>Sentence sym</code> type as a type-level fixed point\nof a suitable functor.</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor, LambdaCase #-}\n\nimport Data.Functor.Foldable  -- from the recursion-schemes package\n\n-- The functor describing the recursive data type\ndata SentenceF sym r\n   = AtomicSentence sym\n   | ImplySentence r r\n   | AndSentence r r\n   | OrSentence r r\n   | NotSentence r\n   deriving (Functor, Show)\n\n-- The original type recovered via a fixed point\ntype Sentence sym = Fix (SentenceF sym)\n</code></pre>\n\n<p>The above <code>Sentence sym</code> type is almost identical to your original one, except everything must be wrapped inside a <code>Fix</code>.\nAdapting the original code to use this type is completely mechanical:\nwhere we used <code>(Constructor ...)</code>, we now use <code>Fix (Constructor ...)</code>. For instance</p>\n\n<pre><code>type Symbol = String\n\n-- A simple formula: not (p -&gt; (p || q))\ntestSentence :: Sentence Symbol\ntestSentence = \n   Fix $ NotSentence $\n      Fix $ ImplySentence\n         (Fix $ AtomicSentence \"p\")\n         (Fix $ OrSentence\n            (Fix $ AtomicSentence \"p\")\n            (Fix $ AtomicSentence \"q\"))\n</code></pre>\n\n<p>Here's your original code, with its redundancies (made worse by the extra <code>Fix</code>es).</p>\n\n<pre><code>-- The original code, adapted\nimply_remove :: Sentence Symbol -&gt; Sentence Symbol\nimply_remove (Fix (ImplySentence s1 s2)) =\n  Fix $ OrSentence (Fix $ NotSentence (imply_remove s1)) (imply_remove s2)\nimply_remove (Fix (AndSentence s1 s2)) =\n  Fix $ AndSentence (imply_remove s1) (imply_remove s2)\nimply_remove (Fix (OrSentence s1 s2)) =\n  Fix $ OrSentence (imply_remove s1) (imply_remove s2)\nimply_remove (Fix (NotSentence s1)) =\n  Fix $ NotSentence (imply_remove s1)\nimply_remove (Fix (AtomicSentence s1)) =\n  Fix $ AtomicSentence s1\n</code></pre>\n\n<p>Let's perform a test by evaluating <code>imply_remove testSentence</code>: the result is what we expect:</p>\n\n<pre><code> -- Output: not ((not p) || (p || q))\n Fix (NotSentence\n   (Fix (OrSentence\n      (Fix (NotSentence (Fix (AtomicSentence \"p\"))))\n      (Fix (OrSentence\n         (Fix (AtomicSentence \"p\"))\n         (Fix (AtomicSentence \"q\")))))))\n</code></pre>\n\n<p>And now, let's use the nuclear weapons borrowed from recursion-schemes:</p>\n\n<pre><code>imply_remove2 :: Sentence Symbol -&gt; Sentence Symbol\nimply_remove2 = cata $ \\case\n   -- Rewrite ImplySentence as follows\n   ImplySentence s1 s2 -&gt; Fix $ OrSentence (Fix $ NotSentence s1) s2\n   -- Keep everything else as it is (after it had been recursively processed)\n   s -&gt; Fix s\n</code></pre>\n\n<p>If we run the test <code>imply_remove2 testSentence</code>, we get the same output as the original code.</p>\n\n<p>What does <code>cata</code> do? Very roughly, when applied to a function like \nin <code>cata f</code>, it builds a <em>catamorphism</em>, i.e. a function which</p>\n\n<ol>\n<li>takes a formula apart into its subcomponents</li>\n<li>recursively apply <code>cata f</code> to the found subcomponents</li>\n<li>reassembles the transformed components into a formula</li>\n<li>passes this last formula (with processed subformulae) to <code>f</code> so that the topmost connective can be affected</li>\n</ol>\n\n<p>The last step is the one doing the actual work. The <code>\\case</code> above performs just the wanted transformation. Everything else is handled by <code>cata</code> (and the <code>Functor</code> instance which has been automagically generated).</p>\n\n<p>All the above being said, I wouldn't recommend anyone to lightly move to \n<code>recursion-schemes</code>. Using <code>cata</code> can lead to very elegant code, yet it requires one to understand the involved machinery, which may not be immediate to grasp (it surely wasn't for me).</p>\n"}, {"tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": false, "score": 3, "last_activity_date": 1427068270, "creation_date": 1427068270, "answer_id": 29201314, "question_id": 29200492, "link": "https://stackoverflow.com/questions/29200492/default-behavior-for-haskell-recursive-data-types/29201314#29201314", "title": "&#39;Default Behavior&#39; for Haskell recursive data types", "body": "<p>What you're looking for is called 'generic programming' in Haskell: <a href=\"https://wiki.haskell.org/Generics\" rel=\"nofollow\">https://wiki.haskell.org/Generics</a>; an early form was called \"Scrap Your Boilerplate\", which you also might want to Google.  I haven't tested this, but I think if you use <a href=\"http://community.haskell.org/~ndm/uniplate/\" rel=\"nofollow\" title=\"Uniplate\">Uniplate</a>'s <code>Data.Generics.Uniplate</code> and <code>Data.Generics.Uniplate.Data</code> modules you can define <code>imply_remove</code> as</p>\n\n<pre><code>imply_remove = transform w where\n    w (ImplySentence s1 s2) = OrSentence (NotSentence s1) s2\n    w s = s\n</code></pre>\n\n<p><code>transform</code> does the recursion for you.</p>\n"}, {"tags": [], "owner": {"reputation": 1251, "user_id": 3973371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb6b82669e037ed73e47d6532ef2c246?s=128&d=identicon&r=PG&f=1", "display_name": "bmaderbacher", "link": "https://stackoverflow.com/users/3973371/bmaderbacher"}, "is_accepted": true, "score": 3, "last_activity_date": 1427069205, "last_edit_date": 1427069205, "creation_date": 1427068757, "answer_id": 29201386, "question_id": 29200492, "link": "https://stackoverflow.com/questions/29200492/default-behavior-for-haskell-recursive-data-types/29201386#29201386", "title": "&#39;Default Behavior&#39; for Haskell recursive data types", "body": "<p>You could write a default function that defines how a Symbol should be treated if no transformation applies to it:</p>\n\n<pre><code>default_transformation :: (Sentence Symbol -&gt; Sentence Symbol) -&gt; Sentence Symbol -&gt; Sentence Symbol\ndefault_transformation f (ImplySentence s1 s2) = ImplySentence (f s1) (f s2)\ndefault_transformation f (AndSentence s1 s2) = AndSentence (f s1) (f s2)\ndefault_transformation f (OrSentence s1 s2) = OrSentence (f s1) (f s2)\ndefault_transformation f (NotSentence s1) = NotSentence (f s1)\ndefault_transformation f (AtomicSentence s1) = AtomicSentence s1\n</code></pre>\n\n<p>The function takes the specific transformation as a parameter.</p>\n\n<p>If you write your specific transformation you only need to write the cases that a are different from the default and add the default as a last case:</p>\n\n<pre><code>imply_remove :: Sentence Symbol -&gt; Sentence Symbol\nimply_remove (ImplySentence s1 s2) = OrSentence (NotSentence (imply_remove s1)) (imply_remove s2)\nimply_remove s = default_transformation imply_remove s\n</code></pre>\n\n<p>The advantage of this approach is that it maybe easier to implement, because it doesn't need any dependencies.</p>\n"}], "owner": {"reputation": 43, "user_id": 4700962, "user_type": "registered", "profile_image": "https://graph.facebook.com/10105025274691053/picture?type=large", "display_name": "rwturner", "link": "https://stackoverflow.com/users/4700962/rwturner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 1, "accepted_answer_id": 29201386, "answer_count": 3, "score": 4, "last_activity_date": 1427099814, "creation_date": 1427062511, "question_id": 29200492, "link": "https://stackoverflow.com/questions/29200492/default-behavior-for-haskell-recursive-data-types", "title": "&#39;Default Behavior&#39; for Haskell recursive data types", "body": "<p>I'm trying to write a propositional logic solver in Haskell. I'm representing logical expressions with a recursive data type called 'Sentence' that has several subtypes for different operations - 'AndSentence', 'OrSentence', etc. So I guess it's a tree with several types of node each having 0, 1, or 2 children.</p>\n\n<p>It seems to be working but some of the code is kind of repetitive and I think there ought to be a better way to express it. Basically I have several functions where the 'default behavior' is to just have the function act recursively on the children of a node, bottoming out on certain node types (typically the 'AtomicSentences', which are leaves). So I write a function like:</p>\n\n<pre><code>imply_remove :: Sentence Symbol -&gt; Sentence Symbol\nimply_remove (ImplySentence s1 s2) = OrSentence (NotSentence (imply_remove s1)) (imply_remove s2)\nimply_remove (AndSentence s1 s2) = AndSentence (imply_remove s1) (imply_remove s2)\nimply_remove (OrSentence s1 s2) = OrSentence (imply_remove s1) (imply_remove s2)\nimply_remove (NotSentence s1) = NotSentence (imply_remove s1)\nimply_remove (AtomicSentence s1) = AtomicSentence s1\n</code></pre>\n\n<p>and I want a more concise way to write the lines for 'AndSentence', 'OrSentence', and 'NotSentence'.</p>\n\n<p>It seems like functors are similar to what I want, but that didn't work out... I want to act on the subtrees, not on some values contained in each node of the subtrees.</p>\n\n<p>Is there a right way to do this? Or a more natural way to structure my data?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 6, "creation_date": 1427060362, "post_id": 29200082, "comment_id": 46612559, "body": "Have you looked at <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Data-List.html#v:transpose\" rel=\"nofollow noreferrer\"><code>Data.List.transpose</code></a>?  You can view the source from the documentation and see how it&#39;s implemented there.  Try converting it from list comprehensions to use <code>map</code> instead."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1427071977, "post_id": 29200082, "comment_id": 46615431, "body": "Indeed, even writing down the signature <a href=\"https://www.haskell.org/hoogle/?hoogle=%5B%5Ba%5D%5D+-%3E+%5B%5Ba%5D%5D\" rel=\"nofollow noreferrer\">would have been enough</a> to find the standard implementation of this..."}], "answers": [{"comments": [{"owner": {"reputation": 2536, "user_id": 4700890, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-z2a4JCF80-0/AAAAAAAAAAI/AAAAAAAAAIU/fFL94G1PsUU/photo.jpg?sz=128", "display_name": "Fernando Aguilar", "link": "https://stackoverflow.com/users/4700890/fernando-aguilar"}, "edited": false, "score": 0, "creation_date": 1427259582, "post_id": 29224685, "comment_id": 46700468, "body": "Thanks a lot, now I understand how works correctly, it&#39;s a bit complex when you are new in this language.  Again thank you for the help :)"}], "tags": [], "owner": {"reputation": 685, "user_id": 3222117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uEbIs.jpg?s=128&g=1", "display_name": "Alexandre Lucchesi", "link": "https://stackoverflow.com/users/3222117/alexandre-lucchesi"}, "is_accepted": true, "score": 0, "last_activity_date": 1427168745, "creation_date": 1427168745, "answer_id": 29224685, "question_id": 29200082, "link": "https://stackoverflow.com/questions/29200082/separate-list-by-heads/29224685#29224685", "title": "separate List by heads", "body": "<p>I adapted the functions you wrote, <code>joinHead</code> and <code>separateLists</code>, to make the code work, while preserving the logic you were following. From what I could infer looking at these functions, the idea was to use <code>joinHead</code> to extract the first element of each child list and return a new list. Then, this new list should be inserted in the front of a list of lists returned from calling <code>separateLists</code> recursively.</p>\n\n<p>Here is the new definition of <code>joinHead</code>:</p>\n\n<pre><code>joinHead :: [[a]] -&gt; [a]\njoinHead ([]:_) = []\njoinHead xs     = map head xs\n</code></pre>\n\n<p>Note that the first line checks, through pattern matching, whether the first list contained in the list of lists is empty and, if so, returns an empty list (<code>[]</code>). The reasons for that are two:</p>\n\n<ol>\n<li>The function <code>head</code> is unsafe. That means that calling <code>head</code> on an empty list will cause an exception to be thrown (try running in GHCi <code>head []</code>);</li>\n<li>For simplicity, I'm assuming that all the lists were already checked to have the same length (<code>length (xs !! 0) == length (xs !! 1) ...</code>).</li>\n</ol>\n\n<p>The definition of <code>separateLists</code> is as follows:</p>\n\n<pre><code>separateLists :: [[a]] -&gt; [[a]]\nseparateLists ([]:_)   = []\nseparateLists ([x]:xs) = [joinHead ([x]:xs)]\nseparateLists xs       = joinHead xs : separateLists (map tail xs)\n</code></pre>\n\n<p>Again, the first two definitions are necessary for both stopping the recursion and safety purposes. The first line says: \"if the first list is empty, then all the elements of all lists were already consumed, so return <code>[]</code>\". The second line says: \"if the first line has exactly one element, then just call <code>joinHead</code> and return the result wrapped in a list\". Note that in the third definition we have a call to <code>tail</code> which, like <code>head</code>, throws exceptions when called on <code>[]</code>. That's the reason of why we need a separate case for lists of length 1. Finally, the third line, which is executed for lists of length greater than 1, gets a list from <code>joinHead xs</code> and insert it (using the \"cons\" operator <code>(:)</code>) in the beginning of the list returned from recursively calling <code>separateLists</code>. In this call, we have to take out the first elements of all the lists, that's why we use <code>map tail xs</code>.</p>\n\n<p>Now, running:</p>\n\n<pre><code>\u03bb: let list = [[1,2,3,4],[5,6,7,8],[9,10,11,12],[13,14,15,16,17]]\n\u03bb: separateLists list\n[[1,5,9,13],[2,6,10,14],[3,7,11,15],[4,8,12,16]]\n</code></pre>\n\n<p>will give you the expected results. I hope it was clear enough. As a final note, I want to point out that this implementation is far from being optimal and, as suggested in the comments, you should probably use the standard <code>Data.List.transpose</code>. As an exercise and didatic example, it's fine! ;-)</p>\n"}], "owner": {"reputation": 2536, "user_id": 4700890, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-z2a4JCF80-0/AAAAAAAAAAI/AAAAAAAAAIU/fFL94G1PsUU/photo.jpg?sz=128", "display_name": "Fernando Aguilar", "link": "https://stackoverflow.com/users/4700890/fernando-aguilar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 472, "favorite_count": 0, "accepted_answer_id": 29224685, "answer_count": 1, "score": 0, "last_activity_date": 1427168745, "creation_date": 1427059818, "question_id": 29200082, "link": "https://stackoverflow.com/questions/29200082/separate-list-by-heads", "title": "separate List by heads", "body": "<p>I have problems trying to separate a list follows, suppose we have the following lists </p>\n\n<hr>\n\n<pre><code>[[1,2,3,4], [5,6,7,8], [9,10,11,12 ], [13,14,15,16,17]].\n</code></pre>\n\n<hr>\n\n<p>The result should be:</p>\n\n<pre><code>[[1,5,9,13] [2,6,10,14] [3,7,11,16] [4,8,12,16]]\n</code></pre>\n\n<p>I'm trying to do it the following way:</p>\n\n<pre><code>joinHead (x: xs) = map head (x: xs)\nseparateLists (x: xs) = xs joinHead x ++ separateLists\n</code></pre>\n\n<p>obviously this does not work. I hope you can help me. thx.</p>\n"}, {"tags": ["haskell", "yesod", "hamlet"], "answers": [{"tags": [], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "is_accepted": false, "score": 1, "last_activity_date": 1427079980, "creation_date": 1427079980, "answer_id": 29202701, "question_id": 29198921, "link": "https://stackoverflow.com/questions/29198921/run-whamlet-in-pure-code/29202701#29202701", "title": "run whamlet in pure code?", "body": "<p>This works: get the render function (in the monad), and apply (in pure code)</p>\n\n<pre><code>render &lt;- getUrlRender \nlet d = graphToDot ... \n     [ URL $ render $ MyRoute ... ]\n</code></pre>\n\n<p>I found this here, where a similar problem is solved: <a href=\"https://github.com/yesodweb/yesod/wiki/Using-type-safe-urls-from-inside-javascript\" rel=\"nofollow\">https://github.com/yesodweb/yesod/wiki/Using-type-safe-urls-from-inside-javascript</a></p>\n"}], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1427079980, "creation_date": 1427052884, "last_edit_date": 1427054306, "question_id": 29198921, "link": "https://stackoverflow.com/questions/29198921/run-whamlet-in-pure-code", "title": "run whamlet in pure code?", "body": "<p>In a yesod application, I want to create URL attributes for a graph that will be rendered by <a href=\"http://hackage.haskell.org/package/graphviz\" rel=\"nofollow\">graphviz</a> , and I want to use interpolation. Ideally,</p>\n\n<pre><code>graphToDot nonClusteredParams { fmtNode = \\ (n,l) -&gt; \n     [ URL [whamlet| @{MyRoute ...} |]\n   } g\n</code></pre>\n\n<p>Of course, the types don't match:</p>\n\n<ul>\n<li>attribute of <code>URL</code> is pure <code>Text</code>, but <code>whamlet</code> is monadic (widget)</li>\n<li>when I replace by <code>shamlet</code>, type is fine, but it cannot interpolate: <code>URL interpolation used, but no URL renderer provided</code></li>\n</ul>\n\n<p>Is there an easy way to solve this? </p>\n"}, {"tags": ["json", "haskell", "post", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 0, "creation_date": 1427042097, "post_id": 29196507, "comment_id": 46606557, "body": "Thanks for a quick answer! I might end up going with this but it&#39;s still far from ideal. A lot of unnecessary processing not to mention fetching the whole entity from the db - a whole another query. What I would really want is a way to translate the json stuff to a persistent update statement."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 0, "creation_date": 1427045039, "post_id": 29196507, "comment_id": 46607545, "body": "While it&#39;s possible to derive something like that automatically using Template Haskell or GHC Generics, that code hasn&#39;t been written yet. You may be able to take a crack at writing some such code, which would then give you full flexibility to implement this exactly as you want."}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1427055905, "post_id": 29196507, "comment_id": 46611210, "body": "If you end up using this approach, watch out for race conditions where request A and B pull the value from the database at the same time, then request A updates one property and request B updates a different one. Since the requests are replacing the full record, request B could overwrite A&#39;s changes, even if they were updating separate fields."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 2, "last_activity_date": 1427039807, "creation_date": 1427039807, "answer_id": 29196507, "question_id": 29195770, "link": "https://stackoverflow.com/questions/29195770/handling-json-posts-in-yesod/29196507#29196507", "title": "Handling JSON posts in Yesod", "body": "<p>I've never tried this, but here's a theoretical approach:</p>\n\n<ol>\n<li>Grab the current value from the database</li>\n<li>Serialize that value to an aeson <code>Value</code> by calling <code>toJSON</code></li>\n<li>Write some kind of \"update\" algorithm that merges two <code>Value</code>s together, e.g. <code>mergeValues :: Value -&gt; Value -&gt; Value</code></li>\n<li>Merge the original entity with the value uploaded by the user</li>\n<li>Try to parse the resulting value with <code>parseJSON</code></li>\n<li>If it succeeds, use <code>replace</code> to put it back into the database</li>\n</ol>\n"}], "owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "accepted_answer_id": 29196507, "answer_count": 1, "score": 0, "last_activity_date": 1427039807, "creation_date": 1427035709, "last_edit_date": 1427037288, "question_id": 29195770, "link": "https://stackoverflow.com/questions/29195770/handling-json-posts-in-yesod", "title": "Handling JSON posts in Yesod", "body": "<p>An AngularJS client is sending a JSON post to a Yesod server to update a person record. The post can contain the following fields each of which is optional - the client can send any subset of these:</p>\n\n<ul>\n<li>firstName</li>\n<li>lastName</li>\n<li>...</li>\n<li>active</li>\n</ul>\n\n<p>To limit the discussion a bit lets assume the client, at the moment, only wants to toggle activity, so it will only send the active value (it specifically wants to keep the rest intact) and the message will be:</p>\n\n<pre><code>{\n  active: 0\n}\n</code></pre>\n\n<p>On the server now, we know the id of the person from the URL (eg. /api/v1.0/person/1) but the client does not send a complete Person entity, so the usual:</p>\n\n<pre><code>person &lt;- requireJsonBody :: Handler Person\n_ &lt;- runDB $ update personId ...\n</code></pre>\n\n<p>will not work here. It would seem a more flexible approach is needed. Maybe something along the lines of:</p>\n\n<pre><code>mapToUpdate :: PersonInfo -&gt; [Update PersonInfo]\n</code></pre>\n\n<p>where PersonInfo is an instance of <code>FromJSON</code> and is defined to match Person but has all the fields of type <code>Maybe a</code>. However, that seems totally contrary to DRY.</p>\n\n<p>So to wrap this up: how would one handle such a use case in Yesod nicely going back and assuming again the client can send any subset of a Person's fields?</p>\n\n<p>You could imagine even more horrifying scenarios. For example one JSON post needing to be mapped to an update of multiple database entities (api entities do not have to map 1:1 to database entities).</p>\n"}, {"tags": ["haskell", "memoization"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 4, "creation_date": 1427029071, "post_id": 29194315, "comment_id": 46602328, "body": "Does pre-processing of A depend on B or vice versa? If pre-processing doesn&#39;t depend on other arguments, why not just move it of the function: <code>f1 &lt;$&gt; [procA a1, procA a2] &lt;*&gt; [procB b1, procB b2] &lt;*&gt; ...</code> Now preprocessing is guaranteed to run only once for each argument."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1427029391, "post_id": 29194315, "comment_id": 46602427, "body": "I mean &quot;move it out of the function&quot;."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1427031268, "post_id": 29194315, "comment_id": 46602963, "body": "&quot;does not recompute the values is[as?] intended&quot; is an ambiguous phrasing: it could also mean &quot;I expected it to recompute, and it did not&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 12530, "user_id": 381619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8f67f35200cf319e30329dddd412b6d?s=128&d=identicon&r=PG", "display_name": "Neil Mayhew", "link": "https://stackoverflow.com/users/381619/neil-mayhew"}, "is_accepted": false, "score": 1, "last_activity_date": 1431638902, "last_edit_date": 1431638902, "creation_date": 1431637150, "answer_id": 30247232, "question_id": 29194315, "link": "https://stackoverflow.com/questions/29194315/memoizing-arguments-independently/30247232#30247232", "title": "Memoizing arguments independently", "body": "<p>You need a function that memoizes both <code>a</code> and <code>b</code> together:</p>\n\n<pre><code>f12 a b = ...\n    in \\c -&gt; ...\n</code></pre>\n\n<p>When you want to memoize <code>a</code> but not <code>b</code>, you use <code>f1 a</code> and when you want to memoize both you use <code>f12 a b</code>.</p>\n\n<p>It would of course be nice to share some implementation between <code>f1</code> and <code>f12</code>. However, you can do that only by having private functions that take the precomputed results in place of the original values:</p>\n\n<pre><code>f1 a = privateA (precomputeA a)\nf12 a b = privateAB (precomputeA a) (precomputeB b)\nprivateA a' b = privateAB a' (precomputeB b)\nprivate AB a' b' c = ...\n</code></pre>\n\n<p>If the precomputation of <code>b</code> depends on the precomputation of <code>a</code>, then:</p>\n\n<pre><code>f1 a = privateA (precomputeA a)\nf12 a b = let a' = precomputeA a in privateAB a' (precomputeB a' b)\nprivateA a' b = privateAB a' (precomputeB a' b)\nprivate AB a' b' c = ...\n</code></pre>\n\n<p>I've purposely not used function composition and eta-reduction, to make things clearer. I've also left out any strictness annotations that you might want to use to control times of evaluation.</p>\n\n<p>Perhaps memoizing isn't quite the right term here. You mean something like \"partial application with some precomputation as well.\"</p>\n"}], "owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1431638902, "creation_date": 1427027028, "last_edit_date": 1492087139, "question_id": 29194315, "link": "https://stackoverflow.com/questions/29194315/memoizing-arguments-independently", "title": "Memoizing arguments independently", "body": "<p>I have a simulation with lots of calls to functions of the <code>type F = A -&gt; B -&gt; C -&gt; D</code>, where <code>A</code>..<code>D</code> are concrete types.</p>\n\n<p>The objects of type <code>A</code> have a medium lifetime. (It is the genome of <a href=\"https://codegolf.stackexchange.com/questions/44707/lab-rat-race-an-exercise-in-genetic-algorithms\">codegolf's ratrace</a>.)</p>\n\n<p>The most expensive computation arises from parameter <code>A</code>. I can easily memoize like this:</p>\n\n<pre><code>f1 :: F\nf1 a = let expensive = trace \"expensive computation!\" $ expensiveComputation a\n        in \\b c -&gt; expensive\n</code></pre>\n\n<p>and hold some pre-processed <code>expensive</code> values via partial application:</p>\n\n<pre><code>preProz :: [B -&gt; C -&gt; D]\npreProz = [f1 [], f1 [False], f2 []]\n</code></pre>\n\n<p>The traces indicate that <code>preProz &lt;*&gt; [[],[[]]] &lt;*&gt; [1,2]</code> does not recompute the values to my delight.</p>\n\n<p>Now I found out that some of my <code>F</code>s would benefit from pre-processing <code>B</code>, too. This pre-processing is <em>independent</em> from <code>A</code>, and, in fact, memoizing like this has no benefit</p>\n\n<pre><code>f2 a = let expensive = trace \"expensive computation!\" $ expensiveComputation a\n        in \\b -&gt; let dear = trace \"expensive computation!\" $ expensiveComputation b\n                  in expensive + dear\n</code></pre>\n\n<p>because <code>dear</code> is recomputed, even is the <code>b</code>s equal.</p>\n\n<p>What I need is something like:</p>\n\n<pre><code>(B -&gt; e) -&gt; A -&gt; e -&gt; C -&gt; D\n</code></pre>\n\n<p>where <code>e</code> should be memoized. The type of <code>e</code> is sort-of-existential here.\nBut this forces me to recompute all values <code>A</code> for every <code>B</code>, which is just as bad, and I cannot save the <code>e</code>s, which are private to the function.</p>\n\n<p>How can I memoize along 2 parameters independently?</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1427021328, "post_id": 29193338, "comment_id": 46600274, "body": "Wild guess: the dreaded monomorphism restriction."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1427021380, "post_id": 29193338, "comment_id": 46600285, "body": "@Jubobs That would be my guess as well - except that doesn&#39;t an explicit type signature disable that?"}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 1, "creation_date": 1427043038, "post_id": 29193338, "comment_id": 46606877, "body": "Are you using an old version of GHC? I&#39;m on 7.8.3 and I get the type signature you&#39;d <i>generally</i> expect (<code>Show a =&gt; a -&gt; IO ()</code>), even without using a signature expression. Getting <code>() -&gt; IO ()</code> seems like an actual problem with GHC."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1427061549, "post_id": 29193338, "comment_id": 46612890, "body": "@MasterMastic GHCi 7.4.2"}, {"owner": {"reputation": 9240, "user_id": 347934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36f498ead2f3466671f5225079b48c77?s=128&d=identicon&r=PG", "display_name": "MvanGeest", "link": "https://stackoverflow.com/users/347934/mvangeest"}, "edited": false, "score": 1, "creation_date": 1427066825, "post_id": 29193338, "comment_id": 46614291, "body": "The monomorphism restriction was turned off by default in GHCi 7.8.1 (<i>for GHCi only</i>), see <a href=\"https://downloads.haskell.org/~ghc/7.8.1/docs/html/users_guide/release-7-8-1.html#idp5920480\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/7.8.1/docs/html/users_guide/&hellip;</a>."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 9240, "user_id": 347934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36f498ead2f3466671f5225079b48c77?s=128&d=identicon&r=PG", "display_name": "MvanGeest", "link": "https://stackoverflow.com/users/347934/mvangeest"}, "edited": false, "score": 1, "creation_date": 1427108767, "post_id": 29193338, "comment_id": 46627358, "body": "@MvanGeest Is it because of the number of SO questions? ;-)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427113465, "post_id": 29193338, "comment_id": 46630048, "body": "@MathematicalOrchid, that&#39;s pretty old. You should think about upgrading to 7.8, or I suppose you can wait another week or three for 7.10."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427114843, "post_id": 29193338, "comment_id": 46630862, "body": "@dfeuer Really? I didn&#39;t think I installed it all that long ago... (Then again, I didn&#39;t think I&#39;ve been using Haskell that long, and then I found a blog post I wrote <b>ten years ago</b>!...)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427117925, "post_id": 29193338, "comment_id": 46632900, "body": "@MathematicalOrchid, 7.4.2 was released in June 2012. There have been some pretty nifty improvements since then."}], "answers": [{"comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1427043565, "post_id": 29193692, "comment_id": 46607055, "body": "I always recommend the <code>:set +m</code> flag, which lets you do multi-line input in GHCi.  It&#39;s really handy for instances like this, although I wish GHCi had smart indentation with multi-line input like IPython (project Jupyter is working on fixing this, though)"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 17, "last_activity_date": 1427023096, "creation_date": 1427023096, "answer_id": 29193692, "question_id": 29193338, "link": "https://stackoverflow.com/questions/29193338/ghci-ignores-type-signature/29193692#29193692", "title": "GHCi ignores type signature", "body": "<p>We can do the following, with monomorphism restriction on:</p>\n\n<pre><code>&gt;let myprint :: Show x =&gt; x -&gt; IO (); myprint = putStrLn . show\n&gt;:t myprint\nmyprint :: Show x =&gt; x -&gt; IO ()\n</code></pre>\n\n<p>This is not the same as <code>let myprint = putStrLn . show :: Show x =&gt; x -&gt; IO ()</code>. In the former case we have a binding with a type signature, in the latter case we a have a <code>let</code> binding with a type annotation inside the right hand side. Monomorphism checks top-level type signatures, but not local annotations.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 21, "last_activity_date": 1427112882, "last_edit_date": 1427112882, "creation_date": 1427023493, "answer_id": 29193760, "question_id": 29193338, "link": "https://stackoverflow.com/questions/29193338/ghci-ignores-type-signature/29193760#29193760", "title": "GHCi ignores type signature", "body": "<p>Adding a type annotation to an <em>expression</em> as in</p>\n\n<pre><code>e :: type\n</code></pre>\n\n<p>makes the compiler check that <code>e</code> has that <code>type</code>, as well as use that <code>type</code> to drive type variables instantiation and instance selection. <em>However</em>, if the <code>type</code> is polymorphic it can still be instantiated later on. Consider e.g.</p>\n\n<pre><code>(id :: a -&gt; a) \"hello\"\n</code></pre>\n\n<p>Above, <code>a</code> will be instantiated to <code>String</code>, despite my annotation. Further,</p>\n\n<pre><code>foo :: Int -&gt; Int\nfoo = (id :: a -&gt; a)\n</code></pre>\n\n<p>will make <code>a</code> to be instantiated to <code>Int</code> later on. The above <code>id</code> annotation does not give any information to GHC: it already knows that <code>id</code> has that type.\nWe could remove it without affecting the type checking at all. That is, the expressions <code>id</code> and <code>id :: a-&gt;a</code> are not only dynamically equivalent, but also statically such.</p>\n\n<p>Similarly, the expressions</p>\n\n<pre><code>putStrLn . show\n</code></pre>\n\n<p>and</p>\n\n<pre><code>(putStrLn . show) :: Show x =&gt; x -&gt; IO ()\n</code></pre>\n\n<p>are statically equivalent: we are just annotating the code with the type GHC can infer. In other words, we are not providing any information to GHC it does not already know.</p>\n\n<p>After the annotation is type checked, GHC can then instantiate <code>x</code> further. The monomorphism restriction does that in your example. To prevent that, use an annotation for the <em>binding</em> you are introducing, not for the <em>expression</em>:</p>\n\n<pre><code>myprint :: Show x =&gt; x -&gt; IO ()\nmyprint = (putStrLn . show)\n</code></pre>\n"}], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 618, "favorite_count": 3, "accepted_answer_id": 29193692, "answer_count": 2, "score": 20, "last_activity_date": 1427112882, "creation_date": 1427020682, "last_edit_date": 1427021106, "question_id": 29193338, "link": "https://stackoverflow.com/questions/29193338/ghci-ignores-type-signature", "title": "GHCi ignores type signature", "body": "<pre><code>Prelude&gt; let myprint = putStrLn . show\nPrelude&gt; :t myprint\nmyprint :: () -&gt; IO ()\n</code></pre>\n\n<p>OK, nothing too unusual here. Just GHCi type defaulting rules, I guess...</p>\n\n<pre><code>Prelude&gt; let myprint = (putStrLn . show) :: Show x =&gt; x -&gt; IO ()\nPrelude&gt; :t myprint\nmyprint :: () -&gt; IO ()\n</code></pre>\n\n<p>What sorcery is this?? You're point-blank <em>ignoring</em> my type declaration?! O_O</p>\n\n<p>Is there some way I can convince GHCi to do what I actually intended?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1427016924, "post_id": 29192821, "comment_id": 46599274, "body": "What do you want to do, exactly? <code>read</code> does not do any I/O, so it can&#39;t be chained to a sequence of I/O actions."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 3, "creation_date": 1427021337, "post_id": 29192821, "comment_id": 46600275, "body": "Note that <code>&gt;&gt;</code> is <i>one</i> operator; Haskell sees the two characters as one name. (Much like <code>getLine</code> is one name, not a sequence of separate letters.) Haskell allows you to define new operators; for example, if you wanted to define a function called <code>**?!</code>, you can..."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1427018324, "post_id": 29192877, "comment_id": 46599590, "body": "hi chi, thanks for your answer... is the purpose of <code>do</code> block to avoid prefixing statement with <code>&gt;</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1427019848, "post_id": 29192877, "comment_id": 46599934, "body": "@MadhavanKumar Yes, do notation is a more convenient notation for <code>&gt;&gt;</code> and <code>&gt;&gt;=</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1427017515, "last_edit_date": 1427017515, "creation_date": 1427017189, "answer_id": 29192877, "question_id": 29192821, "link": "https://stackoverflow.com/questions/29192821/get-and-put-a-string-in-haskell-throws-error/29192877#29192877", "title": "Get and put a string in Haskell throws error", "body": "<blockquote>\n  <p>1) does two greater than symbols mean a new statement?</p>\n</blockquote>\n\n<p>In this context, yes. In the IO monad, <code>&gt;&gt;</code> is a rough equivalent of the <code>;</code> in many imperative programming languages.</p>\n\n<blockquote>\n  <p>2) what does two greater than symbols followed by equal sign mean?</p>\n</blockquote>\n\n<p><code>x &gt;&gt;= y</code> is like <code>x &gt;&gt; y</code> except it takes the result of <code>x</code> and applies to <code>y</code>, which has to be a function. Briefly put, <code>getLine &gt;&gt;= \\a -&gt; action</code> means \"read a line, bind that value to variable <code>a</code>, and run <code>action</code> (which can depend from <code>a</code>).</p>\n\n<p>I'd recommend a monad tutorial to fully understand these. You can start with a general tutorial such as <a href=\"http://learnyouahaskell.com/\">LYAH</a>.</p>\n\n<p>Your code is more commonly written in <code>do</code> notation:</p>\n\n<pre><code>main = do\n  putStrLn \"Enter 1st String:\"  \n  a &lt;- getLine\n  read a\n</code></pre>\n\n<p>where the last line makes no sense: <code>read</code> returns a value but does not do any I/O, so we can not chain that to a sequence of I/O actions. This triggers a compiler error. If you know some imperative programming, think about the pseudocode</p>\n\n<pre><code>print(\"some message\");\na = inputLine();\ntoInteger(a);\n</code></pre>\n\n<p>The last line makes no sense: it converts the string into an integer... and then does not use the result in any way.</p>\n"}, {"tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": false, "score": 2, "last_activity_date": 1427029876, "last_edit_date": 1427029876, "creation_date": 1427017899, "answer_id": 29192972, "question_id": 29192821, "link": "https://stackoverflow.com/questions/29192821/get-and-put-a-string-in-haskell-throws-error/29192972#29192972", "title": "Get and put a string in Haskell throws error", "body": "<p>About your second question: your <code>main</code> is not a valid monadic expression. When specialised to the <code>IO</code> monad, the <em>bind</em> and <em>then</em> operators have type</p>\n\n<pre><code>(&gt;&gt;=) :: IO a -&gt; (a -&gt; IO b) -&gt; IO b\n(&gt;&gt;)  :: IO a -&gt;     IO b    -&gt; IO b\n</code></pre>\n\n<p>If you try to align the types of your <code>main</code> expression, you will identify the problem very quickly:</p>\n\n<pre><code>putStrLn \"Enter 1st String:\"  &gt;&gt;  getLine   &gt;&gt;=  \\a -&gt; read a\n\n{           IO ()          }    {IO String}      {actual: Read t =&gt; String -&gt; t   }\n\n{                  IO String              }      {expected:         String -&gt; IO t}         ???         }\n</code></pre>\n\n<p>The type expected for the second argument of <code>&gt;&gt;=</code> is <code>String -&gt; IO t</code>, but <code>read</code> doesn't return an <code>IO</code> value.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 29192877, "answer_count": 2, "score": -2, "last_activity_date": 1427121353, "creation_date": 1427016757, "last_edit_date": 1427121353, "question_id": 29192821, "link": "https://stackoverflow.com/questions/29192821/get-and-put-a-string-in-haskell-throws-error", "title": "Get and put a string in Haskell throws error", "body": "<p>I found the following Haskell code, but I'm confused:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main = putStrLn \"Enter 1st String:\"  \n  &gt;&gt; getLine\n  &gt;&gt;= \\a -&gt; read a\n</code></pre>\n\n<ol>\n<li><p>What do the two \"greater than\" symbols (<code>&gt;&gt;</code>) mean? A new statement?</p></li>\n<li><p>What do the two \"greater than\" symbols followed by an equal sign (<code>&gt;&gt;=</code>) mean?</p></li>\n</ol>\n\n<p>This Haskell code throws the following error:</p>\n\n<pre><code>a.hs:3:13:\nNo instance for (Read (IO t0)) arising from a use of \u2018read\u2019\nIn the expression: read a\nIn the second argument of \u2018(&gt;&gt;=)\u2019, namely \u2018\\ a -&gt; read a\u2019\nIn the expression:\n  putStrLn \"Enter 1st String:\" &gt;&gt; getLine &gt;&gt;= \\ a -&gt; read a\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "yum"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1427020762, "post_id": 29192314, "comment_id": 46600149, "body": "I would just do a complete uninstall, and redo everything. I&#39;ve had to do that before."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1427022114, "post_id": 29192314, "comment_id": 46600486, "body": "<a href=\"https://ghc.haskell.org/trac/ghc/wiki/Building/QuickStart\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/wiki/Building/QuickStart</a> Claims that you&#39;re supposed to do <code>make</code> and then <code>make install</code>. I don&#39;t know if that&#39;s significant. It also says a few other things about tweaking <code>PATH</code> and so on..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1427026069, "post_id": 29192314, "comment_id": 46601482, "body": "make with no arguments fail as &quot;&quot;&quot;make: *** [default] Error 1&quot;&quot;&quot;... it doesn&#39;t help... i am installing ghc and it says &#39;cannot find the program ghc&#39;... ironical!"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1427039226, "post_id": 29192314, "comment_id": 46605524, "body": "Um...  Are you installing the precompiled binary for your platform, or building from source? The two are very different, and you report having mixed the steps for the two."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1427041606, "post_id": 29192314, "comment_id": 46606369, "body": "since precompiled binary is very old, i completely removed all yum rpms (cleaned dependencies as well).. and tried to do source installation..."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1427061986, "post_id": 29192314, "comment_id": 46613008, "body": "GHC is a self-hosting compiler, which means that you <i>must</i> have a precompiled binary of a reasonably recent version in order to compile it from source. In fact 7.0.4 is too old to compile 7.8.4. The 7.8.* series seems to require at least 7.4."}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 156, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1427081809, "creation_date": 1427012233, "last_edit_date": 1427081809, "question_id": 29192314, "link": "https://stackoverflow.com/questions/29192314/ghc-7-8-4-source-installation-via-make-fails-on-centos-6-6", "title": "ghc 7.8.4 source installation via make fails on Centos 6.6", "body": "<p>Before installing ghc on my Centos 6.6, i printed available ghc in centos repo using, </p>\n\n<pre><code> yum --showduplicates list ghc | expand\n</code></pre>\n\n<p>and got,</p>\n\n<pre><code>ghc.x86_64                           7.0.4-46.el6                           epel\n</code></pre>\n\n<p>But since 7.0.4 is old, i downloaded <code>ghc-7.8.4-x86_64-unknown-linux-centos65.tar</code> from <a href=\"https://www.haskell.org/ghc/download_ghc_7_8_3#x86_64linux\" rel=\"nofollow\">haskell-downloads</a> and did <code>./configure &amp;&amp; make install</code>.\nIt gave error as,</p>\n\n<pre><code>Configuring ghc-prim-0.3.1.0...\nghc-cabal: Cannot find the program 'ghc' at\n'/root/ghc-7.8.4/inplace/bin/ghc-stage1' or on the path\nmake[1]: *** [install_packages] Error 1\nmake: *** [install] Error 2\n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 1, "creation_date": 1427011007, "post_id": 29192163, "comment_id": 46598083, "body": "Not sure if the order of your functions is relevant here. (B:xs) is a superset of (B:B:xs). So maybe if you move the more specialized cases up it might help."}], "answers": [{"comments": [{"owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "reply_to_user": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1427011224, "post_id": 29192199, "comment_id": 46598132, "body": "@user2225104 <a href=\"http://en.wikipedia.org/wiki/Wikipedia:Too_long;_didn%27t_read\" rel=\"nofollow noreferrer\">TL;DR</a> is for the people who want to know the crisp solution instead of reading a long text."}, {"owner": {"reputation": 31, "user_id": 4689872, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh5.googleusercontent.com/-zVwayj_UwuQ/AAAAAAAAAAI/AAAAAAAAIRk/21USL0Zz0mk/photo.jpg?sz=128", "display_name": "Massimiliano Martella", "link": "https://stackoverflow.com/users/4689872/massimiliano-martella"}, "edited": false, "score": 0, "creation_date": 1427011832, "post_id": 29192199, "comment_id": 46598268, "body": "It Works! Thank you very much!"}], "tags": [], "owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "is_accepted": true, "score": 4, "last_activity_date": 1427011437, "last_edit_date": 1427011437, "creation_date": 1427011082, "answer_id": 29192199, "question_id": 29192163, "link": "https://stackoverflow.com/questions/29192163/zip-element-in-a-list-in-haskell/29192199#29192199", "title": "Zip Element in a list in Haskell", "body": "<p><strong>TL;DR</strong></p>\n\n<p>When you define a function with multiple patterns, the patterns which are too specific should be defined at the beginning and the broader patterns should be defined at the end.</p>\n\n<p><strong>Explanation</strong></p>\n\n<p>In your case,</p>\n\n<pre><code>zS (B:xs) = B : zS xs\n</code></pre>\n\n<p>already matches any list which starts with <code>B</code>. So, </p>\n\n<pre><code>zS (B:B:xs) = B : zS xs\nzS (B:A:xs) = B : A : zS xs\n</code></pre>\n\n<p>will already be matched by <code>zS (B:xs) = B : zS xs</code> itself. That is why Haskell is calling it out by saying</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Pattern match(es) are overlapped\n</code></pre>\n\n<p>To fix this, define the specific patterns at the beginning, like this</p>\n\n<pre><code>zS :: [El] -&gt; [El]\nzS [] = []\nzS (B:B:xs) = B : zS xs\nzS (B:A:xs) = B : A : zS xs\nzS (A:xs) = A : zS xs\nzS (B:xs) = B : zS xs\n</code></pre>\n\n<hr>\n\n<p><strong>Note:</strong> Your code has a bug,</p>\n\n<pre><code>zS (B:B:xs) = B : zS xs\n</code></pre>\n\n<p>Here, you are including <code>B</code>, if you find two matches and no matter how many times <code>B</code> is repeated. Instead, you can recurse like this</p>\n\n<pre><code>zS (B:B:xs) = zS (B:xs)\n</code></pre>\n\n<p>so that </p>\n\n<pre><code>zS (B:A:xs) = B : A : zS xs\n</code></pre>\n\n<p>will take care of repeating <code>B</code>s for you.</p>\n"}], "owner": {"reputation": 31, "user_id": 4689872, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh5.googleusercontent.com/-zVwayj_UwuQ/AAAAAAAAAAI/AAAAAAAAIRk/21USL0Zz0mk/photo.jpg?sz=128", "display_name": "Massimiliano Martella", "link": "https://stackoverflow.com/users/4689872/massimiliano-martella"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 549, "favorite_count": 0, "accepted_answer_id": 29192199, "answer_count": 1, "score": 1, "last_activity_date": 1427011437, "creation_date": 1427010714, "last_edit_date": 1427011258, "question_id": 29192163, "link": "https://stackoverflow.com/questions/29192163/zip-element-in-a-list-in-haskell", "title": "Zip Element in a list in Haskell", "body": "<p>I have a problem with the following function in Haskell that zip only elements \"B\" in a list:</p>\n\n<pre><code>data El = A | B deriving (Show)\n\nzS :: [El] -&gt; [El]\nzS [] = []\nzS (A:xs) = A : zS xs\nzS (B:xs) = B : zS xs\nzS (B:B:xs) = B : zS xs\nzS (B:A:xs) = B : A : zS xs\n</code></pre>\n\n<p>When I test the function <code>zS</code> the result should be:</p>\n\n<pre><code>zS [B, B, A, A, B, B, B, A, B ] --&gt; [B, A, A, B, A, B ]\n</code></pre>\n\n<p>but it does not work. Also, when I compile the code, Haskell return a Warning like this:</p>\n\n<pre><code> Warning:\n    Pattern match(es) are overlapped\n    In an equation for 'zS':\n</code></pre>\n\n<p>How can I fix this?</p>\n"}, {"tags": ["haskell", "monomorphism-restriction"], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1427014824, "post_id": 29192553, "comment_id": 46598857, "body": "Spot on. I have a question tough, do you think the following is a GHC bug: <code>x :: Random a =&gt; a; x = let (a, b) = random (mkStdGen 0) in a</code> type checks with monomorphism restriction, but doesn&#39;t check without it! (On GHC 7.8.4). It seems really weird to me that <i>lifting</i> the restriction should ever cause <i>fewer</i> programs to check."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1427015049, "post_id": 29192553, "comment_id": 46598893, "body": "@Andr&#225;sKov&#225;cs I thought it was a bug before I started writing my answer, but now I&#39;m about 50/50 :P"}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 3, "last_activity_date": 1427014839, "last_edit_date": 1427014839, "creation_date": 1427014401, "answer_id": 29192553, "question_id": 29192126, "link": "https://stackoverflow.com/questions/29192126/how-to-work-around-issue-with-ambiguity-when-monomorphic-restriction-turned-on/29192553#29192553", "title": "How to work around issue with ambiguity when monomorphic restriction turned *on*?", "body": "<p>When you define</p>\n\n<pre><code>(a,g) = random (mkStdGen 4)\n</code></pre>\n\n<p>then even if <code>g</code> itself is always of type <code>StdGen</code>, the <em>value</em> of <code>g</code> depends on the <em>type</em> of <code>a</code>, because different types can differ in how much they use the random number generator.</p>\n\n<p>Moreover, when you (hypothetically) <em>use</em> <code>g</code> later, as long as <code>a</code> was polymorphic originally, there is no way to decide <em>which</em> type of <code>a</code> you want to use for calculating <code>g</code>.</p>\n\n<p>So, taken alone, as a polymorphic definition, the above has to be disallowed because <code>g</code> actually <em>is</em> extremely ambiguous and this ambiguity <em>cannot</em> be fixed at the use site.</p>\n\n<p>This is a general kind of problem with <code>let/where</code> bindings that bind several variables in a pattern, and is probably the reason why the ordinary monomorphism restriction treats them even stricter than single variable equations: With a pattern, you cannot even disable the MR by giving a polymorphic type signature.</p>\n\n<p>When you use <code>_</code> instead, presumably GHC doesn't worry about this ambiguity as long as it doesn't affect the calculation of <code>a</code>.  Possibly it could have detected that <code>g</code> is unused in the former version, and treated it similarly, but apparently it doesn't.</p>\n\n<p>As for workarounds without giving unnecessary explicit types, you might instead try replacing <code>let/where</code> by one of the binding methods in Haskell which are <em>always</em> monomorphic.  The following all work:</p>\n\n<pre><code>case random (mkStdGen 4) of\n    (a,g) -&gt; a :: Int\n\n(\\(a,g) -&gt; a :: Int) (random (mkStdGen 4))\n\ndo (a,g) &lt;- return $ random (mkStdGen 4)\n   return (a :: Int)    -- The result here gets wrapped in the Monad\n</code></pre>\n"}], "owner": {"reputation": 163, "user_id": 3036581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6023d80d8ce97faf06d8aff635441a3?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Young", "link": "https://stackoverflow.com/users/3036581/thomas-young"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 29192553, "answer_count": 1, "score": 2, "last_activity_date": 1427014839, "creation_date": 1427010376, "question_id": 29192126, "link": "https://stackoverflow.com/questions/29192126/how-to-work-around-issue-with-ambiguity-when-monomorphic-restriction-turned-on", "title": "How to work around issue with ambiguity when monomorphic restriction turned *on*?", "body": "<p>So, learning Haskell, I came across the dreaded monomorphic restriction, soon enough, with the following (in ghci):</p>\n\n<pre><code>Prelude&gt; let f = print.show\nPrelude&gt; f 5\n\n&lt;interactive&gt;:3:3:\n    No instance for (Num ()) arising from the literal `5'\n    Possible fix: add an instance declaration for (Num ())\n    In the first argument of `f', namely `5'\n    In the expression: f 5\n    In an equation for `it': it = f 5\n</code></pre>\n\n<p>So there's a bunch of material about this, e.g. <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow\">here</a>, and it is not so hard to workaround.\nI can either add an explicit type signature for f, or I can turn off the monomorphic restriction (with \":set -XNoMonomorphismRestriction\" directly in ghci, or in a .ghci file).</p>\n\n<p>There's some discussion about the monomorphic restriction, but it seems like the general advice is that it is ok to turn this off (and I was told that this is actually off by default in newer versions of ghci).</p>\n\n<p>So I turned this off.</p>\n\n<p>But then I came across another issue:</p>\n\n<pre><code>Prelude&gt; :set -XNoMonomorphismRestriction\nPrelude&gt; let (a,g) = System.Random.random (System.Random.mkStdGen 4) in a :: Int \n\n&lt;interactive&gt;:4:5:\n    No instance for (System.Random.Random t0)\n      arising from the ambiguity check for `g'\n    The type variable `t0' is ambiguous\n    Possible fix: add a type signature that fixes these type variable(s)\n    Note: there are several potential instances:\n      instance System.Random.Random Bool -- Defined in `System.Random'\n      instance System.Random.Random Foreign.C.Types.CChar\n        -- Defined in `System.Random'\n      instance System.Random.Random Foreign.C.Types.CDouble\n        -- Defined in `System.Random'\n      ...plus 33 others\n    When checking that `g' has the inferred type `System.Random.StdGen'\n    Probable cause: the inferred type is ambiguous\n    In the expression:\n      let (a, g) = System.Random.random (System.Random.mkStdGen 4)\n      in a :: Int\n    In an equation for `it':\n        it\n          = let (a, g) = System.Random.random (System.Random.mkStdGen 4)\n            in a :: Int\n</code></pre>\n\n<p>This is actually simplified from example code in the 'Real World Haskell' book, which wasn't working for me, and which you can find on this page: <a href=\"http://book.realworldhaskell.org/read/monads.html\" rel=\"nofollow\">http://book.realworldhaskell.org/read/monads.html</a> (it's the Monads chapter, and the getRandom example function, search for 'getRandom' on that page).</p>\n\n<p>If I leave the monomorphic restriction <em>on</em> (or turn it on) then the code works. It also works (with the monomorphic restriction on) if I change it to:</p>\n\n<pre><code>Prelude&gt; let (a,_) = System.Random.random (System.Random.mkStdGen 4) in a :: Int \n-106546976\n</code></pre>\n\n<p>or if I specify the type of 'a' earlier:</p>\n\n<pre><code>Prelude&gt; let (a::Int,g) = System.Random.random (System.Random.mkStdGen 4) in a :: Int\n-106546976\n</code></pre>\n\n<p>but, for this second workaround, I have to turn on the 'scoped type variables' extension (with \":set -XScopedTypeVariables\").</p>\n\n<p>The problem is that in this case (problems when monomorphic restriction <em>on</em>) neither of the workarounds seem generally applicable.</p>\n\n<p>For example, maybe I want to write a function that does something like this and works with arbitrary (or multiple) types, and of course in this case I most probably <em>do</em> want to hold on to the new generator state (in 'g').</p>\n\n<p>The question is then: How do I work around this kind of issue, in general, and without specifying the exact type directly?</p>\n\n<p>And, it would also be great (as a Haskell novice) to get more of an idea about exactly what is going on here, and why these issues occur..</p>\n"}, {"tags": ["haskell", "ocaml", "ocaml-core"], "comments": [{"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1427040430, "post_id": 29191484, "comment_id": 46605935, "body": "A similar thing occurs in Haskell when influencing the inliner. The following map definition is better optimized than a more naive one: <code>map f = go where { go [] = []; go (a : as) = f a : go as }</code>."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1427042855, "post_id": 29191484, "comment_id": 46606815, "body": "@J.Abrahamson That&#39;s only useful because <code>map</code> is recursive. Hence, <code>go as</code> is more efficient than <code>map f as</code>. I don&#39;t see how the same concept would apply to <code>compose</code> considering that it is not recursive."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1427046295, "post_id": 29191484, "comment_id": 46607959, "body": "There are non-recursive instances, too. My point is that the inliner only runs when all of the variables in your definition are filled and thus behaves differently between <code>f x = \\y -&gt; ...</code> and <code>f x y = ...</code> despite them being semantically identical."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1427016627, "post_id": 29191741, "comment_id": 46599221, "body": "Wouldn&#39;t a closure be built to return <code>fun x -&gt; f (g x)</code> anyway? Would building this closure be cheaper wrt building the one associated to partial application? I can&#39;t see an obvious reason for that."}, {"owner": {"reputation": 8625, "user_id": 2642162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f497a9526578cba7c81514047b3120fb?s=128&d=identicon&r=PG", "display_name": "gsg", "link": "https://stackoverflow.com/users/2642162/gsg"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1427022411, "post_id": 29191741, "comment_id": 46600547, "body": "The closures built by partial application involve an additional indirection - they go through <code>caml_curryN</code> (which is necessary for the correct evaluation order) rather than straight to the code."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1427040497, "post_id": 29191741, "comment_id": 46605961, "body": "Does the compiler not treat <code>let compose f g = fun x -&gt; f (g x)</code> and <code>let compose f g x = f (g x)</code> differently? I wouldn&#39;t have thought to interject a <code>()</code>."}, {"owner": {"reputation": 8625, "user_id": 2642162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f497a9526578cba7c81514047b3120fb?s=128&d=identicon&r=PG", "display_name": "gsg", "link": "https://stackoverflow.com/users/2642162/gsg"}, "edited": false, "score": 0, "creation_date": 1427041126, "post_id": 29191741, "comment_id": 46606208, "body": "No, those are handled the same. <code>let f x y = ...</code> is just sugar for <code>let f = fun x -&gt; fun y -&gt; ...</code>: when expanded, the two are identical."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1427046375, "post_id": 29191741, "comment_id": 46607982, "body": "Gotcha. In Haskell they&#39;re treated slightly differently with regard to the inliner. It makes a lot of sense to use the <code>(); E</code> trick in OCaml too, though."}], "tags": [], "owner": {"reputation": 8625, "user_id": 2642162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f497a9526578cba7c81514047b3120fb?s=128&d=identicon&r=PG", "display_name": "gsg", "link": "https://stackoverflow.com/users/2642162/gsg"}, "is_accepted": true, "score": 3, "last_activity_date": 1427037191, "last_edit_date": 1427037191, "creation_date": 1427006620, "answer_id": 29191741, "question_id": 29191484, "link": "https://stackoverflow.com/questions/29191484/breakpoints-in-the-argument-passing-scheme-of-ocaml/29191741#29191741", "title": "Breakpoints in the argument-passing scheme of OCaml", "body": "<p>This is an efficiency hack to avoid the cost of a partial application in the expected use case indicated in the comment.</p>\n\n<p>OCaml compiles curried functions into fixed-arity constructs, using a closure to partially apply them where necessary. This means that calls of that arity are efficient - there's no closure construction, just a function call.</p>\n\n<p>There <em>will</em> be a closure construction within <code>compose</code> for <code>fun x -&gt; f (g x)</code>, but this will be more efficient than the partial application. Closures generated by partial application go through a wrapper <code>caml_curryN</code> which exists to ensure that effects occur at the correct time (if that closure is itself partially applied).</p>\n\n<p>The fixed arity that the compiler chooses is based on a simple syntactic analysis - essentially, how many arguments are taken in a row without anything in between. The Jane St. programmers have used this to select the arity that they desire by injecting <code>()</code> \"in between\" arguments.</p>\n\n<p>In short, <code>let compose f g x = f (g x)</code> is a less desirable definition because it would result in the common two-argument case of <code>compose f g</code> being a more expensive partial application.</p>\n\n<p>Semantically, of course, there is no difference at all.</p>\n"}, {"tags": [], "owner": {"reputation": 865, "user_id": 668513, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpb4B.png?s=128&g=1", "display_name": "yzzlr", "link": "https://stackoverflow.com/users/668513/yzzlr"}, "is_accepted": false, "score": 2, "last_activity_date": 1427065628, "creation_date": 1427065628, "answer_id": 29200957, "question_id": 29191484, "link": "https://stackoverflow.com/questions/29191484/breakpoints-in-the-argument-passing-scheme-of-ocaml/29200957#29200957", "title": "Breakpoints in the argument-passing scheme of OCaml", "body": "<p>It's worth noting that compilation of partial application has improved in OCaml, and this performance hack is no longer necessary.</p>\n"}], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 29191741, "answer_count": 2, "score": 8, "last_activity_date": 1427065628, "creation_date": 1427003749, "question_id": 29191484, "link": "https://stackoverflow.com/questions/29191484/breakpoints-in-the-argument-passing-scheme-of-ocaml", "title": "Breakpoints in the argument-passing scheme of OCaml", "body": "<p>Today, I was going through the source code of <a href=\"https://www.janestreet.com/\" rel=\"noreferrer\">Jane Street</a>'s <code>Core_kernel</code> module and I <a href=\"https://github.com/janestreet/core_kernel/blob/master/lib/fn.ml#L23-L26\" rel=\"noreferrer\">came across</a> the <code>compose</code> function:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>(* The typical use case for these functions is to pass in functional arguments\n   and get functions as a result. For this reason, we tell the compiler where\n   to insert breakpoints in the argument-passing scheme. *)\nlet compose f g = (); fun x -&gt; f (g x)\n</code></pre>\n\n<p>I would have defined the <code>compose</code> function as:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>let compose f g x = f (g x)\n</code></pre>\n\n<p>The reason they give for defining <code>compose</code> the way they did is &ldquo;because <code>compose</code> is a function which takes functions <code>f</code> and <code>g</code> as arguments and returns the function <code>fun x -&gt; f (g x)</code> as a result, they defined <code>compose</code> the way they did to tell the compiler to insert a breakpoint after <code>f</code> and <code>g</code> but before <code>x</code> in the argument-passing scheme.&rdquo;</p>\n\n<p>So I have two questions:</p>\n\n<ol>\n<li>Why do we need breakpoints in the argument-passing scheme?</li>\n<li>What difference would it make if we defined <code>compose</code> the normal way?</li>\n</ol>\n\n<p>Coming from Haskell, this convention doesn't make any sense to me.</p>\n"}, {"tags": ["list", "haskell", "math", "recursion", "pattern-matching"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1427003558, "post_id": 29191321, "comment_id": 46596812, "body": "Consider matching it as <code>(Num x : op : Num y : op_next : remaining_expr)</code> instead. You can make that change and it won&#39;t affect how your function currently works. Then start thinking about what you can do with <code>op_next</code> and <code>remaining_expr</code>. If you need to worry about order of operations then think about what kind of pattern match you could do to find those cases. What are the different interactions between the different operators? Make sure that <code>[Num 1, Plus, Num 2, Times, Num 3]</code> is treated as <code>1 + (2 * 3)</code>. Get that one working, then implement the next rule. See if you can find a pattern."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1427016751, "post_id": 29191321, "comment_id": 46599236, "body": "See <a href=\"http://stackoverflow.com/questions/588004/is-floating-point-math-broken\" title=\"is floating point math broken\">stackoverflow.com/questions/588004/&hellip;</a>"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 1, "creation_date": 1430808125, "post_id": 29191321, "comment_id": 48207043, "body": "I&#39;m voting to close this question as off-topic because it is specialized to a specific homework assignment and unclear."}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 4698977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc1a2702473d1ba596e22217cfc50817?s=128&d=identicon&r=PG&f=1", "display_name": "tetris12367", "link": "https://stackoverflow.com/users/4698977/tetris12367"}, "edited": false, "score": 0, "creation_date": 1427023897, "post_id": 29192944, "comment_id": 46600901, "body": "Hey thanks man, it makes soo much sense now and i knew i understood it, it just didnt get through my head. But i will definetly do it my own way but i do appreciate your help!"}], "tags": [], "owner": {"reputation": 184, "user_id": 3489809, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000321486785/picture?type=large", "display_name": "Sam Ye", "link": "https://stackoverflow.com/users/3489809/sam-ye"}, "is_accepted": false, "score": -2, "last_activity_date": 1427017630, "creation_date": 1427017630, "answer_id": 29192944, "question_id": 29191321, "link": "https://stackoverflow.com/questions/29191321/haskell-function-for-solving-basic-equations/29192944#29192944", "title": "Haskell, function for solving basic equations", "body": "<p>Oh hi coursemate, yeah this week's lab drives me crazy too..</p>\n\n<p>I did this in 9 cases (which I think it's terrible and I need to find a better way, it works fine though).</p>\n\n<p>What I did is to set up the patterns which cover all possible inputs</p>\n\n<ol>\n<li>px : Num x : op : py : Num y : opn : r</li>\n<li>px : Num x : op : Num y : opn : r</li>\n<li>Num x : op : py : Num y : opn : r</li>\n<li>Num x : op : Num y : opn : r</li>\n<li>Num x : op : Num y : []</li>\n<li>Num x : op : py : Num y : []</li>\n<li>px : Num x : op : Num y : []</li>\n<li>px : Num x : op : py : Num y : []</li>\n<li>_</li>\n</ol>\n\n<p>where px and py are the number prefix (Plus / Minus)</p>\n\n<p>In cases 2 ~ 3, they'll call eval again which process to case 1, same as cases 5 ~ 7, they'll process to case 8. So case 1 &amp; 8 are cases which doing the actual calculations.</p>\n\n<p>Case 1 is where you deal with the binding_power function (which calculates the operator priority);</p>\n\n<p>Case 8 is where you do the final calculation (beware of zero-division), you may set-up a where clause like to translate a negative number: </p>\n\n<pre><code>tx = (if px == Minus then -1 else 1) * x\nty = (if py == Minus then -1 else 1) * y\n</code></pre>\n\n<p>If you want spoilers, here's the link: <a href=\"http://pastebin.com/Vq8PC6Z3\" rel=\"nofollow\">http://pastebin.com/Vq8PC6Z3</a></p>\n"}], "owner": {"reputation": 19, "user_id": 4698977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc1a2702473d1ba596e22217cfc50817?s=128&d=identicon&r=PG&f=1", "display_name": "tetris12367", "link": "https://stackoverflow.com/users/4698977/tetris12367"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 324, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1427017630, "creation_date": 1427002099, "last_edit_date": 1427003714, "question_id": 29191321, "link": "https://stackoverflow.com/questions/29191321/haskell-function-for-solving-basic-equations", "title": "Haskell, function for solving basic equations", "body": "<p>I'm new to haskell and have started it because I'm doing it at UNI,\nI've had previous experience in C, C# and HTML, CSS. We had a lab this \nweek where we were given the code :</p>\n\n<pre><code>data Token = Plus | Minus | Times | Divided_By | Power | Num {number :: Double}\nderiving (Show, Eq)\n\ntype Expression = [Token]\n\ntokenizer :: String -&gt; Expression\ntokenizer expression_as_string = case expression_as_string of\n   \"\"    -&gt; []\n   c: cs -&gt; case c of\n      '+' -&gt; Plus        : tokenizer cs\n      '-' -&gt; Minus       : tokenizer cs\n      '*' -&gt; Times       : tokenizer cs\n      '/' -&gt; Divided_By  : tokenizer cs\n      '^' -&gt; Power       : tokenizer cs\n      _ | c `elem` ['0' .. '9'] -&gt; case reads expression_as_string of\n                                      [(value, rest)] -&gt; Num value : tokenizer rest\n                                      _               -&gt; error \"Could not read number\"\n        | c `elem` [' ', '\\t'] -&gt; tokenizer cs\n        | otherwise -&gt; error \"Unknown Symbol\"\n\nexpression_to_string :: Expression -&gt; String\nexpression_to_string expr = case expr of\n   []    -&gt; \"\"\n   e: es -&gt; case e of\n      Plus       -&gt; \" + \"     ++ expression_to_string es\n      Minus      -&gt; \" - \"     ++ expression_to_string es\n      Times      -&gt; \" * \"     ++ expression_to_string es\n      Divided_By -&gt; \" / \"     ++ expression_to_string es\n      Power      -&gt; \" ^ \"     ++ expression_to_string es\n      Num x      -&gt; (show x)  ++ expression_to_string es\n\neval_string_expression :: String -&gt; String\neval_string_expression s = expression_to_string (eval (tokenizer s))\n</code></pre>\n\n<p>So now we are meant to implement out own function called eval which should solve this equation, when typed in ghci: </p>\n\n<blockquote>\n  <p>eval [Num 3.2, Plus, Minus, Num 4.2, Minus, Num 5.3, Plus, Num 6.3]\n      [Num {number = 0.0}]</p>\n</blockquote>\n\n<p>So at this point i've used pattern matching (judging that i understand it) and got this far:</p>\n\n<pre><code>eval :: Expression -&gt; Expression\neval list = case list of\n   [] -&gt; []\n   [Num x, op, Num y] -&gt; case op of\n      Plus           -&gt; [Num (x + y)]\n      Minus         -&gt; [Num (x - y)]\n      Times         -&gt; [Num (x * y)]\n      Divided_By -&gt; [Num (x / y)]\n      Power         -&gt; [Num (x ** y)]\n      _                -&gt; error \"......\"\n</code></pre>\n\n<p>Now if i type this into ghci: eval[Num 3.1, Plus, Num 4.2]\nit returns 7.300000000001 because it is a double, now im not sure if this is correct.\nThough i do know that this is non-exhaustive because i havent taken care of all the possibilities. \nWhat i need help with is taking a negative number into consideration such as Minus, Plus which should return a Minus but I also need to take note of how order works, such as Powers, then Multiplication/Division then Addition/Subtraction. \nOur lecturer has given us the return value if the eval function is called: \n    eval ((eval [Num x, op, Num y]) ++ op_next: remaining_expr)</p>\n\n<p>So if anyone can help, if you understand what i am saying it would be helpful, ohh and go easy please im still trying to learn! :)\nThis lab is meant to teach us pattern matching but i still don't fully understand it. </p>\n\n<p>I probably should note that I know what I am meant to do but just not how to write it correctly!</p>\n"}, {"tags": ["regex", "haskell", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 1, "last_activity_date": 1426989573, "last_edit_date": 1426989573, "creation_date": 1426989153, "answer_id": 29190111, "question_id": 29189831, "link": "https://stackoverflow.com/questions/29189831/bytestring-regex-match-with-alltextmatches-result-type/29190111#29190111", "title": "ByteString regex match with AllTextMatches result type", "body": "<p>Starting from your error:</p>\n\n<pre><code>No instance for (RegexContext\n                   Regex ByteString (AllTextMatches [] (Int, Int)))\n</code></pre>\n\n<p>Looking at what we have in scope, <code>AllTextMatches</code> only defines one <code>RegexContext</code> instance:</p>\n\n<pre><code>\u03bb :info AllTextMatches\n...\ninstance RegexLike a b =&gt; RegexContext a b (AllTextMatches [] b)\n  -- Defined in \u2018Text.Regex.Base.Context\u2019\n</code></pre>\n\n<p>And there's only two <code>RegexLike</code> instances in scope:</p>\n\n<pre><code>\u03bb :i RegexLike\n...\ninstance RegexLike Regex String\n  -- Defined in \u2018Text.Regex.Posix.String\u2019\ninstance RegexLike Regex ByteString\n  -- Defined in \u2018Text.Regex.Posix.ByteString\u2019\n</code></pre>\n\n<p>Since we're dealing with <code>ByteString</code>s here, we must be using the <code>RegexLike Regex ByteString</code> instance, which lets us infer <code>a</code> and <code>b</code> in <code>AllTextMatches</code>' instance of <code>RegexContext</code> as <code>Regex</code> and <code>ByteString</code>, so we have:</p>\n\n<pre><code>RegexContext Regex ByteString (AllTextMatches [] ByteString)\n</code></pre>\n\n<p>If we ask for that:</p>\n\n<pre><code>\u03bb getAllTextMatches (pack \"foo\" =~ pack \"o\") :: [ByteString]\n[\"o\",\"o\"]\n</code></pre>\n\n<p>It works!</p>\n\n<p>But that doesn't give us anything like a <code>(MatchOffset, MatchLength)</code>, which is a bit of a bummer.</p>\n\n<p>I'm guessing you're trying <a href=\"http://book.realworldhaskell.org/read/efficient-file-processing-regular-expressions-and-file-name-matching.html#regexp.ghci:mix.simple\" rel=\"nofollow\">to run this example</a>?</p>\n\n<p>There's considerable discussion in the comments there, but the long and the short of it is that the API for <code>Text.Regex.Posix</code> has apparently shifted since RWH was written. Not too surprising since it's now <code>0.95.2</code>, and <a href=\"http://book.realworldhaskell.org/\" rel=\"nofollow\">when RWH was first published in November 2008</a> <a href=\"http://hackage.haskell.org/package/regex-posix-0.72.0.3\" rel=\"nofollow\">the latest version was <code>0.72.3</code></a>.</p>\n\n<p>These days, <a href=\"http://hackage.haskell.org/package/regex-base-0.93.2/docs/Text-Regex-Base-RegexLike.html#v:getAllMatches\" rel=\"nofollow\">to get a list of all the match positions and offsets use <code>getAllMatches</code></a> instead.</p>\n\n<pre><code>\u03bb getAllMatches (pack \"foo\" =~ pack \"o\") :: [(Int, Int)]\n[(1,1),(2,1)]\n</code></pre>\n"}], "owner": {"reputation": 251, "user_id": 1564106, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35d895ec931b2609c500431c4730adae?s=128&d=identicon&r=PG", "display_name": "bpaterni", "link": "https://stackoverflow.com/users/1564106/bpaterni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 29190111, "answer_count": 1, "score": 1, "last_activity_date": 1439504830, "creation_date": 1426985952, "last_edit_date": 1495542117, "question_id": 29189831, "link": "https://stackoverflow.com/questions/29189831/bytestring-regex-match-with-alltextmatches-result-type", "title": "ByteString regex match with AllTextMatches result type", "body": "<p>I'm having problems with the following example ghci interaction from Chapter 8 of Real World Haskell. With the help of rampion's answer to <a href=\"https://stackoverflow.com/a/7636780/1564106\">a related question</a>, the expected output should be:</p>\n\n<pre><code>&gt; :m +Text.Regex.Posix Data.ByteString.Char8\n&gt; getAllTextMatches $ pack \"foo\" =~ pack \"o\" :: [(Int, Int)]\n[(1,1),(2,1)]\n</code></pre>\n\n<p>instead, I see a missing instance error:</p>\n\n<pre><code>&gt; getAllTextMatches $ pack \"foo\" =~ pack \"o\" :: [(Int, Int)]\n    No instance for (RegexContext\n                       Regex ByteString (AllTextMatches [] (Int, Int)))\n      arising from a use of `=~'\n    Possible fix:\n      add an instance declaration for\n      (RegexContext Regex ByteString (AllTextMatches [] (Int, Int)))\n    In the second argument of `($)', namely `pack \"foo\" =~ pack \"o\"'\n    In the expression:\n        getAllTextMatches $ pack \"foo\" =~ pack \"o\" :: [(Int, Int)]\n    In an equation for `it':\n        it = getAllTextMatches $ pack \"foo\" =~ pack \"o\" :: [(Int, Int)]\n</code></pre>\n\n<p>what gives?</p>\n"}, {"tags": ["sqlite", "haskell", "persist"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1427020939, "post_id": 29189457, "comment_id": 46600193, "body": "The best way to try and narrow this down is if you could provide a minimal reproducing test case, such as a SQL script that would generate a database that causes this issue."}, {"owner": {"reputation": 3125, "user_id": 156831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4a7fc39d443767abbe16fc219bf3910?s=128&d=identicon&r=PG", "display_name": "lifeless", "link": "https://stackoverflow.com/users/156831/lifeless"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1427092965, "post_id": 29189457, "comment_id": 46620135, "body": "I wish I could - I&#39;ve tried making a new DB with the same schema for that table and sample data, but no boom. I can put the DB up online for someone you fiddle with."}, {"owner": {"reputation": 3125, "user_id": 156831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4a7fc39d443767abbe16fc219bf3910?s=128&d=identicon&r=PG", "display_name": "lifeless", "link": "https://stackoverflow.com/users/156831/lifeless"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1427433305, "post_id": 29189457, "comment_id": 46783765, "body": "Hah, tracked it down to a bad other app inserting bad data randomly. I&#39;d look away and back and it broke.."}], "answers": [{"tags": [], "owner": {"reputation": 3125, "user_id": 156831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4a7fc39d443767abbe16fc219bf3910?s=128&d=identicon&r=PG", "display_name": "lifeless", "link": "https://stackoverflow.com/users/156831/lifeless"}, "is_accepted": false, "score": 1, "last_activity_date": 1427433333, "creation_date": 1427433333, "answer_id": 29293762, "question_id": 29189457, "link": "https://stackoverflow.com/questions/29189457/persistmarshalerror-reading-from-sqlite/29293762#29293762", "title": "PersistMarshalError reading from sqlite", "body": "<p>Hah, tracked it down to a bad other app inserting bad data randomly. I'd look away and back and it broke.</p>\n"}], "owner": {"reputation": 3125, "user_id": 156831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4a7fc39d443767abbe16fc219bf3910?s=128&d=identicon&r=PG", "display_name": "lifeless", "link": "https://stackoverflow.com/users/156831/lifeless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1427433333, "creation_date": 1426982516, "question_id": 29189457, "link": "https://stackoverflow.com/questions/29189457/persistmarshalerror-reading-from-sqlite", "title": "PersistMarshalError reading from sqlite", "body": "<p>I'm trying to read from an existing SQLite database using persistent-sql.</p>\n\n<p>I'm getting a PersistMarshalError, and I suspect it might be a bug in the sqlite driver interpreting the sqlite output ...  but would love to be wrong :)</p>\n\n<p>This is the schema:</p>\n\n<pre><code>  CREATE TABLE \"System\" (\n  'SystemId'  INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,\n  'SystemName'  TEXT(255) COLLATE NOCASE,\n  'SystemX'  Double,\n  'SystemY'  Double,\n  'SystemZ'  Double,\n  'SystemSize'  Double\n  );\n</code></pre>\n\n<p>And this is the haskell test code:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving, TemplateHaskell,\n         OverloadedStrings, GADTs, FlexibleContexts, ScopedTypeVariables #-} \nimport Database.Persist\nimport Database.Persist.Sqlite\nimport Database.Persist.TH\nimport Control.Monad.IO.Class (liftIO)\nimport Data.Time (UTCTime)\nimport Data.Text (Text)\nimport Control.Monad.Logger\nimport Control.Monad.Trans.Resource (runResourceT)\n\nshare [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistUpperCase|\nSystem\n   Id Int sqltype=int sql=SystemId\n   name Text Maybe sqltype=text sql=SystemName\n   x Double Maybe sqltype=double sql=SystemX \n   y Double Maybe sqltype=double sql=SystemY \n   z Double Maybe sqltype=double sql=SystemZ\n   size Double Maybe sqltype=double sql=SystemSize\n   deriving Show\n|]\n\nconnStr = \"PATH_TO_DB\"\n\nmain :: IO ()\nmain = runStdoutLoggingT $ withSqlitePool connStr 10 $ \\pool -&gt;\n     runResourceT $ flip runSqlPool pool $ do\n        printMigration migrateAll\n        res  :: [Entity System] &lt;- selectList [] [LimitTo 1] \n        liftIO $ print res\n</code></pre>\n\n<p>This is the error:</p>\n\n<pre><code>[Debug#SQL] SELECT \"SystemId\", \"SystemName\", \"SystemX\", \"SystemY\", \"SystemZ\", \"SystemSize\" FROM \"System\"; [] @(&lt;unknown&gt;\n:&lt;unknown&gt; &lt;unknown&gt;:0:0)\nedbpc: PersistMarshalError \"field x: Expected Double, received: PersistText \\\"X\\\"\"\n</code></pre>\n\n<p>There is no row in the DB with \"X\" in the SystemX column.</p>\n\n<pre><code>sqlite&gt; select * from system where systemx like '%X%';\nsqlite&gt; select * from system where systemx like '%x%';\nsqlite&gt;\n</code></pre>\n\n<p>What I think is happening is that the field name is being included in the sqlite output rows, and that is being parsed.</p>\n\n<p>I think this because when I add 'OffsetBy 1' to the query, the error goes away and I see the actual first row from the table.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 555, "user_id": 4108393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1616347e88a4828ad7b5eaf6dff2337?s=128&d=identicon&r=PG&f=1", "display_name": "G Philip", "link": "https://stackoverflow.com/users/4108393/g-philip"}, "edited": false, "score": 0, "creation_date": 1427035219, "post_id": 29193611, "comment_id": 46604189, "body": "Thank you. I am not very familiar with the guard stuff so this looks like magic to me. I have figured out the Ctrl-D question as well as the factoring question (to some extent), please see my answer."}], "tags": [], "owner": {"reputation": 2221, "user_id": 448591, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5520f21f2e367d78c29d08d3b30b954f?s=128&d=identicon&r=PG", "display_name": "Jakob Runge", "link": "https://stackoverflow.com/users/448591/jakob-runge"}, "is_accepted": false, "score": 1, "last_activity_date": 1427024423, "last_edit_date": 1427024423, "creation_date": 1427022532, "answer_id": 29193611, "question_id": 29189428, "link": "https://stackoverflow.com/questions/29189428/getting-haskeline-to-quit-early/29193611#29193611", "title": "Getting Haskeline to quit early", "body": "<p>I think your hunch is right here. Much of the pattern matching done via case can be replaced with using the Maybe Monad a bit more.\nInstead of</p>\n\n<pre><code>basket &lt;- case input of\n  Nothing -&gt; return Nothing -- User pressed Ctrl-D with the input being empty\n  Just \"\" -&gt; return (Just initialBasket) -- User pressed Enter with the input being empty\n  Just \"quit\" -&gt; return Nothing -- User typed in \"quit\" and pressed Enter\n  Just newOwner -&gt; return (Just initialBasket{ownerName = newOwner})\n</code></pre>\n\n<p>you could write something like</p>\n\n<pre><code>let basket' = do\n  i &lt;- input\n  guard $ i /= \"quit\"\n  b &lt;- basket\n  return $ if (null i) then b else b{fruitCount = read i}\n</code></pre>\n\n<p>you could even introduce some helpers like</p>\n\n<pre><code>guardInput :: Maybe String -&gt; (String -&gt; Maybe a) -&gt; Maybe a\nguardInput input \u03bb = input &gt;&gt;= \\i -&gt; ((guard $ i /= \"quit\") &gt;&gt; \u03bb i)\n-- | Custom ternary operator .)\nTrue  ? (a, _) = a\nFalse ? (_, b) = b\n</code></pre>\n\n<p>to write</p>\n\n<pre><code>let basket = guardInput input $\n        \\i -&gt; return $ (null i) ? (initialBasket, initialBasket{ownerName = i})\n</code></pre>\n\n<p>Sorry - I know this doesn't answer your problem with Ctrl+D, but I haven't figured that one out myself (yet).</p>\n"}, {"comments": [{"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "edited": false, "score": 1, "creation_date": 1427132939, "post_id": 29195676, "comment_id": 46643015, "body": "I would experiment with using the <a href=\"http://hackage.haskell.org/package/transformers-0.4.3.0/docs/Control-Monad-Trans-Maybe.html#g:1\" rel=\"nofollow noreferrer\"><code>MaybeT</code></a> monad transformer, which could simplify many of your nested <code>case somethingMaybe of ...</code> . Your <code>InputT IO (Maybe FruitBasket)</code> would instead be <code>MaybeT (InputT IO) FruitBasket</code>."}], "tags": [], "owner": {"reputation": 555, "user_id": 4108393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1616347e88a4828ad7b5eaf6dff2337?s=128&d=identicon&r=PG&f=1", "display_name": "G Philip", "link": "https://stackoverflow.com/users/4108393/g-philip"}, "is_accepted": false, "score": 2, "last_activity_date": 1427042710, "last_edit_date": 1427042710, "creation_date": 1427035186, "answer_id": 29195676, "question_id": 29189428, "link": "https://stackoverflow.com/questions/29189428/getting-haskeline-to-quit-early/29195676#29195676", "title": "Getting Haskeline to quit early", "body": "<p>With help from some of the advice <a href=\"https://mail.haskell.org/pipermail/beginners/2010-August/005155.html\" rel=\"nofollow\">here on the haskell-beginners mailing list</a> I have managed to solve my problems, the Ctrl-D question entirely and the factoring question to my own satisfaction (as of now!). I am posting the answer here in the hope it helps others in my predicament.</p>\n\n<p>First, the trouble with the Ctrl-D: The problem was that I was throwing away the  <em>control logic</em> offered by the Maybe monad and just using the <em>values</em> from the monad, by referring to various variable names which contained these values. The first place where I do this is here, in the <code>getBasketData</code> function:</p>\n\n<pre><code>basket &lt;- case input of ...               \ninput &lt;- getInputLine ...\nbasket' &lt;- case input of\n                Nothing -&gt; return Nothing\n                Just \"\" -&gt; return basket \n</code></pre>\n\n<p>Notice how, in computing <code>basket'</code>,  I </p>\n\n<ol>\n<li>Ignore the case where <code>basket</code> could have been <code>Nothing</code>, and</li>\n<li>Use the <em>value</em> encapsulated by <code>basket</code> by referring to (and pattern matching on, when needed) the variable <code>basket</code> which is still in scope inside the expression for <code>basket'</code>.</li>\n</ol>\n\n<p>This is the where the Ctrl-D was lost. Here, for contrast, is code for <code>getBasketData</code> which does <em>not</em> let the <code>Nothing</code>s slip through the gaps (I renamed the <code>basket</code> variables to <code>maybeBasket</code>, because they are really instances of <code>Maybe FruitBasket</code>):</p>\n\n<pre><code>getBasketData basket = runInputT defaultSettings $ withInterrupt $ getData basket\n    where \n      getData :: FruitBasket -&gt; InputT IO (Maybe FruitBasket)\n      getData initialBasket = handleInterrupt f  $ do\n             outputStrLn banner\n             input &lt;- getInputLine $ \"Who owns this basket? [\" ++ defaultOwner ++ \"] : \"\n             maybeBasket &lt;- case input of\n                       Nothing -&gt; return $ Nothing -- User pressed Ctrl-D with the input being empty\n                       Just \"\" -&gt; return $ Just initialBasket -- User pressed Enter with the input being empty\n                       Just \"quit\" -&gt; return $ Nothing -- User typed in \"quit\" and pressed Enter\n                       Just newOwner -&gt; return $ Just initialBasket{ownerName = newOwner}\n             maybeBasket' &lt;- case maybeBasket of\n                         Nothing -&gt; return $ Nothing\n                         Just realBasket -&gt; do input &lt;- getInputLine $ \"Number of kinds of fruit in the basket? [\" ++ show defaultCount ++ \"] : \"\n                                               case input of\n                                                Nothing -&gt; return $ Nothing\n                                                Just \"\" -&gt; return $ maybeBasket \n                                                Just \"quit\" -&gt; return $ Nothing\n                                                Just count -&gt;  return $ Just $ realBasket{fruitCount = (read count)}\n             maybeBasket'' &lt;- case maybeBasket' of\n                               Nothing -&gt; return $ Nothing\n                               Just realBasket -&gt; do let defaultFruitNames = pruneOrPad (fruitNames realBasket) (fruitCount realBasket)\n                                                     newNames &lt;- getFruitNames defaultFruitNames 1\n                                                     case newNames of \n                                                       Nothing -&gt; return $ Nothing\n                                                       Just newSetOfNames -&gt; return $ Just $ realBasket{fruitNames = newSetOfNames} \n             return maybeBasket''\n               where f = (outputStrLn interruptMessage  &gt;&gt; getData initialBasket)\n                     defaultOwner = ownerName initialBasket\n                     defaultCount = fruitCount initialBasket\n</code></pre>\n\n<p>Thus, for instance, we try to do any real computation to get <code>maybeBasket'</code> --- <em>including</em> presenting the prompt for the number of different kinds of fruit --- only if <code>maybeBasket</code> is not <code>Nothing</code>. </p>\n\n<p>This solves the Ctrl-D problem: the program now stops questioning and returns <code>Nothing</code> if the user presses Ctrl-D in response to any question.</p>\n\n<hr>\n\n<p>Now onto the factoring. This is where advice from the mailing list answer helped: I started out by splitting up the big <code>getData</code> function into three pieces, one for each \"big\" use of the <code>&lt;-</code> operator, and put these pieces into separate functions. This cleared up the logic a lot for me (indeed, this is how I found the fix to the Ctrl-D problem as well). Starting with this, I kept rephrasing the various parts till I got the following version which looks good enough to me. Notice how small and clean the <code>getBasketData</code> function has become!</p>\n\n<pre><code>module Main where \nimport System.Console.Haskeline\n\ntype PersonName = String\ntype FruitName = String\ndata FruitBasket = FruitBasket { ownerName :: PersonName,\n                                 fruitCount :: Int,\n                                 fruitNames :: [FruitName]\n                               } deriving Show\n\ndefaultBasket :: FruitBasket\ndefaultBasket = FruitBasket \"Mary\" 2 [\"Apple\", \"Peach\"]\n\nmain :: IO ()\nmain = do\n  basket &lt;- getBasketData defaultBasket\n  putStrLn $ \"Got: \" ++ show(basket)\n\n-- Prompt the user for information about a fruit basket, and\n-- return a FruitBasket instance containing this information.  The\n-- first argument is an instance of FruitBasket from which we get\n-- the default values for the various prompts. The return value\n-- has a Maybe type because the user may abort the questioning, in\n-- which case we get nothing from them.\ngetBasketData :: FruitBasket -&gt; IO (Maybe FruitBasket)\ngetBasketData basket = runInputT defaultSettings $ withInterrupt $ getData basket\n    where \n      getData :: FruitBasket -&gt; InputT IO (Maybe FruitBasket)\n      getData initialBasket = handleInterrupt f  $ do\n             outputStrLn banner\n             (ownerQ initialBasket) &gt;&gt;=  (processOwner initialBasket) &gt;&gt;= processCount &gt;&gt;= processNames\n               where f = (outputStrLn interruptMessage  &gt;&gt; getData initialBasket)\n\n\nownerQ :: FruitBasket -&gt; InputT IO (Maybe PersonName)\nownerQ basket = getInputLine $ \"Who owns this basket? [\" ++ (ownerName basket) ++ \"] : \"\n\n\nprocessOwner :: FruitBasket -&gt; Maybe PersonName -&gt; InputT IO (Maybe FruitBasket)\nprocessOwner _ Nothing = return Nothing\nprocessOwner _ (Just \"quit\") = return Nothing\nprocessOwner basket (Just \"\") = return $ Just basket \nprocessOwner basket (Just newOwner) = return $ Just basket{ownerName = newOwner}\n\n\nprocessCount ::  Maybe FruitBasket -&gt; InputT IO (Maybe FruitBasket)\nprocessCount Nothing = return Nothing\nprocessCount (Just basket) = (fruitTypesQ basket) &gt;&gt;= processCount'\n  where processCount' :: Maybe String -&gt; InputT IO (Maybe FruitBasket)\n        processCount' Nothing = return Nothing\n        processCount' (Just \"quit\") = return Nothing\n        processCount' (Just \"\") = return $ Just basket \n        processCount' (Just count) = return $ Just basket{fruitCount = (read count)}\n\n\nfruitTypesQ :: FruitBasket -&gt; InputT IO (Maybe String)        \nfruitTypesQ basket = getInputLine $ \"Number of kinds of fruit in the basket? [\" ++ show (fruitCount basket) ++ \"] : \"\n\n\nprocessNames :: Maybe FruitBasket -&gt; InputT IO (Maybe FruitBasket)\nprocessNames Nothing = return Nothing\nprocessNames (Just basket) = input &gt;&gt;= processNames'\n  where input = getFruitNames defaultFruitNames 1\n        defaultFruitNames = pruneOrPad (fruitNames basket) (fruitCount basket)\n        processNames' :: Maybe [FruitName] -&gt; InputT IO (Maybe FruitBasket)\n        processNames' Nothing = return Nothing\n        processNames' (Just newSetOfNames) = return $ Just basket{fruitNames = newSetOfNames}\n\n\n\nbanner :: String\nbanner = \"Please enter details of the fruit basket below. At each prompt you can do one of the following:\\n\\\n         \\\\t (a) Press Enter to submit the [default] value;\\n\\\n         \\\\t (b) Type in a string, edit it if needed, and then press Enter to submit this value;\\n\\\n         \\\\t (c) Press Ctrl-C to reset all values to the defaults and start over;\\n\\\n         \\\\t (d) Press Ctrl-D or enter \\\"quit\\\" to quit; all the values you submitted will be lost.\" \n\ninterruptMessage :: String\ninterruptMessage = \"#################################################\\n\\\n                   \\You pressed Ctrl-C.\\n\\\n                   \\We will now reset all values and start over.\\n\\\n                   \\To quit, press Ctrl-D or enter \\\"quit\\\".\\n\\\n                   \\#################################################\\n\"\n\n\n\n\npruneOrPadNames :: Maybe FruitBasket -&gt; Maybe [String]\npruneOrPadNames Nothing = Nothing\npruneOrPadNames (Just basket) = Just $ pruneOrPad (fruitNames basket) (fruitCount basket)\n\n-- When requiredLength is not larger than (length inputList),\n-- (pruneOrPad inputList requiredLength) is the prefix of\n-- inputList of length requiredLength. Otherwise, it is inputList\n-- padded with as many empty strings as required to make the total\n-- length equal to requiredLength.\n\npruneOrPad :: [String] -&gt; Int -&gt; [String]\npruneOrPad inputList requiredLength\n               | requiredLength &lt;= inputLength  = take requiredLength inputList\n               | otherwise = inputList ++ (replicate difference \"\")\n    where inputLength = length inputList\n          difference = requiredLength - inputLength\n\n\ngetFruitNames :: [FruitName] -&gt; Int -&gt; InputT IO (Maybe [FruitName])\ngetFruitNames  [] _  = return $ Just [\"\"]\ngetFruitNames (name:names) count = do\n  input &lt;- getInputLine $ \"Name of fruit \" ++ (show count) ++ \" [\" ++ name ++ \"] : \"\n  newNames &lt;- case input of\n               Nothing -&gt; return Nothing \n               Just \"\" -&gt; do -- Keep the default name for this fruit ...\n                          newNames' &lt;- getFruitNames names (count + 1) \n                          case newNames' of\n                            Nothing -&gt; return Nothing\n                            -- ... unless the user chose to quit\n                            -- while entering a name\n\n                            Just [\"\"] -&gt; return $ Just [name] \n                            -- At this point names = [] so it is\n                            -- already time to stop asking for\n                            -- more names.\n\n                            Just furtherNames -&gt;   return $ Just (name : furtherNames)\n\n               Just \"quit\" -&gt; return Nothing\n               Just name' -&gt; do\n                          newNames' &lt;- getFruitNames names (count + 1) \n                          case newNames' of\n                            Nothing -&gt; return Nothing\n                            Just [\"\"] -&gt; return $ Just [name'] \n                            Just furtherNames -&gt;  return $ Just (name' : furtherNames)\n  return newNames\n</code></pre>\n\n<hr>\n\n<p>The moral of this story seems to be: \"When confused, break things down.\"</p>\n"}], "owner": {"reputation": 555, "user_id": 4108393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1616347e88a4828ad7b5eaf6dff2337?s=128&d=identicon&r=PG&f=1", "display_name": "G Philip", "link": "https://stackoverflow.com/users/4108393/g-philip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1427042710, "creation_date": 1426982264, "last_edit_date": 1495534204, "question_id": 29189428, "link": "https://stackoverflow.com/questions/29189428/getting-haskeline-to-quit-early", "title": "Getting Haskeline to quit early", "body": "<p>I am trying to use <a href=\"https://hackage.haskell.org/package/haskeline-0.7.1.3/docs/System-Console-Haskeline.html\" rel=\"nofollow noreferrer\">Haskeline</a> to write a program which asks the user a sequence of questions, each one optionally with a default value in [brackets], and reads in their responses. I want the user to be able to</p>\n\n<ol>\n<li>Press Enter to submit the [default] value;</li>\n<li>Type in a string, edit it if needed, and then press Enter to submit this value;</li>\n<li>Press Ctrl-C to reset all values to the defaults and start over; and,</li>\n<li>Press Ctrl-D or enter \"quit\" to quit, in which case all the values which they  submitted are lost.</li>\n</ol>\n\n<p>I have been able to get points 1-3 working, but I cannot get point 4 to work: pressing Ctrl-D (or entering \"quit\") just brings up the next prompt instead of making the program quit the questioning. Looking at my program (please see below) I understand why this happens, but I am not able to figure out how to fix this so that Ctrl-D (or \"quit\") actually makes the questioning stop. How do I fix the program to make this happen?</p>\n\n<p>I did see <a href=\"https://stackoverflow.com/questions/4771199/haskell-best-practise-early-termination-in-haskeline\">this question</a> which seems to ask something similar, but I could not get much from there; I am not even sure that they are asking the same question as I am.</p>\n\n<p>As a secondary question: my current program has quite a few <code>case</code> statements which switch on <code>Maybe</code> values. In particular, I currently check for <code>Nothing</code> two or three levels deep so that I can correctly return a <code>Nothing</code> when the user presses Ctrl-D. I have a feeling that this could be simplified using (something like) the monadic <code>&gt;&gt;=</code> operator, but I am unable to figure out how to do this in this case. Is my hunch right? Is there a way to do away with all this pattern  matching which looks for <code>Nothing</code>?</p>\n\n<p>Also: please tell me anything else which could improve my code below. I am quite new to this, so it is very likely that I am missing many obvious things here.</p>\n\n<p>My program asks the user about the composition of a fruit basket. The information associated with a fruit basket consists of the name of the owner of the fruit basket and the names of the different kinds of fruit in the basket. To be able to ask for the latter, I first ask for the <em>number</em> of different kind of fruit in the basket, and then ask for the name of each kind. We start with a default fruit basket whose information is then modified as per what the user tells us. </p>\n\n<pre><code>module Main where \nimport System.Console.Haskeline\n\ntype PersonName = String\ntype FruitName = String\ndata FruitBasket = FruitBasket { ownerName :: PersonName,\n                                 fruitCount :: Int,\n                                 fruitNames :: [FruitName]\n                               } deriving Show\n\ndefaultBasket = FruitBasket \"Mary\" 2 [\"Apple\", \"Peach\"]\n\nmain :: IO ()\nmain = do\n  basket &lt;- getBasketData defaultBasket\n  putStrLn $ \"Got: \" ++ show(basket)\n\n-- Prompt the user for information about a fruit basket, and\n-- return a FruitBasket instance containing this information.  The\n-- first argument is an instance of FruitBasket from which we get\n-- the default values for the various prompts. The return value\n-- has a Maybe type because the user may abort the questioning, in\n-- which case we get nothing from them.\ngetBasketData :: FruitBasket -&gt; IO (Maybe FruitBasket)\ngetBasketData basket = runInputT defaultSettings $ withInterrupt $ getData basket\n    where \n      getData :: FruitBasket -&gt; InputT IO (Maybe FruitBasket)   \n      getData initialBasket = handleInterrupt f  $ do \n        outputStrLn banner\n        input &lt;- getInputLine $ \"Who owns this basket? [\" ++ defaultOwner ++ \"] : \"\n        basket &lt;- case input of\n                   Nothing -&gt; return Nothing -- User pressed Ctrl-D with the input being empty\n                   Just \"\" -&gt; return (Just initialBasket) -- User pressed Enter with the input being empty\n                   Just \"quit\" -&gt; return Nothing -- User typed in \"quit\" and pressed Enter\n                   Just newOwner -&gt; return (Just initialBasket{ownerName = newOwner})\n        input &lt;- getInputLine $ \"Number of kinds of fruit in the basket? [\" ++ show defaultCount ++ \"] : \"\n        basket' &lt;- case input of\n                    Nothing -&gt; return Nothing\n                    Just \"\" -&gt; return basket \n                    Just \"quit\" -&gt; return Nothing\n                    Just count -&gt; return $ updateFruitCount basket (read count)\n                           where updateFruitCount Nothing _ = Nothing\n                                 updateFruitCount (Just realBasket) newCount = Just $ realBasket{fruitCount = newCount}\n        let defaultFruitNames = pruneOrPadNames basket' \n        newNames &lt;- getFruitNames defaultFruitNames 1\n        case newNames of \n          Nothing -&gt; return (Just defaultBasket)\n          Just newSetOfNames -&gt; return $ updateFruitNames basket' newSetOfNames\n              where updateFruitNames Nothing _ = Nothing\n                    updateFruitNames (Just realBasket) realNewNames = Just $ realBasket{fruitNames = realNewNames} \n          where f = (outputStrLn \"Press Ctrl-D or enter \\\"quit\\\" to quit.\" &gt;&gt; getData initialBasket)\n                defaultOwner = ownerName initialBasket\n                defaultCount = fruitCount initialBasket\n\n\nbanner :: String\nbanner = \"Please enter details of the fruit basket below. At each prompt you can do one of the following:\\n\\\n         \\\\t (a) Press Enter to submit the [default] value;\\n\\\n         \\\\t (b) Type in a string, edit it if needed, and then press Enter to submit this value;\\n\\\n         \\\\t (c) Press Ctrl-C to reset all values to the defaults and start over;\\n\\\n         \\\\t (d) Press Ctrl-D or enter \\\"quit\\\" to quit; all the values you submitted will be lost.\" \n\npruneOrPadNames :: Maybe FruitBasket -&gt; Maybe [String]\npruneOrPadNames Nothing = Nothing\npruneOrPadNames (Just basket) = Just $ pruneOrPad (fruitNames basket) (fruitCount basket)\n\n-- When requiredLength is not larger than (length inputList),\n-- (pruneOrPad inputList requiredLength) is the prefix of\n-- inputList of length requiredLength. Otherwise, it is inputList\n-- padded with as many empty strings as required to make the total\n-- length equal to requiredLength.\n\npruneOrPad :: [String] -&gt; Int -&gt; [String]\npruneOrPad inputList requiredLength\n               | requiredLength &lt;= inputLength  = take requiredLength inputList\n               | otherwise = inputList ++ (replicate difference \"\")\n    where inputLength = length inputList\n          difference = requiredLength - inputLength\n\n\n\ngetFruitNames Nothing _ = return Nothing\ngetFruitNames (Just []) _  = return $ Just [\"\"]\ngetFruitNames (Just (name:names)) count = do\n  input &lt;- getInputLine $ \"Name of fruit \" ++ (show count) ++ \" [\" ++ name ++ \"] : \"\n  newNames &lt;- case input of\n               Nothing -&gt; return Nothing \n               Just \"\" -&gt; do -- Keep the default name for this fruit ...\n                          newNames' &lt;- getFruitNames (Just names) (count + 1) \n                          case newNames' of\n                            Nothing -&gt; return Nothing\n                            -- ... unless the user chose to quit\n                            -- while entering a name\n\n                            Just [\"\"] -&gt; return $ Just [name] \n                            -- At this point names = [] so it is\n                            -- already time to stop asking for\n                            -- more names.\n\n                            Just furtherNames -&gt;   return $ Just (name : furtherNames)\n\n               Just \"quit\" -&gt; return Nothing\n               Just name' -&gt; do\n                          newNames' &lt;- getFruitNames (Just names) (count + 1) \n                          case newNames' of\n                            Nothing -&gt; return Nothing\n                            Just [\"\"] -&gt; return $ Just [name'] \n                            Just furtherNames -&gt;  return $ Just (name' : furtherNames)\n  return newNames\n</code></pre>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1427008683, "post_id": 29189077, "comment_id": 46597668, "body": "I don&#39;t think this is right. OP&#39;s problem was that he didn&#39;t have any pass-through Zoom instance to begin with, and we can solve that by writing the instance, and it&#39;s not necessary to generalize the state. <code>Zoomed (Hearth m) = Focusing m</code> and <code>instance Monad m =&gt; Zoom (Hearth m) (Hearth m) GameState GameState</code> is good here too. The <code>s</code> and <code>t</code> params in <code>Zoom</code> refer to the old and new state types of the monad transformer, not the type of the lens that can be zoomed."}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1427025878, "post_id": 29189077, "comment_id": 46601434, "body": "@Andr&#225;sKov&#225;cs You can write that instance but I can&#39;t get it to work. What would the type of  <code>hand &lt;&gt;= [card]</code> be? In my solution it&#39;s <code>HearthS Player m ()</code>."}, {"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1427026578, "post_id": 29189077, "comment_id": 46601655, "body": "You also can&#39;t write a <code>Zoom (StateT t z) (Hearth z) t GameState</code> instance because of the functional dependencies. You could do <code>Zoom (HearthS t z) (Hearth z) t GameState</code> where <code>HearthS</code> and <code>Hearth</code> are both newtypes but this feels like a bad solution."}], "tags": [], "owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "is_accepted": true, "score": 7, "last_activity_date": 1426979027, "creation_date": 1426979027, "answer_id": 29189077, "question_id": 29188217, "link": "https://stackoverflow.com/questions/29188217/lens-zoom-ambiguous-variable/29189077#29189077", "title": "Lens zoom ambiguous variable", "body": "<p>The problem is your newtype can only hold one state, namely <code>GameState</code>. Zoom essentially changes the state to the target of your lens, but since <code>Hearth</code> cannot have <code>Player</code> as a state, <code>zoom (getPlayer handle)</code> can't be used with <code>Hearth</code>.</p>\n\n<p>The simple solution is to replace the newtype with <code>type Hearth = StateT GameState</code> and zooming works. If you want a newtype you'll need to have the state parameterised, here's an example:</p>\n\n<pre><code>import Control.Lens.Internal.Zoom\n\nnewtype HearthS s m a = Hearth {\n    unHearth :: StateT s m a\n} deriving (Functor, Applicative, Monad, MonadState s, MonadIO, MonadTrans)\n\ntype Hearth = HearthS GameState\n\ntype instance Zoomed (HearthS s m) = Focusing m\ninstance Monad z =&gt; Zoom (HearthS s z) (HearthS t z) s t where\n  zoom l (Hearth m) = Hearth (zoom l m)\n</code></pre>\n"}], "owner": {"reputation": 30828, "user_id": 239916, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/950ab2797f3012eeed28559fcdde8e1f?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Eding", "link": "https://stackoverflow.com/users/239916/thomas-eding"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 1, "accepted_answer_id": 29189077, "answer_count": 1, "score": 3, "last_activity_date": 1426979027, "creation_date": 1426973043, "last_edit_date": 1426973407, "question_id": 29188217, "link": "https://stackoverflow.com/questions/29188217/lens-zoom-ambiguous-variable", "title": "Lens zoom ambiguous variable", "body": "<p>I'm having difficulty using the <code>zoom</code> function given by <code>Control.Lens</code>. With my custom monad transformer <code>HearthMonad</code>, I cannot figure out how to satisfy GHC's \"ambiguous type\" complaint.</p>\n\n<p>The code in question is in <code>drawCard</code>.</p>\n\n<p>How can I solve this? Do I have to create my own custom zoom operator to handle the <code>Monad m</code> in <code>Hearth m</code>?</p>\n\n<hr>\n\n<pre><code>{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE TemplateHaskell #-}\n\n\nmodule EngineZoom where\n\n\n--------------------------------------------------------------------------------\n\n\nimport Control.Applicative\nimport Control.Lens\nimport Control.Monad.State\nimport Data.List\nimport Data.Maybe\n\n\n--------------------------------------------------------------------------------\n\n\ntype PlayerHandle = String\n\n\ndata Card = Card String\n    deriving (Show, Eq, Ord)\n\n\ndata Player = Player {\n    _playerHandle :: PlayerHandle,\n    _hand :: [Card]\n} deriving (Show, Eq, Ord)\nmakeLenses ''Player\n\n\ndata GameState = GameState {\n    _gamePlayers :: [Player]\n} deriving (Show, Eq, Ord)\nmakeLenses ''GameState\n\n\nnewtype Hearth m a = Hearth {\n    unHearth :: StateT GameState m a\n} deriving (Functor, Applicative, Monad, MonadState GameState, MonadIO, MonadTrans)\n\n\ntype HearthMonad = MonadIO\n\n\nrunHearth :: (HearthMonad m) =&gt; m ()\nrunHearth = evalStateT (unHearth runGame) mkGameState\n\n\nmkGameState :: GameState\nmkGameState = GameState { _gamePlayers = map mkPlayer [\"Bob\", \"Joe\"] }\n\n\nmkPlayer :: PlayerHandle -&gt; Player\nmkPlayer handle = Player { _playerHandle = handle, _hand = [] }\n\n\nrunGame :: (HearthMonad m) =&gt; Hearth m ()\nrunGame = do\n    card &lt;- drawCard \"Bob\"\n    liftIO $ print card\n\n\ngetPlayer :: PlayerHandle -&gt; Lens' GameState Player\ngetPlayer handle f st = fmap put' get'\n    where\n        players = st^.gamePlayers\n        put' player = let\n            g p = case p^.playerHandle == handle of\n                True -&gt; player\n                False -&gt; p\n            in set gamePlayers (map g players) st\n        get' = f $ fromJust $ find (\\p -&gt; p^.playerHandle == handle) players\n\n\ndrawCard :: (HearthMonad m) =&gt; PlayerHandle -&gt; Hearth m Card\ndrawCard handle = do\n    let card = Card \"Yeti\"\n    --getPlayer handle.hand &lt;&gt;= [card]\n    zoom (getPlayer handle) $ hand &lt;&gt;= [card]\n    return card\n</code></pre>\n\n<hr>\n\n<pre><code>EngineZoom.hs:86:5:\n    Could not deduce (Control.Lens.Internal.Zoom.Zoomed (Hearth m)\n                      ~ Control.Lens.Internal.Zoom.Zoomed m0)\n    from the context (HearthMonad m)\n      bound by the type signature for\n                 drawCard :: HearthMonad m =&gt; PlayerHandle -&gt; Hearth m Card\n      at EngineZoom.hs:82:13-60\n    NB: `Control.Lens.Internal.Zoom.Zoomed' is a type function, and may not be injective\n    The type variable `m0' is ambiguous\n    Relevant bindings include\n      drawCard :: PlayerHandle -&gt; Hearth m Card\n        (bound at EngineZoom.hs:83:1)\n    In the expression: zoom (getPlayer handle)\n    In a stmt of a 'do' block:\n      zoom (getPlayer handle) $ hand &lt;&gt;= [card]\n    In the expression:\n      do { let card = Card \"Yeti\";\n           zoom (getPlayer handle) $ hand &lt;&gt;= [card];\n           return card }\n</code></pre>\n"}, {"tags": ["scala", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 12424, "user_id": 345859, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/cdb711788e4473ecd856108533787144?s=128&d=identicon&r=PG&f=1", "display_name": "Jas", "link": "https://stackoverflow.com/users/345859/jas"}, "edited": false, "score": 0, "creation_date": 1502909498, "post_id": 29188104, "comment_id": 78400182, "body": "where do i see in the signature <code>(a -&gt; m b)</code> that the function should generate a traversable type, i only see that the function should produce <code>m b</code> but m is general isn&#39;t it where does it say a list? isn&#39;t a list denoted in haskell by <code>[]</code> i don&#39;t see any <code>[]</code> in the haskell bind definition..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 12424, "user_id": 345859, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/cdb711788e4473ecd856108533787144?s=128&d=identicon&r=PG&f=1", "display_name": "Jas", "link": "https://stackoverflow.com/users/345859/jas"}, "edited": false, "score": 1, "creation_date": 1502910878, "post_id": 29188104, "comment_id": 78400823, "body": "@Jas Above I&#39;m only saying that Scala&#39;s bind <i>for lists</i> (shown above) is more general than Haskell&#39;s bind <i>for lists</i>. I am not comparing the general bind (Scala has no &quot;general&quot; bind, only classes which happen to have a flatMap, IIRC). In Haskell, we have a list-bind <code>[a] -&gt; (a -&gt; [b]) -&gt; [b]</code> when in Scala it is more similar to <code>[a] -&gt; (a -&gt; t b) -&gt; [b]</code> for a suitable <code>t</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 11, "last_activity_date": 1426972318, "creation_date": 1426972318, "answer_id": 29188104, "question_id": 29187983, "link": "https://stackoverflow.com/questions/29187983/comparing-haskell-and-scala-bind-flatmap-examples/29188104#29188104", "title": "Comparing Haskell and Scala Bind/Flatmap Examples", "body": "<p>Quoting from the Scala reference for <a href=\"http://www.scala-lang.org/api/2.11.6/#scala.collection.immutable.List\"><code>List</code></a></p>\n\n<pre><code>final def flatMap[B](f: (A) \u21d2 GenTraversableOnce[B]): List[B] \n</code></pre>\n\n<p>So, <code>flatMap</code> is more general than Haskell's <code>(&gt;&gt;=)</code>, since it only requires the mapped function <code>f</code> to generate a traversable type, not necessarily a <code>List</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1426973768, "post_id": 29188246, "comment_id": 46591422, "body": "Is that just <code>List</code>s <code>flatMap</code> or does this work for every type in Scala?"}, {"owner": {"reputation": 1251, "user_id": 3973371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb6b82669e037ed73e47d6532ef2c246?s=128&d=identicon&r=PG&f=1", "display_name": "bmaderbacher", "link": "https://stackoverflow.com/users/3973371/bmaderbacher"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1426974021, "post_id": 29188246, "comment_id": 46591486, "body": "The <code>GenTraversableOnce</code> is used for all &quot;list like&quot; collections in Scala. It&#39;s possible to use e.g. a <code>Vector</code> in combination with a <code>List</code>. <code>Vector(1).flatMap(x=&gt;List(x)) == Vector(1)</code> or <code>List(1).flatMap(x=&gt;Vector(x)) == List(1)</code>"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1426974303, "post_id": 29188246, "comment_id": 46591560, "body": "Nah, I wondered whether the use of <code>GenTraversableOnce</code> in the <code>flatMap</code> signature is a generalisation that is specific to lists, or is working in all monads (types with a <code>flatMap</code> method?)?"}, {"owner": {"reputation": 1251, "user_id": 3973371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb6b82669e037ed73e47d6532ef2c246?s=128&d=identicon&r=PG&f=1", "display_name": "bmaderbacher", "link": "https://stackoverflow.com/users/3973371/bmaderbacher"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1426974447, "post_id": 29188246, "comment_id": 46591598, "body": "It&#39;s only defined this way for <code>List</code>, <code>Vector</code> and probably some other similar types. <code>Option</code> on the other hand has a simple <code>flatMap</code> as you would expect: <code>final def flatMap[B](f: (A) \u21d2 Option[B]): Option[B]</code>"}, {"owner": {"reputation": 1251, "user_id": 3973371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb6b82669e037ed73e47d6532ef2c246?s=128&d=identicon&r=PG&f=1", "display_name": "bmaderbacher", "link": "https://stackoverflow.com/users/3973371/bmaderbacher"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1426975604, "post_id": 29188246, "comment_id": 46591897, "body": "@Bergi I&#39;ve looked into it and it seems that every subclass of <code>TraversableOnce</code> shows this behavior, I&#39;ve added the details to my answer."}], "tags": [], "owner": {"reputation": 1251, "user_id": 3973371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb6b82669e037ed73e47d6532ef2c246?s=128&d=identicon&r=PG&f=1", "display_name": "bmaderbacher", "link": "https://stackoverflow.com/users/3973371/bmaderbacher"}, "is_accepted": true, "score": 20, "last_activity_date": 1488187469, "last_edit_date": 1488187469, "creation_date": 1426973260, "answer_id": 29188246, "question_id": 29187983, "link": "https://stackoverflow.com/questions/29187983/comparing-haskell-and-scala-bind-flatmap-examples/29188246#29188246", "title": "Comparing Haskell and Scala Bind/Flatmap Examples", "body": "<p>As @chi explained Scala's <code>flatMap</code> is more general than the Haskell's <code>&gt;&gt;=</code>. The full signature from the Scala docs is:</p>\n\n<pre><code>final def flatMap[B, That](f: (A) \u21d2 GenTraversableOnce[B])(implicit bf: CanBuildFrom[List[A], B, That]): That\n</code></pre>\n\n<p>This implicit isn't relevant for this specific problem, so we could as well use the simpler definition:</p>\n\n<pre><code>final def flatMap[B](f: (A) \u21d2 GenTraversableOnce[B]): List[B]\n</code></pre>\n\n<p>There is only one Problem, <code>Option</code> is no subclass of <code>GenTraversableOnce</code>, here an implicit conversion comes in. Scala defines an implicit conversion from <code>Option</code> to <code>Iterable</code> which is a subclass of <code>Traversable</code> which is a subclass of <code>GenTraversableOnce</code>.</p>\n\n<pre><code>implicit def option2Iterable[A](xo: Option[A]): Iterable[A]   \n</code></pre>\n\n<p>The implicit is defined in the companion object of <code>Option</code>.</p>\n\n<p>A simpler way to see the implicit at work is to assign a <code>Option</code> to an <code>Iterable</code> <code>val</code>:</p>\n\n<pre><code>scala&gt; val i:Iterable[Int] = Some(1)\ni: Iterable[Int] = List(1)\n</code></pre>\n\n<p>Scala uses some defaulting rules, to select <code>List</code> as the implementation of <code>Iterable</code>.</p>\n\n<p>The fact that you can combine different subtypes of <code>TraversableOnce</code> with monad operations comes from the <code>implicit class</code> <code>MonadOps</code>:</p>\n\n<pre><code>  implicit class MonadOps[+A](trav: TraversableOnce[A]) {\n    def map[B](f: A =&gt; B): TraversableOnce[B] = trav.toIterator map f\n    def flatMap[B](f: A =&gt; GenTraversableOnce[B]): TraversableOnce[B] = trav.toIterator flatMap f\n    def withFilter(p: A =&gt; Boolean) = trav.toIterator filter p\n    def filter(p: A =&gt; Boolean): TraversableOnce[A] = withFilter(p)\n  }\n</code></pre>\n\n<p>This enhances every <code>TraversableOnce</code> with the methods above. The subtypes are free to define more efficient versions on there own, these will shadow the implicit definitions. This is the case for <code>List</code>.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3709, "favorite_count": 3, "accepted_answer_id": 29188246, "answer_count": 2, "score": 16, "last_activity_date": 1488187469, "creation_date": 1426971562, "last_edit_date": 1426971749, "question_id": 29187983, "link": "https://stackoverflow.com/questions/29187983/comparing-haskell-and-scala-bind-flatmap-examples", "title": "Comparing Haskell and Scala Bind/Flatmap Examples", "body": "<p>The following <code>bind(&gt;&gt;=)</code> code, in Haskell, does not compile:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>ghci&gt; [[1]] &gt;&gt;= Just\n&lt;interactive&gt;:38:11:\n    Couldn't match type \u2018Maybe\u2019 with \u2018[]\u2019\n    Expected type: [t] -&gt; [[t]]\n      Actual type: [t] -&gt; Maybe [t]\n    In the second argument of \u2018(&gt;&gt;=)\u2019, namely \u2018Just\u2019\n    In the expression: [[1]] &gt;&gt;= Just\n</code></pre>\n\n<p>But, in Scala, it does actually compile and run:</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>scala&gt; List( List(1) ).flatMap(x =&gt; Some(x) )\nres1: List[List[Int]] = List(List(1))\n</code></pre>\n\n<p>Haskell's <code>&gt;&gt;=</code> signature is:</p>\n\n<p><code>&gt;&gt;= :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code></p>\n\n<p>So, in <code>[[1]] &gt;&gt;= f</code>, <code>f</code>'s type should be: <code>a -&gt; [b]</code>.</p>\n\n<p>Why does the Scala code compile?</p>\n"}, {"tags": ["python", "performance", "haskell", "io"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1426973400, "post_id": 29186541, "comment_id": 46591300, "body": "Your test file is virtually all zeros. Is this really a good test?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1427018485, "post_id": 29186541, "comment_id": 46599626, "body": "@dfeuer I didn&#39;t generate that file. It just happens to be one of the test cases given during the contest. It may be bad or uninteresting, but I didn&#39;t have a say in this."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1427026029, "post_id": 29186541, "comment_id": 46601473, "body": "I know that <code>read :: String -&gt; Integer</code> was <i>quadratic</i> at least until a more or less recent patch. Not sure whether the same kind of algorithm was used for <code>Int</code>..."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 8, "creation_date": 1427045225, "post_id": 29186541, "comment_id": 46607605, "body": "Notice <code>read</code> is just the wrong tool for the job when your format is simply ints.  <code>read</code> is intended to parse valid haskell expressions, so things like <code>&quot;((( 0x8485)   ))&quot;</code>  will parse fine at quite some extra cost."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 27, "last_activity_date": 1426964893, "last_edit_date": 1495542285, "creation_date": 1426964893, "answer_id": 29186861, "question_id": 29186541, "link": "https://stackoverflow.com/questions/29186541/why-is-this-haskell-program-so-much-slower-than-an-equivalent-python-one/29186861#29186861", "title": "Why is this Haskell program so much slower than an equivalent Python one?", "body": "<p><strong>Read is slow</strong></p>\n\n<p>Fast read, <a href=\"https://stackoverflow.com/questions/10357663/python-faster-than-compiled-haskell/10358198#10358198\">from this answer</a>, will bring you down to 5.5 seconds.</p>\n\n<pre><code>import Numeric\nfastRead :: String -&gt; Int\nfastRead s = case readDec s of [(n, \"\")] -&gt; n\n</code></pre>\n\n<p><strong>Strings are Linked Lists</strong></p>\n\n<p>In Haskell the <code>String</code> type is a linked list.  Using a packed representation (<code>bytestring</code> if you really only want ascii but <code>Text</code> is also very fast and supports unicode).  As shown in <a href=\"https://stackoverflow.com/questions/10357663/python-faster-than-compiled-haskell/10360424#10360424\">this answer</a>, the performance should then be neck and neck.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1427003307, "post_id": 29186898, "comment_id": 46596784, "body": "You should do better using <code>B.dropWhile (not . isDigit)</code>. <code>isDigit</code> is much cheaper than <code>isSpace</code>, although not <i>quite</i> as cheap as the fake version, <code>(==&#39; &#39;)</code>."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 66, "last_activity_date": 1427007825, "last_edit_date": 1427007825, "creation_date": 1426965168, "answer_id": 29186898, "question_id": 29186541, "link": "https://stackoverflow.com/questions/29186541/why-is-this-haskell-program-so-much-slower-than-an-equivalent-python-one/29186898#29186898", "title": "Why is this Haskell program so much slower than an equivalent Python one?", "body": "<p><code>read</code> is slow. For bulk parsing, use <code>bytestring</code> or <code>text</code> primitives, or <code>attoparsec</code>. </p>\n\n<p>I did some benchmarking. Your original version ran in <strong>23,9</strong> secs on my computer. The version below ran in <strong>0.35</strong> secs:</p>\n\n<pre><code>import qualified Data.ByteString.Char8 as B\nimport Control.Applicative\nimport Data.Maybe\nimport Data.List\nimport Data.Char\n\nmain = print . sum =&lt;&lt; getIntList\n\ngetIntList :: IO [Int]\ngetIntList =\n    map (fst . fromJust . B.readInt) . B.words &lt;$&gt; B.readFile \"test.txt\"\n</code></pre>\n\n<p>By specializing the parser to your <code>test.txt</code> file, I could get the runtime down to <strong>0.26</strong> sec:</p>\n\n<pre><code>getIntList :: IO [Int]          \ngetIntList =\n    unfoldr (B.readInt . B.dropWhile (==' ')) &lt;$&gt; B.readFile \"test.txt\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1426971826, "post_id": 29187868, "comment_id": 46590865, "body": "<code>word</code> doesn&#39;t seem to be the big issue, empirically. With <code>map (const 0) . words &lt;$&gt; readFile &quot;test.txt&quot;</code> the code runs in 1,3 sec, as opposed to ~23 sec if I do the <code>read</code> instead of <code>const 0</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1426972094, "post_id": 29187868, "comment_id": 46590927, "body": "@Andr&#225;sKov&#225;cs, interesting. What happens if you use a fast version of <code>read</code> along with <code>words</code>? If <code>read</code> can be made so much faster, why isn&#39;t it?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 4, "creation_date": 1426972246, "post_id": 29187868, "comment_id": 46590963, "body": "if I use a rather ugly <code>map (fst . fromJust . B.readInt . B.pack) . words &lt;$&gt; readFile &quot;test.txt&quot;</code>, I still get 2 sec runtime. It&#39;d be a good idea to look at <code>read</code>..."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 5, "last_activity_date": 1426971159, "last_edit_date": 1426971159, "creation_date": 1426970834, "answer_id": 29187868, "question_id": 29186541, "link": "https://stackoverflow.com/questions/29186541/why-is-this-haskell-program-so-much-slower-than-an-equivalent-python-one/29187868#29187868", "title": "Why is this Haskell program so much slower than an equivalent Python one?", "body": "<p>I would venture to guess that a big part of your problem is actually <code>words</code>. When you <code>map read . words</code>, what you're actually doing is this:</p>\n\n<ol>\n<li>Scan the input looking for a space, building a list of non-spaces as you go. There are a lot of different kinds of spaces, and checking any character that's not a common type of space additionally involves a foreign call to a C function (slow). I'm planning to fix this sometime, but I haven't gotten around to it yet, and even then you'll still be building and throwing away lists for no good reason, and checking for spaces when you really just want to check for digits.</li>\n<li>Read through the list of accumulated characters to try to make a number out of them. Produce the number. The accumulated list now becomes garbage.</li>\n<li>Go back to step 1.</li>\n</ol>\n\n<p>This is a fairly ridiculous way to proceed. I believe you can even do better using something horrible like <code>reads</code>, but it would make more sense to use something like <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Text-ParserCombinators-ReadP.html\" rel=\"nofollow\">ReadP</a>. You can also try fancier sorts of things like stream-based parsing; I don't know if that will help much or not.</p>\n"}], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4215, "favorite_count": 6, "accepted_answer_id": 29186898, "answer_count": 3, "score": 45, "last_activity_date": 1461686900, "creation_date": 1426963117, "last_edit_date": 1461686900, "question_id": 29186541, "link": "https://stackoverflow.com/questions/29186541/why-is-this-haskell-program-so-much-slower-than-an-equivalent-python-one", "title": "Why is this Haskell program so much slower than an equivalent Python one?", "body": "<p>As part of a programming challenge, I need to read, from stdin, a sequence of space-separated integers (<em>on a single line</em>), and print the sum of those integers to stdout. The sequence in question can contain as many as 10,000,000 integers.</p>\n\n<p>I have two solutions for this: one written in Haskell (<code>foo.hs</code>), and another, equivalent one, written in Python 2 (<code>foo.py</code>). Unfortunately, the (compiled) Haskell program is consistently slower than the Python program, and I'm at a loss for explaining the discrepancy in performance between the two programs; see the <em>Benchmark</em> section below. If anything, I would have expected Haskell to have the upper hand...</p>\n\n<p>What am I doing wrong? How can I account for this discrepancy? Is there an easy way of speeding up my Haskell code?</p>\n\n<p>(For information, I'm using a mid-2010 Macbook Pro with 8Gb RAM, GHC 7.8.4, and Python 2.7.9.)</p>\n\n<h3><code>foo.hs</code></h3>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main = print . sum =&lt;&lt; getIntList\n\ngetIntList :: IO [Int]\ngetIntList = fmap (map read . words) getLine\n</code></pre>\n\n<p>(compiled with <code>ghc -O2 foo.hs</code>)</p>\n\n<h3><code>foo.py</code></h3>\n\n<pre class=\"lang-py prettyprint-override\"><code>ns = map(int, raw_input().split())\nprint sum(ns)\n</code></pre>\n\n<h3>Benchmark</h3>\n\n<p>In the following, <a href=\"https://github.com/Jubobs/test/blob/master/test.txt?raw=true\" rel=\"nofollow\"><code>test.txt</code></a> consists of a single line of 10 million space-separated integers.</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code># Haskell\n$ time ./foo &lt; test.txt \n1679257\n\nreal    0m36.704s\nuser    0m35.932s\nsys     0m0.632s\n\n# Python\n$ time python foo.py &lt; test.txt\n1679257 \n\nreal    0m7.916s\nuser    0m7.756s\nsys     0m0.151s\n</code></pre>\n"}, {"tags": ["database", "haskell", "database-migration", "yesod", "persistent"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1426963555, "post_id": 29186432, "comment_id": 46588288, "body": "Did you change the table name ? If you don&#39;t need to preserve the data (since you seem to be playing with fpcomplete), you can use <code>runMigrationUnsafe</code> to migrate it anyway."}], "owner": {"user_type": "does_not_exist", "display_name": "user4653789"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 577, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1426962559, "creation_date": 1426962559, "last_edit_date": 1495535334, "question_id": 29186432, "link": "https://stackoverflow.com/questions/29186432/yesod-database-migration-manual-intervention-required", "title": "Yesod: &quot;Database migration: manual intervention required&quot;", "body": "<p>In my Yesod web app I found my code - which had worked perfectly before - impossible to launch properly.</p>\n\n<p>The error message was this: </p>\n\n<blockquote>\n  <p>Database migration: manual intervention required.The following actions are >considered unsafe: DROP TABLE \"config_d_b\";</p>\n</blockquote>\n\n<p>The database consists of this code:</p>\n\n<pre><code>    share [mkPersist sqlSettings, mkMigrate \"migrateAll\"]\n    [persistLowerCase|\n    ConfigDB\n        numberOfParticipants Int\n        setEndOfRegDate      Bool Maybe\n        endOfRegistration    Day Maybe\n        stopRegistration     Bool\n        groupName            Text\n        deriving Show\n    |]\n</code></pre>\n\n<p>I'm working on fpcomplete and now, after logging out and leaving it alone for ten minutes, it works fine. \nI still don't want to run the risk of this happening again (presentation due in 4 days). </p>\n\n<p>So, what is going on?\nFrom this related question:\n<a href=\"https://stackoverflow.com/questions/23004528/haskell-persistent-out-of-sync\">Haskell Persistent out of sync</a>\nI got the impression that it had something to do with </p>\n\n<pre><code>    endOfRegistration    Day Maybe\n</code></pre>\n\n<p>but deleting all the related code yielded no different result.</p>\n\n<p>Thanks in advance, Sophia</p>\n"}, {"tags": ["parsing", "haskell", "syntax"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 1, "creation_date": 1426957654, "post_id": 29185467, "comment_id": 46586454, "body": "You could possibly build an AST with more than two children. Say this specific node gets as children the list <code>[x, ***, y, +++, z]</code>, then check the precedence and build a binary node to replace itself afterwards. (There is probably a better approach)."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1426961700, "post_id": 29185467, "comment_id": 46587668, "body": "Note that you could also do this very easily without any hacks by just having two parse passes, one to grab operator fixity and precedence and one to actually parse the source code."}], "answers": [{"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1426958651, "post_id": 29185676, "comment_id": 46586771, "body": "Oh my God, that&#39;s terrifying! o_O"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1426959508, "post_id": 29185676, "comment_id": 46587019, "body": "So &quot;re-associate the syntax tree&quot; basically amounts to a series of tree rotations?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1426960699, "post_id": 29185676, "comment_id": 46587351, "body": "Well, yes. You can look at the source of the renamer (e.g <a href=\"https://github.com/ghc/ghc/blob/master/compiler/rename/RnExpr.hs#L122\" rel=\"nofollow noreferrer\">this part</a>) and see it for yourself."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1426965071, "post_id": 29185676, "comment_id": 46588783, "body": "@MathematicalOrchid Indeed, it&#39;s a bit scary but at least is simple. I do not dare to peek at how Agda handles mixfix notation (<code>use_and_now : A-&gt;B-&gt;C</code>), or how Coq handles arbitrary user defined <code>Notation</code> (which can even include binders! Roughly, <code>Notation &quot;match e with Left x-&gt;ex ; Right y-&gt;ey&quot; := either (\\x-&gt;ex) (\\y-&gt;ey) e</code>) or how Maude allows one to define <code>op __</code> which is the <i>juxtaposition operator</i> (so that <code>x y z</code> when <code>x,y,z</code> are of your custom type makes use of such <code>op</code>)."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 4, "creation_date": 1427055897, "post_id": 29185676, "comment_id": 46611205, "body": "There is a <a href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.157.7899\" rel=\"nofollow noreferrer\">paper</a> about Agda&#39;s mixfix notation."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 11, "last_activity_date": 1426961919, "last_edit_date": 1426961919, "creation_date": 1426958556, "answer_id": 29185676, "question_id": 29185467, "link": "https://stackoverflow.com/questions/29185467/parsing-with-user-defined-operator-precedence/29185676#29185676", "title": "Parsing with user-defined operator precedence", "body": "<p>Quoting the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/Parser\" rel=\"noreferrer\">page on GHC trac</a> for the parser:</p>\n\n<blockquote>\n  <p>Infix operators are parsed as if they were all left-associative. The\n  renamer uses the fixity declarations to re-associate the syntax tree.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1599253622, "post_id": 29190619, "comment_id": 112728183, "body": "The <a href=\"https://www.haskell.org/onlinereport/syntax-iso.html\" rel=\"nofollow noreferrer\">Haskell 98 Report &#167;9.3</a> says: \u201c\u2026the expression <code>do a == b == c</code> has a single unambiguous\u2026parse, namely <code>(do { a == b }) == c</code> because <code>(==)</code> is non-associative\u201d\u2014and therefore leads to an error after <code>b</code>, inserting a close-brace due to the layout rule. This implies that a local fixity declaration like your example <i>was</i> in fact ambiguous/paradoxical in precisely the way you describe. They helpfully offer \u201cProgrammers are therefore advised to avoid writing code that requires the parser to insert a closing brace in such situations\u201d. ;)"}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 8, "last_activity_date": 1426999507, "last_edit_date": 1426999507, "creation_date": 1426994787, "answer_id": 29190619, "question_id": 29185467, "link": "https://stackoverflow.com/questions/29185467/parsing-with-user-defined-operator-precedence/29190619#29190619", "title": "Parsing with user-defined operator precedence", "body": "<p>Andr\u00e1s Kov\u00e1cs's answer tells what's really done in GHC, but there's some history to this.</p>\n\n<p>There was actually a somewhat hypothetical change from the Haskell 98 to the Haskell 2010 standard.  In the former's BNF grammar, operator fixity and parsing were intertwined in such a way that you could in theory have some <em>very</em> strange interactions between the rules for fixity and the rules for when expressions and indentation blocks end. (For the latter two, the rules are essentially, \"keep on going until you have to stop\".)</p>\n\n<p>In particular you could redefine a local operator and its fixity such that a use of it belonged in the redefining inner <code>where</code> block exactly ... when it didn't. So you got a parser paradox. I cannot find any of the old examples but this may be one:</p>\n\n<pre><code>let (+) = (Prelude.+)\n    infix 9 + -- make the inner + high precedence and non-associative\nin 2 + 3 + 4\n--       ^ this + cannot parse here as the inner operator, which means\n--         the let ... in ... expression should end automatically first,\n--         but then it's the standard +, and its fixity says it should parse\n--         as part of the inner expression...\n</code></pre>\n\n<p>In Haskell 2010 they officially changed that so that operator fixities are determined in a separate stage after the parsing proper.</p>\n\n<p>So why was this a hypothetical change? Because all the compiler writers already did it the Haskell 2010 way, and always had, for their own sanity.</p>\n"}, {"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 2, "creation_date": 1427056949, "post_id": 29192735, "comment_id": 46611578, "body": "The last option is a bit tricky when you have local redefinitions of operators like in my example."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 2, "last_activity_date": 1427015993, "creation_date": 1427015993, "answer_id": 29192735, "question_id": 29185467, "link": "https://stackoverflow.com/questions/29185467/parsing-with-user-defined-operator-precedence/29192735#29192735", "title": "Parsing with user-defined operator precedence", "body": "<p>Summarising the comments so far, it seems the possibilities are thus:</p>\n\n<ul>\n<li>Return a parse tree where any infix operators are left as some kind of \"list\" structure, and then rearrange once precedences become known.</li>\n<li>Pretend you know the operator precedences, and then rearrange the parse tree after the fact.</li>\n<li>Do a first parse that only reads imports and fixity declarations, load the imports, and then do a full parse with known precedences.</li>\n</ul>\n"}], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 762, "favorite_count": 1, "accepted_answer_id": 29185676, "answer_count": 3, "score": 20, "last_activity_date": 1427015993, "creation_date": 1426957352, "question_id": 29185467, "link": "https://stackoverflow.com/questions/29185467/parsing-with-user-defined-operator-precedence", "title": "Parsing with user-defined operator precedence", "body": "<p>OK, so here's a question: Given that Haskell allows you to define new operators with arbitrary operator precedence... how is it possible to actually parse Haskell source code?</p>\n\n<p>You cannot know what operator precedences are set until you parse the source. But you cannot parse the source until you know the correct operator precedences. So... um, how?</p>\n\n<p>Consider, for example, the expression</p>\n\n<pre><code>x *** y +++ z\n</code></pre>\n\n<p>Until we finish parsing the module, we don't know what other modules are imported, and hence what operators (and other identifiers) might be in scope. We <em>certainly</em> don't know their precedences yet. But the parser has to return <em>something</em>... But should it return</p>\n\n<pre><code>(x *** y) +++ z\n</code></pre>\n\n<p>Or should it return</p>\n\n<pre><code>x *** (y +++ z)\n</code></pre>\n\n<p>The poor parser has no way to know. This can only be determined once you hunt down the import that brings <code>(+++)</code> and <code>(***)</code> into scope, load that file off disk, and discover what the operator precedences are. Clearly the parser itself isn't going to do all that I/O; a parser just turns a stream of characters into an AST.</p>\n\n<p>Clearly somebody somewhere has figured out how to do this. But I can't work it out... Any hints?</p>\n"}, {"tags": ["haskell", "converter"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1426955739, "post_id": 29185050, "comment_id": 46585838, "body": "You are <code>read</code>ing a string <code>i</code>: reading a <code>String</code> expects quotes like <code>reads &quot;\\&quot;i\\&quot;&quot;</code>, hence it fails."}, {"owner": {"reputation": 634, "user_id": 4697270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7884aed17ee40cfaae6b53e6966b29ea?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4697270/david"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1426961172, "post_id": 29185050, "comment_id": 46587499, "body": "@chi, hm, how can I fix this problem?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1426962017, "post_id": 29185050, "comment_id": 46587782, "body": "You could remove these chars as you do for the <code>+</code>, e.g. <code>(a, &#39;+&#39;:&#39;i&#39;:&#39;*&#39;:r1) &lt;- reads s</code>. Then <code>r1</code> would just contain the last float. This is still a bit fragile because it will fail if there&#39;s a space between the symbols."}], "answers": [{"comments": [{"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1426961309, "post_id": 29185139, "comment_id": 46587543, "body": "Or <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Text-ParserCombinators-ReadP.html#t:ReadP\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.7.0.2/docs/&hellip;</a> , which ghc actually uses to implement <code>Read</code> (cf. <a href=\"https://github.com/ghc/ghc/blob/master/libraries/base/GHC/Read.hs\" rel=\"nofollow noreferrer\">github.com/ghc/ghc/blob/master/libraries/base/GHC/Read.hs</a> )"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1426961475, "post_id": 29185139, "comment_id": 46587602, "body": "@d8d0d65b3f7cf42, yes, that looks like another good option. There are lots of good options."}, {"owner": {"reputation": 634, "user_id": 4697270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7884aed17ee40cfaae6b53e6966b29ea?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4697270/david"}, "edited": false, "score": 0, "creation_date": 1426961541, "post_id": 29185139, "comment_id": 46587625, "body": "@dfeuer, thank you for answer. What do you mean, when you say: &quot;you get nada&quot;?"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 1, "last_activity_date": 1426955604, "creation_date": 1426955604, "answer_id": 29185139, "question_id": 29185050, "link": "https://stackoverflow.com/questions/29185050/list-comprehension-and-converting-string-to-object/29185139#29185139", "title": "List comprehension and converting string to object", "body": "<p>You seem to be using <code>reads</code> as though it were a full monadic parser. It's not. It comes up with a match or none, and if the match it finds does not match your pattern, you get nada. You will be much better off using something like <code>parsec</code>, <code>attoparsec</code>, or even something super-simple like <code>regex-applicative</code>.</p>\n"}], "owner": {"reputation": 634, "user_id": 4697270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7884aed17ee40cfaae6b53e6966b29ea?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4697270/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 29185139, "answer_count": 1, "score": 3, "last_activity_date": 1426955604, "creation_date": 1426955098, "question_id": 29185050, "link": "https://stackoverflow.com/questions/29185050/list-comprehension-and-converting-string-to-object", "title": "List comprehension and converting string to object", "body": "<p>I have a string, like <code>2.7+i*3.4</code>. I want to parse this string and get <code>Complex number</code> object. I try to do this:</p>\n\n<pre><code>newtype MyComplexNumber = MyComplexNumber (Complex Float)\n\nmyReadsCmplx s = [(MyComplexNumber (a :+ b)) |\n                               (a, '+':r1) &lt;- reads s :: [(Float, String)],\n                               (i, '*':r2) &lt;- reads r1 :: [(String, String)],\n                               (b, r3) &lt;- reads r2 :: [(Float, String)]]\n</code></pre>\n\n<p>But I have empty list:</p>\n\n<pre><code>*Main Data.Complex&gt; myReadsCmplx \"2.7+i*3.4\"\n[]\n*Main Data.Complex&gt;\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 4, "creation_date": 1426954214, "post_id": 29184859, "comment_id": 46585372, "body": "<code>not True = False</code> and <code>not False = True</code>. The <code>\\x -&gt;</code> syntax is for lambdas (anonymous functions)."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1426954624, "post_id": 29184859, "comment_id": 46585482, "body": "equivalent to <code>&#47;=</code>  <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Data-Eq.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.7.0.2/docs/Data-Eq.html</a>"}, {"owner": {"reputation": 126, "user_id": 4561178, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vgQ6U.jpg?s=128&g=1", "display_name": "Jake Matthews", "link": "https://stackoverflow.com/users/4561178/jake-matthews"}, "edited": false, "score": 0, "creation_date": 1426954800, "post_id": 29184859, "comment_id": 46585537, "body": "Oh yeah just realised the lambdas (anonymous functions), I&#39;ve learnt about them but never used them before myself, thank you :D"}], "answers": [{"comments": [{"owner": {"reputation": 126, "user_id": 4561178, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vgQ6U.jpg?s=128&g=1", "display_name": "Jake Matthews", "link": "https://stackoverflow.com/users/4561178/jake-matthews"}, "edited": false, "score": 0, "creation_date": 1426955188, "post_id": 29184965, "comment_id": 46585648, "body": "I understand lambda part, but I don&#39;t understand how can y be compared too, does y in (x == y)  represent the \\y lambda or x, or the next element in the list?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 126, "user_id": 4561178, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vgQ6U.jpg?s=128&g=1", "display_name": "Jake Matthews", "link": "https://stackoverflow.com/users/4561178/jake-matthews"}, "edited": false, "score": 1, "creation_date": 1426955567, "post_id": 29184965, "comment_id": 46585776, "body": "@JakeEmbx The <code>x</code> comes as the first element of the list provided to <code>rmDup</code>, and <code>y</code> is introduced in the lambda passed to <code>filter</code>, so <code>y</code> is representing an element of <code>xs</code>.  <code>y</code> is only in scope for the lambda passed to <code>filter</code>, but using operator sections this could instead be written as <code>rmDup (x:xs) = x : rmDup (filter (&#47;= x) xs)</code>.  It takes the first element of the list, <code>x</code>, keeps it, then filters out all elements equal to it in the remainder of the list.  This is then fed back into <code>rmDup</code> and the process continues for the next element of the list, which must be distinct from <code>x</code>."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 6, "last_activity_date": 1426954670, "creation_date": 1426954670, "answer_id": 29184965, "question_id": 29184859, "link": "https://stackoverflow.com/questions/29184859/what-does-filter-y-notx-y-xs-mean/29184965#29184965", "title": "what does (filter (\\y -&gt; not(x == y)) xs) mean?", "body": "<p>The <code>\\name -&gt; expr</code> syntax defines a lambda function, also known as anonymous functions.  This is just an alternative way to define a function in Haskell that is particularly useful when you don't want to have to give a name to it.  For example, in</p>\n\n<pre><code>&gt; map (\\x -&gt; x + 1) [1, 2, 3]\n[2, 3, 4]\n</code></pre>\n\n<p>It would be quite a pain to have to write it as</p>\n\n<pre><code>&gt; let add1 x = x + 1 in map add1 [1, 2, 3]\n[2, 3, 4]\n</code></pre>\n\n<p>since this name is only used once, and this general pattern is very, very common in Haskell (and other functional languages)<sup>[1]</sup>.  You can even use this syntax when defining normal functions:</p>\n\n<pre><code>&gt; let add1 = \\x -&gt; x + 1 in map add1 [1, 2, 3]\n[2, 3, 4]\n</code></pre>\n\n<p>And the compiler essentially does this to all your functions anyway, since this form is easier to manipulate internally.</p>\n\n<p>The <code>not</code> function you see being used is a built-in that simply performs a logical NOT on a boolean value:</p>\n\n<pre><code>not :: Bool -&gt; Bool\nnot True = False\nnot False = True\n</code></pre>\n\n<p>So the expression <code>\\y -&gt; not (x == y)</code> is equivalent to <code>\\y -&gt; x /= y</code><sup>[2]</sup>.</p>\n\n<hr>\n\n<p><sup>[1]</sup> For this example you can actually leave out the lambda if you really wanted and write this as <code>map (+1) [1, 2, 3]</code>, since Haskell lets you partially apply operators, a very handy feature I constantly wish I had in other programming languages.  Operator sections as they're known are quite useful and can help reduce a lot of unnecessary typing.</p>\n\n<p><sup>[2]</sup> Or at least should be, although you could define a type where the instance for <code>Eq</code> defines both <code>==</code> and <code>/=</code> to always return <code>True</code>, but expect this to act strangely with code that expects them to behave well.</p>\n"}], "owner": {"reputation": 126, "user_id": 4561178, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vgQ6U.jpg?s=128&g=1", "display_name": "Jake Matthews", "link": "https://stackoverflow.com/users/4561178/jake-matthews"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 0, "accepted_answer_id": 29184965, "answer_count": 1, "score": 3, "last_activity_date": 1426954670, "creation_date": 1426954047, "question_id": 29184859, "link": "https://stackoverflow.com/questions/29184859/what-does-filter-y-notx-y-xs-mean", "title": "what does (filter (\\y -&gt; not(x == y)) xs) mean?", "body": "<p>I'm trying to work out how to remove duplicates from a list in haskell. I found the answer below to my problem...</p>\n\n<pre><code>type Regist = [String]\ntype ListRe = [Regist]\n\nrmDup :: ListRe -&gt; ListRe\nrmDup [] = []\nrmDup (x:xs) = x : rmDup (filter (\\y -&gt; not(x == y)) xs)\n</code></pre>\n\n<p>on stackoverflow but I don't understand what particular parts of the last line mean or do espically</p>\n\n<pre><code>(\\y -&gt; not(x == y))\n</code></pre>\n\n<p>I've never seen \\y used before or \"not\" which is puzzling me quite a bit!</p>\n\n<p>I would of added a comment to the answer but i don't have enough reputation on my account to add a comment on the answer (was someone elses question), to ask about the answer as well as the fact it was from 2010 and I can't seem to get in contact with the person who answered!</p>\n\n<p>Any help is appreciated!</p>\n\n<p>thank you :) </p>\n"}, {"tags": ["haskell", "recursion", "tail-recursion"], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1426955433, "post_id": 29184742, "comment_id": 46585724, "body": "I think it&#39;s very important to explain the role of the <code>$!</code> operations in this context.  Without them, the accumulator version is just as bad as the original."}, {"owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1426957416, "post_id": 29184742, "comment_id": 46586384, "body": "@Carl Oh yeah, I tried to explain a bit about <code>$!</code> here. Please check now."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1426958357, "post_id": 29184742, "comment_id": 46586681, "body": "I&#39;ve done some benchmark and there is absolutely no difference vs the <code>$!</code> and <code>$</code> version (in <code>-O2</code> at least)"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1426959815, "post_id": 29184742, "comment_id": 46587105, "body": "@mb14 GHC&#39;s strictness analyzer must take care of it. You can&#39;t rely on that in general though, so it is important to understand the principle."}], "tags": [], "owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "is_accepted": true, "score": 4, "last_activity_date": 1426957392, "last_edit_date": 1426957392, "creation_date": 1426953479, "answer_id": 29184742, "question_id": 29184644, "link": "https://stackoverflow.com/questions/29184644/efficiency-of-haskell-tail-recursive-functions/29184742#29184742", "title": "Efficiency of Haskell Tail-recursive functions", "body": "<p>Lets take the example of <code>sum</code>. Lets say you invoke it with 5</p>\n\n<pre><code>sum 5 = 5 + (sum 4)\n      = 5 + (4 + sum 3)\n      = 5 + (4 + (3 sum 2))\n      = 5 + (4 + (3 + (2 + (sum 1))))\n      = 5 + (4 + (3 + (2 + (1 + sum 0))))\n      = 5 + (4 + (3 + (2 + (1 + 0))))\n      = 5 + (4 + (3 + (2 + 1)))\n      = 5 + (4 + (3 + 3))\n      = 5 + (4 + 6)\n      = 5 + 10\n      = 15\n</code></pre>\n\n<p>Till <code>sum 0</code> is evaluated, rest of the functions cannot exit from the memory, since they all waiting on the recursive call to return so that they can return a value. In this case, it is just 5, imagine 100000. </p>\n\n<p>But, the <code>sum'</code> will be evaluated like this</p>\n\n<pre><code>sum' 5 = sumTR 5 0\n       = sumTR 4 (0 + 5)\n       = sumTR 4 5\n       = sumTR 3 (5 + 4)\n       = sumTR 3 9\n       = sumTR 2 (9 + 3)\n       = sumTR 2 12\n       = sumTR 1 (12 + 2)\n       = sumTR 1 14\n       = sumTR 0 (1 + 14)\n       = sumTR 0 15\n       = sumTR 2 (9 + 3)\n       = 15\n</code></pre>\n\n<p>Here, the calls to <code>sumTR</code> returns the result of calling another function. So, the current function need not have to be in memory as its return value is not depending on the result of the recursive call (it doesn't depend on it but the return value of the current function is same as the result of the return value of the recursive function call).</p>\n\n<p>Compilers normally optimize the tail calls to loops, so they are very efficient.</p>\n\n<p>Read more about <a href=\"https://wiki.haskell.org/Tail_recursion\" rel=\"nofollow\">Tail Recursion in this wiki page</a></p>\n\n<hr>\n\n<p>As Carl mentioned in the comments, it is important to understand the role of <code>$!</code> here. It forces the normal application of a function to a strict application of a function. What does it mean? The <code>$!</code> basically reduces the expression to Head normal form. What is head normal form? The expression will be reduced till the point it becomes a function application or data constructor.</p>\n\n<p>Consider this</p>\n\n<pre><code>sumTR (n-1) $ (r+n)\n</code></pre>\n\n<p>here <code>r + n</code> will be evaluated by the <code>sumTR</code> function after it is invoked, exactly like I have shown in the expansion above. Because Haskell evaluates everything lazily. But, you can force the evaluation of <code>r + n</code> to happen before function invocation and invoke it with the result of <code>r + n</code>. This will give huge runtime benefits, as compiler doesn't have to wait till the call is made to determine the function expression to be invoked, if it has to do pattern matching. For example,</p>\n\n<pre><code>func :: Int -&gt; Int\nfunc 0 = 100\nfunc a = a + a\n</code></pre>\n\n<p>Here, if I invoke <code>func</code>, like this</p>\n\n<pre><code>func $ (1 - 1)\n</code></pre>\n\n<p>Haskell will not evaluate <code>1 - 1</code> till the <code>func</code> is actually invoked. So, after invoking <code>func</code>, it will evaluate the expression and find that to be <code>0</code> and it will choose <code>func 0 = 100</code> and return <code>100</code>. But we can force the strict application, like this</p>\n\n<pre><code>func $! (1 - 1)\n</code></pre>\n\n<p>Now, haskell will evaluate <code>(1 - 1)</code> first and then it will know that the value is <code>0</code>. So, it will directly invoke <code>func 0 = 100</code> and return <code>100</code>. We reduce the burden on the compiler by forcing strict application.</p>\n\n<p>You can read more about this strict application, in <a href=\"https://wiki.haskell.org/Performance/Strictness\" rel=\"nofollow\">this haskell wiki page</a>.</p>\n"}], "owner": {"reputation": 854, "user_id": 2795296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108472145a26c614aed6f603bac5bf94?s=128&d=identicon&r=PG&f=1", "display_name": "David Mart&#237;nez", "link": "https://stackoverflow.com/users/2795296/david-mart%c3%adnez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 685, "favorite_count": 2, "closed_date": 1426958836, "accepted_answer_id": 29184742, "answer_count": 1, "score": 2, "last_activity_date": 1426957392, "creation_date": 1426952863, "last_edit_date": 1426953475, "question_id": 29184644, "link": "https://stackoverflow.com/questions/29184644/efficiency-of-haskell-tail-recursive-functions", "closed_reason": "Duplicate", "title": "Efficiency of Haskell Tail-recursive functions", "body": "<p>I have the following basic Haskell code:</p>\n\n<pre><code>prodsum x = prod x + sum x \n\nprod 0 = 1\nprod n = n * prod (n-1)\n\nsum 0 = 0\nsum n = n + sum (n-1)\n</code></pre>\n\n<p>Can anyone explain me why the code below is more efficient:</p>\n\n<pre><code>prod' n = prodTR n 1\n   where prodTR 0 r = r\n         prodTR n r = prodTR (n-1) $! (r*n)\n\nsum' n = sumTR n 0\n   where sumTR 0 r = r\n         sumTR n r = sumTR (n-1) $! (r+n)\n\nprodsum' n = prod' n + sum' n\n</code></pre>\n"}, {"tags": ["haskell", "criterion"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1426952240, "post_id": 29184397, "comment_id": 46584779, "body": "I know Carter Schonwald has done some work on such, and I think his report template may be <a href=\"https://gist.github.com/cartazio/c3fa2513d733b4576e62\" rel=\"nofollow noreferrer\">this gist</a>. You could try asking on the haskell-cafe mailing list; he will likely respond."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1426955451, "post_id": 29184397, "comment_id": 46585732, "body": "I does the trick for the first question. It&#39;s good to know that the answer is in the template"}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1426951279, "creation_date": 1426951279, "question_id": 29184397, "link": "https://stackoverflow.com/questions/29184397/criterion-is-it-possible-to-alter-benchark-graph", "title": "Criterion: Is it possible to alter Benchark graph?", "body": "<p>I just started using the excellent <code>criterion</code> package and I was wondering if it's possible to alter the graph. For example I would need to </p>\n\n<ul>\n<li><p>normalize result within a group so that the longest result of a group take the full width of the graph (whatever the time spent in other groups)</p></li>\n<li><p>to change the order of the bars in the graph to be able to have a standard bar charts where instead of having cluster of bar of the same colours, you could have\ncluster of bars using all the different colours.</p></li>\n</ul>\n"}, {"tags": ["haskell", "typeclass", "overlapping-instances"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1426952653, "post_id": 29184022, "comment_id": 46584930, "body": "Well... it doesn&#39;t strictly have to be Haskell code, although that is how it traditionally is. Off the top of my head, I know that <code>HList</code> produces something that&#39;s not Haskell code, but that is otherwise sane. The idea that it should produce Haskell code seems more restrictive than useful, because <code>Read</code> doesn&#39;t have a type checker\u2014you always need to know the type of what you&#39;re reading, and I don&#39;t know of any way to make <code>Read</code> work with existentials."}, {"owner": {"reputation": 1635, "user_id": 2254489, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b9c417017130602fd4561958e6840a2c?s=128&d=identicon&r=PG", "display_name": "Sventimir", "link": "https://stackoverflow.com/users/2254489/sventimir"}, "edited": false, "score": 0, "creation_date": 1426953087, "post_id": 29184022, "comment_id": 46585046, "body": "SampleSpace is a typeclass because a side from the type you have guessed quite correctly, there&#39;s also another, representing a SampleSpace where all events are equally probable. Hence it does not need to store the probability in a data field, it just needs to return 1/n, where n is number of events in that space. Now I would like to use the two types polimorfically - that&#39;s what I need a typeclass for. Thanks for the answer anyway."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1635, "user_id": 2254489, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b9c417017130602fd4561958e6840a2c?s=128&d=identicon&r=PG", "display_name": "Sventimir", "link": "https://stackoverflow.com/users/2254489/sventimir"}, "edited": false, "score": 0, "creation_date": 1426953572, "post_id": 29184022, "comment_id": 46585189, "body": "@Sventimir, you could use <code>data SampleSpace a = SampleSpace {events :: [a], member :: a-&gt; Bool, probability :: a -&gt; Rational}</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 9, "last_activity_date": 1426949532, "last_edit_date": 1426949532, "creation_date": 1426949216, "answer_id": 29184022, "question_id": 29183805, "link": "https://stackoverflow.com/questions/29183805/make-a-typeclass-instance-automatically-an-instance-of-another/29184022#29184022", "title": "Make a typeclass instance automatically an instance of another", "body": "<p><strong>tl;dr</strong>: don't do that, or, if you insist, use <code>-XOverlappingInstances</code>.</p>\n\n<ol>\n<li>This is not what the <code>Show</code> class is there for. <code>Show</code> is for simply showing plain data, in a way that is actually Haskell code and can be used as such again, yielding the original value.</li>\n<li><code>SampleSpace</code> should perhaps not be a class in the first place. It seems to be basically the class of types that have something like <code>Map a Rational</code> associated with them. Why not just use that as a field in a plain <code>data</code> type?</li>\n<li>Even if we accept the design... such a generic <code>Show</code> instance (or, indeed, generic instance for any single-parameter class) runs into problems when someone makes another instance for a concrete type &ndash; in the case of <code>Show</code>, there are of course already plenty of instances around. Then how should the compiler decide which of the two instances to use? GHC can do it, in fact: if you turn on the <code>-XOverlappingInstances</code> extension, it will select the more specific one (i.e. <code>instance SampleSpace s =&gt; Show (s a)</code> is &ldquo;overridden&rdquo; by any more specific instance), but really this isn't as trivial as may seem &ndash; what if somebody defined <em>another</em> such generic instance? Crucial to recall: Haskell type classes <em>are always open</em>, i.e. basically the compiler has to assume that <em>all</em> types could possibly in any class. Only when a specific instance is invoke will it actually need the proof for that, but it can never proove that a type <em>isn't</em> in some class.</li>\n</ol>\n\n<p>What I'd recommend instead &ndash; since that <code>Show</code> instance doesn't merely show data, it should be made a different function. Either</p>\n\n<pre><code>showDistribution :: (SampleSpace s, Show a, Ord a) =&gt; s a -&gt; String\n</code></pre>\n\n<p>or indeed</p>\n\n<pre><code>showDistribution :: (Show a, Ord a) =&gt; SampleSpace a -&gt; String\n</code></pre>\n\n<p>where <code>SampleSpace</code> is a single concrete type, instead of a class.</p>\n"}], "owner": {"reputation": 1635, "user_id": 2254489, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b9c417017130602fd4561958e6840a2c?s=128&d=identicon&r=PG", "display_name": "Sventimir", "link": "https://stackoverflow.com/users/2254489/sventimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 29184022, "answer_count": 1, "score": 4, "last_activity_date": 1426949532, "creation_date": 1426947997, "question_id": 29183805, "link": "https://stackoverflow.com/questions/29183805/make-a-typeclass-instance-automatically-an-instance-of-another", "title": "Make a typeclass instance automatically an instance of another", "body": "<p>What I'd like to achieve is that any instance of the following class (<code>SampleSpace</code>) should automatically be an instance of <code>Show</code>, because <code>SampleSpace</code> contains the whole interface necessary to create a String representation and hence all possible instances of the class would be virtually identical.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nimport Data.Ratio (Rational)                                               \n\nclass SampleSpace space where                                               \n    events          :: Ord a =&gt; space a -&gt; [a]                              \n    member          :: Ord a =&gt; a -&gt; space a -&gt; Bool                        \n    probability     :: Ord a =&gt; a -&gt; space a -&gt; Rational                    \n\ninstance (Ord a, Show a, SampleSpace s) =&gt; Show (s a) where                 \n    show s = showLines $ events s                                           \n        where                                                               \n        showLines [] = \"\"                                                   \n        showLines (e:es) = show e ++ \":   \" ++ (show $ probability e s)\n                                  ++ \"\\n\" ++ showLines es\n</code></pre>\n\n<p>Since, as I found out already, while matching instance declarations GHC only looks at the head, and not at contraints, and so it believes <code>Show (s a)</code> is about Rational as well:</p>\n\n<pre><code>[1 of 1] Compiling Helpers.Probability ( Helpers/Probability.hs, interpreted )\n\nHelpers/Probability.hs:21:49:\n    Overlapping instances for Show Rational\n      arising from a use of \u2018show\u2019\n    Matching instances:\n      instance (Integral a, Show a) =&gt; Show (GHC.Real.Ratio a)\n        -- Defined in \u2018GHC.Real\u2019\n      instance (Ord a, Show a, SampleSpace s) =&gt; Show (s a)\n        -- Defined at Helpers/Probability.hs:17:10\n    In the expression: show\n    In the first argument of \u2018(++)\u2019, namely \u2018(show $ probability e s)\u2019\n    In the second argument of \u2018(++)\u2019, namely\n      \u2018(show $ probability e s) ++ \"\" ++ showLines es\n</code></pre>\n\n<p>Question: is it possible (otherwise than by enabling overlapping instances) to make any instance of a typeclass automatically an instance of another too?</p>\n"}, {"tags": ["unit-testing", "haskell", "testing", "io"], "answers": [{"tags": [], "owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "is_accepted": true, "score": 1, "last_activity_date": 1426948607, "creation_date": 1426948607, "answer_id": 29183894, "question_id": 29183568, "link": "https://stackoverflow.com/questions/29183568/testing-of-io-return-value/29183894#29183894", "title": "Testing of IO return value", "body": "<p>Sorry, the solution was not that complicated (I just managed to make it complicated in my head).</p>\n\n<pre><code>ucg :: TestTree\nucg = testGroup \"selectByCount\" \n    [ testCase \"2 Words dominated by exactly 1 Acoustic\" $ do \n        r &lt;- fmap length  $ tRunUmeQuery (selectByCount \"Word\" \"Acoustic\" \"=\" ((toInteger 1):[]) Strict) testdb  \n        assertEqual \"selectByCount: 1 Acoustic in Word\" 6 r\n    ]\n</code></pre>\n\n<p>This TestGroup works just fine.</p>\n"}], "owner": {"reputation": 729, "user_id": 2181977, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0b84fe9137990458c9a91dcadd10579c?s=128&d=identicon&r=PG", "display_name": "Fredrik Karlsson", "link": "https://stackoverflow.com/users/2181977/fredrik-karlsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 29183894, "answer_count": 1, "score": 0, "last_activity_date": 1426955903, "creation_date": 1426946332, "last_edit_date": 1426955903, "question_id": 29183568, "link": "https://stackoverflow.com/questions/29183568/testing-of-io-return-value", "title": "Testing of IO return value", "body": "<p>I have a statement that I need to check the return value of:</p>\n\n<pre><code>&gt; let a = tRunUmeQuery (selectByCount \"Word\" \"Acoustic\" \"=\" ((toInteger 1):[]) Strict)  testdb\n&gt; :t a \na :: IO [[SqlValue]]\n</code></pre>\n\n<p>So, I would like to make sure that <code>a</code> is a list with a length of exactly 6 (<code>IO 6</code> then). </p>\n\n<pre><code>&gt; fmap length a\n6\n</code></pre>\n\n<p>What would a testCase that checks this look like?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1426942490, "post_id": 29182836, "comment_id": 46581924, "body": "You are using <code>+</code> to merge the results of the recursive calls."}], "answers": [{"tags": [], "owner": {"reputation": 170, "user_id": 4680808, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/i506Y.png?s=128&g=1", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/4680808/mikhail"}, "is_accepted": true, "score": 0, "last_activity_date": 1426944899, "last_edit_date": 1426944899, "creation_date": 1426944195, "answer_id": 29183210, "question_id": 29182836, "link": "https://stackoverflow.com/questions/29182836/calculate-the-deepers-branch-in-tree/29183210#29183210", "title": "Calculate the deeper&#39;s branch in Tree", "body": "<p>In this two lines, i change <strong>sum</strong> of your functions with l and r branches to <strong>max</strong> of them:</p>\n\n<pre><code>pathTree_hlp curmax prevmax (Node A l r) = max (pathTree_hlp (curmax+1) prevmax l) (pathTree_hlp (curmax+1) prevmax r)\npathTree_hlp curmax prevmax (Node B l r) = max (pathTree_hlp 0 (max curmax prevmax) l) (pathTree_hlp 0 (max curmax prevmax) r)\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 4689872, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh5.googleusercontent.com/-zVwayj_UwuQ/AAAAAAAAAAI/AAAAAAAAIRk/21USL0Zz0mk/photo.jpg?sz=128", "display_name": "Massimiliano Martella", "link": "https://stackoverflow.com/users/4689872/massimiliano-martella"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 29183210, "answer_count": 1, "score": 0, "last_activity_date": 1426944899, "creation_date": 1426941731, "question_id": 29182836, "link": "https://stackoverflow.com/questions/29182836/calculate-the-deepers-branch-in-tree", "title": "Calculate the deeper&#39;s branch in Tree", "body": "<p>I need Help for solve this problem:\nI must calculate the length of the deeper's branch consisting of only elements \"A\" in a BSTree.</p>\n\n<p>I tried with this:</p>\n\n<pre><code>data El = A | B deriving (Eq,Show)\n\ndata BSTree a = Nil | Node a (BSTree a) (BSTree a)\ntestBST :: BSTree El\ntestBST = Node A (Node A (Node B Nil Nil) Nil) (Node A Nil (Node A (Node B Nil Nil) Nil)) \n\npathTree_hlp :: Int -&gt; Int -&gt; BSTree El -&gt; Int\npathTree_hlp curmax prevmax Nil = max curmax prevmax\npathTree_hlp curmax prevmax (Node A l r) = pathTree_hlp (curmax+1) prevmax l + pathTree_hlp (curmax+1) prevmax r \npathTree_hlp curmax prevmax (Node B l r) = pathTree_hlp 0 (max curmax prevmax) l + pathTree_hlp 0 (max curmax prevmax) r\n\npathInTree :: BSTree El -&gt; Int\npathInTree Nil = 0\npathInTree (Node B l r) = 0\npathInTree (Node A l r) = pathTree_hlp 0 0 (Node A l r)\n</code></pre>\n\n<p>The result should it be 3, but my code returns 17 (?)\nCan you help me for solve this problem?</p>\n\n<p>Thanks to all.</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "is_accepted": true, "score": 6, "last_activity_date": 1426941090, "last_edit_date": 1426941090, "creation_date": 1426940779, "answer_id": 29182679, "question_id": 29182479, "link": "https://stackoverflow.com/questions/29182479/import-a-whole-module-at-one-time-with-haskell/29182679#29182679", "title": "import a whole module at one time with Haskell", "body": "<p>This is how <code>MyLib</code> should look like -- maybe with different indentation:</p>\n\n<pre><code>module MyLib\n  (module MyLib.Types\n  ,module MyLib.Functions\n  ,module MyLib.Algo.Line\n  ,module MyLib.Algo.Point\n  ) where \nimport MyLib.Types \nimport MyLib.Functions\nimport MyLib.Algo.Line \nimport MyLib.Algo.Point  \n</code></pre>\n\n<p>What happens is that when you put a module like that in your export list, you export all the symbols that <em>your</em> module knows about it.</p>\n\n<p>You could potentially scope what part of this module you export, for example:</p>\n\n<pre><code>module ExampleLib\n  (module Data.Maybe\n  ) where \nimport Data.Maybe (fromJust)\n</code></pre>\n\n<p>The above will just re-export <code>fromJust</code> from <code>Data.Maybe</code>, not the whole <code>Data.Maybe</code> module.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 29182679, "answer_count": 1, "score": 2, "last_activity_date": 1426941090, "creation_date": 1426939405, "question_id": 29182479, "link": "https://stackoverflow.com/questions/29182479/import-a-whole-module-at-one-time-with-haskell", "title": "import a whole module at one time with Haskell", "body": "<p>I'm embarrassed with a library problem with Haskell.\nI finished a library made of several files</p>\n\n<pre><code>src/MyLib/Firstbib.hs\nsrc/MyLib/Secondbib.hs\n...\nsrc/MyLib/Lastbib.hs\n</code></pre>\n\n<p>At this time, After <code>cabal install</code> I can import each file separatly with</p>\n\n<pre><code>import MyLib.Firstbib\nimport MyLib.Secondbib\nimport MyLib.Lastbib\n</code></pre>\n\n<p><strong>every thing is OK</strong></p>\n\n<p>Now, I would like to import all these part of MyLib in a simple import :</p>\n\n<pre><code>import MyLib\n</code></pre>\n\n<p>and I can't reach to make it.</p>\n\n<p>I tried to create a file named <code>src/MyLib.hs</code> containing :</p>\n\n<pre><code>module MyLib where \nimport MyLib.Types \nimport MyLib.Functions\nimport MyLib.Algo.Line \nimport MyLib.Algo.Point  \n</code></pre>\n\n<p>and expose it with Cabal</p>\n\n<pre><code>Library\n  -- Modules exported by the library.\n  Hs-Source-Dirs:     src\n  Exposed-modules:      MyLib\n                      , MyLib.Functions\n                      , MyLib.Types\n                      , MyLib.Algo.Line\n                      , MyLib.Algo.Point\n</code></pre>\n\n<p>but it doesn't work.!</p>\n\n<p>What it the correct way to import many files with only one module import (as for Gtk2Hs for example)?</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1426940988, "post_id": 29182669, "comment_id": 46581500, "body": "So much simpler than my deleted version."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1426940739, "creation_date": 1426940739, "answer_id": 29182669, "question_id": 29182233, "link": "https://stackoverflow.com/questions/29182233/lifting-polymorphic-values-with-typeclasses/29182669#29182669", "title": "Lifting polymorphic values with typeclasses", "body": "<p>You should always move as much information as possible from the instance head to the instance constraints. Here, the correct instance can be determined purely based on whether we have an <code>Either</code> or a <code>ConstRight</code>, so there is no need to constrain instance heads further. </p>\n\n<p><code>LiftEither (Either e a) e a</code> is overly restrictive, because it demands that the two <code>a</code>-s and the two <code>e</code>-s can be determined to be equal at the point of matching the instance head. The other instance has the same issue. Instead, you should move the type equalities to the constraints. That way GHC can happily match the instances and try solving the constraints later. </p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, TypeFamilies, FlexibleInstances #-}\n\nnewtype ConstRight a = ConstRight a\n\nclass LiftEither t e a where\n  liftEither :: t -&gt; Either e a\n\ninstance (e ~ f, a ~ b) =&gt; LiftEither (Either e a) f b where\n  liftEither = id\n\ninstance (a ~ b) =&gt; LiftEither (ConstRight a) e b where\n  liftEither (ConstRight a) = Right a\n</code></pre>\n\n<p>Now all your examples work.</p>\n"}], "owner": {"reputation": 75, "user_id": 2878664, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dd583dcb638667bd3ec99eadd11a646?s=128&d=identicon&r=PG&f=1", "display_name": "vtan", "link": "https://stackoverflow.com/users/2878664/vtan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 29182669, "answer_count": 1, "score": 1, "last_activity_date": 1426940739, "creation_date": 1426937581, "question_id": 29182233, "link": "https://stackoverflow.com/questions/29182233/lifting-polymorphic-values-with-typeclasses", "title": "Lifting polymorphic values with typeclasses", "body": "<p>I tried to implement automatic lifting into <code>Either</code> types: pure values would be\nlifted with <code>Right</code>, already <code>Either</code> values with <code>id</code>.</p>\n\n<pre><code>-- Wrapper for pure, non-Either values\nnewtype ConstRight a = ConstRight a\n\nclass LiftEither t e a where\n  liftEither :: t -&gt; Either e a\n\ninstance LiftEither (Either e a) e a where\n  liftEither = id\n\ninstance LiftEither (ConstRight a) e a where\n  liftEither (ConstRight a) = Right a\n\nx :: Either () (Int -&gt; Int)\nx = liftEither $ ConstRight (id :: Int -&gt; Int)\n\ny :: Either () (a -&gt; a)\ny = liftEither $ ConstRight id\n\nz :: Either (a -&gt; a) ()\nz = liftEither $ Left id\n</code></pre>\n\n<p>However, only monomoprhic values can be lifted using this method. The\ndefinitions of <code>y</code> and <code>z</code> yield type errors:</p>\n\n<pre><code>No instance for (LiftEither (ConstRight (a1 -&gt; a1)) () (a -&gt; a))\n  arising from a use of \u2018liftEither\u2019\nThe type variable \u2018a1\u2019 is ambiguous\n\nNo instance for (LiftEither (Either (a0 -&gt; a0) b0) (a -&gt; a) ())\n  arising from a use of \u2018liftEither\u2019\nThe type variables \u2018b0\u2019, \u2018a0\u2019 are ambiguous\n</code></pre>\n\n<p>This could be solved with functional dependencies, but <code>ConstRight a</code> does not determine <code>e</code>:</p>\n\n<pre><code>class LiftEither t e a | t -&gt; e a where\n  liftEither :: t -&gt; Either e a\n</code></pre>\n\n<p>I also tried using associated types, but I could not come up with a suitable\ndefinition for the <code>ConstRight</code> instance:</p>\n\n<pre><code>class LiftEither t where\n  type Result t\n  liftEither :: t -&gt; Result t\n\ninstance LiftEither (Either e a) where\n  type Result (Either e a) = Either e a\n  liftEither = id\n\ninstance LiftEither (ConstRight a) where\n  type Result (ConstRight a) = Either e a -- e is not in scope\n  liftEither (ConstRight a) = Right a\n</code></pre>\n\n<p>Is it possible to implement this for polymorphic values?</p>\n"}, {"tags": ["haskell", "algebraic-data-types"], "answers": [{"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 6, "last_activity_date": 1426929218, "creation_date": 1426929218, "answer_id": 29181037, "question_id": 29180798, "link": "https://stackoverflow.com/questions/29180798/using-a-type-of-a-parameterized-data-type-in-a-haskell-function/29181037#29181037", "title": "Using a type of a parameterized data type in a Haskell function", "body": "<p>You don't need anything, it just works. </p>\n\n<pre><code>fun :: Bounded a =&gt; Foo a -&gt; a\nfun _ = maxBound\n</code></pre>\n\n<p>The compiler knows that the result of <code>fun</code> would be an <code>a</code> and therefore will call the correct <code>maxBound</code>.</p>\n"}], "owner": {"reputation": 33, "user_id": 4696751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a56b701ae33edee5d685ae512d252d1?s=128&d=identicon&r=PG&f=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/4696751/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1426929218, "creation_date": 1426927222, "question_id": 29180798, "link": "https://stackoverflow.com/questions/29180798/using-a-type-of-a-parameterized-data-type-in-a-haskell-function", "title": "Using a type of a parameterized data type in a Haskell function", "body": "<p>Let's say I have some algebraic data type in Haskell:</p>\n\n<pre><code>data Foo a = ...\n</code></pre>\n\n<p>I'd like to have a function that could \"extract\" this type <code>a</code> and do something with it, assuming it satisfies certain conditions. Specifically, I need something like:</p>\n\n<pre><code>fun :: Bounded a =&gt; Foo a -&gt; a\n</code></pre>\n\n<p>with intended usage as follows:</p>\n\n<pre><code>fun foo = maxBound :: a\n</code></pre>\n\n<p>Of course this notation is incorrect in Haskell, but I think my intentions are clear. Is it possible to do something like this?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 393, "user_id": 1644283, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/222a87019a3fee76802bf022cbfbdd4f?s=128&d=identicon&r=PG", "display_name": "Vectornaut", "link": "https://stackoverflow.com/users/1644283/vectornaut"}, "edited": false, "score": 0, "creation_date": 1426969500, "post_id": 29182906, "comment_id": 46590170, "body": "Interesting! I don&#39;t get the same behavior in a shell, and moving the mouse / focus back and forth between the plot window and GHCi doesn&#39;t work for me. It&#39;s sounding like this must be some weird interaction between gnuplot, GHCi, the windowing system, and the terminal..."}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "reply_to_user": {"reputation": 393, "user_id": 1644283, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/222a87019a3fee76802bf022cbfbdd4f?s=128&d=identicon&r=PG", "display_name": "Vectornaut", "link": "https://stackoverflow.com/users/1644283/vectornaut"}, "edited": false, "score": 1, "creation_date": 1426974794, "post_id": 29182906, "comment_id": 46591681, "body": "I am not surprised that different windowing systems behave differently, but I am surprised that typing a command in a shell behaves differently from sending the command programmatically (via <code>rawSystem</code>). You could find out the exact command that is being sent (e.g., put a fake <code>gnuplot</code> executable in your PATH that actually contains <code>echo $*</code>) and execute what you see in a shell, and compare.  (For me, <code>set term x11 persist; plot &quot;plot1.dat&quot; with lines</code>.)"}], "tags": [], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "is_accepted": false, "score": 4, "last_activity_date": 1426943434, "last_edit_date": 1426943434, "creation_date": 1426942149, "answer_id": 29182906, "question_id": 29180730, "link": "https://stackoverflow.com/questions/29180730/why-does-easyplot-make-commands-invisible-in-ghci/29182906#29182906", "title": "Why does EasyPlot make commands invisible in GHCi?", "body": "<p>I can reproduce what you describe (ghc-7.8.4, fedora 21, x86_64, xmonad).</p>\n\n<p>It is not a ghci feature, you get the same behaviour in a shell. </p>\n\n<pre><code>gnuplot -e \"set terminal x11 persist ; plot sin(x)\"\n</code></pre>\n\n<p>(This is (roughly) the command that is sent to the shell by EasyPlot,\ncf. <a href=\"https://hackage.haskell.org/package/easyplot-1.0/docs/src/Graphics-EasyPlot.html#exec\" rel=\"nofollow\">https://hackage.haskell.org/package/easyplot-1.0/docs/src/Graphics-EasyPlot.html#exec</a> )</p>\n\n<p>Plot window appears, shell prompt appears, but shell does not (seem to) work.</p>\n\n<p>You can just move the mouse pointer to the plot window, then back to the shell - this seems to make it work.</p>\n"}], "owner": {"reputation": 393, "user_id": 1644283, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/222a87019a3fee76802bf022cbfbdd4f?s=128&d=identicon&r=PG", "display_name": "Vectornaut", "link": "https://stackoverflow.com/users/1644283/vectornaut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1426943434, "creation_date": 1426926644, "last_edit_date": 1426927052, "question_id": 29180730, "link": "https://stackoverflow.com/questions/29180730/why-does-easyplot-make-commands-invisible-in-ghci", "title": "Why does EasyPlot make commands invisible in GHCi?", "body": "<p>Minimal working example:</p>\n\n<ol>\n<li>Start GHCi</li>\n<li><code>import</code> <a href=\"https://hackage.haskell.org/package/easyplot-1.0/docs/Graphics-EasyPlot.html\" rel=\"nofollow\"><code>Graphics.EasyPlot</code></a></li>\n<li><code>plot X11 sin</code></li>\n</ol>\n\n<p>On my system, as expected, a plot of the sine function appears in a window, GHCi displays <code>True</code> (the value of the <code>IO Bool</code> that <code>plot</code> returned, indicating a successful plot) and a fresh command prompt appears.</p>\n\n<p>Unexpectedly, when I type, no text appears at the command prompt until I hit enter. Then the text I typed becomes visible, and GHCi reacts as expected to whatever command I entered. When I type at the next command prompt, the same thing happens. So far, I've found two ways to get GHCi back to normal:</p>\n\n<ul>\n<li>Running <code>:l</code> to load a file.</li>\n<li>Quitting and restart.</li>\n</ul>\n\n<p>Why does this happen, and how can I prevent it?</p>\n\n<hr>\n\n<p>Things that don't prevent the behavior:</p>\n\n<ul>\n<li>Calling <code>plot</code> from the <code>main</code> function in a file and running it using the <code>:main</code> command in GHCi.</li>\n<li>Plotting to a file, using the <code>PNG</code> terminal, instead of to a window.</li>\n<li>Using <code>plot'</code> instead of <code>plot</code>.</li>\n</ul>\n\n<p>Things that don't get GHCi back to normal:</p>\n\n<ul>\n<li>Running <code>:m</code> to unload all modules.</li>\n</ul>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1426928412, "post_id": 29180426, "comment_id": 46578307, "body": "Do you want to do anything that requires <code>T</code> to be something other than simply <code>HList</code>? I ask this because even If you need to filter or manipulate the type list, you can do that separately from the data definition, and put the resulting types in a HList all the same."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 1, "creation_date": 1426934326, "post_id": 29180426, "comment_id": 46579700, "body": "It&#39;s not entirely clear to me yet what you need. To encode variadic functions in Haskell, you can use overloading (as the <code>quickCheck</code> function does) , continuations, often embedded in datatypes (see e.g. <code>formatting</code> on Hackage), HList and combinations of these.  Without a concrete use case, it is difficult to say what is best."}, {"owner": {"reputation": 8297, "user_id": 298847, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b52bc71fb15db17f585b912aed45b217?s=128&d=identicon&r=PG", "display_name": "tibbe", "link": "https://stackoverflow.com/users/298847/tibbe"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1426938001, "post_id": 29180426, "comment_id": 46580689, "body": "@Andr&#225;sKov&#225;cs <code>T</code> will probably contains a map, keyed by the type parameter, to some record."}], "owner": {"reputation": 8297, "user_id": 298847, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b52bc71fb15db17f585b912aed45b217?s=128&d=identicon&r=PG", "display_name": "tibbe", "link": "https://stackoverflow.com/users/298847/tibbe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 159, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1426923947, "creation_date": 1426923947, "question_id": 29180426, "link": "https://stackoverflow.com/questions/29180426/how-can-we-emulate-variadic-templates-in-haskell", "title": "How can we emulate variadic templates in Haskell?", "body": "<p>In C++ we can define a function which takes a variable number of statically typed arguments, using <a href=\"https://en.wikipedia.org/wiki/Variadic_template\" rel=\"nofollow\">variadic templates</a>, like so:</p>\n\n<pre><code>template&lt;typename... Params&gt; void f(Params... parameters);\n</code></pre>\n\n<p>(Alternatively we could have create a struct with variadic number of fields and used that as the argument to <code>f</code>.)</p>\n\n<p>We can also use type traits to inspect the values. I would like to do something similar in Haskell.</p>\n\n<p>I'd like to define a data type and a family of functions with a parameterized number of statically typed arguments:</p>\n\n<pre><code>data T ??? = ...\nmkT :: ... -&gt; T ???\nf :: T ??? -&gt; ...\n</code></pre>\n\n<p><code>f</code> needs to be able to convert the parameter types to <em>values</em> so we can do something generic with them (think printf).</p>\n\n<p>Perhaps a job for HLists?</p>\n"}, {"tags": ["haskell", "applicative", "traversable"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1426921064, "post_id": 29180063, "comment_id": 46576834, "body": "Relevant: <a href=\"http://stackoverflow.com/questions/29125149/how-would-i-use-lens-in-haskell-to-duplicate-pythons-enumerate\">How would I use <code>lens</code> in Haskell to duplicate Python&#39;s <code>enumerate</code>?</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1426921791, "post_id": 29180063, "comment_id": 46576947, "body": "What&#39;s the deal with the empty string? If you want a &quot;nothing interesting&quot; value, the canonical choice is <code>()</code>."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1426921932, "post_id": 29180063, "comment_id": 46576974, "body": "The post @dfeuer linked contains several nice alternative approaches, but none of them remove the need for an initial value to give the shape. (But then that question didn&#39;t ask for that, either.)"}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 2, "last_activity_date": 1426921467, "creation_date": 1426921467, "answer_id": 29180154, "question_id": 29180063, "link": "https://stackoverflow.com/questions/29180063/get-indices-of-applicative-traversable-without-dummy/29180154#29180154", "title": "Get indices of Applicative Traversable without dummy", "body": "<p>You are not going to escape using <code>pure</code> if you are doing this with just <code>Applicative</code> and <code>Traversable</code>. It's the only function in those classes which gives you a value of your type without already <em>having</em> one.</p>\n\n<p>Also, your dummy determines the shape of the value you construct. Consider a type such as lists, where not all values have the same shape: How do you choose between constructing <code>[0]</code>, <code>[0,1]</code> or <code>[0,1,2]</code>? (A <code>pure</code>-based dummy gives you the first one.)</p>\n"}], "owner": {"reputation": 3333, "user_id": 3859566, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a7c4c1c9ad9bd41f49004d32884bc680?s=128&d=identicon&r=PG&f=1", "display_name": "yong", "link": "https://stackoverflow.com/users/3859566/yong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 29180154, "answer_count": 1, "score": 1, "last_activity_date": 1426921467, "creation_date": 1426920503, "question_id": 29180063, "link": "https://stackoverflow.com/questions/29180063/get-indices-of-applicative-traversable-without-dummy", "title": "Get indices of Applicative Traversable without dummy", "body": "<p>Let's say I have some <code>v</code>, which is both <code>Applicative</code> and also <code>Traversable</code>. How can I get a <code>v</code> with the indices of <code>v</code>? For a concrete example, consider <code>V3</code> from <code>Linear</code>. I want <code>V3 0 1 2</code>.</p>\n\n<p>One way is to use <code>mapAccumL</code> with a dummy, for example:</p>\n\n<pre><code>snd $ T.mapAccumL \n    (\\idx _ -&gt; (idx + 1, idx)) \n    0 (pure \"\") :: V3 Int\n</code></pre>\n\n<p>But the <code>(pure \"\")</code> dummy feels inelegant. How can we do this in a more elegant way?</p>\n"}, {"tags": ["haskell", "android-ndk", "ghc"], "comments": [{"owner": {"reputation": 17430, "user_id": 309483, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d797538504a367f277d19bd8369e9a19?s=128&d=identicon&r=PG", "display_name": "Janus Troelsen", "link": "https://stackoverflow.com/users/309483/janus-troelsen"}, "edited": false, "score": 0, "creation_date": 1460893659, "post_id": 29179707, "comment_id": 60942275, "body": "The easiest method is probably Frege."}], "answers": [{"comments": [{"owner": {"reputation": 17430, "user_id": 309483, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d797538504a367f277d19bd8369e9a19?s=128&d=identicon&r=PG", "display_name": "Janus Troelsen", "link": "https://stackoverflow.com/users/309483/janus-troelsen"}, "edited": false, "score": 0, "creation_date": 1461155206, "post_id": 36708537, "comment_id": 61068718, "body": "Thanks for your answer, but when I posted the bounty I was hoping for recent attempts, exactly because I didn&#39;t see anyone using JHC for this since 2011."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 3, "last_activity_date": 1503021561, "last_edit_date": 1503021561, "creation_date": 1461040005, "answer_id": 36708537, "question_id": 29179707, "link": "https://stackoverflow.com/questions/29179707/how-to-target-haskell-to-android-using-jhc/36708537#36708537", "title": "how to target haskell to android using jhc?", "body": "<p>Back in 2011 I had limited success using JHC in a similar way, but targeting iOS instead of Android. <a href=\"https://gergo.erdi.hu/blog/2011-02-13-developing_iphone_applications_in_haskell___a_tutorial/\" rel=\"nofollow noreferrer\">Initial results were good</a> in just getting the thing running, but we ended up discarding JHC in favor of GHC precisely because we started getting weird compile-time errors on programs that used Parsec. Bear in mind, this was in 2011 so JHC might have improved by a lot since.</p>\n\n<p>If you want to give GHC a chance, I'd recommend <a href=\"https://github.com/sseefried/docker-epidemic-build-env\" rel=\"nofollow noreferrer\">looking at this example</a> which uses GHC 7.8 to compile a game for Android. I haven't used it in anger yet, but I did manage to get it working on Docker, getting as far as rebuilding the game from scratch and installing it on a real Android device, so the approach definitely has merit.</p>\n\n<p><strong>UPDATE as of August 2017:</strong> Moritz Angermann has posted <a href=\"https://medium.com/@zw3rk/a-haskell-cross-compiler-for-android-8e297cb74e8a\" rel=\"nofollow noreferrer\">detailed instructions on targeting Android with a GHC  cross-compiler</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "is_accepted": false, "score": 0, "last_activity_date": 1502961628, "creation_date": 1502961628, "answer_id": 45731192, "question_id": 29179707, "link": "https://stackoverflow.com/questions/29179707/how-to-target-haskell-to-android-using-jhc/45731192#45731192", "title": "how to target haskell to android using jhc?", "body": "<p>Well <a href=\"http://eta-lang.org/\" rel=\"nofollow noreferrer\">a compiler called eta</a> maybe the most convenient way now.it targets jvm and it will produce a jar file so you can directly put it in your project</p>\n"}], "owner": {"reputation": 478, "user_id": 4079111, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e4775c2984de42fca587c03065107de1?s=128&d=identicon&r=PG&f=1", "display_name": "doofin", "link": "https://stackoverflow.com/users/4079111/doofin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 357, "favorite_count": 1, "accepted_answer_id": 36708537, "answer_count": 2, "score": 6, "last_activity_date": 1503021561, "creation_date": 1426917030, "last_edit_date": 1461039648, "question_id": 29179707, "link": "https://stackoverflow.com/questions/29179707/how-to-target-haskell-to-android-using-jhc", "title": "how to target haskell to android using jhc?", "body": "<p>I want to write a Haskell function (module) of type: <code>String -&gt; String</code> to call in Android. The easiest method seems to use JHC to generate C code, then use Android NDK to generate a shared library, but I could not find any documentation for JHC. Does JHC also use Cabal to build? Is JHC stable enough to use Parsec or Attoparsec library?</p>\n"}, {"tags": ["haskell", "functional-programming", "lambda-calculus", "interaction-nets"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1426912713, "post_id": 29178805, "comment_id": 46575531, "body": "Yowzers! I&#39;d tell you to post that on CS.SE, but sadly that site seems to get very little traffic, and to be even less focused than this one, so you may get a couple upvotes but no answers. Or I&#39;d tell you to post on cs-theory.SE, but sadly you&#39;re likely to get nothing but downvotes there unless you&#39;re at least an upper-level graduate student."}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 2, "creation_date": 1426940714, "post_id": 29178805, "comment_id": 46581418, "body": "Interaction nets are graphs, not trees. Your data type does not express this. -  The compilation (from Lambda to Net) is indeed given by Lambda to GLambda (Sect.1) and then the four diagrams above E. 4, then simplification (after Ex. 4). - Have you checked other papers by van Oostrom, e.g <a href=\"http://www.phil.uu.nl/~oostrom/oudonderwijs/cmitt/03-04/\" rel=\"nofollow noreferrer\">phil.uu.nl/~oostrom/oudonderwijs/cmitt/03-04</a> (bottom of page), and the references, or other work by the authors that are cited, e.g., <a href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.22.9699\" rel=\"nofollow noreferrer\">citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.22.9699</a>"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1426953134, "post_id": 29178805, "comment_id": 46585065, "body": "I am trying, but again, the pile of undefined things (probably assuming I should know) and the huge amount of big, different papers to read is, in general, is making this job very hard. I really think many would benefit from a brief summary and simple reference implementation, akin to that &quot;implementing dependently typing&quot; tutorial. Again, if anyone reading this is knowledgeable enough to provide this, please, consider doing so :)"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1427133789, "post_id": 29178805, "comment_id": 46643496, "body": "Jan Rochel wrote an implementation of <a href=\"https://hackage.haskell.org/package/graph-rewriting-lambdascope\" rel=\"nofollow noreferrer\">lambdascope in haskell</a>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1427176850, "post_id": 29178805, "comment_id": 46659486, "body": "I know, thank you! I find the code quite complicated, though - it uses his own DSL so it is hard to see how it works. Plus, it is missing a &quot;fromNet&quot; function, so it is useless if all I want is normalizing terms. It has a great graphical interface, though."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 1, "last_activity_date": 1481611107, "creation_date": 1481611107, "answer_id": 41115002, "question_id": 29178805, "link": "https://stackoverflow.com/questions/29178805/how-do-you-translate-from-lambda-terms-to-interaction-nets/41115002#41115002", "title": "How do you translate from lambda terms to interaction nets?", "body": "<p>I have an <a href=\"https://github.com/gergoerdi/interaction-nets/blob/master/src/Language/IntNet.hs\" rel=\"nofollow noreferrer\">implementation of interaction net reduction in Haskell</a> that uses <code>STRef</code>s to represent the net graph structure in a mutable way:</p>\n\n<pre><code>data NodeType = NRot\n              | NLam\n              | NApp\n              | NDup Int\n              | NEra\n             deriving (Show)\n\ntype NodeID = Int\ntype Port s = STRef s (Node s, PortNum)\n\ndata Node s = Node\n    { nodeType :: !NodeType\n    , nodeID :: !NodeID\n    , nodePort0, nodePort1, nodePort2 :: !(Port s)\n    }\n</code></pre>\n\n<p>Conversion from lambda terms is implemented in a <a href=\"https://github.com/gergoerdi/interaction-nets/blob/master/src/Language/IntNet/Lam.hs\" rel=\"nofollow noreferrer\">separate module</a>. It is not the nicest code I've ever written, because it's a straight transliteration of a <a href=\"https://github.com/MaiaVictor/optlam\" rel=\"nofollow noreferrer\">Javascript implementation</a> and I didn't really take the time to understand what the JS version is doing:</p>\n\n<pre><code>encodeLam :: Lam -&gt; IntNet s (Node s)\nencodeLam lam = do\n    nextTag &lt;- do\n        ref &lt;- lift $ newSTRef 0\n        return $ lift $ do\n            modifySTRef ref succ\n            readSTRef ref\n\n    let go scope up (Lam body) = do\n            del &lt;- mkNode NEra\n            lam &lt;- mkNode NLam\n            linkHalf lam P0 up\n            link (lam, P1) (del, P0)\n            link (del, P1) (del, P2)\n            bod &lt;- go (lam:scope) (lam, P2) body\n            linkHalf lam P2 bod\n            return (lam, P0)\n        go scope up (App f e) = do\n            app &lt;- mkNode NApp\n            linkHalf app P2 up\n            linkHalf app P0 =&lt;&lt; go scope (app, P0) f\n            linkHalf app P1 =&lt;&lt; go scope (app, P1) e\n            return (app, P2)\n        go scope up (Var v) = do\n            let lam = scope !! v\n            (target, targetPort) &lt;- readPort lam P1\n            case nodeType target of\n                NEra -&gt; do\n                    linkHalf lam P1 up\n                    return (lam, P1)\n                _ -&gt; do\n                    dup &lt;- mkNode . NDup =&lt;&lt; nextTag\n                    linkHalf dup P0 (lam, P1)\n                    linkHalf dup P1 up\n                    link (dup, P2) =&lt;&lt; readPort lam P1\n                    linkHalf lam P1 (dup, P0)\n                    return (dup, P1)\n\n    root &lt;- asks root\n    enc &lt;- go [] (root, P0) lam\n    linkHalf root P0 enc\n    return root\n</code></pre>\n\n<p>It also implements the reverse transformation:</p>\n\n<pre><code>decodeLam :: Node s -&gt; IntNet s Lam\ndecodeLam root = do\n    (setDepth, getDepth) &lt;- do\n        ref &lt;- lift $ newSTRef mempty\n        let set node depth = lift $ modifySTRef ref $\n                             IntMap.insertWith (\\ _new old -&gt; old) (nodeID node) depth\n            get node = lift $ (! nodeID node) &lt;$&gt; readSTRef ref\n        return (set, get)\n\n    let go depth exit (node, port) = do\n            setDepth node depth\n            case nodeType node of\n                NDup _ -&gt; do\n                    let (port', exit') = case port of\n                            P0 -&gt; (head exit, tail exit)\n                            _ -&gt; (P0, port:exit)\n                    go depth exit' =&lt;&lt; readPort node port'\n                NLam -&gt; case port of\n                    P1 -&gt; do\n                        depth' &lt;- getDepth node\n                        return $ Var (depth - depth' - 1)\n                    _ -&gt; Lam &lt;$&gt; (go (succ depth) exit =&lt;&lt; readPort node P2)\n                NApp -&gt; do\n                    f &lt;- go depth exit =&lt;&lt; readPort node P0\n                    e &lt;- go depth exit =&lt;&lt; readPort node P1\n                    return $ App f e\n    go 0 [] =&lt;&lt; readPort root P0\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 407, "favorite_count": 0, "accepted_answer_id": 41115002, "answer_count": 1, "score": 5, "last_activity_date": 1481611107, "creation_date": 1426907281, "question_id": 29178805, "link": "https://stackoverflow.com/questions/29178805/how-do-you-translate-from-lambda-terms-to-interaction-nets", "title": "How do you translate from lambda terms to interaction nets?", "body": "<p>On <a href=\"http://www.phil.uu.nl/~oostrom/publication/pdf/lambdascope.pdf\" rel=\"noreferrer\">this paper</a>, the author suggests a translation between lambda terms: </p>\n\n<pre><code>data Term = Zero | Succ Term | App Term Term | Lam Term\n</code></pre>\n\n<p>and interaction nets:</p>\n\n<pre><code>data Net = -- if I understood correctly\n    Apply Net Net Net \n    | Abstract Net Net Net\n    | Delete Net Net Int\n    | Duplicate Net Net Net Int\n    | Erase Net\n</code></pre>\n\n<p>Unfortunately I can not understand his compilation algorithm. It seems like the actual algorithm is missing, and I have no idea what he means with the images on the third page. I've tried understanding it by looking at the published source code, but the author defines it using his own graph rewriting DSL so I would have to learn it first. How exactly is the translation implemented as a normal Haskell function?</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "edited": false, "score": 0, "creation_date": 1426934994, "post_id": 29175747, "comment_id": 46579898, "body": "Thanks, that was exactly what I was looking for. A minor correction: it should be --test-option=always at the end."}], "tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 6, "last_activity_date": 1426935050, "last_edit_date": 1426935050, "creation_date": 1426885222, "answer_id": 29175747, "question_id": 29175592, "link": "https://stackoverflow.com/questions/29175592/using-cabal-to-compile-but-not-run-the-test-suite/29175747#29175747", "title": "Using cabal to compile but not run the test suite?", "body": "<p>If you <code>cabal configure --enable-tests</code>, then <code>cabal build</code> will build not just the library/executables, but also the test suites. You can also build individual test suites by name, saying <code>cabal build name-of-test-suite</code>.</p>\n\n<p>You can run them manually from the appropriate subdirectories under <code>dist/build</code> if you don't want to use <code>cabal test</code>.</p>\n\n<p>Furthermore, if it's e.g. a <code>tasty</code> test suite, you may be able to get color output by saying something like</p>\n\n<pre><code>cabal test --show-details=always --test-option=--color --test-option=always\n</code></pre>\n\n<p>You can also try <code>--show-details=streaming</code>. I don't know how robust this is, though, and whether it works may also depend on the platform you are on.</p>\n"}], "owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 1, "accepted_answer_id": 29175747, "answer_count": 1, "score": 4, "last_activity_date": 1426935050, "creation_date": 1426884624, "question_id": 29175592, "link": "https://stackoverflow.com/questions/29175592/using-cabal-to-compile-but-not-run-the-test-suite", "title": "Using cabal to compile but not run the test suite?", "body": "<p><code>cabal test</code> will compile the test suite executable and then run it. However, it removes the console colouring (because it logs the result). I'd like to use cabal to build the executable and then run it from a script, but I can't figure out how to just build the executable.</p>\n"}, {"tags": ["function", "haskell", "function-composition"], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 7, "last_activity_date": 1426882702, "last_edit_date": 1426882702, "creation_date": 1426881743, "answer_id": 29174926, "question_id": 29174842, "link": "https://stackoverflow.com/questions/29174842/confusion-with-function-composition/29174926#29174926", "title": "Confusion with function composition", "body": "<p>The reason for this is that <code>.</code> only allows the function to take <em>one</em> argument before being passed to the next. So:</p>\n\n<pre><code>(sum . map) double [1,2,3]\n</code></pre>\n\n<p>Will become</p>\n\n<pre><code>(sum (map double)) [1,2,3]\n</code></pre>\n\n<p>...and we can't sum a function, can we? Type error galore!</p>\n\n<p>What you'll want to do is this:</p>\n\n<pre><code>(sum . map double) [1,2,3]\n</code></pre>\n\n<p>which reduces to:</p>\n\n<pre><code>sum (map double [1,2,3])\n</code></pre>\n\n<p>If you want to see, here's how <code>.</code> is defined:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)\n(.) f g arg = f (g arg)\n</code></pre>\n\n<hr>\n\n<p>If you're being really smart, you can doubly compose something, so that it takes two arguments before it's passed along:</p>\n\n<pre><code>((sum .) . map) double [1,2,3]\n</code></pre>\n\n<p>which reduces to:</p>\n\n<pre><code>(sum . map double) [1,2,3]\n</code></pre>\n\n<p>and finally:</p>\n\n<pre><code>sum (map double [1,2,3])\n</code></pre>\n"}], "owner": {"reputation": 5095, "user_id": 2022518, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/9366c006da5aca3fa94f7be13677042d?s=128&d=identicon&r=PG", "display_name": "LetMeSOThat4U", "link": "https://stackoverflow.com/users/2022518/letmesothat4u"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 2, "accepted_answer_id": 29174926, "answer_count": 1, "score": 2, "last_activity_date": 1432308693, "creation_date": 1426881390, "last_edit_date": 1495540265, "question_id": 29174842, "link": "https://stackoverflow.com/questions/29174842/confusion-with-function-composition", "title": "Confusion with function composition", "body": "<p>Beginning to learn Haskell:</p>\n\n<pre><code>*Main&gt; map double [1,2,3]\n[2,4,6]\n\n*Main&gt; sum (map double [1,2,3])\n12\n\n*Main&gt; (sum . map) (double) ([1,2,3])\n\n&lt;interactive&gt;:71:8:\nCouldn't match type \u2018[b0] -&gt; [b0]\u2019 with \u2018[[t0] -&gt; t]\u2019\nExpected type: (b0 -&gt; b0) -&gt; [[t0] -&gt; t]\n  Actual type: (b0 -&gt; b0) -&gt; [b0] -&gt; [b0]\nRelevant bindings include it :: t (bound at &lt;interactive&gt;:71:1)\nProbable cause: \u2018map\u2019 is applied to too few arguments\nIn the second argument of \u2018(.)\u2019, namely \u2018map\u2019\nIn the expression: sum . map\n</code></pre>\n\n<p>According to this answer: <a href=\"https://stackoverflow.com/questions/940382/haskell-difference-between-dot-and-dollar-sign\">Haskell: difference between . (dot) and $ (dollar sign)</a> \"The primary purpose of the . operator is not to avoid parenthesis, but to chain functions. It lets you tie the output of whatever appears on the right to the input of whatever appears on the left.\". </p>\n\n<p>OK, so why my example does not work? Actual and expected types are different, but why? After all, according to this description <code>map</code> should take <code>(double) ([1,2,3])</code> on the input and pass its output to <code>sum</code>'s input?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1426882772, "post_id": 29174829, "comment_id": 46568028, "body": "The first sentence in your question doesn&#39;t make sense."}], "answers": [{"comments": [{"owner": {"reputation": 144, "user_id": 1808054, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GLsdL.png?s=128&g=1", "display_name": "Ori", "link": "https://stackoverflow.com/users/1808054/ori"}, "edited": false, "score": 0, "creation_date": 1426883394, "post_id": 29174994, "comment_id": 46568286, "body": "What&#39;s &quot;happy path&quot;? Any idea why I&#39;m getting <code>^M</code> character at the end of every line?"}, {"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "reply_to_user": {"reputation": 144, "user_id": 1808054, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GLsdL.png?s=128&g=1", "display_name": "Ori", "link": "https://stackoverflow.com/users/1808054/ori"}, "edited": false, "score": 0, "creation_date": 1426883756, "post_id": 29174994, "comment_id": 46568453, "body": "The happy path is the path the code takes if no errors occur. <code>^M</code> probably has to do with Windows vs. Unix line endings, I don&#39;t know the exact cause."}], "tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": true, "score": 1, "last_activity_date": 1426882034, "creation_date": 1426882034, "answer_id": 29174994, "question_id": 29174829, "link": "https://stackoverflow.com/questions/29174829/closing-the-handle-in-desugared-code/29174994#29174994", "title": "Closing the Handle in desugared code", "body": "<p>You're only closing the handles in the happy path. You must use <code>withFile</code> or <code>bracket</code> instead so that the handles will be closed even when an exception is thrown.</p>\n\n<p>For example:</p>\n\n<pre><code>capitalize = withFile \"input.txt\" ReadMode $\n             \\x -&gt; hGetContents x &gt;&gt;=\n             \\y -&gt; withFile \"output2.txt\" WriteMode $\n             \\z -&gt; hPutStrLn z (fmap toUpper y)\n</code></pre>\n\n<p>Without <code>withFile</code>:</p>\n\n<pre><code>capitalize = openFile \"input.txt\" ReadMode &gt;&gt;=\n             \\x -&gt; hGetContents x &gt;&gt;=\n             \\y -&gt; openFile \"output2.txt\" WriteMode &gt;&gt;=\n             \\z -&gt; hPutStrLn z (fmap toUpper y) &gt;&gt;\n             hClose x &gt;&gt;\n             hClose z\n</code></pre>\n"}], "owner": {"reputation": 144, "user_id": 1808054, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GLsdL.png?s=128&g=1", "display_name": "Ori", "link": "https://stackoverflow.com/users/1808054/ori"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 29174994, "answer_count": 1, "score": 0, "last_activity_date": 1426882794, "creation_date": 1426881337, "last_edit_date": 1426882794, "question_id": 29174829, "link": "https://stackoverflow.com/questions/29174829/closing-the-handle-in-desugared-code", "title": "Closing the Handle in desugared code", "body": "<p>Does it matter if I don't close both handles but to be safe how would I do so in the desugared <a href=\"http://book.realworldhaskell.org/read/io.html\" rel=\"nofollow\">Real World Haskell</a> example</p>\n\n<pre><code>import System.IO\nimport Data.Char(toUpper)\n\nmain :: IO ()\nmain = do \n       inh &lt;- openFile \"input.txt\" ReadMode\n       outh &lt;- openFile \"output.txt\" WriteMode\n       mainloop inh outh\n       hClose inh\n       hClose outh\n\nmainloop :: Handle -&gt; Handle -&gt; IO ()\nmainloop inh outh = \n    do ineof &lt;- hIsEOF inh\n       if ineof\n           then return ()\n           else do inpStr &lt;- hGetLine inh\n                   hPutStrLn outh (map toUpper inpStr)\n                   mainloop inh outh\n</code></pre>\n\n<p>to</p>\n\n<pre><code>capitalize = openFile \"input.txt\" ReadMode &gt;&gt;=\n             \\x -&gt; hGetContents x &gt;&gt;=\n             \\y -&gt; openFile \"output2.txt\" WriteMode &gt;&gt;=\n             \\z -&gt; hPutStrLn z (fmap toUpper y)\n</code></pre>\n\n<p>Everything works except for \"output2.txt\" file which has a <code>^M</code> character at the end of each line.</p>\n"}, {"tags": ["haskell", "syntactic-sugar"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1426876738, "post_id": 29173185, "comment_id": 46565072, "body": "Actually, your style is more accurate in terms of the variables bound, but it could be written either way."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1426878258, "post_id": 29173185, "comment_id": 46565888, "body": "Your version is the correct desugaring. The given answer does extra work."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1426879567, "post_id": 29173185, "comment_id": 46566567, "body": "Desugaring does not perform pointfree transformations. The replacement of <code>\\str -&gt; putStrLn (&quot;Hi &quot; ++ str)</code> by <code>putStrLn . (&quot;Hi &quot; ++)</code> is extra work not specified in the desugaring rules."}], "answers": [{"comments": [{"owner": {"reputation": 144, "user_id": 1808054, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GLsdL.png?s=128&g=1", "display_name": "Ori", "link": "https://stackoverflow.com/users/1808054/ori"}, "edited": false, "score": 0, "creation_date": 1426878005, "post_id": 29173334, "comment_id": 46565744, "body": "Should have been obvious to me.  Was over thinking it.  Thank You"}], "tags": [], "owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "is_accepted": true, "score": 7, "last_activity_date": 1426881859, "last_edit_date": 1426881859, "creation_date": 1426875736, "answer_id": 29173334, "question_id": 29173185, "link": "https://stackoverflow.com/questions/29173185/haskell-desugar-syntax/29173334#29173334", "title": "Haskell desugar syntax", "body": "<p>The snippets are identical, the latter just uses <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow\">point free</a> style (also punningly referred to as \"pointless style\").</p>\n\n<p>The central point is that <code>(\"Hi \" ++)</code> is a partially applied <code>(++)</code> that prepends <code>\"Hi \"</code> to the input. </p>\n\n<p>This function is composed (using <code>.</code>) with <code>putStrLn</code> to get a function that prepends \"Hi \" to the input and then prints it. </p>\n\n<p>This is exactly what your more explicit lambda does.</p>\n"}], "owner": {"reputation": 144, "user_id": 1808054, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GLsdL.png?s=128&g=1", "display_name": "Ori", "link": "https://stackoverflow.com/users/1808054/ori"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 29173334, "answer_count": 1, "score": 2, "last_activity_date": 1426881859, "creation_date": 1426875166, "last_edit_date": 1426878046, "question_id": 29173185, "link": "https://stackoverflow.com/questions/29173185/haskell-desugar-syntax", "title": "Haskell desugar syntax", "body": "<p>Shuklan's <a href=\"http://shuklan.com/haskell/lec09.html#/0/18\" rel=\"nofollow\">Haskell Lecture</a> wanted the following code desugared:</p>\n\n<pre><code>main = do\n  putStrLn \"Enter name:\"\n  name &lt;- getLine\n  putStrLn (\"Hi \" ++ name)\n</code></pre>\n\n<p>I came up with:</p>\n\n<pre><code>main = putStrLn \"Enter name:\" &gt;&gt; getLine &gt;&gt;= \\str -&gt; putStrLn (\"Hi \" ++ str)\n</code></pre>\n\n<p>He revealed:</p>\n\n<pre><code>main = putStrLn \"Enter name:\" &gt;&gt; getLine &gt;&gt;= putStrLn . (\"Hi \" ++)\n</code></pre>\n\n<p>Never seen that syntax before, how does it work?</p>\n"}, {"tags": ["haskell", "substring", "find-occurrences"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1426881260, "post_id": 29173013, "comment_id": 46567372, "body": "Can you give an example?"}, {"owner": {"reputation": 486, "user_id": 3807103, "user_type": "registered", "accept_rate": 58, "profile_image": "https://lh3.googleusercontent.com/-YNIokoSHQ8U/AAAAAAAAAAI/AAAAAAAAAFs/hUUwaGWJ4IQ/photo.jpg?sz=128", "display_name": "qleguennec", "link": "https://stackoverflow.com/users/3807103/qleguennec"}, "edited": false, "score": 0, "creation_date": 1426884917, "post_id": 29173013, "comment_id": 46569031, "body": "I might have misunderstood your problem, shouldn&#39;t the type of occ be [Elem] -&gt; (Int, [Int])? There is no reason that it should output a list."}], "answers": [{"tags": [], "owner": {"reputation": 170, "user_id": 4680808, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/i506Y.png?s=128&g=1", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/4680808/mikhail"}, "is_accepted": true, "score": 1, "last_activity_date": 1426888272, "creation_date": 1426888272, "answer_id": 29176372, "question_id": 29173013, "link": "https://stackoverflow.com/questions/29173013/map-of-number-of-occurrences-in-a-list/29176372#29176372", "title": "Map of number of occurrences in a list", "body": "<p>I apologize for complexity, but this work:</p>\n\n<pre><code>import Data.List\ndata Elem = Dot | Star\nocc :: [Elem] -&gt; [(Int, [Int])]\nocc list = reduce (occ_hlp list 1 0 0 [])\n\n-- Help function, which find all subsequence of Stars\nocc_hlp [] pos cur_pos cur_len result       | cur_len == 0 = result\n                                            | otherwise = ((cur_len, [cur_pos]):result)\nocc_hlp (Star:t) pos cur_pos cur_len result | cur_len == 0 = occ_hlp t (pos + 1) pos 1 result\n                                            | otherwise = occ_hlp t (pos + 1) cur_pos (cur_len + 1) result\nocc_hlp (Dot:t) pos cur_pos cur_len result  | pos == 1 = occ_hlp t (pos + 1) 0 0 result\n                                            | otherwise = occ_hlp t (pos + 1) 0 0 ((cur_len, [cur_pos]) : result)\n\n-- Reduce obtained subsequence of Stars with same length                                            \nreduce list = filter (\\x -&gt; not $ (snd x) == []) \n                 $ [(elem, sort $ foldl (\\x y -&gt; x ++ (snd y)) [] (filter (\\x -&gt; (fst x) == elem) list)) | elem &lt;- [1..max_len]] \n                     where max_len = maximum $ map (fst) list\n</code></pre>\n\n<p>In this program i have 2 help functions:</p>\n\n<p>1) occ_help, which find all [(Int, [Int])] subsequence of Stars.\nFor your example:</p>\n\n<pre><code>occ_hlp [Dot,Star,Dot,Star,Dot,Star,Star,Star] 1 0 0 []\n</code></pre>\n\n<p>will returns list of subsequence:</p>\n\n<pre><code>[(3,[6]),(1,[4]),(1,[2])]\n</code></pre>\n\n<p>2) reduce, which folds list of these elements to required list\nExample:</p>\n\n<pre><code>reduce [(3,[6]),(1,[4]),(1,[2])]\n</code></pre>\n\n<p>will returns your result:</p>\n\n<pre><code>[(1,[2,4]),(3,[6])]\n</code></pre>\n"}], "owner": {"reputation": 149, "user_id": 4146323, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-_env-LLlT78/AAAAAAAAAAI/AAAAAAAAAdc/3YneQMotNAI/photo.jpg?sz=128", "display_name": "edoz90", "link": "https://stackoverflow.com/users/4146323/edoz90"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 375, "favorite_count": 0, "accepted_answer_id": 29176372, "answer_count": 1, "score": 0, "last_activity_date": 1426898766, "creation_date": 1426874560, "last_edit_date": 1426898766, "question_id": 29173013, "link": "https://stackoverflow.com/questions/29173013/map-of-number-of-occurrences-in-a-list", "title": "Map of number of occurrences in a list", "body": "<p>I'm working with this type of list:</p>\n\n<p><code>data Elem = Dot | Star</code></p>\n\n<p>and I've to print a list of tuples, with 2 units, in which the first indicates the length of a sequence of \"Star\" in the list and the second lists the locations where this sequence appears (the first position is 1). Possibly without using built in function.</p>\n\n<p>The function is:</p>\n\n<p><code>occ :: [Elem] -&gt; [(Int, [Int])]</code></p>\n\n<p>EDIT:\nMy idea is: split the problem in two functions, one for find the position of every \"Star\", one for lists the locations.</p>\n\n<p>EDIT2:\nExample: </p>\n\n<p><code>occ [Dot,Star,Dot,Star,Dot,Star,Star,Star]</code></p>\n\n<p><code>[(1,[2,4]), (3,[6])]</code></p>\n\n<p>EDIT3:\n<a href=\"http://pastebin.com/uvvXBARL\" rel=\"nofollow\">http://pastebin.com/uvvXBARL</a></p>\n"}, {"tags": ["haskell", "type-inference"], "comments": [{"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 3, "creation_date": 1426873072, "post_id": 29172584, "comment_id": 46563353, "body": "Replace <code>m x</code> with <code>a -&gt; x</code>\u2014functions form a monad!"}], "answers": [{"tags": [], "owner": {"reputation": 1144, "user_id": 4245823, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-czWZC6KwKYU/AAAAAAAAAAI/AAAAAAAAAYI/yBtPVyZjU4M/photo.jpg?sz=128", "display_name": "felipez", "link": "https://stackoverflow.com/users/4245823/felipez"}, "is_accepted": false, "score": 2, "last_activity_date": 1426875646, "last_edit_date": 1426875646, "creation_date": 1426874675, "answer_id": 29173043, "question_id": 29172584, "link": "https://stackoverflow.com/questions/29172584/how-to-understand-type-inference-of-f-ap-min/29173043#29173043", "title": "How to understand type inference of &quot;f = ap min&quot;?", "body": "<p>your question is related to the concept of unification, which can be roughly described as the process of finding the expressions' types subjected to constrains imposed by the environment.\ntake a look at this excellent course/manual developed by Stephen Diehl,</p>\n\n<blockquote>\n  <p><a href=\"http://dev.stephendiehl.com/fun/#january\" rel=\"nofollow\">http://dev.stephendiehl.com/fun/#january</a></p>\n</blockquote>\n\n<p>Chapter 5 to 8 describe what you are looking for.</p>\n"}, {"comments": [{"owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "edited": false, "score": 0, "creation_date": 1426877582, "post_id": 29173508, "comment_id": 46565516, "body": "I need digest all the gems from your great answer. Thanks!"}, {"owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "edited": false, "score": 0, "creation_date": 1426879372, "post_id": 29173508, "comment_id": 46566463, "body": "Side question: will type unification on Haskell result in one but only one correct type?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1426905348, "post_id": 29173508, "comment_id": 46574422, "body": "@augustss, that seems to ignore the monomorphism restriction in Report Haskell, and the limitations on let generalization in common Glasgow flavors."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1426951096, "post_id": 29173508, "comment_id": 46584455, "body": "@dfeuer There are some minor caveats. I regard the monomorphism restriction as a &quot;bug&quot;, and the missing let generalization is only with certain ghc extensions.  If you want to be picky then things also break down for polymorphic recursion, GADTs, defaulting, and undoubtedly other extensions as well.  But sometimes it&#39;s better with an approximation to the absolute truth than the actual truth. :)"}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 3, "last_activity_date": 1426885504, "last_edit_date": 1426885504, "creation_date": 1426876348, "answer_id": 29173508, "question_id": 29172584, "link": "https://stackoverflow.com/questions/29172584/how-to-understand-type-inference-of-f-ap-min/29173508#29173508", "title": "How to understand type inference of &quot;f = ap min&quot;?", "body": "<pre><code>ap     :: Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b\nmin    :: Ord a =&gt; a -&gt; a -&gt; a\n-------------------------------------------------\nap min :: ?\n</code></pre>\n\n<p>Since <code>min</code> is the argument to <code>ap</code>, it means that we need to figure out a way to <a href=\"http://en.wikipedia.org/wiki/Unification_%28computer_science%29\" rel=\"nofollow\">unify</a> these two types:</p>\n\n<pre><code>Monad m =&gt; m (a -&gt; b)\nOrd a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>To do this, first we need to figure out what <code>Monad</code> instance (if any) applies here.  Since <code>a -&gt; a -&gt; a</code> is the same as <code>a -&gt; (a -&gt; a)</code>, the <code>m</code> type variable needs to be equated with <code>(-&gt;) a</code>.  (Note that Haskell supports currying and sections in the type system as well; just as <code>(+) 1</code> is the partial application of the function <code>(+)</code> to the argument <code>1</code>, <code>(-&gt;) a</code> is the partial application of the type constructor <code>(-&gt;)</code> to the type <code>a</code>.)</p>\n\n<p>So we rewrite to this:</p>\n\n<pre><code>Monad m =&gt; m        (a -&gt; b)\n  Ord a =&gt; ((-&gt;) a) (a -&gt; a)\n</code></pre>\n\n<p>This makes it easy to visualize the substitutions that we need to make in the type of <code>ap</code>:</p>\n\n<pre><code>m := Ord a =&gt; (-&gt;) a\na := Ord a =&gt; a\nb := Ord a =&gt; a\n</code></pre>\n\n<p>But before we can proceed, we need to establish whether there exists a <code>Monad</code> instance for <code>(-&gt;) a</code>, because otherwise this is a type error.  But the following is one of the standard <code>Monad</code> instances, and it will do:</p>\n\n<pre><code>instance Monad ((-&gt;) r) where\n    return a = const a\n    fa &gt;&gt;= g = \\r -&gt; g (fa r) r\n</code></pre>\n\n<p>So now let's make the substitutions:</p>\n\n<pre><code>ap     :: Ord a =&gt; ((-&gt;) a) (a -&gt; a) -&gt; ((-&gt;) a) a -&gt; ((-&gt;) a) a\nmin    :: Ord a =&gt; a -&gt; a -&gt; a\n--------------------------------------------------------\nap min :: ?\n</code></pre>\n\n<p>Uncurry the types in <code>ap</code>:</p>\n\n<pre><code>ap     :: Ord a =&gt; (a -&gt; a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a\nmin    :: Ord a =&gt; a -&gt; a -&gt; a\n--------------------------------------------------------\nap min :: ?\n</code></pre>\n\n<p>And now it's hopefully easy to see the solution:</p>\n\n<pre><code>ap     :: Ord a =&gt; (a -&gt; a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a\nmin    :: Ord a =&gt;  a -&gt; a -&gt; a\n--------------------------------------------------------\nap min :: Ord a =&gt; (a -&gt; a) -&gt; a -&gt; a\n</code></pre>\n"}], "owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 29173508, "answer_count": 2, "score": 1, "last_activity_date": 1426885504, "creation_date": 1426872914, "question_id": 29172584, "link": "https://stackoverflow.com/questions/29172584/how-to-understand-type-inference-of-f-ap-min", "title": "How to understand type inference of &quot;f = ap min&quot;?", "body": "<p>I've been struggling to understand another example on type inference below,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>min :: Ord a =&gt; a -&gt; a -&gt; a\nap  :: Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b\n\nf   :: Ord a =&gt; (a -&gt; a) -&gt; a -&gt; a\nf   =  ap min\n\nf reverse \"on\" -- \"no\"\n</code></pre>\n\n<p>How is the type of <code>f</code> inferred when <code>ap</code> is applied to <code>min</code>? Where should I look for some practical references on the topic of type inference in Haskell? </p>\n"}, {"tags": ["haskell", "set", "custom-data-type"], "comments": [{"owner": {"reputation": 13, "user_id": 2608895, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/c867793b6495b1f6f3ea5ff6064ee2f8?s=128&d=identicon&r=PG", "display_name": "user2608895", "link": "https://stackoverflow.com/users/2608895/user2608895"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1426873060, "post_id": 29172459, "comment_id": 46563346, "body": "yep i know, just wondering if it can be done"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1426873086, "post_id": 29172459, "comment_id": 46563364, "body": "Take a look at <code>Data.List.intercalate</code>."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1426873308, "creation_date": 1426873308, "answer_id": 29172685, "question_id": 29172459, "link": "https://stackoverflow.com/questions/29172459/how-to-show-user-defined-data-type-sets-in-haskell/29172685#29172685", "title": "How to &quot;show&quot; user defined data type &quot;sets&quot; in Haskell?", "body": "<p>First: as you probably have it in your own code: type names and constructors must be uppercase.</p>\n\n<pre><code>data Set a = Set [a]\n</code></pre>\n\n<p>Second: the <code>Show</code> class isn't really meant for such pretty-printing. Often, users will expect its output to be valid Haskell code. <code>{1,2,3}</code> is not valid Haskell.</p>\n\n<p>Anyway...</p>\n\n<p>The easiest solution would be to just use the <code>Show</code> instance for the underlying list type, like you did, but trim away a leading <code>[</code> and trailing <code>]</code>:</p>\n\n<pre><code>trimOuterBrackets :: String -&gt; String\ntrimOuterBrackets ('[':s)\n                | (']':s') &lt;- reverse s  = reverse s'\ntrimOuterBrackets s = s\n</code></pre>\n\n<p>Note however that this wouldn't work reliably, at least not for characters: <code>show $ Set ['b','l','a']</code> would yield <code>{\"bla\"}</code>, because strings are lists as well but <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:showList\" rel=\"nofollow\">shown differently</a>.</p>\n\n<p>Therefore, you should better define the function yourself. As bheklilr remarked, it can be done with <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Data-List.html#v:intercalate\" rel=\"nofollow\"><code>intercalate</code></a>: this takes a list of strings and another string that is used to &ldquo;glue&rdquo; those strings together. A list of strings can be obtained by <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:map\" rel=\"nofollow\"><code>map</code></a>ing the <code>show</code> function over the elements of your set...</p>\n\n<p>This should be enough hints, I think.</p>\n"}], "owner": {"reputation": 13, "user_id": 2608895, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/c867793b6495b1f6f3ea5ff6064ee2f8?s=128&d=identicon&r=PG", "display_name": "user2608895", "link": "https://stackoverflow.com/users/2608895/user2608895"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 485, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1426880220, "creation_date": 1426872425, "last_edit_date": 1426880220, "question_id": 29172459, "link": "https://stackoverflow.com/questions/29172459/how-to-show-user-defined-data-type-sets-in-haskell", "title": "How to &quot;show&quot; user defined data type &quot;sets&quot; in Haskell?", "body": "<p>if i've defined a set data type like:</p>\n\n<pre><code>data Set a = Set [a]\n</code></pre>\n\n<p>examples of sets:</p>\n\n<ul>\n<li><code>empty = Set []</code> </li>\n<li><code>s = Set [1,23]</code></li>\n</ul>\n\n<p>and i want to create an instance of show to display the set like this:\n{1, 23} instead instead of [1,23]</p>\n\n<p>how would i go about doing this?\nso far i've tried something like: </p>\n\n<pre><code>instance (Show a) =&gt; Show (Set a) where \nshow (Set a) = \"{\" ++ show a ++ \"}\"\n</code></pre>\n\n<p>But this doesn't work because it gives me {[1,23]} </p>\n\n<p>Is it even possible to do something like this? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1426873136, "post_id": 29172356, "comment_id": 46563384, "body": "Both definitions of <code>Zero</code> and <code>One</code> are equivalent. However, the constructor <code>Two</code> can not be represented outside a GADT."}, {"owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1426873766, "post_id": 29172356, "comment_id": 46563667, "body": "@chi I tried to do it in the first way, but it returned an error saying Illegal kind signature MyType?"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1426874980, "post_id": 29172356, "comment_id": 46564233, "body": "@xcoder Do you have <code>KindSignatures</code> enabled?"}], "answers": [{"tags": [], "owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "is_accepted": true, "score": 0, "last_activity_date": 1426945465, "creation_date": 1426945465, "answer_id": 29183418, "question_id": 29172356, "link": "https://stackoverflow.com/questions/29172356/haskell-custom-data-type-expression/29183418#29183418", "title": "Haskell custom data type expression", "body": "<p>This has to be done via GADT. The trick is to enable KindSignature in your program.</p>\n"}], "owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 29183418, "answer_count": 1, "score": 2, "last_activity_date": 1426945465, "creation_date": 1426872050, "last_edit_date": 1426873793, "question_id": 29172356, "link": "https://stackoverflow.com/questions/29172356/haskell-custom-data-type-expression", "title": "Haskell custom data type expression", "body": "<p>If I have the custom data type as follows:</p>\n\n<pre><code>data MyType :: * -&gt; *  where\nZero:: MyType a\nOne:: a -&gt; MyType a\nTwo:: MyType a -&gt; MyType b -&gt; MyType (a,b)\n</code></pre>\n\n<p>Is it the same as writing them as:</p>\n\n<pre><code> data MyType a = Zero\n             | One a\n</code></pre>\n\n<p>Is the above correct? And how do I represent Two?</p>\n"}, {"tags": ["c++", "opengl", "haskell", "abstract", "vbo"], "answers": [{"comments": [{"owner": {"reputation": 38487, "user_id": 2327517, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0Bulc.jpg?s=128&g=1", "display_name": "derhass", "link": "https://stackoverflow.com/users/2327517/derhass"}, "edited": false, "score": 0, "creation_date": 1426887873, "post_id": 29173073, "comment_id": 46570302, "body": "Why a different VBO? The buffer object is just memory which is totally under the user&#39;s control. There is nothing which prevents having several objects with different vertex formats in the same VBO."}, {"owner": {"reputation": 678, "user_id": 3241118, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/519fc989bbf1c18ad275b427d3e4fda4?s=128&d=identicon&r=PG&f=1", "display_name": "Gentatsu", "link": "https://stackoverflow.com/users/3241118/gentatsu"}, "edited": false, "score": 0, "creation_date": 1426901911, "post_id": 29173073, "comment_id": 46573930, "body": "Ok, cool. I know how much I can abstract out then. Thanks! Yeah, I&#39;ll use the same VBO. All the binding and stuff should be the same, just the offsets and stuff is different I think. Thanks, both of you!"}, {"owner": {"reputation": 49036, "user_id": 3530129, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IYkz8.jpg?s=128&g=1", "display_name": "Reto Koradi", "link": "https://stackoverflow.com/users/3530129/reto-koradi"}, "reply_to_user": {"reputation": 678, "user_id": 3241118, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/519fc989bbf1c18ad275b427d3e4fda4?s=128&d=identicon&r=PG&f=1", "display_name": "Gentatsu", "link": "https://stackoverflow.com/users/3241118/gentatsu"}, "edited": false, "score": 0, "creation_date": 1426907280, "post_id": 29173073, "comment_id": 46574669, "body": "@Gentatsu If I properly understand what you&#39;re trying to do, you shouldn&#39;t have a problem with the VBO storage. But you <i>will</i> have to skip the <code>glVertexAttribPointer()</code> call for the normals if you don&#39;t have them. And make sure that you don&#39;t enable the corresponding attribute."}, {"owner": {"reputation": 678, "user_id": 3241118, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/519fc989bbf1c18ad275b427d3e4fda4?s=128&d=identicon&r=PG&f=1", "display_name": "Gentatsu", "link": "https://stackoverflow.com/users/3241118/gentatsu"}, "edited": false, "score": 0, "creation_date": 1426939408, "post_id": 29173073, "comment_id": 46581032, "body": "Yeah, that&#39;s what I got from the answer. It&#39;s in quite a complex chain of code, so I didn&#39;t want to play around with it too much in case I lost where I was, and had to roll back again anyway. It&#39;s good to know where I stand, and do it in  a bit as opposed to dive straight in. Thanks!"}], "tags": [], "owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "is_accepted": true, "score": 1, "last_activity_date": 1426874791, "creation_date": 1426874791, "answer_id": 29173073, "question_id": 29172282, "link": "https://stackoverflow.com/questions/29172282/vbo-general-geometry/29173073#29173073", "title": "VBO General Geometry", "body": "<p>From the <a href=\"https://www.opengl.org/sdk/docs/man/html/glVertexAttribPointer.xhtml\" rel=\"nofollow\">OpenGL documentation</a> for <code>glVertexAttribPointer</code>:</p>\n\n<blockquote>\n<i>size</i><br>\nSpecifies the number of components per generic vertex attribute. Must     \nbe 1, 2, 3, 4. Additionally, the symbolic constant <code>GL_BGRA</code> is accepted \nby <b>glVertexAttribPointer</b>. The initial value is 4.\n</blockquote>\n\n<p>Hence, you cannot call a pointer to something whose type has size zero. In order to not use normals, you'd have to use a different VBO.</p>\n"}], "owner": {"reputation": 678, "user_id": 3241118, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/519fc989bbf1c18ad275b427d3e4fda4?s=128&d=identicon&r=PG&f=1", "display_name": "Gentatsu", "link": "https://stackoverflow.com/users/3241118/gentatsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 29173073, "answer_count": 1, "score": 0, "last_activity_date": 1426874791, "creation_date": 1426871804, "question_id": 29172282, "link": "https://stackoverflow.com/questions/29172282/vbo-general-geometry", "title": "VBO General Geometry", "body": "<p>I'm making a rendering engine in Haskell, and am optimising my code to use VBOs. I'd like to abstract the type of geometry a bit, as there are a decent amount, and would like to kind of stick it in one function, and a few parameters. </p>\n\n<p>For example, if I have one set of geometry which is a list of pairs of vertices and normals i.e. <code>[(Vertex, Normal)]</code>. I set the stride to 6, in the descriptor, set the size for 3 for each and then the offset for the normals as 3. </p>\n\n<p>Now, if I wanted to do just a list of vertices i.e. [Vertex], could I set the size of the stride to be 3, and size of the normal to be 0 but still set the pointers and everything? </p>\n"}, {"tags": ["haskell", "sudoku"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1426867046, "post_id": 29170746, "comment_id": 46559758, "body": "Put the <code>T</code>s in parentheses first, then perform the substitution.  It should be <code>mark :: ((Int, Int), Int) -&gt; ((Int, Int) -&gt; [Int]) -&gt; ((Int, Int) -&gt; [Int])</code>."}, {"owner": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1426867372, "post_id": 29170746, "comment_id": 46559982, "body": "why parentheses are required? I didn&#39;t say type T = ((Int,Int) -&gt; [Int])"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1426867609, "post_id": 29170746, "comment_id": 46560126, "body": "The types <code>a -&gt; b -&gt; c</code> and <code>(a -&gt; b) -&gt; c</code> are different, the first is not different from <code>a -&gt; (b -&gt; c)</code>.  The <code>-&gt;</code> is right-associative, so the parentheses matter."}, {"owner": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1426867879, "post_id": 29170746, "comment_id": 46560266, "body": "If it was right associative I would have got...((Int,Int),Int )-&gt; ((Int,Int) -&gt;  ([Int] -&gt; ((Int,Int) -&gt; [Int])))"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1426868148, "post_id": 29170746, "comment_id": 46560447, "body": "No, you would have <code>((Int, Int), Int) -&gt; (T) -&gt; (T) ~ ((Int, Int), Int) -&gt; (T) -&gt; ((Int, Int) -&gt; [Int]) ~ ((Int, Int), Int) -&gt; (T) -&gt; (Int, Int) -&gt; [Int] ~ ((Int, Int), Int) -&gt; ((Int, Int) -&gt; [Int]) -&gt; (Int, Int) -&gt; [Int]</code>.  I would recommend copy/pasting this into your editor and splitting it up on the <code>~</code>s to read it better, but this is the substitution that GHC will do to arrive at the final type.  Note that you end up with essentially 3 arguments, the <code>((Int, Int), Int)</code>, <code>((Int, Int) -&gt; [Int])</code>, and <code>(Int, Int)</code>, to return a <code>[Int]</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1426868718, "post_id": 29170746, "comment_id": 46560782, "body": "@AnimeshSaxena &quot;Why are the parentheses needed?&quot; Answer: because Haskell does the sane thing and uses syntactic substitution, not string interpolation. One can&#39;t write <code>type Foo = eger</code> and use <code>IntFoo</code> in place of <code>Integer</code>, either, and thank goodness for that!"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1426871528, "post_id": 29170746, "comment_id": 46562501, "body": "This is the kind of moment where naming things well can make all the difference."}, {"owner": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "edited": false, "score": 0, "creation_date": 1426906223, "post_id": 29170746, "comment_id": 46574529, "body": "Ok I got most of it. I didn&#39;t get the last part where you remove the parenthesis from (T).  ((Int, Int), Int) -&gt; ((Int,Int)-&gt;[Int]) -&gt; ((Int,Int)-&gt;[Int]). In your solution the last argument has parenthesis removed and it splits up into two parts. So why this selective choice, coz both 2nd and third arguments were T? Sorry if this is stretching your patience."}], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1426871815, "post_id": 29170944, "comment_id": 46562677, "body": "In other words, instead of <code>T</code>, a better name would have been <code>Optioner</code> or even <code>Solver</code>."}, {"owner": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "edited": false, "score": 0, "creation_date": 1426944905, "post_id": 29170944, "comment_id": 46582636, "body": "So as per the mapping I would get something like this....p = ((1,2),6) (for example). s = function which takes two ints and gives out an array of ints. This seems to hold for (const [1..9]) coz if I do (const [1..9]) (2,3) it will give out [1..9] which is array of ints. Still there is confusion about q. I am not passing q when i am calling mark via foldr. What is q? How is it passed in the call?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "edited": false, "score": 0, "creation_date": 1426945168, "post_id": 29170944, "comment_id": 46582715, "body": "@AnimeshSaxena True, <code>foldr</code> is not passing <code>q</code> to <code>mark</code>. But <code>mark</code> is returning a <code>T</code>, which is a function that does take <code>q</code> (a pair) and returns a list. Instead of writing <code>mark p s = \\q -&gt; ... some list</code> which is clearer, the author wrote the equivalent <code>mark p s q = ... some list</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1426867433, "creation_date": 1426867433, "answer_id": 29170944, "question_id": 29170746, "link": "https://stackoverflow.com/questions/29170746/how-to-break-up-complex-type-aliases-in-haskell/29170944#29170944", "title": "How to break up complex type aliases in haskell?", "body": "<p>A value of this type</p>\n\n<pre><code>type T = (Int,Int) -&gt; [Int]\n</code></pre>\n\n<p>maps the coordinates of any sudoku cell <code>(x,y) :: (Int,Int)</code> into a set of the possible values such cell might have (represented as a list of digits <code>[Int]</code>).</p>\n\n<p>The function <code>const [0..9]</code> maps any cell into the set of all digits. It acts as the initial state for a sudoku solver: at the beginning, assume any cell may have any digit.</p>\n"}], "owner": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 29170944, "answer_count": 1, "score": 0, "last_activity_date": 1426867530, "creation_date": 1426866883, "last_edit_date": 1426867530, "question_id": 29170746, "link": "https://stackoverflow.com/questions/29170746/how-to-break-up-complex-type-aliases-in-haskell", "title": "How to break up complex type aliases in haskell?", "body": "<p>I came across this very old sudoku code which seems greek to me coz of mainly this ugly type</p>\n\n<pre><code>type T = (Int,Int) -&gt; [Int]\n</code></pre>\n\n<p>To understand this function for instance</p>\n\n<pre><code>mark :: ((Int,Int),Int) -&gt; T -&gt; T\nmark (p@(i,j),n) s q@(x,y) =\n  if p==q then [n] else\n  if x==i || y==j || e x i &amp;&amp; e y j then delete n $ s q else s q\n  where e a b = div (a-1) 3==div (b-1) 3\n</code></pre>\n\n<p>I can replace the T with the actual type</p>\n\n<pre><code>mark :: ((Int,Int),Int) -&gt; (Int,Int)-&gt;[Int] -&gt; (Int,Int)-&gt;[Int]\nmark (p@(i,j),n) s q@(x,y) = \n</code></pre>\n\n<p>Now the type arguments don't seem to line up properly. p matches perfectly, but i get confused with \"s\". If I jump into the call for mark it's like this.....here the list I can easily see it's array of key value pairs with keys like (1,2) etc. These have been filtered for blanks or zeros in sudoku. </p>\n\n<pre><code>input :: String -&gt; (Int,Int) -&gt; [Int]\ninput s = foldr mark (const [1..9]) $\n   [(p,n) | (p,n) &lt;- zip idx $ map read $ lines s &gt;&gt;= words, n&gt;0]\n</code></pre>\n\n<p>The mark function is called with this list and accumulator which is a function (const [1..9]). This doesn't fit the type signature. </p>\n\n<pre><code>mark :: ((Int,Int),Int) -&gt; (Int,Int)-&gt;[Int] -&gt; (Int,Int)-&gt;[Int]\n</code></pre>\n\n<p>Problem with the code is that I can't see the actual result of the mark function which I still don't understand. When it's passed to a third function it gets some output. Any explanation on how to understand this sphagetti code?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 2339963, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/449132ac6b41d73d15413727ad059c5b?s=128&d=identicon&r=PG", "display_name": "Wolf", "link": "https://stackoverflow.com/users/2339963/wolf"}, "edited": false, "score": 0, "creation_date": 1426884493, "post_id": 29170714, "comment_id": 46568814, "body": "Interesting. What would the idiomatic way to handle this type difference in Haskell be? I ended up doing <code>(toInteger . length . digList) xs</code> so that ghc would infer <code>i</code>&#39;s type to be <code>Integer</code> but the extra call to toInteger seems... dirty to me."}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "reply_to_user": {"reputation": 119, "user_id": 2339963, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/449132ac6b41d73d15413727ad059c5b?s=128&d=identicon&r=PG", "display_name": "Wolf", "link": "https://stackoverflow.com/users/2339963/wolf"}, "edited": false, "score": 1, "creation_date": 1427358747, "post_id": 29170714, "comment_id": 46747256, "body": "@wolf you can also use <code>genericLength :: Num i =&gt; [a] -&gt; i</code>. It&#39;s slightly slower than just <code>length</code> but can return any kind of number."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 2, "last_activity_date": 1426866814, "creation_date": 1426866814, "answer_id": 29170714, "question_id": 29170679, "link": "https://stackoverflow.com/questions/29170679/couldnt-match-type-integer-with-int/29170714#29170714", "title": "Couldn&#39;t match type `Integer&#39; with `Int&#39;", "body": "<p>The argument <code>i</code> to <code>isnp</code> is inferred to be <code>Int</code> because you use <code>i `elem` xs</code>, and because you use <code>i == length (digList n)</code>.  The compiler sees that <code>i</code> should be an <code>Int</code> since you're comparing it to <code>length (digList n)</code>, which always returns an <code>Int</code>, and you're using <code>i `elem` xs</code>, so <code>xs</code> must have the type <code>[Int]</code>, but you pass in <code>(digList n)</code> for <code>xs</code>, and <code>digList n</code> has type <code>[Integer]</code>, hence the error.</p>\n"}], "owner": {"reputation": 119, "user_id": 2339963, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/449132ac6b41d73d15413727ad059c5b?s=128&d=identicon&r=PG", "display_name": "Wolf", "link": "https://stackoverflow.com/users/2339963/wolf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 709, "favorite_count": 0, "accepted_answer_id": 29170714, "answer_count": 1, "score": 0, "last_activity_date": 1426866999, "creation_date": 1426866704, "last_edit_date": 1426866999, "question_id": 29170679, "link": "https://stackoverflow.com/questions/29170679/couldnt-match-type-integer-with-int", "title": "Couldn&#39;t match type `Integer&#39; with `Int&#39;", "body": "<p>I am working on Project Euler #41, and this is part of my solution to the problem which I can't figure out how to get around Haskell expecting an <code>[Int]</code> instead of an <code>[Integer]</code>. Diglist works fine but I included it just in case the error somehow involves it.</p>\n\n<pre><code>digList :: Integer -&gt; [Integer]\ndigList n = digList' [] n where\n        digList' xs n\n                | n &lt; 10        = n : xs\n                | otherwise = digList' (lsd : xs) nxt\n                where\n                    lsd = n `mod` 10\n                    nxt = n `div` 10\n\nisNPandigital :: Integer -&gt; Bool\nisNPandigital n = isnp 1 (digList n) where --error on this line\n    isnp i xs\n        | i `elem` xs = isnp i $ delete i xs\n        | i == length (digList n) = null xs\n        | otherwise = False\n</code></pre>\n\n<p>The error is:     </p>\n\n<pre><code>Couldn't match type `Integer' with `Int'\nExpected type: [Int]\nActual type: [Integer]\nIn the return type of a call of `digList'\nIn the second argument of `isnp', namely `(digList n)'\nIn the expression: isnp 1 (digList n)\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 4, "creation_date": 1426866216, "post_id": 29170362, "comment_id": 46559171, "body": "Monomorphism restriction lift in GHCi. (yet again)"}, {"owner": {"reputation": 13921, "user_id": 2045611, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/74ed58457a9b1cb04f854ae5ca531ca5?s=128&d=identicon&r=PG", "display_name": "Cam", "link": "https://stackoverflow.com/users/2045611/cam"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1426866274, "post_id": 29170362, "comment_id": 46559211, "body": "Hi Bartek, can you expand a little on what that means, or give a resource that would help me understand?"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1426866385, "post_id": 29170362, "comment_id": 46559285, "body": "<a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow noreferrer\">Monomorphism restriction</a> is disabled in GHCi by default. This keeps reappearing on SO, with the similar ambiguity message (hence &quot;yet again&quot;)."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 3, "creation_date": 1426869997, "post_id": 29170362, "comment_id": 46561611, "body": "This is <i>not</i> about the monomorphism restriction being lifted. It&#39;s about GHCi having extended default rules, as bheklilr&#39;s answer explains correctly. The monomorphism restriction causes the definition in the source file to fail, but it doesn&#39;t apply to the GHCi input, as it&#39;s not a let binding."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 1, "last_activity_date": 1426866629, "last_edit_date": 1426866629, "creation_date": 1426866243, "answer_id": 29170496, "question_id": 29170362, "link": "https://stackoverflow.com/questions/29170362/no-instance-for-eq-a-arising-from-a-use-of/29170496#29170496", "title": "No instance for (Eq a) arising from a use of `==&#39;", "body": "<p>Just explicitly annotate it with type:</p>\n\n<pre><code>value = test Empty == ([] :: [[Int]])\n</code></pre>\n\n<p>The type of <code>[]</code> can be anything: <code>[Int]</code> or <code>[Float]</code> or <code>[[Int]]</code>. The compiler is not able to figure it out because even <code>Exp</code> is polymorphic. If your function was like this you wouldn't have to explicitly annotate:</p>\n\n<pre><code>test :: EXP Int -&gt; [[Int]]\ntest Empty = []\ntest (Symbol x) = [[x]]\n\nvalue = test Empty == []\n</code></pre>\n\n<p>Or even if you are ready to give it hints like this:</p>\n\n<pre><code>value :: [[Int]]\nvalue = (test Empty)\n\nvalue2 = value == []\n</code></pre>\n\n<p>That said, instead of using <code>Int</code>, use <code>()</code> for annotating as @bheklir has done. That is a better approach of tagging type to remove ambiguity for the compiler.</p>\n"}, {"comments": [{"owner": {"reputation": 13921, "user_id": 2045611, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/74ed58457a9b1cb04f854ae5ca531ca5?s=128&d=identicon&r=PG", "display_name": "Cam", "link": "https://stackoverflow.com/users/2045611/cam"}, "edited": false, "score": 0, "creation_date": 1426866463, "post_id": 29170508, "comment_id": 46559340, "body": "do you know why GHCi does that? what are the practical reasons for wanting that different behavior?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 13921, "user_id": 2045611, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/74ed58457a9b1cb04f854ae5ca531ca5?s=128&d=identicon&r=PG", "display_name": "Cam", "link": "https://stackoverflow.com/users/2045611/cam"}, "edited": false, "score": 1, "creation_date": 1426866643, "post_id": 29170508, "comment_id": 46559462, "body": "@Cam Actually, the practical reason is situations like this.  Interactive development is not meant to be as formal as your finished application, so you can think of it as a relaxation of the type checking rules so that you don&#39;t have to give explicit types all the time.  For example, GHCi picks <code>IO</code> as its default instance for <code>Monad</code>, it picks <code>Double</code> for <code>Floating</code>, <code>Integer</code> for <code>Integral</code>, and more.  It&#39;s just there to help reduce the number of expressions that need explicit signatures.  It does trip a lot of people up, though, I&#39;m not sure how much of a net positive this feature is."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1426866674, "post_id": 29170508, "comment_id": 46559477, "body": "Nice explanation! I always forgot how useful <code>()</code> is in these scenarios!"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 4, "last_activity_date": 1426866280, "creation_date": 1426866280, "answer_id": 29170508, "question_id": 29170362, "link": "https://stackoverflow.com/questions/29170362/no-instance-for-eq-a-arising-from-a-use-of/29170508#29170508", "title": "No instance for (Eq a) arising from a use of `==&#39;", "body": "<p>What you need to get <code>value</code> to compile is a local type signature</p>\n\n<pre><code>value = (test Empty :: [[()]]) == []\n</code></pre>\n\n<p>Or better yet, use <code>null</code>:</p>\n\n<pre><code>value = null $ test Empty\n</code></pre>\n\n<p>This is because the type of <code>test</code> is</p>\n\n<pre><code>test :: EXP a -&gt; [[a]]\n</code></pre>\n\n<p>And the type of <code>value</code> is just <code>Bool</code>.  The compiler has no way to guess exactly what <code>Eq</code> instance to use inside of <code>value</code>, it can't be inferred from the context.  In general whenever you see <code>== []</code>, you should replace this with the <code>null</code> function since this avoids the <code>Eq</code> constraint.</p>\n\n<p>It works in GHCi because when you type in <code>(test Empty) == []</code>, GHCi's extended defaulting rules will automatically pick <code>()</code> for the ambiguous <code>a</code> type.</p>\n"}], "owner": {"reputation": 13921, "user_id": 2045611, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/74ed58457a9b1cb04f854ae5ca531ca5?s=128&d=identicon&r=PG", "display_name": "Cam", "link": "https://stackoverflow.com/users/2045611/cam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1363, "favorite_count": 0, "accepted_answer_id": 29170508, "answer_count": 2, "score": 1, "last_activity_date": 1426866629, "creation_date": 1426865811, "question_id": 29170362, "link": "https://stackoverflow.com/questions/29170362/no-instance-for-eq-a-arising-from-a-use-of", "title": "No instance for (Eq a) arising from a use of `==&#39;", "body": "<p>In the following Haskell code:</p>\n\n<pre><code>import Data.List\nimport Data.Char\n\ndata EXP a = Empty | Symbol a\n           deriving (Show, Eq, Ord)\n\ntest :: (Ord a) =&gt; EXP a -&gt; [[a]]\n\ntest Empty = []\ntest (Symbol x) = [[x]]\n\nvalue = (test Empty) == []\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>problem.hs:12:10:\n    No instance for (Ord a0) arising from a use of `test'\n    The type variable `a0' is ambiguous\n    Note: there are several potential instances:\n      instance Ord a =&gt; Ord (EXP a) -- Defined at problem.hs:5:32\n      instance Integral a =&gt; Ord (GHC.Real.Ratio a)\n        -- Defined in `GHC.Real'\n      instance Ord GeneralCategory -- Defined in `Data.Char'\n      ...plus 26 others\n    In the first argument of `(==)', namely `(test Empty)'\n    In the expression: (test Empty) == []\n    In an equation for `value': value = (test Empty) == []\n\nproblem.hs:12:22:\n    No instance for (Eq a0) arising from a use of `=='\n    The type variable `a0' is ambiguous\n    Note: there are several potential instances:\n      instance Eq a =&gt; Eq (EXP a) -- Defined at problem.hs:5:28\n      instance Eq a =&gt; Eq (GHC.Real.Ratio a) -- Defined in `GHC.Real'\n      instance Eq GeneralCategory -- Defined in `Data.Char'\n      ...plus 26 others\n    In the expression: (test Empty) == []\n    In an equation for `value': value = (test Empty) == []\nFailed, modules loaded: none.\n</code></pre>\n\n<p>But if I remove the last line, so the code is:</p>\n\n<pre><code>import Data.List\nimport Data.Char\n\ndata EXP a = Empty | Symbol a\n           deriving (Show, Eq, Ord)\n\ntest :: (Ord a) =&gt; EXP a -&gt; [[a]]\n\ntest Empty = []\ntest (Symbol x) = [[x]]\n</code></pre>\n\n<p>I can do the following in the interactive prompt, without error:</p>\n\n<pre><code>Prelude&gt; :l problem.hs\n[1 of 1] Compiling Main             ( problem.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; test Empty == []\nTrue\n*Main&gt;\n</code></pre>\n\n<p>Why do I get an error when the == check is in the source file, but not when it's in the interactive prompt?</p>\n"}, {"tags": ["haskell", "types", "functional-programming"], "comments": [{"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 1, "creation_date": 1426853667, "post_id": 29166179, "comment_id": 46551059, "body": "Please provide a fully working example. Without <code>&lt;-</code>, this is not a list comprehension and I doubt it compiles."}, {"owner": {"reputation": 1827, "user_id": 450706, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f88b53eac24db144b567a6ea9b17b795?s=128&d=identicon&r=PG", "display_name": "Rich Ashworth", "link": "https://stackoverflow.com/users/450706/rich-ashworth"}, "reply_to_user": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1426853870, "post_id": 29166179, "comment_id": 46551176, "body": "updated the code snippet"}, {"owner": {"reputation": 716, "user_id": 1995474, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae968c7b168bb164fc30f3e3254a8478?s=128&d=identicon&r=PG", "display_name": "Stephan", "link": "https://stackoverflow.com/users/1995474/stephan"}, "edited": false, "score": 1, "creation_date": 1426854523, "post_id": 29166179, "comment_id": 46551541, "body": "I think the <code>x==fromJust(f y)</code> in the list comprehension isn&#39;t necessary. Conditioning on <code>isJust(f y)</code> does the job."}], "answers": [{"tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": false, "score": 14, "last_activity_date": 1426854428, "last_edit_date": 1426854428, "creation_date": 1426853453, "answer_id": 29166207, "question_id": 29166179, "link": "https://stackoverflow.com/questions/29166179/how-to-deal-with-maybe-type-in-haskell-list-comprehensions/29166207#29166207", "title": "How to deal with Maybe type in Haskell list comprehensions", "body": "<p>You can simply use <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Data-Maybe.html#v:catMaybes\"><code>catMaybes</code></a> (from <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Data-Maybe.html\"><code>Data.Maybe</code></a>) to filter out all <code>Nothing</code> values.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1426862626, "post_id": 29166431, "comment_id": 46556654, "body": "You might want to explain that this is essentially <code>flip concatMap (f y) $ \\result -&gt; case result of {Just x -&gt; [x]; {-Implicitly added!-} _ -&gt; []}</code>"}, {"owner": {"reputation": 716, "user_id": 1995474, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae968c7b168bb164fc30f3e3254a8478?s=128&d=identicon&r=PG", "display_name": "Stephan", "link": "https://stackoverflow.com/users/1995474/stephan"}, "edited": false, "score": 1, "creation_date": 1426865344, "post_id": 29166431, "comment_id": 46558607, "body": "Right, I find it easier to just learn that pattern matching in list comprehensions is perfectly valid and automatically filters out non-matching cases. Your desugaring is not exactly adding clarity, I find :-)"}, {"owner": {"reputation": 6218, "user_id": 962696, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c93e1ec07b42606f1efd7d7414f3c21d?s=128&d=identicon&r=PG&f=1", "display_name": "JonnyRaa", "link": "https://stackoverflow.com/users/962696/jonnyraa"}, "edited": false, "score": 0, "creation_date": 1589213936, "post_id": 29166431, "comment_id": 109197994, "body": "interesting that the behaviour is different here from pattern matching in do notation where <code>Just x &lt;- f y</code> might error"}, {"owner": {"reputation": 716, "user_id": 1995474, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae968c7b168bb164fc30f3e3254a8478?s=128&d=identicon&r=PG", "display_name": "Stephan", "link": "https://stackoverflow.com/users/1995474/stephan"}, "edited": false, "score": 0, "creation_date": 1589361188, "post_id": 29166431, "comment_id": 109260111, "body": "It wouldn&#39;t be different to do notation, because it&#39;s the monad instance of List that controls how pattern matching errors are handled. And in List, error simply is ignored. This might have changed recently due to the MonadFail proposal, I&#39;m not sure."}], "tags": [], "owner": {"reputation": 716, "user_id": 1995474, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae968c7b168bb164fc30f3e3254a8478?s=128&d=identicon&r=PG", "display_name": "Stephan", "link": "https://stackoverflow.com/users/1995474/stephan"}, "is_accepted": true, "score": 17, "last_activity_date": 1426860198, "last_edit_date": 1426860198, "creation_date": 1426854232, "answer_id": 29166431, "question_id": 29166179, "link": "https://stackoverflow.com/questions/29166179/how-to-deal-with-maybe-type-in-haskell-list-comprehensions/29166431#29166431", "title": "How to deal with Maybe type in Haskell list comprehensions", "body": "<p>If you simply want to filter out all the <code>Nothing</code>s, shang's answer gives the most concise solution. However, it can be done easily in a list comprehension:</p>\n\n<pre><code>[x | Just x &lt;- f y]\n</code></pre>\n"}], "owner": {"reputation": 1827, "user_id": 450706, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f88b53eac24db144b567a6ea9b17b795?s=128&d=identicon&r=PG", "display_name": "Rich Ashworth", "link": "https://stackoverflow.com/users/450706/rich-ashworth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1272, "favorite_count": 2, "accepted_answer_id": 29166431, "answer_count": 2, "score": 4, "last_activity_date": 1426860198, "creation_date": 1426853375, "last_edit_date": 1426854390, "question_id": 29166179, "link": "https://stackoverflow.com/questions/29166179/how-to-deal-with-maybe-type-in-haskell-list-comprehensions", "title": "How to deal with Maybe type in Haskell list comprehensions", "body": "<p>I have a list comprehension in Haskell that specifies a predicate on a Maybe type:</p>\n\n<p><code>[x | x &lt;- listOfMaybes, isJust(f y), x == fromJust(f y)]</code></p>\n\n<p>is there a way to simplify this expression?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1426851416, "post_id": 29165581, "comment_id": 46549889, "body": "You cannot use <code>Char</code> like that, because <code>Char</code> is a <i>type</i>, not a <i>value</i>. In <code>func (One ...)</code>, you need to replace the dots by a <i>value</i> (of any type), e.g. <code>func (One &#39;a&#39;)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "edited": false, "score": 0, "creation_date": 1426851558, "post_id": 29165632, "comment_id": 46549966, "body": "Thanks for your answer. I just tried func (One &quot;Hello&quot;) and it gives me back &quot;Hello&quot;? I expected it returns something like String? Looks like I need to modify func?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "edited": false, "score": 0, "creation_date": 1426851773, "post_id": 29165632, "comment_id": 46550083, "body": "oh - no sorry it&#39;s not that easy - you can use something like <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Data-Typeable.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.7.0.2/docs/&hellip;</a> (it&#39;s a bit like the runtime-type-information you get with Java and .net) but overall see my addition above"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "edited": false, "score": 2, "creation_date": 1426851833, "post_id": 29165632, "comment_id": 46550108, "body": "what are you trying to do with this? Maybe we can help with that instead?"}, {"owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "edited": false, "score": 0, "creation_date": 1426852957, "post_id": 29165632, "comment_id": 46550694, "body": "um...to simplify it, what I am trying to do is to read a string, gets the prefix of the string which matches certain pattern, then extract this part of matched string and show it as (a,string), where a is a datatype...um...maybe I should understand my problem better."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 2, "last_activity_date": 1426851414, "creation_date": 1426851414, "answer_id": 29165632, "question_id": 29165581, "link": "https://stackoverflow.com/questions/29165581/haskell-custom-datatype-with-parameter/29165632#29165632", "title": "Haskell custom datatype with parameter", "body": "<p>Try <code>func (One \"Hello\")</code> it will work.</p>\n\n<p>The reason is that Haskell thinks you are trying to give it a <em>data-constructor</em> because you wrote a upper-case <code>Char</code> so just give it some real value ;)</p>\n\n<p>BTW: In case you really want to give the <em>type</em> <code>Char</code>: that's in general not possible in Haskell as you need a dependent-type caps (see <a href=\"https://en.wikipedia.org/wiki/Idris_(programming_language)#Dependent_types\" rel=\"nofollow\">Idris</a> for example).</p>\n"}, {"tags": [], "owner": {"reputation": 1452, "user_id": 538973, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f2dc3b359948acc418b091aef228d384?s=128&d=identicon&r=PG", "display_name": "RasmusWL", "link": "https://stackoverflow.com/users/538973/rasmuswl"}, "is_accepted": false, "score": 1, "last_activity_date": 1426851652, "creation_date": 1426851652, "answer_id": 29165701, "question_id": 29165581, "link": "https://stackoverflow.com/questions/29165581/haskell-custom-datatype-with-parameter/29165701#29165701", "title": "Haskell custom datatype with parameter", "body": "<p>That's not really how haskell works. <code>Char</code> is a type, so we can write</p>\n\n<pre><code>func :: MyType Char -&gt; Char\n</code></pre>\n\n<p>meaning that we expect the \"something\" of <code>MyType</code> to be a Char. </p>\n\n<p>Checking what type an argument has is probably valid in something like Java, but is not the way functional programming works.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1427002292, "last_edit_date": 1427002292, "creation_date": 1427001556, "answer_id": 29191268, "question_id": 29165581, "link": "https://stackoverflow.com/questions/29165581/haskell-custom-datatype-with-parameter/29191268#29191268", "title": "Haskell custom datatype with parameter", "body": "<p>I don't think there's much chance you <em>really</em> want this with your current level of understanding of Haskell (it's a stretch for me, and I've been at it a while), but if you really really do, you can actually get something pretty close.</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE PolyKinds #-} --might as well\n\n-- I renamed Nothing to None to avoid conflicting with Maybe.\n-- Since we're using DataKinds, this creates not only a type\n-- constructor MyType and data constructors None and One,\n-- but also a *kind* MyType and *type* constructors None and\n-- One.\ndata MyType a = None | One a\n\n-- We can't make a *function*, func, to take One Char and\n-- produce Char, but we can make a *type function* (called\n-- a type family) to do that (although I don't really know\n-- why you'd want this particular one.\ntype family Func (a :: MyType k) :: k\ntype instance Func (One a) = a\n</code></pre>\n\n<p>Now if we write</p>\n\n<pre><code>Prelude&gt; '3' :: Func (One Char)\n</code></pre>\n\n<p>GHCi is perfectly happy with it. In fact, we can make this type function even more general:</p>\n\n<pre><code>type family Func2 (a :: g) :: k where\n  Func2 (f a) = a\n</code></pre>\n\n<p>Now we can write</p>\n\n<pre><code>'c' :: Func2 (One Char)\n</code></pre>\n\n<p>but we can also write</p>\n\n<pre><code>'c' :: Func2 (Maybe Char)\n</code></pre>\n\n<p>and even</p>\n\n<pre><code>'c' :: Func2 (Either Char)\n'c' :: Func2 ((Either Int) Char)\n</code></pre>\n\n<p>But in case you think anything goes,</p>\n\n<pre><code>'c' :: Func2 (Maybe Int)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>'c' :: Func2 Char\n</code></pre>\n\n<p>will give errors.</p>\n"}], "owner": {"reputation": 1125, "user_id": 777085, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5112855aef89ec6bf599252fbae5eca7?s=128&d=identicon&r=PG", "display_name": "xcoder", "link": "https://stackoverflow.com/users/777085/xcoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1427002292, "creation_date": 1426851245, "last_edit_date": 1426851663, "question_id": 29165581, "link": "https://stackoverflow.com/questions/29165581/haskell-custom-datatype-with-parameter", "title": "Haskell custom datatype with parameter", "body": "<p>I have a custom data type as follows:</p>\n\n<pre><code> data MyType a = Nothing\n             | One a\n</code></pre>\n\n<p>The idea is to have a function that return the data type.  For example,</p>\n\n<p><code>func (One Char)</code> should return <code>Char</code> -- return the data type</p>\n\n<p>I tried to implement <code>func</code> as follow:</p>\n\n<pre><code>func :: MyType a -&gt; a\nfunc (One a) = a\n-- don't worry about Nothing for now\n</code></pre>\n\n<p>The code compiled but when I tried to run <code>func (One Char)</code> it gives me an error: <code>Not in scope: data constructor \u2018Char\u2019\n</code></p>\n\n<p>What is going on?</p>\n"}, {"tags": ["haskell", "frp", "elm"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1426855090, "post_id": 29164392, "comment_id": 46551860, "body": "There are a number of Haskell FRP packages. I think you should probably dig through those before trying to port something from Elm."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427361062, "post_id": 29164392, "comment_id": 46748366, "body": "A few things from this area are mentioned in the disccussion of a new <a href=\"http://www.reddit.com/r/haskell/comments/305stl/ann_the_auto_library_denotative_framework_for/\" rel=\"nofollow noreferrer\">Auto library</a>. Now I suspect that I need something more like a real (&quot;real-time&quot;) FRP rather than a pseudo FRP like Elm or Auto, because I want for a dependent node to perform a new computation only whenever it is free in the real-time (done its previous job), and it should take whatever intermediate result from the source node is available at that moment, skipping any previous ones, and not waiting for new ones..."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427361312, "post_id": 29164392, "comment_id": 46748489, "body": "On a low level, I imagine this as a mutable variable holding the last computed intermediate result (in the source node), and the dependent node reading it whenever it is free again. Or better: whenever it is queried, and hence must force the computation of its value. Well, the last part is not so unsimilar from the Elm system, but matching my idea that the source signal is like a mutable variable with the Elm system is not yet clear for me. Anyway, these considerations of mine are not directly related to the question I posed in the title of this post."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427361483, "post_id": 29164392, "comment_id": 46748562, "body": "Anyway, these considerations of mine are not directly related to the question I posed in the title of this post. I believe the question from the title is a very important and intersting one on its own for the Haskell community, because Elm has an attractive well-presented and widely-known signalling system, which many might want to use in their Haskell programs."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1427362833, "post_id": 29164392, "comment_id": 46749242, "body": "A nice solution to the particular problem of mine could be writing my computation nodes as <a href=\"https://themonadreader.wordpress.com/2011/10/26/issue-19/\" rel=\"nofollow noreferrer\">coroutines</a> (see also <a href=\"http://jozefg.bitbucket.org/posts/2014-04-08-bargain-coroutines.html\" rel=\"nofollow noreferrer\">Bargain Priced Coroutines</a>), and then a specialized top-level main function which would connect them through a mutable variable and scheduling them in &quot;real-time&quot; with real threads. Then I&#39;d have the flexibility of embedding them into a completely different scheduler (purely functional, with discrete steps, cooperative multi-tasking, or less finegrained)"}], "answers": [{"tags": [], "owner": {"reputation": 823, "user_id": 738768, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4f386e31c52b0f02b60dfe847b01e48c?s=128&d=identicon&r=PG", "display_name": "kasbah", "link": "https://stackoverflow.com/users/738768/kasbah"}, "is_accepted": false, "score": 2, "last_activity_date": 1426860704, "last_edit_date": 1426860704, "creation_date": 1426857792, "answer_id": 29167564, "question_id": 29164392, "link": "https://stackoverflow.com/questions/29164392/is-the-signal-system-of-elm-available-as-a-haskell-library/29167564#29167564", "title": "Is the signal system of Elm available as a Haskell library?", "body": "<p><a href=\"https://github.com/switchface/helm\" rel=\"nofollow\">Helm</a>, which I am currently maintainer of, might be what you are looking for. It does combine the signalling with an SDL window that will always appear. You might be able to <a href=\"https://github.com/switchface/helm/blob/master/src/FRP/Helm.hs#L154\" rel=\"nofollow\">hack the render function</a> and still use Helm's <code>Signal</code> without SDL or you could just take inspiration from Helm and write a similar <code>Signal</code> type using Elerea (which Helm uses in the background).</p>\n\n<p>An even better idea might be to modify Helm to allow for use cases where <code>main</code> might not have anything to display and send us a pull-request.</p>\n"}, {"tags": [], "owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "is_accepted": false, "score": 1, "last_activity_date": 1429608122, "creation_date": 1429608122, "answer_id": 29767999, "question_id": 29164392, "link": "https://stackoverflow.com/questions/29164392/is-the-signal-system-of-elm-available-as-a-haskell-library/29767999#29767999", "title": "Is the signal system of Elm available as a Haskell library?", "body": "<p>From <a href=\"http://www.reddit.com/r/haskell/comments/33b3m9/elm_015_tasks_mailboxes_and_import_syntax/cqj8i47\" rel=\"nofollow\">a comment by\nTekmo</a>\nto the announcement of \"Elm 0.15: Tasks, Mailboxes, and import\nsyntax\":</p>\n\n<blockquote>\n  <p>The Haskell version of <em>mailboxes</em> is <code>pipes-concurrency</code>. The analog\n    of Elm's <code>Address</code> is an <code>Output</code> and the analog of a <code>Signal</code> is an\n    <code>Input</code>.</p>\n</blockquote>\n\n<p>(BTW, this seems to be very close to what I was looking for. Initially, in\nprevious versions of Elm, the abstractions I actually wanted seem to\nhave been missing, but <em>tasks</em> and <em>mailboxes</em> might fit my needs\nquite well. So, and now I know--thanks to the comment by Tekmo--that\na similar Haskell library is <code>pipes-concurrency</code>.)</p>\n"}], "owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 631, "favorite_count": 2, "answer_count": 2, "score": 10, "last_activity_date": 1429608122, "creation_date": 1426847339, "question_id": 29164392, "link": "https://stackoverflow.com/questions/29164392/is-the-signal-system-of-elm-available-as-a-haskell-library", "title": "Is the signal system of Elm available as a Haskell library?", "body": "<p>For the task I'm working on, the signal system of the Elm programming language seems to be an appropriate solution.</p>\n\n<p>But my pure computational functions are implemented in Haskell. Is there a Haskell library that would allow me to construct a signal graph (with my pure functions in the nodes) so that it works like in Elm?</p>\n\n<h3>My background</h3>\n\n<p>I need to observe intermediate results of a huge computation, on demand, i.e., I don't want to actually format and output each intermediate result, but if it is requested, then I should respond with the most fresh intermediate result (received from the computation signal).</p>\n\n<p>Actually, there are several parallel computations, and some of them use the result of others, so I want several independent output signals for observing them. So I believe I could write an Elm program modeling the system to observe the intermediate results as they are available. (Perhaps, I'm wrong, I should try to write a prototype at least in Elm probably, but I'm also thinking about integrating with my main Haskell code already.)</p>\n"}, {"tags": ["haskell", "monads", "free-monad", "monadfix"], "comments": [{"owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "edited": false, "score": 1, "creation_date": 1426853945, "post_id": 29161923, "comment_id": 46551227, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/14636048/is-it-possible-to-implement-monadfix-for-free\" title=\"is it possible to implement monadfix for free\">stackoverflow.com/questions/14636048/&hellip;</a>"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "edited": false, "score": 0, "creation_date": 1426870980, "post_id": 29161923, "comment_id": 46562206, "body": "@shang question is pretty different..the other one is asking if a polymorphic generic mfix can be written, while I&#39;m asking about a concrete type :)"}], "answers": [{"comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1426909857, "post_id": 29178811, "comment_id": 46575033, "body": "I&#39;m not completely convinced by this argument...in haskell, we have laziness..  We have MonadFix for State, so so we <code>a -&gt; s -&gt; (a, s)</code> to <code>s -&gt; (a, s)</code>...for example, what if your function outputs a <code>b</code> that is constant and doesn&#39;t depend on <code>next</code>...or what if it outputs something that can be evaluated partially (like a list, where the first two elements are constant), and the rest depends on a <code>next</code> that we generate with the first two...laziness means that we don&#39;t need <i>all</i> <code>next</code> <i>immediately</i> to get <i>some</i> of <code>b</code>..."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1426911748, "post_id": 29178811, "comment_id": 46575388, "body": "@JustinL. We don&#39;t have any <code>b</code>s, we don&#39;t have any <code>a</code>s and we don&#39;t have any <code>next</code>s. If we had a <code>next </code> we could get a <code>b</code>. We can get an <code>a</code> before we need to return a <code>next</code>. The <code>b</code> we return can&#39;t possibly be defined in terms of that <code>a</code>; if it were we&#39;d have poked a hole in the purity of functions; applying the function returned in the <code>MooreF</code> constructor would change the value of the <code>b</code> returned in the same constructor."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1426911903, "post_id": 29178811, "comment_id": 46575417, "body": "@JustinL. As for a &quot;<code>b</code> thas is constant and doesn&#39;t depend on <code>next</code>&quot;, <code>moreFFix</code> must be written <code>forall b.</code>, which is why I say, &quot;we don&#39;t have any <code>b</code>s&quot;. The only value we know <code>b</code> can take on short of something returned from the function is <code>undefined</code> which is worse than useless."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1426913222, "post_id": 29178811, "comment_id": 46575574, "body": "&quot;Not having any <code>b</code>s&quot; doesn&#39;t always stop us in haskell; <code>fix :: (a -&gt; a) -&gt; a</code> works, despite us not having any <code>a</code>s; <code>fix f = f (fix f)</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1426913384, "post_id": 29178811, "comment_id": 46575591, "body": "@JustinL., I do not understand this well enough to know if Cirdec is right, but I do understand Cirdec&#39;s abilities well enough to know you should take what they say seriously."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1426914406, "post_id": 29178811, "comment_id": 46575725, "body": "@dfeuer I&#39;ve been wrong before; usually many times per day. The onus to check arguments before believing them is always on the reader."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1426915041, "post_id": 29178811, "comment_id": 46575815, "body": "@JustinL. I&#39;ve added what happens if you do an analog of <code>a -&gt; s -&gt; (a, s)</code> to <code>s -&gt; (a, s)</code>. Separately, in <code>fix :: (a -&gt; a) -&gt; a</code> not having any <code>a</code>s doesn&#39;t stop us because we <i>have a way to get</i> <code>a</code>s if we only had any <code>a</code>s. When we don&#39;t have any <code>a</code>s or <code>b</code>s, a function <code>( a-&gt; b)</code> doesn&#39;t help us make either the <code>a</code>s we need to use the function or the <code>b</code>s."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1426915287, "post_id": 29178811, "comment_id": 46575867, "body": "@Cirdec, I just mean your argument deserves careful inspection."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1426922356, "post_id": 29178811, "comment_id": 46577042, "body": "thank you all, I think I&#39;m starting to see.  One thing that seems to be weird to me in the end is that I&#39;m basically using this to &quot;purify&quot; code that runs in <code>IO</code>...where all I ever do with the <code>IO</code> is block, put things to stdout, read in the answer, and move on with the answer.  This happens to be MonadFix just fine and works like I expect.  But how come when I try to just isolate the part of IO that I need, how come I apparently lose this ability?"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1426922770, "post_id": 29178811, "comment_id": 46577113, "body": "Also, can we write instances if we popped in concrete types, like <code>Interact Int Int</code> ...?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 1, "creation_date": 1426953244, "post_id": 29178811, "comment_id": 46585101, "body": "@JustinL. It&#39;s because you&#39;ve removed the parts of IO that are needed to write a <code>MonadFix</code> instance. <code>fixIO</code> is based on the ability to read references that haven&#39;t been written yet. It&#39;s implemented in terms of <code>MVar</code>s and <code>unsafeInterleaveIO</code>. <code>Free</code> is &quot;freeing the interpreter as much as possible&quot;, which prevents us from doing a few other things. I believe we can write a <code>MonadFix</code> instance if we commit to a concrete interpreter. I&#39;ll post another answer about how to add <code>MonadFix</code> to <code>Free</code> without committing to a concrete interpreter."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 2, "last_activity_date": 1426914262, "last_edit_date": 1495540250, "creation_date": 1426907351, "answer_id": 29178811, "question_id": 29161923, "link": "https://stackoverflow.com/questions/29161923/monadfix-instance-for-interpreter-monad-transformer-generated-by-freet/29178811#29178811", "title": "MonadFix instance for interpreter monad transformer generated by FreeT?", "body": "<p>It is not possible to write a <code>MonadFix m =&gt; MonadFix (Interactive p r)</code> instance.</p>\n\n<p>Your <code>InteractiveF</code> is the base functor of the well studied <a href=\"http://en.wikipedia.org/wiki/Moore_machine\" rel=\"nofollow noreferrer\">Moore machines</a>. A Moore machine provides an output, in your case the prompt, then determines the next thing to do based on an input, in your case the environment. A Moore machine always outputs first.</p>\n\n<pre><code>data MooreF a b next = MooreF b (a -&gt; next)\n    deriving (Functor)\n</code></pre>\n\n<p>If we follow <a href=\"https://stackoverflow.com/a/14640129/414413\">C. A. McCann's argument</a> about writing <code>MonadFix</code> instances for <code>Free</code> but constrain ourselves to the specific case of <code>Free (MooreF a b)</code>, we will eventually determine that if there's a <code>MonadFix</code> instance for <code>Free (MooreF a b)</code> then there must exist a function</p>\n\n<pre><code>mooreFfix :: (next -&gt; MooreF a b next) -&gt; MooreF a b next\n</code></pre>\n\n<p>To write this function, we must construct a <code>MooreF b (f :: a -&gt; next)</code>. We don't have any <code>b</code>s to output. It's conceivable that we could get a <code>b</code> if we already had the next <code>a</code>, but a Moore machine always outputs first. </p>\n\n<h3>Like the let in State</h3>\n\n<p>You can write something close to <code>mooreFfix</code> if you are reading just one <code>a</code> ahead.</p>\n\n<pre><code>almostMooreFfix :: (next -&gt; MooreF a b next) -&gt; a -&gt; MooreF a b next\nalmostMooreFfix f a = let (MooreF b g) = f (g a)\n                      in (MooreF b g)\n</code></pre>\n\n<p>It then becomes imperative that <code>f</code> be able to determine <code>g</code> independently of the argument <code>next</code>. All of the possible <code>f</code>s to use are of the form <code>f next = MooreF (f' next) g'</code> where <code>f'</code> and <code>g'</code> are some other functions.</p>\n\n<pre><code>almostMooreFFix :: (next -&gt; b) -&gt; (a -&gt; next) -&gt; a -&gt; MooreF a b next\nalmostMooreFFix f' g' a = let (MooreF b g) = f (g a)\n                          in (MooreF b g)\n                          where\n                              f next = MooreF (f' next) g'\n</code></pre>\n\n<p>With some equational reasoning we can replace <code>f</code> on the right side of the <code>let</code></p>\n\n<pre><code>almostMooreFFix :: (next -&gt; b) -&gt; (a -&gt; next) -&gt; a -&gt; MooreF a b next\nalmostMooreFFix f' g' a = let (MooreF b g) = MooreF (f' (g a)) g'\n                          in (MooreF b g)\n</code></pre>\n\n<p>We bind <code>g</code> to <code>g'</code>.</p>\n\n<pre><code>almostMooreFFix :: (next -&gt; b) -&gt; (a -&gt; next) -&gt; a -&gt; MooreF a b next\nalmostMooreFFix f' g' a = let (MooreF b _) = MooreF (f' (g' a)) g'\n                          in (MooreF b g')\n</code></pre>\n\n<p>When we bind <code>b</code> to <code>f' (g' a)</code> the <code>let</code> becomes unnecessary and the function has no recursive knot.</p>\n\n<pre><code>almostMooreFFix :: (next -&gt; b) -&gt; (a -&gt; next) -&gt; a -&gt; MooreF a b next\nalmostMooreFFix f' g' a = MooreF (f' (g' a)) g'\n</code></pre>\n\n<p>All of the <code>almostMooreFFix</code>es that aren't <code>undefined</code> don't even need a <code>let</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 5, "last_activity_date": 1426962342, "last_edit_date": 1426962342, "creation_date": 1426961492, "answer_id": 29186217, "question_id": 29161923, "link": "https://stackoverflow.com/questions/29161923/monadfix-instance-for-interpreter-monad-transformer-generated-by-freet/29186217#29186217", "title": "MonadFix instance for interpreter monad transformer generated by FreeT?", "body": "<p>Imagine you already had an interpreter for <code>Interactive</code>.</p>\n\n<pre><code>interpret :: FreeT (InteractiveF p r) m a -&gt; m a\ninterpret = undefined\n</code></pre>\n\n<p>It would be trivial to write a <code>MonadFix</code> instance:</p>\n\n<pre><code>instance MonadFix m =&gt; MonadFix (FreeT (InteractiveF p r) m) where\n    mfix = lift . mfix . (interpret .)\n</code></pre>\n\n<p>We can directly capture this idea of \"knowing the interpeter\" without committing to an interpreter ahead of time.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\ndata UnFreeT t m a = UnFree {runUnFreeT :: (forall x. t m x -&gt; m x) -&gt; t m a}\n--   given an interpreter from `t m` to `m` ^                          |\n--                                  we have a value in `t m` of type a ^\n</code></pre>\n\n<p><code>UnFreeT</code> is just a <code>ReaderT</code> that reads the interpreter.</p>\n\n<p>If <code>t</code> is a monad transformer, <code>UnFreeT t</code> is also a monad transformer. We can easily build an <code>UnFreeT</code> from a computation that doesn't require knowing the interpreter simply by ignoring the interpeter.</p>\n\n<pre><code>unfree :: t m a -&gt; UnFreeT t m a\n--unfree = UnFree . const\nunfree x = UnFree $ \\_ -&gt; x\n\ninstance (MonadTrans t) =&gt; MonadTrans (UnFreeT t) where\n    lift = unfree . lift\n</code></pre>\n\n<p>If <code>t</code> is a monad transormer, <code>m</code> is a <code>Monad</code>, and <code>t m</code> is also a <code>Monad</code>, then <code>UnFree t m</code> is a <code>Monad</code>. Given an interpreter we can bind together two computations that require the interpeter.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nrefree :: (forall x. t m x -&gt; m x) -&gt; UnFreeT t m a -&gt; t m a\n-- refree = flip runUnFreeT\nrefree interpreter x = runUnFreeT x interpreter\n\ninstance (MonadTrans t, Monad m, Monad (t m)) =&gt; Monad (UnFreeT t m) where\n    return = lift . return\n    x &gt;&gt;= k = UnFree $ \\interpreter -&gt; runUnFreeT x interpreter &gt;&gt;= refree interpreter . k\n</code></pre>\n\n<p>Finally, given the interpreter, we can fix computations as long as the underlying monad has a <code>MonadFix</code> instance.</p>\n\n<pre><code>instance (MonadTrans t, MonadFix m, Monad (t m)) =&gt; MonadFix (UnFreeT t m) where\n    mfix f = UnFree $ \\interpreter -&gt; lift . mfix $ interpreter . refree interpreter . f\n</code></pre>\n\n<p>We can actually do anything the underlying monad can do, once we have the interpreter. This is because, once we have an <code>interpreter :: forall x. t m x -&gt; m x</code> we can do all of the following. We can go from <code>m x</code> through <code>t m x</code> all the way up to <code>UnFreeT t m x</code> and back down again.</p>\n\n<pre><code>                      forall x.\nlift               ::           m x -&gt;         t m x\nunfree             ::         t m x -&gt; UnFreeT t m x\nrefree interpreter :: UnFreeT t m x -&gt;         t m x\ninterpreter        ::         t m x -&gt;           m x\n</code></pre>\n\n<h3>Usage</h3>\n\n<p>For your <code>Interactive</code>, you'd wrap the <code>FreeT</code> in <code>UnFreeT</code>.</p>\n\n<pre><code>type Interactive p r = UnFreeT (FreeT (InteractiveF p r))\n</code></pre>\n\n<p>Your interpreters would still be written to produce a <code>FreeT (InteractiveF p r) m a -&gt; m a</code>. To interpret the new <code>Interactive p r m a</code> all the way to an <code>m a</code> you'd use</p>\n\n<pre><code>interpreter . refree interpreter\n</code></pre>\n\n<p>The <code>UnFreeT</code> no longer \"frees the interpreter as much as possible\". The interpreter can no longer make arbitrary decisions about what to do wherever it wants. The computation in <code>UnFreeT</code> can beg for an interpreter. When the computation begs for and uses an interpreter, the same interpreter will be used to interpret that portion of the program as was used to start interpreting the program.</p>\n"}], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 4, "accepted_answer_id": 29186217, "answer_count": 2, "score": 7, "last_activity_date": 1426962342, "creation_date": 1426838385, "last_edit_date": 1426840117, "question_id": 29161923, "link": "https://stackoverflow.com/questions/29161923/monadfix-instance-for-interpreter-monad-transformer-generated-by-freet", "title": "MonadFix instance for interpreter monad transformer generated by FreeT?", "body": "<p>I have a simplified version of the standard interpreter monad transformer generated by <code>FreeT</code>:</p>\n\n<pre><code>data InteractiveF p r a = Interact p (r -&gt; a)\n\ntype Interactive p r = FreeT (InteractiveF p r)\n</code></pre>\n\n<p><code>p</code> is the \"prompt\", and <code>r</code> is the \"environment\"...one would run this using something like:</p>\n\n<pre><code>runInteractive :: Monad m =&gt; (p -&gt; m r) -&gt; Interactive p r m a -&gt; m a\nrunInteractive prompt iact = do\n  ran &lt;- runFreeT iact\n  case ran of\n    Pure x -&gt; return x\n    Free (Interact p f) -&gt; do\n      response &lt;- prompt p\n      runInteractive prompt (f resp)\n\ninstance MonadFix m =&gt; MonadFix (FreeT (InteractiveF p r)) m a)\nmfix = -- ???\n</code></pre>\n\n<p>I feel like this type is more or less just a constrained version of <code>StateT</code>...if anything, an <code>Interactive p r IO</code> is I think a constrained version of <code>IO</code>...I think...but... well, in any case, my intuiton says that there should be a good instance.</p>\n\n<p>I tried writing one but I can't really seem to figure out.  My closest attempt so far has been:</p>\n\n<pre><code>mfix f = FreeT (mfix (runFreeT . f . breakdown))\n  where\n    breakdown :: FreeF (InteractiveF p r) a (FreeT (InteractiveF p r) m a) -&gt; a\n    breakdown (Pure x) = x\n    breakdown (Free (Interact p r)) = -- ...?\n</code></pre>\n\n<p>I also tried using a version taking advantage of the <code>MonadFix</code> instance of the <code>m</code>, but also no luck --</p>\n\n<pre><code>mfix f = FreeT $ do\n  rec ran &lt;- runFreeT (f z)\n      z   &lt;- case ran of\n               Pure x -&gt; return x\n               Free iact -&gt; -- ...\n  return -- ...\n</code></pre>\n\n<p>Anyone know if this is really possible at all, or why it isn't?  If it is, what's a good place for me to keep on looking?</p>\n\n<hr>\n\n<p>Alternatively, in my actual application, I don't even really need to use <code>FreeT</code>...I can just use <code>Free</code>; that is, have <code>Interactive</code> be just a monad and not just a monad transformer, and have</p>\n\n<pre><code>runInteractive :: Monad m =&gt; (p -&gt; m r) -&gt; Interactive p r a -&gt; m a\nrunInteractive _ (Pure x) = return x\nrunInteractive prompt (Free (Interact p f) = do\n    response &lt;- prompt p\n    runInteractive prompt (f response)\n</code></pre>\n\n<p>If something is possible for this case and not for the general FreeT case, I would also be happy :)</p>\n"}]