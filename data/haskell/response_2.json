[{"tags": ["date", "haskell", "internationalization"], "answers": [{"comments": [{"owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "edited": false, "score": 1, "creation_date": 1421910571, "post_id": 28077687, "comment_id": 44544094, "body": "The problem with spawning date processes is even worse, since it seems to only work with the GNU date version. (it fails on mac)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "edited": false, "score": 1, "creation_date": 1421945121, "post_id": 28077687, "comment_id": 44564450, "body": "@Kritzefitz It really needs to be rewritten, then. You can try to write the relevant C bindings (likely just one function), or see if some other package has a better locale handling -- I did not find anything, though."}, {"owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "edited": false, "score": 0, "creation_date": 1421997058, "post_id": 28077687, "comment_id": 44584150, "body": "Well I saw that C has <code>strftime</code> which has the format item <code>%D</code>, which formats the date according to the current locale. haskells <code>format</code> has the same format item, but it formats the date according to the given <code>TImeLocale</code>. I didn&#39;t find a C function to get the current format."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1421878057, "last_edit_date": 1421878057, "creation_date": 1421877745, "answer_id": 28077687, "question_id": 28077322, "link": "https://stackoverflow.com/questions/28077322/getting-the-date-format-for-the-current-locale/28077687#28077687", "title": "Getting the date format for the current locale", "body": "<pre><code>System.CurrentLocale.currentLocale :: IO TimeLocale\n</code></pre>\n\n<p>from package <a href=\"http://hackage.haskell.org/package/current-locale\" rel=\"nofollow\">current-locale</a>\nlooks suitable.</p>\n\n<p>I did not test it. Looking at its source code, it should work. I actually do not like it very much since underneath it spawns <em>four</em> <code>date</code> subprocesses (!), which is rather overkill for this simple task, IMHO.</p>\n\n<p>Probably it can be rewritten to use some C or POSIX function instead.</p>\n"}], "owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 1, "accepted_answer_id": 28077687, "answer_count": 1, "score": 6, "last_activity_date": 1421878057, "creation_date": 1421876262, "question_id": 28077322, "link": "https://stackoverflow.com/questions/28077322/getting-the-date-format-for-the-current-locale", "title": "Getting the date format for the current locale", "body": "<p>When I first stumbled across the constant <code>defaultTimeLocale</code> in <code>System.Locale</code>, I supposed it should contain the default TimeLocale for the current locale.</p>\n\n<p>After some trying around, I realized that it always contains the same constants and looking at the source code of <code>System.Locale</code> quickly revealed that it's in fact only a constant. (Later I realized that the type also tells me that. Since <code>defaultTimeLocale</code> isn't an <code>IO</code> value and doesn't take any arguments it <em>has</em> to be constant.)</p>\n\n<p>What is the way in Haskell to get the current <code>TimeLocale</code> with respect to the current locale?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1421864125, "post_id": 28073986, "comment_id": 44527367, "body": "In the future please format your code so others can read it more easily.  Also, are you just asking us to interpret your code?  Why can&#39;t you just copy and paste each of your ten evaluations into an interpreter like GHCi and see the answer for yourself?"}, {"owner": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "edited": false, "score": 0, "creation_date": 1421864446, "post_id": 28073986, "comment_id": 44527530, "body": "there are literally infinitely many ways to represent even <code>first_threes</code>"}, {"owner": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "edited": false, "score": 0, "creation_date": 1421864473, "post_id": 28073986, "comment_id": 44527543, "body": "also there is stuff like <code>4+5</code> which is also the same as <code>my_sum (my_take 5 first_threes)</code> and a valid substitution for it. You will have to be a bit more precise"}, {"owner": {"reputation": 1, "user_id": 4475073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b53f5335c14234a940c8e20c6beea58a?s=128&d=identicon&r=PG", "display_name": "Kamran", "link": "https://stackoverflow.com/users/4475073/kamran"}, "reply_to_user": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "edited": false, "score": 0, "creation_date": 1421865227, "post_id": 28073986, "comment_id": 44527893, "body": "@NiklasB. I have updated the question it should more precise and understandable."}, {"owner": {"reputation": 1, "user_id": 4475073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b53f5335c14234a940c8e20c6beea58a?s=128&d=identicon&r=PG", "display_name": "Kamran", "link": "https://stackoverflow.com/users/4475073/kamran"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1421865245, "post_id": 28073986, "comment_id": 44527907, "body": "@ThomasM.DuBuisson I have updated the question it should more precise and understandable."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1421867624, "post_id": 28073986, "comment_id": 44529141, "body": "First few steps probably go something like this: <code>sum (take 5 threes)</code> -&gt; <code>sum (take 5 (1:2:3:threes))</code> -&gt; <code>sum (1 : take 4 (2:3:threes))</code> -&gt; <code>1 + sum (take 4 (2:3:threes))</code> -&gt; <code>1 + sum (2 : take 3 (3:threes))</code>. Notice how I&#39;ve reduced the top-most node that can be reduced at every step. This is probably what you mean by &quot;Lazy evaluation&quot;."}, {"owner": {"reputation": 1, "user_id": 4475073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b53f5335c14234a940c8e20c6beea58a?s=128&d=identicon&r=PG", "display_name": "Kamran", "link": "https://stackoverflow.com/users/4475073/kamran"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1421877350, "post_id": 28073986, "comment_id": 44534077, "body": "@user2407038 is this a potential step 1 + 2 + my_sum (my_take 3 (3:first_threes)) ?"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 4475073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b53f5335c14234a940c8e20c6beea58a?s=128&d=identicon&r=PG", "display_name": "Kamran", "link": "https://stackoverflow.com/users/4475073/kamran"}, "edited": false, "score": 0, "creation_date": 1421947292, "post_id": 28079867, "comment_id": 44565715, "body": "@Kamran Are you kidding? You don&#39;t know how to add, or... what?"}], "tags": [], "owner": {"reputation": 186, "user_id": 2259718, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25c8ea8da9371a836b7853f57ced3129?s=128&d=identicon&r=PG", "display_name": "Samvel Truzyan", "link": "https://stackoverflow.com/users/2259718/samvel-truzyan"}, "is_accepted": false, "score": 0, "last_activity_date": 1421889767, "creation_date": 1421889767, "answer_id": 28079867, "question_id": 28073986, "link": "https://stackoverflow.com/questions/28073986/haskell-lazy-evaluation-and-rewriting/28079867#28079867", "title": "Haskell Lazy Evaluation and Rewriting", "body": "<pre><code>-- original expression\nsum (take 5 first_threes)\n\n-- (substitution) apply `take 5 first_threes` to `sum` \ncase take 5 first_threes of\n  [] -&gt; 0\n  (x : xs) -&gt; x + sum xs\n\n-- pattern matching force evaluation of the first cons constructor so\n-- we need eval `take 5 first_threes` first\n\n-- apply `first_threes` to `take n` (substitution)\n(\\ n -&gt; case n of\n  0 -&gt; [] \n  _ -&gt; case first_trees of \n         _ -&gt; []\n         (x : xs) -&gt; x : take (n - 1) xs) 5\n\n-- apply 5 to the lambda (substitution)\ncase 5 of\n  0 -&gt; [] \n  _ -&gt; case first_trees of \n         _ -&gt; []\n         (x : xs) -&gt; x : take (5 - 1) xs\n\n-- 5 is already in normal form, after case analysis we will have\ncase first_trees of \n  _ -&gt; []\n  (x : xs) -&gt; x : take (5 - 1) xs\n\n-- pattern matching again (see above)\ncase 1 : 2 : 3 : first_threes of\n  _ -&gt; []\n  (x : xs) -&gt; x : take (5 - 1) xs\n\n-- after case analysis (?) we will have\n1 : take (5 - 1) (2 : 3 : first_threes)\n\n-- now we return back to our original expression\ncase 1 : take (5 - 1) (2 : 3 : first_threes) of\n  [] -&gt; 0\n  (x : xs) -&gt; x + sum xs\n\n-- after case analysis we will have\n1 + sum (take (5 - 1) (2 : 3 : first_threes))\n\n-- (+) operator is strict in both args \n-- the first arg is already evaluated, but we also need to evaluate the second\n1 + case take (5 - 1) (2 : 3 : first_threes) of\n      [] -&gt; 0\n      (x : xs) -&gt; x + sum xs\n\n-- and so on...\n\n-- in the end we will get\n1 + (2 + (3 + (1 + (2 + (0)))))\n-- which is evaluated in reverse order (starting from the `0`)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "is_accepted": false, "score": 1, "last_activity_date": 1421907362, "creation_date": 1421907362, "answer_id": 28082336, "question_id": 28073986, "link": "https://stackoverflow.com/questions/28073986/haskell-lazy-evaluation-and-rewriting/28082336#28082336", "title": "Haskell Lazy Evaluation and Rewriting", "body": "<p>I think this starts what your teacher wants to see</p>\n\n<pre><code>my_sum (my_take 5 first_threes)\n-- th.1\nmy_sum (my_take 5 (1:2:3:first_threes))\n-- t.2\nmy_sum (1 : my_take 4 (2:3:first_threes))\n-- s.2\n1 + my_sum (my_take 4 (2:3:first_threes))\n-- continue yourself\n</code></pre>\n\n<p>A word on nomenclature: Check whether you have to work through <em>solutions</em>. I gave you a few <em>rewrites</em>. In every step you use one of the equalities to rewrite your term. The comments indicate which on I used for rewrite.. </p>\n"}], "owner": {"reputation": 1, "user_id": 4475073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b53f5335c14234a940c8e20c6beea58a?s=128&d=identicon&r=PG", "display_name": "Kamran", "link": "https://stackoverflow.com/users/4475073/kamran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1421907362, "creation_date": 1421863852, "last_edit_date": 1421865027, "question_id": 28073986, "link": "https://stackoverflow.com/questions/28073986/haskell-lazy-evaluation-and-rewriting", "title": "Haskell Lazy Evaluation and Rewriting", "body": "<p>Function Definitions:</p>\n\n<pre><code>first_threes :: [Int]                     -- first three numbers repeated\nfirst_threes = 1:2:3:first_threes         -- th.1\n\ntake :: Int -&gt; [a] -&gt; [a]                 -- take\ntake 0 _ = []                             -- t.1\ntake n (x:xs) = x : (take (n - 1) xs)     -- t.2\n\nsum :: [Int] -&gt; Int                       -- summation of an Int list\nsum [] = 0                                -- s.1\nsum (x:xs) = x + (sum xs)                 -- s.2\n</code></pre>\n\n<p>I need to rewrite the statement below by using the definitions of the functions above. I need to obtain the answer 9. I need to justify each solution using 'Lazy Evaluation'.</p>\n\n<pre><code>Hugs_Main&gt; my sum (my take 5 first_threes)\n9\n</code></pre>\n\n<p>I am trying to work out 20 solutions which obtain 9 as the answer. Below are my first 10 solutions but I cannot think of anything else. Can anyone help out?</p>\n\n<p>My first 10 solutions:</p>\n\n<pre><code>my_sum (my_take 5 first_threes)\nmy_sum (my_take 5 (1:2:3:first_threes))\nmy_sum (my_take 5 (1:2:first_threes))\nmy_sum (my_take 5 (2:first_threes))\nmy_sum (my_take 4 (3:first_threes))\nmy_sum (1:2:3:(my_take 2 (first_threes)))\nmy_sum (1:2:(my_take 3 (first_threes)))\nmy_sum (1:(2:my_take 3 (3:first_threes)))\nmy_sum (1:(my_take 4 (2:3:first_threes)))\nmy_sum (1:(my_take 4 (2:first_threes)))\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "ghcjs"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1421861258, "creation_date": 1421861258, "answer_id": 28073295, "question_id": 28071045, "link": "https://stackoverflow.com/questions/28071045/how-to-use-two-different-compilers-for-different-targets-in-a-cabal-file/28073295#28073295", "title": "How to use two different compilers for different targets in a .cabal file?", "body": "<p>The compiler to use is determined during the configure step (or during an install step's implicit configure step, which does not share configuration options with a previous configure step). It is also determined by the entity building the package and cannot be influenced by the person writing the package. Probably what happened to you is that a previous cabal build implicitly invoked the configure step and chose a compiler; future builds will keep a previous choice of compiler over one stuck in your global configuration file. You can countermand that by simply manually running <code>cabal configure</code> again.</p>\n\n<p>It is possible to cause a build to fail with the wrong implementation, e.g.</p>\n\n<pre><code>library\n    if impl(ghc)\n        buildable: False\n</code></pre>\n\n<p>will prevent cabal from trying to build the package using GHC. However, this isn't really useful for building separate parts of a package with separate compilers, as cabal will refuse to install a package unless it can build the whole thing with a single compiler.</p>\n\n<p>Probably the best way forward is to make separate packages for things that should be built by separate compilers.</p>\n"}], "owner": {"reputation": 7656, "user_id": 823, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ab7c8cd9bfc94ab2eae4a39e229a712e?s=128&d=identicon&r=PG", "display_name": "ryantm", "link": "https://stackoverflow.com/users/823/ryantm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 2, "accepted_answer_id": 28073295, "answer_count": 1, "score": 5, "last_activity_date": 1421861258, "creation_date": 1421854551, "question_id": 28071045, "link": "https://stackoverflow.com/questions/28071045/how-to-use-two-different-compilers-for-different-targets-in-a-cabal-file", "title": "How to use two different compilers for different targets in a .cabal file?", "body": "<p>When I run <code>cabal build</code> it uses some Haskell compiler to build the executables and/or test-suites in my .cabal file.</p>\n\n<p>Can I control which compiler is used for the different targets? Ideally, I would like to have separate build targets that use ghc and ghcjs in the same <code>.cabal</code> file. It seems to me that someone might want to use ghc and hugs or two version of ghc in the same project. Is this currently possible?</p>\n\n<p>Also, how does cabal decide what compiler to use when running <code>cabal build</code>? I saw there is a compiler option in my <code>~/.cabal/config</code> file but changing it from <code>ghc</code> to <code>ghcjs</code> and uncommenting it, did not seem to change what <code>cabal build</code> does.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1421859756, "post_id": 28069938, "comment_id": 44524994, "body": "SPJ presented a lecture once in which he explained what constraints compile to. <a href=\"https://www.youtube.com/watch?v=6COvD8oynmI\" rel=\"nofollow noreferrer\">youtube.com/watch?v=6COvD8oynmI</a> - In short, they&#39;re function arguments in their own."}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1421855129, "post_id": 28071137, "comment_id": 44521768, "body": "Although the first should be a parser error if one follows the 2010 grammar rigorously. Then, on the other hand, <a href=\"https://github.com/ghc/ghc/blob/master/compiler/parser/Parser.y\" rel=\"nofollow noreferrer\">GHC&#39;s parser</a> is full of things I can&#39;t comprehend."}, {"owner": {"reputation": 12035, "user_id": 603094, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/325af9a946cb4337c6640f0e95044be1?s=128&d=identicon&r=PG", "display_name": "kirelagin", "link": "https://stackoverflow.com/users/603094/kirelagin"}, "edited": false, "score": 0, "creation_date": 1422881654, "post_id": 28071137, "comment_id": 44910623, "body": "FTR, here is the relevant part of the parser: <a href=\"https://github.com/ghc/ghc/blob/851ed7211fb18fea938be84c99b6389f6762b30d/compiler/parser/Parser.y#L1082\" rel=\"nofollow noreferrer\">github.com/ghc/ghc/blob/&hellip;</a>"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 7, "last_activity_date": 1421855815, "last_edit_date": 1421855815, "creation_date": 1421854813, "answer_id": 28071137, "question_id": 28069938, "link": "https://stackoverflow.com/questions/28069938/haskell-multiple-contexts-currying/28071137#28071137", "title": "Haskell Multiple Contexts - currying?", "body": "<p>The two versions are the same. Constraints and <code>forall</code>-s are floated out to the top of the scope when they are not already there. For example, the following definitions are valid:</p>\n\n<pre><code>foo :: a -&gt; a -&gt; Num a =&gt; a\nfoo = (+)\n\nbar :: a -&gt; forall b. b -&gt; a\nbar = const\n</code></pre>\n\n<p>But <code>:t foo</code> prints <code>Num a =&gt; a -&gt; a -&gt; a</code> and <code>:t bar</code> prints <code>a -&gt; b -&gt; a</code> (which is equivalent to <code>forall a b. a -&gt; b -&gt; a</code>). </p>\n\n<p>GHC doesn't support polymorphic return types, that's why the constraints and quantifiers are floated out. I guess it could have been also a valid design choice for GHC to throw errors.</p>\n"}], "owner": {"reputation": 949, "user_id": 1017252, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/90e3d67b15c2573bfc3821746de04dc0?s=128&d=identicon&r=PG", "display_name": "Omari Norman", "link": "https://stackoverflow.com/users/1017252/omari-norman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 518, "favorite_count": 1, "accepted_answer_id": 28071137, "answer_count": 1, "score": 12, "last_activity_date": 1421855815, "creation_date": 1421851414, "last_edit_date": 1495541970, "question_id": 28069938, "link": "https://stackoverflow.com/questions/28069938/haskell-multiple-contexts-currying", "title": "Haskell Multiple Contexts - currying?", "body": "<p>When writing contexts on a type signature, ordinarily I would do something like</p>\n\n<pre><code>f :: (Enum a, Ord a) =&gt; a -&gt; a\n</code></pre>\n\n<p>But through sheer dumb luck I found that this compiles and seems to work identically, at least on GHC 7.8:</p>\n\n<pre><code>f :: Enum a =&gt; Ord a =&gt; a -&gt; a\n</code></pre>\n\n<p>What are the theoretical or practical differences between the two?  Is the second one less orthodox?  The <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-620004\" rel=\"nofollow noreferrer\">Haskell report</a> seems to make no mention of the second form, and I've never seen it used anywhere.  <a href=\"https://stackoverflow.com/questions/11093847/haskell-type-signature-with-multiple-class-constraints\">Related question</a>.</p>\n"}, {"tags": ["haskell", "tuples", "ord"], "comments": [{"owner": {"reputation": 1089, "user_id": 3243497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3bece7a1639b7122d7b2de6b9f86bdde?s=128&d=identicon&r=PG", "display_name": "betaveros", "link": "https://stackoverflow.com/users/3243497/betaveros"}, "edited": false, "score": 2, "creation_date": 1421848079, "post_id": 28068714, "comment_id": 44517028, "body": "Can you define &quot;combined order&quot; more rigorously? How does (a,d) compare to (b,c), for instance?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1421848457, "post_id": 28068714, "comment_id": 44517269, "body": "<code>Ord</code> seems insufficient for this. I&#39;d add as another argument a quantifying function <code>(a,a) -&gt; Int</code> that &quot;weights&quot; the pair, and sort according to that. Also see if you can require <code>Enum a</code> so that pairs can be converted more easily."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1421848851, "post_id": 28068714, "comment_id": 44517525, "body": "Isn&#39;t <code>sortBy :: (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]</code> sufficient for you?"}, {"owner": {"reputation": 131, "user_id": 1430987, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/c8SNk.jpg?s=128&g=1", "display_name": "J.Swersey", "link": "https://stackoverflow.com/users/1430987/j-swersey"}, "reply_to_user": {"reputation": 1089, "user_id": 3243497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3bece7a1639b7122d7b2de6b9f86bdde?s=128&d=identicon&r=PG", "display_name": "betaveros", "link": "https://stackoverflow.com/users/3243497/betaveros"}, "edited": false, "score": 0, "creation_date": 1421848885, "post_id": 28068714, "comment_id": 44517549, "body": "@betaveros: (a,d) would be equal to (b,c). How, exactly, they&#39;re sorted doesn&#39;t matter so much as that I have a robust way of sorting them where the &quot;lighter&quot; elements rise to the top. If one list is abcd, and another is abcde, I have be sure that nothing with e shows up before everything from abcd, and that the order is consistent."}, {"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 0, "creation_date": 1421848979, "post_id": 28068714, "comment_id": 44517616, "body": "Sorting is the wrong way to go for your task. The right way is to think about the order in which you&#39;re iterating over the pairs."}, {"owner": {"reputation": 131, "user_id": 1430987, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/c8SNk.jpg?s=128&g=1", "display_name": "J.Swersey", "link": "https://stackoverflow.com/users/1430987/j-swersey"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421848992, "post_id": 28068714, "comment_id": 44517625, "body": "@chi: unfortunately, this is a homework assignment with rigid requirements that are, quite frankly, <i>kinda</i> stupid. That quantifying function is a good idea, but I have no idea how to implement it for arbitrary classes that implement ord."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1421849469, "post_id": 28068714, "comment_id": 44517934, "body": "@JonahStephenSwersey You write, in your comment, <i>(a,d) would be equal to (b,c)</i>. Could you explain why? What exactly do you use to compare two tuples, in the general case? It seems to me that the answer to your question hinges in this."}, {"owner": {"reputation": 131, "user_id": 1430987, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/c8SNk.jpg?s=128&g=1", "display_name": "J.Swersey", "link": "https://stackoverflow.com/users/1430987/j-swersey"}, "reply_to_user": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 0, "creation_date": 1421849549, "post_id": 28068714, "comment_id": 44517983, "body": "@interjay: I&#39;m not sure how else to iterate over them. Like, for [1,3,6,8,9], I need to have the 1 to combine with 3 and 6, and then I need the 3 to combine with 6, and then I need the 1 again to combine with the 8, and I&#39;m honestly not sure how to handle that case at all. Maybe iterating backwards..."}, {"owner": {"reputation": 1089, "user_id": 3243497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3bece7a1639b7122d7b2de6b9f86bdde?s=128&d=identicon&r=PG", "display_name": "betaveros", "link": "https://stackoverflow.com/users/3243497/betaveros"}, "edited": false, "score": 0, "creation_date": 1421849796, "post_id": 28068714, "comment_id": 44518150, "body": "If you want &quot;nothing with e shows up before everything from abcd&quot; and don&#39;t want to require <code>Enum</code>, might <code>sortBy (\\(x1,x2) (y1,y2) -&gt; (max x1 x2, min x1 x2) `compare` (max y1 y2, min y1 y2))</code> work?"}, {"owner": {"reputation": 131, "user_id": 1430987, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/c8SNk.jpg?s=128&g=1", "display_name": "J.Swersey", "link": "https://stackoverflow.com/users/1430987/j-swersey"}, "edited": false, "score": 0, "creation_date": 1421849953, "post_id": 28068714, "comment_id": 44518248, "body": "Aaaand I just realized that this wouldn&#39;t solve the problem at all. Crap."}, {"owner": {"reputation": 131, "user_id": 1430987, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/c8SNk.jpg?s=128&g=1", "display_name": "J.Swersey", "link": "https://stackoverflow.com/users/1430987/j-swersey"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1421850193, "post_id": 28068714, "comment_id": 44518397, "body": "@Jubobs and suddenly I&#39;m wondering if &quot;Distance&quot; is even a coherent concept when talking about a list of elements who are merely ordered, if the order between them does not imply an equal distance. If it isn&#39;t, then there is no valid answer."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1421852660, "creation_date": 1421852660, "answer_id": 28070373, "question_id": 28068714, "link": "https://stackoverflow.com/questions/28068714/ordering-non-numeric-tuples-by-total-value-distance-in-haskell/28070373#28070373", "title": "Ordering non-numeric tuples by total value (distance?) in Haskell", "body": "<p>Such an ordering can not exist. Not just in Haskell, but anywhere &ndash; it's mathematically impossible!</p>\n\n<p>By strict-ordering tuples, you're basically creating a mapping between a two-dimensional domain and a one-dimensional one. This needs to be bijective to preserve the order axioms. Then you talk about distance, that is in this case a topological property and always works analogous to the problem of mapping the real line \u211d to the 2D-plane \u211d<sup>2</sup>.\n<br>Such bijections <a href=\"https://en.wikipedia.org/wiki/Space-filling_curve\" rel=\"nofollow\">exist</a>, but it's never possible that both the mapping and its inverse are continuous (which would be necessary to preserve distances in any consistent sense).</p>\n\n<p>So what you want is not achievable.</p>\n"}], "owner": {"reputation": 131, "user_id": 1430987, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/c8SNk.jpg?s=128&g=1", "display_name": "J.Swersey", "link": "https://stackoverflow.com/users/1430987/j-swersey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1421852660, "creation_date": 1421847710, "last_edit_date": 1421850318, "question_id": 28068714, "link": "https://stackoverflow.com/questions/28068714/ordering-non-numeric-tuples-by-total-value-distance-in-haskell", "title": "Ordering non-numeric tuples by total value (distance?) in Haskell", "body": "<p>EDIT: I just realized that this won't solve the problem at all, except for lists with every entry in the set (i.e. getting a comparative value for <code>(a,e)</code> and <code>(b,d)</code> won't help me at all if the list doesn't contain e, but does contain f). Derp. That said, the question of distance comparisons for ordered but non-numeric sets in Haskell is still IMO interesting, so...</p>\n\n<p>I have to write a function </p>\n\n<pre><code>pairs :: Ord a =&gt; [a] -&gt; [(a,a)]\n</code></pre>\n\n<p>which returns all pairs (x<sub>i</sub>, x<sub>j</sub>) from a list where x<sub>i</sub> &lt; x<sub>j</sub> and i &lt; j. </p>\n\n<p>That's pretty straightforward with list comprehensions. Now, I need it sorted, and I need it sorted by the \"order\" of the tuples. That is, the combined order - (a,z) needs to come a long way after (b,c). For integers, this is easy - add x<sub>i</sub> to x<sub>j</sub> and use that for the comparison. </p>\n\n<p>However, this is over <code>Ord</code>, so this function has to take obnoxious things like chars, and in Haskell, all I know how to get is <code>GT</code>, <code>LT</code>, or <code>EQ</code> - not how much <code>GT</code>. Is there a way to get Haskell to say</p>\n\n<blockquote>\n  <p><code>Z</code> is 25 Greater Than <code>A</code></p>\n</blockquote>\n\n<p>or something like that? Or any other ideas on how to sort this? </p>\n\n<p>(The actual task involves fulfilling the predicate that for any list <code>xs</code> that is a prefix of another list <code>ys</code>, <code>pairs xs</code> is a prefix of <code>pairs ys</code>. I'm simply under the impression that sorting the list after producing it is probably the way to go. EDIT2: solved it by iterating the list backwards, for those wondering.)</p>\n"}, {"tags": ["haskell", "yesod", "persistent", "scotty"], "answers": [{"comments": [{"owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "edited": false, "score": 0, "creation_date": 1461757093, "post_id": 28079893, "comment_id": 61341527, "body": "@michael-snoyman: What if the key has some type other than <code>Int64</code>?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1461771576, "post_id": 28079893, "comment_id": 61353190, "body": "I&#39;m actually not familiar with the more flexible primary key mechanism in persistent, so I can&#39;t advise on how to handle that case."}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 4, "creation_date": 1521590479, "post_id": 28079893, "comment_id": 85793916, "body": "For the next person googling: the quasiquoter creates a declaration of the form <code>newtype Key TypeName = TypeNameKey {unTypeNameKey :: Int32 }</code> from the quote <code>persistLowerCase| TypeName Id Int32</code>"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 15, "last_activity_date": 1421889954, "creation_date": 1421889954, "answer_id": 28079893, "question_id": 28068447, "link": "https://stackoverflow.com/questions/28068447/how-to-fetch-entity-by-int-when-a-key-is-expected-in-the-haskell-persistent/28079893#28079893", "title": "How to fetch entity by `Int` when a `Key` is expected in the Haskell persistent library?", "body": "<p>You can use <a href=\"http://www.stackage.org/haddock/lts-1.2/persistent-2.1.1.4/Database-Persist-Sql.html#v:toSqlKey\">toSqlKey</a> for that.</p>\n"}], "owner": {"reputation": 1362, "user_id": 1349525, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/LXJ8Y.jpg?s=128&g=1", "display_name": "Dark_Daiver", "link": "https://stackoverflow.com/users/1349525/dark-daiver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1842, "favorite_count": 2, "accepted_answer_id": 28079893, "answer_count": 1, "score": 11, "last_activity_date": 1576351183, "creation_date": 1421846874, "last_edit_date": 1576351183, "question_id": 28068447, "link": "https://stackoverflow.com/questions/28068447/how-to-fetch-entity-by-int-when-a-key-is-expected-in-the-haskell-persistent", "title": "How to fetch entity by `Int` when a `Key` is expected in the Haskell persistent library?", "body": "<p>I use Persistent orm with scotty web framework.</p>\n\n<p>I want to get value from db by id. These id are coming to me from GET request</p>\n\n<p>There are \"get\" function that takes \"Key Entity\" variable and returns \"Maybe Entity\".</p>\n\n<p>I use following code to get value from db</p>\n\n<pre><code>k &lt;- keyFromValues $ [(PersistInt64 myOwnIntVarFromRequest)]\ncase k of\n    Left _ -&gt; {-some processing-}\n    Right x -&gt; do\n    t &lt;- liftIO . runDb $ get (x::Key Post) --Post is one of my models\n    case t of\n        Nothing -&gt; {-processing-}\n        Just x -&gt; {-processing-}\n</code></pre>\n\n<p>These code is extremly ugly. But i don't know how to do it better</p>\n\n<p>So my question is how obtain variable of type \"Key Entity\" without calling keyFromValues.</p>\n\n<p>PS Sorry for my poor English</p>\n"}, {"tags": ["haskell", "types", "existential-type"], "comments": [{"owner": {"reputation": 1593, "user_id": 1829442, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f1b88b650cc161e532273962f4017f75?s=128&d=identicon&r=PG", "display_name": "idontgetoutmuch", "link": "https://stackoverflow.com/users/1829442/idontgetoutmuch"}, "edited": false, "score": 0, "creation_date": 1421932522, "post_id": 28068129, "comment_id": 44555906, "body": "You know you can already do this using hmatrix? <a href=\"https://hackage.haskell.org/package/hmatrix-0.16.1.3/docs/Numeric-LinearAlgebra-Static.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/hmatrix-0.16.1.3/docs/&hellip;</a>. And you get the full power of LAPACK behind it."}], "answers": [{"tags": [], "owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "is_accepted": true, "score": 3, "last_activity_date": 1421846644, "creation_date": 1421846644, "answer_id": 28068368, "question_id": 28068129, "link": "https://stackoverflow.com/questions/28068129/how-to-use-linear-v-to-write-static-type-checked-matrix-operations-haskell/28068368#28068368", "title": "How to use Linear.V to write static type checked matrix operations (Haskell)?", "body": "<p>This is a little tricky to ask without a bit more knowledge of what exactly you want to do, but I'll take a stab. <code>Linear.V</code> gives you <em>n</em>-dimensional vectors for any <em>n</em>. In <code>linear</code>, matrices are defined as vectors-of-vectors - <code>Linear.Matrix</code> defines the operations on such values. <code>Linear.Matrix</code> works over various sizes of matrix by being parameterized over two functors, and <code>Linear.V</code> is indeed a <code>Functor</code> so we're good to use those operations.</p>\n\n<p>The following boring example shows how you could work with <code>Linear.V</code>:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\nimport Linear\nimport Linear.V\nimport Data.Vector\n\nidentity :: V 2 (V 2 Float)\nidentity = V (fromList [ V (fromList [1, 0]), V (fromList [0, 1]) ])\n\ncalculation :: V 2 (V 2 Float)\ncalculation = identity !*! identity\n</code></pre>\n\n<p>It's boring in that it just calculates the product of two identity matrices, but it should give you an idea how to put these pieces together. I'm using GHC 7.6+ type literals to specify that <code>identity</code> is a <em>2x2</em> matrix.</p>\n\n<p>Note that using the <code>V</code> constructor is somewhat dangerous - it allows you to \"lie\" about the size of the vector. For example, if you do the following:</p>\n\n<pre><code>identity :: V 2 (V 2 Float)\nidentity = V (fromList [ V (fromList [1, 0]) ])\n</code></pre>\n\n<p>things are likely to go <em>very</em> wrong. It's safer to use <code>fromVector</code>, or perhaps <code>tabulate</code> (<code>tabulate</code> uses the representation of <code>V</code> - which is basically a function from element index to its value).</p>\n"}], "owner": {"reputation": 3333, "user_id": 3859566, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a7c4c1c9ad9bd41f49004d32884bc680?s=128&d=identicon&r=PG&f=1", "display_name": "yong", "link": "https://stackoverflow.com/users/3859566/yong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 28068368, "answer_count": 1, "score": 2, "last_activity_date": 1421846644, "creation_date": 1421845935, "question_id": 28068129, "link": "https://stackoverflow.com/questions/28068129/how-to-use-linear-v-to-write-static-type-checked-matrix-operations-haskell", "title": "How to use Linear.V to write static type checked matrix operations (Haskell)?", "body": "<p>I'm interested in using <code>Linear.V</code> from the <a href=\"https://hackage.haskell.org/package/linear-1.15.5/docs/Linear-V.html\" rel=\"nofollow\" ><code>Linear</code> library</a> to write matrix operations on sizes that are known at compile time. However, I'm not sure how to use this library. Where can I find more references on how to use it?</p>\n"}, {"tags": ["haskell", "error-handling", "monad-transformers"], "comments": [{"owner": {"reputation": 5412, "user_id": 1626632, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9a63a74d81c3e3abfb4a1ecb56fd3eff?s=128&d=identicon&r=PG", "display_name": "Helmut Grohne", "link": "https://stackoverflow.com/users/1626632/helmut-grohne"}, "edited": false, "score": 0, "creation_date": 1421853868, "post_id": 28068091, "comment_id": 44520770, "body": "I suspect that some <code>(m a -&gt; n b) -&gt; t m a -&gt; t n b</code> like <code>mapReaderT</code> is required to achieve the goal."}], "owner": {"reputation": 5412, "user_id": 1626632, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9a63a74d81c3e3abfb4a1ecb56fd3eff?s=128&d=identicon&r=PG", "display_name": "Helmut Grohne", "link": "https://stackoverflow.com/users/1626632/helmut-grohne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1422351456, "creation_date": 1421845859, "last_edit_date": 1422351456, "question_id": 28068091, "link": "https://stackoverflow.com/questions/28068091/safe-catcherror", "title": "Safe catchError?", "body": "<p>When writing code with <code>MonadError</code>, a <code>catchError</code> can turn a failing computation into a successful one. Unfortunately, the given handler function can fail itself, so there are no guarantees as to whether the resulting computation is successful. I was considering to escape the <code>MonadError</code>:</p>\n\n<pre><code> {-# LANGUAGE RankNTypes #-}\n safeCatchError' :: Monad m =&gt;\n                    (forall e n. (Error e, MonadError e n) =&gt; (n a, e -&gt; m a)) -&gt;\n                    m a\n safeCatchError' (c, h) = either h return (c `asTypeOf` Left \"e = String\")\n</code></pre>\n\n<p>This version does not deal with transformer stacks though. So what about the following extension?</p>\n\n<pre><code>safeCatchError :: (MonadTrans t, Monad m) =&gt;\n                  (forall e n. (Error e, MonadError e n) =&gt; (t n a, e -&gt; t m a)) -&gt;\n                  t m a\n</code></pre>\n\n<p>Can this function be defined reasonably? If yes, how? If no, why not? What extra assumptions are necessary? It can be defined for <code>t = ReaderT a</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1421841771, "post_id": 28066762, "comment_id": 44513261, "body": "List are not sets, I suspect that&#39;s the cause of confusion here. Powerset as such is perfectly deterministic, and list operations are deterministic too, but since there&#39;s no 1:1 correspondence between lists and sets represented by them, a &quot;powerset&quot; implementation by lists isn&#39;t quite well-specified."}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 9, "creation_date": 1421842781, "post_id": 28066762, "comment_id": 44513824, "body": "Who says it&#39;s non-deterministic? I ask because either they are wrong or you have misunderstood their intention. We commonly say the list monad allows us to model non-determinism \u2013 that doesn&#39;t mean the result of our computations are non-deterministic all the time \u2013 quite the opposite. Lists allow us to model non-determinism deterministically. By representing a single value with a list of possible values, and treating it as sort of a single value, we can pretend we are working with single values when in fact we are working with all possible combinations of values."}], "answers": [{"tags": [], "owner": {"reputation": 3961, "user_id": 176015, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/398c96f77ec9b99b1e8122214227305d?s=128&d=identicon&r=PG", "display_name": "svenningsson", "link": "https://stackoverflow.com/users/176015/svenningsson"}, "is_accepted": false, "score": 12, "last_activity_date": 1421843975, "creation_date": 1421843975, "answer_id": 28067485, "question_id": 28066762, "link": "https://stackoverflow.com/questions/28066762/why-is-power-set-considered-non-deterministic-example-in-haskell/28067485#28067485", "title": "Why is power set considered non-deterministic example in haskell?", "body": "<p>The reason why the term non-determinism is sometimes used when talking about the list monad is because of denotational semantics. When giving semantics to non-deterministic languages it is common to use the power domain. This domain can be approximated in Haskell using lists. Since the use of monads in Haskell comes from their use in denotational semantics, some of the terms used in that field have been carried over even though they may or may not make sense in their new context.</p>\n"}], "owner": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1421862240, "creation_date": 1421841635, "last_edit_date": 1421862240, "question_id": 28066762, "link": "https://stackoverflow.com/questions/28066762/why-is-power-set-considered-non-deterministic-example-in-haskell", "title": "Why is power set considered non-deterministic example in haskell?", "body": "<p>Given a set [1,2,3] the power set is unique. Why do we say it's non deterministic? Consider another example</p>\n\n<pre><code>[1,2] &gt;&gt;= \\n -&gt; ['a','b'] &gt;&gt;= \\ch -&gt; return (n,ch)  \n</code></pre>\n\n<p>Why is this function non-deterministic?</p>\n\n<p>If I consider <code>\\ch -&gt; return (n,ch)</code> as the second function where is the first?</p>\n\n<p>And if the first function is </p>\n\n<pre><code>\\n -&gt; ['a','b'] &gt;&gt;= \\ch -&gt; return (n,ch)  \n</code></pre>\n\n<p>Why is it evaluation from right to left. </p>\n\n<p>Shouldn't it be <code>\\n -&gt; (function)</code>?</p>\n\n<p>And what function is this <code>(['a','b'] &gt;&gt;= \\ch -&gt; return (n,ch))</code>?</p>\n\n<p>If it's left to right It can't evaluate the second <code>\\ch</code> function without using the first part <code>['a','b']</code> which doesn't have to do anything with <code>'n'</code> parameter. </p>\n"}, {"tags": ["haskell", "typeclass", "type-families"], "answers": [{"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 3, "last_activity_date": 1421845197, "creation_date": 1421845197, "answer_id": 28067872, "question_id": 28066534, "link": "https://stackoverflow.com/questions/28066534/using-data-constraint-forall-with-equality-constraints/28067872#28067872", "title": "Using Data.Constraint.Forall with equality constraints", "body": "<p>You can use a class:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, FlexibleContexts #-}\n\nclass (F (f x) ~ g x) =&gt; F'Eq f g x\ninstance (F (f x) ~ g x) =&gt; F'Eq f g x\n\nbar' :: forall f g. (Forall (F'Eq f g)) =&gt; forall a b. f a -&gt; f b\nbar' = helper\n  where\n    helper :: forall a b. f a -&gt; f b\n    helper = case (inst :: Forall (F'Eq f g) :- F'Eq f g a) of\n        Sub Dict -&gt; case (inst :: Forall (F'Eq f g) :- F'Eq f g b) of\n            Sub Dict -&gt; bar\n</code></pre>\n"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 28067872, "answer_count": 1, "score": 4, "last_activity_date": 1421845197, "creation_date": 1421840963, "last_edit_date": 1421842394, "question_id": 28066534, "link": "https://stackoverflow.com/questions/28066534/using-data-constraint-forall-with-equality-constraints", "title": "Using Data.Constraint.Forall with equality constraints", "body": "<p>Let's say I have a function like this:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nclass C a where\n\nfoo :: forall f a b. (C (f a), C (f b)) =&gt; f a -&gt; f b\nfoo = _\n</code></pre>\n\n<p>Now, if I would like to move the scope of <code>a</code> and <code>b</code> to the right of the typeclass constraint in the type of <code>foo</code> (let's say, because I want to use <code>foo</code> to implement a typeclass method that needs to be polymorphic in <code>a</code> and <code>b</code>), it can done with a bit of legwork using <code>Data.Constraint.Forall</code>:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE ConstraintKinds, TypeOperators #-}\nimport Data.Constraint\nimport Data.Constraint.Forall\n\nfoo' :: forall f. (ForallF C f) =&gt; forall a b. f a -&gt; f b\nfoo' = helper\n  where\n    helper :: forall a b. f a -&gt; f b\n    helper = case (instF :: ForallF C f :- C (f a)) of\n        Sub Dict -&gt; case (instF :: ForallF C f :- C (f b)) of\n            Sub Dict -&gt; foo\n</code></pre>\n\n<p>Now, my question is, suppose I change my function to something involving type equalities:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, ScopedTypeVariables #-}\n\ntype family F a :: * -&gt; *\n\nbar :: forall f g a b. (F (f a) ~ g a, F (f b) ~ g b) =&gt; f a -&gt; f b\nbar = _\n</code></pre>\n\n<p>Is there a way to adapt the above technique to this?</p>\n\n<p>Here's what I tried:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, ScopedTypeVariables #-}\n{-# LANGUAGE ConstraintKinds, TypeOperators #-}\nimport Data.Constraint\nimport Data.Constraint.Forall\n\ntype F'Eq f g x = F (f x) ~ g x\n\nbar' :: forall f g. (Forall (F'Eq f g)) =&gt; forall a b. f a -&gt; f b\nbar' = helper\n  where\n    helper :: forall a b. f a -&gt; f b\n    helper = case (inst :: Forall (F'Eq f g) :- F'Eq f g a) of\n        Sub Dict -&gt; case (inst :: Forall (F'Eq f g) :- F'Eq f g b) of\n            Sub Dict -&gt; bar\n</code></pre>\n\n<p>But (unsurprisingly) this fails because of the unsaturated type synonym:</p>\n\n<blockquote>\n  <p>Type synonym <code>\u2018F'Eq\u2019</code> should have 3 arguments, but has been given 2</p>\n  \n  <p>In an expression type signature: <code>Forall (F'Eq f g) :- F'Eq f g a</code></p>\n  \n  <p>In the expression: <code>(inst :: Forall (F'Eq f g) :- F'Eq f g a)</code></p>\n</blockquote>\n"}, {"tags": ["haskell", "gtk2hs"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1421893281, "post_id": 28063969, "comment_id": 44539232, "body": "There should be nothing special about a widget created after the program&#39;s main window is shown compared to one created before it is shown. Just add to or modify the text entry&#39;s handlers once the new widget is available."}], "answers": [{"tags": [], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "is_accepted": true, "score": 0, "last_activity_date": 1422430908, "creation_date": 1422430908, "answer_id": 28187013, "question_id": 28063969, "link": "https://stackoverflow.com/questions/28063969/gtk2hs-widget-interaction/28187013#28187013", "title": "Gtk2Hs : Widget interaction", "body": "<p>I find a solution to my problem : </p>\n\n<ol>\n<li><p>In the main program I create an IORef of a list of actions to perform :</p>\n\n<pre><code>actionsIO &lt;- newIORef [action_to_do_1,action_to_do_2]\n</code></pre></li>\n<li><p>I create my custom combined widget for text entry</p>\n\n<pre><code>ent &lt;- textEntry window canvas state modele parser info actionsIO\n</code></pre>\n\n<p>Inside, I execute the list of actions that way :</p>\n\n<pre><code>actions &lt;- readIORef actionsIO\nsequence_ actions\n</code></pre></li>\n<li><p>I create my treeview</p>\n\n<pre><code>arwin &lt;- arrayWin modele window canvas state info actionsIO\n</code></pre>\n\n<p>Inside, I modify/delete/add actions to the list like this :</p>\n\n<pre><code>let newactions = [new_action_to_do_1,new_action_to_do_2]\nwriteIORef actionsIO newactions\n</code></pre>\n\n<p>These new actions are performed every time a command is validated with the special entry widget.</p></li>\n</ol>\n\n<p>There is probably a \"cleaner\" method to do that, but this one work well and solved my problem completely.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 28187013, "answer_count": 1, "score": 0, "last_activity_date": 1422430908, "creation_date": 1421833560, "last_edit_date": 1421833994, "question_id": 28063969, "link": "https://stackoverflow.com/questions/28063969/gtk2hs-widget-interaction", "title": "Gtk2Hs : Widget interaction", "body": "<p>I'm trying to create a program with Gtk2Hs and Haskell and I wonder whether it is possible to make different widgets communicate with one another.</p>\n\n<p>I have a text entry, which is used to write commands, a drawing area, which draws something when the text entry is validated. These two widgets works together fine.</p>\n\n<p>However, I would like to add an \"optional\" treeview in a different window, which would be updated when all commands in the text entry have been executed (this can take a long time). </p>\n\n<p>As the treeview is \"optional\" and created only afterwards, I can't define callbacks to its update in the text entry definition (like the drawing area).</p>\n\n<p>I would to create a signal (event?) to be emitted when all the operations are done and caught by the treeview to update its data.</p>\n\n<p>My questions are :</p>\n\n<ul>\n<li>Is there a way to do that with Gtk2Hs and Glib?</li>\n<li>Is there a module that could be used to make it (portable to Linux/Windows, if possible)?</li>\n<li>Is there a correct way to make a widget interract/communicate with others?</li>\n</ul>\n\n<p>I'm using GHC 7.4.1 and Gtk2Hs 0.12.3</p>\n"}, {"tags": ["haskell", "type-signature"], "comments": [{"owner": {"reputation": 2134, "user_id": 2623659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1bd33f70a971bf89c7719005d477e2b?s=128&d=identicon&r=PG", "display_name": "ach", "link": "https://stackoverflow.com/users/2623659/ach"}, "edited": false, "score": 0, "creation_date": 1421823270, "post_id": 28061132, "comment_id": 44503560, "body": "Well, <code>!!</code> has the type <code>[a] -&gt; Int -&gt; a</code> (<a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:-33--33-\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.7.0.2/docs/&hellip;</a>); the index is of fixed type <code>Int</code>. Thus, your function must have the type <code>(Integral a) =&gt; Int -&gt; a</code>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1421825696, "post_id": 28061132, "comment_id": 44504577, "body": "Just have ghci tell you what the type signature is with <code>:type p007nthPrime </code>"}], "answers": [{"comments": [{"owner": {"reputation": 1089, "user_id": 3243497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3bece7a1639b7122d7b2de6b9f86bdde?s=128&d=identicon&r=PG", "display_name": "betaveros", "link": "https://stackoverflow.com/users/3243497/betaveros"}, "edited": false, "score": 2, "creation_date": 1421848394, "post_id": 28061275, "comment_id": 44517228, "body": "For indexing with <code>Integer</code>s and other <code>Integral</code> types, Haskell also provides <a href=\"http://hackage.haskell.org/package/base-4.7.0.1/docs/Data-List.html#v:genericIndex\" rel=\"nofollow noreferrer\">genericIndex</a> of type <code>Integral i =&gt; [a] -&gt; i -&gt; a</code>."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 6, "last_activity_date": 1421823357, "creation_date": 1421823357, "answer_id": 28061275, "question_id": 28061132, "link": "https://stackoverflow.com/questions/28061132/type-signature-for-index-in-haskell/28061275#28061275", "title": "Type signature for index in Haskell", "body": "<p>The <code>(!!)</code> list indexing operator only takes <code>Int</code>s, while your <code>primes</code> list contains <code>Integer</code>s, so your signature needs to be</p>\n\n<pre><code>p007nthPrime :: Int -&gt; Integer\n</code></pre>\n\n<p>Both <code>Int</code> and <code>Integer</code> are types of the class <code>Integral</code>, but a single type cannot be both <code>Int</code> and <code>Integer</code>.</p>\n\n<p>If you need the argument to also be <code>Integer</code>, I suggest using the <code>fromIntegral</code> function.</p>\n\n<p>Otherwise, to find out what type signature to give a function/value, a good idea is to use the <code>:t</code> command in GHCi:</p>\n\n<pre><code>*Main&gt; :t p007nthPrime\np007nthPrime :: Int -&gt; Integer\n</code></pre>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 28061275, "answer_count": 1, "score": 1, "last_activity_date": 1421823357, "creation_date": 1421822809, "question_id": 28061132, "link": "https://stackoverflow.com/questions/28061132/type-signature-for-index-in-haskell", "title": "Type signature for index in Haskell", "body": "<p>Project Euler Problem 7: What is the 10 001st prime number?</p>\n\n<p>This is a function that takes a single parameter (10001) and returns the 10001st prime.  GHCi gives me no problems: </p>\n\n<pre><code>p007nthPrime x = primes !! (x - 1)\n    where\n        primes :: [Integer]\n        primes = sieve [2..]\n            where\n                sieve (p:xs) = p : sieve [x|x &lt;- xs, x `mod` p &gt; 0]\n</code></pre>\n\n<p>Now, being a good Haskeller, I'd like to make a type signature.  However, putting <code>p007nthPrime :: (Integral a) =&gt; a -&gt; a</code> at the top throws me this error: </p>\n\n<pre><code>projecteuler.hs:81:29:\n    Couldn't match type `Integer' with `Int'\n    Expected type: Int\n      Actual type: a\n    In the first argument of `(-)', namely `x'\n    In the second argument of `(!!)', namely `(x - 1)'\n    In the expression: primes !! (x - 1)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>and inserting <code>p007nthPrime :: (Num a) =&gt; a -&gt; a</code> does the same thing.  What is the right type signature for this function?</p>\n"}, {"tags": ["haskell", "compilation", "ghc", "ghc-api"], "comments": [{"owner": {"reputation": 940, "user_id": 1275256, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5cd12beabbb9d483c03d843cc504e5c0?s=128&d=identicon&r=PG", "display_name": "gxtaillon", "link": "https://stackoverflow.com/users/1275256/gxtaillon"}, "edited": false, "score": 0, "creation_date": 1422055632, "post_id": 28059669, "comment_id": 44614965, "body": "The devs of the <a href=\"https://www.haskell.org/mailman/listinfo/ghc-devs\" rel=\"nofollow noreferrer\">ghc mailing list</a> are probably the ones with the answers you are looking for."}, {"owner": {"reputation": 5707, "user_id": 1186208, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e601af8314cff7e7cca5647125e5a5ed?s=128&d=identicon&r=PG", "display_name": "Christian Conkle", "link": "https://stackoverflow.com/users/1186208/christian-conkle"}, "edited": false, "score": 1, "creation_date": 1422480174, "post_id": 28059669, "comment_id": 44771390, "body": "I believe there&#39;s been work done recently on allowing plugins to do core-to-core transformation passes within the GHC pipeline; not exactly what you want though. Perhaps you could explain briefly why you want to do this precise workflow?"}, {"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "reply_to_user": {"reputation": 5707, "user_id": 1186208, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e601af8314cff7e7cca5647125e5a5ed?s=128&d=identicon&r=PG", "display_name": "Christian Conkle", "link": "https://stackoverflow.com/users/1186208/christian-conkle"}, "edited": false, "score": 1, "creation_date": 1422518080, "post_id": 28059669, "comment_id": 44783680, "body": "@ChristianConkle I do not want <code>CORE -&gt; CORE</code> plugin. I&#39;m creating my custom language and want to compile it to core and then use GHC pipeline. Sorry for being unclear."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 3776499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de2ef166cda62ae0d3b2cfc046744e40?s=128&d=identicon&r=PG&f=1", "display_name": "Llamadonica", "link": "https://stackoverflow.com/users/3776499/llamadonica"}, "edited": false, "score": 0, "creation_date": 1422478862, "post_id": 28202176, "comment_id": 44770752, "body": "As for the other part of your question, replacing the CORE with another, you&#39;re probably out of luck, and I&#39;m not even quite sure what your aim is there."}, {"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 0, "creation_date": 1422518028, "post_id": 28202176, "comment_id": 44783653, "body": "hmm, ok, maybe this is the way to go to link the object file manually, but I hope GHC has some routines to do this for us. I mean - sometimes this might change and supporting it would be much easier if it would be handled by ghc. @Llamadonica I want to compile my custom language to CORE and then just proceed with normal GHC pipeline."}], "tags": [], "owner": {"reputation": 1, "user_id": 3776499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de2ef166cda62ae0d3b2cfc046744e40?s=128&d=identicon&r=PG&f=1", "display_name": "Llamadonica", "link": "https://stackoverflow.com/users/3776499/llamadonica"}, "is_accepted": false, "score": -2, "last_activity_date": 1422478347, "creation_date": 1422478347, "answer_id": 28202176, "question_id": 28059669, "link": "https://stackoverflow.com/questions/28059669/using-ghc-api-to-compile-haskell-sources-to-core-and-core-to-binary/28202176#28202176", "title": "Using GHC API to compile Haskell sources to CORE and CORE to binary", "body": "<p>Short answer: once you have to object file you use the c compiler of your choice to compile a main stub and link into an executable.</p>\n\n<p>If you have the object file, then the last steps that GHC would do are done in the linker and a C compiler. For instance, by setting the -verbose flag and -keep-tmp-files for a simple hello_world, the last three steps for me, after building the objects, were:</p>\n\n<pre><code>'/usr/bin/gcc' '-fno-stack-protector' '-Wl,--hash-size=31' '-Wl,--reduce-memory-overheads' '-c' '/tmp/ghc29076_0/ghc29076_0.c' '-o' '/tmp/ghc29076_0/ghc29076_0.o' '-DTABLES_NEXT_TO_CODE' '-I/usr/lib/ghc/include'\n*** C Compiler:\n'/usr/bin/gcc' '-fno-stack-protector' '-Wl,--hash-size=31' '-Wl,--reduce-memory-overheads' '-c' '/tmp/ghc29076_0/ghc29076_0.s' '-o' '/tmp/ghc29076_0/ghc29076_1.o' '-DTABLES_NEXT_TO_CODE' '-I/usr/lib/ghc/include'\n*** Linker:\n'/usr/bin/gcc' '-fno-stack-protector' '-Wl,--hash-size=31' '-Wl,--reduce-memory-overheads' '-o' 'hello' 'hello.o' '-L/usr/lib/ghc/base-4.6.0.1' '-L/usr/lib/ghc/integer-gmp-0.5.0.0' '-L/usr/lib/ghc/ghc-prim-0.3.0.0' '-L/usr/lib/ghc' '/tmp/ghc29076_0/ghc29076_0.o' '/tmp/ghc29076_0/ghc29076_1.o' '-lHSbase-4.6.0.1' '-lHSinteger-gmp-0.5.0.0' '-lgmp' '-lHSghc-prim-0.3.0.0' '-lHSrts' '-lffi' '-lm' '-lrt' '-ldl' '-u' 'ghczmprim_GHCziTypes_Izh_static_info' '-u' 'ghczmprim_GHCziTypes_Czh_static_info' '-u' 'ghczmprim_GHCziTypes_Fzh_static_info' '-u' 'ghczmprim_GHCziTypes_Dzh_static_info' '-u' 'base_GHCziPtr_Ptr_static_info' '-u' 'ghczmprim_GHCziTypes_Wzh_static_info' '-u' 'base_GHCziInt_I8zh_static_info' '-u' 'base_GHCziInt_I16zh_static_info' '-u' 'base_GHCziInt_I32zh_static_info' '-u' 'base_GHCziInt_I64zh_static_info' '-u' 'base_GHCziWord_W8zh_static_info' '-u' 'base_GHCziWord_W16zh_static_info' '-u' 'base_GHCziWord_W32zh_static_info' '-u' 'base_GHCziWord_W64zh_static_info' '-u' 'base_GHCziStable_StablePtr_static_info' '-u' 'ghczmprim_GHCziTypes_Izh_con_info' '-u' 'ghczmprim_GHCziTypes_Czh_con_info' '-u' 'ghczmprim_GHCziTypes_Fzh_con_info' '-u' 'ghczmprim_GHCziTypes_Dzh_con_info' '-u' 'base_GHCziPtr_Ptr_con_info' '-u' 'base_GHCziPtr_FunPtr_con_info' '-u' 'base_GHCziStable_StablePtr_con_info' '-u' 'ghczmprim_GHCziTypes_False_closure' '-u' 'ghczmprim_GHCziTypes_True_closure' '-u' 'base_GHCziPack_unpackCString_closure' '-u' 'base_GHCziIOziException_stackOverflow_closure' '-u' 'base_GHCziIOziException_heapOverflow_closure' '-u' 'base_ControlziExceptionziBase_nonTermination_closure' '-u' 'base_GHCziIOziException_blockedIndefinitelyOnMVar_closure' '-u' 'base_GHCziIOziException_blockedIndefinitelyOnSTM_closure' '-u' 'base_ControlziExceptionziBase_nestedAtomically_closure' '-u' 'base_GHCziWeak_runFinalizzerBatch_closure' '-u' 'base_GHCziTopHandler_flushStdHandles_closure' '-u' 'base_GHCziTopHandler_runIO_closure' '-u' 'base_GHCziTopHandler_runNonIO_closure' '-u' 'base_GHCziConcziIO_ensureIOManagerIsRunning_closure' '-u' 'base_GHCziConcziSync_runSparks_closure' '-u' 'base_GHCziConcziSignal_runHandlers_closure'\n</code></pre>\n\n<p>Looking at those first two files reveals that the c file is just:</p>\n\n<pre><code>#include \"Rts.h\"\nextern StgClosure ZCMain_main_closure;\nint main(int argc, char *argv[])\n{\n    RtsConfig __conf = defaultRtsConfig;\n    __conf.rts_opts_enabled = RtsOptsSafeOnly;\n   return hs_main(argc, argv, &amp;ZCMain_main_closure,__conf);\n}\n</code></pre>\n\n<p>Doesn't seem like that should change much from project to project.</p>\n\n<p>The assembly file is: </p>\n\n<pre><code> .section .debug-ghc-link-info,\"\",@note\n .ascii \"([\\\"-lHSbase-4.6.0.1\\\",\\\"-lHSinteger-gmp-0.5.0.0\\\",\\\"-lgmp\\\",\\\"-lHSghc-prim-0.3.0.0\\\",\\\"-lHSrts\\\",\\\"-lffi\\    \",\\\"-lm\\\",\\\"-lrt\\\",\\\"-ldl\\\",\\\"-u\\\",\\\"ghczmprim_GHCziTypes_Izh_static_info\\\",\\\"-u\\\",\\\"ghczmprim_GHCziTypes_Czh_static    _info\\\",\\\"-u\\\",\\\"ghczmprim_GHCziTypes_Fzh_static_info\\\",\\\"-u\\\",\\\"ghczmprim_GHCziTypes_Dzh_static_info\\\",\\\"-u\\\",\\\"bas    e_GHCziPtr_Ptr_static_info\\\",\\\"-u\\\",\\\"ghczmprim_GHCziTypes_Wzh_static_info\\\",\\\"-u\\\",\\\"base_GHCziInt_I8zh_static_info    \\\",\\\"-u\\\",\\\"base_GHCziInt_I16zh_static_info\\\",\\\"-u\\\",\\\"base_GHCziInt_I32zh_static_info\\\",\\\"-u\\\",\\\"base_GHCziInt_I64z    h_static_info\\\",\\\"-u\\\",\\\"base_GHCziWord_W8zh_static_info\\\",\\\"-u\\\",\\\"base_GHCziWord_W16zh_static_info\\\",\\\"-u\\\",\\\"base    _GHCziWord_W32zh_static_info\\\",\\\"-u\\\",\\\"base_GHCziWord_W64zh_static_info\\\",\\\"-u\\\",\\\"base_GHCziStable_StablePtr_stati    c_info\\\",\\\"-u\\\",\\\"ghczmprim_GHCziTypes_Izh_con_info\\\",\\\"-u\\\",\\\"ghczmprim_GHCziTypes_Czh_con_info\\\",\\\"-u\\\",\\\"ghczmpri    m_GHCziTypes_Fzh_con_info\\\",\\\"-u\\\",\\\"ghczmprim_GHCziTypes_Dzh_con_info\\\",\\\"-u\\\",\\\"base_GHCziPtr_Ptr_con_info\\\",\\\"-u\\    \",\\\"base_GHCziPtr_FunPtr_con_info\\\",\\\"-u\\\",\\\"base_GHCziStable_StablePtr_con_info\\\",\\\"-u\\\",\\\"ghczmprim_GHCziTypes_Fal    se_closure\\\",\\\"-u\\\",\\\"ghczmprim_GHCziTypes_True_closure\\\",\\\"-u\\\",\\\"base_GHCziPack_unpackCString_closure\\\",\\\"-u\\\",\\\"b    ase_GHCziIOziException_stackOverflow_closure\\\",\\\"-u\\\",\\\"base_GHCziIOziException_heapOverflow_closure\\\",\\\"-u\\\",\\\"base    _ControlziExceptionziBase_nonTermination_closure\\\",\\\"-u\\\",\\\"base_GHCziIOziException_blockedIndefinitelyOnMVar_closur    e\\\",\\\"-u\\\",\\\"base_GHCziIOziException_blockedIndefinitelyOnSTM_closure\\\",\\\"-u\\\",\\\"base_ControlziExceptionziBase_neste    dAtomically_closure\\\",\\\"-u\\\",\\\"base_GHCziWeak_runFinalizzerBatch_closure\\\",\\\"-u\\\",\\\"base_GHCziTopHandler_flushStdHan    dles_closure\\\",\\\"-u\\\",\\\"base_GHCziTopHandler_runIO_closure\\\",\\\"-u\\\",\\\"base_GHCziTopHandler_runNonIO_closure\\\",\\\"-u\\\"    ,\\\"base_GHCziConcziIO_ensureIOManagerIsRunning_closure\\\",\\\"-u\\\",\\\"base_GHCziConcziSync_runSparks_closure\\\",\\\"-u\\\",\\\"    base_GHCziConcziSignal_runHandlers_closure\\\"],[],Nothing,RtsOptsSafeOnly,False,[],[])\"\n</code></pre>\n\n<p>Well that's a little worse, but it looks like those are a list of linker flags with some gobbledygook that was passed into GHC at the end. I'm not sure <em>what</em> all the things that the linker is undefining, and looking at linker flags will be your biggest homework. Will you have to modify those flags? Maybe, and maybe only if dependencies change.</p>\n"}, {"comments": [{"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 0, "creation_date": 1422625230, "post_id": 28237020, "comment_id": 44835573, "body": "I&#39;m not interested in creating the textual core, because I want to generate it&#39;s AST. Loading external core to GHC oculd be solution, but as you have written it is not maintained anymore - the same answer I got on the mailing list. I&#39;m still very interested in getting the &quot;real&quot; solution, but for now I will just drop the bounty here, because the time is over :("}], "tags": [], "owner": {"reputation": 2905, "user_id": 1641629, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ec74ffd87c09656ff7645d31ed224056?s=128&d=identicon&r=PG&f=1", "display_name": "remdezx", "link": "https://stackoverflow.com/users/1641629/remdezx"}, "is_accepted": false, "score": 5, "last_activity_date": 1422624659, "creation_date": 1422624659, "answer_id": 28237020, "question_id": 28059669, "link": "https://stackoverflow.com/questions/28059669/using-ghc-api-to-compile-haskell-sources-to-core-and-core-to-binary/28237020#28237020", "title": "Using GHC API to compile Haskell sources to CORE and CORE to binary", "body": "<p>Generating textual representation of core is not a problem here, because it can be made in multiple ways. You can use <code>-fext-core</code> flag to generate <code>.hcr</code> files and work with them using e.g. <a href=\"http://hackage.haskell.org/package/extcore\" rel=\"noreferrer\">extcore</a>. There are also other packages that can dump core, like <a href=\"http://hackage.haskell.org/package/ghc-core\" rel=\"noreferrer\">ghc-core</a> or <a href=\"http://hackage.haskell.org/package/ghc-core-html\" rel=\"noreferrer\">ghc-core-html</a>.</p>\n\n<p>The main problem here, is loading ghc-core into <code>ghc</code>. As far as I know it was supported but now is not, because there was low interest in using it and it became obsolete with time.</p>\n\n<p>The best thing we can try here is dig more into <code>ghc</code> internals, find places where ghc-core is used and try to modify it there. Maybe we can also try creating a <a href=\"https://downloads.haskell.org/~ghc/7.8.3/docs/html/users_guide/compiler-plugins.html\" rel=\"noreferrer\">ghc plugin</a> and modify core with it.</p>\n"}], "owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 921, "favorite_count": 4, "answer_count": 2, "score": 20, "last_activity_date": 1422624659, "creation_date": 1421814851, "last_edit_date": 1495542339, "question_id": 28059669, "link": "https://stackoverflow.com/questions/28059669/using-ghc-api-to-compile-haskell-sources-to-core-and-core-to-binary", "title": "Using GHC API to compile Haskell sources to CORE and CORE to binary", "body": "<p><strong>The Idea</strong></p>\n\n<p>Hello! I want to create a program, that will generate Haskell Core and will use GHC API to compile it further into an executable. But before I will do it I want to construct a very basic example, showing how can we just compile Haskell sources into CORE and then into the binary file.</p>\n\n<p><strong>The problem</strong></p>\n\n<p>I have read a lot of documentation and tried many methods from GHC Api, but for now without success. I started with <a href=\"https://www.haskell.org/haskellwiki/GHC/As_a_library\" rel=\"nofollow noreferrer\">Official GHC Api introduction</a> and successfully compiled the examples. The examples show the usage of the following functions: <code>parseModule</code>, <code>typecheckModule</code>, <code>desugarModule</code>, <code>getNamesInScope</code> and <code>getModuleGraph</code> but does not cover the final compilation step. On the other hand, there are some functions in the api, whose names look related to the problem, like <a href=\"https://www.haskell.org/platform/doc/2013.2.0.0/ghc-api/HscMain.html\" rel=\"nofollow noreferrer\">HscMain.{hscCompileOneShot, hscCompileBatch}</a> or <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/ghc-7.8.4/GHC.html#g:6\" rel=\"nofollow noreferrer\">GHC.{compileToCoreModule, compileCoreToObj}</a>. I tried to use them, but I get runtime errors, like in this example:</p>\n\n<pre><code>import GHC\nimport GHC.Paths ( libdir )\nimport DynFlags\ntargetFile = \"Test.hs\"\n\nmain :: IO ()\nmain = do\n   res &lt;- example\n   return ()\n\nexample = \n    defaultErrorHandler defaultFatalMessager defaultFlushOut $ do\n      runGhc (Just libdir) $ do\n        dflags &lt;- getSessionDynFlags\n        let dflags' = foldl xopt_set dflags\n                            [Opt_Cpp, Opt_ImplicitPrelude, Opt_MagicHash]\n        setSessionDynFlags dflags'\n        coreMod &lt;- compileToCoreModule targetFile\n        compileCoreToObj False coreMod \"foo\" \"bar\"\n        return () \n</code></pre>\n\n<p>which can be compiled with <code>ghc -package ghc Main.hs</code> and which results in the following error during runtime:</p>\n\n<pre><code>Main: panic! (the 'impossible' happened)\n  (GHC version 7.8.3 for x86_64-unknown-linux):\n    expectJust mkStubPaths\n</code></pre>\n\n<p>which of course can be the result of wrong API usage, in particular, because of line <code>compileCoreToObj False coreMod \"foo\" \"bar\"</code>, wher the string are just random ones, because the documentation does not say much about them. If we look into the sources, it seems, that the first one is the output name and the second one is \"extCore_filename\", whatever it could be.</p>\n\n<p>Another worrying thing is the comment in the documentation next to the <code>compileCoreToObj</code> function: </p>\n\n<blockquote>\n  <p>[...] This has only so far been tested with a single self-contained module.</p>\n</blockquote>\n\n<p>But I hope it will not introduce any further problems.</p>\n\n<p><strong>The question</strong></p>\n\n<p>What is the best possible way to create this solution? How can we create a minimal working example, that will load haskell sources, compile them into the CORE and then compile the core to final executable (using the GHC API). The intermediate step is needed for further replacement by custom CORE.</p>\n\n<p>As a side-question - is it currently possible to provide GHC with external core files or this feature is not implemented yet and I will have to construct the Core manually, using GHC.Api (related to: <a href=\"https://stackoverflow.com/questions/8927010/compiling-to-ghc-core?rq=1\">Compiling to GHC Core</a>)</p>\n\n<p><strong>Update</strong></p>\n\n<p>I was finally able to create a small example allowing loading a module and compiling it to <code>.hi</code> and <code>.o</code> files. This is not a solution for the problem, because it does not allow me to replace the CORE and it does not link the object files into executables yet:</p>\n\n<pre><code>import GHC\nimport GHC.Paths ( libdir )\nimport DynFlags\nimport Linker\nimport Module\ntargetFile = \"Test.hs\"\n\nmain :: IO ()\nmain = do\n   res &lt;- example\n   return ()\n\nexample = \n    defaultErrorHandler defaultFatalMessager defaultFlushOut $ do\n      runGhc (Just libdir) $ do\n        dflags &lt;- getSessionDynFlags\n        let dflags2 = dflags { ghcLink   = LinkBinary\n                             , hscTarget = HscAsm\n                             }\n        let dflags' = foldl xopt_set dflags2\n                            [Opt_Cpp, Opt_ImplicitPrelude, Opt_MagicHash]\n        setSessionDynFlags dflags'\n        setTargets =&lt;&lt; sequence [guessTarget \"Test.hs\" Nothing]\n\n        load LoadAllTargets\n        return ()\n</code></pre>\n"}, {"tags": ["haskell", "conduit"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 5, "last_activity_date": 1421808117, "creation_date": 1421808117, "answer_id": 28058729, "question_id": 28058280, "link": "https://stackoverflow.com/questions/28058280/unable-to-recover-from-errors-in-conduit/28058729#28058729", "title": "Unable to recover from errors in Conduit", "body": "<p>Your usage of <code>catchC</code> is correct; the problem is the usage of <code>throw</code>, which introduces an imprecise exception instead of a proper <code>IO</code> exception. If you instead use:</p>\n\n<pre><code>liftIO $ throwIO $ MyException \"Value\"\n</code></pre>\n\n<p>your program works as expected.</p>\n"}], "owner": {"reputation": 65, "user_id": 914591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/669814873645cdf45e2781699d71771b?s=128&d=identicon&r=PG", "display_name": "rubioz", "link": "https://stackoverflow.com/users/914591/rubioz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 2, "accepted_answer_id": 28058729, "answer_count": 1, "score": 2, "last_activity_date": 1421808117, "creation_date": 1421804857, "question_id": 28058280, "link": "https://stackoverflow.com/questions/28058280/unable-to-recover-from-errors-in-conduit", "title": "Unable to recover from errors in Conduit", "body": "<p>I am trying to understand how to catch errors thrown within conduits. I believed that by applying <code>catchC</code> on a conduit, I could produce a new conduit that would rerun in the event of a faillure.</p>\n\n<p>In the example below we have a source that, depending on a boolean value, will throw an custom dummy exception. Initially the value of that boolean leads to that exception being thrown, however the handler inside <code>catchC</code> produces a new conduit that should exhibit the opposite behaviour (yielding the numbers from 1 to 10)</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n\nmodule Main where\n\nimport Data.Conduit\nimport qualified Data.Conduit.List as CL\nimport Control.Monad.IO.Class\nimport Control.Exception\nimport Data.Typeable\n\ndata MyException = MyException String\n    deriving (Show, Typeable)\n\ninstance Exception MyException where\n\nlistAsStream :: Bool -&gt; Source IO Int\nlistAsStream val =  if val then CL.sourceList [1..10] else throw $ MyException \"Value\"\n\nconduitWhatever :: Sink Int IO ()\nconduitWhatever = awaitForever $ liftIO . print\n\nmain :: IO ()\nmain = catchC (listAsStream False) handler $$ conduitWhatever\n\nhandler :: MyException -&gt; Source IO Int\nhandler _= catchC (listAsStream True) handler\n</code></pre>\n\n<p>I am pretty sure I have misunderstood how <code>catchC</code> works. Could anyone explain me what I am doing wrong?</p>\n\n<p>Thanks a lot!</p>\n"}, {"tags": ["haskell", "pattern-matching", "unification"], "comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 4, "creation_date": 1421786363, "post_id": 28054481, "comment_id": 44491275, "body": "It&#39;s unfortunately very unclear what you want. Why is floating the type parameters to <code>Wrap</code> not an option? If <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code> are really independent and flexible, it seems like the right thing to do. Even if you used existential quantification, you&#39;d know nothing about the hidden types and couldn&#39;t do anything useful with them."}, {"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "reply_to_user": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1421787855, "post_id": 28054481, "comment_id": 44491981, "body": "@kosmikus: So they&#39;re not actually independent and flexible. I&#39;m doing a lot of type-level programming, so having them as universally quantified solves my heterogeneity problem :\\  In this example, <code>b, c, d</code> are auxilliary types facilitating some internal plumbing for the type safety. The thing is, though, once I create <code>Init</code>, the types are no longer prone to change, and that&#39;s why I feel comfortable &quot;wrapping&quot; them away."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1421789164, "post_id": 28054481, "comment_id": 44492597, "body": "@AthanClark once you place <code>Init</code> in an existential wrapper, you can do absolutely nothing with the <code>b c d</code> fields, it&#39;s pretty much throwing them into a black hole. Existentials are only useful if there are additional data wrapped in, like class instances, functions or singletons."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1421790603, "post_id": 28054481, "comment_id": 44493295, "body": "You can&#39;t throw <code>b,c,d</code> away and get get them back. At most, your <code>unWrap</code> function can temporarily get them back only to rewrap them into a new existential-type container, or pass them to a polymorhic countinuation e.g. <code>unWrap :: Wrap a -&gt; (forall b c d. Init a b c d -&gt; r) -&gt; r</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1421790761, "post_id": 28054481, "comment_id": 44493364, "body": "Also, I can&#39;t see how the title of the question relates to the actual question. Tags also agree with the title, only. Can you shed some light or edit them to be more relevant?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 6, "creation_date": 1421791498, "post_id": 28054481, "comment_id": 44493723, "body": "I think the clarity of this question would really benefit if you included the actual problem you were trying to solve."}], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1421785433, "creation_date": 1421785433, "question_id": 28054481, "link": "https://stackoverflow.com/questions/28054481/type-level-unification-and-value-level-pattern-matching-with-encapsulated-types", "title": "Type-level unification and Value-level pattern-matching with Encapsulated types", "body": "<p>I'm trying to simplify a composite data type, but don't know the best way. Here is my code so far:</p>\n\n<pre><code>data Init a b c d = Init a b c d\n\ndata Wrap a = WNil (Init a b c d)\n            | WCons a (Wrap a)\n</code></pre>\n\n<p>The issue I keep seeing is probably obvious - I can't unify the expected result type's type variables with the encapsulated one:</p>\n\n<pre><code>-- | Will fail to compile\nunWrap :: Wrap a -&gt; Init a b c d\nunWrap (WNil x) = x\nunWrap (WCons _ xs) = unWrap xs\n</code></pre>\n\n<p>I've heard <code>-XExistentialQuantification</code> thrown around as a possible solution, but I couldn't get anything working. Does anyone have an idea what to do here, besides floating the type parameters to <code>Wrap</code>?</p>\n"}, {"tags": ["haskell", "monad-transformers", "haskeline"], "answers": [{"comments": [{"owner": {"reputation": 16405, "user_id": 770023, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa614f9017b6dfd4fa9b4f3b39dc61c7?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/770023/paul"}, "edited": false, "score": 0, "creation_date": 1421782570, "post_id": 28053686, "comment_id": 44489298, "body": "I already tried this solution, but I get a compilation error: <code>No instance for (MonadIO (InputT IO))       arising from a use of \u2018liftIO\u2019</code>"}, {"owner": {"reputation": 16405, "user_id": 770023, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa614f9017b6dfd4fa9b4f3b39dc61c7?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/770023/paul"}, "edited": false, "score": 0, "creation_date": 1421782627, "post_id": 28053686, "comment_id": 44489331, "body": "The same for the simple <code>lift</code> solution: <code>No instance for (MonadTrans InputT) arising from a use of \u2018lift\u2019</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 16405, "user_id": 770023, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa614f9017b6dfd4fa9b4f3b39dc61c7?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/770023/paul"}, "edited": false, "score": 1, "creation_date": 1421783337, "post_id": 28053686, "comment_id": 44489724, "body": "@Paul Surprising... here I have such an instance. Maybe you need to <code>import Control.Monad.IO.Class</code> ?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 16405, "user_id": 770023, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa614f9017b6dfd4fa9b4f3b39dc61c7?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/770023/paul"}, "edited": false, "score": 0, "creation_date": 1421786015, "post_id": 28053686, "comment_id": 44491117, "body": "@Paul What version of Haskeline are you using? Do you have multiple versions of some packages installed? This looks like a cabal issue."}, {"owner": {"reputation": 1603, "user_id": 225292, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/139dd92ae95a2075a124e552c1299d54?s=128&d=identicon&r=PG", "display_name": "paul", "link": "https://stackoverflow.com/users/225292/paul"}, "reply_to_user": {"reputation": 16405, "user_id": 770023, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa614f9017b6dfd4fa9b4f3b39dc61c7?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/770023/paul"}, "edited": false, "score": 0, "creation_date": 1421789599, "post_id": 28053686, "comment_id": 44492834, "body": "@Paul IIRC (a big if), I had the &quot;No instance...&quot; errors issue and it appeared after I installed a different Cabal package. Try re-installing the Haskeline package through Cabal (I think there might be a <code>--reinstall</code> option) and see if that fixes it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1603, "user_id": 225292, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/139dd92ae95a2075a124e552c1299d54?s=128&d=identicon&r=PG", "display_name": "paul", "link": "https://stackoverflow.com/users/225292/paul"}, "edited": false, "score": 0, "creation_date": 1421789664, "post_id": 28053686, "comment_id": 44492864, "body": "@Paul haskeline 0.7.1.3 here, BTW"}, {"owner": {"reputation": 1603, "user_id": 225292, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/139dd92ae95a2075a124e552c1299d54?s=128&d=identicon&r=PG", "display_name": "paul", "link": "https://stackoverflow.com/users/225292/paul"}, "reply_to_user": {"reputation": 16405, "user_id": 770023, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa614f9017b6dfd4fa9b4f3b39dc61c7?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/770023/paul"}, "edited": false, "score": 0, "creation_date": 1421801817, "post_id": 28053686, "comment_id": 44497481, "body": "@Paul I just checked my notes and the &quot;No instance...&quot; error you were getting was what I was getting. I worked out that it had started happening after I&#39;d installed the Lens library, and that re-installing the Haskeline library fixed the problem."}, {"owner": {"reputation": 16405, "user_id": 770023, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa614f9017b6dfd4fa9b4f3b39dc61c7?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/770023/paul"}, "edited": false, "score": 0, "creation_date": 1421861435, "post_id": 28053686, "comment_id": 44525977, "body": "@chi, The problem is solved, I tried reinstalling haskeline and hiding an older version of it (I somehow wound up having two of them, 0.7.1.2 and 0.7.1.3). This seemed to do the trick."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 11, "last_activity_date": 1421782429, "creation_date": 1421782429, "answer_id": 28053686, "question_id": 28053526, "link": "https://stackoverflow.com/questions/28053526/perform-simple-io-in-haskeline-inside-inputt-monad-without-having-to-resort-to/28053686#28053686", "title": "Perform simple IO in Haskeline, inside InputT monad, without having to resort to unsafePerformIO", "body": "<p>Since <code>InputT IO</code> is a <code>MonadIO</code>, you can use <code>liftIO</code> with this type:</p>\n\n<pre><code>liftIO :: IO a -&gt; InputT IO a\n</code></pre>\n\n<p>So,</p>\n\n<pre><code>do ...\n   x &lt;- liftIO $ runExceptT $ foo input\n   case x of\n     Left err  -&gt; ...\n     Right res -&gt; ...\n</code></pre>\n\n<p>Alternatively, use <code>Control.Monad.Trans.lift</code> instead.</p>\n"}], "owner": {"reputation": 16405, "user_id": 770023, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa614f9017b6dfd4fa9b4f3b39dc61c7?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/770023/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 585, "favorite_count": 0, "accepted_answer_id": 28053686, "answer_count": 1, "score": 7, "last_activity_date": 1421782429, "creation_date": 1421781755, "question_id": 28053526, "link": "https://stackoverflow.com/questions/28053526/perform-simple-io-in-haskeline-inside-inputt-monad-without-having-to-resort-to", "title": "Perform simple IO in Haskeline, inside InputT monad, without having to resort to unsafePerformIO", "body": "<p>Given the proof of concept code below I'd like to be able to somehow perform my <code>foo</code> function with the ability to output the string <code>Paul!</code> and the possibility of getting its return value inside the <code>InputT</code> monad-transformer without using <code>unsafePerformIO</code> to remove the IO wrapper after <code>runExceptT</code>.</p>\n\n<pre><code>import Control.Monad.Except\n\nimport System.IO.Unsafe (unsafePerformIO)\nimport System.Console.Haskeline\n\n\ntype ErrorWithIO = ExceptT String IO\n\n\nfoo :: String -&gt; ErrorWithIO String\nfoo \"paul\" = do liftIO $ putStrLn \"Paul!\"\n                return \"OK!\"\nfoo _ = throwError \"ERROR!\"\n\n\nrunRepl :: IO ()\nrunRepl = runInputT defaultSettings $ loop\n\n\nloop :: InputT IO ()\nloop = do\n    line &lt;- getInputLine \"&gt; \"\n    case line of\n        Nothing -&gt; return ()\n        Just input -&gt; do return $ putStrLn \"asd\"\n                         case unsafePerformIO $ runExceptT $ foo input of\n                             Left err -&gt; outputStrLn err &gt;&gt; loop\n                             Right res -&gt; do\n                                 x &lt;- outputStrLn . show $ res\n                                 loop\n\n\n\n\nmain :: IO ()\nmain = runRepl &gt;&gt; putStrLn \"Goodbye!\"\n</code></pre>\n\n<p>Am I missing something obvious here?</p>\n"}, {"tags": ["haskell", "llvm"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1421787141, "post_id": 28053448, "comment_id": 44491649, "body": "LLVM 3.4 with GHC 7.8.4 and 7.8.3 on x64 linux gives NaN to both."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1421792353, "post_id": 28053448, "comment_id": 44494127, "body": "What version of GHC are you using? This obviously is/was a bug."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 6, "creation_date": 1421794059, "post_id": 28053448, "comment_id": 44494863, "body": "I would consider it a bug, though it might well have been acceptable according to some specification. LLVM evidently fired some optimisation here which assumes non-negative arguments, making \u221a(-7) undefined behaviour."}, {"owner": {"reputation": 5755, "user_id": 394253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/985ef765f821b00d3b41ac5ca8aef6a0?s=128&d=identicon&r=PG", "display_name": "Ed&#39;ka", "link": "https://stackoverflow.com/users/394253/edka"}, "edited": false, "score": 6, "creation_date": 1421805641, "post_id": 28053448, "comment_id": 44498401, "body": "Probably related: <a href=\"http://llvm.org/bugs/show_bug.cgi?id=21048\" rel=\"nofollow noreferrer\">LLVM bug 21048</a>"}, {"owner": {"reputation": 76699, "user_id": 240733, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/0b55ab48c85a40ac1960c1fc4d5e2f99?s=128&d=identicon&r=PG&f=1", "display_name": "stakx - no longer contributing", "link": "https://stackoverflow.com/users/240733/stakx-no-longer-contributing"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1422780649, "post_id": 28053448, "comment_id": 44879140, "body": "@leftaroundabout: You should post your comment as an answer, so it can be properly upvoted and/or accepted."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5755, "user_id": 394253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/985ef765f821b00d3b41ac5ca8aef6a0?s=128&d=identicon&r=PG", "display_name": "Ed&#39;ka", "link": "https://stackoverflow.com/users/394253/edka"}, "edited": false, "score": 0, "creation_date": 1422781409, "post_id": 28053448, "comment_id": 44879317, "body": "I was merely making a vague guess in <i>my</i> comment. @Ed&#39;ka, <i>you</i> should post that as an answer, you&#39;ve pointed out the particular bug."}], "answers": [{"tags": [], "owner": {"reputation": 5175, "user_id": 4370109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UcQgO.jpg?s=128&g=1", "display_name": "Brian Tompsett - \u6c64\u83b1\u6069", "link": "https://stackoverflow.com/users/4370109/brian-tompsett-%e6%b1%a4%e8%8e%b1%e6%81%a9"}, "is_accepted": true, "score": 3, "last_activity_date": 1423332297, "last_edit_date": 1490003019, "creation_date": 1423332297, "answer_id": 28385568, "question_id": 28053448, "link": "https://stackoverflow.com/questions/28053448/why-compiling-this-haskell-program-with-fllvm-produces-a-different-result/28385568#28385568", "title": "Why compiling this Haskell program with -fllvm produces a different result?", "body": "<p>(Question answered in the comments. Converted to a community wiki answer. See <a href=\"https://meta.stackoverflow.com/questions/251597/question-with-no-answers-but-issue-solved-in-the-comments\">Question with no answers, but issue solved in the comments (or extended in chat)</a> )</p>\n\n<p>@leftaroundabout wrote:</p>\n\n<blockquote>\n  <p>I would consider it a bug, though it might well have been acceptable according to some specification. LLVM evidently fired some optimisation here which assumes non-negative arguments, making \u221a(-7) undefined behaviour.</p>\n</blockquote>\n\n<p>@Ed'ka wrote:</p>\n\n<blockquote>\n  <p>Probably related: <a href=\"http://llvm.org/bugs/show_bug.cgi?id=21048\" rel=\"nofollow noreferrer\">LLVM bug 21048</a></p>\n</blockquote>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 544, "favorite_count": 0, "accepted_answer_id": 28385568, "answer_count": 1, "score": 24, "last_activity_date": 1423332297, "creation_date": 1421781435, "last_edit_date": 1421793453, "question_id": 28053448, "link": "https://stackoverflow.com/questions/28053448/why-compiling-this-haskell-program-with-fllvm-produces-a-different-result", "title": "Why compiling this Haskell program with -fllvm produces a different result?", "body": "<p>Compiling the following program:</p>\n\n<pre><code>main = print (sqrt (-7))\n</code></pre>\n\n<p>On OSX Yosemite, LLVM version 3.4.2, target x86_64-apple-darwin14.0.0, GHC 7.8.4 produces two different results, depending on llvm use:</p>\n\n<pre><code>apple1$ ghc -fforce-recomp a.hs -o a; ./a\n[1 of 1] Compiling Main             ( a.hs, a.o )\nLinking a ...\nNaN\n\napple1$ ghc -fforce-recomp -fllvm a.hs -o a; ./a\n[1 of 1] Compiling Main             ( a.hs, a.o )\nLinking a ...\n0.0\n</code></pre>\n\n<p>Why this happens?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7204, "user_id": 4333347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b091d5e3973e6f65ec16442c3b1b16b?s=128&d=identicon&r=PG", "display_name": "buydadip", "link": "https://stackoverflow.com/users/4333347/buydadip"}, "edited": false, "score": 0, "creation_date": 1421871228, "post_id": 28052951, "comment_id": 44531049, "body": "Before getting flagged once more, I would like people to see that I edited my question. I do believe it fits within the guidelines now."}], "answers": [{"comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 7204, "user_id": 4333347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b091d5e3973e6f65ec16442c3b1b16b?s=128&d=identicon&r=PG", "display_name": "buydadip", "link": "https://stackoverflow.com/users/4333347/buydadip"}, "edited": false, "score": 0, "creation_date": 1421780421, "post_id": 28053006, "comment_id": 44488114, "body": "@Bolboa: okay, made the change"}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 11, "last_activity_date": 1421780409, "last_edit_date": 1421780409, "creation_date": 1421779884, "answer_id": 28053006, "question_id": 28052951, "link": "https://stackoverflow.com/questions/28052951/haskell-lacks-an-accompanying-binding-for-recursive-function/28053006#28053006", "title": "Haskell - &quot;lacks an accompanying binding&quot; for recursive function", "body": "<p>The type signature for a function has to be in the same scope as the function itself. If you want to add a type signature to a function inside a <code>where</code> clause (which is usually not done, but sometimes makes sense) you have to put it in the <code>where</code> clause itself:</p>\n\n<pre><code>sumFactor num = tempFunc num num\n    where\n        tempFunc :: Int-&gt; Int-&gt; Int\n        tempFunc x y\n            | y == 0 = 0\n            | x `mod` y == 0 = y + tempFunc x (y-1)\n            | otherwise = y-1\n</code></pre>\n"}], "owner": {"reputation": 7204, "user_id": 4333347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b091d5e3973e6f65ec16442c3b1b16b?s=128&d=identicon&r=PG", "display_name": "buydadip", "link": "https://stackoverflow.com/users/4333347/buydadip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 1, "accepted_answer_id": 28053006, "answer_count": 1, "score": 2, "last_activity_date": 1421806983, "creation_date": 1421779705, "last_edit_date": 1421806983, "question_id": 28052951, "link": "https://stackoverflow.com/questions/28052951/haskell-lacks-an-accompanying-binding-for-recursive-function", "title": "Haskell - &quot;lacks an accompanying binding&quot; for recursive function", "body": "<p>I have the following function:</p>\n\n<pre><code>tempFunc :: Int-&gt; Int-&gt; Int\ntempFunc x y\n    | y == 0 = 0\n    | x `mod` y == 0 = y + tempFunc x (y-1)\n    | otherwise = y-1\n</code></pre>\n\n<p>Its purpose is to recursively sum all the factors of a number together. I want to eliminate the need for the second parameter <code>y</code> (since <code>y</code> is equal to <code>x</code>), so I implemented the function in the following way</p>\n\n<pre><code>tempFunc :: Int-&gt; Int-&gt; Int\nsumFactor num = tempFunc num num\n    where\n        tempFunc x y\n        ...\n</code></pre>\n\n<p>But I get the following error:</p>\n\n<pre><code>The type signature for \u2018tempFunc\u2019 lacks an accompanying binding\n</code></pre>\n\n<p>This type of error, I noticed, arises when the type definitions are incorrect. But I cannot figure out what is wrong with my type definitions, since the first excerpt works.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1421779886, "post_id": 28052902, "comment_id": 44487812, "body": "The language you use is quite sloppy, which makes it extremely hard to &quot;parse&quot; it. Can you try to reformulate your question?"}, {"owner": {"reputation": 361, "user_id": 4011383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc91cbebfef922ecd15477c3a96d8f8f?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Seweryn", "link": "https://stackoverflow.com/users/4011383/michal-seweryn"}, "edited": false, "score": 1, "creation_date": 1421779992, "post_id": 28052902, "comment_id": 44487866, "body": "Shouldn&#39;t the type of <code>zipWith&#39;</code> be <code>(a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]</code> ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 361, "user_id": 4011383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc91cbebfef922ecd15477c3a96d8f8f?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Seweryn", "link": "https://stackoverflow.com/users/4011383/michal-seweryn"}, "edited": false, "score": 0, "creation_date": 1421780017, "post_id": 28052902, "comment_id": 44487880, "body": "@MichalSeweryn: indeed, I think the OP means <code>foldWith</code>?"}, {"owner": {"reputation": 313, "user_id": 3103185, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/a9jDo.png?s=128&g=1", "display_name": "Ingako", "link": "https://stackoverflow.com/users/3103185/ingako"}, "reply_to_user": {"reputation": 361, "user_id": 4011383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc91cbebfef922ecd15477c3a96d8f8f?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Seweryn", "link": "https://stackoverflow.com/users/4011383/michal-seweryn"}, "edited": false, "score": 0, "creation_date": 1421780527, "post_id": 28052902, "comment_id": 44488166, "body": "@MichalSeweryn yes you are right!"}, {"owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 1, "creation_date": 1421780978, "post_id": 28052902, "comment_id": 44488421, "body": "There&#39;s no currying here.  Currying means transforming a function with a type like <code>(a,b) -&gt; c</code> into <code>a -&gt; b -&gt; c</code>."}, {"owner": {"reputation": 313, "user_id": 3103185, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/a9jDo.png?s=128&g=1", "display_name": "Ingako", "link": "https://stackoverflow.com/users/3103185/ingako"}, "reply_to_user": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 0, "creation_date": 1421781112, "post_id": 28052902, "comment_id": 44488488, "body": "@jwodder thanks, I&#39;ll edit my question right away. Can you please show me how you approach this kind of  functions?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421792125, "post_id": 28052902, "comment_id": 44494020, "body": "I think most functional programmers refer to &quot;curried functions&quot; simply as &quot;functions&quot;, since having them in curried form is the norm, unlike e.g. in most of math. Indeed, mentioning that they are in a curried form can mislead one to thinking there&#39;s some currying going on, i.e. that the program somehow constructs a function in an uncurried form and then transform it to a curried one."}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1421799324, "post_id": 28052902, "comment_id": 44496788, "body": "To address your last sentence: don&#39;t worry about taking your time to figure out <i>anything</i> in FP. It might feel bad if you&#39;re accustomed to imperative programming, but if so, remember that in Haskell and most FP languages it&#39;s an entirely different story. One of the biggest selling point that FP languages tell the public is that you can be very concise, and that means that when you <i>do</i> need to put it to words to initially understand it, it takes time, and the reason it&#39;s a blessing is because after you got it, any usage still stays concise which an upside in so so so many aspects."}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 1, "last_activity_date": 1421781799, "creation_date": 1421781799, "answer_id": 28053545, "question_id": 28052902, "link": "https://stackoverflow.com/questions/28052902/how-to-analyse-a-function-in-haskell/28053545#28053545", "title": "How to analyse a function in Haskell?", "body": "<p>Curried functions <em>look</em> scarier than they are. One way of thinking about how they work is uncurrying them. For instance:</p>\n\n<pre><code>(++) :: [t] -&gt; [t] -&gt; [t]\n</code></pre>\n\n<p>Becomes, when uncurried:</p>\n\n<pre><code>(++) :: ([t], [t]) -&gt; [t]\n</code></pre>\n\n<p>In my eyes, that's all the explanation needed, but here's a more detailed one, that might explain it fully:</p>\n\n<p>A function of type <code>a -&gt; b</code> takes an argument of type <code>a</code> and returns an argument of type <code>b</code>. Remember that <code>a -&gt; b</code> is in itself a concrete type and could take the place of <code>b</code> in the first, making a function of something like <code>a -&gt; (b -&gt; c)</code>.</p>\n\n<p>Let's say that a function <code>f</code> is of type <code>a -&gt; b -&gt; c</code>, which is as above. What does that mean? <strong>It is a function that returns a function!</strong> That is how currying works. The idea of functions returning other functions allows us to <em>partially apply</em> functions, limiting or specifying their traits.</p>\n\n<hr>\n\n<p>Let's now make our own function specifying that:</p>\n\n<pre><code>func :: a -&gt; [a] -&gt; [a]\nfunc = \\elem -&gt; ( \\list -&gt; elem : list )\n</code></pre>\n\n<p>The lambda expressions here have been written in such a way that it should be obvious what the type means: the first lambda (<code>\\elem -&gt; ...</code>) constructs the other based on it's input.</p>\n\n<hr>\n\n<p>Now, let's have a look at <code>zipWith</code>:</p>\n\n<pre><code>zipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\n</code></pre>\n\n<p>The first argument to <code>zipWith</code> is a function, which in itself takes two arguments. Not too crazy.</p>\n\n<p>The second argument is a list which can be passed to the function, because of the type variables defined.</p>\n\n<p>The third argument is another list that can be passed to the function after the first.</p>\n\n<p>The return value is a list of the resultant type of the function we passed to <code>zipWith</code> first.</p>\n"}, {"tags": [], "owner": {"reputation": 361, "user_id": 4011383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc91cbebfef922ecd15477c3a96d8f8f?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Seweryn", "link": "https://stackoverflow.com/users/4011383/michal-seweryn"}, "is_accepted": false, "score": 1, "last_activity_date": 1421782214, "creation_date": 1421782214, "answer_id": 28053635, "question_id": 28052902, "link": "https://stackoverflow.com/questions/28052902/how-to-analyse-a-function-in-haskell/28053635#28053635", "title": "How to analyse a function in Haskell?", "body": "<p>So, let's start with zipping function. It's type is <code>a -&gt; (b -&gt; c)</code>. It takes as a parameter of type <code>a</code>, and returns function which transforms <code>b</code> to <code>c</code>. It is isomorphic to it's uncurried equivalence <code>(a, b) -&gt; c</code>, the difference is that we fix first parameter, to get function which now requires only <code>b</code> to return c. </p>\n\n<p>So this is what the zipper's type mean. Now let's move on to <code>zipWith'</code>. It takes as a parameter zipping function (explained above). It returns something of type <code>[a] -&gt; ([b] -&gt; [c])</code>, which is pretty similiar to zipper function. We can say that <code>zipWith'</code> lifts zipping function to work with lists -<code>zipWith'</code> returns a function witch takes a list of <code>a</code>s, and returns function which takes list of <code>b</code>s and returns list of <code>c</code>s.</p>\n\n<p>In your example we have <code>zipWith' (*)</code>. For simplicity assume that <code>(*)</code> is of type <code>Int -&gt; (Int -&gt; Int)</code> (in reality it is more general - <code>(Num a) =&gt; a -&gt; (a -&gt; a</code>). Then we have <code>a ~ b ~ c ~ Int</code> and <code>zipWith' (*) :: [Int] -&gt; ([Int] -&gt; [Int])</code>. Then <code>zipWith' (*)</code> takes as a parameter a list of <code>Int</code>s and returns a function which transforms one list of <code>Int</code>s to another. So it can be used to zip two lists of lists of <code>a</code>s. And this is exactly what happens.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1421783507, "creation_date": 1421783507, "answer_id": 28053996, "question_id": 28052902, "link": "https://stackoverflow.com/questions/28052902/how-to-analyse-a-function-in-haskell/28053996#28053996", "title": "How to analyse a function in Haskell?", "body": "<p>In this case it might be helpful to think of the nested lists as (2-dimensional) matrices.</p>\n\n<pre><code>A =  ( 1 2 3 )   B =  ( 3 2 2 )  --&gt;  result = ( 3  4  6 )\n     ( 3 5 6 )        ( 3 4 5 )                ( 9 20 30 )\n</code></pre>\n\n<p>The outer zip' combines the rows from A and B and the inner zip combines a pair of rows into another row, and so it is clear the result will have the same shape as the inputs.</p>\n\n<p>It also might be helpful to realize that <code>zipWith (*)</code> is just component-wise multiplication of vectors. In fact there is a pattern:</p>\n\n<pre><code>zipWith (*)                     -- component-wise * on 1-d matrices\nzipWith (zipWith (*))           -- component-wise * on 2-d matrices\nzipWith (zipWith (zipWith (*))) -- component-wise * on 3-d matrices\n...\n</code></pre>\n\n<p>and of course <code>(*)</code> can be replaced by any binary operation.</p>\n\n<p>Some other list functions and their matrix interpretations:</p>\n\n<ul>\n<li>map - iterate over all of the rows</li>\n<li>transpose - transpose rows and columns</li>\n<li>concat - flatten the first dimension (i.e. all rows into a single row)</li>\n</ul>\n\n<p>As an exercise you might try implementing matrix multiplication with list operations.</p>\n"}, {"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 1, "last_activity_date": 1421842874, "last_edit_date": 1421842874, "creation_date": 1421785065, "answer_id": 28054395, "question_id": 28052902, "link": "https://stackoverflow.com/questions/28052902/how-to-analyse-a-function-in-haskell/28054395#28054395", "title": "How to analyse a function in Haskell?", "body": "<p>Left to right.</p>\n\n<p>In fact you can see it with 4 different point of view</p>\n\n<pre><code>zipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\n--  take a function, 2 list and returns a list\nzipWith (*)  :: [a] -&gt; [b] -&gt; [c]\n-- new function which takes 2 list and returns a new one\nzipWith (*) [1,2,3] :: [b] -&gt; [c]\n-- new function which takes a list a produce a new one\nzipPwith * [1,2,3] [3,5,6] :: [c]\n-- a function without argument, or a value (equivalent in Haskell)\n</code></pre>\n\n<p>Or right to left :-)</p>\n\n<pre><code>zipPwith * [1,2,3] [3,5,6] :: [c]\n-- a function without argument, or a value (equivalent in Haskell)    \nzipWith (*) [1,2,3] :: [b] -&gt; [c]\n-- new function which takes a list a produce a new one \nzipWith (*)  :: [a] -&gt; [b] -&gt; [c]\n-- new function which takes 2 list and returns a new one \nzipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\n--  take a function, 2 list and returns a list\n</code></pre>\n"}], "owner": {"reputation": 313, "user_id": 3103185, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/a9jDo.png?s=128&g=1", "display_name": "Ingako", "link": "https://stackoverflow.com/users/3103185/ingako"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 28053545, "answer_count": 4, "score": 2, "last_activity_date": 1421842874, "creation_date": 1421779562, "last_edit_date": 1421781131, "question_id": 28052902, "link": "https://stackoverflow.com/questions/28052902/how-to-analyse-a-function-in-haskell", "title": "How to analyse a function in Haskell?", "body": "<p>Hi everyone Haskell newbie here. I'm really confused about how to look at a curried function. </p>\n\n<p>For example, here is  a function definition</p>\n\n<pre><code>zipWith' :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nzipWith' _ [] _ = []\nzipWith' _ _ [] = []\nzipWith' f (x:xs) (y:ys) = f x y : zipWith' f xs ys\n</code></pre>\n\n<p>When I call</p>\n\n<pre><code>zipWith' (zipWith' (*)) [[1,2,3],[3,5,6]] [[3,2,2],[3,4,5]]\n</code></pre>\n\n<p>I understand that</p>\n\n<pre><code>zipWith' :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\n</code></pre>\n\n<p>is equivalent to </p>\n\n<pre><code>zipWith' :: (a -&gt; b -&gt; c) -&gt; ([a] -&gt; ([b] -&gt; [c]))\n</code></pre>\n\n<p>But what I don't understand is the way/order to look at it. Should we analyse it from left to right? Such as look at the (a -> b -> c) first and then apply the [a] in to the (a -> b -> c) and lastly apply ([b] -> [c]) into (a -> b -> c) -> [a]? Or is it the other way round? </p>\n\n<p>And if you don't understand what I'm asking (sorry :( ), could you just show me how you think when you see this kind of problems? I freak out whenever I see these functions and it usually takes me a while to figure out :P</p>\n"}, {"tags": ["haskell", "type-signature"], "comments": [{"owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 0, "creation_date": 1421779377, "post_id": 28052780, "comment_id": 44487541, "body": "Where exactly were you sticking that?"}, {"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "reply_to_user": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 0, "creation_date": 1421779865, "post_id": 28052780, "comment_id": 44487799, "body": "right before <code>isPalindrome [] = True</code>, directly beneath <code>where</code>"}, {"owner": {"reputation": 361, "user_id": 4011383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc91cbebfef922ecd15477c3a96d8f8f?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Seweryn", "link": "https://stackoverflow.com/users/4011383/michal-seweryn"}, "edited": false, "score": 3, "creation_date": 1421780200, "post_id": 28052780, "comment_id": 44487990, "body": "You have a typo. Shod be <code>(Eq a) =&gt;...</code> (arrow should be made with equal sign)"}, {"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 0, "creation_date": 1421780415, "post_id": 28052780, "comment_id": 44488109, "body": "That worked.  As did <code>largest :: (Ord a) =&gt; [a] -&gt; a</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1421783696, "post_id": 28052780, "comment_id": 44489917, "body": "By the way, <code>isPalindrome</code> has quadratic complexity when the simpler <code>\\x -&gt; x == reverse x</code> has linear complexity. It does not really matters, since we have only short inputs, of course."}], "answers": [{"comments": [{"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 0, "creation_date": 1421780597, "post_id": 28053193, "comment_id": 44488206, "body": "That worked.  So does <code>largest :: (Ord a) =&gt; [a] -&gt; a</code>"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 4, "last_activity_date": 1421780503, "creation_date": 1421780503, "answer_id": 28053193, "question_id": 28052780, "link": "https://stackoverflow.com/questions/28052780/haskell-type-signatures-with-varying-parameters/28053193#28053193", "title": "Haskell type signatures with varying parameters", "body": "<blockquote>\n  <p>You have a typo. [Should] be <code>(Eq a) =&gt;...</code> (arrow should be made with equal sign) \u2013  Michal Seweryn</p>\n</blockquote>\n\n<p>Class constraints are separated from the types they constrain with <code>=&gt;</code>.</p>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 28053193, "answer_count": 1, "score": 0, "last_activity_date": 1421780516, "creation_date": 1421779152, "last_edit_date": 1421779922, "question_id": 28052780, "link": "https://stackoverflow.com/questions/28052780/haskell-type-signatures-with-varying-parameters", "title": "Haskell type signatures with varying parameters", "body": "<p>Project Euler #4: A palindromic number reads the same both ways. The largest palindrome made from the product of two 2-digit numbers is 9009 = 91 \u00d7 99. Find the largest palindrome made from the product of two 3-digit numbers.</p>\n\n<p>This solution works:</p>\n\n<pre><code>p004largestPalindrome :: Integer\np004largestPalindrome = largest [ a * b | a &lt;- [100..999], b &lt;- [100..999], isPalindrome $ show(a*b) ]\n    where\n        isPalindrome [] = True\n        isPalindrome [_] = True\n        isPalindrome (x:xs) = if x == last xs then isPalindrome (init xs) else False\n        largest [] = 0\n        largest [x] = x\n        largest (x:xs) = if x &gt; head xs then largest (x:(tail xs)) else largest xs \n</code></pre>\n\n<p>My question is: can you assign type signatures to the functions in the <code>where</code> clause, given that the both have different arrangements of parameters ([], [x], (x:xs))?  Sticking in <code>isPalindrome :: (Eq a) -&gt; [a] -&gt; Bool</code> throws an error.</p>\n\n<p>Edit: I am trying to insert a type signature like so:</p>\n\n<pre><code>p004largestPalindrome :: Integer\np004largestPalindrome = largest [ a * b | a &lt;- [100..999], b &lt;- [100..999], isPalindrome $ show(a*b) ]\n    where\n        isPalindrome :: (Eq a) -&gt; [a] -&gt; Bool\n        isPalindrome [] = True\n        isPalindrome [_] = True\n        isPalindrome (x:xs) = if x == last xs then isPalindrome (init xs) else False\n        largest [] = 0\n        largest [x] = x\n        largest (x:xs) = if x &gt; head xs then largest (x:(tail xs)) else largest xs\n</code></pre>\n"}, {"tags": ["haskell", "io", "pretty-print"], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1421777119, "post_id": 28052063, "comment_id": 44486393, "body": "I think this deserves an explanation of why <code>type</code> is used instead of <code>data</code>. (<code>R</code> and <code>W</code> have no constructors)"}, {"owner": {"reputation": 2956, "user_id": 379181, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/EWoW0.png?s=128&g=1", "display_name": "Oso", "link": "https://stackoverflow.com/users/379181/oso"}, "edited": false, "score": 1, "creation_date": 1421778858, "post_id": 28052063, "comment_id": 44487281, "body": "It&#39;s a relief to know that I actually wasn&#39;t too far off. I&#39;ll mark this as accepted as soon as I can go home and try it myself."}], "tags": [], "owner": {"reputation": 361, "user_id": 4011383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc91cbebfef922ecd15477c3a96d8f8f?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Seweryn", "link": "https://stackoverflow.com/users/4011383/michal-seweryn"}, "is_accepted": true, "score": 2, "last_activity_date": 1421778030, "last_edit_date": 1421778030, "creation_date": 1421776661, "answer_id": 28052063, "question_id": 28051705, "link": "https://stackoverflow.com/questions/28051705/pretty-printing-2d-list-in-haskell-explanation-of-failure/28052063#28052063", "title": "Pretty-Printing 2D List in Haskell (Explanation of Failure)", "body": "<p>In your case the type should be <code>ppW :: W -&gt; IO ()</code>.  <code>()</code> (pronounced \"unit\") is a type which can have only one* value - namely <code>()</code>. So <code>IO ()</code> is an IO action which as a result gives no value (It is equivalence of void functions from C, C++ or Java).</p>\n\n<p>Here is some piece of code that should compile:</p>\n\n<pre><code>data X = Y | Z\n  deriving (Eq, Show)\n\ntype R = [X]\n\ntype W = [R]\n\nppR :: R -&gt; IO ()\nppR = putStrLn . show\n\nppW :: W -&gt; IO ()\nppW (w:[]) = ppR w\nppW (w:ws) = ppR w &gt;&gt; ppW ws\n</code></pre>\n\n<p>If you have any problem with types you can always use ghci to determine type of any function. Or you can simply look at the types of functions you are using:</p>\n\n<pre><code>putStrLn :: String -&gt; IO()\n(&gt;&gt;) :: IO a -&gt; IO b -&gt; IO b -- this is not exactly what ghci would tell you.\n</code></pre>\n\n<p>Edit:\nIn the code I included I used <code>type</code> instead of <code>data</code>. <code>type</code> defines a type synonym (it is like C/C++ typedef). It is easier to use them than to use <code>data</code> - <code>data</code> requires you to write explicitly the name of constructor, so you would have:</p>\n\n<pre><code>data R =  R [X]\n\nppR :: R -&gt; IO ()\nppR (R r)= putStrLn (show r)\n</code></pre>\n\n<p>*actually it can also be also bottom, but that's a different story.</p>\n"}], "owner": {"reputation": 2956, "user_id": 379181, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/EWoW0.png?s=128&g=1", "display_name": "Oso", "link": "https://stackoverflow.com/users/379181/oso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 323, "favorite_count": 0, "accepted_answer_id": 28052063, "answer_count": 1, "score": 1, "last_activity_date": 1421778030, "creation_date": 1421775364, "last_edit_date": 1495542510, "question_id": 28051705, "link": "https://stackoverflow.com/questions/28051705/pretty-printing-2d-list-in-haskell-explanation-of-failure", "title": "Pretty-Printing 2D List in Haskell (Explanation of Failure)", "body": "<p><a href=\"https://stackoverflow.com/questions/26546523/print-2d-list-of-lists-in-haskell\" title=\"Answers\">Answers</a> <a href=\"https://stackoverflow.com/questions/26546523/print-2d-list-of-lists-in-haskell\" title=\"exist\">exist</a> for <em>how</em> to pretty-print in Haskell, including how to do it with <a href=\"https://stackoverflow.com/questions/10292868/how-do-i-pretty-print-a-table-in-haskell\" title=\"packages\">packages</a>, but this is more a question about why my first approach failed.</p>\n\n<p>Given a 2D list of the form <code>w = [r,r1,r2]</code>, where w,r are of  respective data types <code>w::W</code>, <code>r::R</code> (simple vars for the example, not my actual naming convention):</p>\n\n<pre><code>data X = Y | Z\n         deriving (Eq, Show)\n\ndata R = [X]\n         deriving (Eq, Show)\n\ndata W = [R]\n         deriving (Eq, Show) \n</code></pre>\n\n<p>Why wouldn't either of the following approaches work? (I'm fully aware this will include the brackets and commas, that's not an issue)</p>\n\n<pre><code>ppR :: R -&gt; IO ()\nppR = putStrLn . show\n</code></pre>\n\n<p>and either</p>\n\n<pre><code>ppW :: W -&gt; IO W (?)\nppW (w:[]) = ppR w\nppW (w:ws) = ppR w &gt;&gt; ppW ws\n</code></pre>\n\n<p>or</p>\n\n<pre><code>ppW :: W -&gt; IO W (?)\nppW (w:[]) = putStrLn . show w\nppW (w:ws) = putStrLn . show w &gt;&gt; ppW ws\n</code></pre>\n\n<p>I don't quite know the types of <code>ppW</code>, I'm still learning. In addition to my clearly naive (lack of) understand of Haskell's handling of impure functions, I'm also stymied by the fact that the second approach to ppW typechecks (with no provided type).</p>\n\n<p>Why doesn't this approach work? Can you not recursively print a 2D list of indeterminate length in Haskell?</p>\n"}, {"tags": ["haskell", "induction"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 6, "creation_date": 1421763619, "post_id": 28047329, "comment_id": 44477381, "body": "Any thoughts of your own? Anything you&#39;ve tried? Surely, you have been given some example on how this kind of proof looks in general."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1421769326, "post_id": 28047329, "comment_id": 44481337, "body": "It seems that your code uses the <code>my_</code> prefix inconsistently. You should edit your question to remove them all, I guess."}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 4212131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d82e32fe33c16a821e748de945c5480?s=128&d=identicon&r=PG&f=1", "display_name": "Sohaib", "link": "https://stackoverflow.com/users/4212131/sohaib"}, "edited": false, "score": 0, "creation_date": 1421863679, "post_id": 28054542, "comment_id": 44527132, "body": "Is it better to separate the statement <code>foldl (+) ns = m + sum ns</code>, into LHS (Left Hand Statement) and RHS (Right Hand Statement) when proving or is it better to prove the statement all together like you have done?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 15, "user_id": 4212131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d82e32fe33c16a821e748de945c5480?s=128&d=identicon&r=PG&f=1", "display_name": "Sohaib", "link": "https://stackoverflow.com/users/4212131/sohaib"}, "edited": false, "score": 0, "creation_date": 1421878015, "post_id": 28054542, "comment_id": 44534399, "body": "What do you mean by that? We can transform the left side to the right, or the right side to the left, or both sides to some third expression; the goal is to show that the sides are equal."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 2, "last_activity_date": 1421786195, "last_edit_date": 1421786195, "creation_date": 1421785642, "answer_id": 28054542, "question_id": 28047329, "link": "https://stackoverflow.com/questions/28047329/structural-induction-and-induction-hypothesis-in-haskell/28054542#28054542", "title": "Structural Induction and Induction Hypothesis in Haskell", "body": "<p>We would like to prove that for all <code>ns</code> and <code>m</code>, <code>foldl (+) m ns = m + sum ns</code>. We shall proceed by induction on <code>ns</code>. In other words, we prove that the property holds for the empty list, and holds for <code>n:ns</code> whenever it holds for <code>ns</code>. </p>\n\n<p>First, let's see the empty list, and let <code>m</code> be an arbitrary number. Our goal is to prove <code>foldl (+) m [] = m + sum []</code>. There are many ways to do this, but we will proceed by transforming the left side of the equation into the right side by equational reasoning.</p>\n\n<pre><code>foldl (+) m []  -- by definition of foldl\nm               -- by right identity of addition\nm + 0           -- by the definition of sum\nm + sum []      -- QED\n</code></pre>\n\n<p>Now for the <code>(:)</code> case. Let our list be <code>n:ns</code>. Suppose that the property holds for <code>ns</code> for any <code>m</code> (this is the induction hypothesis). Our goal is to prove <code>foldl (+) m (n:ns) = m + sum (n:ns)</code>. Again, we use equational reasoning.</p>\n\n<pre><code>foldl (+) m (n:ns)    -- by the definition of foldl\nfoldl (+) (m + n) ns  -- by the induction hypothesis, applied to (m + n)\n(m + n) + sum ns      -- by associativity of addition\nm + (n + sum ns)      -- by the definition of sum\nm + sum (n:ns)        -- QED\n</code></pre>\n\n<p>And we're done. </p>\n\n<hr>\n\n<p>A common issue among new students of proof writing is that they're not sure if what they're doing actually makes sense, and this makes them nervous. I recommend taking a look at proof assistants such as <a href=\"http://wiki.portal.chalmers.se/agda/pmwiki.php\" rel=\"nofollow\">Agda</a> or <a href=\"https://coq.inria.fr/\" rel=\"nofollow\">Coq</a>. They are excellent for building proof-writing skill. As a small example of Agda, the above proof can be written very similarly there, with some syntactic differences:</p>\n\n<pre><code>-- imports omitted\n\nprop : forall m ns \u2192 foldl (_+_) m ns \u2261 m + sum ns\n\nprop m [] = begin\n  foldl (_+_) m []     \u2261\u27e8\u27e9 \n  m                    \u2261\u27e8 sym $ +-right-identity m \u27e9\n  m + 0                \u2261\u27e8\u27e9\n  m + sum []           \u220e\n\nprop m (x \u2237 ns) = begin \n  foldl _+_ m (x \u2237 ns)     \u2261\u27e8\u27e9\n  foldl _+_ (m + x) ns     \u2261\u27e8 prop (m + x) ns \u27e9  \n  (m + x) + sum ns         \u2261\u27e8 +-assoc m x (sum ns) \u27e9 \n  m + (x + sum ns)         \u2261\u27e8\u27e9\n  m + sum (x \u2237 ns)         \u220e\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 4212131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d82e32fe33c16a821e748de945c5480?s=128&d=identicon&r=PG&f=1", "display_name": "Sohaib", "link": "https://stackoverflow.com/users/4212131/sohaib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 632, "favorite_count": 0, "protected_date": 1421939798, "accepted_answer_id": 28054542, "answer_count": 1, "score": 0, "last_activity_date": 1421938259, "creation_date": 1421762738, "last_edit_date": 1421863093, "question_id": 28047329, "link": "https://stackoverflow.com/questions/28047329/structural-induction-and-induction-hypothesis-in-haskell", "title": "Structural Induction and Induction Hypothesis in Haskell", "body": "<p>I am trying to prove <strong>'ns'</strong> with the statement below using structual induction. All lists <strong>'ns'</strong> are of type <strong>[Int]</strong> and all <strong>'m'</strong> are of type <strong>Int</strong>.</p>\n\n<pre><code>foldl (+) m ns = m + (sum ns)\n</code></pre>\n\n<p>Definitions:</p>\n\n<pre><code>sum :: [Int] -&gt; Int         -- summation of an Int list\nsum []     = 0              -- s.1\nsum (x:xs) = x + (sum xs)   -- s.2\n\nfoldl :: (a -&gt; b -&gt; a) -&gt; a -&gt; [b] -&gt; a    -- fold left\nfoldl _ s []     = s                       -- fl.1\nfoldl f s (x:xs) = foldl f (f s x) xs      -- fl.2\n</code></pre>\n\n<p>It would be grateful if someone can help me out on this.</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 3, "creation_date": 1421763777, "post_id": 28047250, "comment_id": 44477496, "body": "Lucky for you a very similar question was asked the other day, although I can see why it would be hard to find it in search.  I&#39;ve marked it as duplicate since the desired outcome is essentially the same and you can achieve what you want to do with the flag shown."}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421764276, "post_id": 28047250, "comment_id": 44477833, "body": "thanks, that was quick and helpful."}], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 32, "favorite_count": 0, "closed_date": 1421763712, "answer_count": 0, "score": 1, "last_activity_date": 1421762558, "creation_date": 1421762558, "question_id": 28047250, "link": "https://stackoverflow.com/questions/28047250/for-a-module-that-contains-errors-can-ghci-process-its-import-declarations-only", "closed_reason": "Duplicate", "title": "For a module that contains errors, can ghci process its import declarations only?", "body": "<p>Is it possible to have ghci (or cabal repl) load only the imports of a module?</p>\n\n<p>If I load a module (from source) that contains some error, then the ghci session has the scope of the last module that was loaded successfully (?).</p>\n\n<p>But to debug the current module, I want to be in its scope (i.e., have all its imports available).</p>\n"}, {"tags": ["haskell", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 24454, "user_id": 446822, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nKNHD.jpg?s=128&g=1", "display_name": "Gus", "link": "https://stackoverflow.com/users/446822/gus"}, "edited": false, "score": 0, "creation_date": 1421766056, "post_id": 28046877, "comment_id": 44479115, "body": "Thanks for your answer but I was more interested in the reason it was implemented that way than in a code review of my sample code. I want to know why that bind strategy was adopted. I don&#39;t think it was because of the types, the types are usually decided in function of the bind strategy, not the opposite. You can swap the order of the type variables but forget the details, the main question it&#39;s in the title."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 24454, "user_id": 446822, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nKNHD.jpg?s=128&g=1", "display_name": "Gus", "link": "https://stackoverflow.com/users/446822/gus"}, "edited": false, "score": 0, "creation_date": 1421768933, "post_id": 28046877, "comment_id": 44481056, "body": "@Gustavo If you want to <code>instance Monad m =&gt; Monad (ContT r m)</code> then the return and bind operation <i>must</i> have exactly those types. Maybe your actual question is &quot;why isn&#39;t <code>ContT r m a</code> defined as <code>(m a -&gt; m r) -&gt; m r</code>&quot; or something similar that would allow your binding function? If so, you should be clear about it in your question since I thought it was about <code>ContT</code> as we know it (except for the bind/return), and not about a different monad transformer. If possible, propose a type you would use for <code>ContT</code>."}, {"owner": {"reputation": 24454, "user_id": 446822, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nKNHD.jpg?s=128&g=1", "display_name": "Gus", "link": "https://stackoverflow.com/users/446822/gus"}, "edited": false, "score": 0, "creation_date": 1421770781, "post_id": 28046877, "comment_id": 44482448, "body": "Thanks @chi. In fact I don&#39;t want anything ;) Looks like by providing more details I was misunderstood. I&#39;m not proposing anything, may be I should delete my code. I just want to know why it was decided to work that way which is very different to the other monad transformers. There must be a good reason to break the analogy, specially with the Functor and Applicative."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1421761533, "creation_date": 1421761533, "answer_id": 28046877, "question_id": 28046173, "link": "https://stackoverflow.com/questions/28046173/why-contt-doesnt-deal-with-the-inner-monad/28046877#28046877", "title": "Why ContT doesn&#39;t deal with the inner monad?", "body": "<p>Let's check the types for the proposed implementation of <code>(&gt;&gt;=)</code>:</p>\n\n<pre><code>&gt; let foo x f = ContT (\\k -&gt; runContT x ((=&lt;&lt;) (\\a -&gt; runContT (f a) k)))\n&gt; :t foo\nfoo\n  :: Monad m =&gt;\n     ContT r m (m a) -&gt; (a -&gt; ContT r m a1) -&gt; ContT r m a1\n     ^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>That should be <code>ContT r m a</code> to match the type for <code>(&gt;&gt;=)</code>.</p>\n\n<p>Similarly for <code>return</code>:</p>\n\n<pre><code>&gt; let bar  x = ContT ($ (return x))\n&gt; :t bar\nbar :: Monad m1 =&gt; a -&gt; ContT r m (m1 a)\n                        ^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>There's an extra <code>m1</code> above.</p>\n"}, {"comments": [{"owner": {"reputation": 24454, "user_id": 446822, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nKNHD.jpg?s=128&g=1", "display_name": "Gus", "link": "https://stackoverflow.com/users/446822/gus"}, "edited": false, "score": 0, "creation_date": 1422117192, "post_id": 28048886, "comment_id": 44628257, "body": "Thanks. I&#39;m marking this as answered for now. But I&#39;m happy to switch to another answer if someone provide more details"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 1, "creation_date": 1476930675, "post_id": 28048886, "comment_id": 67558652, "body": "<code>ContT r m</code> is actually a monad even when <code>m</code> isn&#39;t. This is actually used in the <code>Text.ParserCombinators.ReadP</code> module: <code>ReadP</code> is basically <code>forall r . ContT r P</code>. <code>P</code> does have a <code>Monad</code> instance but not a valid one, but the <code>Monad</code> instance for <code>ReadP</code> is valid."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 6, "last_activity_date": 1421767026, "creation_date": 1421767026, "answer_id": 28048886, "question_id": 28046173, "link": "https://stackoverflow.com/questions/28046173/why-contt-doesnt-deal-with-the-inner-monad/28048886#28048886", "title": "Why ContT doesn&#39;t deal with the inner monad?", "body": "<p><code>(&gt;&gt;=)</code> doesn't need to deal with the inner monad (besides that it's not possible to implement it in a way you proposed, as chi showed), because we can just <code>lift</code> monadic values and get the desired semantics.</p>\n\n<pre><code>lift :: Monad m =&gt; m a -&gt; ContT r m a\nlift ma = ContT (ma &gt;&gt;=)\n</code></pre>\n\n<p>Or as it is in the standard <a href=\"https://hackage.haskell.org/package/transformers-0.4.2.0/docs/Control-Monad-Trans-Cont.html\">library</a>:</p>\n\n<pre><code>instance MonadTrans (ContT r) where\n    lift m = ContT (m &gt;&gt;=)\n</code></pre>\n\n<p>Now we have</p>\n\n<pre><code>import Control.Monad.Trans.Cont\nimport Control.Monad.Trans.Class\n\ntest :: ContT r [] Int\ntest = do\n  x &lt;- lift [1, 2]\n  y &lt;- lift [10, 20]\n  return (x + y)\n\n-- evalContT test == [11, 21, 12, 22]\n</code></pre>\n\n<p>In other words, with the standard monad instance for ContT we can already manipulate the current continuations <em>arbitrarily</em>, so alternative implementations could hardly buy us anything. </p>\n"}], "owner": {"reputation": 24454, "user_id": 446822, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nKNHD.jpg?s=128&g=1", "display_name": "Gus", "link": "https://stackoverflow.com/users/446822/gus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 28048886, "answer_count": 2, "score": 5, "last_activity_date": 1421767026, "creation_date": 1421759374, "last_edit_date": 1421765441, "question_id": 28046173, "link": "https://stackoverflow.com/questions/28046173/why-contt-doesnt-deal-with-the-inner-monad", "title": "Why ContT doesn&#39;t deal with the inner monad?", "body": "<p>The bind strategy for <code>ContT</code> ignores the inner monad, in fact the code is the same as for <code>Cont</code>.</p>\n\n<p>Following the analogy from other Monad Transformers I would have implemented it this way:</p>\n\n<pre><code>return x = ContT ($ (return x))\n(&gt;&gt;=) x f = ContT (\\k -&gt; runContT x ((=&lt;&lt;) (\\a -&gt; runContT (f a) k)))\n</code></pre>\n\n<p>Then for example this expression:</p>\n\n<pre><code>do \n    x1 &lt;- ContT (\\k -&gt; k [1, 2])\n    x2 &lt;- ContT (\\k -&gt; k [10, 20])\n    return ((+) x1 x2) \n</code></pre>\n\n<p>Would result in <code>[11, 21, 12, 22]</code></p>\n\n<p>My question is what was the reason behind that design decision? Why was it implemented that way, which makes it very different from other Monad Transformers, note that the functor instance is:</p>\n\n<pre><code>fmap f m = ContT $ \\c -&gt; runContT m (c . f)\n</code></pre>\n\n<p>rather than:</p>\n\n<pre><code>fmap f m = ContT $ runCont $ (fmap . fmap) f (Cont (runContT m))\n</code></pre>\n\n<p>which is more or less the same as for other Monad Transformers, but the current implementation seems to break the functor composition, I mean since monads do not compose automatically we may have discussions about different bind strategies but for functors and applicatives it should always be the same and here it seems to be quite different. Was it a hack to get some code which represent more use cases working?</p>\n\n<p>Even <a href=\"http://hackage.haskell.org/package/transformers-0.2.2.0/docs/src/Control-Monad-Trans-Identity.html#IdentityT\" rel=\"nofollow\">IdentityT</a> works that way, but I read that the bind strategy for <code>Cont</code> is in fact the same as for <code>Identity</code>, so what about <code>ContT</code> and <code>IdentityT</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 8390, "user_id": 1404049, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/vkpuK.png?s=128&g=1", "display_name": "Fallenreaper", "link": "https://stackoverflow.com/users/1404049/fallenreaper"}, "edited": false, "score": 0, "creation_date": 1421759033, "post_id": 28045969, "comment_id": 44474440, "body": "Regular expressions?"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 4274735, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/246a16d5153d6c5306327cbb9ef5e161?s=128&d=identicon&r=PG&f=1", "display_name": "user4274735", "link": "https://stackoverflow.com/users/4274735/user4274735"}, "edited": false, "score": 0, "creation_date": 1421759145, "post_id": 28046033, "comment_id": 44474516, "body": "Can you a bit more specific please? Like a line of code if I can ask? :-)"}], "tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": true, "score": 5, "last_activity_date": 1421759246, "last_edit_date": 1421759246, "creation_date": 1421758909, "answer_id": 28046033, "question_id": 28045969, "link": "https://stackoverflow.com/questions/28045969/string-contains-char-and-return-strings-haskell/28046033#28046033", "title": "String contains char and return strings Haskell", "body": "<p>You could combine <code>words</code>, <code>filter</code> and <code>elem</code> to do that.</p>\n\n<p>Something like this - haven't tested if this exactly works, but it shouldn't be far off:</p>\n\n<pre><code>wordsContaining :: String -&gt; Char -&gt; [String]\nwordsContaining c = filter (elem c) . words\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 4274735, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/246a16d5153d6c5306327cbb9ef5e161?s=128&d=identicon&r=PG&f=1", "display_name": "user4274735", "link": "https://stackoverflow.com/users/4274735/user4274735"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 28046033, "answer_count": 1, "score": -3, "last_activity_date": 1421759359, "creation_date": 1421758677, "last_edit_date": 1421759359, "question_id": 28045969, "link": "https://stackoverflow.com/questions/28045969/string-contains-char-and-return-strings-haskell", "title": "String contains char and return strings Haskell", "body": "<p>Let's say:</p>\n\n<pre><code>let someString = \"It is a String\"\n</code></pre>\n\n<p>How can I return the words which contain a certain char?</p>\n"}, {"tags": ["haskell", "design-patterns"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 11, "creation_date": 1421758043, "post_id": 28045697, "comment_id": 44473847, "body": "The abstract factory pattern is more or less a ridiculously convoluted way of working yourself around a language&#39;s inability so simply define <b>a function</b>. Why would you need that in Haskell? \u2014 More objective remark: Haskell type classes are <i>not</i> a good drop-in for something that&#39;s a class in an OO language. If you want to model something like Abstract Factory in Haskell, you&#39;d probably better use <code>data</code> for the &quot;classes&quot;."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1421758467, "post_id": 28045697, "comment_id": 44474111, "body": "The type of <code>createProduct</code> indicates it can create any instance of <code>Product</code> while the implementation can only return instances of <code>FirstProduct</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1421758622, "post_id": 28045697, "comment_id": 44474201, "body": "For more info on how to (not) do OO in Haskell, consider <a href=\"https://www.haskell.org/haskellwiki/OOP_vs_type_classes\" rel=\"nofollow noreferrer\">haskell.org/haskellwiki/OOP_vs_type_classes</a>,  <a href=\"http://stackoverflow.com/questions/20184286/object-oriented-programming-in-haskell/20188103\" title=\"object oriented programming in haskell\">stackoverflow.com/questions/20184286/&hellip;</a>, and <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">lukepalmer.wordpress.com/2010/01/24/&hellip;</a>."}, {"owner": {"reputation": 3076, "user_id": 371457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d6bc4763d6dbbdfec8d891ae57ab71bb?s=128&d=identicon&r=PG", "display_name": "frm", "link": "https://stackoverflow.com/users/371457/frm"}, "edited": false, "score": 0, "creation_date": 1421758637, "post_id": 28045697, "comment_id": 44474208, "body": "I could use <code>data</code> to define sets of factories and products, but this would limit the extensibility of my system. If I define <code>data Factory = FirstFactory | SecondFactory</code>, then my library is only limited to those two implementations. I would like instead to define a <code>Factory</code> API I could rely on, so that users of my library could provide different implementations of it. Can you explain how to use functions to achieve a similar goal?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1421758921, "post_id": 28045697, "comment_id": 44474386, "body": "No no, you just define one record: for all that&#39;s <i>needed</i> from <code>Product</code>, i.e. for the results of all its <i>interface methods</i>. (In your example, this is basically just a single <code>String</code>). Everything that would have to be fields or methods of derived classes isn&#39;t really needed in Haskell: that kind of stuff can be automatically packed in closures of the functions (&quot;factories&quot;) with which you generate your <code>Product</code>s. It&#39;s actually a lot like the &quot;ad-hoc-object-orientation&quot; that some dynamic languages offer."}], "answers": [{"comments": [{"owner": {"reputation": 3076, "user_id": 371457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d6bc4763d6dbbdfec8d891ae57ab71bb?s=128&d=identicon&r=PG", "display_name": "frm", "link": "https://stackoverflow.com/users/371457/frm"}, "edited": false, "score": 0, "creation_date": 1421762047, "post_id": 28046606, "comment_id": 44476330, "body": "This seems interesting, but as you stated before my problem could be solved with much simpler constructs. I edited my question to add another solution that came to my mind. Anyway, today I definitely learnt something!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1421761227, "last_edit_date": 1421761227, "creation_date": 1421760690, "answer_id": 28046606, "question_id": 28045697, "link": "https://stackoverflow.com/questions/28045697/abstract-factories-in-haskell/28046606#28046606", "title": "Abstract factories in Haskell", "body": "<p><em>As I already commented, the whole idea is futile: you don't need abstract factories in Haskell. But that aside, here's why your particular attempt doesn't compile.</em></p>\n\n<hr>\n\n<p>The signature</p>\n\n<pre><code>  createProduct :: Product p =&gt; f -&gt; p\n</code></pre>\n\n<p>means not what you apparently think: in Java, this would say \"I'll generate some object of a subclass of <code>Product</code>, don't ask which though.\" In Haskell &ndash; whose subclasses are <em>not</em> subtypes! &ndash; this means, \"for <em>any</em> (specific!) instance of <code>Product</code> that you request, I'll give you an object of that concrete type.\" Which isn't possible, since <code>FirstFactory</code> apparently can't supply a <code>SecondProduct</code>.</p>\n\n<p>To express what you tried to say, you need an explicit wrapper to contain \"any subclass\". We call that an <em>existential</em>, it's written thus:</p>\n\n<pre><code>{-# LANGUAGE GADTs       #-}\n\ndata AnyProduct where\n  AnyProduct :: Product p =&gt; p -&gt; AnyProduct\n</code></pre>\n\n<p>with this, you can write</p>\n\n<pre><code>class Factory f where\n  createProduct :: f -&gt; AnyProduct\n</code></pre>\n\n<p>For some <code>yourProduct :: AnyProduct</code>, you can then \"call the <code>toString</code> method\" this way:</p>\n\n<pre><code>      ...\n      productString = case yourProduct of\n                        AnyProduct p -&gt; toString p\n      ...\n</code></pre>\n\n<p>But since this is actually <em>the only thing</em> you can do with an <code>AnyProduct</code> value (like in OO language, you can't access fields/methods of the unknown subclass), the whole <code>AnyProduct</code> type is actually completely equivalent to <code>String</code> alone! And by the same argument, <code>AnyFactory</code> would again be equivalent to that. So basically, the entire code you posted is equivalent to</p>\n\n<pre><code>type Product = String\n</code></pre>\n\n<p>...</p>\n\n<p>Existentials are quite <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"noreferrer\">generally frowned upon</a>, you should only use them in special cases, not for anything just because OO languages do it with subclassing.</p>\n"}], "owner": {"reputation": 3076, "user_id": 371457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d6bc4763d6dbbdfec8d891ae57ab71bb?s=128&d=identicon&r=PG", "display_name": "frm", "link": "https://stackoverflow.com/users/371457/frm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 777, "favorite_count": 0, "accepted_answer_id": 28046606, "answer_count": 1, "score": 0, "last_activity_date": 1421761892, "creation_date": 1421757806, "last_edit_date": 1421761892, "question_id": 28045697, "link": "https://stackoverflow.com/questions/28045697/abstract-factories-in-haskell", "title": "Abstract factories in Haskell", "body": "<p>I was wondering how to implement the Abstract Factory design pattern, common in object-oriented languages, in a functional language. In particular, I am interested in an Haskell implementation.</p>\n\n<p>I tried to implement the pattern using type classes:</p>\n\n<pre><code>class Product p where\n  toString :: p -&gt; String\n\nclass Factory f where\n  createProduct :: Product p =&gt; f -&gt; p\n\ndata FirstProduct = FirstProduct\ndata FirstFactory = FirstFactory\n\ninstance Product FirstProduct where\n  toString _ = \"first product\"\n\ninstance Factory FirstFactory where\n  createProduct _ = FirstProduct\n</code></pre>\n\n<p>When compiling this code, the following error is returned instead:</p>\n\n<pre><code>Could not deduce (p ~ FirstProduct)\nfrom the context (Product p)\n  bound by the type signature for\n             createProduct :: Product p =&gt; FirstFactory -&gt; p\n  at test.hs:14:3-15\n  \u2018p\u2019 is a rigid type variable bound by\n      the type signature for\n        createProduct :: Product p =&gt; FirstFactory -&gt; p\n      at test.hs:14:3\nRelevant bindings include\n  createProduct :: FirstFactory -&gt; p (bound at test.hs:14:3)\nIn the expression: FirstProduct\nIn an equation for \u2018createProduct\u2019: createProduct _ = FirstProduct\n</code></pre>\n\n<p>It looks like the compiler is not happy with the implementation of <code>createProduct</code>, and in particular with its return value. I though that returning any instance of the <code>Product</code> type class could do the trick, but it obviously doesn't.</p>\n\n<p>I would like to know if something similar to an Abstract Factory can be implemented in Haskell or if my approach is completely wrong. Are there any other \"patterns\" I could use to achieve a similar result?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>According to the suggestions and explanations of leftaroundabout, I came up with a different solution that fulfills my needs without misusing type classes. The solution could be probably be improved, but at the moment this is the best I was able to achieve.</p>\n\n<p>The library would have to define something similar to the following:</p>\n\n<pre><code>data ProductSystem p = ProductSystem {create :: p, toString :: p -&gt; String }\n\nproductUser :: ProductSystem p -&gt; String\nproductUser system = toString system $ create system\n</code></pre>\n\n<p>Some users of the library could provide \"implementations\" of the <code>ProductSystem</code> for their concrete needs:</p>\n\n<pre><code>data FirstProduct = FirstProduct\n\nfirstSystem :: ProductSystem FirstProduct\nfirstSystem = ProductSystem create toString\n  where \n    create = FirstProduct\n    toString p = \"first\"\n\ndata SecondProduct = SecondProduct\n\nsecondSystem :: ProductSystem SecondProduct\nsecondSystem = ProductSystem create toString\n  where\n    create = SecondProduct\n    toString p = \"second\"\n</code></pre>\n\n<p>Somewhere else, the two pieces could be unified to execute the wanted behavior:</p>\n\n<pre><code>productUser firstSystem\nproductUser secondSystem\n</code></pre>\n"}, {"tags": ["haskell", "read-eval-print-loop", "ghci"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1421751483, "post_id": 28043568, "comment_id": 44469988, "body": "A related question would be how to get the output of commands like <code>:browse</code>, or of tab-auto-completion, into a usable Haskell list."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421756714, "post_id": 28043568, "comment_id": 44473081, "body": "This is about adding <code>history :: IO [String]</code> to GHCi, right? AFAIK, there&#39;s no such feature. For <code>:browse</code>, I wonder if <code>Distribution.HaskellSuite.Modules</code> can do."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421757136, "post_id": 28043568, "comment_id": 44473344, "body": "Yes, that&#39;s pretty much what I&#39;m looking for. Something like <code>searchHistory :: (String -&gt; Bool) -&gt; IO ()</code> would perhaps be even more useful (to prepend a matching command &quot;forward&quot; so it can then be accessed and executed with up-arrow), though that idea does seem a bit procedural/destructive."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1421764165, "post_id": 28043568, "comment_id": 44477740, "body": "@leftaroundabout: You&#39;re aware that there&#39;s reverse-search? Ctrl+R, as in bash. Is this what you&#39;re looking for?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1421765274, "post_id": 28043568, "comment_id": 44478545, "body": "@Zeta: Whoa, it&#39;s as simple as that?? Well, I should have tried that myself shouldn&#39;t I... wonder, should I close the question, or rephrase it to focus on string-reading history or other stuff, or will you just post <code>ctrl+r</code> as an answer?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421765451, "post_id": 28043568, "comment_id": 44478688, "body": "@leftaroundabout As per my answer that I posted about the same time you made your last comment, you can actually get the history from previous GHCi sessions as a <code>[String]</code> if that&#39;s what you really want, but <code>CTRL+R</code> is definitely the more useful route.  I use it pretty much constantly, particularly because it works in more than just GHCi, bash and IPython support it too."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1421790088, "post_id": 28048252, "comment_id": 44493064, "body": "I&#39;ll still accept this as answer to the question as I phrased it (though, as you said yourself, <code>ctrl+r</code> is a much better solution for the actual <i>problem</i> at hand)."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 2, "last_activity_date": 1421765317, "creation_date": 1421765317, "answer_id": 28048252, "question_id": 28043568, "link": "https://stackoverflow.com/questions/28043568/is-there-a-simple-way-to-access-the-repl-history-e-g-as-a-list-from-within-gh/28048252#28048252", "title": "Is there a simple way to access the REPL history (e.g. as a list) from within GHCi?", "body": "<p>There's probably a better way to do this that's more cross-platform way that could be developed into a nice little package to load in a .ghci file or something, but the quick and dirty way using <code>haskeline</code> is pretty simple.  You can just read in the <code>ghci_history</code> file for your system, mine is located at <code>C:/Users/bheklilr/AppData/Roaming/ghc/ghci_history</code>, but I believe on a *nix system it should be at <code>~/.ghci_history</code>.  Pick whichever is appropriate for your system.</p>\n\n<pre><code>&gt; import System.Console.Haskeline.History\n&gt; hist &lt;- fmap $ readHistory \"path/to/ghci_history\"\n&gt; putStrLn $ unlines hist\n</code></pre>\n\n<p>Unfortunately, at least for me, it seems that the history file is not updated until GHCi exits, so for a particular session <code>hist</code> should be the same (provided you only have one instance of GHCi).  This is a pretty limited API in my opinion, I think it wouldn't be too hard to dump the history on each command or at least every couple commands, but this is not done.</p>\n\n<p>Alternatively, you can use <code>CTRL-R</code> and a handful of other commands to search your history, it's a lot more useful.  It's especially useful because it'll search for matching subtext.</p>\n"}], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 440, "favorite_count": 1, "accepted_answer_id": 28048252, "answer_count": 1, "score": 8, "last_activity_date": 1421765317, "creation_date": 1421751390, "question_id": 28043568, "link": "https://stackoverflow.com/questions/28043568/is-there-a-simple-way-to-access-the-repl-history-e-g-as-a-list-from-within-gh", "title": "Is there a simple way to access the REPL history (e.g. as a list) from within GHCi?", "body": "<p>Other REPLs, <a href=\"https://www.gnu.org/software/octave/doc/interpreter/Commands-For-History.html\">e.g. Octave</a>, have dedicated commands for browsing the command history. I find that quite handy (though whenever I use such a feature I ask myself, <em>why didn't I properly define that command in a file in the first place</em>?).</p>\n\n<p>GHCi seems to have no such feature, and I think it probably shouldn't &ndash; such interactivity would make endevours like control from Emacs more troublesome than they are already.</p>\n\n<p>However, it sounds like a rather trivial task to simply fetch <em>the entire history</em>, and then use ordinary Haskell to browse it. Has anything like that been implemented anywhere yet?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 0, "creation_date": 1421751520, "post_id": 28043562, "comment_id": 44470017, "body": "<code>map length [filter (&#47;= &#39; &#39;) someString]</code> - does this compile?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 0, "creation_date": 1421751562, "post_id": 28043562, "comment_id": 44470046, "body": "@shree.pat18 It does, but it will always return <code>[&lt;length of non space chars&gt;]</code> if I am not mistaken. It is equivalent to <code>return . filter (&#47;= &#39; &#39;) someString :: [Int]</code>"}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1421751696, "post_id": 28043562, "comment_id": 44470115, "body": "@ThreeFx My bad, missed the space and got parse error. But it won&#39;t always return [1]."}, {"owner": {"reputation": 31, "user_id": 4274735, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/246a16d5153d6c5306327cbb9ef5e161?s=128&d=identicon&r=PG&f=1", "display_name": "user4274735", "link": "https://stackoverflow.com/users/4274735/user4274735"}, "edited": false, "score": 0, "creation_date": 1421751704, "post_id": 28043562, "comment_id": 44470121, "body": "yes it does and returns the length of the non space chars. But I wish to remove some other chars like the ! and so on."}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 0, "creation_date": 1421751740, "post_id": 28043562, "comment_id": 44470144, "body": "@user4274735 Why are you using <code>map length</code>? <code>filter</code> will return the string just fine."}, {"owner": {"reputation": 31, "user_id": 4274735, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/246a16d5153d6c5306327cbb9ef5e161?s=128&d=identicon&r=PG&f=1", "display_name": "user4274735", "link": "https://stackoverflow.com/users/4274735/user4274735"}, "edited": false, "score": 0, "creation_date": 1421751775, "post_id": 28043562, "comment_id": 44470159, "body": "because I wish to know the length of the string. any string..."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 4274735, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/246a16d5153d6c5306327cbb9ef5e161?s=128&d=identicon&r=PG&f=1", "display_name": "user4274735", "link": "https://stackoverflow.com/users/4274735/user4274735"}, "edited": false, "score": 0, "creation_date": 1421751905, "post_id": 28043604, "comment_id": 44470230, "body": "Thanks that will do the trick! Is it possible to add a range of char like a-Z using flip?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 31, "user_id": 4274735, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/246a16d5153d6c5306327cbb9ef5e161?s=128&d=identicon&r=PG&f=1", "display_name": "user4274735", "link": "https://stackoverflow.com/users/4274735/user4274735"}, "edited": false, "score": 1, "creation_date": 1421751968, "post_id": 28043604, "comment_id": 44470277, "body": "@user4274735 Just use <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Data-Char.html\" rel=\"nofollow noreferrer\"><code>Data.Char</code></a>&#39;s <code>isLetter</code> for that."}, {"owner": {"reputation": 31, "user_id": 4274735, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/246a16d5153d6c5306327cbb9ef5e161?s=128&d=identicon&r=PG&f=1", "display_name": "user4274735", "link": "https://stackoverflow.com/users/4274735/user4274735"}, "edited": false, "score": 0, "creation_date": 1421752256, "post_id": 28043604, "comment_id": 44470448, "body": "I hope you do not mind me to ask this but how would it look like using isLetter?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 31, "user_id": 4274735, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/246a16d5153d6c5306327cbb9ef5e161?s=128&d=identicon&r=PG&f=1", "display_name": "user4274735", "link": "https://stackoverflow.com/users/4274735/user4274735"}, "edited": false, "score": 0, "creation_date": 1421752307, "post_id": 28043604, "comment_id": 44470480, "body": "@user4274735 <code>isLetter x</code> returns <code>True</code> if x is a letter, else it is <code>False</code>. To invert it, just use <code>not . isLetter</code>."}, {"owner": {"reputation": 31, "user_id": 4274735, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/246a16d5153d6c5306327cbb9ef5e161?s=128&d=identicon&r=PG&f=1", "display_name": "user4274735", "link": "https://stackoverflow.com/users/4274735/user4274735"}, "edited": false, "score": 0, "creation_date": 1421752511, "post_id": 28043604, "comment_id": 44470602, "body": "Well thanks I used like: map length [filter (isLetter) someString] and it did the trick thanks again!"}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 4, "last_activity_date": 1421752107, "last_edit_date": 1421752107, "creation_date": 1421751489, "answer_id": 28043604, "question_id": 28043562, "link": "https://stackoverflow.com/questions/28043562/haskell-filter-more-than-one-char/28043604#28043604", "title": "Haskell filter more than one char", "body": "<p>You can just do:</p>\n\n<pre><code>filter (not . flip elem \"&lt;your chars here&gt;\")\n</code></pre>\n\n<p>Example: </p>\n\n<pre><code>ghci&gt; filter (not . flip elem \" .,\") \"This is an example sentence, which uses punctuation.\"\n\"Thisisanexamplesentencewhichusespunctuation\"\n</code></pre>\n\n<p>Just to put the comment in here: To filter out letters of both cases (a-z and A-Z), you should probably use <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Data-Char.html\" rel=\"nofollow\"><code>Data.Char</code></a>'s <code>isLetter</code> function.</p>\n"}, {"tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": false, "score": 1, "last_activity_date": 1421752281, "last_edit_date": 1421752281, "creation_date": 1421751962, "answer_id": 28043770, "question_id": 28043562, "link": "https://stackoverflow.com/questions/28043562/haskell-filter-more-than-one-char/28043770#28043770", "title": "Haskell filter more than one char", "body": "<p>An alternative is to use a fold to get the length, if you don't actually need to return the filtered string but only want its length.</p>\n\n<pre><code>f x charlist = foldl (\\acc x -&gt; if not $ x `elem` charlist then acc + 1 else acc) 0 x\n</code></pre>\n\n<p><code>charlist</code> is your list of banned characters. If you have a fixed list always, you can directly define it as a top-level value and use it in the function body instead of passing it as a parameter.</p>\n\n<p>A more concise version using list comprehensions:</p>\n\n<pre><code>f x = length [z | z &lt;- x, notElem z charlist]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 40039, "user_id": 699224, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4feb08afcd7c57acb72bd49fc2bf834d?s=128&d=identicon&r=PG", "display_name": "DNA", "link": "https://stackoverflow.com/users/699224/dna"}, "is_accepted": false, "score": 4, "last_activity_date": 1421780576, "last_edit_date": 1421780576, "creation_date": 1421752111, "answer_id": 28043825, "question_id": 28043562, "link": "https://stackoverflow.com/questions/28043562/haskell-filter-more-than-one-char/28043825#28043825", "title": "Haskell filter more than one char", "body": "<p>A slightly shorter way is to use <code>notElem</code>:</p>\n\n<pre><code>\u03bb&gt; filter (flip notElem \" f\") \"foo bar\"\n\"oobar\"\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 4274735, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/246a16d5153d6c5306327cbb9ef5e161?s=128&d=identicon&r=PG&f=1", "display_name": "user4274735", "link": "https://stackoverflow.com/users/4274735/user4274735"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 874, "favorite_count": 0, "accepted_answer_id": 28043604, "answer_count": 3, "score": 0, "last_activity_date": 1421780576, "creation_date": 1421751346, "question_id": 28043562, "link": "https://stackoverflow.com/questions/28043562/haskell-filter-more-than-one-char", "title": "Haskell filter more than one char", "body": "<p>I have a question. I have this line of code here.</p>\n\n<pre><code>map length [filter (/= ' ') someString]\n</code></pre>\n\n<p>I know it removes the space from someString. But is it possible to remove more than just the space from the string using filter? Let just say remove the spaces and some other char.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 0, "creation_date": 1421751054, "post_id": 28043425, "comment_id": 44469752, "body": "Infinite loop here because <code>pos</code> is one of your arguments. What are you trying to do? What is the expected output of <code>gameList [1,2,3] 0  1</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1421752101, "post_id": 28043425, "comment_id": 44470363, "body": "BTW, you normally never need to end lines with semicolons in Haskell, nor do you need to surround definitions with parentheses."}, {"owner": {"reputation": 15, "user_id": 575870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fde284656733309e1c326d529e6031f?s=128&d=identicon&r=PG", "display_name": "RocZhang", "link": "https://stackoverflow.com/users/575870/roczhang"}, "edited": false, "score": 0, "creation_date": 1421807118, "post_id": 28043425, "comment_id": 44498740, "body": "The reason is that let expression is not assignment, it&#39;s defintion of block code.  In this case, it&#39;s recursive. The same case as the following code:    let t = (let pos = next; next = pos in (pos, next))"}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 575870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fde284656733309e1c326d529e6031f?s=128&d=identicon&r=PG", "display_name": "RocZhang", "link": "https://stackoverflow.com/users/575870/roczhang"}, "edited": false, "score": 0, "creation_date": 1421806421, "post_id": 28043761, "comment_id": 44498566, "body": "Yes, I made that mistake  because I thought let expression will just assignment ,not block of code.   So It&#39;s hard for me to know why . Thanks a lot."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 2, "last_activity_date": 1421751938, "creation_date": 1421751938, "answer_id": 28043761, "question_id": 28043425, "link": "https://stackoverflow.com/questions/28043425/in-haskell-loop-exception-without-loop-in-its-function-body/28043761#28043761", "title": "In haskell loop exception without loop in its function body", "body": "<blockquote>\n  <p>doesn't use the loop , even recursion</p>\n</blockquote>\n\n<p>This is not correct, here's why.</p>\n\n<pre><code>gameList :: [Int]-&gt;Int-&gt;Int-&gt;[(Int, Int)]\ngameList  org pos step =              -- this is an unused argument named pos\n  let next  = (mod (pos + step)  2) ; -- here we define next in terms of pos\n        pos = next;                   -- ... which is defined here in terms of next\n    in  [(pos, pos)]                  -- here we use this circularly-defined pos\n</code></pre>\n\n<p>See, <code>let</code> is not an assignment, and it is not \"executed\" top-to-bottom. <code>let</code> introduces a block of <em>mutually-recursive definitions</em>. So this</p>\n\n<pre><code>let next  = (mod (pos + step)  2) ;\n    pos = next;             \n</code></pre>\n\n<p>does not use <code>pos</code> the function argument at all. </p>\n"}, {"comments": [{"owner": {"reputation": 15, "user_id": 575870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fde284656733309e1c326d529e6031f?s=128&d=identicon&r=PG", "display_name": "RocZhang", "link": "https://stackoverflow.com/users/575870/roczhang"}, "edited": false, "score": 0, "creation_date": 1421806663, "post_id": 28043780, "comment_id": 44498629, "body": "I got the reason I misunderstand the meaning of let expression. It&#39;s not a assignment, it&#39;s block of code.  And also thanks your answer and suggestion on -Wall"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 15, "user_id": 575870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fde284656733309e1c326d529e6031f?s=128&d=identicon&r=PG", "display_name": "RocZhang", "link": "https://stackoverflow.com/users/575870/roczhang"}, "edited": false, "score": 0, "creation_date": 1421835546, "post_id": 28043780, "comment_id": 44509532, "body": "It&#39;s a block of <i>definitions</i>, that&#39;s the crucial thing."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1421752458, "last_edit_date": 1421752458, "creation_date": 1421752000, "answer_id": 28043780, "question_id": 28043425, "link": "https://stackoverflow.com/questions/28043425/in-haskell-loop-exception-without-loop-in-its-function-body/28043780#28043780", "title": "In haskell loop exception without loop in its function body", "body": "<blockquote>\n  <p>\"doesn't use a loop, even recursion\"</p>\n</blockquote>\n\n<p>I'm afraid it does actually use recursion, albeit in a way that isn't even possible in non-lazy languages!</p>\n\n<p>The crux is that your parameter <code>pos</code> is never actually used anywhere, it's immediately shadowed by the <code>pos</code> defined in the <code>let</code> block (GHC would have warned you about that, with <code>-Wall</code>!). So your code is equivalent to</p>\n\n<pre><code>gameList org _ step =\n    let next  = (mod (pos + step)  2) ;\n        pos = next;             \n    in  [(pos, pos)]\n</code></pre>\n\n<p>where <code>next</code> is defined in terms of <code>pos</code> which is defined in terms of <code>next</code> which is... and so on.</p>\n\n<p>The obvious fix is to remove the line <code>pos = next</code>, which is completely unnecessary anyway.</p>\n\n<pre><code>gameList org pos step\n  = let next  = (pos + step) `mod` 2\n    in  [(next, next)]\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 575870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fde284656733309e1c326d529e6031f?s=128&d=identicon&r=PG", "display_name": "RocZhang", "link": "https://stackoverflow.com/users/575870/roczhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "accepted_answer_id": 28043761, "answer_count": 2, "score": 0, "last_activity_date": 1421752458, "creation_date": 1421750932, "question_id": 28043425, "link": "https://stackoverflow.com/questions/28043425/in-haskell-loop-exception-without-loop-in-its-function-body", "title": "In haskell loop exception without loop in its function body", "body": "<p>I'm newbie to Haskell and write the following small code but it failed with loop exception. The problem is the code  doesn't use the loop , even recursion. \nThat's make me crazy!</p>\n\n<pre><code>gameList :: [Int]-&gt;Int-&gt;Int-&gt;[(Int, Int)]\ngameList  org pos step =\n    let next  = (mod (pos + step)  2) ;\n        pos = next;             \n    in  [(pos, pos)]\n</code></pre>\n\n<p>Then save it in one file and succeed to load it into GHC with interactive mode.\ninvoke it like this \n           <code>gameList [1,2,3] 0  1</code></p>\n\n<p>It will throw error \"[(*** Exception: &lt;>\"</p>\n\n<p>The GHCI info :WinGHCi 1.0.6\nHelp me!</p>\n"}, {"tags": ["haskell", "casting", "type-conversion"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1421747931, "post_id": 28041411, "comment_id": 44467825, "body": "You can optimise your sieve by doing: <code>primes = 2 : sieve [3,5..]</code>. Alternatively, you can implement something like <a href=\"http://www.cs.hmc.edu/~oneill/papers/Sieve-JFP.pdf\" rel=\"nofollow noreferrer\">this</a>. It should speed up you code by a significant amount. You can also use <a href=\"https://hackage.haskell.org/package/HaskellForMaths-0.4.3/docs/Math-NumberTheory-Prime.html\" rel=\"nofollow noreferrer\"><code>Math.NumberTheory.Prime</code></a> to save youself some work."}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 4, "creation_date": 1421745584, "post_id": 28041541, "comment_id": 44466506, "body": "Or use <code>(\\p -&gt; p^2 &lt;= x)</code> in place of <code>(&lt; floor (sqrt x))</code>. No need for <code>sqrt</code>, really."}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1421745763, "post_id": 28041541, "comment_id": 44466600, "body": "Yes, agreed. In this particular case, there are better options."}], "tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 3, "last_activity_date": 1421745437, "creation_date": 1421745437, "answer_id": 28041541, "question_id": 28041411, "link": "https://stackoverflow.com/questions/28041411/rounding-a-float-to-an-int-in-haskell/28041541#28041541", "title": "Rounding a float to an int in haskell", "body": "<p>The actual problem is the second error. (The first is just a consequence.) The <code>x</code> is an <code>Integer</code>, so you cannot call <code>sqrt</code> on it, because that requires a <code>Floating</code> instance.</p>\n\n<p>Try:</p>\n\n<pre><code>takeWhile (&lt; floor (sqrt (fromIntegral x)))\n</code></pre>\n\n<p>This will convert <code>x</code> from an integer to a floating point number so that <code>sqrt</code> can operate on it.</p>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 539, "favorite_count": 0, "accepted_answer_id": 28041541, "answer_count": 1, "score": 1, "last_activity_date": 1421747869, "creation_date": 1421745027, "last_edit_date": 1421747869, "question_id": 28041411, "link": "https://stackoverflow.com/questions/28041411/rounding-a-float-to-an-int-in-haskell", "title": "Rounding a float to an int in haskell", "body": "<p>Problem 3 of Project Euler says: The prime factors of 13195 are 5, 7, 13 and 29.\nWhat is the largest prime factor of the number 600851475143?</p>\n\n<p>I made a lazy list of primes, then I do a takeWhile they are less than the square root of 600851475143, and test each prime to see if it is a factor.</p>\n\n<pre><code>primes :: [Integer]\nprimes = sieve [2..]\n    where\n        sieve (p:xs) = p : sieve [x|x &lt;- xs, x `mod` p &gt; 0]\nprimeFactors :: Integer -&gt; Integer\nprimeFactors x = last $ filter (\\y -&gt; x `mod` y == 0) $ takeWhile (&lt; floor (sqrt x)) $ primes\n</code></pre>\n\n<p>However, I get an error with <code>(&lt; floor (sqrt x))</code>:</p>\n\n<pre><code>projecteuler.hs:34:70:\n    No instance for (RealFrac Integer) arising from a use of `floor'\n    Possible fix: add an instance declaration for (RealFrac Integer)\n    In the second argument of `(&lt;)', namely `floor (sqrt x)'\n    In the first argument of `takeWhile', namely `(&lt; floor (sqrt x))'\n    In the expression: takeWhile (&lt; floor (sqrt x))\n\nprojecteuler.hs:34:77:\n    No instance for (Floating Integer) arising from a use of `sqrt'\n    Possible fix: add an instance declaration for (Floating Integer)\n    In the first argument of `floor', namely `(sqrt x)'\n    In the second argument of `(&lt;)', namely `floor (sqrt x)'\n    In the first argument of `takeWhile', namely `(&lt; floor (sqrt x))'\n</code></pre>\n\n<p>This is weird: :t <code>floor</code> gives me <code>(Integral b, RealFrac a) =&gt; a -&gt; b</code>, which means that this floor should be returning a integer.  How can I add an instance declaration (or do whatever is necessary to fix this?)</p>\n\n<p>Also, any suggestions on code optimization are greatly appreciated :)</p>\n\n<p>Edit: this has been solved, and now I am cleaning it up.  I've encapsulated everything inside of the main function, so it looks like this:</p>\n\n<pre><code>p003primeFactors :: Integer -&gt; [Integer]\np003primeFactors x = filter (\\y -&gt; x `mod` y == 0) $ takeWhile (\\p -&gt; p^2 &lt;= x) $ primes\n    where\n        primes :: [Integer]\n        primes = sieve [2..]\n            where\n                sieve (p:xs) = p : sieve [x|x &lt;- xs, x `mod` p &gt; 0]\n</code></pre>\n\n<p>Is this the best way to create namespaces for functions like this?</p>\n"}, {"tags": ["haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1421734595, "post_id": 28038362, "comment_id": 44461794, "body": "Well, the <code>SPARKS</code> section of the report explicitly says 3 sparks were GC&#39;d. Given that the code creates 3 sparks total, that tells you GHC is deciding not to use your parallelism for some reason. In this case, I&#39;d suspect that <code>main</code> starts evaluating <code>x</code> before the spark has a chance to convert, due to the access pattern in <code>print</code>. Not sure why the sparks for <code>y</code> and <code>z</code> don&#39;t convert, though - I&#39;d look at what threadscope has to say."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1421777910, "post_id": 28038886, "comment_id": 44486809, "body": "I don&#39;t get the problem yet, sorry. What should I do, then? The works I&#39;m spawning are heavy and take some time to process. I don&#39;t get why GHC would prefer to do each one sequentially."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1421778717, "post_id": 28038886, "comment_id": 44487197, "body": "Are you doing enough allocation? I believe the spark manager gets time to run in the same way that context switches to threads are made - i.e. through the allocator. Just an idea..."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1421735924, "last_edit_date": 1421735924, "creation_date": 1421734619, "answer_id": 28038886, "question_id": 28038362, "link": "https://stackoverflow.com/questions/28038362/why-my-haskell-program-using-par-isnt-spawning-any-spark/28038886#28038886", "title": "Why my Haskell program using `par` isn&#39;t spawning any spark?", "body": "<p>I think it takes a while for sparks to get processed after they are created, so if you don't have a lot of work to do they are likely to be GC'ed or fizzle out.</p>\n\n<p>Consider this program:</p>\n\n<pre><code>import Control.Parallel.Strategies\nimport System.Environment\n\nfib :: Int -&gt; Int\nfib n\n  | n &lt;= 2 = n\n  | otherwise = fib (n-2) + fib (n-1)\n\ntest4 n = runEval $ do\n  a &lt;- rpar (fib n)\n  b &lt;- rpar (fib (n+1))\n  c &lt;- rpar (fib (n+2))\n  d &lt;- rpar (fib (n+3))\n  return (a,b,c,d)\n\nmain = do\n  n &lt;- fmap (read.head) getArgs\n  print $ test4 n\n</code></pre>\n\n<p>and here is a summary of what I typically see for various values of <code>n</code>:</p>\n\n<pre><code>n           sparks\n----------  ------------------------\nup to 25    either 4 GC or 4 fizzled\n26          1 converted, 3 fizzled\n28          2 converted, 2 fizzled\n30          3 converted, 1 fizzled\n</code></pre>\n\n<p>In each case 4 sparks get created, but for smaller values of <code>n</code> the spark manager doesn't have any time to evaluate any of them and they all get evaluated by the main thread.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1421818827, "creation_date": 1421818827, "answer_id": 28060350, "question_id": 28038362, "link": "https://stackoverflow.com/questions/28038362/why-my-haskell-program-using-par-isnt-spawning-any-spark/28060350#28060350", "title": "Why my Haskell program using `par` isn&#39;t spawning any spark?", "body": "<p>There certainly is a trick to get sparks to run. Here is another approach using <code>parMap</code>:</p>\n\n<pre><code>import Control.Monad.Par\n\nimport qualified Data.Vector.Unboxed as UV\n\npasses = UV.fromList [1..1000000] :: UV.Vector Int\nvector = UV.fromList [1..100] :: UV.Vector Double\n\ntest = runPar $ parMap go [1..4]\n  where go k = UV.foldr' (const (UV.map (+k))) vector passes\n\nmain = print test\n</code></pre>\n\n<p>This does not create any sparks, but the code runs in parallel. Profiling stats shows a Total time of 1.63s (elapsed 0.93s).</p>\n\n<p>Threadscope is very handy for observing HEC activity. Compile with:</p>\n\n<pre><code>ghc -O2 -threaded -eventlog -rtsopts ...\n</code></pre>\n\n<p>and run with:</p>\n\n<pre><code>./prog +RTS -N... -l\n</code></pre>\n\n<p>to generate the event log file to use with Threadscope.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1421818827, "creation_date": 1421731732, "question_id": 28038362, "link": "https://stackoverflow.com/questions/28038362/why-my-haskell-program-using-par-isnt-spawning-any-spark", "title": "Why my Haskell program using `par` isn&#39;t spawning any spark?", "body": "<p>I'm trying to compile the following program using threads:</p>\n\n<pre><code>import qualified Data.Vector.Unboxed as UV\npasses = UV.fromList [1..1000000] :: UV.Vector Int\nvector = UV.fromList [1..100] :: UV.Vector Double\nvectors = x `par` y `par` z `par` w `pseq` (x,y,z,w) where\n    x = UV.foldr' (const (UV.map (+1))) vector passes\n    y = UV.foldr' (const (UV.map (+2))) vector passes\n    z = UV.foldr' (const (UV.map (+3))) vector passes\n    w = UV.foldr' (const (UV.map (+4))) vector passes\nmain = print vectors\n</code></pre>\n\n<p>But it does not look like it is executing in parallel, since its execution time with either <code>N1</code> or <code>N4</code> are almost the same.</p>\n\n<pre><code>vh:haskell apple1$ ghc -fforce-recomp -threaded -O2 bench.hs -o bench; time ./bench +RTS -s -N4\n[1 of 1] Compiling Main             ( bench.hs, bench.o )\nLinking bench ...\n(fromList [1000001.0,1000002.0,1000003.0,1000004.0,1000005.0,1000006.0,1000007.0,1000008.0,1000009.0,1000010.0,1000011.0,1000012.0,1000013.0,1000014.0,1000015.0,1000016.0,1000017.0,1000018.0,1000019.0,1000020.0,1000021.0,1000022.0,1000023.0,1000024.0,1000025.0,1000026.0,1000027.0,1000028.0,1000029.0,1000030.0,1000031.0,1000032.0,1000033.0,1000034.0,1000035.0,1000036.0,1000037.0,1000038.0,1000039.0,1000040.0,1000041.0,1000042.0,1000043.0,1000044.0,1000045.0,1000046.0,1000047.0,1000048.0,1000049.0,1000050.0,1000051.0,1000052.0,1000053.0,1000054.0,1000055.0,1000056.0,1000057.0,1000058.0,1000059.0,1000060.0,1000061.0,1000062.0,1000063.0,1000064.0,1000065.0,1000066.0,1000067.0,1000068.0,1000069.0,1000070.0,1000071.0,1000072.0,1000073.0,1000074.0,1000075.0,1000076.0,1000077.0,1000078.0,1000079.0,1000080.0,1000081.0,1000082.0,1000083.0,1000084.0,1000085.0,1000086.0,1000087.0,1000088.0,1000089.0,1000090.0,1000091.0,1000092.0,1000093.0,1000094.0,1000095.0,1000096.0,1000097.0,1000098.0,1000099.0,1000100.0],fromList [2000001.0,2000002.0,2000003.0,2000004.0,2000005.0,2000006.0,2000007.0,2000008.0,2000009.0,2000010.0,2000011.0,2000012.0,2000013.0,2000014.0,2000015.0,2000016.0,2000017.0,2000018.0,2000019.0,2000020.0,2000021.0,2000022.0,2000023.0,2000024.0,2000025.0,2000026.0,2000027.0,2000028.0,2000029.0,2000030.0,2000031.0,2000032.0,2000033.0,2000034.0,2000035.0,2000036.0,2000037.0,2000038.0,2000039.0,2000040.0,2000041.0,2000042.0,2000043.0,2000044.0,2000045.0,2000046.0,2000047.0,2000048.0,2000049.0,2000050.0,2000051.0,2000052.0,2000053.0,2000054.0,2000055.0,2000056.0,2000057.0,2000058.0,2000059.0,2000060.0,2000061.0,2000062.0,2000063.0,2000064.0,2000065.0,2000066.0,2000067.0,2000068.0,2000069.0,2000070.0,2000071.0,2000072.0,2000073.0,2000074.0,2000075.0,2000076.0,2000077.0,2000078.0,2000079.0,2000080.0,2000081.0,2000082.0,2000083.0,2000084.0,2000085.0,2000086.0,2000087.0,2000088.0,2000089.0,2000090.0,2000091.0,2000092.0,2000093.0,2000094.0,2000095.0,2000096.0,2000097.0,2000098.0,2000099.0,2000100.0],fromList [3000001.0,3000002.0,3000003.0,3000004.0,3000005.0,3000006.0,3000007.0,3000008.0,3000009.0,3000010.0,3000011.0,3000012.0,3000013.0,3000014.0,3000015.0,3000016.0,3000017.0,3000018.0,3000019.0,3000020.0,3000021.0,3000022.0,3000023.0,3000024.0,3000025.0,3000026.0,3000027.0,3000028.0,3000029.0,3000030.0,3000031.0,3000032.0,3000033.0,3000034.0,3000035.0,3000036.0,3000037.0,3000038.0,3000039.0,3000040.0,3000041.0,3000042.0,3000043.0,3000044.0,3000045.0,3000046.0,3000047.0,3000048.0,3000049.0,3000050.0,3000051.0,3000052.0,3000053.0,3000054.0,3000055.0,3000056.0,3000057.0,3000058.0,3000059.0,3000060.0,3000061.0,3000062.0,3000063.0,3000064.0,3000065.0,3000066.0,3000067.0,3000068.0,3000069.0,3000070.0,3000071.0,3000072.0,3000073.0,3000074.0,3000075.0,3000076.0,3000077.0,3000078.0,3000079.0,3000080.0,3000081.0,3000082.0,3000083.0,3000084.0,3000085.0,3000086.0,3000087.0,3000088.0,3000089.0,3000090.0,3000091.0,3000092.0,3000093.0,3000094.0,3000095.0,3000096.0,3000097.0,3000098.0,3000099.0,3000100.0],fromList [4000001.0,4000002.0,4000003.0,4000004.0,4000005.0,4000006.0,4000007.0,4000008.0,4000009.0,4000010.0,4000011.0,4000012.0,4000013.0,4000014.0,4000015.0,4000016.0,4000017.0,4000018.0,4000019.0,4000020.0,4000021.0,4000022.0,4000023.0,4000024.0,4000025.0,4000026.0,4000027.0,4000028.0,4000029.0,4000030.0,4000031.0,4000032.0,4000033.0,4000034.0,4000035.0,4000036.0,4000037.0,4000038.0,4000039.0,4000040.0,4000041.0,4000042.0,4000043.0,4000044.0,4000045.0,4000046.0,4000047.0,4000048.0,4000049.0,4000050.0,4000051.0,4000052.0,4000053.0,4000054.0,4000055.0,4000056.0,4000057.0,4000058.0,4000059.0,4000060.0,4000061.0,4000062.0,4000063.0,4000064.0,4000065.0,4000066.0,4000067.0,4000068.0,4000069.0,4000070.0,4000071.0,4000072.0,4000073.0,4000074.0,4000075.0,4000076.0,4000077.0,4000078.0,4000079.0,4000080.0,4000081.0,4000082.0,4000083.0,4000084.0,4000085.0,4000086.0,4000087.0,4000088.0,4000089.0,4000090.0,4000091.0,4000092.0,4000093.0,4000094.0,4000095.0,4000096.0,4000097.0,4000098.0,4000099.0,4000100.0])\n   3,842,955,664 bytes allocated in the heap\n      16,390,368 bytes copied during GC\n       8,469,360 bytes maximum residency (6 sample(s))\n       2,122,880 bytes maximum slop\n              24 MB total memory in use (7 MB lost due to fragmentation)\n\n                                    Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      7411 colls,  7411 par    0.20s    0.06s     0.0000s    0.0004s\n  Gen  1         6 colls,     5 par    0.00s    0.00s     0.0002s    0.0008s\n\n  Parallel GC work balance: 1.00% (serial 0%, perfect 100%)\n\n  TASKS: 10 (1 bound, 9 peak workers (9 total), using -N4)\n\n  SPARKS: 3 (0 converted, 0 overflowed, 0 dud, 3 GC'd, 0 fizzled)\n\n  INIT    time    0.00s  (  0.00s elapsed)\n  MUT     time    0.77s  (  0.69s elapsed)\n  GC      time    0.20s  (  0.06s elapsed)\n  EXIT    time    0.00s  (  0.00s elapsed)\n  Total   time    0.97s  (  0.76s elapsed)\n\n  Alloc rate    5,018,806,918 bytes per MUT second\n\n  Productivity  78.9% of total user, 101.5% of total elapsed\n\ngc_alloc_block_sync: 6988\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n\nreal    0m0.759s\nuser    0m0.972s\nsys 0m0.158s\nvh:haskell apple1$ time ./bench\n(fromList [1000001.0,1000002.0,1000003.0,1000004.0,1000005.0,1000006.0,1000007.0,1000008.0,1000009.0,1000010.0,1000011.0,1000012.0,1000013.0,1000014.0,1000015.0,1000016.0,1000017.0,1000018.0,1000019.0,1000020.0,1000021.0,1000022.0,1000023.0,1000024.0,1000025.0,1000026.0,1000027.0,1000028.0,1000029.0,1000030.0,1000031.0,1000032.0,1000033.0,1000034.0,1000035.0,1000036.0,1000037.0,1000038.0,1000039.0,1000040.0,1000041.0,1000042.0,1000043.0,1000044.0,1000045.0,1000046.0,1000047.0,1000048.0,1000049.0,1000050.0,1000051.0,1000052.0,1000053.0,1000054.0,1000055.0,1000056.0,1000057.0,1000058.0,1000059.0,1000060.0,1000061.0,1000062.0,1000063.0,1000064.0,1000065.0,1000066.0,1000067.0,1000068.0,1000069.0,1000070.0,1000071.0,1000072.0,1000073.0,1000074.0,1000075.0,1000076.0,1000077.0,1000078.0,1000079.0,1000080.0,1000081.0,1000082.0,1000083.0,1000084.0,1000085.0,1000086.0,1000087.0,1000088.0,1000089.0,1000090.0,1000091.0,1000092.0,1000093.0,1000094.0,1000095.0,1000096.0,1000097.0,1000098.0,1000099.0,1000100.0],fromList [2000001.0,2000002.0,2000003.0,2000004.0,2000005.0,2000006.0,2000007.0,2000008.0,2000009.0,2000010.0,2000011.0,2000012.0,2000013.0,2000014.0,2000015.0,2000016.0,2000017.0,2000018.0,2000019.0,2000020.0,2000021.0,2000022.0,2000023.0,2000024.0,2000025.0,2000026.0,2000027.0,2000028.0,2000029.0,2000030.0,2000031.0,2000032.0,2000033.0,2000034.0,2000035.0,2000036.0,2000037.0,2000038.0,2000039.0,2000040.0,2000041.0,2000042.0,2000043.0,2000044.0,2000045.0,2000046.0,2000047.0,2000048.0,2000049.0,2000050.0,2000051.0,2000052.0,2000053.0,2000054.0,2000055.0,2000056.0,2000057.0,2000058.0,2000059.0,2000060.0,2000061.0,2000062.0,2000063.0,2000064.0,2000065.0,2000066.0,2000067.0,2000068.0,2000069.0,2000070.0,2000071.0,2000072.0,2000073.0,2000074.0,2000075.0,2000076.0,2000077.0,2000078.0,2000079.0,2000080.0,2000081.0,2000082.0,2000083.0,2000084.0,2000085.0,2000086.0,2000087.0,2000088.0,2000089.0,2000090.0,2000091.0,2000092.0,2000093.0,2000094.0,2000095.0,2000096.0,2000097.0,2000098.0,2000099.0,2000100.0],fromList [3000001.0,3000002.0,3000003.0,3000004.0,3000005.0,3000006.0,3000007.0,3000008.0,3000009.0,3000010.0,3000011.0,3000012.0,3000013.0,3000014.0,3000015.0,3000016.0,3000017.0,3000018.0,3000019.0,3000020.0,3000021.0,3000022.0,3000023.0,3000024.0,3000025.0,3000026.0,3000027.0,3000028.0,3000029.0,3000030.0,3000031.0,3000032.0,3000033.0,3000034.0,3000035.0,3000036.0,3000037.0,3000038.0,3000039.0,3000040.0,3000041.0,3000042.0,3000043.0,3000044.0,3000045.0,3000046.0,3000047.0,3000048.0,3000049.0,3000050.0,3000051.0,3000052.0,3000053.0,3000054.0,3000055.0,3000056.0,3000057.0,3000058.0,3000059.0,3000060.0,3000061.0,3000062.0,3000063.0,3000064.0,3000065.0,3000066.0,3000067.0,3000068.0,3000069.0,3000070.0,3000071.0,3000072.0,3000073.0,3000074.0,3000075.0,3000076.0,3000077.0,3000078.0,3000079.0,3000080.0,3000081.0,3000082.0,3000083.0,3000084.0,3000085.0,3000086.0,3000087.0,3000088.0,3000089.0,3000090.0,3000091.0,3000092.0,3000093.0,3000094.0,3000095.0,3000096.0,3000097.0,3000098.0,3000099.0,3000100.0],fromList [4000001.0,4000002.0,4000003.0,4000004.0,4000005.0,4000006.0,4000007.0,4000008.0,4000009.0,4000010.0,4000011.0,4000012.0,4000013.0,4000014.0,4000015.0,4000016.0,4000017.0,4000018.0,4000019.0,4000020.0,4000021.0,4000022.0,4000023.0,4000024.0,4000025.0,4000026.0,4000027.0,4000028.0,4000029.0,4000030.0,4000031.0,4000032.0,4000033.0,4000034.0,4000035.0,4000036.0,4000037.0,4000038.0,4000039.0,4000040.0,4000041.0,4000042.0,4000043.0,4000044.0,4000045.0,4000046.0,4000047.0,4000048.0,4000049.0,4000050.0,4000051.0,4000052.0,4000053.0,4000054.0,4000055.0,4000056.0,4000057.0,4000058.0,4000059.0,4000060.0,4000061.0,4000062.0,4000063.0,4000064.0,4000065.0,4000066.0,4000067.0,4000068.0,4000069.0,4000070.0,4000071.0,4000072.0,4000073.0,4000074.0,4000075.0,4000076.0,4000077.0,4000078.0,4000079.0,4000080.0,4000081.0,4000082.0,4000083.0,4000084.0,4000085.0,4000086.0,4000087.0,4000088.0,4000089.0,4000090.0,4000091.0,4000092.0,4000093.0,4000094.0,4000095.0,4000096.0,4000097.0,4000098.0,4000099.0,4000100.0])\n\nreal    0m0.717s\nuser    0m0.694s\nsys 0m0.021s\n</code></pre>\n\n<p>Why it is not running in parallel and how do I fix it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1421732216, "post_id": 28037889, "comment_id": 44460974, "body": "You&#39;ve had your literal question answered, but I am still a bit confused: Using <code>randomBF = getRandom</code> to implement the <code>Random</code> instance seems circular to me, because used that way, <code>getRandom</code> is actually calling out to the instance you are trying to define! In fact as far as I can see the code you have listed is a perfectly good instance definition if you just remove the <code>randomBF</code> declaration altogether."}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1421809513, "post_id": 28037889, "comment_id": 44499372, "body": "but, is it necessary to give type information, i.e. the part after <code>::</code> in <code>getRandom :: Rand StdGen Battlefield</code>? In other words, is using <code>randomBF</code> useful since it&#39;s more concise than the former?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1421812726, "post_id": 28037889, "comment_id": 44500165, "body": "It could certainly be useful to define <code>randomBF</code> as a shortcut to use in GHCi, where type hints are often missing. In a whole program, though, type inference would usually take care of choosing the right type."}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1421988601, "post_id": 28037889, "comment_id": 44581527, "body": "Thanks, @&#216;rjanJohansen. With respect to <code>getRandom :: (MonadRandom m, Random a) =&gt; m a</code>, I don&#39;t understand how <code>getRandom</code> type checks to return a <code>Rand StdGen Battlefield</code> in <code>randomBF</code>. Why does it?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1421988947, "post_id": 28037889, "comment_id": 44581627, "body": "It&#39;s because there is a predefined <code>MonadRandom (Rand StdGen)</code> instance as well as the <code>Random BattleField</code> instance you&#39;ve defined, so <code>m = Rand StdGen</code> and <code>a = BattleField</code> are allowable substitutions."}], "answers": [{"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1421730054, "post_id": 28038033, "comment_id": 44460303, "body": "Your answer indicates to me that my <code>evalRandT</code> approach is idiomatic. Is that so?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1421731224, "post_id": 28038033, "comment_id": 44460653, "body": "I believe that&#39;s in <code>Data.Functor.Identity</code>, not <code>Data.Functor</code>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1421731638, "post_id": 28038033, "comment_id": 44460787, "body": "Honestly I don&#39;t know. I can say two things: 1) I&#39;ve never had to use the Rand monad over anything other than the Identity monad in which case it is simpler just to use <code>evalRand</code>; 2) there is a performance penalty for using transformer stacks."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1421732138, "post_id": 28038033, "comment_id": 44460951, "body": "@user5402, doesn&#39;t that typically depend on inlining? Some things should also be a little better for <code>Identity</code> in base 4.8: <code>fmap = coerce</code>, <code>foldMap = coerce</code>, <code>foldl = coerce</code>, <code>foldl&#39; = coerce</code>, <code>(&lt;*&gt;) = coerce</code>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1421731777, "last_edit_date": 1421731777, "creation_date": 1421729890, "answer_id": 28038033, "question_id": 28037889, "link": "https://stackoverflow.com/questions/28037889/extracting-x-from-rand-stdgen-x/28038033#28038033", "title": "Extracting `X` from `Rand StdGen X`", "body": "<p>To extract the value from the Identity monad, use <code>runIdentity</code> from  <code>Data.Functor.Identity</code>.</p>\n\n<p>You could also use: <code>evalRand randomBF (mkStdGen 5)</code> which returns a Battlefield value.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 28038033, "answer_count": 1, "score": 1, "last_activity_date": 1421731777, "creation_date": 1421728993, "question_id": 28037889, "link": "https://stackoverflow.com/questions/28037889/extracting-x-from-rand-stdgen-x", "title": "Extracting `X` from `Rand StdGen X`", "body": "<p>Working on Homework 12 of Prof. Yorgey's UPenn <a href=\"http://www.cis.upenn.edu/~cis194/spring13/hw/12-monads.pdf\" rel=\"nofollow\">class</a> from 2013, it presents the <code>Battlefield</code> data type.</p>\n\n<pre><code>type Army = Int\n\ndata Battlefield = Battlefield { attackers :: Army, defenders :: Army } deriving Show\n</code></pre>\n\n<p>For the second homework question, it asks to implement the <code>random</code> and <code>randomR</code> functions.</p>\n\n<pre><code>    -- @author: Brent Yorgey\n    first :: (a -&gt; b) -&gt; (a, c) -&gt; (b, c)\n    first f (a, c) = (f a, c)\n\ninstance Random Battlefield where\n    random = first (\\(as, ds) -&gt; Battlefield as ds) . twoInts\n    randomR = undefined -- TODO\n</code></pre>\n\n<p>I implemented the above <code>random</code> using the following functions.</p>\n\n<pre><code>randomBF :: Rand StdGen Battlefield\nrandomBF = getRandom\n\ntwoInts :: RandomGen g =&gt; g -&gt; ((Army, Army), g)\ntwoInts gen = let (one, gen')  = random gen\n                  (two, gen'') = random gen'\n              in ((abs one, abs two), gen'')\n</code></pre>\n\n<p>I'm curious how I can get a <code>Battlefield</code> from <code>randomBF</code>.</p>\n\n<p>I tried the following:</p>\n\n<pre><code>ghci&gt; evalRandT randomBF (mkStdGen 5)\nIdentity (Battlefield {attackers = 7777369639206507645, defenders = 5955775402155530247})\n</code></pre>\n\n<p>However it's wrapped in an <code>Identity</code>. I'm not sure what that is. But, how can I extract the <code>Battlefield ...</code> part in idiomatic Haskell?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1421730117, "post_id": 28037837, "comment_id": 44460327, "body": "In terms of a proposal, if it even exists, which I doubt, it probably is very low on the list of things to do, especially since the set of classes you can derive normally is not that large. If you really want to avoid writing out each class every time, you can use Template Haskell to generate standalone deriving declarations."}, {"owner": {"reputation": 1835, "user_id": 1337806, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/ff032a1a9ace832d80ad4cf65ccf8567?s=128&d=identicon&r=PG", "display_name": "sam boosalis", "link": "https://stackoverflow.com/users/1337806/sam-boosalis"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1431572833, "post_id": 28037837, "comment_id": 48560703, "body": "yeah I considered that, but then you have Template Haskell&#39;s problems of longer compilation, etc."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 2, "last_activity_date": 1428442535, "creation_date": 1428442535, "answer_id": 29501761, "question_id": 28037837, "link": "https://stackoverflow.com/questions/28037837/deriving-clause-with-arbitrary-constraint-aliases/29501761#29501761", "title": "deriving clause with arbitrary &quot;Constraint aliases&quot;?", "body": "<p>There is no proposal for this. It wouldn't be too hard, but I suspect it wouldn't get a lot of traction. Not only could you use template haskell to generate standalone deriving declarations as a comment suggests, but you could macro-expand to your desired clause using CPP if you really want.</p>\n"}], "owner": {"reputation": 1835, "user_id": 1337806, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/ff032a1a9ace832d80ad4cf65ccf8567?s=128&d=identicon&r=PG", "display_name": "sam boosalis", "link": "https://stackoverflow.com/users/1337806/sam-boosalis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1432148140, "creation_date": 1421728665, "last_edit_date": 1432148140, "question_id": 28037837, "link": "https://stackoverflow.com/questions/28037837/deriving-clause-with-arbitrary-constraint-aliases", "title": "deriving clause with arbitrary &quot;Constraint aliases&quot;?", "body": "<p>For example, this declaration with <code>deriving</code>:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable, ConstraintKinds #-}\nimport Data.Data (Data)\nimport Data.Typeable (Typeable)\n\ntype Constraints a = (Show a, Eq a, Ord a, Data a, Typeable a)\ndata A = A deriving (Constraints)\n</code></pre>\n\n<p>errors with:</p>\n\n<pre><code>Illegal deriving item \u2018Constraints\u2019\n</code></pre>\n\n<p>Which makes sense given <a href=\"http://downloads.haskell.org/~ghc/7.8.3/docs/html/users_guide/deriving.html\" rel=\"nofollow noreferrer\">http://downloads.haskell.org/~ghc/7.8.3/docs/html/users_guide/deriving.html</a></p>\n\n<p>I write <code>deriving (Show, Eq, Ord, Data, Typeable)</code> for most of my types. It might be nice to export standard \"constraint aliases\", i.e. any type of kind <code>* -&gt; Constraint</code>. Given, of course, that the constraints in the constraint tuple are all the right arity, have an empty \"minimal complete definition\", etc.</p>\n\n<p>Is there any proposal for this? How hard would it be? Are there alternatives?</p>\n"}, {"tags": ["windows", "haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1421720855, "post_id": 28036774, "comment_id": 44458157, "body": "How are you running the program? That seems likely to be the real issue."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1421722894, "post_id": 28036774, "comment_id": 44458619, "body": "For simple programs like this, you should just run them in ghci. This will fix your problem. However, you can &quot;pause&quot; with <code>getChar</code> at the end of the function as well - if you aren&#39;t able to get it to work, include the exact code you are running."}, {"owner": {"reputation": 107, "user_id": 4472212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/314b3e2afd82d367c16cffdcd9a9c525?s=128&d=identicon&r=PG&f=1", "display_name": "yul-dev", "link": "https://stackoverflow.com/users/4472212/yul-dev"}, "edited": false, "score": 0, "creation_date": 1421730601, "post_id": 28036774, "comment_id": 44460465, "body": "The code I was running is exactly the same as above but I was moving x&lt;- getChar to different location to see the effect. The user below cleared up my problem but thanks for the feedback anyway."}], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 4472212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/314b3e2afd82d367c16cffdcd9a9c525?s=128&d=identicon&r=PG&f=1", "display_name": "yul-dev", "link": "https://stackoverflow.com/users/4472212/yul-dev"}, "edited": false, "score": 0, "creation_date": 1421730476, "post_id": 28037118, "comment_id": 44460440, "body": "Thanks that&#39;s exactly what I was looking for it worked!"}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 4, "last_activity_date": 1421723198, "creation_date": 1421723198, "answer_id": 28037118, "question_id": 28036774, "link": "https://stackoverflow.com/questions/28036774/stopping-a-program-from-exiting-after-completion/28037118#28037118", "title": "Stopping a program from exiting after completion", "body": "<p>If you run your program in Windows by clicking on it, then it gets a terminal window of its own which itself exits once the program does. I guess that's what you did, or similar.</p>\n\n<p>But if you instead start a terminal window with a DOS prompt, and run the program from there, then that window will survive after the program ends and you can see your output.</p>\n\n<p>You could also run the program from inside GHCi or WinGHCi with the <code>:main</code> command.</p>\n\n<p>Lastly, your <code>x &lt;- getChar</code> could <em>almost</em> work at the end of <code>main</code>, but there's a rule that the last statement in a <code>do</code> block must be an expression, so it cannot bind a variable.  But you are not using <code>x</code> for anything, so you can just remove the <code>x &lt;-</code> part:</p>\n\n<pre><code>main = do\n    print m\n    print $ f m\n    print $ g m n\n    getChar --used to pause program\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 4472212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/314b3e2afd82d367c16cffdcd9a9c525?s=128&d=identicon&r=PG&f=1", "display_name": "yul-dev", "link": "https://stackoverflow.com/users/4472212/yul-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 28037118, "answer_count": 1, "score": 1, "last_activity_date": 1421730750, "creation_date": 1421720580, "last_edit_date": 1421730750, "question_id": 28036774, "link": "https://stackoverflow.com/questions/28036774/stopping-a-program-from-exiting-after-completion", "title": "Stopping a program from exiting after completion", "body": "<p>I'm new to Haskell and trying to set it up on a windows machine. I get it to compile but when I run the .exe file, the program runs and exits right away, barely showing the output. </p>\n\n<p>Below is the sample code I created</p>\n\n<pre><code>module Main where\nm = 2 * n\nn = f 4\n\n--functions\nf::Int -&gt; Int\nf x = 2 * x\n\ng::Int -&gt; Int -&gt; Int\ng x y = 2 * x * y\n\nmain = do\nx &lt;-getChar --used to pause program\n\nprint m\nprint $ f m\nprint $ g m n\n</code></pre>\n\n<p>I used the getChar to pause the program until a key is pressed. I've been trying to figure out how to do something like exit on a key stroke after the print statements. How can I do this and could there be a  better way?</p>\n"}, {"tags": ["regex", "haskell", "tree"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 5, "creation_date": 1421719153, "post_id": 28036453, "comment_id": 44457784, "body": "Your <code>Regex</code> datatype is already a tree."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1421719571, "post_id": 28036453, "comment_id": 44457877, "body": "I assume <code>Emptyset</code> is a pattern that doesn&#39;t match anything? If so, it seems an awkward thing to put in that type, and it might be best to remove it."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1421725271, "post_id": 28036453, "comment_id": 44459123, "body": "&quot;... update the tree ...&quot; - the FP approach is to <i>define</i> values. It would help if you gave a concrete example of a transformation or analysis that you want to perform on your regular expressions."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1421731778, "post_id": 28036453, "comment_id": 44460831, "body": "I&#39;m quite sure this application wants nothing to do with AVL trees :-)."}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1421741590, "post_id": 28036453, "comment_id": 44464608, "body": "@dfeuer the <code>EmptySet</code> certainly belongs to the <a href=\"http://en.wikipedia.org/wiki/Regular_expression#Formal_definition\" rel=\"nofollow noreferrer\">RegEx definition</a>. Hint: the intersection of two regular is regular as well, but can be empty. Would make a nice SO question why the empty set is missing in most implementations."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1421744011, "post_id": 28036453, "comment_id": 44465705, "body": "@Franky, it may well be most efficient to represent it in the same sum type, but you likely <i>don&#39;t</i> want to have something like <code>Star EmptySet</code> or <code>Or EmptySet e</code>, and you can enforce that by using <code>data NE a = Word a | ...</code> and <code>data Regex a = EmptySet | NERegex (NE a)</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1421744245, "post_id": 28036453, "comment_id": 44465815, "body": "But I guess that would represent some sort of &quot;optimized&quot; regex, and you may also want to be able to represent one with extra stuff... Hmmm."}], "answers": [{"comments": [{"owner": {"reputation": 289, "user_id": 1038753, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/aa2db486b7ce866a9da3d29134b236c9?s=128&d=identicon&r=PG", "display_name": "Heinrich Ody", "link": "https://stackoverflow.com/users/1038753/heinrich-ody"}, "edited": false, "score": 0, "creation_date": 1421758896, "post_id": 28045193, "comment_id": 44474368, "body": "Seems much better than mine. Thanks!"}], "tags": [], "owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "is_accepted": true, "score": 3, "last_activity_date": 1421756774, "last_edit_date": 1421756774, "creation_date": 1421756214, "answer_id": 28045193, "question_id": 28036453, "link": "https://stackoverflow.com/questions/28036453/simplifying-regex-in-haskell-with-trees/28045193#28045193", "title": "Simplifying regex in Haskell with trees", "body": "<p>As noted in the comments, you already have a tree. You can simplify right away:</p>\n\n<pre><code>simplify :: Regex a -&gt; Regex a\nsimplify (Star Emptyset)   = Emptyword\nsimplify (Star (Star x))   = Star (simplify x)\nsimplify (Concat x Emptyword) = simplify x\nsimplify (Concat Emptyword y) = simplify y\nsimplify (Or x y) | x == y = x\n-- or rather simplify (Or x y) | simplify x == simplify y = simplify x\n-- more sophisticated rules here\n-- ...\n-- otherwise just push down\nsimplify (Or x y) = simplify (Or (simplify x) (simplify y)\n-- ...\nsimplify x@(Letter _) = x\n</code></pre>\n\n<p>This is just superficial, e.g. the first rule should be <code>simplify (Star x) | simplify x == Emptyset = emptyword</code>.</p>\n\n<h2>AVL Trees</h2>\n\n<p>AVL trees are for balance, not really applicable here. The only place where balance make sense is for the associative operations </p>\n\n<pre><code>Or (x (Or y z) == Or (Or x y) y\n</code></pre>\n\n<p>I suggest to use lists for those operations</p>\n\n<pre><code>data Regex' a = Letter' a | Concat' [Regex a]  | Or [Regex a] | Star (Regex a)\nderiving (Show, Eq)\n</code></pre>\n\n<p>(No <code>Emptyword'</code> because it is <code>Concat' []</code>; same with <code>Emptyset'</code> and <code>Or</code>.)\nConverting between <code>Regex</code> and <code>Regex'</code> is the usual exercise for the reader.</p>\n\n<h2>General Hardness</h2>\n\n<p>Note that Regex equivalence is not easy:</p>\n\n<pre><code>(a|b)* = (a*b)*a*\n</code></pre>\n\n<p>Optimizing <code>Or \"(a|b)*\" \"(a*b)*a*\"</code> is hard...</p>\n"}], "owner": {"reputation": 289, "user_id": 1038753, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/aa2db486b7ce866a9da3d29134b236c9?s=128&d=identicon&r=PG", "display_name": "Heinrich Ody", "link": "https://stackoverflow.com/users/1038753/heinrich-ody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 28045193, "answer_count": 1, "score": 1, "last_activity_date": 1421756774, "creation_date": 1421718148, "last_edit_date": 1421755797, "question_id": 28036453, "link": "https://stackoverflow.com/questions/28036453/simplifying-regex-in-haskell-with-trees", "title": "Simplifying regex in Haskell with trees", "body": "<p>I have this data structure for regular expressions (RE), and so far I do not have any functions modifying REs:</p>\n\n<pre><code>data Regex a = Letter a | Emptyword | Concat (Regex a) (Regex a) | Emptyset | Or (Regex a) (Regex a) | Star (Regex a)\n    deriving (Show, Eq)\n</code></pre>\n\n<p>I would like to implement a simplification algorithm for my REs. For this I thought I should first represent the RE as tree, update the tree according to some equivalences and then convert it back to a RE. My reasoning was that with trees I would have functions to find, extract and attach subtrees, update values etc.</p>\n\n<p>However, I have difficulties finding a tree module giving these functionalities and being simple enough for a beginner to learn.\nI found this <a href=\"http://hackage.haskell.org/package/AvlTree-4.2/docs/Data-Tree-AVL.html\" rel=\"nofollow\">avl-tree package</a> however, it seems very large.</p>\n\n<p>I'd like to have alternative suggestions to my approach with trees and suggestions on easy tree modules supporting mentioned functions.\nNote that I'm a beginner in Haskell and I do not understand monads yet and that I'm not interested in an implementation to simplify REs.</p>\n\n<p><strong>Edit 1:</strong> We know that the following two REs are equivalent, where <code>L b</code> stands for <code>Letter b</code> and <code>C</code> for <code>Concat</code>:</p>\n\n<pre><code>    Or                          Or\n   /  \\                        / \\\n  L b  C            =        L b  L a\n      /  \\                        \n    L a  Emptyword                  \n</code></pre>\n\n<p>So given the left RE I'd like to replace the subtree with its root labeled by <code>C</code> with a node labeled by <code>L a</code>. As was pointed out my data structure is a tree structure. However, currently I do not have functions to, e.g. replace a subtree with a node, or find a subtree of a structure that I can replace. </p>\n"}, {"tags": ["haskell", "recursion", "fixpoint-combinators"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1421720069, "post_id": 28036201, "comment_id": 44457981, "body": "&quot;What is the purpose of leaving the signature at its most general?&quot; You lose nothing by doing so."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 10, "last_activity_date": 1421719051, "creation_date": 1421719051, "answer_id": 28036580, "question_id": 28036201, "link": "https://stackoverflow.com/questions/28036201/useful-instantiations-of-fix-on-non-function-types/28036580#28036580", "title": "Useful instantiations of \u201cfix\u201d on non-function types?", "body": "<p>I don't know if you would regard this example as trivial, but you can use <code>fix</code> directly (without going through a function) to build up data:</p>\n\n<pre><code>repeat :: a -&gt; [a]\nrepeat x = fix (x:)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "edited": false, "score": 0, "creation_date": 1421750422, "post_id": 28036972, "comment_id": 44469399, "body": "I really like these examples, although I feel that the second one is cheating somewhat because <code>State</code> is essentially a synonym for <code>s -&gt; (a, s)</code> and so the input fed to fix has type <code>((b -&gt; c) -&gt; b -&gt; c)</code> where <code>b = (Int, Int)</code> and <code>c = ((Int,Int), [Int])</code>."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "edited": false, "score": 1, "creation_date": 1421751776, "post_id": 28036972, "comment_id": 44470161, "body": "@Chris Taylor, that&#39;s fair. However one of the questions is &quot;What is the purpose of leaving the signature at its most general?&quot;, and this example is the illustration."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "edited": false, "score": 0, "creation_date": 1421752970, "post_id": 28036972, "comment_id": 44470890, "body": "@ChrisTaylor: right. Then again, <i>any</i> type can be read as &quot;essentially a synonym for&quot; such a function type, namely its untyped-lambda-calculus representation."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 5, "last_activity_date": 1421722301, "last_edit_date": 1421722301, "creation_date": 1421722151, "answer_id": 28036972, "question_id": 28036201, "link": "https://stackoverflow.com/questions/28036201/useful-instantiations-of-fix-on-non-function-types/28036972#28036972", "title": "Useful instantiations of \u201cfix\u201d on non-function types?", "body": "<p>Fibonacci sequence, for example:</p>\n\n<pre><code>fibs = fix ((1:) . (1:) . (zipWith (+) &lt;*&gt; tail))\n</code></pre>\n\n<p>Or the <code>forever</code> function:</p>\n\n<pre><code>forever x = fix (x &gt;&gt;)\n</code></pre>\n\n<p>Or another variant of fibonacci sequence:</p>\n\n<pre><code>fibs :: State (Int, Int) [Int]\nfibs = fix $ \\loop -&gt; do\n    (x, y) &lt;- get\n    put (y, y + x)\n    (x :) &lt;$&gt; loop\n\nmain = print $ take 15 $ fst $ runState fibs (1, 1)\n</code></pre>\n\n<p>prints <code>[1,1,2,3,5,8,13,21,34,55,89,144,233,377,610]</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1421785464, "post_id": 28043656, "comment_id": 44490821, "body": "The factorial numbers are simply <code>fix ((1:) . zipWith (*) [1..])</code>."}], "tags": [], "owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "is_accepted": true, "score": 8, "last_activity_date": 1421759087, "last_edit_date": 1421759087, "creation_date": 1421751638, "answer_id": 28043656, "question_id": 28036201, "link": "https://stackoverflow.com/questions/28036201/useful-instantiations-of-fix-on-non-function-types/28043656#28043656", "title": "Useful instantiations of \u201cfix\u201d on non-function types?", "body": "<p>There are many examples of building corecursive data with <code>fix</code>. I don't know enough to elaborate on the general theory, but it seems as though any data type that is like a stream, in that you can always output one more value given the stream so far, can be computed with <code>fix</code> without feeding it a function type.</p>\n\n<h3>Examples</h3>\n\n<p>The simplest example (given in Cactus's answer) is a repeating stream of values, for example</p>\n\n<pre><code>x = [1, 1, 1, 1, 1, 1, 1, 1, ...]\n</code></pre>\n\n<p>This satisfies the equation</p>\n\n<pre><code>(1:) x = x\n</code></pre>\n\n<p>and can be produced by</p>\n\n<pre><code>&gt;&gt; fix (1:)\n[1,1,1,1,1,1,1,1,1,1,...]\n</code></pre>\n\n<hr>\n\n<p>A slightly more complicated example is the natural numbers</p>\n\n<pre><code>n = [0, 1, 2, 3, 4, 5, 6, ...]\n</code></pre>\n\n<p>which satisfy the equation</p>\n\n<pre><code>0 : map (+1) n = n\n</code></pre>\n\n<p>and can be produced by</p>\n\n<pre><code>&gt;&gt; fix ((0:) . map (+1))\n[0,1,2,3,4,5,6,7,8,9,...]\n</code></pre>\n\n<hr>\n\n<p>The factorial numbers can be generated most easily if we look at the pair <code>(n,f)</code> where <code>f</code> is the <code>n</code>th factorial number -</p>\n\n<pre><code>x = [(0,1), (1,1), (2,2), (3,6), (4,24), (5,120), ...]\n</code></pre>\n\n<p>which are fixed if we take the pair <code>(n,f)</code> to <code>(n+1, f*(n+1))</code> and then cons <code>(0,1)</code> to the start of the list. So they can be generated by</p>\n\n<pre><code>&gt;&gt; fix $ \\xs -&gt; (0,1) : map (\\(n,f) -&gt; (n+1,f*(n+1))) xs\n[(0,1),(1,1),(2,2),(3,6),(4,24),(5,120),(6,720),(7,5040),...]\n</code></pre>\n\n<p>The fibonacci numbers can be generated similarly, as in user3237465's answer.</p>\n\n<h3>Generalizing the examples</h3>\n\n<p>All three examples here are essentially recursive functions transformed into corecursive streams, i.e. they have some initial state <code>s</code> and the values emitted by the stream are <code>s</code>, <code>f s</code>, <code>f (f s)</code> etc for some function <code>f</code>. The general method for doing this is the function <code>iterate</code></p>\n\n<pre><code>iterate :: (a -&gt; a) -&gt; a -&gt; [a]\niterate f x = x : iterate f (f x)\n</code></pre>\n\n<p>which can be defined in terms of <code>fix</code> -</p>\n\n<pre><code>iterate f x = x : map f (iterate f x)\n            = (x:) . (map f) $ iterate f x\n            = fix ((x:) . map f)\n</code></pre>\n\n<p>So any stream which repeatedly applies a function to some state can be written in terms of <code>fix</code> (though, of course, you could simply use <code>iterate</code> instead of <code>fix</code> -- a particular case of the rule that <code>fix</code> is not necessary in a language which allows recursive let expressions).</p>\n\n<h3>Non-stream examples</h3>\n\n<p>For an example that isn't a stream, consider binary trees with values at the branches -</p>\n\n<pre><code>data Tree a = Tip | Bin a (Tree a) (Tree a) deriving (Show)\n</code></pre>\n\n<p>If we want a binary tree whose nodes are labelled in breadth first order, note that we could fix such a tree by taking two copies of itself, and incrementing all of the values in the left- and right-branches by the appropriate amount, as defined by the following function -</p>\n\n<pre><code>fun :: (Num a) =&gt; Tree a -&gt; Tree a\nfun t = Bin 1 (incr 1 t) (incr 2 t)\n  where\n    incr n (Bin a l r) = Bin (a+n) (incr m l) (incr m r)\n      where\n        m = 2 * n\n</code></pre>\n\n<p>Using a simple function <code>takeLevels</code> to display just the initial portion of the tree, we then compute the fixed point as</p>\n\n<pre><code>&gt;&gt; takeLevels 3 $ fix fun\nBin 1 (Bin 2 (Bin 4 Tip Tip) (Bin 5 Tip Tip)) (Bin 3 (Bin 6 Tip Tip) (Bin 7 Tip Tip))\n</code></pre>\n\n<p>which is what we wanted.</p>\n"}], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 1, "accepted_answer_id": 28043656, "answer_count": 3, "score": 10, "last_activity_date": 1563167768, "creation_date": 1421716128, "last_edit_date": 1563167768, "question_id": 28036201, "link": "https://stackoverflow.com/questions/28036201/useful-instantiations-of-fix-on-non-function-types", "title": "Useful instantiations of \u201cfix\u201d on non-function types?", "body": "<p>Every time I\u2019ve used <code>fix :: (a -&gt; a) -&gt; a</code>, it\u2019s been at the type</p>\n\n<pre><code>((a -&gt; b) -&gt; a -&gt; b) -&gt; a -&gt; b\n</code></pre>\n\n<p>for some <code>a</code> and <code>b</code>. Is there actually some application of <code>fix</code> where its type parameter is not instantiated to a function type, other than a trivial thing like <code>fix (const 0)</code>? What is the purpose of leaving the signature at its most general?</p>\n"}, {"tags": ["haskell", "random", "binary", "seed", "prng"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1421713139, "post_id": 28035728, "comment_id": 44456348, "body": "Well, <code>StdGen</code> has a <code>Show</code> instance. You can simply use <code>print g</code>. (Please indent your code correctly and make sure you&#39;ve copied everything)"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1421719007, "post_id": 28035728, "comment_id": 44457756, "body": "Also, consider using a different generator.  Haskell no longer specifies an official one and <code>StdGen</code> has many deficiencies."}, {"owner": {"reputation": 11, "user_id": 2962685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09af292bbb89b8b3ddd46cbc83eb3034?s=128&d=identicon&r=PG&f=1", "display_name": "user2962685", "link": "https://stackoverflow.com/users/2962685/user2962685"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1421789663, "post_id": 28035728, "comment_id": 44492863, "body": "I&#39;m trying to compare different generators to see which is best in which scenarios. @Thomas  what sort of deficiencies does <code>stdGen</code> have?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1421792995, "post_id": 28035728, "comment_id": 44494417, "body": "@user2962685 <code>StdGen</code> is not cryptographically secure, <code>StdGen</code> <a href=\"https://github.com/GaloisInc/cryptol/issues/86\" rel=\"nofollow noreferrer\">isn&#39;t even statistically good random</a>, it is really slow compared to some generators, by default it seeds from just the time,  you can&#39;t reseed the generator, the available abstraction (<code>RandomGen</code>) does not allow for failure, <code>RandomGen</code> doesn&#39;t even allow for creation of a new geneator, and there is no tracking of the period."}], "answers": [{"tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": false, "score": 1, "last_activity_date": 1421826665, "creation_date": 1421826665, "answer_id": 28062067, "question_id": 28035728, "link": "https://stackoverflow.com/questions/28035728/how-to-obtain-the-seed-used-by-haskells-rng/28062067#28062067", "title": "How to obtain the seed used by Haskell&#39;s RNG?", "body": "<pre><code>import System.Random\noutputSeed = do\n  g &lt;- getStdGen\n  print g\n</code></pre>\n\n<p>This will print out the seed as two numbers (I just tried it and it output <code>1010512508 1</code>)</p>\n\n<p>You can also use <code>read</code> to turn the string back into a random seed. If the original string is in that format, it will return the same seed. But if you use some other string it will do something else to generate the seed.</p>\n\n<pre><code>Prelude System.Random&gt; read \"111 112\" :: StdGen\n111 112\nPrelude System.Random&gt; read \"blabla\" :: StdGen\n37214 1\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 2962685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09af292bbb89b8b3ddd46cbc83eb3034?s=128&d=identicon&r=PG&f=1", "display_name": "user2962685", "link": "https://stackoverflow.com/users/2962685/user2962685"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1421826665, "creation_date": 1421712576, "last_edit_date": 1421714412, "question_id": 28035728, "link": "https://stackoverflow.com/questions/28035728/how-to-obtain-the-seed-used-by-haskells-rng", "title": "How to obtain the seed used by Haskell&#39;s RNG?", "body": "<p>I am using the following Haskell code to write a file of one million pseudorandom bits:</p>\n\n<pre><code>import System.Random\nrbits= do\n  g &lt;- getStdGen\n  writeFile \"haskellbits.txt\" (take 1000000 (randomRs ('0', '1') g))\n</code></pre>\n\n<p>However, I am also interested in writing the seed used to get the sequence. How can I output it?</p>\n"}, {"tags": ["performance", "haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1421712547, "post_id": 28035350, "comment_id": 44456173, "body": "What version of GHC are you using?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1421712669, "post_id": 28035350, "comment_id": 44456199, "body": "7.8.4 on Yosemite..."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1421712742, "post_id": 28035350, "comment_id": 44456233, "body": "For me the Haskell version is 12 ms (using Criterion) and the C version is 4.2 ms (using timespec from &lt;time.h&gt;)."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1421712815, "post_id": 28035350, "comment_id": 44456260, "body": "What is your machine and compile options? You didn&#39;t change anything on the code?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1421712931, "post_id": 28035350, "comment_id": 44456294, "body": "GHC 7.8.4,  x64 linux,  -O2 -fllvm. Without llvm it&#39;s 12,3 ms. Didn&#39;t change the code."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1421713130, "post_id": 28035350, "comment_id": 44456347, "body": "Also, <code>foldl&#39;</code> and <code>forM</code> almost always have overhead. I changed them to tail recursive loops  and runtime went down to 1 ms (probably the same as C time, considering likely inaccuracy of C timer). You can also use <code>unsafeWrite</code> and <code>unsafeAt</code> for reading/writing."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1421713390, "post_id": 28035350, "comment_id": 44456403, "body": "@Andr&#225;sKov&#225;cs you could suggest that style in an answer :) Why is there an overhead, though? Why isn&#39;t there a function that does accumulation computing without overhead?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1421717643, "post_id": 28035350, "comment_id": 44457424, "body": "@Andr&#225;sKov&#225;cs, that&#39;s very often (much) better with GHC 7.10, which is why I asked."}], "answers": [{"comments": [{"owner": {"reputation": 938, "user_id": 913893, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38b2c9583c4c21e1c1cd5c887cf04c18?s=128&d=identicon&r=PG", "display_name": "John Tyree", "link": "https://stackoverflow.com/users/913893/john-tyree"}, "edited": false, "score": 0, "creation_date": 1421776083, "post_id": 28035973, "comment_id": 44485822, "body": "I wrote exactly this myself while playing around with the array code. What a difference a nice API makes :)     Keep in mind that <code>foldl1&#39;</code> is also defined for unboxed vectors: <code>V.foldl1&#39; (+) vec</code> ...."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 5, "last_activity_date": 1421714631, "last_edit_date": 1421714631, "creation_date": 1421714302, "answer_id": 28035973, "question_id": 28035350, "link": "https://stackoverflow.com/questions/28035350/why-is-this-haskell-array-filling-operation-so-slow/28035973#28035973", "title": "Why is this Haskell array filling operation so slow?", "body": "<p>GHC does not produce nice tight loops like what you accomplish with C. A factor of 3 in run times is about par for the course based on my experience.</p>\n\n<p>To get better performance use the Vector library:</p>\n\n<pre><code>import qualified Data.Vector.Unboxed as V\n\nsize = 256*256*16 :: Int\n\ndoit = V.foldl' (+) 0 vec\n  where vec = V.generate size id \n\nmain = print doit\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1421715644, "post_id": 28036029, "comment_id": 44456917, "body": "Integer is overkill... maybe just a Double, since that is the type JavaScript uses. Sorry about the imports..."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 2, "last_activity_date": 1421714701, "creation_date": 1421714701, "answer_id": 28036029, "question_id": 28035350, "link": "https://stackoverflow.com/questions/28035350/why-is-this-haskell-array-filling-operation-so-slow/28036029#28036029", "title": "Why is this Haskell array filling operation so slow?", "body": "<p>This is too big for a comment, but not really an answer. Your imports were a little annoying to track down, and I also squashed the warnings from <code>-Wall</code> (important to pay attention to when you're looking at performance):</p>\n\n<pre><code>module Main where\n\nimport Data.Array.Unboxed\nimport Data.Array.ST\nimport Data.Array.Unsafe\nimport Control.Monad.ST\nimport Control.Monad\nimport Data.List\n\nsize :: Int\nsize = 256*256*16\n\nar :: UArray Int Int\nar = runST $ do\n    a &lt;- newArray (0,size) 0 :: ST s (STUArray s Int Int)\n    forM_ [0..size] $ \\i -&gt; do\n        writeArray a i i \n    unsafeFreeze a\n\narrSum :: Int\narrSum = foldl' (\\ s i -&gt; s + (ar ! i)) 0 [0..size-1]\n\nmain :: IO ()\nmain = print arrSum\n</code></pre>\n\n<p>for haskell and node repsectively:</p>\n\n<pre><code>jberryman /tmp \u00bb time ./t         \n-524288\n./t  0.04s user 0.01s system 92% cpu 0.056 total\njberryman /tmp \u00bb time nodejs t.js \n549755289600\nnodejs t.js  0.19s user 0.01s system 100% cpu 0.200 total\n</code></pre>\n\n<p>I get basically the same timing for GHC 7.8, and 7.6 (where I have to <code>import Data.Array.ST hiding (unsafeFreeze)</code>, but otherwise code is the same).</p>\n\n<p><strong>EDIT</strong>: Oops, look at me not being very observant; notice that on my 32-bit machine the count overflows in haskell, but not in JS, so we have another apples to oranges; a fairer comparison might be <code>Integer</code> here.</p>\n\n<p>I definitely recommend criterion for doing any kind of micro benchmarking, otherwise you're setting yourself up to waste a lot of time.</p>\n\n<p>Also I don't believe you have the overhead of initializing your array in the <code>C</code> version, so it's not quite a fair comparison.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1421778610, "post_id": 28050026, "comment_id": 44487143, "body": "You can also <code>touch bench.hs; ghc -O2 bench.hs -o bench</code>. If you&#39;re compiling multiple modules, this will let you recompile just the one you need to. I tend to do this when I want to do something like <code>-ddump-simpl</code>."}], "tags": [], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "is_accepted": false, "score": 2, "last_activity_date": 1421770270, "creation_date": 1421770270, "answer_id": 28050026, "question_id": 28035350, "link": "https://stackoverflow.com/questions/28035350/why-is-this-haskell-array-filling-operation-so-slow/28050026#28050026", "title": "Why is this Haskell array filling operation so slow?", "body": "<p>Sorry, I guess only I can answer this question properly. The reason, for anyone curious, has nothing to do with the code, but the fact GHC was not recompiling my auto-built binaries with <code>-O2</code> when I benchmarked them. The solution was to use the <code>force-rrecomp</code> flag:</p>\n\n<pre><code>ghc -fforce-recomp -O2 bench.hs -o bench\n</code></pre>\n\n<p>A better solution, suggested by people on #haskell @ freenode, is to set up Cabal properly, and build using it.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "answer_count": 3, "score": 4, "last_activity_date": 1421770270, "creation_date": 1421710332, "question_id": 28035350, "link": "https://stackoverflow.com/questions/28035350/why-is-this-haskell-array-filling-operation-so-slow", "title": "Why is this Haskell array filling operation so slow?", "body": "<p>For a specific task, I need a lot of fast, individual writes in a mutable array. In order to check the performance, I've used the following test:</p>\n\n<pre><code>size :: Int\nsize = 256*256*16\n\narr :: UArray Int Int\narr = runST $ do\n    arr &lt;- newArray (0,size) 0 :: ST s (STUArray s Int Int)\n    forM_ [0..size] $ \\i -&gt; do\n        writeArray arr i i \n    unsafeFreeze arr\n\narr_sum = foldl' (\\ sum i -&gt; sum + (arr ! i)) 0 [0..size-1]\n\nmain = print arr_sum\n</code></pre>\n\n<p>Here is the result:</p>\n\n<pre><code>vh:haskell apple1$ ghc -O3 bench.hs -o bench; time ./bench\nLinking bench ...\n549755289600\n\nreal    0m0.748s\nuser    0m0.697s\nsys 0m0.048s\n</code></pre>\n\n<p>I suspected it shouldn't take 0.7s to fill a 256*256*16 array on memory, so I tested an equivalent program in JavaScript:</p>\n\n<pre><code>size = 256*256*16;\nx = new Array(size);\ns = 0;\nfor (var i=0; i&lt;size; ++i)\n    x[i] = i;\nfor (var i=0; i&lt;size; ++i)\n    s += x[i];\nconsole.log(s);\n</code></pre>\n\n<p>And the result is:</p>\n\n<pre><code>vh:haskell apple1$ time node bench.js\n549755289600\n\nreal    0m0.175s\nuser    0m0.150s\nsys 0m0.024s\n</code></pre>\n\n<p>On C, the time was <code>0.012s</code>, which is a good lower bound. </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n#define SIZE (256*256*16)\ndouble x[SIZE];\n\nint main(){\n    int i;\n    double s = 0;\n    for (i = 0; i&lt;SIZE; ++i)\n        x[i] = i;\n    for (i = 0; i&lt;SIZE; ++i)\n        s += x[i];\n    printf(\"%f\",s);\n};\n</code></pre>\n\n<p>So that pretty much confirms my hypothesis that my Haskell program is doing something else other than just filling the array and summing it afterwards. There is probably a hidden stack somewhere, but I can not identify it since I used <code>foldl'</code> and <code>forM_</code>, which I believed were compiled to stack-free code. So, what is the source of inefficiency here?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1421712592, "post_id": 28035221, "comment_id": 44456183, "body": "Do you have algorithm already? Every task solution starts with thinking of the algorithm (which is imperative) first. Then you just code it (which is usually trivial)."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1421713289, "creation_date": 1421713289, "answer_id": 28035829, "question_id": 28035221, "link": "https://stackoverflow.com/questions/28035221/string-number-to-string-word-representation/28035829#28035829", "title": "String Number to String Word Representation", "body": "<p>Here's how to pattern match Strings:</p>\n\n<pre><code>numWords :: String -&gt; [String]\nnumWords []  =  ...    -- matches only the empty string\nnumWords [a] =  ...    -- matches when argument is just  a single char;\n                          a = the digit\nnumWords [a,b] = ...   -- matches when there are exactly two chars;\n                          a = first chars, b = second char\nnumWords ['1',b] = ... -- matches when there are exactly two characters and\n                          the first char is '1'; b is set to the second char\nnumWords (a:as) = ...  -- matches when there is at least one character;\n                          a = first character, as = second through last characters\n</code></pre>\n\n<p>But you might also want to consider changing the signature of numWords to take an Int:</p>\n\n<pre><code>numWords :: Int -&gt; [String]\nnumWords x\n  | x &lt; 10  = ...     -- x is a single digit\n  | x &lt; 20  = ...     -- x is between 11 and 19\n  | x &lt; 30  = ...     -- x is between 20 and 29\n  | ...\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 4451914, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-awT0hVhhugg/AAAAAAAAAAI/AAAAAAAAABM/CdKAKJR2xs4/photo.jpg?sz=128", "display_name": "The Hound", "link": "https://stackoverflow.com/users/4451914/the-hound"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 446, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1421713289, "creation_date": 1421709614, "last_edit_date": 1421712363, "question_id": 28035221, "link": "https://stackoverflow.com/questions/28035221/string-number-to-string-word-representation", "title": "String Number to String Word Representation", "body": "<p>I'm doing a mini exercise to help me out with a much larger one. For now, I am trying to write a function called \"digitStr\" that has the signature of (I think) <code>digitStr :: String -&gt; String</code>.</p>\n\n<p>What I'm trying to do here is that when I type something like the following, I should get the following output:</p>\n\n<pre><code>&gt; digitStr \"23\"\n\"twenty three\"\n</code></pre>\n\n<p>For now, assume that numbers only go up to 25.</p>\n\n<p>WHAT I'VE TRIED ON MY OWN:</p>\n\n<p>My first idea was to add numerical words into the database.</p>\n\n<pre><code>wrdtxt :: txt\nwrdtxt = \" one\",\" two\",\" three\",\" four\",\" five\",\"six\",\" seven\",\" eight\",\" nine\",\" ten\",\" eleven\",\" twelve\",\"thirteen\",\" fourteen\",\"fifteen\",\" sixteen\",\" seventeen\",\" eighteen\",\" nineteen\", \" twenty\"\n</code></pre>\n\n<p>The next step is to make a function that takes a string and outputs it into a list of strings:</p>\n\n<pre><code>numWords :: String -&gt; [String]\nnumWords \"\" = []\nnumWords x = words x\n</code></pre>\n\n<p>The next step is to take the length of the function. If its length is 2, we look at the 1st digit to determine if it's in the 10s or 20s. If it is \"25\", somehow, do \"twenty\" ++ \"five\".</p>\n\n<p>As you can tell, I am a bit confused on what to do. I've been thinking about this for the past 2 days and this is all I can come up with. </p>\n"}, {"tags": ["haskell", "lazy-evaluation", "function-composition"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1421709453, "post_id": 28035148, "comment_id": 44455219, "body": "Try <code>sum . filter even . takeWhile (&lt; (x + 1)) $ fibs</code>.  The problem is that you&#39;re trying to compose <code>filter even</code> and <code>takeWhile (&lt; (x + 1)) fibs</code>, but the latter isn&#39;t a function, hence the error saying it can&#39;t match <code>[a]</code> with <code>b -&gt; [c]</code>.  The <code>$</code> operator basically forces evaluation of both sides before apply the left as a function to the right.  Alternatively, you could do <code>sum $ filter even $ takeWhile (&lt; (x + 1)) fibs</code>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1421709613, "post_id": 28035148, "comment_id": 44455264, "body": "By doing <code>sum . filter even . takeWhile (&lt; (x + 1))</code>, you&#39;re creating a new function to apply to <code>fibs</code> using <code>$</code>.  It all comes down to operator precedence, like how <code>2 * x + 1</code> is interpreted as <code>(2 * x) + 1</code> rather than <code>2 * (x + 1)</code> since <code>*</code> has higher precedence than <code>+</code>.  The <code>$</code> operator has very low precedence, lower than <code>.</code>, but function application (e.g. <code>takeWhile (&lt; (x + 1)) fibs</code> has higher precedence than anything else."}, {"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421710644, "post_id": 28035148, "comment_id": 44455659, "body": "So is the (.) operator not typically used with expressions that have parameters in them?  It seems like it is only used to compose functions, regardless of their parameters."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1421710813, "post_id": 28035148, "comment_id": 44455706, "body": "the composition operator is typically used with functions that only have one argument not yet supplied. You can use it when the function has parameters, but you have to make sure it still has a parameter that has yet to be supplied."}], "answers": [{"tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": true, "score": 1, "last_activity_date": 1421709830, "creation_date": 1421709830, "answer_id": 28035264, "question_id": 28035148, "link": "https://stackoverflow.com/questions/28035148/haskell-nested-parens-vs-dot-notation/28035264#28035264", "title": "Haskell: nested parens vs. dot notation", "body": "<p>The problem is that <code>takeWhile (&lt; (x+1)) fibs</code> has the type <code>[a0]</code> (where <code>a0</code> is some <code>Num</code>), while the function composition expects a function for its second argument (<code>a1 -&gt; [c0]</code>).</p>\n\n<p>If you want to use dot notation, it would be</p>\n\n<pre><code>p002fibsum x = (sum . filter even . takeWhile (&lt; (x+1))) fibs\n</code></pre>\n\n<p>though I'd rather use dollar signs:</p>\n\n<pre><code>p002fibsum x = sum $ filter even $ takeWhile (&lt; (x+1)) fibs\n</code></pre>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 0, "accepted_answer_id": 28035264, "answer_count": 1, "score": 1, "last_activity_date": 1495668937, "creation_date": 1421709216, "last_edit_date": 1495668937, "question_id": 28035148, "link": "https://stackoverflow.com/questions/28035148/haskell-nested-parens-vs-dot-notation", "title": "Haskell: nested parens vs. dot notation", "body": "<p>Problem 2 of Project Euler says:\nEach new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be:</p>\n\n<p>1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...</p>\n\n<p>By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the even-valued terms.</p>\n\n<p>GHCi parses this solution just fine:</p>\n\n<pre><code>fibs = 0 : 1 : zipWith (+) fibs (tail fibs)\np002fibsum x = sum (filter even (takeWhile (&lt; (x+1)) fibs))\n</code></pre>\n\n<p>...but it has a problem with this one:</p>\n\n<pre><code>fibs = 0 : 1 : zipWith (+) fibs (tail fibs)\np002fibsum x = sum . filter even . takeWhile (&lt; (x+1)) fibs\n\nCouldn't match expected type `a1 -&gt; [c0]' with actual type `[a0]'\nIn the return type of a call of `takeWhile'\nProbable cause: `takeWhile' is applied to too many arguments\nIn the second argument of `(.)', namely\n  `takeWhile (&lt; (x + 1)) fibs'\nIn the second argument of `(.)', namely\n  `filter even . takeWhile (&lt; (x + 1)) fibs'\n</code></pre>\n\n<p>takeWhile seems to take only two params, which seem to be the right amount.  Am I failing because of a missing type signature?  How can I get this solution to work with dot notation?</p>\n"}, {"tags": ["haskell", "happstack", "heist"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421703065, "post_id": 28033789, "comment_id": 44452530, "body": "Are you using a cabal sandbox?"}, {"owner": {"reputation": 2728, "user_id": 453273, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1a9ce578cf1f56e53ae38d1b0476d7e?s=128&d=identicon&r=PG", "display_name": "Rose Kunkel", "link": "https://stackoverflow.com/users/453273/rose-kunkel"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421703097, "post_id": 28033789, "comment_id": 44452547, "body": "I don&#39;t believe so, but I don&#39;t really know much about cabal."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1421703285, "post_id": 28033789, "comment_id": 44452629, "body": "It looks like you have conflicting versions of a library installed and the compiler can&#39;t figure out which one to use (this is a sore point in the Haskell community and many are actively working on how to implement it better).  A few versions ago, the <code>cabal</code> package added sandboxes (run <code>cabal sandbox init</code> to make one) that sets up a project-specific package database that you can install packages against.  This lets you install the version of a library you need for each project and not pollute your global install.  It&#39;s like virtualenv for Python."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421703311, "post_id": 28033789, "comment_id": 44452640, "body": "More info at <a href=\"https://www.haskell.org/cabal/users-guide/installing-packages.html\" rel=\"nofollow noreferrer\">haskell.org/cabal/users-guide/installing-packages.html</a>"}, {"owner": {"reputation": 2728, "user_id": 453273, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1a9ce578cf1f56e53ae38d1b0476d7e?s=128&d=identicon&r=PG", "display_name": "Rose Kunkel", "link": "https://stackoverflow.com/users/453273/rose-kunkel"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421703549, "post_id": 28033789, "comment_id": 44452750, "body": "Ah, it seems that happstack-heist pulled in happstack-server-7.3.9 when I already had happstack-server-7.4.0 installed. Thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "edited": false, "score": 0, "creation_date": 1421704564, "post_id": 28034100, "comment_id": 44453221, "body": "I believe that for this to work you also have to remove the global packages in question."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "edited": false, "score": 0, "creation_date": 1421704652, "post_id": 28034100, "comment_id": 44453262, "body": "@Dan That very well may be the case.  I haven&#39;t had to deal with it since I started using sandboxes because I do my absolute best to not install anything globally that isn&#39;t in the platform."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 3, "last_activity_date": 1421704380, "creation_date": 1421704380, "answer_id": 28034100, "question_id": 28033789, "link": "https://stackoverflow.com/questions/28033789/type-names-prefixed-with-package-name-and-version/28034100#28034100", "title": "Type names prefixed with package name and version", "body": "<p>Welcome to cabal hell!  What has happened is that when you installed the two packages for this example, <code>happstack-server</code> and <code>happstack-heist</code>, one of them pulled in a different version of the other than what was already installed on your system.  When you tried to compile the example the compiler couldn't figure out which one to use.  The solution to this is <a href=\"https://ro-che.info/ccc/22\" rel=\"nofollow\">sandboxes</a>.  Just <code>cd</code> to the directory you have this example, run <code>cabal sandbox init</code>, then <code>cabal install --dependencies-only</code>.  This will go grab all the dependencies for a project with a <code>.cabal</code> file and install them in a local <code>.cabal-sandbox/</code> directory.  When you run <code>cabal build</code> or <code>cabal install</code> the dependencies are pulled from this local folder, and any executable will be installed in <code>.cabal-sandbox/bin</code>.</p>\n"}], "owner": {"reputation": 2728, "user_id": 453273, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d1a9ce578cf1f56e53ae38d1b0476d7e?s=128&d=identicon&r=PG", "display_name": "Rose Kunkel", "link": "https://stackoverflow.com/users/453273/rose-kunkel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 28034100, "answer_count": 1, "score": 2, "last_activity_date": 1421704380, "creation_date": 1421702991, "question_id": 28033789, "link": "https://stackoverflow.com/questions/28033789/type-names-prefixed-with-package-name-and-version", "title": "Type names prefixed with package name and version", "body": "<p>I'm pretty new to Haskell, and I'm trying to follow along with the <a href=\"http://www.happstack.com/docs/crashcourse/index.html\" rel=\"nofollow\">Happstack Crash Course</a>. I've done some of the examples, but when I tried <a href=\"http://www.happstack.com/docs/crashcourse/index.html#heist-html5-and-xml-templates\" rel=\"nofollow\">the happstack-heist example</a>, I got a strange compilation error. The file that I'm compiling looks like this:</p>\n\n<pre><code>module Main where\n\nimport Control.Applicative    ((&lt;$&gt;))\nimport Control.Monad          (msum)\nimport qualified Data.Text    as T\nimport Happstack.Server       ( dir, nullConf, nullDir, simpleHTTP\n                              , seeOther, toResponse\n                              )\nimport Happstack.Server.Heist (heistServe, initHeistCompiled)\nimport Heist                  (Splices, (##), getParamNode, noSplices)\nimport Heist.Compiled         (Splice, yieldRuntimeText)\nimport qualified Text.XmlHtml as X\n\n-- | factorial splice\nfactSplice :: (Monad m) =&gt; Splice m\nfactSplice = do\n  intStr &lt;- T.unpack . X.nodeText &lt;$&gt; getParamNode\n  let res = yieldRuntimeText $ do\n        case reads intStr of\n          [(n,[])] -&gt;\n            return (T.pack $ show $ product [1..(n :: Integer)])\n          _ -&gt;\n            return (T.pack $ \"Unable to parse \" ++\n                    intStr ++ \" as an Integer.\")\n  return $ res\n\nmain :: IO ()\nmain = do\n  heistState &lt;- do\n    r &lt;- initHeistCompiled (T.pack \"fact\" ## factSplice) noSplices \".\"\n    case r of\n      (Left e) -&gt; error $ unlines e\n      (Right heistState) -&gt; return $ heistState\n  simpleHTTP nullConf $ msum\n    [ dir \"heist\" $ heistServe heistState\n    , nullDir &gt;&gt;\n      seeOther \"/heist/factorial\" (toResponse \"/heist/factorial\")\n    ]\n</code></pre>\n\n<p>The error is:</p>\n\n<pre><code>test.hs:37:36:\n    Couldn't match expected type `happstack-server-7.3.9:Happstack.Server.Internal.Types.Response'\n                with actual type `Happstack.Server.Internal.Types.Response'\n    In the return type of a call of `toResponse'\n    In the second argument of `seeOther', namely\n      `(toResponse \"/heist/factorial\")'\n    In the second argument of `(&gt;&gt;)', namely\n      `seeOther \"/heist/factorial\" (toResponse \"/heist/factorial\")'\n</code></pre>\n\n<p>It seems as though something wants types that are prefixed with the package name and version number, which I don't understand. Both happstack-server and happstack-heist were installed with <code>cabal install</code>.</p>\n"}, {"tags": ["haskell", "serialization", "haskell-lens"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421695352, "post_id": 28030983, "comment_id": 44448663, "body": "With <code>lens</code> you could associate an <code>Update</code> with a particular lens, then use that within <code>commit</code>, but it&#39;s just moving the association elsewhere and adding a large dependency to your project.  It would look like <code>commit s update = updateToModifier update s</code> and <code>updateToModifier (BallPos p) = ball .~ p</code>; <code>updateToModifier (BallVel p) = ballV .~ p</code>; <code>updateToModifier (PlaerPos p) = playerPaddle .~ p</code>; <code>updateToModifier (AIPos p) = aiPaddle .~ p</code>.  This would make <code>commit</code> simple, but you would still have all the complexity with <code>updateToModifier</code>."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421695453, "post_id": 28030983, "comment_id": 44448721, "body": "@bheklilr Yeah. I&#39;m hoping there&#39;s a convenient solution."}, {"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 0, "creation_date": 1421698194, "post_id": 28030983, "comment_id": 44450166, "body": "If the client and server share code, you might be able to use the new <code>StaticPointers</code> extension (ghc dev branch only for now) to serialize <code>state -&gt; state</code> functions."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 0, "creation_date": 1421706452, "post_id": 28030983, "comment_id": 44454073, "body": "@cdk I&#39;m not comfortable with using an unreleased version of GHC, but that does look like it would be a great solution to my issue."}], "owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 127, "favorite_count": 2, "answer_count": 0, "score": 5, "last_activity_date": 1421690992, "creation_date": 1421690992, "question_id": 28030983, "link": "https://stackoverflow.com/questions/28030983/serializing-a-setter", "title": "Serializing a Setter", "body": "<p>My program has a client and a server component that need to communicate. They each have a state that they mutate.\nThe mutation is done explicitly in the following way:</p>\n\n<p>There a relation</p>\n\n<pre><code>class Diff a b where\n    commit :: a -&gt; b -&gt; a\n</code></pre>\n\n<p>That says that type <code>b</code> can be considered a 'chunk' of type <code>a</code> and that you can modify objects of type <code>a</code> by 'committing' object of type <code>b</code> to them.</p>\n\n<p>So you modify the state, those chunks get logged and transmitted to the client which also has an instance of the above relation, just for a different type <code>a</code>.</p>\n\n<p>Now, here's the deal. My server's state is a record with many field. All of them can change since, you know, it's a state. That's what it does. This leaves me having to write a separate case in my 'chunk' type for each possible field so I can transmit them over the network. It would be lovely if I could somehow transmit any <code>state -&gt; state</code> function, but I don't see that happening. The client shares the servers code, so it <em>does</em> know about the structure of my 'chunks', and the part where it has to interpret them to update it's own, local, state is something that I can manage.</p>\n\n<p>What I was wondering is if I could maybe use lens here to automate the generation of update chunks. All my 'chunk' type is, after all, is a clumsy setter with a generic structure I can serialize.</p>\n\n<p>What would be the best way to avoid repeating code here?</p>\n\n<p>To give you a better idea of how my code currently looks, here's an example of how the server's state looks for a game of pong.</p>\n\n<pre><code>data State = State\n           { playerPaddle :: Double\n           , aiPaddle :: Double\n           , ball :: Vec2 Double\n           , ballV :: Vec2 Double } deriving Show\n\ndata Update = BallPos (Vec2 Double)\n            | BallVel (Vec2 Double)\n            | PlayerPos Double\n            | AIPos Double\n\ninstance Diff State Update where\n    commit s (BallPos p) = s { ball = p }\n    commit s (BallVel p) = s { ballV = p }\n    commit s (PlayerPos p) = s { playerPaddle = p }\n    commit s (AIPos p) = s { aiPaddle = p }\n</code></pre>\n"}, {"tags": ["haskell", "gtk", "gtk2hs"], "comments": [{"owner": {"reputation": 10424, "user_id": 3408572, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f3a08b145553b98749d3d0572d01265?s=128&d=identicon&r=PG&f=1", "display_name": "andlabs", "link": "https://stackoverflow.com/users/3408572/andlabs"}, "edited": false, "score": 0, "creation_date": 1421696015, "post_id": 28030979, "comment_id": 44449016, "body": "Why do you want to create your own signal? Couldn&#39;t you just connect handlers to the signals that are already provided?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1421719615, "post_id": 28030979, "comment_id": 44457887, "body": "Looking at the docs, <a href=\"http://hackage.haskell.org/package/glib-0.13.0.7/docs/System-Glib-Signals.html#t:Signal\" rel=\"nofollow noreferrer\">Signal</a> has its constructor exported... can you formulate your &quot;attaching a new callback to the signal&quot; operation as <code>Bool -&gt; object -&gt; handler -&gt; IO (ConnectId object)</code>? (the <code>Bool</code> is for before/after)."}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 158, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1421719294, "creation_date": 1421690971, "last_edit_date": 1421719294, "question_id": 28030979, "link": "https://stackoverflow.com/questions/28030979/gtk2hs-make-its-own-signal-or-event", "title": "Gtk2Hs make its own Signal (or Event)", "body": "<p>I'm trying to create a program with Gtk2Hs and Haskell and I wonder if it is possible to create a new signal with Gtk.</p>\n\n<p>For example I created a <strong>hBox</strong> containing a <strong>button</strong> and a <strong>text entry</strong>. This component can be added at differents places in the window and I would like to trigger some action when the button is pressed or when the entry is edited.</p>\n\n<p>Is it possible to create and force the widget (the hBox?) to emit a custom <code>my_own_signal</code> with something like :</p>\n\n<pre><code>onbuttonPressed button $ do emit my_own_signal\nonEntryActivate entry $ do emit my_own_signal\n</code></pre>\n\n<p>which could be captured by making a </p>\n\n<pre><code>on hbox my_own_signal $ do somethings\n</code></pre>\n\n<p>or</p>\n\n<pre><code>on my_widget my_own_signal $ do somethings\n</code></pre>\n\n<p>This way I could have a \"global\" signal for my widget/hbox</p>\n\n<p>I'm using GHC 7.4.1 and Gtk2Hs 0.12.3</p>\n"}, {"tags": ["haskell", "reflection", "typeclass", "dependent-type", "data-kinds"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1421698646, "post_id": 28030118, "comment_id": 44450379, "body": "I only understand a tiny bit of this, but what is the point of the <code>ReflectEmpty</code> class?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1421700479, "post_id": 28030118, "comment_id": 44451311, "body": "By &quot;reflect generically&quot; do you mean you want to lower any promoted type to whatever type it came from? This will be impossible, because the compiler sees no relation between <code>Node</code> and <code>&#39;Node</code> - likewise for all promoted types. They simply share the same name. But for any concrete objects, say <code>Proxy [Symbol] -&gt; [String]</code> or even <code>Reflect a a&#39; =&gt; Proxy [a] -&gt; [a&#39;]</code> is probably doable."}, {"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1421700540, "post_id": 28030118, "comment_id": 44451348, "body": "@dfeuer Honestly just completeness, I feel like there is a common pattern here that could be captured. I think you&#39;re right though - it could be eliminated. This feels like the analogue of simple pattern-matching on a normal AST grammar algebraic data type for homogeneous languages / tree-like structures, except... like across the universe instead of just a data type. The type-classes almost simulate manual pattern-matching for heterogeneous types, and the inheritance (in theory) allows for the reduction of the type (all in the one type-class <code>Reflect</code>)"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1443344235, "post_id": 28030118, "comment_id": 53449266, "body": "Do you have a (functional) equivalent of this in Idris, Agda or another dep. typed language?"}, {"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1443554570, "post_id": 28030118, "comment_id": 53537762, "body": "@ErikAllik You wouldn&#39;t need a type-level tree in the first place! Because you could always make predicates that are bound to the value level. As a container, the rose tree should be polymorphic enough to take any type."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1443605100, "post_id": 28030118, "comment_id": 53557588, "body": "I simply wanted a comparison of how simple this would be on a deptyped language, that&#39;s all :) thought you might have something."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1421701645, "post_id": 28033250, "comment_id": 44451918, "body": "I don&#39;t think KProxy is treated specially. Your code works the same (for me) when I defined my own KProxy."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1421701921, "post_id": 28033250, "comment_id": 44452027, "body": "The special treatment is somehow bound to the name <code>KProxy</code>. Try to rename it to <code>FooProxy</code> or something else, and it won&#39;t work."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1421702917, "post_id": 28033250, "comment_id": 44452459, "body": "@Andr&#225;sKov&#225;cs, youch! That sounds like a bug to me. GHC has no business caring about what names things have."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1421703091, "post_id": 28033250, "comment_id": 44452545, "body": "@dfeuer: <code>RebindableSyntax</code> is already about looking at specific names, so I don&#39;t think this one sticks out in comparison."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1421715454, "post_id": 28033250, "comment_id": 44456869, "body": "I changed the name to other things and it still worked. Anything of the form <code>data A (a :: *) = B</code> seems to work. Even <code>data KP (a :: *) = KP_ Bool</code> worked! What version of GHC are you using? I would be very surprised if a name that isn&#39;t defined in one of the &quot;core&quot; modules is given special treatment."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1421745448, "post_id": 28033250, "comment_id": 44466417, "body": "@user2407038 you&#39;re right! I mixed up my renaming of the proxies, therefore getting an error that I shouldn&#39;t have got. Will edit answer."}, {"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "edited": false, "score": 0, "creation_date": 1421788111, "post_id": 28033250, "comment_id": 44492114, "body": "@Andr&#225;sKov&#225;cs Do you ever run into issues where the singleton&#39;s implementation of <code>Demote</code> won&#39;t automatically reduce? It&#39;s strange, I can witness the reflected values, but they type of the values is still encoded as <code>Demote &lt;crazy type-level-tree&gt;</code>. Is this because the kinds (and also types) overlap? Your answer is a diamond in the rough, by the way :)"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "edited": false, "score": 0, "creation_date": 1421788938, "post_id": 28033250, "comment_id": 44492489, "body": "@AthanClark where do you get those types? If you use <code>:kind! Type</code> in ghci, you get the normal form of the type along with the kind. With <code>:t</code> you get unreduced types."}, {"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "edited": false, "score": 0, "creation_date": 1421796069, "post_id": 28033250, "comment_id": 44495718, "body": "@Andr&#225;sKov&#225;cs Wow!! That&#39;s so crazy!! But in a GHC script, how would one force the reduction so that it is associated with a value-level term? Maybe a poly-kinded coerce?"}, {"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "edited": false, "score": 0, "creation_date": 1421801481, "post_id": 28033250, "comment_id": 44497393, "body": "Actually, if you just assume the structure is what it should reduce to, and operate on the data with <code>head</code> or something like that, the reduction happens. @Andr&#225;sKov&#225;cs needs a promotion"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1421830427, "post_id": 28033250, "comment_id": 44506566, "body": "Yep, it&#39;s always the normal forms of types that get checked, so don&#39;t worry about reduction."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 8, "last_activity_date": 1421745785, "last_edit_date": 1421745785, "creation_date": 1421700639, "answer_id": 28033250, "question_id": 28030118, "link": "https://stackoverflow.com/questions/28030118/reflecting-heterogeneous-promoted-types-back-to-values-compositionally/28033250#28033250", "title": "Reflecting Heterogeneous Promoted Types back to Values, Compositionally", "body": "<h2>The lazy solution</h2>\n\n<p>Install the <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow\"><code>singletons</code></a> package:</p>\n\n<pre><code>{-# LANGUAGE\n  TemplateHaskell, DataKinds, PolyKinds, TypeFamilies,\n  ScopedTypeVariables, FlexibleInstances, UndecidableInstances, GADTs #-}\n\nimport GHC.TypeLits\nimport Data.Singletons.TH\nimport Data.Singletons.Prelude\nimport Data.Proxy\n\n$(singletons [d|\n  data Tree a = Node a [Tree a] deriving (Eq, Show)\n  |])\n\nreflect ::\n  forall (a :: k).\n  (SingI a, SingKind ('KProxy :: KProxy k)) =&gt;\n  Proxy a -&gt; Demote a\nreflect _ = fromSing (sing :: Sing a)\n\n-- reflect (Proxy :: Proxy (Node \"foo\" '[])) == Node \"foo\" []\n</code></pre>\n\n<p>And we're done. </p>\n\n<p>Unfortunately, the library is sparsely documented and quite complex too. I advise looking at the <a href=\"http://www.cis.upenn.edu/~eir/packages/singletons/\" rel=\"nofollow\">project homepage</a> for some additional documentation. I try to explain the basics below. </p>\n\n<p><code>Sing</code> is the data family that defines the singleton representations. Singletons are structurally the same as the unlifted types, but their values are indexed by the corresponding  lifted values. For example, the singleton of <code>data Nat = Z | S Nat</code> would be</p>\n\n<pre><code>data instance Sing (n :: Nat) where\n  SZ :: Sing Z\n  SS :: Sing n -&gt; Sing (S n)\n</code></pre>\n\n<p><code>singletons</code> is the template function that generates the singletons (and it also  lifts the derived instances, and can lift functions as well). </p>\n\n<p><code>SingKind</code> is essentially a <em>kind class</em> which provides us the <code>Demote</code> type and <code>fromSing</code>. <code>Demote</code> gives us the corresponding unlifted type for a lifted value. For example, <code>Demote False</code> is <code>Bool</code>, while <code>Demote \"foo\"</code> is <code>Symbol</code>. <code>fromSing</code> converts a singleton value to the corresponding unlifted value. So <code>fromSing SZ</code> equals <code>Z</code>. </p>\n\n<p><code>SingI</code> is a class which reflects the lifted values into singleton values. <code>sing</code> is its method, and <code>sing :: Sing x</code> gives us the singleton value of <code>x</code>. This is almost what we want; to complete the definition of <code>reflect</code> we only need to use <code>fromSing</code> on <code>sing</code> to get the unlifted value. </p>\n\n<p><code>KProxy</code> is an export of <code>Data.Proxy</code>. It allows us to capture kind variables from the environment and use them inside definitions. Note that any promotable data type of kind (* -> *) can be used in place of <code>KProxy</code>. For details of datatype promotion <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/promotion.html\" rel=\"nofollow\">see this.</a></p>\n\n<p>Note though that there is a weaker form of dispatching on kinds, which doesn't require <code>KProxy</code>:</p>\n\n<pre><code>type family Demote (a :: k)\ntype instance Demote (s :: Symbol) = String\ntype instance Demote (b :: Bool)   = Bool\n</code></pre>\n\n<p>So far so good, but how do we write the instance for lifted lists?</p>\n\n<pre><code>type instance Demote (xs :: [a]) = [Demote ???] \n</code></pre>\n\n<p><code>Demote a</code> is not allowed, of course, because <code>a</code> is a kind, not a type. So we need <code>KProxy</code> in order to be able to make use of <code>a</code> in the right hand side. </p>\n\n<h2>The do-it-yourself solution</h2>\n\n<p>This proceeds similarly to the <code>singletons</code> solution, but we deliberately skip the singleton representations and go directly for reflection. This should be somewhat more performant, and we might even learn a bit in the process (I certainly did!). </p>\n\n<pre><code>import GHC.TypeLits\nimport Data.Proxy\n\ndata Tree a = Node a [Tree a] deriving (Eq, Show)\n</code></pre>\n\n<p>We implement the kind dispatch as an open type family, and provide a type synonym for convenience: </p>\n\n<pre><code>type family Demote' (kparam :: KProxy k) :: *  \ntype Demote (a :: k) = Demote' ('KProxy :: KProxy k)  \n</code></pre>\n\n<p>The general pattern is that we use <code>'KProxy :: KProxy k</code> whenever we want to mention a kind <code>k</code>.  </p>\n\n<pre><code>type instance Demote' ('KProxy :: KProxy Symbol) = String\ntype instance Demote' ('KProxy :: KProxy (Tree a)) = Tree (Demote' ('KProxy :: KProxy a))\ntype instance Demote' ('KProxy :: KProxy [a]) = [Demote' ('KProxy :: KProxy a)]\n</code></pre>\n\n<p>Doing the reflection is pretty straightforward now:</p>\n\n<pre><code>class Reflect (a :: k) where\n  reflect :: Proxy (a :: k) -&gt; Demote a\n\ninstance KnownSymbol s =&gt; Reflect (s :: Symbol) where\n  reflect = symbolVal\n\ninstance Reflect ('[] :: [k]) where\n  reflect _ = []\n\ninstance (Reflect x, Reflect xs) =&gt; Reflect (x ': xs) where\n  reflect _ = reflect (Proxy :: Proxy x) : reflect (Proxy :: Proxy xs)\n\ninstance (Reflect n, Reflect ns) =&gt; Reflect (Node n ns) where\n  reflect _ = Node (reflect (Proxy :: Proxy n)) (reflect (Proxy :: Proxy ns))\n</code></pre>\n"}], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 532, "favorite_count": 3, "accepted_answer_id": 28033250, "answer_count": 1, "score": 8, "last_activity_date": 1421745785, "creation_date": 1421687721, "last_edit_date": 1495541029, "question_id": 28030118, "link": "https://stackoverflow.com/questions/28030118/reflecting-heterogeneous-promoted-types-back-to-values-compositionally", "title": "Reflecting Heterogeneous Promoted Types back to Values, Compositionally", "body": "<p>I've been playing with <code>-XDataKinds</code> recently, and would like to take a promoted structure build with type families and pull it back down to the value level. I believe this is possible because the compositional components are very simple, and the terminal expressions are just as straight forward.</p>\n\n<h1>Background</h1>\n\n<p>I would like to demote / reflect simple rose trees of <code>Strings</code>, which become types of kind <code>Tree Symbol</code> (when using <code>GHC.TypeLits.Symbol</code> as a type-level string). Here is my boilerplate code:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n\nimport GHC.TypeLits\nimport Data.Proxy\n\ndata Tree a = Node a [Tree a]\n\ntype TestInput = '[ 'Node \"foo\" '[ 'Node \"bar\" '[]\n                                 , 'Node \"baz\" '[]\n                                 ]\n                  , 'Node \"bar\" '[]\n                  ]\n</code></pre>\n\n<p>It's a simple type-level rose forest that looks like this very detailed diagram:</p>\n\n<pre><code> *-- \"foo\" -- \"bar\"\n |         \\_ \"baz\"\n  \\_ \"bar\"\n</code></pre>\n\n<h1>Attempted Solution</h1>\n\n<p>Ideally, I would like to traverse this structure and give a 1-to-1 mapping back to <em>values</em> of kind <code>*</code>, but it's not very obvious how to do this heterogeneously while still carrying-over the (necessary) instances due to overloading.</p>\n\n<p>vanila on <code>#haskell</code> suggested I use type classes to bind the two worlds, but it seems a bit trickier than I thought. My first attempt tried to encode the contents of a type-level pattern match via an instance head constraint, but my associated type (to encode the <code>*</code>-kinded type result of the mapping) overlapped - apparently <a href=\"https://stackoverflow.com/questions/17593730/why-are-these-family-instance-declarations-conflicting\">instance heads are somewhat ignored by GHC</a>.</p>\n\n<p>Ideally, I would also like the reflection of lists and trees to be generic, which seems to be causing problems - it's like using type classes to organize the type/kind strata.</p>\n\n<p>Here is a non-functional example of what I would like:</p>\n\n<pre><code>class Reflect (a :: k) where\n  type Result :: *\n  reflect :: Proxy a -&gt; Result\n\nclass ReflectEmpty (empty :: [k]) where\n  reflectEmpty :: forall q. Proxy empty -&gt; [q]\n  reflectEmpty _ = []\n\ninstance ReflectEmpty '[] where\n\ninstance ReflectEmpty a =&gt; Reflect a where\n  type Result = forall q. [q]\n  reflect = reflectEmpty\n\n-- | The superclass constraint is where we get compositional\nclass Reflect (x :: k) =&gt; ReflectCons (cons :: [x]) where\n  reflectCons :: PostReflection x ~ c =&gt; Proxy cons -&gt; [c]\n\ninstance ( Reflect x\n         , ReflectCons xs ) =&gt; ReflectCons (x ': xs) where\n  reflectCons _ = reflect (Proxy :: Proxy x) :\n    reflectCons (Proxy :: Proxy xs)\n\ninstance ( Reflect x\n         , ReflectEmpty e ) =&gt; ReflectCons (x ': e) where\n  reflectCons _ = reflect (Proxy :: Proxy x) :\n    reflectEmpty (Proxy :: Proxy e)\n</code></pre>\n\n<p>...</p>\n\n<p>There are a couple of thing generally wrong about this code. Here is what I see:</p>\n\n<ul>\n<li>I need some form of look-ahead to know the result of a higher-kinded reflection for generic type-level list reflection - <code>PostReflection</code> type function</li>\n<li>I'm needing to create and destroy <code>Proxy</code>'s on the fly. I'm not sure if this won't compile currently, but I don't feel confident that the types will unify as I expect them to.</li>\n</ul>\n\n<p>But, this typeclass heirarchy feels like the only way to capture a heterogeneous grammar, so this may still be a start. Any help with this would be tremendous!</p>\n"}, {"tags": ["haskell", "https"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1421687377, "post_id": 28029422, "comment_id": 44444821, "body": "There is an open issue with tls and certain MS servers: <a href=\"https://github.com/vincenthz/hs-tls/issues/87\" rel=\"nofollow noreferrer\">github.com/vincenthz/hs-tls/issues/87</a> which might be the problem."}, {"owner": {"reputation": 3603, "user_id": 1187277, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/aSBwR.png?s=128&g=1", "display_name": "Shon", "link": "https://stackoverflow.com/users/1187277/shon"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1422490251, "post_id": 28029422, "comment_id": 44775487, "body": "For the time being, I have simply moved all my https stuff into a little python script. (Very handy for me, since the tweepy python-twitter api is a breeze - I was able to learn the needed python, install library, and get it working in less time than it took me to puzzle out the opening paragraphs of the documentation for the <code>twitter-conduit</code> Haskell lib). I recommend people &quot;just trying to get the job done&quot; explore similar solutions as temporary fixes. I will try to get the thing to be all in Haskell at some point."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1422499946, "post_id": 28029422, "comment_id": 44777976, "body": "it just occurred to me that there are Haskell bindings to libcurl, and even though it hasn&#39;t been updated in a while it might another way to go. <a href=\"https://hackage.haskell.org/package/curl\" rel=\"nofollow noreferrer\">(link)</a>"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1422502020, "post_id": 28029422, "comment_id": 44778408, "body": "I just tried using <code>wget</code> and got his error: <code>ERROR: certificate common name </code>ssl2000.cloudflare.com&#39; doesn&#39;t match requested host name <code>www.wordsapi.com&#39;.</code> So maybe that&#39;s really the problem."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1422502403, "post_id": 28029422, "comment_id": 44778491, "body": "I created a new issue for this: <a href=\"https://github.com/vincenthz/hs-tls/issues/101\" rel=\"nofollow noreferrer\">github.com/vincenthz/hs-tls/issues/101</a>"}], "owner": {"reputation": 3603, "user_id": 1187277, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/aSBwR.png?s=128&g=1", "display_name": "Shon", "link": "https://stackoverflow.com/users/1187277/shon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 329, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1421685434, "creation_date": 1421685434, "question_id": 28029422, "link": "https://stackoverflow.com/questions/28029422/what-is-the-general-recipe-for-making-https-requests-with-the-wreq-library", "title": "What is the general recipe for making https requests with the wreq library?", "body": "<p>I am trying to use <a href=\"http://hackage.haskell.org/package/wreq-0.3.0.1/docs/Network-Wreq.html\" rel=\"nofollow\">Network.Wreq</a> to make https requests. I am following the <a href=\"http://www.serpentine.com/wreq/tutorial.html\" rel=\"nofollow\">wreq tutorial</a> as well as consulting the documentation for the package. I am using <a href=\"https://www.wordsapi.com/\" rel=\"nofollow\">WordsApi</a> for my test queries.</p>\n\n<p>If I use <code>curl</code> to send the GET query:</p>\n\n<pre><code>curl \"https://www.wordsapi.com/words/test?accessToken=myTokenHere\"\n</code></pre>\n\n<p>I get the JSON data returned as expected. So I know my token is correct. However, if I try to run wreq's <code>get</code> function in <code>ghci</code> (I'm actually using <code>cabal repl</code>, but that shouldn't matter, right?)</p>\n\n<pre><code>get \"https://www.wordsapi.com/words/test?accessToken=myTokenHere\"\n</code></pre>\n\n<p>then I get the following exception:</p>\n\n<pre><code>*** Exception: TlsException (HandshakeFailed (Error_Protocol (\"expecting server hello, got alert :\n[(AlertLevel_Fatal,HandshakeFailure)]\",True,HandshakeFailure)))\n</code></pre>\n\n<p>I have seen solutions to similar problems given for the Http.Conduit library, but I don't know how to translate them to apply to wreq.</p>\n\n<p>I would ultimately like to use wreq for POST requests, but I am hoping that if I can figure out how to make valid https GET requests, that solution should transfer to POST requests too.</p>\n\n<p>Any help, or requests for further information, is very much appreciated.</p>\n\n<hr>\n\n<p>Specs: </p>\n\n<ul>\n<li>wreq 0.3.0.1</li>\n<li>GHC 7.8.3</li>\n</ul>\n"}, {"tags": ["multithreading", "haskell", "stm"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421675232, "post_id": 28025180, "comment_id": 44437366, "body": "In this code several <code>STM</code> transactions are run which perform a single read or a single write on a <code>TVar</code>. This looks weird. There are no guarantees on the ordering of these writes w.r.t. the reads, so any intermediate value can be read, e.g. <code>10,10,10</code>."}, {"owner": {"reputation": 345, "user_id": 3996781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ebc9d5cf8ef442da813c0076fc2b17f8?s=128&d=identicon&r=PG&f=1", "display_name": "Ammlan Ghosh", "link": "https://stackoverflow.com/users/3996781/ammlan-ghosh"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421675892, "post_id": 28025180, "comment_id": 44437775, "body": "@Chi, in the first case (with TVar), if I add a thread delay e.g. <code>threadDelay (10^6 * 4) \tnv &lt;- readTVarIO n   putStrLn (&quot;Fib number of &quot;  ++ &quot; = &quot; ++ (show nv))</code> then it shows the last updated value i.e. 832040 (Fib 30). Otherwise it shows values as 10 610 and 610 (610 is value of Fib 15)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421676402, "post_id": 28025180, "comment_id": 44438123, "body": "That&#39;s fine, if your aim is to observe the effects of race conditions. Still, I wonder why you didn&#39;t use plain <code>IOVar</code>s instead of <code>TVar</code>s -- you are not really using transactions here."}, {"owner": {"reputation": 345, "user_id": 3996781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ebc9d5cf8ef442da813c0076fc2b17f8?s=128&d=identicon&r=PG&f=1", "display_name": "Ammlan Ghosh", "link": "https://stackoverflow.com/users/3996781/ammlan-ghosh"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421678121, "post_id": 28025180, "comment_id": 44439171, "body": "@Chi I have used TVar instead of IOVar, just to avoid lock related problems (although not applicable particularly in this code). I wanted to check the total execution time for set of read and write transactions (in a different program). But I couldn&#39;t do so, as the main thread exits before the completion of child threads. How to overcome this problem. Is there any alternative other than TMVar?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1421679430, "post_id": 28025180, "comment_id": 44440008, "body": "There is some discussion on that at the end of <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Control-Concurrent.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.7.0.2/docs/&hellip;</a> in &quot;Terminating the program&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 2, "last_activity_date": 1421673186, "creation_date": 1421673186, "answer_id": 28025442, "question_id": 28025180, "link": "https://stackoverflow.com/questions/28025180/haskell-stm-main-thread-will-not-exit-until-child-thread-completes-execution/28025442#28025442", "title": "Haskell STM : Main thread will not exit until child thread completes execution", "body": "<p><code>main1</code> is in <code>IO</code> but <code>takeTMVar</code> returns an <code>STM Int</code>. You need to run the transaction:</p>\n\n<pre><code>t &lt;- atomically $ takeTMVar n\nputStrLn( \"result: \" ++ (show t))\n</code></pre>\n"}], "owner": {"reputation": 345, "user_id": 3996781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ebc9d5cf8ef442da813c0076fc2b17f8?s=128&d=identicon&r=PG&f=1", "display_name": "Ammlan Ghosh", "link": "https://stackoverflow.com/users/3996781/ammlan-ghosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 28025442, "answer_count": 1, "score": 0, "last_activity_date": 1421673186, "creation_date": 1421672280, "last_edit_date": 1495539810, "question_id": 28025180, "link": "https://stackoverflow.com/questions/28025180/haskell-stm-main-thread-will-not-exit-until-child-thread-completes-execution", "title": "Haskell STM : Main thread will not exit until child thread completes execution", "body": "<p>In the following program, I want that main thread will not exit until all its child threads complete execution. Please note that I have used bang patterns to evaluate the Fibonacci call so that it returns an evaluated thunk to main thread.</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nmodule Main\nwhere\n\nimport Control.Concurrent.STM \nimport Control.Concurrent\nimport System.IO\n\nnfib :: Int -&gt; Int\nnfib n | n &lt;= 2 = 1\n       | otherwise = (n1 + n2 )\n                     where n1 = nfib (n-1)\n                           n2 = nfib (n-2)\n\ntype TInt = TVar Int\n\nupdateNum :: TInt -&gt; Int -&gt; STM()\nupdateNum n v = do writeTVar n v\n\nupdateTransaction :: TInt -&gt; Int -&gt; IO ()\nupdateTransaction n v = do \n        atomically $ do\n             updateNum n v\n\nmain :: IO ()\nmain = do \n    n &lt;- newTVarIO 10\n\n    forkIO $ do             \n        let v = 30\n        let !x = nfib v\n        updateTransaction n x\n\n    forkIO $ do             \n        let v = 15\n        let !x = nfib v\n        updateTransaction n x\n\n    forkIO $ do             \n        let v = 25\n        let !x = nfib v\n        updateTransaction n x   \n\n    nv &lt;- readTVarIO n\n    putStrLn (\"Fib number of \"  ++ \" = \" ++ (show nv))  \n\n    nv &lt;-  readTVarIO n\n    putStrLn (\"Fib number of \"  ++ \" = \" ++ (show nv))\n\n    nv &lt;-  readTVarIO n\n    putStrLn (\"Fib number of \"  ++ \" = \" ++ (show nv))\n</code></pre>\n\n<hr>\n\n<p>I have tired to solve this problem as per [link] (<a href=\"https://stackoverflow.com/questions/27741439/haskell-mvar-how-to-execute-shortest-job-first\">Haskell MVar : How to execute shortest job first?</a>). I don't know whether approach is correct not not and also getting an error when try to print the value of TMVar. \nHere is the code :-  (nfib is same as above) </p>\n\n<pre><code>type TMInt = TMVar Int\n\nupdateNum1 :: TMInt -&gt; Int -&gt; STM()\nupdateNum1 n v = do putTMVar n v\n\nupdateTransaction1 :: TMInt -&gt; Int -&gt; IO ()\nupdateTransaction1 n v = do \n        atomically $ do\n            updateNum1 n v\n\nmain1 :: IO ()\nmain1 = do \n    n &lt;- newTMVarIO 0\n    forkIO $ do             \n        let v = 30\n        let !x = nfib v\n        updateTransaction1 n x\n\n    forkIO $ do             \n        let v = 15\n        let !x = nfib v\n        updateTransaction1 n x\n\n    forkIO $ do             \n        let v = 25\n        let !x = nfib v\n        updateTransaction1 n x  \n\n    -- t &lt;- takeTMVar n\n    -- putStrLn( \"result: \" ++ (show t))\n</code></pre>\n\n<p>** Error is as follows:- </p>\n\n<pre><code>Couldn't match type `STM' with `IO'\nExpected type: IO Int\n     Actual type: STM Int\nIn the return type of a call of `takeTMVar'\nIn a stmt of a 'do' block: t &lt;- takeTMVar n\n</code></pre>\n\n<p>Please help. Thanks. </p>\n"}, {"tags": ["haskell", "udp", "conduit", "attoparsec"], "answers": [{"comments": [{"owner": {"reputation": 1668, "user_id": 311358, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0b2b51e4cceb4a0c1609b81815001b69?s=128&d=identicon&r=PG", "display_name": "xrl", "link": "https://stackoverflow.com/users/311358/xrl"}, "edited": false, "score": 0, "creation_date": 1421689935, "post_id": 28026108, "comment_id": 44446125, "body": "I thought <code>fileToBS</code> (which uses the Data.Conduit.List function <code>lines</code>) would  would consume the newline. I do manage to break the input file in to discrete ByteStrings. The issue is these ByteStrings are being fed in to the same parser instance. In place of that behavior I want incomplete parses to continue as errors (<code>Left</code>) and subsequent <code>ByteString</code> values should be parsed independently."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 1668, "user_id": 311358, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0b2b51e4cceb4a0c1609b81815001b69?s=128&d=identicon&r=PG", "display_name": "xrl", "link": "https://stackoverflow.com/users/311358/xrl"}, "edited": false, "score": 0, "creation_date": 1421693819, "post_id": 28026108, "comment_id": 44447929, "body": "In that case you need to limit to one chunk of input, which can be done with Data.Conduit.List.isolate."}, {"owner": {"reputation": 1668, "user_id": 311358, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0b2b51e4cceb4a0c1609b81815001b69?s=128&d=identicon&r=PG", "display_name": "xrl", "link": "https://stackoverflow.com/users/311358/xrl"}, "edited": false, "score": 0, "creation_date": 1421783204, "post_id": 28026108, "comment_id": 44489650, "body": "This does not appear to be feeding the ByteStrings down as inidividual chunks -- it seems to only consume one line then stop processing any more.  <code>fileToBS openAction C.$= (CL.isolate 1) C.$= parseToLogData C.$$ printer</code>"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 1668, "user_id": 311358, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0b2b51e4cceb4a0c1609b81815001b69?s=128&d=identicon&r=PG", "display_name": "xrl", "link": "https://stackoverflow.com/users/311358/xrl"}, "edited": false, "score": 1, "creation_date": 1421800681, "post_id": 28026108, "comment_id": 44497178, "body": "Right. You&#39;d need to do this in a loop to consume multiple lines."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 1, "last_activity_date": 1421675197, "creation_date": 1421675197, "answer_id": 28026108, "question_id": 28021416, "link": "https://stackoverflow.com/questions/28021416/manually-terminate-inputs-for-conduit-attoparsec/28026108#28026108", "title": "Manually terminate inputs for Conduit Attoparsec", "body": "<p>You probably want to fuse your <code>parseToLogData</code> with a function that prevents it from consuming a new line (ASCII code 10). Using conduit-combinators terminology, something like:</p>\n\n<pre><code>takeWhileCE (/= 10) =$= parseToLogData\ndropWhileCE (/= 10) &gt;&gt; dropCE 1 -- flush the rest of it\n</code></pre>\n\n<p>You may also want to look into the <code>line</code> combinator function.</p>\n"}], "owner": {"reputation": 1668, "user_id": 311358, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0b2b51e4cceb4a0c1609b81815001b69?s=128&d=identicon&r=PG", "display_name": "xrl", "link": "https://stackoverflow.com/users/311358/xrl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1421783322, "creation_date": 1421659722, "last_edit_date": 1421783322, "question_id": 28021416, "link": "https://stackoverflow.com/questions/28021416/manually-terminate-inputs-for-conduit-attoparsec", "title": "Manually terminate inputs for Conduit Attoparsec", "body": "<p>I am processing a syslog logfile, each line as an individual syslog entry, and parsing that entry using a Attoparsec parser. So I am using</p>\n\n<pre><code>fileToBS :: IO Handle -&gt; C.Source (ResourceT IO) BS.ByteString\nfileToBS handleMaker = source C.$= bsSplitterConduit\n  where source = CB.sourceIOHandle handleMaker\n        bsSplitterConduit = CB.lines\n</code></pre>\n\n<p>to generate the stream of syslog entries. I am using </p>\n\n<pre><code>parseToLogData:: C.Conduit BS.ByteString (ResourceT IO) (Either CATT.ParseError (CATT.PositionRange, LogData))\nparseToLogData = CATT.conduitParserEither syslogParser\n</code></pre>\n\n<p>to convert those bytestrings in to syslog values. Syslog values are generated from this parser (with some type synonyms of my own):</p>\n\n<pre><code>syslogParser :: Parser (Priority, Maybe UTCTime, IPAddress, BS.ByteString)\nsyslogParser = do\n  pri &lt;- priority &lt;?&gt; \"priority parse error\"\n  mbDate &lt;- date &lt;?&gt; \"date parse error\"\n  space\n  srcAddr &lt;- ip\n  space\n  msg &lt;- ATT.takeByteString\n  return LogData{pri = pri, timestamp = mbDate, source = srcAddr, message = \"msg\"}\n\npriority :: Parser Priority\npriority = do\n  string \"&lt;\"\n  digitsString &lt;- takeWhile1 digit\n  string \"&gt;\"\n  return (RawPriority digitsString)\n\ndate :: Parser (Maybe UTCTime)\ndate = do\n  rawDate &lt;- ATT.take 15\n  let stringDate = BS.unpack rawDate\n  let parsedDate = parseTime defaultTimeLocale syslogDateFormat stringDate\n  return parsedDate\n\nip :: Parser IPAddress\nip = do\n  oct0 &lt;- takeWhile1 digit\n  period\n  oct1 &lt;- takeWhile1 digit\n  period\n  oct2 &lt;- takeWhile1 digit\n  period\n  oct3 &lt;- takeWhile1 digit\n  return (oct0, oct1, oct2, oct3)\n--ip = takeWhile1 (\\x -&gt; digit x || x == 46)\n\nspace = string \" \"\ncolon = string \":\"\nperiod = string \".\"\n\ndigit test = (test &gt;= 48 &amp;&amp; test &lt;= 57)\noctet = digit\n</code></pre>\n\n<p>The issue is the line which takes all the rest of the syslog entry (<code>msg &lt;- ATT.takeByteString</code>). This function does not play nice with streams because it needs a termination signal if using a resumable parser (which is what conduit's attoparsec library uses).</p>\n\n<p>I have tried to yield empty bytestrings to fix this behavior but it is not working as expected (see incremental input on <a href=\"https://hackage.haskell.org/package/attoparsec-0.12.1.2/docs/Data-Attoparsec-ByteString.html\" rel=\"nofollow\">https://hackage.haskell.org/package/attoparsec-0.12.1.2/docs/Data-Attoparsec-ByteString.html</a> ). It consumes the entirety of the syslog input file in to one parsed value. This is a 80MB test file so after the initial field extraction it is putting all the subsequent syslog messages in to the message field of syslog value.</p>\n\n<p>Here is my terminator conduit to try and signal \"atomic message\" behavior. I am not sure why it does not work.</p>\n\n<pre><code>terminator :: C.Conduit BS.ByteString (ResourceT IO) BS.ByteString\nterminator = C.awaitForever yieldAndAddTerminator\n  where\n    yieldAndAddTerminator bs = do\n      C.yield bs\n      C.yield terminator\n    terminator = \"\"\n</code></pre>\n\n<p>How can I treat UDP messages as atomic pieces of data in the conduit world?</p>\n\n<p>A copy of this codebase can be found here: <a href=\"https://github.com/tureus/safe-forwarder\" rel=\"nofollow\">https://github.com/tureus/safe-forwarder</a> .</p>\n"}, {"tags": ["windows", "haskell", "profiling", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 1932, "user_id": 1784267, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/172e98db79964f9e6e4969e9f4afc452?s=128&d=identicon&r=PG", "display_name": "phaazon", "link": "https://stackoverflow.com/users/1784267/phaazon"}, "is_accepted": true, "score": 1, "last_activity_date": 1421843521, "creation_date": 1421843521, "answer_id": 28067337, "question_id": 28020899, "link": "https://stackoverflow.com/questions/28020899/profiling-an-application-on-windows-with-cabal-ghc/28067337#28067337", "title": "Profiling an application on Windows with cabal/ghc", "body": "<p>Problem solved. The issue is due to the fact I\u2019m using <code>-debug</code> on the command line interface to GHC. I\u2019ve been told <code>-debug</code> and <code>-p</code> are not compatible, hence the error.</p>\n"}], "owner": {"reputation": 1932, "user_id": 1784267, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/172e98db79964f9e6e4969e9f4afc452?s=128&d=identicon&r=PG", "display_name": "phaazon", "link": "https://stackoverflow.com/users/1784267/phaazon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 1, "accepted_answer_id": 28067337, "answer_count": 1, "score": 1, "last_activity_date": 1421843521, "creation_date": 1421657766, "question_id": 28020899, "link": "https://stackoverflow.com/questions/28020899/profiling-an-application-on-windows-with-cabal-ghc", "title": "Profiling an application on Windows with cabal/ghc", "body": "<p>I\u2019ve been experiencing a nasty issue with profiling on Windows. But first, the context of setup:</p>\n\n<ul>\n<li>I created a shared sandbox in <em>~/dev/foo_shared</em>: <code>cabal sandbox init --sandbox=.</code></li>\n<li>I created a sandbox in <em>~/dev/foo</em> using the shared sandbox above: <code>cabal sandbox init --sandbox=~/dev/foo_shared</code></li>\n<li>I installed all the dependencies with profiling enabled: <code>cabal install --only-dependencies --enable-library-profiling --enable-executable-profiling</code></li>\n<li>I configured the <em>foo</em> package so that it includes profiling RTS: <code>cabal configure --enable-profiling --enable-executable-profiling</code></li>\n<li>I tried to build with <code>cabal build</code></li>\n</ul>\n\n<p>Everything builds up correctly, but doesn\u2019t link. I then rebuilt with <code>cabal build -v3</code>, and this is the linker part (the most interesting part):</p>\n\n<pre><code>c:/program files/haskell platform/2014.2.0.0/mingw/bin/../lib/gcc/x86_64-w64-mingw32/4.6.3/../../../../x86_64-w64-mingw32/bin/ld.exe: cannot find -lHSrts_debug_p\n</code></pre>\n\n<p>I googled that, and IIRC, it\u2019s because I lack the profiling library for the GHC\u2019s RTS. I never found it for Windows :( Last information, I\u2019m on Windows 10, not sure it helps though.</p>\n"}, {"tags": ["haskell", "gadt", "type-families", "data-kinds", "constraint-kinds"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 3, "creation_date": 1421639010, "post_id": 28017635, "comment_id": 44422250, "body": "Why do you need <code>All</code> to be on <code>HList</code>? Any time you need it, you can just use <code>All</code> on the <code>[*]</code> that is the type argument of your <code>HList</code>, i.e. you can have <code>frobulate :: All (Frobable xs) =&gt; HList xs -&gt; Frob</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1421639649, "post_id": 28017635, "comment_id": 44422391, "body": "You can&#39;t promote GADTs because GHCs type system (or, more like kind system) simply doesn&#39;t support it. Your second HList doesn&#39;t particularly make sense, because every list has multiple representations, and you can&#39;t pattern match on <code>:++:</code> anyways. I&#39;m guessing you want to eventually write something like <code>All p (xs :++: ys) = All p xs :++: All p ys</code>, but that won&#39;t work.  Is there an actual problem you are trying to solve with your 2nd HList?"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1421668169, "post_id": 28017635, "comment_id": 44433395, "body": "I don&#39;t understand why you need to promote HList to kind.  Why can&#39;t you do with <code>&#39;[]</code> ? You can easily append &#39;<code>[]</code>&#39;."}, {"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1421674015, "post_id": 28017635, "comment_id": 44436656, "body": "@user2407038: Thanks for the helpful info. You&#39;re exactly correct, I want to be able to convince GHC <code>(All p xs, All p ys) =&gt; All p (xs :++: ys) =&gt; ...</code> and I hoped that adding an explicit representation for appending would help. The more I think about your comment, I start to see some of the issues that you mention (lack of a unique representation). Is there any other way for me to prove <code>(All p xs, All p ys) =&gt; All p (xs :++: ys)</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 0, "creation_date": 1421681280, "post_id": 28026609, "comment_id": 44441166, "body": "This looks promising. I had tried a &quot;fake dependent types&quot; approach but got stuck. I&#39;ll update this thread when I get a chance to try your suggestion. Thanks!"}, {"owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "edited": false, "score": 0, "creation_date": 1422050300, "post_id": 28026609, "comment_id": 44613022, "body": "You&#39;ve answered my original question and <code>allAppend</code> works as advertised. I think it&#39;s sent me down the right track. Unfortunately I&#39;ve hit some snags related to other related code that I didn&#39;t include in my original question. I may open another SO question related to this one"}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 5, "last_activity_date": 1421676874, "creation_date": 1421676874, "answer_id": 28026609, "question_id": 28017635, "link": "https://stackoverflow.com/questions/28017635/hlist-with-datakinds-kind-not-promotable/28026609#28026609", "title": "HList with DataKinds, kind not promotable", "body": "<p>I see now that the question is how to write a proof of <code>(All p xs, All p ys) =&gt; All p (xs :++: ys)</code>. The answer is, by induction, of course!</p>\n\n<p>The type of the function we really want to write is</p>\n\n<pre><code>allAppend :: (p :: Constraint) -&gt; (xs :: [*]) -&gt; (ys :: [*]) \n          -&gt; (All p xs, All p ys) -&gt; All p (xs :++: ys)\n</code></pre>\n\n<p>but Haskell doesn't have dependent types. \"Faking\" dependent types usually means having a witness that carries a proof that a type exists. This makes things somewhat tedious, but currently there is no other way. We already have a witness for a list <code>xs</code> - it is precisely <code>HList xs</code>. For constraints, we will use</p>\n\n<pre><code>data Dict p where Dict :: p =&gt; Dict p\n</code></pre>\n\n<p>Then we can write implication as a simple function:</p>\n\n<pre><code>type (==&gt;) a b = Dict a -&gt; Dict b \n</code></pre>\n\n<p>So our type becomes:</p>\n\n<pre><code>allAppend :: Proxy p -&gt; HList xs -&gt; HList ys \n          -&gt; (All p xs, All p ys) ==&gt; (All p (xs :++: ys))\n</code></pre>\n\n<p>The body of the function is quite straightforward - note how each pattern in <code>allAppend</code> matches each pattern in the definition of <code>:++:</code>:</p>\n\n<pre><code>allAppend _ Nil _  Dict = Dict  \nallAppend _ _  Nil Dict = Dict \nallAppend p (Cons _ xs) ys@(Cons _ _) Dict = \n  case allAppend p xs ys Dict of Dict -&gt; Dict \n</code></pre>\n\n<p>The opposite entailment <code>All p (xs :++: ys) =&gt; (All p xs, All p ys)</code> also holds. In fact, the function definition is identical. </p>\n"}], "owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 292, "favorite_count": 1, "accepted_answer_id": 28026609, "answer_count": 1, "score": 3, "last_activity_date": 1421676874, "creation_date": 1421638672, "last_edit_date": 1421676391, "question_id": 28017635, "link": "https://stackoverflow.com/questions/28017635/hlist-with-datakinds-kind-not-promotable", "title": "HList with DataKinds, kind not promotable", "body": "<p>I have this code snippet which uses a plethora of GHC extensions:</p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n\nimport GHC.Exts (Constraint)\n\ndata HList :: [*] -&gt; * where\n    Nil  :: HList '[]\n    Cons :: a -&gt; HList l -&gt; HList (a ': l)\n\ntype family All (p :: * -&gt; Constraint) (xs :: HList [*]) :: Constraint where\n    All p Nil = ()\n    All p (Cons x xs) = (p x, All p xs)\n</code></pre>\n\n<p>GHC complains that:</p>\n\n<pre><code> \u2018HList\u2019 of kind \u2018[*] -&gt; *\u2019 is not promotable\n    In the kind \u2018HList [*]\u2019\n</code></pre>\n\n<p>Why can't I promote <code>HList</code> to a kind? I get the same error using GHC <code>7.8.2</code> and <code>7.11</code>.</p>\n\n<p>Of course, using the builtin <code>'[]</code> works just fine:</p>\n\n<pre><code>type family All (p :: * -&gt; Constraint) (xs :: [*]) :: Constraint where\n    All p '[]       = ()\n    All p (x ': xs) = (p x, All p xs)\n</code></pre>\n\n<p>I want to use my own <code>HList</code> instead of <code>'[]</code> because the actual <code>HList</code> supports appending and looks like this:</p>\n\n<pre><code>type family (:++:) (xs :: [*]) (ys :: [*]) where\n    '[] :++:  ys = ys\n     xs :++: '[] = xs\n    (x ': xs) :++: ys = x ': (xs :++: ys)\n\ndata HList :: [*] -&gt; * where\n    Nil  :: HList '[]\n    Cons :: a -&gt; HList l -&gt; HList (a ': l)\n    App  :: Hlist a -&gt; HList b -&gt; HList (a :++: b)\n</code></pre>\n\n<p><strong>EDIT</strong>: The main goal is to have GHC infer</p>\n\n<pre><code>(All p xs, All p ys) ==&gt; All p (xs :++: ys)\n</code></pre>\n\n<p>so that I can write</p>\n\n<pre><code>data Dict :: Constraint -&gt; * where\n    Dict :: c =&gt; Dict c\n\nwitness :: Dict (All p xs) -&gt; Dict (All p ys) -&gt; Dict (All p (xs :++: ys))\nwitness Dict Dict = Dict\n</code></pre>\n\n<p>I had hoped that adding an explicit representation for appending type-level lists would help me achieve this. Is there another way to convince GHC of the above?</p>\n"}, {"tags": ["haskell", "import", "qualified-name"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1421639084, "post_id": 28017548, "comment_id": 44422272, "body": "From <a href=\"https://www.haskell.org/haskellwiki/Import\" rel=\"nofollow noreferrer\">haskell.org/haskellwiki/Import</a> it looks like this is impossible, but I&#39;m not sure what good it would do anyway. Since you&#39;re allowed to specify your own prefix it&#39;s as short as you like, and there&#39;s no risk of conflict with any other modules. What&#39;s the harm in just <code>import qualified Data.List as List</code>? The only difference is that <code>List.intercalate</code> will be available: as long as you never type that, you won&#39;t know the difference, so to speak."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1421639894, "post_id": 28017548, "comment_id": 44422438, "body": "You can also just create an auxiliary module which simply re-exports <code>sort</code> and <code>intersperse</code> and then do a qualified import of that module."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1421681972, "post_id": 28017548, "comment_id": 44441599, "body": "@amalloy &quot;There&#39;s no risk of conflict with any other modules&quot; is not necessarily true. You can import as many modules with the same name as you like, and I could imagine wanting to have <code>A.map</code> from <code>Prelude</code> but <code>A.foldr</code> from <code>Data.Foldable</code>, for example, hence introducing many name clashes."}], "answers": [{"comments": [{"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1421671363, "post_id": 28018341, "comment_id": 44435112, "body": "When I use the first method, such as <code>import qualified Data.Map as Map (findWithDefault)</code>, I am still able to see things like <code>Data.Map.notMember</code> in GHCi. Nothing is visible as <code>Map.*</code> except for <code>Map.findWithDefault</code> but it seems to also import all of Data.Map as well."}, {"owner": {"reputation": 1089, "user_id": 3681109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d676ca6572e75e842ca0fa3e9e82d1bb?s=128&d=identicon&r=PG&f=1", "display_name": "genisage", "link": "https://stackoverflow.com/users/3681109/genisage"}, "reply_to_user": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1421702670, "post_id": 28018341, "comment_id": 44452339, "body": "@prpl.mnky.dshwshr The same thing happened with me. But I noticed that even with no imports, I could use functions with fully qualified names. Perhaps another question would be if there&#39;s a way to turn that off in GHCi."}], "tags": [], "owner": {"reputation": 1089, "user_id": 3681109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d676ca6572e75e842ca0fa3e9e82d1bb?s=128&d=identicon&r=PG&f=1", "display_name": "genisage", "link": "https://stackoverflow.com/users/3681109/genisage"}, "is_accepted": false, "score": 5, "last_activity_date": 1421651998, "last_edit_date": 1421651998, "creation_date": 1421644686, "answer_id": 28018341, "question_id": 28017548, "link": "https://stackoverflow.com/questions/28017548/haskell-qualified-import-of-a-set-of-functions/28018341#28018341", "title": "Haskell *qualified* import of a set of functions", "body": "<p>Despite the fact that it's not mentioned on <a href=\"https://www.haskell.org/haskellwiki/Import\">https://www.haskell.org/haskellwiki/Import</a>, <code>import qualified Foo as Bar (x, y)</code> seems to work fine for me. I'm running ghc 7.6.3. Maybe that particular wiki page is outdated. If it doesn't work for you, what version of ghc are you using?</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 5, "last_activity_date": 1421649041, "last_edit_date": 1495540257, "creation_date": 1421649041, "answer_id": 28019058, "question_id": 28017548, "link": "https://stackoverflow.com/questions/28017548/haskell-qualified-import-of-a-set-of-functions/28019058#28019058", "title": "Haskell *qualified* import of a set of functions", "body": "<p>This is allowed, at least according to the Haskell 2010 Report. First see the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch5.html#x11-1050005.3.4\" rel=\"nofollow noreferrer\">examples</a>, which include this one:</p>\n\n<pre><code>import qualified A(x)\n</code></pre>\n\n<p>Then look up to the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch5.html#x11-1010005.3\" rel=\"nofollow noreferrer\">actual syntax spec</a>, which indicates that the <code>qualified</code>, <code>as</code>, and \"impspec\" (the list of imported identifiers or the list of hidden identifiers) are all optional and independent. Thus the syntax genisage <a href=\"https://stackoverflow.com/questions/28017548/haskell-qualified-import-of-a-set-of-functions/28018341#28018341\">describes</a> is actually standard.</p>\n"}, {"comments": [{"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1421671223, "post_id": 28020311, "comment_id": 44435041, "body": "When I use the first method, such as <code>import qualified Data.Map as Map (findWithDefault)</code>, I am still able to see things like <code>Data.Map.notMember</code> in GHCi. Nothing is visible as <code>Map.*</code> except for <code>Map.findWithDefault</code> but it seems to also import all of Data.Map as well."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 2, "creation_date": 1421677071, "post_id": 28020311, "comment_id": 44438540, "body": "@prpl.mnky.dshwshr, GHCi is weird about modules in general, because it&#39;s trying to be friendly to interactive development. If you want to know what you actually need, compile the code."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 17, "last_activity_date": 1421655216, "creation_date": 1421655216, "answer_id": 28020311, "question_id": 28017548, "link": "https://stackoverflow.com/questions/28017548/haskell-qualified-import-of-a-set-of-functions/28020311#28020311", "title": "Haskell *qualified* import of a set of functions", "body": "<pre><code>import qualified Data.List as List (sort, intersperse)\n</code></pre>\n\n<p>This is actually fine and works. The grammar of an import declaration is as follows:</p>\n\n<blockquote>\n  <h3>5.3 Import Declarations</h3>\n\n<pre><code>impdecl   \u2192   import [qualified] modid [as modid] [impspec]\n</code></pre>\n</blockquote>\n\n<p><code>qualified</code> and <code>as</code> do <em>not</em> prevent an import specification. This isn't a Haskell2010 addition, as it has been part of the <a href=\"https://www.haskell.org/onlinereport/modules.html#sect5.3\">Haskell 98 report</a>.</p>\n\n<p>On the other hand your first example</p>\n\n<pre><code>import qualified Data.List (sort, intersperse) as List\n--     qualified           impspec!            as modid\n--                            ^                    ^         \n--                            +--------------------+\n</code></pre>\n\n<p>doesn't follow the grammar, as the impspec must be the last element in an import declaration if it's provided.</p>\n"}], "owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2968, "favorite_count": 1, "accepted_answer_id": 28020311, "answer_count": 3, "score": 14, "last_activity_date": 1421655216, "creation_date": 1421637975, "question_id": 28017548, "link": "https://stackoverflow.com/questions/28017548/haskell-qualified-import-of-a-set-of-functions", "title": "Haskell *qualified* import of a set of functions", "body": "<p>In Haskell, I can import a module qualified by its name or a shortcut name, like so:</p>\n\n<pre><code>import qualified Data.List as List\nimport qualified Data.Map\n</code></pre>\n\n<p>I can also import only a select set of functions from a module, or import all functions other than a select set, like so:</p>\n\n<pre><code>import Data.List (sort, intersperse)\nimport Data.Map hiding (findWithDefault)\n</code></pre>\n\n<p>Is it possible to import a specific set of functions, like in the <code>import Data.List (sort, intersperse)</code> example above, but to ensure the functions are still identified in a qualified way, such as <code>List.sort</code> and <code>List.intersperse</code>?</p>\n\n<p>Though this does not work, it is the spirit of what I am asking:</p>\n\n<pre><code>import qualified Data.List (sort, intersperse) as List\n</code></pre>\n\n<p>or perhaps</p>\n\n<pre><code>import qualified Data.List as List (sort, intersperse)\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "is_accepted": false, "score": 0, "last_activity_date": 1421631470, "creation_date": 1421631470, "answer_id": 28016799, "question_id": 28016759, "link": "https://stackoverflow.com/questions/28016759/leaf-trees-in-haskell-non-exhaustive-pattern/28016799#28016799", "title": "Leaf Trees in Haskell - non-exhaustive pattern", "body": "<p>Ok, </p>\n\n<p>this was straightforward, i need some rest i guess:</p>\n\n<p>This was missing :</p>\n\n<pre><code>select (Fork l r) [] = Nothing\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "edited": false, "score": 0, "creation_date": 1421633970, "post_id": 28016867, "comment_id": 44421366, "body": "Thank you for the insights Cirdec, i have a test tomorrow and i am a bit late on the study, your help is graceful :)"}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 1, "creation_date": 1421653678, "post_id": 28016867, "comment_id": 44426353, "body": "Use <code>:set -fwarn-incomplete-patterns</code> in GHCi, or simply <code>.set -Wall</code> for all warnings."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 6, "last_activity_date": 1421632774, "last_edit_date": 1495541569, "creation_date": 1421632072, "answer_id": 28016867, "question_id": 28016759, "link": "https://stackoverflow.com/questions/28016759/leaf-trees-in-haskell-non-exhaustive-pattern/28016867#28016867", "title": "Leaf Trees in Haskell - non-exhaustive pattern", "body": "<h3>Ask the compiler</h3>\n\n<p>GHC can warn you about non-exhaustive patterns at compile time instead of waiting to run time to discover them. If I put your code into a file and compile it with the <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/options-sanity.html#idp10519744\" rel=\"nofollow noreferrer\"><code>-fwarn-incomplete-patterns</code> flag</a></p>\n\n<pre><code>ghc -fwarn-incomplete-patterns nonExhaustiveLeafTree.hs\n</code></pre>\n\n<p>It produces the following error message:</p>\n\n<pre><code>    Pattern match(es) are non-exhaustive\n    In an equation for `select':\n        Patterns not matched:\n            (Leaf _) _\n            (Fork (Fork _ _) _) []\n            (Fork (Leaf _) (Fork _ _)) []\n            (Fork (Leaf _) (Leaf _)) []\n</code></pre>\n\n<p>After adding the <a href=\"https://stackoverflow.com/a/28016799/414413\">rule you suggested in your answer</a> to cover <code>[]</code>, it still produces a warning about anything where the tree is a <code>Leaf _</code></p>\n\n<pre><code>    Pattern match(es) are non-exhaustive\n    In an equation for `select': Patterns not matched: (Leaf _) _\n</code></pre>\n\n<h3>Covering everything</h3>\n\n<p>We can cover all of the patterns easily if we handle <code>Leaf</code>s and <code>Fork</code>s separately from each other. This also removes the duplicate code of deciding which way to go on a <code>Fork</code> when its direct descendants are leaves. </p>\n\n<p>You'll know that there's a result when you reach a <code>Leaf</code> and there's no path left to follow.</p>\n\n<pre><code>select (Leaf a) [] = Just a\n</code></pre>\n\n<p>You'll need to decide what to do when you reach a <code>Leaf</code> and there's still a path you need to follow.</p>\n\n<pre><code>select (Leaf a) (l:ls) = ????\n</code></pre>\n\n<p>Like you mentioned in your answer, you'll know there's no result when there's no path left and you are at a <code>Fork</code>.</p>\n\n<pre><code>select (Fork _ _) [] = Nothing\n</code></pre>\n\n<p>You can simplify what happens when there's a fork and a path to a single rule.</p>\n\n<pre><code>select (Fork l r) (b:bs) = if b\n                           then select r bs\n                           else select l bs\n</code></pre>\n"}], "owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 0, "accepted_answer_id": 28016867, "answer_count": 2, "score": 0, "last_activity_date": 1421632774, "creation_date": 1421631083, "question_id": 28016759, "link": "https://stackoverflow.com/questions/28016759/leaf-trees-in-haskell-non-exhaustive-pattern", "title": "Leaf Trees in Haskell - non-exhaustive pattern", "body": "<p>This function follows a path of Bools, going left or right depending on False or True, respectively</p>\n\n<pre><code>data LTree a = Leaf a \n             | Fork (LTree a) (LTree a)\n             deriving (Show)\n\nselect :: LTree a -&gt; [Bool] -&gt; (Maybe a)\nselect (Fork (Leaf a) (Leaf b)) (l:ls)  = if l==False  then Just a \n                                                       else Just b\nselect (Fork l r) (b:bs) = if b==False  then select l bs\n                                        else select r bs\n</code></pre>\n\n<p>The thing is, LTree does not have declared the Empty value, how can i know that it is a node or a fork that i am falling into with my function?</p>\n"}, {"tags": ["haskell", "recursion", "functor", "algebraic-data-types", "category-theory"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1421635498, "post_id": 28016665, "comment_id": 44421630, "body": "1. What is the point of <code>:~:</code>? Your function is probably impractical if you have to call it with <code>Refl</code> all the time. 2. If I write <code>gmap f = cata ( embed . bimap f id )</code> and let the compiler infer the type, I get <code>(Foldable t, Unfoldable d, Bifunctor p, Base d ~ p b, Base t ~ p a) =&gt; (a -&gt; b) -&gt; t -&gt; d</code>. Is there anything wrong with this most general type? You can have a more specific type if you like. The compiler is perfectly happy with your function, so I don&#39;t know what the actual question is."}, {"owner": {"reputation": 741, "user_id": 2963238, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/28ca5f7c13e9099945f7adbc1ddacea5?s=128&d=identicon&r=PG&f=1", "display_name": "gonzaw", "link": "https://stackoverflow.com/users/2963238/gonzaw"}, "edited": false, "score": 0, "creation_date": 1421636724, "post_id": 28016665, "comment_id": 44421836, "body": "@user2405038 I want to create an instance of <code>Functor</code> using <code>fmap = gmap</code>"}], "answers": [{"comments": [{"owner": {"reputation": 741, "user_id": 2963238, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/28ca5f7c13e9099945f7adbc1ddacea5?s=128&d=identicon&r=PG&f=1", "display_name": "gonzaw", "link": "https://stackoverflow.com/users/2963238/gonzaw"}, "edited": false, "score": 0, "creation_date": 1421875240, "post_id": 28068136, "comment_id": 44532972, "body": "Awesome! Just a minor quirk though. I&#39;m trying to test this out with a typical List type, like so <code>data ListT a = ConsT a (ListT a) | NilT</code>, <code>data ListF a b = NilF | ConsF a b</code>, <code>type instance Base (ListT a) = ListF a</code>. I create an instance of <code>Bifunctor</code>, and when when I try to create an instance <code>instance Foldable (ListT a) where</code> I get the following error: <code>Couldn&#39;t match type \u2018Base (ListF a Data.Constraint.Forall.A)\u2019 with \u2018p1 Data.Constraint.Forall.A\u2019  The type variable p1 is ambiguous</code>. Idem with <code>Unfoldable</code>"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 741, "user_id": 2963238, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/28ca5f7c13e9099945f7adbc1ddacea5?s=128&d=identicon&r=PG&f=1", "display_name": "gonzaw", "link": "https://stackoverflow.com/users/2963238/gonzaw"}, "edited": false, "score": 0, "creation_date": 1421910776, "post_id": 28068136, "comment_id": 44544168, "body": "That&#39;s because that horrible <code>Functor</code> instance matches not just for <code>ListT</code>, but also for <code>ListF</code>..."}, {"owner": {"reputation": 741, "user_id": 2963238, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/28ca5f7c13e9099945f7adbc1ddacea5?s=128&d=identicon&r=PG&f=1", "display_name": "gonzaw", "link": "https://stackoverflow.com/users/2963238/gonzaw"}, "edited": false, "score": 0, "creation_date": 1421972792, "post_id": 28068136, "comment_id": 44577662, "body": "Great, now it works! I don&#39;t mind the newtype wrapping. From what I&#39;ve read, it&#39;s a best practice to make these &quot;exotic&quot; automatic kind of instances of common typeclasses (Applicative, Functor, Monad) with a newtype wrapper instead, to prevent orphan instances and the like. I could always just use <code>gmap</code> alone when using <code>ListT</code>, but if I ever need to use the functionality of <code>Functor</code> I&#39;d just wrap and unwrap it quickly. If it bothered me that much, I&#39;d just include a quick <code>instance Functor ListT where fmap f = unF . fmap f. F</code> and be done with it"}, {"owner": {"reputation": 741, "user_id": 2963238, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/28ca5f7c13e9099945f7adbc1ddacea5?s=128&d=identicon&r=PG&f=1", "display_name": "gonzaw", "link": "https://stackoverflow.com/users/2963238/gonzaw"}, "edited": false, "score": 0, "creation_date": 1421972948, "post_id": 28068136, "comment_id": 44577701, "body": "In fact, I wonder if it&#39;s possible to use Template Haskell to include that little  <code>Functor ListT</code> instance. That definition would be the same no matter the type. If I have another type, like <code>TreeT</code>, it would still be <code>fmap f = unF . fmap f . F</code>, right? If so, I think I might try a little bit with that!"}, {"owner": {"reputation": 741, "user_id": 2963238, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/28ca5f7c13e9099945f7adbc1ddacea5?s=128&d=identicon&r=PG&f=1", "display_name": "gonzaw", "link": "https://stackoverflow.com/users/2963238/gonzaw"}, "edited": false, "score": 0, "creation_date": 1421973006, "post_id": 28068136, "comment_id": 44577720, "body": "Sorry for triple posting, but would this be a good functionality to include in the recursion-schemes library?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 741, "user_id": 2963238, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/28ca5f7c13e9099945f7adbc1ddacea5?s=128&d=identicon&r=PG&f=1", "display_name": "gonzaw", "link": "https://stackoverflow.com/users/2963238/gonzaw"}, "edited": false, "score": 0, "creation_date": 1421974784, "post_id": 28068136, "comment_id": 44578223, "body": "Of course if you can add hand-written <code>instance Functor ListT</code> instances, you might as well set <code>fmap = gmap</code> in there, alleviating the need for this generic instance and the <code>F</code> newtype wrapper."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 1, "last_activity_date": 1421911695, "last_edit_date": 1495539810, "creation_date": 1421845949, "answer_id": 28068136, "question_id": 28016665, "link": "https://stackoverflow.com/questions/28016665/haskell-functor-instance-for-generic-polymorphic-algebraic-data-types-using-re/28068136#28068136", "title": "Haskell - Functor instance for generic polymorphic Algebraic Data Types using recursion-schemes", "body": "<p><a href=\"https://stackoverflow.com/a/28067872/477476\">With a little help from @kosmikus</a>, I was able to hack together a version that works, as long as you're OK with <code>UndecidableInstances</code>.</p>\n\n<p>The idea is to remove all references to <code>a</code> and <code>b</code> from the context of <code>gmap</code>, by requiring <code>forall x. Foldable (f x)</code> and so on, encoded using the <a href=\"http://hackage.haskell.org/package/constraints-0.4.1.3\" rel=\"nofollow noreferrer\">constraints</a> package:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, ScopedTypeVariables, TypeOperators, ConstraintKinds #-}\n{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, FlexibleContexts #-}\nimport Data.Bifunctor\nimport Data.Functor.Foldable\nimport Data.Constraint\nimport Data.Constraint.Forall\n\n-- https://stackoverflow.com/a/28067872/477476\nclass (p x ~ Base (f x)) =&gt; Based p f x\ninstance (p x ~ Base (f x)) =&gt; Based p f x\n\ngmap :: forall p f a b. ( Bifunctor p \n                        , ForallF Foldable f\n                        , ForallF Unfoldable f\n                        , Forall (Based p f))\n     =&gt; (a -&gt; b) -&gt; f a -&gt; f b\ngmap f = case (instF :: ForallF Foldable f :- Foldable (f a)) of\n  Sub Dict -&gt; case (instF :: ForallF Unfoldable f :- Unfoldable (f b)) of\n    Sub Dict -&gt; case (inst :: Forall (Based p f) :- Based p f a) of\n      Sub Dict -&gt; case (inst :: Forall (Based p f) :- Based p f b) of\n        Sub Dict -&gt; cata (embed . bimap f id)\n</code></pre>\n\n<p>With <code>a</code> and <code>b</code> out of the way, we can turn <code>gmap</code> into <code>fmap</code>:</p>\n\n<pre><code>{-# LANGUAGE UndecidableInstances #-}\ninstance (Bifunctor p, ForallF Foldable f, ForallF Unfoldable f, Forall (Based p f)) =&gt; Functor f where\n    fmap = gmap\n</code></pre>\n\n<p><strong>Edited to add</strong>: the trouble with the above instance is that it will match any type at the right kind, as noted by @gonzaw: if you have</p>\n\n<pre><code>data ListT a = NilT\n             | ConsT a (ListT a)\n\ndata ListF a b = NilF\n               | ConsF a b\n\ntype instance Base (ListT a) = ListF a\n\ninstance Bifunctor ListF where ...\ninstance Functor (ListF a) where ...\ninstance Foldable (ListT a) where ...\ninstance Unfoldable (ListT a) where ...\n</code></pre>\n\n<p>then you get more than you bargained for, and the generic <code>Functor</code> instance and the one for <code>ListF a</code>(!) overlap.</p>\n\n<p>You can add one more layer of newtype wrappers to get around that: if instead, you have</p>\n\n<pre><code>newtype F f x = F{ unF ::  (f x) }\n\ninstance (Bifunctor p, ForallF Foldable f, ForallF Unfoldable f, Forall (Based p f)) =&gt; Functor (F f) where\n    fmap f = F . gmap f . unF\n\ntype ListT' = F ListT\n</code></pre>\n\n<p>then finally the following typechecks:</p>\n\n<pre><code>*Main&gt; unF . fmap (+1) . F $ ConsT 1 $ ConsT 2 NilT\nConsT 2 (ConsT 3 NilT)\n</code></pre>\n\n<p>Whether this extra layer of <code>newtype</code> wrapping is acceptable for you is something you'll have to decide.</p>\n"}], "owner": {"reputation": 741, "user_id": 2963238, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/28ca5f7c13e9099945f7adbc1ddacea5?s=128&d=identicon&r=PG&f=1", "display_name": "gonzaw", "link": "https://stackoverflow.com/users/2963238/gonzaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 1, "accepted_answer_id": 28068136, "answer_count": 1, "score": 4, "last_activity_date": 1421911695, "creation_date": 1421629927, "last_edit_date": 1495539810, "question_id": 28016665, "link": "https://stackoverflow.com/questions/28016665/haskell-functor-instance-for-generic-polymorphic-algebraic-data-types-using-re", "title": "Haskell - Functor instance for generic polymorphic Algebraic Data Types using recursion-schemes", "body": "<h2>Problem:</h2>\n\n<p>Recently I asked the following question on here, asking how to create a generic map function, and a generic instance of <code>Functor</code> for any arbitrary polymorphic ADT (Algebraic Data Type), like Lists, Trees, etc:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/27856974/functor-instance-for-generic-polymorphic-adts-in-haskell\">Functor instance for generic polymorphic ADTs in Haskell?</a></p>\n\n<p>Now, I'm trying to reformulate the above to be compatible with <code>recursion-schemes</code>. I.e, instead of defining the base functor, and then define the type as its fixed point, I want to define the type on one hand, the base functor on the other, and correlate them using the <code>Base</code> family type.</p>\n\n<p>So instead of doing this:</p>\n\n<pre><code>data ListF a b = NilF | ConsF a b\nnewtype Fix f = Fix { unFix :: f (Fix f) }\ntype List a = Fix (ListF a)\n</code></pre>\n\n<p>I want to do this:</p>\n\n<pre><code>data ListF a b = NilF | ConsF a b\ndata List a = Nil | Cons a (List a)\ntype instance Base (List a) = ListF a\n</code></pre>\n\n<p>This way I could leverage the power of the <code>recursion-schemes</code> library, while still being able to define a generic <code>fmap</code> for any of these polymorphic types. Not only that, but it's a more pleasant experience being able to use the \"normal\" type without it being a type synonym for the fix point.</p>\n\n<h2>Attempt:</h2>\n\n<p>Initially I thought about having a <code>Bifunctor</code> instance on one hand, and somehow coercing or making it equal to the corresponding <code>Base</code> family instance. At the moment I can only think about using <code>a :~: b</code> from <code>Data.Type.Equality</code>. This is what I've got so far:</p>\n\n<pre><code>{-# LANGUAGE TypeOperators, Rank2Types #-}\nimport Data.Bifunctor\nimport Data.Functor.Foldable\nimport Data.Type.Equality\n\ngmap :: (Bifunctor p, Foldable (f a), Unfoldable (f b)) =&gt; \n        (forall x. p x :~: Base (f x)) -&gt; (a -&gt; b) -&gt; f a -&gt; f b\ngmap refl f = cata alg\n    where\n        alg = embed . \n              castWith (apply refl Refl) . \n              bimap f id . \n              castWith (apply (sym refl) Refl)\n</code></pre>\n\n<p>My problem comes in trying to define an instance of <code>Functor</code> though. I don't know how to specify those specific type constraints when defining the instance.\nI was thinking about somehow creating a typeclass <code>Equals</code>, and doing something like this:</p>\n\n<pre><code>instance (Bifunctor p, Foldable (f a), Unfoldable (f b), Equals (p a) (Base (f a))) \n    =&gt; Functor f where\n</code></pre>\n\n<p>But I don't know if that's possible, nor if I'm approaching it in the right way (for instance I'm not sure if my definition of <code>gmap</code> is the correct one).</p>\n\n<hr>\n\n<p><em>For reference, this is the definition of the generic <code>gmap</code> from the original SO question:</em></p>\n\n<pre><code>gmap :: (Bifunctor f) =&gt; (a -&gt; b) -&gt; Fix (f a) -&gt; Fix (f b)\ngmap f = unwrapFixBifunctor . cata alg . wrapFixBifunctor\n  where\n    alg = Fix . bimap f id\n\n    unwrapFixBifunctor :: (Bifunctor f) =&gt; Fix (WrappedBifunctor f a) -&gt; Fix (f a)\n    unwrapFixBifunctor = Fix . unwrapBifunctor . fmap unwrapFixBifunctor . unFix\n\n    wrapFixBifunctor :: (Bifunctor f) =&gt; Fix (f a) -&gt; Fix (WrappedBifunctor f a)\n    wrapFixBifunctor = Fix . fmap wrapFixBifunctor . WrapBifunctor . unFix\n</code></pre>\n\n<hr>\n\n<h2>Update:</h2>\n\n<p>It was noted that the following definition of <code>gmap</code> would be more general, and would not need any weird application of type-level equality:</p>\n\n<pre><code>gmap :: (Foldable t, Unfoldable d, Bifunctor p, Base d ~ p b, Base t ~ p a)\n        =&gt; (a -&gt; b) -&gt; t -&gt; d\ngmap f = cata ( embed . bimap f id )\n</code></pre>\n\n<p>However, I still can't find a way to create an instance of <code>Functor</code> that has similar type constraints</p>\n"}, {"tags": ["haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1421646279, "post_id": 28016604, "comment_id": 44423873, "body": "Aside from apparently meaning &quot;championships&quot; in Romanian, what does &quot;campionate&quot; mean?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1421647630, "post_id": 28016604, "comment_id": 44424193, "body": "You may want to look at the <code>monad-par</code> package. It doesn&#39;t seem to quite go where you&#39;re looking, but <code>Control.Monad.Par.IO</code> may ease the pain a bit. It&#39;s conceivable that you could hook into the sort of goo that makes ThreadScope go, but I doubt that will give you quite what you want. Another option might be to use something horrible and unsafe like <code>trace</code> or <code>unsafePerformIO</code> to let threads report completion. I think the essential problem is that &quot;has such-and-such a thread finished yet?&quot; is not a question that makes sense in a pure context."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1421656934, "post_id": 28016604, "comment_id": 44427594, "body": "You should add <code>parMap</code>&#39;s type, or mention if it&#39;s from <code>Control.Parallel.Strategies</code>."}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1421672079, "post_id": 28016604, "comment_id": 44435534, "body": "@dfeuer Woops. I meant &quot;sample&quot; I guess."}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1421672212, "post_id": 28016604, "comment_id": 44435611, "body": "@Zeta I have just realised that <code>parMap</code> is unnecessary. For the sake of the discussion it&#39;s equal to <code>map</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1421675857, "post_id": 28016604, "comment_id": 44437749, "body": "@Jefffrey: So, for the sake of discussion, a <code>mapWithCounter :: NFData b =&gt; _ -&gt; (a -&gt; b) -&gt; [a] -&gt; IO [b]</code> would be fine? I have an idea, but I&#39;m gone for the rest of the day."}, {"owner": {"reputation": 891, "user_id": 99978, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/784837d98d18ff99681f612a62dddbcc?s=128&d=identicon&r=PG", "display_name": "j.p.", "link": "https://stackoverflow.com/users/99978/j-p"}, "edited": false, "score": 0, "creation_date": 1421703131, "post_id": 28016604, "comment_id": 44452559, "body": "You wrote that the whole map operation takes a while. Is this because of the high number of elements in the list or does each mapped function take long?"}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "reply_to_user": {"reputation": 891, "user_id": 99978, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/784837d98d18ff99681f612a62dddbcc?s=128&d=identicon&r=PG", "display_name": "j.p.", "link": "https://stackoverflow.com/users/99978/j-p"}, "edited": false, "score": 0, "creation_date": 1421708370, "post_id": 28016604, "comment_id": 44454838, "body": "@j.p. Actually both. The initial list is long N (with N very long), the operation on each element of this list generates a list of N elements too (so the idea it to generate a matrix out of a list). And the computation of this list for every element is relatively expensive."}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1421708411, "post_id": 28016604, "comment_id": 44454851, "body": "I also have another instance where I just map over a N^2 list performing relatively simple tasks on each element."}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1421710126, "post_id": 28016604, "comment_id": 44455457, "body": "@Zeta That would be equivalent to a <code>mapM</code> in the sense that suddenly we are introducing <code>IO</code> and losing the benefits of pure code. Or maybe I&#39;m not understanding you correctly."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1421710958, "post_id": 28016604, "comment_id": 44455752, "body": "@Jefffrey: No, you understand perfectly fine. Displaying the status every once in a while necessarily leads to <code>IO</code>. It&#39;s exactly what dfeuer mentioned. The &quot;how-much-has-my-map-finished?&quot; question cannot really get answered in pure code."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1422038880, "post_id": 28016604, "comment_id": 44607441, "body": "@Zeta, in principle, it would be possible to set up the runtime system to allow these threads to be tagged when sparked (using a version of <code>par</code> that takes a tag), and then to offer IO actions to get information about just the threads that have a certain tag. But this would probably be a bit tricky to do efficiently, and as far as I can tell, GHC just doesn&#39;t offer anything remotely like this."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1421656890, "creation_date": 1421656890, "answer_id": 28020691, "question_id": 28016604, "link": "https://stackoverflow.com/questions/28016604/keep-track-of-progress-of-a-map/28020691#28020691", "title": "Keep track of progress of a `map`", "body": "<p>One could try to craft this behaviour using <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/System-Timeout.html#v:timeout\" rel=\"nofollow\">timeout</a>.</p>\n\n<pre><code>seconds :: Int\nseconds = 1000000\n\nprogress :: [a] -&gt; IO ()\nprogress [] = return ()\nprogress l@(x:xs) =\n  do r &lt;- timeout (5 * seconds) x  -- 5s\n     threadDelay (2 * seconds)     -- 2s more delay\n     case r of\n       Nothing -&gt; progress l  -- retry\n       Just y  -&gt; do putStrLn \"one done!\"\n                     progress xs\n</code></pre>\n\n<p>Be careful since I fear that <code>timeout</code> is aborting the computation. If there's another thread that evaluates <code>x</code> that should be fine, but if this is the only thread doing that it could cause a livelock if 5 seconds are not enough.</p>\n"}, {"tags": [], "owner": {"reputation": 891, "user_id": 99978, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/784837d98d18ff99681f612a62dddbcc?s=128&d=identicon&r=PG", "display_name": "j.p.", "link": "https://stackoverflow.com/users/99978/j-p"}, "is_accepted": true, "score": 2, "last_activity_date": 1422023652, "creation_date": 1422023652, "answer_id": 28112140, "question_id": 28016604, "link": "https://stackoverflow.com/questions/28016604/keep-track-of-progress-of-a-map/28112140#28112140", "title": "Keep track of progress of a `map`", "body": "<p>In production you probably shouldn't use trace and are forced to deal with the complications of needing IO, but for tests you could modify the definition of parMap to take another parameter telling when to emit a count:</p>\n\n<pre><code>import Control.Monad (sequence)\nimport Control.Parallel.Strategies (Strategy, using, rseq, rparWith, parMap)\nimport Debug.Trace (traceShow)\nimport System.IO (hFlush, hSetBuffering, BufferMode(NoBuffering), stdout)\n\nevalList' :: Integer -&gt; Strategy a -&gt; Strategy [a]\nevalList' t s as = sequence $ foldr f [] $ zip as [1..]\n  where f (a, n) ss | n `mod` t == 0 = s (traceShow n a):ss\n                    | otherwise      = s a:ss\n\nparList' :: Integer -&gt; Strategy a -&gt; Strategy [a]\nparList' t s = evalList' t (rparWith s)\n\nparMap' :: Integer -&gt; Strategy b -&gt; (a -&gt; b) -&gt; [a] -&gt; [b]\nparMap' t s f xs = map f xs `using` parList' t s\n\n-- some work to do\nfib :: Integer -&gt; Integer\nfib 0 = 1\nfib 1 = 1\nfib n = fib (n-1) + fib(n-2)\n\nmain = do hSetBuffering stdout NoBuffering\n          print $ sum (parMap' 1000 rseq (fib.(+20).(`mod` 5)) ([1..10000]::[Integer]))\n</code></pre>\n\n<p>If the work packages given by each list element become to small, you could adapt parListChunk instead accordingly.</p>\n"}], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 3, "accepted_answer_id": 28112140, "answer_count": 2, "score": 11, "last_activity_date": 1424188660, "creation_date": 1421629365, "last_edit_date": 1424188660, "question_id": 28016604, "link": "https://stackoverflow.com/questions/28016604/keep-track-of-progress-of-a-map", "title": "Keep track of progress of a `map`", "body": "<p>I have a <code>map</code> operation (that is actually run in parallel using <code>parMap</code> from <code>Control.Parallel.Strategies</code>) that takes quite a while. Given that I know how many times the function is applied (<code>n</code> in this context), how can I easily display, every once in a while, how many of the <code>n</code> applications have been evaluated?</p>\n\n<p>The obvious solution would be to make the map a <code>mapM</code> with some <code>putStr</code> inside the mapping function, but that would:</p>\n\n<ul>\n<li>take an unnecessary amount of efficiency</li>\n<li>not sample the status every once in a while but in every applications</li>\n<li>basically remove all the good things about a deterministic algorithm in the context of parallelism</li>\n</ul>\n\n<p>So, is there a way to keep track of this information, that I'm missing, that avoids these problems?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 289, "user_id": 1038753, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/aa2db486b7ce866a9da3d29134b236c9?s=128&d=identicon&r=PG", "display_name": "Heinrich Ody", "link": "https://stackoverflow.com/users/1038753/heinrich-ody"}, "edited": false, "score": 0, "creation_date": 1421627340, "post_id": 28016320, "comment_id": 44420141, "body": "In my editor I inserted indention as tabs (not converted to spaces). If I use spaces instead it works. Thanks!"}], "tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": true, "score": 3, "last_activity_date": 1421626407, "creation_date": 1421626407, "answer_id": 28016320, "question_id": 28016304, "link": "https://stackoverflow.com/questions/28016304/syntax-with-where-in-haskell/28016320#28016320", "title": "Syntax with where in Haskell", "body": "<p>There's <a href=\"http://coliru.stacked-crooked.com/a/597dd6f679d6e1bc\" rel=\"nofollow\">absolutely nothing</a> wrong with your code.</p>\n"}], "owner": {"reputation": 289, "user_id": 1038753, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/aa2db486b7ce866a9da3d29134b236c9?s=128&d=identicon&r=PG", "display_name": "Heinrich Ody", "link": "https://stackoverflow.com/users/1038753/heinrich-ody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 28016320, "answer_count": 1, "score": 0, "last_activity_date": 1421626407, "creation_date": 1421626239, "question_id": 28016304, "link": "https://stackoverflow.com/questions/28016304/syntax-with-where-in-haskell", "title": "Syntax with where in Haskell", "body": "<p>I have the following simple definition.</p>\n\n<pre><code>f :: Int -&gt; Int\nf x = bla + blub\n  where blub = 1\n        bla = 1\n</code></pre>\n\n<p>The compiler gives me the error <code>test.hs:4:21: parse error on input '='</code>\nI know about the indention rules, but all seems to be well indented here.</p>\n"}, {"tags": ["haskell", "charts", "ihaskell"], "comments": [{"owner": {"reputation": 1593, "user_id": 1829442, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f1b88b650cc161e532273962f4017f75?s=128&d=identicon&r=PG", "display_name": "idontgetoutmuch", "link": "https://stackoverflow.com/users/1829442/idontgetoutmuch"}, "edited": false, "score": 0, "creation_date": 1422103308, "post_id": 28016264, "comment_id": 44624349, "body": "Did you manage to find a solution?"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 1593, "user_id": 1829442, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f1b88b650cc161e532273962f4017f75?s=128&d=identicon&r=PG", "display_name": "idontgetoutmuch", "link": "https://stackoverflow.com/users/1829442/idontgetoutmuch"}, "edited": false, "score": 0, "creation_date": 1422144206, "post_id": 28016264, "comment_id": 44636011, "body": "@idontgetoutmuch: No, not so far."}], "answers": [{"tags": [], "owner": {"reputation": 1593, "user_id": 1829442, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f1b88b650cc161e532273962f4017f75?s=128&d=identicon&r=PG", "display_name": "idontgetoutmuch", "link": "https://stackoverflow.com/users/1829442/idontgetoutmuch"}, "is_accepted": true, "score": 1, "last_activity_date": 1422206006, "creation_date": 1422206006, "answer_id": 28139096, "question_id": 28016264, "link": "https://stackoverflow.com/questions/28016264/haskell-chart-library-make-log-log-line-chart-with-identical-x-and-y-axes/28139096#28139096", "title": "Haskell Chart library: make log-log line chart with identical x and y axes", "body": "<p>This will do but could be vastly improved (not least by removing the unsafePerformIO).</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall                      #-}\n{-# OPTIONS_GHC -fno-warn-name-shadowing   #-}\n{-# OPTIONS_GHC -fno-warn-type-defaults    #-}\n{-# OPTIONS_GHC -fno-warn-unused-do-bind   #-}\n{-# OPTIONS_GHC -fno-warn-missing-methods  #-}\n{-# OPTIONS_GHC -fno-warn-orphans          #-}\n\nimport Graphics.Rendering.Chart hiding ( translate )\nimport Graphics.Rendering.Chart.Backend.Diagrams\nimport Diagrams.Backend.Cairo.CmdLine\nimport Diagrams.Prelude hiding ( render, Renderable )\nimport Data.Default.Class\nimport Diagrams.Backend.CmdLine\n\nimport System.IO.Unsafe\n\n\npointVals :: [(Double, Double)]\npointVals = map (\\(x,y) -&gt; (log x, log y)) [(1,10), (10, 100), (100, 1000)]\n\ndataPts :: PlotPoints Double Double\ndataPts = plot_points_style .~ filledCircles 2 (opaque red)\n          $ plot_points_values .~ pointVals\n          $ plot_points_title .~ \"Data points\"\n          $ def\n\nlayout :: Layout Double Double\nlayout = layout_title .~ \"Log vs Log\"\n         $ layout_y_axis . laxis_generate .~ scaledAxis def (0,10)\n         $ layout_x_axis . laxis_generate .~ scaledAxis def (0,10)\n         $ layout_plots .~ [toPlot dataPts]\n         $ def\n\nmyChart :: Renderable ()\nmyChart = toRenderable layout\n\ndenv :: DEnv\ndenv = unsafePerformIO $ defaultEnv vectorAlignmentFns 500 500\n\ndisplayHeader :: FilePath -&gt; Diagram B R2 -&gt; IO ()\ndisplayHeader fn =\n  mainRender ( DiagramOpts (Just 900) (Just 700) fn\n             , DiagramLoopOpts False Nothing 0\n             )\n\nmyDiagram :: Diagram Cairo R2\nmyDiagram = fst $ runBackend denv (render myChart (500, 500))\n\nmain :: IO ()\nmain = displayHeader \"LogChart.png\" myDiagram\n</code></pre>\n"}], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 667, "favorite_count": 0, "accepted_answer_id": 28139096, "answer_count": 1, "score": 1, "last_activity_date": 1422206006, "creation_date": 1421625712, "last_edit_date": 1421626023, "question_id": 28016264, "link": "https://stackoverflow.com/questions/28016264/haskell-chart-library-make-log-log-line-chart-with-identical-x-and-y-axes", "title": "Haskell Chart library: make log-log line chart with identical x and y axes", "body": "<p>Ok, I'm getting stumped by the Haskell <a href=\"https://hackage.haskell.org/package/Chart-1.3.3\" rel=\"nofollow noreferrer\">Chart</a> library.  I've figured out this way to make a log-log line chart of a <code>Vector</code> of values in Kronos Haskell:</p>\n\n<pre><code>import Data.Vector (Vector, (!))\nimport qualified Data.Vector as V\nimport Graphics.Rendering.Chart.Easy hiding (Vector)\n\nlogLogChart name points = toRenderable $ execEC $ plot chart\n    where chart = line name [V.toList $ V.imap makePoint points]\n          makePoint x y = (LogValue (fromIntegral (x+1)), LogValue y)\n</code></pre>\n\n<p>This certainly does render a reasonable log-log line chart, with automatically chosen ranges for the x and y axes based on the data.  One example (as rendered in Kronos Haskell):</p>\n\n<p><img src=\"https://i.stack.imgur.com/xVYVG.png\" alt=\"Example log-log chart\"></p>\n\n<p>The problem is that I have a specialized application where I need these two things:</p>\n\n<ol>\n<li>The range of the two axes needs to be the same.  (Since my x-axis is 1-based indices into a <code>Vector</code>, this could be simplified to have the range of the y-axis determined by that of the x-axis.)</li>\n<li>The dimensions of the rendered chart should be square, not rectangular as in the example above.</li>\n</ol>\n\n<p>I tried looking through the documentation for the library, but it's just got me completely stumped.  Any pointers?</p>\n"}, {"tags": ["haskell", "inheritance", "vector", "typeclass"], "comments": [{"owner": {"reputation": 1424, "user_id": 756714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a0c58c5ad07c97f187f3a9241c4d2639?s=128&d=identicon&r=PG", "display_name": "vivian", "link": "https://stackoverflow.com/users/756714/vivian"}, "edited": false, "score": 0, "creation_date": 1421629041, "post_id": 28016209, "comment_id": 44420513, "body": "Use hmatrix (<a href=\"http://hackage.haskell.org/package/hmatrix\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/hmatrix</a>)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 1424, "user_id": 756714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a0c58c5ad07c97f187f3a9241c4d2639?s=128&d=identicon&r=PG", "display_name": "vivian", "link": "https://stackoverflow.com/users/756714/vivian"}, "edited": false, "score": 0, "creation_date": 1421629679, "post_id": 28016209, "comment_id": 44420637, "body": "Is there any tutorial/guide? Every link there seems broken. Also, someone at Haskell pointed out a few good solutions (such as using Data.Array). Yet, I&#39;m interested in an actual answer to the question as asked for the sake of knowledge. Thank you very much!"}, {"owner": {"reputation": 1424, "user_id": 756714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a0c58c5ad07c97f187f3a9241c4d2639?s=128&d=identicon&r=PG", "display_name": "vivian", "link": "https://stackoverflow.com/users/756714/vivian"}, "edited": false, "score": 0, "creation_date": 1421652364, "post_id": 28016209, "comment_id": 44425821, "body": "Code examples: <a href=\"http://dis.um.es/~alberto/hmatrix/hmatrix.html\" rel=\"nofollow noreferrer\">dis.um.es/~alberto/hmatrix/hmatrix.html</a>"}, {"owner": {"reputation": 12661, "user_id": 648955, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/DUiuD.jpg?s=128&g=1", "display_name": "leventov", "link": "https://stackoverflow.com/users/648955/leventov"}, "edited": false, "score": 0, "creation_date": 1421662515, "post_id": 28016209, "comment_id": 44430408, "body": "Consider yarr or repa, which are designed for multidimensional."}, {"owner": {"reputation": 134362, "user_id": 83805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68c3dd15d6cd5d99a63113843d7e1c1b?s=128&d=identicon&r=PG", "display_name": "Don Stewart", "link": "https://stackoverflow.com/users/83805/don-stewart"}, "edited": false, "score": 0, "creation_date": 1421673705, "post_id": 28016209, "comment_id": 44436481, "body": "Repa is quite similar to Vector, and supports arbitrary (typed) dimensions."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1421690495, "post_id": 28030634, "comment_id": 44446404, "body": "I appreciate that answer since it solves the practical issue posted, but it doesn&#39;t solve the actual inner problem, which is extending builtin types with different interfaces. What if I, for example, wanted a matrix that worked with polar coordinates?"}, {"owner": {"reputation": 134362, "user_id": 83805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68c3dd15d6cd5d99a63113843d7e1c1b?s=128&d=identicon&r=PG", "display_name": "Don Stewart", "link": "https://stackoverflow.com/users/83805/don-stewart"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1421690982, "post_id": 28030634, "comment_id": 44446598, "body": "You get to program against the API the library has exposed. Normally for vector-alikes, you would overload the indexing type. This works for e.g. the base array library that is parameterized by coordinates. For vector, you have to write a wrapper that does it, since it is specialized to word-sized indexing."}], "tags": [], "owner": {"reputation": 134362, "user_id": 83805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68c3dd15d6cd5d99a63113843d7e1c1b?s=128&d=identicon&r=PG", "display_name": "Don Stewart", "link": "https://stackoverflow.com/users/83805/don-stewart"}, "is_accepted": false, "score": 1, "last_activity_date": 1421689642, "last_edit_date": 1592644375, "creation_date": 1421689642, "answer_id": 28030634, "question_id": 28016209, "link": "https://stackoverflow.com/questions/28016209/is-there-any-way-to-extend-data-vector-to-accept-2d-indices-without-having-to-a/28030634#28030634", "title": "Is there any way to extend Data.Vector to accept 2D indices, without having to almost rewrite the whole library?", "body": "<blockquote>\n<p>My program needs a Matrix type that works exactly the same as the Vector types on Hackage, except using 2D points instead of Ints for indexing</p>\n</blockquote>\n<p>The answer is to use a library for 2 (or higher) dimensional matrices.</p>\n<p>You can choose between those close to vector</p>\n<ul>\n<li><a href=\"http://hackage.haskell.org/package/repa\" rel=\"nofollow noreferrer\">repa</a></li>\n<li><a href=\"http://hackage.haskell.org/package/matrix\" rel=\"nofollow noreferrer\">matrix</a></li>\n</ul>\n<p>or further away</p>\n<ul>\n<li><a href=\"http://hackage.haskell.org/package/hmatrix\" rel=\"nofollow noreferrer\">hmatrix</a></li>\n</ul>\n<p>Repa is built on top of vector.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1421689642, "creation_date": 1421625294, "question_id": 28016209, "link": "https://stackoverflow.com/questions/28016209/is-there-any-way-to-extend-data-vector-to-accept-2d-indices-without-having-to-a", "title": "Is there any way to extend Data.Vector to accept 2D indices, without having to almost rewrite the whole library?", "body": "<p>My program needs a Matrix type that works exactly the same as the Vector types on Hackage, except using 2D points instead of Ints for indexing. I've started creating such extension, which shows below:</p>\n\n<pre><code>module Data.Matrix.Mutable where\n\nimport Control.Monad.Primitive\nimport Control.Monad.ST\nimport Linear\nimport qualified Data.Vector.Unboxed.Mutable as MUV\nimport qualified Data.Vector.Unboxed as UV\n\ndata MMatrix s t = MMatrix { dim :: V2 Int, buffer :: MUV.MVector s t }\n\nindexToPos :: Int -&gt; Int -&gt; V2 Int\nindexToPos width index = V2 (quot index width) (mod index width)\n\nposToIndex :: Int -&gt; V2 Int -&gt; Int\nposToIndex width (V2 x y) = y * width + x\n\nwidth :: MMatrix s t -&gt; Int\nwidth  (MMatrix (V2 w _) _) = w\n\nheight :: MMatrix s t -&gt; Int\nheight (MMatrix (V2 _ h) _) = h\n\nnew :: (PrimMonad m, MUV.Unbox t) =&gt; V2 Int -&gt; m (MMatrix (PrimState m) t)\nnew (dim@(V2 w h)) = return . MMatrix dim =&lt;&lt; MUV.new (w * h)\n\nwrite :: (PrimMonad m, MUV.Unbox t) =&gt; MMatrix (PrimState m) t -&gt; V2 Int -&gt; t -&gt; m ()\nwrite matrix pos val = MUV.write (buffer matrix) (posToIndex (width matrix) pos) val\n\nread :: (PrimMonad m, MUV.Unbox t) =&gt; MMatrix (PrimState m) t -&gt; V2 Int -&gt; m t\nread matrix pos = MUV.read (buffer matrix) (posToIndex (width matrix) pos)\n</code></pre>\n\n<p>On the progress, I've noticed I'm forced to manually write a wrapper for every single function for every single vector type. That process is not only tedious, but has high maintenance costs, since any change on their API will need an equally big change on my code. In a dynamic language, the solution is much simpler: overwrite the \"read\" and \"write\" functions on a Vector base type. Example (in JavaScript):</p>\n\n<pre><code>Matrix = clone(Vector);\nMatrix.read = function(x,y){\n    return Vector.read.call(this, this.width * y + x);\n};\nMatrix.set = function(x,y,val){\n    return Vector.write.call(this, this.width * y + x, val);\n};\n</code></pre>\n\n<p>From now on, Matrix works exactly like Vector, except indexed by 2D points, as intended. What is the equivalent strategy on Haskell (using typeclasses, I guess)?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1421632963, "post_id": 28015698, "comment_id": 44421159, "body": "Another place where I wonder about the difference is unit testing, or QuickCheck-like things. If you replace with <code>id</code> it might be possible to write a unit test that is more like a law: &quot;<code>myFunc 0</code> doesn&#39;t change anything ever ...&quot; or something like that, which could be proven via <code>id</code> but it&#39;s not clear to me what it would do in the other case."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 4, "last_activity_date": 1421621126, "creation_date": 1421621126, "answer_id": 28015698, "question_id": 28015570, "link": "https://stackoverflow.com/questions/28015570/is-there-an-advantage-to-using-a-point-free-identity-function-instead-of-a-wildc/28015698#28015698", "title": "Is there an advantage to using a point-free identity function instead of a wildcard?", "body": "<p>In GHC, there can be a difference. Which is better will depend on the situation. Specifically, a function is only inlined by the optimizer if it is \"fully applied\". So in the first formulation, if you were to do something like</p>\n\n<pre><code>fooThing (myFunc 0)\n</code></pre>\n\n<p>then (unless some other optimizations happen first), GHC will produce a closure representing <code>myFunc 0</code> and then apply it once <code>fooThing</code> decides to do so. If you use your <code>id</code>-based implementation instead, GHC will translate the above to</p>\n\n<pre><code>fooThing id\n</code></pre>\n"}], "owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 28015698, "answer_count": 1, "score": 2, "last_activity_date": 1421634511, "creation_date": 1421620204, "last_edit_date": 1495542437, "question_id": 28015570, "link": "https://stackoverflow.com/questions/28015570/is-there-an-advantage-to-using-a-point-free-identity-function-instead-of-a-wildc", "title": "Is there an advantage to using a point-free identity function instead of a wildcard?", "body": "<p>If a function has a case that will result in returning the input as-is, is there anything to be gained by using a point-free <code>id</code> for that case? </p>\n\n<p>Example:</p>\n\n<pre><code>-- First way, use some symbol as wildcard\nmyFunc :: Int -&gt; SomeData -&gt; SomeData\nmyFunc 0 _ = _\nmyFunc ...\n\n-- Second way, point-free `id`. Is this more efficient?\nmyFunc :: Int -&gt; SomeData -&gt; SomeData\nmyFunc 0 = id\nmyFunc ...\n</code></pre>\n\n<p>One standard function where I thought this might be used is <code>drop</code> since <code>drop 0</code> is effectively <code>id</code>. But if you look at the <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/src/GHC-List.html#drop\" rel=\"nofollow noreferrer\">source code</a>, it is not point free (there is <code>drop 0 xs = xs</code> ... you have to scroll down a little to see the definition; look for <code>drop (I# n#) ls</code>). I suspect it can't matter much if <code>drop</code> doesn't make use of it.</p>\n\n<p>Edit: Actually <a href=\"https://stackoverflow.com/a/8936002/567620\">it looks like equations with differing numbers of arguments is disallowed</a> by the case-expansion method for translating multiple-equation function definitions.</p>\n\n<p>So if you opted for this route, you'd have to make sure all the remaining equations for the function are also definable in the same point-free style -- which is highly unlikely for most functions.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 6, "creation_date": 1421621593, "post_id": 28015472, "comment_id": 44418697, "body": "I think this may be off-topic because this site is not suitable for the very first steps of learning a new programming language. There are many suitable Haskell tutorials available that will cover these basics."}], "answers": [{"comments": [{"owner": {"reputation": 39089, "user_id": 220834, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/a8qUy.jpg?s=128&g=1", "display_name": "Don Roby", "link": "https://stackoverflow.com/users/220834/don-roby"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1421622659, "post_id": 28015523, "comment_id": 44418973, "body": "@user2407038 Thanks for the edit.  I guess I was mixing my functional languages a bit."}], "tags": [], "owner": {"reputation": 39089, "user_id": 220834, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/a8qUy.jpg?s=128&g=1", "display_name": "Don Roby", "link": "https://stackoverflow.com/users/220834/don-roby"}, "is_accepted": false, "score": 0, "last_activity_date": 1421621727, "last_edit_date": 1421621727, "creation_date": 1421619890, "answer_id": 28015523, "question_id": 28015472, "link": "https://stackoverflow.com/questions/28015472/maybe-type-in-haskell-and-what-is-slash-in-my-statement/28015523#28015523", "title": "maybe type in haskell, and what is slash in my statement?", "body": "<p>You need <code>maybe</code> because <code>find</code> returns a <code>Maybe</code>.  If it finds a value, say 10, it returns <code>Just 10</code> otherwise it returns <code>Nothing</code>.</p>\n\n<p>The <code>\\x -&gt; digitSum x== 40</code> is a lambda expression, and <code>\\x</code> is how you bind the variable.</p>\n"}, {"tags": [], "owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "is_accepted": true, "score": 2, "last_activity_date": 1421623113, "last_edit_date": 1421623113, "creation_date": 1421621740, "answer_id": 28015766, "question_id": 28015472, "link": "https://stackoverflow.com/questions/28015472/maybe-type-in-haskell-and-what-is-slash-in-my-statement/28015766#28015766", "title": "maybe type in haskell, and what is slash in my statement?", "body": "<p>You need <code>Maybe</code> because you aren't sure if you'll find what you're looking for, it's Haskell's way of saying: <em>\"maybe you're getting a result, maybe not\"</em>.</p>\n\n<p>So say you have this:</p>\n\n<pre><code>find (\\x -&gt; x &gt; 40) [1 .. 10]\n</code></pre>\n\n<p>It looks for the first number that is greater than 40, in a list that only goes to 10. what's it going to find? Nothing.</p>\n\n<p>And that's exactly what it finds:</p>\n\n<pre><code>Prelude Data.List&gt; find (\\x -&gt; x &gt; 40) [1 .. 10]\nNothing\n</code></pre>\n\n<p><code>Nothing</code> is one of the two possible outcomes of a <code>Maybe</code>, the other is <code>Just</code>. </p>\n\n<p>Like if I changed <code>&gt; 40</code> to <code>&gt;= 5</code>, the result would be this:</p>\n\n<pre><code>Prelude Data.List&gt; find (\\x -&gt; x &gt;= 5) [1 .. 10]\nJust 5\n</code></pre>\n\n<p>Then you might say <em>\"well, why doesn't it just return 0 if it doesn't find anything?\"</em>, that's because, what if 0 is one of the possible results of your search, would you want it to both mean \"I found 0\" and \"I found nothing\"? Of course not! That's why <code>Nothing</code> means you found nothing.</p>\n\n<p>As for why you need to write <code>\\x</code>, that's fairly simple too.</p>\n\n<p>The example code you showed can also be written as such:</p>\n\n<pre><code>sumIs40 :: Int -&gt; Bool\nsumIs40 x = digitSum x == 40\n\nfirstTop40 :: Maybe Int\nfirstTop40 = find sumIs40 [1..]\n</code></pre>\n\n<p>But let's say you only use <code>sumIs40</code> once, and that's in that one spot in your code, so you replace <code>sumIs40</code> with a <code>\\</code>, and change the <code>=</code> to a <code>-&gt;</code> and drop it in where the function would normally have been called.</p>\n\n<p>This is called an <code>anonymous</code> function, or <code>lambda</code> function, and a little bit of Googling around will tell you more about them and how useful they are, but you can basically think of them as one-time functions without a name.</p>\n\n<p>Actually, on a more advanced note: If you wanted to, you could leave the <code>\\x -&gt;</code> out completely like this:</p>\n\n<pre><code>Prelude Data.List&gt; find (&gt;= 5) [1 .. 10]\nJust 5\n</code></pre>\n\n<p>You can read that as <em>\"find anything greater-than-or-equal-to 5, in a list from 1 to 10\"</em>, which then yields <code>Just 5</code></p>\n\n<p>The above example is possible because of something called <code>currying</code> and/or <code>partial application</code> which you can also read more about on the internet.</p>\n"}], "owner": {"reputation": 6557, "user_id": 2495795, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/13606de0b736d7191e2cf2bfea1d4fda?s=128&d=identicon&r=PG", "display_name": "BufBills", "link": "https://stackoverflow.com/users/2495795/bufbills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "closed_date": 1421675690, "accepted_answer_id": 28015766, "answer_count": 2, "score": -2, "last_activity_date": 1421623113, "creation_date": 1421619560, "last_edit_date": 1421622159, "question_id": 28015472, "link": "https://stackoverflow.com/questions/28015472/maybe-type-in-haskell-and-what-is-slash-in-my-statement", "closed_reason": "Not suitable for this site", "title": "maybe type in haskell, and what is slash in my statement?", "body": "<p>I have an example such as:</p>\n\n<pre><code>firstTop40 :: Maybe Int\nfirstTop40 = find (\\x -&gt; digitSum x == 40) [1..]\n</code></pre>\n\n<p>My question is why do I need \"maybe\" here in function prototype?</p>\n\n<p>Second question is: Why would I need <code>\\x</code> here?</p>\n"}, {"tags": ["list", "haskell", "filter"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1421618350, "creation_date": 1421618350, "answer_id": 28015275, "question_id": 28015230, "link": "https://stackoverflow.com/questions/28015230/haskell-writing-a-filter-for-selfdefined-list/28015275#28015275", "title": "Haskell writing a Filter for selfdefined List", "body": "<p><code>e : (filterList f l)</code> is not a <code>List a</code> but a <code>[a]</code>, use <code>Cons e (filterList f l)</code> instead.</p>\n\n<p>(By the way, always post the error for this kind of questions. It may say nothing to you, but it often greatly helps us in answering.)</p>\n"}, {"comments": [{"owner": {"reputation": 365, "user_id": 4435026, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/9mjcZ.jpg?s=128&g=1", "display_name": "SuperTasche", "link": "https://stackoverflow.com/users/4435026/supertasche"}, "edited": false, "score": 0, "creation_date": 1421618864, "post_id": 28015285, "comment_id": 44417955, "body": "Your answer was fast and very well structured. Thank you for that. ;)"}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 4, "last_activity_date": 1421618395, "creation_date": 1421618395, "answer_id": 28015285, "question_id": 28015230, "link": "https://stackoverflow.com/questions/28015230/haskell-writing-a-filter-for-selfdefined-list/28015285#28015285", "title": "Haskell writing a Filter for selfdefined List", "body": "<p>Your recursive call for the first case is wrong: You want to do <code>Cons e (filterList f l)</code> but you actually use <code>(:)</code> and not <code>Cons</code>. Reason for this being that <code>e : (filterList f l)</code> has type <code>[a]</code> but you actually want <code>List a</code>.</p>\n\n<p>To solve this, just change</p>\n\n<pre><code>e : (filterList f l)\n</code></pre>\n\n<p>to</p>\n\n<pre><code>Cons e (filterList f l)\n</code></pre>\n\n<p>since you want it to return your the \"non-standard\" List type.</p>\n"}], "owner": {"reputation": 365, "user_id": 4435026, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/9mjcZ.jpg?s=128&g=1", "display_name": "SuperTasche", "link": "https://stackoverflow.com/users/4435026/supertasche"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 28015285, "answer_count": 2, "score": 0, "last_activity_date": 1421618395, "creation_date": 1421618045, "question_id": 28015230, "link": "https://stackoverflow.com/questions/28015230/haskell-writing-a-filter-for-selfdefined-list", "title": "Haskell writing a Filter for selfdefined List", "body": "<p>Heyho.</p>\n\n<p>I am learning Haskell at University right now. There is a task I just can't wrap my head around. I don't understand why this won't compile. Hope someone can help me.\nThey gave us a self defined List and now we are supposed to create Filter that works with this list just like the Filter from the bib.\nHere's the code:</p>\n\n<pre><code>data List a = Nil | Cons a (List a) deriving Show\n\nlist :: List Int\nlist = Cons (-3) (Cons 14 (Cons (-6) (Cons 7 (Cons 1 Nil))))\n\nfilterList :: (a -&gt; Bool) -&gt; List a -&gt; List a\nfilterList f Nil = Nil\nfilterList f (Cons e l) | f e = e : (filterList f l)\n                        | otherwise = (filterList f l)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421609581, "post_id": 28013861, "comment_id": 44414995, "body": "What isn&#39;t working about it?  Is there a compiler error?  If so, post that error message."}, {"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421609687, "post_id": 28013861, "comment_id": 44415034, "body": "@bheklilr thank you!"}, {"owner": {"reputation": 6881, "user_id": 477047, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Qh2bO.gif?s=128&g=1", "display_name": "David Unric", "link": "https://stackoverflow.com/users/477047/david-unric"}, "edited": false, "score": 2, "creation_date": 1421609854, "post_id": 28013861, "comment_id": 44415098, "body": "Did you missed add Maybe type in <code>else (verEmails n xs)</code> ?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421609971, "post_id": 28013861, "comment_id": 44415141, "body": "Why exactly are you converting this function to use <code>Maybe</code>?  It looks to me like you&#39;re more or less writing a customized <code>filter</code>, and lists return 0 or more values, while <code>Maybe</code> is for when you need to return 0 or 1 values."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 6881, "user_id": 477047, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Qh2bO.gif?s=128&g=1", "display_name": "David Unric", "link": "https://stackoverflow.com/users/477047/david-unric"}, "edited": false, "score": 0, "creation_date": 1421610004, "post_id": 28013861, "comment_id": 44415150, "body": "@DavidUnric No, the error is <code>e : (verEmails n xs)</code> since <code>e :: String</code> and <code>verEmails n xs :: Maybe [String]</code>."}, {"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "reply_to_user": {"reputation": 6881, "user_id": 477047, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Qh2bO.gif?s=128&g=1", "display_name": "David Unric", "link": "https://stackoverflow.com/users/477047/david-unric"}, "edited": false, "score": 0, "creation_date": 1421610054, "post_id": 28013861, "comment_id": 44415173, "body": "@DavidUnric you are right, but if i add <code>Just</code> after the else, it will double the error, exact same error doubles."}, {"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421610098, "post_id": 28013861, "comment_id": 44415189, "body": "@bheklilr , i know, the function already does what i need, but the exercise, from college, asks to use Maybe :("}], "answers": [{"comments": [{"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "edited": false, "score": 0, "creation_date": 1421626345, "post_id": 28014089, "comment_id": 44419921, "body": "Thank you for the final tip, i was not doing the exercise with much caution. You are right, i should always pay attention to all possible cases. Thank you very much for your help bheklilr!"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 4, "last_activity_date": 1421610659, "creation_date": 1421610659, "answer_id": 28014089, "question_id": 28013861, "link": "https://stackoverflow.com/questions/28013861/using-maybe-string-at-haskell/28014089#28014089", "title": "Using Maybe [String] at Haskell", "body": "<p>The problem comes from trying to do <code>e : verEmails n xs</code>, since <code>verEmails n xs</code> does not return a list, but a list enclosed in <code>Maybe</code>.  The easiest way to handle this is to use the <code>Data.Maybe.fromMaybe</code> function:</p>\n\n<pre><code>fromMaybe :: a -&gt; Maybe a -&gt; a\nfromMaybe onNothing Nothing = onNothing\nfromMaybe onNothing (Just a) = a\n</code></pre>\n\n<p>Here I'm presuming you would want to return <code>Just aList</code> where <code>aList</code> contains all the emails filtered from the <code>Agenda</code> passed in.  This means that the only way <code>verEmails</code> will return <code>Nothing</code> is when the agenda passed in is empty.  So we have</p>\n\n<pre><code>verEmails n [] = Nothing\nverEmails n ((nome, ((Email e):ls)):xs)\n    = if n == nome\n        then Just $ e : (fromMaybe [] $ verEmails n xs)\n        else verEmails n xs\n</code></pre>\n\n<p>This just simply converts <code>verEmails n xs</code> from <code>Maybe [String]</code> to <code>[String]</code>, defaulting to the empty list, prepends <code>e</code>, then wraps it back up in a <code>Just</code>.</p>\n\n<p>As a side note, your function does not cover all possible cases, what happens if I were to run <code>verEmails n ((nome, []):xs)</code>?  Or even <code>verEmails n ((nome, [Casa 1]):xs)</code>?</p>\n"}], "owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2070, "favorite_count": 1, "accepted_answer_id": 28014089, "answer_count": 1, "score": 2, "last_activity_date": 1421610659, "creation_date": 1421609323, "last_edit_date": 1421609852, "question_id": 28013861, "link": "https://stackoverflow.com/questions/28013861/using-maybe-string-at-haskell", "title": "Using Maybe [String] at Haskell", "body": "<p>i want to return a string using Maybe [String], but i can't manage to do it using Maybe.</p>\n\n<p>Should i define an instance?</p>\n\n<pre><code>data Contacto = Casa Integer\n              | Trab Integer\n              | Tlm Integer\n              | Email String\n              deriving (Show)\ntype Nome = String\ntype Agenda = [(Nome, [Contacto])]\n\naddEmail :: Nome -&gt; String -&gt; Agenda -&gt; Agenda\naddEmail n email agenda = (n, [Email email]):(agenda)\n\n\nverEmails :: Nome -&gt; Agenda -&gt; [String]\nverEmails n [] = []\nverEmails n ((nome, ((Email e):ls)):xs) = if n == nome then (e:(verEmails n xs))\n                                                       else (verEmails n xs)\n</code></pre>\n\n<p>Here is the same function verEmails, where i use Maybe:</p>\n\n<pre><code>verEmails :: Nome -&gt; Agenda -&gt; Maybe [String]\nverEmails n [] = Nothing\nverEmails n ((nome, ((Email e):ls)):xs) = if n == nome then Just (e:(verEmails n xs))\n                                                       else (verEmails n xs)\n</code></pre>\n\n<p>The error that GHCi gives me:</p>\n\n<blockquote>\n<pre><code>Couldn't match expected type `[String]'\n                with actual type `Maybe [String]'\n    In the return type of a call of `verEmails'\n    In the second argument of `(:)', namely `(verEmails n xs)'\n    In the first argument of `Just', namely `(e : (verEmails n xs))'\n</code></pre>\n</blockquote>\n"}, {"tags": ["haskell", "lazy-evaluation", "state-monad"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1421607820, "post_id": 28013499, "comment_id": 44414347, "body": "@GabrielGonzalez has done some work on making stricter transformers, such as this <a href=\"https://www.haskell.org/pipermail/libraries/2013-March/019528.html\" rel=\"nofollow noreferrer\">more strict WriterT</a>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 7, "creation_date": 1421608735, "post_id": 28013499, "comment_id": 44414660, "body": "I would be tempted to make this strict only on <code>s</code>. If a strict <code>a</code> is wanted, the caller can simply <code>m &gt;&gt;= \\ !a -&gt; ...</code> to achieve the same effect, I think."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1421616470, "post_id": 28013499, "comment_id": 44417206, "body": "Making it strict in <code>a</code> will violate the monad laws, so you don&#39;t want to do that. When making it strict in <code>s</code>, you will also have to change <code>return</code> to <code>return x = State $ \\ !s -&gt; (x, s)</code> or however it goes to preserve the identity laws."}, {"owner": {"reputation": 134362, "user_id": 83805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68c3dd15d6cd5d99a63113843d7e1c1b?s=128&d=identicon&r=PG", "display_name": "Don Stewart", "link": "https://stackoverflow.com/users/83805/don-stewart"}, "edited": false, "score": 0, "creation_date": 1421689396, "post_id": 28013499, "comment_id": 44445841, "body": "Try it and see. You&#39;ll likely break the monad laws (and introduce e.g. immediate failures)."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1424405064, "post_id": 28013499, "comment_id": 45545096, "body": "@dfeuer I think you could turn your comment into an answer, to close this out as an unanswered question?"}], "answers": [{"comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 3, "creation_date": 1424424481, "post_id": 28622132, "comment_id": 45552000, "body": "In the presence of <code>seq</code> all monads fail the laws (also lazy <code>Writer</code> and <code>State</code>),  see <a href=\"http://stackoverflow.com/a/12620418/1333025\">this answer</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1424443385, "post_id": 28622132, "comment_id": 45563152, "body": "@PetrPudl&#225;k, yes, that is a sad thing. We should still do what we can when reasonable, right?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 2, "creation_date": 1424443623, "post_id": 28622132, "comment_id": 45563324, "body": "@PetrPudl&#225;k, in particular, I think it&#39;s best to make sure your <code>Monad</code> instances obey the laws <i>as long as no one using them does stupid <code>seq</code> tricks</i>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 2, "creation_date": 1424444038, "post_id": 28622132, "comment_id": 45563581, "body": "Stupid <code>seq</code> tricks will be extra nasty in base version 4.8, because <code>Identity</code> will be taking full advantage of people not doing that, with definitions like <code>fmap=coerce</code>, <code>foldMap=coerce</code>, <code>foldl=coerce</code>, and <code>foldl&#39;=coerce</code>."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1424444331, "post_id": 28622132, "comment_id": 45563788, "body": "I wish that Haskell incorporated proper inductive and coinductive data-types. Then there would be no problems with <code>seq</code>/<code>undefined</code> for such data types."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1424530435, "post_id": 28622132, "comment_id": 45591856, "body": "@PetrPudl&#225;k, do you have any links to explain what you mean by any of that?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 2, "creation_date": 1424540860, "post_id": 28622132, "comment_id": 45595607, "body": "See <a href=\"https://en.wikipedia.org/wiki/Coinduction\" rel=\"nofollow noreferrer\">coinduction</a>, <a href=\"https://en.wikipedia.org/wiki/Corecursion\" rel=\"nofollow noreferrer\">corecursion</a> and also <a href=\"https://en.wikipedia.org/wiki/Total_functional_programming\" rel=\"nofollow noreferrer\">Total functional programming</a>. It&#39;s also worthwhile to read linked <a href=\"http://www.jucs.org/jucs_10_7/total_functional_programming\" rel=\"nofollow noreferrer\">the paper</a>. In particular, inductive data types are always finite and have no bottoms, coinductive data types (codata) can me infinite, but again no bottoms. And what&#39;s really nice that this can be enforced syntactically. So <code>seq</code> can only alter performance, not the result."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1424799016, "post_id": 28622132, "comment_id": 45694686, "body": "@PetrPudl&#225;k, I read some of that paper; it looks like its author is living in some other universe in which programmers want all their programs verified total (so they are willing to give up Turing completeness) and will even settle for a much weaker version of termination checking than is available in Coq or Agda (so many useful programs are ridiculously hard to write, or impossible)."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1424807086, "post_id": 28622132, "comment_id": 45699260, "body": "I believe the paper has many worthy ideas. Sometimes it&#39;s too difficult to make a whole program total, but it&#39;s good to aim at least for its parts. It&#39;s easier (and also enforced) in Agda or Coq, but there other things get harder. And giving up Turing completeness isn&#39;t that bad in many cases, in particular in the presence of codata, when it&#39;s possible to have infinite data structures and potentially infinitely running programs."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1424807622, "post_id": 28622132, "comment_id": 45699576, "body": "@PetrPudl&#225;k, I hear you, but twisting one&#39;s brain (and program) into knots to <i>attempt</i> to cram it into something like Turner&#39;s system does not sound very appealing to me. I agree that making programs as obviously total as reasonable is a good objective, as is getting help from the compiler to prove totality when reasonable."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1424809034, "post_id": 28622132, "comment_id": 45700374, "body": "I agree. My approach is somewhat similar to <code>IO</code>/pure code. I try to keep non-total code separated from total, even if it&#39;s just the matter of separating it into functions. This approach makes me more aware of what is potentially problematic (non-total) and focus a bit more on reasoning about its correctness."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 6, "last_activity_date": 1424541313, "last_edit_date": 1424541313, "creation_date": 1424409755, "answer_id": 28622132, "question_id": 28013499, "link": "https://stackoverflow.com/questions/28013499/stricter-strict-state-monad/28622132#28622132", "title": "Stricter Strict State Monad", "body": "<p>According to the monad identity laws,</p>\n\n<pre><code>return a &gt;&gt;= const b = const b a = b\n</code></pre>\n\n<p>Thus in particular,</p>\n\n<pre><code>return undefined &gt;&gt;= const b = b\n</code></pre>\n\n<p>If the <code>&gt;&gt;=</code> operation were strict in the result value, that would break this law, so you shouldn't do that.</p>\n\n<p>Suppose you instead do this:</p>\n\n<pre><code>m &gt;&gt;= k = State $ \\s -&gt;\n  case runState m s of\n    (a, !s') -&gt; runState (k a) s'\n</code></pre>\n\n<p>Now we face another identity law:</p>\n\n<pre><code>m &gt;&gt;= return = m\n</code></pre>\n\n<p>For example,</p>\n\n<pre><code>return a &gt;&gt;= return = return a\n</code></pre>\n\n<p>So if <code>return a &gt;&gt;= return</code> is strict in the state, then we must also have <code>return a</code> strict in the state! So we need to redefine <code>return</code> as well:</p>\n\n<pre><code>return a = State $ \\ !s -&gt; (a, s)\n</code></pre>\n\n<p>Note that you don't really <em>need</em> to do any of this; if you want, you can use the usual strict state monad, and write things like</p>\n\n<pre><code>!_ &lt;- get\n</code></pre>\n\n<p>in the spots where you want to force the state. You could even write an action to do this:</p>\n\n<pre><code>forceState :: Monad m =&gt; StateT s m ()\nforceState = get &gt;&gt;= \\ !_ -&gt; return ()\n</code></pre>\n\n<h3>Edit</h3>\n\n<p>Even this definition feels a little bit strange to me; I would expect the lambda to force the state, rather than the <code>case</code>. I'm not sure if not doing that leads to some kind of breakage, but it wouldn't surprise me if it did.</p>\n"}], "owner": {"reputation": 3333, "user_id": 3859566, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a7c4c1c9ad9bd41f49004d32884bc680?s=128&d=identicon&r=PG&f=1", "display_name": "yong", "link": "https://stackoverflow.com/users/3859566/yong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 639, "favorite_count": 0, "accepted_answer_id": 28622132, "answer_count": 1, "score": 12, "last_activity_date": 1424541313, "creation_date": 1421607305, "last_edit_date": 1421620184, "question_id": 28013499, "link": "https://stackoverflow.com/questions/28013499/stricter-strict-state-monad", "title": "Stricter Strict State Monad", "body": "<p>The strict state monad is defined using:</p>\n\n<pre><code>m &gt;&gt;= k = State $ \\s -&gt;\n  case runState m s of\n    (a, s') -&gt; runState (k a) s'\n</code></pre>\n\n<p>But this can still leak memory, because <code>a</code> and <code>s'</code> are left unevaluated. For example, we might have a function <code>f</code> that takes a large object as input and quickly returns <code>(a, s')</code>, but as long as <code>a</code> is left unevaluated the input to <code>f</code> cannot be GC'ed. </p>\n\n<p>One potential solution is to have <code>f</code> return <code>seq a (a, s')</code>, but this isn't always possible if we are using something like <code>MonadRandom</code>, and the state is encapsulated away from <code>f</code>. Is there a version that is defined like this:</p>\n\n<pre><code>m &gt;&gt;= k = State $ \\s -&gt;\n  case runState m s of\n    (!a, !s') -&gt; runState (k a) s'\n</code></pre>\n\n<p>Does this exist in a library anywhere already?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "edited": false, "score": 0, "creation_date": 1421595845, "post_id": 28011533, "comment_id": 44410400, "body": "What is the problem, <code>6, 6</code> is the biggest in the list."}, {"owner": {"reputation": 37, "user_id": 4358044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6750d27fba55e9bd2348df47510c8a13?s=128&d=identicon&r=PG&f=1", "display_name": "spacecows", "link": "https://stackoverflow.com/users/4358044/spacecows"}, "reply_to_user": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "edited": false, "score": 0, "creation_date": 1421595932, "post_id": 28011533, "comment_id": 44410433, "body": "It was just an example. The function i wrote gives me (1,10)."}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1421680415, "post_id": 28011533, "comment_id": 44440643, "body": "<code>auxSum = uncurry (+)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "is_accepted": true, "score": 6, "last_activity_date": 1421601738, "last_edit_date": 1421601738, "creation_date": 1421596263, "answer_id": 28011629, "question_id": 28011533, "link": "https://stackoverflow.com/questions/28011533/sort-by-comparing-the-sum-of-a-double/28011629#28011629", "title": "Sort by comparing the sum of a double", "body": "<p><a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Data-List.html#v:sortBy\" rel=\"nofollow\"><code>sortBy</code></a>, by default, does the stable sort <em>in ascending order</em>. So, <code>head</code> will get the smallest pair. Instead, you can tweak the <code>auxSum</code> to return negative sum values to sort the actual data in descending order and get the head, like this</p>\n\n<pre><code>auxSum :: (Int,Int) -&gt; Int\nauxSum (a,b) = -(a + b)\n\n&gt; maxSumPair [(1,10),(6,6),(10,1)] \n(6,6)\n</code></pre>\n\n<p>If you don't want to change the <code>auxSum</code>, then use <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:last\" rel=\"nofollow\"><code>last</code></a> function instead of <code>head</code>, like this</p>\n\n<pre><code>auxSum :: (Int,Int) -&gt; Int\nauxSum (a,b) = a + b\n\nmaxSumPair :: [(Int,Int)] -&gt; (Int,Int)\nmaxSumPair l = last $ sortBy (comparing auxSum) l\n\n&gt; maxSumPair [(1,10),(6,6),(10,1)] \n(6,6)\n</code></pre>\n\n<p><strong>Note:</strong> Alternatively, you can use <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Data-List.html#v:maximumBy\" rel=\"nofollow\"><code>maximumBy</code></a> function, which will be highly efficient for this case (because <code>sortBy</code> would run in O(n * log n) time but <code>maximumBy</code> would finish it in O(n)), like this</p>\n\n<pre><code>auxSum :: (Int,Int) -&gt; Int\nauxSum (a,b) = a + b\n\n&gt; maximumBy (comparing auxSum) [(1,10),(6,6),(10,1)] \n(6,6)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1421602301, "creation_date": 1421602301, "answer_id": 28012677, "question_id": 28011533, "link": "https://stackoverflow.com/questions/28011533/sort-by-comparing-the-sum-of-a-double/28012677#28012677", "title": "Sort by comparing the sum of a double", "body": "<p>Just to add to the discussion, note that you can perform reverse sorting by flipping the comparison function:</p>\n\n<pre><code>reverseSort xs = sortBy (flip compare) xs\nreverseSortBy cmp xs = sortBy (flip cmp) xs\n</code></pre>\n\n<p>so you could have written:</p>\n\n<pre><code>maxSumPair xs = head $ sortBy (flip $ comparing auxSum) xs\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 4358044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6750d27fba55e9bd2348df47510c8a13?s=128&d=identicon&r=PG&f=1", "display_name": "spacecows", "link": "https://stackoverflow.com/users/4358044/spacecows"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 28011629, "answer_count": 2, "score": 1, "last_activity_date": 1421602301, "creation_date": 1421595734, "last_edit_date": 1421596607, "question_id": 28011533, "link": "https://stackoverflow.com/questions/28011533/sort-by-comparing-the-sum-of-a-double", "title": "Sort by comparing the sum of a double", "body": "<pre><code>maxSumPair :: [(Int,Int)] -&gt; (Int,Int)\nmaxSumPair l = head $ sortBy (comparing auxSum) l\n\nauxSum :: (Int,Int) -&gt; Int\nauxSum (a,b) = a+b\n</code></pre>\n\n<p>With the function <code>maxSumPair</code> and I want to calculate which of the doubles has the biggest sum.</p>\n\n<p>For example, this is how it should work:</p>\n\n<pre><code>&gt; maxSumPairs [(1,10),(6,6),(10,1)] \n(6,6)\n</code></pre>\n\n<p>But my function gives me (1,10) instead of (6,6). What's my mistake?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421604923, "post_id": 28011646, "comment_id": 44413353, "body": "Actually, <code>list</code> by itself is already diverging since <code>ordList</code> is strict on the spine."}], "tags": [], "owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "is_accepted": false, "score": 4, "last_activity_date": 1421596339, "creation_date": 1421596339, "answer_id": 28011646, "question_id": 28011292, "link": "https://stackoverflow.com/questions/28011292/reading-numbers-from-input-haskell/28011646#28011646", "title": "Reading numbers from input Haskell", "body": "<pre><code>let list = ordList ((read num :: Int):list)\n</code></pre>\n\n<p>This is basically a recursive definition of a list of the form <code>[x, x, ...]</code> (like if you wrote an equation saying <code>x = 1 + x</code>). That is perfectly fine by itself, since Haskell is lazy; however, if you try to <code>print list</code> (aka \"solve the equation\"), it will fail, since it will try to print infinitely many numbers. </p>\n\n<p>You probably have a misconception about the workings of the <code>(:)</code> operator. Haskell functions will never perform an assignment operation and concatenate <code>num</code> onto <code>list</code> by changing it, like in imperative languages. There are only <em>pure</em> functions.</p>\n\n<p>If you want to accumulate all numbers, you should try to come up with a recursive definition of <code>readIntegers</code>, keeping its state (the <code>list</code>) in an additional parameter (there are also more sophisticated ways, hiding the state passing, but more complicated to use for a beginner).  </p>\n"}, {"tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": false, "score": 7, "last_activity_date": 1421598331, "last_edit_date": 1421598331, "creation_date": 1421596483, "answer_id": 28011672, "question_id": 28011292, "link": "https://stackoverflow.com/questions/28011292/reading-numbers-from-input-haskell/28011672#28011672", "title": "Reading numbers from input Haskell", "body": "<p>As @phg points out, you are essentially constructing an infinite list, and actually evaluating it causes the loop error. A simple implementation to resolve this issue is to define a helper function which takes an additional parameter - a list to store all the inputs read in from the screen, like so:</p>\n\n<pre><code>readInteger :: IO ()\nreadInteger = readInteger' []\n    where\n        readInteger' x = do\n        putStrLn \"insert a number: \"\n        num&lt;-getLine        \n        if ((read num :: Int) == 0)  \n        then print $ ordList x \n        else readInteger' $ (read num :: Int):x\n        where ordList ::[Int]-&gt;[Int]\n              ordList [] = []\n              ordList xs = sort xs\n</code></pre>\n\n<p>Please note that the above is essentially just an implementation of @phg's answer, but with some changes to your original logic. Firstly, since 0 is a sentinel value, we shouldn't be appending that to our list. Second, we do not need to sort the list every single time we are adding a value to it. Sorting once at the time of printing/passing to another function is sufficient.</p>\n\n<p><a href=\"http://rextester.com/QWP1689\">Demo</a></p>\n\n<p>If you want to read an unspecified number of integers without prompting for user input and cut it off the moment you encounter 0, you would probably do well to use <code>getContents</code>, which will read everything from the standard input as a single string, lazily.</p>\n\n<p>Then, it is a simple matter of parsing it to a list of numbers and doing what you want with it, like so:</p>\n\n<pre><code>readIntegers :: ()\nreadIntegers = do\n   a &lt;- getContents\n   let b = ordList $ takeWhile (/= 0) $ map (\\x -&gt; read x :: Int) $ words a          \n   mapM (putStrLn . show) b\n where ordList ::[Int]-&gt;[Int]\n       ordList [] = []\n       ordList xs = sort xs \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "edited": false, "score": 0, "creation_date": 1421608598, "post_id": 28012326, "comment_id": 44414621, "body": "That&#39;s a very nice solution."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1421600302, "creation_date": 1421600302, "answer_id": 28012326, "question_id": 28011292, "link": "https://stackoverflow.com/questions/28011292/reading-numbers-from-input-haskell/28012326#28012326", "title": "Reading numbers from input Haskell", "body": "<p>For a more sophisticated solution, note that this is an <em>unfold</em> and you can use <code>unfoldM</code> from Control.Monad.Loops to implement it:</p>\n\n<pre><code>import Control.Monad.Loops (unfoldM)\n\nreadInts :: IO [Int]\nreadInts = unfoldM $ fmap (check . read) getLine\n  where check x = if x == 0 then Nothing else Just x\n</code></pre>\n\n<p>This has the nice property that it returns the list in the order in which it was read.</p>\n"}], "owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2022, "favorite_count": 0, "accepted_answer_id": 28012326, "answer_count": 3, "score": 2, "last_activity_date": 1421600302, "creation_date": 1421594335, "question_id": 28011292, "link": "https://stackoverflow.com/questions/28011292/reading-numbers-from-input-haskell", "title": "Reading numbers from input Haskell", "body": "<p>I want to have a function that reads arbitrary int's until the number '0' is inserted, and then presents the numbers inserted in an ordered list.</p>\n\n<p>For that i wrote this function:</p>\n\n<pre><code>import Data.List\n\nreadIntegers :: IO()\nreadIntegers = do\n    putStrLn \"insert a number: \"\n    num&lt;-getLine\n    let list = ordList ((read num :: Int):list)\n    if (read num == 0)  \n    then print list \n    else readIntegers\n  where ordList ::[Int]-&gt;[Int]\n        ordList [] = []\n        ordList xs = sort xs\n</code></pre>\n\n<p>This compiles just fine, but when i insert the number '0', it gives me this error:</p>\n\n<pre><code>*** Exception: &lt;&lt;loop&gt;&gt;\n</code></pre>\n\n<p>What am i doing wrong ?</p>\n"}, {"tags": ["haskell", "memory-management", "garbage-collection", "profiling"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 6, "creation_date": 1421599174, "post_id": 28011067, "comment_id": 44411486, "body": "This generally happens when lots of things survive the nursery generation unnecessarily, making them way more expensive to collect. The first thing I&#39;d check for is a space leak preventing short-lived values from being collected immediately."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1421622071, "post_id": 28011067, "comment_id": 44418815, "body": "Related (an answer there may or may not help you, depending on what&#39;s going on in your case): <a href=\"http://stackoverflow.com/questions/27630833/is-it-possible-to-skip-the-nursery\" title=\"is it possible to skip the nursery\">stackoverflow.com/questions/27630833/&hellip;</a>"}, {"owner": {"reputation": 134362, "user_id": 83805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68c3dd15d6cd5d99a63113843d7e1c1b?s=128&d=identicon&r=PG", "display_name": "Don Stewart", "link": "https://stackoverflow.com/users/83805/don-stewart"}, "edited": false, "score": 1, "creation_date": 1421689096, "post_id": 28011067, "comment_id": 44445708, "body": "Start by getting a heap profile. e.g. <a href=\"http://stackoverflow.com/a/3276557/83805\">stackoverflow.com/a/3276557/83805</a>"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 4, "creation_date": 1438273823, "post_id": 28011067, "comment_id": 51394219, "body": "Is this still relevant? Do you have a program that reproduces this behaviour?"}, {"owner": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "edited": false, "score": 1, "creation_date": 1444637771, "post_id": 28011067, "comment_id": 53969663, "body": "Can you publish a program that reproduces this issue?"}], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 1, "last_activity_date": 1454276521, "last_edit_date": 1454276521, "creation_date": 1449682880, "answer_id": 34185432, "question_id": 28011067, "link": "https://stackoverflow.com/questions/28011067/optimize-haskell-gc-usage/34185432#34185432", "title": "Optimize Haskell GC usage", "body": "<p>As Carl suggested, you should check code for space leaks. I'll assume that your program really requires a lot of memory for good reason.</p>\n\n<p>The program spent 2820.18s doing major GC. You can lower it by reducing either memory usage (not a case by the assumption) or number of major collections. You have a lot of free RAM, so you can try <code>-Ffactor</code> <a href=\"http://downloads.haskell.org/~ghc/7.10.2/docs/html/users_guide/runtime-control.html#rts-options-gc\" rel=\"nofollow\">option</a>:</p>\n\n<pre><code> -Ffactor\n\n    [Default: 2] This option controls the amount of memory reserved for\n the older generations (and in the case of a two space collector the size\n of the allocation area) as a factor of the amount of live data. For\n example, if there was 2M of live data in the oldest generation when we\n last collected it, then by default we'll wait until it grows to 4M before\n collecting it again.\n</code></pre>\n\n<p>In your case there is ~3G of live data. By default major GC will be triggered when heap grows to 6G. With <code>-F3</code> it will be triggered when heap grows to 9G saving you ~1000s CPU time.</p>\n\n<p>If most of the live data is static (e.g. never changes or changes slowly,) then you will be interested in <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9052\" rel=\"nofollow\">stable heap</a>. The idea is to exclude long living data from major GC. It can be achieved e.g. using <a href=\"http://ezyang.com/compact.html\" rel=\"nofollow\">compact normal forms</a>, though it is <a href=\"https://phabricator.haskell.org/D1264\" rel=\"nofollow\">not merged</a> into GHC yet.</p>\n"}], "owner": {"reputation": 3333, "user_id": 3859566, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a7c4c1c9ad9bd41f49004d32884bc680?s=128&d=identicon&r=PG&f=1", "display_name": "yong", "link": "https://stackoverflow.com/users/3859566/yong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 508, "favorite_count": 6, "answer_count": 1, "score": 40, "last_activity_date": 1454276521, "creation_date": 1421593000, "last_edit_date": 1421689224, "question_id": 28011067, "link": "https://stackoverflow.com/questions/28011067/optimize-haskell-gc-usage", "title": "Optimize Haskell GC usage", "body": "<p>I am running a long-lived Haskell program that holds on to a lot of memory. Running with <code>+RTS -N5 -s -A25M</code> (size of my L3 cache) I see:</p>\n\n<pre><code>715,584,711,208 bytes allocated in the heap\n390,936,909,408 bytes copied during GC\n  4,731,021,848 bytes maximum residency (745 sample(s))\n     76,081,048 bytes maximum slop\n           7146 MB total memory in use (0 MB lost due to fragmentation)\n\n                                  Tot time (elapsed)  Avg pause  Max pause\nGen  0     24103 colls, 24103 par   240.99s   104.44s     0.0043s    0.0603s\nGen  1       745 colls,   744 par   2820.18s   619.27s     0.8312s    1.3200s\n\nParallel GC work balance: 50.36% (serial 0%, perfect 100%)\n\nTASKS: 18 (1 bound, 17 peak workers (17 total), using -N5)\n\nSPARKS: 1295 (1274 converted, 0 overflowed, 0 dud, 0 GC'd, 21 fizzled)\n\nINIT    time    0.00s  (  0.00s elapsed)\nMUT     time  475.11s  (454.19s elapsed)\nGC      time  3061.18s  (723.71s elapsed)\nEXIT    time    0.27s  (  0.50s elapsed)\nTotal   time  3536.57s  (1178.41s elapsed)\n\nAlloc rate    1,506,148,218 bytes per MUT second\n\nProductivity  13.4% of total user, 40.3% of total elapsed\n</code></pre>\n\n<p>The GC time is 87% of the total run time! I am running this on a system with a massive amount of RAM, but when I set a high <code>-H</code> value the performance was worse.</p>\n\n<p>It seems that both <code>-H</code> and <code>-A</code> controls the size of <code>gen 0</code>, but what I would really like to do is increase the size of <code>gen 1</code>. What is the best way to do this?</p>\n"}, {"tags": ["haskell", "functor", "generic-programming", "deriving", "bifunctor"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1421588435, "post_id": 28010045, "comment_id": 44408265, "body": "Ask this question somewhere else. Questions about software recommendations, including library recommendations, are off-topic for SO."}, {"owner": {"reputation": 5054, "user_id": 548515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55624bebc921a03713d00a91c9e58a36?s=128&d=identicon&r=PG", "display_name": "Hans Lub", "link": "https://stackoverflow.com/users/548515/hans-lub"}, "edited": false, "score": 0, "creation_date": 1421589970, "post_id": 28010045, "comment_id": 44408697, "body": "Your question doesn&#39;t typecheck in my brain. Haskell can automatically derive class instances (like <code>Eq</code>, or <code>Functor</code>) but never member functions. Those derivations are provided by the compiler (after using a suitable pragma like  <code>DeriveFunctor</code>), never by a package. Or am I missing something?"}, {"owner": {"reputation": 4972, "user_id": 1964342, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce48e3381ac19802f017e34b80e0536c?s=128&d=identicon&r=PG", "display_name": "tohava", "link": "https://stackoverflow.com/users/1964342/tohava"}, "reply_to_user": {"reputation": 5054, "user_id": 548515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55624bebc921a03713d00a91c9e58a36?s=128&d=identicon&r=PG", "display_name": "Hans Lub", "link": "https://stackoverflow.com/users/548515/hans-lub"}, "edited": false, "score": 0, "creation_date": 1421590036, "post_id": 28010045, "comment_id": 44408711, "body": "@HansLub Check this out: <a href=\"https://hackage.haskell.org/package/genifunctors-0.2.2.0/docs/Data-Generics-Genifunctors.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/genifunctors-0.2.2.0/docs/&hellip;</a> . I want something like this but without Template Haskell if possible."}, {"owner": {"reputation": 5054, "user_id": 548515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55624bebc921a03713d00a91c9e58a36?s=128&d=identicon&r=PG", "display_name": "Hans Lub", "link": "https://stackoverflow.com/users/548515/hans-lub"}, "edited": false, "score": 0, "creation_date": 1421590924, "post_id": 28010045, "comment_id": 44408968, "body": "Ah, I see. Template Haskell can &#39;generate&#39;  class instance declarartions; your use of the word &quot;derive&quot; made my head explode (but <a href=\"https://github.com/ekmett/bifunctors/issues/17\" rel=\"nofollow noreferrer\">you&#39;re not the only one</a>. It is still not clear to me what you mean by &#39;derive&#39; <i>outside</i> the context of TH (as you want to avoid it)"}, {"owner": {"reputation": 4972, "user_id": 1964342, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce48e3381ac19802f017e34b80e0536c?s=128&d=identicon&r=PG", "display_name": "tohava", "link": "https://stackoverflow.com/users/1964342/tohava"}, "reply_to_user": {"reputation": 5054, "user_id": 548515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55624bebc921a03713d00a91c9e58a36?s=128&d=identicon&r=PG", "display_name": "Hans Lub", "link": "https://stackoverflow.com/users/548515/hans-lub"}, "edited": false, "score": 0, "creation_date": 1421590990, "post_id": 28010045, "comment_id": 44408986, "body": "@HansLub - I mean that maybe it can be implemented generically by using properties of other generic programming oriented type classes (Data.Data and Generic)"}, {"owner": {"reputation": 5054, "user_id": 548515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55624bebc921a03713d00a91c9e58a36?s=128&d=identicon&r=PG", "display_name": "Hans Lub", "link": "https://stackoverflow.com/users/548515/hans-lub"}, "edited": false, "score": 2, "creation_date": 1421591462, "post_id": 28010045, "comment_id": 44409152, "body": "<a href=\"https://hackage.haskell.org/package/generic-deriving\" rel=\"nofollow noreferrer\">The generic-deriving package</a> mentions a paper &quot;A generic deriving mechanism for Haskell&quot;. Seems I will have to read it to prevent future brain explosions :-)"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1421608438, "post_id": 28010045, "comment_id": 44414561, "body": "This question can be edited to be on-topic for StackOverflow. Instead of asking for library recommendations, you can ask how to do something specific like, &quot;I&#39;m trying to derive <code>fmapFirst</code> and <code>fmapSecond</code> for bifunctors ...&quot;. It&#39;s helpful if you include what you have done so far or references to what you have found researching the problem. If a solution exists in a library, you might still get an answer referring to that library, but a good answer will also include how that library works. This should be more useful to you and more useful to future readers of StackOverflow."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1421608649, "post_id": 28010045, "comment_id": 44414640, "body": "The closest thing I know of is the derived <code>GFunctor</code> in <a href=\"https://hackage.haskell.org/package/generic-deriving-1.7.0/docs/Generics-Deriving-Functor.html\" rel=\"nofollow noreferrer\"><code>Generics.Deriving.Functor</code></a>, which solves both halves of the problem, leaving only a problem of juggling two type arguments."}], "owner": {"reputation": 4972, "user_id": 1964342, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce48e3381ac19802f017e34b80e0536c?s=128&d=identicon&r=PG", "display_name": "tohava", "link": "https://stackoverflow.com/users/1964342/tohava"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 248, "favorite_count": 0, "closed_date": 1421615727, "answer_count": 0, "score": 3, "last_activity_date": 1421625365, "creation_date": 1421586810, "last_edit_date": 1421625365, "question_id": 28010045, "link": "https://stackoverflow.com/questions/28010045/modern-haskell-implementation-of-generically-derived-bifunctors", "closed_reason": "Not suitable for this site", "title": "Modern haskell implementation of generically derived bifunctors", "body": "<p>I'm looking for a way to derive <code>fmapFirst</code> and <code>fmapSecond</code> for bifunctors automatically. I would prefer a way to do it using the new <code>Generic</code> type class or using <code>Data.Data</code>, and without Template Haskell. </p>\n\n<p>(Note that I already know that <a href=\"https://hackage.haskell.org/package/genifunctors-0.2.2.0/docs/Data-Generics-Genifunctors.html\" rel=\"nofollow\">https://hackage.haskell.org/package/genifunctors-0.2.2.0/docs/Data-Generics-Genifunctors.html</a> supports this with use of Template Haskell, I wish to know if Template Haskell can be avoided here)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 0, "creation_date": 1421557110, "post_id": 28007277, "comment_id": 44402785, "body": "<code>if upperCase c</code> <b>==</b> <code>True</code>. Why isn&#39;t it supposed to be ==? Also, what if c isn&#39;t uppercase? Where&#39;s the else condition?"}, {"owner": {"reputation": 247, "user_id": 4441586, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-wtwj0CDF2fU/AAAAAAAAAAI/AAAAAAAAABI/MKN2fXgHWc4/photo.jpg?sz=128", "display_name": "Jubl", "link": "https://stackoverflow.com/users/4441586/jubl"}, "reply_to_user": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 0, "creation_date": 1421557423, "post_id": 28007277, "comment_id": 44402828, "body": "@shree.pat18 I thought that you use &#39;=&#39; for boolean operations and &#39;==&#39; for arithmetic operations. My function &quot;lowerCase&quot; prints out &quot;False&quot; if function is uppercase."}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 1, "creation_date": 1421557466, "post_id": 28007277, "comment_id": 44402834, "body": "Nope. <code>==</code> is always for equality anywhere AFAIK, as long as the type is an instance of <code>Eq</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1421578388, "post_id": 28007277, "comment_id": 44405656, "body": "Style comment: don&#39; t use <code>== True</code>, it&#39;s redundant. You can simply write <code>if upperCase c then ... else ...</code>. Even in English, &quot;if it is true that c is upper case, then ..&quot; is more distracting than the direct &quot;if c is upper case, then ....&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 247, "user_id": 4441586, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-wtwj0CDF2fU/AAAAAAAAAAI/AAAAAAAAABI/MKN2fXgHWc4/photo.jpg?sz=128", "display_name": "Jubl", "link": "https://stackoverflow.com/users/4441586/jubl"}, "edited": false, "score": 1, "creation_date": 1421557752, "post_id": 28007314, "comment_id": 44402877, "body": "I misspoke. I was supposed to make it for all lowercase, but it&#39;s the same thing. It works. Thank you!"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1421602064, "post_id": 28007314, "comment_id": 44412421, "body": "<code>if x == True then a else b</code> should be written as <code>if x then a else b</code>."}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": true, "score": 4, "last_activity_date": 1421557407, "creation_date": 1421557407, "answer_id": 28007314, "question_id": 28007277, "link": "https://stackoverflow.com/questions/28007277/recursively-printing-out-lowercase-letters/28007314#28007314", "title": "Recursively Printing Out Lowercase Letters", "body": "<p>Quite a few things wrong here:</p>\n\n<ol>\n<li><code>if</code> requires an <code>else</code> as well.</li>\n<li><code>==</code> is for comparison, <code>=</code> for assignment.</li>\n<li><code>++</code> works on 2 lists, what you are looking for is <code>(:)</code> which appends an element to a list.</li>\n</ol>\n\n<p>The correct function should look something like this:</p>\n\n<pre><code>allCaps :: String -&gt; String\nallCaps \"\" = \"\"\nallCaps (c:cs) = if upperCase c == True then c : allCaps cs else allCaps cs\n</code></pre>\n\n<p>BTW, <code>Data.Char</code> has an <code>isUpper</code> function, unless creating that function is part of your exercise.</p>\n\n<p><a href=\"http://rextester.com/UBBX81347\" rel=\"nofollow\">Demo</a></p>\n"}, {"tags": [], "owner": {"reputation": 11780, "user_id": 2827654, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a171742e9c31a541d4d2031af932e94a?s=128&d=identicon&r=PG&f=1", "display_name": "jamshidh", "link": "https://stackoverflow.com/users/2827654/jamshidh"}, "is_accepted": false, "score": 5, "last_activity_date": 1421557631, "creation_date": 1421557631, "answer_id": 28007336, "question_id": 28007277, "link": "https://stackoverflow.com/questions/28007277/recursively-printing-out-lowercase-letters/28007336#28007336", "title": "Recursively Printing Out Lowercase Letters", "body": "<p>@shree.pat18 addressed the problems, but I feel the need to point out that this is a textbook case for using the <code>filter</code> function....  The Haskell idiomatic solution would be </p>\n\n<pre><code>allLow = filter isLower\n</code></pre>\n"}], "owner": {"reputation": 247, "user_id": 4441586, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-wtwj0CDF2fU/AAAAAAAAAAI/AAAAAAAAABI/MKN2fXgHWc4/photo.jpg?sz=128", "display_name": "Jubl", "link": "https://stackoverflow.com/users/4441586/jubl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 409, "favorite_count": 0, "accepted_answer_id": 28007314, "answer_count": 2, "score": 1, "last_activity_date": 1421557631, "creation_date": 1421557004, "last_edit_date": 1421557316, "question_id": 28007277, "link": "https://stackoverflow.com/questions/28007277/recursively-printing-out-lowercase-letters", "title": "Recursively Printing Out Lowercase Letters", "body": "<p>I'm doing an exercise where I need to make a function called, allLow that has the signature of <code>allLow :: String -&gt; String</code> that takes a String and prints out all the capital letters, recursively. So it will run like,</p>\n\n<pre><code>&gt; allLow \"WhERe IS MY PEPPErONI PIZZa?\"\n\"hera\"\n</code></pre>\n\n<p>Here's what I have:</p>\n\n<pre><code>allLow :: String -&gt; String\nallLow \"\" = \"\"\nallLow (c:cs) = if lowerCase c = True then (c ++ (allLow cs))\n</code></pre>\n\n<p>I wrote a function called, \"lowerCase\" (Char -> Bool) which returns true if the given char is lowercase. I am assuming that I can test lowerCase's validity at each \"index\" of the string and pump out all uppercase letters that way, but it's not working. The error message isn't helping me. It's saying there is a parse error at '=' but Idk what that means. It's not supposed to be == True.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 6551, "user_id": 49107, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/1e8f141e7857d397d8020ed3b759e88a?s=128&d=identicon&r=PG", "display_name": "Maciej Piechotka", "link": "https://stackoverflow.com/users/49107/maciej-piechotka"}, "edited": false, "score": 3, "creation_date": 1421548942, "post_id": 28006620, "comment_id": 44401589, "body": "That&#39;s because expression <code>Denied == Missing</code> does not have a defined value. If you want everything else evaluate to <code>False</code> then you need to add <code>_ == _ = False</code> at the end - otherwise it will evaluate to bottom (unspecified value)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1421550290, "post_id": 28006620, "comment_id": 44401797, "body": "Put <code>:set -Wall</code> in your .ghci file and the compiler will warn you about this mistake."}], "answers": [{"comments": [{"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "edited": false, "score": 2, "creation_date": 1421549013, "post_id": 28006640, "comment_id": 44401601, "body": "Thank you so much shree.pat18. I really appreciate it!"}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "reply_to_user": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "edited": false, "score": 2, "creation_date": 1421549100, "post_id": 28006640, "comment_id": 44401614, "body": "@skills Tip: Since the last case is to handle everything else, we don&#39;t really need to name the expressions <code>x</code> or <code>y</code> - we could write <code>_ == _ = False</code> without affecting the result."}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": true, "score": 10, "last_activity_date": 1421548907, "creation_date": 1421548907, "answer_id": 28006640, "question_id": 28006620, "link": "https://stackoverflow.com/questions/28006620/instance-eq-at-haskell-non-exhaustive-pattern/28006640#28006640", "title": "Instance Eq at Haskell -&gt; Non-exhaustive pattern", "body": "<p>Add a final pattern match to test for any other combination of inputs as <code>False</code>, like so:</p>\n\n<pre><code>instance Eq Classification where\nDenied     == Denied    = True\nMissing    == Missing   = True\nAproved x  == Aproved y = y==x    \nx == y = False\n</code></pre>\n"}], "owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 28006640, "answer_count": 1, "score": 1, "last_activity_date": 1421549595, "creation_date": 1421548725, "last_edit_date": 1421549595, "question_id": 28006620, "link": "https://stackoverflow.com/questions/28006620/instance-eq-at-haskell-non-exhaustive-pattern", "title": "Instance Eq at Haskell -&gt; Non-exhaustive pattern", "body": "<p>I am trying to declare an instance using haskell, here i have my data type:</p>\n\n<pre><code>data Classification = Aproved Int\n                    | Denied\n                    | Missing\n                    deriving (Show)\n</code></pre>\n\n<p>And the instance declared:</p>\n\n<pre><code>instance Eq Classificacao where\n    Denied     == Denied    = True\n    Missing    == Missing   = True\n    Aproved x  == Aproved y = y==x\n</code></pre>\n\n<p>When i try to compare the data constructors, it gives me the error Non-exhaustive pattern , if i use at GHCi <code>Denied==Missing</code></p>\n\n<p>What should i do? I am learning still.</p>\n"}, {"tags": ["haskell", "cuda", "accelerate-haskell"], "answers": [{"tags": [], "owner": {"reputation": 965, "user_id": 229255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/588fe10267b620e1c0d0d188a8db2621?s=128&d=identicon&r=PG", "display_name": "Ian Ross", "link": "https://stackoverflow.com/users/229255/ian-ross"}, "is_accepted": false, "score": 1, "last_activity_date": 1421823258, "creation_date": 1421823258, "answer_id": 28061254, "question_id": 28006170, "link": "https://stackoverflow.com/questions/28006170/how-do-i-enable-cuda-on-the-examples-on-the-accelerate-examples-package/28061254#28061254", "title": "How do I enable CUDA on the examples on the accelerate-examples package?", "body": "<p>I think you just need to use the <code>-fcuda</code> flag when you Cabal install.  This will install the <code>acclerate-cuda</code> package and enable the CUDA backend for all the examples (they seem to use the CUDA backend by default if it's enabled).</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1421823258, "creation_date": 1421543558, "question_id": 28006170, "link": "https://stackoverflow.com/questions/28006170/how-do-i-enable-cuda-on-the-examples-on-the-accelerate-examples-package", "title": "How do I enable CUDA on the examples on the accelerate-examples package?", "body": "<p>I've installed CUDA on my OSX Yosemite. I've downloaded the accelerate-examples package and compiled it with <code>cabal install</code>. It compiled correctly. When I ran the examples, though, I noticed they do not offer a option to run under CUDA. For example:</p>\n\n<pre><code>vh:accelerate-crystal apple1$ ./accelerate-crystal\nEKG monitor started at: http://localhost:8000\n\naccelerate-crystal (c) [2011..2013] The Accelerate Team\n\nUsage: accelerate-crystal [OPTIONS]\n\nAvailable backends:\n  *  interpreter  reference implementation (sequential)\n</code></pre>\n\n<p>This makes them run slow (and, obviously, beat the purpose). How do I enable CUDA on the compiled examples?</p>\n"}, {"tags": ["haskell", "yesod", "template-haskell"], "answers": [{"comments": [{"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1421584449, "post_id": 28008606, "comment_id": 44407114, "body": "Function declaration deleteUserR now exists in module Handler.User, but when Yesod runner try call deleteUserR from module Application, compiler write Yesod specific Error:  No instance for (ToTypedContent res0)   arising from a use of <code>yesodRunner&#39; The type variable </code>res0&#39; is ambiguous"}, {"owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "reply_to_user": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1421585395, "post_id": 28008606, "comment_id": 44407400, "body": "Hi, Maybe we should add type signature to the generated function declaration. I have updated the code example in my answer. Try it again with right type signature, in your case: <code>funcName :: UserId -&gt; Handler Value</code>"}, {"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1421586434, "post_id": 28008606, "comment_id": 44407685, "body": "Problem: I don&#39;t know type signature for <code>funcName</code>  It have type something like this: <code>Key User -&gt; Handler Value</code> but type User is argument of mkDeleteHandler, where <code>Key User = UserId</code>"}, {"owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "reply_to_user": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1421587061, "post_id": 28008606, "comment_id": 44407861, "body": "Hmm, I have no idea what you are exactly trying to do without seeing the full code... Can you update your question with full code?"}, {"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1421587999, "post_id": 28008606, "comment_id": 44408124, "body": "Do you have yesod packages installed? For example, default Yesod scaffolding site enough to get error"}, {"owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "reply_to_user": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1421588281, "post_id": 28008606, "comment_id": 44408213, "body": "Do you get an error too, if you define the function <code>deleteUserR</code> &quot;manually&quot; like you did in your question?"}, {"owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "reply_to_user": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1421588535, "post_id": 28008606, "comment_id": 44408294, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/69062/discussion-between-bmk-and-bet\">continue this discussion in chat</a>."}, {"owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "reply_to_user": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1421604181, "post_id": 28008606, "comment_id": 44413089, "body": "I&#39;ve updated the answer with a simple type parametrization example. It should be straight forward to adapt the example for your case."}, {"owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "edited": false, "score": 0, "creation_date": 1421606398, "post_id": 28008606, "comment_id": 44413848, "body": "Very good example. It is really solve problem. Can I write code with TH something like this <code>funcName :: $(mytype) -&gt; IO()</code>, where $(mytype) - compile time evaluation type?"}], "tags": [], "owner": {"reputation": 1498, "user_id": 960404, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/fp5n0.jpg?s=128&g=1", "display_name": "bmk", "link": "https://stackoverflow.com/users/960404/bmk"}, "is_accepted": true, "score": 1, "last_activity_date": 1421604123, "last_edit_date": 1421604123, "creation_date": 1421576018, "answer_id": 28008606, "question_id": 28004888, "link": "https://stackoverflow.com/questions/28004888/automatically-declaration-yesod-handlers-using-template-haskell/28008606#28008606", "title": "Automatically declaration yesod handlers using Template Haskell", "body": "<p>EDIT: Simple type signature parameterization example added</p>\n\n<p>I think there is a problem with function name binding in your <code>mkDeleteHandler</code>. I would try something like this for example (example simplified):</p>\n\n<pre><code>mkHandler :: String -&gt; String -&gt; Q [Dec]\nmkHandler typeName funcName = do\n  funDecl &lt;- [d| funcName :: String -&gt; IO()\n                 funcName var1 = do\n                 print var1 |]\n\n  let [SigD _ (AppT _ t0), FunD _ funBody] = funDecl\n      sigBody' = (AppT (AppT ArrowT (ConT tname)) t0)\n\n  return $ [SigD hname sigBody', FunD hname funBody]\n\n  where\n    hname  = mkName funcName\n    tname = mkName typeName\n</code></pre>\n\n<p>And then you can splice it something like this:</p>\n\n<pre><code>data Foo = Foo Int\n     deriving Show\n\n$(mkHandler \"Int\" \"handlerInt\")\n$(mkHandler \"String\" \"handlerString\")\n$(mkHandler \"Foo\" \"handlerFoo\")\n\nmain = do\n  handlerInt 5\n  handlerString \"Hello World\"\n  handlerFoo $ Foo 5\n</code></pre>\n\n<p>Note that the <code>mkHandler</code> should be defined in separate module and imported first before using it.</p>\n\n<p>Your problem was that the <code>hname</code> was not used at all, like the compiler has correctly warned. The fix is that we generate a \"template\" function declaration using quotation brackets and then replace the generated function name with our own <code>hname</code>.</p>\n\n<p>IMHO the best tutorial for learning <code>Template Haskell</code> is <a href=\"http://web.archive.org/web/20100703060856/http://www.haskell.org/bz/thdoc.htm\" rel=\"nofollow\">this one</a>.</p>\n"}], "owner": {"reputation": 329, "user_id": 971883, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab5062317cc23f37e24ff80f0b6261e8?s=128&d=identicon&r=PG", "display_name": "Bet", "link": "https://stackoverflow.com/users/971883/bet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 28008606, "answer_count": 1, "score": 1, "last_activity_date": 1421604123, "creation_date": 1421532556, "question_id": 28004888, "link": "https://stackoverflow.com/questions/28004888/automatically-declaration-yesod-handlers-using-template-haskell", "title": "Automatically declaration yesod handlers using Template Haskell", "body": "<p>For example, I have next entity type in Model </p>\n\n<pre><code>User json\n    username Text\n</code></pre>\n\n<p>and following Haskell types:</p>\n\n<pre><code>Entity User\n</code></pre>\n\n<p>Delete handler for User:</p>\n\n<p>Routes file:</p>\n\n<pre><code>/users/#UserId UserR DELETE\n</code></pre>\n\n<p>Handler declaration:</p>\n\n<pre><code>deleteUserR :: UserId -&gt; Handler Value\ndeleteUserR uid = do\n    runDB $ delete uid\n    sendResponseStatus status200 (\"DELETED\" :: Text)\n</code></pre>\n\n<p>I want to write template function something like this:</p>\n\n<pre><code>mkDeleteHandler :: String -&gt; Q [Dec]\nmkDeleteHandler name = do\n    [d|hname idname = do\n        runDB $ delete idname\n        sendResponseStatus status200 (\"DELETED\" :: Text)|]\n        where hname  = mkName (\"delete\" ++ name ++ \"R\")\n              idname = mkName (\"i\" ++ name)\n</code></pre>\n\n<p>In my Handler.User module I write</p>\n\n<pre><code>mkDeleteHandler \"User\"\n</code></pre>\n\n<p>But it is not working. Compiler write next warnings:</p>\n\n<p><strong>Warning: Defined but not used: hname</strong></p>\n\n<p><strong>Warning: Defined but not used: idname</strong></p>\n\n<p>And Error:</p>\n\n<p><strong>Not in scope: deleteUserR</strong></p>\n"}, {"tags": ["file", "haskell", "io"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1421530289, "post_id": 28004476, "comment_id": 44397550, "body": "Why don&#39;t you return your lines instead? E.g. <code>mainloop ::  Handle -&gt; Handle -&gt; IO (String,String,String) ; .... ; inp3 &lt;- hGetLine inh ; return (inp1,inp2,inp3)</code>."}, {"owner": {"reputation": 3, "user_id": 4465663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/27338eb8de8cc84533e53de4e56084d2?s=128&d=identicon&r=PG&f=1", "display_name": "desf", "link": "https://stackoverflow.com/users/4465663/desf"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421531826, "post_id": 28004476, "comment_id": 44397981, "body": "Because I&#39;m stupid and don&#39;t know Haskell well enough. ;) Many thanks, Any ideas about typing filename?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1421532016, "post_id": 28004476, "comment_id": 44398030, "body": "You shouldn&#39;t try to shoehorn in a 2nd questions which is only tangentially related. Just create an actual new question. Also, <code>mainLoop inh = liftA3 (,,) a a a where a = hGetLine inh</code>."}, {"owner": {"reputation": 3, "user_id": 4465663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/27338eb8de8cc84533e53de4e56084d2?s=128&d=identicon&r=PG&f=1", "display_name": "desf", "link": "https://stackoverflow.com/users/4465663/desf"}, "edited": false, "score": 0, "creation_date": 1421533134, "post_id": 28004476, "comment_id": 44398327, "body": "Ok, sorry. I worked it out myself anyway. It appears that notepad++ makes some mess with white symbols and haskell compiler are showing stupid errors one after another. After editing in regular notepad the name isssue is solved.."}], "answers": [{"tags": [], "owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "is_accepted": true, "score": 1, "last_activity_date": 1421582496, "creation_date": 1421582496, "answer_id": 28009422, "question_id": 28004476, "link": "https://stackoverflow.com/questions/28004476/reding-3-lines-from-file-haskell/28009422#28009422", "title": "Reding 3 lines from file - Haskell", "body": "<p>So the problem is that GHC refuse to compile :</p>\n\n<pre><code>mainloop :: Handle -&gt; Handle -&gt; IO ()\nmainloop inh outh = do \n  inp1 &lt;- hGetLine inh\n  inp2 &lt;- hGetLine inh\n  inp3 &lt;- hGetLine inh\n</code></pre>\n\n<p>Right ?</p>\n\n<p>This is in fact very reasonable, you're thinking in (bad) imperative terms, as if your inp# were global variables that you could use in another function after initializing them in <code>mainloop</code>... But that's not the case : inp1, inp2 and inp3 are only local bindings that were introduced and can be used only in this do-block in <code>mainloop</code> so when the last line is :</p>\n\n<pre><code>inp3 &lt;- hGetLine inh\n</code></pre>\n\n<p>It is clear that there's an error since you won't be able to use this inp3 anywhere (you're at the end of the do-block) which is why GHC tells you that the last line of your do-block should be an expression like <code>putStrLn inp3</code> rather than an affectation.</p>\n\n<p>It should now be clear that your function <code>mainloop</code> actually read the lines but immediately lose them, if you want to use them in the caller you have to return them with <code>return (inp1, inp2, inp3)</code> for instance (which is an expression so your GHC will be happy with your do-block). Of course, Haskell is the king of abstraction so repeating the same line 3 times and giving 3 useless names to temporary variable is a bit of an anathema... Other suggestions to do the same without repetition and having to invent useless names would be :</p>\n\n<pre><code>mainLoop inh = liftA3 (,,) a a a where a = hGetLine inh\n</code></pre>\n\n<p>which would return a triplet or :</p>\n\n<pre><code>mainLoop inh = replicateM 3 (hGetLine inh)\n</code></pre>\n\n<p>which would return a list of 3 elements... But at this point I would probably not create a function just for <code>[l1,l2,l3] &lt;- replicateM 3 (hGetLine inh)</code>.</p>\n"}], "owner": {"reputation": 3, "user_id": 4465663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/27338eb8de8cc84533e53de4e56084d2?s=128&d=identicon&r=PG&f=1", "display_name": "desf", "link": "https://stackoverflow.com/users/4465663/desf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 28009422, "answer_count": 1, "score": 0, "last_activity_date": 1421582496, "creation_date": 1421529817, "question_id": 28004476, "link": "https://stackoverflow.com/questions/28004476/reding-3-lines-from-file-haskell", "title": "Reding 3 lines from file - Haskell", "body": "<p>I'm writing a Haskell program. More advanced functions later, but for now I'm stuck at reading file. I know that there are tons of threads about it, but as far as I can see, all solution are loop based. I need to read from a txt file with 3 lines. and save content of these 3 lines in 3 separate variables for further use, so loop based solution are not only not necessary but also problematic (with saving into 3 different variables). I searched a bit, found some of examples,  tried to build something from them, but this language seems so strange I can't figure why some modifications are working and some are not.</p>\n\n<p>First of all, working code:</p>\n\n<pre><code>import System.IO\n\nmain :: IO ()\nmain = do \n   inh &lt;- openFile \"input.txt\" ReadMode\n   outh &lt;- openFile \"output.txt\" WriteMode\n   mainloop inh outh\n   hClose inh\n   hClose outh\n\nmainloop :: Handle -&gt; Handle -&gt; IO ()\nmainloop inh outh = do \ninp1 &lt;- hGetLine inh\ninp2 &lt;- hGetLine inh\ninp3 &lt;- hGetLine inh\nputStrLn (inp3)\n</code></pre>\n\n<p>This code reads first, then second, then third line from the file, saves each into respective variable and then puts inp3 on the screen. Thing is though, I don't need to print it just save it into 3 variables for further use, but without the printing line it the program doesn't work, compiler says \"the last statement in do block must be an expression\". If I however want to print more lines just to see if reading is working correctly and add more putStrLn (for inp1 and inp2) it won't compile. For example, after adding line \"putStrLn (inp1)\" just after the line with getting inp1 it won't compile and says \"Parse error in patter putStrLn, Possibly caused by a missing 'do'? I'm just beggining wwith Haskell so it probably is somethin obvious, but I have no idea what.</p>\n\n<p>There is also a second issue. This program reads from input.txt. I want it to ask for name, wait for person to type and then open it. I figured it would be something like</p>\n\n<pre><code>putStrLn \"Type name\"\nname &lt;- getLine\ninh &lt;- openFile name ReadMode    \n</code></pre>\n\n<p>but it doesn't work either. I will be very thankful for any input that can help me. Oddly enough in example given in <a href=\"http://en.wikibooks.org/wiki/Haskell/Libraries/Solutions/IO\" rel=\"nofollow\">http://en.wikibooks.org/wiki/Haskell/Libraries/Solutions/IO</a>\nis using something similar and it compile without any problems, but mine won't. Any sugestions?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 21422, "user_id": 333698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ca080b4ef1c6cb4df9bc123d3b3af61?s=128&d=identicon&r=PG", "display_name": "psmears", "link": "https://stackoverflow.com/users/333698/psmears"}, "edited": false, "score": 0, "creation_date": 1421529486, "post_id": 28004400, "comment_id": 44397318, "body": "... and what happens when you try this? (I suspect I can <i>guess</i>, but you should add that to your question!)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1421529583, "post_id": 28004400, "comment_id": 44397349, "body": "&quot;If the list is empty, return an empty list.&quot; But I didn&#39;t want a list, I wanted to pick an <code>a</code>!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421529989, "post_id": 28004400, "comment_id": 44397467, "body": "Recall that <code>foldl (+) 2 [3,4,5] = ((2+3)+4)+5</code>. How many arguments should your <code>leftFolder</code> take?"}], "answers": [{"comments": [{"owner": {"reputation": 356, "user_id": 4392949, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-nBwze4RbYJw/AAAAAAAAAAI/AAAAAAAAAE8/acyTL4RQNEk/photo.jpg?sz=128", "display_name": "Joffrey Baratheon", "link": "https://stackoverflow.com/users/4392949/joffrey-baratheon"}, "edited": false, "score": 0, "creation_date": 1421530949, "post_id": 28004497, "comment_id": 44397731, "body": "I&#39;m trying to understand your code here. So you are saying that we have this leftFolder function, and we will pass 3 arguments through it. The &quot;_&quot; indicates that we don&#39;t care what that argument will be and then the 2nd c argument indicates the starting point for the accumulator. The &quot;[]&quot; represents the empty list being passed through. I need help understanding the 3rd line. You are saying that we will pass a function argument (fn for stuff like (+) ) and an accumulator variable c, with a list with a head and tail. I need help understanding what&#39;s going on at &quot;leftFolder fn (fn c x) xs&quot;"}, {"owner": {"reputation": 11044, "user_id": 1594980, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/d8b0d9cdd77d0b6b9765d45fdf80632c?s=128&d=identicon&r=PG", "display_name": "Jiri Kremser", "link": "https://stackoverflow.com/users/1594980/jiri-kremser"}, "edited": false, "score": 0, "creation_date": 1421532094, "post_id": 28004497, "comment_id": 44398055, "body": "<code>leftFolder fn (fn c x) xs</code> means apply the <code>leftFolder</code> function recursively on  following parameters: 1) the same <code>fn</code> function 2) the new accumulator created by applying the <code>fn</code> on the original accumulator <code>c</code> and the head of the list <code>x</code>, 3) tail of the list <code>xs</code> (the head element was processed, from left)  imho natural language sux in this case and <code>leftFolder fn (fn c x) xs</code> is more understandable"}], "tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": true, "score": 3, "last_activity_date": 1421529929, "creation_date": 1421529929, "answer_id": 28004497, "question_id": 28004400, "link": "https://stackoverflow.com/questions/28004400/using-a-function-like-foldl-recursively/28004497#28004497", "title": "Using a Function Like foldl Recursively", "body": "<p>There are a lot of issues with your code. For example:</p>\n\n<ul>\n<li>you are pattern matchin as a first argument <code>[]</code> while the first argument should be a function</li>\n<li>you are using only 1 argument as opposed to the 3 you are requiring</li>\n<li><code>x (++) ...</code> makes no sense; you probably meant to use <code>x:...</code></li>\n<li>in the first pattern match you are returning a list, while the return type of your function is not necessarily a list</li>\n</ul>\n\n<p>I believe what you are looking for is this:</p>\n\n<pre><code>leftFolder :: (a -&gt; b -&gt; a) -&gt; a -&gt; [b] -&gt; a\nleftFolder _ c [] = c\nleftFolder fn c (x:xs) = leftFolder fn (fn c x) xs\n</code></pre>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/a688512919a2b1c6\" rel=\"nofollow\"><kbd>Live demo</kbd></a></p>\n\n<p>That is: if the list is empty then we return the accumulated value in the second position. Otherwise we calculate the new accumulated value (<code>fn c x</code>) and then pass it as the second argument to our function while also forwarding <code>fn</code> and passing the rest of the list.</p>\n"}], "owner": {"reputation": 356, "user_id": 4392949, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh5.googleusercontent.com/-nBwze4RbYJw/AAAAAAAAAAI/AAAAAAAAAE8/acyTL4RQNEk/photo.jpg?sz=128", "display_name": "Joffrey Baratheon", "link": "https://stackoverflow.com/users/4392949/joffrey-baratheon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 28004497, "answer_count": 1, "score": 0, "last_activity_date": 1421530270, "creation_date": 1421529321, "last_edit_date": 1421530270, "question_id": 28004400, "link": "https://stackoverflow.com/questions/28004400/using-a-function-like-foldl-recursively", "title": "Using a Function Like foldl Recursively", "body": "<p>As an exercise, I'm trying to write a function that behaves the same way as the foldl function and I'm trying to use recursion, as well.</p>\n\n<p>My function will be called, \"leftFolder\" and the signature will look like a foldl function's:\n <code>leftFolder :: (a -&gt; b -&gt; a) -&gt; a -&gt; [b] -&gt; a</code></p>\n\n<p>I'm kinda stuck on what to do, but here's what I've tried:</p>\n\n<pre><code>leftFolder :: (a -&gt; b -&gt; a) -&gt; a -&gt; [b] -&gt; a\nleftFolder [] = []\nleftFolder (x:xs) = x (++) (leftFolder xs)\n</code></pre>\n\n<p>In my mind, this makes sense. I'm saying that if the list is empty, return an empty list. If it's not, then take the head of the list and then keep appending it to the tail.</p>\n"}, {"tags": ["haskell", "repa"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1421532205, "post_id": 28003993, "comment_id": 44398085, "body": "How about <a href=\"https://hackage.haskell.org/package/repa-3.3.1.2/docs/Data-Array-Repa.html#v:fromFunction\" rel=\"nofollow noreferrer\"><code>fromFunction</code></a>? For the 2D case, it would be something like <code>drawRect x y colour = fromFunction (Z :. y :. x) (const colour)</code>. Unless you want to actually update an array (probably a bad idea), then use <code>\\colour -&gt; map (const colour)</code>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1421539962, "post_id": 28003993, "comment_id": 44399965, "body": "The problem is that I don&#39;t want to check every pixel of a 1024x1024 image to draw a small circle on pos (600, 600)."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1421542071, "post_id": 28003993, "comment_id": 44400386, "body": "Why does it have to be REPA?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1421543207, "post_id": 28003993, "comment_id": 44400616, "body": "I believe you will have to use fairly low level operations if you are really worried about iterating over each pixel. The simple way is to create the small image, append arrays filled with zeroes to get the proper positioning, then add them together. The not-so-simple way is use <code>loadP&#47;S</code> to write the &quot;large&quot; image, then <code>loadRangeP&#47;S</code> to write the small &quot;image&quot;. Your pseudocode seems to assume mutation but the point of a high level library like REPA is to <i>not</i> expose the underlying mutation to the user. Maybe it would help if you gave the actual problem you are trying to solve."}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 2, "last_activity_date": 1421548043, "creation_date": 1421548043, "answer_id": 28006561, "question_id": 28003993, "link": "https://stackoverflow.com/questions/28003993/what-is-the-fastest-way-to-draw-a-rectangle-in-a-repa-array/28006561#28006561", "title": "What is the fastest way to draw a rectangle in a REPA array?", "body": "<p>Of the ordinary REPA mechanisms for making new arrays, making an new delayed array is fastest when copying an array once to foreign memory. Actual performance using REPA will depend on what you do with your array.</p>\n\n<p>Let's define the type of a computation that depends only on the position in an array and the current value at that position.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.Array.Repa hiding ((++))\nimport Data.Array.Repa.Repr.ForeignPtr\n\nimport Data.Word\nimport Control.Monad\nimport Data.Time.Clock\nimport System.Mem\n\ntype Ghost sh a b = sh -&gt; a -&gt; b\n</code></pre>\n\n<p>We can define filling in any shape.</p>\n\n<pre><code>fill :: Shape sh =&gt; sh -&gt; sh -&gt; a -&gt; Ghost sh a a\nfill from to color = go\n    where\n        {-# INLINE go #-}\n        go sh a =\n            if inShapeRange from to sh\n            then color\n            else a\n</code></pre>\n\n<p>We will use this with three different ways to define a new array - a delayed array, a structured traversal, and an unstructured traversal. </p>\n\n<p>The simplest delaying is <code>fromFunction</code>.</p>\n\n<pre><code>ghostD :: (Shape sh, Source r a) =&gt; Ghost sh a b -&gt; Array r sh a -&gt; Array D sh b\nghostD g a = fromFunction (extent a) go\n    where\n        {-# INLINE go #-}\n        go sh = g sh (a ! sh)\n</code></pre>\n\n<p>A structured traversal can take advantage of knowing the structure of the underlying array representation. Unfortunately, the only way we can get information about the position in a structured traversal is by zipping using <code>szipWith</code> with an array that somehow already contains the position information.</p>\n\n<pre><code>ghostS :: (Shape sh, Structured r1 a b, Source r1 a) =&gt; Ghost sh a b -&gt; Array r1 sh a -&gt; Array (TR r1) sh b\nghostS g a = szipWith ($) ghost a\n    where\n        ghost = fromFunction (extent a) g\n</code></pre>\n\n<p>An unstructured traversal is very similar to a delayed array built by <code>fromFunction</code>; it also returns an <code>Array D</code>.</p>\n\n<pre><code>ghostT :: (Shape sh, Source r a) =&gt; Ghost sh a b -&gt; Array r sh a -&gt; Array D sh b\nghostT g a = traverse a id go\n    where\n        {-# INLINE go #-}\n        go lookup sh = g sh (lookup sh)\n</code></pre>\n\n<p>With some extremely naive benchmarking, we can run these and see how fast they are. We perform garbage collection before measuring the time to try to get reliable timing results. We'll have two benchmarks. For each mechanism,. we'll run a single step writing the result to memory 10 times. Then we'll compose 101 identical steps writing the result to memory once.</p>\n\n<pre><code>bench :: Int -&gt; String -&gt; IO a -&gt; IO ()\nbench n name action = do\n    performGC\n    start &lt;- getCurrentTime\n    replicateM_ n action    \n    performGC\n    end &lt;- getCurrentTime\n    putStrLn $ name ++ \" \" ++ (show (diffUTCTime end start / fromIntegral n))\n\niterN :: Int -&gt; (a -&gt; a) -&gt; (a -&gt; a)\niterN 0 f = id\niterN n f = f . iterN (n-1) f\n\nmain = do\n    (img :: Array F DIM2 Word32) &lt;- computeP (fromFunction (Z :. 1024 :. 1024 ) (const minBound))\n    let (Z :. x :. y ) = extent img\n        drawBox = fill (Z :. 20 :. 20 ) (Z :. x - 20 :. y - 20 ) maxBound\n\n    bench 10 \"Delayed      10x1\" ((computeP $ ghostD drawBox img) :: IO (Array F DIM2 Word32))\n    bench 10 \"Unstructured 10x1\" ((computeP $ ghostT drawBox img) :: IO (Array F DIM2 Word32))\n    bench 10 \"Structured   10x1\" ((computeP $ ghostS drawBox img) :: IO (Array F DIM2 Word32))\n\n    bench 1 \"Delayed      1x101\" ((computeP $ (iterN 100 (ghostD drawBox)) . ghostD drawBox $ img) :: IO (Array F DIM2 Word32))\n    bench 1 \"Unstructured 1x101\" ((computeP $ (iterN 100 (ghostT drawBox)) . ghostT drawBox $ img) :: IO (Array F DIM2 Word32))\n    bench 1 \"Structured   1x101\" ((computeP $ (iterN 100 (ghostS drawBox)) . ghostS drawBox $ img) :: IO (Array F DIM2 Word32))\n</code></pre>\n\n<p>The resulting times are averaged over the number of times the array was forced by being written to foreign memory. These results are typical of multiple runs on my machine.</p>\n\n<pre><code>Delayed      10x1 0.0234s\nUnstructured 10x1 0.02652s\nStructured   10x1 0.02652s\nDelayed      1x101 0.078s\nUnstructured 1x101 0.0936s\nStructured   1x101 0.2652s\n</code></pre>\n\n<p>The results don't seem to depend on the order the benchmarks are run in.</p>\n\n<pre><code>Structured   10x1 0.03276s\nUnstructured 10x1 0.02652s\nDelayed      10x1 0.01716s\nStructured   1x101 0.2184s\nUnstructured 1x101 0.1092s\nDelayed      1x101 0.0624s\n</code></pre>\n\n<p>These results suggest you can do a handful of full-array computations and still have the performance be dominated by memory access to write the results.</p>\n\n<p>Libraries for rendering scenes by drawing on them typically have a very different structure from REPA, which is mostly built to do data processing tasks across all the data in parallel. Drawing and rendering libraries usually use a graph or tree of scene elements called a <a href=\"http://en.wikipedia.org/wiki/Scene_graph\" rel=\"nofollow\">scene graph</a> that allows them to quickly cull elements that won't be drawn in an image or a portion of an image. Mutating the result isn't necessary to achieve good performance if you can quickly cull everything that doesn't affect a specific pixel.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 1, "accepted_answer_id": 28006561, "answer_count": 1, "score": 0, "last_activity_date": 1421548043, "creation_date": 1421526578, "question_id": 28003993, "link": "https://stackoverflow.com/questions/28003993/what-is-the-fastest-way-to-draw-a-rectangle-in-a-repa-array", "title": "What is the fastest way to draw a rectangle in a REPA array?", "body": "<p>Usually, a good method of drawing a rectangle in a bitmap is looping through the 2 bounding dimensions and setting individual pixels. For example, on pseudocode:</p>\n\n<pre><code>drawRect(array, color, x, X, y, Y):\n    for x from x til X:\n        for y from y til Y:\n            array[x,y] = color\n</code></pre>\n\n<p>What is the equivalent on Haskell's REPA?</p>\n"}, {"tags": ["haskell", "unicode", "utf-8", "unicode-string"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1421526199, "post_id": 28003875, "comment_id": 44396428, "body": "If I recall correctly, you need to change the codepage. This is a windows specific problem."}, {"owner": {"reputation": 11, "user_id": 4465124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4293b60bf10bd49743b597db8249de64?s=128&d=identicon&r=PG&f=1", "display_name": "mateuszjp", "link": "https://stackoverflow.com/users/4465124/mateuszjp"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1421526722, "post_id": 28003875, "comment_id": 44396587, "body": "main problem is with &quot;sepcial character&quot; like &#39;\u0107&#39;, writeFile function throw exception"}, {"owner": {"reputation": 11, "user_id": 4465124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4293b60bf10bd49743b597db8249de64?s=128&d=identicon&r=PG&f=1", "display_name": "mateuszjp", "link": "https://stackoverflow.com/users/4465124/mateuszjp"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1421527085, "post_id": 28003875, "comment_id": 44396695, "body": "what do you mean by codepage? how to change codepage?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1421527478, "post_id": 28003875, "comment_id": 44396791, "body": "Try running <code>chcp 65001</code> in the terminal before your Haskell application."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1421528019, "post_id": 28003875, "comment_id": 44396931, "body": "what does the command <code>chcp</code> report? (more info on chcp: <a href=\"http://ss64.com/nt/chcp.html\" rel=\"nofollow noreferrer\">ss64.com/nt/chcp.html</a> )"}, {"owner": {"reputation": 11, "user_id": 4465124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4293b60bf10bd49743b597db8249de64?s=128&d=identicon&r=PG&f=1", "display_name": "mateuszjp", "link": "https://stackoverflow.com/users/4465124/mateuszjp"}, "edited": false, "score": 0, "creation_date": 1421528332, "post_id": 28003875, "comment_id": 44397008, "body": "THANKS chcp helps; I use (answer with bat file, <a href=\"http://superuser.com/questions/269818/change-default-code-page-of-windows-console-to-utf-8\" title=\"change default code page of windows console to utf 8\">superuser.com/questions/269818/&hellip;</a>)"}], "answers": [{"comments": [{"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1421653442, "post_id": 28011954, "comment_id": 44426267, "body": "cp 65001 isn&#39;t exactly UTF8: it&#39;s a non-unicode encoding that uses the same packing scheme (or if it is UTF8 then that means the console font associated with it has very few correct glyphs)."}, {"owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "edited": false, "score": 0, "creation_date": 1522483437, "post_id": 28011954, "comment_id": 86179120, "body": "See the doc for System.IO for available encodings: <a href=\"https://hackage.haskell.org/package/base-4.11.0.0/docs/System-IO.html#g:23\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.11.0.0/docs/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1367, "user_id": 1160885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc61c1b2045efa54375188bdb6a33945?s=128&d=identicon&r=PG", "display_name": "Jedai", "link": "https://stackoverflow.com/users/1160885/jedai"}, "is_accepted": false, "score": 1, "last_activity_date": 1421598056, "creation_date": 1421598056, "answer_id": 28011954, "question_id": 28003875, "link": "https://stackoverflow.com/questions/28003875/haskell-save-unicode-string-characters-to-file/28011954#28011954", "title": "Haskell - save unicode (String, characters) to file", "body": "<p>By default, a newly created handle is affected the locale encoding the OS reported (see <code>System.IO.localeEncoding</code>). In Windows that may be a very old codepage... So one way is to change the codepage to 65001 (with <code>chcp 65001</code>) prior to launching the Haskell executable. If that is unsatisfactory, you can change the encoding of any Handle in your code with <code>System.IO.hSetEncoding</code> (even stdout) or even use ByteString IO (binary) and do the encoding/decoding yourself (probably overkill if you don't need very precise control over it). Note that this means that writeFile can't be used since you don't see the handle, you'll have to write your own variant :</p>\n\n<pre><code>writeFileWithEncoding fp content enc =\n  withFile fp WriteMode $ \\h -&gt; do\n    hSetEncoding h enc\n    hPutStr h content\n</code></pre>\n\n<p>Or just a version specialized for utf8.</p>\n"}], "owner": {"reputation": 11, "user_id": 4465124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4293b60bf10bd49743b597db8249de64?s=128&d=identicon&r=PG&f=1", "display_name": "mateuszjp", "link": "https://stackoverflow.com/users/4465124/mateuszjp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 604, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1421598056, "creation_date": 1421525830, "last_edit_date": 1421526132, "question_id": 28003875, "link": "https://stackoverflow.com/questions/28003875/haskell-save-unicode-string-characters-to-file", "title": "Haskell - save unicode (String, characters) to file", "body": "<p>environment: windows 7 64, ghci 7.8.3</p>\n\n<p>IN GHCI</p>\n\n<pre><code>\\197 &lt;-&gt; \u0106\n\nPrelude&gt; putStrLn \"\\197\"\n*** Exception: &lt;stdout&gt;: hPutChar: invalid argument (invalid character)\n</code></pre>\n\n<p>Finally</p>\n\n<p>I try use <code>writeFile</code> function to save <code>String</code> to file;</p>\n\n<pre><code>writeFile \"filename.txt\" \"\u0107\u0106\"\n-- content in \"filename.txt\" -&gt; \u2020\u0179\n</code></pre>\n\n<p>how to write to character quotation mark (\")</p>\n\n<pre><code>content2 = \"\\\"http:\\\\www.google.com\\\"\"\nwriteFile \"filename2.txt content2\n</code></pre>\n\n<ul>\n<li>how to store in file <code>content2</code> without Escaping character</li>\n<li>because I want to store something like <code>href=\"http:\\\\www.google.com\"</code></li>\n</ul>\n\n<p>If this is wrong way, how to download webpage (html) and save it on hdd and then open it in web browser, </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 8617, "user_id": 3477950, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mC5xL.jpg?s=128&g=1", "display_name": "The Paramagnetic Croissant", "link": "https://stackoverflow.com/users/3477950/the-paramagnetic-croissant"}, "edited": false, "score": 0, "creation_date": 1421525283, "post_id": 28003711, "comment_id": 44396179, "body": "The trick is to return a new function from your callback that has one of its argument already applied to its other argument."}, {"owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "reply_to_user": {"reputation": 8617, "user_id": 3477950, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mC5xL.jpg?s=128&g=1", "display_name": "The Paramagnetic Croissant", "link": "https://stackoverflow.com/users/3477950/the-paramagnetic-croissant"}, "edited": false, "score": 0, "creation_date": 1421525609, "post_id": 28003711, "comment_id": 44396264, "body": "@TheParamagneticCroissant that&#39;s the purpose os the function, what i was asking is for a practical solution, because i struggle with folds"}, {"owner": {"reputation": 8617, "user_id": 3477950, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mC5xL.jpg?s=128&g=1", "display_name": "The Paramagnetic Croissant", "link": "https://stackoverflow.com/users/3477950/the-paramagnetic-croissant"}, "edited": false, "score": 2, "creation_date": 1421525638, "post_id": 28003711, "comment_id": 44396274, "body": "a la &quot;gimme teh codez&quot; style? that&#39;s not something we like to do on Stack Overflow, but let me see\u2026"}, {"owner": {"reputation": 8617, "user_id": 3477950, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mC5xL.jpg?s=128&g=1", "display_name": "The Paramagnetic Croissant", "link": "https://stackoverflow.com/users/3477950/the-paramagnetic-croissant"}, "edited": false, "score": 0, "creation_date": 1421528355, "post_id": 28003711, "comment_id": 44397018, "body": "@laker001 I also added an answer with a complete, compilable example."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1421526001, "creation_date": 1421526001, "answer_id": 28003905, "question_id": 28003711, "link": "https://stackoverflow.com/questions/28003711/trouble-understanding-folds-in-haskell/28003905#28003905", "title": "Trouble understanding folds in Haskell", "body": "<p>First of all, lets think of the type of <code>applyAll</code>:</p>\n\n<pre><code>applyAll :: Num a =&gt; [(a -&gt; a)] -&gt; a -&gt; a\n</code></pre>\n\n<p>In the process you create a single value from a list. This is called <em>folding</em> (or a <em>fold</em>). Your example suggests that <code>applyAll</code> should start from the right, since the result is</p>\n\n<pre><code>24 = 3 * (1 + (5 + (2)))\n</code></pre>\n\n<p>Therefore, it is a <em>right fold</em>. There are two functions in <code>Prelude</code> (and some variants) which fold a list: <code>foldl</code> and <code>foldr</code>. The suffix indicate whether it is a left or right fold. As discussed above, you want a right fold. Lets have a look on <code>foldr</code>'s type:</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\n</code></pre>\n\n<p>The documentation indicates that <code>(a -&gt; b -&gt; b)</code> is the folding function, taking a value from the list (of type <code>a</code>) and an accumulator (of type <code>b</code>). Then follows the initial value, and last, the list.</p>\n\n<p>A first prototype for <code>applyAll</code> is therefore</p>\n\n<pre><code>applyAll fns init = foldr ?? init fns\n</code></pre>\n\n<p>At this point we're only using the types. We know that <code>applyAll</code> takes a list as first argument, and a value as a second one. We know that <code>foldr</code> takes some kind of function, a value, and a list. So this first draft <em>just fits</em> our purpose. </p>\n\n<p>We're now almost there! What's missing is the correct folding function. Remember, we're looking for something that takes a value from the list, and an accumulator. However, in our case, the list has values of type <code>(a -&gt; a)</code>, and the accumulator is <code>a</code>. So our function should have type</p>\n\n<pre><code>?? :: (a -&gt; a) -&gt; a -&gt; a\n</code></pre>\n\n<p>Luckily, that function is actually tremendously easy, well known, and probably often used by you. Think about it: the function should take another function, a value, and return a value. That sounds like a simple function application, and indeed <code>($)</code> is the function your looking for.</p>\n\n<p>Putting all those things together to create <code>applyAll</code> is left to you as an exercise, but at this point, there isn't much left to do.</p>\n"}, {"tags": [], "owner": {"reputation": 8617, "user_id": 3477950, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mC5xL.jpg?s=128&g=1", "display_name": "The Paramagnetic Croissant", "link": "https://stackoverflow.com/users/3477950/the-paramagnetic-croissant"}, "is_accepted": false, "score": 2, "last_activity_date": 1421529407, "last_edit_date": 1421529407, "creation_date": 1421528311, "answer_id": 28004240, "question_id": 28003711, "link": "https://stackoverflow.com/questions/28003711/trouble-understanding-folds-in-haskell/28004240#28004240", "title": "Trouble understanding folds in Haskell", "body": "<p>As I mentioned in my comment: <code>fold</code> (or, as it's more commonly known, <code>reduce</code>) is a higher-order function that applies a two-argument transformation to each element of the list, the other argument being the return value of the previous transformation; hence \"chaining\" the transformation over all the elements of the list.</p>\n\n<p>Using this logic, you can intuitively deduce that if you have a list of functions, your transform has to return another function. But what kind of function should it return? It turns out the transform can be the function composition operation itself.</p>\n\n<p>Example (probably not very idiomatic, as I'm explicitly avoiding point-free notation - it may or may not help you understand the code more easily):</p>\n\n<pre><code>-- composes a list of functions, the last element in the list being the innermost\napplyAll :: [Int -&gt; Int] -&gt; (Int -&gt; Int)\napplyAll fs = foldr (.) id fs\n\n-- usage:\nmain :: IO ()\nmain = print $ applyAll [(*3), (+1), \\x-&gt;x+5] 2\n</code></pre>\n"}], "owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 28003905, "answer_count": 2, "score": -1, "last_activity_date": 1421529407, "creation_date": 1421524866, "question_id": 28003711, "link": "https://stackoverflow.com/questions/28003711/trouble-understanding-folds-in-haskell", "title": "Trouble understanding folds in Haskell", "body": "<p>i want to have a function that takes a list and a number, and applies all functions in that list to the number.\nFor example:    </p>\n\n<pre><code>applyAll [(*3),(+1),\\x-&gt;x+5] 2\n</code></pre>\n\n<p>would result in the number 24.</p>\n\n<p>My problem is that i have to do it with fold, and i don't understand it quite well yet. LearnYouaHaskell helped a little, but i'm still pretty confused.</p>\n\n<p>Any help on how to do this ?</p>\n"}, {"tags": ["haskell", "function-composition"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1421524638, "creation_date": 1421524638, "answer_id": 28003673, "question_id": 28003618, "link": "https://stackoverflow.com/questions/28003618/beginning-haskell-composing-function-with-data-constructor-and-io-monad/28003673#28003673", "title": "Beginning Haskell - composing function with data constructor and IO monad", "body": "<p>You just need an extra dot:</p>\n\n<pre><code>return . transformContent . TaggedContent (id, attrs) =&lt;&lt; readFile f\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1421525488, "creation_date": 1421525488, "answer_id": 28003812, "question_id": 28003618, "link": "https://stackoverflow.com/questions/28003618/beginning-haskell-composing-function-with-data-constructor-and-io-monad/28003812#28003812", "title": "Beginning Haskell - composing function with data constructor and IO monad", "body": "<p>Daniel Wagner explained how to perform a minimal modification to get your code to compile. I will comment on a few common alternatives.</p>\n\n<p>Code such as</p>\n\n<pre><code>return . g =&lt;&lt; someIOAction\n</code></pre>\n\n<p>is often also written as</p>\n\n<pre><code>fmap g someIOAction\n</code></pre>\n\n<p>or</p>\n\n<pre><code>g `fmap` someIOAction\n</code></pre>\n\n<p>or, after importing <code>Control.Applicative</code></p>\n\n<pre><code>g &lt;$&gt; someIOAction\n</code></pre>\n\n<p>In your specific case, you could use:</p>\n\n<pre><code>transformContent . TaggedContent (id, attrs) &lt;$&gt; readFile f\n</code></pre>\n"}], "owner": {"reputation": 1242, "user_id": 978677, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d0d717a9e4aa531242bfc75804a9992f?s=128&d=identicon&r=PG", "display_name": "cm007", "link": "https://stackoverflow.com/users/978677/cm007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 28003673, "answer_count": 2, "score": 1, "last_activity_date": 1421525488, "creation_date": 1421524280, "question_id": 28003618, "link": "https://stackoverflow.com/questions/28003618/beginning-haskell-composing-function-with-data-constructor-and-io-monad", "title": "Beginning Haskell - composing function with data constructor and IO monad", "body": "<p>I have the following:</p>\n\n<pre><code>import Data.List\n\ndata Content\n  = TaggedContent (String, [String]) String\n  | Null\n\nprocessContent :: Content -&gt; IO Content\nprocessContent c@(TaggedContent (id, attrs) text) =\n  case stripPrefix \"include=\" a of\n       Just f     -&gt; return . TaggedContent (id, attrs) =&lt;&lt; readFile f\n       Nothing    -&gt; return c\n  where a = head(attrs)\nprocessContent x = return x\n\ntransformContent :: Content -&gt; Content\ntransformContent x = x -- (details of implementation not necessary)\n</code></pre>\n\n<p>I would like to compose  <code>transformContent</code> with the <code>TaggedContent</code> constructor; that is, something like</p>\n\n<pre><code>       Just f     -&gt; return . transformContent TaggedContent (id, attrs) =&lt;&lt; readFile f\n</code></pre>\n\n<p>However, this will not compile.</p>\n\n<p>I am new to Haskell and am trying to understand the correct syntax.</p>\n"}, {"tags": ["haskell", "typeclass", "applicative"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 3, "creation_date": 1421521853, "post_id": 28003135, "comment_id": 44395153, "body": "What type are you trying to lift it <i>to</i>? I see <code>&lt;*&gt;</code> in the code, but I don&#39;t see any mention of <code>Applicative</code> in the type signatures... Either way, I suspect the <code>Lift a</code> instance is going to be a problem, since it overlaps with every other possible instance (including <code>Lift (a -&gt; r)</code>)."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1421521954, "post_id": 28003135, "comment_id": 44395189, "body": "Nevermind my code, I have tried a ton of things (most probably nonsense), just posted some random snapshot for the sake of it. I&#39;m really confused with this concept, because, for example, <code>lift (pure (+)) (Just 1) (Just 2)</code> - here, <code>(pure (+))</code> has a different type than <code>Just 1</code>, but the structure provided is hardcoded for a single type <code>Integer</code>... I also need a way to encode an instance for &quot;any type that is not a function&quot;, as sort of a termination condition for the type unrolling."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1576541971, "post_id": 28003135, "comment_id": 104925827, "body": "Wrote a <a href=\"https://github.com/effectfully/sketches/tree/master/avoid-overlapping-recursive\" rel=\"nofollow noreferrer\">blog post</a> on the topic."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1421526942, "post_id": 28003729, "comment_id": 44396650, "body": "Oh my, that is purely awesome. No wonder I was so lost, I don&#39;t have half of the knowledge required to implement that. Is there a book with in-depth explanations of those complexities of the type system, or you learned it by experience? Thank you! Edit: I guess you need &quot;TypeFamilies&quot; and &quot;FlexibleInstances&quot; too..."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1421530018, "post_id": 28003729, "comment_id": 44397486, "body": "I always forget those extensions exist because I have them always turned on. I&#39;ll include that. The details of the GHC type system extensions are found mainly in the <a href=\"https://downloads.haskell.org/~ghc/7.8.3/docs/html/users_guide/\" rel=\"nofollow noreferrer\">user guide</a>. It is not very in-depth, however, and sometimes cryptic, but useful for understanding what each extensions does, not so much how to use it. Most of the really gritty type-hackery and tricks I know I&#39;ve learned experience, and <a href=\"http://okmij.org/ftp/\" rel=\"nofollow noreferrer\">Oleg</a>."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1421570529, "post_id": 28003729, "comment_id": 44404808, "body": "Why the <code>TypeFamilies</code> extension? I don&#39;t see where you are using them... it&#39;s probably possible to use type families <i>instead</i> of functional dependency, but I don&#39;t see why both would be required...  A, wait. you need that for the type constraints?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1421601977, "post_id": 28003729, "comment_id": 44412394, "body": "@Bakuriu Yes, you need either <code>GADTs</code> or <code>TypeFamilies</code> to use the type equality constraint <code>~</code>."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 20, "last_activity_date": 1460415515, "last_edit_date": 1460415515, "creation_date": 1421524938, "answer_id": 28003729, "question_id": 28003135, "link": "https://stackoverflow.com/questions/28003135/is-it-possible-to-encode-a-generic-lift-function-in-haskell/28003729#28003729", "title": "Is it possible to encode a generic &quot;lift&quot; function in Haskell?", "body": "<p>Notice that you can chain any number of <code>&lt;*&gt;</code>, to get a function of the form</p>\n\n<pre><code>f (a0 -&gt; .. -&gt; an) -&gt; (f a0 -&gt; .. -&gt; f an)\n</code></pre>\n\n<p>If we have the type <code>a0 -&gt; .. -&gt; an</code> and <code>f a0 -&gt; .. -&gt; f an</code>, we can compute <code>f</code> from this. We can encode this relation, and the most general type, as follows</p>\n\n<pre><code>class Lift a f b | a b -&gt; f where \n  lift' :: f a -&gt; b \n</code></pre>\n\n<p>As you may expect, the \"recursive case\" instance will simply apply <code>&lt;*&gt;</code> once, then recurse:</p>\n\n<pre><code>instance (a ~ a', f' ~ f, Lift as f rs, Applicative f) \n      =&gt; Lift (a -&gt; as) f (f' a' -&gt; rs) where  \n  lift' f a = lift' $ f &lt;*&gt; a\n</code></pre>\n\n<p>The base case is when there is no more function. Since you can't actually assert \"<code>a</code> is not a function type\", this relies on overlapping instances:</p>\n\n<pre><code>instance (f a ~ b) =&gt; Lift a f b where \n  lift' = id \n</code></pre>\n\n<p>Because of GHCs instance selection rules, the recursive case will always be selected, if possible. </p>\n\n<p>Then the function you want is <code>lift' . pure</code> :</p>\n\n<pre><code>lift :: (Lift a f b, Applicative f) =&gt; a -&gt; b\nlift x = lift' (pure x) \n</code></pre>\n\n<p>This is where the functional dependency on <code>Lift</code> becomes very important. Since <code>f</code> is mentioned only in the context, this function would be ill-typed unless we can determine what <code>f</code> is knowing only <code>a</code> and <code>b</code> (which do appear in the right hand side of <code>=&gt;</code>). </p>\n\n<p>This requires several extensions:</p>\n\n<pre><code>{-# LANGUAGE \n    OverlappingInstances\n  , MultiParamTypeClasses\n  , UndecidableInstances\n  , FunctionalDependencies\n  , ScopedTypeVariables\n  , TypeFamilies\n  , FlexibleInstances\n  #-}\n</code></pre>\n\n<p>and, as usual with variadic functions in Haskell, normally the only way to select an instance is to give an explicit type signature.</p>\n\n<pre><code>lift (\\x y z -&gt; x * y + z) readLn readLn readLn :: IO Int\n</code></pre>\n\n<p>The way I have written it, GHC will happily accept <code>lift</code> which is polymorphic in the arguments to <code>f</code> (but not <code>f</code> itself).</p>\n\n<pre><code>lift (+) [1..5] [3..5] :: (Enum a, Num a) =&gt; [a]\n</code></pre>\n\n<p>Sometimes the context is sufficient to infer the correct type. Note that the argument type is again polymorphic.</p>\n\n<pre><code>main = lift (\\x y z -&gt; x * y + z) readLn readLn readLn &gt;&gt;= print \n</code></pre>\n\n<hr>\n\n<p>As of GHC >= 7.10, <code>OverlappingInstances</code> has been deprecated and the compiler will issue a warning. It will likely be removed in some later version. This can be fixed by removing <code>OverlappingInstances</code> from the <code>{-# LANGUAGE .. #-}</code> pragma and changing the 2nd instance to </p>\n\n<pre><code>instance {-# OVERLAPS #-} (f a ~ b) =&gt; Lift a f b where \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1421595406, "post_id": 28004372, "comment_id": 44410255, "body": "That is a great answer, perhaps even more complete than the first one. I wasn&#39;t expecting two answers to something I consider quite complex. Thank you!"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 7, "last_activity_date": 1421530481, "last_edit_date": 1421530481, "creation_date": 1421529127, "answer_id": 28004372, "question_id": 28003135, "link": "https://stackoverflow.com/questions/28003135/is-it-possible-to-encode-a-generic-lift-function-in-haskell/28004372#28004372", "title": "Is it possible to encode a generic &quot;lift&quot; function in Haskell?", "body": "<p>I assume you would prefer to use <code>lift</code> without type annotations. In this case there are basically two options:</p>\n\n<p><strong>First</strong>, if we use <code>OverlappingInstances</code>, polymorphic functions need annotations:</p>\n\n<pre><code>{-# LANGUAGE\n  OverlappingInstances,\n  MultiParamTypeClasses,\n  UndecidableInstances,\n  FunctionalDependencies,\n  FlexibleInstances,\n  TypeFamilies\n  #-}\n\nimport Control.Applicative\n\nclass Applicative f =&gt; ApN f a b | a b -&gt; f where\n  apN :: f a -&gt; b\n\ninstance (Applicative f, b ~ f a) =&gt; ApN f a b where\n  apN = id\n\ninstance (Applicative f, ApN f a' b', b ~ (f a -&gt; b')) =&gt; ApN f (a -&gt; a') b where\n  apN f fa = apN (f &lt;*&gt; fa)\n\nlift :: ApN f a b =&gt; a -&gt; b\nlift a = apN (pure a)\n\n-- Now we can't write \"lift (+) (Just 0) Nothing\"\n-- We must annotate as follows: \n--   lift ((+) :: Int -&gt; Int -&gt; Int) (Just 0) Nothing\n-- Monomorphic functions work fine though:\n--   lift (||) (Just True) (Just True) --&gt; results in \"Just True\"\n</code></pre>\n\n<p><strong>Second</strong>, if we instead use <code>IncoherentInstances</code>, <code>lift</code> will work without annotations even on polymorphic functions. However, some complicated stuff still won't check out, for example <code>(lift . lift) (+) (Just (Just 0)) Nothing</code>.  </p>\n\n<pre><code>{-# LANGUAGE \n  IncoherentInstances, MultiParamTypeClasses,\n  UndecidableInstances,ScopedTypeVariables,\n  AllowAmbiguousTypes, FlexibleInstances, TypeFamilies\n  #-}\n\nimport Control.Applicative\n\nclass Applicative f =&gt; ApN f a b where\n  apN :: f a -&gt; b\n\ninstance (Applicative f, b ~ f a) =&gt; ApN f a b where\n  apN = id\n\ninstance (Applicative f, ApN f a' b', b ~ (f a -&gt; b')) =&gt; ApN f (a -&gt; a') b where\n  apN f fa = apN (f &lt;*&gt; fa)\n\nlift :: forall f a b. ApN f a b =&gt; a -&gt; b\nlift a = (apN :: f a -&gt; b) (pure a)\n\n-- now \"lift (+) (Just 0) (Just 10)\" works out of the box\n</code></pre>\n\n<p>I presented two solutions instead of just the one with <code>IncoherentInstances</code> because <code>IncoherentInstances</code> is a rather crude extension that should be avoided if possible. It's probably fine here, but I thought it worthwhile to provide an alternative solution, anyway.</p>\n\n<hr>\n\n<p>In both cases I use the same trick to help inference and reduce annotations: I try to move information from the instance heads to the instance constraints. So instead of</p>\n\n<pre><code>instance (Applicative f) =&gt; ApN f a (f a) where\n  apN = id\n</code></pre>\n\n<p>I write</p>\n\n<pre><code>instance (Applicative f, b ~ f a) =&gt; ApN f a b where\n  apN = id\n</code></pre>\n\n<p>Also, in the other instance I use a plain <code>b</code> parameter in the instance head and add <code>b ~ (f a ~ b')</code> to the constraints.</p>\n\n<p>The reason for doing this is that GHC first checks if there is a matching instance head, and it tries to resolve the constraints only after there is a successful match. We want to place the least amount of burden on the instance head, and let the constraint solver sort things out (because it's more flexible, can delay making judgements and can use constraints from other parts of the program). </p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 716, "favorite_count": 7, "accepted_answer_id": 28003729, "answer_count": 2, "score": 12, "last_activity_date": 1460415515, "creation_date": 1421521284, "last_edit_date": 1495541761, "question_id": 28003135, "link": "https://stackoverflow.com/questions/28003135/is-it-possible-to-encode-a-generic-lift-function-in-haskell", "title": "Is it possible to encode a generic &quot;lift&quot; function in Haskell?", "body": "<p>I'm not the biggest fan of varargs, but I always thought both the applicative (<code>f &lt;$&gt; x &lt;*&gt; y</code>) and idiom (<code>[i| f x y |]</code>) styles have too many symbols. I usually prefer going the <code>liftA2 f x y</code> way, but I, too, think that A2 is a little ugly. From <a href=\"https://stackoverflow.com/questions/3467279/how-to-create-a-polyvariadic-haskell-function\">this question</a>, I've learned it is possible to implement vararg functions in Haskell. This way, is it possible to use the same principle in order implement a lift function, such that:</p>\n\n<pre><code>lift f a b == pure f &lt;*&gt; a &lt;*&gt; b\n</code></pre>\n\n<p>I've tried replacing the <code>+</code> by <code>&lt;*&gt;</code> on the quoted code:</p>\n\n<pre><code>class Lift r where \n    lift :: a -&gt; r\n\ninstance Lift a where\n    lift = id\n\ninstance (Lift r) =&gt; Lift (a -&gt; r) where\n    lift x y = lift (x &lt;*&gt; y)\n</code></pre>\n\n<p>But I couldn't manage to get the types right...</p>\n"}, {"tags": ["haskell", "types", "type-inference"], "owner": {"reputation": 21, "user_id": 4465278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57a68d498a0c0e3f58ca11a1ef4f2bfc?s=128&d=identicon&r=PG&f=1", "display_name": "OrangeSanFran", "link": "https://stackoverflow.com/users/4465278/orangesanfran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 106, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1421516574, "creation_date": 1421516574, "question_id": 28002320, "link": "https://stackoverflow.com/questions/28002320/typing-haskell-in-haskell-get-all-assumps", "title": "Typing Haskell in Haskell: Get all Assumps", "body": "<p>I've been following along <a href=\"http://web.cecs.pdx.edu/~mpj/thih/TypingHaskellInHaskell.html\" rel=\"nofollow\">http://web.cecs.pdx.edu/~mpj/thih/TypingHaskellInHaskell.html</a> and it has worked out great so far. The only problem is how to get all the computed <code>Assump</code>-Values out of the type-inferencer/type-checker (I've renamed all binds to be globally unique) because the final function</p>\n\n<pre><code>tiProgram :: ClassEnv -&gt; [Assump] -&gt; Program -&gt; [Assump]\n</code></pre>\n\n<p>only returns <code>Assump</code>s for the top level <code>BindGroup</code>s. I've tried to change the Let-Binding Expression inference (branch in <code>tiExpr</code>) to something like</p>\n\n<pre><code>do (ps, as') &lt;- tiBindGroup ce as bg\n   (qs, t) &lt;- tiExpr ce (as' ++ as) localExpr\n   s &lt;- gets t_subst\n   rs &lt;- reduce ce (apply s ps')\n   s' &lt;- defaultSubst ce [] rs\n   let assumps = apply (s'@@s) as'\n   storeAssumps assumps\n   return (ps', t)\n</code></pre>\n\n<p>but this will not work for obvious reasons (unresolvable ambiguities). </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1421516047, "post_id": 28002150, "comment_id": 44393402, "body": "Hint: which clause can return <code>True</code>?"}, {"owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1421516108, "post_id": 28002150, "comment_id": 44393407, "body": "@DanielWagner the whole ideia is, if it checks out til the end, ir returns true."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1421516137, "post_id": 28002150, "comment_id": 44393419, "body": "I understand the <i>idea</i>, of course. I&#39;m asking, <i>which of the clauses that you wrote</i> can return <code>True</code>?"}, {"owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1421516191, "post_id": 28002150, "comment_id": 44393439, "body": "The clause where i make the comparison, it returns true if it checks, false if it does not @DanielWagner"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1421516422, "post_id": 28002150, "comment_id": 44393507, "body": "Okay. That may be a misunderstanding of how guards work, then, and will guide my answer. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "edited": false, "score": 0, "creation_date": 1421518019, "post_id": 28002357, "comment_id": 44393996, "body": "Please check my update. It compiles now, but still does not work properly"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "edited": false, "score": 0, "creation_date": 1421518200, "post_id": 28002357, "comment_id": 44394052, "body": "@laker001 When the details of a question changes, the usual etiquette here is to open a separate question. But my answer is the same hint: which clause can return <code>True</code>? (My answer: none of them! Why?)"}, {"owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "edited": false, "score": 0, "creation_date": 1421518373, "post_id": 28002357, "comment_id": 44394101, "body": "in this case, the <code>sufix (x:xs) (y:ys) = x == y &amp;&amp; sufix xs ys</code> expression should return <code>True</code>or <code>False</code>, since it is a <code>AND</code> operation, am i right ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "edited": false, "score": 1, "creation_date": 1421518628, "post_id": 28002357, "comment_id": 44394167, "body": "@laker001 For it to return <code>True</code>, you must find both that <code>x == y</code> and that <code>sufix xs ys</code> -- and the latter can&#39;t return <code>True</code> in the first place. So you&#39;ll have to look harder to find a place that returns <code>True</code>!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1421516742, "creation_date": 1421516742, "answer_id": 28002357, "question_id": 28002150, "link": "https://stackoverflow.com/questions/28002150/having-trouble-with-issuffix-function-in-haskell/28002357#28002357", "title": "having trouble with isSuffix function in Haskell", "body": "<p>There's a few problems here. The first is that there seems to be a misunderstanding of how guards work. From your comments, it sounds like you believe that</p>\n\n<pre><code>f | p1 = p2\n</code></pre>\n\n<p>will return <code>p1</code> in some cases, but this is not true: <code>p1</code> is only used to decide whether to return <code>p2</code> or continue on to a next clause. One possible fix for this is to change your guard line like this:</p>\n\n<pre><code>sufix (x:xs) (y:ys) = x == y &amp;&amp; sufix xs ys\n</code></pre>\n\n<p>A second problem is that your patterns for <code>sufix</code> are not complete: they do not handle the case where one list is longer than the other. You can turn on <code>-fwarn-incomplete-patterns</code> and see what I mean:</p>\n\n<pre><code>test.hs:5:11: Warning:\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018sufix\u2019:\n        Patterns not matched:\n            [] (_ : _)\n            (_ : _) []\n</code></pre>\n\n<p>When you work out what answers to put for these patterns, I think you will see what I was aiming at with my hint about when you return <code>True</code>!</p>\n"}], "owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1421517995, "creation_date": 1421515517, "last_edit_date": 1421517995, "question_id": 28002150, "link": "https://stackoverflow.com/questions/28002150/having-trouble-with-issuffix-function-in-haskell", "title": "having trouble with isSuffix function in Haskell", "body": "<p>i want to check if a list is a suffix of the other. \nI'm struggling with this, for a while know.</p>\n\n<p>Here's my code:</p>\n\n<pre><code>isSuffix :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\nisSuffix [] _ = False\nisSuffix _ [] = False\nisSuffix xs ys = sufix (take (length ys) (reverse xs)) (reverse ys)\n    where sufix [] [] = False\n          sufix (x:xs) (y:ys) \n              | (x == y)  = sufix xs ys\n</code></pre>\n\n<p>This doesn't work, and i can't find the error.</p>\n\n<p>UPDATE:</p>\n\n<pre><code>isSuffix :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\nisSuffix [] _ = False\nisSuffix _ [] = False\nisSuffix xs ys = sufix (take (length ys) (reverse xs)) (reverse ys)\n   where sufix [] [] = False\n      sufix [] _ = False\n      sufix _ [] = False\n      sufix (x:xs) (y:ys) = x == y &amp;&amp; sufix xs ys\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 3, "creation_date": 1421516755, "post_id": 28002272, "comment_id": 44393600, "body": "I&#39;ve only ever seen this written infix as <code>a ~ ()</code> and imagine the prefix version would be <code>(~) a ()</code>. How does the kind <code>*</code> come into it? It isn&#39;t mentioned in the documentation for <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/equality-constraints.html\" rel=\"nofollow noreferrer\">equality constraints</a>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 5, "creation_date": 1421516897, "post_id": 28002272, "comment_id": 44393653, "body": "@Cirdec Yes, it is unfortunate, but GHC does not expose user-level syntax for kind-specific <code>~</code>. However, in its internal language, <code>~</code> takes a kind argument (and therefore when used needs to be applied to a kind). These kinds are inserted by kind inference, similarly to how Haskell&#39;s implicit <code>forall</code>s are converted into type-polymorphism and type application implicitly by type inference. GHC knows enough about this to strip the implicit kinds during printing, but haddock doesn&#39;t do the stripping."}, {"owner": {"reputation": 1053, "user_id": 865234, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/7a85169a8c33472f88086f3aec210b8e?s=128&d=identicon&r=PG", "display_name": "Dmitry Polyanitsa", "link": "https://stackoverflow.com/users/865234/dmitry-polyanitsa"}, "edited": false, "score": 1, "creation_date": 1421517063, "post_id": 28002272, "comment_id": 44393698, "body": "This fully answers my question, thanks! I&#39;ve also seen it only as <code>a ~ ()</code> and couldn&#39;t even imagine that <code>~</code> takes a kind argument."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1421518205, "post_id": 28002272, "comment_id": 44394054, "body": "Interesting. I was mentally parsing it as <code>Monad m, f (~) (a ())</code> except that <code>f</code> was named <code>*</code> and used infix, and was wondering what on earth would require such a context... :-)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1421516324, "creation_date": 1421516324, "answer_id": 28002272, "question_id": 28002078, "link": "https://stackoverflow.com/questions/28002078/what-does-this-context-mean-monad-m-a/28002272#28002272", "title": "What does this context mean: (Monad m, (~) * a ())?", "body": "<p><code>(~)</code> is type-level equality (you could write it as some variant of <code>=</code> or <code>==</code>, but the opinion was that this notation already had enough different meanings that introducing another would be confusing). <code>*</code> is the kind of types. So <code>(~) *</code> is the assertion that two (inhabitable) types are equal. In other words, the instance could also be written like this:</p>\n\n<pre><code>instance Monad m =&gt; LaTeXC (LaTeXT m ())\n</code></pre>\n\n<p>Why wasn't it? Well, it's a question of inference. The way it was written makes the compiler choose this instance even if it doesn't (yet) know that the final argument to <code>LaTeXT</code> is <code>()</code>, then forces that, whereas the proposed alternative instance would simply complain.</p>\n"}], "owner": {"reputation": 1053, "user_id": 865234, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/7a85169a8c33472f88086f3aec210b8e?s=128&d=identicon&r=PG", "display_name": "Dmitry Polyanitsa", "link": "https://stackoverflow.com/users/865234/dmitry-polyanitsa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 28002272, "answer_count": 1, "score": 5, "last_activity_date": 1421516324, "creation_date": 1421515086, "question_id": 28002078, "link": "https://stackoverflow.com/questions/28002078/what-does-this-context-mean-monad-m-a", "title": "What does this context mean: (Monad m, (~) * a ())?", "body": "<p>I've found the following class instance : <code>(Monad m, (~) * a ()) =&gt; LaTeXC (LaTeXT m a)</code>, but can't quite understand its context.</p>\n\n<p>What does <code>(~) * a ()</code> mean? Where can I read about it?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 447, "user_id": 82695, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d470766bdf88f0c5aac3e2f34fca44e8?s=128&d=identicon&r=PG", "display_name": "Real John Connor", "link": "https://stackoverflow.com/users/82695/real-john-connor"}, "edited": false, "score": 0, "creation_date": 1421519636, "post_id": 28001877, "comment_id": 44394482, "body": "Thanks.  I updated my question with an OO version of what I want to accomplish.  The motivating example is a MetricSpace typeclass which defines a function which (is supposed) to return the underlying space (an instance of the Space typeclass.)  The question I posted was the best minimal example of the problem I could think up."}], "tags": [], "owner": {"reputation": 361, "user_id": 4011383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc91cbebfef922ecd15477c3a96d8f8f?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Seweryn", "link": "https://stackoverflow.com/users/4011383/michal-seweryn"}, "is_accepted": false, "score": 6, "last_activity_date": 1421515503, "last_edit_date": 1421515503, "creation_date": 1421513746, "answer_id": 28001877, "question_id": 28001590, "link": "https://stackoverflow.com/questions/28001590/how-can-i-prove-to-ghc-that-b-foo/28001877#28001877", "title": "How can I prove to GHC that (b ~ Foo)?", "body": "<p>This type signature:</p>\n\n<pre><code>class Buz a where\n  punk :: Fiz b =&gt; a -&gt; b\n</code></pre>\n\n<p>says that <code>punk</code> must be able to return something of type <code>b</code> for any type <code>b</code> given it is instance of <code>Fiz</code>. So the problem is not that compiler cannot deduce that <code>Foo</code> is instance of <code>Fiz</code>, but that the return value is not <code>Quux</code>, which is an instance of <code>Fiz</code>.</p>\n\n<pre><code>data Quux = Quux \n\ninstance Fiz Quux where\n  funk a = a\n</code></pre>\n\n<p>If you want to have type class with function returning any instance of <code>Fiz</code>, you can use ExistentionalQuantification extension:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, ExistentialQuantification #-}   \ndata Foo = Foo Int\ndata Bar = Bar Foo\ndata SomeFiz = forall a . Fiz a =&gt; SomeFiz a\nclass Fiz a where\n  funk :: a -&gt; a\n\nclass Buz a where\n  punk :: a -&gt; SomeFiz\n\ninstance Fiz Foo where\n  funk a = a\n\ninstance Buz Bar where\n  punk (Bar foo) = SomeFiz foo\n</code></pre>\n\n<p>Otherwise if you really mean to implement this typeclass, you can only do this by passing bottoms to <code>funk</code>:</p>\n\n<pre><code>instance Buz Bar where\n  punk _ = funk undefined\n-- or for example:\ninstance Buz Bar where\n  punk _ = funk (funk undefined)\n</code></pre>\n\n<p>or by fixing funk:</p>\n\n<pre><code>instance Buz Bar where\n  punk _ = fix funk\n</code></pre>\n\n<p>If you could give more details on what you want to achieve, maybe I'll be able to give more helpful answer.</p>\n"}, {"comments": [{"owner": {"reputation": 447, "user_id": 82695, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d470766bdf88f0c5aac3e2f34fca44e8?s=128&d=identicon&r=PG", "display_name": "Real John Connor", "link": "https://stackoverflow.com/users/82695/real-john-connor"}, "edited": false, "score": 0, "creation_date": 1421514822, "post_id": 28001913, "comment_id": 44393064, "body": "I still don&#39;t get it.  <code>punk</code> is defined in <code>Buz</code> to return <i>some</i> instance of <code>Fiz</code>.  <code>foo</code> is of type <code>Foo</code> which is an instance <code>Fiz</code>.  You cannot construct a <code>Bar</code> such that given <code>(Bar something)</code>, <code>something</code> is not a <code>Foo</code>...  I get that there can be other instances of <code>Buz</code> out there, but this <code>punk</code> is being defined for <code>Bar</code> only..."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 447, "user_id": 82695, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d470766bdf88f0c5aac3e2f34fca44e8?s=128&d=identicon&r=PG", "display_name": "Real John Connor", "link": "https://stackoverflow.com/users/82695/real-john-connor"}, "edited": false, "score": 2, "creation_date": 1421515167, "post_id": 28001913, "comment_id": 44393160, "body": "<code>punk</code> is define in <code>Buz</code> to return a value for <i>every</i> type that is an instance of <code>Fiz</code>."}, {"owner": {"reputation": 447, "user_id": 82695, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d470766bdf88f0c5aac3e2f34fca44e8?s=128&d=identicon&r=PG", "display_name": "Real John Connor", "link": "https://stackoverflow.com/users/82695/real-john-connor"}, "edited": false, "score": 0, "creation_date": 1421519452, "post_id": 28001913, "comment_id": 44394420, "body": "Thank you.  I think that I am beginning to see where my mental model of haskell starts to deviate from reality.  I have updated my question, can you please take another look?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 447, "user_id": 82695, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d470766bdf88f0c5aac3e2f34fca44e8?s=128&d=identicon&r=PG", "display_name": "Real John Connor", "link": "https://stackoverflow.com/users/82695/real-john-connor"}, "edited": false, "score": 1, "creation_date": 1421522406, "post_id": 28001913, "comment_id": 44395332, "body": "@RealJohnConnor Your <b>new</b> question should probably be a <b>new</b> separate question. It&#39;s ok to learn things from one question, be done with it, and ask another question; it&#39;s more valuable for other people who might encounter the same problems if each problem is a separate question."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 447, "user_id": 82695, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d470766bdf88f0c5aac3e2f34fca44e8?s=128&d=identicon&r=PG", "display_name": "Real John Connor", "link": "https://stackoverflow.com/users/82695/real-john-connor"}, "edited": false, "score": 1, "creation_date": 1421522586, "post_id": 28001913, "comment_id": 44395386, "body": "@RealJohnConnor I would not be surprised if a follow up question has been asked and answered multiple times. A quick search knowing that people coming from OO generally stray into existential types finds <a href=\"http://stackoverflow.com/questions/19061828/existential-antipattern-how-to-avoid\">this question</a> and <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">this article</a>. If reading those doesn&#39;t provide the insight you need, ask a new question specifically about the problem you have with metric spaces."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 4, "last_activity_date": 1421513967, "creation_date": 1421513967, "answer_id": 28001913, "question_id": 28001590, "link": "https://stackoverflow.com/questions/28001590/how-can-i-prove-to-ghc-that-b-foo/28001913#28001913", "title": "How can I prove to GHC that (b ~ Foo)?", "body": "<p>You can't.</p>\n\n<p>The class <code>Buz</code> says that if <code>a</code> has an instance for <code>Buz</code>, then for <strong>every</strong> <code>b</code> that has a <code>Fiz</code> instance, you can provide a function from <code>a -&gt; b</code>. The class <code>Fiz</code> provides virtually no help in producing a <code>b</code>; <code>funk</code> will only give you a <code>b</code> if you already have a <code>b</code>.</p>\n\n<p>You are probably misunderstanding the error message from GHC. Type inference goes both ways. In this case, <code>b</code> comes from the signature for <code>punk</code> in the class <code>Buz</code>. It <em>requires</em> that the result of <code>punk</code> be something of type <code>b</code> for every type <code>b</code>. <code>Foo</code> is not something of every type.</p>\n\n<pre><code>  \u2018b\u2019 is a rigid type variable bound by\n      the type signature for punk :: Fiz b =&gt; Bar -&gt; b at Test.hs:42:5\n</code></pre>\n"}], "owner": {"reputation": 447, "user_id": 82695, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d470766bdf88f0c5aac3e2f34fca44e8?s=128&d=identicon&r=PG", "display_name": "Real John Connor", "link": "https://stackoverflow.com/users/82695/real-john-connor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1421519261, "creation_date": 1421512046, "last_edit_date": 1592644375, "question_id": 28001590, "link": "https://stackoverflow.com/questions/28001590/how-can-i-prove-to-ghc-that-b-foo", "title": "How can I prove to GHC that (b ~ Foo)?", "body": "<h1>New Question</h1>\n<p>I'm not going to pretend that I know how to think or talk about haskell. In pseudo-java-oo-jargon:</p>\n<p>What I want to do is have a &quot;structure&quot; that &quot;implements&quot; an &quot;interface.&quot;  Part of that interface is a function which returns an object which implements another interface.</p>\n<pre><code>interface IFiz {}\n\ninterface IBuz {\n    function IFiz getFiz() \n}\n\nclass Foo implements IFiz { ... }\nclass Bar implements IBuz {\n    IFiz fiz = new Foo();\n    function getFiz() {\n        return fiz;\n    }\n}\n</code></pre>\n<p>How can I do this in Haskell?  My attempt at doing this is described below.</p>\n<hr />\n<h1>Old Question</h1>\n<p>How can I prove to GHC that (b ~ Foo)?</p>\n<p>My understanding of the problem:</p>\n<p>Foo is an instance of the type class Fiz.</p>\n<p>I would like Bar to be an instance of the type class Buz.</p>\n<p>However, the compiler is unable to deduce that (b ~ Foo) in the implementation of the <code>punk</code> method.  But what else could it be?  I attempted to add data constraints using the deprecated direct way, as well as using GADTs, but neither seemed to work (I continued to get the exact same error.)</p>\n<pre><code>data Foo = Foo Int                                                                                                                                                                                                                           \ndata Bar = Bar Foo                                                                                                                                                                                                                           \n                                                                                                                                                                                                                                           \nclass Fiz a where                                                                                                                                                                                                                            \n    funk :: a -&gt; a -- Not important, I just wanted to put something in Fiz                                                                                                                                                                                                                           \n                                                                                                                                                                                                                                           \nclass Buz a where                                                                                                                                                                                                                            \n    punk :: Fiz b =&gt; a -&gt; b                                                                                                                                                                                                                  \n                                                                                                                                                                                                                                           \ninstance Fiz Foo where                                                                                                                                                                                                                       \n    funk a = a                                                                                                                                                                                                                               \n                                                                                                                                                                                                                                           \ninstance Buz Bar where                                                                                                                                                                                                                       \n   punk (Bar foo) = foo\n</code></pre>\n<hr />\n<pre><code>Could not deduce (b ~ Foo)\nfrom the context (Fiz b)\n  bound by the type signature for punk :: Fiz b =&gt; Bar -&gt; b\n  at Test.hs:42:5-8\n  \u2018b\u2019 is a rigid type variable bound by\n      the type signature for punk :: Fiz b =&gt; Bar -&gt; b at Test.hs:42:5\nRelevant bindings include punk :: Bar -&gt; b (bound at Test.hs:42:5)\nIn the expression: foo\nIn an equation for \u2018punk\u2019: punk (Bar foo) = foo\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "edited": false, "score": 0, "creation_date": 1421510406, "post_id": 28000879, "comment_id": 44391676, "body": "And for more examples: <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"nofollow noreferrer\">learnyouahaskell.com</a>"}], "answers": [{"tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 4, "last_activity_date": 1421510314, "last_edit_date": 1421510314, "creation_date": 1421510013, "answer_id": 28001250, "question_id": 28000879, "link": "https://stackoverflow.com/questions/28000879/type-parameters-in-haskell/28001250#28001250", "title": "type parameters in Haskell", "body": "<p>Type names have to start with a capital letter. So, your definitions actually should look like this, since you are only defining type synonyms:</p>\n\n<pre><code>type Position = Float\ntype GreyScale = Int\n</code></pre>\n\n<p>For <code>Pixel</code>: It looks like you wanted to define a data type, not just a synonym, so you should do something like this:</p>\n\n<pre><code>data Pixel = Pixel Position GreyScale\n</code></pre>\n\n<p>Next: The <code>Eq</code> instance compares two <code>Pixel</code>s, so you have to represent them as such: </p>\n\n<pre><code>instance Eq Pixel where\n    Pixel pos1 greyScale1 == Pixel pos2 greyScale2 = greyScale1 == greyScale2\n</code></pre>\n\n<p><code>greyScale1 == greyScale2</code> just compares the two <code>greyScales</code>, which is what you want. </p>\n\n<p>Also, I would not recommend overwriting <code>Show</code> instances to assure that <code>read . show == id</code> holds. (You can automatically derive specific instances by adding <code>deriving (Instance1, Instance2, ..)</code> after the datatype declaration). Rather than meddling with it I would define separate functions:</p>\n\n<pre><code>showPosition :: Pixel -&gt; String\nshowPosition (Pixel position greyScale) = show position\n</code></pre>\n\n<p>and</p>\n\n<pre><code>showGreyscale :: Pixel -&gt; String\nshowGreyscale (Pixel position greyScale) = show greyScale\n</code></pre>\n"}], "owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1258, "favorite_count": 0, "accepted_answer_id": 28001250, "answer_count": 1, "score": 1, "last_activity_date": 1421510314, "creation_date": 1421507802, "question_id": 28000879, "link": "https://stackoverflow.com/questions/28000879/type-parameters-in-haskell", "title": "type parameters in Haskell", "body": "<p>I want to create a type Pixel, and make it an instance of the Eq and Show class. However, i've been reading information from a lot of places, and got really confused with this.</p>\n\n<p>Here's some info on the type i need to create:</p>\n\n<p>I have to store two numbers (the position of the pixel and a value from 0 to 255).\nTwo pixels are equal if they have the same value, whatever their position is.\nFor the Show instance, i need to print the position and the value.</p>\n\n<p>Here's my attempt at this:</p>\n\n<pre><code>type position = Float\ntype greyScale = Int\ntype Pixel = (position, greyScale)\n\ninstance Eq Pixel where\n    greyScale == greyScale = True\n\ninstance Show Pixel where\n    show position = position\n    show greyScale = greyScale\n</code></pre>\n\n<p>is this a correct way to do it ?</p>\n"}, {"tags": ["bash", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 39446, "user_id": 4301306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a1461d0104809c90e2a252a2d4b0ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Wintermute", "link": "https://stackoverflow.com/users/4301306/wintermute"}, "is_accepted": true, "score": 9, "last_activity_date": 1421502837, "last_edit_date": 1421502837, "creation_date": 1421502399, "answer_id": 28000099, "question_id": 27999995, "link": "https://stackoverflow.com/questions/27999995/trying-to-print-over-line-gets-me-extra-k-somewhere/28000099#28000099", "title": "Trying to print over line, gets me extra &quot;![K&quot; somewhere", "body": "<p>Haskell, unlike all other programming languages I'm aware of (or at least can think of right now), doesn't interpret <code>\\033</code> as an octal literal but a decimal one. This explains why you get <code>!</code>, because <code>!</code> is 33 in ASCII.</p>\n\n<p>The solution is to replace <code>\\033</code> with <code>\\o33</code> (or <code>\\x1b</code> or <code>\\27</code>) in the haskell code. Or, perhaps more prettily, with <code>\\ESC</code>. They all mean the same thing, so pick the one you think is most readable.</p>\n"}], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 28000099, "answer_count": 1, "score": 2, "last_activity_date": 1421502837, "creation_date": 1421501742, "last_edit_date": 1421502320, "question_id": 27999995, "link": "https://stackoverflow.com/questions/27999995/trying-to-print-over-line-gets-me-extra-k-somewhere", "title": "Trying to print over line, gets me extra &quot;![K&quot; somewhere", "body": "<h3>The problem</h3>\n\n<p>I've read that you can use <code>\\033[K</code> to erase to the end of a bash line, and <code>\\r</code> to go back to the beginning of the line. So you can combine them to override a line with another line.</p>\n\n<p>I tried different configurations and in pretty much any arrangement, even.</p>\n\n<pre><code>\\r\\033[K\\rString\\r\n</code></pre>\n\n<p>there's always an extra <code>![K</code> coming from somewhere.</p>\n\n<h3>The actual Haskell script details</h3>\n\n<p>The actual script I'm using right now is:</p>\n\n<pre><code>putStrOver :: String -&gt; IO ()\nputStrOver str = putStr $ \"\\033[K\" ++ str ++ \"\\r\"\n</code></pre>\n\n<p>and used as:</p>\n\n<pre><code>forM [1..n] $ \\i -&gt; do\n    -- calc percentage\n    putStrOver $ \"Generating: \" ++ show perc ++ \"%\"\n</code></pre>\n\n<p>And what it gets me is this:</p>\n\n<p><img src=\"https://i.stack.imgur.com/RoVD4.png\" alt=\"Image showing an extra &quot;![K&quot; is prepended on the printed screen\"></p>\n\n<h3>Trying to isolate the problem</h3>\n\n<p>So there's always this annoying extra <code>![K</code> part that is generated from somewhere. I first thought it could have been some <code>!</code> coming from somewhere else, so I took a bran new GHCi environment and tested just that function with:</p>\n\n<pre><code>mapM_ (\\i -&gt; putStrOver . show $ i) [1..]\n</code></pre>\n\n<p>and it still prints <code>![K</code>:</p>\n\n<p><img src=\"https://i.stack.imgur.com/k7qAY.png\" alt=\"Example of the problem with the GHCi script\"></p>\n\n<p>I'm using the Terminal bash on a Mac OS X Yosemite, if that counts for anything.</p>\n\n<h3>Question</h3>\n\n<p>What is going on? How can I solve this problem?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1421498006, "post_id": 27999464, "comment_id": 44388324, "body": "It&#39;s not obvious what you mean by &quot;write wrong&quot;. There are many ways we can turn a list into a tree (while keeping elements in order). Also, if you want to &quot;go the other way&quot;, you&#39;ll have to write an entirely different function, so I don&#39;t  see why this <code>treeToList</code> is relevant to that."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421498053, "post_id": 27999464, "comment_id": 44388331, "body": "It is not possible to go the other way around: any tree visit (pre-, post-,in-) defines a non-injective map from trees to lists, so information is lost. At bast, you can achieve a pseudo-inverse, i.e. reconstructing one of the many trees which once visited give the input list back."}, {"owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1421498561, "post_id": 27999464, "comment_id": 44388447, "body": "@Andr&#225;sKov&#225;cs so this is a correct way of transforming a tree into a list ?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1421500313, "post_id": 27999464, "comment_id": 44388866, "body": "@laker001 Yes. This is an <a href=\"http://en.wikipedia.org/wiki/Tree_traversal#In-order_.28symmetric.29\" rel=\"nofollow noreferrer\">in order traversal</a> of a tree. It is perfectly valid."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1421515142, "post_id": 27999464, "comment_id": 44393149, "body": "For a given <i>n</i> you have many possible shapes of an <i>n</i>-element binary tree, but just one list. So there is no way how to go back without additional information. See <a href=\"http://stackoverflow.com/q/3042412/1333025\">With &#39; N &#39; no of nodes, how many different Binary and Binary Search Trees possible?</a>."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1421500575, "creation_date": 1421500575, "answer_id": 27999835, "question_id": 27999464, "link": "https://stackoverflow.com/questions/27999464/treetolist-in-haskell-function/27999835#27999835", "title": "TreeToList in Haskell function", "body": "<p>This is a correct way to transform a binary tree of <code>Int</code> into a list by \"in-order\" traversal. This is the most common way to turn a search tree into a list. There are, however, other valid ways to traverse trees which will produce lists in different orders for various purposes, as you can see on <a href=\"https://en.wikipedia.org/wiki/Tree_traversal\" rel=\"nofollow\">Wikipedia</a>. As Andr\u00e1s Kov\u00e1cs and chi have indicated, there is generally no way to go backwards, unless you have specific information about the shape of the tree you wish to construct.</p>\n"}], "owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1421500575, "creation_date": 1421497635, "question_id": 27999464, "link": "https://stackoverflow.com/questions/27999464/treetolist-in-haskell-function", "title": "TreeToList in Haskell function", "body": "<p>I have this function that i wrote to pass from a tree to a list in Haskell:</p>\n\n<pre><code>treeToList :: Tree -&gt; [Int]\ntreeToList (Leaf x) = [x]\ntreeToList (Node left x right) =  treeToList left ++ [x] ++ treeToList right\n</code></pre>\n\n<p>This works just fine, however i have a doubt:</p>\n\n<p>With the input: </p>\n\n<pre><code>treeToList (Node (Leaf 1) 2 (Node (Leaf 3) 4 (Leaf 5)))\n</code></pre>\n\n<p>the function produces this list:</p>\n\n<pre><code>[1,2,3,4,5]\n</code></pre>\n\n<p>which, i think is wrong, because if i want to go the other way around, and write the tree from the list, i'm going to write it wrong. </p>\n\n<p>How can i fix this ?</p>\n"}, {"tags": ["haskell", "state-machine", "transducer"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1421484800, "post_id": 27997155, "comment_id": 44385287, "body": "This question needs editing to be on-topic for StackOverflow. Explicitly asking for a library or resource recommendation is off-topic, but describing a specific problem and soliciting solutions (which may very well involve libraries) is acceptable. Asking the <i>best</i> way to do something is usually too broad or opinion-based. Asking for <i>a</i> way to do something still results in high quality answers, but with less opinionated discussion of their merits."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1421518569, "post_id": 27998555, "comment_id": 44394148, "body": "Fantastic <code>machines</code> tutorial, thanks. I&#39;ve been meaning to try to understand that library for quite some time. I wonder if there is a way to attach this discussion to the official documentation somehow."}, {"owner": {"reputation": 741, "user_id": 2963238, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/28ca5f7c13e9099945f7adbc1ddacea5?s=128&d=identicon&r=PG&f=1", "display_name": "gonzaw", "link": "https://stackoverflow.com/users/2963238/gonzaw"}, "edited": false, "score": 0, "creation_date": 1421519830, "post_id": 27998555, "comment_id": 44394543, "body": "Awesome. With Moore and Mealy machines in the <code>machines</code> library, you can create a machine by unfolding over explicit state using <code>unfoldMoore</code> or <code>unfoldMealy</code>. These functions model the transition functions that define a Moore/Mealy machine, so you can still use them to construct a machine in the traditional way (defining the states, then defining the transition and output function). Is there a similar function that can be created for FSTs (i.e <code>Process</code>)?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 741, "user_id": 2963238, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/28ca5f7c13e9099945f7adbc1ddacea5?s=128&d=identicon&r=PG&f=1", "display_name": "gonzaw", "link": "https://stackoverflow.com/users/2963238/gonzaw"}, "edited": false, "score": 0, "creation_date": 1421521438, "post_id": 27998555, "comment_id": 44395034, "body": "@gonzaw That would make a good follow up question. This question was about how to model finite state machines in Haskell, that question would be about how to specifically <code>unfold</code> a <code>Process</code> using the machines library. The question will be better if you can provide a specific problem, like how to unfold a <code>Process</code> from <code>data State = RepeatNext Word8 | SayAgain Word8 Word8</code> and <code>step (RepeatNext n) = Await (x -&gt; SayAgain n x) Stop; step (SayAgain 0 _) = Await (n -&gt; RepeatNext n) Stop; step (SayAgain n x) = Yield x (SayAgain (n-1) x)</code>"}, {"owner": {"reputation": 741, "user_id": 2963238, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/28ca5f7c13e9099945f7adbc1ddacea5?s=128&d=identicon&r=PG&f=1", "display_name": "gonzaw", "link": "https://stackoverflow.com/users/2963238/gonzaw"}, "edited": false, "score": 0, "creation_date": 1421522606, "post_id": 27998555, "comment_id": 44395396, "body": "Ok. I&#39;ll first try toying around with <code>Process</code> to try and see if I can figure it out. If not I&#39;ll make a follow up question. I&#39;ll mark this as answered then."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 27, "last_activity_date": 1421515033, "last_edit_date": 1495540038, "creation_date": 1421490827, "answer_id": 27998555, "question_id": 27997155, "link": "https://stackoverflow.com/questions/27997155/finite-state-transducers-in-haskell/27998555#27998555", "title": "Finite State Transducers in Haskell?", "body": "<p>A <a href=\"https://hackage.haskell.org/package/machines-0.4.1/docs/Data-Machine-Mealy.html\" rel=\"noreferrer\"><code>Mealy</code></a> machine alternately reads an <code>a</code> from a stream of inputs <code>a</code> and outputs a <code>b</code> to a stream of outputs. It reads first and then outputs once after each read.</p>\n\n<pre><code>newtype Mealy a b = Mealy { runMealy :: a -&gt; (b, Mealy a b) }\n</code></pre>\n\n<p>A <a href=\"https://hackage.haskell.org/package/machines-0.4.1/docs/Data-Machine-Moore.html\" rel=\"noreferrer\"><code>Moore</code></a> machine alternately outputs a <code>b</code> to a stream of outputs and reads an input <code>a</code> from a stream of inputs. It starts with an output of <code>b</code> and then reads once after each output.</p>\n\n<pre><code>data Moore a b = Moore b (a -&gt; Moore a b)\n</code></pre>\n\n<p>An FST either reads from it's input, writes to its output, or stops. It can read as many times in a row as it wants or write as many times in a row as it wants.</p>\n\n<pre><code>data FST a b\n    = Read  (a -&gt; FST a b)\n    | Write (b,   FST a b)\n    | Stop\n</code></pre>\n\n<p>The equivalent of an <code>FST</code> from machines is <a href=\"https://hackage.haskell.org/package/machines-0.4.1/docs/Data-Machine-Process.html#t:Process\" rel=\"noreferrer\"><code>Process</code></a>. It's definition is a little spread out. To simplify the discussion we are going to forget about <code>Process</code> for now and explore it from the inside-out.</p>\n\n<h3>The base functor</h3>\n\n<p>To describe what a <code>Process</code> is, we're going to first notice a pattern in all three machines so far. Each of them recursively refers to itself for \"what to do next\". We are going to replace \"what to do next\" with any type <code>next</code>. The <code>Mealy</code> machine, while mapping an input to an output, also provides the <code>next</code> machine to run.</p>\n\n<pre><code>newtype MealyF a b next = MealyF { runMealyF :: a -&gt; (b, next) }\n</code></pre>\n\n<p>The <code>Moore</code> machine, after outputting and requesting an input, figures out the <code>next</code> machine to run.</p>\n\n<pre><code>data MooreF a b next = MooreF b (a -&gt; next)\n</code></pre>\n\n<p>We can write the <code>FST</code> the same way. When we <code>Read</code> from the input we'll figure out what to do <code>next</code> depending on the input. When we <code>Write</code> to the output we'll also provide what to do <code>next</code> after outputting. When we <code>Stop</code> there's nothing to do next.</p>\n\n<pre><code>data FSTF a b next\n    = Read  (a -&gt; next)\n    | Write (b,   next)\n    | Stop\n</code></pre>\n\n<p>This pattern of eliminating explicit recursion shows up repeatedly in Haskell code, and is usually called a \"base functor\". In the machines package the base functor is <a href=\"https://hackage.haskell.org/package/machines-0.4.1/docs/Data-Machine-Type.html#t:Step\" rel=\"noreferrer\"><code>Step</code></a>. Compared to our code, <code>Step</code> has renamed the type variable for the output to <code>o</code>, what to do next to <code>r</code>, reading to <code>Await</code>, and writing to <code>Yield</code>.</p>\n\n<pre><code>data Step k o r\n  = forall t. Await (t -&gt; r) (k t) r\n  | Yield o r\n  | Stop\n</code></pre>\n\n<p><code>Await</code>ing is a little more complicated than <code>Read</code> because a <a href=\"https://hackage.haskell.org/package/machines-0.4.1/docs/Data-Machine-Type.html#t:Machine\" rel=\"noreferrer\"><code>Machine</code></a> can read from multiple sources. For <code>Process</code>es that can only read from a single source, <code>k</code> is <a href=\"https://hackage.haskell.org/package/machines-0.4.1/docs/Data-Machine-Is.html\" rel=\"noreferrer\"><code>Is</code></a> applied to a specific type, which is a proof the second type <code>Is</code> the first type. For a <code>Process</code> reading inputs <code>a</code>, <code>k</code> will be <code>Is a</code>.</p>\n\n<pre><code>data Step (Is a) o r\n  = forall t. Await (t -&gt; r) (Is a t) r\n  | Yield o r\n  | Stop\n</code></pre>\n\n<p>The existential quantification <code>forall t.</code> is an <a href=\"https://stackoverflow.com/a/17282019/414413\">implementation detail for dealing with <code>Source</code>s</a>. After witnessing that <code>a ~ t</code> this becomes.</p>\n\n<pre><code>data Step (Is a) o r\n  = forall t ~ a. Await (t -&gt; r) Refl r\n  | Yield o r\n  | Stop\n</code></pre>\n\n<p>If we unify <code>t</code> with <code>a</code> and remove the <code>Refl</code> constructor which is always the same, this looks like our <code>FSTF</code>.</p>\n\n<pre><code>data Step (Is a) o r\n  = Await (a -&gt; r) r\n  | Yield  o    r\n  | Stop\n</code></pre>\n\n<p>The extra <code>r</code> for what to do next in <code>Await</code> is what to do next when there's no more input.</p>\n\n<h3>The machine transformer `MachineT`</h3>\n\n<p>The machine transformer, <a href=\"https://hackage.haskell.org/package/machines-0.4.1/docs/Data-Machine-Type.html#t:MachineT\" rel=\"noreferrer\"><code>MachineT</code></a>, makes <code>Step</code> look almost like our <code>FST</code>. It says, \"A machine operating over some monad <code>m</code> is what to do in that monad to get the next <code>Step</code>. The <code>next</code> thing to do after each step is another <code>MachineT</code>.\"</p>\n\n<pre><code>newtype MachineT m k o = MachineT { runMachineT :: m (Step k o (MachineT m k o)) }\n</code></pre>\n\n<p>Overall, specialized for our types, this looks like </p>\n\n<pre><code>newtype MachineT m (Is a) o = \n    MachineT m (\n        Await (a -&gt; MachineT m (Is a) o) (MachineT m (Is a) o)\n      | Yield  o   (MachineT m (Is a) o)\n      | Stop\n    )\n</code></pre>\n\n<p><code>Machine</code> is a pure <code>MachineT</code>.</p>\n\n<pre><code>type Machine k o = forall m. Monad m =&gt; MachineT m k o\n</code></pre>\n\n<p>Universal quantification over all <code>Monad</code>s <code>m</code> is another way of saying a computation doesn't need anything from an underlying <code>Monad</code>. This can be seen by substituting <a href=\"https://hackage.haskell.org/package/transformers-0.4.2.0/docs/Data-Functor-Identity.html\" rel=\"noreferrer\"><code>Identity</code></a> for <code>m</code>.</p>\n\n<pre><code>type Machine k o = \n    MachineT Identity (\n        Await (a -&gt; MachineT Identity k o) (MachineT Identity k o)\n      | Yield  o   (MachineT Identity k o)\n      | Stop\n    )\n</code></pre>\n\n<h3>Processes</h3>\n\n<p>A <code>Process</code> or <code>ProcessT</code> is a <code>Machine</code> or <code>MachineT</code> that only reads a single type of input <code>a</code>, <code>Is a</code>.</p>\n\n<pre><code>type Process    a b = Machine    (Is a) b\ntype ProcessT m a b = MachineT m (Is a) b\n</code></pre>\n\n<p>A <code>Process</code> has the following structure after removing all the intermediate constructors that are always the same. This structure is exactly the same as our <code>FST</code>, except it has an added \"what to do next\" in the case that there's no more input.</p>\n\n<pre><code>type Process a b =\n    Await (a -&gt; Process a b) (Process a b)\n  | Yield  b   (Process a b)\n  | Stop\n</code></pre>\n\n<p>The <code>ProcessT</code> variant has an <code>m</code> wrapped around it so that it can act in the monad at each step.</p>\n\n<p><code>Process</code> models state transducers.</p>\n"}], "owner": {"reputation": 741, "user_id": 2963238, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/28ca5f7c13e9099945f7adbc1ddacea5?s=128&d=identicon&r=PG&f=1", "display_name": "gonzaw", "link": "https://stackoverflow.com/users/2963238/gonzaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1733, "favorite_count": 8, "accepted_answer_id": 27998555, "answer_count": 1, "score": 13, "last_activity_date": 1422113563, "creation_date": 1421478821, "last_edit_date": 1421503690, "question_id": 27997155, "link": "https://stackoverflow.com/questions/27997155/finite-state-transducers-in-haskell", "title": "Finite State Transducers in Haskell?", "body": "<p>I've been wondering if there is a way to define and work with <a href=\"http://en.wikipedia.org/wiki/Finite_state_transducer\">finite state transducers</a> in Haskell in an idiomatic way.</p>\n\n<p>You can approach FSTs as <em>generators</em> (it generates an output of type {x1,x2}), or as <em>recognizers</em> (given an input of type {x1,x2} it recognizes it if it belongs to the rational relation), or as <em>translators</em> (given an input tape, it translates it into an output tape). Would the representation change depending on the approach?</p>\n\n<p>Would it also be possible to model a FST in a way that you can produce one by specifying rewriting rules? E.g creating a DSL to model rewriting rules, and then creating a function <code>createFST :: [Rule] -&gt; FST</code>.</p>\n\n<p>The closest I could find is Kmett, Bjarnason and Cough's <code>machines</code> library:\n<a href=\"https://hackage.haskell.org/package/machines\">https://hackage.haskell.org/package/machines</a></p>\n\n<p>But I can't seem to realize how to model a FST with a <code>Machine</code>. I'd suppose that the correct way of doing it would be similar to how they define Moore and Mealy machines: define a FST as a different entity, but provide an instance of <code>Automaton</code> to be able to use it as a machine.</p>\n\n<p>I found some other options too, but they define it in a straightforward way (like in <a href=\"https://hackage.haskell.org/package/fst\">https://hackage.haskell.org/package/fst</a> ). That doesn't convince me much, as I wonder if there's a better way to do so idiomatically using the strengths of Haskell's type system (like how Moore and Mealy machines are defined in the <code>machines</code> library).</p>\n"}, {"tags": ["javascript", "haskell", "currying", "lambda-calculus", "partial-application"], "comments": [{"owner": {"reputation": 1198, "user_id": 303712, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09fc206c95ff9e23a0f62d46c5819812?s=128&d=identicon&r=PG&f=1", "display_name": "raine", "link": "https://stackoverflow.com/users/303712/raine"}, "edited": false, "score": 0, "creation_date": 1421513650, "post_id": 27996544, "comment_id": 44392705, "body": "Looks like <code>countWhere</code> is expected to return a Number, instead of <code>[1,3,5]</code>."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 1198, "user_id": 303712, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09fc206c95ff9e23a0f62d46c5819812?s=128&d=identicon&r=PG&f=1", "display_name": "raine", "link": "https://stackoverflow.com/users/303712/raine"}, "edited": false, "score": 0, "creation_date": 1421516615, "post_id": 27996544, "comment_id": 44393558, "body": "Oops. Yes, you are correct."}, {"owner": {"reputation": 28104, "user_id": 128595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74530a34228bb8fa1f87ae92c78909b7?s=128&d=identicon&r=PG", "display_name": "Eli Barzilay", "link": "https://stackoverflow.com/users/128595/eli-barzilay"}, "edited": false, "score": 3, "creation_date": 1421522025, "post_id": 27996544, "comment_id": 44395216, "body": "The &quot;correctly&quot; is subjective.  The kind of currying that you&#39;re talking about in your answer is only relevant if you want to translate code from a language with automatic currying like Haskell and want to keep the translation similar.  But if you want to use Javascript with a currying function then the version that you refer to as incorrect is actually correct -- when there are enough arguments you apply the function and you <i>don&#39;t</i> curry the result (ie, no auto-currying).  This is even more important in a language with variadic functions like Javascript, see next comment."}, {"owner": {"reputation": 28104, "user_id": 128595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74530a34228bb8fa1f87ae92c78909b7?s=128&d=identicon&r=PG", "display_name": "Eli Barzilay", "link": "https://stackoverflow.com/users/128595/eli-barzilay"}, "edited": false, "score": 4, "creation_date": 1421522128, "post_id": 27996544, "comment_id": 44395247, "body": "In the case of JS, you can&#39;t know if the function will use more arguments or not, so your correct version turn from a cute auto-currying thing into a broken tool.  (Yes, I&#39;m sure that you don&#39;t use variadic functions, but don&#39;t confuse random readers.)"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 1, "creation_date": 1421522143, "post_id": 27996544, "comment_id": 44395254, "body": "I have a strong case against variadic arguments: <a href=\"http://stackoverflow.com/a/26701110/783743\">stackoverflow.com/a/26701110/783743</a>"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 28104, "user_id": 128595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74530a34228bb8fa1f87ae92c78909b7?s=128&d=identicon&r=PG", "display_name": "Eli Barzilay", "link": "https://stackoverflow.com/users/128595/eli-barzilay"}, "edited": false, "score": 0, "creation_date": 1421522801, "post_id": 27996544, "comment_id": 44395454, "body": "@EliBarzilay Yes, it is indeed subjective in a &quot;subjective&quot; language like JavaScript which has a lot of &quot;subjective&quot; features like variadic arguments. However, the fact remains that if I am forced to write <code>countWhere(odd)([1,2,3,4,5])</code> instead of <code>countWhere(odd, [1,2,3,4,5])</code> then that is plain wrong. Haskell has variadic functions too: <a href=\"http://stackoverflow.com/q/3467279/783743\">stackoverflow.com/q/3467279/783743</a>. Interestingly, these type-safe &quot;variadic functions&quot; work because of currying; and the &quot;correct&quot; version of <code>curry</code> allows them to be directly translated in JavaScript too. Hence, it actually enables variadic args. =)"}, {"owner": {"reputation": 28104, "user_id": 128595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74530a34228bb8fa1f87ae92c78909b7?s=128&d=identicon&r=PG", "display_name": "Eli Barzilay", "link": "https://stackoverflow.com/users/128595/eli-barzilay"}, "edited": false, "score": 4, "creation_date": 1421544177, "post_id": 27996544, "comment_id": 44400799, "body": "@AaditMShah, re variadic functions -- there is nothing wrong with them.  See all lisps where they&#39;re very inherent and natural.  Re Haskell, that&#39;s wrong -- Haskell has <i>only</i> unary functions, not even nullary ones (and the fact that many Haskellers are unaware of this is pretty amazing).  Finally, the <code>countWhere</code> that you want is still a translation of a Haskell-ism, where a function can return another function and the whole thing is invoked as &quot;one&quot; function call (multiple ones, of course, due to currying), in a more JS-ish style, this wouldn&#39;t happen."}, {"owner": {"reputation": 28104, "user_id": 128595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74530a34228bb8fa1f87ae92c78909b7?s=128&d=identicon&r=PG", "display_name": "Eli Barzilay", "link": "https://stackoverflow.com/users/128595/eli-barzilay"}, "edited": false, "score": 2, "creation_date": 1421544388, "post_id": 27996544, "comment_id": 44400841, "body": "So obviously, the question is whether it&#39;s a good idea to try and force this auto-curried-like view into JS code -- and the thing is that you&#39;ll always run into more subtle problems with more trickery that will be needed to go around them.  For most people, that means that it&#39;s better to use JS like JS, or choose an auto curried language (Haskell or ML) and use it as such.  If you like to keep on fighting, then that&#39;s your own choice -- and it&#39;s better to not confuse people into thinking that this is supposed to be better for JS programs."}, {"owner": {"reputation": 28104, "user_id": 128595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74530a34228bb8fa1f87ae92c78909b7?s=128&d=identicon&r=PG", "display_name": "Eli Barzilay", "link": "https://stackoverflow.com/users/128595/eli-barzilay"}, "edited": false, "score": 0, "creation_date": 1421544433, "post_id": 27996544, "comment_id": 44400854, "body": "Even for your own choice, I&#39;m guessing that what you really would feel better with is a language that either has auto currying, or can be tweaked to have it."}, {"owner": {"reputation": 28104, "user_id": 128595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74530a34228bb8fa1f87ae92c78909b7?s=128&d=identicon&r=PG", "display_name": "Eli Barzilay", "link": "https://stackoverflow.com/users/128595/eli-barzilay"}, "edited": false, "score": 3, "creation_date": 1421544709, "post_id": 27996544, "comment_id": 44400910, "body": "Oh, and one last comment -- if you try this kind of thing in a statically-typed non-curried language (like Typed Racket, for example) you&#39;ll probably see that you&#39;re really changing the types of functions: when you curry a function F that returns a binary function G, the result will change to become curried itself, and therefore have a different type.  That&#39;s a good way to see the essence of the fight you&#39;re having."}], "answers": [{"comments": [{"owner": {"reputation": 28104, "user_id": 128595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74530a34228bb8fa1f87ae92c78909b7?s=128&d=identicon&r=PG", "display_name": "Eli Barzilay", "link": "https://stackoverflow.com/users/128595/eli-barzilay"}, "edited": false, "score": 3, "creation_date": 1421522387, "post_id": 27996545, "comment_id": 44395331, "body": "This answer is not completely correct, see my comment to the question.  (I&#39;d comment here, but you seem to be having a dialog with yourself.)"}, {"owner": {"reputation": 12396, "user_id": 1379657, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KVqkP.jpg?s=128&g=1", "display_name": "Ludwig Magnusson", "link": "https://stackoverflow.com/users/1379657/ludwig-magnusson"}, "edited": false, "score": 0, "creation_date": 1442386838, "post_id": 27996545, "comment_id": 53055697, "body": "Regarding case 4. If the result of applying f to the first n arguments is not a function, what then? Is it considered an error or do you just discard the remaining arguments and return the non function value?"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 12396, "user_id": 1379657, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KVqkP.jpg?s=128&g=1", "display_name": "Ludwig Magnusson", "link": "https://stackoverflow.com/users/1379657/ludwig-magnusson"}, "edited": false, "score": 1, "creation_date": 1442406741, "post_id": 27996545, "comment_id": 53068277, "body": "@LudwigMagnusson It is an error because we still try to apply the non-function value to the remaining arguments. Hence, JavaScript will complain that you were trying to call a non-callable object. This is the desired behavior because we want an error every time we make such a stupid mistake."}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 12, "last_activity_date": 1557461891, "last_edit_date": 1557461891, "creation_date": 1421473137, "answer_id": 27996545, "question_id": 27996544, "link": "https://stackoverflow.com/questions/27996544/how-to-correctly-curry-a-function-in-javascript/27996545#27996545", "title": "How to correctly curry a function in JavaScript?", "body": "<p>The problem with your <code>curry</code> function (and for <a href=\"http://ramdajs.com/docs/R.html#curry\" rel=\"nofollow noreferrer\">most</a> <a href=\"https://github.com/dominictarr/curry\" rel=\"nofollow noreferrer\"><code>curry</code></a> <a href=\"http://fitzgen.github.io/wu.js/#curryable\" rel=\"nofollow noreferrer\">functions</a> <a href=\"https://lodash.com/docs#curry\" rel=\"nofollow noreferrer\">that</a> <a href=\"http://benalman.com/news/2012/09/partial-application-in-javascript/#currying\" rel=\"nofollow noreferrer\">people</a> <a href=\"http://extralogical.net/articles/currying-javascript.html\" rel=\"nofollow noreferrer\">write</a> in JavaScript) is that it doesn't handle extra arguments correctly.</p>\n\n<p><strong>What <code>curry</code> does</strong></p>\n\n<p>Suppose <code>f</code> is a function and <code>f.length</code> is <code>n</code>. Let <code>curry(f)</code> be <code>g</code>. We call <code>g</code> with <code>m</code> arguments. What should happen?</p>\n\n<ol>\n<li>If <code>m === 0</code> then just return <code>g</code>.</li>\n<li>If <code>m &lt; n</code> then partially apply <code>f</code> to the <code>m</code> new arguments, and return a new curried function which accepts the remaining <code>n - m</code> arguments.</li>\n<li>Otherwise apply <code>f</code> to the <code>m</code> arguments and return the result.</li>\n</ol>\n\n<p>This is what most <code>curry</code> functions do, and this is wrong. The first two cases are right, but the third case is wrong. Instead, it should be:</p>\n\n<ol>\n<li>If <code>m === 0</code> then just return <code>g</code>.</li>\n<li>If <code>m &lt; n</code> then partially apply <code>f</code> to the <code>m</code> new arguments, and return a new curried function which accepts the remaining <code>n - m</code> arguments.</li>\n<li>If <code>m === n</code> then apply <code>f</code> to the <code>m</code> arguments. If the result is a function then <code>curry</code> the result. Finally, return the result.</li>\n<li>If <code>m &gt; n</code> then apply <code>f</code> to the first <code>n</code> arguments. If the result is a function then <code>curry</code> the result. Finally, apply the result to the remaining <code>m - n</code> arguments and return the new result.</li>\n</ol>\n\n<p><strong>The problem with most <code>curry</code> functions</strong></p>\n\n<p>Consider the following code:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const countWhere = compose(compose(length), filter);\n\ncountWhere(odd, [1,2,3,4,5]);\n</code></pre>\n\n<p>If we use the incorrect <code>curry</code> functions, then this is equivalent to:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>compose(compose(length), filter, odd, [1,2,3,4,5]);\n</code></pre>\n\n<p>However, <code>compose</code> only accepts three arguments. The last argument is dropped:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const compose = curry((f, g, x) =&gt;f(g(x)));\n</code></pre>\n\n<p>Hence, the above expression evaluates to:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>compose(length)(filter(odd));\n</code></pre>\n\n<p>This further evaluates to:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>compose(length, filter(odd));\n</code></pre>\n\n<p>The <code>compose</code> function expects one more argument which is why it returns a function instead of returning <code>3</code>. To get the correct output you need to write:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>countWhere(odd)([1,2,3,4,5]);\n</code></pre>\n\n<p>This is the reason why most <code>curry</code> functions are wrong.</p>\n\n<p><strong>The solution using the correct <code>curry</code> function</strong></p>\n\n<p>Consider the following code again:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const countWhere = compose(compose(length), filter);\n\ncountWhere(odd, [1,2,3,4,5]);\n</code></pre>\n\n<p>If we use the correct <code>curry</code> function, then this is equivalent to:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>compose(compose(length), filter, odd)([1,2,3,4,5]);\n</code></pre>\n\n<p>Which evaluates to:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>compose(length)(filter(odd))([1,2,3,4,5]);\n</code></pre>\n\n<p>Which further evaluates to (skipping an intermediate step):</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>compose(length, filter(odd), [1,2,3,4,5]);\n</code></pre>\n\n<p>Which results in:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>length(filter(odd, [1,2,3,4,5]));\n</code></pre>\n\n<p>Producing the correct result <code>3</code>.</p>\n\n<p><strong>The implementation of the correct <code>curry</code> function</strong></p>\n\n<p>Implementing the correct <code>curry</code> function in ES6 is straightforward:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const curried = Symbol(\"curried\");\n\nObject.defineProperty(curry, curried, { value: true });\n\nfunction curry(functor, ...initArgs) {\n    if (arguments.length === 0) return curry;\n\n    if (typeof functor !== \"function\") {\n        const value = JSON.stringify(functor);\n        throw new TypeError(`${value} is not a function`);\n    }\n\n    if (functor[curried]) return functor(...initArgs);\n\n    const arity = functor.length;\n    const args = initArgs.length;\n\n    if (args &gt;= arity) {\n        const result = functor(...initArgs.slice(0, arity));\n        return typeof result === \"function\" || args &gt; arity ?\n            curry(result, ...initArgs.slice(arity)) : result;\n    }\n\n    const result = (...restArgs) =&gt; curry(functor, ...initArgs, ...restArgs);\n\n    return Object.defineProperty(result, curried, { value: true });\n}\n</code></pre>\n\n<p>I am not sure how fast this implementation of <code>curry</code> is. Perhaps somebody could make it faster.</p>\n\n<p><strong>Implications of using the correct <code>curry</code> function</strong></p>\n\n<p>Using the correct <code>curry</code> function allows you to directly translate Haskell code into JavaScript. For example:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const id = curry(a =&gt; a);\n\nconst flip = curry((f, x, y) =&gt; f(y, x));\n</code></pre>\n\n<p>The <code>id</code> function is useful because it allows you to partially apply a non-curried function easily:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const add = (a, b) =&gt; a + b;\n\nconst add2 = id(add, 2);\n</code></pre>\n\n<p>The <code>flip</code> function is useful because it allows you to easily create <a href=\"https://stackoverflow.com/a/25720884/783743\">right sections</a> in JavaScript:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const sub = (a, b) =&gt; a - b;\n\nconst sub2 = flip(sub, 2); // equivalent to (x - 2)\n</code></pre>\n\n<p>It also means that you don't need hacks like this <a href=\"http://ramdajs.com/docs/R.html#useWith\" rel=\"nofollow noreferrer\">extended <code>compose</code> function</a>:</p>\n\n<p><a href=\"https://stackoverflow.com/q/17386706/783743\">What&#39;s a Good Name for this extended `compose` function?</a></p>\n\n<p>You can simply write:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const project = compose(map, pick);\n</code></pre>\n\n<p>As mentioned in the question, if you want to compose <code>length</code> and <code>filter</code> then you use the <code>(f .) . g</code> pattern:</p>\n\n<p><a href=\"https://stackoverflow.com/q/20279306/783743\">What does (f .) . g mean in Haskell?</a></p>\n\n<p>Another solution is to create higher order <code>compose</code> functions:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const compose2 = compose(compose, compose);\n\nconst countWhere = compose2(length, fitler);\n</code></pre>\n\n<p>This is all possible because of the correct implementation of the <code>curry</code> function.</p>\n\n<p><strong>Extra food for thought</strong></p>\n\n<p>I usually use the following <code>chain</code> function when I want to compose a chain of functions:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const chain = compose((a, x) =&gt; {\n    var length = a.length;\n    while (length &gt; 0) x = a[--length](x);\n    return x;\n});\n</code></pre>\n\n<p>This allows you to write code like:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const inc = add(1);\n\nconst foo = chain([map(inc), filter(odd), take(5)]);\n\nfoo([1,2,3,4,5,6,7,8,9,10]); // [2,4,6]\n</code></pre>\n\n<p>Which is equivalent to the following Haskell code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>let foo = map (+1) . filter odd . take 5\n\nfoo [1,2,3,4,5,6,7,8,9,10]\n</code></pre>\n\n<p>It also allows you to write code like:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>chain([map(inc), filter(odd), take(5)], [1,2,3,4,5,6,7,8,9,10]); // [2,4,6]\n</code></pre>\n\n<p>Which is equivalent to the following Haskell code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>map (+1) . filter odd . take 5 $ [1,2,3,4,5,6,7,8,9,10]\n</code></pre>\n\n<p>Hope that helps.</p>\n"}, {"comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1431657218, "post_id": 30249365, "comment_id": 48601682, "body": "Hello @naomik. Yes, I agree that currying is about converting an <code>n</code>-ary function into <code>n</code> unary functions. That&#39;s the mathematical definition of currying and being a functional programmer I am well aware of it. I also agree that code like <code>add(1)(2)</code> would be the JavaScript equivalent of Haskell code (multiple function applications). However, there are two problems with such code. First, function application is expensive. Hence, <code>add(1, 2)</code> is faster than <code>add(1)(2)</code>. Second, code like <code>add(1)(2)</code> is uncouth. I would rather write <code>add(1, 2)</code> in JavaScript."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1431657527, "post_id": 30249365, "comment_id": 48601736, "body": "Anyway, my question wasn&#39;t really about mathematical currying. That&#39;s set in stone and cannot be debated. My question was about most of the available <code>autoCurry</code> implementations in functional JavaScript libraries. I&#39;d been using one of these libraries and I ran into a problem with their <code>autoCurry</code> implementations. Specifically, most functional JavaScript libraries run into the <a href=\"http://stackoverflow.com/q/17386706/783743\">following problem with &quot;auto&quot; currying which they try to solve using several variants of function composition</a>."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1431657919, "post_id": 30249365, "comment_id": 48601846, "body": "Finally, my implementation of <code>curry</code> not only avoids these common pitfalls but also allows one-to-one correspondence between functional programming languages like Haskell and JavaScript (not only including code like <code>add(1)(2)</code> but also code like <code>add(1, 2)</code> for efficiency). This allows you to write truly functional programs with having to resort to hacks employed by current functional libraries to work around their &quot;incorrect&quot; (in my humble opinion) implementations of <code>autoCurry</code>. Yes, the <code>curry</code> function is magic but it is restricted and it makes auto curried functions more mathematical."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1431658515, "post_id": 30249365, "comment_id": 48602009, "body": "Anyway, you seem to like ES6 syntax and yes it is easy to define mathematically curried functions in ES6. However, not everyone is fond of ES6. In fact, I think ES6 syntax looks horrendous and hence I avoid it like the plague. There are two reasons why I prefer auto currying over writing mathematically curried functions. First, it is more efficient. Second, I don&#39;t have to write closures within closures. P.S. I&#39;m not trying to build the next CoffeeScript. The only magic in my code is the <code>curry</code> function. Everything else is mathematical. Also, PureScript looks nice but is very inefficient. =)"}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 2, "creation_date": 1431665733, "post_id": 30249365, "comment_id": 48603959, "body": "@AaditMShah I appreciate the response. Fwiw, the computer science definition of currying doesn&#39;t differ from the mathematical one. Best regards."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1431668289, "post_id": 30249365, "comment_id": 48604753, "body": "Yes, it doesn&#39;t differ. However, the question is not about currying as that wouldn&#39;t be very useful in JavaScript. It&#39;s about auto currying."}], "tags": [], "owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "is_accepted": false, "score": 15, "last_activity_date": 1489612758, "last_edit_date": 1495541843, "creation_date": 1431647705, "answer_id": 30249365, "question_id": 27996544, "link": "https://stackoverflow.com/questions/27996544/how-to-correctly-curry-a-function-in-javascript/30249365#30249365", "title": "How to correctly curry a function in JavaScript?", "body": "<p>@Aadit,</p>\n\n<p>I'm posting this because you shared a comment on my answer to <a href=\"https://stackoverflow.com/a/30198265/633183\">To \u201ccombine\u201d functions in javascript in a functional way?</a> I didn't specifically cover currying in that post because it's a very contentious topic and not really a can of worms I wanted to open there.</p>\n\n<p>I'd be wary using the phrasing <em>\"how to <strong>correctly</strong> curry\"</em> when you seem to be adding your own sugar and conveniences into your implementation.</p>\n\n<p>Anyway, all of that aside, I truly don't intend for this to be an argumentative/combative post. I'd like to be able to have an open, friendly discussion about currying in JavaScript while emphasizing some of the differences between our approaches.</p>\n\n<p>Without further ado...</p>\n\n<hr>\n\n<p>To clarify:</p>\n\n<p>Given <code>f</code> is a function and <code>f.length</code> is <code>n</code>. Let <code>curry(f)</code> be <code>g</code>. We call <code>g</code> with <code>m</code> arguments. What should happen? You say:</p>\n\n<blockquote>\n  <ol>\n  <li>If <code>m === 0</code> then just return <code>g</code>.</li>\n  <li>If <code>m &lt; n</code> then partially apply <code>f</code> to the <code>m</code> new arguments, and return a new curried function which accepts the remaining <code>n - m</code> arguments.</li>\n  <li>If <code>m === n</code> then apply <code>f</code> to the <code>m</code> arguments. If the result is a function then curry the result. Finally, return the result.</li>\n  <li>If <code>m &gt; n</code> then apply <code>f</code> to the first <code>n</code> arguments. If the result is a function then curry the result. Finally, apply the result to the remaining <code>m - n</code> arguments and return the new result.</li>\n  </ol>\n</blockquote>\n\n<p>Let's see a code example of what <a href=\"https://stackoverflow.com/a/27996545/633183\">@Aadit M Shah</a>'s code actually does</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>var add = curry(function(x, y) {\n  return function(a, b) {\n    return x + y + a + b;\n  }\n});\n\nvar z = add(1, 2, 3);\nconsole.log(z(4)); // 10\n</code></pre>\n\n<p>There are two things happening here:</p>\n\n<ol>\n<li>You're attempting to support calling curried functions with variadic arguments.</li>\n<li>You're automatically currying returned functions</li>\n</ol>\n\n<p>I don't believe there's a lot of room for debate here, but people seem to miss what <a href=\"http://en.wikipedia.org/wiki/Currying\" rel=\"nofollow noreferrer\">currying</a> actually is</p>\n\n<blockquote>\n  <p>via: Wikipedia<br>\n  In mathematics and computer science, <strong>currying</strong> is the technique of translating the evaluation of a function that takes multiple arguments (or a tuple of arguments) into evaluating a sequence of functions, <strong>each with a single argument</strong>...</p>\n</blockquote>\n\n<p>I'm bolding that last bit, because it's so important; each function in the sequence only takes a <strong>single argument</strong>; not variadic (0, 1, or more) arguments like you suggest.</p>\n\n<p>You mention haskell in your post, too, so I assume you know that Haskell has no such thing as functions that take more than one argument. (Note: a function that takes a tuple is still just a function that takes one argument, a single tuple). The reasons for this are profound and afford you a flexibility in expressiveness not afforded to you by functions with variadic arguments.</p>\n\n<p>So let's re-ask that original question: <strong>What should happen?</strong></p>\n\n<p>Well, it's simple when each function only accepts 1 argument. At any time, if more than 1 argument is given, they're just dropped.</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>function id(x) {\n  return x;\n}\n</code></pre>\n\n<p>What happens when we call <code>id(1,2,3,4)</code>? Of course we only get the <code>1</code> back and <code>2,3,4</code> are completely disregarded. This is:</p>\n\n<ol>\n<li>how JavaScript works</li>\n<li>how Wikipedia says currying should work</li>\n<li>how we should implement our own <code>curry</code> solution</li>\n</ol>\n\n<blockquote>\n  <p>Before we go further, I'm going to use <strong>ES6</strong>-style <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions\" rel=\"nofollow noreferrer\">arrow functions</a> but I will also include the ES5 equivalent at the bottom of this post. (Probably later tonight.)</p>\n</blockquote>\n\n<p><strong>currying technique \u00e0 la naomik</strong></p>\n\n<p>In this approach, we write a <strong>curry</strong> function that continuously returns single-parameter functions until all arguments have been specified</p>\n\n<p>As a result of this implementation we have <strong>6</strong> multi-purpose functions.</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>// no nonsense curry\r\nconst curry = f =&gt; {\r\n  const aux = (n, xs) =&gt;\r\n    n === 0 ? f (...xs) : x =&gt; aux (n - 1, [...xs, x])\r\n  return aux (f.length, [])\r\n}\r\n   \r\n// demo\r\nlet sum3 = curry(function(x,y,z) {\r\n  return x + y + z;\r\n});\r\n    \r\nconsole.log (sum3 (3) (5) (-1)); // 7</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>OK, so we've seen a <code>curry</code> technique  that is implemented using a simple auxiliary loop. It has no dependencies and a declarative definition that is under 5 lines of code. It allows functions to be partially applied, <strong>1 argument at a time</strong>, just as a curried function is supposed to work.</p>\n\n<p>No magic, no unforeseen auto-currying, no other unforeseen consequences.</p>\n\n<hr>\n\n<p><strong>But what really is the point of currying anyway?</strong></p>\n\n<p>Well, as it turns out, I don't really <code>curry</code> functions that I write. As you can see below, I generally define all of my reusable functions in curried form. So really, you only need <code>curry</code> when you want to interface with some functions that you don't have control over, perhaps coming from a lib or something; some of which might have variadic interfaces!</p>\n\n<p>I present <code>curryN</code></p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>// the more versatile, curryN\r\nconst curryN = n =&gt; f =&gt; {\r\n  const aux = (n, xs) =&gt;\r\n    n === 0 ? f (...xs) : x =&gt; aux (n - 1, [...xs, x])\r\n  return aux (n, [])\r\n};\r\n\r\n// curry derived from curryN\r\nconst curry = f =&gt; curryN (f.length) (f);\r\n\r\n// some caveman function\r\nlet sumN = function() {\r\n  return [].slice.call(arguments).reduce(function(a, b) {\r\n    return a + b;\r\n  });\r\n};\r\n\r\n// curry a fixed number of arguments\r\nlet g = curryN (5) (sumN);\r\nconsole.log (g (1) (2) (3) (4) (5)); // 15</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<hr>\n\n<p><strong>To curry or not to curry? That is the question</strong></p>\n\n<p>We'll write some examples where our functions are all in curried form. Functions will be kept extremely simple. Each with <code>1</code> parameter, and each with a single return expression.</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>// composing two functions\r\nconst comp = f =&gt; g =&gt; x =&gt; f (g (x))\r\nconst mod  = y =&gt; x =&gt; x % y\r\nconst eq   = y =&gt; x =&gt; x === y\r\nconst odd  = comp (eq (1)) (mod (2))\r\n\r\nconsole.log (odd(1)) // true\r\nconsole.log (odd(2)) // false</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Your <code>countWhere</code> function</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>// comp :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)\r\nconst comp = f =&gt; g =&gt; x =&gt;\r\n  f(g(x))\r\n\r\n// mod :: Int -&gt; Int -&gt; Int\r\nconst mod = x =&gt; y =&gt;\r\n  y % x\r\n\r\n// type Comparable = Number | String\r\n// eq :: Comparable -&gt; Comparable -&gt; Boolean\r\nconst eq = x =&gt; y =&gt;\r\n  y === x\r\n\r\n// odd :: Int -&gt; Boolean\r\nconst odd =\r\n  comp (eq(1)) (mod(2))\r\n\r\n// reduce :: (b -&gt; a -&gt; b) -&gt; b -&gt; ([a]) -&gt; b\r\nconst reduce = f =&gt; y =&gt; ([x,...xs]) =&gt;\r\n  x === undefined ? y : reduce (f) (f(y)(x)) (xs)\r\n\r\n// filter :: (a -&gt; Boolean) -&gt; [a] -&gt; [a]\r\nconst filter = f =&gt;\r\n  reduce (acc =&gt; x =&gt; f (x) ? [...acc,x] : acc) ([])\r\n\r\n// length :: [a] -&gt; Int\r\nconst length = x =&gt;\r\n  x.length\r\n\r\n// countWhere :: (a -&gt; Boolean) -&gt; [a] -&gt; Int\r\nconst countWhere = f =&gt;\r\n  comp (length) (filter(f));\r\n\r\nconsole.log (countWhere (odd) ([1,2,3,4,5]))\r\n// 3</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<hr>\n\n<p><strong>Remarks</strong></p>\n\n<p>So to curry or not to curry?</p>\n\n<pre><code>// to curry\nconst add3 = curry((a, b, c) =&gt;\n  a + b + c\n)\n\n// not to curry\nconst add3 = a =&gt; b =&gt; c =&gt;\n a + b + c\n</code></pre>\n\n<p>With ES6 arrow functions being the go-to choice for today's JavaScripter, I think the choice to manually curry your functions is a no-brainer. It's actually shorter and has less overhead to just write it out in curried form.</p>\n\n<p>That said, you're still going to be interfacing with libs that do not offer curried forms of the functions they expose. For this situation, I'd recommend</p>\n\n<ul>\n<li><code>curry</code> and <code>curryN</code> (defined above)</li>\n<li><code>partial</code> (as <a href=\"https://stackoverflow.com/a/42164779/633183\">defined here</a>)</li>\n</ul>\n\n<hr>\n\n<p><strong>@Iven</strong>,</p>\n\n<p>Your <code>curryN</code> implementation is very nice. This section exists solely for you.</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>const U = f=&gt; f (f)\r\nconst Y = U (h=&gt; f=&gt; f(x=&gt; h (h) (f) (x)))\r\n\r\nconst curryN = Y (h=&gt; xs=&gt; n=&gt; f=&gt;\r\n  n === 0 ? f(...xs) : x=&gt; h ([...xs, x]) (n-1) (f)\r\n) ([])\r\n\r\nconst curry = f=&gt; curryN (f.length) (f)\r\n\r\nconst add3 = curry ((x,y,z)=&gt; x + y + z)\r\n\r\nconsole .log (add3 (3) (6) (9))</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": [], "owner": {"reputation": 93, "user_id": 4245458, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-urMeZG21Rq4/AAAAAAAAAAI/AAAAAAAAATw/uxD7S9PID1g/photo.jpg?sz=128", "display_name": "Arijit Basu", "link": "https://stackoverflow.com/users/4245458/arijit-basu"}, "is_accepted": false, "score": -2, "last_activity_date": 1451369861, "creation_date": 1451369861, "answer_id": 34505519, "question_id": 27996544, "link": "https://stackoverflow.com/questions/27996544/how-to-correctly-curry-a-function-in-javascript/34505519#34505519", "title": "How to correctly curry a function in JavaScript?", "body": "<pre><code>//---Currying refers to copying a function but with preset parameters\n\nfunction multiply(a,b){return a*b};\n\nvar productOfSixNFiveSix = multiply.bind(this,6,5);\n\nconsole.log(productOfSixNFive());\n\n//The same can be done using apply() and call()\n\nvar productOfSixNFiveSix = multiply.call(this,6,5);\n\nconsole.log(productOfSixNFive);\n\nvar productOfSixNFiveSix = multiply.apply(this,[6,5]);\n\nconsole.log(productOfSixNFive);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1465025181, "post_id": 37622178, "comment_id": 62737303, "body": "Very nice work, @Iven. I think your last implementation oversteps its own utility, but your original <code>curryN</code> is quite elegant. The readability is excellent. Now I&#39;m trying to think of a way to write it that doesn&#39;t leak private api (<code>acc=[]</code>) and doesn&#39;t use a recursion combinator..."}, {"owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "reply_to_user": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 0, "creation_date": 1465045991, "post_id": 37622178, "comment_id": 62743011, "body": "@naomik Yes, <code>acc = []</code> is ugly. &quot;<i>leak private api</i>&quot; describes the problem well, btw. I haven&#39;t found a way to avoid this default-value-construct without using a wrapper. Provided I understand your curry implemented with <code>Y</code> correctly (see naomik&#39;s answer), you use such a wrapper with <code>Y (h=&gt;...</code> - very ingenious solution!"}], "tags": [], "owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "is_accepted": false, "score": 1, "last_activity_date": 1465057780, "last_edit_date": 1465057780, "creation_date": 1464982698, "answer_id": 37622178, "question_id": 27996544, "link": "https://stackoverflow.com/questions/27996544/how-to-correctly-curry-a-function-in-javascript/37622178#37622178", "title": "How to correctly curry a function in JavaScript?", "body": "<p>Apart from its mathematical definition</p>\n\n<blockquote>\n  <p>currying is the transformation of a function with <code>n</code> parameters into a sequence of <code>n</code> functions, which each accept a single parameter. The arity is thus transformed from <code>n-ary</code> to <code>n * 1-ary</code></p>\n</blockquote>\n\n<p>what impact has currying on programming? <strong>Abstraction over arity</strong>!</p>\n\n<pre><code>const comp = f =&gt; g =&gt; x =&gt; f(g(x));\nconst inc = x =&gt; x + 1;\nconst mul = y =&gt; x =&gt; x * y;\nconst sqr = x =&gt; mul(x)(x);\n\ncomp(sqr)(inc)(1); // 4\ncomp(mul)(inc)(1)(2); // 4\n</code></pre>\n\n<p><code>comp</code> expects two functions <code>f</code> and <code>g</code> and a single arbitrary argument <code>x</code>. Consequently <code>g</code> must be an unary function (a function with exactly one formal parameter) and <code>f</code> too, since it is fed with the return value of <code>g</code>. It won't surprise anyone that <code>comp(sqr)(inc)(1)</code> works. <code>sqr</code> and <code>inc</code> are both unary.</p>\n\n<p>But <code>mul</code> is obviously a binary function. How on earth is that going to work? Because currying abstracted the arity of <code>mul</code>. You can now probably imagine what a powerful feature currying is.</p>\n\n<p>In ES2015 we can pre-curry our functions with arrow functions succinctly:</p>\n\n<pre><code>const map = (f, acc = []) =&gt; xs =&gt; xs.length &gt; 0\n ? map(f, [...acc, f(xs[0])])(xs.slice(1))\n : acc;\n\nmap(x =&gt; x + 1)([1,2,3]); // [2,3,4]\n</code></pre>\n\n<p>Nevertheless, we need a programmatic curry function for all functions out of our control. Since we learned that currying primarily means abstraction over arity, our implementation <strong>must not depend on <code>Function.length</code></strong>:</p>\n\n<pre><code>const curryN = (n, acc = []) =&gt; f =&gt; x =&gt; n &gt; 1\n ? curryN(n - 1, [...acc, x])(f)\n : f(...acc, x);\n\nconst map = (f, xs) =&gt; xs.map(x =&gt; f(x));\ncurryN(2)(map)(x =&gt; x + 1)([1,2,3]); // [2,3,4]\n</code></pre>\n\n<p>Passing the arity explicitly to <code>curryN</code> has the nice side effect that we can curry variadic functions as well:</p>\n\n<pre><code>const sum = (...args) =&gt; args.reduce((acc, x) =&gt; acc + x, 0);\ncurryN(3)(sum)(1)(2)(3); // 6\n</code></pre>\n\n<p>One problem remains: Our curry solution can't deal with methods. OK, we can easily redefine methods that we need:</p>\n\n<pre><code>const concat = ys =&gt; xs =&gt; xs.concat(ys);\nconst append = x =&gt; concat([x]);\n\nconcat([4])([1,2,3]); // [1,2,3,4]\nappend([4])([1,2,3]); // [1,2,3,[4]]\n</code></pre>\n\n<p>An alternative is to adapt <code>curryN</code> in a manner that it can handle both multi-argument functions and methods:</p>\n\n<pre><code>const curryN = (n, acc = []) =&gt; f =&gt; x =&gt; n &gt; 1 \n ? curryN(n - 1, [...acc, x])(f)\n : typeof f === \"function\"\n  ? f(...acc, x)\n  : x[f](...acc);\n\ncurryN(2)(\"concat\")(4)([1,2,3]); // [1,2,3,4]\n</code></pre>\n\n<p>I don't know if this is the correct way to curry functions (and methods) in Javascript though. It is rather one possible way.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>naomik pointed out that by using a default value the internal API of the curry function is partially exposed. The achieved simplification of the curry function comes thus at the expense of its stability. To avoid API leaking we need a wrapper function. We can utilize the U combinator (similar to naomik's solution with Y):</p>\n\n<pre><code>const U = f =&gt; f(f);\nconst curryN = U(h =&gt; acc =&gt; n =&gt; f =&gt; x =&gt; n &gt; 1\n ? h(h)([...acc, x])(n-1)(f)\n : f(...acc, x))([]);\n</code></pre>\n\n<p>Drawback: The implementation is harder to read and has a performance penalty.</p>\n"}], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4872, "favorite_count": 9, "accepted_answer_id": 27996545, "answer_count": 4, "score": 10, "last_activity_date": 1557461891, "creation_date": 1421473137, "last_edit_date": 1557461848, "question_id": 27996544, "link": "https://stackoverflow.com/questions/27996544/how-to-correctly-curry-a-function-in-javascript", "title": "How to correctly curry a function in JavaScript?", "body": "<p>I wrote a simple <code>curry</code> function in JavaScript which works correctly for most cases:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>const add = curry((a, b, c) =&gt; a + b + c);\r\n\r\nconst add2 = add(2);\r\n\r\nconst add5 = add2(3);\r\n\r\nconsole.log(add5(5));</code></pre>\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;script&gt;\r\nconst curried = Symbol(\"curried\");\r\n\r\nObject.defineProperty(curry, curried, { value: true });\r\n\r\nfunction curry(functor, ...initArgs) {\r\n    if (arguments.length === 0) return curry;\r\n\r\n    if (typeof functor !== \"function\") {\r\n        const value = JSON.stringify(functor);\r\n        throw new TypeError(`${value} is not a function`);\r\n    }\r\n\r\n    if (functor[curried] || initArgs.length &gt;= functor.length)\r\n        return functor(...initArgs);\r\n\r\n    const result = (...restArgs) =&gt; curry(functor, ...initArgs, ...restArgs);\r\n\r\n    return Object.defineProperty(result, curried, { value: true });\r\n}\r\n&lt;/script&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>However, it doesn't work for the following case:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>// length :: [a] -&gt; Number\nconst length = a =&gt; a.length;\n\n// filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nconst filter = curry((f, a) =&gt; a.filter(f));\n\n// compose :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\nconst compose = curry((f, g, x) =&gt; f(g(x)));\n\n// countWhere :: (a -&gt; Bool) -&gt; [a] -&gt; Number\nconst countWhere = compose(compose(length), filter);\n</code></pre>\n\n<p>According to the following question <code>countWhere</code> is defined as <code>(length .) . filter</code>:</p>\n\n<p><a href=\"https://stackoverflow.com/q/20279306/783743\">What does (f .) . g mean in Haskell?</a></p>\n\n<p>Hence I should be able to use <code>countWhere</code> as follows:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const odd = n =&gt; n % 2 === 1;\n\ncountWhere(odd, [1,2,3,4,5]);\n</code></pre>\n\n<p>However, instead of returning <code>3</code> (the length of the array <code>[1,3,5]</code>), it returns a function. What am I doing wrong?</p>\n"}, {"tags": ["haskell", "memoization"], "answers": [{"comments": [{"owner": {"reputation": 6881, "user_id": 477047, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Qh2bO.gif?s=128&g=1", "display_name": "David Unric", "link": "https://stackoverflow.com/users/477047/david-unric"}, "edited": false, "score": 0, "creation_date": 1421465671, "post_id": 27995745, "comment_id": 44382145, "body": "Oh, thank you. If I can understand it right, the whole point is to separate functions which do the calculation to force them pre-generate list of partial results. Can be the same achieved anyhow with forced strictness like with <code>seq</code> ?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 6881, "user_id": 477047, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Qh2bO.gif?s=128&g=1", "display_name": "David Unric", "link": "https://stackoverflow.com/users/477047/david-unric"}, "edited": false, "score": 1, "creation_date": 1421466763, "post_id": 27995745, "comment_id": 44382298, "body": "it&#39;s more a question of scope than strictness. When <code>fib = \\n -&gt; let fibs = map fib&#39; [0..] in fibs !! n</code> returns, <code>fibs</code> drops out of scope, and is forgotten. When <code>fib = let fibs = map fib&#39; [0..] in \\n -&gt; fibs !! n</code> returns, fibs is still in scope (to <code>fib</code>, not to the rest of the file)."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 3, "last_activity_date": 1421463681, "creation_date": 1421463681, "answer_id": 27995745, "question_id": 27995641, "link": "https://stackoverflow.com/questions/27995641/memoizing-function-with-condition/27995745#27995745", "title": "Memoizing function with condition?", "body": "<p>You're very close!</p>\n\n<p>Just pull the map statements out further:</p>\n\n<pre><code>fib = lookup\n  where fibs = map fib' [0..]\n        negfibs = map negfib' [0..]\n        lookup n | n &gt;= 0    = (fibs !!) . fromInteger $ n\n                 | otherwise = (negfibs !!) . fromInteger $ -n - 1\n</code></pre>\n\n<p>Now the definition of <code>fibs</code> and <code>negfibs</code> only happens once (with the definition of <code>fib</code>) as opposed for each <code>n</code>.</p>\n"}], "owner": {"reputation": 6881, "user_id": 477047, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Qh2bO.gif?s=128&g=1", "display_name": "David Unric", "link": "https://stackoverflow.com/users/477047/david-unric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 27995745, "answer_count": 1, "score": 3, "last_activity_date": 1421463681, "creation_date": 1421462417, "question_id": 27995641, "link": "https://stackoverflow.com/questions/27995641/memoizing-function-with-condition", "title": "Memoizing function with condition?", "body": "<p>Trying to extend memoizing fibonacci function for negative arguments.\nBellow is a code which obvioulsy works with positive values only:</p>\n\n<pre><code>fib :: Integer -&gt; Integer\nfib = (map fib' [0..] !!) . fromInteger\n    where\n    fib' 0        = 0\n    fib' 1        = 1\n    fib' n        = (fib $ n-2) + (fib $ n-1)\n    negfib' 0     = 1\n    negfib' 1     = -1\n    negfib' n     = (fib $ n+2) - (fib $ n+1)\n</code></pre>\n\n<p>How can I alter <code>fib</code> definition so it would also cache results with <code>negfib'</code> when called with a negative number ?</p>\n\n<p>Attempted with pattern guards</p>\n\n<pre><code>fib n\n    | n&gt;= 0     = (map fib' [0..] !!) . fromInteger $ n\n    | otherwise = (map negfib' [0..] !!) . fromInteger $ -n - 1\n</code></pre>\n\n<p>or enclosed in lambda function</p>\n\n<pre><code>fib = (\\n -&gt; if n &gt;= 0\n                 then map fib' [0..] !!) . fromInteger $ n\n                 else map negfib' [0..] !!) . fromInteger $ -n - 1\n</code></pre>\n\n<p>which did not helped, as lists of partially applied fibonnaci function thunks is not pre-generated this way.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 5008, "user_id": 2088822, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/c96b4e7fa4e410b2df9513f79cffd0fe?s=128&d=identicon&r=PG", "display_name": "afsantos", "link": "https://stackoverflow.com/users/2088822/afsantos"}, "edited": false, "score": 0, "creation_date": 1421452664, "post_id": 27994578, "comment_id": 44379735, "body": "Look out! You have 666 reputation, I don&#39;t know what might happen to you! In all seriousness now, shouldn&#39;t <code>asin</code> be <code>sum</code>, or the other way around, in your first code block?"}, {"owner": {"reputation": 7204, "user_id": 4333347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b091d5e3973e6f65ec16442c3b1b16b?s=128&d=identicon&r=PG", "display_name": "buydadip", "link": "https://stackoverflow.com/users/4333347/buydadip"}, "reply_to_user": {"reputation": 5008, "user_id": 2088822, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/c96b4e7fa4e410b2df9513f79cffd0fe?s=128&d=identicon&r=PG", "display_name": "afsantos", "link": "https://stackoverflow.com/users/2088822/afsantos"}, "edited": false, "score": 0, "creation_date": 1421452698, "post_id": 27994578, "comment_id": 44379740, "body": "@afsantos sorry that was a typo... 666 lucky me :)"}, {"owner": {"reputation": 5008, "user_id": 2088822, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/c96b4e7fa4e410b2df9513f79cffd0fe?s=128&d=identicon&r=PG", "display_name": "afsantos", "link": "https://stackoverflow.com/users/2088822/afsantos"}, "edited": false, "score": 0, "creation_date": 1421452802, "post_id": 27994578, "comment_id": 44379773, "body": "If I understand correctly, you want a function with one parameter that gives your intended result, <code>sumTen x</code>. But you want the recursive call to end after ten iterations. Is that right?"}], "answers": [{"comments": [{"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1421467597, "post_id": 27994666, "comment_id": 44382411, "body": "This doesn&#39;t do exactly what the OP is asking, but I think he/she would be able to figure out the missing part."}], "tags": [], "owner": {"reputation": 1272, "user_id": 373864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c34ede316e83d40011a76e986324e7a?s=128&d=identicon&r=PG", "display_name": "Fernando", "link": "https://stackoverflow.com/users/373864/fernando"}, "is_accepted": true, "score": 6, "last_activity_date": 1421470333, "last_edit_date": 1421470333, "creation_date": 1421452879, "answer_id": 27994666, "question_id": 27994578, "link": "https://stackoverflow.com/questions/27994578/haskell-how-to-keep-track-of-counter-in-recursive-function/27994666#27994666", "title": "Haskell- How to keep track of counter in recursive function", "body": "<p>You can use an auxiliary function:</p>\n\n<pre><code>sumNRec x 0     = 0 \nsumNRec x times = x + sumNRec (x*2) (times - 1)\n\nsumTen x = sumNRec x 10\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 2, "last_activity_date": 1421453205, "last_edit_date": 1421453205, "creation_date": 1421452889, "answer_id": 27994667, "question_id": 27994578, "link": "https://stackoverflow.com/questions/27994578/haskell-how-to-keep-track-of-counter-in-recursive-function/27994667#27994667", "title": "Haskell- How to keep track of counter in recursive function", "body": "<pre><code>sumTen :: Float -&gt; Float\nsumTen x = go 10 x\n    where\n      go n x\n       | n == 0 = x\n       | otherwise = x + go (n-1) (2*x)\n</code></pre>\n\n<p>There are two main points here: <code>go</code> is a simple recursive function of two arguments, which passes along the <code>n</code> to make you stop at the right time. But because you don't want to expose that argument, the top-level <code>sumTen</code> function is just a partially-applied version of <code>go</code>. You could even write this as:</p>\n\n<pre><code>sumTen = go 10\n  where go n x = -- ...\n</code></pre>\n\n<p>Which one you prefer is a style choice, really.</p>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1421453507, "post_id": 27994699, "comment_id": 44379941, "body": "This doesn&#39;t actually do the same thing as the recursive version, because the doubling and the adding are intermingled in the original function. This &quot;simplification&quot; isn&#39;t really faithful."}, {"owner": {"reputation": 67048, "user_id": 388787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f786b1ad349a30e02802ae61b4518fc?s=128&d=identicon&r=PG", "display_name": "Dan D.", "link": "https://stackoverflow.com/users/388787/dan-d"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1421468401, "post_id": 27994699, "comment_id": 44382521, "body": "The compiler via loop fusion and deforestation can do the intermingling itself."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1421474679, "post_id": 27994699, "comment_id": 44383537, "body": "I don&#39;t mean you missed some optimizations, I mean your code is incorrect: it produces different results than the code OP was trying to produce. Compare with my straightforward recursive version, for example."}], "tags": [], "owner": {"reputation": 67048, "user_id": 388787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f786b1ad349a30e02802ae61b4518fc?s=128&d=identicon&r=PG", "display_name": "Dan D.", "link": "https://stackoverflow.com/users/388787/dan-d"}, "is_accepted": false, "score": 1, "last_activity_date": 1421546664, "last_edit_date": 1421546664, "creation_date": 1421453164, "answer_id": 27994699, "question_id": 27994578, "link": "https://stackoverflow.com/questions/27994578/haskell-how-to-keep-track-of-counter-in-recursive-function/27994699#27994699", "title": "Haskell- How to keep track of counter in recursive function", "body": "<p>Perhaps this even:</p>\n\n<pre><code>sumTen x = sum $ take (10+1) $ iterate (* 2) x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1421486741, "creation_date": 1421486741, "answer_id": 27998043, "question_id": 27994578, "link": "https://stackoverflow.com/questions/27994578/haskell-how-to-keep-track-of-counter-in-recursive-function/27998043#27998043", "title": "Haskell- How to keep track of counter in recursive function", "body": "<p>Let's solve the problem in a general way. Start with your original function:</p>\n\n<pre><code>sum :: Float -&gt; Float\nsum x = x + sum (2*x)\n</code></pre>\n\n<p>As a first step, add an extra <code>rec</code> argument. This <code>rec</code> stands for \"recursive call\", and is a function that we are going to call instead of all the recursive calls in the function body. Concretely, just replace any <code>sum</code> that appears in the right hand side of the definition with <code>rec</code>:</p>\n\n<pre><code>sumK :: (Float -&gt; Float) -&gt; Float -&gt; Float\nsumK rec x = x + rec (2*x)\n</code></pre>\n\n<p>Now, if we wanted the recursive function executed zero times, we would get <code>id</code>. To recurse just once, we can use <code>sumK id</code> since</p>\n\n<pre><code>sumK id x = x + id (2*x) = x + 2*x\n</code></pre>\n\n<p>To recurse twice: <code>sumK (sumK id)</code> since</p>\n\n<pre><code>sumK (sumK id) x = x + sumK id (2*x) = x + (2*x) + 2*(2*x)\n</code></pre>\n\n<p>And so on: to recurse <code>n</code> times we just run <code>sumK (... (sumK id)...)</code> where <code>sumK</code> is applied <code>n</code> times. Equivalently, this can be written as the composition <code>sumK . sumK . ... . sumK $ id</code>. So, to obtain that it is enough to generate a list <code>[sumK,sumK,...]</code>, compose them, and apply <code>id</code> at the end.</p>\n\n<pre><code>sum10 :: Float -&gt; Float\nsum10 = compose (replicate 10 sumK) id\n\ncompose :: [a -&gt; a] -&gt; a -&gt; a\ncompose = foldr (.) id\n</code></pre>\n\n<p>If you prefer, you can write a small general helper:</p>\n\n<pre><code>recurseOnly :: Int -&gt; ((a-&gt;a)-&gt;(a-&gt;a)) -&gt; (a-&gt;a)\nrecurseOnly n funK = compose (replicate n funK) id\n\nsum10 :: Float -&gt; Float\nsum10 = recurseOnly 10 sumK\n</code></pre>\n"}], "owner": {"reputation": 7204, "user_id": 4333347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b091d5e3973e6f65ec16442c3b1b16b?s=128&d=identicon&r=PG", "display_name": "buydadip", "link": "https://stackoverflow.com/users/4333347/buydadip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6449, "favorite_count": 0, "accepted_answer_id": 27994666, "answer_count": 4, "score": 4, "last_activity_date": 1421546664, "creation_date": 1421452168, "last_edit_date": 1421452492, "question_id": 27994578, "link": "https://stackoverflow.com/questions/27994578/haskell-how-to-keep-track-of-counter-in-recursive-function", "title": "Haskell- How to keep track of counter in recursive function", "body": "<p>I'm having some difficulty trying to keep track of a counter variable in my function. </p>\n\n<p>I created a function that takes a number as a single parameter and recursively multiplies the number by two, summing all the numbers multiplied by two together, the code below makes it more clear what I intend to do:</p>\n\n<pre><code>sum :: Float -&gt; Float\nsum x = x + sum (2*x)\n</code></pre>\n\n<p>However, the difficulty I am facing, is that I want the function to recurse only ten times. So I want it to stop once ten numbers have been added together. I tried using a counter to keep track of how many times the function has recursed, but to no avail.</p>\n\n<p>This is what I tried:</p>\n\n<pre><code>sumTen :: Float -&gt; Float\nsumTen x n\n    where\n      n=10\n       |n == 0 = x\n       |otherwise = x + sumTen (2*x) (n-1)\n</code></pre>\n\n<p>I realize the code above does not work, counter <code>n</code> would be given the value ten through every recursive call, meaning it will never reach the base case <code>n == 0</code>.</p>\n\n<p>What makes this so difficult is that <code>sumTen</code> must be called using one parameter. In the code above, I tried to give the function a default parameter <code>n</code> with a predetermined value, but it clearly does not work.</p>\n\n<p>Can someone help me make the recursive function stop after 'n' recursive calls?</p>\n"}, {"tags": ["haskell", "counter", "fold"], "comments": [{"owner": {"reputation": 12058, "user_id": 205756, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c43a4d8967538063b38e41f4559a975?s=128&d=identicon&r=PG", "display_name": "alternative", "link": "https://stackoverflow.com/users/205756/alternative"}, "edited": false, "score": 3, "creation_date": 1421449571, "post_id": 27994161, "comment_id": 44378964, "body": "You don&#39;t need to know what index you are at. (Hint: If you have 10 digits, the most significant needs to be multiplied by 2, 9 times... thats the number of digits to the right of it in the list.. hmm....)"}, {"owner": {"reputation": 734, "user_id": 3287963, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7374e00f2519a2140863746b4454f673?s=128&d=identicon&r=PG&f=1", "display_name": "J0hj0h", "link": "https://stackoverflow.com/users/3287963/j0hj0h"}, "reply_to_user": {"reputation": 12058, "user_id": 205756, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c43a4d8967538063b38e41f4559a975?s=128&d=identicon&r=PG", "display_name": "alternative", "link": "https://stackoverflow.com/users/205756/alternative"}, "edited": false, "score": 0, "creation_date": 1421449660, "post_id": 27994161, "comment_id": 44378988, "body": "The function is applied on a per element basis. The exponent <code>i</code> changes for each of the list&#39;s elements. I have no idea how it&#39;s possible to do that without knowing the index to determine the exponent."}, {"owner": {"reputation": 734, "user_id": 3287963, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7374e00f2519a2140863746b4454f673?s=128&d=identicon&r=PG&f=1", "display_name": "J0hj0h", "link": "https://stackoverflow.com/users/3287963/j0hj0h"}, "reply_to_user": {"reputation": 12058, "user_id": 205756, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c43a4d8967538063b38e41f4559a975?s=128&d=identicon&r=PG", "display_name": "alternative", "link": "https://stackoverflow.com/users/205756/alternative"}, "edited": false, "score": 0, "creation_date": 1421449818, "post_id": 27994161, "comment_id": 44379032, "body": "o.O That&#39;s so easy! Thanks for the hint! Totally forgot that way of doing it! :D"}], "answers": [{"comments": [{"owner": {"reputation": 734, "user_id": 3287963, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7374e00f2519a2140863746b4454f673?s=128&d=identicon&r=PG&f=1", "display_name": "J0hj0h", "link": "https://stackoverflow.com/users/3287963/j0hj0h"}, "edited": false, "score": 0, "creation_date": 1421450069, "post_id": 27994272, "comment_id": 44379108, "body": "Yes, thanks a lot! @alternative already gave this hint and I just wrote the code. This works! Sometimes I just don&#39;t see the wood for the trees. :D"}], "tags": [], "owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "is_accepted": true, "score": 6, "last_activity_date": 1421449909, "creation_date": 1421449909, "answer_id": 27994272, "question_id": 27994161, "link": "https://stackoverflow.com/questions/27994161/custom-fold-function-needs-counter/27994272#27994272", "title": "Custom &#39;fold&#39; function needs counter", "body": "<p>If you were to write out the calculation, it would look like this:</p>\n\n<pre><code>x0 + 2 * x1 + 4 * x2 + 8 * x3 + ...\n</code></pre>\n\n<p>This might suggest you need to use the index, but if you factorize this expression, you get this instead:</p>\n\n<pre><code>x0 + 2 * (x1 + 2 * (x2 + 2 * (x3 ...\n</code></pre>\n\n<p>Do you see how it can be written as a fold now?  Notice that there is a self-similarity that looks kind of like this:</p>\n\n<pre><code>x + 2 * x'\n</code></pre>\n\n<p>Hopefully that's enough of a hint for you :)</p>\n"}], "owner": {"reputation": 734, "user_id": 3287963, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7374e00f2519a2140863746b4454f673?s=128&d=identicon&r=PG&f=1", "display_name": "J0hj0h", "link": "https://stackoverflow.com/users/3287963/j0hj0h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 397, "favorite_count": 0, "accepted_answer_id": 27994272, "answer_count": 1, "score": 5, "last_activity_date": 1421449909, "creation_date": 1421449334, "question_id": 27994161, "link": "https://stackoverflow.com/questions/27994161/custom-fold-function-needs-counter", "title": "Custom &#39;fold&#39; function needs counter", "body": "<p>My homework went really well until I stumpled upon the last task.<br>\nFirst, I had to define a custom <code>List</code> structure:</p>\n\n<pre><code>data List a = Nil | Cons a (List a) deriving Show\n</code></pre>\n\n<p>Another task was to write a custom <code>fold</code> function:</p>\n\n<pre><code>foldList :: (a -&gt; b -&gt; b) -&gt; b -&gt; List a -&gt; b\nfoldList f b Nil        = b\nfoldList f b (Cons a l) = f a (foldList f b l)\n</code></pre>\n\n<p><em>The second parameter is the value that is used at the end of the list (at a <code>Nil</code> element).</em></p>\n\n<p>I also had to write a function <code>prodList</code> that multiplies every element of the provided list with each other:</p>\n\n<pre><code>prodList :: List Int -&gt; Int\nprodList = foldList (\\x y -&gt; x * y) 1\n</code></pre>\n\n<p><em>The <code>1</code> at the end is the neutral element of multplication. It therefore has no effect on the calculation.</em></p>\n\n<p>The last one, though, is hard for me to solve.<br>\nI have to write a function <code>binList</code> that calculates the decimal value of list that represents a binary number. The least significant bit is the first element of the list, the binary number is therefore reversed.<br>\nA given example is that the result of <code>binList (Cons 1 (Cons 0 (Cons 0 (Cons 0 (Cons 1 Nil)))))</code> should be 19 (since (10001)_2 is (19)_10). The result of the list [1,1,0,1], however, should be (1011)_2=(11)_10).<br>\nThe culprit of the assignment is, that we <em>have</em> to use <code>foldList</code>.</p>\n\n<p>I know how to calculate each digit, but I struggle to find a way to find out which index <code>i</code> I'm currently at:  </p>\n\n<pre><code>binList :: List Int -&gt; Int\nbinList = foldList (\\x y -&gt; 2^i*x + y)\n</code></pre>\n\n<p>There probably is a nice, curry way to solve this in Haskell. Could you explain to me how you would solve this assignment?</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 2878664, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dd583dcb638667bd3ec99eadd11a646?s=128&d=identicon&r=PG&f=1", "display_name": "vtan", "link": "https://stackoverflow.com/users/2878664/vtan"}, "edited": false, "score": 0, "creation_date": 1421777702, "post_id": 27991570, "comment_id": 44486685, "body": "Thanks. The <code>Applicative</code> instance of <code>(-&gt;) r</code> and this <code>fromMaybe &lt;*&gt; f</code> idiom is what I&#39;ve been looking for."}], "tags": [], "owner": {"reputation": 2133, "user_id": 2494576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69dcf21a7cf379c1f25476d80a73338f?s=128&d=identicon&r=PG", "display_name": "felix-eku", "link": "https://stackoverflow.com/users/2494576/felix-eku"}, "is_accepted": true, "score": 6, "last_activity_date": 1421437716, "last_edit_date": 1421437716, "creation_date": 1421437308, "answer_id": 27991570, "question_id": 27991268, "link": "https://stackoverflow.com/questions/27991268/modifying-the-target-of-a-lens-conditionally/27991570#27991570", "title": "Modifying the target of a Lens conditionally", "body": "<p>You could do</p>\n\n<pre><code>import Control.Applicative\nimport Data.Maybe\n\nupdateGameState :: Input -&gt; GameState -&gt; GameState\nupdateGameState input = fromMaybe &lt;*&gt; _1 (move input)\n-- updateGameState x s = fromMaybe s $ _1 $ move x\n</code></pre>\n\n<p>This uses the fact that <code>Lens s t a b</code> is a type alias for <code>forall f . Functor f =&gt; (a -&gt; f b) -&gt; (s -&gt; f t)</code>, so we can choose to use <code>Maybe</code> as <code>f</code> and get a function of type <code>GameState -&gt; Maybe GameState</code>.</p>\n"}], "owner": {"reputation": 75, "user_id": 2878664, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dd583dcb638667bd3ec99eadd11a646?s=128&d=identicon&r=PG&f=1", "display_name": "vtan", "link": "https://stackoverflow.com/users/2878664/vtan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "accepted_answer_id": 27991570, "answer_count": 1, "score": 6, "last_activity_date": 1421437716, "creation_date": 1421436187, "question_id": 27991268, "link": "https://stackoverflow.com/questions/27991268/modifying-the-target-of-a-lens-conditionally", "title": "Modifying the target of a Lens conditionally", "body": "<p>I have a function that produces an updated board from an input and a board, if the move is permitted by the rules of the game:</p>\n\n<pre><code>move :: Input -&gt; Board -&gt; Maybe Board\n</code></pre>\n\n<p>The board is wrapped in the <code>GameState</code> type with some additional data:</p>\n\n<pre><code>type GameState = (Board, ...)\n</code></pre>\n\n<p>Now I'd like to use lenses to update the board in the game state if <code>move</code> yields <code>Just</code> a value.\nI can do this with a helper function:</p>\n\n<pre><code>updateGameState :: Input -&gt; GameState -&gt; GameState\nupdateGameState input gs = gs &amp; _1 %~ (f $ move input)\n  where\n    f g x = maybe x id (g x)\n</code></pre>\n\n<p>However, I'm wondering if there is a combinator that modifies the target of a\n<code>Lens</code> only if the supplied function returns a <code>Just</code>. I've found the <code>?~</code> operator, but that handles partiality on the left hand side.</p>\n\n<p>Is there a (likely more general) combinator that can achieve this, or is there another way to express this in a terse and idiomatic way?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 2, "last_activity_date": 1421436586, "creation_date": 1421436586, "answer_id": 27991389, "question_id": 27991263, "link": "https://stackoverflow.com/questions/27991263/list-shuffling-with-shufflem/27991389#27991389", "title": "List shuffling with shuffleM", "body": "<p>You could do</p>\n\n<pre><code>main :: IO ()\nmain = do\n    let xs = [1..10]\n    ys &lt;- shuffleM xs\n    print $ doSomething ys\n\ndoSomething :: [Integer] -&gt; Integer\ndoSomething = sum\n</code></pre>\n\n<p>For example.  I'm not sure where <code>shuffleM</code> comes from, but if it's from the <a href=\"https://hackage.haskell.org/package/random-shuffle-0.0.3/docs/System-Random-Shuffle.html\" rel=\"nofollow\">random-shuffle</a> library then you just have to use it inside a monad that implements <code>MonadRandom</code>, which includes <code>IO</code>.  Then you can process the shuffled list just like you would any other list.</p>\n"}], "owner": {"reputation": 149, "user_id": 233398, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5e813eee4ecfbd78e20a11ae36ed73c8?s=128&d=identicon&r=PG", "display_name": "adhalanay", "link": "https://stackoverflow.com/users/233398/adhalanay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 542, "favorite_count": 0, "accepted_answer_id": 27991389, "answer_count": 1, "score": 1, "last_activity_date": 1421436586, "creation_date": 1421436178, "question_id": 27991263, "link": "https://stackoverflow.com/questions/27991263/list-shuffling-with-shufflem", "title": "List shuffling with shuffleM", "body": "<p>I try to write a function that takes a list and give permutation of it. In ghci I can do something like this:</p>\n\n<pre><code>&gt;let xs=[1..10]\n&gt;ys &lt;- shuffleM xs\n</code></pre>\n\n<p>both xs and ys have the type [Integer] and ys is indeed a permutation of xs. I want to get the same effect in a programme, because after shuffling I need to use ys further. How can it be done?</p>\n"}, {"tags": ["haskell", "higher-kinded-types", "type-kinds", "polykinds"], "comments": [{"owner": {"reputation": 2342, "user_id": 1683460, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2535857ac59d18baeda7b081c645f901?s=128&d=identicon&r=PG", "display_name": "Twan van Laarhoven", "link": "https://stackoverflow.com/users/1683460/twan-van-laarhoven"}, "edited": false, "score": 2, "creation_date": 1421435203, "post_id": 27990891, "comment_id": 44372846, "body": "<code>HoldingInt Maybe</code> is something of kind <code>(* -&gt; *) -&gt; *</code> applied to <i>something of</i> kind <code>* -&gt; *</code>. To apply something to a kind, it would need to have sort <code>Kind -&gt; ...</code>."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 2342, "user_id": 1683460, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2535857ac59d18baeda7b081c645f901?s=128&d=identicon&r=PG", "display_name": "Twan van Laarhoven", "link": "https://stackoverflow.com/users/1683460/twan-van-laarhoven"}, "edited": false, "score": 0, "creation_date": 1421435656, "post_id": 27990891, "comment_id": 44373071, "body": "@TwanvanLaarhoven I&#39;ve sprinkled in more <i>something of</i>s."}, {"owner": {"reputation": 1089, "user_id": 3681109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d676ca6572e75e842ca0fa3e9e82d1bb?s=128&d=identicon&r=PG&f=1", "display_name": "genisage", "link": "https://stackoverflow.com/users/3681109/genisage"}, "edited": false, "score": 0, "creation_date": 1421438067, "post_id": 27990891, "comment_id": 44374223, "body": "I think there must be a typo in your second sentence since <code>ord &#39;a&#39; ~ (+1) 1</code> but <code>ord !~ (+1)</code> and <code>&#39;a&#39; !~ 1</code>. Does <code>~</code> not mean &quot;has the same type as&quot;?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 1089, "user_id": 3681109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d676ca6572e75e842ca0fa3e9e82d1bb?s=128&d=identicon&r=PG&f=1", "display_name": "genisage", "link": "https://stackoverflow.com/users/3681109/genisage"}, "edited": false, "score": 0, "creation_date": 1421438611, "post_id": 27990891, "comment_id": 44374506, "body": "@genisage <code>~</code> means &quot;<i>is</i> the same type as&quot;. It operates on types not on values."}], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1421443748, "post_id": 27992766, "comment_id": 44376853, "body": "I wonder if type application is only injective for kinds constructed from <code>*</code> and <code>(-&gt;)</code>. Type application may not be injective for kinds constructed from the other kind that is floating around, <code>GHC.Exts.Constraint</code>, or for any future kind in general."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1421444230, "post_id": 27992766, "comment_id": 44377045, "body": "<code>Constraint</code> is no issue by itself. We run into problems precisely when there should be an <code>a ~ b</code> constraint where <code>a</code> and <code>b</code> have different kinds (because such constraints are unrepresentable in GHC)."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1421442498, "creation_date": 1421442498, "answer_id": 27992766, "question_id": 27990891, "link": "https://stackoverflow.com/questions/27990891/is-polykinded-type-application-injective/27992766#27992766", "title": "Is polykinded type application injective?", "body": "<p>If a type-level application has different kinds, then the two types can not be shown to be equal. Here is evidence:</p>\n\n<pre><code>GHC.Prim&gt; () :: ((Any :: * -&gt; *) Any) ~ ((Any :: (* -&gt; *) -&gt; *) Any) =&gt; ()\n&lt;interactive&gt;:6:1:\n    Couldn't match kind \u2018*\u2019 with \u2018* -&gt; *\u2019\n    Expected type: Any Any\n      Actual type: Any Any\n    In the expression:\n        () :: ((Any :: * -&gt; *) Any) ~ ((Any :: (* -&gt; *) -&gt; *) Any) =&gt; ()\n    In an equation for \u2018it\u2019:\n        it\n          = () :: ((Any :: * -&gt; *) Any) ~ ((Any :: (* -&gt; *) -&gt; *) Any) =&gt; ()\n\n&lt;interactive&gt;:6:7:\n    Couldn't match kind \u2018*\u2019 with \u2018* -&gt; *\u2019\n    Expected type: Any Any\n      Actual type: Any Any\n    In the ambiguity check for: Any Any ~ Any Any =&gt; ()\n    To defer the ambiguity check to use sites, enable AllowAmbiguousTypes\n    In an expression type signature:\n      ((Any :: * -&gt; *) Any) ~ ((Any :: (* -&gt; *) -&gt; *) Any) =&gt; ()\n    In the expression:\n        () :: ((Any :: * -&gt; *) Any) ~ ((Any :: (* -&gt; *) -&gt; *) Any) =&gt; ()\n</code></pre>\n\n<p>(Even turning on the suggested <code>AllowAmbiguousTypes</code> extension gives the same type-checking error -- just without the suggestion.)</p>\n\n<p>Therefore, if two types can be shown to be equal, then type-level applications in the same structural position on the two sides of the equality have the same kind.</p>\n\n<p>If you wish for proof instead of evidence, one would need to write down a careful inductive proof about the system described in <a href=\"http://www.cse.unsw.edu.au/~chak/papers/tc-tfs.pdf\">Type Checking with Open Type Functions</a>. Inspection of Figure 3 suggests to me that the invariant, \"all type applications in ~'s have the same kind on both sides of the ~\" is preserved, though neither I nor the paper prove this carefully, so there is some chance it is not so.</p>\n"}, {"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 6, "last_activity_date": 1421490214, "last_edit_date": 1421490214, "creation_date": 1421443726, "answer_id": 27993048, "question_id": 27990891, "link": "https://stackoverflow.com/questions/27990891/is-polykinded-type-application-injective/27993048#27993048", "title": "Is polykinded type application injective?", "body": "<p>Polykinded type application is injective from the outside, but certainly not injective from inside Haskell.</p>\n\n<p>By \"injective from the outside\" I mean that whenever there is a <code>Refl</code> with type <code>f a :~: g b</code>, then it must be the case that <code>f</code> is equal to <code>g</code> and <code>a</code> is equal to <code>b</code>, and since we know that types of different kinds are never equal, the kinds must be also the same. </p>\n\n<p>The issue is that GHC only has homogeneous type equality constraints, and doesn't have kind equality constraints at all. The machinery for encoding GADTs using coercions exists only on the type and promoted type level. That's why we can't express heterogeneous equality, and why we can't promote GADTs. </p>\n\n<pre><code>{-# LANGUAGE PolyKinds, GADTs, TypeOperators #-}\n\ndata HEq (a :: i) (b :: k) :: * where\n  HRefl :: HEq a a\n-- ERROR: Data constructor \u2018HRefl\u2019 cannot be GADT-like in its *kind* arguments \n</code></pre>\n\n<p>Also, here's a simple example of GHC not inferring injectivity:</p>\n\n<pre><code>sym1 :: forall f g a b. f a :~: g b -&gt; g b :~: f a\nsym1 Refl = Refl\n-- ERROR: could not deduce (g ~ f), could not deduce (b ~ a)\n</code></pre>\n\n<p>If we annotate <code>a</code> and <code>b</code> with the same kind, it checks out. </p>\n\n<p><a href=\"http://www.cis.upenn.edu/~justhsu/docs/nokinds.pdf\" rel=\"nofollow\">This paper</a> talks about the above limitations and how they could be eliminated in GHC (they describe a system with unified kind/type coercions and heterogeneous equality constraints).  </p>\n"}], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 1, "accepted_answer_id": 27993048, "answer_count": 2, "score": 7, "last_activity_date": 1421490214, "creation_date": 1421434649, "last_edit_date": 1495542182, "question_id": 27990891, "link": "https://stackoverflow.com/questions/27990891/is-polykinded-type-application-injective", "title": "Is polykinded type application injective?", "body": "<h3>Is polykinded type application injective?</h3>\n\n<p>When we <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/kind-polymorphism.html\" rel=\"nofollow noreferrer\">enable <code>PolyKinds</code></a>, do we know that <code>f a ~ g b</code> implies <code>f ~ g</code> and <code>a ~ b</code>?</p>\n\n<h3>Motivation</h3>\n\n<p>When <a href=\"https://stackoverflow.com/a/27978248/414413\">trying to answer another question</a>, I reduced the problem to the point that I received the following error only with <code>PolyKinds</code> enabled.</p>\n\n<pre><code>Could not deduce (c1 ~ c)\nfrom the context ((a, c z) ~ (c1 a1, c1 b))\n</code></pre>\n\n<p>If polykinded type application were injective, we could deduce <code>c1 ~ c</code> as follows.</p>\n\n<pre><code>(a,   c z) ~ (c1 a1,   c1 b)\n(a,) (c z) ~ (c1 a1,) (c1 b) {- switch to prefix notation -}\n      c z  ~           c1 b  {- f a ~ g b implies a ~ b -}\n      c    ~           c1    {- f a ~ g b implies f ~ g -}\n      c1   ~           c     {- ~ is reflexive -}\n</code></pre>\n\n<h3>Type application is injective</h3>\n\n<p>In Haskell, type application is injective. If <code>f a ~ g b</code> then <code>f ~ g</code> and <code>a ~ b</code>. We can prove this to ourselves by compiling the following</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nimport Control.Applicative\n\nsecond :: a -&gt; a -&gt; a\nsecond _ = id\n\ntypeApplicationIsInjective :: (Applicative f, f a ~ g b) =&gt; f a -&gt; g b -&gt; f b\ntypeApplicationIsInjective fa gb = second &lt;$&gt; fa &lt;*&gt; gb\n</code></pre>\n\n<h3>Kind of type application is not injective</h3>\n\n<p>The kind of a type application is not injective. If we consider the following, which has kind <code>(* -&gt; *) -&gt; *</code>.</p>\n\n<pre><code>newtype HoldingInt f = HoldingInt (f Int)\n</code></pre>\n\n<p>We can ask ghci what kind something of kind <code>(* -&gt; *) -&gt; *</code> has when applied to something of kind <code>* -&gt; *</code>, which is <code>*</code></p>\n\n<pre><code>&gt; :k HoldingInt\nHoldingInt :: (* -&gt; *) -&gt; *\n&gt; :k Maybe\nMaybe :: * -&gt; *\n&gt; :k HoldingInt Maybe\nHoldingInt Maybe :: *\n</code></pre>\n\n<p>This is the same kind as something of kind <code>* -&gt; *</code> applied to something of kind <code>*</code></p>\n\n<pre><code>&gt; :k Maybe\nMaybe :: * -&gt; *\n&gt; :k Int\nInt :: *\n&gt; :k Maybe Int\nMaybe Int :: *\n</code></pre>\n\n<p>Therefore, it is not true that, borrowing <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/other-type-extensions.html\" rel=\"nofollow noreferrer\">syntax from <code>KindSignatures</code></a>, the first set of kind signatures implies anything in the second.</p>\n\n<pre><code>f :: kf, g :: kg, a :: ka, b :: kb, f a :: k, g b :: k\ng :: kf, f :: kg, b :: ka, a :: kb\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1421432949, "post_id": 27990392, "comment_id": 44371705, "body": "Functions you define must have a name starting with a lowercase letter. Use e.g. <code>lnat</code>. Uppercase letters are reserved for constructors of values in data types."}, {"owner": {"reputation": 1089, "user_id": 3681109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d676ca6572e75e842ca0fa3e9e82d1bb?s=128&d=identicon&r=PG&f=1", "display_name": "genisage", "link": "https://stackoverflow.com/users/3681109/genisage"}, "edited": false, "score": 2, "creation_date": 1421432953, "post_id": 27990392, "comment_id": 44371706, "body": "functions start with lowercase letters, types and constructors start with capitals"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 2, "creation_date": 1421432966, "post_id": 27990392, "comment_id": 44371708, "body": "use lowercase initial for function names.  Uppercase initial means constructors."}, {"owner": {"reputation": 713, "user_id": 2321104, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/b301526acaf0c9b25363cafb77e77d56?s=128&d=identicon&r=PG", "display_name": "AndrewB", "link": "https://stackoverflow.com/users/2321104/andrewb"}, "edited": false, "score": 0, "creation_date": 1421433079, "post_id": 27990392, "comment_id": 44371762, "body": "A silly mistake :/ thanks all."}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 1, "last_activity_date": 1421435545, "creation_date": 1421435545, "answer_id": 27991123, "question_id": 27990392, "link": "https://stackoverflow.com/questions/27990392/haskell-reversed-number-digit-list/27991123#27991123", "title": "Haskell Reversed Number Digit List", "body": "<p>All values must start with a lowercase character. If it starts with a capital or <code>:</code> then that value is a data constructor, to be used in <code>data</code> declarations. This is what you'll want to change your function to:</p>\n\n<pre><code>lnat 0 = [0]\nlnat x = mod x 10 : lnat (div x 10)\n</code></pre>\n\n<p>Note that I also changed the inefficient <code>++</code> operator to <code>:</code> to add a bit more speed.</p>\n"}], "owner": {"reputation": 713, "user_id": 2321104, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/b301526acaf0c9b25363cafb77e77d56?s=128&d=identicon&r=PG", "display_name": "AndrewB", "link": "https://stackoverflow.com/users/2321104/andrewb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "closed_date": 1422431723, "accepted_answer_id": 27991123, "answer_count": 1, "score": 1, "last_activity_date": 1421435545, "creation_date": 1421432730, "question_id": 27990392, "link": "https://stackoverflow.com/questions/27990392/haskell-reversed-number-digit-list", "closed_reason": "Not suitable for this site", "title": "Haskell Reversed Number Digit List", "body": "<p>I am new to Haskell and I am trying to turn an int into a reversed digit list(of ints).</p>\n\n<p>What I have is:</p>\n\n<pre><code>Lnat 0 = [0]\nLnat x = [mod x 10] ++ Lnat (div x 10)\n</code></pre>\n\n<p>However I get the error \"Not in scope: data constructor 'Lnat'\" on both lines and it crashes trying to load the file.</p>\n\n<p>Could you please explain the root of this and how to fix it?</p>\n"}, {"tags": ["haskell", "concurrency"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1421431863, "post_id": 27989942, "comment_id": 44371172, "body": "I read something on this in the GHC docs a long time ago, but can not remember where :-/ IIRC, when a thread enters a thunk it marks it as busy, evaluates it, rewrite it with the result, and then unmarks it. Threads trying to enter a busy thunk wait for it to be unmarked. To avoid actual locks, which are expensive, a cheaper and lesser locking mechanism is used which doesn&#39;t completely guarantee mutual exclusion: there&#39;s a small window of time in which two thread may enter the same thunk. Fortunately, this only wastes CPU: it doesn&#39;t break semantics since purity ensures the result is the same."}], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 1, "last_activity_date": 1421433136, "creation_date": 1421433136, "answer_id": 27990507, "question_id": 27989942, "link": "https://stackoverflow.com/questions/27989942/how-ghc-forces-evaluation-in-multithreaded-applications/27990507#27990507", "title": "How GHC forces evaluation in multithreaded applications?", "body": "<p>When one thread evaluates a thunk, the chunk is locked, and other threads block on it (aka black hole). See <a href=\"http://research.microsoft.com/pubs/67424/2005-haskell.pdf\" rel=\"nofollow\">Haskell on a Shared-Memory Multiprocessor</a> paper for details.</p>\n"}], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 2, "accepted_answer_id": 27990507, "answer_count": 1, "score": 2, "last_activity_date": 1421433136, "creation_date": 1421430997, "question_id": 27989942, "link": "https://stackoverflow.com/questions/27989942/how-ghc-forces-evaluation-in-multithreaded-applications", "title": "How GHC forces evaluation in multithreaded applications?", "body": "<p>For example: I have a quite simple memoised implementation of fibonacci sequence,\nwhich I request in multiple threads:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\nmodule Main where\n\nimport Control.Concurrent\nimport Control.DeepSeq\nimport System.Environment (getArgs)\nimport System.IO.Unsafe (unsafePerformIO)\n\ndata Tree a = Tree (Tree a) a (Tree a)\ninstance Functor Tree where\n  fmap f (Tree l m r) = Tree (fmap f l) (f m) (fmap f r)\n\nindex :: Tree a -&gt; Int -&gt; a\nindex (Tree _ m _) 0 = m\nindex (Tree l _ r) n = case (n - 1) `divMod` 2 of\n  (q,0) -&gt; index l q\n  (q,_) -&gt; index r q\n\nnats :: Tree Int\nnats = go 0 1\n  where go !n !s = Tree (go l s') n (go r s')\n          where l = n + s\n                r = l + s\n                s' = s * 2\n\nfib :: (Int -&gt; Integer) -&gt; Int -&gt; Integer\nfib _ 0 = 0\nfib _ 1 = 1\nfib f n = f (n - 1) + f (n - 2)\n\nfib_tree :: Tree Integer\nfib_tree = fmap (fib fastfib) nats\n\nfastfib :: Int -&gt; Integer\nfastfib = index fib_tree\n\nwriteMutex :: MVar ()\nwriteMutex = unsafePerformIO (newMVar ())\n\nfibIO :: Int -&gt; IO ()\nfibIO n = let fibn = fastfib n\n          in deepseq fibn $ do takeMVar writeMutex\n                               putStrLn (show n ++ \" \" ++ show fibn)\n                               putMVar writeMutex ()\n\nchildren :: MVar [MVar ()]\nchildren = unsafePerformIO (newMVar [])\n\nwaitForChildren :: IO ()\nwaitForChildren = do\n cs &lt;- takeMVar children\n case cs of\n   []   -&gt; return ()\n   m:ms -&gt; do\n      putMVar children ms\n      takeMVar m\n      waitForChildren\n\nforkChild :: IO () -&gt; IO ThreadId\nforkChild io = do\n   mvar &lt;- newEmptyMVar\n   childs &lt;- takeMVar children\n   putMVar children (mvar:childs)\n   forkFinally io (\\_ -&gt; putMVar mvar ())\n\nmain' :: [Int] -&gt; IO ()\nmain' = mapM_ (forkChild . fibIO)\n\nmain :: IO ()\nmain = do\n  nargs &lt;- fmap read `fmap` getArgs :: IO [Int]\n  main' nargs\n  waitForChildren\n</code></pre>\n\n<p>And when compiled with <code>-threaded</code> I can run it:</p>\n\n<pre><code>% time ./concur 10 10 10 10 10 10 10 +RTS -N4\n10 55\n10 55\n10 55\n10 55\n10 55\n10 55\n10 55\n./concur 10 10 10 10 10 10 10 +RTS -N4  0.00s user 0.00s system 82% cpu 0.007 total\n</code></pre>\n\n<p>And as expected if I have single large argument, or many, the execution time is the same.</p>\n\n<p>I'm interested how evaluation of thunks in memoised tree is performed, on low-level? </p>\n"}, {"tags": ["haskell", "binary-tree"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 3, "creation_date": 1421429684, "post_id": 27989532, "comment_id": 44370131, "body": "Your guard syntax is messed up, it should be <code>| &lt;boolean expression&gt; = &lt;int expression&gt;</code> on each line.  It also looks like you&#39;re over thinking things a bit.  If you have <code>left</code> and <code>right</code> as sub-trees, you just want to call <code>nSatisfy condition</code> on each of those then add them together.  You could (and should) do this without the guard."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1421430774, "post_id": 27989532, "comment_id": 44370632, "body": "<code>nSatisfy condition Leaf x</code> should be <code>nSatisfy condition (Leaf x)</code>"}, {"owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421495448, "post_id": 27989532, "comment_id": 44387733, "body": "check my update @bheklilr"}, {"owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421495464, "post_id": 27989532, "comment_id": 44387737, "body": "check my update @chi"}], "answers": [{"tags": [], "owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "is_accepted": false, "score": 3, "last_activity_date": 1421497557, "last_edit_date": 1421497557, "creation_date": 1421445066, "answer_id": 27993353, "question_id": 27989532, "link": "https://stackoverflow.com/questions/27989532/checking-how-many-elements-of-a-tree-satisfy-a-predicate/27993353#27993353", "title": "Checking how many elements of a tree satisfy a predicate", "body": "<p>That function is doing way too much at once: count, check a predicate and traverse a complex type.</p>\n\n<p>I suggest to write a function</p>\n\n<pre><code>listFromTree :: Tree -&gt; [Int]\n</code></pre>\n\n<p>and build your <code>nSatisfy</code> with <code>listFromTree</code> and the Prelude functions <code>length</code> and <code>filter</code>.</p>\n\n<hr>\n\n<p>Edit: OP found a working answer himself, now here my code:</p>\n\n<pre>\nnSatisfy' p = length . filter p . listFromTree\n\nlistFromTree :: Tree -> [Int]\nlistFromTree (Leaf x) = [x]\nlistFromTree (Node left x right) = listFromTree left ++ [x] ++ listFromTree right\n</pre>\n\n<p>Functions that check something, i.e. <code>a -&gt; Bool</code> are usually called <a href=\"http://en.wikipedia.org/wiki/Predicate_(mathematical_logic)\" rel=\"nofollow\">predicate</a> and shortened with <code>p</code> like in <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:filter\" rel=\"nofollow\">filter</a>. <code>n</code> is usually an integer, not a function.</p>\n"}, {"comments": [{"owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "edited": false, "score": 0, "creation_date": 1421494164, "post_id": 27994524, "comment_id": 44387466, "body": "why is this wrong ?                                                                                 <code>mapTree :: Int -&gt; Tree -&gt; Tree mapTree n Leaf x = Leaf (n x) mapTree n (Node left x right) = Node ((mapTree n left) n x (mapTree n right))</code>"}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 1, "last_activity_date": 1421451695, "creation_date": 1421451695, "answer_id": 27994524, "question_id": 27989532, "link": "https://stackoverflow.com/questions/27989532/checking-how-many-elements-of-a-tree-satisfy-a-predicate/27994524#27994524", "title": "Checking how many elements of a tree satisfy a predicate", "body": "<p>Well, here's a hint. You can solve this problem much more easily if you split it into three parts:</p>\n\n<ol>\n<li>A <code>mapTree :: (Int -&gt; Int) -&gt; Tree -&gt; Tree</code> function that applies the supplied function to every <code>Int</code> in the tree.</li>\n<li>A function that tests an individual <code>Int</code> and returns <code>1</code> if it satisfies your condition, <code>0</code> otherwise.</li>\n<li>A <code>sumTree :: Tree -&gt; Int</code> function that sums all the <code>Int</code>s in a tree.</li>\n</ol>\n\n<p>Then you can put these three parts together to solve your problem fairly easily.  And what's more, <code>mapTree</code> and <code>sumTree</code> will be useful for other problems.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1421501392, "creation_date": 1421501392, "answer_id": 27999950, "question_id": 27989532, "link": "https://stackoverflow.com/questions/27989532/checking-how-many-elements-of-a-tree-satisfy-a-predicate/27999950#27999950", "title": "Checking how many elements of a tree satisfy a predicate", "body": "<p>There's nothing <em>wrong</em> with your updated version. Luis Casillas and Franky, however, are encouraging you to think about breaking up the ideas in your code into the smallest possible pieces. This is generally the best way to deal with programming problems, for several reasons:</p>\n\n<ol>\n<li><p>The human brain can only think about so much at once. If you break up the problem into different pieces or layers and only think about one at a time, you have a much better chance of solving it correctly.</p></li>\n<li><p>You will create functions that you can reuse to solve other problems, and <em>ways of thinking</em> that you can reuse to solve other problems.</p></li>\n<li><p>You will be able to test each piece of the solution separately. In this case, the problem is simple enough to test the whole solution, but in most realistic cases, waiting until you have a complete solution before you start testing will lead you down the rabbit hole of \"I know it's wrong, but I don't know where\".</p></li>\n<li><p>Once you've broken your problem down into little pieces, you are much more likely to find that <em>other people have already solved those problems</em>. Sometime soon, your Haskell study will lead you to polymorphic data structures and functions. By generalizing your <code>Tree</code> type a little, you will gain the ability to use library functions like <code>toList</code>, <code>fmap</code>, and <code>sum</code>, building your solution from solution pieces that other people have written for you.</p></li>\n</ol>\n"}], "owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 600, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1421503740, "creation_date": 1421429536, "last_edit_date": 1421503740, "question_id": 27989532, "link": "https://stackoverflow.com/questions/27989532/checking-how-many-elements-of-a-tree-satisfy-a-predicate", "title": "Checking how many elements of a tree satisfy a predicate", "body": "<p>I want to count how many elements in a Tree \"respect\" a certain rule.</p>\n\n<p>For example:</p>\n\n<p>For the data type:</p>\n\n<pre><code>data Tree = Leaf Int | Node Tree Int Tree\n</code></pre>\n\n<p>and the function signature:</p>\n\n<pre><code>nSatisfy :: (Int-&gt;Bool) -&gt; Tree -&gt; Int\n</code></pre>\n\n<p>for the input:</p>\n\n<pre><code>(&gt;0) Tree \n</code></pre>\n\n<p>it should return the values of the tree that are (>0).</p>\n\n<p>Here's what i've tried:</p>\n\n<pre><code>nSatisfy :: (Int-&gt;Bool) -&gt; Tree -&gt; Int\nnSatisfy condition Leaf x = if condition x then 1 else 0\nnSatisfy condition (Node left x right)\n    |(if condition x then 1 else 0) + nSatisfy condition Tree\n    | otherwise = nSatisfy condition left || nSatisfy condition right\n</code></pre>\n\n<p>Any help?</p>\n\n<p>UPDATE:</p>\n\n<p>I found a much simpler way to do this:</p>\n\n<pre><code>nSatisfy :: (Int-&gt;Bool) -&gt; Tree -&gt; Int\nnSatisfy n (Leaf x) = if n x then 1 else 0\nnSatisfy n (Node left x right) = (if n x then 1 else 0) + (nSatisfy n left) + (nSatisfy n right)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1421428690, "post_id": 27989262, "comment_id": 44369564, "body": "That certainly is weird behavior, considering <code>length $ takeWhile ((== 6) . head . randomRs (1, 6) . mkStdGen) [1..]</code> is <code>53667</code>.  It takes that long to get a generator that doesn&#39;t return 6 as its first element.  I seem to remember others noticing some problems with <code>System.Random</code>&#39;s true (pseudo)randomness."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1421428782, "post_id": 27989262, "comment_id": 44369627, "body": "AFAIK, <code>StdGen</code> is just a simple linear congruential generator. I&#39;m curious but not massively surprised that it&#39;s not especially random near the beginning."}, {"owner": {"reputation": 17898, "user_id": 562440, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/4nedy.jpg?s=128&g=1", "display_name": "Raffael", "link": "https://stackoverflow.com/users/562440/raffael"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1421429096, "post_id": 27989262, "comment_id": 44369799, "body": "@MathematicalOrchid: a primitve implementation also came to my mind - though this is very extreme."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1421431192, "post_id": 27989430, "comment_id": 44370842, "body": "But all this is because <code>StdGen</code> is a horrible generator.  He is justified in expecting distinct random streams from distinct seeds no matter the value.  <code>random</code> is a broken package and we can&#39;t replace <code>StdGen</code> with the one from <code>tf-random</code> fast enough."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1421431258, "post_id": 27989430, "comment_id": 44370876, "body": "Yeah, I suppose you&#39;re right. Still \u2013 those <i>are</i> also horrible seeds... it&#39;s not really the purpose of a random generator to also be a good hash function in its first iteration, so one <i>should</i> use properly &quot;scattered&quot; seeds. (Again you might say, <code>mkStdGen</code> should include a proper hash function!)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1421429148, "creation_date": 1421429148, "answer_id": 27989430, "question_id": 27989262, "link": "https://stackoverflow.com/questions/27989262/weird-biased-random-number-generation-with-randomr/27989430#27989430", "title": "Weird biased random number generation with randomR", "body": "<p>Those seeds are all <em>very small numbers</em>, as in, much smaller than <code>maxBound :: Int</code>. They are thus very much not a representative sample of real-world internal states for the random generator. And basically, the first result of <code>randomR</code> is only \"as random as the seed\", WRT the respective ranges.</p>\n\n<p>If you want variation in the first result, you'll need to properly hash the seed, so the values are decently scattered across the permitted integer range. The easiest way to do that is to discard the first result.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1421431839, "post_id": 27989952, "comment_id": 44371160, "body": "At least the mersenne twister, though it&#39;s undoubtably useful for some applications, is with regard to this particular issue actually <i>worse</i> than a simple LCRG: similar start conditions will yield a whole strand of similar results until they diverge. It&#39;s pretty expensive to adress this issue (not to speak of the twister&#39;s rather absurdly big state...)"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 6, "last_activity_date": 1421431366, "last_edit_date": 1421431366, "creation_date": 1421431044, "answer_id": 27989952, "question_id": 27989262, "link": "https://stackoverflow.com/questions/27989262/weird-biased-random-number-generation-with-randomr/27989952#27989952", "title": "Weird biased random number generation with randomR", "body": "<p><code>System.Random.StdGen</code> is a horrible generator that should have been replaced long ago.  There are even quickcheck properties that are obviously false which still pass after thousands of checks because of the poor quality of <code>StdGen</code> - and that is done with good seeding.</p>\n\n<p>There are numerous strong generators both of a cryptographic variety and a statistical.  Consider using the <code>tf-random</code> package for one proposed replacement to <code>StdGen</code>, <code>DRBG</code> for a cryptographic random generator, or <code>mersenne-random-pure64</code> for a fast and statistically good generator.</p>\n"}], "owner": {"reputation": 17898, "user_id": 562440, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/4nedy.jpg?s=128&g=1", "display_name": "Raffael", "link": "https://stackoverflow.com/users/562440/raffael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 1, "accepted_answer_id": 27989952, "answer_count": 2, "score": 4, "last_activity_date": 1421431366, "creation_date": 1421428511, "last_edit_date": 1421428816, "question_id": 27989262, "link": "https://stackoverflow.com/questions/27989262/weird-biased-random-number-generation-with-randomr", "title": "Weird biased random number generation with randomR", "body": "<p>I assume I am doing something wrong here:</p>\n\n<pre><code>ghci&gt; take 10 $ randomRs (1,6) (mkStdGen 2)\n[6,4,1,5,4,2,2,2,2,3]\nghci&gt; take 10 $ randomRs (1,6) (mkStdGen 3)\n[6,4,5,4,4,2,1,1,5,1]\nghci&gt; take 10 $ randomRs (1,6) (mkStdGen 5)\n[6,2,2,1,3,2,5,1,5,4]\nghci&gt; take 10 $ randomRs (1,6) (mkStdGen 7)\n[6,1,4,5,3,2,3,6,6,6]\nghci&gt; take 10 $ randomRs (1,6) (mkStdGen 11)\n[6,4,4,6,1,2,6,5,6,5]\n</code></pre>\n\n<p>Why is the first random number always \"randomly\" 6 ... ?</p>\n\n<p>Same pattern with \"n\" for letters from a to z:</p>\n\n<pre><code>ghci&gt; take 10 $ randomRs ('a','z') (mkStdGen 13)\n\"nnofwbxbtw\"\nghci&gt; take 10 $ randomRs ('a','z') (mkStdGen 17)\n\"novkmtfugl\"\nghci&gt; take 10 $ randomRs ('a','z') (mkStdGen 19)\n\"nhurafjvey\"\n</code></pre>\n\n<p>I stumbled upon this working through LYAHFGG (chapter 9 on randomness) and really fail to make sense of it. I would expect no pattern across seeds.</p>\n"}, {"tags": ["forms", "haskell", "yesod"], "owner": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 113, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1421446171, "creation_date": 1421426123, "last_edit_date": 1421446171, "question_id": 27988535, "link": "https://stackoverflow.com/questions/27988535/evaluation-of-checkboxesfieldlist-in-yesod", "title": "Evaluation of checkBoxesFieldList in Yesod", "body": "<p>I'm struggling with the evaluation of <code>checkBoxesFieldList</code> of monadic forms in my Yesod appliction.</p>\n\n<p>I'm using these to create <code>n</code>-questions where <code>n</code> is the number of <code>checkBoxesFieldList</code>, with 4 answers (only <code>True</code>/<code>False</code>) each. But in comparison to the applicative forms, these already \"evaluate\" the result and tell me if I answered correctly.</p>\n\n<p>The problem occurs if there are boxes unchecked, or you check a wrong one out of four, so I can't know what wrong answer you checked.</p>\n\n<p>Example:</p>\n\n<ul>\n<li>If I checked only the first box, the result is <code>[False]</code>.</li>\n<li>If I checked only the second box wrong, the result is still <code>[False]</code>.</li>\n<li>If I checked only the third box (but it was the right answer), the result is [True].</li>\n</ul>\n\n<p>What I want to achieve: The result from <code>runFormPost</code> should give me a <code>[Bool]</code> based on: <code>checked -&gt; return True</code>, <code>unchecked -&gt; return False</code>.</p>\n\n<p>Example: </p>\n\n<p>If I checked only the first box wrong, the result should be <code>[True, False, False, False]</code></p>\n\n<p>I already had to customize the <code>checkboxesField</code> from the library, but I just can't find a way remove the evaluation.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>data Question = Question {\n   , identity   :: Text\n   , content    :: Text\n   , answerList :: [Answer]\n   , maxScore   :: Int\n  }\n\ndata Answer = Answer {\n   , identity  :: Text\n   , content   :: Text\n   , isCorrect :: Bool\n   , hint      :: Text\n  }\n\nzipAnswers :: [Answer] -&gt; [(Text, Bool)]\nzipAnswers [] = []\nzipAnswers ((Answer _ text val _):xs) = (text, val):zipAnswers xs\n\nlistEditMForm :: [Question] -&gt; Html -&gt; MForm Handler (FormResult ([FormResult (Maybe [Bool])]), Widget)\nlistEditMForm xs token = do\n      check_fields &lt;- forM xs (\\(Question _ content alist _ ) -&gt; mopt (checkboxesFieldList' $ zipAnswers alist) (fromString $ T.unpack content) Nothing)\n      let (check_results, check_views) = unzip check_fields\n      let numerated_views = zip ([1..]::[Int]) check_views\n      let widget = [whamlet|\n              ^{token}\n                &lt;ul class=\"tabs\"&gt;\n                   $forall (c,view) &lt;- numerated_views\n                       &lt;li&gt;\n                           &lt;input type=\"radio\" name=\"tabs\" id=\"tab#{fvId view}\"&gt;\n                           &lt;label for=\"tab#{fvId view}\"&gt;Q #{show c}\n                           &lt;div id=\"tab-content#{fvId view}\" class=\"tab-content animated fadeIn\"&gt;\n                             &lt;p class=boldWhite&gt; #{fvLabel view}: &lt;/p&gt;\n                             ^{fvInput view}\n                             &lt;br&gt;\n             &lt;input class=button type=submit value=\"Testing\"&gt;\n        |]\n      return ((FormSuccess check_results), widget)\n\n\n\n\ncheckboxesFieldList' :: (Eq a, RenderMessage site FormMessage, RenderMessage site msg) =&gt; [(msg, a)]\n                     -&gt; Field (HandlerT site IO) [a]\ncheckboxesFieldList' = checkboxesField' . optionsPairs\n\n\n\ncheckboxesField' :: (Eq a, RenderMessage site FormMessage)\n                 =&gt; HandlerT site IO (OptionList a)\n                 -&gt; Field (HandlerT site IO) [a]\ncheckboxesField' ioptlist = (multiSelectField ioptlist)\n    { fieldView =\n        \\theId name attrs val _ -&gt; do\n            opts &lt;- fmap olOptions $ handlerToWidget ioptlist\n            let optselected (Left _) _ = False\n                optselected (Right vals) opt = (optionInternalValue opt) `elem` vals\n            [whamlet|\n                  &lt;span ##{theId}&gt;\n                    $forall opt &lt;- opts\n                        &lt;label&gt;\n                          &lt;input type=checkbox name=#{name} value=#{optionExternalValue opt} *{attrs} :optselected val opt:checked&gt;\n                          &lt;span class=simpleWhite&gt; #{optionDisplay opt}\n                |]\n    }\n</code></pre>\n"}, {"tags": ["list", "haskell", "recursion"], "comments": [{"owner": {"reputation": 6581, "user_id": 461202, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f780ff5bfdfea60bdc260664f00b574?s=128&d=identicon&r=PG", "display_name": "zegkljan", "link": "https://stackoverflow.com/users/461202/zegkljan"}, "edited": false, "score": 4, "creation_date": 1421422163, "post_id": 27987261, "comment_id": 44365491, "body": "Do you insist on doing it by hand? Because you can use <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:filter\" rel=\"nofollow noreferrer\">filter</a> and <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:length\" rel=\"nofollow noreferrer\">length</a>."}], "answers": [{"tags": [], "owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "is_accepted": true, "score": 2, "last_activity_date": 1421422584, "last_edit_date": 1421422584, "creation_date": 1421422188, "answer_id": 27987322, "question_id": 27987261, "link": "https://stackoverflow.com/questions/27987261/verifying-condition-in-haskell/27987322#27987322", "title": "Verifying condition in Haskell", "body": "<p>You have to add the result, like this</p>\n\n<pre><code>countP :: [a] -&gt; (a -&gt; Bool) -&gt; Int\ncountP [] _ = 0\ncountP (x:xs) condition = (if condition x then 1 else 0) + (countP xs condition)\n</code></pre>\n\n<p>Whenever <code>condition x</code> evaluates to True, we use <code>1</code> otherwise <code>0</code> and we recursively call <code>countP</code> and add them.</p>\n\n<p>So, when you invoke it like this</p>\n\n<pre><code>countP [1, -2, 0, -1, 5] (&gt;0)\n</code></pre>\n\n<p>it will be evaluated <em>recursively</em>, like this</p>\n\n<pre><code>(if (&gt; 0) 1 then 1 else 0) + (countP [-2, 0, -1, 5] (&gt; 0))\n1 + (countP [-2, 0, -1, 5] (&gt; 0))\n1 + (if (&gt; 0) -1 then 1 else 0) + (countP [0, -1, 5] (&gt; 0))\n1 + 0 + (countP [0, -1, 5] (&gt; 0))\n1 + 0 + 0 + (countP [-1, 5] (&gt; 0))\n1 + 0 + 0 + 0 + (countP [5] (&gt; 0))\n1 + 0 + 0 + 0 + 1 + (countP [] (&gt; 0))\n1 + 0 + 0 + 0 + 1 + 0 = 2\n</code></pre>\n\n<p><code>(countP [] (&gt; 0))</code> is evaluated to be <code>0</code> because of our <em>base condition</em> of our recursive function <code>countP [] _ = 0</code>. It means that no matter what the second parameter is, if the first parameter is an empty list, then return 0.</p>\n"}, {"tags": [], "owner": {"reputation": 1774, "user_id": 2755759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9c7a38438d26b07e62c8ba358c3dd69?s=128&d=identicon&r=PG", "display_name": "Andrew Monshizadeh", "link": "https://stackoverflow.com/users/2755759/andrew-monshizadeh"}, "is_accepted": false, "score": 2, "last_activity_date": 1421422200, "creation_date": 1421422200, "answer_id": 27987328, "question_id": 27987261, "link": "https://stackoverflow.com/questions/27987261/verifying-condition-in-haskell/27987328#27987328", "title": "Verifying condition in Haskell", "body": "<p>You seem to be over thinking this. You can use some of the Prelude provided functions and compose them to produce the result:</p>\n\n<pre><code>length $ filter (&gt;0) [1,-2,0,-1,5]\n</code></pre>\n\n<p><code>length</code> will take a list and tell you how long it is.\n<code>filter</code> takes a predicate and tells you how many elements in a provided list match that predicate.\nSo if you get the <code>length</code> of the <code>filter</code>ed list, you are set.</p>\n\n<pre><code>countP xs f = length $ filter f xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 1, "last_activity_date": 1421422213, "creation_date": 1421422213, "answer_id": 27987332, "question_id": 27987261, "link": "https://stackoverflow.com/questions/27987261/verifying-condition-in-haskell/27987332#27987332", "title": "Verifying condition in Haskell", "body": "<p>There is a function specifically for counting the number of things in a list, and it's called <code>length</code>.  You could do something like</p>\n\n<pre><code>countP' [] _ = []\ncountP' (x:xs) condition = if condition x then 1 : countP' xs condition else countP' xs condition\n\ncountP xs condition = length (countP' xs condition)\n</code></pre>\n\n<p>However, this takes two functions and it does extra work.  Instead you could work directly with <code>Int</code>s instead of <code>[Int]</code>s:</p>\n\n<pre><code>countP :: [a] -&gt; (a -&gt; Bool) -&gt; Int\ncountP [] _ = 0\ncountP (x:xs) condition = ...\n</code></pre>\n\n<p>I'll still let you fill in the blanks here, know that you are not very far from the correct solution with what you already have.</p>\n\n<p>However, if I were going to implement this code in a project, I would simply reach for <code>length</code> and <code>filter</code>:</p>\n\n<pre><code>countP xs condition = length (filter condition xs)\n</code></pre>\n\n<p>This is what I would call the idiomatic definition (up to argument order).</p>\n"}], "owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 27987322, "answer_count": 3, "score": 2, "last_activity_date": 1421422584, "creation_date": 1421421997, "last_edit_date": 1421422517, "question_id": 27987261, "link": "https://stackoverflow.com/questions/27987261/verifying-condition-in-haskell", "title": "Verifying condition in Haskell", "body": "<p>I need a function that checks a condition on a list.</p>\n\n<p>For example:</p>\n\n<pre><code>countP :: [a] -&gt; (a -&gt; Bool) -&gt; Int\n</code></pre>\n\n<p>with the input:</p>\n\n<pre><code>countP [1,-2,0,-1,5] (&gt;0)\n</code></pre>\n\n<p>should return 2, because there are two numbers greater than zero.</p>\n\n<p>Here's what i've done so far:</p>\n\n<pre><code>countP :: [a] -&gt; (a -&gt; Bool) -&gt; Int\ncountP [] _ = []\ncountP (x:xs) condition = if condition x then 1:countP xs condition else countP xs condition \n</code></pre>\n\n<p>It's returning [1,1] instead of the number two. It must be recursive.</p>\n\n<p>How can i do this ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1421415738, "post_id": 27985140, "comment_id": 44361457, "body": "You need to apply the <code>(!!)</code> operator twice, since you have a list of lists: <code>getCell nss row col = nss !! row !! col</code>."}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 4, "creation_date": 1421416568, "post_id": 27985140, "comment_id": 44361913, "body": "While not directly relevant to your question, be aware that defining a matrix as a list of lists of elements is silly for anyting other than pedagogical reasons or algorithms that consume the entire matrix from start to finish (row-wise). Haskell lists are linked lists that index in O(n) time. For constant-time indexing, build your matrix using <a href=\"https://hackage.haskell.org/package/vector\" rel=\"nofollow noreferrer\"><code>Vector</code></a>s instead."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1421417916, "post_id": 27985140, "comment_id": 44362704, "body": "Elaborating on the @gspr comment: using <code>(!!)</code> to access list elements is arguably the worst method. Typically you <code>map,filter,zip,fold</code> to scan a list, or just use recursion."}], "owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "closed_date": 1421421309, "answer_count": 0, "score": 0, "last_activity_date": 1421415290, "creation_date": 1421415290, "question_id": 27985140, "link": "https://stackoverflow.com/questions/27985140/getting-an-element-from-a-matrix-in-haskell", "closed_reason": "Duplicate", "title": "Getting an element from a matrix in Haskell", "body": "<p>If i want to get a specific element from a matrix, how would i do that ?</p>\n\n<p>For example: </p>\n\n<pre><code>getCell :: [[Int]] -&gt; Int -&gt; Int -&gt; Int\n</code></pre>\n\n<p>with the input:</p>\n\n<pre><code>getCell [[1,2,3,4],[2,3,4,5]] 1 2\n</code></pre>\n\n<p>should return the value 4 (indexes start from zero).</p>\n\n<p>I'm familiarized with the !! operator, but here it is a different scenario.</p>\n\n<p>Any help?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421404555, "post_id": 27981907, "comment_id": 44355338, "body": "I don&#39;t understand your question: can you elaborate? Can&#39;t you define some helper function such as <code>prepend (Set set) x = Set (x:set)</code> to help with your task?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1421404631, "post_id": 27981907, "comment_id": 44355379, "body": "What does <code>difference</code> actually return?"}, {"owner": {"reputation": 12289, "user_id": 3764804, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fZQON.png?s=128&g=1", "display_name": "BullyWiiPlaza", "link": "https://stackoverflow.com/users/3764804/bullywiiplaza"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1421404968, "post_id": 27981907, "comment_id": 44355551, "body": "@MathematicalOrchid: It return the difference of two sets e.g. all elements from the right set are removed from the left one   chi: In the recursion I need to iterate over the list inside the <code>Set</code> but prepend the leading elements before the recursion so that they won&#39;t be extracted over and over again"}], "answers": [{"comments": [{"owner": {"reputation": 12289, "user_id": 3764804, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fZQON.png?s=128&g=1", "display_name": "BullyWiiPlaza", "link": "https://stackoverflow.com/users/3764804/bullywiiplaza"}, "edited": false, "score": 0, "creation_date": 1421406076, "post_id": 27982357, "comment_id": 44356142, "body": "Doesn&#39;t work because <code>difference</code> returns a <code>Set a</code> and you can&#39;t prepend a tuple to that. Also difference takes a <code>Set a</code> and a <code>Set a</code> but you&#39;re giving it a tuple list and a <code>Set a</code>."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 12289, "user_id": 3764804, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fZQON.png?s=128&g=1", "display_name": "BullyWiiPlaza", "link": "https://stackoverflow.com/users/3764804/bullywiiplaza"}, "edited": false, "score": 0, "creation_date": 1421409611, "post_id": 27982357, "comment_id": 44358133, "body": "@user3764804 How about now?"}, {"owner": {"reputation": 12289, "user_id": 3764804, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fZQON.png?s=128&g=1", "display_name": "BullyWiiPlaza", "link": "https://stackoverflow.com/users/3764804/bullywiiplaza"}, "edited": false, "score": 0, "creation_date": 1421411207, "post_id": 27982357, "comment_id": 44359016, "body": "Couldn&#39;t match expected type <code>Set a</code> with actual type <code>[(a, Integer)]</code> at <code>difference set (Set set&#39;)</code>"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 12289, "user_id": 3764804, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fZQON.png?s=128&g=1", "display_name": "BullyWiiPlaza", "link": "https://stackoverflow.com/users/3764804/bullywiiplaza"}, "edited": false, "score": 2, "creation_date": 1421411285, "post_id": 27982357, "comment_id": 44359066, "body": "Without seeing more of your code (.e.g, the type signature for <code>difference</code>, the definition of <code>Set</code>, etc.) it&#39;s difficult to tell what&#39;s up."}, {"owner": {"reputation": 12289, "user_id": 3764804, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fZQON.png?s=128&g=1", "display_name": "BullyWiiPlaza", "link": "https://stackoverflow.com/users/3764804/bullywiiplaza"}, "edited": false, "score": 0, "creation_date": 1421411616, "post_id": 27982357, "comment_id": 44359254, "body": "You don&#39;t need to know more to get the syntax right but I solved it anyway using anti-patterns (indexes).  Here are the requested information though: <code>data Set set = Set [(set, Integer)] deriving (Eq, Show)</code> <code>difference :: Ord a =&gt; Set a -&gt; Set a -&gt; Set a</code>"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 1, "last_activity_date": 1421409590, "last_edit_date": 1421409590, "creation_date": 1421405520, "answer_id": 27982357, "question_id": 27981907, "link": "https://stackoverflow.com/questions/27981907/cons-data-type-outside-recursion/27982357#27982357", "title": "Cons Data Type Outside Recursion", "body": "<p>It looks like what you <em>might</em> be looking for is</p>\n\n<pre><code>| ... = Set ((element, count) : difference set (Set set'))\n</code></pre>\n\n<p>No? How about this:</p>\n\n<pre><code>| ... = let Set set2 = difference set (Set set') in Set ((element, count) : set2)\n</code></pre>\n\n<p>(I'm assuming that <code>Set</code> is just <code>data Set x = Set [x]</code>.)</p>\n"}], "owner": {"reputation": 12289, "user_id": 3764804, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fZQON.png?s=128&g=1", "display_name": "BullyWiiPlaza", "link": "https://stackoverflow.com/users/3764804/bullywiiplaza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1421409590, "creation_date": 1421404067, "last_edit_date": 1421405059, "question_id": 27981907, "link": "https://stackoverflow.com/questions/27981907/cons-data-type-outside-recursion", "title": "Cons Data Type Outside Recursion", "body": "<p>I'm trying to write a function which recursively goes through a data structure which internally uses a list once without modifying it. I'm having trouble prepending the element again outside of the recursion so that it won't dead loop.</p>\n\n<pre><code>difference (Set ((element, count) : set)) (MultiSet set')\n    | ... = difference (Set ((element, count) : set)) (Set set') -- Prepends tuple inside the recursion\n    | ...\n</code></pre>\n\n<p>What I need is a way of prepending the tuple (element, count) in front of the <code>set</code> without including it in the recursive call from <code>difference</code>.</p>\n\n<p>What's an easy/standard way of doing this?</p>\n"}, {"tags": ["haskell", "stm"], "comments": [{"owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "edited": false, "score": 2, "creation_date": 1421402402, "post_id": 27981259, "comment_id": 44354076, "body": "I think this question is rather too broad for StackOverflow - can you try to narrow it down?"}, {"owner": {"reputation": 345, "user_id": 3996781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ebc9d5cf8ef442da813c0076fc2b17f8?s=128&d=identicon&r=PG&f=1", "display_name": "Ammlan Ghosh", "link": "https://stackoverflow.com/users/3996781/ammlan-ghosh"}, "reply_to_user": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "edited": false, "score": 0, "creation_date": 1421402553, "post_id": 27981259, "comment_id": 44354156, "body": "@GaneshSittampalam How to implement non-blocking STM using Haskell, where second transaction does not require to wait."}, {"owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "edited": false, "score": 0, "creation_date": 1421403362, "post_id": 27981259, "comment_id": 44354665, "body": "For example ask about specific problems you&#39;re having doing that, details of what you&#39;ve tried/what&#39;s not working, etc."}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 1, "creation_date": 1421404053, "post_id": 27981259, "comment_id": 44355056, "body": "As far as I know the stm package in hackage is already obstruction free."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1421404201, "post_id": 27981259, "comment_id": 44355154, "body": "AFAIK, Haskell&#39;s STM implementation provides no fairness guarantees:a transaction is allow to starve indefinitely. Your question is about rewriting the implementation so that certain transactions have higher priority than the others, so that they can not only not starve, but they can not even retry, being run in a wait-free fashion. This looks as an interesting large project. Unless some library already provides something like that, I don&#39;t think a SO answer can include all of this STM redesign."}, {"owner": {"reputation": 345, "user_id": 3996781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ebc9d5cf8ef442da813c0076fc2b17f8?s=128&d=identicon&r=PG&f=1", "display_name": "Ammlan Ghosh", "link": "https://stackoverflow.com/users/3996781/ammlan-ghosh"}, "reply_to_user": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1421647467, "post_id": 27981259, "comment_id": 44424156, "body": "@JeremyList, how to implement new contention management policy in Haskell STM?"}], "answers": [{"comments": [{"owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "edited": false, "score": 0, "creation_date": 1421413193, "post_id": 27982321, "comment_id": 44360108, "body": "This might be better as a comment than an answer - the only content that might answer the question is in the link."}, {"owner": {"reputation": 345, "user_id": 3996781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ebc9d5cf8ef442da813c0076fc2b17f8?s=128&d=identicon&r=PG&f=1", "display_name": "Ammlan Ghosh", "link": "https://stackoverflow.com/users/3996781/ammlan-ghosh"}, "edited": false, "score": 0, "creation_date": 1421647994, "post_id": 27982321, "comment_id": 44424294, "body": "@MathematicalOrchid, thanks for your answer.  I was trying to implement contention management policies [link] (<a href=\"https://www.cs.rochester.edu/u/scott/papers/2005_PODC_CM.pdf\" rel=\"nofollow noreferrer\">cs.rochester.edu/u/scott/papers/2005_PODC_CM.pdf</a>) in Haskell those were used in Dynamic Software Transactional Memory. Let me read the PDF you have linked; I hope it would be helpful for me."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 2, "last_activity_date": 1421409804, "last_edit_date": 1421409804, "creation_date": 1421405408, "answer_id": 27982321, "question_id": 27981259, "link": "https://stackoverflow.com/questions/27981259/haskell-stm-how-to-implement-obstruction-free-stm-using-haskell/27982321#27982321", "title": "Haskell STM : How to implement Obstruction Free STM using Haskell?", "body": "<p>First: The default STM implementation does not \"block\" conflicting transactions. Rather, every transaction runs at full speed, and conflicts are only detected at the commit stage. When a transaction tries to commit, it either succeeds, or it gets aborted and <em>immediately</em> restarts the transaction. It does not at any point \"block\". (You're perhaps thinking of the <code>retry</code> primitive, which <em>does</em> block transactions.)</p>\n\n<p>Second: There was an issue of The Monad Reader (no, I don't recall which number) which described an implementation of STM where transaction conflicts <em>immediately</em> rollback one of the conflicting transactions (which one depends on timing). You may find it interesting. (On the other hand, the code isn't accessible, so...)</p>\n\n<p>Edit: It was <a href=\"https://themonadreader.files.wordpress.com/2010/01/issue15.pdf\" rel=\"nofollow\">issue 15</a> (final section).</p>\n"}], "owner": {"reputation": 345, "user_id": 3996781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ebc9d5cf8ef442da813c0076fc2b17f8?s=128&d=identicon&r=PG&f=1", "display_name": "Ammlan Ghosh", "link": "https://stackoverflow.com/users/3996781/ammlan-ghosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "closed_date": 1422431739, "accepted_answer_id": 27982321, "answer_count": 1, "score": -2, "last_activity_date": 1421912231, "creation_date": 1421401983, "last_edit_date": 1421912231, "question_id": 27981259, "link": "https://stackoverflow.com/questions/27981259/haskell-stm-how-to-implement-obstruction-free-stm-using-haskell", "closed_reason": "Needs more focus", "title": "Haskell STM : How to implement Obstruction Free STM using Haskell?", "body": "<p>I want to implement Obstruction Free STM (OFTM) using Haskell <strong>to benchmark various available contention management policies.</strong> For example, a Transaction T1 acquires a Tvar, say X and yet to commit. Now another Transaction T2 wants to access X. In Haskell STM, T2 is being blocked and retries later. I want that Transaction will execute in non-blocking fashion where T2 will abort T1 or <strong>back off for some arbitrary time by consulting contention manager</strong>. And T1 will retry later on.  As it happens in case of Aggressive contention manager, which always chooses to abort an enemy transaction at conflict time.\nIt is just an experiment I want to do.\nThanks in advance.   </p>\n"}]