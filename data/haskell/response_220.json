[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1553733166, "post_id": 55388226, "comment_id": 97498725, "body": "The only instance of <code>MonadHttp</code> is <code>Req</code>. The way to run a <code>Req</code> action is <code>runReq</code>. So instead of trying to use <code>liftIO</code> to raise your <code>downloadFile</code> from <code>IO</code> to something, which can&#39;t work because <code>downloadFile</code> isn&#39;t an <code>IO</code> action, use <code>runReq</code> to lower your <code>downloadFile</code> from something to <code>IO</code>."}, {"owner": {"reputation": 677, "user_id": 2636579, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/b615adca01077d21372bbbed1b998617?s=128&d=identicon&r=PG", "display_name": "reallymemorable", "link": "https://stackoverflow.com/users/2636579/reallymemorable"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553790229, "post_id": 55388226, "comment_id": 97525523, "body": "I tried this, but clearly I am still doing something wrong: <code>fmap concat $ mapM (mapConcurrently (runReq downloadFile)) wtf</code>"}, {"owner": {"reputation": 677, "user_id": 2636579, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/b615adca01077d21372bbbed1b998617?s=128&d=identicon&r=PG", "display_name": "reallymemorable", "link": "https://stackoverflow.com/users/2636579/reallymemorable"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553791339, "post_id": 55388226, "comment_id": 97526154, "body": "Trying to use defaultHttpConfig: <code>fmap concat $ mapM (mapConcurrently (runReq . (defaultHttpConfig downloadFile))) wtf</code>"}], "owner": {"reputation": 677, "user_id": 2636579, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/b615adca01077d21372bbbed1b998617?s=128&d=identicon&r=PG", "display_name": "reallymemorable", "link": "https://stackoverflow.com/users/2636579/reallymemorable"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1553731032, "creation_date": 1553731032, "question_id": 55388226, "link": "https://stackoverflow.com/questions/55388226/using-haskells-req-library-with-scalpel-to-save-files-to-client", "title": "Using Haskell&#39;s Req library with Scalpel to save files to client", "body": "<p>I am 99% of the way there on a Haskell / Scalpel scraper to pull down thousands of .gz files in batches and store them locally on my client.</p>\n\n<p>I am trying to now take the chunked <code>[[String]]</code>s and get them into IO so they can be saved.</p>\n\n<p>I am using <code>import Network.HTTP.Req</code>.</p>\n\n<pre><code>-- This is the argument for the downloadFiles function\nchunkLinks :: IO [[String]]\nchunkLinks = fmap (chunksOf 10) filterNonGz\n\n-- THIS IS WHAT YOU EXECUTE \ndownloadFile :: (MonadHttp m) =&gt; String -&gt; m ()\ndownloadFile url = do\n    -- Pull them into memory\n    contents &lt;- req GET (https (T.pack url)) NoReqBody bsResponse mempty\n\n    -- Get the filename itself\n    let fileName = head $ reverse $ T.splitOn \"/\" (T.pack url)\n\n    -- Write them to the client (the filename will be the url)\n    liftIO $ BSS.writeFile (dataDir ++ (T.unpack fileName)) (responseBody contents)\n\n\ndataDir = \"./Data/LODES/\"\n\neatChunks :: (MonadHttp m) =&gt;  m [()]\neatChunks = do\n    (wtf :: [[String]]) &lt;- liftIO $ (take (5) &lt;$&gt; chunkLinks)\n    fmap concat $ liftIO $ mapM (liftIO . mapConcurrently (liftIO . downloadFile)) wtf\n</code></pre>\n\n<p>I am getting an error on <code>downloadFile</code> in the last line. </p>\n\n<p>The error is:</p>\n\n<pre><code>\u2022 Could not deduce (MonadHttp IO)\n    arising from a use of \u2018downloadFile\u2019\n  from the context: MonadHttp m\n    bound by the type signature for:\n               eatChunks :: forall (m :: * -&gt; *). MonadHttp m =&gt; m [()]\n    at /private/var/folders/70/kchtzk4j0hs398f95ywd78x00000gn/T/ghc-mod39229/UsCensusDataLodesScraper39228-2281.hs:195:1-37\n</code></pre>\n\n<p>Please excuse the <code>liftIO</code>s littered about.  They are desperate attempts to get this to work...</p>\n\n<p>Does anyone know what to do next?</p>\n\n<p>For reference, the output of <code>chunkLinks</code> looks like this:</p>\n\n<pre><code>[[\"https://lehd.ces.census.gov/data/lodes/LODES7/ak/od/ak_od_aux_JT00_2002.csv.gz\",\"https://lehd.ces.census.gov/data/lodes/LODES7/ak/od/ak_od_aux_JT00_2003.csv.gz\",\"https://lehd.ces.census.gov/data/lodes/LODES7/ak/od/ak_od_aux_JT00_2004.csv.gz\",\"https://lehd.ces.census.gov/data/lodes/LODES7/ak/od/ak_od_aux_JT00_2005.csv.gz\",\"https://lehd.ces.census.gov/data/lodes/LODES7/ak/od/ak_od_aux_JT00_2006.csv.gz\",\"https://lehd.ces.census.gov/data/lodes/LODES7/ak/od/ak_od_aux_JT00_2007.csv.gz\",\"https://lehd.ces.census.gov/data/lodes/LODES7/ak/od/ak_od_aux_JT00_2008.csv.gz\",\"https://lehd.ces.census.gov/data/lodes/LODES7/ak/od/ak_od_aux_JT00_2009.csv.gz\",\"https://lehd.ces.census.gov/data/lodes/LODES7/ak/od/ak_od_aux_JT00_2010.csv.gz\",\"https://lehd.ces.census.gov/data/lodes/LODES7/ak/od/ak_od_aux_JT00_2011.csv.gz\"], ...etc.\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "lazy-evaluation"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 3, "creation_date": 1553731850, "post_id": 55388175, "comment_id": 97498435, "body": "This area of Haskell (space/time efficiency) isn&#39;t my strong point, but I think that if you rewrite the folding function as <code>(\\x acc -&gt; p x &amp;&amp; acc)</code> it then will not need to   scan the full list if it finds a <code>False</code> value, since this variant turns <code>[e1, e2, e3, e4, ...]</code> into <code>p e1 &amp;&amp; (p e2 &amp;&amp; (p e3 &amp;&amp; (p e4 &amp;&amp; ...)))</code>, which short-circuits if anything returns <code>False</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 4, "creation_date": 1553731913, "post_id": 55388175, "comment_id": 97498451, "body": "(1) Side note: <code>foldr</code> is also recursive. A common term for talking about solutions like your second one, in contrast to ones using functions like <code>foldr</code>, is &quot;explicit recursion&quot;. (2) As @bradrn notes, your first solution will short-circuit too if you switch the order of the arguments to <code>(&amp;&amp;)</code>. That would be well worth exploring in an answer here."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1553738053, "post_id": 55388175, "comment_id": 97499727, "body": "On another note, tail recursion in Haskell must be thought of accounting for laziness. Relevant Q&amp;As: <a href=\"https://stackoverflow.com/q/13042353/2751851\"><i>Does Haskell have tail-recursive optimization?</i></a>; <a href=\"https://stackoverflow.com/q/3429634/2751851\"><i>foldl is tail recursive, so how come foldr runs faster than foldl?</i></a>."}], "answers": [{"comments": [{"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553736239, "post_id": 55388631, "comment_id": 97499387, "body": "Aren&#39;t stream fusion rules technically a specific instance of rewrite rules, that have applied to the Vector library, but not in fact used in eg. foldr?"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553736882, "post_id": 55388631, "comment_id": 97499492, "body": "@ATayler They&#39;re used in foldr. See the <code>fold&#47;build</code> rule in <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/src/&hellip;</a>"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553737342, "post_id": 55388631, "comment_id": 97499584, "body": "That is a rewrite rule, not a stream fusion rule. Contrast to <a href=\"http://hackage.haskell.org/package/stream-fusion-0.1.2.5/\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/stream-fusion-0.1.2.5</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 1, "creation_date": 1553737545, "post_id": 55388631, "comment_id": 97499623, "body": "@ATayler and JosephSible: I believe this is a matter of terminology. Joseph&#39;s answer refers to <a href=\"https://downloads.haskell.org/~ghc/8.6.4/docs/html/users_guide/glasgow_exts.html#list-fusion\" rel=\"nofollow noreferrer\">what the User&#39;s Guide calls &quot;list fusion&quot;</a>. AFAIK, &quot;Stream fusion&quot; indeed refers to a different, if related, technique -- <a href=\"https://www.stackbuilders.com/tutorials/haskell/ghc-optimization-and-fusion/\" rel=\"nofollow noreferrer\">this post</a> looks like a good summary of the whole matter."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 2, "last_activity_date": 1553738359, "last_edit_date": 1553738359, "creation_date": 1553734542, "answer_id": 55388631, "question_id": 55388175, "link": "https://stackoverflow.com/questions/55388175/recursion-or-fold-in-haskell/55388631#55388631", "title": "Recursion or fold in haskell", "body": "<p><code>foldr</code> is defined as follows:</p>\n\n<pre><code>foldr k z = go\n          where\n            go []     = z\n            go (y:ys) = y `k` go ys\n</code></pre>\n\n<p>If you inline this definition into <code>all1</code>, you'll see that the result is recursive too. Therefore, it just isn't <em>explicitly</em> recursive, since it hides the recursion inside of <code>foldr</code>.</p>\n\n<p>The <code>foldr</code> variant is both more space efficient and more time efficient, as <code>foldr</code> has rules for <a href=\"https://downloads.haskell.org/~ghc/8.6.4/docs/html/users_guide/glasgow_exts.html#list-fusion\" rel=\"nofollow noreferrer\">list fusion</a> (an optimization to remove intermediate lists), which <code>all1</code> gets for free.</p>\n\n<p>To make short-circuiting work, just change <code>acc &amp;&amp; p x</code> to <code>p x &amp;&amp; acc</code>. With <code>foldr</code>, this will stop going over the list as soon as it gets a <code>False</code> result. With <code>foldl</code> or <code>foldl'</code>, even if your folding function short-circuits, it needs to walk the rest of the list anyway.</p>\n\n<p>Summary: Using <code>foldr</code> is more efficient than either <code>foldl</code>, <code>foldl'</code>, or explicitly recursing in your own function. A nice easy test of this is to do <code>+set :s</code> in GHCi, and then compare performance on the list <code>(False:replicate 10000000 True)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1553877749, "last_edit_date": 1553877749, "creation_date": 1553736809, "answer_id": 55388910, "question_id": 55388175, "link": "https://stackoverflow.com/questions/55388175/recursion-or-fold-in-haskell/55388910#55388910", "title": "Recursion or fold in haskell", "body": "<p>Let's consider, brick by brick, whether a <code>foldr</code>-based solution can short-circuit. To begin with, <code>(&amp;&amp;)</code> is defined <a href=\"https://www.stackage.org/haddock/lts-13.14/ghc-prim-0.5.3/src/GHC-Classes.html#%26%26\" rel=\"nofollow noreferrer\">like this</a>:</p>\n\n<pre><code>(&amp;&amp;)                    :: Bool -&gt; Bool -&gt; Bool\nTrue  &amp;&amp; x              =  x\nFalse &amp;&amp; _              =  False\n</code></pre>\n\n<p>Given the second clause, and thanks to laziness, the second argument to <code>(&amp;&amp;)</code> is ignored if the first one is <code>False</code> -- in other words, it short-circuits.</p>\n\n<p>Next, <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#foldr\" rel=\"nofollow noreferrer\">this is <code>foldr</code> for lists</a>:</p>\n\n<pre><code>foldr            :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldr k z = go\n          where\n            go []     = z\n            go (y:ys) = y `k` go ys\n</code></pre>\n\n<p>If <code>y `k` go ys</code> can be evaluated without looking at <code>go ys</code>, there will be no recursive call, and the fold as a whole will shortcut.</p>\n\n<p>In <code>all1</code>, the binary operation is <code>\\x acc -&gt; acc &amp;&amp; p x</code>. That isn't good enough for our purposes, for passing <code>acc</code> (which corresponds the <code>go ys</code> in the <code>foldr</code> definition) as the first, short-circuiting, argument of <code>(&amp;&amp;)</code> leads to the whole list being consumed regardless of what <code>p x</code> turns out to be. Not all is lost, though: swapping the arguments to <code>(&amp;&amp;)</code>...</p>\n\n<pre><code>all3 :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nall3 p xs = foldr (\\x acc -&gt; p x &amp;&amp; acc) True xs\n</code></pre>\n\n<p>... gives us the desired short-circuiting.</p>\n"}], "owner": {"reputation": 7465, "user_id": 319633, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/b6bdb2180f34d08366cce6271d913780?s=128&d=identicon&r=PG", "display_name": "Tallmaris", "link": "https://stackoverflow.com/users/319633/tallmaris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 797, "favorite_count": 0, "accepted_answer_id": 55388910, "answer_count": 2, "score": 4, "last_activity_date": 1578823858, "creation_date": 1553730643, "last_edit_date": 1578823858, "question_id": 55388175, "link": "https://stackoverflow.com/questions/55388175/recursion-or-fold-in-haskell", "title": "Recursion or fold in haskell", "body": "<p>I am studying a bit of functional programming using haskell and I am trying to go through some concepts by re-implementing some library functions.</p>\n\n<p>I have a question though mainly in regards to when it is better to choose recursion over iteration. For example when reimplementing the \"all\" function I can choose between:</p>\n\n<pre><code>all1 :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nall1 p xs = foldr (\\x acc -&gt; acc &amp;&amp; p x) True xs \n\nall2 :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nall2 p (x:xs) \n  | p x == False = False\n  | otherwise    = all2 p xs\n</code></pre>\n\n<p>The way I look at it, the recursive one should be more time efficient since it will stop at the first non-matching entry, while the folding one is more space efficient (I think, still not clear about tail recursion optimisation in haskell) but it will always scan the full list, unless there is some clever optimisation done by looking at the fact that <code>false</code> will always give <code>false</code> once it's there.</p>\n\n<p>So, is this compromise something which is always there? Am I misunderstanding something in the way recursion and folding work?</p>\n"}, {"tags": ["haskell", "types", "typechecking", "applicative"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 7, "creation_date": 1553731666, "post_id": 55388119, "comment_id": 97498390, "body": "Your type annotation is not more general, because it restricts <code>&lt;*&gt;</code> and <code>pure</code> to work in the same Applicative, and with the same <code>a</code>. The more general type GHC derived allows for two different Applicatives. So you were right to suspect that by adding a (less general) signature you allowed a non-infinite type to be inferred."}], "answers": [{"comments": [{"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 2, "creation_date": 1553736996, "post_id": 55388309, "comment_id": 97499519, "body": "The program still runs into an infinite type error when you compile with <code>NoMonomorphismRestriction</code>, so I don&#39;t think what is said about the monomorphism restriction is quite correct."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1553770321, "post_id": 55388309, "comment_id": 97511727, "body": "Interesting. I made a simpler example that has the same less-general-than-possible behaviour. Would you make this into a question, or shall I?"}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1553789809, "post_id": 55388309, "comment_id": 97525285, "body": "You can go ahead and make the question, I think you have a firmer grasp on this than I do."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1553791038, "post_id": 55388309, "comment_id": 97525971, "body": "<a href=\"https://stackoverflow.com/questions/55402733/why-does-ghc-infer-a-monomorphic-type-here-even-with-monomorphismrestriction-di\" title=\"why does ghc infer a monomorphic type here even with monomorphismrestriction di\">stackoverflow.com/questions/55402733/&hellip;</a>"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1553770264, "last_edit_date": 1553770264, "creation_date": 1553731654, "answer_id": 55388309, "question_id": 55388119, "link": "https://stackoverflow.com/questions/55388119/resolving-the-type-of-f-f-pure/55388309#55388309", "title": "Resolving the type of `f = f (&lt;*&gt;) pure`", "body": "<p>The confusion is caused by Haskell's type classes and the fact that functions-from-fixed-type are an instance of <code>Applicative</code> (aka the reader monad). It becomes clearer if you write it out with specialised version:</p>\n\n<pre><code>type Reader a b = a -&gt; b\n\nfmapFn :: (a -&gt; b) -&gt; Reader c a -&gt; Reader c b\nfmapFn = fmap\n    -- \u2261 liftA\n    -- \u2261 (.)\n\nfmap' :: Applicative f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nfmap' = fmapFn (&lt;*&gt;) pure\n      \u2261 (&lt;*&gt;) . pure\n      \u2261 \\\u03c6 -&gt; (&lt;*&gt;) (pure \u03c6)\n      \u2261 \\\u03c6 fa -&gt; pure \u03c6 &lt;*&gt; fa\n</code></pre>\n\n<p>And at this point it requires the applicative law</p>\n\n<pre><code>fmap f x = pure f &lt;*&gt; x\n</code></pre>\n\n<p>so</p>\n\n<pre><code> fmap' \u2261 \\\u03c6 fa -&gt; fmap \u03c6 fa\n       \u2261 fmap\n</code></pre>\n\n<p><em>duh</em>. But the point is, in the definition <code>fmap' = fmap' (&lt;*&gt;) pure</code>, the <code>(&lt;*&gt;)</code> and <code>pure</code> belong to the functor for which you want this to eventually work, but the <code>fmap'</code> you're <em>using</em> actually always belongs to the function functor. That's ok in Haskell: the definition <em>is</em> polymorphic after all, so if the top-level knows how to do this for <em>all</em> functors then you can certainly also use it for the function functor. (Leaving aside the issue of nontermination due to circular dependency...)\nHowever, because you're defining it in the form <code>fmap' = ...</code>, <del>the <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow noreferrer\">monomorphism restriction</a> kicks in: if you write  <code>fmap' = fmap' (&lt;*&gt;) pure</code> without signature at the top-level,</del> the compiler tries to find a concrete type for which this should work, in particular a single, concrete functor. But whatever concrete type you choose, this will then be a different type from the <code>fmapFn</code> that you're trying to use yourself. So, this definition only compiles with an explicit signature that forces it to be polymorphic <del>(or alternatively, with the <code>-XNoMonomorphismRestriction</code> flag, which causes the compiler to pick the polymorphic type without explicit instruction)</del>.</p>\n\n<p><sup><em>EDIT</em></sup> Surprisingly it turns out it is <em>not</em> the monomorphism restriction what tries to make the type less polymorphic than necessary. To figure out what it is, let's try to find a simpler example with the same problem. First attempt:</p>\n\n<pre><code>fromFloat :: RealFrac a =&gt; Float -&gt; a\ntoFloat :: RealFrac a =&gt; a -&gt; Float\nfromFloat = realToFrac\ntoFloat   = realToFrac\n\ns = fromFloat . s . toFloat\n</code></pre>\n\n<p>(I chose <code>Float</code> because it's not a <code>default</code> type that the compiler might pick by itself.)\n<br>Turns out this compiles just fine, but instead of the most general type</p>\n\n<pre><code>s' :: (RealFrac a, RealFrac b) =&gt; a -&gt; b\ns' = fromFloat . s' . toFloat\n</code></pre>\n\n<p>it just picks up the simpler</p>\n\n<pre><code>s :: Float -&gt; Float\n</code></pre>\n\n<p>...regardless of whether the monomorphism restriction is enabled. <em>Why?</em> I don't know; I'd find this an interesting question to ask.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553895176, "post_id": 55423347, "comment_id": 97570546, "body": "Yup, same as my answer to the follow-up: <a href=\"https://stackoverflow.com/questions/55402733/why-does-ghc-infer-a-monomorphic-type-here-even-with-monomorphismrestriction-di/55403422#55403422\" title=\"why does ghc infer a monomorphic type here even with monomorphismrestriction di\">stackoverflow.com/questions/55402733/&hellip;</a>"}], "tags": [], "owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "is_accepted": false, "score": 3, "last_activity_date": 1553883119, "creation_date": 1553883119, "answer_id": 55423347, "question_id": 55388119, "link": "https://stackoverflow.com/questions/55388119/resolving-the-type-of-f-f-pure/55423347#55423347", "title": "Resolving the type of `f = f (&lt;*&gt;) pure`", "body": "<p>It\u2019s because the f used in the body of the definition of f has a different type than the definition.  This is called polymorphic recursion, and Haskell only allows that if you provide a type signature.\nThe reason for requiring a type signature is that type inference for polymorphic recursion is undecidable in the general case. </p>\n"}], "owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 1, "answer_count": 2, "score": 10, "last_activity_date": 1553883119, "creation_date": 1553730128, "question_id": 55388119, "link": "https://stackoverflow.com/questions/55388119/resolving-the-type-of-f-f-pure", "title": "Resolving the type of `f = f (&lt;*&gt;) pure`", "body": "<p>Recently I noticed that humourously <code>liftA</code> can be written as</p>\n\n<pre><code>liftA (&lt;*&gt;) pure\n</code></pre>\n\n<p>I thought this was neat and so as a bit of a joke I thought I would make a new \"definition\" of <code>liftA</code> based on this property:</p>\n\n<pre><code>f = f (&lt;*&gt;) pure\n</code></pre>\n\n<p>Now I had expected that this would be something of the same type as <code>liftA</code> that just never halted.  However it fails to compile.</p>\n\n<pre><code>\u2022 Occurs check: cannot construct the infinite type:\n    t ~ (f (a -&gt; b) -&gt; f a -&gt; f b) -&gt; (a1 -&gt; f1 a1) -&gt; t\n\u2022 In the expression: f (&lt;*&gt;) pure\n  In an equation for \u2018f\u2019: f = f (&lt;*&gt;) pure\n\u2022 Relevant bindings include\n    f :: (f (a -&gt; b) -&gt; f a -&gt; f b) -&gt; (a1 -&gt; f1 a1) -&gt; t\n      (bound at liftA.hs:2:1)\n</code></pre>\n\n<p>This seems sensible, I see how the compiler has an issue.  However things get a little weird because when I add an annotation:</p>\n\n<pre><code>f :: Applicative f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nf = f (&lt;*&gt;) pure\n</code></pre>\n\n<p>It suddenly compiles.</p>\n\n<p>Now my initial suspicion was that the type I was annotating <code>f</code> with was not the most general type and that by restricting the type I had made it possible to unify things.  However looking at the types this doesn't seem to be the case my type seems to be more general than the type that the compiler was trying to derive.</p>\n\n<p>What is going on here?  I am a bit out of my depth here but I am curious as to what the compiler is thinking in each scenario and why it encounters an issue in one but not the other.</p>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553723977, "post_id": 55385996, "comment_id": 97496130, "body": "Look at <code>zipSource</code> for cycling between sources. Conduit is downstream-driven so adding a delay in the consumer should work(?) What have you tried?"}], "answers": [{"tags": [], "owner": {"reputation": 99, "user_id": 1477320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aea41b95d3ac0816d486b2b77f9619c7?s=128&d=identicon&r=PG", "display_name": "ghn", "link": "https://stackoverflow.com/users/1477320/ghn"}, "is_accepted": false, "score": 0, "last_activity_date": 1553724396, "last_edit_date": 1553724396, "creation_date": 1553723123, "answer_id": 55386949, "question_id": 55385996, "link": "https://stackoverflow.com/questions/55385996/conduit-how-multiple-producers-to-one-consumer-with-backpressure/55386949#55386949", "title": "Conduit: How? Multiple Producers to One Consumer with Backpressure", "body": "<p>Changing the stream to return chunks of data (including empty chunks) allows the delay to be added upstream. I've got a rough prototype working with ZipSource but will most likely need to change my approach to get the sources to pull data independently of each other.</p>\n\n<pre><code>followUser :: Text -&gt; ConduitT () [Tweet] Twitter ()\nfollowUser sn = do\n  ts &lt;- lift $ getNewTweets [(\"screen_name\", sn)]\n  yield ts\n  source\n\nhandleTweet :: Tweet -&gt; IO ()\nhandleTweet = print\n\nmain :: IO ()\nmain = do\n  let sources = sequenceSources [ followUser \"user1\"\n                                , followUser \"user2\"\n                                ]\n\n  _ &lt;- runTwitter $ runConduit\n    $ sources\n    .| iterMC (\\a -&gt; threadDelay 3000000)\n    .| mapM_CE (liftIO . Prelude.mapM_ handleTweet)\n\n  return ()\n\n</code></pre>\n"}], "owner": {"reputation": 99, "user_id": 1477320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aea41b95d3ac0816d486b2b77f9619c7?s=128&d=identicon&r=PG", "display_name": "ghn", "link": "https://stackoverflow.com/users/1477320/ghn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553724396, "creation_date": 1553718881, "last_edit_date": 1553719539, "question_id": 55385996, "link": "https://stackoverflow.com/questions/55385996/conduit-how-multiple-producers-to-one-consumer-with-backpressure", "title": "Conduit: How? Multiple Producers to One Consumer with Backpressure", "body": "<p>Is there anyway I can express \"backpressure\" to throttle the production of values from a conduit source?</p>\n\n<p>Suppose I have something similar to:</p>\n\n<pre><code>source :: ConduitT () Tweet Twitter ()\nsource = do\n  ts &lt;- lift $ getNewTweets [(\"screen_name\", \"Bits90824664\")]\n  yieldMany ts\n  _ &lt;- liftIO $ threadDelay 3000000\n  source\n</code></pre>\n\n<p>Where <code>getNewTweets</code> requests its data through a throttled web API. I've successfully been able to \"pace\" the amount of requests being performed by adding a <code>threadDelay</code> in the producer. However, I am planning on adding additional sources to my pipeline and start consuming data from each producer in a cyclic manner. So, placing a  <code>threadDelay</code> in the producer no longer makes sense. I would like to place the delay somewhere upstream.</p>\n\n<p>I've tried things like adding the delay to the consumer or adding an <code>iterMC</code> with a <code>threadDelay</code> into the middle of the pipeline but doesn't do anything. I'm guessing multi-threading is occurring so the delays don't work correctly? </p>\n\n<p>Or, a new thought! Most of the time my producer doesn't produce any values at all and does a <code>yieldMany []</code>... so having the delay outside the consumer might not be working unless I treat <code>[]</code> as a normal stream value and rewrite the producer to be <code>ConduitT () [Value] IO ()</code>. <s>Any ideas on if this will work with the chunked (<code>CE</code>) variants of consumers or will the empty chunks be short-circuited somehow?</s> I'm thinking I would use a non-chunked transformer to add the delay so that it'll be triggered with each request and will use one of the CE variants of consumers at the end of the pipeline. I will experiment when I get a chance.</p>\n\n<p>If there is some other technique to code this sort of behavior in Haskell I would be thankful for any advice as I'm relatively new to Haskell especially the conduit library; I'm not even sure how/if I can cycle through the multiple sources in the first place.</p>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553728343, "post_id": 55385004, "comment_id": 97497533, "body": "Hold up. You implicitly claim that <code>a</code> and <code>c</code> do not match in <code>Match (Maybe a) (Maybe b) c</code>. How do you know they don&#39;t match?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1553729287, "post_id": 55385004, "comment_id": 97497795, "body": "There&#39;s no direct way but you can get some mileage out of using <code>(a == c) ~ &#39;False</code> as a poor man&#39;s unequality constraint: <a href=\"https://blog.poisson.chat/posts/2018-06-06-hlists-dependent-haskell.html\" rel=\"nofollow noreferrer\">blog.poisson.chat/posts/&hellip;</a>"}, {"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 0, "creation_date": 1553729861, "post_id": 55385004, "comment_id": 97497949, "body": "Daniel, i failed in various ways to write this. This one worked as well as an attempt with two lines in a closed family with the first line a matching a.  And im not sure what im claiming or not claiming, i lack that background."}, {"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1553901981, "post_id": 55385004, "comment_id": 97572377, "body": "@Li-yaoXia its an interesting read, thanks. Very interesting..."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 3, "last_activity_date": 1553729602, "creation_date": 1553729602, "answer_id": 55388068, "question_id": 55385004, "link": "https://stackoverflow.com/questions/55385004/find-match-a-parametric-parameter/55388068#55388068", "title": "Find match a parametric parameter", "body": "<p>You are asking for two different things. You looked for</p>\n\n<blockquote>\n  <p>[a type function] which takes a two structures, <code>s</code>, and <code>t</code> (which are assumed two different parameterizations of the same type, e.g. <code>Maybe Int</code> and <code>Maybe String</code>) and a parameter which will be matched against. If a matching parameter is found, the type function supplies the replacement. Otherwise it supplies the original parameter.</p>\n</blockquote>\n\n<p>You've already mostly written it. You should probably avoid using <code>(==)</code>, because you are allowed to use nonlinear matching, which is generally superior:</p>\n\n<pre><code>type family Match (a :: i) (b :: i) (c :: o) :: o where\n    Match (f a) (f b) a = b\n    Match (f a) (f b) b = a\n    Match _     _     c = c\n</code></pre>\n\n<p>Later, you define two functions, and you want both to compile.</p>\n\n<pre><code>undefined :: Match (Maybe a) (Maybe b) a\nundefined :: Match (Maybe a) (Maybe b) c\n</code></pre>\n\n<p>The first one takes two types as arguments:</p>\n\n<pre><code>\\@(a :: Type) @(b :: Type) -&gt; (undefined :: Match (Maybe a) (Maybe b) a)\n</code></pre>\n\n<p>The type signature matches the first equation of <code>Match</code>, and reduces to <code>a</code>.</p>\n\n<pre><code>\\@(a :: Type) @(b :: Type) -&gt; (undefined :: a)\n</code></pre>\n\n<p>Which allows the correct parameters to be inferred for the function <code>undefined</code>:</p>\n\n<pre><code>\\@a @(b :: Type) -&gt; undefined @'GHC.Types.LiftedRep @a\n</code></pre>\n\n<p>The second function is</p>\n\n<pre><code>\\@(a :: Type) @(b :: Type) @(c :: Type) -&gt; (undefined :: Match (Maybe a) (Maybe b) c)\n</code></pre>\n\n<p>It would be incorrect to infer the argument to <code>undefined</code> as the type family application <code>Match (Maybe a) (Maybe b) c</code>. There are many questions about \"ambiguous type\" errors that contain the reason why. Rather, the type family application must be reduced. But it cannot reduce. It matches the third equation, but it also might match the first and second equations, if <code>a ~ c</code> or <code>b ~ c</code>, so it would be incorrect to jump to the fallback choice when the primary one is still available. You might ask, \"why aren't <code>a</code>/<code>b</code> and <code>c</code> different?\" The answer is that <code>a</code>, <code>b</code>, and <code>c</code> are just variables (which happen to be type variables) and are just names for values (which happen to be types). These values are given as arguments to your function. If I gave you <code>x, y :: Int</code>, and asked you for the value of <code>if x == y then \"Yes\" else \"No\"</code>, you would not be able to tell me, because you do not know the values of <code>x</code> and <code>y</code>. Yet, you have asked Haskell, \"Here, <code>a, b, c :: Type</code>. What is <code>if a == c then b else if b == c then a else c?</code>\" That is just as unanswerable. There is no way to tell variables with equal values apart, because that would really undermine the foundations of Haskell.</p>\n\n<p>Notice that there is a rather cheeky answer to the question I gave you. You can just say \"the value of <code>if x == y then \"Yes\" else \"No\"</code> is <code>if x == y then \"Yes\" else \"No\"</code>.\" Analogously, I can go in and manually supply a type argument of an unreduced type family application to <code>undefined</code> to define your function, by allowing ambiguous types. There is no longer any need to infer what the argument to <code>undefined</code> is by trying (and failing) to reduce the <code>Match</code> application.</p>\n\n<pre><code>fun :: forall a b c. Match (Maybe a) (Maybe b) c\nfun = undefined @_ @(Match (Maybe a) (Maybe b) c)\n</code></pre>\n\n<p>This neatly sidesteps the impossible question. The result type of <code>fun</code> is now deferred to when it is used, which is the power/curse of <code>AllowAmbiguousTypes</code>. Now, <code>fun @Int @String @Int :: String</code>, by the first equation, <code>fun @Int @String @String :: Int</code>, by the second equation, and <code>fun @Int @String @Bool :: Bool</code>, by the third equation. There is no way to make this function \"choose\" the third equation at the definition.</p>\n"}], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 55388068, "answer_count": 1, "score": 5, "last_activity_date": 1553729602, "creation_date": 1553714550, "question_id": 55385004, "link": "https://stackoverflow.com/questions/55385004/find-match-a-parametric-parameter", "title": "Find match a parametric parameter", "body": "<p>Is it possible to match a type parameter for an arbitrary type via type families or otherwise?</p>\n\n<p>I attempt to write a type function </p>\n\n<pre><code>type family Match s t a\n</code></pre>\n\n<p>which takes a two structures, <code>s</code>, and <code>t</code> (which are assumed two different parameterizations of the same type, e.g. <code>Maybe Int</code> and <code>Maybe String</code>) and a parameter which will be matched against. If a matching parameter is found, the type function supplies the replacement. Otherwise it supplies the original parameter. </p>\n\n<pre><code>Match (Maybe a) (Maybe b) a ~ b\nMatch (Maybe a) (Maybe b) c ~ c \n</code></pre>\n\n<p>My attempted implementation:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE PolyKinds #-}\n\nimport Data.Type.Equality\nimport Data.Type.Bool\n\ntype family Match (s::k) (t::k) (a :: * ) :: * where\n  Match (f a :: *) (g b :: *) c = If ((a == c)) b c\n</code></pre>\n\n<p>The family apparently works as planned when the parameter is found:</p>\n\n<pre><code>&gt;  :t (undefined :: (Match (Maybe a) (Maybe b) a))\n(undefined :: (Match (Maybe a) (Maybe b) a)) :: b\n</code></pre>\n\n<p>But not for when not matching:</p>\n\n<pre><code> &gt;  :t (undefined :: (Match (Maybe a) (Maybe b) c))\n     Couldn't match type \u2018If\n                             ghc-prim-0.5.0.0:GHC.Types.*\n                             (Data.Type.Equality.EqStar a0 c0)\n                             b0\n                             c0\u2019\n                     with \u2018If\n                             ghc-prim-0.5.0.0:GHC.Types.*   (Data.Type.Equality.EqStar a c) b c\u2019\n      Expected type: Match * (Maybe a) (Maybe b) c\n        Actual type: Match * (Maybe a0) (Maybe b0) c0\n      NB: \u2018If\u2019 is a type function, and may not be injective\n      The type variables \u2018a0\u2019, \u2018b0\u2019, \u2018c0\u2019 are ambiguous\n    \u2022 In the ambiguity check for an expression type signature\n      To defer the ambiguity check to use sites, enable AllowAmbiguousTypes\n      In an expression type signature: Match (Maybe a) (Maybe b) c\n      In the expression: (undefined :: Match (Maybe a) (Maybe b) c)\n</code></pre>\n\n<p>Is something like what I'm asking possible? It doesn't have to be type families, I'm open to other approaches. OTOH, will allowing ambiguous types help here? I don't know the pitfalls so I hesitate.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "monads", "functor", "applicative"], "answers": [{"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1553725819, "post_id": 55384272, "comment_id": 97496739, "body": "Can you please add how you get from <code>const . pure</code> to <code>fmap pure . const</code>? Btw it might have been easier to start with <code>(.)</code> right away instead of writing <code>fmap</code> (and later explaining (figuring out?) what <code>Functor</code> instance it belongs to)."}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1553727265, "post_id": 55384272, "comment_id": 97497188, "body": "@Bergi Actually you are right, doing it earlier makes things simpler."}], "tags": [], "owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "is_accepted": false, "score": 12, "last_activity_date": 1553727241, "last_edit_date": 1553727241, "creation_date": 1553711504, "answer_id": 55384272, "question_id": 55384267, "link": "https://stackoverflow.com/questions/55384267/is-x-pure-y-equivalent-to-liftm-const-y-x/55384272#55384272", "title": "Is `x &gt;&gt; pure y` equivalent to `liftM (const y) x`", "body": "<h1>Yes they are the same</h1>\n\n<p>Let's start with <code>flip (&gt;&gt;) . pure</code>, which is the pointfree version of <code>x &gt;&gt; pure y</code> you provide:</p>\n\n<pre><code>flip (&gt;&gt;) . pure\n</code></pre>\n\n<p>It is the case that <code>flip (&gt;&gt;)</code> is just <code>(=&lt;&lt;) . const</code> so we can rewrite this as:</p>\n\n<pre><code>((=&lt;&lt;) . const) . pure\n</code></pre>\n\n<p>Since function composition (<code>(.)</code>) is associative we can write this as:</p>\n\n<pre><code>(=&lt;&lt;) . (const . pure)\n</code></pre>\n\n<p>Now we would like to rewrite <code>const . pure</code>. We can notice that <code>const</code> is just <code>pure</code> on <code>(a -&gt;)</code>, that means since <code>pure . pure</code> is <code>fmap pure . pure</code>, <code>const . pure</code> is <code>(.) pure . const</code>, (<code>(.)</code> is <code>fmap</code> for the functor <code>(a -&gt;)</code>).</p>\n\n<pre><code>(=&lt;&lt;) . ((.) pure . const)\n</code></pre>\n\n<p>Now we associate again:</p>\n\n<pre><code>((=&lt;&lt;) . (.) pure) . const\n</code></pre>\n\n<p><code>((=&lt;&lt;) . (.) pure)</code> is the definition for <code>liftM</code><sup>1</sup> so we can substitute:</p>\n\n<pre><code>liftM . const\n</code></pre>\n\n<p>And that is the goal.  The two are the same.</p>\n\n<hr>\n\n<p><sup>1: The definition of <code>liftM</code> is <code>liftM f m1 = do { x1 &lt;- m1; return (f x1) }</code>, we can desugar the <code>do</code> into <code>liftM f m1 = m1 &gt;&gt;= return . f</code>.  We can flip the <code>(&gt;&gt;=)</code> for <code>liftM f m1 = return . f =&lt;&lt; m1</code> and elide the <code>m1</code> to get <code>liftM f = (return . f =&lt;&lt;)</code> a little pointfree magic and we get <code>liftM = (=&lt;&lt;) . (.) return</code></sup></p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1553716850, "post_id": 55384586, "comment_id": 97492931, "body": "Interesting. For some reason I thought that the standard definition was <code>liftM = fmap</code>, with the more restrictive type. With the real definition above, the wanted equation is much simpler to obtain :)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1553719654, "post_id": 55384586, "comment_id": 97494207, "body": "@chi Even without it things aren&#39;t too bad: <code>fmap f m = m &gt;&gt;= return . f</code> is also a monad law (one of the oft-forgotten ones)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1553722076, "post_id": 55384586, "comment_id": 97495410, "body": "That law itself follows from parametricity and the monad law <code>m &gt;&gt;= pure = m</code>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 15, "last_activity_date": 1553713184, "last_edit_date": 1553713184, "creation_date": 1553712855, "answer_id": 55384586, "question_id": 55384267, "link": "https://stackoverflow.com/questions/55384267/is-x-pure-y-equivalent-to-liftm-const-y-x/55384586#55384586", "title": "Is `x &gt;&gt; pure y` equivalent to `liftM (const y) x`", "body": "<p>The other answer gets there eventually, but it takes a long-winded route. All that is actually needed are the definitions of <code>liftM</code>, <code>const</code>, and a single monad law: <code>m1 &gt;&gt; m2</code> and <code>m1 &gt;&gt;= \\_ -&gt; m2</code> must be semantically identical. (Indeed, this is the default implementation of <code>(&gt;&gt;)</code>, and it is rare to override it.) Then:</p>\n\n<pre><code>liftM (const x) y\n= { definition of liftM* }\ny &gt;&gt;= \\z -&gt; pure (const x z)\n= { definition of const }\ny &gt;&gt;= \\z -&gt; pure x\n= { monad law }\ny &gt;&gt; pure x\n</code></pre>\n\n<p>* Okay, okay, so the actual definition of <code>liftM</code> uses <code>return</code> instead of <code>pure</code>. Whatever.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 4, "last_activity_date": 1553726269, "last_edit_date": 1592644375, "creation_date": 1553718448, "answer_id": 55385897, "question_id": 55384267, "link": "https://stackoverflow.com/questions/55384267/is-x-pure-y-equivalent-to-liftm-const-y-x/55385897#55385897", "title": "Is `x &gt;&gt; pure y` equivalent to `liftM (const y) x`", "body": "<p>One more possible route, exploiting the applicative laws:</p>\n<blockquote>\n<p>For instance I found that <code>y &gt;&gt; pure x</code> can be rewritten as follows [...]</p>\n<pre><code>fmap (const id) y &lt;*&gt; pure x\n</code></pre>\n</blockquote>\n<p>That amounts to...</p>\n<pre><code>fmap (const id) y &lt;*&gt; pure x\npure ($ x) &lt;*&gt; fmap (const id) y -- interchange law of applicatives\nfmap ($ x) (fmap (const id) y) -- fmap in terms of &lt;*&gt;\nfmap (($ x) . const id) y -- composition law of functors\nfmap (const x) y\n</code></pre>\n<p>... which, as you noted, is the same as <code>liftM (const x) y</code>.</p>\n<p>That this route requires only applicative laws and not monad ones reflects how <code>(*&gt;)</code> (another name for <code>(&gt;&gt;)</code>) is an <code>Applicative</code> method.</p>\n"}], "owner": {"reputation": 632, "user_id": 2341449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15e3f14d66ce1f2dca5ca0a02aea25b2?s=128&d=identicon&r=PG", "display_name": "1000000000", "link": "https://stackoverflow.com/users/2341449/1000000000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 774, "favorite_count": 0, "answer_count": 3, "score": 15, "last_activity_date": 1553727241, "creation_date": 1553711469, "last_edit_date": 1553718628, "question_id": 55384267, "link": "https://stackoverflow.com/questions/55384267/is-x-pure-y-equivalent-to-liftm-const-y-x", "title": "Is `x &gt;&gt; pure y` equivalent to `liftM (const y) x`", "body": "<p>The two expressions</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>y &gt;&gt; pure x\nliftM (const x) y\n</code></pre>\n\n<p>have the same type signature in Haskell.\nI was curious whether they were equivalent, but I could neither produce a proof of the fact nor a counter example against it.</p>\n\n<p>If we rewrite the two expressions so that we can eliminate the <code>x</code> and <code>y</code> then the question becomes whether the two following functions are equivalent</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>flip (&gt;&gt;) . pure\nliftM . const\n</code></pre>\n\n<p>Note that both these functions have type <code>Monad m =&gt; a -&gt; m b -&gt; m a</code>.</p>\n\n<p>I used the laws that Haskell gives for monad, applicatives, and functors to transform both statements into various equivalent forms, but I was not able to produce a sequence of equivalences between the two.</p>\n\n<p>For instance I found that <code>y &gt;&gt; pure x</code> can be rewritten as follows</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>y &gt;&gt;= const (pure x)\ny *&gt; pure x\n(id &lt;$ y) &lt;*&gt; pure x\nfmap (const id) y &lt;*&gt; pure x\n</code></pre>\n\n<p>and <code>liftM (const x) y</code> can be rewritten as follows</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>fmap (const x) y\npure (const x) &lt;*&gt; y\n</code></pre>\n\n<p>None of these spring out to me as necessarily equivalent, but I cannot think of any cases where they would not be equivalent.</p>\n"}, {"tags": ["haskell", "yesod", "persistent"], "answers": [{"tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 0, "last_activity_date": 1553702875, "creation_date": 1553702875, "answer_id": 55381759, "question_id": 55380861, "link": "https://stackoverflow.com/questions/55380861/default-values-for-persistlist-on-sqlite-yesod/55381759#55381759", "title": "default values for PersistList on SQLite - Yesod", "body": "<p>Have you read <a href=\"https://github.com/yesodweb/persistent/blob/master/docs/Persistent-entity-syntax.md#default\" rel=\"nofollow noreferrer\">this</a>? The value of the <code>default</code> field doesn't really have anything to do with the Haskell side per-se, it's being passed to set the \"default value\" description your DBMS. In this case <code>[PrvDemoOne]</code> is being passed directly to SQLite, which will interpret it as gibberish (because it's not a valid SQL expression) so this is either ignored or (what seems to be the case here) treated as if you hadn't set a default at all.</p>\n\n<p>If you want a \"Haskell side\" default value you should just create a function for that, i.e. something like</p>\n\n<pre><code>defaultUser :: Text -&gt; Maybe Text -&gt; User\ndefaultUser i maybePw = User { ident = i, password = maybePw, perms = [PrvDemoOne] }\n</code></pre>\n\n<p>If you want a SQL side default you need to write the corresponding SQL expression for the value you're trying to represent.</p>\n\n<p>On a non-Haskell related note: the 'normal' way to represent lists (or sets in this case, rather!) in SQL is via relations, so you'd normally have a many-to-many relationship mapping users to their privileges instead of a list field.</p>\n"}], "owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 55381759, "answer_count": 1, "score": 0, "last_activity_date": 1557049760, "creation_date": 1553700335, "last_edit_date": 1557049760, "question_id": 55380861, "link": "https://stackoverflow.com/questions/55380861/default-values-for-persistlist-on-sqlite-yesod", "title": "default values for PersistList on SQLite - Yesod", "body": "<p>I would like to add a PersistList value into a user entity with a default value. My model file looks like this. And <code>Models.hs</code> file:</p>\n\n<pre><code>User\n    ident Text\n    password Text Maybe\n    UniqueUser ident\n    perms [Privileges] default=[PrvDemoOne]\n    deriving Typeable\n</code></pre>\n\n<hr>\n\n<pre><code>data Privileges =\n  PrvDemoOne         -- ^ what can be demo one...\n  | PrvDemoTwo       -- ^ what can be demo two...\n  deriving (Show,Read,Eq)\n\nderivePersistField \"Privileges\"\n</code></pre>\n\n<p>the code compiles but when a new user is added into the table save an empty array instead of an array with the default value. </p>\n\n<blockquote>\n  <p>1|google-uid:223344555661778819911||[]</p>\n</blockquote>\n\n<p>The question is how I could save the column with the default value?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1553703164, "post_id": 55379400, "comment_id": 97485805, "body": "Maybe a dumb question, but <i>why</i> exactly are you doing this rather than using one of the existing solutions to managing package databases like <code>cabal-install</code> or <code>stack</code>?"}, {"owner": {"reputation": 269, "user_id": 2789617, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b18dcd70f6aaecd2bb05a205b454d0ed?s=128&d=identicon&r=PG&f=1", "display_name": "mattator", "link": "https://stackoverflow.com/users/2789617/mattator"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1553706348, "post_id": 55379400, "comment_id": 97487640, "body": "I am using installing packages through nixos. I might be able to do sthg just by using cabal but wanted to stick with my current nix workflow, which implies that I can&#39;t ghc-pkg register/unregister since the default database is read only. Hence my approach of adding another database. It looks like it should work if only I could find how to generate that damn database :D"}], "answers": [{"tags": [], "owner": {"reputation": 269, "user_id": 2789617, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b18dcd70f6aaecd2bb05a205b454d0ed?s=128&d=identicon&r=PG&f=1", "display_name": "mattator", "link": "https://stackoverflow.com/users/2789617/mattator"}, "is_accepted": true, "score": 0, "last_activity_date": 1554701616, "creation_date": 1554701616, "answer_id": 55566791, "question_id": 55379400, "link": "https://stackoverflow.com/questions/55379400/how-to-generate-a-ghc-database-for-one-package/55566791#55566791", "title": "How to generate a ghc database for one package?", "body": "<p>To answer myself, <code>cabal build</code> generates such a db in <code>dist/package.conf.inplace/</code> that can then be referred to via <code>cabal configure --package-db /home/teto/netlink-hs/dist/package.conf.inplace</code></p>\n"}], "owner": {"reputation": 269, "user_id": 2789617, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b18dcd70f6aaecd2bb05a205b454d0ed?s=128&d=identicon&r=PG&f=1", "display_name": "mattator", "link": "https://stackoverflow.com/users/2789617/mattator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 55566791, "answer_count": 1, "score": 0, "last_activity_date": 1554701616, "creation_date": 1553696075, "question_id": 55379400, "link": "https://stackoverflow.com/questions/55379400/how-to-generate-a-ghc-database-for-one-package", "title": "How to generate a ghc database for one package?", "body": "<p>I want to use GHC_PACKAGE_PATH to point at several ghc package databases (<a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/packages.html#package-databases\" rel=\"nofollow noreferrer\">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/packages.html#package-databases</a>). \nI have one haskell library in ~/mylib and would like to generate a database that contains this package ~/mylib.\nI have tried</p>\n\n<pre><code>ghc-pkg -v -f ~/mylib recache\n</code></pre>\n\n<p>but the generated package.cache is empty and thus ghc-pkg -v list does show me the database but with an empty package list.</p>\n\n<p>NB:There is a cabal file in ~/mylib/mylib.cabal</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3203, "user_id": 2622234, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a4b0faa804acdb74ea677bc421d5caac?s=128&d=identicon&r=PG", "display_name": "sara", "link": "https://stackoverflow.com/users/2622234/sara"}, "edited": false, "score": 3, "creation_date": 1553693010, "post_id": 55378234, "comment_id": 97478735, "body": "What do you mean when you say &quot;fail&quot;? A runtime exception? A return value representing an error? A <code>MonadThrow</code> call?"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 3203, "user_id": 2622234, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a4b0faa804acdb74ea677bc421d5caac?s=128&d=identicon&r=PG", "display_name": "sara", "link": "https://stackoverflow.com/users/2622234/sara"}, "edited": false, "score": 0, "creation_date": 1553694091, "post_id": 55378234, "comment_id": 97479436, "body": "If you just want a quick and dirty escape hatch for debugging your own code, then <code>error &quot;my error message&quot;</code> matches any type so can go anywhere. Otherwise @sara is completely right that there are approaches to handle matters more gracefully (like other languages might use try .. catch) if that&#39;s what you&#39;re looking for ?"}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1553694691, "post_id": 55378734, "comment_id": 97479899, "body": "This would be an unconditional failure, akin to Python&#39;s <code>fail</code> method in the <code>unittest</code> module. The user wants something more like <code>assertRaises(SomeException, some_func, ...)</code>, which asserts that a particular call will fail."}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1553694855, "post_id": 55378734, "comment_id": 97480009, "body": "Sorry, it&#39;s due to wrong naming. In all frameworks I&#39;ve seen <code>assertFail</code> fails unconditionally; <code>assertRaises</code> is indeed a very different beast. I&#39;ve extended my answer a bit."}], "tags": [], "owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "is_accepted": false, "score": 0, "last_activity_date": 1553695124, "last_edit_date": 1553695124, "creation_date": 1553694247, "answer_id": 55378734, "question_id": 55378234, "link": "https://stackoverflow.com/questions/55378234/how-to-implement-assertfail-in-haskell/55378734#55378734", "title": "How to implement `assertFail` in Haskell?", "body": "<p>One way to <em>prototype</em> <code>assertFail</code> could be <code>assertFail = undefined</code>, because <a href=\"https://wiki.haskell.org/Undefined\" rel=\"nofollow noreferrer\">evaluating it would raise a runtime exception</a>. Another would be using <a href=\"https://wiki.haskell.org/Error\" rel=\"nofollow noreferrer\"><code>error</code></a>.</p>\n\n<p>If you're building a test framework, a proper design would likely involve total functions (that never raise a runtime error) which return something like <code>Maybe String</code> for a possible error message.</p>\n\n<p>If what you need is indeed <code>assertRaises</code>, take a look at <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Exception.html\" rel=\"nofollow noreferrer\"><code>Control.Exception</code></a> which likely would help.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1553705744, "post_id": 55378996, "comment_id": 97487337, "body": "A much more extensive package specifically for property testing: <a href=\"http://hackage.haskell.org/package/ChasingBottoms\" rel=\"nofollow noreferrer\"><code>ChasingBottoms</code></a>."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553705847, "post_id": 55378996, "comment_id": 97487373, "body": "@dfeuer Thanks!"}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 3, "last_activity_date": 1553694994, "creation_date": 1553694994, "answer_id": 55378996, "question_id": 55378234, "link": "https://stackoverflow.com/questions/55378234/how-to-implement-assertfail-in-haskell/55378996#55378996", "title": "How to implement `assertFail` in Haskell?", "body": "<p>If I understand what you want correctly, you can use <a href=\"http://hackage.haskell.org/package/spoon-0.3.1\" rel=\"nofollow noreferrer\">spoon</a>:</p>\n\n<pre><code>import Control.Spoon\n\nassertFail x = case spoon x of\n    Nothing -&gt; ()\n    Just _ -&gt; error \"unexpected success\"\n</code></pre>\n\n<p>A relevant question: <a href=\"https://stackoverflow.com/questions/14710928/is-spoon-unsafe-in-haskell\">Is spoon unsafe in Haskell?</a></p>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1553695124, "creation_date": 1553692807, "question_id": 55378234, "link": "https://stackoverflow.com/questions/55378234/how-to-implement-assertfail-in-haskell", "title": "How to implement `assertFail` in Haskell?", "body": "<p>when implementing my own tool modules and funtions, I want to make sure that my function fails on specific input, such as <code>assertFail (head [])</code>, but this <code>assertFail</code> function seems impossible to be implemented in Haskell, is there any way to hack it?</p>\n"}, {"tags": ["haskell", "recursion", "pattern-matching", "algebraic-data-types"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1553688284, "post_id": 55376664, "comment_id": 97475558, "body": "The only problem I&#39;ve noticed (unable to test right now) is that the outputs of the functions should use the <code>Arg</code> constructor - eg. the first 2 cases for <code>combine</code> should result in <code>Arg []</code>"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553688977, "post_id": 55376664, "comment_id": 97475950, "body": "oh, and there are some more problems in the <code>same</code> function. <code>Arg x : xs</code> should be <code>Arg (x : xs)</code>. You&#39;ve not covered the case where either argument is <code>Arg []</code>. And (in the <code>x == y</code> guard in the final pattern) you can&#39;t have <code>x</code> as the output."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1553689048, "post_id": 55376664, "comment_id": 97476004, "body": "And in trying to make sense of what the <code>same</code> function might be intended to do - is there supposed to be a difference in &quot;meaning&quot; between <code>Arg []</code> and <code>Empty</code>? And if so, what is it?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553696469, "post_id": 55376664, "comment_id": 97481149, "body": "you&#39;re missing the parens in the last line of <code>combine</code>. to pass the type checker, it should be <code>... = Arg (xs ++ ys)</code>. it won&#39;t be right (in case you want to not include the duplicate elements in the result), but at least it&#39;ll type check. --- <code>same (Arg x : xs) (Arg y : ys) = ...</code> is wrong too: it should be <code>same (Arg (x : xs)) (Arg (y : ys)) = ...</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553697549, "post_id": 55376664, "comment_id": 97481869, "body": "you have many questions all jumbled up in one post. you will have better ROI if you ask a specific, well-focused question, with/about <i>one</i> code snippet. i.e. the minimal code, as in <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. but it turns out that my previous comment answers your new edit. you just need to add parens around the <code>(x:xs)</code> inside the <code>(Arg (x:xs))</code> etc., because what you have now is interpreted as <code>(Arg x) : xs</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553698222, "post_id": 55376664, "comment_id": 97482376, "body": "general advice: while still learning the basics, use explicit parens <i>everywhere</i>. forget about <code>$</code>. even use the explicit <code>{ ; }</code> in <code>let</code>, <code>case</code> and <code>do</code> (with a proper code indentation.)"}], "answers": [{"comments": [{"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553692220, "post_id": 55377777, "comment_id": 97478157, "body": "Corrected <code>combine</code> to your spec. It&#39;s a bit unnatural, because usually <code>Empty</code> does something different to <code>Arg []</code>. <code>nub</code> takes a list and removes duplicate entries. <code>$</code> is function application and I used it here to remove the need for brackets; <code>a $ b c = a (b c)</code> and <code>a $ b $ c = a (b (c))</code>. The problem with writing <code>same</code> recursively is that you essentially need to sort the lists to do it, but I can write another version 1 sec."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9660393"}, "edited": false, "score": 0, "creation_date": 1553692464, "post_id": 55377777, "comment_id": 97478321, "body": "1) you&#39;re a god, thank you. 2) instead of <code>$</code> I can substitute <code>[]</code>? 3) thank you again, this is saving my life. I&#39;ve been pulling my hair out trying to understand algebraic data type syntax. I understand the idea and pattern matching but get caught in the syntax."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553692919, "post_id": 55377777, "comment_id": 97478676, "body": "2) No you cannot, they are completely different! You should fire up GHCi and play with them. The :t command tells you something&#39;s type and is very useful."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9660393"}, "edited": false, "score": 0, "creation_date": 1553693111, "post_id": 55377777, "comment_id": 97478801, "body": "I got the <code>combine</code> to work but I&#39;m still having issues with using recursion on <code>same</code> to return a list of [Int] with only like Ints and no repeats."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553693218, "post_id": 55377777, "comment_id": 97478893, "body": "3) the easiest way to learn is to try. Look at the error messages when you try to compile it, try to understand what the compiler is objecting to, and search the errors for beginners with similar problems and see what people said. Error messages are never perfectly informative, but learning to read them is invaluable for understanding where one&#39;s code is wrong."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9660393"}, "edited": false, "score": 0, "creation_date": 1553693230, "post_id": 55377777, "comment_id": 97478901, "body": "It is legitimately syntax. The correct answer for <code>combine</code> was just <code>()</code> in a place that I hadn&#39;t tried yet, which always seems the case for me in haskell. I&#39;m always missing some parenthesis."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9660393"}, "edited": false, "score": 0, "creation_date": 1553694611, "post_id": 55377777, "comment_id": 97479837, "body": "I wrote same&#39; and added it above. It&#39;s how I&#39;m most comfortable in the syntax, using guards and a where statement instead of the local <code>let</code>. I&#39;m a beginner and I&#39;m trying to stay within what I know well. The error seems to come from the where statement as not being recognized but it&#39;s probably because of mismatched parenthesis or syntax."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553697205, "post_id": 55377777, "comment_id": 97481612, "body": "<code>same a b = nub (a++b)</code> is wrong. <code>same</code> is supposed to be set intersection, according to the description in the question. <code>nub</code> belongs in <code>combine</code>, which is supposed to be a union."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553697704, "post_id": 55377777, "comment_id": 97481990, "body": "Ah you&#39;re totally right, fixed it. That&#39;s what comes from doing everything without testing!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553698024, "post_id": 55377777, "comment_id": 97482229, "body": "the pattern <code>(Arg x : xs)</code> is wrong, missing some parens inside."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9660393"}, "edited": false, "score": 0, "creation_date": 1553700433, "post_id": 55377777, "comment_id": 97483984, "body": "May I ask one final question: why does your intersect not need a type definition?"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553700925, "post_id": 55377777, "comment_id": 97484316, "body": "It&#39;s good practice to give top-level functions type definitions (and if you ask the compiler to warn you about anything potentially bad, this is one of things it&#39;ll mention), but often unnecessary. Here the compiler sees eg. pattern matching on lists for the left argument, and that the right argument is passed as the second argument to <code>elem</code>, so both arguments must be lists. Likewise they must be lists of the same type supporting equality because of the call to <code>elem</code>. Hence <code>Eq a =&gt; [a] -&gt; [a] -&gt; [a]</code>. Search Hindley-Milner. PS sorry for any confusion from my mistakes, answering on mobile!"}], "tags": [], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "is_accepted": false, "score": 1, "last_activity_date": 1553699827, "last_edit_date": 1553699827, "creation_date": 1553691432, "answer_id": 55377777, "question_id": 55376664, "link": "https://stackoverflow.com/questions/55376664/using-algebraic-data-type-to-combine-lists/55377777#55377777", "title": "Using Algebraic Data Type to combine lists", "body": "<pre><code>combine :: Example -&gt; Example -&gt; Example\ncombine x Empty = x\ncombine Empty x = x\ncombine (Arg xs) (Arg ys) = Arg $ union xs ys\n\nunion xs ys = nub $ xs ++ ys\nnub [] = []\nnub (x:xs) = if x `elem` xs then nub xs else x : nub xs\n\nsame :: Example -&gt; Example -&gt; Example\nsame _ Empty = Empty\nsame Empty _ = Empty\nsame (Arg xs) (Arg ys) = Arg $ intersect xs ys\n\nintersect _ [] = [] -- unnecessary but practical!\nintersect [] _ = []\nintersect (x:xs) ys = if x `elem` ys then x : intersect xs ys else intersect xs ys\n</code></pre>\n\n<p>As Robin comments, you have a couple of different issues. Firstly you need to match all the cases, secondly you need to wrap the results back up into your data type, thirdly you need to remove duplicates in the union, fourthly your \"set intersection\" operation would only work with some very strong assumptions about the structure of the input lists. <code>union</code>, <code>intersect</code> (also available in Data.List) are good enough for demonstration purposes without invoking eg. <code>Data.IntSet.toList . Data.IntSet.fromList</code> although that would be faster. Your version (if corrected slightly) would output the elements that appear in at the same position in both lists.</p>\n\n<p>Common tutorials on functors often start with the <code>Maybe</code> kind, that might be helpful for you in understanding this because <code>Example</code> is isomorphic to <code>Maybe [Int]</code>. </p>\n\n<p>An example where you might want to use the <code>Arg (x : xs)</code> deconstructor would be a function that takes the lesser element at each index from the two lists. Could you try writing that yourself recursively ie. without using <code>zip</code>?</p>\n\n<p>EDIT: heavy changes and corrections</p>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1553701148, "post_id": 55380409, "comment_id": 97484458, "body": "Note that <code>lift</code> is similar to <code>omap</code> from the <code>mono-traversable</code> package."}, {"owner": {"reputation": 427, "user_id": 7941330, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/u7jCJ.jpg?s=128&g=1", "display_name": "F&#225;bio Roberto Teodoro", "link": "https://stackoverflow.com/users/7941330/f%c3%a1bio-roberto-teodoro"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553709240, "post_id": 55380409, "comment_id": 97489188, "body": "@WillNess You were right, thank you. Edited the code to eliminate all the extra <code>nub</code>s."}], "tags": [], "owner": {"reputation": 427, "user_id": 7941330, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/u7jCJ.jpg?s=128&g=1", "display_name": "F&#225;bio Roberto Teodoro", "link": "https://stackoverflow.com/users/7941330/f%c3%a1bio-roberto-teodoro"}, "is_accepted": true, "score": 0, "last_activity_date": 1553709008, "last_edit_date": 1553709008, "creation_date": 1553698982, "answer_id": 55380409, "question_id": 55376664, "link": "https://stackoverflow.com/questions/55376664/using-algebraic-data-type-to-combine-lists/55380409#55380409", "title": "Using Algebraic Data Type to combine lists", "body": "<p>Using the concept of <a href=\"https://wiki.haskell.org/Lifting\" rel=\"nofollow noreferrer\">lifting</a>, I came ou with this solution:</p>\n\n<pre><code>import Data.List (nub)\n\ndata Example = Arg [Int]\n         | Empty\n    deriving Show\n\ncombine :: Example -&gt; Example -&gt; Example\ncombine Empty Empty = Empty\ncombine x Empty = x\ncombine Empty x = x\ncombine (Arg xs) (Arg ys) = Arg $ nub $ xs ++ ys\n\nsame :: Example -&gt; Example -&gt; Example\nsame arg1 arg2 = lift nub $ same' arg1 arg2\n    where\n        same' _ Empty = Empty\n        same' Empty _ = Empty\n        same' (Arg []) y = Arg []\n        same' (Arg (x : xs)) (Arg (ys))\n            | x `elem` ys = lift (x : ) $ same' (Arg xs) (Arg ys)\n            | otherwise  = same' (Arg xs) (Arg ys)\n\nlift :: ([Int] -&gt; [Int]) -&gt; Example -&gt; Example\nlift _ Empty = Empty\nlift f (Arg x) = Arg (f x)\n</code></pre>\n\n<p>What <code>lift</code> do is to apply a function to the \"content\" of <code>Arg</code>. If you have the expression <code>same (Arg [1, 2, 4, 3]) (Arg [3,1,4])</code> the recursion will turn it into:</p>\n\n<pre><code>lift nub $ lift (1 : ) $ lift (4 : ) $ lift (3 : ) $ Arg []\n</code></pre>\n\n<p>wich evaluates like:</p>\n\n<pre><code>lift nub $ lift (1 : ) $ lift (4 : ) $ Arg (3:[])\nlift nub $ lift (1 : ) $ Arg (4:3:[])\nlift nub $ Arg (1:4:3:[])\nArg (nub $ 1:4:3:[])\n</code></pre>\n\n<p>then finally:</p>\n\n<pre><code>Arg [1,4,3]\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9660393"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 55380409, "answer_count": 2, "score": 1, "last_activity_date": 1553709008, "creation_date": 1553687912, "last_edit_date": 1553699019, "question_id": 55376664, "link": "https://stackoverflow.com/questions/55376664/using-algebraic-data-type-to-combine-lists", "title": "Using Algebraic Data Type to combine lists", "body": "<p>I'm trying to understand the syntax of created algebraic data types. The type I've created is either an <code>[Int]</code> or <code>Empty</code>, similar to <code>Maybe</code> with <code>Just</code> and <code>Nothing</code> except the <code>Just</code> has to be a list of <code>Int</code>. I'm having trouble understanding manipulating the created type when it accepts two inputs and gives an output of the same type.</p>\n\n<pre><code>data Example = Arg [Int]\n         | Empty\n    deriving Show\n</code></pre>\n\n<p>I use pattern matching and understand that every case must be addressed; however, my issue comes from the syntax of the final pattern where neither is <code>Empty</code>. I'm trying to write two functions: one that combines both <code>[Int]</code> lists from the <code>Example</code> constructor, and I want to create a function that only shows a set of <code>[Int]</code> that both share, instead of combining.</p>\n\n<p>The first issue is combining two sets. I can do it in a normal function but somewhere, using the <code>Example</code> data type, the syntax is off and I'm unfamiliar with it. The biggest issue in the second is the same: I understand recursion but I don't understand the syntax of recursion in a created data type. I was also thinking of using a <code>where</code> statement in the second function but if I can't get the syntax of basic recursion right then I doubt it'd be successful.</p>\n\n<pre><code>combine :: Example -&gt; Example -&gt; Example\ncombine Empty Empty = Empty\ncombine (Arg xs) Empty = (Arg xs)\ncombine Empty (Arg ys) = (Arg ys)\ncombine (Arg xs) (Arg ys) = Arg xs ++ ys\n\nsame :: Example -&gt; Example -&gt; Example\nsame _ Empty = Empty\nsame Empty _ = Empty\nsame (Arg x : xs) (Arg y : ys)\n  | x == y    = x\n  | otherwise = same (Arg xs) (Arg ys)\n</code></pre>\n\n<p>The output of <code>combine</code> should be an <code>[Int]</code> list containing all <code>Int</code>s from both lists; if one list is empty, it should return the entire set of the non-empty list.</p>\n\n<p>The output of <code>same</code> should contain an <code>[Int]</code> list containing only the numbers shared by both groups, with no repeats; if one set is empty, the output is empty.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1553676570, "post_id": 55372182, "comment_id": 97468318, "body": "cannot check now, but does this compile? Wrong types at <code>elem shortVowel (last sentence)</code> since <code>elem :: a -&gt; [a] -&gt; Bool</code> but  <code>shortVowel :: [[Char]]</code> and <code>last sentence :: [Char]</code>. Also, I think your are messing the types. You say: <i>and <code>y</code> is also a sublist in the <code>shortVowel</code> list</i>... <code>y</code> is a <code>Char</code> not a sublist. Try something like <code>map (== [last (last sentence)]) shortVowel</code>"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 3, "creation_date": 1553676847, "post_id": 55372182, "comment_id": 97468495, "body": "Quick tip: String literals <code>&quot;abc&quot;</code> are equivalent internally to lists <code>[&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]</code>. So you could also write <code>sentence = [&quot;the&quot;, &quot;boy&quot;, &quot;is&quot;, &quot;happy&quot;]</code>."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1553676940, "post_id": 55372182, "comment_id": 97468554, "body": "As for your question: The <code>any</code> function is useful in cases like this. <code>any f list</code> is true if <i>any</i> element of <code>list</code> returns true when given to <code>f</code>. So e.g. <code>any (\\x -&gt; x &gt; 1) [0,1,2]</code> returns <code>True</code>, since there is at least one element of <code>[0,1,2]</code> which satisfies <code>\\x -&gt; x &gt; 1</code>."}], "answers": [{"tags": [], "owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "is_accepted": false, "score": 2, "last_activity_date": 1553678527, "last_edit_date": 1553678527, "creation_date": 1553676964, "answer_id": 55373167, "question_id": 55372182, "link": "https://stackoverflow.com/questions/55372182/how-to-check-if-the-last-element-of-a-list-is-a-member-of-another-list/55373167#55373167", "title": "How to check if the last element of a list is a member of another list?", "body": "<p>Instead of writing <code>shortVowel = [['a'], ['e'], ['y']]</code> I would write <code>shortVowel' = ['a', 'e', 'y']</code>. Which is the same as <code>shortVowel' = \"aey\"</code>. Now do</p>\n\n<pre><code>or [x == last $ last sentence | x &lt;- shortVowel']\n</code></pre>\n\n<p>The above checks if any of the elements in <code>shortVowel</code> is the last element of the last word in your sentence. If you want to check it for all short vowels then do</p>\n\n<pre><code>[(x, x == last $ last sentence) | x &lt;- shortVowel']\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 2, "last_activity_date": 1553679667, "creation_date": 1553679667, "answer_id": 55374008, "question_id": 55372182, "link": "https://stackoverflow.com/questions/55372182/how-to-check-if-the-last-element-of-a-list-is-a-member-of-another-list/55374008#55374008", "title": "How to check if the last element of a list is a member of another list?", "body": "<p>Here are some things you could do:</p>\n\n<ul>\n<li><p>Deal with handling errors. Both the list of words and the last word itself could be empty.</p>\n\n<p><code>last</code> is a <a href=\"https://wiki.haskell.org/Avoiding_partial_functions\" rel=\"nofollow noreferrer\">partial function</a> and can crash at run-time.</p></li>\n<li><p>Move your logic into a pure function separate from <code>main :: IO</code>.</p>\n\n<p>Make the example string a parameter of the function.</p>\n\n<p>And deal with extracting the last word from the sentence separately.</p></li>\n</ul>\n\n<p>Here's an example of that:</p>\n\n<pre><code>module Main where\n\n-- | `lastMay [x,y,z] == Just z` and `lastMay [] == Nothing`.\nlastMay :: [a] -&gt; Maybe a\nlastMay [] = Nothing\nlastMay [x] = Just x\nlastMay (_:xs) = lastMay xs\n\n-- | `endsWithShortVowel \"yay\" == True` and `endsWithShortVowel \"moo\" == False`.\nwordEndsWithShortVowel :: String -&gt; Bool\nwordEndsWithShortVowel s = case lastMay s of\n  Nothing -&gt; False -- No letters in word!\n  Just c -&gt; c `elem` \"aey\"\n\nsentenceEndsWithShortVowel :: [String] -&gt; Bool\nsentenceEndsWithShortVowel s = case lastMay s of\n  Nothing -&gt; False -- No words in sentence!\n  Just w -&gt; wordEndsWithShortVowel w\n\nmain :: IO ()\nmain =\n  if sentenceEndsWithShortVowel exampleSentence\n    then ...\n    else ...\n\nexampleSentence :: [String]\nexampleSentence = words \"the boy is happy\"\n</code></pre>\n\n<p>Then, for example, making the program receptible to strings from standard input becomes easier:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  sentence &lt;- words &lt;$&gt; getLine\n  if sentenceEndsWithShortVowel sentence\n    then ...\n    else ...\n</code></pre>\n\n<p><strong>Note:</strong> Be careful of indentation levels when you combine <code>do</code> and <code>if-then-else</code>.</p>\n"}], "owner": {"reputation": 139, "user_id": 9580614, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-h-PRdmxbbjg/AAAAAAAAAAI/AAAAAAAAAAs/1mkUEvK_wo0/photo.jpg?sz=128", "display_name": "Ricardo Potozky", "link": "https://stackoverflow.com/users/9580614/ricardo-potozky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1553679667, "creation_date": 1553673048, "question_id": 55372182, "link": "https://stackoverflow.com/questions/55372182/how-to-check-if-the-last-element-of-a-list-is-a-member-of-another-list", "title": "How to check if the last element of a list is a member of another list?", "body": "<p>I'm having some troubles with lists. </p>\n\n<p>I have the following lists of lists:</p>\n\n<pre><code>sentence = [['t','h','e'], ['b','o','y'],['i','s'],['h','a','p','p','y']]\n\nshortVowel = [['a'], ['e'], ['y']]\n</code></pre>\n\n<p>I need to make an if statement that checks 2 things: </p>\n\n<p>(1) if an element x is a member of the last \"sublist\" (whose, of course, is the last element of the main list),</p>\n\n<p>and (2) if an element (a sublist) of the list <code>shortVowel</code> is the last member of the last sublist.   </p>\n\n<p>The (1) I was able to do with <code>elem '\u0430' (last sentence))</code> (checking if 'a'is a member of <code>['h','a','p','p','y']</code>, which it is.</p>\n\n<p>The (2) is the one I don't know how to get.</p>\n\n<p>For exemple, the last element of the last sublist in <code>sentence</code> is <code>y</code> (from happY). And <code>y</code> is also a sublist in the <code>shortVowel</code> list. </p>\n\n<p>I need to check exactly this. </p>\n\n<p>I try some things, like <code>elem shortVowel (last sentence)</code>, but it didn't work.</p>\n\n<p>This is my current code:</p>\n\n<pre><code>import Data.List\n\nsentence = [['t','h','e'], ['b','o','y'],['i','s'],['h','a','p','p','y']]\n\nshortVowel = [['a'], ['e'], ['y']]\n\nmain =  if ((elem '\u0430' (last sentence)) || (elem '\u043e' (last sentence)) || (elem '\u0443' (last sentence)) &amp;&amp; (elem shortVowel (last sentence)))\n           then putStrLn \"A\"\n        else if (elem '\u0440' (last sentence))\n           then putStrLn \"B\"\n        else putStrLn \"C\"\n</code></pre>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1553643621, "post_id": 55367690, "comment_id": 97459021, "body": "well there are always <a href=\"https://hackage.haskell.org/package/bifunctors-5/docs/Data-Bifunctor.html\" rel=\"nofollow noreferrer\">Bifunctors</a> - you could define a new typeclass which just included <code>first</code> from <code>Bifunctor</code> (presumably under some other name). I think the only reason the last parameter is &quot;privileged&quot; in the way you describe is that type application (like function application) is left-associative - so <code>Either a b</code> is the same as <code>(Either a) b</code>, and can&#39;t be rewritten as something applied to <code>a</code> (without some <code>newtype</code> shenanigans as you observe)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1553644382, "post_id": 55367690, "comment_id": 97459193, "body": "Also related: <a href=\"https://stackoverflow.com/q/8248217/2751851\"><i>Are there \u201ctype-level combinators\u201d? Will they exist in some future?</i></a>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1553700079, "post_id": 55367690, "comment_id": 97483732, "body": "I don&#39;t think this is actually an exact duplicate of either of the linked questions."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 1, "creation_date": 1553714068, "post_id": 55367690, "comment_id": 97491628, "body": "@John F. Miller: I asked the original questions. Benjamin Hodgson, Chepner and Daniel Wagner provided lots of useful information. I learned a lot from their comments in combination with getting my head around the Typeclassopedia. I am still a long way from the level of understanding these guys have of Haskell, but it nonetheless it fuels my enthousiasm to dive in deeper and deeper ;-)"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "closed_date": 1553647051, "answer_count": 0, "score": 1, "last_activity_date": 1553653334, "creation_date": 1553643277, "last_edit_date": 1553653334, "question_id": 55367690, "link": "https://stackoverflow.com/questions/55367690/is-it-possible-to-make-a-functor-instance-for-a-type-parameter-other-than-the-la", "closed_reason": "Duplicate", "title": "Is it possible to make a Functor instance for a type parameter other than the last?", "body": "<p>Sometimes there are data types that contain multiple type parameters (eg <code>Either a b</code> and <code>(a,b)</code>).  We can create a Functor instance for the <code>b</code> parameter which turns out to be pretty straight forward. But what about the <code>a</code> parameter? I know that one could wrap everything in a <code>newtype</code> with the parameters in reverse order, but is there a way to create the instance of a second order type class (is that the correct way to describe <code>Functor</code>/ <code>Applicative</code> / <code>Monad</code>?) directly on a parameter other than the last? I don't think so but I could not actually find that written down anywhere.</p>\n\n<p><strong>Context:</strong></p>\n\n<p><a href=\"https://stackoverflow.com/q/55364861/2751851\">Another question on Stack Overflow</a> was from a student studying Haskell who was trying to create a Functor instance for their own Either-like Type presumably as a class assignment. Unfortunately, they had defined their data type as <code>data Alt a b = Success a | Failure b</code> and could not get the functor instance to work because they wanted to fmap over the <code>a</code> parameter.  I was about to write that <code>Functor</code> instances only work for the last parameter when I realized that I did not actually know that for sure. Thus my question.</p>\n"}, {"tags": ["haskell", "phantom-types"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1553655985, "post_id": 55367487, "comment_id": 97461477, "body": "You might also like <a href=\"https://stackoverflow.com/q/38926169/791604\">Statically enforcing that two objects were created from the same (Int) \u201cseed\u201d</a>. While reading the question (and my answer there), when you see &quot;seed&quot;, think &quot;modulus&quot;; when you see <code>Collection</code>, think <code>Mod</code>; when you see &quot;merge collections&quot;, think &quot;add&quot; or &quot;multiply&quot; or similar such operations that only work when the moduli of the two arguments are equal."}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 4632965, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/41794552ce2747e22551cc47d3e45e3a?s=128&d=identicon&r=PG&f=1", "display_name": "jgrec", "link": "https://stackoverflow.com/users/4632965/jgrec"}, "edited": false, "score": 0, "creation_date": 1553643212, "post_id": 55367595, "comment_id": 97458911, "body": "thanks for this answer, but in this case it is not possible to choose to work with modulo 2 for example. Is it impossible? If it is the case, I don&#39;t understand the purpose of having a data type such as <code>Mod m</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 75, "user_id": 4632965, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/41794552ce2747e22551cc47d3e45e3a?s=128&d=identicon&r=PG&f=1", "display_name": "jgrec", "link": "https://stackoverflow.com/users/4632965/jgrec"}, "edited": false, "score": 0, "creation_date": 1553645310, "post_id": 55367595, "comment_id": 97459423, "body": "@jgrec If you cannot know the modulus at compile time -- that is, if you&#39;re not willing to admit <code>KnownNat m</code> -- then yes, you must enter existential land. Whether &quot;it&quot; is impossible or not depends greatly on what &quot;it&quot; is. You certainly cannot unwrap a <code>SomeMod</code> into a <code>Mod m</code> for any <code>m</code>, but that is almost always not the end goal anyway; serving rather as a stepping stone to some larger goal that is achievable in another way."}, {"owner": {"reputation": 75, "user_id": 4632965, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/41794552ce2747e22551cc47d3e45e3a?s=128&d=identicon&r=PG&f=1", "display_name": "jgrec", "link": "https://stackoverflow.com/users/4632965/jgrec"}, "edited": false, "score": 0, "creation_date": 1553681057, "post_id": 55367595, "comment_id": 97471087, "body": "I&#39;m starting to understand that a bit, but since I don&#39;t have acess to the constuctor of <code>Mod (::Nat)</code> and since I cannot transform <code>SomeMod</code> into <code>Mod</code>, how can I use <code>Mod x</code> into a programm (without knowing <code>x</code>in advance)? In <code>ghci</code> I get it, but not in a programm."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 75, "user_id": 4632965, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/41794552ce2747e22551cc47d3e45e3a?s=128&d=identicon&r=PG&f=1", "display_name": "jgrec", "link": "https://stackoverflow.com/users/4632965/jgrec"}, "edited": false, "score": 0, "creation_date": 1553692476, "post_id": 55367595, "comment_id": 97478333, "body": "@jgrec If you do not know <code>x</code> in advance, then you do not use <code>Mod x</code>. You use <code>SomeMod</code> directly. Again: what things do you want to do with it? It&#39;s nearly impossible to answer in the abstract, but if you talk about what operations you want to do we can talk about whether/how it is possible to do those operations on <code>SomeMod</code>s."}, {"owner": {"reputation": 75, "user_id": 4632965, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/41794552ce2747e22551cc47d3e45e3a?s=128&d=identicon&r=PG&f=1", "display_name": "jgrec", "link": "https://stackoverflow.com/users/4632965/jgrec"}, "edited": false, "score": 0, "creation_date": 1553782459, "post_id": 55367595, "comment_id": 97519909, "body": "I wanted to compute the determinant of a matrice mod x, but x must be choosen at random. But once x is choosen, I cannot use it to create mod x value. Since <code>SomeMod</code> is not an instance of <code>Ord</code>, linear arithmetic library won&#39;t be able to perform determinant computation. Maybe I could write my own <code>Ord</code> instance for <code>SomeMod</code>? But then I would lose the benefit of restricting matrices of the same mod. With <code>SomeMod</code>, I can add/mul values mod 5 and mod 3. In a way it seems to me that I need dependent typing, but it might not be doable."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 75, "user_id": 4632965, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/41794552ce2747e22551cc47d3e45e3a?s=128&d=identicon&r=PG&f=1", "display_name": "jgrec", "link": "https://stackoverflow.com/users/4632965/jgrec"}, "edited": false, "score": 0, "creation_date": 1553784111, "post_id": 55367595, "comment_id": 97521252, "body": "@jgrec It should be relatively easy to cook up an <code>Ord</code> instance yourself, although I don&#39;t immediately see why it would be needed for computing a determinant. For restricting matrices to the same modulus, see the answer in the link I posted as a comment on your question above."}, {"owner": {"reputation": 75, "user_id": 4632965, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/41794552ce2747e22551cc47d3e45e3a?s=128&d=identicon&r=PG&f=1", "display_name": "jgrec", "link": "https://stackoverflow.com/users/4632965/jgrec"}, "edited": false, "score": 0, "creation_date": 1553788416, "post_id": 55367595, "comment_id": 97524471, "body": "thanks I will try to do just that. By the way I wanted to use <code>detLU</code> (<a href=\"https://hackage.haskell.org/package/matrix-0.3.6.1/docs/Data-Matrix.html#g:17\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/matrix-0.3.6.1/docs/&hellip;</a>) which requires <code>Ord</code>, but either way you&#39;re right, I can use other method to compute the determinant or I can cook myself an instance. Thanks again"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1553642587, "creation_date": 1553642587, "answer_id": 55367595, "question_id": 55367487, "link": "https://stackoverflow.com/questions/55367487/arithmoi-and-phantom-types/55367595#55367595", "title": "Arithmoi and phantom types", "body": "<p>Like IO, existentials cannot be escaped. Once in an existential, always in an existential. But that's okay -- if you're willing to admit <code>KnownNat m</code>, which your type signature claims you are willing to do, then you can just lift directly to that type.</p>\n\n<pre><code>foo :: KnownNat m =&gt; Natural -&gt; Mod m\nfoo = fromIntegral\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 4632965, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/41794552ce2747e22551cc47d3e45e3a?s=128&d=identicon&r=PG&f=1", "display_name": "jgrec", "link": "https://stackoverflow.com/users/4632965/jgrec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 55367595, "answer_count": 1, "score": 1, "last_activity_date": 1553653385, "creation_date": 1553641814, "last_edit_date": 1553653385, "question_id": 55367487, "link": "https://stackoverflow.com/questions/55367487/arithmoi-and-phantom-types", "title": "Arithmoi and phantom types", "body": "<p>I'm tyring to understand the use of phantom types in the package arithmoi (<a href=\"https://hackage.haskell.org/package/arithmoi-0.8.0.0\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/arithmoi-0.8.0.0</a>). It helps to check if I'm working with the right residue class (<code>Z/nZ</code>).</p>\n\n<p>The phantom type in question is <code>data Mod (n :: Nat) = Mod Natural</code>, and as I understand the constructor is not exported. But the constructor of <code>SomeMod</code> is exported, so I figure I must use it to construct <code>::Mod n</code> variable.\nMoreover, one can read in the documentation, but I can't use it.</p>\n\n<pre><code>case modulo n m of\n  SomeMod k -&gt; process k -- Here k has type Mod m\n  InfMod{}  -&gt; error \"impossible\"\n</code></pre>\n\n<p>So I tried:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foo :: KnownNat m =&gt; Nat -&gt; Nat -&gt; Mod m\nfoo n m = case modulo n m of\n    (SomeMod k) -&gt; k\n    otherwise -&gt; error \"some error\"\n</code></pre>\n\n<p>I got an error about a variable m, m1 which is escaping its scope. I'm a bit puzzled.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "edited": false, "score": 0, "creation_date": 1553634748, "post_id": 55365605, "comment_id": 97456093, "body": "Thank you for the reproducible script - made answering very easy!"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1553638041, "post_id": 55365605, "comment_id": 97457376, "body": "Note that <code>key1 &lt;- return $ rep2Key cowRecKeyStr1</code> is just <code>let key1 = rep2Key cowRecKeyStr1</code>"}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1553644609, "post_id": 55365605, "comment_id": 97459255, "body": "@Cubic amazingly I literally just switched from a tab where I just happened to read this very fact - thanks for pointing it out - it does seem a bit more straightforward"}], "answers": [{"comments": [{"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1553633886, "post_id": 55365927, "comment_id": 97455710, "body": "And here I thought I&#39;d become proficient at do-notation. The irony is I was using <code>readMay</code> under the hood all along in my actual app (unlike the script above), and evoking error for <code>Nothing</code>s. I should probably surface the read returning <code>Maybe a</code> as much as possible anyway, except where <code>read</code> is demanded."}, {"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "reply_to_user": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 1, "creation_date": 1553634694, "post_id": 55365927, "comment_id": 97456074, "body": "I added a way to keep that signature (possibly for something where absolutely no error is possible)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1553636830, "post_id": 55365927, "comment_id": 97456931, "body": "@bbarker, fret not, this is a subtle one."}], "tags": [], "owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "is_accepted": true, "score": 4, "last_activity_date": 1553634643, "last_edit_date": 1553634643, "creation_date": 1553633203, "answer_id": 55365927, "question_id": 55365605, "link": "https://stackoverflow.com/questions/55365605/read-on-int-works-in-isolation-but-how-to-get-it-to-work-in-this-script/55365927#55365927", "title": "read on int works in isolation, but how to get it to work in this script?", "body": "<p>I've annotated <code>read'</code> in your script with the type expected from it:</p>\n\n<pre><code>read' :: String -&gt; Int32\nread' s = case reads s of\n  [(x,\"\")] -&gt; x\n  _ -&gt; error $ \" read error, reading: '\" ++ s ++ \"'\"\n</code></pre>\n\n<p>and immediately got an error:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Maybe Int32\u2019\n              with actual type \u2018Int32\u2019\n\u2022 In a stmt of a 'do' block: miInt &lt;- read' (unpack mrkStr)\n</code></pre>\n\n<p>Indeed, the <code>do</code> block in <code>rep2Key</code> is run in the <code>Maybe</code> context, so the line</p>\n\n<pre><code>miInt &lt;- read' (unpack mrkStr)\n</code></pre>\n\n<p>binds <code>miInt :: Int32</code>, but the expression on the right has the type <code>Maybe Int32</code>. This is why annotating <code>miInt</code> by itself didn't point to the problem.</p>\n\n<p>If you want to fail the parsing (?), change <code>read'</code> to return a <code>Maybe</code>, like this:</p>\n\n<pre><code>read' :: Read a =&gt; String -&gt; Maybe a\nread' s = case reads s of\n  [(x,\"\")] -&gt; Just x\n  _  -&gt; Nothing\n</code></pre>\n\n<p>If you want to keep the <code>error</code> behavior (and <code>read'</code> signature), or for any other functions that return a pure value, you can change the line in <code>rep2Key</code> to</p>\n\n<pre><code>let miInt = read' (unpack mrkStr)\n</code></pre>\n\n<p>Here <code>miInt</code> is bound to the value from the right hand side without invoking <code>&gt;&gt;=</code>, so it'll be expected to be the same type (<code>Int32</code> without <code>Maybe</code>).</p>\n\n<p>A <a href=\"https://www.stackage.org/lts-13.14/hoogle?q=Read%20a%20%3D%3E%20String%20-%3E%20Maybe%20a\" rel=\"nofollow noreferrer\">Hoogle search</a> shows that this last function exists in Prelude as <a href=\"https://www.stackage.org/haddock/lts-13.14/base-4.12.0.0/Text-Read.html#v:readMaybe\" rel=\"nofollow noreferrer\">Text.Read.readMaybe</a>.</p>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 55365927, "answer_count": 1, "score": 1, "last_activity_date": 1553634643, "creation_date": 1553631538, "question_id": 55365605, "link": "https://stackoverflow.com/questions/55365605/read-on-int-works-in-isolation-but-how-to-get-it-to-work-in-this-script", "title": "read on int works in isolation, but how to get it to work in this script?", "body": "<p>When I try to call read to read an <code>Int32</code>, it works in GHCi:</p>\n\n<pre><code>$ ghci\nGHCi, version 8.4.4: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; import Data.Int\nPrelude Data.Int&gt; let fooInt32 :: Int32; fooInt32 = read \"6531\"\nPrelude Data.Int&gt; :t fooInt32\nfooInt32 :: Int32\nPrelude Data.Int&gt; fooInt32\n6531\n</code></pre>\n\n<p>However, in my app, I get this error (used a wrapped read for better error messages):</p>\n\n<pre><code>readInt32.hs:  read error, reading: '6531'\nCallStack (from HasCallStack):\n  error, called at /home/brandon/workspace/ProjectGists/Haskell/ReadInt32/readInt32.hs:27:9 in main:Main\n</code></pre>\n\n<p>Here's a self-contained stack script that exemplifies the error:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-13.14 script\n{-# LANGUAGE OverloadedStrings #-}\n\nimport           Data.Int\nimport           Data.Maybe                       (fromJust, isJust, listToMaybe)\nimport           Data.String                      (IsString(..))\nimport           Data.Text                        (Text, pack, splitOn, unpack)\nimport           Data.Time.Calendar               (Day(..))\nimport           Data.Time.Clock                  (UTCTime(..))\nimport           Data.Typeable\n\nnewtype CowMark = CowMark {unCowMark :: Int32}\n  deriving (Eq, Ord, Read, Show, Typeable)\n\nnewtype TableName = TableName {unTableName :: Text}\n  deriving (Eq, Ord, Read, Show)\n\ninstance IsString TableName where\n  fromString str = TableName $ pack str\n\ntype CowRecordKey = (TableName, CowMark, UTCTime)\n\nread' :: Read a =&gt; String -&gt; a\nread' s = case reads s of\n  [(x,\"\")] -&gt; x\n  _  -&gt; error $ \" read error, reading: '\" ++ s ++ \"'\"\n\nrep2Key :: String -&gt; Maybe CowRecordKey\nrep2Key strKey = do\n  splList &lt;- return $ splitOn \"_\" (pack strKey)\n  (tblName, mrkStr, timeStr) &lt;- head3 splList\n  miInt &lt;- read' (unpack mrkStr)\n  timeOut &lt;- read (unpack timeStr)\n  return $ (TableName $ tblName, CowMark miInt, timeOut)\n  where\n    head3 :: [a] -&gt; Maybe (a, a, a)\n    head3 list@(_:x2:xs) = do\n      mx1 &lt;- listToMaybe list\n      mx2 &lt;- listToMaybe (x2:xs)\n      mx3 &lt;- listToMaybe xs\n      return (mx1, mx2, mx3)\n    head3 _ = Nothing\n\ncowRecKey1 :: CowRecordKey\ncowRecKey1 = (\n    TableName \"SxRecord\"\n  , CowMark 6531\n  , UTCTime (ModifiedJulianDay 3234) 0\n  )\n\ncowRecKeyStr1 :: String\ncowRecKeyStr1 = \"SxRecord_6531_1867-09-25 00:00:00\"\n\nmain = do\n  key1 &lt;- return $ rep2Key cowRecKeyStr1\n  print key1\n</code></pre>\n\n<p>Not really sure what to make of this. I've also tried annotating <code>miInt :: Int32</code> to see if that helped, but it didn't.</p>\n"}, {"tags": ["haskell", "compiler-errors", "functor", "type-mismatch", "either"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 6, "creation_date": 1553628652, "post_id": 55364861, "comment_id": 97453537, "body": "You reversed <code>a</code> and <code>b</code>. Should be <code>data Alt a b = Success b | Failure a</code>, since you want to apply <code>f</code> to the value of type <code>b</code>, not type <code>a</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1553630260, "post_id": 55364861, "comment_id": 97454243, "body": "For what it&#39;s worth, I am opposed to the vote to close this as a simple typographical error. Although it is a two-character change to fix, knowing how to make that change requires a fairly deep understanding of a variety of very on-topic Haskell concepts, and would not be found by a non-Haskell-expert doing a glorified spellchecking pass."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1553668103, "post_id": 55364861, "comment_id": 97464533, "body": "@Daniel Wagner: thanks for keeping it open. I do understand Benjamin&#39;s elaborate explanation but otherwise would not have found it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553675291, "post_id": 55364861, "comment_id": 97467675, "body": "@DanielWagner, I tend to vote to close questions with that reason when they are (essentially) impossible for someone with a similar problem to find. It&#39;s a sad fact that it&#39;s really, really hard to search for information on typical type errors and find something <i>relevant</i>. Things with similar words are utterly irrelevant; things that are right on point have completely unrelated words."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1553692597, "post_id": 55364861, "comment_id": 97478433, "body": "@dfeuer Madderote has a similar (identical, in fact!) problem, and found(ed) this question. It would be a shame to close the question and deprive them of an answer just because some hypothetical future visitor hypothetically didn&#39;t find this question."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553698947, "post_id": 55364861, "comment_id": 97482920, "body": "@DanielWagner IOW we should separate the concerns, stop worrying about searchability, concentrate on answering and let <i>SO+Google</i> worry about improving <i>their</i> search algorithms! :)"}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1553699812, "post_id": 55364861, "comment_id": 97483544, "body": "@Community: appreciate the efforts, comments and the great answer by Benjamin. Even if one does not immediately find the answer, it can still help someone that stumbled across this thread, as SO helped me many times when stuck."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1558486996, "post_id": 55364861, "comment_id": 99114264, "body": "@WillNess, I just don&#39;t see a way to make these things searchable without strong AI."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1558496810, "post_id": 55364861, "comment_id": 99115903, "body": "@dfeuer depends on what &quot;these things&quot; means. :) tags here seem relevant, so a search on tags along would do fine in this case."}], "answers": [{"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 1, "creation_date": 1553668449, "post_id": 55366789, "comment_id": 97464675, "body": "Hogson: great explanation. Thank you. I do understand the theory behind it, but never giving it any though that Functor is right-bound, so never even tried to reverse parameter order. Mapping it over <code>Failure</code> is also not a viable option I think.  For any noob ready this: this is the reason I went over Brent Yorgey&#39;s Typeclassopedia again, to get this thorough understanding of types. Benjamin&#39;s explanation definitely added to that understanding, so to it into my own documentation."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 1, "creation_date": 1553676399, "post_id": 55366789, "comment_id": 97468199, "body": "@Madderote, mapping over failure is a different idea, but it turns out to make sense too. See <a href=\"http://hackage.haskell.org/package/errors-2.3.0/docs/Data-EitherR.html#t:EitherR\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/errors-2.3.0/docs/&hellip;</a>"}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553699935, "post_id": 55366789, "comment_id": 97483632, "body": "@dfeuer: Hah! Thanks for pointing me to that. Back to Typeclassopedia to get some routine in all this."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553705472, "post_id": 55366789, "comment_id": 97487186, "body": "Since <code>*</code> doesn&#39;t appear in standard Haskell syntax (you need <code>KindSignatures</code> or a similar extension to use it), and since GHC has been making the transition from <code>*</code> to <code>Type</code> for a few years, I think you should probably mention the new pronunciation (found in <code>Data.Kind</code>)."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 11, "last_activity_date": 1558471876, "last_edit_date": 1558471876, "creation_date": 1553637503, "answer_id": 55366789, "question_id": 55364861, "link": "https://stackoverflow.com/questions/55364861/haskell-defining-functor-instance-for-an-alternative-either-data-type/55366789#55366789", "title": "Haskell defining Functor instance for an alternative Either data type", "body": "<p><a href=\"https://stackoverflow.com/questions/55364861/haskell-trying-either-alternative#comment97453537_55364861\">As @chepner says in the comments</a>, your code will compile if you switch the order of the type parameters,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Alt b a = Success a | Failure b\n</code></pre>\n\n<p>or alternatively switch the <em>meaning</em> of the <code>Functor</code> instance, so that it maps over <code>Failure</code> and leaves <code>Success</code> alone.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Functor (Alt a) where\n    fmap f (Success x) = Success x\n    fmap f (Failure x) = Failure (f x)\n</code></pre>\n\n<p>Basically, the <code>Functor</code> type class only knows how to map over a type's last type parameter. So we had to rejig things so that we apply the function <code>f</code> to an occurrence of that last type parameter.</p>\n\n<hr>\n\n<p><strong>Why</strong> you can only map over the rightmost parameter is a very deep and interesting question. To understand this you have to understand <em>kinds</em>, which are an advanced feature of Haskell's type system.</p>\n\n<p>You can think of kinds as being the \"next level\" of types, in some sense. Types classify values; kinds classify types. So <code>\"foo\"</code> is a <code>String</code>, and <code>String</code> is a type. In Haskell \"type\" is pronounced <code>*</code>.</p>\n\n<pre><code>-- :t in ghci asks for the type of a value-level expression\nghci&gt; :t \"foo\"\n\"foo\" :: String\n\n-- :k asks for the kind of a type-level expression\nghci&gt; :k String\nString :: *\n</code></pre>\n\n<p>All ordinary types - those which can have values - have a kind of <code>*</code>. So <code>String :: *</code>, <code>Int :: *</code>, <code>Bool :: *</code>, etc.</p>\n\n<p>Things get interesting when you start thinking about parameterised types. <code>Maybe</code> is not a type by itself - you can't have values of type <code>Maybe</code>, but you can have <code>Maybe Int</code>, <code>Maybe String</code>, etc. So <code>Maybe</code> is a sort of function - it takes a type as an argument and it produces a type. (<code>Maybe</code> is a <em>type constructor</em>, to use the technical term.)</p>\n\n<pre><code>-- Maybe is a function...\nghci&gt; :k Maybe\nMaybe :: * -&gt; *\n\n-- and you can apply it to an argument to get a type\nghci&gt; :k Maybe Int\nMaybe Int :: *\n</code></pre>\n\n<p><code>Alt</code> is a two-parameter type function. Type functions are curried in Haskell, just like regular value functions, so <code>Alt</code> has a type of <code>* -&gt; * -&gt; *</code> (which really means <code>* -&gt; (* -&gt; *)</code>).</p>\n\n<pre><code>ghci&gt; :k Alt\nAlt :: * -&gt; * -&gt; *\n</code></pre>\n\n<p>Now, <code>Functor</code> is a <em>higher-order</em> type function. It takes an argument <code>f</code>, which itself is a type function. <code>Functor</code> on its own is not a valid type class constraint, but <code>Functor f</code> is.</p>\n\n<pre><code>ghci&gt; :k Functor\nFunctor :: (* -&gt; *) -&gt; Constraint\n</code></pre>\n\n<p>This means <code>Maybe</code> on its own, with a kind of <code>* -&gt; *</code>, is a valid argument for the <code>Functor</code> type function. But <code>Int :: *</code> isn\u2019t, and nor is <code>Maybe Int :: *</code>, and nor is <code>Alt :: * -&gt; * -&gt; *</code>. The error messages tell you about the kind mismatch:</p>\n\n<pre><code>ghci&gt; :k Functor Int\n&lt;interactive&gt;:1:9: error:\n    \u2022 Expected kind \u2018* -&gt; *\u2019, but \u2018Int\u2019 has kind \u2018*\u2019\n    \u2022 In the first argument of \u2018Functor\u2019, namely \u2018Int\u2019\n      In the type \u2018Functor Int\u2019\n\nghci&gt; :k Functor Alt\n&lt;interactive&gt;:1:9: error:\n    \u2022 Expecting one more argument to \u2018Alt\u2019\n      Expected kind \u2018* -&gt; *\u2019, but \u2018Alt\u2019 has kind \u2018* -&gt; * -&gt; *\u2019\n    \u2022 In the first argument of \u2018Functor\u2019, namely \u2018Alt\u2019\n      In the type \u2018Functor Alt\u2019\n</code></pre>\n\n<p>The kind system is there to prevent you from forming invalid types, just like how the type system prevents you from writing invalid values. If there was no kind system, and we were allowed to write <code>instance Functor Alt</code>, it would produce the following (nonsensical) type for <code>fmap</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- `Alt a` is not a valid type, because its second argument is missing!\nfmap :: (a -&gt; b) -&gt; Alt a -&gt; Alt b\n</code></pre>\n\n<p>So we need to turn <code>Alt :: * -&gt; * -&gt; *</code> into something of kind <code>* -&gt; *</code>, in order to have a valid argument for <code>Functor</code>. <code>Alt</code> is a curried type function, so if we give it a single type argument, we'll get a type function back!</p>\n\n<pre><code>ghci&gt; :k Functor (Alt Int)\nFunctor (Alt Int) :: Constraint\n</code></pre>\n\n<p>That's why the <code>instance</code> declaration says <code>instance Functor (Alt x)</code> - it needs to give <code>Alt</code> an argument (and in this case the argument can be any type <code>x</code> as long as its kind is <code>*</code>). Now we have <code>fmap :: (a -&gt; b) -&gt; Alt x a -&gt; Alt x b</code>, which is a valid type expression.</p>\n\n<p>So in general, the recipe for making a <code>Functor</code> instance is to start by giving arguments to your type until it only has one parameter left. That's why <code>Functor</code> only knows how to map over the rightmost type parameter. As an exercise you can try defining a <code>Functor</code> class which maps over the <em>second</em>-to-last type parameter.</p>\n\n<p>This is a big topic so hopefully I haven't gone too fast. It's OK not to understand kinds straight away - it took me several tries! Let me know in the comments if there's anything you'd like me to explain further.</p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 0, "accepted_answer_id": 55366789, "answer_count": 1, "score": 5, "last_activity_date": 1558471876, "creation_date": 1553628328, "last_edit_date": 1553700488, "question_id": 55364861, "link": "https://stackoverflow.com/questions/55364861/haskell-defining-functor-instance-for-an-alternative-either-data-type", "title": "Haskell defining Functor instance for an alternative Either data type", "body": "<p>Going through Typeclassopedia to gain some routing working with type classes. Want to make an alternative to <code>Either</code> an instance of <code>Functor</code>, but even examining the definition of <code>Either</code> as an instance of <code>Functor</code> keeps getting me in trouble. \nHave this, but will not compile. </p>\n\n<pre><code>data Alt a b = Success a | Failure b deriving (Show, Eq, Ord) \n\ninstance Functor (Alt a) where \n  fmap _ (Failure a) = Failure a\n  fmap f (Success x) = Success (f x)  \n\n    \u2022 Couldn't match expected type \u2018a1\u2019 with actual type \u2018a\u2019\n      \u2018a1\u2019 is a rigid type variable bound by\n        the type signature for:\n          fmap :: forall a1 b. (a1 -&gt; b) -&gt; Alt a a1 -&gt; Alt a b\n        at Brenty_tcop.hs:25:3-6\n      \u2018a\u2019 is a rigid type variable bound by\n        the instance declaration\n        at Brenty_tcop.hs:24:10-24\n    \u2022 In the first argument of \u2018f\u2019, namely \u2018x\u2019\n      In the first argument of \u2018Success\u2019, namely \u2018(f x)\u2019\n      In the expression: Success (f x)\n    \u2022 Relevant bindings include\n        x :: a (bound at Brenty_tcop.hs:26:19)\n        f :: a1 -&gt; b (bound at Brenty_tcop.hs:26:8)\n        fmap :: (a1 -&gt; b) -&gt; Alt a a1 -&gt; Alt a b\n          (bound at Brenty_tcop.hs:25:3)\n   |\n26 |   fmap f (Success x) = Success (f x) \n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1553627793, "post_id": 55364512, "comment_id": 97453163, "body": "<code>xsum s = sum (zipWith (*) (map sum (inits s)) (map sum (tails s)))</code>"}, {"owner": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1553628111, "post_id": 55364512, "comment_id": 97453304, "body": "Thanks again for your input! As i said above i cant implement it using the functions like zipWith and map (also sum), cause i must only use very basic functions. But ill see if i can do something with the code you provided ! :-)"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1553628271, "post_id": 55364512, "comment_id": 97453374, "body": "Sure, the source code for all of those functions are open to the public, so you can just copy and paste to reimplement the functions that aren&#39;t available to you."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553628372, "post_id": 55364512, "comment_id": 97453428, "body": "you hid your requirement in the middle of a lengthy post. :) I didn&#39;t see it. perhaps it should have been <b>emphasized</b> in some way....?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553628521, "post_id": 55364512, "comment_id": 97453487, "body": "what is the question? there is no question."}, {"owner": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "edited": false, "score": 0, "creation_date": 1553628882, "post_id": 55364512, "comment_id": 97453641, "body": "yes youre right thanks for the edit , im still new to this and haskell. The question is to implement the formula as seen in the picture using basic functions. Ive posted some desired results at the end. Also im using hugs :-("}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553629126, "post_id": 55364512, "comment_id": 97453758, "body": "Are you sure the desired results are correct? I <i>think</i>  <code>xsum [4,5,8] = 124</code> according to the formula you gave."}, {"owner": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "edited": false, "score": 0, "creation_date": 1553629410, "post_id": 55364512, "comment_id": 97453889, "body": "oh another mistake youre right , yes its 124 , forgive me"}], "answers": [{"comments": [{"owner": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "edited": false, "score": 0, "creation_date": 1553627869, "post_id": 55364656, "comment_id": 97453192, "body": "yes the ^ is my mistake , the correct symbol its * , a fellow stackoverflower here made and edit on that thank god. Not far but i will try. Also because its a school assignment i cant use those functions even sum , if you see in the code that i posted i created one myself."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "edited": false, "score": 0, "creation_date": 1553628198, "post_id": 55364656, "comment_id": 97453337, "body": "Indeed, but each of the few functions I mentioned is simple to implement, and it may be easier to build it out of these simple blocks (where you can peek at the prelude implementation if needed!). Although, there is also be a straight-up recursive definition which isn&#39;t too complicated. If you show your attempts we can give incremental hints."}, {"owner": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "edited": false, "score": 0, "creation_date": 1553629153, "post_id": 55364656, "comment_id": 97453772, "body": "ok ill try and i will send feeback if i acomplish anything. Im worried cause im fairly new to this , only twoo weeks in class with haskell and they presented us with those problems."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "edited": false, "score": 0, "creation_date": 1553629771, "post_id": 55364656, "comment_id": 97454039, "body": "<code>xsum (x:xs@(y:ys)) = _</code> <code>xsum _ = _</code> see if you can fill in the right-hand-sides of these definitions for the recursive solution. The only other function you&#39;ll need for this is <code>sum</code> which you&#39;ve already (correctly) defined. My hint is that I&#39;ve already pattern-matched on the values you&#39;ll need (ie.. the clean way of writing it mentions all of <code>x, xs, y, ys</code>)"}, {"owner": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "edited": false, "score": 0, "creation_date": 1553633189, "post_id": 55364656, "comment_id": 97455442, "body": "@A Tayler i tried   xsum(x:xs@(y:y s)) = x * ( sumIntList xs ) + (x + y) * (sumIntList ys)     xsum [2] = 0     xsum [1] = 0     xsum [] = 0 , but only works for the first one . Sorry i coudnt formatted as code"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "edited": false, "score": 0, "creation_date": 1553634262, "post_id": 55364656, "comment_id": 97455889, "body": "You&#39;re close. The first part is correct, <code>(x+y)*...</code> is not, you will need a recursive call to <code>xsum</code>."}, {"owner": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "edited": false, "score": 0, "creation_date": 1553636493, "post_id": 55364656, "comment_id": 97456781, "body": "i thought about     xsum (x:xs@(y:ys)) = x * ( sumIntList xs ) + xsum xs    but i get an error. I should also make a guard so that when the elements of the list are under 2 , we get a 0"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "edited": false, "score": 0, "creation_date": 1553636723, "post_id": 55364656, "comment_id": 97456884, "body": "You will need <code>x+y</code>. Add the current item into the head of the remainder of the list then make the recursive call on the resultant list. Yes, you will need <code>xsum _ = 0</code> as a second line. You&#39;re really close!"}, {"owner": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "edited": false, "score": 0, "creation_date": 1553640372, "post_id": 55364656, "comment_id": 97458109, "body": "again i tried xsum (x:xs@(y:ys)) = x * ( sumIntList xs ) + (x+y) + (xsum xs)  for the first line and xsum ys        | length ys &lt; 2          = 0                               for the second . I must be missing smthing"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "edited": false, "score": 0, "creation_date": 1553642357, "post_id": 55364656, "comment_id": 97458696, "body": "For the first line <code>xsum (x:xs@(y:ys)) = x * sumIntList xs + xsum ((x+y):ys)</code> , for the second line just <code>xsum _ = 0</code> because <code>_</code> catches all other cases which is what we want. The resulting implementation is not ideal because we&#39;re calling <code>sumIntList</code> across <code>tails</code> and the results are highly shareable, but it&#39;s simple and uses no extra functions. A better implementation would use a <code>scanl</code> front-to-back and back-to-front to generate the partial prefix-/suffix sums, zip them together, multiply the pairs, and sum the result."}, {"owner": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "edited": false, "score": 0, "creation_date": 1553642871, "post_id": 55364656, "comment_id": 97458838, "body": "wow great works fine . the xsum ((x+y):ys) part for me it too difficult to come up with though .but yeah good job"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553711971, "post_id": 55364656, "comment_id": 97490642, "body": "you don&#39;t need <code>scanl</code>. use same trick that you do with <code>(x+y)</code> -- save the first <code>sum xs</code> and then do <code>(sum - y)</code> as you move to the right. You will need an additional argument. I.e. if <code>sum (y:ys) = s</code>, then <code>sum ys = s - y</code>. Nice job. :)"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553715517, "post_id": 55364656, "comment_id": 97492311, "body": "Huh, cool idea. Though, if you&#39;re willing to fiddle with the top-level structure (such as by adding a helper function / argument) then it&#39;s easy to do the summing manually because you&#39;re recursing on the list, otherwise you summing it and then subtracting back down to 0."}], "tags": [], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "is_accepted": true, "score": 1, "last_activity_date": 1553725602, "last_edit_date": 1553725602, "creation_date": 1553627489, "answer_id": 55364656, "question_id": 55364512, "link": "https://stackoverflow.com/questions/55364512/haskell-calculate-complex-sum-using-lists/55364656#55364656", "title": "Haskell - Calculate complex sum using lists", "body": "<p>The image you provided says <code>*</code> rather than <code>^</code>. It would be good to see some of your attempts. One simple approach would be to map the function <code>splitAt</code> across each possible index, then use the function <code>sum</code> on each pair to get the (initial segment sum, final segment sum) pair, then for each pair multiply its elements together, then sum all the resulting products. How far can you get with coding that up?</p>\n\n<p>EDIT: to save potential future readers from scrolling through all the comments, a potential implementation is given below that uses only <code>sum</code>. It is suboptimal because it <code>sum</code>s the same sublists many times over, a better implementation might start by using <code>scanl</code> in both directions to generate the partial sums and proceed from there.</p>\n\n<pre><code>xsum (x:xs@(y:ys)) = x * sum xs + xsum ((x+y):ys)\nxsum _ = 0\n</code></pre>\n\n<p>EDIT2: We have a (sort of) forwards-travelling and backwards-travelling thing going on, I like it!</p>\n\n<pre><code>xsum = fst . xsum'\n  where xsum' (x:xs@(y:ys)) = (\\(acc,s) -&gt; (acc + x * (s-x),s) ) $ xsum' ((x+y):ys)\n        xsum' [] = (0,0)\n        xsum' [x] = (0,x)\n</code></pre>\n"}], "owner": {"reputation": 129, "user_id": 11217204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21225c0307007ebde12a4211d54013c?s=128&d=identicon&r=PG&f=1", "display_name": "DavidDunn", "link": "https://stackoverflow.com/users/11217204/daviddunn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 55364656, "answer_count": 1, "score": -2, "last_activity_date": 1553725602, "creation_date": 1553626830, "last_edit_date": 1553629427, "question_id": 55364512, "link": "https://stackoverflow.com/questions/55364512/haskell-calculate-complex-sum-using-lists", "title": "Haskell - Calculate complex sum using lists", "body": "<p>for a given list by user <code>s=[x1,x2,...,xk]</code> I need to calculate the sum of</p>\n\n<pre><code>x1 * (x2+x3+...x4)\n+ (x1+x2) * (x3+x4+...xk)\n+ ...\n+ (x1+x2+...+x(k-2)) * (x(k-1) + xk)\n+ (x1+x2+...+x(k-1)) * xk\n</code></pre>\n\n<p>from a function <code>[Int]-&gt;Int</code></p>\n\n<p>Please see the math formula in the following photo for better understanding :</p>\n\n<p><a href=\"https://imgur.com/gallery/Oqgpkcu\" rel=\"nofollow noreferrer\">https://imgur.com/gallery/Oqgpkcu</a></p>\n\n<p>just tried very little things like calculating the sum of the list minus the last element. <strong>By the way i must implement all of this by using lists and very basic functions (head, tail ,init )</strong></p>\n\n<pre><code>xsum :: [Int] -&gt; Int\nxsum s = sumIntList (init s)\n\nsumIntList :: [Int] -&gt; Int \nsumIntList (h:t) = h + sumIntList t\nsumIntList [] = 0\n</code></pre>\n\n<p>some of the result that SHOULD be produced by the calling of the function are :</p>\n\n<pre><code>xsum [4,5,8]\n124\n\nxsum [1..100]\n341665830\n</code></pre>\n\n<p>Thanks for reading !</p>\n"}, {"tags": ["list", "haskell", "user-input", "io-monad", "do-notation"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553625088, "post_id": 55363795, "comment_id": 97451891, "body": "There should be a new line after <code>getLine</code>, and that <code>[]</code> shouldn&#39;t be there. And make sure you line up the <code>p</code> of <code>print</code> with the <code>x</code> in <code>xs</code>"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1553625662, "last_edit_date": 1553625662, "creation_date": 1553624880, "answer_id": 55363994, "question_id": 55363795, "link": "https://stackoverflow.com/questions/55363795/ask-user-for-list-input-in-haskell/55363994#55363994", "title": "Ask user for list input in Haskell", "body": "<p><code>getLine</code> is an <code>IO</code> action that produces a string, nothing else. You need to process that string once you receive it. As an example, here's an <code>IO</code> action that will parse an appropriate input into a list of <code>Int</code> values.</p>\n\n<pre><code>getIntList :: IO [Int]\ngetIntList = fmap read getLine\n\nmain = do\n         ints &lt;- getIntList\n         print ints\n</code></pre>\n\n<p>There is a <code>Read</code> instance for lists, so the following works:</p>\n\n<pre><code>&gt; read \"[1,2,3]\" :: [Int]\n[1,2,3]\n</code></pre>\n\n<p><code>getIntList</code> uses the <code>Functor</code> instance for <code>IO</code> to apply <code>read</code> to the string that <code>getLine</code> will produce; <code>read</code>'s concrete type will be inferred from the type given to <code>getIntList</code>: since <code>getIntList :: IO [Int]</code>, then <code>fmap read :: IO String -&gt; IO [Int]</code>, and so <code>read :: String -&gt; [Int]</code> will be used.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 2, "last_activity_date": 1602104003, "last_edit_date": 1602104003, "creation_date": 1553625956, "answer_id": 55364266, "question_id": 55363795, "link": "https://stackoverflow.com/questions/55363795/ask-user-for-list-input-in-haskell/55364266#55364266", "title": "Ask user for list input in Haskell", "body": "<p>You do it e.g. like this:</p>\n<pre><code>main :: IO ()\nmain = do\n  xs &lt;- getLine\n  let { ints :: [Int] \n      ; ints = read xs \n      }\n  print $ take 2 ints\n  \n</code></pre>\n<p>and you must type in the input in a valid list syntax, e.g.</p>\n<pre><code>[1,2,3]\n</code></pre>\n<p>Do take note, each line in a <code>do</code>-block must start at the same indentation level (unless explicit separators <code>{ ; }</code> are used).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11239824"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 55364266, "answer_count": 2, "score": 0, "last_activity_date": 1607893343, "creation_date": 1553624102, "last_edit_date": 1602103869, "question_id": 55363795, "link": "https://stackoverflow.com/questions/55363795/ask-user-for-list-input-in-haskell", "title": "Ask user for list input in Haskell", "body": "<p>I found this code online, but it's not running.</p>\n<pre><code>main = do\n xs &lt;- getLine []\nprint xs\n</code></pre>\n<p>So how do I ask the user for list input in Haskell? I am new to Haskell, please explain when you answer. Thanks.</p>\n"}, {"tags": ["haskell", "haskell-stack", "haskell-chart"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553612904, "post_id": 55359075, "comment_id": 97444688, "body": "I&#39;m not familiar with this library, but I&#39;m fairly sure that you can get rid of this error by disabling <code>MonadFailDesugaring</code> in GHC (which has only been on by default since 8.6.1) - see <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=inline#new-monadic-failure-desugaring-mechanism\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553617370, "post_id": 55359075, "comment_id": 97447634, "body": "@Robin Zigmond: but that&#39;s a language pragma, right? Can I explicitly disable (or change) a pragma from my source file, rather than altering a library?"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553618218, "post_id": 55359075, "comment_id": 97448184, "body": "At the top of your file, {-# LANGUAGE NoMonadFailDesugaring #-}"}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1553619233, "post_id": 55359075, "comment_id": 97448815, "body": "@A Tayler: thanks. Overlooked that somehow."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 13158298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4da4f500847cee52f74c30a0facac440?s=128&d=identicon&r=PG&f=1", "display_name": "Neil Villamizar", "link": "https://stackoverflow.com/users/13158298/neil-villamizar"}, "is_accepted": false, "score": 2, "last_activity_date": 1590414815, "creation_date": 1590414815, "answer_id": 62003858, "question_id": 55359075, "link": "https://stackoverflow.com/questions/55359075/haskell-chart-breaks-stack-build/62003858#62003858", "title": "Haskell Chart breaks stack build", "body": "<p>You have some options to solve that problem. You are trying to do pattern matching in a 'do' block with non-exhaustive patterns. In order to do that:</p>\n\n<ul>\n<li><p>You could disable the MonadFailDesugaring extension. Add {-# LANGUAGE NoMonadFailDesugaring #-} in the top of the file or compile with the flag -XNoMonadFailDesugaring. But this extension cannot be deactivated in GHC 8.8 ot later.</p></li>\n<li><p>You could define or derive a MonadFail instance.</p></li>\n<li><p>You could use the State monad. If a lower monad in the monad transformer stack is an instance of MonadFail, then we can make the highest monad an instance of MonadFail as well.</p></li>\n<li><p>Desist, and perform explicit and exhaustive pattern matching.</p></li>\n</ul>\n\n<p>source: <a href=\"http://www.fyrbll.me/haskell/language-extensions/monad-fail-desugaring/processed.html\" rel=\"nofollow noreferrer\">http://www.fyrbll.me/haskell/language-extensions/monad-fail-desugaring/processed.html</a></p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 327, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1590414815, "creation_date": 1553608993, "last_edit_date": 1553621869, "question_id": 55359075, "link": "https://stackoverflow.com/questions/55359075/haskell-chart-breaks-stack-build", "title": "Haskell Chart breaks stack build", "body": "<p>Trying using Chart for learning Haskell. Package breaks in building with: </p>\n\n<pre><code>/private/var/folders/m2/qwhdrn_d46z99_3vxchdwn7r0000gn/T/stack5630/Chart-1.9/Graphics/Rendering/Chart/State.hs:102:3: error:\n    \u2022 No instance for (Control.Monad.Fail.MonadFail Identity)\n        arising from a do statement\n        with the failable pattern \u2018(c : cs)\u2019\n    \u2022 In a stmt of a 'do' block: (c : cs) &lt;- use shapes\n      In the second argument of \u2018($)\u2019, namely\n        \u2018do (c : cs) &lt;- use shapes\n            shapes .= cs\n            return c\u2019\n      In the expression:\n        liftCState\n          $ do (c : cs) &lt;- use shapes\n               shapes .= cs\n               return c\n    |\n102 |   (c:cs) &lt;- use shapes\n</code></pre>\n\n<p>I am too inexperienced to know how to go about issues like this. Please advise.</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1553607932, "post_id": 55358056, "comment_id": 97441133, "body": "There seem to be two different questions here. You can&#39;t call <code>f</code> because there are no instances of <code>C</code>. But if you add an instance, say <code>instance C Char</code>, then <code>f &#39;a&#39;</code> works fine."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1553609863, "post_id": 55358056, "comment_id": 97442551, "body": "OK. I should learn not to edit a q in a hurry. Editted again. Ref @Chepner&#39;s comment, I can&#39;t call <code>f</code> but I can export it. I deliberately don&#39;t want dischargable constraints in this module, so that I force callers of <code>f</code> to access a dictionary."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1553836863, "post_id": 55358056, "comment_id": 97541665, "body": "Thanks @DanielWagner for the answer. I added a supplementary q, if you&#39;re still listening."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553881475, "post_id": 55358056, "comment_id": 97564921, "body": "What is the difference between a &quot;superclass constraint&quot; and a &quot;constraint&quot; (those two things being the only textual difference I see between your questions 2a and 2b)? As for &quot;where they go&quot;, I&#39;m not sure the question is sensible. Since dictionaries aren&#39;t explicitly available in the surface language, it&#39;s not possible to observe <i>where</i> in them particular bits go."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1553906149, "post_id": 55358056, "comment_id": 97573164, "body": "2b &quot;instances with constraints&quot; means constraints on the instances. No we can&#39;t observe the dictionaries, but both you here and SPJ at the link give examples. I presume it&#39;s the mechanism GHC uses to prove a term&#39;s type meets the constraints, even if it&#39;s not calling methods."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553908714, "post_id": 55358056, "comment_id": 97573488, "body": "What is the motivation for these questions? Why do the answers matter?"}], "answers": [{"comments": [{"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1554112850, "post_id": 55358768, "comment_id": 97618680, "body": "&quot;You can&#39;t tell the order that superclass dictionaries are stored in.&quot; Indeed. And I wasn&#39;t asking that. From prev version of the answer (&quot;a dictionary with no fields&quot;) it wasn&#39;t clear whether constraint dictionaries were stored in the same dict as the method overloads, or in some other structure. Then it&#39;s a dictionary with fields for the constraints (if any) but no fields for the methods (because there aren&#39;t any)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1554133637, "post_id": 55358768, "comment_id": 97630785, "body": "@AntC Ah, yep. The dictionary contains both methods and superclass dictionaries as fields."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1553909046, "last_edit_date": 1553909046, "creation_date": 1553608144, "answer_id": 55358768, "question_id": 55358056, "link": "https://stackoverflow.com/questions/55358056/typeclasses-without-methods-used-as-constraints-do-they-get-dictionaries/55358768#55358768", "title": "typeclasses without methods, used as constraints: do they get dictionaries?", "body": "<blockquote>\n  <p>Is there a dictionary for [typeclasses without methods]? What does it contain?</p>\n</blockquote>\n\n<p>Yes, there is a dictionary with no fields.</p>\n\n<p>Compare:</p>\n\n<pre><code>class Monoid a where\n    mempty :: a\n    mappend :: a -&gt; a -&gt; a\ndata DictMonoid a = DictMonoid a (a -&gt; a -&gt; a)\n\nclass C a\ndata DictC a = DictC\n</code></pre>\n\n<blockquote>\n  <p>If <code>M</code> gets imported into some other module (with <code>C</code> instances) how is <code>f</code>'s dictionary lookup encoded?</p>\n</blockquote>\n\n<p>Type inference is used to determine what instance is needed when <code>f</code> is called; then GHC looks up that type in its collection of known instances (=known dictionaries).</p>\n\n<p>One possible outcome of this process is that the instance we determine would be needed is polymorphic, and there is no fully polymorphic instance. Then the appropriate constraint (such as <code>C a</code> or <code>C m</code> or whatever) is attached to the inferred type of whatever term is calling <code>f</code> -- which is then compiled to a function which accepts a dictionary on <code>f</code>'s behalf and passes it on.</p>\n\n<blockquote>\n  <p>For no-method typeclasses with superclass constraints: Where do the constraints go in the dictionary?</p>\n</blockquote>\n\n<p>Somewhere. There's no observation you can make from the surface language to distinguish between different places. For example, consider:</p>\n\n<pre><code>class Semigroup a =&gt; Monoid a where mempty :: a\ndata DictMonoid1 a = DictMonoid1 (DictSemigroup a) a\ndata DictMonoid2 a = DictMonoid2 a (DictSemigroup a)\n</code></pre>\n\n<p>These are sort of the only two choices one could make for where to put the superclass' dictionary. But what difference could it possibly make?</p>\n\n<p>Okay, but you asked about no-method typeclasses. But the answer is the same. You can't tell the order that superclass dictionaries are stored in.</p>\n\n<pre><code>class (A a, B a) =&gt; C a\ndata DictC1 a = DictC1 (DictA a) (DictB a)\ndata DictC2 a = DictC2 (DictB a) (DictA a)\n</code></pre>\n\n<p>What could you possibly do to tell the difference between these? Nothing.</p>\n\n<blockquote>\n  <p>For no-method typeclass instances with constraints: Again where do the constraints go in the dictionary?</p>\n</blockquote>\n\n<p>Nowhere. They become arguments that the caller must supply to receive a dictionary. Particular fields of the supplied dictionary may be closed over by the new dictionary, of course. Example:</p>\n\n<pre><code>class Ord a where compare :: a -&gt; a -&gt; Ordering\ndata DictOrd a where DictOrd (a -&gt; a -&gt; Ordering)\n\ninstance (Ord a, Ord b) =&gt; Ord (a, b) where\n    compare (a,b) (a',b') = compare a a' &lt;&gt; compare b b'\ninstanceOrdTuple :: DictOrd a -&gt; DictOrd b -&gt; DictOrd (a,b)\ninstanceOrdTuple (DictOrd comparea) (DictOrd compareb)\n    = DictOrd $ \\(a,b) (a',b') -&gt; comparea a a' &lt;&gt; compareb b b'\n</code></pre>\n\n<p>Okay, but you asked about no-method typeclasses. But the answer is not significantly different. The instance's constraint dictionaries are not stored anywhere, just like before; the only difference is that now we can also be sure that even the fields of the supplied dictionaries are not closed over.</p>\n\n<pre><code>class A a where whateverA :: a -&gt; Int\nclass B a where whateverB :: Int -&gt; a\nclass C a\ndata DictA a = DictA (a -&gt; Int)\ndata DictB a = DictB (Int -&gt; a)\ndata DictC a = DictC\n\ninstance (A a, B a) =&gt; C [a]\ninstanceCList :: DictA a -&gt; DictB a -&gt; DictC [a]\ninstanceCList (DictA whateverAa) (DictB whateverBa) = DictC\n</code></pre>\n\n<p><strong>The following commentary replies to an old version of the question.</strong></p>\n\n<blockquote>\n  <p>There's no instances for <code>C</code> in this module, so the compiler can't discharge <code>f</code>s constraint.</p>\n</blockquote>\n\n<p>It doesn't need to. <code>f</code> is compiled to a function which <em>takes</em> a dictionary as an argument; there's no need to create a dictionary to compile <code>f</code>, only to compile its callers.</p>\n\n<blockquote>\n  <p>The compiler can't discharge the <code>C Char</code> constraint arising from the equation for <code>y</code>. What does it do?</p>\n</blockquote>\n\n<p>It reports that it can't discharge the <code>C Char</code> constraint and exits unsuccessfully. (This hardly even qualifies as a question -- just try it and see for yourself!)</p>\n"}], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 55358768, "answer_count": 1, "score": 4, "last_activity_date": 1553927399, "creation_date": 1553605977, "last_edit_date": 1553927399, "question_id": 55358056, "link": "https://stackoverflow.com/questions/55358056/typeclasses-without-methods-used-as-constraints-do-they-get-dictionaries", "title": "typeclasses without methods, used as constraints: do they get dictionaries?", "body": "<p>If I'm using a typeclass to overload methods, that's implemented in 'dictionary passing style'. That is, the method gets an extra argument (that doesn't appear in surface Haskell); to resolve overloading the method looks up the dictionary by type of its 'proper' argument(s); and pulls a method implementation out of the dictionary. <a href=\"https://stackoverflow.com/questions/22158673/transform-a-function-with-a-typeclass-constraint-into-a-function-taking-an-expli\">As described in this q, for example</a>.</p>\n\n<p>But what about typeclasses without methods? They can be used as constraints. Is there a dictionary for them? What does it contain?</p>\n\n<p>For a specific example:</p>\n\n<pre><code>module M  where\n\nclass C a             -- no methods\n                      -- no instances in module M\nf :: C a =&gt; a -&gt; Bool\nf x = blah\n</code></pre>\n\n<p>There's no instances for <code>C</code> in this module, so if <code>M</code> gets imported into some other module (with <code>C</code> instances) how is <code>f</code>'s dictionary lookup encoded?</p>\n\n<p>The usual situation would be that class <code>C</code> has method(s); there's calls to them on RHS of the equation for <code>f</code>; so the wanted <code>C a</code> is encoded as a dictionary lookup for the method call.</p>\n\n<p><strong>Supplementary q's:</strong> (if anybody's still listening)</p>\n\n<p>2a. For no-method typeclasses with superclass constraints: Where do the constraints go in the dictionary? A <a href=\"https://gitlab.haskell.org/ghc/ghc/issues/16442#note_190157\" rel=\"nofollow noreferrer\">comment on a ticket from SPJ</a> seems to suggest it's an argument to the dictionary's data constructor.</p>\n\n<p>2b. For no-method typeclass instances with constraints: Again where do the constraints go in the dictionary?</p>\n\n<p><strong>Motivation</strong></p>\n\n<p>@Daniel in the comments is asking the motivation for these q's. Apart from just understanding compiler internals a bit better ...</p>\n\n<p>GHC translates surface Haskell into an Internal Representation: System F<sub>C</sub>, which has aot explicit type signatures at every function application. (Those applications must include applying to the dictionaries for a class.) I'm trying to understand where all the type-related components of class and instance decls go inside the dictionaries; to figure out how a term in F<sub>C</sub> gets to an equivalent representation to the original Haskell. Then I don't understand how [typeclasses without methods] fit in. Because those classes cannot appear directly as terms in surface Haskell, but only as constraints. Then it must be dictionar(ies) for such a class that represent it at term level.</p>\n\n<p>If you want to ask where this is going: there seems to be a limitation in F<sub>C</sub> that it can't represent Functional Dependencies. Something to do with being unable to generate type-level evidence. Then I want to understand how that limitation arises/what about FunDeps can't be (or currently isn't) represented?</p>\n"}, {"tags": ["haskell", "tree", "diff"], "answers": [{"comments": [{"owner": {"reputation": 3024, "user_id": 152436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca96b092fc9b1e74c7342f98f51cf0c?s=128&d=identicon&r=PG", "display_name": "Gareth Stockwell", "link": "https://stackoverflow.com/users/152436/gareth-stockwell"}, "edited": false, "score": 0, "creation_date": 1553674334, "post_id": 55363367, "comment_id": 97467203, "body": "The suggested change to processEdit has the desired effect."}, {"owner": {"reputation": 3024, "user_id": 152436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca96b092fc9b1e74c7342f98f51cf0c?s=128&d=identicon&r=PG", "display_name": "Gareth Stockwell", "link": "https://stackoverflow.com/users/152436/gareth-stockwell"}, "edited": false, "score": 0, "creation_date": 1553674843, "post_id": 55363367, "comment_id": 97467451, "body": "Regarding the suggestion to implement a new type for the changed tree, there are two reasons why I would prefer not to do this:  1. The Tree data type shown in my example is cut down from the real application.  The latter already has a generic node type, which has attributes including a list of labels.  I plan to use these labels to indicate the insertion / deletion.  I realise a strictly typed approach would usually be preferred in Haskell, but using labels fits better with my application."}, {"owner": {"reputation": 3024, "user_id": 152436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca96b092fc9b1e74c7342f98f51cf0c?s=128&d=identicon&r=PG", "display_name": "Gareth Stockwell", "link": "https://stackoverflow.com/users/152436/gareth-stockwell"}, "edited": false, "score": 0, "creation_date": 1553674889, "post_id": 55363367, "comment_id": 97467478, "body": "2. From looking at Diff.hs, the patch function depends on a large number of sub-functions.  The assumption that the input and output trees have the same type is deeply baked into the signatures of these functions.  Therefore implementing patch&#39; would require re-implementing a large part of the underlying library code."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 3024, "user_id": 152436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca96b092fc9b1e74c7342f98f51cf0c?s=128&d=identicon&r=PG", "display_name": "Gareth Stockwell", "link": "https://stackoverflow.com/users/152436/gareth-stockwell"}, "edited": false, "score": 1, "creation_date": 1553678376, "post_id": 55363367, "comment_id": 97469463, "body": "@GarethStockwell, that sounds like a great improvement you could contribute to the library!"}, {"owner": {"reputation": 3024, "user_id": 152436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca96b092fc9b1e74c7342f98f51cf0c?s=128&d=identicon&r=PG", "display_name": "Gareth Stockwell", "link": "https://stackoverflow.com/users/152436/gareth-stockwell"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553692581, "post_id": 55363367, "comment_id": 97478418, "body": "@dfeuer This program is the first Haskell I have ever written. I&#39;m trying to walk before I can run :)"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553693502, "post_id": 55363367, "comment_id": 97479054, "body": "This is already more running than walking lol unless you come from Idris or something like that. The internals of gdiff look pretty hairy to me, I just had an intuition about how to fix it that was roughly correct and didnt require me to understand more deeply. Original author of gdiff posted here (can&#39;t link rn) that he might write it differently if using updated GHC generics."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553699694, "post_id": 55363367, "comment_id": 97483444, "body": "<a href=\"https://stackoverflow.com/questions/28707547/is-the-gdiff-library-obsolete\" title=\"is the gdiff library obsolete\">stackoverflow.com/questions/28707547/&hellip;</a>"}, {"owner": {"reputation": 3024, "user_id": 152436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca96b092fc9b1e74c7342f98f51cf0c?s=128&d=identicon&r=PG", "display_name": "Gareth Stockwell", "link": "https://stackoverflow.com/users/152436/gareth-stockwell"}, "edited": false, "score": 0, "creation_date": 1553723957, "post_id": 55363367, "comment_id": 97496126, "body": "@ATayler can you see a way to transform <code>$ Del Node $</code> into <code>$ Ins DelNode $</code>?  I have tried to add an override to processEdit, but can&#39;t see how to make the type signatures of Del and Ins line up appropriately.  If you have any suggestions, could you please expand your answer to include them?"}, {"owner": {"reputation": 3024, "user_id": 152436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca96b092fc9b1e74c7342f98f51cf0c?s=128&d=identicon&r=PG", "display_name": "Gareth Stockwell", "link": "https://stackoverflow.com/users/152436/gareth-stockwell"}, "edited": false, "score": 0, "creation_date": 1553723996, "post_id": 55363367, "comment_id": 97496138, "body": "@ATayler re walking and running, my background is mostly C and Python - so I&#39;m feeling more than a little lost in the world of Haskell at the moment :)  Thanks for your help with this."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 3024, "user_id": 152436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca96b092fc9b1e74c7342f98f51cf0c?s=128&d=identicon&r=PG", "display_name": "Gareth Stockwell", "link": "https://stackoverflow.com/users/152436/gareth-stockwell"}, "edited": false, "score": 0, "creation_date": 1553728173, "post_id": 55363367, "comment_id": 97497483, "body": "@GarethStockwell I tried for a couple mins but it&#39;s not straightforward. I would roll custom diff / patch functions, that&#39;s not difficult."}], "tags": [], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "is_accepted": true, "score": 0, "last_activity_date": 1553622757, "last_edit_date": 1553622757, "creation_date": 1553622440, "answer_id": 55363367, "question_id": 55355019, "link": "https://stackoverflow.com/questions/55355019/using-text-generic-diff-to-generate-output-containing-inserted-deleted-mar/55363367#55363367", "title": "Using Text.Generic.Diff to generate output containing &quot;inserted&quot; / &quot;deleted&quot; markers", "body": "<p>Just specialize <code>processEdit</code> to be on <code>TreeFamily</code> (because obviously what you're trying to accomplish is specific to <code>TreeFamily</code>) and pattern match on the (first) argument to <code>Ins</code>.</p>\n\n<pre><code>processEdit :: EditScriptL TreeFamily txs tys -&gt; EditScriptL TreeFamily txs tys\nprocessEdit End         = End\nprocessEdit (Ins  Node' d) = Ins  InsNode'   (processEdit d)\nprocessEdit (Ins  c  d) = Ins  c (processEdit d)\nprocessEdit (Del  c  d) = Del  c   (processEdit d)\nprocessEdit (CpyTree d) = CpyTree  (processEdit d)\nprocessEdit (Cpy  c  d) = Cpy  c   (processEdit d)\n</code></pre>\n\n<p>However, I do not like this approach. It requires modifying your original datatype and you lose the type-level distinction between an \"original\" tree and a \"patched\" tree. A better solution would be to create another datatype (eg. <code>ChangedTree</code>) and reimplement <code>patch' :: EditScriptL TreeFamily Tree Tree -&gt; Tree -&gt; ChangedTree</code>. If you keep track of both insertions and deletions, might you need a \"replace\"-type change as well?</p>\n\n<p>Oh and, <code>runDiff</code> needs the type-signature because otherwise it doesn't know what <code>Type _ Tree</code> instance to use. eg. <code>diff @TreeFamily before after</code> (TypeApplications extension) would fix it. Haskell's typeclasses are open, so it won't automatically infer that you want <code>instance Type TreeFamily Tree</code> rather than some other <code>instance Type XXX Tree</code>, just because it can't see any other suitable <code>XXX</code> in scope right now doesn't mean that it will guess that's what you intended to use.</p>\n"}], "owner": {"reputation": 3024, "user_id": 152436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca96b092fc9b1e74c7342f98f51cf0c?s=128&d=identicon&r=PG", "display_name": "Gareth Stockwell", "link": "https://stackoverflow.com/users/152436/gareth-stockwell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 55363367, "answer_count": 1, "score": 2, "last_activity_date": 1553622757, "creation_date": 1553596518, "question_id": 55355019, "link": "https://stackoverflow.com/questions/55355019/using-text-generic-diff-to-generate-output-containing-inserted-deleted-mar", "title": "Using Text.Generic.Diff to generate output containing &quot;inserted&quot; / &quot;deleted&quot; markers", "body": "<p>I am using the Haskell <a href=\"http://hackage.haskell.org/package/gdiff\" rel=\"nofollow noreferrer\">gdiff</a> package to calculate differences between trees.  The output of the diff algorithm is an \"edit script\", which describes a sequence of operations that transforms the \"before\" tree to the \"after\" tree.  gdiff provides a \"patch\" function which applies the edit script to the \"before\" tree, therefore generating the \"after\" tree.</p>\n\n<p>What I need to do is modify this patch operation so that the output is an \"after\" tree in which the modifications are highlighted.</p>\n\n<p>As an example, imagine that the tree is a document AST.  I want to generate an output which shows insertions / deletions, inline in the \"after\" document.</p>\n\n<p>So far, I have written a program which successfully uses gdiff to compute differences between instances of a simple binary tree data structure.  What I can't figure out is how to modify the resulting edit script so that it injects \"inserted\" and \"deleted\" markers when the patch operation is executed.</p>\n\n<p>Can anyone help?</p>\n\n<h1>Diffing two binary trees</h1>\n\n<p>Here is my binary tree data structure: </p>\n\n<pre><code>data Tree = Node String Tree Tree\n          | Empty\n          deriving Show\n</code></pre>\n\n<p>And here are my example \"before\" and \"after\" trees:</p>\n\n<pre><code>before :: Tree\nbefore =\n  Node \"root\"\n    (Node \"A\"\n      (Empty)\n      (Empty)\n    )\n    (Empty)\n\nafter :: Tree\nafter =\n  Node \"root\"\n    (Node \"A\"\n      (Node \"B\" Empty Empty)\n      (Empty)\n    )\n    (Empty)\n</code></pre>\n\n<p>The diff is executed as follows:</p>\n\n<pre><code>runDiff :: EditScript TreeFamily Tree Tree\nrunDiff = diff before after\n\nmain :: IO ()\nmain = do\n  putStrLn (\"before     = \" ++ (show before))\n  putStrLn (\"after      = \" ++ (show after))\n\n  let edit = runDiff\n  putStrLn (\"edit       = \" ++ (show edit))\n\n  let compressed = compress edit\n  putStrLn (\"compressed = \" ++ (show compressed))\n\n  let result = patch edit before\n  putStrLn (\"result     = \" ++ (show result))\n</code></pre>\n\n<p>(I'll come back to the definition of <code>TreeFamily</code> in a moment.)</p>\n\n<p>The output is:</p>\n\n<pre><code>before     = Node \"root\" (Node \"A\" Empty Empty) Empty\nafter      = Node \"root\" (Node \"A\" (Node \"B\" Empty Empty) Empty) Empty\nedit       = Cpy Node $ Cpy \"root\" $ Cpy Node $ Cpy \"A\" $ Ins Node $ Ins \"B\" $ Cpy Empty $ Cpy Empty $ Cpy Empty $ Ins Empty $ End\ncompressed = Cpy Node $ CpyTree $ Cpy Node $ CpyTree $ Ins Node $ Ins \"B\" $ CpyTree $ CpyTree $ CpyTree $ Ins Empty $ End\nresult     = Node \"root\" (Node \"A\" (Node \"B\" Empty Empty) Empty) Empty\n</code></pre>\n\n<h1>Proposed strategy: process the edit script</h1>\n\n<p>I think that I can implement the \"generate marked-up after tree\" operation by processing the edit script so that <code>... $ Ins Node $ ...</code> is replaced with <code>... $ Ins InsNode $ ...</code>, where <code>InsNode</code> is another <code>Tree</code> constructor:</p>\n\n<pre><code>data Tree = Node String Tree Tree\n          | InsNode String Tree Tree\n          | Empty\n          deriving Show\n</code></pre>\n\n<p>(And similarly for deletions, but this post focuses only on insertion.)</p>\n\n<p>The processed edit script would then be fed to the existing gdiff patch function.</p>\n\n<h1>TreeFamily definition</h1>\n\n<p>The gdiff library requires the user to define a \"family datatype\".  Here is my definition.  Note that I have included the <code>InsNode</code> type.  Although this doesn't appear in the input data, I <em>think</em> gdiff will need to know about it in order to perform the <code>Node</code> to <code>InsNode</code> substitution described above.</p>\n\n<pre><code>data TreeFamily :: * -&gt; * -&gt; * where\n    Node'       ::           TreeFamily Tree (Cons String (Cons Tree (Cons Tree Nil)))\n    InsNode'    ::           TreeFamily Tree (Cons String (Cons Tree (Cons Tree Nil)))\n    String'     :: String -&gt; TreeFamily String Nil\n    Empty'      ::           TreeFamily Tree Nil\n\n\ninstance Family TreeFamily where\n    decEq Node' Node'                  = Just(Refl, Refl)\n    decEq InsNode' InsNode'            = Just(Refl, Refl)\n    decEq (String' s1) (String' s2)\n                | s1 == s2             = Just (Refl, Refl)\n                | otherwise            = Nothing\n    decEq Empty' Empty'                = Just(Refl, Refl)\n    decEq _ _                          = Nothing\n\n    fields Node' (Node s t1 t2)        = Just (CCons s (CCons t1 (CCons t2 CNil)))\n    fields InsNode' (InsNode s t1 t2)  = Just (CCons s (CCons t1 (CCons t2 CNil)))\n    fields (String' _) _               = Just CNil\n    fields Empty' Empty                = Just CNil\n    fields _ _                         = Nothing\n\n    apply Node' (CCons s (CCons t1 (CCons t2 CNil)))    = Node s t1 t2\n    apply InsNode' (CCons s (CCons t1 (CCons t2 CNil))) = InsNode s t1 t2\n    apply (String' s) CNil                              = s\n    apply Empty' CNil                                   = Empty\n\n    string Node'       = \"Node\"\n    string InsNode'    = \"InsNode\"\n    string (String' s) = show s\n    string Empty'      = \"Empty\"\n\n\ninstance Type TreeFamily Tree where\n    constructors = [ Concr Node', Concr InsNode', Concr Empty' ]\n\ninstance Type TreeFamily String where\n    constructors = [ Abstr String' ]\n</code></pre>\n\n<h1>First attempt at a processEdit function</h1>\n\n<p>The function which processes an <code>EditScript</code> to perform the <code>Node</code> to <code>InsNode</code> substitution should have the same signature as the <code>compress</code> function, namely:</p>\n\n<pre><code>processEdit :: (Family f) =&gt; EditScriptL f txs tys -&gt; EditScriptL f txs tys\n</code></pre>\n\n<p>I can write the following identity equations ...</p>\n\n<pre><code>processEdit End         = End\nprocessEdit (Ins  c  d) = Ins  c   (processEdit d)\nprocessEdit (Del  c  d) = Del  c   (processEdit d)\nprocessEdit (CpyTree d) = CpyTree  (processEdit d)\nprocessEdit (Cpy  c  d) = Cpy  c   (processEdit d)\n</code></pre>\n\n<p>... but I don't know how to modify the <code>Ins</code> equation to perform the substitution.  Can anyone help?</p>\n\n<h1>Complete test program for reference</h1>\n\n<pre><code>{-# LANGUAGE FlexibleInstances     #-}\n{-# LANGUAGE GADTs                 #-}\n{-# LANGUAGE KindSignatures        #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE NoImplicitPrelude     #-}\n\n\nmodule Main where\n\nimport Prelude\nimport Data.Generic.Diff\n\n\n-- Data types --\n\ndata Tree = Node String Tree Tree\n          | InsNode String Tree Tree\n          | Empty\n          deriving Show\n\n\n-- GADT Family --\n\ndata TreeFamily :: * -&gt; * -&gt; * where\n    Node'       ::           TreeFamily Tree (Cons String (Cons Tree (Cons Tree Nil)))\n    InsNode'    ::           TreeFamily Tree (Cons String (Cons Tree (Cons Tree Nil)))\n    String'     :: String -&gt; TreeFamily String Nil\n    Empty'      ::           TreeFamily Tree Nil\n\n\ninstance Family TreeFamily where\n    decEq Node' Node'                  = Just(Refl, Refl)\n    decEq InsNode' InsNode'            = Just(Refl, Refl)\n    decEq (String' s1) (String' s2)\n                | s1 == s2             = Just (Refl, Refl)\n                | otherwise            = Nothing\n    decEq Empty' Empty'                = Just(Refl, Refl)\n    decEq _ _                          = Nothing\n\n    fields Node' (Node s t1 t2)        = Just (CCons s (CCons t1 (CCons t2 CNil)))\n    fields InsNode' (InsNode s t1 t2)  = Just (CCons s (CCons t1 (CCons t2 CNil)))\n    fields (String' _) _               = Just CNil\n    fields Empty' Empty                = Just CNil\n    fields _ _                         = Nothing\n\n    apply Node' (CCons s (CCons t1 (CCons t2 CNil)))    = Node s t1 t2\n    apply InsNode' (CCons s (CCons t1 (CCons t2 CNil))) = InsNode s t1 t2\n    apply (String' s) CNil                              = s\n    apply Empty' CNil                                   = Empty\n\n    string Node'       = \"Node\"\n    string InsNode'    = \"InsNode\"\n    string (String' s) = show s\n    string Empty'      = \"Empty\"\n\n\ninstance Type TreeFamily Tree where\n    constructors = [ Concr Node', Concr InsNode', Concr Empty' ]\n\ninstance Type TreeFamily String where\n    constructors = [ Abstr String' ]\n\n\n-- Input trees --\n\nbefore :: Tree\nbefore =\n  Node \"root\"\n    (Node \"A\"\n      (Empty)\n      (Empty)\n    )\n    (Empty)\n\nafter :: Tree\nafter =\n  Node \"root\"\n    (Node \"A\"\n      (Node \"B\" Empty Empty)\n      (Empty)\n    )\n    (Empty)\n\n\n{-\nFunction for modifying the edit script\n\nThe objective is to transform edit script fragments of the form\n    ... $ Ins Node $ ...\nto\n    ... $ Ins InsNode $ ...\n-}\n\nprocessEdit :: (Family f) =&gt; EditScriptL f txs tys -&gt; EditScriptL f txs tys\nprocessEdit End         = End\nprocessEdit (Ins  c  d) = Ins  c   (processEdit d)\nprocessEdit (Del  c  d) = Del  c   (processEdit d)\nprocessEdit (CpyTree d) = CpyTree  (processEdit d)\nprocessEdit (Cpy  c  d) = Cpy  c   (processEdit d)\n\n\n-- Test --\n\n-- For some reason, this signature is required for type inference to work --\nrunDiff :: EditScript TreeFamily Tree Tree\nrunDiff = diff before after\n\nmain :: IO ()\nmain = do\n  putStrLn (\"before     = \" ++ (show before))\n  putStrLn (\"after      = \" ++ (show after))\n\n  let edit = runDiff\n  putStrLn (\"edit       = \" ++ (show edit))\n\n  let compressed = compress edit\n  putStrLn (\"compressed = \" ++ (show compressed))\n\n  let processed = processEdit compressed\n  putStrLn (\"processed  = \" ++ (show processed))\n\n  let result = patch edit before\n  putStrLn (\"result     = \" ++ (show result))\n</code></pre>\n"}, {"tags": ["haskell", "monads", "writer", "type-signature"], "answers": [{"tags": [], "owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "is_accepted": true, "score": 7, "last_activity_date": 1553593219, "creation_date": 1553593219, "answer_id": 55353905, "question_id": 55353713, "link": "https://stackoverflow.com/questions/55353713/haskell-monadwriter-type-signature/55353905#55353905", "title": "Haskell MonadWriter type signature", "body": "<p>There is no particular reason to put the result (<code>3003</code>) first and the output (<code>\"log 1\\n\"</code>) second in the argument to <code>writer</code>. The order was, I suppose, chosen to correspond to the <a href=\"https://stackage.org/haddock/lts-13.14/transformers-0.5.5.0/src/Control-Monad-Trans-Writer-Strict.html#WriterT\" rel=\"noreferrer\">internal representation of <code>WriterT</code></a>:</p>\n\n<pre><code>newtype WriterT w m a = WriterT { runWriterT :: m (a, w) }\n</code></pre>\n\n<p>(for <code>Writer</code>, <code>m</code> is identity).</p>\n\n<p>However, in the type signature for <code>Writer</code>, the order of arguments matters. If we look at, for example, the <code>Functor</code> typeclass with a member</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>it makes it possible to substitute <code>Writer String</code> (or generally, <code>Writer result</code>) for <code>f</code> and obtain</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; Writer result a -&gt; Writer result b\n</code></pre>\n\n<p>which is exactly the correct order of arguments. Swapping them would make implementing <code>Functor</code> impossible (without some trickery).</p>\n\n<p>This is true for all types/functions which take more than one parameter: the only way they can be used as one-argument types/functions is by varying the last argument, not the other ones.</p>\n\n<p>See related questions discussing similar issues:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/32927048/switch-order-of-arguments-for-instance-declaration-in-haskell\">Switch order of arguments for instance declaration in Haskell</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/3789190/currying-out-of-order-in-haskell\">Currying out of order in Haskell</a></p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 55353905, "answer_count": 1, "score": 4, "last_activity_date": 1553593219, "creation_date": 1553592566, "question_id": 55353713, "link": "https://stackoverflow.com/questions/55353713/haskell-monadwriter-type-signature", "title": "Haskell MonadWriter type signature", "body": "<p>Noob question on MonadWriter: </p>\n\n<pre><code>monadWrite :: Writer String Int\nmonadWrite = writer (3003, \"log 1\\n\") \n</code></pre>\n\n<p>Why is it that <code>String</code> comes first in the typesig and <code>Int</code> second, while <code>3003</code> is clearly an <code>Int</code> while <code>\"log 1\\n\"</code> is a <code>String</code>. \nTrivial I know, but I would like to understand. </p>\n"}, {"tags": ["haskell", "unicode", "symbols", "ghci"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 4, "creation_date": 1553597744, "post_id": 55353647, "comment_id": 97434496, "body": "Unicode output on windows terminals is a persistent and annoying problem - the correct answer depends on which combination of shell (i.e. powershell or cmd.com) and terminal (e.g. ConEmu, Console2, the default windows one whatever that is called?) you&#39;re running (it&#39;s not really Haskell specific but most windows programs are built to either deal with or sidestep this issue, while most of the GHC people are on various *nixes). If you don&#39;t have a particularly fancy setup something as simple as running <code>chcp 65001</code> before ghci might work"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553601221, "post_id": 55353647, "comment_id": 97436536, "body": "<a href=\"https://stackoverflow.com/q/10779149/791604\">See also.</a>"}], "answers": [{"comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1553592629, "post_id": 55353704, "comment_id": 97431208, "body": "<a href=\"https://gitlab.haskell.org/ghc/ghc/issues/8118\" rel=\"nofollow noreferrer\">gitlab.haskell.org/ghc/ghc/issues/8118</a> might be relevant. And <a href=\"https://gitlab.haskell.org/ghc/ghc/issues/4471\" rel=\"nofollow noreferrer\">gitlab.haskell.org/ghc/ghc/issues/4471</a>. And a large number of other tickets :-/"}, {"owner": {"reputation": 491, "user_id": 4518482, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/2e9ccd1af4190abf1b0dac86a7f38a97?s=128&d=identicon&r=PG&f=1", "display_name": "chansey", "link": "https://stackoverflow.com/users/4518482/chansey"}, "edited": false, "score": 0, "creation_date": 1553593130, "post_id": 55353704, "comment_id": 97431509, "body": "Thanks, but what do you mean about &quot;by setting a LANG=C.utf8 environment variable&quot;? Does this means &quot;system environment variable&quot;? (e.g: In windows7, Control Panel Home -&gt; System Properties -&gt; Environment Variables -&gt; System variables) Or other configuration of Haskell? Sorry I&#39;m not very familiar with Haskell. (PS: I have set System variables LANG=C.utf8, but doesn&#39;t work)"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "reply_to_user": {"reputation": 491, "user_id": 4518482, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/2e9ccd1af4190abf1b0dac86a7f38a97?s=128&d=identicon&r=PG&f=1", "display_name": "chansey", "link": "https://stackoverflow.com/users/4518482/chansey"}, "edited": false, "score": 0, "creation_date": 1553594205, "post_id": 55353704, "comment_id": 97432178, "body": "And I am not familiar with Windows, sorry. I hope someone else can help you out here."}], "tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 5, "last_activity_date": 1553592529, "creation_date": 1553592529, "answer_id": 55353704, "question_id": 55353647, "link": "https://stackoverflow.com/questions/55353647/haskell-doesnt-support-unicode-symbol-constructor-e-g-%e2%97%81/55353704#55353704", "title": "Haskell doesn&#39;t support unicode symbol constructor (e.g.: \u25c1)?", "body": "<p>The problem is not with your code, or constructors, but simply that your environment is not set up so that Haskell can print unicode characters. Try</p>\n\n<pre><code>Prelude&gt; putStrLn \"\\9731\"\n</code></pre>\n\n<p>and you should see the same problem.</p>\n\n<p>I am not an expert on Unicode and Windows, but presumably you can fix this by setting a <code>LANG=C.utf8</code> environment variable, or similar.</p>\n"}, {"tags": [], "owner": {"reputation": 491, "user_id": 4518482, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/2e9ccd1af4190abf1b0dac86a7f38a97?s=128&d=identicon&r=PG&f=1", "display_name": "chansey", "link": "https://stackoverflow.com/users/4518482/chansey"}, "is_accepted": false, "score": 0, "last_activity_date": 1588095402, "last_edit_date": 1588095402, "creation_date": 1588092443, "answer_id": 61485506, "question_id": 55353647, "link": "https://stackoverflow.com/questions/55353647/haskell-doesnt-support-unicode-symbol-constructor-e-g-%e2%97%81/61485506#61485506", "title": "Haskell doesn&#39;t support unicode symbol constructor (e.g.: \u25c1)?", "body": "<p>Following @Cubic, this issue can be workaround by running <code>chcp 65001</code> before GHCi.</p>\n\n<p>I use stack in windows 7 command line:</p>\n\n<pre><code>X:\\you-path&gt; chcp 65001\n\nX:\\you-path&gt; stack ghci\n\n*Main&gt; Constant 2 :\u25c1 Variable \"a\"\n\nConstant 2 :\u25c1\ufffd\ufffd Variable \"a\"\n</code></pre>\n\n<p>It works.</p>\n"}], "owner": {"reputation": 491, "user_id": 4518482, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/2e9ccd1af4190abf1b0dac86a7f38a97?s=128&d=identicon&r=PG&f=1", "display_name": "chansey", "link": "https://stackoverflow.com/users/4518482/chansey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1588095402, "creation_date": 1553592361, "last_edit_date": 1553607858, "question_id": 55353647, "link": "https://stackoverflow.com/questions/55353647/haskell-doesnt-support-unicode-symbol-constructor-e-g-%e2%97%81", "title": "Haskell doesn&#39;t support unicode symbol constructor (e.g.: \u25c1)?", "body": "<p>For example:</p>\n\n<pre><code>{-# LANGUAGE UnicodeSyntax #-}\n\ndata Symbolic n\n  = Constant n\n  | Variable String\n  | Symbolic n :+ Symbolic n\n  | Symbolic n :* Symbolic n\n  | Symbolic n :\u25c1 Symbolic n\n  deriving (Show)\n</code></pre>\n\n<p>This code loaded successfully in GHCi.</p>\n\n<p>Then I input:</p>\n\n<pre><code>Constant 2 :* Variable \"a\"\n</code></pre>\n\n<p>That's OK.</p>\n\n<p>But when I input:</p>\n\n<pre><code>Constant 2 :\u25c1 Variable \"a\"\n</code></pre>\n\n<p>*** Exception: : hPutChar: invalid argument (invalid character)</p>\n\n<p>Does this mean that Haskell does not support Unicode symbol constructor? </p>\n\n<p>How to make it support Unicode symbol constructor?</p>\n\n<p>Environment:\nGHCi 8.6.3 (WinGHCi)\nWindows 7</p>\n\n<p>Thanks.</p>\n\n<p>New observation:</p>\n\n<p>It works when \u25c1 appeared in source file, but you can not input \u25c1 in REPL (I use WinGHCi). </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1553582179, "post_id": 55350607, "comment_id": 97426068, "body": "Have you tried <code>head (head list)</code>?"}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1553616612, "post_id": 55350607, "comment_id": 97447155, "body": "Just use <code>(!!)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "is_accepted": false, "score": 1, "last_activity_date": 1553587655, "last_edit_date": 1553587655, "creation_date": 1553581578, "answer_id": 55350979, "question_id": 55350607, "link": "https://stackoverflow.com/questions/55350607/get-elements-of-a-list-inside-a-list/55350979#55350979", "title": "Get elements of a list inside a list", "body": "<p>There is an indexing function (!!), so for your examples, head . (!!0) and last . (!!1) . If your question is more general, then please elaborate. Indexing is not great because it can throw errors if you attempt to index past the end of the list, so usually we try to work around that, eg. by saying \"well I want to do the same thing to every element of the list so I don't really need the index\" (map function) or \"if I really do need the index then don't use it directly\") (zip [0..], or use of eg. a record data type).</p>\n\n<p>Also, Hoogle is your friend if you've not met it before. If you can break down your functions into simple ones you think might be standard, then search their type signatures, that's usually a good place to start. <a href=\"https://hoogle.haskell.org/?hoogle=%5Ba%5D%20-&gt;%20Int%20-&gt;%20a\" rel=\"nofollow noreferrer\">Hoogle <code>[a] -&gt; Int -&gt; a</code></a> even if you don't find exactly what you want, often if you find something similar and browse it's module or source code you can find something helpful. </p>\n"}, {"tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": false, "score": 1, "last_activity_date": 1553583397, "creation_date": 1553583397, "answer_id": 55351374, "question_id": 55350607, "link": "https://stackoverflow.com/questions/55350607/get-elements-of-a-list-inside-a-list/55351374#55351374", "title": "Get elements of a list inside a list", "body": "<p>If all you need is the first or last element, <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-List.html#v:concat\" rel=\"nofollow noreferrer\"><code>concat</code></a> will flatten the list for you.</p>\n"}], "owner": {"reputation": 139, "user_id": 9580614, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-h-PRdmxbbjg/AAAAAAAAAAI/AAAAAAAAAAs/1mkUEvK_wo0/photo.jpg?sz=128", "display_name": "Ricardo Potozky", "link": "https://stackoverflow.com/users/9580614/ricardo-potozky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1553587655, "creation_date": 1553579485, "question_id": 55350607, "link": "https://stackoverflow.com/questions/55350607/get-elements-of-a-list-inside-a-list", "title": "Get elements of a list inside a list", "body": "<p>When working with lists in Haskell, i can simply load my file into <em>ghci</em> and type <code>head list</code> or <code>last list</code> to get the information that I need. But if I have a list of lists, lets say: <code>list = [[1,2,3],[4,5,6]]</code>, how can I get the first element (head) of the first list (in this case, 1), or the  last element of the second list (in this case, 6), and so one?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "edited": false, "score": 2, "creation_date": 1553566793, "post_id": 55348906, "comment_id": 97422495, "body": "have a look at the <code>Data.List</code> library <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.htm&zwnj;&#8203;l</a> , there are many different approaches to problems like this that depend on how much you want/have to write your own functions from scratch"}, {"owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "edited": false, "score": 1, "creation_date": 1553566890, "post_id": 55348906, "comment_id": 97422511, "body": "Also remember you can look for function by types on Hoogle <a href=\"https://hoogle.haskell.org/\" rel=\"nofollow noreferrer\">hoogle.haskell.org</a>, so in this case you would want a function that, given an element and a list, returns its index: <code>a -&gt; [a] -&gt; Maybe Int</code>"}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1553566968, "post_id": 55348906, "comment_id": 97422528, "body": "Hi Lola, have you looked through the functions in Data.List? <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.htm&zwnj;&#8203;l</a> . The <code>break</code> function might be useful.  Are you haveing trouble with using recursion? Try looking at some existing recursive code and make sure ytou know how recursion works in haskell."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1553567156, "post_id": 55348906, "comment_id": 97422561, "body": "What would <code>gap &#39;a&#39; &#39;a&#39; &quot;a&quot;</code> be? <code>Just 0</code> or <code>Nothing</code>? How about <code>gap &#39;a&#39; &#39;a&#39; &quot;aa&quot;</code>? <code>Just 0</code> or <code>Just 1</code>?"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1553568634, "post_id": 55348906, "comment_id": 97422856, "body": "<code>gap&#39; x1 x2 = length . takeWhile (&#47;= x2) . dropWhile (&#47;= x1)</code> is a good starting point."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1553569826, "post_id": 55348906, "comment_id": 97423065, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/49246572/gap-function-that-returns-the-integer-distance-between-first-appearance-of-two-e\">Gap function that returns the integer distance between first appearance of two elements in a list using either foldl or foldr.(Haskell)</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 2, "creation_date": 1553571654, "post_id": 55348906, "comment_id": 97423408, "body": "@AaditMShah, I would reach for <code>elemIndex</code> for the second part."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553572801, "post_id": 55348906, "comment_id": 97423604, "body": "The alleged duplicate specifically asks for a fold."}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1553593450, "post_id": 55348906, "comment_id": 97431712, "body": "Why does  <code>gap 8 3 [1..10]</code> not return <code>Just 5</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553577896, "post_id": 55349651, "comment_id": 97424716, "body": "This is gratuitously inefficient. <code>dropWhile</code> was the right way to start."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1553578067, "post_id": 55349651, "comment_id": 97424764, "body": "@dfeuer I think it is about as efficient as can be done given the spec. If I have correctly guessed what you have in mind for <code>dropWhile</code>, it will get the wrong answer for <code>gap &#39;a&#39; &#39;b&#39; &quot;bacb&quot;</code>. (Whether the code in the answer gets it right or not is not clear -- the spec is a bit ambiguous, I have to say -- but the <code>dropWhile</code> version will definitely get it wrong!)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553578439, "post_id": 55349651, "comment_id": 97424863, "body": "@DanielWagner, it seems a bit ambiguous, but I see what you mean. However, it&#39;s still not the best way, because it traverses the list twice, retaining memory. You could use a slightly different <code>dropWhile</code> invocation, or to avoid a redundant test work up something custom."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553598492, "post_id": 55349651, "comment_id": 97434968, "body": "@dfeuer I agree. Without optimizations, this code is very inefficient. However, a smart compiler could most probably perform loop fusion to traverse the list only once. Either way, the first step is to get the program right, and the next step is to perform optimizations if necessary. If it doesn&#39;t matter that this code is inefficient, then let it be. However, if you find out that it&#39;s a performance bottleneck only then should you bother optimizing it."}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 2, "last_activity_date": 1553572859, "creation_date": 1553572859, "answer_id": 55349651, "question_id": 55348906, "link": "https://stackoverflow.com/questions/55348906/how-would-i-find-the-distance-between-two-elements-in-a-list/55349651#55349651", "title": "How would I find the distance between two elements in a list?", "body": "<p>Here's how I'd do it:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.List (elemIndex)\n\ngap :: Eq a =&gt; a -&gt; a -&gt; [a] -&gt; Maybe Int\ngap x1 x2 xs = do\n    i &lt;- elemIndex x1 xs\n    j &lt;- elemIndex x2 xs\n    if i &lt;= j\n        then Just (j - i)\n        else Nothing\n</code></pre>\n\n<p>Credits to <a href=\"https://stackoverflow.com/users/1477667/dfeuer\">dfeuer</a> for reminding me of the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:elemIndex\" rel=\"nofollow noreferrer\"><code>elemIndex</code></a> function.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553600792, "post_id": 55353922, "comment_id": 97436278, "body": "Same comment as I gave dfeuer: this does not appear to comply to the spec. Consider e.g. <code>gap &#39;a&#39; &#39;b&#39; &quot;bacb&quot;</code> -- this reports <code>Just 2</code>, which is clearly incorrect. (<code>Nothing</code>, <code>Just 1</code>, or <code>Just (-1)</code> all might be sensible choices depending on exactly how you interpret the spec.)"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553618403, "post_id": 55353922, "comment_id": 97448300, "body": "Just 2 seems correct to me @Daniel . The second example case indicates that the second argument should appear in the list at or beyond the first argument. On &quot;bacb&quot; then gap &#39;a&#39; &#39;a&#39; is Just 0, gap &#39;a&#39; &#39;c&#39; is Just 1, gap &#39;a&#39; &#39;b&#39; is Just 2"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553621256, "post_id": 55353922, "comment_id": 97449945, "body": "@ATayler The second example&#39;s return value is not a <code>Just</code>, so I don&#39;t see how you can use it to support returning a <code>Just</code> in some other case."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553621724, "post_id": 55353922, "comment_id": 97450196, "body": "@DanielWagner I think I get got why we&#39;re misunderstanding each other. My spec is, &quot;find the first occurrence o of the first argument, then <i>only considering the remainder of the list subsequent to that first occurrence</i> find the first occurrence of the second argument, then subtract their indices, returning Nothing if either is not to be found&quot;. Your spec is &quot;find the first occurrence of each argument o1 o2 and return if o1 &lt;= o2 then Just (o2 - o1) else Nothing&quot;. Both of which are consistent with the examples given, I think mine is a marginally more natural interpretation but you mayn&#39;t."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1553622647, "post_id": 55353922, "comment_id": 97450700, "body": "@ATayler I think your claim about my interpretation of the spec is too precise, since I don&#39;t know what to return in case <code>o1 &lt;= o2</code> (e.g. it seems as though always returning <code>Just (o2-o1)</code> when <code>o1</code> and <code>o2</code> both exist matches the examples, too). But yes, I interpret &quot;first appearance of two elements&quot; as &quot;first occurrence of each argument&quot;. Perhaps some extra condition like the one you propose was <i>intended</i>, but no extra condition was <i>stated</i>, and the example input-output pairs don&#39;t imply one."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553623106, "post_id": 55353922, "comment_id": 97450914, "body": "@DanielWagner My strongest argument is that the two arguments should be provided in an unordered fashion were your behaviour intended, but probably that&#39;s a stretch :P. I think you mean you don&#39;t know what to do in case <code>o2 &lt;= o1</code> though."}], "tags": [], "owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "is_accepted": false, "score": 3, "last_activity_date": 1553603733, "last_edit_date": 1553603733, "creation_date": 1553593287, "answer_id": 55353922, "question_id": 55348906, "link": "https://stackoverflow.com/questions/55348906/how-would-i-find-the-distance-between-two-elements-in-a-list/55353922#55353922", "title": "How would I find the distance between two elements in a list?", "body": "<p>An answer which is expected to run fast: </p>\n\n<pre><code>import Data.List (elemIndex)\n\n\ngap :: Eq a =&gt; a -&gt; a -&gt; [a] -&gt; Maybe Int\ngap x y ls = elemIndex y $ dropWhile ((/=) x) ls             \n</code></pre>\n\n<p>If you do not want to rely on <code>Data.List</code> then you have to write and add your own <code>elemIndex'</code>. </p>\n\n<p>After Daniel Wagner's feedback an alternative:</p>\n\n<pre><code>gap' :: Eq a =&gt; a -&gt; a -&gt; [a] -&gt; Maybe Int\ngap' x y ls\n    | null ls'          = Nothing\n    | head ls' == y     = Nothing \n    | otherwise         = elemIndex y ls'\n\n    where\n\n    ls' = dropWhile (\\t -&gt; t /= x &amp;&amp; t /= y) ls\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 11182553, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-9pOdw0Sb29E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3HK_pNB3RP3gZ_tpsZRS1ZfuCDA/mo/photo.jpg?sz=128", "display_name": "Lola Martinez", "link": "https://stackoverflow.com/users/11182553/lola-martinez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1553603733, "creation_date": 1553566439, "last_edit_date": 1553568070, "question_id": 55348906, "link": "https://stackoverflow.com/questions/55348906/how-would-i-find-the-distance-between-two-elements-in-a-list", "title": "How would I find the distance between two elements in a list?", "body": "<p>I have to find the distance between first appearance of two elements in a list. The program we are using is Haskell. I've been online for HOURS trying to look for help on how to start or direction to solve it. Please help!</p>\n\n<p>This is how we are defining it:\n<code>gap :: (Eq a) =&gt; a -&gt; a -&gt; [a] -&gt; Maybe Int</code></p>\n\n<p>Here are some examples:</p>\n\n<pre><code>&gt; gap 3 8 [1..10]\nJust 5\n\n&gt; gap 8 3 [1..10]\nNothing\n\n&gt; gap 'h' 'l' \"hello\"\nJust 2\n\n&gt; gap 'h' 'z' \"hello\"\nNothing\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 1, "creation_date": 1553553711, "post_id": 55347351, "comment_id": 97419603, "body": "You can do the same using mutable vectors in Haskell."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1553553868, "post_id": 55347351, "comment_id": 97419646, "body": "Yeah; as this data structure is fundamentally about side-effects (under-used entries are kicked out \u2013 <i>not nice</i>, referential-transperencywise speaking!) using the <code>ST</code> monad for actual mutable structures seems the way to go."}, {"owner": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1553553898, "post_id": 55347351, "comment_id": 97419654, "body": "@freestyle Yes I know but I am looking for a Haskell idiomatic solution if possible. Mutable vectors do not seem idiomatic Haskell to me."}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1553557564, "post_id": 55347351, "comment_id": 97420562, "body": "Wrapped in the right monad, mutable vectors are perfectly idiomatic Haskell, so long as you need something mutable and vector-shaped."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553561978, "post_id": 55348145, "comment_id": 97421527, "body": "<code>alterF</code> does require the tree to be walked a second time, but doesn&#39;t require the keys to be loaded and compared again along the way; the location in the tree is stored using a two-word bit list that (very compactly and efficiently) represents the sequence of left and right branches needed to find the key. It&#39;s not very pretty, but the more natural ways to do it turn out to be much slower for many functors."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553567048, "post_id": 55348145, "comment_id": 97422546, "body": "@dfeuer Thanks, I didn&#39;t know that! Is there a blog post or w/e going into your final sentence in more detail? because it&#39;s not obvious why that should be the case. My intuition says you could design different types of zippers on trees, one which remembers the branching as you described, or another which rotates the structure such that the node under focus is constant-time accessible. Practically the latter is unwieldly and/or slow?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553569418, "post_id": 55348145, "comment_id": 97422995, "body": "Practically, the latter tends to require memory to be allocated as you descend the tree, which ultimately leads to poor performance. The obvious thing is to code <code>alterF</code> a lot like <code>traverse</code>, but to target only one element. If you think about <code>traverse</code>, it says (roughly) <code>traverse f (Bin s k v l r) = Bin s k &lt;$&gt; f v &lt;*&gt; traverse f l &lt;*&gt; traverse f r</code>. You have to map over the functor at each level. For <code>traverse</code>, the cost of mapping at a node is shared by all the descendents. But for <code>alterF</code>, there&#39;s only <i>one</i> relevant descendant."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553569555, "post_id": 55348145, "comment_id": 97423019, "body": "If you want to think about the process more explicitly, you can implement <code>alterF</code> using a zipper. But you&#39;ll have to allocate one &quot;breadcrumb&quot; for each level in the tree. The bit queue can be seen as a sort of &quot;virtual zipper&quot;, indexing into the existing structure instead of actually rotating it."}, {"owner": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "edited": false, "score": 0, "creation_date": 1553603590, "post_id": 55348145, "comment_id": 97438065, "body": "Thanks, I did not know about priority search queue. I learned about implementing it from the following paper. <a href=\"https://www.cs.ox.ac.uk/ralf.hinze/publications/ICFP01.pdf\" rel=\"nofollow noreferrer\">cs.ox.ac.uk/ralf.hinze/publications/ICFP01.pdf</a>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1553639301, "post_id": 55348145, "comment_id": 97457760, "body": "Welcome to Stack Overflow! This was a really great answer! I&#39;ve edited it to add some links to the packages you mentioned."}], "tags": [], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "is_accepted": true, "score": 5, "last_activity_date": 1553639256, "last_edit_date": 1553639256, "creation_date": 1553559312, "answer_id": 55348145, "question_id": 55347351, "link": "https://stackoverflow.com/questions/55347351/haskell-alternative-for-doubly-linked-list-coupled-with-hash-table-pattern/55348145#55348145", "title": "Haskell alternative for Doubly-linked-list coupled with Hash-table pattern", "body": "<p>As comments indicate, mutable vectors are perfectly acceptable when required. However, I think there's an issue with the way you've stated the question - unless the idea is to duplicate \"as closely as possible\" (without mutable structures) the imperative code, why bother having 2 treemaps? A single priority search queue (see packages <a href=\"http://hackage.haskell.org/package/pqueue\" rel=\"nofollow noreferrer\"><code>pqueue</code></a> or <a href=\"http://hackage.haskell.org/package/PSQueue\" rel=\"nofollow noreferrer\"><code>PSQueue</code></a>) would be an appropriate structure whilst maintaining purity. It supports efficiently both priorities (for eviction) and searching (for lookups of your desired cached argument).</p>\n\n<p>On a related note, some structures support eg. <a href=\"http://hackage.haskell.org/package/containers-0.6.0.1/docs/Data-Map-Lazy.html#v:alterF\" rel=\"nofollow noreferrer\"><code>Data.Map</code>'s <code>alterF</code></a>, which effectively provides you with a continuation allowing you to \"do something else\" dependent on the <code>Maybe</code> value at a key, but \"remembering\" where you are and thus avoiding to pay the full cost to re-traverse the structure to subsequently modify at this key. See also <a href=\"http://hackage.haskell.org/package/lens-4.17/docs/Control-Lens-At.html#v:at\" rel=\"nofollow noreferrer\">the <code>at</code> lens</a>.</p>\n"}], "owner": {"reputation": 1220, "user_id": 3711976, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d83e1776e6d29a6e86818109b8ac2104?s=128&d=identicon&r=PG&f=1", "display_name": "Kakaji", "link": "https://stackoverflow.com/users/3711976/kakaji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 55348145, "answer_count": 1, "score": 2, "last_activity_date": 1553639256, "creation_date": 1553553198, "question_id": 55347351, "link": "https://stackoverflow.com/questions/55347351/haskell-alternative-for-doubly-linked-list-coupled-with-hash-table-pattern", "title": "Haskell alternative for Doubly-linked-list coupled with Hash-table pattern", "body": "<p>There's a useful pattern in imperative programming, namely, a doubly-linked-list coupled with a hash-table for constant time lookup in the linked list. </p>\n\n<p>One application of this pattern is in LRU cache. The head of the doubly-linked-list will contain the least recently used entry in the cache and the last element in the doubly-linked-list will contain the most recently used entry. The keys in the hash-table are keys of the entries and the values are pointers to nodes in the linked-list corresponding to the key/entry. When an entry is queried in the cache, hash-table will be used to point to its node in the linked-list and then the node will be removed from its current location in the linked-list and be placed at the end of the linked-list making it the most-recently-used entry. For eviction, we simply remove entries from the head of the linked-list as they are the least recently used ones. Both lookup and eviction operations will take constant time. </p>\n\n<p>I can think of implementing this in Haskell using two TreeMaps and I know that the time complexity will be O(log n). But I am a little uncomfortable as the constant factor in the time complexity seems a little high. Specifically, to perform a look-up, first I need to check if the entry exists and save its value, then I need to first delete it from the LRU map and re-insert it with a new key. This means that each lookup will result in a root-to-node traversal three times. </p>\n\n<p>Is there a better way of doing this in Haskell?</p>\n"}, {"tags": ["parsing", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1553543067, "post_id": 55345279, "comment_id": 97415453, "body": "Why do you think that parsers should only be used on recursively enumerable BNF grammars?"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1553543219, "post_id": 55345279, "comment_id": 97415519, "body": "@ReinHenrichs I just guess. When I look at examples, it always shows a text, that is always recursively enumerable."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1553543271, "post_id": 55345279, "comment_id": 97415543, "body": "What kind of data structure are you looking for? And what variety do you expect in the input text?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1553543317, "post_id": 55345279, "comment_id": 97415566, "body": "Transforming texts into data structures is by definition <i>parsing</i>. Are you talking about a particular package&#39;s <code>Parser</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1553543399, "post_id": 55345279, "comment_id": 97415614, "body": "This is a single string, not a language; the property &quot;recursively enumerable&quot; doesn&#39;t type-check. If you have just a single string, then you can just make a single value that has what you need from that string. If you have a collection of strings, then you must describe it better than just &quot;here&#39;s one element of the collection&quot;. (I don&#39;t immediately see what makes you think such a collection would obviously not be recursively enumerable. That outcome would kind of surprise me.)"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1553543445, "post_id": 55345279, "comment_id": 97415644, "body": "I would like to transform into <code>data Pcp = Pcp { publicKey :: String  , event :: String, body :: String </code>"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 1, "creation_date": 1553543540, "post_id": 55345279, "comment_id": 97415677, "body": "The protocol is describing on <a href=\"https://blogs.sap.com/2015/07/27/specification-of-the-push-channel-protocol-pcp/\" rel=\"nofollow noreferrer\">blogs.sap.com/2015/07/27/&hellip;</a>. And yes it is a grammar."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1553543867, "post_id": 55345279, "comment_id": 97415821, "body": "Then it is both defined by a BNF grammar and recursively enumerable and I am even more confused by your question."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1553543934, "post_id": 55345279, "comment_id": 97415853, "body": "@zero_coding Then yes a parser definitely makes sense"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1553543935, "post_id": 55345279, "comment_id": 97415854, "body": "I can not see, that it is a BNF grammar and recursively enumerable."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1553543975, "post_id": 55345279, "comment_id": 97415875, "body": "You literally just posted a link to the BNF grammar."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1553544070, "post_id": 55345279, "comment_id": 97415935, "body": "@zero_coding It&#39;s right there in the page you linked: &quot;<i>A Push Channel Protocol  (PCP) message can be more formally described using the Backus-Naur Form grammar. Figure 1 shows the structure of a PCP message.</i>&quot; Of course, posting the grammar as a GIF image, not text, is a horrible practice."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1553544133, "post_id": 55345279, "comment_id": 97415972, "body": "If it can be described by a BNF grammar then it is recursively enumerable."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1553544174, "post_id": 55345279, "comment_id": 97415989, "body": "@ReinHenrichs I can not see, that it is recursively enumerable."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1553544209, "post_id": 55345279, "comment_id": 97416002, "body": "BNF grammars describe context-free languages. All context-free languages are recursively enumerable. Therefore, if it is described by a BNF grammar then it is recursively enumerable."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1553544315, "post_id": 55345279, "comment_id": 97416059, "body": "Please explain me, why the <code>A Push Channel Protocol  (PCP)</code> is recursively enumerable? I can not see it."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1553544342, "post_id": 55345279, "comment_id": 97416077, "body": "What part of my previous comment is confusing you?"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1553544401, "post_id": 55345279, "comment_id": 97416109, "body": "what does it mean <code>context-free languages</code>?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1553544504, "post_id": 55345279, "comment_id": 97416153, "body": "Recursively enumerable and context-free are both part of the Chomsky Hierarchy. You can easily google these terms."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 1, "creation_date": 1553545943, "post_id": 55345279, "comment_id": 97416771, "body": "Perhaps @zero_coding is confusing terms, and thinks &quot;recursively enumerable&quot; means that structures in the language can be (more or less) arbitrarily nested? For example, a string like this can likely be parsed by some regex, but a language like JSON where you can put objects in objects in objects would require a more complex parsing algorithm."}], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 5, "last_activity_date": 1553545220, "creation_date": 1553545220, "answer_id": 55345804, "question_id": 55345279, "link": "https://stackoverflow.com/questions/55345279/does-the-usage-of-parser-make-sense/55345804#55345804", "title": "Does the usage of Parser make sense?", "body": "<p>Like any tool, you should use a parser when it is suitable for the job. Turning strings into data structures is exactly what parsers are for.</p>\n\n<p>This specific language <em>is</em> defined by a BNF and thus is also recursively enumerable (in fact, context-free) and so is a perfect candidate for parsing, but you can use a parser for all sorts of things. For example, log files may not have a defined BNF grammar but are often structured well enough in practice for parsing to be useful.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 55345804, "answer_count": 1, "score": -1, "last_activity_date": 1553545220, "creation_date": 1553542844, "last_edit_date": 1553543758, "question_id": 55345279, "link": "https://stackoverflow.com/questions/55345279/does-the-usage-of-parser-make-sense", "title": "Does the usage of Parser make sense?", "body": "<p>I have the following text and would like to transform into a data structure. </p>\n\n<p>The text is: </p>\n\n<pre><code>pcp-action:MESSAGE\\npcp-channel:apc\\:///\\npcp-body-type:text\\nPUBLIC:THISPK\\nTOPIC:SEND\\n\\nHello Foo \n</code></pre>\n\n<p>I would like to know, if it makes sense to use Parser for it. To be honestly, I can not see the sense to use <code>Parser</code> in this case, because the structure is not in <code>BNF</code> like for example <code>JSON</code> and it is not recursively enumerable.  </p>\n\n<p>When does it make sense to transform a text with <code>Parser</code> into a data structure? </p>\n\n<p><strong>Update</strong>  </p>\n\n<p>I forget to mention the text above is based on the following description, that is written here <a href=\"https://blogs.sap.com/2015/07/27/specification-of-the-push-channel-protocol-pcp/\" rel=\"nofollow noreferrer\">https://blogs.sap.com/2015/07/27/specification-of-the-push-channel-protocol-pcp/</a>.   </p>\n\n<p>It looks like, it is based on a grammar.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1553541352, "post_id": 55344872, "comment_id": 97414650, "body": "You can use <code>++</code> to concatenate strings. If <code>c</code> is a single char, you can use <code>[c]</code> to turn it into a string (if you need to). Instead <code>c : s</code> prepends char <code>c</code> to the string <code>s</code>."}, {"owner": {"reputation": 11, "user_id": 10611373, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-oUIPxJlbOPk/AAAAAAAAAAI/AAAAAAAAABA/3Sg3MaIxGJg/photo.jpg?sz=128", "display_name": "Ben French", "link": "https://stackoverflow.com/users/10611373/ben-french"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1553541568, "post_id": 55344872, "comment_id": 97414743, "body": "ok thanks ill try to implement that!"}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1553542600, "post_id": 55344928, "comment_id": 97415242, "body": "Congrats, you&#39;ve just defined an L-System. (Ok, technically you also need a starting string.)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1553543039, "post_id": 55344928, "comment_id": 97415437, "body": "Heh, I don&#39;t think I ever knew there was a formal name for that process."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1553543089, "post_id": 55344928, "comment_id": 97415460, "body": "(Of course, in this case we&#39;re stopping after one round of replacements.)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1553543645, "post_id": 55344928, "comment_id": 97415717, "body": "This is a very nice approach, but I fear it is too high-level for the OP who is a beginner and did not know about <code>++</code>, which is more basic than <code>concatMap</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1553543698, "post_id": 55344928, "comment_id": 97415740, "body": "Yep. <code>iterate (&gt;&gt;= helper)</code> will give you the whole sequence."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1553544199, "post_id": 55344928, "comment_id": 97415996, "body": "I was assuming he already had a helper with type <code>Char -&gt; Char</code>, which meant he had something like <code>convert (x:xs) = helper x : convert xs</code> or <code>convert msg = map helper msg</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1553541522, "last_edit_date": 1553541522, "creation_date": 1553541143, "answer_id": 55344928, "question_id": 55344872, "link": "https://stackoverflow.com/questions/55344872/combining-string-modification-and-concatenation-in-haskell/55344928#55344928", "title": "Combining string modification and concatenation in haskell", "body": "<p>Assuming your helper is something like</p>\n\n<pre><code>helper :: Char -&gt; String\nhelper '!' = \"!!!111oneone\"\nhelper c = [c]\n</code></pre>\n\n<p>then you can use <code>concatMap</code> to map <code>helper</code> over each character in your string, and then concatenate the results into a single string.</p>\n\n<pre><code>convert :: String -&gt; String\nconvert = concatMap helper\n-- convert msg = concatMap helper msg\n</code></pre>\n\n<p>The trick is that your helper promotes <em>every</em> character to a list of characters; most characters just become the corresponding one-character string, but <code>!</code> becomes something more.</p>\n\n<p>(Note that <code>concatMap</code> forms the basis of the <code>Monad</code> instance for lists. You could also write <code>convert msg = msg &gt;&gt;= helper</code>.)</p>\n"}], "owner": {"reputation": 11, "user_id": 10611373, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-oUIPxJlbOPk/AAAAAAAAAAI/AAAAAAAAABA/3Sg3MaIxGJg/photo.jpg?sz=128", "display_name": "Ben French", "link": "https://stackoverflow.com/users/10611373/ben-french"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1553541522, "creation_date": 1553540876, "question_id": 55344872, "link": "https://stackoverflow.com/questions/55344872/combining-string-modification-and-concatenation-in-haskell", "title": "Combining string modification and concatenation in haskell", "body": "<p>So my problem is to take a string in haskell and to modify it so that if there are certain characters, they are changed to other characters, and I have created a helper function to do this, however  there is one case where if the character is '!' then it become '!!!111oneone', so i figure to do this you would need to concatenate the current string with '!!111oneone', the trouble is that my function was working with chars however to do this we would need to work with the string, how would you combine this, ie a helper to modify the chars if necessary and implementing the conversion if there is a '!'.</p>\n\n<p>Here is what i have so far</p>\n\n<pre><code>convert :: String -&gt; String\nconvert [] = []\nconvert (x:xs) =\n| x == '!'  = !helper\n| otherwise = converthelper x\n</code></pre>\n"}, {"tags": ["haskell", "set"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 4, "creation_date": 1553540418, "post_id": 55344667, "comment_id": 97414222, "body": "What&#39;s your first attempt? You&#39;ve not shown any effort so far, please do so."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553540679, "post_id": 55344667, "comment_id": 97414341, "body": "I really don&#39;t think this is going to be particularly pleasant to write in terms of lists if you&#39;re not allowed to convert to sets along the way. And it will certainly be very inefficient."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1553540762, "post_id": 55344667, "comment_id": 97414381, "body": "So, what did you try so far?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1553541016, "post_id": 55344667, "comment_id": 97414491, "body": "Try to recurse on the first list argument."}], "answers": [{"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1554863843, "post_id": 55353014, "comment_id": 97903217, "body": "I think this is the same solution I came up with. Using the <code>MonadComprehensions</code> extension can also eliminate the need for explicitly using <code>Just</code> or <code>Nothing</code>"}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 1, "last_activity_date": 1553590170, "creation_date": 1553590170, "answer_id": 55353014, "question_id": 55344667, "link": "https://stackoverflow.com/questions/55344667/find-complement-set-of-a-given-set-a-and-a-universal-set-u-in-haskell/55353014#55353014", "title": "Find complement set of a given set A and a universal set U in Haskell", "body": "<p>I don't want to solve your problem for you - I believe the solution should be your own work. However, I will provide a list of functions which could assist you, and which you don't have to import:</p>\n\n<ul>\n<li><code>filter f list</code>: returns all elements of <code>list</code> where <code>f element</code> returns <code>True</code>. For instance, <code>filter (\\x -&gt; (x /= 0)) [0,1,0,2,3]</code> gives <code>[1,2,3]</code>. This is useful with the <code>not</code> function, which inverts a <code>Bool</code>; for instance, <code>filter (\\x -&gt; not (x &gt; 2)) [1,2,3,4,5]</code> gives <code>[1,2]</code>.</li>\n<li><code>all f list</code>: returns <code>True</code> if <code>f</code> gives <code>True</code> for all elements of <code>list</code>. For example, <code>all (\\x -&gt; (x /= 0)) [1,2,3]</code> gives <code>True</code>; however, <code>all (\\x -&gt; (x /= 0)) [1,0,2,3]</code> gives <code>False</code>.</li>\n<li><code>x `elem` list</code> (which is really just syntax sugar for <code>elem x list</code>) returns true if <code>x</code> is an element of <code>list</code>. For example, <code>1 `elem` [1,2,3]</code> gives <code>True</code>, but <code>0 `elem` [1,2,3]</code> gives <code>False</code>.</li>\n</ul>\n\n<p>Again, I won't directly give you the solution to this problem. But I can guarantee you that if you put the above functions together in the right way - together with the <code>Just</code> and <code>Nothing</code> constructors - you can make your <code>complement</code> function.</p>\n"}], "owner": {"reputation": 7, "user_id": 9212927, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LdGFsqm8ygw/AAAAAAAAAAI/AAAAAAAAAOI/N3VzKbD7PQM/photo.jpg?sz=128", "display_name": "omonimus2016", "link": "https://stackoverflow.com/users/9212927/omonimus2016"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 0, "closed_date": 1554863865, "answer_count": 1, "score": -2, "last_activity_date": 1553590170, "creation_date": 1553539963, "question_id": 55344667, "link": "https://stackoverflow.com/questions/55344667/find-complement-set-of-a-given-set-a-and-a-universal-set-u-in-haskell", "closed_reason": "Needs more focus", "title": "Find complement set of a given set A and a universal set U in Haskell", "body": "<p>I have tried to write a function (complement), which given a set A and a universal set U, returns a complement of A with respect to U, wrapped in the Just type constructor. I have to double check if the set A is not a subset of U, in that case, I should return Nothing. </p>\n\n<p>Basically, I found few resources that explain how to check if a set (in our case A), is a subset of U. \n<a href=\"http://www.multiwingspan.co.uk/haskell.php?page=subsets\" rel=\"nofollow noreferrer\">http://www.multiwingspan.co.uk/haskell.php?page=subsets</a>\nBasically, it is enough to use the \"subset\" function (that return a boolean), to see if A is a subset of B. </p>\n\n<p>I found an as well different website that explains how to create the complement set without implement recursively functions, using:</p>\n\n<pre><code>import Data.Set(Set)\nimport qualified Data.Set  as Set\n</code></pre>\n\n<p>The only problem is that I CANNOT import any external modules to solve this problem. </p>\n\n<p>The signature of the function is:</p>\n\n<pre><code>complement :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Maybe [a]\n</code></pre>\n\n<p>I expect the following output:</p>\n\n<pre><code>complement [1,2,3] [1..5] = Just [4,5]\ncomplement [1,2,3] [2..5] = Nothing\n</code></pre>\n\n<p>Can anyone help me to deal with it?</p>\n"}, {"tags": ["function", "haskell", "types", "monads"], "answers": [{"tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": true, "score": 8, "last_activity_date": 1553532704, "last_edit_date": 1553532704, "creation_date": 1553530554, "answer_id": 55342129, "question_id": 55341953, "link": "https://stackoverflow.com/questions/55341953/why-does-haskell-presume-the-returned-monad-type-is-the-same-type-that-is-passed/55342129#55342129", "title": "Why does Haskell presume the returned monad type is the same type that is passed as an argument?", "body": "<p>Well, let's look at what the <code>do</code> block desugars to:</p>\n\n<pre><code>sequence_mine (elt:l) = elt &gt;&gt;= \\e -&gt; (sequence l) &gt;&gt;= \\sl -&gt; return (e:sl)\n</code></pre>\n\n<p>Recall that the \"bind\" operator <code>&gt;&gt;=</code> has the type signature <code>(Monad m) =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code>. Note that the monad <code>m</code> here, although arbitrary, must be the same for both of the arguments and the result type.</p>\n\n<p>So if <code>elt</code> has type <code>m a</code>, it's easy to see that the <code>return (e:sl)</code> - which is the output type of the whole expression - must have type <code>m [a]</code>, for the same monad <code>m</code>.</p>\n\n<p>To put it another way, each <code>do</code> block only works in the context of a fixed monad.</p>\n"}], "owner": {"reputation": 6365, "user_id": 4385532, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/0573709d0b88e4b50af0e28c3e96873b?s=128&d=identicon&r=PG&f=1", "display_name": "gaazkam", "link": "https://stackoverflow.com/users/4385532/gaazkam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 55342129, "answer_count": 1, "score": 5, "last_activity_date": 1553532704, "creation_date": 1553529996, "question_id": 55341953, "link": "https://stackoverflow.com/questions/55341953/why-does-haskell-presume-the-returned-monad-type-is-the-same-type-that-is-passed", "title": "Why does Haskell presume the returned monad type is the same type that is passed as an argument?", "body": "<p>Why does this code compile?</p>\n\n<pre><code>--sequence_mine :: Monad m =&gt; [m a] -&gt; m [a]\nsequence_mine [] = return []\nsequence_mine (elt:l) = do\n  e &lt;- elt\n  sl &lt;- sequence l\n  return (e:sl)\n</code></pre>\n\n<p>Note I intentionally commented out the type declaration here. But the code still compiles and seems to work as expected, even without the type declaration - and this is what surprises me.</p>\n\n<p>To my understanding, ambiguity should arise on this line:</p>\n\n<pre><code>return (e:sl)\n</code></pre>\n\n<p>The reason is that Haskell shouldn't know which type of monad we are returning. Why does it have to be the same type that we are accepting?</p>\n\n<p>To clarify more. To my understanding, if I don't explicitely put the type declaration analogous to the one I commented out, Haskell should deduce this function has a typing like this:</p>\n\n<pre><code>sequence_mine :: (Monad m1, Monad m2) =&gt; [m1 a] -&gt; m2 [a]\n</code></pre>\n\n<p>Unless I explicitely unify <code>m1</code> and <code>m2</code> by calling them both <code>m</code>, there is no reason for Haskell to believe they both refer to the same type! I would suppose.</p>\n\n<p>Yet that is not the case. What am I missing here?</p>\n"}, {"tags": ["haskell", "exception"], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1553530974, "post_id": 55341508, "comment_id": 97409422, "body": "<code>seq result (return result)</code> has a handy (slightly more efficient) function for it: <code>evaluate</code>. Plus, no need for a let binding! <code>evaluate (foo 1) `catch` \\(Problem msg) -&gt; putStrLn msg</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1553531003, "post_id": 55341508, "comment_id": 97409445, "body": "<code>s&#47;almost&#47;&#47;</code>. :)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1553531517, "post_id": 55341508, "comment_id": 97409769, "body": "Oops! I meant: <code>baz = evaluate (foo 1) `catch` \\(Problem msg) -&gt; return 100</code>. I got thrown off by your <code>catch</code> body (its the wrong one!)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1553531616, "post_id": 55341508, "comment_id": 97409839, "body": "@Alec, <code>evaluate</code> isn&#39;t more efficient; it&#39;s better behaved."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1553533308, "post_id": 55341508, "comment_id": 97410801, "body": "@Alec Ah, yes, that was what caused my problems trying to test <code>evaluate</code>. My test file was correct, but then I blindly copied the bad definition of <code>baz</code> in my answer. Everything&#39;s fixed now."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1553629080, "post_id": 55341508, "comment_id": 97453731, "body": "It might be worth mentioning in this answer that <code>evaluate</code> and <code>seq</code> will work in this particular case, but sometimes evaluating to normal form with help of <code>deepseq</code> is be necessary. Another suggestion is to not use pure <code>throw</code>"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 3, "last_activity_date": 1553533256, "last_edit_date": 1553533256, "creation_date": 1553528573, "answer_id": 55341508, "question_id": 55341334, "link": "https://stackoverflow.com/questions/55341334/failing-to-catch-exception-thrown-by-pure-function/55341508#55341508", "title": "Failing to catch exception thrown by &quot;pure&quot; function", "body": "<p>Due to laziness, <code>foo 1</code> doesn't get executed until you actually attempt to print the value of <code>n</code>. Essentially, <code>n</code> is bound to the unevaluated thunk <code>foo 1</code>, not the result of <code>foo 1</code>.</p>\n\n<p>A rather clumsy way to force <code>baz</code> to handle the exception is to use <code>seq</code>; there is almost certainly a more elegant solution.</p>\n\n<pre><code>baz = let result = foo 1\n      in seq result (return result) `catch` \\(Problem msg) -&gt; return 100\n</code></pre>\n\n<p>And, thanks to @Alec, that more elegant solution is to simply replace <code>return</code> with <code>Control.Exception.evaluate</code> in your original function.</p>\n\n<pre><code>baz :: IO Int\nbaz =\n  evaluate (foo 1)\n  `catch` \\(Problem _) -&gt; return 100\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 11255695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/610a32fd918aaab843567693f7e29435?s=128&d=identicon&r=PG&f=1", "display_name": "gfoust", "link": "https://stackoverflow.com/users/11255695/gfoust"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 55341508, "answer_count": 1, "score": 0, "last_activity_date": 1553533256, "creation_date": 1553528018, "question_id": 55341334, "link": "https://stackoverflow.com/questions/55341334/failing-to-catch-exception-thrown-by-pure-function", "title": "Failing to catch exception thrown by &quot;pure&quot; function", "body": "<p>I'm trying to catch a custom exception thrown by \"pure\" code.  I don't understand the behavior of my program.</p>\n\n<p>I'm using GHC 8.6.3.  Here's my code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Exception\n\nnewtype Problem = Problem String deriving Show\n\ninstance Exception Problem\n\nfoo :: Int -&gt; Int\nfoo n = n + (throw $ Problem \"Whoops\")\n\nbaz :: IO Int\nbaz =\n  return (foo 1)\n  `catch` \\(Problem _) -&gt; return 100\n\nmain = do\n  n &lt;- baz\n  print n\n  `catch` \\(Problem msg) -&gt; putStrLn msg\n</code></pre>\n\n<p>I expect the exception to be caught by the first handler, and for the program to print \"100\".  Instead it gets caught by the second handler and prints \"Whoops\".</p>\n\n<p>Why is the exception being caught in <code>main</code> and not in <code>baz</code>?  How can I catch the exception in <code>baz</code>?</p>\n"}, {"tags": ["haskell", "comments", "coq"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1553526507, "post_id": 55337201, "comment_id": 97406704, "body": "This might not always be possible \u2013 consider the comment <code>(* -} *)</code>. Would that be converted to <code>{- -} -}</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 6, "last_activity_date": 1553542509, "last_edit_date": 1553542509, "creation_date": 1553540013, "answer_id": 55344687, "question_id": 55337201, "link": "https://stackoverflow.com/questions/55337201/extracting-coq-to-haskell-while-keeping-comments/55344687#55344687", "title": "Extracting Coq to Haskell while keeping comments", "body": "<p>No, this isn't possible.  To double-check, you can see that <a href=\"https://github.com/coq/coq/blob/v8.9/plugins/extraction/miniml.ml\" rel=\"nofollow noreferrer\">the AST for the internal language that extraction targets</a>, called MiniML, doesn't (as of v8.9) have any constructors for comments.  The relevant file is in the Coq repository, <a href=\"https://github.com/coq/coq/blob/v8.9/plugins/extraction/miniml.ml\" rel=\"nofollow noreferrer\"><code>plugins/extraction/miniml.ml</code></a>.</p>\n"}], "owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 55344687, "answer_count": 1, "score": 7, "last_activity_date": 1553542509, "creation_date": 1553514730, "question_id": 55337201, "link": "https://stackoverflow.com/questions/55337201/extracting-coq-to-haskell-while-keeping-comments", "title": "Extracting Coq to Haskell while keeping comments", "body": "<p><strong>Is there anyway to keep comments while extracting Coq to Haskell</strong>?\nIdeally, I would like to have machine generated Haskell files untouched by humans, and so the motivation of extracting comments is clear. However, I couldn't find how to do it, and I wonder if this is at all possible (?). Here is an example Coq file:</p>\n\n<pre><code>(*************)\n(* factorial *)\n(*************)\nFixpoint factorial (n : nat) : nat :=\n  match n with\n  | 0 =&gt; 1\n  | 1 =&gt; 1 (* this case is redundant *)\n  | S n' =&gt; (mult n (factorial n'))\n  end.\n\nCompute (factorial 7).\n\n(********************************)\n(* Extraction Language: Haskell *)\n(********************************)\nExtraction Language Haskell.\n\n(***************************)\n(* Extract to Haskell file *)\n(***************************)\nExtraction \"/home/oren/Downloads/RPRP/output.hs\" factorial. \n</code></pre>\n\n<p>And when I extract it to Haskell everything works fine other than the fact that the comment inside factorial is lost:</p>\n\n<pre><code>$ coqc ./input.v &gt; /dev/null\n$ cat ./output.hs\nmodule Output where\n\nimport qualified Prelude\n\ndata Nat =\n   O\n | S Nat\n\nadd :: Nat -&gt; Nat -&gt; Nat\nadd n m =\n  case n of {\n   O -&gt; m;\n   S p -&gt; S (add p m)}\n\nmul :: Nat -&gt; Nat -&gt; Nat\nmul n m =\n  case n of {\n   O -&gt; O;\n   S p -&gt; add m (mul p m)}\n\nfactorial :: Nat -&gt; Nat\nfactorial n =\n  case n of {\n   O -&gt; S O;\n   S n' -&gt;\n    case n' of {\n     O -&gt; S O;\n     S _ -&gt; mul n (factorial n')}}\n</code></pre>\n"}, {"tags": ["haskell", "timeout", "infinite-loop", "infinite"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 7, "creation_date": 1553519684, "post_id": 55336948, "comment_id": 97402383, "body": "Yes, unfortunately, tight loops that don&#39;t allocate memory can&#39;t be interrupted with <code>timeout</code>. GHC pretends it does preemptive threading, and the facade is very good, but in fact within each OS thread it does cooperative threading. Allocation -- usually a very frequent event in immutable languages -- is the trigger for choosing whether to yield control or not. But GHC is smart enough to be able to optimize this loop into one that doesn&#39;t allocate, by observing that <code>length</code>&#39;s internal counter can be updated in-place (and <code>cycle [1,2,3]</code> allocates as much as it needs in time, it seems)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1553522977, "post_id": 55336948, "comment_id": 97404481, "body": "See the first entry of <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/bugs.html#bugs-in-ghc\" rel=\"nofollow noreferrer\">Bugs in GHC</a>. It&#39;s a long standing issue, which is not easy to fix without disabling a lot of optimizations."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1553526223, "post_id": 55336948, "comment_id": 97406534, "body": "@chi Nice! If -fno-omit-yields as suggested in your link works, it seems like it&#39;s worth writing a (short) answer suggesting it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553528615, "post_id": 55336948, "comment_id": 97408045, "body": "@DanielWagner It seems rather fragile to me, and it&#39;s module-wide instead of expression-wide. Also, Will Ness below found a duplicate, I think."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553528937, "post_id": 55336948, "comment_id": 97408209, "body": "Hm. Seems related, though it focuses on interactive, rather than programmatic, ways of stopping infinite loops."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 4, "last_activity_date": 1553521456, "creation_date": 1553521456, "answer_id": 55339229, "question_id": 55336948, "link": "https://stackoverflow.com/questions/55336948/how-can-i-use-the-haskell-timeout-function-in-system-timeout-to-halt-runaway-c/55339229#55339229", "title": "How can I use the Haskell timeout function (in System.Timeout) to halt runaway computations?", "body": "<p>You can use your own, non-sharing implementation of <code>cycle</code>:</p>\n\n<pre><code>&gt; _Y g = g (_Y g)\n_Y :: (t -&gt; t) -&gt; t\n\n&gt; take 10 . _Y $ ([1,2,3] ++)\n[1,2,3,1,2,3,1,2,3,1]\nit :: Num a =&gt; [a]\n\n&gt; timeout 100000 . print . length . _Y $ ([1,2,3] ++)\nNothing\nit :: Maybe ()\n(0.11 secs, 152470624 bytes)\n</code></pre>\n\n<p><code>_Y</code> will of course allocate an infinite, growing list, unlike the sharing <code>cycle</code> which is equivalent to <code>fix ([1,2,3] ++)</code> which creates an actual cyclic list in memory:</p>\n\n<pre><code>&gt; timeout 100000 . print . length . fix $ ([1,2,3] ++)\n&lt;&lt;&lt;hangs&gt;&gt;&gt;\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/55188787/849891\">How can I stop infinite evaluation in GHCi?</a> </li>\n</ul>\n"}], "owner": {"reputation": 91, "user_id": 11254028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e6c8dcec1bf9062981c972cd21ce60?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Schachte", "link": "https://stackoverflow.com/users/11254028/peter-schachte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "answer_count": 1, "score": 9, "last_activity_date": 1553586291, "creation_date": 1553513885, "last_edit_date": 1553586291, "question_id": 55336948, "link": "https://stackoverflow.com/questions/55336948/how-can-i-use-the-haskell-timeout-function-in-system-timeout-to-halt-runaway-c", "title": "How can I use the Haskell timeout function (in System.Timeout) to halt runaway computations?", "body": "<p>The timeout function in System.Timeout sometimes fails to halt an infinite computation.</p>\n\n<p>For example,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>timeout 1000 $ print $ length [0..]\n</code></pre>\n\n<p>returns <code>Nothing</code> as expected because the timeout interrupts the infinite computation.  But</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>timeout 1000 $ print $ length $ cycle [1,2,3]\n</code></pre>\n\n<p>loops forever.</p>\n\n<p>This is on a Mac, using ghc or ghci 8.6.4.</p>\n\n<p>I expect the second example to behave like the first, interrupting the infinite computation after 1 millisecond and returning <code>Nothing</code>.  Instead, the second example hangs.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1553509399, "post_id": 55335430, "comment_id": 97396306, "body": "@jaroslawj has explained how to fix the first issue. Regarding the second one, I can&#39;t see the issue with the code (the patterns look exhaustive to me) - can you show me how you are calling the function when you get the error? And why is there a <code>*</code> at the start of the first line of each definition. Are you loading these functions from a file or putting them directly into GHCi? In the latter case, you need <code>:{</code> at the start to indicate this is a multi-line definition, and <code>}:</code> at the end."}, {"owner": {"reputation": 1, "user_id": 11254148, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-YH5FzPLV2OU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfhgrbtvXSd6dom9b-w8-RS0QRMNw/mo/photo.jpg?sz=128", "display_name": "Mengchao Ju", "link": "https://stackoverflow.com/users/11254148/mengchao-ju"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553510319, "post_id": 55335430, "comment_id": 97396863, "body": "@Robin Zigmond Sorry, I just copy and paste the codes. The original codes do not have the * symbol. and when I have replaced the other to otherwise, it still reports the error."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553510705, "post_id": 55335430, "comment_id": 97397086, "body": "can you please edit the question so that it shows the exact code you&#39;re running?"}, {"owner": {"reputation": 1, "user_id": 11254148, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-YH5FzPLV2OU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfhgrbtvXSd6dom9b-w8-RS0QRMNw/mo/photo.jpg?sz=128", "display_name": "Mengchao Ju", "link": "https://stackoverflow.com/users/11254148/mengchao-ju"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553512134, "post_id": 55335430, "comment_id": 97397954, "body": "@Robin Zigmond, I have updated the codes and the results. Thank you very much. I waste one afternoon to seek the reason, but nothing useful. :("}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553512253, "post_id": 55335430, "comment_id": 97398036, "body": "thanks - so you&#39;re trying to put multiline function definitions directly into GHCi, one line at a time. As I already said, that doesn&#39;t work - unless you put <code>:{</code> before it and <code>:}</code> after (each on a line of its own). Or better still, write the function definition (normally) in a <code>.hs</code> file then load it into GHCi with <code>:l</code>"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1553512338, "post_id": 55335430, "comment_id": 97398087, "body": "also, the particular error it&#39;s now showing for <code>unroll</code> is because of this: <code>y:unroll x-1 ys</code>, you&#39;re missing necessary parentheses, it should be <code>y:(unroll (x-1) ys)</code>. [Also I would strongly advise to put each guard on a separate line, it&#39;s very hard to read when they&#39;re all on 1 line.]"}, {"owner": {"reputation": 1, "user_id": 11254148, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-YH5FzPLV2OU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfhgrbtvXSd6dom9b-w8-RS0QRMNw/mo/photo.jpg?sz=128", "display_name": "Mengchao Ju", "link": "https://stackoverflow.com/users/11254148/mengchao-ju"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553514088, "post_id": 55335430, "comment_id": 97399129, "body": "Thank you very much! I will try them"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1553520320, "post_id": 55335430, "comment_id": 97402831, "body": "There&#39;s almost certainly a duplicate for the <code>y: unroll x - 1 ys</code> / <code>y : unroll (x - 1) ys</code> issue as well, but I can&#39;t find one at the moment."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11254148, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-YH5FzPLV2OU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfhgrbtvXSd6dom9b-w8-RS0QRMNw/mo/photo.jpg?sz=128", "display_name": "Mengchao Ju", "link": "https://stackoverflow.com/users/11254148/mengchao-ju"}, "edited": false, "score": 0, "creation_date": 1553510718, "post_id": 55335498, "comment_id": 97397094, "body": "Sorry, after I replaced the other to otherwise, it still reports the error."}], "tags": [], "owner": {"reputation": 452, "user_id": 3531310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c879bfa7b230a3b1a3f96fd3cb830e?s=128&d=identicon&r=PG&f=1", "display_name": "jaroslawj", "link": "https://stackoverflow.com/users/3531310/jaroslawj"}, "is_accepted": false, "score": 0, "last_activity_date": 1553509699, "last_edit_date": 1553509699, "creation_date": 1553508957, "answer_id": 55335498, "question_id": 55335430, "link": "https://stackoverflow.com/questions/55335430/the-issue-about-the-variable-not-in-scope-and-the-exception-interactive/55335498#55335498", "title": "the issue about the &quot;Variable not in scope&quot; and the &quot; Exception: &lt;interactive&gt;: Non-exhaustive patterns in function&quot;", "body": "<p>In the first example replace <code>other</code> with <code>otherwise</code>. In second example you don't have a total function, that is defined for all possible values of its input - in particular you are missing function definition for the list with one element <code>subst a b [x] = -- place function definition here</code></p>\n"}], "owner": {"reputation": 1, "user_id": 11254148, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-YH5FzPLV2OU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfhgrbtvXSd6dom9b-w8-RS0QRMNw/mo/photo.jpg?sz=128", "display_name": "Mengchao Ju", "link": "https://stackoverflow.com/users/11254148/mengchao-ju"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "closed_date": 1553520238, "answer_count": 1, "score": -1, "last_activity_date": 1553523502, "creation_date": 1553508745, "last_edit_date": 1553523502, "question_id": 55335430, "link": "https://stackoverflow.com/questions/55335430/the-issue-about-the-variable-not-in-scope-and-the-exception-interactive", "closed_reason": "Duplicate", "title": "the issue about the &quot;Variable not in scope&quot; and the &quot; Exception: &lt;interactive&gt;: Non-exhaustive patterns in function&quot;", "body": "<p>I encountered the error \"<strong><em>Variable not in scope: other :: Bool</em></strong>\" when I am running the below codes:</p>\n\n<pre><code>unroll x [] = []\nunroll 0 y = []\nunroll x (y:ys) | x &gt; length (y:ys) = y:unroll x-1 ys | otherwise = take x (y:ys)\n</code></pre>\n\n<p>The result:</p>\n\n<pre><code>Prelude&gt;     unroll x [] = []\nPrelude&gt;     unroll 0 y = []\nPrelude&gt;     unroll x (y:ys) | x &gt; length (y:ys) = y:unroll x-1 ys | otherwise = take x (y:ys)\n\n&lt;interactive&gt;:89:5: error:\n    ? Couldn't match type \u2018[a] -&gt; [a]\u2019 with \u2018[a]\u2019\n      Expected type: Int -&gt; [a]\n        Actual type: Int -&gt; [a] -&gt; [a]\n    ? Relevant bindings include\n        unroll :: Int -&gt; [a] (bound at &lt;interactive&gt;:89:5)\nPrelude&gt;\n</code></pre>\n\n<p>And another issue, which is \"****** Exception: :12:1-72: Non-exhaustive patterns in function subst***\" jumped out when I am running the second codes:</p>\n\n<pre><code>subst _ _ [] = []\nsubst \"\" \"\" (x:xs) = (x:xs)\nsubst a b (x:xs) | x == a = b : subst a b xs | x /= a = x : subst a b xs*\n</code></pre>\n\n<p>The result2:</p>\n\n<pre><code>Prelude&gt; subst _ _ [] = []\nPrelude&gt; subst \"\" \"\" (x:xs) = (x:xs)\nPrelude&gt; subst a b (x:xs) | x == a = b : subst a b xs | x /= a = x : subst a b xs\nPrelude&gt; subst 2 0 [1,2,0,1]\n[1,0,0,1*** Exception: &lt;interactive&gt;:92:1-72: Non-exhaustive patterns in function subst\n</code></pre>\n\n<p>Can anyone help me to explain and solve the issue above?</p>\n\n<p>Thank you very much!</p>\n\n<p>Cheers</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553503825, "post_id": 55334033, "comment_id": 97393232, "body": "<code>get</code> returns a value of type <code>(StateT Int IO) String</code> (I&#39;ve put the parentheses in to be more explicit, they are implied anyway), so using the <code>&lt;-</code> notation to &quot;extract  the underlying value&quot;, <code>a</code> is simply a <code>String</code>."}, {"owner": {"reputation": 225, "user_id": 9494377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Don Klein", "link": "https://stackoverflow.com/users/9494377/don-klein"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553504075, "post_id": 55334033, "comment_id": 97393363, "body": "@RobinZigmond Yes, <code>(StateT Int IO) String</code> was my understanding of how a monad transformer is constructed, I&#39;m just hoping to see the real code that made it happen and as I said I failed to see that from the source code?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553505106, "post_id": 55334033, "comment_id": 97393878, "body": "Ah OK, in that case you need to be more explicit about what you want explained. I was simply answering the question in the comment, as to why <code>liftIO $ print a</code> was not showing a tuple."}, {"owner": {"reputation": 225, "user_id": 9494377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Don Klein", "link": "https://stackoverflow.com/users/9494377/don-klein"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553508080, "post_id": 55334033, "comment_id": 97395553, "body": "That\u2019s exactly what I\u2019m curious about because judeging by the source listed above it looks like this? get = state $ \\ s -&gt; (s, s) which is returning a tuple? @RobinZigmond"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553508433, "post_id": 55334033, "comment_id": 97395759, "body": "Do you understand how <code>do</code> notation is &quot;desugared&quot;? This <code>do</code> block translates into <code>w = get &gt;&gt;= \\a -&gt; liftIO (print a) &gt;&gt; return (show a)</code> - the <code>a</code> here is of type <code>String</code>, even though <code>get</code> is of type <code>StateT Int IO String</code>. (<code>&gt;&gt;=</code> has type signature <code>m a -&gt; (a -&gt; m b) -&gt; m  b</code>, <code>m</code> in this case is <code>StateT Int IO</code>)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1553515795, "post_id": 55334033, "comment_id": 97400099, "body": "@DonKlein No, <code>get</code> doesn&#39;t return anything. It <i>is</i> a value that wraps a <i>function</i> that returns a tuple. Its monad instance defines <code>&gt;&gt;=</code> to pass part of that return value, once it actually gets called via <code>runState(T)</code>, as the argument to the next function."}, {"owner": {"reputation": 225, "user_id": 9494377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Don Klein", "link": "https://stackoverflow.com/users/9494377/don-klein"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1553517035, "post_id": 55334033, "comment_id": 97400846, "body": "@chepner that makes sense, but can you show me where this monad instance is defined? I want to see how it\u2019s &gt;&gt;= actually return part of the value (for that I had flipped through endless source code today trying to find just that), thanks!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553517085, "post_id": 55334033, "comment_id": 97400869, "body": "<a href=\"https://hackage.haskell.org/package/transformers-0.5.6.2/docs/src/Control.Monad.Trans.State.Lazy.html#line-221\" rel=\"nofollow noreferrer\">here</a>. this is the source for the <code>Monad</code> instance <a href=\"https://hackage.haskell.org/package/transformers-0.5.6.2/docs/Control-Monad-Trans-State-Lazy.html#t:StateT\" rel=\"nofollow noreferrer\">from here</a>. You find it under &quot;Instances&quot;, the second entry."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1553517305, "post_id": 55334033, "comment_id": 97400984, "body": "Note that <code>m &gt;&gt;= f</code> doesn&#39;t actually return the value. It creates a <i>new</i> <code>StateT</code> value whose wrapped function unwraps <code>m</code> and &quot;composes* its function with <code>f</code>. <code>a &lt;- get</code> is desugared as <code>get &gt;&gt;= \\a -&gt; ...</code>, where the <code>...</code> continuation is everything that follows in the <code>do</code> block."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1553517469, "post_id": 55334033, "comment_id": 97401063, "body": "see the <code>k a</code> in the last line of <code>&gt;&gt;=</code> implementation there, <code>runStateT (k a) s&#39;</code>? that&#39;s what it means that only the part of the tuple - i.e. its <code>fst</code> field - is passed along as the &quot;returned value&quot; from a previous computation step into the next computation step, while the <code>s&#39;</code> in <code>( a  , s&#39;)</code> is tagging along as part of the stateful computation &quot;pipeline&quot;. So we &quot;compute&quot; the <code>a</code> &quot;value&quot;, and <code>s</code> &quot;state&quot; is maintained on the side for us."}, {"owner": {"reputation": 225, "user_id": 9494377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Don Klein", "link": "https://stackoverflow.com/users/9494377/don-klein"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553518624, "post_id": 55334033, "comment_id": 97401772, "body": "@WillNess Ah that clicked for me, actually I stared at that instance implementation for like an hour today but didn&#39;t realize the key lies in the (k a) part, thanks for point that out, all&#39;s good now!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1553519919, "post_id": 55334033, "comment_id": 97402539, "body": "see <a href=\"https://stackoverflow.com/q/31506839/849891\">e.g. this</a> for some illuminating (hopefully) re-writes in the answers. (disclaimer: one of them is by me). it&#39;s for simple State (no transformers) so should be simpler to follow. transformers just juggle the additional monads around, but the essence of state passing is the same."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1553522860, "post_id": 55334033, "comment_id": 97404404, "body": "Don&#39;t put an answer in the question itself. You can post an answer to your own question if you fee the need."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1553519535, "last_edit_date": 1553519535, "creation_date": 1553517382, "answer_id": 55337941, "question_id": 55334033, "link": "https://stackoverflow.com/questions/55334033/curious-about-why-get-in-statet-monad-transformer-returns-a-instead-of-a-s/55337941#55337941", "title": "Curious about why get in StateT monad transformer returns a instead of (a, s)", "body": "<p>A value of type <code>StateT s m a</code>, modulo <code>newtype</code> wrappers, is a function with type <code>s -&gt; m (a, s)</code>.</p>\n\n<p>The function <code>(return . (\\ s -&gt; (s, s)))</code> has type <code>s -&gt; m (s, s)</code>, hence once it is wrapped by the <code>StateT</code> constructor becomes a value of type <code>StateT s m s</code>.</p>\n\n<p>Note that a value of type <code>StateT s m (s, s)</code> would instead involve a function of type <code>s -&gt; m (s, (s, s))</code> which is not what we are using here.</p>\n\n<p>Your confusion seem to arise from the \"other\" <code>s</code> in <code>m (s, s)</code>, which does not contribute to <code>x</code> when we run <code>x &lt;- get</code>. To understand why, it's useful to think to think to what a stateful computation performs:</p>\n\n<ul>\n<li>First, we read the old state of type <code>s</code>. This is the <code>s -&gt; ..</code> part in the type <code>s -&gt; m (a, s)</code>.</li>\n<li>Then, we run some action in the monad <code>m</code>. This is the <code>.. -&gt; m ..</code> part in the type <code>s -&gt; m (a, s)</code>.\n\n<ul>\n<li>The monadic action returns a new state, to replace the old one. This is the <code>.. -&gt; .. (.., s)</code> part in the type <code>s -&gt; m (a, s)</code>.</li>\n<li>Finally, monadic action also returns a value, of a possibly different type <code>a</code>. This the <code>.. -&gt; .. (a, ..)</code> part in the type <code>s -&gt; m (a, s)</code>.</li>\n</ul></li>\n</ul>\n\n<p>Running <code>x &lt;- action</code> handles all these types automatically for us, and lets <code>x</code> to have the result type <code>a</code>, only.</p>\n\n<p>Concretely, consider this imperative pseudo-code:</p>\n\n<pre><code>global n: int\n\ndef foo():\n   if n &gt; 5:\n      print \"&gt;5\"\n      n = 8\n      return \"hello\"\n   else:\n      print \"not &gt;5\"\n      n = 10\n      return \"greetings\"\n</code></pre>\n\n<p>In an imperative language, we would type this as <code>foo(): string</code>, since it returns a string, disregarding its side effects to the global <code>n: int</code> and the printed messages.</p>\n\n<p>In Haskell, we would instead model that using a more precise type like</p>\n\n<pre><code>Int -&gt; IO (String, Int)\n^-- the old n\n       ^-- the printed stuff\n           ^-- the returned string\n                   ^-- the new n\n</code></pre>\n\n<p>Again, running <code>x &lt;- foo()</code> we want <code>x: string</code>, not <code>x: (string, int)</code>, following what would happen in an imperative language.</p>\n\n<p>If instead we had a function</p>\n\n<pre><code>global n: int\n\ndef bar():\n   old_n = n\n   n = n + 5\n   return old_n\n</code></pre>\n\n<p>we would use the type</p>\n\n<pre><code>Int -&gt; IO (Int, Int)\n</code></pre>\n\n<p>since the returned value is an <code>Int</code> now. Similarly,</p>\n\n<pre><code>global n: int\n\ndef get():\n   return n\n</code></pre>\n\n<p>could use the same type</p>\n\n<pre><code>Int -&gt; IO (Int, Int)\n</code></pre>\n\n<p>Now, one might argue that the second <code>Int</code> is not strictly necessary here, since <code>get()</code> is not really producing a new state -- it's not <em>changing</em> the value of <code>n</code>. Still, it's convenient to use a type of the same form, <code>s -&gt; m (a, s)</code>, as any function which <em>could</em> change the state. This is so that it can be used together with any other function having a similar type.</p>\n"}], "owner": {"reputation": 225, "user_id": 9494377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Don Klein", "link": "https://stackoverflow.com/users/9494377/don-klein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1553522908, "creation_date": 1553503620, "last_edit_date": 1553522908, "question_id": 55334033, "link": "https://stackoverflow.com/questions/55334033/curious-about-why-get-in-statet-monad-transformer-returns-a-instead-of-a-s", "title": "Curious about why get in StateT monad transformer returns a instead of (a, s)", "body": "<p>I was reading the <a href=\"https://hackage.haskell.org/package/transformers-0.5.5.0/docs/src/Control.Monad.Trans.State.Lazy.html#get\" rel=\"nofollow noreferrer\">StateT monad transformer's source</a>, as it reads like this:</p>\n\n<pre><code>get :: (Monad m) =&gt; StateT s m s\nget = state $ \\ s -&gt; (s, s)\n</code></pre>\n\n<p>I expanded the above code by switching out <code>state</code> and got this, but still fail to see why it's not returning a tuple.</p>\n\n<pre><code>a &lt;- StateT (return . (\\ s -&gt; (s, s)))\n</code></pre>\n\n<p>From the code above it seemed <code>get</code> returns a tuple <code>(s, s)</code>, which looked fine, but I'm wondering why when using it, <code>get</code> returned an <code>Int</code>, instead of <code>(Int, Int)</code>? </p>\n\n<p>I traced a lot of source code trying to find when or what changed it but to no avail.</p>\n\n<pre><code>w :: StateT Int IO String\nw = do\n  a &lt;- get\n  liftIO $ print a -- 2, but why? shouldn't this be (2, 2) instead?\n  return $ show a\n\nresult = runStateT w 2 -- (\"2\",2)\n\n</code></pre>\n"}, {"tags": ["haskell", "bmp", "bytestring"], "comments": [{"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 1, "creation_date": 1553529726, "post_id": 55333669, "comment_id": 97408690, "body": "I do not see any pure function. Do you have any reason for that?"}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "reply_to_user": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1553543297, "post_id": 55333669, "comment_id": 97415560, "body": "I think I don&#39;t understand your observation well. However, if you meant to say that there are no functions for manipulating an rgba matrix, this is due to the fact that for me the functions I published serve as a working &quot;environment&quot;. If instead you mean that Matrix is bound to the Integer type (and not for example to the Int type) this is because the Matrix conversion function (matrix library) requires the Integer type. I think that working with Array I wouldn&#39;t have this constraint."}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1553552293, "post_id": 55333669, "comment_id": 97419186, "body": "Do you have any real problem?"}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1553552459, "post_id": 55333669, "comment_id": 97419233, "body": "What is <code>Matrix</code>? I would expect <code>Matrix Integer</code> instead of <code>Matrix [Integer]</code>."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1553563324, "post_id": 55333669, "comment_id": 97421835, "body": "I voted to close as too broad, because it is.  But briefly: <code>Is it better to operate a Word8 or Integer matrix?</code>  <code>Word8</code> can unbox while <code>Integer</code> won&#39;t. <code>How else can we switch from ByteString to a two-dimensional matrix?</code> There are infinite ways, why do you ask? <code>Are the procedures used the most efficient?</code> No.  Lists are obviously not going to be &quot;most efficient&quot; - consider packed structures of word8 values.  Consider smaller, notably self contained, examples."}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1553582557, "post_id": 55333669, "comment_id": 97426216, "body": "@ThomasM.DuBuisson : 1 (Switch from ByteString to a two-dimensional matrix): In Matrix library I only found &quot;fold...&quot; and &quot;mapAccum...&quot; with type ... ByteString -&gt; a. The last one seemed inappropriate. You say that &quot;there are infinite ways&quot; to do it; please can you tell me just one that is better than the one chosen by me?"}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "reply_to_user": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1553582808, "post_id": 55333669, "comment_id": 97426310, "body": "@Elmex80s : Matrix [Integer] are list of rgba value. Ex. [255,100,30,0]. Regardless of whether to keep Word8 or Integer or Int in the matrix, I think it would be better to replace the list of the four RGBA values with a record structure."}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1553583817, "post_id": 55333669, "comment_id": 97426719, "body": "@ThomasM.DuBuisson : I chose to use Integers instead of Word8 because it seemed difficult to use the mathematical functions with the latter type. For example, if I want to halve a Red value, I can easily use the &quot;div&quot; operator with the Integer type; I don&#39;t think this is as easy as using the Word8 type. it&#39;s because I&#39;m not sure and I may be wrong that I ask the forum for help."}], "owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1553581733, "creation_date": 1553501977, "last_edit_date": 1553581733, "question_id": 55333669, "link": "https://stackoverflow.com/questions/55333669/file-bmp-analysis-and-transformation", "title": "File .BMP: analysis and transformation", "body": "<p>My goal is to be able to analyze and transform graphic files focusing on the color matrix.</p>\n\n<ol>\n<li>Is it better to operate a Word8 or Integer matrix?</li>\n<li>How else can we switch from ByteString to a two-dimensional matrix?</li>\n<li>Are the procedures used the most efficient?</li>\n</ol>\n\n<p>?</p>\n\n<pre><code>bmpToMatrix :: FilePath -&gt; IO (Matrix [Integer])\nbmpToMatrix input = do\n    Right bmp  &lt;- readBMP input\n    let rgbas   =  unpackBMPToRGBA32 bmp\n        (width, height) = bmpDimensions bmp\n        integers =  BS.foldr ((:) . toInteger) [] rgbas\n    return $ MT.fromList height width $ SP.chunksOf 4 integers\n\nbmpEdit :: (Matrix [Integer] -&gt; Matrix [Integer]) -&gt; FilePath -&gt; FilePath -&gt; IO ()\nbmpEdit f input output = do\n    matrix &lt;- bmpToMatrix input\n    let matrix' = f matrix\n    matrixToBMP output matrix'\n\nmatrixToByteString :: Matrix [Integer] -&gt; ByteString \nmatrixToByteString = BS.pack . L.concatMap (L.map fromIntegral) . MT.toList\n\nmatrixToBMP :: FilePath -&gt; Matrix [Integer] -&gt; IO ()\nmatrixToBMP output mt =\n    writeBMP output $ packRGBA32ToBMP (ncols mt) (nrows mt) $ matrixToByteString mt\n</code></pre>\n"}, {"tags": ["haskell", "testing", "typeclass", "quickcheck"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1553513316, "post_id": 55332047, "comment_id": 97398692, "body": "Why does <code>HasCheck</code> involve a <code>Monad m</code>? Why do you even need that type class? Wouldn&#39;t it be simpler to have a pure function <code>isCollision :: Coord -&gt; Bool</code>, without involving a type class?"}, {"owner": {"reputation": 441, "user_id": 7919572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7180a29a1e3cbca63bc706c4c7414a6?s=128&d=identicon&r=PG&f=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/7919572/marc"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1553540501, "post_id": 55332047, "comment_id": 97414262, "body": "For the knight it&#39;s not so interesting but the pawn depends on the state of the game and if it has moved before therefore it needs to be a Monad for the State Monad."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1553547113, "post_id": 55332047, "comment_id": 97417234, "body": "Could you write the function as <code>Coord -&gt; State s Bool</code> then? With an unconstrained <code>Monad m</code>, <code>m</code> could also be <code>[]</code>, <code>IO</code>, <code>-&gt;</code>, <code>Maybe</code>, and all sorts of other monads. Are any of those meaningful?"}, {"owner": {"reputation": 441, "user_id": 7919572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7180a29a1e3cbca63bc706c4c7414a6?s=128&d=identicon&r=PG&f=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/7919572/marc"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1553571344, "post_id": 55332047, "comment_id": 97423361, "body": "The <code>(-&gt;)</code> instance of HasCheck is used for mocking in unit tests. Potentially <code>IO</code> could be interesting too if it&#39;s instead requesting a server.  The reason I implemented it that way was that I didn&#39;t want the logic for the Pieces to concern itself in anyway about how the board is implemented. In theory quickcheck shouldn&#39;t need to care about the state of the board either."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1553582756, "post_id": 55332047, "comment_id": 97426292, "body": "One usually doesn&#39;t mock in FP; there&#39;s no need, because <a href=\"https://blog.ploeh.dk/2015/05/07/functional-design-is-intrinsically-testable\" rel=\"nofollow noreferrer\">pure functions are already intrinsically testable</a>. Could you design the code so that it&#39;s composed of pure functions instead?"}, {"owner": {"reputation": 441, "user_id": 7919572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7180a29a1e3cbca63bc706c4c7414a6?s=128&d=identicon&r=PG&f=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/7919572/marc"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1553584812, "post_id": 55332047, "comment_id": 97427205, "body": "The Piece module implements all the logic for the pieces without depending on state. We still need a way to check if a coordinate is a collision or not. By abstracting it away in a type class HasCheck we can instance it in a stateless way. All HasCheck constrainted functions work if given a isCollision function, separating logic from implementation. It&#39;s inescapable that this function will depend on state for the real implementation but we can move that stateful implementation to the outward of the program, leaving the core testable, pure and stateless. So in that sense we &quot;mock&quot; isCollision."}, {"owner": {"reputation": 441, "user_id": 7919572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7180a29a1e3cbca63bc706c4c7414a6?s=128&d=identicon&r=PG&f=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/7919572/marc"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1553585361, "post_id": 55332047, "comment_id": 97427503, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/190675/discussion-between-marc-and-mark-seemann\">continue this discussion in chat</a>."}], "answers": [{"tags": [], "owner": {"reputation": 441, "user_id": 7919572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7180a29a1e3cbca63bc706c4c7414a6?s=128&d=identicon&r=PG&f=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/7919572/marc"}, "is_accepted": true, "score": 0, "last_activity_date": 1553677251, "last_edit_date": 1553677251, "creation_date": 1553676640, "answer_id": 55373077, "question_id": 55332047, "link": "https://stackoverflow.com/questions/55332047/quickchecking-with-a-typeclass-constraint-and-reporting-the-generated-values/55373077#55373077", "title": "Quickchecking with a typeclass constraint and reporting the generated values?", "body": "<p>Okay so I feel this should be solvable in another way. However I made the following solution that works inspired by the <a href=\"https://jaspervdj.be/posts/2018-03-08-handle-pattern.html\" rel=\"nofollow noreferrer\">handler pattern</a>.</p>\n\n<p>I changed the HasCheck typeclass to a record, as follows: </p>\n\n<pre><code>data Handle = MakeHandle                                                                   \n    { isCollision   :: Coord -&gt; Bool                                                   \n    }      \n\n</code></pre>\n\n<p>and then refactored all the code to use handle instead of HasCheck. </p>\n\n<pre><code>collisionKnightRule :: Handle -&gt; Coord -&gt; (Set Coord)                            \ncollisionKnightRule handle =                                                     \n    Set.filter (isCollision handle) . knightMoveSet                              \n\n\n-- | Set of all moves, legal or not                                              \nknightMoveSet :: Coord -&gt; Set Coord                                              \nknightMoveSet (x,y) =                                                            \n    Set.fromList                                                                 \n        [ (x+2,y-1),(x+2,y+1),(x-2,y-1),(x-2,y+1)                                \n        , (x+1,y-2),(x+1,y+2),(x-1,y-2),(x-1,y+2)                                \n        ]                                                                        \n\n\n-- | Set of illegal moves                                                        \nknightRuleSet :: Handle -&gt; Coord -&gt; (Set Coord)                                  \nknightRuleSet =                                                                  \n    collisionKnightRule                                                          \n\n\nknightMoves :: Handle -&gt; Coord -&gt; (Set Coord)                                    \nknightMoves handle pos =                                                         \n    let                                                                          \n        moveSet =                                                                \n            knightMoveSet pos                                                    \n\n        invalidMoves =                                                           \n            knightRuleSet handle pos                                             \n    in                                                                           \n        Set.difference moveSet invalidMoves\n</code></pre>\n\n<p>The disadvantage of this is I fear that for stateful code it can be easy to introduce an error where you pass in a handle that is out-of-date,  I.E. having multiple sources of truths. An advantage is that this is probably easier for people new to Haskell to understand. We can now mock functions using the Quickcheck's Function  typeclass and pass them as an argument to make a mockHandler:</p>\n\n<pre><code>knightSetProperty ::                                                                 \n    Fun (Int,Int) Bool                                                               \n    -&gt; (Int,Int)                                                                     \n    -&gt; Gen Bool                                                                      \nknightSetProperty (Fun _ isCollision) position =                \n    let                                                                              \n        handler = \n            Piece.MakeHandle isCollision                           \n        moveSet =                                                                      \n            Piece.knightMoves handler position                                       \n    in                                                                               \n        return $ moveSet `Set.isProperSubsetOf` (Piece.knightMoveSet position)\n</code></pre>\n\n<p>Now this fails properly with a counterexample:</p>\n\n<pre><code>*** Failed! Falsifiable (after 53 tests and 74 shrinks):     \n{_-&gt;False}\n(0,0)\n</code></pre>\n"}], "owner": {"reputation": 441, "user_id": 7919572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7180a29a1e3cbca63bc706c4c7414a6?s=128&d=identicon&r=PG&f=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/7919572/marc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 55373077, "answer_count": 1, "score": 2, "last_activity_date": 1553677251, "creation_date": 1553493939, "question_id": 55332047, "link": "https://stackoverflow.com/questions/55332047/quickchecking-with-a-typeclass-constraint-and-reporting-the-generated-values", "title": "Quickchecking with a typeclass constraint and reporting the generated values?", "body": "<p>I'm trying to do a property-based test for a chess game. I have set up the following typeclass</p>\n\n<pre><code>class Monad m =&gt; HasCheck m where                                                   \n    isCollision :: Coord -&gt; m Bool                                                  \n</code></pre>\n\n<p>which checks if a given coordinate contains a collision or out of bounds.</p>\n\n<p>Now I have a function that generates the moveset of allowed actions for a knight like the following</p>\n\n<pre><code>collisionKnightRule :: HasCheck m =&gt; Coord -&gt; m (Set Coord)                      \ncollisionKnightRule =                                                            \n    Set.filterM isCollision . knightMoveSet                                      \n\n\n-- | Set of all moves, legal or not                                              \nknightMoveSet :: Coord -&gt; Set Coord                                              \nknightMoveSet (x,y) =                                                            \n    Set.fromList                                                                 \n        [ (x+2,y-1),(x+2,y+1),(x-2,y-1),(x-2,y+1)                                \n        , (x+1,y-2),(x+1,y+2),(x-1,y-2),(x-1,y+2)                                \n        ]                                                                        \n\n\n\nknightMoves :: HasCheck m =&gt; Coord -&gt; m (Set Coord)                              \nknightMoves pos =                                                                \n    do  let moveSet =                                                            \n                knightMoveSet pos                                                \n        invalidMoves &lt;- collisionKnightRule pos                                        \n        return $ Set.difference moveSet invalidMoves                             \n\n</code></pre>\n\n<p>and an instance for the HasCheck class for an arbitrary coordinate</p>\n\n<pre><code>instance HasCheck Gen where                                                      \n    isCollision _ =                                                              \n         Quickcheck.arbitrary                                                    \n\n</code></pre>\n\n<p>and so afterwards to test this I want to ensure that the generated moveset is a proper subset of all possible moves.</p>\n\n<pre><code>knightSetProperty :: Piece.HasCheck Gen                                          \n    =&gt; (Int,Int)                                                                 \n    -&gt; Gen Bool                                                                  \nknightSetProperty position =                                                     \n    do  moves &lt;- Piece.knightMoves position                                      \n        return $ moves `Set.isProperSubsetOf` (Piece.knightMoveSet position)\n\n-- ... later on\n\nit \"Knight ruleset is subset\" $                                          \n            quickCheck knightSetProperty\n</code></pre>\n\n<p>Of course this fails because it could be that the knight can't move anywhere, which would mean that it's not a proper subset but the same set. However the error reported is not particularly helpful</p>\n\n<pre><code>*** Failed! Falsifiable (after 14 tests and 3 shrinks):  \n(0,0)\n</code></pre>\n\n<p>This is because quickcheck doesn't report the generated value of isCollision. Therefore I wonder, how can I make quickCheck report the generated value of <code>isCollision</code>?</p>\n"}, {"tags": ["python", "django", "bash", "haskell", "heroku"], "comments": [{"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1553599739, "post_id": 55331563, "comment_id": 97435642, "body": "After <code>cabal sandbox init</code>, cabal will install in <code>.cabal-sandbox&#47;bin</code>.  Is this directory on your PATH?"}, {"owner": {"reputation": 3, "user_id": 11252937, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5CP901mfwXo/AAAAAAAAAAI/AAAAAAAAABY/o25E0IXZxfo/photo.jpg?sz=128", "display_name": "Sarthak Kumar", "link": "https://stackoverflow.com/users/11252937/sarthak-kumar"}, "reply_to_user": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1553605632, "post_id": 55331563, "comment_id": 97439549, "body": "Thanks for your comment @bergey. No, it wasn&#39;t on my path; however, I removed that line from the before_deploy script and the result was the same. I think the packages are being installed but not actually being deployed in heroku."}], "owner": {"reputation": 3, "user_id": 11252937, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5CP901mfwXo/AAAAAAAAAAI/AAAAAAAAABY/o25E0IXZxfo/photo.jpg?sz=128", "display_name": "Sarthak Kumar", "link": "https://stackoverflow.com/users/11252937/sarthak-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1553490708, "creation_date": 1553490708, "question_id": 55331563, "link": "https://stackoverflow.com/questions/55331563/is-it-possible-to-install-haskell-and-non-haskell-packages-within-a-python-djang", "title": "Is it possible to install Haskell and non-Haskell packages within a Python/Django app deployed in Heroku?", "body": "<p>My Django application uses packages associated with Haskell, such as <code>HLint</code>, and some non-Haskell packages such as <code>graphviz</code>. I use the <code>shlex</code> command in my app to call a bash script that then goes on to call the package. This runs fine locally.</p>\n\n<p>However, I have also deployed the app to Heroku using Travis - over there, the views designed to activate the bash scripts do not run. I'm running a before_deploy script to install the required packages and the Travis build says they are successfully installed; I don't think the packages are available to the Heroku app. </p>\n\n<p>My question is: is it possible for the required packages to be available in the Heroku app? And if so, how can I configure Heroku to run them via bash or some other means? Any help would be really appreciated!</p>\n\n<p>It may be useful to know that the app is running in a Linux environment, and that I'm using a single Python build pack.</p>\n\n<h3>Code</h3>\n\n<p>My <code>.travis.yml</code> file is as follows:</p>\n\n<pre><code>sudo: true\nlanguage: python\npython:\n- '3.6'\nenv:\n- DJANGO=2.1.5\ninstall:\n- pip install -q Django==$DJANGO\n- pip install -q -r requirements.txt\nscript:\n- python manage.py test\nbefore_deploy:\n- \"./before_deploy.sh\"\ndeploy:\n  provider: heroku\n  api_key:\n    secure: &lt;REDACTED&gt;\n  app: hasnetdt-stage\nnotifications:\n  email: false\n</code></pre>\n\n<p>And here is the <code>before_deploy.sh</code> script for reference:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>#!/bin/bash\n\nsudo add-apt-repository -y ppa:hvr/ghc\nsudo apt-get update\nsudo apt-get install -y cabal-install-1.22 ghc-7.10.2\nsudo apt-get install -y graphviz\n\nexport PATH=~/.cabal/bin:/opt/cabal/1.22/bin:/opt/ghc/7.10.2/bin:$PATH\ncabal sandbox init\ncabal update\ncabal install alex happy\ncabal install hindent hlint\n</code></pre>\n\n<h3>Sidenote:</h3>\n\n<p>When I tried deploying locally (i.e. with <code>git push heroku master</code>), the Heroku logs said:</p>\n\n<pre><code>2019-03-24T18:41:29.637402+00:00 app[web.1]: ./static/scripts/prettify.sh: line 3: hindent: command not found\n2019-03-24T18:41:29.644886+00:00 app[web.1]: ./static/scripts/linter.sh: line 3: hlint: command not found\n</code></pre>\n\n<p>But this may be because I deployed it locally rather than with Travis, so the before_deploy script isn't running.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1270, "user_id": 2383766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc13aeb9c9f89e097f48d815b81541d5?s=128&d=identicon&r=PG", "display_name": "Z-Y.L", "link": "https://stackoverflow.com/users/2383766/z-y-l"}, "edited": false, "score": 2, "creation_date": 1553488436, "post_id": 55330951, "comment_id": 97388015, "body": "Where is your <code>f</code> in your <code>evalExpr</code>? And <code>f</code> is not type-checked. Notice the type signature of <code>foldl</code>: <code>(b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b</code>. Maybe you should use the <a href=\"https://hackage.haskell.org/package/parsec\" rel=\"nofollow noreferrer\">parsec</a> package to solve your problem."}, {"owner": {"reputation": 29, "user_id": 11182553, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-9pOdw0Sb29E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3HK_pNB3RP3gZ_tpsZRS1ZfuCDA/mo/photo.jpg?sz=128", "display_name": "Lola Martinez", "link": "https://stackoverflow.com/users/11182553/lola-martinez"}, "reply_to_user": {"reputation": 1270, "user_id": 2383766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc13aeb9c9f89e097f48d815b81541d5?s=128&d=identicon&r=PG", "display_name": "Z-Y.L", "link": "https://stackoverflow.com/users/2383766/z-y-l"}, "edited": false, "score": 0, "creation_date": 1553488772, "post_id": 55330951, "comment_id": 97388088, "body": "@Z-Y.L what do you mean by f not type-checked?"}, {"owner": {"reputation": 1270, "user_id": 2383766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc13aeb9c9f89e097f48d815b81541d5?s=128&d=identicon&r=PG", "display_name": "Z-Y.L", "link": "https://stackoverflow.com/users/2383766/z-y-l"}, "edited": false, "score": 0, "creation_date": 1553489329, "post_id": 55330951, "comment_id": 97388197, "body": "<code>f</code> should always return the result of the same type and align with the type signature of <code>foldl</code>. In your case, <code>f</code>&#39;s type signature should be <code>Int -&gt; Char -&gt; Int</code>, but yours is not."}, {"owner": {"reputation": 29, "user_id": 11182553, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-9pOdw0Sb29E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3HK_pNB3RP3gZ_tpsZRS1ZfuCDA/mo/photo.jpg?sz=128", "display_name": "Lola Martinez", "link": "https://stackoverflow.com/users/11182553/lola-martinez"}, "reply_to_user": {"reputation": 1270, "user_id": 2383766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc13aeb9c9f89e097f48d815b81541d5?s=128&d=identicon&r=PG", "display_name": "Z-Y.L", "link": "https://stackoverflow.com/users/2383766/z-y-l"}, "edited": false, "score": 0, "creation_date": 1553503645, "post_id": 55330951, "comment_id": 97393155, "body": "@Z-Y.L any suggestion how to fix it?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1553517793, "post_id": 55330951, "comment_id": 97401251, "body": "I suggest you first write it using recursion. Using a fold here would be harder, since you need to process more than one character at a time. E.g. when you need to read <code>&quot;+3...&quot;</code> you need to read both <code>+</code> and <code>3</code> to decide to increment the accumulator by 3. Reading only the <code>+</code> is not enough. Also, it&#39;s not clear if you need to handle numbers larger than 9 e.g. <code>23+543-765</code>: in such case, you need a smarter recursion."}], "answers": [{"tags": [], "owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "is_accepted": false, "score": 0, "last_activity_date": 1553518541, "creation_date": 1553518541, "answer_id": 55338311, "question_id": 55330951, "link": "https://stackoverflow.com/questions/55330951/evaluating-a-string-of-operations-but-code-does-not-work/55338311#55338311", "title": "Evaluating a string of operations but code does not work", "body": "<p>You're not far off something that works on your examples. Try this:</p>\n\n<pre><code>evalExpr :: String -&gt; Int\nevalExpr xs = foldl f (0 +) xs 0\n\nf :: (Int -&gt; Int) -&gt; Char -&gt; (Int -&gt; Int)\nf v ch | ch == '+' = (v 0 +)\n       | ch == '-' = (v 0 -)\n       | ch == ' ' = v\n       | otherwise = (v (read [ch] :: Int) +)\n</code></pre>\n\n<p>So the main difference to yours is that the accumulator in the fold is a function that takes in one Int and produces one Int, instead of just being an Int.</p>\n"}, {"tags": [], "owner": {"reputation": 1270, "user_id": 2383766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc13aeb9c9f89e097f48d815b81541d5?s=128&d=identicon&r=PG", "display_name": "Z-Y.L", "link": "https://stackoverflow.com/users/2383766/z-y-l"}, "is_accepted": false, "score": 1, "last_activity_date": 1553614327, "creation_date": 1553614327, "answer_id": 55360920, "question_id": 55330951, "link": "https://stackoverflow.com/questions/55330951/evaluating-a-string-of-operations-but-code-does-not-work/55360920#55360920", "title": "Evaluating a string of operations but code does not work", "body": "<p>You can do as @5ndG suggested. However, to evaluate a string of operations, using <code>parsec</code> is a better way. Here is an example for your case:</p>\n\n<pre><code>module EvalExpr where\n\n-- You need parsec to do parsing work, and the following are just example \n-- modes for your simple case.\nimport Text.Parsec\nimport Text.Parsec.Char\nimport Text.Parsec.String\n\n-- A data structure for your simple arithmetic expresssion\ndata Expr = Lit Int\n          | Plus Expr Expr\n          | Minus Expr Expr\n          deriving Show\n\n-- Evaluate an Expr to an integer number\neval :: Expr -&gt; Int\neval (Lit n) = n\neval (Plus e1 e2) = eval e1 + eval e2\neval (Minus e1 e2) = eval e1 - eval e2\n\n-- The following do the parsing work\n-- Parser for an integer number\nint :: Parser Expr\nint = Lit . read &lt;$&gt; (many1 digit &lt;* spaces)      -- A number may be followed by spaces\n\n-- Parser for operators \"Plus\" and \"Minus\"\nplus, minus :: Parser (Expr -&gt; Expr -&gt; Expr)\nplus = Plus &lt;$ char '+' &lt;* spaces\nminus = Minus &lt;$ char '-' &lt;* spaces\n\n-- Parser for Expr\nexpr :: Parser Expr\nexpr = chainl int (plus &lt;|&gt; minus) (Lit 0)\n\n-- Evalute string to an integer\nevalExpr :: String -&gt; Int\nevalExpr s = case parse expr \"\" s of\n               Left err -&gt; error $ show err\n               Right e  -&gt; eval e\n</code></pre>\n\n<p>The above is just an simple example of using <code>parsec</code>. If your actual case is more complex, you'll need more work to do. So learning to use <code>parsec</code> is necessary. The <a href=\"https://github.com/JakeWheat/intro_to_parsing\" rel=\"nofollow noreferrer\">intro_to_parsing</a> is a good start. Also in the <a href=\"http://hackage.haskell.org/package/parsec\" rel=\"nofollow noreferrer\">package description</a> are there some learning resources. </p>\n\n<p>By the way, <code>Text.Parsec.Expr</code> in <code>parsec</code> can parse an expression more conveniently, but above all, you need to know the basic of <code>parsec</code>. </p>\n\n<p>Happy learning!</p>\n"}], "owner": {"reputation": 29, "user_id": 11182553, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-9pOdw0Sb29E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3HK_pNB3RP3gZ_tpsZRS1ZfuCDA/mo/photo.jpg?sz=128", "display_name": "Lola Martinez", "link": "https://stackoverflow.com/users/11182553/lola-martinez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1553614327, "creation_date": 1553484905, "last_edit_date": 1553523520, "question_id": 55330951, "link": "https://stackoverflow.com/questions/55330951/evaluating-a-string-of-operations-but-code-does-not-work", "title": "Evaluating a string of operations but code does not work", "body": "<p>I need to write a code that evaluates a string of operations and outputs the resulting integer of that string. I wrote something but it's not working and would like some help. I need to use fold since it is easier but I'm sure what's wrong. This is on Haskell and using Emacs.</p>\n\n<pre><code>evalExpr :: String -&gt; Int\nevalExpr xs = foldl 0 xs where\n  f v x | x == \"+\" = (+) v\n        | x == \"-\" = (-) v\n        | x == \" \" = 0\n        | otherwise = read v :: Int\n</code></pre>\n\n<p>For example:</p>\n\n<p>evalExpr \"2+4+5-8\"</p>\n\n<p>the output should be: 3</p>\n\n<p>evalExpr \"\"</p>\n\n<p>the output should be: 0</p>\n\n<p>This is because it should read the string left to right.</p>\n"}, {"tags": ["haskell", "stream", "infinite", "self-reference", "interleave"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1553485069, "post_id": 55330709, "comment_id": 97387418, "body": "Exactly which part are you stuck on? Do you understand most of it except for the actual <code>ruler</code> definition, or do you need help with understanding the various other <code>streamXXX</code> functions as well?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1553518115, "post_id": 55330709, "comment_id": 97401445, "body": "Upvoted for being honest on the homework. No, ruler will not result in <code>0,1,0,1,...</code> since in such case <code>streamMap (+1) ruler</code> would be <code>1,2,1,2,...</code> and interleaving that with <code>0,0,0,...</code> does not result in <code>0,1,0,1,...</code>. It&#39;s more tricky. <code>0,1</code> looks the correct start, though. Try pretending that <code>ruler=0,1,x2,x3,x4,x5,...</code> for some unknowns <code>xi</code>, and try to infer what <code>x2</code> should be. Then, knowing <code>x2</code>, compute <code>x3</code>. And so on. You&#39;ll notice a pattern."}], "answers": [{"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 2, "last_activity_date": 1553546739, "creation_date": 1553546739, "answer_id": 55346151, "question_id": 55330709, "link": "https://stackoverflow.com/questions/55330709/implementing-the-ruler-function-using-streaminterleave/55346151#55346151", "title": "Implementing the ruler function using `streamInterleave`", "body": "<p>Firstly, we'll represent a <code>Stream</code> like this:</p>\n\n<pre><code>a1 a2 a3 a4 a5 ...\n</code></pre>\n\n<p>Now, let's take the definition of <code>ruler</code> apart:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>ruler :: Stream Integer\nruler = streamInterleave (streamRepeat 0) (streamMap (+1) ruler)\n</code></pre>\n\n<p>In Haskell, an important point is laziness; that is, stuff doesn't need to be evaluated until it needs to be. This is important here: it's what makes this infinitely recursive definition work. So how do we understand this? We'll start with the <code>streamRepeat 0</code> bit:</p>\n\n<pre><code>0 0 0 0 0 0 0 0 0 ...\n</code></pre>\n\n<p>Then this is fed into a <code>streamInterleave</code>, which interleave this the with (as yet unknown) stream from <code>streamMap (+1) ruler</code> (represented with <code>x</code>s):</p>\n\n<pre><code>0 x 0 x 0 x 0 x 0 x 0 x ...\n</code></pre>\n\n<p>Now we'll start filling in those <code>x</code>s. We know already that every second element of <code>ruler</code> is <code>0</code>, so every second element of <code>streamMap (+1) ruler</code> must be <code>1</code>:</p>\n\n<pre><code>  1   x   1   x   1   x   1   x   1   x ... &lt;--- the elements of (streamMap (+1) ruler)\n0 1 0 x 0 1 0 x 0 1 0 x 0 1 0 x 0 1 0 x ... &lt;--- the elements of ruler\n</code></pre>\n\n<p>Now we know every second element out of each group of four (so numbers 2,6,10,14,18,...) is <code>1</code>, so the corresponding elements of <code>streamMap (+1) ruler</code> must be <code>2</code>:</p>\n\n<pre><code>  1   2   1   x   1   2   1   x   1   2 ... &lt;--- the elements of (streamMap (+1) ruler)\n0 1 0 2 0 1 0 x 0 1 0 2 0 1 0 x 0 1 0 2 ... &lt;--- the elements of ruler\n</code></pre>\n\n<p>Now we know that every fourth element out of each group of eight (so numbers 4,12,20,...) is <code>2</code> so the corresponding elements of <code>streamMap (+1) ruler</code> must be <code>3</code>:</p>\n\n<pre><code>  1   2   1   3   1   2   1   x   1   2 ... &lt;--- the elements of (streamMap (+1) ruler)\n0 1 0 2 0 1 0 3 0 1 0 2 0 1 0 x 0 1 0 2 ... &lt;--- the elements of ruler\n</code></pre>\n\n<p>And we can continue building <code>ruler</code> like this <em>ad infinitum</em>, by substituting back each <code>n/2, 3n/2, 5n/2, ...</code> numbered value of <code>ruler</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1553587953, "last_edit_date": 1553587953, "creation_date": 1553552712, "answer_id": 55347279, "question_id": 55330709, "link": "https://stackoverflow.com/questions/55330709/implementing-the-ruler-function-using-streaminterleave/55347279#55347279", "title": "Implementing the ruler function using `streamInterleave`", "body": "<p>In Haskell notation, with <code>[]</code> in place of <code>Stream</code> (which <em>is</em> isomorphic to infinite lists),</p>\n\n<pre><code>ruler = interleave (repeat 0) \n                   (map (+1) ruler)\n\n[ruler !! i     | i &lt;- [0..]]     == concat . transpose $\n                                       [ repeat 0\n                                       , map (+1) ruler]\n</code></pre>\n\n<p>Splitting the <code>ruler</code> into two alternating sub-sequences to match, we get</p>\n\n<pre><code>[ruler !! 2*i   | i &lt;- [0..]]     == repeat 0\n                                  == [0 | i &lt;- [0..]]         -- {0} --\n\n[ruler !! 2*i+1 | i &lt;- [0..]]     == map (+1) ruler\n                                  == map (+1) $ concat . transpose $\n                                       [ [ruler !! 2*i   | i &lt;- [0..]]\n                                       , [ruler !! 2*i+1 | i &lt;- [0..]]]\nconcat . transpose $              == concat . transpose $\n [[ruler !! 2*i+1 | i &lt;- [0,2..]]      [ [1 | i &lt;- [0..]]\n ,[ruler !! 2*i+1 | i &lt;- [1,3..]]]     , [1 + ruler !! 2*i+1 | i &lt;- [0..]]]\n</code></pre>\n\n<p>Splitting again,</p>\n\n<pre><code>  [ruler !! 4*i+1 | i &lt;- [0..]]   == [1 | i &lt;- [0..]]         -- {1} --\n\n  [ruler !! 4*i+3 | i &lt;- [0..]]   == concat . transpose $\n                                       [ [1 + ruler !! 2*i+1 | i &lt;- [0,2..]]\n                                       , [1 + ruler !! 2*i+1 | i &lt;- [1,3..]]]\n</code></pre>\n\n<p>and again,</p>\n\n<pre><code>  [ruler !! 8*i+3 | i &lt;- [0..]]   == [2 | i &lt;- [0..]]         -- {2} --\n\n  [ruler !! 8*i+7 | i &lt;- [0..]]   == ....\n</code></pre>\n\n<p>You should be able to see it through from here:</p>\n\n<pre><code>      .... 16*i+7             .....   3                       -- {3} --\n      .... 32*i+15            .....   4                       -- {4} --\n      .... 64*i+31            .....\n      ....\n</code></pre>\n\n<p>Thus,</p>\n\n<pre><code>    ruler !! 2^(k+1)*i + 2^k - 1   ==   k    ,  k &lt;- [0..] ,  i &lt;- [0..]\n\n0: i =&gt; 2i\n1:      2i+1 =&gt; 4i+1\n2:              4i+3 =&gt; 8i+3\n3:                      8i+7 =&gt; 16i+7\n4:                              16i+15 =&gt; ....\n5:                                     \n</code></pre>\n"}], "owner": {"reputation": 355, "user_id": 3150464, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6994392ca8aa3dc2bc3cfbf83e02044e?s=128&d=identicon&r=PG&f=1", "display_name": "klabe", "link": "https://stackoverflow.com/users/3150464/klabe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 55346151, "answer_count": 2, "score": 1, "last_activity_date": 1553587953, "creation_date": 1553482656, "last_edit_date": 1553540911, "question_id": 55330709, "link": "https://stackoverflow.com/questions/55330709/implementing-the-ruler-function-using-streaminterleave", "title": "Implementing the ruler function using `streamInterleave`", "body": "<p>I am doing the homework of CIS 194. The problem is to implement the ruler function by using <code>streamInterleave</code>. The code looks like</p>\n\n<pre><code>data Stream a = Cons a (Stream a)\n\nstreamRepeat :: a -&gt; Stream a\nstreamRepeat x = Cons x (streamRepeat x)\n\nstreamMap :: (a -&gt; b) -&gt; Stream a -&gt; Stream b\nstreamMap f (Cons x xs) = Cons (f x) (streamMap f xs)\n\nstreamInterleave :: Stream a -&gt; Stream a -&gt; Stream a\nstreamInterleave (Cons x xs) ys = Cons x (streamInterleave ys xs)\n\nruler :: Stream Integer\nruler = streamInterleave (streamRepeat 0) (streamMap (+1) ruler)\n</code></pre>\n\n<p>I am really confused why ruler can be implemented like this. Is this going to give me <code>[0,1,0,1....]</code>?</p>\n\n<p>Any help will be greatly appreciated. Thank you!!</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 225, "user_id": 9494377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Don Klein", "link": "https://stackoverflow.com/users/9494377/don-klein"}, "edited": false, "score": 0, "creation_date": 1553503084, "post_id": 55330123, "comment_id": 97392924, "body": "Thanks @Koterpillar for the quick reply, it worked like charm!"}], "tags": [], "owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "is_accepted": true, "score": 1, "last_activity_date": 1553476405, "last_edit_date": 1553476405, "creation_date": 1553476098, "answer_id": 55330123, "question_id": 55330071, "link": "https://stackoverflow.com/questions/55330071/functional-dependency-and-weird-rigid-type-variable-errors/55330123#55330123", "title": "Functional dependency and weird rigid type variable errors", "body": "<p>When you're defining the <code>Foo (StateT s w)</code> instance, you aren't constraining <code>s</code> to be an <code>Int</code>, yet you want to return it from <code>bar</code>. How you're using the instance later doesn't matter, because the instance has to be valid on its own.</p>\n\n<p>Perhaps you want to define:</p>\n\n<pre><code>instance (MonadIO w) =&gt; Foo (StateT Int w) where\n    type Inner (StateT Int w) = w\n    bar current = do\n        a &lt;- get\n        return a\n</code></pre>\n\n<p><a href=\"https://repl.it/repls/UnusedExtrasmallDefinitions\" rel=\"nofollow noreferrer\">Here is your REPL with the modified definition</a>.</p>\n"}], "owner": {"reputation": 225, "user_id": 9494377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Don Klein", "link": "https://stackoverflow.com/users/9494377/don-klein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 55330123, "answer_count": 1, "score": 0, "last_activity_date": 1553476405, "creation_date": 1553475583, "question_id": 55330071, "link": "https://stackoverflow.com/questions/55330071/functional-dependency-and-weird-rigid-type-variable-errors", "title": "Functional dependency and weird rigid type variable errors", "body": "<p>I'm trying to figure out why the return type is not recognized in this code sample, see <a href=\"https://repl.it/@coodoo1/functional-dependency-error\" rel=\"nofollow noreferrer\">runnable code here</a>.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nmodule Test where\n\nimport Control.Monad.IO.Class\nimport Control.Monad\nimport Control.Monad.Except\nimport Control.Exception\nimport Data.Typeable\nimport Control.Monad.State.Lazy\n\nclass Foo m where\n  type Inner m :: * -&gt; *\n  bar :: Int -&gt; m Int\n\ninstance (MonadIO w, Show s, Num s) =&gt; Foo (StateT s w) where\n  bar current = do\n    a &lt;- get\n    return a -- error\n    -- return 24 -- ok\n\nprogram :: StateT Int IO String\nprogram = do\n      r &lt;- bar 42\n      liftIO $ putStrLn $ \"output= \" ++ (show r)\n      return $ \"ok\"\n\nrun :: IO ()\nrun = do\n  (a, s) &lt;- runStateT program $ 777\n  putStrLn $ (show a) ++ (show s)\n\n</code></pre>\n\n<p>and the error message was like below, in my case <code>MonadState s1 (StateT s1 m)</code> both <code>s1</code> should be <code>Int</code> hence I'm not sure why it's not allowed.</p>\n\n<pre><code>\u2022 Couldn't match type \u2018s\u2019 with \u2018Int\u2019\n    arising from a functional dependency between:\n      constraint \u2018MonadState Int (StateT s w)\u2019\n        arising from a use of \u2018get\u2019\n      instance \u2018MonadState s1 (StateT s1 m)\u2019 at &lt;no location info&gt;\n  \u2018s\u2019 is a rigid type variable bound by\n    the instance declaration\n    at fsm-try-5-3-q.hs:16:10-55\n\u2022 In a stmt of a 'do' block: a &lt;- get\n  In the expression:\n    do a &lt;- get\n       return a\n  In an equation for \u2018bar\u2019:\n      bar current\n        = do a &lt;- get\n             return a\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 4, "creation_date": 1553463683, "post_id": 55328827, "comment_id": 97383431, "body": "The type of both x and y are not the same.  Could you please explain what type you think <code>x</code> has and what type you think <code>y</code> has and why you think the type of <code>test3</code> says they are the same?"}, {"owner": {"reputation": 81, "user_id": 11252076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6db07d3d6c5ed9ed682d086bc4f62f?s=128&d=identicon&r=PG&f=1", "display_name": "csj", "link": "https://stackoverflow.com/users/11252076/csj"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1553463835, "post_id": 55328827, "comment_id": 97383477, "body": "Sorry to clarify I mean why in the solution are all the variables are a like for example shouldn&#39;t the third a in the solution be a b since it refers to the type of y?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1553464284, "post_id": 55328827, "comment_id": 97383587, "body": "The key insight is that <code>x</code> is applied to both <code>y</code> and <code>x y</code>, which means the argument type and the return type of <code>x</code> have to be the same."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 0, "creation_date": 1553464509, "post_id": 55328827, "comment_id": 97383651, "body": "@raytoal csj Said <code>x</code> and <code>y</code> have the same type, this indicates either sloppy phrasing or a misunderstanding so I asked for a clarification.  The type of <code>x</code> is a function <code>a -&gt; a</code> where as the type of <code>y</code> need not be, it is unrestrained <code>y :: a</code>.  Ah, a misunderstanding as is common in short text communication - no worries."}, {"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 0, "creation_date": 1553464551, "post_id": 55328827, "comment_id": 97383668, "body": "Got it, my bad."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 11252076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6db07d3d6c5ed9ed682d086bc4f62f?s=128&d=identicon&r=PG&f=1", "display_name": "csj", "link": "https://stackoverflow.com/users/11252076/csj"}, "edited": false, "score": 0, "creation_date": 1553464627, "post_id": 55328890, "comment_id": 97383685, "body": "Thank you for your help!!"}], "tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 20, "last_activity_date": 1553463974, "creation_date": 1553463974, "answer_id": 55328890, "question_id": 55328827, "link": "https://stackoverflow.com/questions/55328827/type-inference-in-haskell-for-functions/55328890#55328890", "title": "Type Inference in Haskell for functions", "body": "<p>This is quite an interesting exercise, actually. It doesn't require any Haskell-specific knowledge - it's really just basic logic.</p>\n\n<pre><code>test3 x y = x (x y)\n</code></pre>\n\n<p>The first thing to note is that <code>test3</code> takes 2 arguments (the <code>x</code> and <code>y</code>) and produces some kind of result. So the type must be of the form</p>\n\n<pre><code>a -&gt; b -&gt; c\n</code></pre>\n\n<p>and it only remains to figure out what <code>a</code>, <code>b</code> and <code>c</code> are, or at least what relations exist between them.</p>\n\n<p>So let's examine that result <code>x (x y)</code> in more detail. It tells us that <code>x</code> is a function which can take <code>y</code> as an argument. We have said that <code>y</code> has type <code>b</code> (which is a completely arbitrary name, but let's stick with it for now) - so <code>x</code> must be a function which takes a <code>b</code> and produces a result of some type. Let's call that type <code>d</code> for now. So we know that the type of <code>test3</code> is of the form</p>\n\n<pre><code>(b -&gt; d) -&gt; b -&gt; c\n</code></pre>\n\n<p>Finally, again from the expression <code>x (x y)</code>, we see that <code>x</code> must take the <code>x y</code> - which we've assigned the type <code>d</code> - and return a result. And this result is the overall result of <code>test3</code>, whose type we've chosen to call <code>c</code>. So, in the above, <code>x</code> - to which we've already assigned the type <code>b -&gt; d</code>, must have type <code>d -&gt; c</code>. The only way <code>b -&gt; d</code> can be equal to <code>d -&gt; c</code> is if <code>b</code>, <code>c</code> and <code>d</code> are all the same type. (Because the types of functions are determine by their input type and result type.) So the overall type of <code>test3</code> must be of the form</p>\n\n<pre><code>(b -&gt; b) -&gt; b -&gt; b\n</code></pre>\n\n<p>Which is exactly what you've been told it is - up to a renaming of <code>a</code> to <code>b</code>. (The names are, as I said, arbitrary anyway - so it's not relevant.)</p>\n"}], "owner": {"reputation": 81, "user_id": 11252076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6db07d3d6c5ed9ed682d086bc4f62f?s=128&d=identicon&r=PG&f=1", "display_name": "csj", "link": "https://stackoverflow.com/users/11252076/csj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1553463974, "creation_date": 1553463504, "last_edit_date": 1553463888, "question_id": 55328827, "link": "https://stackoverflow.com/questions/55328827/type-inference-in-haskell-for-functions", "title": "Type Inference in Haskell for functions", "body": "<p>I am doing practice problems for Haskell and one of the problems is</p>\n\n<pre><code>test3 x y = x (x y)\n</code></pre>\n\n<p>for which I have to find the type.</p>\n\n<p>The solution is </p>\n\n<pre><code>test3 :: (a -&gt; a) -&gt; a -&gt; a\n</code></pre>\n\n<p>I am not understanding why the variables in the solution are all a's instead of referring to x and y as two different variables like a and b. Could someone explain that and also go through how to find the type of this problem.</p>\n"}, {"tags": ["function", "haskell", "fold"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553462566, "post_id": 55328673, "comment_id": 97383165, "body": "Did you check the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:elemIndex\" rel=\"nofollow noreferrer\">documentation</a>? If the element occurs in the list, you get a <code>Just</code> value (holding the index of its first occurence), if it doesn&#39;t you get <code>Nothing</code>."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1553462681, "post_id": 55328673, "comment_id": 97383195, "body": "or if your comment was based on being unfamiliar with <code>Maybe</code> at all, see <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Maybe.html\" rel=\"nofollow noreferrer\">here</a> - or any of countless other good explanations online."}, {"owner": {"reputation": 83, "user_id": 10683263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ce74c450bb01ac8d2b919e3bedcead3?s=128&d=identicon&r=PG&f=1", "display_name": "wwww", "link": "https://stackoverflow.com/users/10683263/wwww"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553466929, "post_id": 55328673, "comment_id": 97384195, "body": "well.. I want to know how can I implement this with fold but I am not sure how to even try it because I don&#39;t know how to do the edge cases since there is a <code>Maybe</code>"}], "answers": [{"tags": [], "owner": {"reputation": 131, "user_id": 7343224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39bffe4dd05aecacff7ca6f99a304e69?s=128&d=identicon&r=PG&f=1", "display_name": "Eduardo Hidalgo", "link": "https://stackoverflow.com/users/7343224/eduardo-hidalgo"}, "is_accepted": false, "score": 1, "last_activity_date": 1553467330, "creation_date": 1553467330, "answer_id": 55329283, "question_id": 55328673, "link": "https://stackoverflow.com/questions/55328673/haskell-fold-implementation-of-elemindex/55329283#55329283", "title": "Haskell Fold implementation of `elemIndex`", "body": "<p>First question: </p>\n\n<blockquote>\n  <p>What does it mean?</p>\n</blockquote>\n\n<p>This means that the returned value is either an index (Int) or Nothing.</p>\n\n<p>from the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:elemIndex\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>The <strong>elemIndex</strong> function returns the index of the first element in the given list which is equal (by ==) to the query element, or <strong>Nothing</strong> if there is no such element.</p>\n</blockquote>\n\n<p>The second question:</p>\n\n<blockquote>\n  <p>How can I interpret this if I were to use folds?</p>\n</blockquote>\n\n<p>I'm not sure there is enough context to the \"were to use folds\" part. But, there are at least 2 ways to use this function:</p>\n\n<ol>\n<li>case analysis, were you state what to return in each case:</li>\n</ol>\n\n<pre class=\"lang-hs prettyprint-override\"><code>case elemIndex xs of                                                                                           \n  Just x -&gt; f x        -- apply function f to x.\n  Nothing -&gt; undefined -- do something here, e.g. give a default value.\n</code></pre>\n\n<ol start=\"2\">\n<li>use function <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Maybe.html#v:maybe\" rel=\"nofollow noreferrer\">maybe</a>:</li>\n</ol>\n\n<pre class=\"lang-hs prettyprint-override\"><code>maybe defaultValue f (elemIndex xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7404, "user_id": 491497, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e4aab95d9512cd6cd431b60fe00d974c?s=128&d=identicon&r=PG", "display_name": "Sagi", "link": "https://stackoverflow.com/users/491497/sagi"}, "is_accepted": false, "score": 1, "last_activity_date": 1553468785, "last_edit_date": 1553468785, "creation_date": 1553467388, "answer_id": 55329293, "question_id": 55328673, "link": "https://stackoverflow.com/questions/55328673/haskell-fold-implementation-of-elemindex/55329293#55329293", "title": "Haskell Fold implementation of `elemIndex`", "body": "<p><code>Maybe</code> is a sum type.<br/>\nSum type is any type that has multiple possible representations.<br/>\nFor example:<br/> </p>\n\n<p><code>data Bool = False | True</code><br/></p>\n\n<p><code>Bool</code> can represented as <code>True</code> or <code>False</code>. The same goes with Maybe.</p>\n\n<p><code>data  Maybe a = Nothing | Just a</code></p>\n\n<blockquote>\n  <p>The Maybe type encapsulates an optional value. <br/>A value of type Maybe a either contains a value of type a (represented as Just a), or it is empty (represented as Nothing)</p>\n</blockquote>\n\n<p><code>elemIndex :: Eq a =&gt; a -&gt; [a] -&gt; Maybe Int</code></p>\n\n<blockquote>\n  <p>The elemIndex function returns the index of the first element in the given list which is equal (by ==) to the query element, or Nothing if there is no such element.</p>\n</blockquote>\n\n<p>Lets compare it to the <code>indexOf</code> function<br/>\nWhat are the possible values of this method?</p>\n\n<ol>\n<li>The index of the element in the array in case it was found (lets say 2).</li>\n<li>-1 in case it was not found.</li>\n</ol>\n\n<p>Another way to represent it:<br/></p>\n\n<ol>\n<li>Return a number in case it was found - <code>Just 2</code>.<br/></li>\n<li>Instead of returning magic numbers like -1 we can return a value that represents the<br>\noption of a failure - <code>Nothing</code>.</li>\n</ol>\n\n<p>Regarding \"How can I interpret this if I were to use folds\", I do not have enough information to understand the question.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1553940123, "creation_date": 1553940123, "answer_id": 55430293, "question_id": 55328673, "link": "https://stackoverflow.com/questions/55328673/haskell-fold-implementation-of-elemindex/55430293#55430293", "title": "Haskell Fold implementation of `elemIndex`", "body": "<p><code>Maybe</code> is a type constructor.</p>\n\n<p><code>Int</code> is a type. <code>Maybe Int</code> is a type.</p>\n\n<p><code>String</code> is a type. <code>Maybe String</code> is a type.</p>\n\n<p>For any type <code>a</code>, <code>Maybe a</code> is a type. Its values come in two varieties: either <code>Nothing</code> or <code>Just x</code> where <code>x</code> is a value of type <code>a</code> (we write: <code>x :: a</code>):</p>\n\n<pre><code>       x :: a\n  -----------------                ------------------\n  Just x :: Maybe a                Nothing :: Maybe a\n</code></pre>\n\n<p>In the first rule, the <code>a</code> in both the type of the value <code>x :: a</code> and the type of the value <code>Just x :: Maybe a</code> is the same. Thus if we know the type of <code>x</code> we know the type of <code>Just x</code>; and vice versa.</p>\n\n<p>In the second rule, nothing in the value <code>Nothing</code> itself determines the <code>a</code> in its type. The determination will be made according to how that value is <em>used</em>, i.e. from the context of its usage, from its call site.</p>\n\n<p>As to the fold implementation of <code>elemIndex</code>, it could be for example</p>\n\n<pre><code>elemIndex_asFold :: Eq a =&gt; a -&gt; [a] -&gt; Maybe Int\nelemIndex_asFold x0 = foldr g Nothing \n    where\n    g x r | x == x0 = Just x\n          | else    = r\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 10683263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ce74c450bb01ac8d2b919e3bedcead3?s=128&d=identicon&r=PG&f=1", "display_name": "wwww", "link": "https://stackoverflow.com/users/10683263/wwww"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 549, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1553940123, "creation_date": 1553462287, "last_edit_date": 1553939878, "question_id": 55328673, "link": "https://stackoverflow.com/questions/55328673/haskell-fold-implementation-of-elemindex", "title": "Haskell Fold implementation of `elemIndex`", "body": "<p>I am looking at Haskell <code>elemIndex</code> function:</p>\n\n<pre><code>elemIndex :: Eq a =&gt; a -&gt; [a] -&gt; Maybe Int\n</code></pre>\n\n<p>What does <code>Maybe</code> mean in this definition? Sometimes when I call it, the output has a <code>Just</code> or a <code>Nothing</code> What does it mean? How can I interpret this if I were to use folds?</p>\n"}, {"tags": ["function", "haskell", "functional-programming", "refactoring", "fold"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 8, "creation_date": 1553453637, "post_id": 55327293, "comment_id": 97380616, "body": "You should post your attempt at using folds, and explain the issues you met."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1553675715, "post_id": 55327293, "comment_id": 97467854, "body": "Welcome to SO. If one of the answers below fixes your issue, you should accept it (click the check mark next to the appropriate answer). That does two things. It lets everyone know your issue has been resolved, and it gives the person that helps you credit for the assist. See <a href=\"https://meta.stackexchange.com/a/5235/187716\">here</a> for a full explanation. (<a href=\"https://meta.stackexchange.com/q/135493/172601\">ref</a>)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1553940198, "post_id": 55327293, "comment_id": 97578508, "body": "Have you had a chance to look into the links I provided in the above comment? By not accepting answers you keep the questions open, signal to the community that those questions are still unresolved. Are they, still? If so, why no follow-up questions or requests for clarification in the comments?"}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553675508, "post_id": 55328026, "comment_id": 97467769, "body": "<i>Inductive programming FTW!</i> --- &quot;have to inspect the last element of the current RLE&quot; last <i>is</i> first, just looking in the <i>reversed</i> direction... :)"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 8, "last_activity_date": 1553457758, "creation_date": 1553457758, "answer_id": 55328026, "question_id": 55327293, "link": "https://stackoverflow.com/questions/55327293/folds-implementation-in-haskell/55328026#55328026", "title": "Folds implementation in Haskell", "body": "<p>Think of a fold as taking a list of terms:</p>\n\n<pre><code>[a,b,c,d]\n</code></pre>\n\n<p>and adding an initial value <code>zz</code> and binary operator <code>&lt;+&gt;</code> between the terms:</p>\n\n<pre><code>foldl (&lt;+&gt;) zz [a,b,c,d] = (((zz &lt;+&gt; a) &lt;+&gt; b) &lt;+&gt; c) &lt;+&gt; d\nfoldr (&lt;+&gt;) zz [a,b,c,d] = a &lt;+&gt; (b &lt;+&gt; (c &lt;+&gt; (d &lt;+&gt; zz)))\n</code></pre>\n\n<p>Note that the initial value is also the value the fold will have when applied to an empty list, so that's usually easy to figure out.  The hard part is defining the appropriate binary operator.</p>\n\n<p>So, to express <code>runLengthEncode</code> as right fold, you need:</p>\n\n<pre><code>'a' &lt;+&gt; ('a' &lt;+&gt; ('a' &lt;+&gt; ('b' &lt;+&gt; zz))) = [(3,'a'),(1,'b')]\n</code></pre>\n\n<p>for an operator <code>&lt;+&gt;</code> and some initial value <code>zz</code>.</p>\n\n<p>We can easily \"solve\" for <code>zz</code> because we know that <code>runLengthEncode [] = []</code>, so <code>zz = []</code>.  We need to define <code>&lt;+&gt;</code> so that it satifies equations derived from the example above (working right to left) like:</p>\n\n<pre><code>'b' &lt;+&gt; [] = [(1, 'b')]\n'a' &lt;+&gt; [(1, 'b')] = [(1, 'a'), (1, 'b')]\n'a' &lt;+&gt; [(1, 'a'), (1, 'b')] = [(2, 'a'), (1, 'b')]\n'a' &lt;+&gt; [(2, 'a'), (1, 'b')] = [(3, 'a'), (1, 'b')]\n</code></pre>\n\n<p>Defining such an operator is actually pretty easy:</p>\n\n<pre><code>(&lt;+&gt;) :: Char -&gt; [(Int, Char)] -&gt; [(Int, Char)]\nx &lt;+&gt; ((n, y) : rest) | x == y = ((n+1), y) : rest\nx &lt;+&gt; rest                     = (1, x) : rest\n</code></pre>\n\n<p>so we get:</p>\n\n<pre><code>runLengthEncode' :: String -&gt; [(Int,Char)]\nrunLengthEncode' = foldr (&lt;+&gt;) []\n</code></pre>\n\n<p>Try doing this with a left fold, too:</p>\n\n<pre><code>(((zz + 'a') &lt;+&gt; 'a') &lt;+&gt; 'a') &lt;+&gt; 'b' =&gt;  [(3,'a'),(1,'b')]\n</code></pre>\n\n<p>You'll find that when it comes time to define <code>&lt;+&gt;</code>, you have to inspect the <em>last</em> element of the current RLE instead of the first.  It can be done, of course, but it's slightly less natural, which is why I used a right fold above.</p>\n\n<p>For <code>runLengthDecode</code>, it's the same business:</p>\n\n<pre><code>(1, 'h') &lt;+&gt; ((5, 'i') &lt;+&gt; zz) = \"hiiiii\"\n</code></pre>\n\n<p>Again, determine what <code>zz</code> should be.  Then, figure out how you write a binary operator to solve:</p>\n\n<pre><code>(5, 'i') &lt;+&gt; zz = \"iiiii\"\n(1, 'h') &lt;+&gt; \"iiiii\" = \"hiiiii\"\n</code></pre>\n\n<p><strong>Spoilers follow...</strong></p>\n\n<p>Of course, you don't actually need to use an operator syntax, so a full solution would look like:</p>\n\n<pre><code>runLengthEncode'' :: String -&gt; [(Int,Char)]\nrunLengthEncode'' = foldr step []\n  where step x ((n, y) : rest) | x == y = ((n+1), y) : rest\n        step x rest                     = (1, x) : rest\n\nrunLengthDecode'' :: [(Int,Char)] -&gt; String\nrunLengthDecode'' = foldr step \"\"\n  where step (n, x) str = replicate n x ++ str\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 10683263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ce74c450bb01ac8d2b919e3bedcead3?s=128&d=identicon&r=PG&f=1", "display_name": "wwww", "link": "https://stackoverflow.com/users/10683263/wwww"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 760, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1553673132, "creation_date": 1553453355, "last_edit_date": 1553673132, "question_id": 55327293, "link": "https://stackoverflow.com/questions/55327293/folds-implementation-in-haskell", "title": "Folds implementation in Haskell", "body": "<p>I am having LOTS of problem trying to understand folds implementation on Haskell. I need to have two functions using fold that have this output</p>\n\n<pre><code>&gt; runLengthEncode \"aaaaaaabbb\"\n[(7,'a'),(3,'b')]\n&gt; runLengthDecode [(1,'h'), (5,'i')]\n\"hiiiii\"\n</code></pre>\n\n<p>So what I did is to write the function first as I would do with pattern matching (they work), but now I do not know how to \"translate\" that using either fold left or fold right. </p>\n\n<pre><code>runLengthEncode :: String -&gt; [(Int,Char)]\nrunLengthEncode [] = []\nrunLengthEncode (x:xs) = runLengthEncode 1 x xs\n    where\n        runLengthEncode n x [] = [(n,x)]\n        runLengthEncode n x (y:ys) | x == y = runLengthEncode (n + 1) y ys\n                                   | otherwise = (n,x) : runLengthEncode 1 y ys\n\nrunLengthDecode :: [(Int,Char)] -&gt; String\nrunLengthDecode [] = []\nrunLengthDecode ((a,b):xs) = replicate a b ++ (runLengthDecode xs)\n</code></pre>\n"}, {"tags": ["haskell", "monad-transformers"], "comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1553450590, "post_id": 55326763, "comment_id": 97379681, "body": "MonadMask isn&#39;t a monad or monad transformer like Either(T), Maybe(T), etc. It&#39;s a typeclass, like Monad itself, MonadFail, etc."}, {"owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1553450838, "post_id": 55326763, "comment_id": 97379754, "body": "So I used another function which had a typeconstraint of MonadIO m , so that would mean m has the the type IO or part of a stack which has IO right ?   Isnt it the same case for MonadMask ?"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1553450948, "post_id": 55326763, "comment_id": 97379780, "body": "Yes, MonadIO is a typeclass just like MonadMask is. Note that MonadIO and IO are not the same thing, though, and the latter is not a typeclass."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1553451090, "post_id": 55326763, "comment_id": 97379831, "body": "@TanmayBhattacharya Is <code>KakfaP</code> a type synonym, or is it defined using a newtype?"}, {"owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1553455209, "post_id": 55326763, "comment_id": 97381131, "body": "@danidiaz it is defined as a newtype"}, {"owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1553455248, "post_id": 55326763, "comment_id": 97381143, "body": "@JosephSible Iam still confused as to the difference between the two"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1553460814, "post_id": 55326763, "comment_id": 97382703, "body": "<code>IO</code> is a type (well, type constructor, anyway). <code>MonadIO</code> and <code>MonadMask</code> are both type classes for which there are <code>IO</code> instances defined. (<code>instance MonadIO IO where ...</code> and <code>instance MonadMask IO where ... </code>)"}], "answers": [{"comments": [{"owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "edited": false, "score": 0, "creation_date": 1553515300, "post_id": 55328825, "comment_id": 97399785, "body": "Thanks a lot for a well explained answer. I implemented the changes , and have added the code . Just wanted to understand , why is the composition operator needed for the clProducer and runHandler  and not for mkProducer , as all three functions are returning values wrapped in Config.KafkaP . I have mentioned the types of the functions called ,and what I think are the types for the variables in the let statment"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "edited": false, "score": 0, "creation_date": 1553540672, "post_id": 55328825, "comment_id": 97414335, "body": "@TanmayBhattacharya <code>mkProducer</code> has type <code>Config.KafkaP x</code>, so the newtype can be unwrapped directly. <code>clProducer</code>  and <code>runHandler</code> are <i>functions</i> of the form <code>x -&gt; Config.KafkaP y</code>. Here what we must unwrap is the <i>return value</i> of the function. And working over the return value of a function with another function is exactly what function composition does."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "edited": false, "score": 0, "creation_date": 1553540941, "post_id": 55328825, "comment_id": 97414466, "body": "@TanmayBhattacharya In case you want to define your own <code>MonadMask</code> instance for <code>KafkaP</code>, the <code>GeneralisedNewtypeDeriving</code> extension can be helpful. It lets you auto-derive typeclass instances for your newtype, by &quot;piggybacking&quot; on already existing instances of the wrapped type. <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#generalised-derived-instances-for-newtypes\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 1, "last_activity_date": 1553540490, "last_edit_date": 1553540490, "creation_date": 1553463493, "answer_id": 55328825, "question_id": 55326763, "link": "https://stackoverflow.com/questions/55326763/how-to-add-mask-to-a-monadic-stack/55328825#55328825", "title": "How to add Mask to a monadic stack", "body": "<p>If you were using the type <code>ReaderT ProducerConfig IO a</code> directly, there wouldn't be a problem, because the <a href=\"http://hackage.haskell.org/package/exceptions\" rel=\"nofollow noreferrer\">exceptions</a> package provides an instance</p>\n\n<blockquote>\n  <p>MonadMask IO</p>\n</blockquote>\n\n<p>That says you can use <code>bracket</code> with <code>IO</code>, and another instance </p>\n\n<blockquote>\n  <p>MonadMask m => MonadMask (ReaderT r m)</p>\n</blockquote>\n\n<p>That says that if the base monad is an instance of <code>MonadMask</code>, then <code>ReaderT</code> over that monad is also an instance of <code>MonadMask</code>.</p>\n\n<p>Notice that <code>MonadMask</code> is not a transformer that is part of the monad stack. Instead, it is a constraint that says \"this monad stack supports masking / bracketing operations\".</p>\n\n<hr>\n\n<p>If you were using a <a href=\"https://wiki.haskell.org/Type_synonym\" rel=\"nofollow noreferrer\">type synonym</a> like</p>\n\n<pre><code>type KafkaP a = ReaderT ProducerConfig IO a\n</code></pre>\n\n<p>there wouldn't be a problem either, because type synonyms don't create a new type, they just give an alias to an exiting one. One can still make use of all the existing typeclass instances for the type.</p>\n\n<hr>\n\n<p>You mention in the comments that <code>KafkaP</code> is a newtype. A newtype is a cheap way of creating, well, a <em>new type</em> out of another. It's basically a constructor that holds a value of the original type.</p>\n\n<p>And that's the problem. Because it is a new type, it doesn't share automatically all the typeclass instances of the old one. In fact, having <em>different</em> typeclass instances in newtypes is one of the main motivations for using newtypes!</p>\n\n<p>What can be done? Well, supposing the newtype constructor is exported (sometimes they are hidden for purposes of encapsulation) you could unwrap the <code>KafkaP</code>s actions into <code>ReaderT ProducerConfig IO a</code> before sending them into <code>bracket</code>, and then re-wrap the result into <code>KafkaP</code> again. Some of the parameters are <code>KafkaP</code>-returning functions, so you'll probably need to throw in some function composition as well. Perhaps something like (assuming <code>KafkaP</code> is the name of the constructor, and <code>runKafkaP</code> the name of the corresponding accessor):</p>\n\n<pre><code>KafkaP $ bracket (runKafkaP mkProducer) (runKafkaP . clProducer) (runKafkaP . runHandler)\n</code></pre>\n\n<p>All this wrapping and unwrapping is tedious; sometimes using <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Coerce.html\" rel=\"nofollow noreferrer\"><code>coerce</code></a> from <code>Data.Coerce</code> can help. But this only works when the newtype constructor is exported.</p>\n\n<hr>\n\n<p>You might also think of defining your own <code>MonadMask</code> instance for <code>KafkaP</code> using the technique above. This can be done, but instances which are defined neither in the module that defines the typeclass nor in the module that defines the type are called <a href=\"https://wiki.haskell.org/Orphan_instance\" rel=\"nofollow noreferrer\">orphan instances</a> and are somewhat frowned upon.</p>\n"}], "owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 55328825, "answer_count": 1, "score": 0, "last_activity_date": 1553540490, "creation_date": 1553450000, "last_edit_date": 1553514758, "question_id": 55326763, "link": "https://stackoverflow.com/questions/55326763/how-to-add-mask-to-a-monadic-stack", "title": "How to add Mask to a monadic stack", "body": "<p>I am trying to use the bracket function from Exception.Safe Package which has a return type of </p>\n\n<pre><code>forall m a b c. MonadMask m =&gt; m a -&gt; (a -&gt; m b) -&gt; (a -&gt; m c) -&gt; m c\n</code></pre>\n\n<p>This implies that my monad stack must have the Mask monad added to the stack ? \nMy calling function looks like this </p>\n\n<pre><code>sendMessage :: String -&gt; Config.KafkaP (Either KafkaError ())\nsendMessage msg=do\n      getProperties &lt;- producerProps\n      let\n        mkProducer =  newProducer getProperties\n        clProducer (Left _)     = return ()\n        clProducer (Right prod) = closeProducer prod\n        runHandler (Left err)   = return $ Left err\n        runHandler (Right prod) = messageSender prod msg\n      res &lt;- bracket mkProducer clProducer runHandler\n      return res\n</code></pre>\n\n<p>And config.KakfaP has the type </p>\n\n<pre><code>ReaderT ProducerConfig IO a\n</code></pre>\n\n<p>And the error I get is ,</p>\n\n<pre><code>No instance for (exceptions-0.10.0:Control.Monad.Catch.MonadMask\n                         Config.KafkaP)\n        arising from a use of \u2018bracket\u2019\n</code></pre>\n\n<p>Does this mean the monad stack needs to be something like this </p>\n\n<pre><code>Mask (ReaderT ProducerConfig IO a) \n</code></pre>\n\n<p>Ideally I would want the function to return what the run Handler returns which is Config.KafkaP (Either KafkaError ()) ,or anything more robust . </p>\n\n<p>Adding a solution based on an answer</p>\n\n<pre><code>sendMessage :: String -&gt; Config.KafkaP (Either KafkaError ())\nsendMessage msg=do\n      getProperties &lt;- producerProps\n      let\n        mkProducer =  newProducer getProperties  \n        --newProducer :: MonadIO m =&gt; ProducerProperties -&gt; m (Either KafkaError KafkaProducer)\n        --mkProducer :: Config.KafkaP (Either KafkaError KafkaProducer)\n        clProducer (Left _)     = return ()\n        clProducer (Right prod) = closeProducer prod\n        --closeProducer :: MonadIO m =&gt; KafkaProducer -&gt; m ()\n        --clProducer :: Config.KafkaP (Either () ())  -- ?? \n        runHandler (Left err)   = return $ Left err\n        runHandler (Right prod) = messageSender prod msg\n        --messageSender :: KafkaProducer -&gt; String -&gt; Config.KafkaP (Either KafkaError ())\n        --runHandler :: Config.KafkaP (Either KafkaError ()) -- ?? \n      Config.KafkaP $ bracket (Config.runK  mkProducer) (Config.runK .clProducer) (Config.runK .runHandler)\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "haskell-platform", "cabal-new"], "comments": [{"owner": {"reputation": 944, "user_id": 49554, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/02c8ecc24181d171df85a26458b9cd5f?s=128&d=identicon&r=PG", "display_name": "jneira", "link": "https://stackoverflow.com/users/49554/jneira"}, "edited": false, "score": 0, "creation_date": 1553445078, "post_id": 55325764, "comment_id": 97377919, "body": "Supposing you are in windows, what version and what console are you using?"}, {"owner": {"reputation": 71, "user_id": 6469329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b8d6acdd717026e6b7d3464b1852753?s=128&d=identicon&r=PG&f=1", "display_name": "mathguy", "link": "https://stackoverflow.com/users/6469329/mathguy"}, "reply_to_user": {"reputation": 944, "user_id": 49554, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/02c8ecc24181d171df85a26458b9cd5f?s=128&d=identicon&r=PG", "display_name": "jneira", "link": "https://stackoverflow.com/users/49554/jneira"}, "edited": false, "score": 0, "creation_date": 1553445189, "post_id": 55325764, "comment_id": 97377975, "body": "windows 8 with cabal version 2.4.1.0 and ghc version 8.6.3 using the cmd"}, {"owner": {"reputation": 71, "user_id": 6469329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b8d6acdd717026e6b7d3464b1852753?s=128&d=identicon&r=PG&f=1", "display_name": "mathguy", "link": "https://stackoverflow.com/users/6469329/mathguy"}, "reply_to_user": {"reputation": 944, "user_id": 49554, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/02c8ecc24181d171df85a26458b9cd5f?s=128&d=identicon&r=PG", "display_name": "jneira", "link": "https://stackoverflow.com/users/49554/jneira"}, "edited": false, "score": 0, "creation_date": 1553445654, "post_id": 55325764, "comment_id": 97378142, "body": "Not sure what is going on. saw this video too <a href=\"https://www.youtube.com/watch?v=a7R-2vtPLDM&amp;t=272s\" rel=\"nofollow noreferrer\">youtube.com/watch?v=a7R-2vtPLDM&amp;t=272s</a> and followed the steps it still didnot work"}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 5, "last_activity_date": 1553445750, "creation_date": 1553445750, "answer_id": 55326101, "question_id": 55325764, "link": "https://stackoverflow.com/questions/55325764/build-fails-with-simple-haskell-library-with-cabal-new-build-with-ghc-8-6-3/55326101#55326101", "title": "Build fails with simple Haskell library with cabal new-build with GHC 8.6.3", "body": "<p>GHC 8.6.3 on Windows suffers from a <a href=\"https://gitlab.haskell.org/ghc/ghc/issues/16057\" rel=\"noreferrer\">bug</a> that makes it pretty much unusable. The issue should be <a href=\"https://www.haskell.org/ghc/download_ghc_8_6_4.html#binaries\" rel=\"noreferrer\">solved</a> in 8.6.4.</p>\n"}], "owner": {"reputation": 71, "user_id": 6469329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b8d6acdd717026e6b7d3464b1852753?s=128&d=identicon&r=PG&f=1", "display_name": "mathguy", "link": "https://stackoverflow.com/users/6469329/mathguy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 55326101, "answer_count": 1, "score": 0, "last_activity_date": 1565474095, "creation_date": 1553443689, "last_edit_date": 1565474095, "question_id": 55325764, "link": "https://stackoverflow.com/questions/55325764/build-fails-with-simple-haskell-library-with-cabal-new-build-with-ghc-8-6-3", "title": "Build fails with simple Haskell library with cabal new-build with GHC 8.6.3", "body": "<p>Trying to build a Simple library with Haskell.\nIt worked once and then just stopped working(weirdly)</p>\n\n<p>only a few commands were run,\na simple cabal init with only library</p>\n\n<p>then the following library was added</p>\n\n<p>Greet.hs</p>\n\n<pre><code>module Greet where\n\n\ngreeet s = \"Hey, \" ++ s\n</code></pre>\n\n<p>then cabal new-build was run and then cabal new-repl</p>\n\n<p>the error is as follows</p>\n\n<pre><code>Build profile: -w ghc-8.6.3 -O1\nIn order, the following will be built (use -v for more details):\n - HaskellTry-0.1.0.0 (lib) (ephemeral targets)\nPreprocessing library for HaskellTry-0.1.0.0..\nGHCi, version 8.6.3: http://www.haskell.org/ghc/  :? for help\nOk, one module loaded.\nPrelude Greet&gt; greeet \"h\"\n\"\n</code></pre>\n\n<p>everything is just stuck after that.</p>\n"}, {"tags": ["haskell", "recursion", "haskell-platform"], "answers": [{"comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1553447562, "post_id": 55326346, "comment_id": 97378768, "body": "Note that <code>subString&#39; &quot;&quot;</code> will crash your entire program with a non-exhaustive patterns error."}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1553447586, "post_id": 55326346, "comment_id": 97378774, "body": "@JosephSible True but easy to fix if he wants."}, {"owner": {"reputation": 31, "user_id": 9806307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8262db9d8252fd0fcb323949d69462d5?s=128&d=identicon&r=PG&f=1", "display_name": "RottenCrusader", "link": "https://stackoverflow.com/users/9806307/rottencrusader"}, "edited": false, "score": 0, "creation_date": 1553448042, "post_id": 55326346, "comment_id": 97378898, "body": "Thanks for the quick answer!"}, {"owner": {"reputation": 31, "user_id": 9806307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8262db9d8252fd0fcb323949d69462d5?s=128&d=identicon&r=PG&f=1", "display_name": "RottenCrusader", "link": "https://stackoverflow.com/users/9806307/rottencrusader"}, "edited": false, "score": 0, "creation_date": 1553449284, "post_id": 55326346, "comment_id": 97379292, "body": "@Elmex80s could you furtherly elaborate how the code works?I am having problems understanding it because i am new to haskell. I am assuming that it is something like the answer below given by JosephSible but im having troubles understanding its logic.Thanks again in advance!"}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1553468400, "post_id": 55326346, "comment_id": 97384504, "body": "here it is for you"}], "tags": [], "owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "is_accepted": true, "score": 1, "last_activity_date": 1553468390, "last_edit_date": 1553468390, "creation_date": 1553447374, "answer_id": 55326346, "question_id": 55325380, "link": "https://stackoverflow.com/questions/55325380/splitting-a-word-in-all-possible-subwords-all-possible-combinations-w-o-import/55326346#55326346", "title": "Splitting a word in all possible &quot;Subwords&quot;-All possible combinations W/O imports", "body": "<p>Recursion is here to help. Say we have a non-empty list <code>x : xs</code>. We want to know <code>subString (x : xs)</code>. We apply our solution recursively to <code>xs</code>, so <code>subString xs</code> is a list of all solutions for <code>xs</code>. However we still have that single <code>x</code>. There are exactly two ways to bring back <code>x</code> in the solution for <code>x : xs</code> which covers for the entire solution set of <code>subString (x : xs)</code>:</p>\n\n<ul>\n<li>Bring <code>x</code> back <em>without</em> attaching it to its neighbor. If we have <code>x : xs = \"Bang\"</code> then <code>x</code> will be <code>'B'</code> and <code>xs</code> will be <code>\"ang\"</code> and <code>subString \"ang\"</code> will be <code>[[\"ang\"],[\"an\",\"g\"],[\"a\",\"ng\"],[\"a\",\"n\",\"g\"]]</code>. This is done by <code>[[x] : u | u &lt;- subString xs]</code>. Here <code>u</code> is a list of Strings, for example <code>[\"a\",\"ng\"]</code>. As <code>x</code> is a character we must turn it to a String, this is done by <code>[x]</code>, attaching it to the head of the list goes by <code>[x] : u</code>, so <code>[\"B\",\"a\",\"ng\"]</code>. The list comprehension will do it for all elements in <code>subString xs</code>.  </li>\n<li>Bring <code>x</code> back attaching it to its neighbors. An arbitrary solution of <code>subString xs</code> will look like <code>u : us</code>. We want to attach <code>x</code> to the first element of <code>u : us</code> which is <code>u</code>. So <code>x : u</code>. For example <code>u : us = [\"a\",\"n\",\"g\"]</code> so <code>u</code> will be <code>\"a\"</code> and <code>us</code> will be <code>[\"n\",\"g\"]</code>. Attaching <code>'B'</code> to <code>\"a\"</code> is done by <code>'B' : \"a\"</code> and will give <code>\"Ba\"</code>. We have to put <code>\"Ba</code> back in the list so <code>(x : u) : us</code>. The list comp[rehension looks like <code>[(x : u) : us | (u : us) &lt;- subString xs]</code>.</li>\n</ul>\n\n<p>We are still left with the case of a String of a single character. We write <code>[x]</code> for that where <code>x</code> is the single character. So <code>subString [x]</code> will be <code>[[[x]]]</code>. </p>\n\n<p>We have to join the solutions together so </p>\n\n<pre><code>subString :: String -&gt; [[String]]\nsubString   [x]    = [[[x]]]\nsubString (x : xs) = [(x : u) : us | (u : us) &lt;- subString xs] ++ [[x] : u | u &lt;- subString xs]\n</code></pre>\n\n<p>Example</p>\n\n<pre><code>*Main&gt; subString \"Bang\"\n[[\"Bang\"],[\"Ban\",\"g\"],[\"Ba\",\"ng\"],[\"Ba\",\"n\",\"g\"],[\"B\",\"ang\"],[\"B\",\"an\",\"g\"],[\"B\",\"a\",\"ng\"],[\"B\",\"a\",\"n\",\"g\"]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 9806307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8262db9d8252fd0fcb323949d69462d5?s=128&d=identicon&r=PG&f=1", "display_name": "RottenCrusader", "link": "https://stackoverflow.com/users/9806307/rottencrusader"}, "edited": false, "score": 0, "creation_date": 1553448022, "post_id": 55326349, "comment_id": 97378889, "body": "Thanks! Works like a charm but i accepted the 1st answer just for the sake of being the 1st.Thanks alot though really!"}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "reply_to_user": {"reputation": 31, "user_id": 9806307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8262db9d8252fd0fcb323949d69462d5?s=128&d=identicon&r=PG&f=1", "display_name": "RottenCrusader", "link": "https://stackoverflow.com/users/9806307/rottencrusader"}, "edited": false, "score": 0, "creation_date": 1553448148, "post_id": 55326349, "comment_id": 97378932, "body": "@rempakos You can give +1 to answers if you think it is worth it, even if you do not accept it as <i>the</i> answer."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1553448204, "post_id": 55326349, "comment_id": 97378951, "body": "@Elmex80s You need 15 rep to upvote, which rempakos doesn&#39;t have yet."}, {"owner": {"reputation": 31, "user_id": 9806307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8262db9d8252fd0fcb323949d69462d5?s=128&d=identicon&r=PG&f=1", "display_name": "RottenCrusader", "link": "https://stackoverflow.com/users/9806307/rottencrusader"}, "edited": false, "score": 0, "creation_date": 1553448340, "post_id": 55326349, "comment_id": 97378998, "body": "I tried upvoting but it didn&#39;t let me because i don&#39;t have the rep, but ill visit back and upvote if i reach that number!Thanks again!"}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 2, "last_activity_date": 1557792818, "last_edit_date": 1557792818, "creation_date": 1553447388, "answer_id": 55326349, "question_id": 55325380, "link": "https://stackoverflow.com/questions/55325380/splitting-a-word-in-all-possible-subwords-all-possible-combinations-w-o-import/55326349#55326349", "title": "Splitting a word in all possible &quot;Subwords&quot;-All possible combinations W/O imports", "body": "<p>Note that the type signature of your attempt is wrong. You want all of the combinations of subword splits, which is a list of list of strings, but your type is just a list of list of strings.</p>\n\n<p>This will work:</p>\n\n<pre><code>onHead :: (a -&gt; a) -&gt; [a] -&gt; [a]\nonHead _ [] = []\nonHead f (x:xs) = f x:xs\n\ncombos :: [a] -&gt; [[[a]]]\ncombos [] = [[]]\ncombos [x] = [[[x]]]\ncombos (x:xs) = [([x]:), onHead (x:)] &lt;*&gt; combos xs\n</code></pre>\n\n<p><code>onHead</code> should be self-explanatory: perform the given function on the head of a list. <code>combos</code> recurses as follows: the subwords of a string are the subwords of its tail, with two possibilities for each: either the head is its own subword, or it's tacked onto the beginning of the first subword.</p>\n\n<hr>\n\n<p>Update: Here's another (IMO cleaner) approach:</p>\n\n<pre><code>combos :: Foldable t =&gt; t a -&gt; [[[a]]]\ncombos = foldr (concatMap . go) [[]]\n  where go x l = ([x]:l):case l of\n          [] -&gt; []\n          h:t -&gt; [(x:h):t]\n</code></pre>\n\n<p>It's using the same technique as above, just with a cleaner implementation.</p>\n"}], "owner": {"reputation": 31, "user_id": 9806307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8262db9d8252fd0fcb323949d69462d5?s=128&d=identicon&r=PG&f=1", "display_name": "RottenCrusader", "link": "https://stackoverflow.com/users/9806307/rottencrusader"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 1, "closed_date": 1553485802, "accepted_answer_id": 55326346, "answer_count": 2, "score": 2, "last_activity_date": 1557792818, "creation_date": 1553441352, "question_id": 55325380, "link": "https://stackoverflow.com/questions/55325380/splitting-a-word-in-all-possible-subwords-all-possible-combinations-w-o-import", "closed_reason": "Duplicate", "title": "Splitting a word in all possible &quot;Subwords&quot;-All possible combinations W/O imports", "body": "<p>I am trying to get all the possible combinations of a word in the following manner WITHOUT using any imports:</p>\n\n<p>For example...</p>\n\n<pre><code>    Input: Bang\n\n    Output: [['B','ang'], ['Ba','ng'], ['Ban','g'], ['B','a','ng'], ['B','an','g'], ['Ba','n','g'], ['B','a','n','g']]\n</code></pre>\n\n<p>This problem has been bothering me for some time and i can't seem to figure out an algorithm to do this..</p>\n\n<p>The code below is what i've done but this gives all the possible combinations of a string but not in the manner that i need.</p>\n\n<p>I tried to implement this python code in haskell but i wasn't able to accomplish it. It basically is the same problem, but you don't have loops in haskell.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/43242777/splitting-a-word-into-all-possible-subwords-all-possible-combinations\">Splitting a word into all possible &#39;subwords&#39; - All possible combinations</a></p>\n\n<p>The output of the code below is...</p>\n\n<p>[\"sun\",\"su\",\"s\",\"un\",\"u\",\"n\"]</p>\n\n<p>and not</p>\n\n<p>[[\"s\",\"un\"],[\"s\",\"u\",\"n\"],[\"su\",\"n\"]]</p>\n\n<pre><code>    -----------------------------------------------------\n\n\n    substring :: String -&gt; [String]\n    substring [] = []\n    substring xs = subs xs ++ substring (tail xs)\n            where\n               subs xs = foldl step [] xs\n               step [] a = [[a]]\n               step acc a = (head acc ++ [a]) : acc\n\n    ---------------EXAMPLES OF EXPECTED RESULTS BELOW----------------------------------\n    Input: Bang\n    Output: [['B','ang'], ['Ba','ng'], ['Ban','g'], ['B','a','ng'], ['B','an','g'], ['Ba','n','g'], ['B','a','n','g']]\n\n    Input: Sun\n    Output: [[\"s\",\"un\"],[\"s\",\"u\",\"n\"],[\"su\",\"n\"]]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553441827, "post_id": 55325367, "comment_id": 97376926, "body": "Hint: the function should result in <code>Nothing</code> if the list argument is empty, and if it&#39;s non-empty but the head doesn&#39;t match then the function should recurse."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9660393"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553442847, "post_id": 55325367, "comment_id": 97377221, "body": "I&#39;m not sure how to use recursion within the syntax of a Maybe statement. The just statement would have to be recursive but how do you write a recursive Just statement?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553443298, "post_id": 55325367, "comment_id": 97377371, "body": "Not sure what you mean by &quot;recursive Just statement&quot; (and Haskell doesn&#39;t have statements anyway,  and<code>Just x</code> is just a value). You&#39;re recursing on the list, not a <code>Maybe</code> value - just use pattern matching and guards, every right hand side is either a <code>Just</code> value, <code>Nothing</code> or a recursive call. (What you have above is a good start, you&#39;ve just forgotten both the recursion and the empty-list case.)"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1553449707, "creation_date": 1553449707, "answer_id": 55326716, "question_id": 55325367, "link": "https://stackoverflow.com/questions/55325367/using-maybe-for-string-within-string-list/55326716#55326716", "title": "Using Maybe for String within String List", "body": "<p>As @RobinZigmond has said, recursion will work fine here, and there's nothing too special about using recursion with <code>Maybe</code> values.  Don't think of <code>Nothing</code> and <code>Just</code> as \"statements\".  <code>Nothing</code> is a value, and <code>Just [\"a\",\"b\",\"c\"]</code> is a value, and a recursive function that returns such values is written and used in much the same way as a recursive function that returns integers.</p>\n\n<p>Spoilers below, but try doing it yourself first, with a further hint.  In your definition, <code>Nothing</code> is a value of type <code>Maybe [String]</code>.  You'd like to replace it with a recursive call to <code>strReturn</code>, and the return type of <code>strReturn</code> is <code>Maybe [String]</code>, which is exactly the type you need!  No <code>Just</code>, \"recursive\" or not, is needed -- just try replacing <code>Nothing</code> directly with a <code>strReturn</code> call that typechecks.</p>\n\n<p>If you still can't figure it out, read on...</p>\n\n<p>Taking your <code>strReturn</code> as a starting point, note that, if <code>x /= y</code>, then you want to keep looking in the rest of the string, so that case should be:</p>\n\n<pre><code>strReturn x (y : ys) | x /= y = strReturn x ys\n</code></pre>\n\n<p>This type-checks fine.  The <code>strReturn</code> call on the left needs to return a value of type <code>Maybe [String]</code>, and fortunately the recursive <code>strReturn</code> call on the right has exactly that type, so no problem.</p>\n\n<p>The only problem with the code now is that it'll crash if the string isn't found, because eventually you'll run out of strings, and the recursive call:</p>\n\n<pre><code>strReturn \"whatever\" []\n</code></pre>\n\n<p>won't match the pattern in the definition.  You need to add a case that states that, if the end of the list is reached (obviously without finding the string, or we would have stopped by now), we need to return <code>Nothing</code>:</p>\n\n<pre><code>strReturn _ [] = Nothing\n</code></pre>\n\n<p>The full definition is:</p>\n\n<pre><code>strReturn :: String -&gt; [String] -&gt; Maybe [String]\nstrReturn _ [] = Nothing\nstrReturn x (y : ys)\n  | x == y = Just ys\n  | otherwise = strReturn x ys\n</code></pre>\n\n<p>Note that it's slightly better practice to use <code>otherwise</code> than <code>x /= y</code>.  This will both avoid an unnecessary check in the compiled code <em>and</em> avoid a warning that you'd get if you compiled with <code>-Wall</code> (which you should!) about non-exhaustive patterns.  The compiler isn't quite clever enough to figure out that <code>x /= y</code> will always succeed if <code>x == y</code> has failed.  (For user-defined datatypes, this could technically be false.)</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9660393"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 55326716, "answer_count": 1, "score": 1, "last_activity_date": 1553449707, "creation_date": 1553441273, "question_id": 55325367, "link": "https://stackoverflow.com/questions/55325367/using-maybe-for-string-within-string-list", "title": "Using Maybe for String within String List", "body": "<p>I'm trying to check if a String is included in a list of Strings and, if it is, I want to return the rest of the Strings in the list AFTER the String has been located.</p>\n\n<p>My issue is that I would normally use recursion to find the String within the list and then return everything after; however, I'm new to Maybe statements so I'm not sure if recursion is the best way to check and return what I want.</p>\n\n<pre><code>strReturn :: String -&gt; [String] -&gt; Maybe [String] \nstrReturn x (y : ys)\n  | x == y = Just ys\n  | x /= y = Nothing\n</code></pre>\n\n<p>The code I've written only checks the head of the list; I'm unsure how to check the rest of the list within the syntax of a Maybe statement - and I want to return everything AFTER the string. This works in all the right way but only for the head. If the String is anywhere but the head it won't see it or return anything.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1553440063, "post_id": 55325082, "comment_id": 97376455, "body": "<code>newp</code> should be defined using <code>let</code> as well, not <code>&lt;-</code>. You are basically trying to use the list monad to nondeterministically set <code>newp</code> to a character from the path, not to the path itself."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1553440169, "post_id": 55325082, "comment_id": 97376480, "body": "Without looking at the rest of the code closely, I question whether <i>any</i> of the <code>do</code> blocks are appropriate. They don&#39;t appear to be."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553442253, "post_id": 55325082, "comment_id": 97377059, "body": "It&#39;s not clear what <code>doesPathExist</code> does, but if - as the name suggests - it inspects the file system to get its result, then you can only use it in a function whose return type is in the <code>IO</code> monad."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1553459131, "post_id": 55325082, "comment_id": 97382265, "body": "Just as an aside: <code>fp ++ &quot;&#47;orders&#47;&quot; ++ (show syear) ++ &quot;&#47;&quot; ++ (show smonth) ++ &quot;&#47;&quot; ++ (show sday)</code> can be written a bit more tidily as <code>fp &lt;&#47;&gt; &quot;orders&quot; &lt;&#47;&gt; show syear &lt;&#47;&gt; show smonth &lt;&#47;&gt; show sday</code> using <code>&lt;&#47;&gt;</code> from the <code>filepath</code> package, which uses the platform directory separator\u2014or more compactly as <code>joinPath $ fp : &quot;orders&quot; : map show [syear, smonth, sday]</code>. You can also pattern-match <code>let [syear, smonth, sday, fyear, fmonth, fday] = range</code>, but it would be better to introduce a separate data type for date ranges, rather than <code>[Int]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 11250902, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HRWDj.png?s=128&g=1", "display_name": "notviable", "link": "https://stackoverflow.com/users/11250902/notviable"}, "edited": false, "score": 0, "creation_date": 1553443527, "post_id": 55325656, "comment_id": 97377446, "body": "This was really helpful and somewhat worked, only now on &#39;then do fps ++ [(show newp)]&#39; it&#39;s saying its expecting a type &#39;IO String&#39; and the actual type is &#39;String&#39;, any thoughts?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 25, "user_id": 11250902, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HRWDj.png?s=128&g=1", "display_name": "notviable", "link": "https://stackoverflow.com/users/11250902/notviable"}, "edited": false, "score": 1, "creation_date": 1553447035, "post_id": 55325656, "comment_id": 97378590, "body": "Be sure you <code>return (fps ++ [(show newp)])</code>   Also <code>let newp = ...</code> instead of <code>newp &lt;-</code>."}, {"owner": {"reputation": 25, "user_id": 11250902, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HRWDj.png?s=128&g=1", "display_name": "notviable", "link": "https://stackoverflow.com/users/11250902/notviable"}, "edited": false, "score": 0, "creation_date": 1553450626, "post_id": 55325656, "comment_id": 97379694, "body": "This was 100% the right answer, you sir, are a genius."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1553443011, "creation_date": 1553443011, "answer_id": 55325656, "question_id": 55325082, "link": "https://stackoverflow.com/questions/55325082/haskell-doespathexist-expected-type-bool-actual-type-io-bool/55325656#55325656", "title": "Haskell &#39;doesPathExist&#39; Expected type: Bool, Actual type: IO Bool", "body": "<p>Your function <code>mkFileList</code> can not return type <code>[String]</code> but instead must be <code>IO [String]</code> to interact with the file system.  When you make that change you'll also want to change your <code>else fps</code> to <code>else return fps</code>.</p>\n\n<p>As it stands, the monad GHC infers when you type <code>do</code> is the list monad and this propagates to cause an error message that confuses you.</p>\n"}], "owner": {"reputation": 25, "user_id": 11250902, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HRWDj.png?s=128&g=1", "display_name": "notviable", "link": "https://stackoverflow.com/users/11250902/notviable"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 55325656, "answer_count": 1, "score": -1, "last_activity_date": 1553452500, "creation_date": 1553439388, "last_edit_date": 1553452500, "question_id": 55325082, "link": "https://stackoverflow.com/questions/55325082/haskell-doespathexist-expected-type-bool-actual-type-io-bool", "title": "Haskell &#39;doesPathExist&#39; Expected type: Bool, Actual type: IO Bool", "body": "<p>I'm trying to validate a directories existence so I can add it into a list of valid directories, however I'm getting errors regarding type mismatches.</p>\n\n<p>My function is here:</p>\n\n<pre><code>--Make a list of files to work on using a range\nmkFileList :: String -&gt; [String] -&gt; [Int] -&gt; [String]\nmkFileList fp fps range = do\n    let syear = range !! 0\n    let smonth = range !! 1\n    let sday = range !! 2\n    let fyear = range !! 3\n    let fmonth = range !! 4\n    let fday = range !! 5\n    if dateCheck range\n      then do newp &lt;- fp ++ \"/orders/\" ++ (show syear) ++ \"/\" ++ (show smonth) ++ \"/\" ++ (show sday)\n              direx &lt;- doesPathExist (show newp)\n\n              --Check new directory exists and add if it does\n              if direx\n                then fps ++ newp\n                else do pure ()\n              --Construct new variables \n              if (sday+1) &gt; 31\n                then do sday &lt;- return (1)\n                        if (smonth+1) &gt; 12\n                          then do smonth &lt;- return (1)\n                                  syear &lt;- return (syear+1)\n                                  pure ()\n                          else do smonth &lt;- return (smonth+1)\n                                  pure ()\n                else do sday &lt;- return (sday+1)\n                        pure ()\n              mkFileList fp fps [syear, smonth, sday, fyear, fmonth, fday]        \n      else fps\n</code></pre>\n\n<p>The error I'm getting is:</p>\n\n<pre><code>Main.hs:141:28: error:\n* Couldn't match type `IO' with `[]'\n  Expected type: [Bool]\n    Actual type: IO Bool\n* In a stmt of a 'do' block: direx &lt;- doesPathExist (show newp)\n  In the expression:\n    do newp &lt;- fp\n                 ++\n                   \"/orders/\"\n                     ++ (show syear) ++ \"/\" ++ (show smonth) ++ \"/\" ++ (show sday)\n       direx &lt;- doesPathExist (show newp)\n       if direx then fps ++ newp else do pure ()\n       if (sday + 1) &gt; 31 then\n           do sday &lt;- return (1)\n              ....\n       else\n           do sday &lt;- return (sday + 1)\n              ....\n       ....\n  In a stmt of a 'do' block:\n    if dateCheck range then\n        do newp &lt;- fp\n                     ++\n                       \"/orders/\"\n                         ++ (show syear) ++ \"/\" ++ (show smonth) ++ \"/\" ++ (show sday)\n           direx &lt;- doesPathExist (show newp)\n           if direx then fps ++ newp else do ...\n           ....\n    else\n        fps\n              direx &lt;- doesPathExist (show newp)\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>EDIT: I've changed my code a fair amount to be somewhat cleaner, still have the same error on 'direx &lt;- doesPathExist (show newp)' however.</p>\n\n<pre><code>--Make a list of files to work on using a range\nmkFileList :: String -&gt; [String] -&gt; [Int] -&gt; [String]\nmkFileList fp fps range = do\n    let syear = range !! 0\n    let smonth = range !! 1\n    let sday = range !! 2\n    let fyear = range !! 3\n    let fmonth = range !! 4\n    let fday = range !! 5\n    if dateCheck range\n      then do let newp = fp ++ \"/orders/\" ++ (show syear) ++ \"/\" ++ (show smonth) ++ \"/\" ++ (show sday)\n              direx &lt;- doesPathExist (show newp)\n\n              --Check new directory exists and add if it does\n              if direx\n                then do fps ++ [(show newp)]\n                        let nrange = plusOneDay range\n                        mkFileList fp fps nrange\n                else do let nrange = plusOneDay range\n                        mkFileList fp fps nrange      \n      else fps\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 9, "user_id": 9138273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45bfbdb164438453635c1aa58bc1f5fe?s=128&d=identicon&r=PG&f=1", "display_name": "egeseckin", "link": "https://stackoverflow.com/users/9138273/egeseckin"}, "reply_to_user": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1553441136, "post_id": 55324735, "comment_id": 97376728, "body": "data BETree = Leaf Float | Node Char BETree BETree deriving (Show, Ord, Eq)"}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1553445292, "post_id": 55324735, "comment_id": 97378009, "body": "Do you want to know how to implement this function <code>toList&#39; :: BETree -&gt; ([Float], [Char])</code>?"}, {"owner": {"reputation": 9, "user_id": 9138273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45bfbdb164438453635c1aa58bc1f5fe?s=128&d=identicon&r=PG&f=1", "display_name": "egeseckin", "link": "https://stackoverflow.com/users/9138273/egeseckin"}, "reply_to_user": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1553448739, "post_id": 55324735, "comment_id": 97379127, "body": "If the Node a is char then it will add a to the charList. However, If it is Int then it adds Node a to intList. I&#39;m trying to find this but I&#39;m getting errors about the type of a"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 2, "creation_date": 1553450144, "post_id": 55324735, "comment_id": 97379548, "body": "You said <code>Int</code>, but there&#39;s no <code>Int</code> in the data type.  Did you mean <code>Float</code> instead of <code>Int</code> or vice versa?"}, {"owner": {"reputation": 9, "user_id": 9138273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45bfbdb164438453635c1aa58bc1f5fe?s=128&d=identicon&r=PG&f=1", "display_name": "egeseckin", "link": "https://stackoverflow.com/users/9138273/egeseckin"}, "edited": false, "score": 0, "creation_date": 1553450867, "post_id": 55324735, "comment_id": 97379759, "body": "Yes, that was my mistake sorry. Trying to check if it is Float or Char"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1553451484, "post_id": 55324735, "comment_id": 97379941, "body": "<code>if (a :: Char)</code> is wrong because <code>if</code> takes a <code>Bool</code>, not a <code>Char</code>. Also, the type annotation is redundant because <code>a</code> is already a <code>Char</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1553451566, "post_id": 55324735, "comment_id": 97379967, "body": "<code>floatList ++ a</code> is two type errors: <code>++</code> takes two lists, but <code>a</code> is not a list (it&#39;s a single <code>Char</code>), and <code>floatList</code> is a list of floats, to which you cannot add <code>a</code> (because it&#39;s a <code>Char</code>, not a <code>Float</code>)."}, {"owner": {"reputation": 9, "user_id": 9138273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45bfbdb164438453635c1aa58bc1f5fe?s=128&d=identicon&r=PG&f=1", "display_name": "egeseckin", "link": "https://stackoverflow.com/users/9138273/egeseckin"}, "edited": false, "score": 0, "creation_date": 1553451632, "post_id": 55324735, "comment_id": 97379987, "body": "Oh, I understand my mistake thank you"}, {"owner": {"reputation": 1125, "user_id": 5672740, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c16baffcdc08015ed0b3f9dcfd424751?s=128&d=identicon&r=PG&f=1", "display_name": "SenselessCoder", "link": "https://stackoverflow.com/users/5672740/senselesscoder"}, "edited": false, "score": 0, "creation_date": 1554128995, "post_id": 55324735, "comment_id": 97627937, "body": "Interesting problem. I hope this wasn&#39;t given as a homework."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1553452933, "creation_date": 1553452933, "answer_id": 55327225, "question_id": 55324735, "link": "https://stackoverflow.com/questions/55324735/how-to-seperate-list-elements-as-char-or-float/55327225#55327225", "title": "How to seperate list elements as Char or Float", "body": "<p>There are a couple of aspects of Haskell that you haven't mastered yet, and they're causing you some difficulty.</p>\n\n<p>First, as you probably know, Haskell takes its types very seriously.  It's a strongly typed language, so that means that the whole concept of searching through a data structure to find values of a particular type is the wrong way of thinking about this problem.  The definition of <code>BETree</code> is:</p>\n\n<pre><code>data BETree = Leaf Float | Node Char BETree BETree deriving (Show, Ord, Eq)\n</code></pre>\n\n<p>which says that this structure consists of <code>Leaf</code>s that contain a <code>Float</code> and internal <code>Node</code>s that contain a <code>Char</code>.  So, if you want to find all the <code>Char</code> values, you don't check the <em>types</em>, you just look for the <code>Node</code>s.  They will all contain <code>Char</code>s and can't contain anything else, by the definition of <code>BETree</code>.  In other words, in your function definition:</p>\n\n<pre><code>toList (Node a l r) = ...\n</code></pre>\n\n<p>you don't need to try to check the type of <code>a</code> -- it's guaranteed to be <code>Char</code> by the definition of <code>Node</code> in the <code>BETree</code> definition.  If you separately write a definition:</p>\n\n<pre><code>toList (Leaf x) = ...\n</code></pre>\n\n<p>then you're similarly guaranteed that <code>x</code> is a <code>Float</code>, and you don't need to check any types.</p>\n\n<p>Second, Haskell normally works with immutable values.  This means that, unlike in most other languages, you usually <em>don't</em> start by creating an empty list and then trying to add elements to it in a separate function.  Instead, you usually write recursive functions that return the \"list so far\", which they generate by adding an element (or elements) to the list returned by recursively calling themselves.  As a simple example, to write a function that builds up the list of all positive integers in an input list, you'd write:</p>\n\n<pre><code>positiveInts :: [Int] -&gt; [Int]\npositiveInts (x:xs) | x &gt; 0 = x : positiveInts xs  -- add \"x\" to list from recursive call\n                    | otherwise = positiveInts xs  -- drop \"x\"\npositiveInts [] = []\n</code></pre>\n\n<p>So. here's how it might work for your problem, starting with the simpler problem of <strong>just</strong> building the <code>floatList</code>:</p>\n\n<pre><code>toFloatList :: BETree -&gt; [Float]\ntoFloatList (Leaf x) = [x]        -- x is guaranteed to be a Float, so return it\ntoFloatList (Node _a l r) =       -- _a can't be a float, so ignore it\n  toFloatList l ++ toFloatList r  -- but recurse to find more Floats in Leafs\n</code></pre>\n\n<p>And test it:</p>\n\n<pre><code>&gt; toFloatList (Node 'x' (Leaf 1.0) (Node 'y' (Leaf 3.0) (Leaf 4.0)))\n[1.0,3.0,4.0]\n&gt;\n</code></pre>\n\n<p>Building just the <code>charList</code> is only slightly more complicated:</p>\n\n<pre><code>toCharList :: BETree -&gt; [Char]\ntoCharList (Leaf _x) = []       -- x is guaranteed to be a Float, so no Chars here\ntoCharList (Node a l r) =       -- \"a\" is a Char\n  toCharList l ++ [a] ++ toCharList r  -- recurse and put \"a\" in the middle\n</code></pre>\n\n<p>and testing it:</p>\n\n<pre><code>&gt; toCharList (Node 'x' (Leaf 1.0) (Node 'y' (Leaf 3.0) (Leaf 4.0)))\n\"xy\"\n&gt; \"xy\" == ['x','y']\nTrue\n&gt;\n</code></pre>\n\n<p>In Haskell, the list of Chars <code>['x','y']</code> is equivalent to the string <code>\"xy\"</code> which is why it gets printed this way.</p>\n\n<p>Now, the easiest way to define <code>toList</code> is:</p>\n\n<pre><code>toList :: BETree -&gt; ([Float], [Char])\ntoList bet = (toFloatList bet, toCharList bet)\n</code></pre>\n\n<p>This traverses the tree twice.  If you want to build both lists together in a single traversal, things get significantly more complicated:</p>\n\n<pre><code>toList' :: BETree -&gt; ([Float], [Char])\ntoList' (Leaf x) = ([x],[])   -- easy, since Leaf contains only one Float\ntoList' (Node a l r) =        -- Nodes are harder\n  let (fl1, cl1) = toList' l  -- lists from the left branch\n      (fl2, cl2) = toList' r  -- lists from the right branch\n  in  (fl1 ++ fl2, cl1 ++ [a] ++ cl2)   -- combine with our Char \"a\"\n</code></pre>\n\n<p>and the test:</p>\n\n<pre><code>&gt; toList (Node 'x' (Leaf 1.0) (Node 'y' (Leaf 3.0) (Leaf 4.0)))\n([1.0,3.0,4.0],\"xy\")\n&gt; toList' (Node 'x' (Leaf 1.0) (Node 'y' (Leaf 3.0) (Leaf 4.0)))\n([1.0,3.0,4.0],\"xy\")\n&gt;\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 9138273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45bfbdb164438453635c1aa58bc1f5fe?s=128&d=identicon&r=PG&f=1", "display_name": "egeseckin", "link": "https://stackoverflow.com/users/9138273/egeseckin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 55327225, "answer_count": 1, "score": -1, "last_activity_date": 1553452933, "creation_date": 1553437116, "last_edit_date": 1553451286, "question_id": 55324735, "link": "https://stackoverflow.com/questions/55324735/how-to-seperate-list-elements-as-char-or-float", "title": "How to seperate list elements as Char or Float", "body": "<p>When I take a mixed tree from char and float I have to seperate them as a Float or Character in haskell and add them to the specific list I tried to write something as you can see below;</p>\n\n<p>I tried to take a as [a] in the else part but it gives error too.</p>\n\n<pre><code>data BETree = Leaf Float | Node Char BETree BETree deriving (Show, Ord, Eq)\n\ncharList :: [Char]\ncharList = []\n\nfloatList :: [Float]\nfloatList = []\n\ntoList :: BETree -&gt; ([Float], [Char])\ntoList (Node a l r) = if (a :: Char ) then (charList ++ [a])\n                      else (floatList ++ a)\n</code></pre>\n\n<p>I expect to entered values to seperate for floatList and charList however I get errors like this;\nCouldn't match expected type \u2018[[Char]]\u2019 with actual type \u2018Char\u2019\nOR\nvice versa</p>\n"}, {"tags": ["haskell", "filter"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1553436713, "post_id": 55324427, "comment_id": 97375501, "body": "<code>myFilteredFunction = liftA2 filter myFilter myFunction</code>"}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 11092299, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-izTE3vrPWHA/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPbarNdPWfr4UrVYPLGpI2wsA8zTg/mo/photo.jpg?sz=128", "display_name": "Kjurdt", "link": "https://stackoverflow.com/users/11092299/kjurdt"}, "edited": false, "score": 0, "creation_date": 1553437419, "post_id": 55324480, "comment_id": 97375694, "body": "Yes, that&#39;s exactly it, so obvious when pointed out! Thank you :D"}], "tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": true, "score": 4, "last_activity_date": 1553435435, "creation_date": 1553435435, "answer_id": 55324480, "question_id": 55324427, "link": "https://stackoverflow.com/questions/55324427/applying-a-filter-function-that-takes-two-arguments-to-a-list-produced-by-a-func/55324480#55324480", "title": "Applying a filter function that takes two arguments to a list produced by a function that takes one argument in Haskell", "body": "<p>Your question isn't 100% clear, but I think you might mean this?</p>\n\n<pre><code>myFilteredFunction :: a -&gt; [b]\nmyFilteredFunction a = filter (\\b -&gt; myFilter a b) (myFunction a)\n</code></pre>\n\n<p>That is, you apply <code>myFunction</code> to get a list, and then filter it according to whether <code>myFilter</code> gives <code>True</code> when applied to the original element and the one being tested.</p>\n\n<p>Note that the function applied to <code>filter</code> here can be simplified using partial application:</p>\n\n<pre><code>myFilteredFunction a = filter (myFilter a) (myFunction a)\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 11092299, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-izTE3vrPWHA/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPbarNdPWfr4UrVYPLGpI2wsA8zTg/mo/photo.jpg?sz=128", "display_name": "Kjurdt", "link": "https://stackoverflow.com/users/11092299/kjurdt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 55324480, "answer_count": 1, "score": -1, "last_activity_date": 1553435435, "creation_date": 1553435075, "question_id": 55324427, "link": "https://stackoverflow.com/questions/55324427/applying-a-filter-function-that-takes-two-arguments-to-a-list-produced-by-a-func", "title": "Applying a filter function that takes two arguments to a list produced by a function that takes one argument in Haskell", "body": "<p>In Haskell, I've defined a filter function that takes two arguments and returns a Bool, ie</p>\n\n<pre><code>myFilter :: a -&gt; b -&gt; Bool\n</code></pre>\n\n<p>I've defined a function that takes one argument and returns a list, ie</p>\n\n<pre><code>myFunction :: a -&gt; [b]\n</code></pre>\n\n<p>The argument myFunction takes is the same as the first argument that myFilter takes, and the items of the list output by myFunction are the same type as the second argument of myFilter, ie</p>\n\n<pre><code>myFunction a = [b]\nmyFilter a b = Bool\n</code></pre>\n\n<p>I want to define another function, myFilteredFunction, </p>\n\n<pre><code>myFilteredFunction :: a -&gt; [b]\n</code></pre>\n\n<p>This takes one argument <code>a</code>, the one that both myFilter and myFunction that, and returns a subset of <code>[b]</code> that includes only items that satisfy the predicate set by myFilter, ie that filters the output of myFunction using myFilter. This seems like such a simple thing to do and yet I've not been able to make it work (I'm new to Haskell)!</p>\n\n<p>Some of the options I've tried, which obviously don't work:</p>\n\n<pre><code>myFilteredFunction = myFilter . myFunction\nmyFilteredFunction' = filter myFilter . myFunction\nmyFilteredFunction'' = myFilter . (map myFunction)\n</code></pre>\n\n<p>I see the problem being that myFilter takes two arguments and the other two functions take just the one...help much appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 4, "creation_date": 1553433764, "post_id": 55324212, "comment_id": 97374685, "body": "are you sure that you have it as <code>doubleMe</code> in the file, and not <code>doubleme</code>? Haskell is case sensitive."}, {"owner": {"reputation": 117, "user_id": 4502721, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-lrJuzGlmiPc/AAAAAAAAAAI/AAAAAAAAABA/DblLhIv7y1c/photo.jpg?sz=128", "display_name": "Amrita Deb", "link": "https://stackoverflow.com/users/4502721/amrita-deb"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553683688, "post_id": 55324212, "comment_id": 97472667, "body": "yep its as doubleMe"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553683809, "post_id": 55324212, "comment_id": 97472746, "body": "well something is up, because this should definitely work. Can you edit your question to show the complete contents of <code>haskell_trial.hs</code>"}, {"owner": {"reputation": 117, "user_id": 4502721, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-lrJuzGlmiPc/AAAAAAAAAAI/AAAAAAAAABA/DblLhIv7y1c/photo.jpg?sz=128", "display_name": "Amrita Deb", "link": "https://stackoverflow.com/users/4502721/amrita-deb"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553771904, "post_id": 55324212, "comment_id": 97512760, "body": "there is just one line there doubleMe x = x + x"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553772186, "post_id": 55324212, "comment_id": 97512925, "body": "I&#39;m sorry to keep repeating myself, but we need to see an <i>exact</i> replica of 1) the file you&#39;re loading and 2) your GHCi session. Everything you have said you have done should lead to the function working as expected with no error, so something must be amiss somewhere - until I see the exact details of what you&#39;ve done I can&#39;t guess as to what. We&#39;re really into trivial troubleshooting here, like are you definitely loading the correct file (and not a different Haskell file without this function in it)?"}], "answers": [{"tags": [], "owner": {"reputation": 117, "user_id": 4502721, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-lrJuzGlmiPc/AAAAAAAAAAI/AAAAAAAAABA/DblLhIv7y1c/photo.jpg?sz=128", "display_name": "Amrita Deb", "link": "https://stackoverflow.com/users/4502721/amrita-deb"}, "is_accepted": false, "score": 0, "last_activity_date": 1555089105, "creation_date": 1555089105, "answer_id": 55656640, "question_id": 55324212, "link": "https://stackoverflow.com/questions/55324212/getting-error-in-haskell-when-running-from-external-file-variable-not-in-scope/55656640#55656640", "title": "Getting error in Haskell when running from external file &quot;variable not in scope&quot;", "body": "<p>It was some setup issue. I installed again and it started working fine</p>\n"}], "owner": {"reputation": 117, "user_id": 4502721, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-lrJuzGlmiPc/AAAAAAAAAAI/AAAAAAAAABA/DblLhIv7y1c/photo.jpg?sz=128", "display_name": "Amrita Deb", "link": "https://stackoverflow.com/users/4502721/amrita-deb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1555089105, "creation_date": 1553433550, "last_edit_date": 1553452414, "question_id": 55324212, "link": "https://stackoverflow.com/questions/55324212/getting-error-in-haskell-when-running-from-external-file-variable-not-in-scope", "title": "Getting error in Haskell when running from external file &quot;variable not in scope&quot;", "body": "<p>The problem I am facing is running from an external file \nBut I am getting the error \"Variable not in scope\"</p>\n\n<p>I am running on windows and its the most basic program. When I am trying to do this fully by command prompt it is working fine. But when I am trying to do this from an external file it is giving this error</p>\n\n<p>file name: haskell_trial.hs</p>\n\n<pre><code>doubleMe x = x + x \n</code></pre>\n\n<p>While running this is the error:</p>\n\n<pre><code>Prelude&gt; :l haskell_trial\n[1 of 1] Compiling Main             ( haskell_trial.hs, interpreted )\nOk, one module loaded.\n*Main&gt; doubleMe 5\n\n&lt;interactive&gt;:6:1: error:\n    Variable not in scope: doubleMe :: Integer -&gt; t\n\n</code></pre>\n\n<p>This is what i get when i simply do it from command prompt:</p>\n\n<pre><code>Prelude&gt; doubleme x = x+x\nPrelude&gt; doubleme 9\n18\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1553427040, "post_id": 55323267, "comment_id": 97372756, "body": "If you try to compile that code, you&#39;re going to get a warning about <code>otherwise</code> being an unused variable. You mean <code>_</code>."}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 10998854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-woJZEacxuts/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMZQ9PvigLleC18lYZqEW0kJs8mFQ/mo/photo.jpg?sz=128", "display_name": "zichao liu", "link": "https://stackoverflow.com/users/10998854/zichao-liu"}, "edited": false, "score": 0, "creation_date": 1553442476, "post_id": 55323355, "comment_id": 97377110, "body": "My fault, I originally thought so."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1553427216, "creation_date": 1553427216, "answer_id": 55323355, "question_id": 55323267, "link": "https://stackoverflow.com/questions/55323267/case-of-executing-sequence-weird-in-haskell/55323355#55323355", "title": "&quot;case of&quot; executing sequence weird in haskell", "body": "<p>I haven't checked everything but note that</p>\n\n<pre><code>trace \"{1}\" x : (filter' p xs)\n</code></pre>\n\n<p>means</p>\n\n<pre><code>(trace \"{1}\" x) : (filter' p xs)\n</code></pre>\n\n<p>so, <code>{1}</code> will be printed when you access the first element contents, and not when you just generate it. I think you wanted</p>\n\n<pre><code>trace \"{1}\" (x : (filter' p xs))\n</code></pre>\n\n<p>I would also rewrite the <code>{2}</code> line as</p>\n\n<pre><code>trace \"{2}\" (filter' p xs)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 119, "user_id": 10998854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-woJZEacxuts/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMZQ9PvigLleC18lYZqEW0kJs8mFQ/mo/photo.jpg?sz=128", "display_name": "zichao liu", "link": "https://stackoverflow.com/users/10998854/zichao-liu"}, "edited": false, "score": 0, "creation_date": 1553441935, "post_id": 55323477, "comment_id": 97376963, "body": "Thanks a lot. I have a deeper question.  For analysis above,  1. why filter&#39; returned back to &quot;case of&quot; after executing {1}, rather than recursively call &quot;(filter&#39; p xs)&quot; in &quot;x : (filter&#39; p xs)&quot;? 2. Who leads this return? The &quot;(x : xs) -&gt; &quot;case or filter&#39; itself?  This time we analyse the step of &quot;filterFirst even [1,2]&quot;: After printing &quot;{3}&quot;,  program go into filter&#39;.  Then we choose the second guard. Then &quot;trace &quot;{2}&quot; filter&#39;&quot; executed and printed &quot;{2}&quot; Then &quot;filter&#39; p xs&quot; will be execute.  For now, why program doen&#39;t return back to &quot;case of&quot; and select the second case?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 119, "user_id": 10998854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-woJZEacxuts/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMZQ9PvigLleC18lYZqEW0kJs8mFQ/mo/photo.jpg?sz=128", "display_name": "zichao liu", "link": "https://stackoverflow.com/users/10998854/zichao-liu"}, "edited": false, "score": 0, "creation_date": 1553446633, "post_id": 55323477, "comment_id": 97378442, "body": "@zichaoliu 1. <code>filter&#39;</code> does not return back to <code>case</code>/<code>of</code> after printing <code>{1}</code>. In fact, <code>{1}</code> is printed last, long after <code>filter&#39;</code> and <code>case</code> are done. I don&#39;t understand this question. 2. What return? The situation you described in #1 does not exist."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 119, "user_id": 10998854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-woJZEacxuts/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMZQ9PvigLleC18lYZqEW0kJs8mFQ/mo/photo.jpg?sz=128", "display_name": "zichao liu", "link": "https://stackoverflow.com/users/10998854/zichao-liu"}, "edited": false, "score": 0, "creation_date": 1553446723, "post_id": 55323477, "comment_id": 97378470, "body": "@zichaoliu <code>case</code> can only select a branch once it knows which pattern matches. To do that, it has to evaluate the expression until it can determine the outcome of each pattern match. For example, to check whether <code>x : xs</code> matches, the expression has to be evaluated until the outermost constructor is known (which for lists is either <code>:</code> or <code>[]</code>)."}, {"owner": {"reputation": 119, "user_id": 10998854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-woJZEacxuts/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMZQ9PvigLleC18lYZqEW0kJs8mFQ/mo/photo.jpg?sz=128", "display_name": "zichao liu", "link": "https://stackoverflow.com/users/10998854/zichao-liu"}, "edited": false, "score": 0, "creation_date": 1553482497, "post_id": 55323477, "comment_id": 97386939, "body": "My mistake, filter&#39; does not execute {1} before return back. Actually I want to ask like that: I have two possibilities about jumping unqualified value, but don&#39;t know which one is correct. The first possibility: When filter&#39; choose the second guard, filter&#39; doesn&#39;t return. So filter&#39; keeps recursive execution. Another possibility, When filter&#39; chosing the second guard, filter&#39; also returned. But &quot;case of&quot; lead &quot;trace &quot;{2}&quot; filter&#39; p xs&quot; executes. So program go back to filter&#39; again. Which possibility is right?"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 3, "last_activity_date": 1553428169, "creation_date": 1553428169, "answer_id": 55323477, "question_id": 55323267, "link": "https://stackoverflow.com/questions/55323267/case-of-executing-sequence-weird-in-haskell/55323477#55323477", "title": "&quot;case of&quot; executing sequence weird in haskell", "body": "<pre><code>trace \"{1}\" x : (filter' p xs)\n</code></pre>\n\n<p>parses as</p>\n\n<pre><code>(trace \"{1}\" x) : (filter' p xs)\n</code></pre>\n\n<p>Similarly,</p>\n\n<pre><code>trace \"{2}\" filter' p xs\n</code></pre>\n\n<p>parses as</p>\n\n<pre><code>(trace \"{2}\" filter') p xs\n</code></pre>\n\n<p>If you want the other interpretation, you need to write <code>trace \"{1}\" (x : (filter' p xs))</code> and <code>trace \"{2}\" (filter' p xs)</code>, respectively.</p>\n\n<hr>\n\n<p>I'm not sure about your question #3. Why would {3} execute multiple times? It's not part of a loop / recursion.</p>\n\n<p>Let's step through the evaluation of</p>\n\n<pre><code>filterFirst even [2,2]\n</code></pre>\n\n<p>The interpreter wants to print the result, so we have to compute the result.</p>\n\n<p>We enter the definition of <code>filterFirst</code> (the outside part of an expression is always evaluated first), giving</p>\n\n<pre><code>case (trace \"{3}\" (filter' p xs)) of \n  (x : xs) -&gt; trace \"{4}\" [x]\n  otherwise -&gt; trace \"{5}\" []\n\nwhere\n    p = even\n    xs = [2,2]\n</code></pre>\n\n<p>Here we need to make a decision. <code>case</code> needs to know which branch to evaluate, so it needs to know which pattern matches (<code>x : xs</code> or <code>otherwise</code>). So the first thing it does is to evaluate the expression we're analyzing:</p>\n\n<pre><code>trace \"{3}\" (filter' p xs)\n\nwhere\n    p = even\n    xs = [2,2]\n</code></pre>\n\n<p>Here the outermost expression is a call to <code>trace</code>, which now prints <code>{3}</code> and hands over to</p>\n\n<pre><code>filter' p xs\n\nwhere\n    p = even\n    xs = [2,2]\n</code></pre>\n\n<p>Now the outermost expression is a call to <code>filter'</code>, which is defined as</p>\n\n<pre><code>filter' p (x:xs) | p x       = trace \"{1}\" x : (filter' p xs)\n                 | otherwise = trace \"{2}\" filter' p xs\nfilter' p [] = []\n</code></pre>\n\n<p>Again we have to make a decision: Which equation do we use? The choice depends on the value of the second argument, so this triggers the evaluation of (the outermost layer of) <code>xs = [2,2]</code>. Well, nothing interesting happens here because <code>[2,2]</code> is already fully evaluated.</p>\n\n<p><code>[2,2]</code> is syntactic sugar for <code>2 : (2 : [])</code>, so this matches the first equation, binding</p>\n\n<pre><code>p = even\nx = 2\nxs = 2 : []  -- same as [2]\n</code></pre>\n\n<p>We now have to evaluate the guard behind the pattern:</p>\n\n<pre><code>p x\neven 2\nTrue\n</code></pre>\n\n<p>Success! Our return value is <code>trace \"{1}\" x : (filter' p xs)</code>, which (as mentioned above) is an application of <code>(:)</code> to two arguments, <code>trace \"{1}\" x</code> and <code>filter' p xs</code>.</p>\n\n<p>No further evaluation happens here. Recall that we're still trying to evaluate</p>\n\n<pre><code>case ... of \n  (x : xs) -&gt; trace \"{4}\" [x]\n  otherwise -&gt; trace \"{5}\" []\n</code></pre>\n\n<p>so we only care if the outermost constructor of the list is <code>:</code> or <code>[]</code>, and we know it's <code>:</code> now. We select the first branch, which yields</p>\n\n<pre><code>trace \"{4}\" [x]\n\nwhere\n    x = trace \"{1}\" x_inner\n    xs = filter' p xs_inner\n    x_inner = 2\n    xs_inner = 2 : []\n    p = even\n</code></pre>\n\n<p>This is slightly confusing because you've named all your variables <code>x</code> and <code>xs</code>. If we inline all variables whose values we already know, the bindings reduce to:</p>\n\n<pre><code>trace \"{4}\" [x]\n\nwhere\n    x = trace \"{1}\" 2\n    xs = filter' even (2 : [])\n</code></pre>\n\n<p><code>xs</code> is not used at all and <code>x</code> is only used once, so this is really equivalent to</p>\n\n<pre><code>trace \"{4}\" [trace \"{1}\" 2]\n</code></pre>\n\n<p>Evaluating this first prints <code>{4}</code> (from <code>trace</code>), then yields</p>\n\n<pre><code>[trace \"{1}\" 2]\n-- syntactic sugar for\n(trace \"{1}\" 2) : []\n</code></pre>\n\n<p>Here the list printing code starts working: We've got a list of at least one element, so it outputs <code>[</code> (the start of the list). To print the first element itself, we need to evaluate it:</p>\n\n<pre><code>trace \"{1}\" 2\n</code></pre>\n\n<p>This finally prints <code>{1}</code> and yields <code>2</code>, which lets the list-printing code output <code>2</code> and <code>]</code> (for the end of the list).</p>\n\n<p>And that's it!</p>\n"}], "owner": {"reputation": 119, "user_id": 10998854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-woJZEacxuts/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMZQ9PvigLleC18lYZqEW0kJs8mFQ/mo/photo.jpg?sz=128", "display_name": "zichao liu", "link": "https://stackoverflow.com/users/10998854/zichao-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1553428306, "creation_date": 1553426597, "last_edit_date": 1553428306, "question_id": 55323267, "link": "https://stackoverflow.com/questions/55323267/case-of-executing-sequence-weird-in-haskell", "title": "&quot;case of&quot; executing sequence weird in haskell", "body": "<p>I'm writing a function to filter the first qualified value from a list in Haskell.</p>\n\n<p>I tried out the function base on filter function, but I don't know how did the function run.</p>\n\n<p>So I add trace to each case.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>filter' :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilter' p (x:xs) | p x       = trace \"{1}\" x : (filter' p xs)\n                 | otherwise = trace \"{2}\" filter' p xs\nfilter' p [] = []\n\n\nfilterFirst :: (a-&gt;Bool) -&gt; [a]-&gt;[a]\nfilterFirst p xs = case (trace \"{3}\" (filter' p xs)) of \n  (x : xs) -&gt; trace \"{4}\" [x]\n  otherwise -&gt; trace \"{5}\" []\n</code></pre>\n\n<p>when testing:</p>\n\n<p><code>filterFirst even [2,2]</code> turns out </p>\n\n<pre><code>{3}\n{4}\n[{1}\n2]\n</code></pre>\n\n<p><code>filterFirst even [1,2]</code> turns out</p>\n\n<pre><code>{3}\n{2}\n{4}\n[{1}\n2]\n</code></pre>\n\n<p><code>filterFirst even [1,1,2]</code> turns out</p>\n\n<pre><code>{3}\n{2}\n{2}\n{4}\n[{1}\n2]\n</code></pre>\n\n<p>The result <code>[2]</code> is correct, but the executing sequence is wired.</p>\n\n<ol>\n<li>Why does {4} executed before {1}?</li>\n<li>{3} seems to only execute once, Why does <code>case of</code> know when to test <code>(x : xs)</code>? </li>\n<li>How does <code>case of</code> execute exactly?</li>\n</ol>\n"}, {"tags": ["function", "haskell", "fold"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1553420842, "post_id": 55321853, "comment_id": 97371290, "body": "if it&#39;s lazy (in its list argument), it must only be right fold. <code>take 10 . intercalate [0] $ repeat [1..3]</code> must work, as does the original."}], "answers": [{"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1553417527, "post_id": 55321889, "comment_id": 97370579, "body": "This definition doesn&#39;t compile: &#39;different number of arguments&#39;."}, {"owner": {"reputation": 17989, "user_id": 365102, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e3139989e6548e7deac2cd45253d60df?s=128&d=identicon&r=PG", "display_name": "Mateen Ulhaq", "link": "https://stackoverflow.com/users/365102/mateen-ulhaq"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1553417933, "post_id": 55321889, "comment_id": 97370663, "body": "@bradrn This is what I get for writing code without testing it... :P"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 2, "creation_date": 1553418252, "post_id": 55321889, "comment_id": 97370720, "body": "That certainly sounds familiar!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1553421368, "post_id": 55321889, "comment_id": 97371408, "body": "<code>foldl</code> destroys laziness, left-nested <code>(++)</code> destroys efficiency. double ungood."}], "tags": [], "owner": {"reputation": 17989, "user_id": 365102, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e3139989e6548e7deac2cd45253d60df?s=128&d=identicon&r=PG", "display_name": "Mateen Ulhaq", "link": "https://stackoverflow.com/users/365102/mateen-ulhaq"}, "is_accepted": false, "score": 1, "last_activity_date": 1553418021, "last_edit_date": 1553418021, "creation_date": 1553415709, "answer_id": 55321889, "question_id": 55321853, "link": "https://stackoverflow.com/questions/55321853/intercalate-using-fold/55321889#55321889", "title": "Intercalate using fold", "body": "<p>Let's remind ourselves about the signature of <code>foldl</code>:</p>\n\n<pre><code>foldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>A simple rewrite of what you wrote:</p>\n\n<pre><code>intercalate :: [a] -&gt; [[a]] -&gt; [a]\nintercalate s [] = []\nintercalate s [x] = x\nintercalate s (x:xs) = foldl (\\acc y -&gt; acc ++ s ++ y) x xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1553421305, "post_id": 55322084, "comment_id": 97371392, "body": "<code>foldr1</code> &quot;accumulates from the right, and prepends values to the accumulator&quot; <b><i>only if</i></b> the reducer function is strict. Here it processes the list  left-to-right, splicing the recursive result (not &quot;accumulator&quot;, so <code>r</code> or similar is the correct mnemonic, not <code>acc</code>) in-place on the fly. and left fold is <b><i>absolutely the wrong tool here</i></b>, it destroys laziness: <code>take 10 . intercalate [0] $ repeat [1..3]</code> must work, as the original does."}, {"owner": {"reputation": 7130, "user_id": 10239789, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YeHJm.png?s=128&g=1", "display_name": "TrebledJ", "link": "https://stackoverflow.com/users/10239789/trebledj"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553421500, "post_id": 55322084, "comment_id": 97371435, "body": "@WillNess &quot;only if the reducer function is strict&quot; \u2013 Ah, so due to laziness, the result will end up being a whole chain of <code>elem0 ++ x ++ elem1 ++ x + elem2 ++ x ++ ... ++ x ++ elemN</code> and then that gets evaluated when it&#39;s needed? (Good catch, btw.)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1553421632, "post_id": 55322084, "comment_id": 97371468, "body": "with the right fold, yes. and no, not even that: actually it will be <code>elem0 ++ x ++ (foldr (...) x [elem1....])</code>. it&#39;s a good mnemonic to write it like you did but it is even lazier than that. (you still have the wrong explanation there about <code>foldr</code> &quot;accumulating&quot; btw..., and the use of left fold must be discouraged much more strongly, IMO)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1553422349, "post_id": 55322084, "comment_id": 97371612, "body": "the <code>n</code> in <code>foldr g n xs</code> is <i>not</i> the initial term, but a final one, if <code>g</code> is not strict in its second argument. the <code>r</code> in <code>foldr</code> does not mean it folds <b><i>from</i></b> the right -- that is decided by the semantics of <code>g</code> alone. at the most we can say that foldr folds <i>on</i> the right or <i>to</i> the right. when <code>g</code> is lazy (like in this answer) &quot;folds beginning from the last element&quot; is wrong. Instead, it &quot;folds ending on the last element&quot;. <code>foldr g n (x:xs) == g x (foldr g n xs)</code>, and that&#39;s that."}, {"owner": {"reputation": 7130, "user_id": 10239789, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YeHJm.png?s=128&g=1", "display_name": "TrebledJ", "link": "https://stackoverflow.com/users/10239789/trebledj"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553423132, "post_id": 55322084, "comment_id": 97371797, "body": "@WillNess Ach semantics. I guess I still have loads to learn. Thanks for eagerly evaluating my answer. :D"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 3, "creation_date": 1553423135, "post_id": 55322084, "comment_id": 97371799, "body": "I&#39;m sorry to be pestering you, but: <code>foldl</code> does <i>not</i> &quot;perform eager evaluation&quot;. in fact it&#39;s its major drawback that it isn&#39;t (<code>foldl&#39;</code> does that, and should be used instead &quot;almost always&quot;). <code>foldl</code> does consume the input list eagerly though (and it doesn&#39;t evaluate the reducer functions chain that it builds until the whole list has been traversed). ---- yeah, you&#39;ll get there with time, and effort. :)"}, {"owner": {"reputation": 7130, "user_id": 10239789, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YeHJm.png?s=128&g=1", "display_name": "TrebledJ", "link": "https://stackoverflow.com/users/10239789/trebledj"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553423399, "post_id": 55322084, "comment_id": 97371866, "body": "Haha, no worries. The precision is all good. Also makes for a good learning experience."}], "tags": [], "owner": {"reputation": 7130, "user_id": 10239789, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YeHJm.png?s=128&g=1", "display_name": "TrebledJ", "link": "https://stackoverflow.com/users/10239789/trebledj"}, "is_accepted": false, "score": 6, "last_activity_date": 1553822757, "last_edit_date": 1553822757, "creation_date": 1553417489, "answer_id": 55322084, "question_id": 55321853, "link": "https://stackoverflow.com/questions/55321853/intercalate-using-fold/55322084#55322084", "title": "Intercalate using fold", "body": "<p>Using <code>foldr1</code>:</p>\n\n<pre><code>intercalate' :: [a] -&gt; [[a]] -&gt; [a]\nintercalate' _ [] = []\nintercalate' x xs = foldr1 (\\a acc -&gt; a ++ x ++ acc) xs\n</code></pre>\n\n<p>This will intercalate values from the <em>right</em> with <code>x</code> between each element. (Albeit it does this <a href=\"https://en.wikipedia.org/wiki/Lazy_evaluation\" rel=\"nofollow noreferrer\"><em>lazily</em></a>. \u2013\u00a0The entire fold isn't evaluated until needed.)</p>\n\n<p>Both <code>foldr1</code> and <code>foldr</code> are similar in that they fold from the right. The difference lies in that the former doesn't require us to provide a final term while the latter  does require a final term to be provided. This requires us to pattern match for the empty list, otherwise an exception would be thrown.</p>\n\n<p>Indeed, <code>foldl1</code> can also accomplish intercalation. However, this is <strong>strongly discouraged</strong> as the left fold will consume input eagerly.</p>\n\n<pre><code>intercalate' :: [a] -&gt; [[a]] -&gt; [a]\nintercalate' _ [] = []\nintercalate' x xs = foldl1 (\\acc a -&gt; acc ++ x ++ a) xs\n</code></pre>\n\n<hr>\n\n<p>To further emphasise the preference over the right fold, consider the following composition:</p>\n\n<pre><code>take 10 . intercalate' [0] $ repeat [1..3]\n</code></pre>\n\n<p>Looks harmless. But using <code>foldl1</code> will eagerly consume the infinite list, not stopping the process.</p>\n\n<p>However, using <code>foldr1</code> will evaluate lazily and give the correct result of <code>[1,2,3,0,1,2,3,0,1,2]</code>. (<code>intercalate'</code> will temporarily evaluate <code>[1..3] ++ [0] ++ (foldr (...) [0] [elem1 ... elemN])</code> before <code>take 10</code> asks for the leading terms and  evaluates the fold.)</p>\n\n<p><em>Kudos to <a href=\"https://stackoverflow.com/questions/55321853/intercalate-using-fold/55322084#comment97371392_55322084\">Will</a>.</em></p>\n\n<p>Useful Reading:<br>\n<a href=\"https://stackoverflow.com/questions/3082324/foldl-versus-foldr-behavior-with-infinite-lists\"><code>foldl</code> versus <code>foldr</code> behaviour with infinite lists</a></p>\n"}], "owner": {"reputation": 83, "user_id": 10683263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ce74c450bb01ac8d2b919e3bedcead3?s=128&d=identicon&r=PG&f=1", "display_name": "wwww", "link": "https://stackoverflow.com/users/10683263/wwww"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1553822757, "creation_date": 1553415186, "last_edit_date": 1553438176, "question_id": 55321853, "link": "https://stackoverflow.com/questions/55321853/intercalate-using-fold", "title": "Intercalate using fold", "body": "<p>Can someone explain me how to write the <code>intercalate</code> function using fold? Additionally, I've heard of <code>foldr</code> or <code>foldl</code>; which of these is the most appropriate to use in this context?</p>\n\n<p>Here's my attempt with recursion:</p>\n\n<pre><code>intercalate :: [a] -&gt; [[a]] -&gt; [a]\nintercalate s [] = []\nintercalate s [x] = x\nintercalate s (x:xs) = x ++ s ++ (intercalate s xs)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1553394375, "post_id": 55320147, "comment_id": 97367302, "body": "Side note: the lambda with the case expression amounts to <code>thing</code>."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 11092512, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-oRvt3Bok-bk/AAAAAAAAAAI/AAAAAAAAACw/m12qxXXs2LA/photo.jpg?sz=128", "display_name": "Ceilvia C", "link": "https://stackoverflow.com/users/11092512/ceilvia-c"}, "edited": false, "score": 0, "creation_date": 1553394171, "post_id": 55320179, "comment_id": 97367275, "body": "Yay it worked! Thank you! yes that&#39;s typo I will edit it"}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 5, "last_activity_date": 1553394254, "last_edit_date": 1553394254, "creation_date": 1553393936, "answer_id": 55320179, "question_id": 55320147, "link": "https://stackoverflow.com/questions/55320147/how-to-write-fmap-for-a-functor-that-has-a-function-in-its-data-type-definition/55320179#55320179", "title": "How to write fmap for a Functor that has a function in it&#39;s data type definition?", "body": "<p>Try <code>fmap g (GMAction upper lower thing) = GMAction upper lower ((fmap g) . thing)</code>. Note the function composition; this is necessary as you need to <code>fmap</code> over the <em>result</em> of the function.</p>\n"}, {"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1553414185, "post_id": 55321605, "comment_id": 97369995, "body": "Really - despite my answer above - this is what I usually use as well. It&#39;s nice having the computer write code for you!"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 63, "user_id": 11092512, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-oRvt3Bok-bk/AAAAAAAAAAI/AAAAAAAAACw/m12qxXXs2LA/photo.jpg?sz=128", "display_name": "Ceilvia C", "link": "https://stackoverflow.com/users/11092512/ceilvia-c"}, "edited": false, "score": 0, "creation_date": 1553459736, "post_id": 55321605, "comment_id": 97382397, "body": "@CeilviaC: You can also see the code that GHC generates from <code>deriving</code> clauses with the <code>-ddump-deriv</code> flag. (If you\u2019re using Stack, this will generate a <code>.dump-deriv</code> file in your <code>.stack-work</code> directory.)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1553412456, "creation_date": 1553412456, "answer_id": 55321605, "question_id": 55320147, "link": "https://stackoverflow.com/questions/55320147/how-to-write-fmap-for-a-functor-that-has-a-function-in-its-data-type-definition/55321605#55321605", "title": "How to write fmap for a Functor that has a function in it&#39;s data type definition?", "body": "<p>GHC's built-in rules for deriving <code>Functor</code> are enough to handle simple cases like this.</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\ndata FGM a = Pure a | GMAction Integer Integer (PlayerMsg -&gt; FGM a) deriving Functor\ndata PlayerMsg = Guess Integer | Surrender\n    deriving (Eq, Show)\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 11092512, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-oRvt3Bok-bk/AAAAAAAAAAI/AAAAAAAAACw/m12qxXXs2LA/photo.jpg?sz=128", "display_name": "Ceilvia C", "link": "https://stackoverflow.com/users/11092512/ceilvia-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 55320179, "answer_count": 2, "score": 1, "last_activity_date": 1553412456, "creation_date": 1553393500, "last_edit_date": 1553394210, "question_id": 55320147, "link": "https://stackoverflow.com/questions/55320147/how-to-write-fmap-for-a-functor-that-has-a-function-in-its-data-type-definition", "title": "How to write fmap for a Functor that has a function in it&#39;s data type definition?", "body": "<p>I have data defined as below:</p>\n\n<pre><code>data FGM a = Pure a | GMAction Integer Integer (PlayerMsg -&gt; FGM a)\ndata PlayerMsg = Guess Integer | Surrender\n    deriving (Eq, Show)\n</code></pre>\n\n<p>FGM represents a number guessing game where the 2 integers are the upper and lower bounds, a is the value to be returned in the end, and playermsg is the guess that the player makes.\nI would like to make FGM a Functor, so I'm trying to define a fmap for it. Problem is I don't know how do deal with the <code>(PlayerMsg -&gt; FGM a)</code> part of FGM. </p>\n\n<p>From my understanding of the testcases given, for <code>fmap g</code> (someFGM), g should only be applied to <code>Pure</code>, if it's <code>GMAction</code>, fmap should use <code>PlayerMsg</code> and generate the next FGM until it reaches a <code>Pure</code>.</p>\n\n<p>This is what I've tried:</p>\n\n<pre><code>instance Functor FGM where\n    fmap g (Pure a) = Pure (g a)\n    fmap g (GMAction upper lower thing) = GMAction upper lower (fmap g (\\x -&gt; case (thing x) of \n                                                                                Pure a -&gt; Pure a\n                                                                                GMAction u l t -&gt; GMAction u l t))\n</code></pre>\n\n<p>But when I try to run test on this I get this error:</p>\n\n<pre><code>Occurs check: cannot construct the infinite type:\n  b ~ FGM b\nExpected type: PlayerMsg -&gt; FGM b\n  Actual type: PlayerMsg -&gt; b\nIn the third argument of 'GMAction', namely '(fmap g (\\x -&gt; case (thing x) of \n                                                                                Pure a -&gt; Pure a\n                                                                                GMAction u l t -&gt; GMAction u l t))'\nIn the expression:...\n</code></pre>\n\n<p>I've also tried</p>\n\n<pre><code>fmap g (GMAction upper lower thing) = GMAction upper lower (fmap g thing)\n</code></pre>\n\n<p>and got the same error.</p>\n\n<p>I tried to search for examples with data that has a function as parameter like <code>PlayerMsg -&gt; FGM a</code>, but can't find anything. <a href=\"https://stackoverflow.com/questions/39515022/functor-fmap-pattern-match-function-values-haskell\">this</a> is kind of similar but didn't work for me(it's my first failed example). Can someone help me define this fmap or point me at where to learn about this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1553377284, "post_id": 55318148, "comment_id": 97364159, "body": "We need to see the definition of the <code>Container</code> type"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1553379847, "post_id": 55318148, "comment_id": 97364765, "body": "Unless fields are declared strict, it will be lazily. That is <code>myFunction</code> will not even be called until <code>field2</code> is demanded."}, {"owner": {"reputation": 9, "user_id": 11248525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ee0c1229b36f1f00e5de18d0259125b?s=128&d=identicon&r=PG&f=1", "display_name": "Simon1729", "link": "https://stackoverflow.com/users/11248525/simon1729"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1553380205, "post_id": 55318148, "comment_id": 97364851, "body": "@luqui does the field1 function actually touch its argument or just pass a reference? if I have a List of 1000000 elements in field1, would the method which just passes field1 need 1000000 steps for evaluation?"}, {"owner": {"reputation": 9, "user_id": 11248525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ee0c1229b36f1f00e5de18d0259125b?s=128&d=identicon&r=PG&f=1", "display_name": "Simon1729", "link": "https://stackoverflow.com/users/11248525/simon1729"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553380467, "post_id": 55318148, "comment_id": 97364915, "body": "@dfeuer something like data Container = Container {field1::type1, field2:type2, etc.}. I obviously generalized my actual functions so I can formulate my question more clearly, but I\u2018m sorry if that makes it more difficult to anwer."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1553382230, "post_id": 55318148, "comment_id": 97365305, "body": "You would need to profile your code to find out. In theory, because everything is immutable, data that you would otherwise think of as copies can be implemented as shared references."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553383970, "post_id": 55318148, "comment_id": 97365650, "body": "A lot of lazy updates (applying a function lazily to a record field) can definitely drive up memory use. Record fields should <i>usually</i> be strict, but it depends somewhat on their types and how they&#39;re used."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1553395045, "post_id": 55318148, "comment_id": 97367391, "body": "By the way you can experiment with this using <code>undefined</code>.  If <code>undefined</code> is ever &quot;touched&quot; the program will blow up."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1553389632, "creation_date": 1553389632, "answer_id": 55319857, "question_id": 55318148, "link": "https://stackoverflow.com/questions/55318148/how-are-function-parameters-passed-in-haskell/55319857#55319857", "title": "How are function parameters passed in Haskell?", "body": "<p>All comments below apply to GHC.</p>\n\n<p>Except in special circumstances (read: where the programmer has explicitly requested it), constructing the new <code>Container</code> will involve a single pointer copy for <code>field1</code>. The <code>field2</code> equation will create a thunk referencing the computation <code>myFunction $ field1 container</code>; when that thunk is forced, it will proceed by passing a pointer (the same pointer as before!) to <code>myFunction</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1553396461, "post_id": 55320302, "comment_id": 97367570, "body": "I&#39;m not exactly sure what this proves. It certainly proves that <code>xs</code> wasn&#39;t mutated, which is good since we&#39;re doing purely functional stuff. But as for call style, I fail to see how your GHC session demonstrates anything about pass by value vs. reference."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1553396661, "post_id": 55320302, "comment_id": 97367597, "body": "<code>doStuff</code> makes new container with a changed field, which is then printed, so its <code>field1</code>&#39;s list gets fleshed out fully by the printing operation. Yet <code>xs</code> which was used in the original container is now fleshed out as well, as evidenced by the last <code>:sprint</code> command (and it wasn&#39;t, before). Ergo, it&#39;s the same list object, shared between the two containers."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1553399229, "post_id": 55320302, "comment_id": 97367920, "body": "If <code>xs</code> was copied, then it would be have to be fully fleshed out during the copy to get all the &quot;new&quot; elements. I feel like <code>xs</code> has to be fully evaluated, no matter which call strategy is used."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1553417876, "post_id": 55320302, "comment_id": 97370647, "body": "@SilvioMayolo Your intuition turned out to be wrong, as is easily seen. I&#39;ve added another example to that effect. The same lazy value is shared among the two data values."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1553416401, "last_edit_date": 1553416401, "creation_date": 1553395498, "answer_id": 55320302, "question_id": 55318148, "link": "https://stackoverflow.com/questions/55318148/how-are-function-parameters-passed-in-haskell/55320302#55320302", "title": "How are function parameters passed in Haskell?", "body": "<p>Why not use record update syntax:</p>\n\n<pre><code>doStuff container = container { field2 = myFunction .... }\n</code></pre>\n\n<p>This creates a copy of <code>container</code> with just one field, <code>field2</code>, holding a different value. But the values in all the other fields in both containers will actually be the same values, shared between the two containers.</p>\n\n<p>Evidence in GHCi:</p>\n\n<pre><code>&gt; data Container = Container {field1::[Int], field2::[Int]} deriving Show\ndata Container = Container {field1 :: [Int], field2 :: [Int]}\nfield1 :: Container -&gt; [Int]\nfield2 :: Container -&gt; [Int]\n\n&gt; doStuff container = container { field2 = (++ [1]) $ field2 container }\ndoStuff :: Container -&gt; Container\n\n&gt; xs=filter even [0..10::Int]\n\n&gt; :sprint xs\nxs = _\n\n&gt; take 2 xs\n[0,2]\n\n&gt; :sprint xs\nxs = 0 : 2 : _\n\n&gt; doStuff (Container xs [0])\nContainer {field1 = [0,2,4,6,8,10], field2 = [0,1]}\n\n&gt; :sprint xs\nxs = [0,2,4,6,8,10]\n</code></pre>\n\n<p>As we can see, <code>xs</code> was passed as if \"by reference\". There's no copying, i.e. no creation of the new list storage to hold the same values -- only a pointer to the list is used, as usual. </p>\n\n<p>Another example to support the above claim:</p>\n\n<pre><code>&gt; c1 = Container (filter even [0..20::Int]) ([0])\nc1 :: Container\n\n&gt; c2 = doStuff c1\nc2 :: Container\n\n&gt; :sprint c1\nc1 = &lt;Ghci39.Container&gt; _ [0]\n\n&gt; :sprint c2\nc2 = _\n\n&gt; take 2 $ field1 c2\n[0,2]\n\n&gt; :sprint c2\nc2 = &lt;Ghci39.Container&gt; (0 : 2 : _) _\n\n&gt; :sprint c1\nc1 = &lt;Ghci39.Container&gt; (0 : 2 : _) [0]\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 11248525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ee0c1229b36f1f00e5de18d0259125b?s=128&d=identicon&r=PG&f=1", "display_name": "Simon1729", "link": "https://stackoverflow.com/users/11248525/simon1729"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1553522788, "creation_date": 1553373514, "last_edit_date": 1553522788, "question_id": 55318148, "link": "https://stackoverflow.com/questions/55318148/how-are-function-parameters-passed-in-haskell", "title": "How are function parameters passed in Haskell?", "body": "<p>I have a high memory usage container datatype with some functions working on it, none of which ever traverses the whole container. However, if I want to apply those functions, I need to copy these unchanged data chunks from the parameters into the result. Most of my functions look something like this:</p>\n\n<pre><code>doStuff :: Container -&gt; a -&gt; Container \ndoStuff container x = Container { \n    field1 = field1 container,\n    field2 = myFunction $ field1 container,\n    ...\n    } \n</code></pre>\n\n<p>My Question is: Is field1 updated by passing a reference to its location or are the contents of field1 copied into the location of the resulting Container?</p>\n\n<p>It is important to know because I build this whole datatype for efficiency purposes which would be vanished if the Container contents would be copied by my functions.</p>\n"}, {"tags": ["haskell", "tree"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 8, "creation_date": 1553368239, "post_id": 55317252, "comment_id": 97361743, "body": "I would strongly advise to include type signatures for all your top-level functions. If you did, then you would have seen at an earlier stage the real source of this error - that GHC infers the type of <code>reshapeTree</code> to be <code>AST -&gt; [(String, AST, String)] -&gt; AST</code> - when it seems you intended <code>AST -&gt; Mapping -&gt; AST</code>."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1553368322, "post_id": 55317252, "comment_id": 97361767, "body": "further, the reason GHC infers that type is this line from <code>reshapeTree</code>: <code>|val == v1 = (ASTNode v3 v2 EmptyAST)</code>. You are using <code>v2</code> as the second parameter to the <code>ASTNode</code> constructor, which according to your definition of <code>AST</code> must itself be an <code>AST</code>"}, {"owner": {"reputation": 93, "user_id": 9004008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51b3014b819527124761968abe0f715d?s=128&d=identicon&r=PG&f=1", "display_name": "Mark R. Chandar", "link": "https://stackoverflow.com/users/9004008/mark-r-chandar"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553369259, "post_id": 55317252, "comment_id": 97361995, "body": "Oh my! Thank you so much Robin! I was about to go crazy trying to figure out what is wrong. Your second comment fixed it!"}], "owner": {"reputation": 93, "user_id": 9004008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51b3014b819527124761968abe0f715d?s=128&d=identicon&r=PG&f=1", "display_name": "Mark R. Chandar", "link": "https://stackoverflow.com/users/9004008/mark-r-chandar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1553367076, "creation_date": 1553367076, "question_id": 55317252, "link": "https://stackoverflow.com/questions/55317252/haskell-function-arguments-could-not-match-type-error", "title": "Haskell function arguments (could not match type error)", "body": "<p>I am working with a tree structure and I have the following lines of code but I don't understand what causes the trouble. My reshapeTree function takes an AST and a Mapping as arguments and returns an AST. I really don't know what causes this error and would be grateful if you could help.Thank you </p>\n\n<p>I get the following error and my code is below:</p>\n\n<p><pre>\n    test1.hs:55:35: error:\n        * Couldn't match type <code>[Char]' with</code>AST'\n          Expected type: [(String, AST, String)]\n            Actual type: Mapping\n        * In the second argument of <code>reshapeTree', namely</code>mapping'\n          In the expression: reshapeTree tree mapping\n          In an equation for `newTree': newTree = reshapeTree tree mapping\n       |\n    55 |  where newTree = reshapeTree tree mapping\n       |                                   ^^^^^^^</p>\n\n<code>type Mapping = [(String, String, String)]\ndata AST = EmptyAST | ASTNode String AST AST deriving (Show, Read)\n\nreshapeTree (EmptyAST) (_) = EmptyAST\nreshapeTree (ASTNode val l r) [] = (ASTNode val l r)\nreshapeTree (ASTNode val l r) [(v1,v2,v3)]\n |val == v1 = (ASTNode v3 v2 EmptyAST)\n |otherwise = (ASTNode val (reshapeTree l [(v1,v2,v3)]) (reshapeTree r [(v1,v2,v3)]))\nreshapeTree (ASTNode val l r) ((v1,v2,v3):xs)\n |val == v1 = (ASTNode v3 v2 EmptyAST) \n |otherwise = reshapeTree (ASTNode val (reshapeTree l ((v1,v2,v3):xs)) (reshapeTree r ((v1,v2,v3):xs))) xs\n\n\nevalTree (ASTNode val l r)\n |val == \"plus\" = show (read (evalTree l) + read (evalTree r) )\n |val == \"times\" = show (read (evalTree l) * read (evalTree r) )\n |val == \"cat\" =  (evalTree l) ++ (evalTree r) \n |val == \"negate\" = show ((-1) * read (evalTree l))\n |val == \"len\" =  show (length(evalTree l))\n |val == \"str\" = evalTree l \n |val == \"num\" = evalTree r\n |otherwise = val\n\nevaluateAST (tree,mapping)\n |mapping == [] = (tree,evalTree tree)\n |otherwise = (tree, evalTree newTree)\n where newTree = reshapeTree tree mapping\n</code></pre>\n\n<p></p>\n"}, {"tags": ["python", "haskell", "quickcheck", "property-based-testing", "python-hypothesis"], "answers": [{"comments": [{"owner": {"reputation": 1330, "user_id": 9297601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ce373d84959098957e6928191a737d5?s=128&d=identicon&r=PG", "display_name": "Zac Hatfield-Dodds", "link": "https://stackoverflow.com/users/9297601/zac-hatfield-dodds"}, "edited": false, "score": 3, "creation_date": 1553733502, "post_id": 55329132, "comment_id": 97498785, "body": "We actually ended up removing the coverage features, as they were a net negative for unit-test scale (though great for multi-day fuzzing with other tools), but kept various heuristics.  That doesn&#39;t change our basic advice though: put simpler strategies first in <code>one_of</code>, and let Hypothesis work out the distribution."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1553465900, "creation_date": 1553465900, "answer_id": 55329132, "question_id": 55316898, "link": "https://stackoverflow.com/questions/55316898/hypothesis-equivalent-of-quickcheck-frequency-generator/55329132#55329132", "title": "Hypothesis equivalent of QuickCheck frequency generator?", "body": "<p>As far as I can see, you've correctly understood the purpose of using <code>frequency</code> here.  It is used to allow the occasional mis-sized indent instead of either (1) only generating correctly sized indents which would never test bad indent sizes; or (2) generating randomly sized indents which would test bad indents over and over again but only generate a fraction of cases with good indents to test other aspects of the code.</p>\n\n<p>Now, the 5:1 ratio of good to (potentially) bad indent sizes is probably quite arbitrary, and it's hard to know if 1:1 or 10:1 would have been better choices without seeing the details of what's being tested. </p>\n\n<p>Luckily though, with respect to porting this to <code>hypothesis</code>, the answer to <a href=\"https://stackoverflow.com/questions/49827010/have-a-strategy-that-does-not-uniformly-choose-between-different-strategies\">Have a Strategy that does not uniformly choose between different strategies</a> includes a deleted comment:</p>\n\n<blockquote>\n  <p>Hypothesis doesn't actually support user-specific probabilities - we start with a uniform distribution, but bias it based on coverage from observed inputs. [...] \u2013 Zac Hatfield-Dodds Apr 15 '18 at 3:43</p>\n</blockquote>\n\n<p>This suggests that the \"hypothesis\" package automatically adjusts weights when using <code>one_of</code> to increase coverage, meaning that it may automatically up-weight the case with correct size in your <code>make_indent_</code> implementation, making it a sort of automatic version of <code>frequency</code>.</p>\n"}], "owner": {"reputation": 26441, "user_id": 202168, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/481f8ec4fe0149f2b3851eee91c23b8e?s=128&d=identicon&r=PG", "display_name": "Anentropic", "link": "https://stackoverflow.com/users/202168/anentropic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 1, "accepted_answer_id": 55329132, "answer_count": 1, "score": 4, "last_activity_date": 1553465900, "creation_date": 1553364750, "last_edit_date": 1553368532, "question_id": 55316898, "link": "https://stackoverflow.com/questions/55316898/hypothesis-equivalent-of-quickcheck-frequency-generator", "title": "Hypothesis equivalent of QuickCheck frequency generator?", "body": "<p>As a learning project I am translating some Haskell code (which I'm unfamiliar with) into Python (which I know well)...</p>\n\n<p>The Haskell library I'm translating has tests which make use of QuickCheck property-based testing. On the Python side I am using Hypothesis as the property-based testing library.</p>\n\n<p>The Haskell tests make use of a helper function which looks like this:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>mkIndent' :: String -&gt; Int -&gt; Gen String\nmkIndent' val size = concat &lt;$&gt; sequence [indent, sym, trailing]\n  where\n    whitespace_char = elements \" \\t\"\n    trailing = listOf whitespace_char\n    indent = frequency [(5, vectorOf size whitespace_char), (1, listOf whitespace_char)]\n    sym = return val\n</code></pre>\n\n<p>My question is specifically about the <code>frequency</code> generator in this helper.\n<a href=\"http://hackage.haskell.org/package/QuickCheck-2.12.6.1/docs/Test-QuickCheck-Gen.html#v:frequency\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/QuickCheck-2.12.6.1/docs/Test-QuickCheck-Gen.html#v:frequency</a></p>\n\n<p>I understand it to mean that <em>most of the time</em> it will return <code>vectorOf whitespace_char</code> with the expected <code>size</code>, but 1 in 5 times it will return <code>listOf whitespace_char</code> which could be any length including zero.</p>\n\n<p>In the context of the library, an indent which does not respect the <code>size</code> would model bad input data for the function under test. So I see the point of occasionally producing such an input.</p>\n\n<p>What I currently don't understand is why the 5:1 ratio in favour of valid inputs? I would have expected the property-based test framework to generate various valid and invalid inputs. For now I assume that this is sort of like an optimisation, so that it doesn't spend most of its time generating invalid examples?</p>\n\n<p>The second part of my question is how to translate this into Hypothesis. AFAICT Hypothesis does not have any equivalent of the <code>frequency</code> generator.</p>\n\n<p>I am wondering whether I should attempt to build a <code>frequency</code> strategy myself from existing Hypothesis strategies, or if the idiom itself is not worth translating and I should just let the framework generate valid &amp; invalid examples alike?</p>\n\n<p>What I have currently is:</p>\n\n<pre class=\"lang-python prettyprint-override\"><code>from hypothesis import strategies as st\n\n@st.composite\ndef make_indent_(draw, val, size):\n    \"\"\"\n    Indent `val` by `size` using either space or tab.\n    Will sometimes randomly ignore `size` param.\n    \"\"\"\n    whitespace_char = st.text(' \\t', min_size=1, max_size=1)\n    trailing = draw(st.text(draw(whitespace_char)))\n    indent = draw(st.one_of(\n        st.text(draw(whitespace_char), min_size=size, max_size=size),\n        st.text(draw(whitespace_char)),\n    ))\n    return ''.join([indent, val, trailing])\n</code></pre>\n\n<p>If I generate a few examples in a shell this seems to be doing exactly what I think it should.</p>\n\n<p>But this is my first use of Hypothesis or property-based testing and I am wondering if I am losing something vital by replacing the <code>frequency</code> distribution with a simple <code>one_of</code>?</p>\n"}, {"tags": ["scala", "haskell", "algebraic-data-types"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 5, "creation_date": 1553353805, "post_id": 55312081, "comment_id": 97357323, "body": "The last example requires several extensions, though, right? (<code>DataKinds</code>, <code>GADTs</code>, and <code>KindSignatures</code>, I think.)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 27, "last_activity_date": 1553331166, "last_edit_date": 1553331166, "creation_date": 1553330771, "answer_id": 55312081, "question_id": 55311975, "link": "https://stackoverflow.com/questions/55311975/how-to-create-adt-in-haskell/55312081#55312081", "title": "How to create ADT in Haskell?", "body": "<p>In Scala, your ADT makes <code>A</code>,<code>B</code>,<code>C</code> to be subtypes of <code>Foo</code>. In Haskell we do not have subtypes, so <code>A</code>,<code>B</code>,<code>C</code> are instead constructors of type <code>Foo</code>.</p>\n\n<p>A few possible workarounds:</p>\n\n<ol>\n<li><p>Repeat the fields. This is the most basic option.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Foo = A Int | B String | C Int String\n</code></pre></li>\n<li><p>Define additional types, so that we can reuse them more than once.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data AT = AT Int      -- can have many arguments\ndata BT = BT String   -- can have many arguments\ndata Foo = A AT | B BT | C AT BT\n</code></pre></li>\n<li><p>Exploit a GADT</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data FooTag = AT | BT | CT\n\ndata Foo (tag :: FooTag) where\n   A :: Int -&gt; Foo 'AT\n   B :: String -&gt; Foo 'BT\n   C :: Foo 'AT -&gt; Foo 'BT -&gt; Foo 'CT\n</code></pre>\n\n<p>Here, in the last line we are able to refer to \"the values constructed using <code>A</code>\"   using the type <code>Foo 'AT</code>, since tag <code>AT</code> is only used by constructor <code>A</code>.\nNote that this approach adds a tag parameter to <code>Foo</code>, so it slightly changes the interface: we can no longer write <code>bar :: Foo -&gt; ...</code>, but we have to write <code>bar :: Foo t -&gt; ...</code> (or to use existential types).</p></li>\n</ol>\n"}], "owner": {"reputation": 183, "user_id": 11246414, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c7a82c39de635e0be9b78a3f0e12f58?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/11246414/andrew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 874, "favorite_count": 2, "accepted_answer_id": 55312081, "answer_count": 1, "score": 18, "last_activity_date": 1553347301, "creation_date": 1553329647, "last_edit_date": 1553347301, "question_id": 55311975, "link": "https://stackoverflow.com/questions/55311975/how-to-create-adt-in-haskell", "title": "How to create ADT in Haskell?", "body": "<p>In Scala I can describe such ADT:</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>sealed trait Foo\ncase class A(a: Int) extends Foo\ncase class B(b: String) extends Foo\ncase class C(a: A, b: B) extends Foo\n</code></pre>\n\n<p>How can I do the same in Haskell?</p>\n\n<pre><code>data Foo = A Int | B String | C A B\n</code></pre>\n\n<p>It doesn't work, because A and B are not types. Should I use GHC extensions to do it?</p>\n"}, {"tags": ["function", "haskell", "monads"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1553323981, "post_id": 55311330, "comment_id": 97349912, "body": "Where do you see existential quantification?"}, {"owner": {"reputation": 175, "user_id": 8005232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnWoD.png?s=128&g=1", "display_name": "zli", "link": "https://stackoverflow.com/users/8005232/zli"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1553324598, "post_id": 55311330, "comment_id": 97350017, "body": "@melpomene sorry if I&#39;m using the wrong term. I didn&#39;t use existential quantification in my definitions, but GHC thinks the type signature includes a <code>forall a b.</code>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1553324787, "post_id": 55311330, "comment_id": 97350049, "body": "Hint: In <code>m &gt;&gt;= \\x -&gt; f x</code>, <code>m</code> needs an <code>r</code>, but so does <code>f x</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1553324832, "post_id": 55311330, "comment_id": 97350057, "body": "Why does your <code>&gt;&gt;=</code> have a non-standard type? Did you define your own <code>&gt;&gt;=</code> with the arguments flipped?"}, {"owner": {"reputation": 175, "user_id": 8005232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnWoD.png?s=128&g=1", "display_name": "zli", "link": "https://stackoverflow.com/users/8005232/zli"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1553325527, "post_id": 55311330, "comment_id": 97350187, "body": "@melpomene yea, i&#39;m trying to implement <code>&gt;&gt;=</code> myself to see if i really understand monads. with my definition, that&#39;s where the <code>forall</code> comes in."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1553326112, "post_id": 55311330, "comment_id": 97350317, "body": "<code>forall</code> is irrelevant. The error message shows explicit declarations for all type variables, but <code>(&gt;&gt;=) :: (a -&gt; t -&gt; b) -&gt; (t -&gt; a) -&gt; t -&gt; b</code> means exactly the same thing. The real problem is that the type should be <code>(&gt;&gt;=) :: (t -&gt; a) -&gt; (a -&gt; t -&gt; b) -&gt; t -&gt; b</code> (that is, <code>(&gt;&gt;=) :: (Monad m) =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code> with <code>m = ((-&gt;) t)</code>). Why isn&#39;t it?"}, {"owner": {"reputation": 175, "user_id": 8005232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnWoD.png?s=128&g=1", "display_name": "zli", "link": "https://stackoverflow.com/users/8005232/zli"}, "edited": false, "score": 0, "creation_date": 1553326963, "post_id": 55311330, "comment_id": 97350498, "body": "I got it now, thanks guys! I feel like I&#39;ve leveled up in understanding. both in trying to reason with type and understanding error messages"}], "answers": [{"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1553331627, "post_id": 55311756, "comment_id": 97351433, "body": "Could you accept this answer so it no longer shows up as &#39;unanswered&#39;?"}, {"owner": {"reputation": 175, "user_id": 8005232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnWoD.png?s=128&g=1", "display_name": "zli", "link": "https://stackoverflow.com/users/8005232/zli"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1553333187, "post_id": 55311756, "comment_id": 97351731, "body": "@bradrn I&#39;m not allowed to until after 2 days, I&#39;ll do it then"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1553342072, "post_id": 55311756, "comment_id": 97354002, "body": "Oh, I didn&#39;t know that. I&#39;d better be a bit more careful when I add these sort of comments then."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1553346963, "post_id": 55311756, "comment_id": 97355290, "body": "I&#39;m not sure this is really worth a self-answer. The correct instance for <code>Monad ((-&gt;) r)</code> is widely available."}, {"owner": {"reputation": 175, "user_id": 8005232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnWoD.png?s=128&g=1", "display_name": "zli", "link": "https://stackoverflow.com/users/8005232/zli"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1553407649, "post_id": 55311756, "comment_id": 97368981, "body": "@chepner yea, i guess the main learning for me was how to read the error message. Maybe the question can be edited to reflect that, or even deleted? what do you think?"}], "tags": [], "owner": {"reputation": 175, "user_id": 8005232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnWoD.png?s=128&g=1", "display_name": "zli", "link": "https://stackoverflow.com/users/8005232/zli"}, "is_accepted": true, "score": 3, "last_activity_date": 1553327511, "creation_date": 1553327511, "answer_id": 55311756, "question_id": 55311330, "link": "https://stackoverflow.com/questions/55311330/error-message-when-implementing-r-monad-type-mismatch/55311756#55311756", "title": "error message when implementing `((-&gt;) r)` monad (type mismatch)", "body": "<p>My fatal misunderstanding was that I thought the error message meant that my implementation had an incorrect type signature. (I thought that because there was a <code>forall</code> in the type signature.) It turns out that's not the actual error, and my error in the implementation was that I needed to apply another <code>r</code> term to both <code>f</code> and <code>m</code> in my implementation. Thanks to @luqui and @melpomene for pointing it out to me</p>\n"}], "owner": {"reputation": 175, "user_id": 8005232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnWoD.png?s=128&g=1", "display_name": "zli", "link": "https://stackoverflow.com/users/8005232/zli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 55311756, "answer_count": 1, "score": 0, "last_activity_date": 1553626673, "creation_date": 1553323632, "last_edit_date": 1553626673, "question_id": 55311330, "link": "https://stackoverflow.com/questions/55311330/error-message-when-implementing-r-monad-type-mismatch", "title": "error message when implementing `((-&gt;) r)` monad (type mismatch)", "body": "<p>I'm just starting to learn haskell, and I'm trying to implement some common monads as exercises for myself. As I was fiddling with the <code>((-&gt;) r)</code> monad, I implemented this (wrong) definition:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Monad ((-&gt;) r) where\n   return x = \\_ -&gt; x\n   m &gt;&gt;= f = \\c -&gt; (f . m) c\n</code></pre>\n\n<p>GHCi complained to me with</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>\u2022 Couldn't match expected type \u2018b\u2019 with actual type \u2018t -&gt; b\u2019\n  `b\u2019 is a rigid type variable bound by\n    the type signature for:\n      (&gt;&gt;=) :: forall a b. (t -&gt; a) -&gt; (a -&gt; t -&gt; b) -&gt; t -&gt; b\n</code></pre>\n\n<p>whereas the type should be:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(&gt;&gt;=) :: (t -&gt; a ) -&gt; (a -&gt; t -&gt; b) -&gt; t -&gt; b\n</code></pre>\n\n<p>Why does my implementation break it? And seemingly, the <code>forall</code> version should give the exact same type, but GHCi thinks otherwise. What's the difference?</p>\n"}, {"tags": ["haskell", "types", "typeclass", "ghci"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1553291682, "post_id": 55308208, "comment_id": 97344696, "body": "You&#39;ve defined <code>i</code> as <code>1</code>, which can be a member of any type of class <code>Num</code>. When you use <code>succ</code>, that further constrains the type to be of class <code>Enum</code>. But this isn&#39;t a problem since there are several types in both classes, and <code>2</code> represents the result in each of them."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1553294559, "post_id": 55308208, "comment_id": 97345489, "body": "@RobinZigmond That&#39;s true (for standard types; you could define your own which worked differently), but not at all the reason GHCi gives <code>2</code> as the answer."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553412685, "post_id": 55308208, "comment_id": 97369752, "body": "You might also like: <a href=\"https://stackoverflow.com/q/42820603/791604\">Why can a Num act like a Fractional?</a>. In fact I&#39;m tempted to mark this one as a duplicate. In short, the user of <code>i</code> gets to choose which instance of <code>Num</code> it wants, and in particular the user can choose a type which also has an <code>Enum</code> instance."}, {"owner": {"reputation": 3905, "user_id": 189699, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/kklyO.jpg?s=128&g=1", "display_name": "protoboolean", "link": "https://stackoverflow.com/users/189699/protoboolean"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553446101, "post_id": 55308208, "comment_id": 97378283, "body": "@DanielWagner That&#39;s interesting! They seem indeed related, but I&#39;m not sure we can call them duplicates: I&#39;m still digesting what&#39;s being said so far."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1553295651, "post_id": 55308527, "comment_id": 97345761, "body": "In GHCi, <code>ExtendedDefaultRules</code> is enabled by default, so I&#39;m pretty sure the &quot;standard class&quot; condition is dropped. It would be relevant by default in compiled code."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553296578, "post_id": 55308527, "comment_id": 97345979, "body": "Yes, I mentioned and linked the extended rules in the answer. But looking at them at first, I thought they delegated more to the Report than they actually do (it was already 1 AM here :)), so decided to quote it instead. Updated the answer."}, {"owner": {"reputation": 3905, "user_id": 189699, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/kklyO.jpg?s=128&g=1", "display_name": "protoboolean", "link": "https://stackoverflow.com/users/189699/protoboolean"}, "edited": false, "score": 0, "creation_date": 1553353802, "post_id": 55308527, "comment_id": 97357321, "body": "This helped me understand more about what&#39;s going on behind the scenes. But it doesn&#39;t seem to address the core of my question. So I&#39;m not yet accepting it. I&#39;ve tried to clarify my question by adding more to it. Thanks"}, {"owner": {"reputation": 3905, "user_id": 189699, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/kklyO.jpg?s=128&g=1", "display_name": "protoboolean", "link": "https://stackoverflow.com/users/189699/protoboolean"}, "edited": false, "score": 0, "creation_date": 1553445893, "post_id": 55308527, "comment_id": 97378220, "body": "The root of my bewilderment is that I interpreted <code>i :: Num a =&gt; a</code> as all that is known about <code>i</code> from that point onward. In Java terms, I saw <code>i</code> as being given an <code>INumber</code> interface\u2026 how could the compiler know, I thought, that the underlying instance could also be a <code>Enumerable</code> after that point? But, from what I see and what&#39;s being said, I guess that GHCi knows what&#39;s the thing underlying <code>i :: Num a =&gt; a</code>, so it knows it can also be <code>Enum a</code>, and <code>Integer</code> and <code>Double</code>\u2026 This I haven&#39;t digested this yet, TBH. I reckon I&#39;ve hit a quite peculiar case and should look at it again later."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 3905, "user_id": 189699, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/kklyO.jpg?s=128&g=1", "display_name": "protoboolean", "link": "https://stackoverflow.com/users/189699/protoboolean"}, "edited": false, "score": 1, "creation_date": 1553453227, "post_id": 55308527, "comment_id": 97380456, "body": "@basilikode In Java terms, it&#39;s closer to <code>&lt;A extends Number&gt; A i()</code> than <code>Number i()</code>. It&#39;s the caller who picks <code>a</code>/<code>A</code>, and can pick <code>Integer</code> or <code>Double</code>. Or call this method from another generic method <code>&lt;A extends Number &amp; Enumerable&gt; A j() { return &lt;A&gt; i().succ(); }</code>."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 8, "last_activity_date": 1553362453, "last_edit_date": 1553362453, "creation_date": 1553293330, "answer_id": 55308527, "question_id": 55308208, "link": "https://stackoverflow.com/questions/55308208/why-is-succ-i-valid-where-i-num-a-a-and-not-an-enum-a/55308527#55308527", "title": "Why is `succ i` valid where `i :: Num a =&gt; a` (and not an `Enum a`)?", "body": "<p>Yes, <code>succ i</code>'s type is inferred as you expect:</p>\n\n<pre><code>Prelude&gt; :t succ i\nsucc i :: (Enum a, Num a) =&gt; a\n</code></pre>\n\n<p>This type is ambiguous, but it satisfies the conditions in <a href=\"https://downloads.haskell.org/~ghc/8.6.3/docs/html/users_guide/ghci.html#type-defaulting-in-ghci\" rel=\"nofollow noreferrer\">the defaulting rules</a> for GHCi:</p>\n\n<blockquote>\n  <p>Find all the unsolved constraints. Then:</p>\n  \n  <ul>\n  <li>Find those that are of form <code>(C a)</code> where <code>a</code> is a type variable, and partition those constraints into groups that share a common type variable <code>a</code>.</li>\n  </ul>\n</blockquote>\n\n<p>In this case, there's only one group: <code>(Enum a, Num a)</code>.</p>\n\n<blockquote>\n  <ul>\n  <li>Keep only the groups in which at least one of the classes is an interactive class (defined below).</li>\n  </ul>\n</blockquote>\n\n<p>This group is kept, because <code>Num</code> is an interactive class.</p>\n\n<blockquote>\n  <ul>\n  <li><p>Now, for each remaining group G, try each type <code>ty</code> from the default-type list in turn; if setting <code>a = ty</code> would allow the constraints in G to be completely solved. If so, default <code>a</code> to <code>ty</code>.</p></li>\n  <li><p>The unit type <code>()</code> and the list type <code>[]</code> are added to the start of the standard list of types which are tried when doing type defaulting.</p></li>\n  </ul>\n</blockquote>\n\n<p>The default default-type list (sic) is (with the additions from the last clause) <code>default ((), [], Integer, Double)</code>. </p>\n\n<p>So when you do <code>Prelude&gt; succ i</code> to actually evaluate this expression (note <code>:t</code> doesn't evaluate the expression it gets), <code>a</code> is set to <code>Integer</code> (first of this list satisfying the constraints), and the result is printed as <code>2</code>.</p>\n\n<p>You can see it's the reason by changing the default:</p>\n\n<pre><code>Prelude&gt; default (Double)\nPrelude&gt; succ 1\n2.0\n</code></pre>\n\n<p>For the updated question:</p>\n\n<blockquote>\n  <p>I'm now starting to realise that my question must stem from a wrong assumption: 'that once <code>i</code> is inferred to be <code>i :: Num a =&gt; a</code>, then <code>i</code> can be nothing else'. Hence I was puzzled to see <code>succ i</code> was evaluated without errors.</p>\n</blockquote>\n\n<p><code>i</code> can be nothing <em>else</em> (i.e. nothing that doesn't fit this type), but it can be used with less general (more specific) types: <code>Integer</code>, <code>Int</code>. Even with many of them in an expression at once:</p>\n\n<pre><code>Prelude&gt; (i :: Double) ^ (i :: Integer)\n1.0\n</code></pre>\n\n<p>And these uses don't affect the type of <code>i</code> itself: it's already defined and its type fixed. OK so far?</p>\n\n<p>Well, adding constraints also makes the type more specific, so <code>(Num a, Enum a) =&gt; a</code> is more specific than <code>(Num a) =&gt; a</code>:</p>\n\n<pre><code>Prelude&gt; i :: (Num a, Enum a) =&gt; a\n1\n</code></pre>\n\n<p>Because of course any type <code>a</code> that satisfies both constraints in <code>(Num a, Enum a)</code> satisfies just <code>Num a</code>.</p>\n\n<blockquote>\n  <p>However it is not adding <code>Enum a</code> when the type variable appears as a function:</p>\n</blockquote>\n\n<p>That's because you specified a signature which doesn't allow it to. If you don't give a signature, there's no reason to infer <code>Num</code> constraint. But e.g.</p>\n\n<pre><code>Prelude&gt; f x = succ x + 1\n</code></pre>\n\n<p>will infer the type with both constraints:</p>\n\n<pre><code>Prelude&gt; :t f\nf :: (Num a, Enum a) =&gt; a -&gt; a\n</code></pre>\n\n<blockquote>\n  <p>So it seems that inference rules for functions are stricter than the ones for variables?</p>\n</blockquote>\n\n<p>It's actually the other way around due to the <a href=\"https://www.haskell.org/onlinereport/decls.html#sect4.5.5\" rel=\"nofollow noreferrer\">monomorphism restriction</a> (not in GHCi, by default). You've actually been a bit lucky not to run into it here, but the answer is already long enough. Searching for the term should give you explanations.</p>\n\n<blockquote>\n  <p>GHC is saying <code>my_succ :: forall a. Num a =&gt; a -&gt; a</code> and given <code>forall a</code> doesn't appear in the type-signature of neither <code>i</code> nor <code>x</code>.</p>\n</blockquote>\n\n<p>That's a red herring. I am not sure why it's shown in one case and not the other, but all of them have that <code>forall a</code> behind the scenes:</p>\n\n<blockquote>\n  <blockquote>\n    <p><a href=\"https://downloads.haskell.org/~ghc/8.6.3/docs/html/users_guide/glasgow_exts.html#extension-ExplicitForAll\" rel=\"nofollow noreferrer\">Haskell type signatures are implicitly quantified.</a> When the language option <code>ExplicitForAll</code> is used, the keyword <code>forall</code> allows us to say exactly what this means. For example:</p>\n\n<pre><code>g :: b -&gt; b\n</code></pre>\n    \n    <p>means this:</p>\n\n<pre><code>g :: forall b. (b -&gt; b)\n</code></pre>\n  </blockquote>\n</blockquote>\n\n<p>(Also, you just need <code>ExplicitForAll</code> and not <code>RankNTypes</code> to write down <code>forall a. Num a =&gt; a</code>.)</p>\n"}], "owner": {"reputation": 3905, "user_id": 189699, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/kklyO.jpg?s=128&g=1", "display_name": "protoboolean", "link": "https://stackoverflow.com/users/189699/protoboolean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1553362453, "creation_date": 1553291169, "last_edit_date": 1553353719, "question_id": 55308208, "link": "https://stackoverflow.com/questions/55308208/why-is-succ-i-valid-where-i-num-a-a-and-not-an-enum-a", "title": "Why is `succ i` valid where `i :: Num a =&gt; a` (and not an `Enum a`)?", "body": "<p>This seems to apply to both GHCi and GHC. I'll show an example with GHCi first.</p>\n\n<p>Given <code>i</code> type has been inferred as follows:</p>\n\n<pre><code>Prelude&gt; i = 1\nPrelude&gt; :t i\ni :: Num p =&gt; p\n</code></pre>\n\n<p>Given that <code>succ</code> is a function defined on <code>Enum</code>:</p>\n\n<pre><code>Prelude&gt; :i Enum\nclass Enum a where\n  succ :: a -&gt; a\n  pred :: a -&gt; a\n  -- \u2026OMITTED\u2026\n</code></pre>\n\n<p>and that <code>Num</code> is not a 'subclass' (if I can use that term) of <code>Enum</code>:</p>\n\n<pre><code>class Num a where\n  (+) :: a -&gt; a -&gt; a\n  (-) :: a -&gt; a -&gt; a\n-- \u2026OMITTED\u2026\n</code></pre>\n\n<p>why <code>succ i</code> does not return an error?</p>\n\n<pre><code>Prelude&gt; succ i\n2 -- works, no error\n</code></pre>\n\n<p>I would expect <code>:type i</code> to be inferred to something like:</p>\n\n<pre><code>Prelude&gt; i = 1\nPrelude&gt; :type i\ni :: (Enum p, Num p) =&gt; p\n</code></pre>\n\n<p><em>(I'm using 'GHC v. 8.6.3')</em></p>\n\n<p><strong>ADDITION:</strong></p>\n\n<p>After reading @RobinZigmond comment and @AlexeyRomanov answer I have noticed that <code>1</code> could be interpreted as one of many types and one of many classes.\nThanks to @AlexeyRomanov answer I understand much more about the defaulting-rules used to decide what type to use for ambiguous expressions.</p>\n\n<p>However I don't feel that Alexey answer addresses exactly my question. My question is about the type of <code>i</code>. It's not about the type of <code>succ i</code>.  </p>\n\n<p>It's about the mismatch between <code>succ</code> argument type (an <code>Enum a</code>) and the apparent type of <code>i</code> (a <code>Num a</code>).</p>\n\n<p>I'm now starting to realise that my question must stem from a wrong assumption: 'that once <code>i</code> is inferred to be <code>i :: Num a =&gt; a</code>, then <code>i</code> can be <em>nothing else</em>'. Hence I was puzzled to see <code>succ i</code> was evaluated without errors.</p>\n\n<p>GHC also seems to be inferring <code>Enum a</code> in addition to what was explicitly declared.</p>\n\n<pre><code>x :: Num a =&gt; a\nx = 1\ny = succ x -- works\n</code></pre>\n\n<p>However it is not adding <code>Enum a</code> when the type variable appears as a function:</p>\n\n<pre><code>my_succ :: Num a =&gt; a -&gt; a\nmy_succ z = succ z -- fails compilation\n</code></pre>\n\n<p>To me it seems that the type constraints attached to a function are stricter to the ones applied to a variable.</p>\n\n<p>GHC is saying <code>my_succ :: forall a. Num a =&gt; a -&gt; a</code> and given \n<code>forall a</code> doesn't appear in the type-signature of neither <code>i</code> nor <code>x</code> I thought that meant GHC is not going to infer any more classes for <code>my_succ</code> types.</p>\n\n<p>But this seems again wrong: I've checked this idea with the following (first time I type RankNTypes) and apparently GHC still infers <code>Enum a</code>:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nx :: forall a. Num a =&gt; a\nx = 1\ny = succ x\n</code></pre>\n\n<p>So it seems that inference rules for functions are stricter than the ones for variables?</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "edited": false, "score": 0, "creation_date": 1553449371, "post_id": 55306611, "comment_id": 97379320, "body": "Thanks for the great explanation ."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 6, "last_activity_date": 1553283343, "last_edit_date": 1553283343, "creation_date": 1553282979, "answer_id": 55306611, "question_id": 55306279, "link": "https://stackoverflow.com/questions/55306279/how-to-deal-with-a-monadic-return-value-m-maybe-foo/55306611#55306611", "title": "How to deal with a monadic return value `m (Maybe Foo)`?", "body": "<p>The type constraint means that the function can be used to return a value for any type <code>m</code> that has a <code>MonadIO</code> instance. Typically, that means <code>IO</code> itself or a monad stack built on top of <code>IO</code>.</p>\n\n<p>The value returned by <code>produceMessage</code> is in part determined by the <em>caller</em>. Need an <code>IO (Maybe KafkaError)</code> value? You can get that, because <code>IO</code> has a <code>MonadIO</code> instance. Need a <code>MyCustomMonadStack (Maybe KafkaError)</code>? You can get that, if you define a <code>MonadIO</code> instance for <code>MyCustomMonadStack</code>.</p>\n\n<p>Presumably, <code>Config.KafkaP</code> also has a <code>MonadIO</code> instance, based on how <code>messageSender</code> uses <code>produceMessage</code>.</p>\n\n<p><code>messageSender</code> has a return value of <code>Config.KafkaP (Either KafkaError ())</code>. The expression <code>return $ Right ()</code> first uses <code>Right ()</code> to produce a value of type <code>Either KafkaError ()</code>, then <code>return</code> is applied to <em>that</em> to produce a value of type <code>Config.KafkaP (Either KafkaError ())</code>. Note that the commented line <code>-- forM_ err print</code> is the only thing that might have used the value coming from <code>produceMessage</code>, so right now <code>messageSender</code> pretends that <code>produceMessage</code> worked, whether it did or not.</p>\n\n<p>A more robust definition would actually use the return value of <code>produceMessage</code> in some way, perhaps like</p>\n\n<pre><code>err &lt;- produceMessage prod message\n\nreturn $ case err of\n           Nothing -&gt; Right ()\n           Just theError -&gt; Left theError\n</code></pre>\n"}], "owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 55306611, "answer_count": 1, "score": 4, "last_activity_date": 1553285465, "creation_date": 1553281406, "last_edit_date": 1553285465, "question_id": 55306279, "link": "https://stackoverflow.com/questions/55306279/how-to-deal-with-a-monadic-return-value-m-maybe-foo", "title": "How to deal with a monadic return value `m (Maybe Foo)`?", "body": "<p>I have a function which returns a value wrapped in a Monad,</p>\n\n<pre><code>produceMessage :: MonadIO m =&gt; KafkaProducer -&gt; ProducerRecord -&gt; m (Maybe KafkaError)\n</code></pre>\n\n<p>And  I have some code to call this function like so </p>\n\n<pre><code>err &lt;- produceMessage prod message\nreturn $ Right ()\n</code></pre>\n\n<p>The above code has been written by someone else, I am just trying to understand what is happening here. This is the rest of the function</p>\n\n<pre><code>messageSender :: KafkaProducer -&gt; String -&gt; Config.KafkaP (Either KafkaError ())\nmessageSender prod msg = do\n  message &lt;- mkMessage Nothing (Just $ pack msg)\n\n  err &lt;- produceMessage prod message\n  --forM_ err print\n  return $ Right ()\n</code></pre>\n\n<p>I have three specific questions, </p>\n\n<ol>\n<li><p>I am confused what does the type signature of <code>produceMessage</code> mean? The type constraint is <code>MonadIO m</code>, what does this mean?</p></li>\n<li><p>The return type is <code>m (Maybe KafkaError)</code>, so this returns a <code>Maybe</code> value wrapped in which monad?</p></li>\n<li><p>How does <code>Right ()</code> come into picture here? In general I am really not \nable to understand the last two lines of <code>messageSender</code>.</p></li>\n</ol>\n"}, {"tags": ["haskell", "functor", "applicative"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1553283835, "post_id": 55305893, "comment_id": 97341833, "body": "Not related to Functor or Applicative, but you could rewrite this nicely with a list comprehension: <code>fs&#39; fs = [(fncnA x, fncnB y) | (x, y) &lt;- fs]</code>"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1553283980, "post_id": 55305893, "comment_id": 97341910, "body": "Or, using <code>Arrow</code> methods, simply <code>fs&#39; = map (fncnA &amp;&amp;&amp; fncnB)</code>. (I think. I&#39;m not really experienced with Arrows.)"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1553285973, "post_id": 55305893, "comment_id": 97342774, "body": "@RobinZigmond: Right idea, wrong function \u2013 you want <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Arrow.html#v:-42--42--42-\" rel=\"nofollow noreferrer\"><code>(***)</code></a>.  <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Arrow.html#v:-38--38--38-\" rel=\"nofollow noreferrer\"><code>(&amp;&amp;&amp;)</code></a> would be for <code>((* 2) &amp;&amp;&amp; (* 3)) 5 == (10,15)</code>."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1553286137, "post_id": 55305893, "comment_id": 97342831, "body": "Thanks @AntalSpector-Zabusky, I knew I&#39;d get mixed up somewhere :)"}], "answers": [{"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 2, "creation_date": 1553293002, "post_id": 55306842, "comment_id": 97345086, "body": "<code>mapPair</code> is also equal to <code>uncurry bimap</code> (where <code>bimap</code> is from <code>Data.Bifunctor</code>)."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1553284415, "last_edit_date": 1553284415, "creation_date": 1553284005, "answer_id": 55306842, "question_id": 55305893, "link": "https://stackoverflow.com/questions/55305893/how-can-i-use-functors-or-applicatives-to-rewrite-this-haskell-function-over-lis/55306842#55306842", "title": "How can I use functors or applicatives to rewrite this Haskell function over lists of tuples", "body": "<p>what you need is the mapPair function, it's defined in <a href=\"https://hackage.haskell.org/package/utility-ht\" rel=\"nofollow noreferrer\">the utility-ht package</a> but it's just</p>\n\n<pre><code>mapPair :: (a -&gt; c, b -&gt; d) -&gt; (a,b) -&gt; (c,d)\nmapPair (f,g) (a,b) = (f a, g b) \n</code></pre>\n\n<p>use</p>\n\n<pre><code>Prelude&gt; mapPair ((* 2), (* 3)) (2,3)\n(4,9)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>Prelude&gt; map (mapPair ((* 2), (* 3))) [(1,2),(2,3)]\n[(2,6),(4,9)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 11, "last_activity_date": 1553284339, "creation_date": 1553284339, "answer_id": 55306939, "question_id": 55305893, "link": "https://stackoverflow.com/questions/55305893/how-can-i-use-functors-or-applicatives-to-rewrite-this-haskell-function-over-lis/55306939#55306939", "title": "How can I use functors or applicatives to rewrite this Haskell function over lists of tuples", "body": "<p>A tuple is a bifunctor, so <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Bifunctor.html#v:bimap\" rel=\"noreferrer\"><code>bimap</code></a> is available.</p>\n\n<pre><code>import Data.Bifunctor\n\nfncnB = (* 2)\nfncnA = (* 3)\nfs' = map (bimap fncnA fncnB)\n</code></pre>\n\n<p>No third-party libraries required.</p>\n"}], "owner": {"reputation": 818, "user_id": 1542000, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/lK7QR.jpg?s=128&g=1", "display_name": "cronburg", "link": "https://stackoverflow.com/users/1542000/cronburg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 55306939, "answer_count": 2, "score": 1, "last_activity_date": 1553284415, "creation_date": 1553279717, "question_id": 55305893, "link": "https://stackoverflow.com/questions/55305893/how-can-i-use-functors-or-applicatives-to-rewrite-this-haskell-function-over-lis", "title": "How can I use functors or applicatives to rewrite this Haskell function over lists of tuples", "body": "<p>Is there a nicer way to write the following function <code>fs'</code> with functors or applicatives?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>fncnB = (* 2)\nfncnA = (* 3)\nfs' fs = zip (map (fncnA . fst) fs) $ map (fncnB . snd) fs\n</code></pre>\n\n<p>I see from <a href=\"https://stackoverflow.com/questions/33852781/different-behaviors-of-applicative-on-tuples-and-lists-in-haskell\">this question</a> that I could rely on the functor instance of lists to map a single function acting over both elements of each tuple, or e.g. on the applicative instance of tuples to apply functions to just the second-half of a two-tuple, but I'm curious how functors and applicatives fit into the picture of operating over lists of multi-component data types.</p>\n"}, {"tags": ["haskell", "monads", "parsec", "io-monad"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 9, "creation_date": 1553279352, "post_id": 55305679, "comment_id": 97339924, "body": "Why not define your original parser polymorphically. <code>ParsecT Text () m</code>, leaving <code>m</code> undecided.  Then your pure tests can test it on <code>Identity</code>, but you can instantiate at <code>IO</code> when you need to."}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 2, "creation_date": 1553298707, "post_id": 55305679, "comment_id": 97346466, "body": "I&#39;ve used luqui&#39;s approach with great results for unit testing before, and I&#39;d definitely do it again. If you still find yourself wanting to call <code>runParserT</code> for whichever reason, you can simply use <code>setPosition</code> to set Parsec&#39;s idea of the current source location (without skipping in the stream)."}, {"owner": {"reputation": 2681, "user_id": 359181, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d6b5837e011a620150043143f9b0dfcb?s=128&d=identicon&r=PG", "display_name": "Rupert Swarbrick", "link": "https://stackoverflow.com/users/359181/rupert-swarbrick"}, "edited": false, "score": 0, "creation_date": 1553343436, "post_id": 55305679, "comment_id": 97354378, "body": "luqui: Good point, that&#39;s exactly what I should be doing! Could you reply with an answer? I&#39;ll happily accept it."}, {"owner": {"reputation": 2681, "user_id": 359181, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d6b5837e011a620150043143f9b0dfcb?s=128&d=identicon&r=PG", "display_name": "Rupert Swarbrick", "link": "https://stackoverflow.com/users/359181/rupert-swarbrick"}, "reply_to_user": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1553507667, "post_id": 55305679, "comment_id": 97395329, "body": "@thatotherguy: Ah! Maybe that&#39;s actually a better approach for me - it will guarantee that Parsec doesn&#39;t need to hold on to any other internal state between top-levels. Thank you both."}], "answers": [{"tags": [], "owner": {"reputation": 2681, "user_id": 359181, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d6b5837e011a620150043143f9b0dfcb?s=128&d=identicon&r=PG", "display_name": "Rupert Swarbrick", "link": "https://stackoverflow.com/users/359181/rupert-swarbrick"}, "is_accepted": true, "score": 1, "last_activity_date": 1553760096, "creation_date": 1553760096, "answer_id": 55392670, "question_id": 55305679, "link": "https://stackoverflow.com/questions/55305679/using-a-parsec-parser-in-the-io-monad/55392670#55392670", "title": "Using a parsec parser in the IO monad", "body": "<p>Just so this question can be marked as answered: luqui's comment above explains how to do it.</p>\n\n<p>The trick is to define all your parsers polymorphically, with type <code>ParsecT Text () m</code> (the definitions all end up looking like <code>thing :: Monad m =&gt; Parsec Text () m MyType</code>). Then you can instantiate with <code>m</code> the identity monad in the test-bench and equal to <code>IO</code> where they are used.</p>\n"}], "owner": {"reputation": 2681, "user_id": 359181, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d6b5837e011a620150043143f9b0dfcb?s=128&d=identicon&r=PG", "display_name": "Rupert Swarbrick", "link": "https://stackoverflow.com/users/359181/rupert-swarbrick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 55392670, "answer_count": 1, "score": 2, "last_activity_date": 1553760096, "creation_date": 1553278766, "question_id": 55305679, "link": "https://stackoverflow.com/questions/55305679/using-a-parsec-parser-in-the-io-monad", "title": "Using a parsec parser in the IO monad", "body": "<p>I've defined a parser using Parsec, which has type <code>Parsec Text () a</code> for some <code>a</code>. I've also got a \"deal with this chunk\" function, which writes the thing I've parsed to a file and has type <code>a -&gt; IO ()</code>. The file format that it's parsing means that we get back to \"top level\" reasonably frequently.</p>\n\n<p>Is there a way to take my original parser and \"lift it\" into the IO monad? I'm imagining something with the following type signature:</p>\n\n<pre><code>liftParser :: Parsec Text () a -&gt; (a -&gt; IO ()) -&gt; ParsecT Text () IO ()\n</code></pre>\n\n<p>where the first argument is the pure parser and the second is the \"do something with the thing I parsed\" function.</p>\n\n<p>Obviously, I can bodge together what I need by redefining my original parser in IO too, but that means my unit tests look horrible, and it just feels like the wrong approach.</p>\n\n<p>Also, I can't do something crazy like calling <code>runParserT</code> because that would drop the source position information - if there's an error on line 1000 of the input, I'd like the error message to say so.</p>\n\n<p>So is there a way to do this and, if so, how? Also, is this a sensible thing to do? I imagine that I'm at least managing to avoid accumulating the output data. And, assuming that I manage something like this, should I expect <code>Parsec</code> to manage to discard the input data that it's already dealt with?</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install", "haskell-platform", "cabal-sandbox"], "comments": [{"owner": {"reputation": 452, "user_id": 3531310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c879bfa7b230a3b1a3f96fd3cb830e?s=128&d=identicon&r=PG&f=1", "display_name": "jaroslawj", "link": "https://stackoverflow.com/users/3531310/jaroslawj"}, "edited": false, "score": 0, "creation_date": 1553270459, "post_id": 55303095, "comment_id": 97335499, "body": "Package io-streams use network as a dependency. Have you seen it installing during cabal install io-streams call? Followed your steps on Linux and didn&#39;t encounter any troubles, haskell file loads without any problems and all packages installed are visible under $HOME/.cabal/packages/hackage.haskell.org? Can you verify if you see packages? And your missing function should be exposed by iphlpapi.dll - check if you have it."}], "owner": {"reputation": 25, "user_id": 7841358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7382beb538e0ac745ad33e57dbf1bd3f?s=128&d=identicon&r=PG&f=1", "display_name": "c-j-o", "link": "https://stackoverflow.com/users/7841358/c-j-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 169, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1553268851, "creation_date": 1553268851, "question_id": 55303095, "link": "https://stackoverflow.com/questions/55303095/ghc-exe-unable-to-load-package-package-name", "title": "ghc.exe: unable to load package &lt;package_name&gt;", "body": "<p>I have recently started learning <code>haskell</code> and have never used the <code>cabal</code> package manager before. I'm currently working on a project that requires me to user the <a href=\"http://hackage.haskell.org/package/io-streams\" rel=\"nofollow noreferrer\"><code>io-streams</code></a> package.  </p>\n\n<p>I of course already have the Haskell Platform installed on my machine. I am currently using the <code>x86_64-core version 8.4.3</code> installer.  </p>\n\n<p>Using a Git Bash terminal on Windows 10, I have created a <code>.cabal-sandbox/</code> folder (using the <code>cabal sandbox init</code> command), in which to house all of my downloaded packages. I have then run <code>cabal install io-streams</code> to download and install the package from the Hackage site. This has worked fine.  </p>\n\n<p>I have now come to writing my code. This is as follows:  </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module StreamFiles where\n\nimport System.IO.Streams.File\n\nmain:: IO ()\nmain = do \n         putStrLn \"some text here\"\n</code></pre>\n\n<p>However, when I come to run this, using the following steps:<br>\n1. Run the <code>cabal repl</code> command in the directory where the <code>.cabal-sandbox/</code> folder is located.<br>\n2. I then run the following in Powershell:  </p>\n\n<pre class=\"lang-bsh prettyprint-override\"><code>Prelude&gt; :l src/fileStreaming/streamfile.hs\n[1 of 1] Compiling StreamFile       ( src\\fileStreaming\\streamfile.hs, interpreted )\nOk, one module loaded.\n*StreamFile&gt; main\n</code></pre>\n\n<p>And get the following error:</p>\n\n<pre class=\"lang-bsh prettyprint-override\"><code>ghc.exe:  | C:\\Users\\UserName\\source\\repos\\complexHaskell\\.cabal-sandbox\\x86_64-windows-ghc-8.4.3\\network-3.0.1.0-HkosMKsQUp05NPIgp4K8kv\\HSnetwork-3.0.1.0-HkosMKsQUp05NPIgp4K8kv.o: unknown symbol `if_nametoindex'\nghc.exe: unable to load package `network-3.0.1.0'\n</code></pre>\n\n<p>And I cannot work out why. Is this a package problem or is there a step that I have missed when pulling the packages down from the Hackage site?<br>\nDo I need to create a <code>.cabal</code> file using the <code>cabal init</code> command and require some dependencies for my imports in there??</p>\n\n<p>Thanks in advance.<br>\nC.</p>\n"}, {"tags": ["haskell", "functor"], "answers": [{"tags": [], "owner": {"reputation": 3203, "user_id": 2622234, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a4b0faa804acdb74ea677bc421d5caac?s=128&d=identicon&r=PG", "display_name": "sara", "link": "https://stackoverflow.com/users/2622234/sara"}, "is_accepted": false, "score": 5, "last_activity_date": 1553268517, "creation_date": 1553268517, "answer_id": 55302979, "question_id": 55302664, "link": "https://stackoverflow.com/questions/55302664/cannot-construct-infinite-type-with-functor/55302979#55302979", "title": "Cannot construct infinite type with functor", "body": "<p>It is an infinite type because in this case, we have <code>f :: (a -&gt; b)</code> being applied to the left and right subtrees which have type <code>BTree a</code>.</p>\n\n<p>This forces that <code>a</code> is the same as <code>BTree a</code>, which would require <code>a</code> to be an infinite type (which, for the record, you can define as <code>Fix BTree</code>, where <code>Fix f = Fix (f (Fix f))</code>, which can be useful, but not what you want here!)</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 7, "last_activity_date": 1553268576, "creation_date": 1553268576, "answer_id": 55303001, "question_id": 55302664, "link": "https://stackoverflow.com/questions/55302664/cannot-construct-infinite-type-with-functor/55303001#55303001", "title": "Cannot construct infinite type with functor", "body": "<p>You are trying to apply <code>f</code> to values of type <code>a</code> (in <code>Leaf (f t)</code>) and to values of type <code>BTree a</code> (in <code>Node (f a) (f b)</code>). For this to work, the type checker needs to find some way to unify <code>a</code> and <code>BTree a</code>, which is only possible if <code>a</code> is an infinitely nested stack of <code>BTree</code> types; adding one more layer of <code>BTree</code> on top of <code>a</code> wouldn't effectively change it.</p>\n\n<p>Changing <code>Node (f a) (f b)</code> to <code>Node (fmap f a) (fmap f b)</code> ensures that <code>f</code> is <em>only</em> applied to values of type <code>a</code>.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 55303001, "answer_count": 2, "score": 1, "last_activity_date": 1553268576, "creation_date": 1553267513, "last_edit_date": 1553268149, "question_id": 55302664, "link": "https://stackoverflow.com/questions/55302664/cannot-construct-infinite-type-with-functor", "title": "Cannot construct infinite type with functor", "body": "<p>I am trying to define instances for <code>Functor</code>,<code>Applicative</code> and <code>Monad</code> for the following <code>type</code>:</p>\n\n<pre><code> data BTree a=Leaf a | Node  (BTree a) (BTree a) deriving (Eq,Show)\n</code></pre>\n\n<p>I have tried implementing the <code>Functor</code> instance like this:</p>\n\n<pre><code> instance Functor BTree where\n        fmap f (Leaf t) =Leaf (f t)\n        fmap f (Node a b) =Node (f a) (f b)\n</code></pre>\n\n<p><strong>What did work</strong></p>\n\n<pre><code>fmap f (Node a b)=Node (fmap f a) (fmap f b)\n</code></pre>\n\n<p>I understand it is not correct since being an instance of <code>functor</code> , the form has to be preserved <code>f a</code> -> <code>f b</code> (in our case <code>Node</code>).\nand in my implementation you would get  <code>f a -&gt; b</code>.</p>\n\n<p><strong>What i don't understand:</strong>\n<br><Br>Why is it an infinite type?\nConsidering <code>Node (f a )(f b)</code> somewhere down the hierarchy a child  <code>Node</code> will be <code>Leaf</code>and i will apply <code>f</code> to it.</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 1229, "user_id": 1183514, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/oO0Xu.jpg?s=128&g=1", "display_name": "boran", "link": "https://stackoverflow.com/users/1183514/boran"}, "edited": false, "score": 7, "creation_date": 1553244500, "post_id": 55295816, "comment_id": 97319962, "body": "From Richard Bird&#39;s Thinking Functionally with Haskell:   <code>Rather than deconstructing a list and then reconstructing it again (a cheap but not free operation), it is better to reuse the value that we matched with</code>"}, {"owner": {"reputation": 3203, "user_id": 2622234, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a4b0faa804acdb74ea677bc421d5caac?s=128&d=identicon&r=PG", "display_name": "sara", "link": "https://stackoverflow.com/users/2622234/sara"}, "edited": false, "score": 0, "creation_date": 1553244889, "post_id": 55295816, "comment_id": 97320178, "body": "Would ghc really reconstruct the entire list here? Seems like a trivial rewrite rule"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 5, "creation_date": 1553244991, "post_id": 55295816, "comment_id": 97320233, "body": "I think it&#39;s mainly for readability. And simple laziness of not wanting to type lots more characters. I agree the gain is minimal and perhaps debatable in this case, but what if you were deconstructing a more complex data structure."}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1553248469, "post_id": 55295816, "comment_id": 97322252, "body": "For a Haskell challange at Hackerrank I wrote a function where I had to make a distinction between an empty list and a non-empty list. So I wrote <code>[]</code> for the first part of the function and <code>(x : xs)</code> for the second part. Elegent in my opinion because this gives you two disjoint cases. However my solution didn&#39;t passed, because of time-out or memory overflow, I do not know. So I replaced <code>(x : xs)</code> by <code>xs</code> and now it passed all the tests and I officially solved the problem. Stil do not understand why."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1553257755, "post_id": 55295816, "comment_id": 97327555, "body": "Being honest: it is a micro-optimization of exactly the kind Knuth warned us all against. And yet it is a habit that we all -- including me -- are in. It produces a bizarre feeling, trying to hold these two facts in my head at the same time."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1553260129, "post_id": 55295816, "comment_id": 97328921, "body": "I disagree about it being a micro-optimization. They both have to do the work of pattern matching on the list; the big difference is in which parts of the list get names. You can&#39;t make the mistake (silly though it might be) of building an incorrect argument like <code>w:w:ws</code> for <code>length</code>, because the work of &quot;building&quot; that argument is already done on the left where you can only <i>deconstruct</i> a list, not build a new one."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1553261276, "post_id": 55295816, "comment_id": 97329701, "body": "@chepner agree. code should be clear and direct as to what it is it manipulates. rebuilding the same value obfuscates this, and yes is error prone. more likely error though would be calling <code>length ws</code>, I think."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1553356344, "post_id": 55295816, "comment_id": 97358058, "body": "So no consensus here? I see a lot of great Haskell minds here with various opinions. More concrete question: if I were to stick to <code>buildEntry&#39; (w:ws) = (w, length (w:ws))</code>, would this be in any way negative?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1553460488, "post_id": 55295816, "comment_id": 97382615, "body": "@Madderote: The only difference <i>in theory</i> is that <code>ws@(w:_)</code>\u2026<code>length ws</code> calls <code>length</code> with the pointer to the <i>original</i> <code>(:)</code> constructor of which <code>w</code> is the first field, whereas <code>(w:ws)</code>\u2026<code>length (w:ws)</code> calls <code>length</code> on a <i>new</i> <code>(:)</code> constructor with the pointers <code>w</code> and <code>ws</code> copied into its fields. But <i>in practice</i> I would expect GHC to notice that you\u2019re reusing a value that\u2019s identical to the pattern (and has the same type) and produce the same code in either case; and even if it weren\u2019t optimised, the performance difference should be negligible (just copying a few words of memory)."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1553510812, "post_id": 55295816, "comment_id": 97397138, "body": "@Jon Purdy: thanks for adding that. I did not consider that yet. I guess that if it will not jeopardise performance, I can conclude I&#39;d stick with readability in which I favour  <code>(w:ws)</code> as a pattern."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1553259896, "post_id": 55296871, "comment_id": 97328783, "body": "The first one could also be written <code>foo x@(C _ _ (D _ _) (E _ _)) = bar x</code>, letting you focus on the constructors involved, since the pattern match doesn&#39;t care about their arguments."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1553263442, "post_id": 55296871, "comment_id": 97331139, "body": "But this is just for exemplification.  I have numerous cases where I _do_use some or all of the arguments and also need to pass on the full structure in a call."}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 2, "creation_date": 1553272851, "post_id": 55296871, "comment_id": 97336838, "body": "Another important distinction is that the second version is rife with the possibility of introducing errors. The first version says that we are passing <code>x</code> in its entirety into <code>bar</code>; the second version says that we are passing something that looks like <code>x</code> into <code>bar</code> but it might differ in some ways."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1553248049, "creation_date": 1553248049, "answer_id": 55296871, "question_id": 55295816, "link": "https://stackoverflow.com/questions/55295816/haskell-why-using-as/55296871#55296871", "title": "Haskell why using @ (as)", "body": "<p>Readability is not always improved by removing the as-pattern. Compare</p>\n\n<pre><code>foo x@(C a b (D c d) (E e f)) = bar x\n</code></pre>\n\n<p>with</p>\n\n<pre><code>foo (C a b (D c d) (E e f)) = bar (C a b (D c d) (E e f))\n</code></pre>\n\n<p>I think the first one is more readable.</p>\n\n<p>Further, there might be some performance differences. As far as I know, using <code>x@(C ...)</code> and then referring to <code>x</code> later will make GHC to define <code>x</code> as a pointer to the same memory cell holding <code>(C ...)</code>. Instead, using <code>(C ...)</code> with the same arguments can allocate a new \"object\" which is a copy of the original one.</p>\n\n<p>Of course, GHC might apply a sort of CSE (common subexpression elimination) to keep only a copy around. However, since CSE is not always beneficial w.r.t. performance, GHC is quite conservative on using CSE.</p>\n\n<p>Right now, I cannot see any issues in doing that optimization in this specific case, so maybe GHC could use CSE after all. Still, I'm unsure about this.</p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1553248049, "creation_date": 1553244252, "question_id": 55295816, "link": "https://stackoverflow.com/questions/55295816/haskell-why-using-as", "title": "Haskell why using @ (as)", "body": "<p>Came across this example: </p>\n\n<pre><code>buildEntry ws@(w:_) = (w, length ws)\n</code></pre>\n\n<p>What's the advantage of using <code>ws@(w:_)</code> instead of:</p>\n\n<pre><code>buildEntry' (w:ws) = (w, length (w:ws))\n</code></pre>\n\n<p>Since I am only a beginner, I think readability of the second example is also better.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 4, "creation_date": 1553229569, "post_id": 55292970, "comment_id": 97314585, "body": "Variable names must begin with a lower case letter."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1553230002, "post_id": 55292970, "comment_id": 97314700, "body": "By the way, the word you&#39;re looking for is &quot;suit&quot;. A suite is a set of rooms, a set of musical compositions, or probably since other things (none of them related to what you mean)."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1553254068, "post_id": 55293072, "comment_id": 97325550, "body": "It&#39;s correct to say that the left-hand side of <code>&lt;-</code> is a (refutable) pattern; a variable by itself <i>is</i> a valid pattern."}, {"owner": {"reputation": 4431, "user_id": 23106, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BYY6E.png?s=128&g=1", "display_name": "Colin Barrett", "link": "https://stackoverflow.com/users/23106/colin-barrett"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1553445404, "post_id": 55293072, "comment_id": 97378054, "body": "You should look up the definition of the word &quot;or&quot; instead of trying to be pedantic. &gt;:("}], "tags": [], "owner": {"reputation": 4431, "user_id": 23106, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BYY6E.png?s=128&g=1", "display_name": "Colin Barrett", "link": "https://stackoverflow.com/users/23106/colin-barrett"}, "is_accepted": true, "score": 7, "last_activity_date": 1553253294, "last_edit_date": 1553253294, "creation_date": 1553230016, "answer_id": 55293072, "question_id": 55292970, "link": "https://stackoverflow.com/questions/55292970/haskell-error-when-creating-list-comprehension/55293072#55293072", "title": "Haskell error when creating List comprehension", "body": "<pre><code>pack :: [Card]\npack = [(Value,Suite) | Value &lt;- [Two .. A], Suite &lt;- [Hearts .. Clubs]]\n</code></pre>\n\n<p>The left hand side of <code>&lt;-</code> should be a variable (or a pattern w/ variables in it). In Haskell those start with a lowercase letter. Try this:</p>\n\n<pre><code>pack :: [Card]\npack = [(value,suite) | value &lt;- [Two .. A], suite &lt;- [Hearts .. Clubs]]\n</code></pre>\n"}], "owner": {"reputation": 1145, "user_id": 1804887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/3YA1Y.jpg?s=128&g=1", "display_name": "Gusti Arya", "link": "https://stackoverflow.com/users/1804887/gusti-arya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 55293072, "answer_count": 1, "score": -1, "last_activity_date": 1553291390, "creation_date": 1553229216, "last_edit_date": 1553291390, "question_id": 55292970, "link": "https://stackoverflow.com/questions/55292970/haskell-error-when-creating-list-comprehension", "title": "Haskell error when creating List comprehension", "body": "<p>I'm following this <a href=\"https://wiki.haskell.org/List_comprehension\" rel=\"nofollow noreferrer\">guide</a> to create a list comprehension.</p>\n\n<pre><code>data Value = Two|Three|Four|Five|Six|Seven|Eight|Nine|Ten|J|Q|K|A\n          deriving (Eq, Ord, Enum)\n\ndata Suite = Hearts | Spades | Diamonds | Clubs\n         deriving (Eq, Ord, Enum)\n\ntype Card  = (Value, Suite)\n\npack :: [Card]\npack = [(Value,Suite) | Value &lt;- [Two .. A], Suite &lt;- [Hearts .. Clubs]]\n</code></pre>\n\n<p>When I create the pack function it always throws </p>\n\n<p><code>error: Data constructor not in scope: Suite :: Suite</code></p>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 8, "last_activity_date": 1553226160, "creation_date": 1553226160, "answer_id": 55292566, "question_id": 55292493, "link": "https://stackoverflow.com/questions/55292493/how-to-get-value-from-type/55292566#55292566", "title": "How to get value from type", "body": "<p>The <code>type</code> keyword declares a new type synonim, not a new type. In your code a <code>Card</code> is just a tuple of <code>CardValue</code> and <code>Suite</code>.</p>\n\n<p>To access pair's elements either use <code>fst</code> and <code>snd</code>:</p>\n\n<pre><code>colour card = if snd card == Spades then Red else Black\n</code></pre>\n\n<p>or pattern-match the argument:</p>\n\n<pre><code>colour (value,suite) = if suite == Spades then Red else Black\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 5, "last_activity_date": 1553226758, "last_edit_date": 1553226758, "creation_date": 1553226257, "answer_id": 55292579, "question_id": 55292493, "link": "https://stackoverflow.com/questions/55292493/how-to-get-value-from-type/55292579#55292579", "title": "How to get value from type", "body": "<p><code>type Card = (CardValue, Suit)</code> makes <code>Card</code> a type alias for a tuple of <code>CardValue</code> and <code>Suit</code> data. That might not be the best data structure (a <code>data</code> member using record syntax seems better) but it's trivial to do what you want:</p>\n\n<pre><code>data Suit  = Spades | Clubs | Hearts | Diamonds\ndata Color = Red | Black\n\ntype Card  = (CardValue, Suit)\n\ngetSuitColor :: Card -&gt; Color\ngetSuitColor (_, Spades) = Black\ngetSuitColor (_, Clubs)  = Black\ngetSuitColor _           = Red\n</code></pre>\n\n<p>Or you could use guards to do the same</p>\n\n<pre><code>getSuitColor :: Card -&gt; Color\ngetSuitColor (_, suit)\n  | suit == Spades = Black\n  | suit == Clubs  = Black\n  | otherwise      = Red\n</code></pre>\n\n<p>However you'll have to use <code>deriving Eq</code> on your <code>Suit</code> to do that (since otherwise you can't <code>==</code> it!)</p>\n\n<hr>\n\n<p>If this were me I'd probably use that record syntax I mentioned above</p>\n\n<pre><code>data Card { rank :: CardValue\n          , suit :: Suit\n          }\n</code></pre>\n\n<p>Which then means you have to construct your <code>Card</code>s, as they're separate types.</p>\n\n<pre><code>myOldCard = (3, Spades)\nmyNewCard = Card 3 Spades\n</code></pre>\n\n<p>But it means you have ready-made lookups into them.</p>\n\n<pre><code>getColor :: Card -&gt; Color\ngetColor = determineColor . suit\n  where\n  determineColor :: Suit -&gt; Color\n  determineColor Spades = Black\n  determineColor Clubs  = Black\n  determineColor _      = Red\n</code></pre>\n"}], "owner": {"reputation": 1145, "user_id": 1804887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/3YA1Y.jpg?s=128&g=1", "display_name": "Gusti Arya", "link": "https://stackoverflow.com/users/1804887/gusti-arya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 55292566, "answer_count": 2, "score": -1, "last_activity_date": 1553271696, "creation_date": 1553225439, "last_edit_date": 1553271696, "question_id": 55292493, "link": "https://stackoverflow.com/questions/55292493/how-to-get-value-from-type", "title": "How to get value from type", "body": "<p>I have this type</p>\n\n<pre><code>type Card = (CardValue,Suite)\n</code></pre>\n\n<p>I want to write a function to show color based on <code>Card.Suite</code> value</p>\n\n<pre><code>colour :: Card -&gt; Colour\ncolour card = if card.Suite == Spades then Red else Black\n</code></pre>\n\n<p>This code just illustrates what I want to achieve. I don't know how to actually get suite value from <code>Card(CardValue,Suite)</code>.</p>\n"}, {"tags": ["haskell", "time", "fibonacci"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553230153, "post_id": 55291798, "comment_id": 97314730, "body": "I don&#39;t understand your note."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1553240717, "post_id": 55291798, "comment_id": 97318226, "body": "@dfeuer The note means: <code>fib</code> is linear in number of additions, but as we know addition is not constant-time on normal CPUs if the inputs are large enough. To counteract this fact, Jatin Sharma benchmarked the two implementations with a base case of <code>(0,0)</code> instead of <code>(0,1)</code>, ensuring the inputs would not grow large."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553245472, "post_id": 55291798, "comment_id": 97320490, "body": "<code>zipWith</code> is traced wrong. That should be <code>zipWith&#39; f a b = trace (&quot;Called zipWith&quot;) (zipWith f a b)</code>. But it won&#39;t make any difference, because <code>fibs</code>, <code>zipWith</code>, and <code>tail</code> are each called once. <code>(+)</code> is actually the only function called multiple times."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1553245949, "post_id": 55291798, "comment_id": 97320764, "body": "nice pictures <a href=\"https://stackoverflow.com/a/37243672/849891\">here</a>, showing a <i>linear</i> process of fleshing out the <i>one</i> list of Fibonacci numbers, top-down."}, {"owner": {"reputation": 301, "user_id": 8813267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b04da5e56cc5c45b2aa2d464a5fe9855?s=128&d=identicon&r=PG&f=1", "display_name": "Jatin Sharma", "link": "https://stackoverflow.com/users/8813267/jatin-sharma"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553254875, "post_id": 55291798, "comment_id": 97325990, "body": "@WillNess Thanks, that was very helpful indeed. How do i give a helpful comment upvote? I can&#39;t seem to find a function."}, {"owner": {"reputation": 301, "user_id": 8813267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b04da5e56cc5c45b2aa2d464a5fe9855?s=128&d=identicon&r=PG&f=1", "display_name": "Jatin Sharma", "link": "https://stackoverflow.com/users/8813267/jatin-sharma"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553254993, "post_id": 55291798, "comment_id": 97326057, "body": "@dfeuer I seem to get fibs now. Thanks a lot! Why is my zipWith trace wrong, btw?"}, {"owner": {"reputation": 301, "user_id": 8813267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b04da5e56cc5c45b2aa2d464a5fe9855?s=128&d=identicon&r=PG&f=1", "display_name": "Jatin Sharma", "link": "https://stackoverflow.com/users/8813267/jatin-sharma"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553257962, "post_id": 55291798, "comment_id": 97327672, "body": "@WillNess Can you please clarify this for me? If i go by the answer you posted, i would like to see how <code>nine = 9 : nine</code> is evaluated. Is it nine = 9 : 9 : nine =&gt; nine = 9 : 9 : 9 : 9 : nine =&gt; 9 : 9 : (8 times) : nine...  Or is it one by one? i.e. nine = 9 : 9 : nine =&gt; nine = 9 : 9 : 9 : nine ?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553258793, "post_id": 55291798, "comment_id": 97328148, "body": "(it&#39;s not <i>my</i> answer...). <code>take 2 nines = take 2 (9:nines) = 9:(take 1 nines) = 9:(take 1 (9:nines)) = 9:(9:take 0 nines) = 9:(9:[])</code>. (I also gave some answers similar to this <a href=\"https://stackoverflow.com/search?q=user%3A849891+interim+name+%5Bhaskell%5D\">before</a>)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1554918104, "post_id": 55291798, "comment_id": 97930114, "body": "@JatinSharma, sorry I never answered your question. <code>zipWith&#39; = trace (&quot;Called zipWith&quot;) zipWith</code> traces the evaluation of the <code>zipWith</code> function itself, <i>not</i> the evaluation of the result of applying it to arguments."}], "answers": [{"comments": [{"owner": {"reputation": 301, "user_id": 8813267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b04da5e56cc5c45b2aa2d464a5fe9855?s=128&d=identicon&r=PG&f=1", "display_name": "Jatin Sharma", "link": "https://stackoverflow.com/users/8813267/jatin-sharma"}, "edited": false, "score": 0, "creation_date": 1553244425, "post_id": 55292457, "comment_id": 97319934, "body": "I see, I&#39;m sorry i&#39;ve just started out, does cons mean constructor?  I&#39;ll have to think more on this with a pen paper.  Is there anyway i can see how many times each function was called? I tried using Debug.Trace (trace) but it didn&#39;t work properly for me. Apparently, they are evaluated only once (the first time) and i couldn&#39;t glean more info."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 301, "user_id": 8813267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b04da5e56cc5c45b2aa2d464a5fe9855?s=128&d=identicon&r=PG&f=1", "display_name": "Jatin Sharma", "link": "https://stackoverflow.com/users/8813267/jatin-sharma"}, "edited": false, "score": 0, "creation_date": 1553244508, "post_id": 55292457, "comment_id": 97319968, "body": "@JatinSharma, cons is the traditional name for the nonempty list constructor. That name has been used since the early days of Lisp."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 301, "user_id": 8813267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b04da5e56cc5c45b2aa2d464a5fe9855?s=128&d=identicon&r=PG&f=1", "display_name": "Jatin Sharma", "link": "https://stackoverflow.com/users/8813267/jatin-sharma"}, "edited": false, "score": 0, "creation_date": 1553244632, "post_id": 55292457, "comment_id": 97320044, "body": "@JatinSharma, tracing can be a bit subtle. I doubt I&#39;ll be able to comment meaningfully on what you tried unless you give the details (preferably by putting them in your question)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1553246171, "post_id": 55292457, "comment_id": 97320886, "body": "... and the <code>zipWith</code> that they are testing comes from a library, so it is compiled, unlike their code which is interpreted, most likely."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1553226013, "last_edit_date": 1553226013, "creation_date": 1553225078, "answer_id": 55292457, "question_id": 55291798, "link": "https://stackoverflow.com/questions/55291798/time-complexity-of-zipwith-fibonacci-in-haskell/55292457#55292457", "title": "Time complexity of zipWith fibonacci in Haskell", "body": "<p>I believe your version is slow primarily because you're running it without optimization, and so you end up building a bunch of unnecessary tuples. The partially hand-optimized (and more idiomatic) version would be</p>\n\n<pre><code>fibs = inc 0 1\n  where\n    inc a b = a : inc b (a+b)\n</code></pre>\n\n<p>Let's look at the classic:</p>\n\n<pre><code>fibs = 1 : 1 : zipWith (+) fibs (tail fibs)\n</code></pre>\n\n<p>The initial representation in memory looks very much like that. It's a list cons pointing to the number 1 and a second list cons pointing to the number 1 and a thunk representing <code>zipWith (+) fibs (tail fibs)</code>. What happens when that thunk is forced? Well <code>zipWith</code> needs to inspect both of it's list arguments. It does so, and, seeing that they're not null, produces a list cons pointing to a thunk representing <code>1+1</code> and a thunk representing <code>zipWith (+) fibs' (tail fibs')</code>, where <code>fibs'</code> is a pointer to the <em>second</em> cons in the sequence. There's no need to evaluate <code>fibs</code> again for each of the <code>zipWith</code> arguments or anything like that.</p>\n"}], "owner": {"reputation": 301, "user_id": 8813267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b04da5e56cc5c45b2aa2d464a5fe9855?s=128&d=identicon&r=PG&f=1", "display_name": "Jatin Sharma", "link": "https://stackoverflow.com/users/8813267/jatin-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "accepted_answer_id": 55292457, "answer_count": 1, "score": 2, "last_activity_date": 1553245185, "creation_date": 1553219806, "last_edit_date": 1553245185, "question_id": 55291798, "link": "https://stackoverflow.com/questions/55291798/time-complexity-of-zipwith-fibonacci-in-haskell", "title": "Time complexity of zipWith fibonacci in Haskell", "body": "<p>In Haskell, the canonical zipWith implementation of the fibonacci function is :</p>\n\n<pre><code>fibs :: [Integer]\nfibs = 1 : 1 : zipWith (+) fibs (tail fibs)\n</code></pre>\n\n<p>I have difficulty analysing the time complexity of this (fibs !! n).\nTrying to write it on paper, at first i thought it was exponential.\nThen O(n^2) , but I have no clue how it happens to be linear.</p>\n\n<p>Why i think it is linear : <a href=\"https://wiki.haskell.org/The_Fibonacci_sequence#Canonical_zipWith_implementation\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/The_Fibonacci_sequence#Canonical_zipWith_implementation</a></p>\n\n<p>Also, i wrote another code :</p>\n\n<pre><code>fibs :: [Integer]\nfibs = inc (0,1) where inc (a,b) = a : inc (b,a+b)\n</code></pre>\n\n<p>This, I believe is clearly O(n). But using the :set +s option in ghci, I see that the zipWith implementation clearly beats mine.</p>\n\n<p>Note: I know that it takes O(n) time for addition of nth and (n-1)th fibonacci number. Thus while testing, i made the base case, i.e. the first two elements 0 : 0 .\nTime complexities are mentioned using the same assumption.</p>\n\n<p>It would be great if i could get some help with tracing these function calls. I'm interested to know which function was called when and maybe print something to let me know what is going on.</p>\n\n<p>My unsuccessful attempt at this : </p>\n\n<pre><code>zipWith' = trace (\"Called zipWith\") (zipWith)\nadd' a b = trace (show a ++ \" + \" ++ (show b)) (add a b)\nfibs = trace (\"Called fibs\") (1 : 1 : zipWith (+) fibs (tail fibs))\n</code></pre>\n\n<p>This does not work. The statements are printed exactly one.\nExcept for add' which works fine, surprisingly.</p>\n\n<p>I wish to know how many times and in what order these functions were called. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1553201437, "post_id": 55288980, "comment_id": 97307449, "body": "Two applications of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:replicate\" rel=\"nofollow noreferrer\">replicate</a> would be the easiest way I think."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1553202256, "post_id": 55288980, "comment_id": 97307801, "body": "<code>zero r c = take r (repeat (take c (repeat 0)))</code>"}], "answers": [{"comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 1, "creation_date": 1553212623, "post_id": 55289743, "comment_id": 97310986, "body": "for your consideration <a href=\"https://meta.stackoverflow.com/questions/334822/how-do-i-ask-and-answer-homework-questions\" title=\"how do i ask and answer homework questions\">meta.stackoverflow.com/questions/334822/&hellip;</a>"}, {"owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1553215217, "post_id": 55289743, "comment_id": 97311555, "body": "Thanks, I thought it is such a basic question that there would be almost no difference between working code and a hint, but I&#39;ll keep that in mind for the next times"}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 1, "creation_date": 1553228395, "post_id": 55289743, "comment_id": 97314310, "body": "No worries. You bring a welcome enthusiasm, and it&#39;s appreciated. But consider if giving answers really help. Keep in mind, when someone is given the answer, without understanding, they&#39;ll lose in the end."}], "tags": [], "owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "is_accepted": false, "score": 5, "last_activity_date": 1553204808, "last_edit_date": 1592644375, "creation_date": 1553204808, "answer_id": 55289743, "question_id": 55288980, "link": "https://stackoverflow.com/questions/55288980/how-to-return-a-matrix-containing-all-zeros-in-haskell/55289743#55289743", "title": "How to return a matrix containing all zeros in Haskell", "body": "<h2>Replicate</h2>\n<p>Replicate is a prelude function with type <code>replicate :: Int -&gt; a -&gt; [a]</code>. It takes an integer and replicates something that amount of times. For your matrix, this will do the trick</p>\n<pre><code>zero row col = replicate row . replicate col $ 0\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11239824"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1553204808, "creation_date": 1553201137, "question_id": 55288980, "link": "https://stackoverflow.com/questions/55288980/how-to-return-a-matrix-containing-all-zeros-in-haskell", "title": "How to return a matrix containing all zeros in Haskell", "body": "<p>I am trying to work on this zero function. I know i can use this to print out desired number of zeros (Prelude> take 5 (repeat 0) ). \nAny help would be appreciated.</p>\n\n<p>zero :: Int -> Int -> [[Double]]\nGiven positive integers representing the rows and columns, return a matrix\nof those dimensions containing all zeros.</p>\n"}, {"tags": ["list", "haskell", "recursion"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1553181773, "post_id": 55282624, "comment_id": 97297484, "body": "The base case is only ever used if you pass an empty list as the parameter to <code>allCombinations</code>. It&#39;s never used in a recursive case."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1553186019, "post_id": 55282624, "comment_id": 97300190, "body": "i.e. it is <i>not</i> a base case but a special case, and this is not a recursion but a corecursion, which <i>never</i> stops. nice code / question. :)"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1553196049, "post_id": 55282624, "comment_id": 97305214, "body": "Side note: It&#39;s possible that this function could become much faster if you do value recursion instead of function recursion: <code>allCombinations values = let r = [] : concatMap (\\w -&gt; map (w:) values) r in r</code>.  Haven&#39;t thought it through but this is one of the more powerful optimization opportunities."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1553244895, "post_id": 55282624, "comment_id": 97320182, "body": "@luqui actually, I make the opposite claim in my (updated) answer. Haven&#39;t tested it yet, though."}], "answers": [{"comments": [{"owner": {"reputation": 395, "user_id": 11019303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2bfaec7dd8db91951fb7515a3908c60?s=128&d=identicon&r=PG&f=1", "display_name": "Sniper", "link": "https://stackoverflow.com/users/11019303/sniper"}, "edited": false, "score": 0, "creation_date": 1553181428, "post_id": 55282831, "comment_id": 97297242, "body": "Thanks for detailed answer. The real confusion was how it took the first token [ ] to do the recursive calculation. You mean if its base case is undefined in case of infinite lists it will take [ ] as default base case ? And so it append [ [ ] ] at the end of the list to carry out the calculation? and if its return an infinite list which it does, how the control was transferred to Take function  to only extract  first 7 elements from an infinite list. I am just a beginner that is why i am trying to understand this from very basic level. :/"}, {"owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "reply_to_user": {"reputation": 395, "user_id": 11019303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2bfaec7dd8db91951fb7515a3908c60?s=128&d=identicon&r=PG&f=1", "display_name": "Sniper", "link": "https://stackoverflow.com/users/11019303/sniper"}, "edited": false, "score": 0, "creation_date": 1553185737, "post_id": 55282831, "comment_id": 97300000, "body": "In Haskell it works the other way around. <code>take</code> has control, and it asks the function to compute the first 7 values. Also I edited my answer to explain that base case a bit better"}], "tags": [], "owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "is_accepted": false, "score": 8, "last_activity_date": 1553185947, "last_edit_date": 1553185947, "creation_date": 1553178782, "answer_id": 55282831, "question_id": 55282624, "link": "https://stackoverflow.com/questions/55282624/how-recursion-met-the-base-case-haskell/55282831#55282831", "title": "How recursion met the base case Haskell", "body": "<p>Short answer: it will <strong>never</strong> meet the base case.</p>\n\n<p>However, it does not need to. The base case is most often needed to stop a recursion, however here you want to return an infinite list, so no need to stop it.</p>\n\n<p>On the other hand, this function would break if you try to take more than 1 element of <code>allCombination []</code> -- have a look at @robin's answer to understand better why. That is the only reason you see a base case here.</p>\n\n<p>The way the main function works is that it starts with an empty list, and then append at the beginning each element in the argument list. (<code>:w</code>) does that recursively. However, this lambda alone would return an infinitely nested list. I.e: <code>[],[[True],[False]],[[[True,True],[True,False]</code> etc. Concatmap removes the outer list at each step, and as it is called recursively this only returns one list of lists at the end. This can be a complicated concept to grasp so look for other example of the use of <code>concatMap</code> and try to understand how they work and why <code>map</code> alone wouldn't be enough.</p>\n\n<p>This obviously only works because of Haskell lazy evaluation. Similarly, you know in a <code>foldr</code> you need to pass it the base case, however when your function is supposed to only take infinite lists, you can have <code>undefined</code> as the base case to make it more clear that finite lists should not be used. For example, <code>foldr f undefined</code> could be used instead of <code>foldr f []</code></p>\n"}, {"tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 4, "last_activity_date": 1553180949, "creation_date": 1553180949, "answer_id": 55283571, "question_id": 55282624, "link": "https://stackoverflow.com/questions/55282624/how-recursion-met-the-base-case-haskell/55283571#55283571", "title": "How recursion met the base case Haskell", "body": "<p>@Lorenzo has already explained the key point - that the recursion in fact never ends, and therefore this generates an infinite list, which you can still take any finite number of elements from because of Haskell's laziness. But I think it will be helpful to give a bit more detail about this particular function and how it works.</p>\n\n<p>Firstly, the <code>[] :</code> at the start of the definition tells you that the first element will <em>always</em> be <code>[]</code>. That of course is the one and only way to make a 0-element list from elements of <code>values</code>. The rest of the list is <code>concatMap (\\w -&gt; map (:w) values) (allCombinations values)</code>.</p>\n\n<p><code>concatMap f</code> is as you observe simply the composition <code>concat . (map f)</code>: it applies the given function to every element of the list, and concatenates the results together. Here the function (<code>\\w -&gt; map (:w) values</code>) takes a list, and produces the list of lists given by prepending each element of <code>values</code> to that list. For example, if <code>values == [1,2]</code>, then:</p>\n\n<pre><code>(\\w -&gt; map (:w) values) [1,2] == [[1,1,2], [2,1,2]]\n</code></pre>\n\n<p>if we <code>map</code> that function over a list of lists, such as</p>\n\n<pre><code>[[], [1], [2]]\n</code></pre>\n\n<p>then we get (still with <code>values</code> as <code>[1,2]</code>):</p>\n\n<pre><code>[[[1], [2]], [[1,1], [2,1]], [[1,2], [2,2]]] \n</code></pre>\n\n<p>That is of course a list of lists of lists - but then the <code>concat</code> part of <code>concatMap</code> comes to our rescue, flattening the outermost layer, and resulting in a list of lists as follows:</p>\n\n<pre><code>[[1], [2], [1,1], [2,1], [1,2], [2,2]]     \n</code></pre>\n\n<p>One thing that I hope you might have noticed about this is that the list of lists I started with was not arbitrary. <code>[[], [1], [2]]</code> is the list of all combinations of size 0 or 1 from the starting list <code>[1,2]</code>. This is in fact the first three elements of <code>allCombinations [1,2]</code>.</p>\n\n<p>Recall that all we know \"for sure\" when looking at the definition is that the first element of this list will be <code>[]</code>. And the rest of the list is <code>concatMap (\\w -&gt; map (:w) [1,2]) (allCombinations [1,2])</code>. The next step is to expand the recursive part of this as <code>[] : concatMap (\\w -&gt; map (:w) [1,2]) (allCombinations [1,2])</code>. The outer <code>concatMap</code>\nthen can see that the head of the list it's mapping over is <code>[]</code> - producing a list starting <code>[1], [2]</code> and continuing with the results of appending <code>1</code> and then <code>2</code> to the other elements - whatever they are. But we've just seen that the next 2 elements are in fact <code>[1]</code> and <code>[2]</code>. We end up with</p>\n\n<pre><code>allCombinations [1,2] == [] : [1] : [2] : concatMap (\\w -&gt; map (:w) values) [1,2] (tail (allCombinations [1,2]))\n</code></pre>\n\n<p>(<code>tail</code> isn't strictly called in the evaluation process, it's done by pattern-matching instead - I'm trying to explain more by words than explicit plodding through equalities). </p>\n\n<p>And looking at that we know the tail is <code>[1] : [2] : concatMap ...</code>. The key point is that, at each stage of the process, we know for sure what the first few elements of the list are - and they happen to be all 0-element lists with values taken from <code>values</code>, followed by all 1-element lists with these values, then all 2-element lists, and so on. Once you've got started, the process must continue, because the function passed to <code>concatMap</code> ensures that we just get the lists obtained from taking every list generated so far, and appending each element of <code>values</code> to the front of them.</p>\n\n<p>If you're still confused by this, look up how to compute the Fibonacci numbers in Haskell. The classic way to get an infinite list of all Fibonacci numbers is:</p>\n\n<pre><code>fib = 1 : 1 : zipWith (+) fib (tail fib)\n</code></pre>\n\n<p>This is a bit easier to understand that the <code>allCombinations</code> example, but relies on essentially the same thing - defining a list purely in terms of itself, but using lazy evaluation to progressively generate as much of the list as you want, according to a simple rule.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1553207583, "post_id": 55289833, "comment_id": 97309654, "body": "That first sentence really gets to the point! &quot;<i>not</i> a base case but a <i>special</i> case&quot;."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 4, "last_activity_date": 1553244814, "last_edit_date": 1553244814, "creation_date": 1553205274, "answer_id": 55289833, "question_id": 55282624, "link": "https://stackoverflow.com/questions/55282624/how-recursion-met-the-base-case-haskell/55289833#55289833", "title": "How recursion met the base case Haskell", "body": "<p>It is <em>not</em> a base case but a <em>special</em> case, and this is not recursion but <em>corecursion</em>,<sup>(<b>*</b>)</sup> which <em>never</em> stops. </p>\n\n<p>Maybe the following re-formulation will be easier to follow:</p>\n\n<pre><code>allCombs :: [t] -&gt; [[t]]\n--        [1,2] -&gt; [[]] ++ [1:[],2:[]] ++ [1:[1],2:[1],1:[2],2:[2]] ++ ...\nallCombs vals = concat . iterate (cons vals) $ [[]]\n    where\n    cons :: [t] -&gt; [[t]] -&gt; [[t]]\n    cons vals combs = concat [ [v : comb | v    &lt;- vals]\n                               |           comb &lt;- combs ]\n\n-- iterate   :: (a     -&gt; a    ) -&gt; a     -&gt; [a]\n-- cons vals ::  [[t]] -&gt; [[t]]\n-- iterate (cons vals)           :: [[t]] -&gt; [[[t]]]\n-- concat    ::                              [[ a ]] -&gt; [ a ]\n-- concat . iterate (cons vals)                      :: [[t]]\n</code></pre>\n\n<p>Looks different, does the same thing. Not just produces the same results, but actually is doing the same thing to produce them.<sup>(<b>*</b>)</sup> The <code>concat</code> is the same <code>concat</code>, you just need to tilt your head a little to see it.</p>\n\n<p>This also shows why the <code>concat</code> is needed here. Each <code>step = cons vals</code> is producing a new batch of combinations, with length increasing by 1 on each <code>step</code> application, and <code>concat</code> glues them all together into one list of results. </p>\n\n<p>The length of each batch is the previous batch length multiplied by <code>n</code> where <code>n</code> is the length of <code>vals</code>. This also shows the need to special case the <code>vals == []</code> case i.e. the <code>n == 0</code> case: <code>0*x == 0</code> and so the length of each new batch is <code>0</code> and so an attempt to get one more value from the results would never produce a result, i.e. enter an infinite loop. The function is said to become <em>non-productive</em>, at that point.</p>\n\n<p>Incidentally, <code>cons</code> is almost the same as </p>\n\n<pre><code>                   == concat [ [v : comb | comb &lt;- combs]\n                               |           v    &lt;- vals  ]\n                   == liftA2 (:) vals combs\n\nliftA2 :: Applicative f =&gt; (a -&gt; b -&gt; r) -&gt; f a -&gt; f b -&gt; f r\n</code></pre>\n\n<p>So if the internal order of each step results is unimportant to you (but see an important caveat at the post bottom) this can just be coded as</p>\n\n<pre><code>allCombsA :: [t] -&gt; [[t]]\n--         [1,2] -&gt; [[]] ++ [1:[],2:[]] ++ [1:[1],1:[2],2:[1],2:[2]] ++ ...\nallCombsA   []   =  [[]]\nallCombsA  vals  =  concat . iterate (liftA2 (:) vals) $ [[]]\n</code></pre>\n\n<hr>\n\n<p><sup>(<b>*</b>)</sup> well actually, this refers to a bit modified version of it,</p>\n\n<pre><code>allCombsRes vals = res\n             where res = [] : concatMap (\\w -&gt; map (: w) vals)\n                              res\n-- or:\nallCombsRes vals = fix $ ([] :) . concatMap (\\w -&gt; map (: w) vals)\n--  where\n--  fix g = x where x = g x     -- in Data.Function\n</code></pre>\n\n<p>Or in pseudocode: </p>\n\n<blockquote>\n<pre><code> Produce a sequence of values `res` by\n      FIRST producing `[]`, AND THEN\n      from each produced value `w` in `res`, \n          produce a batch of new values `[v : w | v &lt;- vals]`\n          and splice them into the output sequence\n               (by using  `concat`)\n</code></pre>\n</blockquote>\n\n<p>So the <code>res</code> list is produced corecursively, starting from its starting point, <code>[]</code>, producing next elements of it based on previous one(s) -- either in batches, as in <code>iterate</code>-based version, or one-by-one as here, taking the input via a back pointer into the results <em>previously</em> produced (taking its output as its input, as a saying goes -- which is a bit deceptive of course, as we take it at a <em>slower</em> pace than we're producing it, or otherwise the process would stop being <em>productive</em>, as was already mentioned above).</p>\n\n<p>But. Sometimes it can be advantageous to produce the input via recursive calls, creating at run time a sequence of functions, each passing its output up the chain, to its caller. Still, the dataflow is upwards, unlike regular recursion which first goes downward towards the base case. </p>\n\n<p>The advantage just mentioned has to do with memory retention. The corecursive <code>allCombsRes</code> as if keeps a back-pointer into the sequence that it itself is producing, and so the sequence can not be garbage-collected on the fly.</p>\n\n<p>But the chain of the stream-producers implicitly created by your original version at run time means each of them <em>can</em> be garbage-collected on the fly as <code>n = length vals</code> new elements are produced from each downstream element, so the overall process becomes equivalent to just <code>k = ceiling $ logBase n i</code> <em>nested loops</em> each with <em>O(1)</em> space state, to produce the <i>i</i>th element of the sequence.</p>\n\n<p>This is much much better than the <em>O(n)</em> memory requirement of the corecursive/value-recursive <code>allCombsRes</code> which in effect keeps a back pointer into its output at the <em><code>i/n</code></em> position. And in practice a logarithmic space requirement is most likely to be seen as a more or less <em>O(1)</em> space requirement.</p>\n\n<p>This advantage only happens with the order of generation as in your version, i.e. as in <code>cons vals</code>, not <code>liftA2 (:) vals</code> which has to go back to the start of its input sequence <code>combs</code> (for each new <code>v</code> in <code>vals</code>) which thus must be preserved, so we can safely say that the formulation in your question is rather ingenious. </p>\n\n<p>And if we're after a pointfree re-formulation -- as pointfree <em>can</em> at times be illuminating -- it is</p>\n\n<pre><code>allCombsY values =  _Y $ ([] :) . concatMap (\\w -&gt; map (: w) values)\n    where\n    _Y g = g (_Y g)      -- no-sharing fixpoint combinator\n</code></pre>\n\n<p>So the code is much easier understood in a <code>fix</code>-using formulation, and then we just switch <code>fix</code> with the semantically equivalent <code>_Y</code>,  for efficiency, getting the (equivalent of the) original code from the question.</p>\n\n<p>The above claims about space requirements behavior <a href=\"https://en.wikipedia.org/wiki/Analysis_of_algorithms%23Empirical_orders_of_growth\" rel=\"nofollow noreferrer\">are easily tested</a>. I haven't done so, yet.</p>\n\n<p>See also: </p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/a/13029529/849891\">Why does GHC make fix so confounding?</a></li>\n<li><a href=\"https://stackoverflow.com/q/53715841/849891\">Sharing vs. non-sharing fixed-point combinator</a></li>\n</ul>\n"}], "owner": {"reputation": 395, "user_id": 11019303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2bfaec7dd8db91951fb7515a3908c60?s=128&d=identicon&r=PG&f=1", "display_name": "Sniper", "link": "https://stackoverflow.com/users/11019303/sniper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 499, "favorite_count": 0, "answer_count": 3, "score": 8, "last_activity_date": 1553244814, "creation_date": 1553178219, "last_edit_date": 1553178596, "question_id": 55282624, "link": "https://stackoverflow.com/questions/55282624/how-recursion-met-the-base-case-haskell", "title": "How recursion met the base case Haskell", "body": "<p>I am trying to understand this piece of code which returns the all possible combinations of <code>[a]</code> passed to it: </p>\n\n<pre><code>-- Infinite list of all combinations for a given value domain\nallCombinations :: [a] -&gt; [[a]]\nallCombinations []     = [[]]\nallCombinations values = [] : concatMap (\\w -&gt; map (:w) values)\n                                        (allCombinations values)\n</code></pre>\n\n<p>Here i tried this sample input: </p>\n\n<pre><code>ghci&gt; take 7 (allCombinations [True,False])\n[[],[True],[False],[True,True],[False,True],[True,False],[False,False]]\n</code></pre>\n\n<p>Here it doesn't seems understandable to me which is  that how the recursion will eventually stops and will return <code>[ [ ] ]</code>,  because <code>allCombinations</code> function certainly doesn't have any pointer which moves through the list, on each call and when it meets the base case <code>[ ]</code> it returns <code>[ [ ] ]</code>. According to me It will call <code>allCombinations</code> function infinite and will never stop on its own. Or may be i am missing something? </p>\n\n<p>On the other hand, take only returns the first <code>7</code> elements from the <code>final list</code> after all calculation is carried out by going back after completing recursive calls. So actually how recursion met the base case here? </p>\n\n<p>Secondly what is the purpose of <code>concatMap</code> here, here we could also use <code>Map</code> function here just to apply function to the list and inside function we could arrange the list? What is actually <code>concatMap</code> doing here. From definition it <code>concatMap</code> tells us it first map the function then concatenate the lists where as i see we are already doing that inside the function here? </p>\n\n<p>Any valuable input would be appreciated? </p>\n"}, {"tags": ["haskell", "switch-statement", "let"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1553168872, "post_id": 55278358, "comment_id": 97289249, "body": "I think <a href=\"https://stackoverflow.com/a/33010779/3234959\">this answer</a> can help you clarify the indentation rules of Haskell. (The related question is also quite similar to yours.)"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1553186110, "post_id": 55278358, "comment_id": 97300242, "body": "&quot;a newline (which is present here) should make semicolons redundant&quot; Only when you don&#39;t have explicit braces!"}], "answers": [{"comments": [{"owner": {"reputation": 6365, "user_id": 4385532, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/0573709d0b88e4b50af0e28c3e96873b?s=128&d=identicon&r=PG&f=1", "display_name": "gaazkam", "link": "https://stackoverflow.com/users/4385532/gaazkam"}, "edited": false, "score": 0, "creation_date": 1553166606, "post_id": 55279003, "comment_id": 97287933, "body": "Umm... I&#39;m confused. Your last code snippet which you say should be working is essentially the same as my first non-working code snippet? The only difference being that you indent <code>(5, 6)</code> a few spaces more?"}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "reply_to_user": {"reputation": 6365, "user_id": 4385532, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/0573709d0b88e4b50af0e28c3e96873b?s=128&d=identicon&r=PG&f=1", "display_name": "gaazkam", "link": "https://stackoverflow.com/users/4385532/gaazkam"}, "edited": false, "score": 0, "creation_date": 1553166643, "post_id": 55279003, "comment_id": 97287959, "body": "@gaazkam It&#39;s <i>not</i> the same, note the 3rd and 4th lines are indented more"}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "reply_to_user": {"reputation": 6365, "user_id": 4385532, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/0573709d0b88e4b50af0e28c3e96873b?s=128&d=identicon&r=PG&f=1", "display_name": "gaazkam", "link": "https://stackoverflow.com/users/4385532/gaazkam"}, "edited": false, "score": 0, "creation_date": 1553166755, "post_id": 55279003, "comment_id": 97288024, "body": "@gaazkam the <code>(5,6)</code> should be indented further than the <code>res</code> rather than the <code>let</code>, subsequent definitions in the same <code>let ... in ...</code> should be indented exactly as much as the <code>res</code>"}, {"owner": {"reputation": 6365, "user_id": 4385532, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/0573709d0b88e4b50af0e28c3e96873b?s=128&d=identicon&r=PG&f=1", "display_name": "gaazkam", "link": "https://stackoverflow.com/users/4385532/gaazkam"}, "edited": false, "score": 0, "creation_date": 1553166812, "post_id": 55279003, "comment_id": 97288052, "body": "OK, finally getting it. Thank you."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 6365, "user_id": 4385532, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/0573709d0b88e4b50af0e28c3e96873b?s=128&d=identicon&r=PG&f=1", "display_name": "gaazkam", "link": "https://stackoverflow.com/users/4385532/gaazkam"}, "edited": false, "score": 0, "creation_date": 1553461293, "post_id": 55279003, "comment_id": 97382817, "body": "@gaazkam: An alternative that I prefer is to simply put a newline+indent after <code>let</code>, the same as you would with a <code>do</code> block, then the indentation is uniform."}], "tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": true, "score": 11, "last_activity_date": 1553166903, "last_edit_date": 1553166903, "creation_date": 1553166261, "answer_id": 55279003, "question_id": 55278358, "link": "https://stackoverflow.com/questions/55278358/does-a-case-expression-in-a-let-expression-require-braces-and-semicolons/55279003#55279003", "title": "Does a case expression in a let expression require braces and semicolons?", "body": "<p><a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch2.html#x7-210002.7\" rel=\"noreferrer\">From the Haskell 2010 Report</a>:</p>\n\n<blockquote>\n  <p>Informally stated, the braces and semicolons are inserted as follows. The layout (or \u201coff-side\u201d) rule takes effect whenever the open brace is omitted after the keyword where, let, do, or of. When this happens, the indentation of the next lexeme (whether or not on a new line) is remembered and the omitted open brace is inserted (the whitespace preceding the lexeme may include comments). For each subsequent line, if it contains only whitespace or is indented more, then the previous item is continued (nothing is inserted); if it is indented the same amount, then a new item begins (a semicolon is inserted); and if it is indented less, then the layout list ends (a close brace is inserted)...</p>\n  \n  <p>...Also, these rules permit:</p>\n\n<pre><code>f x = let a = 1; b = 2  \n          g y = exp2  \n       in exp1 \n</code></pre>\n</blockquote>\n\n<p>This example actually shows how you are expected to treat the indentation in Haskell, basically it's not the <em>keywords</em> that determine how indented something is, rather it is the first identifier (or other lexeme) following them, so in the case of  </p>\n\n<pre><code>b = case (n, m) of\n  (5, 6) -&gt; True\n  _ -&gt; False\n</code></pre>\n\n<p>This is fine since the 2nd and 3rd lines are indented more than the <code>b</code> in the first line, on the other hand, the following</p>\n\n<pre><code>b =\n  let res =\n    case (n, m) of\n      (5, 6) -&gt; True\n      _ -&gt; False\n  in not res\n</code></pre>\n\n<p>Is essentially parsed as</p>\n\n<pre><code>b =\n  let { res =\n    } case (n, m) of\n     { (5, 6) -&gt; True\n     ; _ -&gt; False\n  } in not res  \n</code></pre>\n\n<p>And this is because <code>case</code> isn't indented more than <code>res</code>, so it's not part of its definition.<br>\nand it's why the compiler complains about a parse error (it expects a lexeme after <code>=</code> but gets nothing, it also doesn't expect the <code>case</code> there since it doesn't fit the <code>let ... in ...</code> syntax).</p>\n\n<p>Instead you should write  </p>\n\n<pre><code>b =\n  let res =\n        case (n, m) of\n          (5, 6) -&gt; True\n          _ -&gt; False\n  in not res\n</code></pre>\n\n<p>or</p>\n\n<pre><code>b =\n  let res = case (n, m) of\n        (5, 6) -&gt; True\n        _ -&gt; False\n  in not res\n</code></pre>\n\n<p>Both of which will be parsed as you expect.</p>\n"}], "owner": {"reputation": 6365, "user_id": 4385532, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/0573709d0b88e4b50af0e28c3e96873b?s=128&d=identicon&r=PG&f=1", "display_name": "gaazkam", "link": "https://stackoverflow.com/users/4385532/gaazkam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 55279003, "answer_count": 1, "score": 6, "last_activity_date": 1553166903, "creation_date": 1553164126, "last_edit_date": 1553166479, "question_id": 55278358, "link": "https://stackoverflow.com/questions/55278358/does-a-case-expression-in-a-let-expression-require-braces-and-semicolons", "title": "Does a case expression in a let expression require braces and semicolons?", "body": "<p>I'm confused by Haskell's parsing rules.</p>\n\n<p>This works beautifuly:</p>\n\n<pre><code>n = 5\nm = 6\nb = case (n, m) of\n  (5, 6) -&gt; True\n  _ -&gt; False\n\nmain = print b\n</code></pre>\n\n<p>Let's complicate it only a teeny tiny bit, let's add a <code>let</code> to the mixture:</p>\n\n<pre><code>b =\n  let res = case (n, m) of\n    (5, 6) -&gt; True\n    _ -&gt; False\n  in not res\n</code></pre>\n\n<p>(Note, for brevity I'm omitting definitions of <code>n</code>, <code>m</code> and <code>main</code> from now on; they carry on the same, I'm only changing <code>b</code>)</p>\n\n<p>Oops, problems here:</p>\n\n<pre><code>wtf.hs:5:5: error: parse error on input \u2018(\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I don't know, maybe that's some kind of a weird indentation rule that I'm not getting. Fine, let's put explicit brackets:</p>\n\n<pre><code>b =\n  let res = case (n, m) of {\n    (5, 6) -&gt; True\n    _ -&gt; False }\n  in not res\n</code></pre>\n\n<p>Still not?!</p>\n\n<pre><code>wtf.hs:6:7: error: parse error on input \u2018-&gt;\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I'm totally confused. I don't know what to do. Why won't this work?? Let's add an explicit semicolon here, even though this is honestly a blind shot and even though I don't understand why would it be needed here, because after all, AFAIK, a newline (which is present here) should make semicolons redundant:</p>\n\n<pre><code>b =\n  let res = case (n, m) of {\n    (5, 6) -&gt; True;\n    _ -&gt; False }\n  in not res\n</code></pre>\n\n<p>And this finally works!</p>\n\n<p>... don't know, maybe the problem lies in <code>let</code> and <code>case</code> being on the same line. As a last attempt to research this myself, let's try this:</p>\n\n<pre><code>b =\n  let res =\n    case (n, m) of\n      (5, 6) -&gt; True\n      _ -&gt; False\n  in not res\n</code></pre>\n\n<p>This however won't work for reasons that are mysterious to me:</p>\n\n<pre><code>wtf.hs:5:5: error:\n    parse error (possibly incorrect indentation or mismatched brackets)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Seriously, I'm confused here. Why are explicit brackets and semicolons needed here? (And are they? Can the code be formatted in such a way that they are not needed?)</p>\n\n<p>Which obscure parsing rule of Haskell I'm not getting here?</p>\n"}, {"tags": ["haskell", "types", "currying", "dependent-type", "type-constructor"], "answers": [{"comments": [{"owner": {"reputation": 175, "user_id": 8005232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnWoD.png?s=128&g=1", "display_name": "zli", "link": "https://stackoverflow.com/users/8005232/zli"}, "edited": false, "score": 0, "creation_date": 1553215339, "post_id": 55275838, "comment_id": 97311592, "body": "thanks for the response! I&#39;m still a little lost:  1. doesn&#39;t <a href=\"https://github.com/konn/sized-vector/blob/master/Data/Vector/Sized.hs#L70-L72\" rel=\"nofollow noreferrer\"><code>Vector</code></a> take size as the second argument? maybe i&#39;m looking at the wrong source  2. in the GADT variant, I thought it should be: <code>Hand</code> is a type constructor which takes a <code>Nat</code> and yields a type which is <code>Vector Card n</code>. in the one you supplied, I&#39;m reading it as <code>Hand</code> is a type constructor which takes a <code>Nat</code>, and a <code>Vector</code> of <code>Card</code>s, and yields a type <code>Hand n</code>. I think I may have a fundamental misunderstanding somewhere..."}, {"owner": {"reputation": 175, "user_id": 8005232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnWoD.png?s=128&g=1", "display_name": "zli", "link": "https://stackoverflow.com/users/8005232/zli"}, "edited": false, "score": 0, "creation_date": 1553236614, "post_id": 55275838, "comment_id": 97316676, "body": "or perhaps my intent isn&#39;t too clear: can I make a type constructor <code>Hand</code> which takes a type-level natural number <code>n</code>, and returns a <code>n</code>-sized <code>Vector</code> of <code>Card</code>s?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 175, "user_id": 8005232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnWoD.png?s=128&g=1", "display_name": "zli", "link": "https://stackoverflow.com/users/8005232/zli"}, "edited": false, "score": 1, "creation_date": 1553238451, "post_id": 55275838, "comment_id": 97317289, "body": "@zii, a constructor constructs the type being defined.  So the <code>Hand</code> constructor can only construct objects of type <code>Hand</code>.  You can make a <i>function</i> which takes a <code>SNat n</code> and returns a <code>Vector n Card</code>, say one that gives you <code>n</code> aces.  Is that what you meant?  What is your intended purpose of this constructor -- how would you use it?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 175, "user_id": 8005232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnWoD.png?s=128&g=1", "display_name": "zli", "link": "https://stackoverflow.com/users/8005232/zli"}, "edited": false, "score": 0, "creation_date": 1553238591, "post_id": 55275838, "comment_id": 97317344, "body": "@zii as for the order of the arguments, not sure what&#39;s going on there.  It&#39;s <code>Vector a n</code> in the one you linked, but the same package <a href=\"http://hackage.haskell.org/package/vector-sized-1.2.0.0/docs/Data-Vector-Sized.html\" rel=\"nofollow noreferrer\">on hackage</a> it&#39;s <code>Vector n a</code>.  Huh."}, {"owner": {"reputation": 175, "user_id": 8005232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnWoD.png?s=128&g=1", "display_name": "zli", "link": "https://stackoverflow.com/users/8005232/zli"}, "edited": false, "score": 0, "creation_date": 1553296364, "post_id": 55275838, "comment_id": 97345919, "body": "i think i just want a type <code>Hand n</code> which is the exact same type as <code>Vector Card n</code>. my thought process was: <code>Hand</code> takes a type <code>Nat</code> and gives me a type that&#39;s the same as <code>Vector Card n</code>, so I can write the <code>Hand</code> constructor with the GADT, but that&#39;s probably where I went wrong."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 5, "last_activity_date": 1553154641, "creation_date": 1553154641, "answer_id": 55275838, "question_id": 55275599, "link": "https://stackoverflow.com/questions/55275599/type-constructor-currying-trying-to-create-a-data-constructor-accepting-one-ty/55275838#55275838", "title": "type constructor currying? (trying to create a data constructor accepting one type from another data constructor accepting two types)", "body": "<p><code>Vector</code> from <code>Data.Vector.Sized</code> takes the size as the <em>first</em> argument, not the second, unlike in the linked tutorial.  So you need</p>\n\n<pre><code>type Hand n = Vector n Card\n</code></pre>\n\n<p>As for your GADT variant, you are simply missing the result type of the constructor.</p>\n\n<pre><code>data Hand (n :: Nat) where\n    Hand :: SNat n -&gt; Vector n Card -&gt; Hand n\n                                   ^^^^^^^^^^\n</code></pre>\n\n<p>GADT constructor types always need a codomain of whatever type they are defining.  That said, I think the <code>SNat</code> here is unnecessary -- if the information of how many cards are in the hand comes from outside, there's no reason to hold onto it inside also.</p>\n"}], "owner": {"reputation": 175, "user_id": 8005232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnWoD.png?s=128&g=1", "display_name": "zli", "link": "https://stackoverflow.com/users/8005232/zli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1553154641, "creation_date": 1553153545, "question_id": 55275599, "link": "https://stackoverflow.com/questions/55275599/type-constructor-currying-trying-to-create-a-data-constructor-accepting-one-ty", "title": "type constructor currying? (trying to create a data constructor accepting one type from another data constructor accepting two types)", "body": "<p>I'm just starting to learn Haskell, and I'm trying to put it to practice by making a card game. I'm trying to create a type \"Hand\" which represents a fixed sized Vector of cards (using sized vectors as described here: <a href=\"https://www.schoolofhaskell.com/user/konn/prove-your-haskell-for-great-safety/dependent-types-in-haskell\" rel=\"nofollow noreferrer\">https://www.schoolofhaskell.com/user/konn/prove-your-haskell-for-great-safety/dependent-types-in-haskell</a>)</p>\n\n<p>I've had a few attempts at this, but none of them have worked:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs, KindSignatures, DataKinds, PolyKinds #-}\n{-# LANGUAGE TypeFamilies, ScopedTypeVariables #-}\n\nimport Data.Type.Natural\nimport Data.Vector.Sized (Vector)\nimport Card -- | I have the Card type defined in another file\n\ndata Hand (n :: Nat) where\n    Hand :: SNat n -&gt; Vector Card n\n\n{- fails with:\n* Data constructor 'Hand' returns type 'Vector Card n'\n    instead of an instance of its parent type 'Hand n'\n* In the definition of data constructor 'Hand'\n  In the data type declaration for 'Hand'\n-}\n\ntype Hand = Vector Card\n\n{- compiles, but it doesn't work as expected:\nghci&gt; :k Hand\nHand :: *\n(whereas I'd expect 'Hand :: Nat -&gt; Vector Card Nat' or something)\n-}\n</code></pre>\n\n<p>I'm not really sure what to call this, it seems something like type constructor currying to me, but maybe I'm completely wrong. I haven't been able to find something similar online. Thanks in advance for the help!</p>\n"}, {"tags": ["haskell", "testing", "chess"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553147832, "post_id": 55274437, "comment_id": 97279497, "body": "Those last two look really good. The first one also has potential. The rest look a bit specific to me; I&#39;d only stick those in a test suite as regression tests after I fixed a bug."}, {"owner": {"reputation": 441, "user_id": 7919572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7180a29a1e3cbca63bc706c4c7414a6?s=128&d=identicon&r=PG&f=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/7919572/marc"}, "edited": false, "score": 0, "creation_date": 1553147922, "post_id": 55274437, "comment_id": 97279529, "body": "Ok, but for doing this would I not need to simulate an entire board, basically reimplementing the program twice? Usually we want the model to be some simpler version that is different from the original implementation right? For example a queue can be tested using only an int checking it&#39;s size, so we would want someting similar here?   &quot; move should only involve positions actually on the board. &quot; This one would be possible to test knowing only the bounds of the board so that should be possible."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1553148143, "post_id": 55274437, "comment_id": 97279596, "body": "Just use your real board. Why do you think you need a fake, model board? Test that, for any board, for any move that board offers, that move satisfies your properties."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1553148244, "post_id": 55274437, "comment_id": 97279621, "body": "@dfeuer Reasonable. I was brainstorming here, writing down anything I thought of regardless of how useful it sounds, to emphasize that this is a useful process for deriving properties. (A better version of the knight property is that a knight&#39;s move always takes it to a different-color square)"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 7, "last_activity_date": 1553147259, "creation_date": 1553147259, "answer_id": 55274437, "question_id": 55274003, "link": "https://stackoverflow.com/questions/55274003/property-based-testing-for-a-chess-game/55274437#55274437", "title": "Property-based testing for a chess game", "body": "<p>Start by just saying some obvious things that are true about real-life chess boards, no matter how dumb they sound. Many of those will be reasonable properties to test. Here are some ideas:</p>\n\n<ul>\n<li>When you move a piece, it moves from the place where it was to the place where the move puts it. </li>\n<li>No legal knight move is ever a legal pawn move.</li>\n<li>A pawn never moves more than two squares at once.</li>\n<li>A knight never moves adjacent to its starting position. </li>\n<li>A move should only involve positions actually on the board. </li>\n<li>Moving onto another piece decreases the number of pieces on the board.</li>\n</ul>\n\n<p>Many more ideas like this exist. They seem simple, but I guarantee your early implementations will miss some of them. Figure out how to write these invariants as properties, and grow your test suite from there.</p>\n"}], "owner": {"reputation": 441, "user_id": 7919572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7180a29a1e3cbca63bc706c4c7414a6?s=128&d=identicon&r=PG&f=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/7919572/marc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 55274437, "answer_count": 1, "score": 2, "last_activity_date": 1553147259, "creation_date": 1553144133, "question_id": 55274003, "link": "https://stackoverflow.com/questions/55274003/property-based-testing-for-a-chess-game", "title": "Property-based testing for a chess game", "body": "<p>I'm trying to wrap my mind around property-based testing and chess. Currently I represent my chess game as a 2d-array and the only pieces I have implemented are pawns and knights for grokking this. </p>\n\n<p>The pawn and knight represent their moves as the set of <code>allMoves(x,y) \\ invalidMoves(board,x,y)</code>. So one property I can think of is to test that <code>allMoves(x,y) \u222a invalidMoves(board,x,y) === allMoves</code>. But beyond that I'm not sure what else to test. I assume that I need to set up a simplified oracle model for the chess board but I'm not sure what such a model would be.</p>\n"}, {"tags": ["haskell", "installation", "cabal", "idris"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1553233952, "post_id": 55273831, "comment_id": 97315861, "body": "Does it work if you try with Stack? You can run <code>stack install --resolver lts-12.26 idris</code>. I chose that resolver based on the information on this page: <a href=\"https://www.stackage.org/package/idris\" rel=\"nofollow noreferrer\">stackage.org/package/idris</a>"}, {"owner": {"reputation": 199, "user_id": 9227540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IafJU.jpg?s=128&g=1", "display_name": "Algeboy", "link": "https://stackoverflow.com/users/9227540/algeboy"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1553398531, "post_id": 55273831, "comment_id": 97367845, "body": "This came close (I think) but failed in the last step hit same issued documented [here](<a href=\"https://github.com/commercialhaskell/stack/issues/3089\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/3089</a> ). More to figure out."}], "answers": [{"comments": [{"owner": {"reputation": 199, "user_id": 9227540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IafJU.jpg?s=128&g=1", "display_name": "Algeboy", "link": "https://stackoverflow.com/users/9227540/algeboy"}, "edited": false, "score": 0, "creation_date": 1553219821, "post_id": 55276636, "comment_id": 97312551, "body": "yeah, I tried new- versions but they hit the same issue.  It seems <code>removeDirectoryRecursive</code> throws up its hands and whatever program is calling it isn&#39;t prepared to handle that. I wouldn&#39;t even care to have the temp files stay and not be deleted if I could get the rest to run."}], "tags": [], "owner": {"reputation": 104, "user_id": 826753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d32bda212d90f3d131b7f7781f8ac0b?s=128&d=identicon&r=PG&f=1", "display_name": "Jens Petersen", "link": "https://stackoverflow.com/users/826753/jens-petersen"}, "is_accepted": false, "score": 0, "last_activity_date": 1553158137, "creation_date": 1553158137, "answer_id": 55276636, "question_id": 55273831, "link": "https://stackoverflow.com/questions/55273831/idris-cabal-install-issues-from-removepathrecursive-on-windows/55276636#55276636", "title": "Idris/cabal install issues from removePathRecursive on Windows", "body": "<p>You could try using <code>cabal new-build</code> or <code>cabal new-install</code>, but I am not sure if that will work.</p>\n"}, {"tags": [], "owner": {"reputation": 199, "user_id": 9227540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IafJU.jpg?s=128&g=1", "display_name": "Algeboy", "link": "https://stackoverflow.com/users/9227540/algeboy"}, "is_accepted": true, "score": 1, "last_activity_date": 1553399073, "creation_date": 1553399073, "answer_id": 55320547, "question_id": 55273831, "link": "https://stackoverflow.com/questions/55273831/idris-cabal-install-issues-from-removepathrecursive-on-windows/55320547#55320547", "title": "Idris/cabal install issues from removePathRecursive on Windows", "body": "<p>This is mostly to record the steps that worked, thanks to Michael Sonyman for the major tip.</p>\n\n<p>Steps to follow.</p>\n\n<ol>\n<li>Install Haskell (with Stack) following <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow noreferrer\">this</a></li>\n<li>Replace <code>,</code> with <code>;</code> in multiline paths of config files as reported by @gergelybat in <a href=\"https://stackoverflow.com/questions/31146531/cabal-install-error-the-package-has-a-configure-script-this-requires-a-uni\">this</a></li>\n<li>Check that you have a version of make by checking <code>stack exec -- which make</code> \n\n<ul>\n<li>if you get <code>no make</code> then install <a href=\"http://gnuwin32.sourceforge.net/packages/make.htm\" rel=\"nofollow noreferrer\">GnuWin32</a>, </li>\n<li>ensure that the install directory for (e.g. <code>c:\\Program Files (x86)\\GnuWin32\\bin</code> is added to your system path (follow \"set environment variables\").  </li>\n<li>Restart PowerShell/Command prompt, retry step 3, you should see a make found, if not recheck your steps.</li>\n</ul></li>\n<li>Run <code>stack install --resolver lts-12.26 idris</code> \u2026 this may be very slow.  It ends by copying the Idris compiler and other items to <code>C:\\Users\\you\\AppData\\Roaming\\local\\bin:</code></li>\n<li>Test by typing <code>idris</code> at prompt, it should load the Idris REPL.</li>\n</ol>\n\n<p>Enjoy dependent typing for the rest of your programming life.</p>\n"}], "owner": {"reputation": 199, "user_id": 9227540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IafJU.jpg?s=128&g=1", "display_name": "Algeboy", "link": "https://stackoverflow.com/users/9227540/algeboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 55320547, "answer_count": 2, "score": 0, "last_activity_date": 1553399073, "creation_date": 1553142665, "question_id": 55273831, "link": "https://stackoverflow.com/questions/55273831/idris-cabal-install-issues-from-removepathrecursive-on-windows", "title": "Idris/cabal install issues from removePathRecursive on Windows", "body": "<p>Installing Idris on Windows 10 using instructions to:</p>\n\n<ul>\n<li>Install Haskell following <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow noreferrer\">this</a></li>\n<li>Replaced <code>,</code> with <code>;</code> in multiline paths of config files as reported by @gergelybat in <a href=\"https://stackoverflow.com/questions/31146531/cabal-install-error-the-package-has-a-configure-script-this-requires-a-uni\">this</a></li>\n</ul>\n\n<pre><code>c:\\Users\\me\\cabal update\nc:\\Users\\me\\cabal install idris\n</code></pre>\n\n<p>Several dependency errors arise, I follow Idris' instructions to apply with blind faith the following further flags</p>\n\n<pre><code>----reinstall       \n--avoid-reinstalls  \n--force-reinstalls  \n--upgrade-dependencies\n</code></pre>\n\n<p>Progress is made things begin to be built, we get all the way to building a temp directory with something called <code>idris-1.3.1\\\u2026\\setup.exe</code>\nThen we crash with following error:</p>\n\n<pre><code>C:\\Users\\me\\AppData\\Local\\Temp\\cabal-tmp-26128\\idris-1.3.1\\dist\\setup: removeDirectoryRecursive:\n\u2026\": unsatisfied constraints (The directory is not empty.)\n</code></pre>\n\n<p>Googling this I find this same error happens across cabal installs and logged as issues on oodles of GitHub projects.  Theories are all over the map and no solutions provided.  The Haskell documentation on <code>removeDirectoryRecursive</code> offers a clue ending with the remark that this fails on Windows if the directory is a symbolic-link.</p>\n\n<p>How does one get past this problem to finish an install?</p>\n"}]