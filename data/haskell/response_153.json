[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1513205876, "post_id": 47803310, "comment_id": 82568165, "body": "<code>whileM_</code> is definitely the wrong function for you! You can write this by hand using recursion pretty easily, or go searching for a function that fits your purpose better."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1513207394, "post_id": 47803590, "comment_id": 82568627, "body": "For this purpose, strict <code>StateT</code> seems more reasonable than lazy, but I think anything in that direction is overkill."}, {"owner": {"reputation": 1581, "user_id": 2319806, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4aeddf919979c1ade0de68de94fc3b88?s=128&d=identicon&r=PG", "display_name": "ericky", "link": "https://stackoverflow.com/users/2319806/ericky"}, "edited": false, "score": 0, "creation_date": 1513280950, "post_id": 47803590, "comment_id": 82604435, "body": "I was unaware of <code>whileJust_</code> and it seems the right tool for the job. Thank you for suggesting it."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1513207220, "creation_date": 1513207220, "answer_id": 47803590, "question_id": 47803310, "link": "https://stackoverflow.com/questions/47803310/haskell-whilem-variable-scope/47803590#47803590", "title": "Haskell: whileM_ variable scope?", "body": "<p><code>whileM_</code> doesn't have a built-in way of achieving this. That combinator is really a bit limiting; as dfeuer says you should probably just write the loop yourself using recursion. Or, use the loop construct that actually has support for this kind of information transfer:</p>\n\n<pre><code>guess :: IO ()\nguess = do\n  putStrLn \"Please input your guess.\"\n  whileJust_\n    (do\n      lastGuess &lt;- getLine  -- don't use the name `guess` if that's already a global function name!\n      return $ if lastGuess /= \"secret\"\n                them Just lastGuess else Nothing )\n    (\\lastGuess -&gt; do\n      putStrLn $ \"You guessed: \" ++ lastGuess\n      putStrLn $ \"And \" ++ lastGuess ++ \" is wrong.\" )\n  putStrLn \"Right - Bye...\"\n</code></pre>\n\n<p>However you <em>can</em> also communicate values between the condition- and execution parts of <code>whileM_</code>. Two options:</p>\n\n<ul>\n<li><p>Specifically in <code>IO</code>, you can always use <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-IORef.html\" rel=\"nofollow noreferrer\"><code>IORef</code>s</a>.</p>\n\n<pre><code>guess :: IO ()\nguess = do\n  putStrLn \"Please input your guess.\"\n  bestGuess &lt;- newIORef \"\"\n  whileM_\n    (do lastGuess &lt;- getLine\n        writeIORef bestGuess lastGuess\n        return $ lastGuess /= \"secret\" )\n    (do lastGuess &lt;- readIORef bestGuess\n        putStrLn $ \"You guessed: \" ++ lastGuess\n        putStrLn $ \"And \" ++ lasyGuess ++ \" is wrong.\" )\n  putStrLn \"Right - Bye...\"\n</code></pre>\n\n<p>This is rather eschewed in Haskell &ndash; an <code>IORef</code> is basically a mutable variable &ndash; but sometimes it's sensible. Definitely not a good idea here.</p></li>\n<li><p>You can instead of <code>IO</code> use a dedicated monad with a pure-functional state variable. That requires <a href=\"http://hackage.haskell.org/package/transformers-0.5.5.0/docs/Control-Monad-Trans-State-Lazy.html#t:StateT\" rel=\"nofollow noreferrer\">a monad transformer</a>. It's a slightly advanced technique, but for complex application can work out extremely well.</p></li>\n</ul>\n"}], "owner": {"reputation": 1581, "user_id": 2319806, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4aeddf919979c1ade0de68de94fc3b88?s=128&d=identicon&r=PG", "display_name": "ericky", "link": "https://stackoverflow.com/users/2319806/ericky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 47803590, "answer_count": 1, "score": 1, "last_activity_date": 1513207220, "creation_date": 1513205484, "last_edit_date": 1513205934, "question_id": 47803310, "link": "https://stackoverflow.com/questions/47803310/haskell-whilem-variable-scope", "title": "Haskell: whileM_ variable scope?", "body": "<p>How can I use a variable scoped in the <code>Bool</code> section of <code>whileM_</code> later in its body?</p>\n\n<p>For example:</p>\n\n<pre><code>guess :: IO ()\nguess = do\n  putStrLn \"Please input your guess.\"\n  whileM_\n    (do\n      guess &lt;- getLine\n      return (guess /= \"secret\"))\n    (do\n      putStrLn (\"You guessed: \" ++ guess)\n      putStrLn (\"And \" ++ guess ++ \" is wrong.\"))\n  putStrLn \"Right - Bye...\"\n</code></pre>\n\n<p><code>guess</code> is not in scope in the second <code>do</code> block so unavailable for use.</p>\n\n<p>How can I bring it into scope?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "type-inference"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 12, "last_activity_date": 1513205664, "creation_date": 1513205664, "answer_id": 47803334, "question_id": 47803288, "link": "https://stackoverflow.com/questions/47803288/how-to-read-haskell-type-signature/47803334#47803334", "title": "how to read haskell type signature?", "body": "<pre><code>jkl :: Num b =&gt; [b] -&gt; ([b] -&gt; t) -&gt; b -&gt; t\n</code></pre>\n\n<p>Whoever calls <code>jkl</code> has to</p>\n\n<ul>\n<li>choose types <code>b</code> and <code>t</code></li>\n<li>guarantee that <code>b</code> was chosen among numeric types (the <code>Num b</code> constraint)</li>\n<li>pass a <code>[b]</code> (list of <code>b</code>) as first argument</li>\n<li>pass a function <code>[b] -&gt; t</code> as second argument (i.e. taking <code>[b]</code> and returning a <code>t</code>)</li>\n<li>pass a <code>b</code> as third argument</li>\n<li>receive <code>t</code> back as a final result</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": false, "score": 7, "last_activity_date": 1513205757, "creation_date": 1513205757, "answer_id": 47803356, "question_id": 47803288, "link": "https://stackoverflow.com/questions/47803288/how-to-read-haskell-type-signature/47803356#47803356", "title": "how to read haskell type signature?", "body": "<p>Whatever is between the double colon <code>::</code> and the fat arrow <code>=&gt;</code> is called <em>constraints</em>. In this case, you have one constraint: <code>Num b</code>. This constraint demands that, whatever type <code>b</code> turns out to be, it must be an instance of type class <code>Num</code>.</p>\n\n<p>After the fat arrow, you get types of function parameters, and at the very end type of its result.</p>\n\n<p>Parameters:</p>\n\n<ol>\n<li><code>[b]</code> - a list of values of type <code>b</code>, whatever that is.</li>\n<li><code>[b] -&gt; t</code> - a function that takes a list of <code>b</code> and produces a single <code>t</code>.</li>\n<li><code>b</code> - a single value of type <code>b</code>.</li>\n</ol>\n\n<p>And finally, function result is <code>t</code>.</p>\n"}], "owner": {"reputation": 25, "user_id": 8813171, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb888d6bee85c0bde4e18c6531a56570?s=128&d=identicon&r=PG&f=1", "display_name": "Don Metro", "link": "https://stackoverflow.com/users/8813171/don-metro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 1, "accepted_answer_id": 47803334, "answer_count": 2, "score": 2, "last_activity_date": 1513205757, "creation_date": 1513205336, "question_id": 47803288, "link": "https://stackoverflow.com/questions/47803288/how-to-read-haskell-type-signature", "title": "how to read haskell type signature?", "body": "<p>So I put this statement on my ghci</p>\n\n<pre><code>jkl x f y = f (map (+y) x)\n</code></pre>\n\n<p>And I got this out put back.</p>\n\n<pre><code>jkl :: Num b =&gt; [b] -&gt; ([b] -&gt; t) -&gt; b -&gt; t\n</code></pre>\n\n<p>But I'm confused when I read it. From my understanding jkl is type num that takes [b], [b] and t, and b. in the end it will output t. is that the right way to read it? </p>\n"}, {"tags": ["haskell", "elm"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1513190781, "post_id": 47800046, "comment_id": 82561343, "body": "<a href=\"https://stackoverflow.com/a/42370593/3234959\">Potentially relevant</a>"}], "answers": [{"tags": [], "owner": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "is_accepted": false, "score": 2, "last_activity_date": 1513191676, "creation_date": 1513191676, "answer_id": 47800359, "question_id": 47800046, "link": "https://stackoverflow.com/questions/47800046/augmenting-type-aliases-in-elm-or-haskell/47800359#47800359", "title": "Augmenting type aliases in elm or haskell", "body": "<p>The short answer is no, but there are some things you can do that go in the direction you want:</p>\n\n<p>Have a single type but make the extra info 'optional'</p>\n\n<pre><code>type alias Cat =\n  { color : String\n  , age : Int \n  , name : String\n  , breed : String\n  , feral : Maybe Bool\n  , spayed : Maybe Bool\n } \n</code></pre>\n\n<p>When you want to pass CatComplex to a function that only uses the Cat fields you could define a Type</p>\n\n<pre><code> type alias CatGeneric a =       \n    { a| \n          color : String\n          , age : Int \n          , name : String\n          , breed : String \n      }\n</code></pre>\n\n<p>then </p>\n\n<pre><code>fn : CatGeneric a -&gt; Bool \n....\n</code></pre>\n\n<p>and this should type check if you pass either a Cat or a CatComplex</p>\n"}, {"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 7, "last_activity_date": 1513193108, "last_edit_date": 1513193108, "creation_date": 1513192119, "answer_id": 47800481, "question_id": 47800046, "link": "https://stackoverflow.com/questions/47800046/augmenting-type-aliases-in-elm-or-haskell/47800481#47800481", "title": "Augmenting type aliases in elm or haskell", "body": "<p>You can use extensible records in Elm to define a rudimentary sort of field composition:</p>\n\n\n\n<pre class=\"lang-elm prettyprint-override\"><code>type alias Cat c =\n    { c\n        | color : String\n        , age : Int\n        , name : String\n        , breed : String\n    }\n\ntype alias FeralCat =\n    Cat\n        { feral : Bool\n        , spayed : Bool\n        }\n</code></pre>\n\n<p>Here's an example of how it could be used:</p>\n\n<pre class=\"lang-elm prettyprint-override\"><code>feralCatSummary : FeralCat -&gt; String\nferalCatSummary { color, feral } =\n    color ++ \"; Feral? \" ++ toString feral\n\nmain : Html msg\nmain =\n    text &lt;|\n        feralCatSummary\n            { color = \"Blue\"\n            , age = 5\n            , name = \"Billy\"\n            , breed = \"Bluecat\"\n            , feral = True\n            , spayed = False\n            }\n</code></pre>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 47800481, "answer_count": 2, "score": 2, "last_activity_date": 1513193108, "creation_date": 1513190508, "question_id": 47800046, "link": "https://stackoverflow.com/questions/47800046/augmenting-type-aliases-in-elm-or-haskell", "title": "Augmenting type aliases in elm or haskell", "body": "<p>Say I have a type in elm (0.18) like this:</p>\n\n<pre><code>type alias CatSimple = \n  { color : String\n  , age : Int \n  , name : String\n  , breed : String\n}\n</code></pre>\n\n<p>My project requires that I also have a type that has all the fields of the previous one, but with a few additional fields:</p>\n\n<pre><code>type alias CatComplex =\n  { color : String\n  , age : Int \n  , name : String\n  , breed : String\n  , feral : Bool\n  , spayed : Bool\n} \n</code></pre>\n\n<p>Now let's say that I need to add another field to <code>CatSimple</code>.  I would have to remember to add it to <code>CatComplex</code> as well.</p>\n\n<p>I would like to be able to dynamically augment my types so that I can avoid having to update all of them, or having to resort to something like this:</p>\n\n<pre><code>type alias CatComplex =\n  { simpleData: CatSimple\n  , feral : Bool\n  , spayed : Bool\n} \n</code></pre>\n\n<p>Is there any way to do that in Elm?</p>\n\n<p>If not, does Haskell provide a way to do this?</p>\n"}, {"tags": ["haskell", "currying"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1513178815, "post_id": 47796375, "comment_id": 82554146, "body": "<a href=\"http://pointfree.io\" rel=\"nofollow noreferrer\">pointfree.io</a> suggests <code>f = ((reverse . join) .) . flip buckets 9</code>."}, {"owner": {"reputation": 438, "user_id": 6371869, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mUzus.jpg?s=128&g=1", "display_name": "Shadasviar", "link": "https://stackoverflow.com/users/6371869/shadasviar"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1513179312, "post_id": 47796375, "comment_id": 82554465, "body": "@MarkSeemann this works, thanks"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1513179300, "creation_date": 1513179300, "answer_id": 47796853, "question_id": 47796375, "link": "https://stackoverflow.com/questions/47796375/how-to-curry-function-with-two-parameters-in-haskell/47796853#47796853", "title": "How to curry function with two parameters in Haskell", "body": "<p>First: I recommend not to use <code>flip</code> just to apply a function partially to its second argument; this can be done better with an infix section. (Or, perhaps the arguments of <code>bucket</code> should be the other way around in the first place?)</p>\n\n<p>So, you want to make</p>\n\n<pre><code>f lst = reverse . concat . (`buckets`9) lst\n</code></pre>\n\n<p>pointfree. The problem is that you need to pass two arguments to the rightmost element in the composition chain. One way to do this is to use <em>uncurried</em> form (because then those two arguments come in just a single value):</p>\n\n<pre><code>f = curry $ reverse . concat . uncurry (`buckets`9)\n</code></pre>\n\n<p>An alternative is to use specialised combinators. The <a href=\"http://hackage.haskell.org/package/pointless-fun-1.1.0.6/docs/Data-Function-Pointless.html#v:.:\" rel=\"nofollow noreferrer\"><code>pointless-fun</code> package has this</a>:</p>\n\n<pre><code>f = reverse . concat .: (`buckets`9)\n</code></pre>\n\n<p>A more standard, though IMO rather ugly alternative is to use the function-functor: you can map over a function, which corresponds to composing after it:</p>\n\n<pre><code>f = fmap (reverse . concat) . (`buckets`9)\n</code></pre>\n\n<p>The best alternative frankly is to keep that parameter named:</p>\n\n<pre><code>basketsort lst = foldl (\\l -&gt; reverse . concat . buckets l 9) lst [1..3] \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 4, "last_activity_date": 1513179435, "creation_date": 1513179435, "answer_id": 47796903, "question_id": 47796375, "link": "https://stackoverflow.com/questions/47796375/how-to-curry-function-with-two-parameters-in-haskell/47796903#47796903", "title": "How to curry function with two parameters in Haskell", "body": "<p>If you expand the second application of the dot operator:</p>\n\n<pre><code>    f lst = reverse . concat . (flip buckets 9) lst\n==&gt; f lst = (.) (reverse . concat) ((flip buckets 9) lst)\n</code></pre>\n\n<p>then the eta-reduction becomes obvious:</p>\n\n<pre><code>    f = (.) (reverse . concat) . (flip buckets 9)\n</code></pre>\n\n<p>But come on, do you really want to do that? Not a very nice present for whoever is going to maintain your code after you're gone.</p>\n"}], "owner": {"reputation": 438, "user_id": 6371869, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mUzus.jpg?s=128&g=1", "display_name": "Shadasviar", "link": "https://stackoverflow.com/users/6371869/shadasviar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "accepted_answer_id": 47796903, "answer_count": 2, "score": 1, "last_activity_date": 1513184477, "creation_date": 1513177926, "last_edit_date": 1513184477, "question_id": 47796375, "link": "https://stackoverflow.com/questions/47796375/how-to-curry-function-with-two-parameters-in-haskell", "title": "How to curry function with two parameters in Haskell", "body": "<p>I have a function <code>buckets</code> with type <code>Integral a =&gt; [a] -&gt; Int -&gt; Int -&gt; [[a]]</code> and I want use it in <code>foldl</code> in this way:</p>\n\n<pre><code>basketsort lst = foldl (f) lst [1..3]\nf lst = reverse . concat . (flip buckets 9) lst\n</code></pre>\n\n<p>The function <code>f</code> works, and has a type <code>Integral a =&gt; [a] -&gt; Int -&gt; [a]</code>, but if I reduce <code>lst</code> parameter, compilation fails.</p>\n\n<p>Is it possible to reduce more than one parameter by currying and use <code>f</code>'s body in foldl without declaration of <code>f</code>? Something like this:</p>\n\n<pre><code>basketsort lst = foldl (reverse . concat . (flip buckets 9)) lst [1..3] \n</code></pre>\n"}, {"tags": ["haskell", "dependency-management", "hackage"], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1513176177, "creation_date": 1513176177, "answer_id": 47795724, "question_id": 47795127, "link": "https://stackoverflow.com/questions/47795127/how-do-i-determine-reasonable-package-dependency-bounds-when-releasing-a-haskell/47795724#47795724", "title": "How do I determine reasonable package dependency bounds when releasing a Haskell library?", "body": "<p>The purpose of the bounds is to ensure the version of the dependency you use has the feature(s) that you need. There is some earliest version <code>X</code> that introduces all those features, so you need a lower bound that is at least <code>X</code>. It's <em>possible</em> that a required feature is <em>removed</em> from a later version <code>Y</code>, in which case you would need to specify an upper bound that is less than <code>Y</code>:</p>\n\n<pre><code>build-depends:    foo &gt;= X &amp;&amp; &lt; Y\n</code></pre>\n\n<p>Ideally, a feature you need never gets removed, in which case you can drop the upper bound. This means the upper bound is only needed if you <em>know</em> your feature disappears from a later version. Otherwise, assume that <code>foo &gt;= X</code> is sufficient until you have evidence to the contrary.</p>\n\n<p><code>foo == X</code> should rarely be used; it is basically short for <code>foo &gt;= X &amp;&amp; &lt;= X</code>, and states that you are using a feature that is <em>only</em> in version X; it wasn't in earlier versions, and it was removed in a later version. If you find yourself in such a situation, it would probably be better to try to rewrite your code to not rely on that feature anymore, so that you can return to using <code>foo &gt;= Z</code> (by relaxing the requirement for version <code>X</code> exactly, you may be able to get by with an even earlier version <code>Z &lt; X</code> of <code>foo</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 12, "last_activity_date": 1513176823, "creation_date": 1513176823, "answer_id": 47795973, "question_id": 47795127, "link": "https://stackoverflow.com/questions/47795127/how-do-i-determine-reasonable-package-dependency-bounds-when-releasing-a-haskell/47795973#47795973", "title": "How do I determine reasonable package dependency bounds when releasing a Haskell library?", "body": "<p>This is a tricky question, since there are different opinions in the community on best practices, and there are trade-offs between ease of figuring out bounds and providing the most compatibility with versions of dependencies possible. As I see it, there are basically three approaches you can take:</p>\n\n<ol>\n<li>Look at the version of the dependencies you're currently using, e.g. <code>safe-0.3.15</code>. Assume that the package is following the PVP and will not release a breaking change before version 0.4, and add this: <code>safe &gt;= 0.3.15 &amp;&amp; &lt; 0.4</code></li>\n<li>The above is nice, but limits a lot of potentially valid build plans. You can spend time testing against other versions of the dependency. For example, if you test against about 0.2.12 and 0.4.3 and they both seem to work, you may want to expand to <code>safe &gt;= 0.2.12 &amp;&amp; &lt; 0.5</code>.\n\n<ul>\n<li><strong>NOTE</strong>: A common mistake that crops up is that in a future version of your package, you forget to check compatibility with older versions, and it turns out you're using a new featured introduced in say safe-0.4.1, making the old bounds invalid. There's unfortunately not much in the way of automated tooling to check for this.</li>\n</ul></li>\n<li>Just forget all of it: no version bounds at all, and make it the responsibility of the consumer of the package to ensure compatibility in a build plan. This has the downside that it's possible to create invalid build plans, but the upside that your bounds won't eliminate potentially good ones. (This is basically a false positive vs false negative tradeoff.)</li>\n</ol>\n\n<p>The <a href=\"https://github.com/fpco/stackage#readme\" rel=\"noreferrer\">Stackage project</a> runs nightly builds that can often let you know when your package is broken by new versions of dependencies, and make it easier for users to consume your package by providing pre-built snapshots that are known to work. This especially helps with case (3), and a little bit with the loose lower bounds in (2).</p>\n\n<p>You may also want to consider using a Travis configuration the tests against old Stackage snapshots, e.g. <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/travis-complex.yml\" rel=\"noreferrer\">https://github.com/commercialhaskell/stack/blob/master/doc/travis-complex.yml</a></p>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 6, "last_activity_date": 1513177280, "creation_date": 1513177280, "answer_id": 47796163, "question_id": 47795127, "link": "https://stackoverflow.com/questions/47795127/how-do-i-determine-reasonable-package-dependency-bounds-when-releasing-a-haskell/47796163#47796163", "title": "How do I determine reasonable package dependency bounds when releasing a Haskell library?", "body": "<p>I assume you're aware of the <a href=\"https://pvp.haskell.org/\" rel=\"noreferrer\">Haskell Package Versioning Policy (PVP)</a>.  This provides some guidance, both implicitly in the meaning it assigns to the first three components of the version (\"A.B.C\") plus some explicit advice on Cabal version ranges.</p>\n\n<p>Roughly speaking, future versions with the same \"A.B\" will not have introduced any breaking changes (including introducing orphan instances that might change the behavior of other code), but might have added new bindings, types, etc.  Provided you have used only qualified imports or explicit import lists:</p>\n\n<pre><code>import qualified Something as S\nimport Something (foo, bar)\n</code></pre>\n\n<p>you can safely write a dependency of the form:</p>\n\n<pre><code>something &gt;= 1.2.0 &amp;&amp; &lt; 1.6\n</code></pre>\n\n<p>where the assumption would be that you've tested <code>1.2.0</code> through <code>1.5.6</code>, say, and you're confident that it'll continue to run with all future <code>1.5.x</code>s (non-breaking changes) but could conceivably break on a future <code>1.6</code>.</p>\n\n<p>If you have imported a package unqualified (which you might very well do if you are re-exporting a big chunk of its API), you'll want a variant of:</p>\n\n<pre><code>the-package &gt;= 1.2.0 &amp;&amp; &lt; 1.5.4   -- tested up to 1.5.3 API\nthe-package &gt;= 1.5.3 &amp;&amp; &lt; 1.5.4   -- actually, this API precisely\n</code></pre>\n\n<p>There is also a caveat (see the PVP) if you <em>define</em> an orphan instance.</p>\n\n<p>Finally, when importing some simple, stable packages where you've imported only the most obviously stable components, you could probably make the assumption that:</p>\n\n<pre><code>the-package &gt;= 1.2.0 &amp;&amp; &lt; 2\n</code></pre>\n\n<p>is going to be pretty safe.</p>\n\n<p>Looking at the Cabal file for a big, complex, well-written package might give you some sense of what's done in practice.  The <code>lens</code> package, for example, extensively uses dependencies of the form:</p>\n\n<pre><code>array &gt;= 0.3.0.2 &amp;&amp; &lt; 0.6\n</code></pre>\n\n<p>but has occasional dependencies like:</p>\n\n<pre><code>free &gt;= 4 &amp;&amp; &lt; 6\n</code></pre>\n\n<p>(In many cases, these broader dependencies are on packages written by the same author, and he can obviously ensure that he doesn't break his own packages, so can be a little more lax.)</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1513177527, "creation_date": 1513177527, "answer_id": 47796246, "question_id": 47795127, "link": "https://stackoverflow.com/questions/47795127/how-do-i-determine-reasonable-package-dependency-bounds-when-releasing-a-haskell/47796246#47796246", "title": "How do I determine reasonable package dependency bounds when releasing a Haskell library?", "body": "<p>A &ldquo;foolproof&rdquo; answer would be: allow exactly those versions that you're sure will work successfully! If you've only ever compiled your project with <code>safe-0.3.15</code>, then technically speaking you don't know whether it'll also work with <code>safe-0.3.15</code>, thus the constraint that cabal offers is right. If you want compatibility with other versions, <em>test them</em> by successively going backwards. This can be done easiest by completely disabling the constraint in the <code>.cabal</code> file and then doing</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ cabal configure --constraint='safe==XYZ' &amp;&amp; cabal test\n</code></pre>\n\n<p>For each version <code>XYZ = 0.3.14</code> etc..</p>\n\n<p>Practically speaking, that's a bit of a paranoid approach. In particular, it's good etiquette for packages to follow the <a href=\"https://pvp.haskell.org/\" rel=\"nofollow noreferrer\">Package Versioning Policy</a>, which demands that new <em>minor versions</em> should never break any builds. I.e., if <code>0.3.15</code> works, then <code>0.3.16</code> etc. should at any rate work too. So the conservative constraint if you've only checked <code>0.3.15</code> would actually be <code>safe &gt;=0.3.15 &amp;&amp; &lt;0.4</code>. Probably, <code>safe &gt;=0.3 &amp;&amp; &lt;0.4</code> would be safe<sup>&dagger;</sup> too. The PVP also requires that you don't use looser <em>major</em>-version bounds than you can confirm to work, i.e. it mandates the <code>&lt;0.4</code> constraint.</p>\n\n<p>Often, this is still needlessly strict. It depends on how tightly you work with some package. In particular, sometimes you'll need to explicitly depend on a package just for some extra configuration function of a type used by a more important dependency. In such a case, I tend to not give any bounds at all for the ancillary package. For an extreme example, if I depend on <code>diagrams-lib</code>, that there's no good reason to give any bounds to <code>diagrams-core</code>, because that is anyway coupled to <code>diagrams-lib</code>.</p>\n\n<p>I also don't usually bother with bounds for very stable and standard packages like <code>containers</code>. The exception is of course <code>base</code>.</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>Did you <em>have</em> to pick the <code>safe</code> package as an example?</sub></p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 554, "favorite_count": 0, "accepted_answer_id": 47795973, "answer_count": 4, "score": 16, "last_activity_date": 1513177527, "creation_date": 1513174492, "question_id": 47795127, "link": "https://stackoverflow.com/questions/47795127/how-do-i-determine-reasonable-package-dependency-bounds-when-releasing-a-haskell", "title": "How do I determine reasonable package dependency bounds when releasing a Haskell library?", "body": "<p>When releasing a library on Hackage, how can I determine reasonable bounds for my dependencies?</p>\n\n<p>It's a very brief question - not sure what additional information I can provide.</p>\n\n<p>It would also be helpful to know if this is handled differently depending on whether stack or cabal is used.</p>\n\n<hr>\n\n<p>Essentially my question relates to the cabal constraints which currently is set as:</p>\n\n<pre><code>library\n  hs-source-dirs: src\n  default-language: Haskell2010\n  exposed-modules: Data.ByteUnits\n  build-depends:       base &gt;=4.9 &amp;&amp; &lt;4.10\n                       , safe == 0.3.15\n</code></pre>\n\n<p>I don't think the <code>==</code> is a good idea. </p>\n"}, {"tags": ["ubuntu", "haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1513172860, "post_id": 47794487, "comment_id": 82550013, "body": "That&#39;s a very very old version. Please upgrade. Get started from here: <a href=\"https://haskell-lang.org/get-started\" rel=\"nofollow noreferrer\">haskell-lang.org/get-started</a>"}, {"owner": {"reputation": 14057, "user_id": 2411173, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/52e928a6f9e3077749b75cddab339f4f?s=128&d=identicon&r=PG", "display_name": "Donbeo", "link": "https://stackoverflow.com/users/2411173/donbeo"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1513173213, "post_id": 47794487, "comment_id": 82550247, "body": "but I think the version that is in .stack is the most recent one. The problem is that I do not know how to access to it.  In python I would have done something like <code>source .stack&#47;bin</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1513187292, "post_id": 47794487, "comment_id": 82559648, "body": "@Donbeo If you think you do have a recent version of stack installed (as well as an old one), first delete the old one, then locate the new one and make sure its location is on your path."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1513192959, "post_id": 47794487, "comment_id": 82562416, "body": "<code>~&#47;.stack</code> isn&#39;t a typical location for the stack executable. <code>stack upgrade</code> (which probably wasn&#39;t available in v0.1.10) will usually place it in <code>~&#47;.local&#47;bin</code>. You should follow Sibi&#39;s advice and do a fresh install."}], "owner": {"reputation": 14057, "user_id": 2411173, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/52e928a6f9e3077749b75cddab339f4f?s=128&d=identicon&r=PG", "display_name": "Donbeo", "link": "https://stackoverflow.com/users/2411173/donbeo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1513197022, "creation_date": 1513172655, "last_edit_date": 1513197022, "question_id": 47794487, "link": "https://stackoverflow.com/questions/47794487/configuring-stack-correctly-on-ubuntu", "title": "configuring stack correctly on ubuntu", "body": "<p>I am very new to haskell I have installed stack but almost nothing is working. </p>\n\n<p>For example:</p>\n\n<pre><code>lpuggini@lpuggini-T3420:~$ stack install cassava\nRun from outside a project, using implicit global project config\nUsing resolver: lts-9.18 from implicit global project's config file: /home/local/CORVIL/lpuggini/.stack/global-project/stack.yaml\nInvalid package ID: \"array-0.5.1.1 base-4.9.1.0 binary-0.8.3.0 bytestring-0.10.8.1\"\nlpuggini@lpuggini-T3420:~$ \n</code></pre>\n\n<p>and </p>\n\n<pre><code>lpuggini@lpuggini-T3420:~$ stack upgrade\nFetched package index.                                                                                    \nPopulated index cache.    \nCabal file warning in /tmp/stack-upgrade8199/stack-1.6.1/stack.cabal: Ignoring unknown section type: custom-setup\nCabal file warning in /tmp/stack-upgrade8199/stack-1.6.1/stack.cabal: Ignoring unknown section type: custom-setup\nInvalid package ID: \"array-0.5.1.1 base-4.9.1.0 binary-0.8.3.0 bytestring-0.10.8.1\"\n</code></pre>\n\n<p>Here are some info:</p>\n\n<pre><code>lpuggini@lpuggini-T3420:~$ which stack\n/usr/bin/stack\nlpuggini@lpuggini-T3420:~$ stack --version\nVersion 0.1.10.0 x86_64\n</code></pre>\n\n<p>I assume that I am running an old version of stack. \nI think I should run it from <code>~/.stack</code> but I can not find the right launcher:</p>\n\n<pre><code>lpuggini@lpuggini-T3420:~$ ls .stack/programs/x86_64-linux/ghc-8.0.2/bin/\nghc  ghc-8.0.2  ghci  ghci-8.0.2  ghc-pkg  ghc-pkg-8.0.2  haddock  haddock-ghc-8.0.2  hp2ps  hpc  hsc2hs  runghc  runghc-8.0.2  runhaskell\nlpuggini@lpuggini-T3420:~$ \n</code></pre>\n\n<p>What is that I am doing wrong? How can I solve?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "edited": false, "score": 0, "creation_date": 1513172232, "post_id": 47794328, "comment_id": 82549645, "body": "Ah I figured it would be there but it wasn&#39;t working. I was missing the version number as well."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 5, "last_activity_date": 1513172270, "last_edit_date": 1513172270, "creation_date": 1513172140, "answer_id": 47794328, "question_id": 47794254, "link": "https://stackoverflow.com/questions/47794254/how-can-i-add-an-external-haskell-package-to-a-stack-project/47794328#47794328", "title": "How can I add an external Haskell package to a stack project?", "body": "<p>In your <code>stack.yaml</code> file, under the <code>extra-deps</code> section, add your dependency. Example:</p>\n\n<pre><code>extra-deps:\n- req-1.0.0\n</code></pre>\n\n<p>Note that you specify the version in the <code>extra-deps</code> if that's not in that particular stackage resolver (the resolver is specified in the <code>stack.yaml</code> file in the field <code>resolver</code>). In case, it's present in the stackage resolver - all you have to do is specify that package name under <code>build-depends</code> section in your cabal file (or the package.yaml file if you are using <code>hpack</code>).</p>\n\n<p>More documentaion is <a href=\"https://docs.haskellstack.org/en/stable/GUIDE/#extra-deps\" rel=\"nofollow noreferrer\">available here</a>.</p>\n"}], "owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1171, "favorite_count": 0, "accepted_answer_id": 47794328, "answer_count": 1, "score": 3, "last_activity_date": 1513172270, "creation_date": 1513171863, "question_id": 47794254, "link": "https://stackoverflow.com/questions/47794254/how-can-i-add-an-external-haskell-package-to-a-stack-project", "title": "How can I add an external Haskell package to a stack project?", "body": "<p>I would like to add <a href=\"https://hackage.haskell.org/package/req-1.0.0/docs/Network-HTTP-Req.html\" rel=\"nofollow noreferrer\"><code>req</code></a> to my Stack project. I can install this on my machine with <code>stack install req</code> but I would like to list this in the project dependencies so it is downloaded when the project is built if it is currently not installed.</p>\n\n<p><code>stack.yaml</code> looks like the place to do this but I couldn't find any info on how it's done. </p>\n"}, {"tags": ["haskell", "megaparsec"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1513170088, "post_id": 47792954, "comment_id": 82548192, "body": "<code>Parsec Void</code> is a parser that must never under any circumstances fail. It shouldn&#39;t be surprising that you can&#39;t just insert a <i>failing check</i> like <code>satisfy</code>..."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1513189007, "post_id": 47792954, "comment_id": 82560502, "body": "Your code compiles with the latest version of megaparsec (6.2.0). On older versions, you don&#39;t use <code>Void</code>; instead use <code>()</code> or <a href=\"https://hackage.haskell.org/package/megaparsec-5.3.0/docs/Text-Megaparsec-Error.html#t:Dec\" rel=\"nofollow noreferrer\">this</a> type."}], "owner": {"reputation": 115, "user_id": 1056350, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2e771754034e77080eea435ede7810cd?s=128&d=identicon&r=PG", "display_name": "Iggy M", "link": "https://stackoverflow.com/users/1056350/iggy-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 159, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1513167808, "creation_date": 1513167808, "question_id": 47792954, "link": "https://stackoverflow.com/questions/47792954/megaparsec-no-instance-for-errorcomponent-void-arising-from-a-do-statement", "title": "Megaparsec: No instance for (ErrorComponent Void) arising from a do statement", "body": "<p>I am trying to write a simple parser with megaparsec and have the following issue:</p>\n\n<pre><code>type MyParser = Parsec Void String\n\nxxx :: MyParser Int\nxxx  = do\n    satisfy (`notElem` \"!&gt;\")\n    return 1\n\ngbgc :: MyParser [Int]\ngbgc  = many (yyy &lt;|&gt; xxx)\n</code></pre>\n\n<p>I get the error on line: satisfy ....\nThat says:</p>\n\n<p>No instance for (ErrorComponent Void) arising from a do statement\nIn a stmt of a 'do' block: satisfy (<code>notElem</code> \"!>\")</p>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1513167578, "post_id": 47792791, "comment_id": 82546594, "body": "can you share where are you reading that please? im interested :)"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1513168502, "post_id": 47792791, "comment_id": 82547182, "body": "Universal construction and factorizers are introduced <a href=\"https://bartoszmilewski.com/2015/01/07/products-and-coproducts/\" rel=\"nofollow noreferrer\">here</a>. <a href=\"https://ncatlab.org/nlab/show/universal+construction\" rel=\"nofollow noreferrer\">This may be helpful too</a>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1513168540, "post_id": 47792791, "comment_id": 82547205, "body": "@DanielSanchez <a href=\"https://bartoszmilewski.com/2014/10/28/category-theory-for-programmers-the-preface/\" rel=\"nofollow noreferrer\">bartoszmilewski.com/2014/10/28/&hellip;</a>"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1513169968, "post_id": 47792791, "comment_id": 82548110, "body": "@n.m. I read about Universal construction but could not figure out what does he mean? Could you please explain it?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1513171398, "post_id": 47792791, "comment_id": 82549095, "body": "I don&#39;t think I can explain it any better than he does. Look at the framed definition &quot;A function object from a to b is an object a\u21d2b together with the morphism...&quot; etc."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1513171447, "post_id": 47792791, "comment_id": 82549127, "body": "An Universal construction  is a relation ship between two objects?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1513177310, "post_id": 47792791, "comment_id": 82553088, "body": "A universal construction in CT is (very roughly) a definition stating someting like &quot;X is an object s.t. for all morphisms ... there is a unique morphism such that ...&quot;. Exponentials (function objects) are often defined in that way."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1513177811, "post_id": 47792791, "comment_id": 82553441, "body": "We say that a morphism <code>f : a-&gt;b</code> &quot;factorizes&quot; through <code>c</code>, if <code>f = h . g</code> for some <code>g : a-&gt;c , h : c -&gt; b</code>."}], "answers": [{"tags": [], "owner": {"reputation": 9111, "user_id": 90088, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=128&d=identicon&r=PG", "display_name": "Bartosz Milewski", "link": "https://stackoverflow.com/users/90088/bartosz-milewski"}, "is_accepted": false, "score": 2, "last_activity_date": 1513254922, "creation_date": 1513254922, "answer_id": 47813537, "question_id": 47792791, "link": "https://stackoverflow.com/questions/47792791/curry-is-the-factorizer-for-the-universal-construction/47813537#47813537", "title": "curry is the factorizer for the universal construction", "body": "<p>The idea of a universal construction and a factorizer was introduced in earlier chapters (in particular in the one about the product and coproduct). </p>\n\n<p>In short, a universal construction compares all possible candidates that share a given property. Here, the candidate is an object <code>z</code> with a morphism <code>g</code> going from <code>(z \u00d7 a)</code> to <code>b</code>. The best such candidate is an object denoted by <code>(a=&gt;b)</code> with the morphism called <code>eval</code>. </p>\n\n<p>The universal property is that for any candidate <code>z</code> together with <code>g</code> there is a unique morphism <code>h</code> that factorizes the diagram given in the picture. A factorizer is a recipe for obtaining this <code>h</code> given <code>z</code> and <code>g</code>, in a particular category. In Haskell, <code>g</code> is a function <code>((a, z)-&gt; b)</code> and <code>h</code> is a function <code>(z -&gt; (a -&gt; b))</code>. So, up to renaming of variables and symmetry of the product, the factorizer has exactly the signature of <code>curry</code>.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1513254922, "creation_date": 1513167298, "last_edit_date": 1513184913, "question_id": 47792791, "link": "https://stackoverflow.com/questions/47792791/curry-is-the-factorizer-for-the-universal-construction", "title": "curry is the factorizer for the universal construction", "body": "<p>I am reading category theory for programmers about functions type.  </p>\n\n<p>He says: </p>\n\n<blockquote>\n  <p>Notice that curry is the factorizer for the universal construction of\n  the function object. This is especially apparent if it\u2019s rewritten in\n  this form:</p>\n\n<pre><code>factorizer :: ((a, b)-&gt;c) -&gt; (a-&gt;(b-&gt;c))\nfactorizer g = \\a -&gt; (\\b -&gt; g (a, b))\n</code></pre>\n  \n  <p>(As a reminder: A factorizer produces the factorizing function from a\n  candidate.)</p>\n</blockquote>\n\n<p>What is a 'factorizer' and 'universal construction'?   </p>\n\n<p>What is he trying to explain about currying? </p>\n"}, {"tags": ["haskell", "tree", "fold"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1513166855, "post_id": 47792606, "comment_id": 82546160, "body": "hint: how do you obtain a list of <code>a</code>s from a list of <code>Tree</code>s?"}], "answers": [{"tags": [], "owner": {"reputation": 4763, "user_id": 1065586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qYTQe.jpg?s=128&g=1", "display_name": "tomferon", "link": "https://stackoverflow.com/users/1065586/tomferon"}, "is_accepted": false, "score": 3, "last_activity_date": 1513167003, "creation_date": 1513167003, "answer_id": 47792688, "question_id": 47792606, "link": "https://stackoverflow.com/questions/47792606/haskell-create-a-fold-function-for-tree-type/47792688#47792688", "title": "Haskell - Create a fold function for tree type", "body": "<p>It sometimes helps to look at what is available in scope and their types. Here's a solution:</p>\n\n<pre><code>foldTree f g (Leaf n)  = (f n)\nfoldTree f g (Node subtrees)  = \n  let as = map (foldTree f g) subtrees -- as :: [a]\n  in g as\n</code></pre>\n"}], "owner": {"reputation": 353, "user_id": 8906596, "user_type": "registered", "accept_rate": 38, "profile_image": "https://graph.facebook.com/10207778167811470/picture?type=large", "display_name": "Adrien Varet", "link": "https://stackoverflow.com/users/8906596/adrien-varet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1513167003, "creation_date": 1513166758, "question_id": 47792606, "link": "https://stackoverflow.com/questions/47792606/haskell-create-a-fold-function-for-tree-type", "title": "Haskell - Create a fold function for tree type", "body": "<p>I have this simple data Tree : </p>\n\n<pre><code>data Tree = Leaf Int | Node [Tree]\n</code></pre>\n\n<p>And I have to devellop a fold function for this type :  </p>\n\n<pre><code>foldTree :: (Int -&gt; a) -&gt; ([a] -&gt; a) -&gt; Tree -&gt; a\n</code></pre>\n\n<p>for example : </p>\n\n<pre><code>foldTree (+1) sum (Node[ (Leaf 2), (Leaf 3)]) \n</code></pre>\n\n<p>will return (2+1)+(3+1) = 7\nFor leafs, I have : </p>\n\n<pre><code>foldTree f g (Leaf n)  = (f n)\n</code></pre>\n\n<p>But I have no ideas for develop the nodes's case.</p>\n\n<p>I'm french, also sorry for the mistakes. </p>\n"}, {"tags": ["haskell", "asynchronous", "process", "stdout"], "comments": [{"owner": {"reputation": 4763, "user_id": 1065586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qYTQe.jpg?s=128&g=1", "display_name": "tomferon", "link": "https://stackoverflow.com/users/1065586/tomferon"}, "edited": false, "score": 2, "creation_date": 1513150484, "post_id": 47787655, "comment_id": 82536412, "body": "Include the code you wrote so far and what&#39;s not working."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1513189908, "post_id": 47787655, "comment_id": 82560887, "body": "By defining <code>checkStarted h = True &lt;$ hGetLine h</code> and replacing <code>&quot;.&#47;my-service&quot;</code> with <code>&quot;yes&quot;</code> I can get your first version to work (to actually access the handle outside the function you have to have <code>pure (hout, p)</code>). I would guess that the reason it isn&#39;t working has to do with <code>my-service</code> and not with your Haskell code."}, {"owner": {"reputation": 365, "user_id": 1560138, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/370b89d2b931def9f3df67326283b295?s=128&d=identicon&r=PG", "display_name": "tmortiboy", "link": "https://stackoverflow.com/users/1560138/tmortiboy"}, "edited": false, "score": 0, "creation_date": 1513205798, "post_id": 47787655, "comment_id": 82568141, "body": "In the terminal I just tried the &#39;my-service&#39; redirecting stdout to file with no luck. Turns out, the log output is being produced via stderr, hence why my code wasnt working"}], "answers": [{"tags": [], "owner": {"reputation": 116, "user_id": 2526001, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b40226907e5dbdd4b0a8b94d59e374c?s=128&d=identicon&r=PG", "display_name": "Sergei Iashin", "link": "https://stackoverflow.com/users/2526001/sergei-iashin"}, "is_accepted": false, "score": 3, "last_activity_date": 1513152199, "creation_date": 1513152199, "answer_id": 47788165, "question_id": 47787655, "link": "https://stackoverflow.com/questions/47787655/haskell-start-a-long-running-process-silently-capturing-stdout/47788165#47788165", "title": "Haskell: start a long running process, silently, capturing stdout", "body": "<p>The following is example of starting process and reading stdout <a href=\"https://github.com/wapxmas/mystem/blob/master/src/NLP/Mystem/IO.hs\" rel=\"nofollow noreferrer\">in a program of mine</a>:</p>\n\n<pre><code>  runMystem :: [T.Text] -&gt; IO T.Text\n  runMystem stemWords = do\n    (i, o, _, ph) &lt;- createProcess (proc mystemExecutabe mystemParams) { std_in = CreatePipe, std_out = CreatePipe }\n    res &lt;- flip (maybe (return T.empty)) i $ \\hIn -&gt;\n              flip (maybe (return T.empty)) o $ \\hOut -&gt; do\n                hSetEncoding hIn utf8\n                hSetEncoding hOut utf8\n                forM_ stemWords $ TIO.hPutStrLn hIn\n                TIO.hGetContents hOut\n    void $ waitForProcess ph\n    return res\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 0, "last_activity_date": 1513236487, "last_edit_date": 1513236487, "creation_date": 1513206958, "answer_id": 47803551, "question_id": 47787655, "link": "https://stackoverflow.com/questions/47787655/haskell-start-a-long-running-process-silently-capturing-stdout/47803551#47803551", "title": "Haskell: start a long running process, silently, capturing stdout", "body": "<p>This answer uses the <a href=\"http://hackage.haskell.org/package/process-streaming\" rel=\"nofollow noreferrer\">process-streaming</a> library (written by the author of this answer) which is a set of helpers over <a href=\"http://hackage.haskell.org/package/process\" rel=\"nofollow noreferrer\">process</a>.</p>\n\n<pre><code>{-# language OverloadedStrings #-}\n{-# language NumDecimals #-}\nimport           System.Process.Streaming (execute,piped,shell,foldOut,transduce1)\nimport qualified System.Process.Streaming.Text as PT\nimport           Data.Text.Lazy (isInfixOf)\nimport           Control.Applicative\nimport           Control.Monad\nimport           Control.Concurrent (threadDelay)\nimport           Control.Concurrent.Async\nimport           Control.Concurrent.MVar\n\nmain :: IO ()\nmain = do\n    started &lt;- newEmptyMVar\n    let execution =\n            execute (piped (shell \"{ sleep 3 ; echo fooo ; sleep 3 ; }\")) $\n                foldOut . transduce1 PT.utf8x . PT.eachLine $ lookline\n        lookline line = do\n            when (isInfixOf \"foo\" line) (putMVar started ())\n            return (Right ())\n        stopOrNot =\n            do abort &lt;- race (threadDelay 4e6) (readMVar started)\n               case abort of\n                   Left () -&gt; return () -- stop immediately\n                   Right () -&gt; runConcurrently empty -- sleep forever\n    result &lt;- race stopOrNot execution\n    print result\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/process-streaming-0.9.1.2/docs/System-Process-Streaming.html#g:1\" rel=\"nofollow noreferrer\"><code>execute</code></a> installs exception handlers that terminate the external process when an asynchronous exceptions arrives, to it is safe to use <code>race</code> with it.</p>\n\n<p><code>execute</code> also takes care to drain any standard stream that is not read explicitly (like <em>stderr</em> in this case) to avoid a common source of deadlocks.</p>\n"}], "owner": {"reputation": 365, "user_id": 1560138, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/370b89d2b931def9f3df67326283b295?s=128&d=identicon&r=PG", "display_name": "tmortiboy", "link": "https://stackoverflow.com/users/1560138/tmortiboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 310, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1513236487, "creation_date": 1513150111, "last_edit_date": 1513152721, "question_id": 47787655, "link": "https://stackoverflow.com/questions/47787655/haskell-start-a-long-running-process-silently-capturing-stdout", "title": "Haskell: start a long running process, silently, capturing stdout", "body": "<p>I have a long running process which I need to start.\nIt takes a few seconds to start, and outputs logs to stdout, with one that indicates it is ready.</p>\n\n<p>I would like to: </p>\n\n<ul>\n<li>start the process silently, so that the stdout from the process is not displayed in my session.</li>\n<li>capture the output as it streams so that I can determine that it is ready.</li>\n<li>have some handle on the process so that I can stop the process at a later point.</li>\n</ul>\n\n<p>I have come close using Shelly, Turtle and System.Process, but fail to capture the stdout.</p>\n\n<p>Using System.Process I had:</p>\n\n<pre><code>import Control.Concurrent (threadDelay)\nimport Control.Concurrent.Async (race)\nimport System.IO\nimport System.Process\n\nstartService :: IO ProcessHandle\nstartService = do\n  let cmd = \"./my-service\"\n      args = [ \"-p 1234\" ]\n  (_, Just hout, _, p) &lt;- createProcess $ (proc cmd args) { std_out = CreatePipe }\n  started &lt;- either id id &lt;$&gt; race (checkStarted hout) timeOut\n  unless started $ fail \"Service not started\"\n  pure p\n  where\n    checkStarted :: Handle -&gt; IO Bool\n    checkStarted h = do\n      str &lt;- hGetLine h\n      -- check str for started log, else loop\n\n    timeOut :: IO Bool\n    timeOut = do\n      threadDelay 10000000\n      pure False\n</code></pre>\n\n<p>But The handler <code>hout</code> was never in a ready state.</p>\n\n<p>Using Shelly I had:</p>\n\n<pre><code>import Control.Concurrent (threadDelay)\nimport Control.Concurrent.Async (race)\nimport Control.Concurrent.MVar\nimport Shelly\nimport System.IO\n\nstartService :: IO (Async ())\nstartService = do\n  let cmd = \"./my-service\"\n      args = [ \"-p 1234\" ]\n  startedMVar &lt;- newEmptyMVar\n  async &lt;- shelly $ asyncSh $ runHandle cmd args $ recordWhenStarted startedMVar\n  started &lt;- either id id &lt;$&gt; race (readMVar startedMVar) timeOut\n  unless started $ fail \"Service not started\"\n  pure async\n  where\n    recordWhenStarted :: MVar Bool -&gt; Text -&gt; IO ()\n    recordWhenStarted mvar txt =\n      when (isStartedLog txt) $\n        modifyMVar_ mvar (const $ pure True)\n\n    timeOut :: IO Bool\n    timeOut = do\n      threadDelay 10000000\n      pure False\n</code></pre>\n\n<p>But the <code>recordWhenStarted</code> is never called.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1513121087, "post_id": 47783171, "comment_id": 82527773, "body": "Is this homework? Wbat have you tried? What problems did you encounter?"}, {"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 3, "creation_date": 1513121202, "post_id": 47783171, "comment_id": 82527809, "body": "Sounds like a job for the list monad."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 5, "creation_date": 1513121970, "post_id": 47783171, "comment_id": 82528026, "body": "<code>mapM (\\x -&gt; [toLower x,toUpper x])</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1513122269, "post_id": 47783171, "comment_id": 82528107, "body": "@user2407038 You should make that into an answer"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1513122457, "post_id": 47783171, "comment_id": 82528171, "body": "@user2407038 any chance you could explain how that works? thank you"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1513122537, "post_id": 47783171, "comment_id": 82528187, "body": "@chi Code-only answers are bad style and I don&#39;t have much to add to my comment (I&#39;ve been looking for a question about why <code>mapM</code> for lists works the way it does but I can&#39;t find it)."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1513122891, "post_id": 47783171, "comment_id": 82528277, "body": "I&#39;d use <code>Applicative</code> and <code>Traversable</code> rather than <code>Monad</code>. So <code>traverse (([toUpper,toLower] &lt;*&gt;) . pure)</code>. Because we&#39;re <i>traversing</i> the word, but using the <i>choice</i> structure for the upper/lower-case distinction."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1513123557, "post_id": 47783171, "comment_id": 82528460, "body": "@pigworker In this case it won&#39;t make a difference, since <code>mapM = traverse</code> for <code>[]</code>"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1513123676, "post_id": 47783171, "comment_id": 82528492, "body": "Yeah, using worse syntax when the data type being operated on is known to be a monad anyway is kind of pointless IMO."}, {"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 2, "creation_date": 1513124823, "post_id": 47783171, "comment_id": 82528804, "body": "Here&#39;s a point-free formulation of the same thing, just because: <code>(traverse.sequenceA) [toLower,toUpper]</code>. Alternatively, using the Functor instance of <code>[]</code> instead of the Applicative instance of <code>-&gt;</code> and the <a href=\"https://www.stackage.org/haddock/lts-9.18/lens-4.15.4/Control-Lens-Lens.html#v:-63--63-\" rel=\"nofollow noreferrer\"><code>??</code> operator in lens</a>: <code>traverse ([toLower,toUpper]??)</code>"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1513125667, "post_id": 47783171, "comment_id": 82529034, "body": "@4castle In <i>this</i> case, but it&#39;s the wrong lesson. <code>traverse</code> is the more powerful tool to understand. <code>mapM</code> is a historic accident."}], "answers": [{"comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1513123115, "post_id": 47783447, "comment_id": 82528331, "body": "Good to go with Applicative. But replace your <code>[&quot;&quot;]</code> with <code>pure &quot;&quot;</code> and you&#39;ll see you just wrote a special case of <code>traverse</code> (i.e. <code>mapM</code>, but <code>mapM</code> should not exist any more, because it asks for <code>Monad</code> when it needs only <code>Applicative</code>)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1513124847, "post_id": 47783447, "comment_id": 82528811, "body": "Amaze your friends, Confuse your enemies! <code>traverse (sequence [toLower, toUpper])</code>, just $19.99!"}], "tags": [], "owner": {"reputation": 4625, "user_id": 1861521, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dda04c7abdfe8b05f4a258b7a01900a6?s=128&d=identicon&r=PG", "display_name": "jcarpenter2", "link": "https://stackoverflow.com/users/1861521/jcarpenter2"}, "is_accepted": false, "score": 2, "last_activity_date": 1513123780, "last_edit_date": 1513123780, "creation_date": 1513122730, "answer_id": 47783447, "question_id": 47783171, "link": "https://stackoverflow.com/questions/47783171/capitalization-combinations-in-haskell/47783447#47783447", "title": "Capitalization combinations in Haskell", "body": "<p>The applicative <code>&lt;*&gt;</code> operator applies each in a list of functions to each of a list of operands.  With it you can write cap like this:</p>\n\n<pre><code>cap :: String -&gt; [String]\ncap \"\" = pure \"\"\ncap (c:cs) = (:) &lt;$&gt; [toLower c, toUpper c] &lt;*&gt; cap cs\n</code></pre>\n\n<p>The <code>&lt;$&gt;</code> is infix <code>fmap</code>, and applies the cons function to each element of <code>[toLower c, toUpper c]</code>.  This creates a two-element list of functions, one of which cons-es the lower-case <code>c</code> onto a string, and the other cons-es the upper-case <code>c</code> onto a string.  This is then sequentially applied to <code>cap cs</code>.</p>\n\n<p>Edit: Oh good, <code>mapM (\\x -&gt; [toLower x,toUpper ])</code> is in one of the comments and definitely better than this.</p>\n\n<p>Edit 2: Do what u/pigworker said:</p>\n\n<pre><code>cap :: String -&gt; [String]\ncap = traverse (\\x -&gt; [toLower x, toUpper x])\n</code></pre>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1513123780, "creation_date": 1513120912, "last_edit_date": 1513122889, "question_id": 47783171, "link": "https://stackoverflow.com/questions/47783171/capitalization-combinations-in-haskell", "title": "Capitalization combinations in Haskell", "body": "<p>What is the most efficient way to write a function that generates all combinations of lower case and upper case letters in a word?</p>\n\n<p>ie </p>\n\n<pre><code>\u03bb: cap \"mat\"\n[\"MAT\",\"MAt\",\"MaT\",\"Mat\",\"mAT\",\"mAt\",\"maT\",\"mat\"] \n</code></pre>\n\n<p>edit:\n@user2407038 has provided</p>\n\n<pre><code>cap w =  mapM (\\x -&gt; [toLower x, toUpper x]) w \n</code></pre>\n\n<p>which works.</p>\n\n<p>in trying to understand why this works, I find that</p>\n\n<pre><code>sequenceA [\"mM\", \"aA\", \"tT\"]\n</code></pre>\n\n<p>gives the correct answer. Maybe someone could help explain why that works</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "edited": false, "score": 0, "creation_date": 1513106332, "post_id": 47779984, "comment_id": 82521172, "body": "Thats not how to convert string to int. Have a read about <code>read</code> in the IO chapter in learn you a haskell"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1513107260, "post_id": 47779984, "comment_id": 82521634, "body": "Haskell was designed so that we don&#39;t need to keep type tags at runtime -- types can be erased during compilation, reducing the memory footprint. If really needed, we have <code>Typeable</code> to keep type tags around. For your problem, though, you don&#39;t need runtime type information at all, but to parse a string into a statically known type."}], "answers": [{"comments": [{"owner": {"reputation": 410, "user_id": 6932854, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/1666674616977204/picture?type=large", "display_name": "Khan Saab", "link": "https://stackoverflow.com/users/6932854/khan-saab"}, "edited": false, "score": 0, "creation_date": 1513107249, "post_id": 47780141, "comment_id": 82521628, "body": "Is there any way to check if <code>::</code> will work before typing in <code>::</code> .  Like you typed in ` &quot;no&quot; :: Int` and it gives exception and i understand how Maybe works but without extra data constructor is it possible?"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1513107315, "post_id": 47780141, "comment_id": 82521657, "body": "<code>::</code> is always evaluated at compile-time. It&#39;s a type annotation, so <code>a :: SomeType</code> is equivalent to doing <code>SomeType a = ...;</code> in Java or C++. It&#39;s going to either work or not work at compile-time."}, {"owner": {"reputation": 410, "user_id": 6932854, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/1666674616977204/picture?type=large", "display_name": "Khan Saab", "link": "https://stackoverflow.com/users/6932854/khan-saab"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1513107714, "post_id": 47780141, "comment_id": 82521869, "body": "@SilvioMayolo sorry for many questions,  As  Thomas M. DuBuisson  said if input is invalid and i try to use read then is their any safeway to avoid exception?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1513107893, "post_id": 47780141, "comment_id": 82521970, "body": "What non-exception result would you like if the user enters <code>&quot;I will not enter a number&quot;</code> for the input? Do you want zero? Negative one?   The value <code>Nothing</code> is the value you get with <code>readMaybe</code> and you can wrap that up however you&#39;d like - for example <code>fromMaybe 0 (readMaybe &quot;not a number&quot;)</code> will default to <code>0</code>."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 7, "last_activity_date": 1513106879, "creation_date": 1513106879, "answer_id": 47780141, "question_id": 47779984, "link": "https://stackoverflow.com/questions/47779984/how-to-check-type-in-haskell/47780141#47780141", "title": "How to check type in haskell", "body": "<p>EDIT: Notice you <em>always</em> have a string from <code>getLine</code> - that's the type it returns.  If that string contains an ascii representation of a number then great and keep reading.</p>\n\n<p>If you have a  string, <code>g</code>, and say <code>g :: Int</code> the compiler will simply so \"no, you are wrong, that's a String\".  You need to perform a translation - parse the string and compute an Int.  The most readily available methods are <code>read</code> in the Prelude and <code>readMaybe</code> in <code>Text.Read</code>.</p>\n\n<p>Read will work but throws exceptions on invalid input:</p>\n\n<pre><code>Prelude&gt; read \"4742\" :: Int\n4742\nPrelude&gt; read \"no\" :: Int\n*** Exception: Prelude.read: no parse\nPrelude&gt; read \"191andmore\"\n*** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>The maybe variant is exception safe:</p>\n\n<pre><code>Prelude&gt; import Text.Read\nPrelude Text.Read&gt; readMaybe \"181\" :: Maybe Int\nJust 181\nPrelude Text.Read&gt; readMaybe \"no\" :: Maybe Int\nNothing\nPrelude Text.Read&gt; readMaybe \"211andmore\" :: Maybe Int\nNothing\n</code></pre>\n"}], "owner": {"reputation": 410, "user_id": 6932854, "user_type": "registered", "accept_rate": 85, "profile_image": "https://graph.facebook.com/1666674616977204/picture?type=large", "display_name": "Khan Saab", "link": "https://stackoverflow.com/users/6932854/khan-saab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 949, "favorite_count": 0, "accepted_answer_id": 47780141, "answer_count": 1, "score": 3, "last_activity_date": 1513107071, "creation_date": 1513106130, "last_edit_date": 1513107071, "question_id": 47779984, "link": "https://stackoverflow.com/questions/47779984/how-to-check-type-in-haskell", "title": "How to check type in haskell", "body": "<p>I don't know how to check type of variable in haskell, Here i mean , when i read something from console with <code>getLine</code> ,however i expect it to be an interger but user can enter a string also,then i don't want my program to crash. For example if someone inputs a string and i try to convert it to <code>Int</code> then it will crash(exception) so i want to check whether it is convertable or not. How do i do that ? Thanks for any help :)</p>\n\n<pre><code> main1 = do\n        let g &lt;- getLine\n            k = g :: Int \n            if(k :: Int)\n                then ........ \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1513106719, "post_id": 47779818, "comment_id": 82521375, "body": "You might want to also see <a href=\"https://en.wikipedia.org/wiki/Combinatory_logic#Examples_of_combinators\" rel=\"nofollow noreferrer\">combinator S</a>, which is generalized by <code>(&lt;*&gt;)</code> in Haskell."}], "answers": [{"comments": [{"owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "edited": false, "score": 0, "creation_date": 1513105987, "post_id": 47779860, "comment_id": 82521021, "body": "Oh, yes! Thanks you. I should have known this myself."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 9, "last_activity_date": 1513109348, "last_edit_date": 1513109348, "creation_date": 1513105659, "answer_id": 47779860, "question_id": 47779818, "link": "https://stackoverflow.com/questions/47779818/is-there-a-standard-function-that-computes-f-x-g-x/47779860#47779860", "title": "Is there a standard function that computes `f x (g x)`?", "body": "<p><code>f &lt;*&gt; g</code>\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800</p>\n\n<p>See <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"noreferrer\">https://wiki.haskell.org/Pointfree</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": false, "score": 10, "last_activity_date": 1513105930, "creation_date": 1513105930, "answer_id": 47779932, "question_id": 47779818, "link": "https://stackoverflow.com/questions/47779818/is-there-a-standard-function-that-computes-f-x-g-x/47779932#47779932", "title": "Is there a standard function that computes `f x (g x)`?", "body": "<p>The function you\u2019re looking for is <code>(&lt;*&gt;)</code>. Why? Well, it\u2019s true that <code>(&lt;*&gt;)</code> has a more general type:</p>\n\n<pre><code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>But consider that we can specialize <code>f</code> to <code>(-&gt;) r</code>, which has an <code>Applicative</code> instance:</p>\n\n<pre><code>(&lt;*&gt;) :: (-&gt;) r (a -&gt; b) -&gt; (-&gt;) r a -&gt; (-&gt;) r b\n</code></pre>\n\n<p>\u2026then we can rearrange the type so <code>-&gt;</code> is infix instead of prefix, as it normally is:</p>\n\n<pre><code>(&lt;*&gt;) :: (r -&gt; a -&gt; b) -&gt; (r -&gt; a) -&gt; (r -&gt; b)\n</code></pre>\n\n<p>\u2026which is the same as your signature modulo alpha renaming.</p>\n\n<p>This works because the function type, <code>(-&gt;)</code>, has instances of <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code>, which are idiomatically called \u201creader\u201d. These instances thread an extra argument around to all their arguments, which is exactly what your function does.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1513109433, "last_edit_date": 1513109433, "creation_date": 1513107250, "answer_id": 47780234, "question_id": 47779818, "link": "https://stackoverflow.com/questions/47779818/is-there-a-standard-function-that-computes-f-x-g-x/47780234#47780234", "title": "Is there a standard function that computes `f x (g x)`?", "body": "<p>Yes, this is a special case of <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Monad.html#v:ap\" rel=\"nofollow noreferrer\"><strong><code>ap :: Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b</code></strong></a></p>\n\n<p>Here you should see the monad <code>m</code> as <code>(-&gt;) r</code>, so a function with a parameter. Now <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.Base.html#ap\" rel=\"nofollow noreferrer\"><code>ap</code> is defined as [source]</a>:</p>\n\n<pre><code>ap m1 m2 = do\n    x1 &lt;- m1\n    x2 &lt;- m2\n    return (x1 x2)\n</code></pre>\n\n<p>Which is thus syntactical sugar for:</p>\n\n<pre><code>ap m1 m2 = m1 &gt;&gt;= (\\x1 -&gt; m2 &gt;&gt;= return . x1)\n</code></pre>\n\n<p>The bind function <code>&gt;&gt;=</code> is defined <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.Base.html#line-703\" rel=\"nofollow noreferrer\">for a <code>(-&gt;) r</code> instance as [source]</a>:</p>\n\n<pre><code>instance Monad ((-&gt;) r) where\n    f &gt;&gt;= k = \\ r -&gt; k (f r) r\n    return = const\n</code></pre>\n\n<p>(<code>return</code> is by default equal to <code>pure</code>, which is defined as <code>const</code>).</p>\n\n<p>So that means that:</p>\n\n<pre><code>ap f g = f &gt;&gt;= (\\x1 -&gt; g &gt;&gt;= const . x1)\n       = f &gt;&gt;= (\\x1 -&gt; (\\r -&gt; (const . x1) (g r) r))\n       = \\x -&gt; (\\x1 -&gt; (\\r -&gt; (const . x1) (g r) r)) (f x) x\n</code></pre>\n\n<p>now we can perform a <em>beta</em> reduction (<code>x1</code> is <code>(f x)</code>):</p>\n\n<pre><code>ap f g = \\x -&gt; (\\r -&gt; (const . (f x)) (g r) r) x\n</code></pre>\n\n<p>and another <em>beta</em> reduction (<code>r</code> is <code>x</code>):</p>\n\n<pre><code>ap f g = \\x -&gt; (const . (f x)) (g x) x\n</code></pre>\n\n<p>We can unwrap the <code>const</code> as <code>\\c _ -&gt; c</code>, and <code>(.)</code> as <code>f . g</code> to `\\z -> f (g z):</p>\n\n<pre><code>ap f g = \\x -&gt; ((\\c _ -&gt; c) . (f x)) (g x) x\n       = \\x -&gt; (\\z -&gt; (\\c _ -&gt; c) ((f x) z)) (g x) x\n</code></pre>\n\n<p>Now we can again perform a beta reductions (<code>z</code> is <code>(g x)</code>, and <code>c</code> is <code>((f x) (g x))</code>):</p>\n\n<pre><code>ap f g = \\x -&gt; ((\\c _ -&gt; c) ((f x) (g x))) x\n       = \\x -&gt; (\\_ -&gt; ((f x) (g x))) x\n</code></pre>\n\n<p>finally we perform a beta-reduction (<code>_</code> is <code>x</code>):</p>\n\n<pre><code>ap f g = \\x -&gt; ((f x) (g x))\n</code></pre>\n\n<p>We now move <code>x</code> to the head of the function:</p>\n\n<pre><code>ap f g x = (f x) (g x)\n</code></pre>\n\n<p>and in Haskell <code>f x y</code> is short for <code>(f x) y</code>, so that means that:</p>\n\n<pre><code>ap f g x = (f x) (g x)\n         = f x (g x)\n</code></pre>\n\n<p>which is the requested function.</p>\n"}], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 433, "favorite_count": 0, "accepted_answer_id": 47779860, "answer_count": 3, "score": 4, "last_activity_date": 1513109433, "creation_date": 1513105431, "question_id": 47779818, "link": "https://stackoverflow.com/questions/47779818/is-there-a-standard-function-that-computes-f-x-g-x", "title": "Is there a standard function that computes `f x (g x)`?", "body": "<p>I couldn't find anything on Hoogle, but is there a standard function or operator with a signature like:</p>\n\n<pre><code>func :: (a -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>I.e. given two functions <code>f</code> and <code>g</code> and an element <code>x</code> as arguments it computes <code>f x (g x)</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1513105515, "post_id": 47779431, "comment_id": 82520783, "body": "<code>|difficulty == &#39;1&#39; =</code> is not the right syntax here. Try <code>if ... then ... else</code> or <code>case</code>."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1513105545, "post_id": 47779431, "comment_id": 82520799, "body": "In Haskell one normally splits things up into functions. So you might have a <code>parseDifficulty</code> function which goes from a string (note double quotes for string and single quotes for chars) like <code>\u201d1\u201d</code> to a <code>Maybe Difficultly</code> like &#39;Just Easy<code>. This could be by a </code>readDifficulty :: IO Difficulty` function like <code>readDifficulty = putStrLn \u201cdifficulty?\u201d &gt;&gt; (fmap parseDifficulty getLine) &gt;&gt;= \\d -&gt; case d of Just d -&gt; return d; Nothing -&gt; readDifficulty</code>. Note that this also demonstrates how one may repeat an IO action. If you want to do cases inside a <code>do</code>, you need a <code>case</code>."}, {"owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "edited": false, "score": 0, "creation_date": 1513105666, "post_id": 47779431, "comment_id": 82520862, "body": "You also need to indent the contents of the <code>do</code> block."}], "answers": [{"comments": [{"owner": {"reputation": 153, "user_id": 5646101, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0c51ea5990aca49fcac37bc616695412?s=128&d=identicon&r=PG&f=1", "display_name": "xsx", "link": "https://stackoverflow.com/users/5646101/xsx"}, "edited": false, "score": 0, "creation_date": 1513106024, "post_id": 47779764, "comment_id": 82521032, "body": "It makes a lot of sense but gives an error : &quot;The last statement in a &#39;do&#39; block must be an expression&quot; at grid &lt;- initializeGrid when I try to run it in platform"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "reply_to_user": {"reputation": 153, "user_id": 5646101, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0c51ea5990aca49fcac37bc616695412?s=128&d=identicon&r=PG&f=1", "display_name": "xsx", "link": "https://stackoverflow.com/users/5646101/xsx"}, "edited": false, "score": 1, "creation_date": 1513107561, "post_id": 47779764, "comment_id": 82521786, "body": "Yes, you didn&#39;t put game code where it goes. It complains that you aren&#39;t using <code>grid</code>. For testing, you can use <code>print grid</code> there."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 3, "last_activity_date": 1513105233, "creation_date": 1513105233, "answer_id": 47779764, "question_id": 47779431, "link": "https://stackoverflow.com/questions/47779431/how-do-i-accept-user-inputs-and-call-functions-based-on-the-them/47779764#47779764", "title": "how do I accept user inputs and call functions based on the them?", "body": "<pre><code>{-# LANGUAGE LambdaCase #-}\n\nimport System.IO\n\nplayGame = do\n  grid &lt;- initializeGrid\n  -- game code goes here\n\ninitializeGrid = do\n  putStrLn \"Select a difficulty (1,2): \"\n  getLine &gt;&gt;= \\case -- \"difficulty &lt;- getLine\" &lt;newline&gt; \"case difficulty of\" also ok\n    \"1\" -&gt; return $ makeGrid 3 3 False\n    \"2\" -&gt; return $ makeGrid 5 5 False\n    _   -&gt; do\n      putStrln \"Wrong thing\"\n      initializeGrid\n\nmakeGrid :: Int -&gt; Int -&gt; a -&gt; [[a]]\nmakeGrid x y = replicate y . replicate x\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 5646101, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0c51ea5990aca49fcac37bc616695412?s=128&d=identicon&r=PG&f=1", "display_name": "xsx", "link": "https://stackoverflow.com/users/5646101/xsx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 47779764, "answer_count": 1, "score": 0, "last_activity_date": 1513105233, "creation_date": 1513104021, "question_id": 47779431, "link": "https://stackoverflow.com/questions/47779431/how-do-i-accept-user-inputs-and-call-functions-based-on-the-them", "title": "how do I accept user inputs and call functions based on the them?", "body": "<pre><code>import System.IO\n\nmakeGrid :: Int -&gt; Int -&gt; a -&gt; [[a]]\nmakeGrid x y = replicate y . replicate x\n\nstartGame = do\nputStrLn \"Select a difficulty (1,2): \"\ndifficulty &lt;- getLine\n|difficulty == '1' = makeGrid 3 3 False\n|difficulty == '2' = makeGrid 5 5 False\n|otherwise = putStrln \"Wrong thing\"\n             some function            --start from beginning again\n</code></pre>\n\n<p>As you see, I have a function makeGrid. I want to take user input in startGame and call makeGrid based on the user input. Also do a while loop if possible, how should I do that?</p>\n"}, {"tags": ["haskell", "arrows"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1513098023, "post_id": 47777649, "comment_id": 82516787, "body": "This may in some cases be possible, but IMO it&#39;s missing the point to just see arrows as an \u201calternative to monads\u201d. They&#39;re not really practical to think about, in that role; fixation on this point is one of the reasons why arrows are so underrepresented in the Haskell ecosystem. I generally consider arrows as just <i>functions with optional extra bells</i> (general morphisms, actually). \u2014 The \u201cproper idiom for monad transformers\u201c would actually be <i>functor composition</i>, which doesn&#39;t have very much to do with arrows (except insofar as all this category-theory is tightly connected)."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1513098449, "post_id": 47777649, "comment_id": 82517024, "body": "hm. OK. As for me, most attractive about arrows is possibilities to get alternative to transformers (I don&#39;t like them;) and second is that seems they can replace streaming/piping libraries. But I never try them and don&#39;t know will they simplify or complicate all. When I see arrow-based libs documentation, all looks very simple, cool and beauty."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1513103136, "post_id": 47777649, "comment_id": 82519527, "body": "There are (seldom used) arrow transformers as well: <a href=\"http://hackage.haskell.org/package/arrows-0.4.4.1/docs/Control-Arrow-Transformer.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/arrows-0.4.4.1/docs/&hellip;</a>"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1513123261, "post_id": 47777649, "comment_id": 82528378, "body": "@Paul-AG I guess one question is, why don&#39;t you like monad transformers? Monad transformers were made to make things easier. There are some alternatives. The &quot;straightforward&quot; way to implement something without them would involve a lot of boilerplate (since it would be just a bunch of nested types, with no &quot;helpers&quot; to deal with the nesting). Also, no, I don&#39;t think arrows have any relation to avoiding/replacing monad transformers."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1513156711, "post_id": 47777649, "comment_id": 82539757, "body": "sounds strange, bcz example in &quot;Haskell Design Patterns&quot; shows how simple is to switch from Monads to Arrows and get equivalent functionality. But more interesting: isn&#39;t simple to turn monad-code to streaming w/o special libs (conduit/pipes/etc), but seems it&#39;s simple w/ Arrows. May be Arrows can eliminate streaming-libs even? Transformers are easy to understand and terrible to read as code. Even more: ListT bug shows that even good Haskellers does not understand what are they doing w/ transformers :) So I supposed, Arrows can help to avoid some design problems in Haskell (transformers)."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1513162486, "post_id": 47777649, "comment_id": 82543486, "body": "I found <a href=\"http://karols.github.io/blog/2014/04/29/from-nested-monads-to-kleisli-arrows-over-monad-transformers/\" rel=\"nofollow noreferrer\">this</a>, so I&#39;&#39; keep it here, maybe someone will be interested"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 158, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1513097336, "creation_date": 1513097336, "question_id": 47777649, "link": "https://stackoverflow.com/questions/47777649/is-it-true-about-arrows", "title": "Is it true about Arrows?", "body": "<p>Somewhere I read that Arrows allow to avoid/simplify monads' transformations (as for me, monad transformers look the most inelegant idiom in Haskell). Is it true? Can somebody show me some small example how Arrows solve transformation when I need to have \"stack\" with 2 effects?</p>\n"}, {"tags": ["haskell", "ghc", "haskell-stack", "intero"], "answers": [{"comments": [{"owner": {"reputation": 58948, "user_id": 857807, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/297e4dba223f5103614030100eab78ca?s=128&d=identicon&r=PG", "display_name": "dcastro", "link": "https://stackoverflow.com/users/857807/dcastro"}, "edited": false, "score": 0, "creation_date": 1513162365, "post_id": 47791032, "comment_id": 82543415, "body": "It doesn&#39;t seem to be working the way I expected... <a href=\"https://gist.github.com/dcastro/05d1076e3cd134a1bc473f77e401998d\" rel=\"nofollow noreferrer\">gist.github.com/dcastro/05d1076e3cd134a1bc473f77e401998d</a>"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 58948, "user_id": 857807, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/297e4dba223f5103614030100eab78ca?s=128&d=identicon&r=PG", "display_name": "dcastro", "link": "https://stackoverflow.com/users/857807/dcastro"}, "edited": false, "score": 1, "creation_date": 1513188678, "post_id": 47791032, "comment_id": 82560354, "body": "Hmm, you&#39;re right. This command doesn&#39;t show dependencies on internal modules :( Probably you can open feature request in <code>stack</code> repository for this."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 0, "last_activity_date": 1513161686, "creation_date": 1513161686, "answer_id": 47791032, "question_id": 47777329, "link": "https://stackoverflow.com/questions/47777329/check-which-targets-components-a-stack-target-component-depends-on/47791032#47791032", "title": "Check which targets/components a stack target/component depends on?", "body": "<p>You can just run <code>stack dot</code> command to build dependency graph for your project and then analyze this graph by yourself. I think your task is rather specific. Just a single analyzing algorithm for dependency graph. Probably not so common so it's not implemented yet (maybe it's implemented, but I'm not aware of it).</p>\n\n<p>See details here:</p>\n\n<p><a href=\"https://www.reddit.com/r/haskelltil/comments/6scuiu/use_stack_dot_to_see_which_of_your_deps_bring_a/\" rel=\"nofollow noreferrer\">Use \u201cstack dot\u201d to see which of your deps bring a particular package to your dependency tree</a></p>\n"}], "owner": {"reputation": 58948, "user_id": 857807, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/297e4dba223f5103614030100eab78ca?s=128&d=identicon&r=PG", "display_name": "dcastro", "link": "https://stackoverflow.com/users/857807/dcastro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 172, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1513161686, "creation_date": 1513096262, "question_id": 47777329, "link": "https://stackoverflow.com/questions/47777329/check-which-targets-components-a-stack-target-component-depends-on", "title": "Check which targets/components a stack target/component depends on?", "body": "<p>By running <code>stack ide targets</code>, I can get a list of all the targets in a stack project. For example, for <a href=\"https://github.com/lukexi/halive\" rel=\"nofollow noreferrer\">Halive</a>, I get:</p>\n\n<pre><code>halive:lib\nhalive:exe:halive\nhalive:test:compileexpr\nhalive:test:demo\nhalive:test:subhalive\nhalive:test:testghc\nhalive:test:unit\n</code></pre>\n\n<p>I'd like to now if there's a way we can ask stack, intero, or some other tool, which targets a target depends on. </p>\n\n<p>For example, in this scenario, I'd like stack/intero/whatever to tell me that <code>halive:test:unit</code> depends on <code>halive:lib</code>.</p>\n\n<p>In case that's not possible, I guess I can try inspecting the .cabal file myself... is there a parser or a tool or something that could give me something like that?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1513091209, "post_id": 47775537, "comment_id": 82512426, "body": "1. The operations in the <code>System.FilePath</code> module are platform agnostic - your friend probably should have used that for both Linux and windows instead of the discouraged <code>.Posix</code> and other platform-specific modules.  2. Local directory is implicit, so I suspect you can just remove all `.\\\\` prefixes to strings (I see two) and see how that works."}, {"owner": {"reputation": 13, "user_id": 9089208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c100f25d44bcd0443c4a63ecb521efd3?s=128&d=identicon&r=PG&f=1", "display_name": "Banaan51", "link": "https://stackoverflow.com/users/9089208/banaan51"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1513091212, "post_id": 47775537, "comment_id": 82512428, "body": "Edit: I use Haskell platform from official Linuxmint repo. 2 cabal packages are needed: MissingH and threadmanager both installed from terminal after cabal update"}, {"owner": {"reputation": 13, "user_id": 9089208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c100f25d44bcd0443c4a63ecb521efd3?s=128&d=identicon&r=PG&f=1", "display_name": "Banaan51", "link": "https://stackoverflow.com/users/9089208/banaan51"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1513093352, "post_id": 47775537, "comment_id": 82513826, "body": "@thomas Yess it works! I edited the source and changed the .\\\\ and removed the Posix module. Only remaining problem is the getOutputFilename path is wrong but i fixed that with replacing \\\\ with / in the path but i think that&#39;s not the right way? Is it better in this case to add the Posix module?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1513095697, "post_id": 47775537, "comment_id": 82515312, "body": "Instead of an explicit <code>&#47;</code> you should use the function <code>&lt;&#47;&gt;</code> from <code>System.FilePath</code>.  For example, <code>dataFilePath &lt;&#47;&gt; &quot;someFile&quot; &lt;.&gt; &quot;pdf&quot;</code> will give the proper slashes for both windows and *nix."}, {"owner": {"reputation": 13, "user_id": 9089208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c100f25d44bcd0443c4a63ecb521efd3?s=128&d=identicon&r=PG&f=1", "display_name": "Banaan51", "link": "https://stackoverflow.com/users/9089208/banaan51"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1513096074, "post_id": 47775537, "comment_id": 82515550, "body": "@Thomas I forgot to thank you very much!!"}, {"owner": {"reputation": 13, "user_id": 9089208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c100f25d44bcd0443c4a63ecb521efd3?s=128&d=identicon&r=PG&f=1", "display_name": "Banaan51", "link": "https://stackoverflow.com/users/9089208/banaan51"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1513101314, "post_id": 47775537, "comment_id": 82518576, "body": "@thomas I tried to implant example about filepath but i keep getting errors about not in scope. can you give a example based on the source code   getOutputFilename above? Otherwise it is not a big deal because i can keep this as linux only"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1513103883, "post_id": 47775537, "comment_id": 82519921, "body": "See my answer. Basically, you can delete the selective FilePath import and just import everything via <code>import System.FilePath</code> or add <code>(&lt;&#47;&gt;)</code> to the list of functions imported from that module."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 1, "last_activity_date": 1513103820, "creation_date": 1513103820, "answer_id": 47779373, "question_id": 47775537, "link": "https://stackoverflow.com/questions/47775537/haskell-source-compile-on-linux/47779373#47779373", "title": "haskell source compile on Linux", "body": "<p>You have a unnecessary platform dependent code.  Use <code>System.FilePath</code> instead for the platform independent version.  Also, omit the <code>.\\\\</code> prefix since the local directory is implicit.</p>\n\n<p>For an example of platform independent paths, don't do this:</p>\n\n<pre><code>getOutPutFileName = \".\\\\output\\\\CDs.sql\"\n</code></pre>\n\n<p>Instead modify your import to be either all of the module (<code>import System.FilePath</code>) or include more functions <code>import System.FilePath ((&lt;/&gt;), ... and the rest...)</code>.  Then use these functions:</p>\n\n<pre><code>getOutPutFileName = \"output\" &lt;/&gt; \"CDs.sql\"\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 9089208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c100f25d44bcd0443c4a63ecb521efd3?s=128&d=identicon&r=PG&f=1", "display_name": "Banaan51", "link": "https://stackoverflow.com/users/9089208/banaan51"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 47779373, "answer_count": 1, "score": 1, "last_activity_date": 1513103820, "creation_date": 1513090530, "last_edit_date": 1513102258, "question_id": 47775537, "link": "https://stackoverflow.com/questions/47775537/haskell-source-compile-on-linux", "title": "haskell source compile on Linux", "body": "<p>This is my first post on stackoverflow so please be patient.</p>\n\n<p>First of all, I don't know anything about Haskell; I program as a hobby with PHP (+HTML/CSS).</p>\n\n<h3>Situation</h3>\n\n<p>A friend of my made a parser to parse freedb textfiles to MySQL in Haskell. He made this for Windows, but now I want to compile the source to a Linux executable on Linux Mint 18.3 64bit. My friend has given me an edit to the source just before he got sick to adjust it to Linux and changed Posix from Windows</p>\n\n<pre><code>System.FilePath.Posix (addTrailingPathSeparator,splitFileName,splitPath,takeDirectory)\n</code></pre>\n\n<p>This source compiles very well on Linux and I get a working executable, but the problem comes when I try to run it &ndash; this error comes up:</p>\n\n<blockquote>\n  <p>FreeDb: .\\data/ getDirectoryContents: does not exist (no such file or\n  directory)</p>\n</blockquote>\n\n<p>It should have find a data directory in the directory where the executable is started but obviously .\\data/ doesn't work on linux.</p>\n\n<p>Full source:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport HulpFunc\nimport qualified Data.ByteString.Char8 as B\nimport Text.Parsec.ByteString\nimport Text.Parsec\nimport Data.Int\nimport Data.List\nimport Control.Applicative((*&gt;),(&lt;*))\nimport Text.Parsec.Prim((&lt;|&gt;))\nimport Data.String.Utils (strip)\nimport Data.Char\nimport System.FilePath.Posix (addTrailingPathSeparator,splitFileName,splitPath,takeDirectory)\nimport Control.Monad (filterM,liftM)\nimport System.Directory (getDirectoryContents,doesFileExist,doesDirectoryExist)\nimport System.IO (IOMode(..),hClose,hPrint,hSetEncoding,openFile,latin1,hSetBuffering,BufferMode,hPutStrLn,hGetContents)\nimport System.Environment\nimport Data.Time\nimport Control.Concurrent\nimport Control.Concurrent.Chan\nimport Control.Monad\nimport qualified Control.Concurrent.ThreadManager as TM\nimport System.Exit (exitFailure)\n\ndata Track = Track {\n                    t_idx :: !Int,\n                    t_title:: !B.ByteString,\n                    t_artist:: !B.ByteString,\n                    t_offset :: !Int,\n                    t_lengthSec :: !Int  -- lengte &lt; 0 =&gt; onbekend\n                  }  deriving Show\n\ndata CD = CD {\n            d_id :: !B.ByteString,\n            d_title :: !B.ByteString,\n            d_artist :: !B.ByteString,\n            d_genre :: !B.ByteString,\n            d_year :: !Int,\n            d_lengthSec :: !Int,\n            d_tracks :: ![Track]\n          } deriving Show\n\nemptyCD :: CD\nemptyCD = CD {\n            d_id = \"\",\n            d_title = \"\",\n            d_artist = \"\",\n            d_genre = \"\",\n            d_year = 0,\n            d_tracks = [],\n            d_lengthSec = 0\n          }\n\nfreeDbFiles :: String -&gt; IO [String]\nfreeDbFiles startDir  = do\n                            let startDir' = addTrailingPathSeparator startDir\n                            names &lt;- getDirectoryContents startDir'\n                            let names' = Prelude.filter (`notElem` [\".\", \"..\"]) names\n                                qualifiedNames = map (startDir' ++) names'\n                            dirs &lt;-  filterM (doesDirectoryExist . addTrailingPathSeparator) qualifiedNames\n                            files &lt;- filterM doesFileExist qualifiedNames\n                            subDirFiles &lt;- mapM freeDbFiles dirs\n                            return $ files ++ (concat subDirFiles)\n\ninsertCmd :: B.ByteString\ninsertCmd = \"INSERT INTO `CDs`\\n(`discId`,`genre`,`artiest`,`titel`,`jaar`,`lengte`,`nummers`)\\nVALUES\\n\";\n\ntracksToSQL :: [Track] -&gt; B.ByteString\ntracksToSQL  tracks  = surround \"\\'\"  $ foldr (\\track str -&gt;\n                                                let fieldValueList = map (\\f -&gt; (sqlEscape . f) track) [t_artist, t_title, B.pack . show . t_lengthSec]  --list of Bytestrings\n                                                    newStr = B.intercalate \"@\" fieldValueList\n                                                in newStr `B.append` \"\\n\" `B.append` str ) \"\" tracks\nshowCD :: CD -&gt; B.ByteString\nshowCD cd = let sqlTracks = tracksToSQL (d_tracks cd)\n                cdPart = (B.intercalate \", \" $ map (\\f -&gt; (sqlField . f) cd)[d_id, d_genre, d_artist, d_title, B.pack . show . d_year, B.pack . show . d_lengthSec])\n            in  zetHaakjes (cdPart `B.append` \",\\n\" `B.append` sqlTracks)\n\nmySpace = (char ' ') &lt;|&gt; tab -- satisfy  (\\c -&gt; (c == ' ' ||  c == '\\t'))\nmySpaces = many mySpace\n\n-- alle parsers voor # (commentlines)\nparseToNewLine :: GenParser Char CD B.ByteString\nparseToNewLine = do\n                    line &lt;- manyTill anyChar eol\n                    return $ \"parseToNewLine: \" `B.append` (B.pack line)\n\ncommentLine =   do\n                     char '#'\n                     mySpaces\n                     line &lt;- (try trackFrameOffsets &lt;|&gt; try discLength &lt;|&gt; parseToNewLine)\n                     return line\n\ndiscLength :: GenParser Char CD B.ByteString\ndiscLength  =   do\n                    string \"Disc length:\"\n                    mySpaces\n                    str &lt;- many digit\n                    -- soms staat hier seconds soms niks\n                    parseToNewLine\n                    updateState (\\cd -&gt; cd{d_lengthSec = (read str::Int)})\n                    return $ \"DiscLength: \" `B.append` (B.pack str)\n\nreadTrackOffSet=  do\n                    char '#'\n                    mySpaces\n                    str &lt;- many1 digit\n                    mySpaces\n                    eol\n                    return (read str::Int)\n\ntrackFrameOffsets = do\n                        string \"Track frame offsets:\"\n                        mySpaces\n                        eol\n                        offSets &lt;- many (try readTrackOffSet)\n                        cd &lt;- getState\n                        let tracks = map (\\(idx,offSet) -&gt; Track { t_idx = idx\n                                                                        ,t_title=\"\"\n                                                                        ,t_artist=\"\"\n                                                                        ,t_offset=offSet\n                                                                        ,t_lengthSec = 0\n                                                                    }) (zip [0..] offSets)\n                            cd' = cd {d_tracks= tracks}\n                        updateState (\\cd -&gt; cd')\n                        return $ B.pack $ \"Tracks: \" ++ (show $ length offSets)\n-- einde # (comment) parsers\n\neol = do \n        try  (string \"\\n\\r\")\n        &lt;|&gt; try (string \"\\r\\n\")\n        &lt;|&gt; string \"\\n\"\n        &lt;|&gt; string \"\\r\"\n\nplay p s = runParser p emptyCD \"parameter\" $ B.pack s  -- testen van een parser\nplayFile p fn = do\n                    putStrLn fn\n                    hIn &lt;- openFile fn ReadMode\n                    hSetEncoding hIn latin1\n                    cont &lt;- B.hGetContents hIn\n                    B.putStrLn $ B.take 20 cont\n                    cont `seq` hClose hIn\n                    let res = play p $ B.unpack cont\n                    res `seq` (putStrLn $ show res)\n\ntestCalcTrackLength =let    cd = CD {d_id = \"0c002502\", d_title = \"Well Well Well\", d_artist = \"Well Well Well\", d_genre = \"\", d_year = 0, d_tracks = [Track {t_idx = 1, t_title = \"Well Well Well2\", t_artist = \"\", t_offset = 150, t_lengthSec = 0},Track {t_idx = 2, t_title = \"\", t_artist = \"\", t_offset = 1487, t_lengthSec = 0}], d_lengthSec = 39}\n                            sortedTracks = sortBy (\\tr1 tr2 -&gt; compOffsets tr1 tr2) (d_tracks cd) -- omgekeerde volgorde\n                            combinedTracks = zip sortedTracks (tail sortedTracks)\n                            tracksWithLengthNoLastTrack =  map (\\(tHi,tLo) -&gt; tLo {t_lengthSec = ((t_offset tHi) - (t_offset tLo)) `div` 75}) combinedTracks\n                            lt = head sortedTracks\n                            lt' = lt {t_lengthSec = (75 * (d_lengthSec cd) -  (t_offset lt)) `div` 75}\n                            tracksWithLength = lt' : tracksWithLengthNoLastTrack\n                            cd' = calculateTrackLengths cd\n                        in (show tracksWithLength) ++ \"\\r\" ++ (show (tracksToSQL   tracksWithLength))\n\n-- begin keyValue parsers (zonder # aan het begin van de regel)\nreadIs = do\n            mySpaces\n            char '='\n            mySpaces\n            return \"\"\n\nnoHash = notFollowedBy (char '#')\n\nupdateTrackInfo :: Int -&gt; B.ByteString -&gt;  B.ByteString -&gt; [Track] -&gt; [Track]\nupdateTrackInfo idx artist title tracks = map   (\\t -&gt; if (t_idx t == idx) then\n                                                            t { t_title=title,t_artist=artist}\n                                                        else\n                                                            t\n                                                ) tracks\n\ntrackTitle :: GenParser Char CD B.ByteString\ntrackTitle = do -- dit is alleen voor tracks\n                string \"TTITLE\"\n                idxStr &lt;- many1 digit\n                readIs\n                (fi,la)&lt;- splitLine\n                let idx = read idxStr :: Int\n                    (art,ti)= if (la == \"\") then  -- alleen een titel, de artiest komt van de D_TITLE\n                                    (\"\",fi)\n                                 else\n                                    (fi,la) -- een regel als \"de artiest / de titel\\n\"\n                updateState (\\cd -&gt; cd {d_tracks = updateTrackInfo idx  art ti (d_tracks cd)})\n                return (\"TrackIdx: \" `B.append` ((B.pack . show) idx) `B.append` \", Art: \" `B.append` art `B.append` \", Titel: \" `B.append` ti)\n\n-- splits line in left,right by ' / '. Als er geen zit dan alles in left\ncharNotEol  :: GenParser Char CD Char\ncharNotEol =  do\n                c &lt;-  notFollowedBy eol *&gt; anyChar\n                return c\n\nsplittableLine :: GenParser Char CD (B.ByteString,B.ByteString)\nsplittableLine = do\n                    le &lt;- manyTill charNotEol (try (string \" / \"))\n                    ri &lt;- restLine\n                    return (B.pack le, ri)\n\nnoSplittableLine :: GenParser Char CD (B.ByteString,B.ByteString)\nnoSplittableLine = do\n                      s &lt;- restLine\n                      return (s,\"\")\n\nsplitLine  :: GenParser Char CD (B.ByteString,B.ByteString)\nsplitLine = (try splittableLine) &lt;|&gt; noSplittableLine\n\nrestEXTD = do  -- extended value voor een disk. Meer EXTDs worden als strings aan elkaar geplakt.\n               char 'D'\n               readIs\n               extd &lt;- restLine\n               return extd\n\nrestEXTTN = do\n               char 'T';\n               str &lt;- many digit\n               let idx = read str :: Int\n               readIs\n               value &lt;- restLine\n               return value\n\nrestLine =    do\n                mySpaces\n                rest &lt;- (manyTill anyChar eol)\n                return $ B.pack rest\n\n\nrestDTitle :: GenParser Char CD B.ByteString\nrestDTitle =  do\n                string \"TITLE\"\n                readIs\n                (art,ti) &lt;- splitLine\n                updateState( \\cd -&gt; cd{d_artist=art,d_title= ti})\n                return $ \"DTitle: \" `B.append` ti `B.append` \", DArtist: \" `B.append` art\n\nrestDYear :: GenParser Char CD  B.ByteString\nrestDYear = do\n               string \"YEAR\"\n               readIs\n               yearStr &lt;- restLine\n               let y = if (trim yearStr == \"\") then\n                            0\n                       else\n                            ((read.B.unpack) yearStr)::Int\n               updateState( \\cd -&gt; cd{d_year=y})\n               return  $ \"DYEAR: \" `B.append` yearStr\n\nrestDGenre :: GenParser Char CD B.ByteString\nrestDGenre= do\n                string \"GENRE\"\n                readIs\n                genre &lt;- restLine\n                updateState( \\cd -&gt; cd{d_genre = genre})\n                return genre\n\nrestDiscId = do\n                string \"ISCID\"\n                readIs\n                discId &lt;- restLine\n                updateState( \\cd -&gt; cd{d_id = discId})\n                return discId\n\ndKeyValue = (char 'D') *&gt; choice [restDTitle,restDYear,restDGenre,restDiscId]\n\nkeyValue =   do\n                noHash\n                mySpaces\n                res &lt;- choice [dKeyValue,trackTitle,garbageKeyValue]\n                return res\n\ngarbageKeyValue = do\n                    key &lt;- (manyTill anyChar (char '='))\n                    mySpaces\n                    val &lt;- restLine\n                    return  $ \"kvGarbage key: \"  `B.append` (B.pack key)  `B.append` \", val: \" `B.append` val\n-- einde keyValue\n\nvalidCd :: CD -&gt; Bool\nvalidCd cd = let titleStr = d_title cd `B.append` d_artist cd\n                 (valid,invalid) =\n                              B.foldr (\\c (va,inva) -&gt; if isAlphaNum c then\n                                                                (va+1,inva)\n                                                          else\n                                                                (va,inva+1)) (0,0) titleStr\n             in  valid &gt; invalid\n\n--validCd cd = True\nparseCD :: GenParser Char CD CD\nparseCD = do\n                setState emptyCD\n                commentInfo &lt;- many commentLine\n                keyValues &lt;- many keyValue\n                cd &lt;- getState\n                let cd' = calculateTrackLengths cd \n                updateState (\\cd -&gt; cd')\n                return $ cd'\n\n-- | omgekeerd sorteren\ncompOffsets :: Track -&gt; Track -&gt; Ordering\ncompOffsets t1 t2 =  let off1 = t_offset t1\n                         off2 = t_offset t2\n                     in case compare off1 off2 of\n                        LT -&gt; GT\n                        GT -&gt; LT\n                        EQ -&gt; EQ\n\nisValidTrackOffset :: Track -&gt; Bool\nisValidTrackOffset t = (t_offset t &gt;= 0)\n\nvalidDiskLength :: CD -&gt; [Track] -&gt; Bool\nvalidDiskLength cd sortedTracks =   if null sortedTracks then  -- sortedTracks: tracks omgekeerd gesorteerd op trackoffset\n                                        False\n                                    else \n                                        let lt = head sortedTracks\n                                        in   75 * (d_lengthSec cd) &gt; (t_offset lt)  -- is de laatste offset van de disk groter dan de offset van het laatste nummer\n\ncalculateTrackLengths :: CD -&gt; CD\ncalculateTrackLengths inCd =    if (all  isValidTrackOffset (d_tracks inCd)) then                                    \n\n                                    let sortedTracks = sortBy (\\tr1 tr2 -&gt; compOffsets tr1 tr2) (d_tracks inCd) -- omgekeerde volgorde sorteren op offsets\n                                        resTracks=  if null sortedTracks then\n                                                        []\n                                                    else               \n                                                        if validDiskLength inCd sortedTracks then\n                                                            let combinedTracks = zip sortedTracks (tail sortedTracks)\n                                                                tracksWithLengthNoLastTrack =  map (\\(tHi,tLo) -&gt; tLo {t_lengthSec = ((t_offset tHi) - (t_offset tLo)) `div` 75}) combinedTracks\n                                                                lt = head sortedTracks\n                                                                lt' = lt {t_lengthSec = (d_lengthSec inCd) -  ((t_offset lt) `div` 75)}\n                                                                tracksWithLength = lt' : tracksWithLengthNoLastTrack  -- alle track lengthes zijn ingevuld\n                                                            in  tracksWithLength\n                                                        else\n                                                            sortedTracks -- geen valid disklength\n                                    in inCd {d_tracks = reverse resTracks}\n                                    --in inCd {d_tracks = sortedTracks}\n                                else\n                                    inCd  -- niet allemaal geldige trackOffsets\n\nparseCDs :: GenParser Char CD [CD]\nparseCDs =  do\n               res &lt;- manyTill parseCD eof\n               return res\n\nparseFile hOutMVar filesChannel = do\n                                    fn &lt;- readChan filesChannel\n                                    if (fn == \"\") then\n                                        do\n                                            writeChan filesChannel \"\" -- laatste element. Stop recursion en zet de lege string weer op de channel voor andere threads\n                                            return () --klaar\n                                    else\n                                        do\n                                            hIn &lt;- openFile fn ReadMode\n                                            hSetEncoding hIn latin1\n                                            cont &lt;- B.hGetContents hIn                   --bestand inlezen\n                                            let res = runParser parseCDs emptyCD \"\" cont --bestand parsen\n                                            res `seq` hClose hIn                         --handle sluiten\n                                            hClose hIn\n                                            let (sql,errorMsg,valCds) = case res of -- sql en errorMsg zijn een bytestrings\n                                                                                (Left err)  -&gt; (\"\",B.pack $ show err,[])\n                                                                                (Right cds) -&gt;  let validCds = filter validCd cds\n                                                                                                    lines = B.intercalate \",\\n\" ((map showCD validCds))\n                                                                                                    lines' =  insertCmd `B.append` lines\n                                                                                                in  (lines' `B.append` (B.pack \";\\n\"),\"\",validCds)\n                                            -- er mag maar een thread tegelijk naar het outputbestand schrijven.\n                                            hOut &lt;- takeMVar hOutMVar  -- lock aanvragen\n                                            putStrLn fn                -- schrijf filename naar scherm\n                                            --putStrLn $ show $ head valCds\n                                            if not (B.null errorMsg) then\n                                                B.putStrLn errorMsg\n                                            else\n                                                B.putStr \"\"\n                                            B.hPutStrLn hOut sql       -- output naar file\n                                            putMVar hOutMVar hOut      -- lock vrijgeven\n                                            parseFile hOutMVar filesChannel -- recurse (next file)\n\nparseFiles hOut fns = do\n                            tm &lt;- TM.make\n                            excludeWrites &lt;- newEmptyMVar\n                            mapM (\\_ -&gt; TM.fork tm (parseFile excludeWrites fns)) [1..4]\n                            putMVar excludeWrites hOut -- hef de block op voor alle threads\n                            TM.waitForAll tm --wacht tot alle forks afgelopen zijn.\n\ngetOutPutFileName = \".\\\\output\\\\CDs.sql\"\n\nmain = do\n            start &lt;- getCurrentTime\n            excludeWrites &lt;- newEmptyMVar\n            files &lt;- freeDbFiles \".\\\\data\"\n            args&lt;- getArgs\n            let outputFn =  if null args then getOutPutFileName else head args\n            hOut &lt;- openFile outputFn AppendMode\n            hSetEncoding hOut latin1\n            filesChan &lt;- newChan\n            mapM_ (writeChan filesChan) files \n            writeChan filesChan \"\" -- lege map = klaar\n            parseFiles hOut filesChan\n            hClose hOut\n            stop &lt;- getCurrentTime\n            putStrLn \"klaar\"\n            print $ diffUTCTime stop start\n</code></pre>\n\n<p>It includes a helper source:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule HulpFunc(trim,\n                rTrim,\n                lTrim,\n                splitSubStr,\n                removeLastChars,\n                splitArr,\n                surround,\n                zetHaakjes,\n                sqlEscape,\n                sqlQuote,                \n                sqlField)\n\nwhere           \n\nimport Text.Parsec.ByteString(Parser)\nimport qualified Data.ByteString.Char8 as B\nimport Data.Int\n\nsnoc :: [a] -&gt; a -&gt; [a]\nsnoc [] s = [s]\nsnoc (c:cs) s = c: snoc cs s\n\nsplitArr :: Int -&gt; [a] -&gt; [[a]]\nsplitArr _   [] = []\nsplitArr idx xs = let (fi,rest)=splitAt idx xs\n                  in fi : (splitArr idx rest)\n\nsplitSubStr :: String -&gt; String -&gt; (String,String)\nsplitSubStr \"\" str = (str,\"\")\nsplitSubStr subStr str =  let (fi,la) = splitSubStrRecurse \"\" subStr str\n                              trimmed = if fi==str then\n                                            fi\n                                        else\n                                            removeLastChars (length subStr) fi\n                          in (trimmed, la)\n\nsplitSubStrRecurse :: String -&gt; String -&gt; String -&gt; (String {-first-}, String {-last-})\nsplitSubStrRecurse foundPrefix subStr \"\" = (\"\",\"\")\nsplitSubStrRecurse foundPrefix subStr str = let le = length subStr\n                                                c = head str\n                                                newFoundPrefix = let pf = snoc foundPrefix c\n                                                                 in if length pf &gt; le then\n                                                                        tail pf\n                                                                    else\n                                                                        pf\n                                            in  if newFoundPrefix == subStr then\n                                                   ([c],drop 1 str)\n                                                else\n                                                    let (fi,la) = splitSubStrRecurse newFoundPrefix subStr $ tail str\n                                                    in ((c : fi), la)\n\nremoveLastChars ::  Int -&gt; String  -&gt; String\nremoveLastChars le s =  let sLe=length s\n                        in if sLe &lt;= le then\n                               \"\"\n                           else\n                              take (sLe-le) s\n\nzetHaakjes :: B.ByteString -&gt; B.ByteString                   \nzetHaakjes s =  \"(\" `B.append` s `B.append` \")\"\n\nsurround  :: B.ByteString -&gt; B.ByteString -&gt; B.ByteString\nsurround surr s = surr `B.append` (s `B.append` surr)\n\n-- sql\n\nsqlQuote = surround \"\\'\"\n\nsqlEscape :: B.ByteString -&gt; B.ByteString\nsqlEscape \"\" = \"\"\nsqlEscape s =   let t = sqlEscape $ B.tail s\n                in  case (B.head s) of\n                        '\\'' -&gt; \"\\\\'\" `B.append` t\n                        '\\\"' -&gt; \"\\\\\\\"\" `B.append` t\n                        '\\\\' -&gt; \"\\\\\\\\\" `B.append` t\n                        c  -&gt;  (B.cons c t)\n\nsqlField = sqlQuote .sqlEscape\n\nlTrim :: B.ByteString -&gt; B.ByteString\nlTrim \"\" = \"\"\nlTrim cs = if (B.head cs ==' ') then  lTrim $ B.tail cs else  cs\n\nrTrim = (B.reverse . lTrim . B.reverse)\n\ntrim :: B.ByteString -&gt; B.ByteString\ntrim  = rTrim . lTrim\n</code></pre>\n\n<p>Can someone clear this error, or put me in the right direction?</p>\n"}, {"tags": ["mysql", "haskell", "scotty"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1513085026, "post_id": 47773388, "comment_id": 82508292, "body": "If you drop the signature of <code>IO User</code>, it will probably work."}, {"owner": {"reputation": 125, "user_id": 9014107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56645781f18f8b0289b6627b5ecb3dd0?s=128&d=identicon&r=PG&f=1", "display_name": "navin", "link": "https://stackoverflow.com/users/9014107/navin"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1513085597, "post_id": 47773388, "comment_id": 82508699, "body": "Tried that. Got following error Couldn&#39;t match type \u2018IO\u2019 with \u2018ActionT Error ConfigM\u2019       Expected type: ActionT Error ConfigM a0         Actual type: IO a0"}], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 9014107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56645781f18f8b0289b6627b5ecb3dd0?s=128&d=identicon&r=PG&f=1", "display_name": "navin", "link": "https://stackoverflow.com/users/9014107/navin"}, "edited": false, "score": 0, "creation_date": 1513159392, "post_id": 47781927, "comment_id": 82541450, "body": "Also, I actually wanted to use Persistent library but then Persistent creates my data type dynamically . Like User data type in this case . And then I will have to import that file everywhere in my code where I want to use User data type , which will create dependency of Persistent in my entire code base . Hence, I am not using it ."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 2, "last_activity_date": 1513114442, "creation_date": 1513114442, "answer_id": 47781927, "question_id": 47773388, "link": "https://stackoverflow.com/questions/47773388/scotty-api-with-mysql-simple-in-haskell/47781927#47781927", "title": "Scotty api with mysql simple in haskell", "body": "<p>You left out plenty of code (imports and pragmas and the definitions of <code>User</code>, please include that next time - see <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>.</p>\n\n<p>But now to your question:</p>\n\n<p>I would change the <code>Action</code> type to the following</p>\n\n<pre><code>type Action a = ActionT Error ConfigM a\n</code></pre>\n\n<p>then <code>getTasksA</code> has the following type signature</p>\n\n<pre><code>getTasksA :: Action ()\ngetTasksA = do\n    u &lt;- getUser\n    json u \n</code></pre>\n\n<p>(alternatively you can write this as <code>getTasksA = getUser &gt;&gt;= json</code>)</p>\n\n<p>and <code>getUser</code></p>\n\n<pre><code>getUser :: Action User\ngetUser = do\n  e &lt;- asks environment\n  conn &lt;- db1Conn config \n  [user] &lt;- liftIO $ query_ conn \"select login as userId, ...\"\n  return user\n</code></pre>\n\n<h2>A few remarks</h2>\n\n<ul>\n<li><p><code>[user] &lt;- liftIO $ query ..</code> is a bad idea - if no user is found this crashes your application - try to write total functions and pattern matches. Better return a <code>Maybe User</code>.</p>\n\n<pre><code>getUser :: Action (Maybe User)\ngetUser = do\n  e &lt;- asks environment\n  conn &lt;- db1Conn config \n  fmap listToMaybe . liftIO $ query_ conn \"select login as userId, ...\"\n</code></pre></li>\n<li><p>if you can wrap your head around it, rather use <code>persistent</code> than writing your SQL queries by hand - this is quite error prone, especially when refactoring, just imagine renaming <code>userId</code> to <code>userID</code>.</p></li>\n<li><p>you <code>ask</code> several times for the <code>environment</code> but then don't use it. Compile with <code>-Wall</code> or even <code>-Werror</code> to get a warning or even elevate warnings to compile errors (which is a good idea for production settings.</p></li>\n</ul>\n"}], "owner": {"reputation": 125, "user_id": 9014107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56645781f18f8b0289b6627b5ecb3dd0?s=128&d=identicon&r=PG&f=1", "display_name": "navin", "link": "https://stackoverflow.com/users/9014107/navin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1513114442, "creation_date": 1513083878, "question_id": 47773388, "link": "https://stackoverflow.com/questions/47773388/scotty-api-with-mysql-simple-in-haskell", "title": "Scotty api with mysql simple in haskell", "body": "<p>I am following <a href=\"http://taylor.fausak.me/2014/10/21/building-a-json-rest-api-in-haskell/\" rel=\"nofollow noreferrer\">this</a> tutorial which uses scotty with persistent to create a simple API .</p>\n\n<p>However, I am trying to create a simple api with scotty and mysql simple library.</p>\n\n<p>Now I am stuck at one point in code .</p>\n\n<p>In the below code I am not able to convert <strong>getUser</strong> function to type <strong>\"ActionT Error ConfigM\"</strong> because of which my code is failing.</p>\n\n<p><strong><em>Can anyone help me with understanding how I can convert getUser function to achieve needed type signature?</em></strong></p>\n\n<p><strong>Code</strong></p>\n\n<pre><code>type Error = Text\ntype Action = ActionT Error ConfigM ()\n\nconfig :: Config\nconfig = Config\n    { environment = Development \n     ,db1Conn = connect connectionInfo\n    }\n\nmain :: IO ()\nmain = do\n  runApplication config\n\nrunApplication :: Config -&gt; IO ()\nrunApplication c = do\n  o &lt;- getOptions (environment c)\n  let r m = runReaderT (runConfigM m) c\n  scottyOptsT o r application\n\napplication :: ScottyT Error ConfigM ()\napplication = do\n  e &lt;- lift (asks environment)\n  get \"/user\" getTasksA\n\ngetTasksA :: Action\ngetTasksA = do\n    u &lt;- getUser\n    json u \n\ngetUser :: IO User\ngetUser = do\n  e &lt;- asks environment\n  conn &lt;- db1Conn config \n  [user]&lt;- query_ conn \"select login as userId, email as userEmail from member limit 1\"\n  return user \n</code></pre>\n\n<p><strong>Error</strong> </p>\n\n<pre><code>\u2022 Couldn't match type \u2018IO\u2019 with \u2018ActionT Error ConfigM\u2019\n      Expected type: ActionT Error ConfigM User\n        Actual type: IO User\n    \u2022 In a stmt of a 'do' block: u &lt;- getUser\n      In the expression:\n        do { u &lt;- getUser;\n             json u }\n      In an equation for \u2018getTasksA\u2019:\n          getTasksA\n            = do { u &lt;- getUser;\n                   json u }\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1513071743, "post_id": 47769292, "comment_id": 82499872, "body": "I think that in Haskell functions should be seen as <i>blackboxes</i>. Since there are a zillion ways to construct exactly the same function (partial application, lambda expressions, etc.). So it looks to me it would be bad design to do such &quot;whitelisting&quot;."}, {"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1513076037, "post_id": 47769292, "comment_id": 82502548, "body": "In my case the whitelisting could be used to add some guarantees that are now left to the user of a lib. There are many conceptually overlapping sets of functions and thus the situation is a bit more complex than in the q above. In practice, I cannot change the lib that allows &quot;too many usages for functions&quot; to construct conceptually in-approriate function applications. But maybe a wrapper for the lib that would define appropriate data-types that can be &quot;classified&quot; and that would have a function producing <code>m a</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1513077332, "post_id": 47769292, "comment_id": 82503323, "body": "Haskell does not have dependent types, hence substituting a subexpression like <code>f1</code> with another one of the same type like <code>f4</code> is always possible. You need to assign those two functions different types, e.g. using a <code>newtype</code> wrapper."}], "answers": [{"comments": [{"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "edited": false, "score": 0, "creation_date": 1513258817, "post_id": 47772951, "comment_id": 82590845, "body": "This raised an extra q about the constraints induced by writing things like <code>f3</code> in your answer. I made a <code>class Hmm</code> and <code>class SHmm</code> to represent envs  <code>SomeMonad</code> and <code>SpecificMonad</code>, and then wrote functions <code>f, g, f1,.., f4</code> to check types with ghci. The type of <code>f4 $ g f1</code> will be specific (it has constraint <code>SHmm</code>). I&#39;m suspecting that in practice I have to be able to turn <code>SHmm</code> back to <code>Hmm</code> (because otherwise I should put <code>SHmm</code> into quite many places). In small setting this might do but I&#39;m suspecting that this doesn&#39;t scale to the problem I&#39;m facing (I&#39;ll update the q a bit)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1513083911, "last_edit_date": 1513083911, "creation_date": 1513082565, "answer_id": 47772951, "question_id": 47769292, "link": "https://stackoverflow.com/questions/47769292/how-to-restrict-function-parameters-using-haskell/47772951#47772951", "title": "How to restrict function parameters using Haskell?", "body": "<p>If <code>f1</code>,<code>f2</code>,<code>f3</code>,<code>f4</code> all have the same type signature, then the type system can't distinguish between them (duh), so you also can't restrict which of them should be valid.</p>\n\n<p>So before you can possibly accomplish your goal, you need some distinction in the signatures. Probably the most sensible way is to refine the monad-class constraint:</p>\n\n<pre><code>class SomeMonad m =&gt; SpecificMonad m\n\nf1, f2 :: SomeMonad m =&gt; m a -&gt; m a     -- same as before\nf3, f4 :: SpecificMonad m =&gt; m a -&gt; m a -- more restrictive\n</code></pre>\n\n<p>(You wouldn't need to change the implementations here, because <code>SpecificMonad</code> guarantees <code>SomeMonad</code>.)</p>\n\n<p>Now, <code>f :: SomeMonad m =&gt; (m a -&gt; m a) -&gt; m a</code> by itself does not enforce that the argument fulfills any particular constraint &ndash; whatever function you pass in would merely add its constraint to the <code>SomeMonad</code> m constraint that <code>f</code> brings itself, i.e.</p>\n\n<pre><code>f f1 :: SomeMonad m =&gt; m a\nf f3 :: SpecificMonad m =&gt; m a -- because `SomeMonad` is superclass, we don't need\n                               -- to mention it, but it's actually implicit constraint\n</code></pre>\n\n<p>are both well-typed.</p>\n\n<p>You can however enfore that <code>f</code> will only accept a function with a particular, <em>not too specific</em> constraint. That requires Rank-2 polymorphism<sup>&dagger;</sup>:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, UnicodeSyntax #-}\n\ng :: SomeMonad m =&gt; (\u2200 \u03bc . SomeMonad \u03bc =&gt; \u03bc a -&gt; \u03bc a) -&gt; m a\ng \u03c6 = f \u03c6\n</code></pre>\n\n<p>Now, you can write <code>g f1</code>, because <code>f1</code> is a polymorphic function that works on any <code>SomeMonad</code>. You cannot however write <code>g f3</code>, because <code>f3</code> is too picky in what monads it can operate with, and even if the outer <code>m</code> that <code>g f3</code> is supposed to be used with does fulfill the <code>SpecificMonad</code> constraint<sup>&ddagger;</sup>, <code>g</code> will not allow its argument to access that information.</p>\n\n<hr>\n\n<p>Of course, to now use <code>f3</code> and <code>f4</code> in any other, <em>legitimate</em> setting, such as <code>f4 $ g f1</code>, you will have to add instances for <code>SpecificMonad</code> to any monad they should work with. These are one-liners like</p>\n\n<pre><code>instance SpecificMonad []\ninstance SpecificMonad Maybe\n</code></pre>\n\n<p>(provided that these have <code>SomeMonad</code> instances already).</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>Written without Unicode:<br><pre><code>g :: SomeMonad m => (forall m' . SomeMonad m' => m' a -> m' a) -> m a<br>g = f</code></pre></sub></p>\n\n<p><sup>&ddagger;</sup><sub>As it must, if you want to write <code>f4 $ g f1</code>.</sub></p>\n"}, {"comments": [{"owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "edited": false, "score": 0, "creation_date": 1513257922, "post_id": 47783055, "comment_id": 82590237, "body": "I made <code>data Proxy (ty :: Type) a = Proxy</code> and this made it possible to write <code>f</code> and <code>g</code> variants that work in the setting given in q above. And <code>h1 :: SomeMonad t m =&gt; Proxy A -&gt; m t -&gt; m t</code> etc.  Scaling is something that is making my head itch. (I&#39;ll make a late addition to the q about scaling in a more complex/larger env that is closer to the actual practical problem I&#39;m facing.)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1513120174, "creation_date": 1513120174, "answer_id": 47783055, "question_id": 47769292, "link": "https://stackoverflow.com/questions/47769292/how-to-restrict-function-parameters-using-haskell/47783055#47783055", "title": "How to restrict function parameters using Haskell?", "body": "<p>Perhaps you can get away with a simple phantom type parameter. For example:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n\ndata Type = A | B\ndata Id (ty :: Type) a = Id a\n\nf1, f2 :: Id A a -&gt; Id A a\nf1 = id\nf2 = id\n\nf3, f4 :: Id B a -&gt; Id B a\nf3 = id\nf4 = id\n</code></pre>\n\n<p>In ghci, we can see that <code>f1</code> and <code>f2</code> combine just fine, as do <code>f3</code> and <code>f4</code>, but not e.g. <code>f1</code> and <code>f3</code>:</p>\n\n<pre><code>Main&gt; :t f1 . f2\nf1 . f2 :: Id 'A a -&gt; Id 'A a\nMain&gt; :t f3 . f4\nf3 . f4 :: Id 'B a -&gt; Id 'B a\nMain&gt; :t f1 . f3\n\n&lt;interactive&gt;:1:6: error:\n    \u2022 Couldn't match type \u2018'B\u2019 with \u2018'A\u2019\n      Expected type: Id 'B a -&gt; Id 'A a\n        Actual type: Id 'B a -&gt; Id 'B a\n    \u2022 In the second argument of \u2018(.)\u2019, namely \u2018f3\u2019\n      In the expression: f1 . f3\n</code></pre>\n"}], "owner": {"reputation": 799, "user_id": 1964881, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/bVDPU.png?s=128&g=1", "display_name": "Gspia", "link": "https://stackoverflow.com/users/1964881/gspia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 0, "accepted_answer_id": 47772951, "answer_count": 2, "score": 1, "last_activity_date": 1513265844, "creation_date": 1513071263, "last_edit_date": 1513265844, "question_id": 47769292, "link": "https://stackoverflow.com/questions/47769292/how-to-restrict-function-parameters-using-haskell", "title": "How to restrict function parameters using Haskell?", "body": "<p>Let's assume four functions <code>f1,f2,f3,f4 :: SomeMonad m =&gt; m a -&gt; m a</code> where <code>f1</code> and <code>f2</code> are conceptually related and similarly <code>f3</code> and <code>f4</code>.</p>\n\n<p>Now it is possible to write a function <code>f :: SomeMonad m =&gt; (m a -&gt; m a) -&gt; m a</code> that can take any of the <code>f1..f4</code> as input. And then it is possible to write, say, <code>f1 $ f f2</code>.</p>\n\n<p>The question is, how to write a function <code>g</code> such that it accepts only <code>f1</code> or <code>f2</code> as a parameter? We should be able to write <code>f4 $ g f1</code> and ghc should deny <code>g f3</code>.</p>\n\n<p>If I try to add a <code>class</code>, say <code>:: (SomeMonad m, Some_G_class a) =&gt;</code>, the return type <code>a</code> is also constrained and then <code>f4</code> cannot be applied. And similarly it seems that the <code>m</code> cannot be modified.</p>\n\n<hr>\n\n<p><strong>Late Addition</strong></p>\n\n<p>The answers by Daniel Wagner and leftroundabout both seem to be useable. </p>\n\n<p>Here is more about the actual (and practical) problem.</p>\n\n<ul>\n<li>The underlying lib contains tens of functions returning <code>m a</code>.</li>\n<li>The lib has been build so that functions can be chained, e.g. with <code>(.)</code> like  <code>f1 . f2 . f3</code>. </li>\n<li>Conceptually, there is about five to ten subsets of those functions, subsets overlapping. The functions should be chaineable within each subset but not with functions from the other subsets.</li>\n</ul>\n\n<p><strong>Using Proxies</strong></p>\n\n<p>It seems that </p>\n\n<pre><code>data Type = A | B\u00a0| C ... | H\ndata Proxy (ty :: Type) = Proxy\n</code></pre>\n\n<p>could be used to classify functions. To handle overlapping useage, a function call like</p>\n\n<pre><code>h1 :: SomeMonad t m =&gt; Either (Proxy A) (Proxy B) -&gt; m t -&gt; m t\nh1 (Left (Proxy :: Proxy A) mt = ..\nh1 (Right (Proxy :: Proxy B) mt = ..\n</code></pre>\n\n<p>could do it. But what if there are functions belonging to <code>A, B, C</code> and <code>D</code>? Maybe there is something like <code>OneOf</code> or <code>Any</code> that would work here?</p>\n\n<p><strong>Using RankNTypes</strong></p>\n\n<p>It seems that the <code>SpecificMonad</code>-constraint (restriction?) starts to propage to the usage sites of the functions <code>f3</code> and <code>f4</code> (that is, all over). I feel that if I try to manage the 5-10 overlapping function sets, there will be  serious difficulties with those constraints propagating every where. Is this the case?</p>\n\n<p>So we need a function to make coercing, maybe something like</p>\n\n<pre><code>fg :: (SomeMonad t m1, SpecificMonad t m2) =&gt; m2 t -&gt; m1 t\nfg a = pure $ fromSpecM a\n</code></pre>\n\n<p>and atm assuming <code>SomeMonad</code> has <code>pure</code>. In my case I cannot add <code>fromSpecM</code> to the class-methods of <code>SomeMonad</code> but maybe it is ok in <code>SpecificMonad</code>. And my first trials along this way are still too simple so that I could see if this is doable. It may well be that I'm not seeing something very obvious here. </p>\n\n<p>In a way, <code>SpecificMonad</code> shouldn't have any additional methods and it should just work as a \"local env/fix/hack\" not affecting other parts of the code. Thus, is there other ways to accomplish something like <code>fg</code>?</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 4, "creation_date": 1513043504, "post_id": 47764139, "comment_id": 82489811, "body": "funsat 0.6.2 was released in 2011, so no wonder it cannot be compiled in latest ghc. Looking into the <a href=\"https://github.com/dbueno/funsat/commits/master\" rel=\"nofollow noreferrer\">commit history</a>, there seems version 0.6.3. which is not yet released in hackage. You can give it a try."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1513081259, "post_id": 47764139, "comment_id": 82505779, "body": "@ymonad To be fair, C code written years ago probably still compiles just fine today. ;-)"}], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 2, "last_activity_date": 1513151533, "last_edit_date": 1513151533, "creation_date": 1513081091, "answer_id": 47772460, "question_id": 47764139, "link": "https://stackoverflow.com/questions/47764139/haskell-error-with-cabal-no-instance-for/47772460#47772460", "title": "Haskell error with cabal: no instance for", "body": "<p>This is failing to compile due to the <a href=\"https://wiki.haskell.org/Functor-Applicative-Monad_Proposal\" rel=\"nofollow noreferrer\">Functor/Applicative/Monad proposal</a> implemented in more recent versions of GHC. The code would originally have compiled just fine, but in recent versions of GHC, you cannot declare something as <code>Monad</code> without first declaring it as <code>Functor</code> and <code>Applicative</code>. You used to be able to, but now you cannot.</p>\n\n<p>The library authors need to update the library's code to fix this new restriction.</p>\n"}], "owner": {"reputation": 491, "user_id": 5137138, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e37c34a79c1a83fe429961233358ef39?s=128&d=identicon&r=PG&f=1", "display_name": "Leomar de Souza", "link": "https://stackoverflow.com/users/5137138/leomar-de-souza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1518400155, "creation_date": 1513042946, "last_edit_date": 1518400155, "question_id": 47764139, "link": "https://stackoverflow.com/questions/47764139/haskell-error-with-cabal-no-instance-for", "title": "Haskell error with cabal: no instance for", "body": "<p>I'm trying to follow the steps for installation for derivation of software product lines called <a href=\"https://github.com/hephaestus-pl/hephaestus-base\" rel=\"nofollow noreferrer\">hephaestus-pl</a>. However, at the time of performing the installation steps, according to the tutorial, there is an error when executing the <code>cabal install</code> command on all cloned repositories. The erros is:</p>\n\n<pre><code>$ sudo cabal install\nResolving dependencies...\nNotice: installing into a sandbox located at\n/home/notebook/workspace/hephaestus/hephaestus-sb\nConfiguring funsat-0.6.2...\nBuilding funsat-0.6.2...\nFailed to install funsat-0.6.2\nBuild log ( /home/notebook/workspace/hephaestus/hephaestus-sb/logs/funsat-0.6.2.log ):\ncabal: Entering directory '.'\nConfiguring funsat-0.6.2...\nBuilding funsat-0.6.2...\nPreprocessing library funsat-0.6.2...\n[ 4 of 10] Compiling Funsat.Monad     ( src/Funsat/Monad.hs, dist/dist-sandbox-cf02e0bc/build/Funsat/Monad.o )\n\nsrc/Funsat/Monad.hs:64:10: error:\n    \u2022 No instance for (Applicative (SSTErrMonad e st s))\n        arising from the superclasses of an instance declaration\n    \u2022 In the instance declaration for \u2018Monad (SSTErrMonad e st s)\u2019\n\nsrc/Funsat/Monad.hs:88:10: error:\n    \u2022 Could not deduce (GHC.Base.Alternative (SSTErrMonad e st s))\n        arising from the superclasses of an instance declaration\n      from the context: Error e\n        bound by the instance declaration at src/Funsat/Monad.hs:88:10-52\n    \u2022 In the instance declaration for \u2018MonadPlus (SSTErrMonad e st s)\u2019\ncabal: Leaving directory '.'\ncabal: Error: some packages failed to install:\nfunsat-0.6.2 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>I'm using the following version of <code>ghci</code>, which came installed along with the <code>haskell-platform:</code> </p>\n\n<pre><code>$ ghci \nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\n</code></pre>\n\n<p>The cabal version is: </p>\n\n<pre><code>$ cabal --version\ncabal-install version 1.24.0.1\ncompiled using version 1.24.1.0 of the Cabal library\n</code></pre>\n\n<p>My operating system is <code>debian 9.2</code>.</p>\n"}, {"tags": ["string", "haskell", "tree", "huffman-code"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1513069551, "post_id": 47763933, "comment_id": 82498544, "body": "This is a nice approach. One might even go further and use <code>StateT String Maybe Trie</code> to avoid having to pass the string state around."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 4, "last_activity_date": 1513040943, "creation_date": 1513040943, "answer_id": 47763933, "question_id": 47763477, "link": "https://stackoverflow.com/questions/47763477/haskell-tree-construction/47763933#47763933", "title": "Haskell Tree construction", "body": "<p><code>!!</code> (which, by the way, is <code>0</code>-indexed) is usually a no-go. It's a very \"imperative\" thing to do, and it's especially smelly with constant indices like here. That means you really want a pattern match. Also, splitting a list (<code>type String = [Char]</code>) at an index and operating on the two parts separately is a bad idea, because these lists are linked and immutable, so you'll end up copying the entire first part.</p>\n\n<p>The way you want to do this is as follows:</p>\n\n<ul>\n<li>If the string is empty, fail.</li>\n<li>If it starts with a <code>*</code>, then do something that somehow parses the left subtree and gets the remainder of the list in one step, and then parse the right one out of that remainder, making a <code>Branch</code>.</li>\n<li>If it's another character, make a <code>Leaf</code>.</li>\n</ul>\n\n<p>There's no need to figure out where to split the string, actually split the string, and then parse the halves; just parse the list until you can't anymore and then whatever's left (or should I say right?) can be parsed again.</p>\n\n<p>So: define a function <code>constructTrie' :: String -&gt; Maybe (Trie, String)</code> that consumes the start of a <code>String</code> into a <code>Trie</code>, and then leaves the unparsed bit behind (and gives <code>Nothing</code> if it just fails to parse). This function will be recursive, which is why it gets that extra output value: it needs extra plumbing to move the remainder of the list around. <code>constructTrie</code> itself can then be defined as a wrapper around it:</p>\n\n<pre><code>-- Maybe Trie because it's perfectly possible that the String just won't parse\nconstructTrie :: String -&gt; Maybe Trie\nconstructTrie s = do (t, \"\") &lt;- constructTrie' s\n                  -- patmat failure in a monad calls fail; fail @Maybe _ = Nothing\n                     return t\n\n-- can make this local to constructTrie in a where clause\n-- or leave it exposed in case it's useful\nconstructTrie' :: String -&gt; Maybe (Trie, String)\nconstructTrie' \"\" = Nothing -- can't parse something from nothing!\nconstructTrie' ('*':leaves) = do (ln, rs) &lt;- constructTrie' leaves\n                              -- Parse out left branch and leave the right part\n                              -- untouched. Doesn't copy the left half\n                                 (rn, rest) &lt;- constructTrie' rs\n                              -- Parse out the right branch. Since, when parsing\n                              -- \"**ABC\", the recursion will end up with\n                              -- constructTrie' \"*ABC\", we should allow the slop.\n                                 return (Branch ln rn, rest)\nconstructTrie' (x:xs) = return (Leaf x, xs)\n</code></pre>\n\n<p>This is a very common pattern: defining a recursive function with extra plumbing to pass around some state and wrapping it in a nicer one. I guess it corresponds to how imperative loops usually mutate variables to keep their state.</p>\n"}], "owner": {"reputation": 91, "user_id": 7942519, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc674a53538a8fa75bbe3f500ab29fd5?s=128&d=identicon&r=PG&f=1", "display_name": "Kryler", "link": "https://stackoverflow.com/users/7942519/kryler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 667, "favorite_count": 0, "accepted_answer_id": 47763933, "answer_count": 1, "score": 0, "last_activity_date": 1513040943, "creation_date": 1513037489, "question_id": 47763477, "link": "https://stackoverflow.com/questions/47763477/haskell-tree-construction", "title": "Haskell Tree construction", "body": "<p>Need some help writing a Haskell function that takes a string and creates a binary tree. Need some help from someone with a little better Haskell experience to fill in some holes for me and describe why because this is a learning experience for me.</p>\n\n<p>I'm given a tree encoded in a single string for a project in Haskell (Example <code>**B**DECA</code>). The star denotes a node any other character denotes a Leaf. I'm trying to fill this data structure with the information read in from input.</p>\n\n<p><code>data Trie = Leaf Char | Branch Trie Trie</code></p>\n\n<p>I'm more of a math and imperative programming guy so I made the observation that I can define a subtree by parsing from left to right. A proper tree will have 1 more character than <code>*</code>. Mathematically I would think of a recursive structure.</p>\n\n<p>If the first character is not a <code>*</code> the solution is the first character. Else the solution is a Branch where the subbranches are feed back into the function where the left Branch is the first set of characters where Characters out number <code>*</code>'s and the right Branch is everything else.</p>\n\n<pre><code>constructTrie :: String -&gt; Trie\nconstructTrie x = if x !! 1 == '*' then\n                      let leftSubtree = (first time in drop 1 x where characters out number *'s)\n                          rightSubtree = (rest of the characters in the drop 1 x)\n                      in Branch constructTrie(leftSubtree) constructTrie(rightSubtree)\n                  else Leaf x !! 1\n</code></pre>\n\n<p>Mostly I need help defining the left and right subtree and if there is anything wrong with defining it this way.</p>\n"}, {"tags": ["windows", "haskell", "compilation", "glib", "haskell-stack"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1513035597, "post_id": 47763183, "comment_id": 82487825, "body": "Those are (afaik) not relative paths, but Unix/Linux paths, and apparently the compiler can not make sense out of these."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1513037624, "post_id": 47763183, "comment_id": 82488405, "body": "You can&#39;t really use cygwin with GHC, because on Windows GHC will expect to be in a Windows environment. In particular, there&#39;s nothing you can do to get GHC to recognize the path <code>&#47;usr&#47;include&#47;cairo</code> as a valid Windows path (because it isn&#39;t). You have to install the native versions of glib (same goes for any other dependancy) and make sure that GHC not using cygwin <code>gcc</code> (stack does a good job of doing so, typically). Also note that your build is not failing near the end, it&#39;s doing so basically right at the start (when building a dependency, not even your package)."}, {"owner": {"reputation": 117, "user_id": 7908951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-R7FxQtZZw2Q/AAAAAAAAAAI/AAAAAAAAARI/W3lm0URTsog/photo.jpg?sz=128", "display_name": "Julien Rhapsodos Girard", "link": "https://stackoverflow.com/users/7908951/julien-rhapsodos-girard"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1513038030, "post_id": 47763183, "comment_id": 82488506, "body": "@user2407038 by native package, you mean Windows package? Because I looked for an available version of glib for Windows and I did not found out any..."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1513038456, "post_id": 47763183, "comment_id": 82488626, "body": "<a href=\"https://github.com/winlibs/glib\" rel=\"nofollow noreferrer\">Here</a> is the glib source; if you feel adventurous you can try to build it yourself. Otherwise you have to find pre-built binaries somewhere on the internet (a quick google search turns up <a href=\"https://ftp.gnome.org/pub/gnome/binaries/win32/glib/\" rel=\"nofollow noreferrer\">this</a>)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1513047003, "post_id": 47763183, "comment_id": 82490592, "body": "I would expect you could find detailed instructions for installing Stack from scratch on Windows. Did you dig around for those?"}, {"owner": {"reputation": 117, "user_id": 7908951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-R7FxQtZZw2Q/AAAAAAAAAAI/AAAAAAAAARI/W3lm0URTsog/photo.jpg?sz=128", "display_name": "Julien Rhapsodos Girard", "link": "https://stackoverflow.com/users/7908951/julien-rhapsodos-girard"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1513068672, "post_id": 47763183, "comment_id": 82498030, "body": "@user2407038 thanks, will try so.I have installed Stack with the Haskell platform for windows (<a href=\"https://www.haskell.org/platform/#windows\" rel=\"nofollow noreferrer\">haskell.org/platform/#windows</a>)"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1513069542, "post_id": 47763183, "comment_id": 82498540, "body": "FWIW, I can&#39;t say if this will address your particular problem, but so far, I&#39;ve been running Stack exclusively from Git Bash on Windows, and I haven&#39;t run into problems with interoperability so far..."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1513130428, "creation_date": 1513130428, "answer_id": 47784414, "question_id": 47763183, "link": "https://stackoverflow.com/questions/47763183/stack-fails-to-compile-under-windows/47784414#47784414", "title": "Stack fails to compile under windows", "body": "<p>I would take a look at the windows install instructions for gtk2hs: <a href=\"https://wiki.haskell.org/Gtk2Hs/Installation#Windows\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Gtk2Hs/Installation#Windows</a></p>\n\n<p>You can download the bundle directly (from <a href=\"https://www.gtk.org/download/windows.php\" rel=\"nofollow noreferrer\">https://www.gtk.org/download/windows.php</a>), or install it using the <code>pacman</code> distributed with the platform-installed msys distro.</p>\n\n<p>You should use the msys version or the independent version, not the cywin one, as ghc is built to work with msys, not cygwin.</p>\n\n<p>Once that's done you should be able to, having set up your paths correctly, <code>cabal install cairo</code>.</p>\n"}], "owner": {"reputation": 117, "user_id": 7908951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-R7FxQtZZw2Q/AAAAAAAAAAI/AAAAAAAAARI/W3lm0URTsog/photo.jpg?sz=128", "display_name": "Julien Rhapsodos Girard", "link": "https://stackoverflow.com/users/7908951/julien-rhapsodos-girard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 305, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1513130428, "creation_date": 1513035375, "last_edit_date": 1513073747, "question_id": 47763183, "link": "https://stackoverflow.com/questions/47763183/stack-fails-to-compile-under-windows", "title": "Stack fails to compile under windows", "body": "<p>I have a rather troublesome bug preventing me to build a small haskell project of mine under Windows, <a href=\"https://github.com/GirardR1006/syme\" rel=\"nofollow noreferrer\">which you can find here if you want to try to compile it</a>.I am under cygwin64.</p>\n\n<p>I'm using stack as a build helper, on the advice <a href=\"https://stackoverflow.com/questions/47739930/gcc-not-working-during-compiling-haskell-programs-on-windows/47763092#47763092\">given on this post</a>.\nNow, the build is failing near at the end (which is rather frustrating after trying to do so for several hours).</p>\n\n<p>Error message is the following:</p>\n\n<pre><code>setup.exe:\n'C:\\Users\\Julien\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-8.0.2\\bin\\ghc-pkg.EXE'\nexited with an error:\ncairo-0.13.4.2: Warning: haddock-interfaces:\nC:\\cygwin64\\tmp\\stack11608\\cairo-0.13.4.2\\.stack-work\\dist\\ca59d0ab\\doc\\html\\cairo\\cairo.haddock\ndoesn't exist or isn't a file\ncairo-0.13.4.2: Warning: haddock-html:\nC:\\cygwin64\\tmp\\stack11608\\cairo-0.13.4.2\\.stack-work\\dist\\ca59d0ab\\doc\\html\\cairo\ndoesn't exist or isn't a directory\ncairo-0.13.4.2: include-dirs: /usr/include/cairo is a relative path which\nmakes no sense (as there is nothing for it to be relative to). You can make\npaths relative to the package database itself by using ${pkgroot}. (use\n--force to override)\ncairo-0.13.4.2: include-dirs: /usr/include/glib-2.0 is a relative path which\nmakes no sense (as there is nothing for it to be relative to). You can make\npaths relative to the package database itself by using ${pkgroot}. (use\n--force to override)\ncairo-0.13.4.2: include-dirs: /usr/lib/glib-2.0/include is a relative path\nwhich makes no sense (as there is nothing for it to be relative to). You can\nmake paths relative to the package database itself by using ${pkgroot}. (use\n--force to override)\ncairo-0.13.4.2: include-dirs: /usr/include/pixman-1 is a relative path which\nmakes no sense (as there is nothing for it to be relative to). You can make\npaths relative to the package database itself by using ${pkgroot}. (use\n--force to override)\ncairo-0.13.4.2: include-dirs: /usr/include/freetype2 is a relative path which\nmakes no sense (as there is nothing for it to be relative to). You can make\npaths relative to the package database itself by using ${pkgroot}. (use\n--force to override)\ncairo-0.13.4.2: include-dirs: /usr/include/libpng16 is a relative path which\nmakes no sense (as there is nothing for it to be relative to). You can make\npaths relative to the package database itself by using ${pkgroot}. (use\n--force to override)\n\n\n--  While building custom Setup.hs for package glib-0.13.5.0 using:\n  C:\\cygwin64\\tmp\\stack11608\\glib-0.13.5.0\\.stack-work\\dist\\ca59d0ab\\setup\\setup --builddir=.stack-work\\dist\\ca59d0ab build --ghc-options \" -ddump-hi -ddump-to-file\"\nProcess exited with code: ExitFailure 1\nLogs have been written to: C:\\cygwin64\\home\\Julien\\syme-master\\.stack-work\\logs\\glib-0.13.5.0.log\n\n[1 of 2] Compiling Main             ( C:\\cygwin64\\tmp\\stack11608\\glib-0.13.5.0\\Setup.hs, C:\\cygwin64\\tmp\\stack11608\\glib-0.13.5.0\\.stack-work\\dist\\ca59d0ab\\setup\\Main.o )\n[2 of 2] Compiling StackSetupShim   ( C:\\sr\\setup-exe-src\\setup-shim-Z6RU0evB.hs, C:\\cygwin64\\tmp\\stack11608\\glib-0.13.5.0\\.stack-work\\dist\\ca59d0ab\\setup\\StackSetupShim.o )\nLinking C:\\cygwin64\\tmp\\stack11608\\glib-0.13.5.0\\.stack-work\\dist\\ca59d0ab\\setup\\setup.exe ...\nConfiguring glib-0.13.5.0...\nBuilding glib-0.13.5.0...\nIn file included from C:/cygwin64/usr/include/glib/gtypes.h:34:0,\n                 from C:/cygwin64/usr/include/glib/galloca.h:32,\n                 from C:/cygwin64/usr/include/glib.h:30,\n                 from C:/cygwin64/usr/include/gobject/gbinding.h:28,\n                 from C:\\cygwin64\\home\\Julien\\syme-master\\../../../usr/include\\glib-object.h:23:\nC:/cygwin64/usr/include/glib/gversionmacros.h:257:2: error: #error \"GLIB_VERSION_MIN_REQUIRED must be &gt;= GLIB_VERSION_2_26\"\n #error \"GLIB_VERSION_MIN_REQUIRED must be &gt;= GLIB_VERSION_2_26\"\n  ^\nPreprocessing library glib-0.13.5.0...\nsetup.exe: Error during preprocessing\n</code></pre>\n\n<p>The point is that according to cygwin installer, I have libglib2.0-devel version 2.52.3-1 installed. Is it the wrong version of glib2? Is there any conflict between other glib versions? If so, how can I make stack understand to check \nwhere are the correct versions? </p>\n\n<p>I must say that I messed up a bit by adding relative paths inside of the stack.yaml file, I don't know if it is troublesome or not.</p>\n\n<p>Any help would be greatly appreciated.</p>\n\n<p>UDPATE: As the comments suggested, I changed my project-local stack.yaml to add the follwing (took me a while to figure out how to write the path on windows)</p>\n\n<pre><code>extra-include-dirs: [c;\\\\cygwin64\\\\usr\\\\include]\nextra-lib-dirs: [c;\\\\cygwin64\\\\lib]\n</code></pre>\n\n<p>Inside of those, I unzipped the libs provided by the link user2407038 provided in the comments. Now, the error message looks like this:</p>\n\n<pre><code>--  While building custom Setup.hs for package cairo-0.13.4.2 using:\n  C:\\cygwin64\\tmp\\stack10676\\cairo-0.13.4.2\\.stack-work\\dist\\ca59d0ab\\setup\\setup --builddir=.stack-work\\dist\\ca59d0ab build --ghc-options \" -ddump-hi -ddump-to-file\"\nProcess exited with code: ExitFailure 1\nLogs have been written to: C:\\cygwin64\\home\\Julien\\syme-master\\.stack-work\\logs\\cairo-0.13.4.2.log\n\n[1 of 2] Compiling Main             ( C:\\cygwin64\\tmp\\stack10676\\cairo-0.13.4.2\\Setup.hs, C:\\cygwin64\\tmp\\stack10676\\cairo-0.13.4.2\\.stack-work\\dist\\ca59d0ab\\setup\\Main.o )\n[2 of 2] Compiling StackSetupShim   ( C:\\sr\\setup-exe-src\\setup-shim-Z6RU0evB.hs, C:\\cygwin64\\tmp\\stack10676\\cairo-0.13.4.2\\.stack-work\\dist\\ca59d0ab\\setup\\StackSetupShim.o )\nLinking C:\\cygwin64\\tmp\\stack10676\\cairo-0.13.4.2\\.stack-work\\dist\\ca59d0ab\\setup\\setup.exe ...\nConfiguring cairo-0.13.4.2...\nBuilding cairo-0.13.4.2...\nC:\\cygwin64\\tmp\\stack10676\\cairo-0.13.4.2\\cairo-gtk2hs.h:1:18: fatal error: cairo.h: No such file or directory\ncompilation terminated.\nPreprocessing library cairo-0.13.4.2...\nsetup.exe: Error during preprocessing\n\n\n-- While building custom Setup.hs for package glib-0.13.5.0 using:\nC:\\cygwin64\\tmp\\stack10676\\glib-0.13.5.0\\.stack-work\\dist\\ca59d0ab\\setup\\setup --builddir=.stack-work\\dist\\ca59d0ab build --ghc-options \" -ddump-hi -ddump-to-file\"\nProcess exited with code: ExitFailure 1\nLogs have been written to: C:\\cygwin64\\home\\Julien\\syme-master\\.stack-work\\logs\\glib-0.13.5.0.log\n\n[1 of 2] Compiling Main             ( C:\\cygwin64\\tmp\\stack10676\\glib-0.13.5.0\\Setup.hs, C:\\cygwin64\\tmp\\stack10676\\glib-0.13.5.0\\.stack-work\\dist\\ca59d0ab\\setup\\Main.o )\n[2 of 2] Compiling StackSetupShim   ( C:\\sr\\setup-exe-src\\setup-shim-Z6RU0evB.hs, C:\\cygwin64\\tmp\\stack10676\\glib-0.13.5.0\\.stack-work\\dist\\ca59d0ab\\setup\\StackSetupShim.o )\nLinking C:\\cygwin64\\tmp\\stack10676\\glib-0.13.5.0\\.stack-work\\dist\\ca59d0ab\\setup\\setup.exe ...\nConfiguring glib-0.13.5.0...\nBuilding glib-0.13.5.0...\nPreprocessing library glib-0.13.5.0...\nsetup.exe: glib-object.h: File does not exist\n</code></pre>\n\n<p>Where can I find those headers?</p>\n"}, {"tags": ["haskell", "lambda-calculus"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1513029949, "post_id": 47762178, "comment_id": 82485853, "body": "Not sure I quite understand your question. Are you asking whether <code>x1 x2</code> is alpha-equivalent to <code>x2 x1</code>?"}, {"owner": {"reputation": 65, "user_id": 8925802, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1626601887401829/picture?type=large", "display_name": "SoMax", "link": "https://stackoverflow.com/users/8925802/somax"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1513030220, "post_id": 47762178, "comment_id": 82485969, "body": "basically yes, I am confused as lecturers told us that x1 x1 are equivalent same with x1x2 x1x2."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1513031493, "post_id": 47762178, "comment_id": 82486447, "body": "Any lambda term is always equivalent to itself, so in particular <code>x</code> is equivalent to <code>x</code>. But <code>x1 x2</code> is not alpha equivalent to <code>x2 x1</code>. I&#39;m not sure I get your point."}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 12, "last_activity_date": 1530001015, "last_edit_date": 1530001015, "creation_date": 1513031693, "answer_id": 47762545, "question_id": 47762178, "link": "https://stackoverflow.com/questions/47762178/alpha-equivalence-between-variables-in-lambda-calculus/47762545#47762545", "title": "Alpha equivalence between variables in lambda calculus", "body": "<p>Two terms are alpha-equivalent iff one can be converted into the other purely by <strong>renaming bound variables</strong>.</p>\n\n<p>A variable is considered to be a <strong>bound variable</strong> if it matches the parameter name of some enclosing lambda. Otherwise it's a <strong>free variable</strong>. Here are a few examples:</p>\n\n<pre><code>\u03bbx. x          -- x is bound\n\u03bbx. y          -- y is free\n\u03bbf. \u03bbx. f x y  -- f and x are bound, y is free\nf (\u03bbf. f x)    -- the first f is free; the second is bound. x is free\nz              -- z is free\n</code></pre>\n\n<p>Basically, \"bound\" and \"free\" roughly correspond to the notions of \"in scope\" and \"out of scope\" in procedural languages.</p>\n\n<p>Alpha-equivalence basically captures the idea that it's safe to rename a variable in a program if you also fix all the references to that variable. That is, when you change the parameter of a lambda term, you also have to go into the lambda's body and change the usages of that variable. (If the name is re-bound by another lambda inside the first lambda, you'd better make sure not to perform the renaming inside the inner lambda.)</p>\n\n<p>Here are some examples of alpha-equivalent terms:</p>\n\n<pre><code>\u03bbx. x   &lt;-&gt;   \u03bby. y   &lt;-&gt;   \u03bbberp. berp\n\u03bbx. \u03bbf. f x   &lt;-&gt;   \u03bbx. \u03bbg. g x   &lt;-&gt;   \u03bbf. \u03bbx. x f   &lt;-&gt;  \u03bbx1. \u03bbx2. x2 x1\n\u03bbf. \u03bbf. f f   &lt;-&gt;   \u03bbg. \u03bbf. f f   &lt;-&gt;   \u03bbf. \u03bbg. g g\n</code></pre>\n\n<p>So is <code>x x</code> alpha-equivalent to <code>x1x2 x1x2</code>? <strong>No!</strong> <code>x</code> is <em>free</em> in the first term, because it's not bound by an enclosing lambda. (Perhaps it's a reference to a global variable.) So it's not safe to rename it to <code>x1x2</code>.</p>\n\n<p>I suspect your tutor really meant to say that <code>\u03bbx. x x</code> is alpha-equivalent to <code>\u03bbx1x2. x1x2 x1x2</code>. Here the <code>x</code> is bound by the lambda, so you can safely rename it.</p>\n\n<p>Is <code>x1 x2</code> alpha-equivalent to <code>x2 x1</code>? For the same reason, <strong>no</strong>.</p>\n\n<p>And is <code>\u03bbx1. \u03bbx2. x1 x2</code> equivalent to <code>\u03bbx1. \u03bbx2. x2 x1</code>? Again, <strong>no</strong>, because this isn't just a renaming - the <code>x1</code> and <code>x2</code> variables moved around.</p>\n\n<p>However, <code>\u03bbx1. \u03bbx2. x1 x2</code> <strong>is</strong> alpha-equivalent to <code>\u03bbx2. \u03bbx1. x2 x1</code>:</p>\n\n<ol>\n<li>rename <code>x1</code> to some temporary name like <code>z</code>: <code>\u03bbz. \u03bbx2. z x2</code></li>\n<li>rename <code>x2</code> to <code>x1</code>: <code>\u03bbz. \u03bbx1. z x1</code></li>\n<li>rename <code>z</code> back to <code>x2</code>: <code>\u03bbx2. \u03bbx1. x2 x1</code></li>\n</ol>\n\n<p>Getting renaming right in a language implementation is a fiddly enough problem that many compiler writers opt for a <em>nameless</em> representation of terms called <em>de Bruijn indices</em>. Rather than using text, variables are represented as a number measuring how many lambdas away the variable was bound. A nameless representation of <code>\u03bbx2. \u03bbx1. x2 x1</code> would look like <code>\u03bb. \u03bb. 2 1</code>. Note that that's exactly the same as the de Bruijn representation of <code>\u03bbx1. \u03bbx2. x1 x2</code>. de Bruijn indices thoroughly solve the problem of alpha-equivalence (although they are quite hard to read).</p>\n"}], "owner": {"reputation": 65, "user_id": 8925802, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1626601887401829/picture?type=large", "display_name": "SoMax", "link": "https://stackoverflow.com/users/8925802/somax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1596, "favorite_count": 1, "accepted_answer_id": 47762545, "answer_count": 1, "score": 2, "last_activity_date": 1530001015, "creation_date": 1513029628, "question_id": 47762178, "link": "https://stackoverflow.com/questions/47762178/alpha-equivalence-between-variables-in-lambda-calculus", "title": "Alpha equivalence between variables in lambda calculus", "body": "<p>Just a fairly simple question (so it seems to me). If two variables <code>(x)(x)</code> are alpha equivalent. Is <code>(x1x2)(x2x1)</code> alpha equivalent?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1513018198, "post_id": 47759351, "comment_id": 82480075, "body": "change to <code>++ show b</code>.  You need to convert a Num type to String.  You can also write <code>[1..999]</code>.  However, your <code>mod</code> test is not correct, swap the arguments otherwise you&#39;re just filtering numbers 1,3 and 5."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1513018490, "post_id": 47759510, "comment_id": 82480237, "body": "Strictly speaking, the error message is just saying there <i>isn&#39;t</i> a <code>Num</code> instance for <code>[Char]</code>, not that there <i>cannot</i> be one."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1513018719, "post_id": 47759510, "comment_id": 82480362, "body": "Adding a type signature for <code>modTest</code> would also help. <code>modTest :: Int -&gt; Bool</code> would be sufficient to infer the type <code>Int</code> for <code>b</code>."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 4, "creation_date": 1513035862, "post_id": 47759510, "comment_id": 82487917, "body": "Yes, this is one of the reasons it is good practice to give types to at least your top-level functions: you get better compiler errors if you tell the compiler what you meant, rather than making it guess which part of your program is wrong when it finds an inconsistency."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 9, "last_activity_date": 1513018536, "last_edit_date": 1513018536, "creation_date": 1513018402, "answer_id": 47759510, "question_id": 47759351, "link": "https://stackoverflow.com/questions/47759351/haskell-error-using-sum-filter-function-1-2-999/47759510#47759510", "title": "Haskell error using sum $ filter &#39;function&#39; $ [1,2..999]", "body": "<p><strong>tl;dr</strong>: Use <code>show b</code> when you print it.</p>\n\n<hr>\n\n<p>Unfortunately, the error here isn't too great. I'll explain where it's coming from though.</p>\n\n<pre><code>module Lib\n    ( euler1\n    ) where\n\nmodTest x = mod 3 x == 0 || mod 5 x == 0\n\neuler1 :: IO ()\neuler1 = do\n  let b = sum $ filter modTest $ [1,2..999]\n  putStrLn $ \"result: \" ++ b\n</code></pre>\n\n<p>Haskell sees your <code>let b = ...</code> line and notices that, whatever <code>b</code> is, it has to be of some numerical, integral type. That's all fine; you want that. But then you do <code>\"result: \" ++ b</code> and Haskell sees that <code>b</code> simply must be a string. So it tries to rationalize this: Is a string a numerical type? The answer is no (unless you defined a really strange instance), and that's why you get the error that <code>Num [Char]</code> (or equivalently <code>Num String</code>) doesn't work. You simply need to tell Haskell to <code>show</code> your numerical value to convert it to a string.</p>\n\n<pre><code>putStrLn $ \"result: \" ++ show b\n</code></pre>\n\n<p>In the future, if you get errors that seem confusing (for instance, the errors you got here were giving you line numbers that were not helpful), try using explicit type signatures. For instance, if you want <code>b</code> to be an integer but you're getting errors, try</p>\n\n<pre><code>let b = (sum $ filter modTest $ [1,2..999]) :: Int\n</code></pre>\n\n<p>Then you should get a more accurate error message, since Haskell understands more of what you intended. When you've fixed the problem, you can remove the inline type annotations if they're cluttering up the code, but they're very helpful for debugging.</p>\n"}], "owner": {"reputation": 361, "user_id": 8514646, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/pNkTZ.png?s=128&g=1", "display_name": "kuwze", "link": "https://stackoverflow.com/users/8514646/kuwze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "accepted_answer_id": 47759510, "answer_count": 1, "score": 1, "last_activity_date": 1513018536, "creation_date": 1513017886, "question_id": 47759351, "link": "https://stackoverflow.com/questions/47759351/haskell-error-using-sum-filter-function-1-2-999", "title": "Haskell error using sum $ filter &#39;function&#39; $ [1,2..999]", "body": "<p>I am trying to figure out multiple Haskell errors I am getting in the following code. Here is my code for Euler problem #1:</p>\n\n<pre><code>module Lib\n    ( euler1\n    ) where\n\nmodTest x = mod 3 x == 0 || mod 5 x == 0\n\neuler1 :: IO ()\neuler1 = do\n  let b = sum $ filter modTest $ [1,2..999]\n  putStrLn $ \"result: \" ++ b\n</code></pre>\n\n<p>And I am getting the following three errors:</p>\n\n<pre><code>/home/kuwze/src/haskell/euler-hs/src/Lib.hs:9:11: error:\n    \u2022 No instance for (Num [Char]) arising from a use of \u2018sum\u2019\n    \u2022 In the expression: sum $ filter modTest $ [1, 2 .. 999]\n      In an equation for \u2018b\u2019: b = sum $ filter modTest $ [1, 2 .. 999]\n      In the expression:\n        do { let b = sum $ filter modTest $ ...;\n             putStrLn $ \"result: \" ++ b }\n\n/home/kuwze/src/haskell/euler-hs/src/Lib.hs:9:24: error:\n    \u2022 No instance for (Integral [Char]) arising from a use of \u2018modTest\u2019\n    \u2022 In the first argument of \u2018filter\u2019, namely \u2018modTest\u2019\n      In the expression: filter modTest\n      In the second argument of \u2018($)\u2019, namely\n        \u2018filter modTest $ [1, 2 .. 999]\u2019\n\n/home/kuwze/src/haskell/euler-hs/src/Lib.hs:9:34: error:\n    \u2022 No instance for (Enum [Char])\n        arising from the arithmetic sequence \u20181, 2 .. 999\u2019\n    \u2022 In the second argument of \u2018($)\u2019, namely \u2018[1, 2 .. 999]\u2019\n      In the second argument of \u2018($)\u2019, namely\n        \u2018filter modTest $ [1, 2 .. 999]\u2019\n      In the expression: sum $ filter modTest $ [1, 2 .. 999] Failed, modules loaded: none.\n</code></pre>\n\n<p>I know this is a simple problem but I would really appreciate any help. Thank you so much.</p>\n"}, {"tags": ["haskell", "pretty-print"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1513031101, "post_id": 47758763, "comment_id": 82486320, "body": "Also look at <a href=\"http://hackage.haskell.org/package/tabular\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/tabular</a> and maybe <a href=\"http://hackage.haskell.org/package/pptable\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/pptable</a> ."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1513041631, "last_edit_date": 1513041631, "creation_date": 1513016561, "answer_id": 47759011, "question_id": 47758763, "link": "https://stackoverflow.com/questions/47758763/haskell-pretty-printing-accessible-practical-library/47759011#47759011", "title": "Haskell Pretty Printing - Accessible, practical library", "body": "<p>Most pretty-printing libraries focus around alternative layouts (choosing cleverly when to add newlines, etc.). For something like this, use <a href=\"http://hackage.haskell.org/package/boxes\" rel=\"nofollow noreferrer\"><code>boxes</code></a>:</p>\n\n<pre><code>import Text.PrettyPrint.Boxes\nimport Data.List\ntable = [(\"bird\",3,44),(\"cat\",534,3)] :: [(String,Int,Int)]\ncols = transpose [ [ animal, show n, show m ] | (animal, n, m) &lt;- table ]\nrendered = render . hsep 2 left . map (vcat left . map text) $ cols\nputStr rendered\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>bird  3    44\ncat   534  3\n</code></pre>\n"}], "owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "closed_date": 1513029992, "accepted_answer_id": 47759011, "answer_count": 1, "score": 1, "last_activity_date": 1513041631, "creation_date": 1513015520, "question_id": 47758763, "link": "https://stackoverflow.com/questions/47758763/haskell-pretty-printing-accessible-practical-library", "closed_reason": "Not suitable for this site", "title": "Haskell Pretty Printing - Accessible, practical library", "body": "<p>Assume I have <code>[(\"bird\",3,44),(\"cat\",534,3)] :: [(String,Int,Int)]</code>. What is the simplest way to get a pretty printed result, a la:</p>\n\n<pre><code>bird    3   44\ncat   534    3\n</code></pre>\n\n<p>It seems there are a lot of Haskell pretty printing libraries without a clear favorite, nor many examples.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 5, "last_activity_date": 1513015084, "last_edit_date": 1513015084, "creation_date": 1513013431, "answer_id": 47758234, "question_id": 47758065, "link": "https://stackoverflow.com/questions/47758065/haskell-couldnt-match-expected-type-a1-with-actual-type-a/47758234#47758234", "title": "Haskell: Couldn&#39;t match expected type \u2018a1\u2019 with actual type \u2018a\u2019", "body": "<p>In your class declaration, the functions <code>insertar</code> and <code>primera</code> promise the consumer to work with <em>any</em> type <code>a</code> whatsoever (by the way: you're missing the <code>insertar</code> implementation). However, when implementing them in your class instance, you try to make it work with the specific <code>a</code>, which is the \"contents\" of <code>Pila</code>. The promise of the class is broken - the functions in the instance do not, in fact, work with <em>any</em> type <code>a</code>, - and so the compiler complains.</p>\n\n<p>If you want to make this work, you need to declare class <code>Coleccion</code> in a way that says \"<em><code>n</code> is a collection, which contains elements of type <code>a</code>, and here are the functions that should work with those types <code>n</code> and <code>a</code></em>\".</p>\n\n<p><strong>One way to do this</strong> is to use an <em>associated type</em>:</p>\n\n<pre><code>class Coleccion n where\n    type Elemento n\n    esVacia::n-&gt;Bool\n    insertar::n -&gt; Elemento n -&gt; n\n    primero::n -&gt; Elemento n\n    eliminar:: n-&gt;n\n    size::n-&gt;Int;\n</code></pre>\n\n<p>This declaration says: \"<em>whoever defines an instance of <code>Coleccion</code> for some type <code>n</code>, should also provide a way to determine what the type of elements of that collection is, and <code>insertar</code> and <code>primero</code> should work on that very type, not on some random unrelated one</em>\". You would implement it like this:</p>\n\n<pre><code>instance Coleccion (Pila a) where\n    type Elemento (Pila a) = a\n    ...\n    primero (Pil x) = last x\n</code></pre>\n\n<p>Here, you say: \"<em>my collection is <code>Pila a</code>, and its elements are <code>a</code>, and here's how <code>primero</code> should work on it</em>\".</p>\n\n<p>(NOTE: you'll need the <code>TypeFamilies</code> extension to do this)</p>\n\n<p><strong>Alternatively</strong>, you could use <em>functional dependencies</em> and two-parameter type class:</p>\n\n<pre><code>class Coleccion n el | n -&gt; el where\n    ...\n    insertar::n -&gt; el -&gt; n\n    primero::n -&gt; el\n</code></pre>\n\n<p>This declaration says: \"<em>whenever you define an instance of <code>Coleccion</code> for some type <code>n</code>, you should also specify what the element <code>el</code> of that collection is</em>\". The \"arrow\" after the \"pipe\" says that the collection type should unambiguously determine what the element is - that is, you can't have one collection contain elements of several different types.</p>\n\n<p>Then you implement it like this:</p>\n\n<pre><code>instance Coleccion (Pila a) a where\n    ...\n    primero (Pil x) = last x\n</code></pre>\n\n<p>(NOTE: you'll need <code>FunctionalDependencies</code> and <code>MultiParamTypeClasses</code> extensions for this)</p>\n"}, {"tags": [], "owner": {"reputation": 794, "user_id": 3717658, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vtnZE.jpg?s=128&g=1", "display_name": "Naqib Hakimi", "link": "https://stackoverflow.com/users/3717658/naqib-hakimi"}, "is_accepted": false, "score": 1, "last_activity_date": 1513017150, "last_edit_date": 1513017150, "creation_date": 1513016176, "answer_id": 47758924, "question_id": 47758065, "link": "https://stackoverflow.com/questions/47758065/haskell-couldnt-match-expected-type-a1-with-actual-type-a/47758924#47758924", "title": "Haskell: Couldn&#39;t match expected type \u2018a1\u2019 with actual type \u2018a\u2019", "body": "<p>@Fyodor Soikin solution is great this one other way to do this </p>\n\n<pre><code>module Coleccion where\n  data Pila a= Pil [a] deriving (Show,Eq,Ord)\n  data Cola a= Col [a] deriving (Show,Eq,Ord)\n\n  class Coleccion n where\n    esVacia::n-&gt;Bool\n    --insertar::n-&gt;a-&gt;n\n    primero::n-&gt;n\n    eliminar:: n-&gt;n\n    size::n-&gt;Int\n\n\n\n  instance Coleccion (Pila a) where\n    esVacia (Pil [])= True\n    esVacia (Pil _ )= False\n    primero (Pil xs) = (Pil [(last xs)])\n    eliminar (Pil xs)= (Pil (init xs))\n    size (Pil []) = 0\n    size (Pil xs) = length xs \n</code></pre>\n\n<p>now using  Monad , Functor and Applicative you can do anything you want </p>\n"}], "owner": {"reputation": 13, "user_id": 9084841, "user_type": "registered", "profile_image": "https://graph.facebook.com/1641518909242987/picture?type=large", "display_name": "Alex G&#243;mez Uceda", "link": "https://stackoverflow.com/users/9084841/alex-g%c3%b3mez-uceda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1206, "favorite_count": 0, "accepted_answer_id": 47758234, "answer_count": 2, "score": 1, "last_activity_date": 1513017150, "creation_date": 1513012765, "last_edit_date": 1513014795, "question_id": 47758065, "link": "https://stackoverflow.com/questions/47758065/haskell-couldnt-match-expected-type-a1-with-actual-type-a", "title": "Haskell: Couldn&#39;t match expected type \u2018a1\u2019 with actual type \u2018a\u2019", "body": "<p>I have this code: </p>\n\n<pre><code>module Coleccion where\n  data Pila a= Pil [a] deriving (Show,Eq,Ord)\n  data Cola a= Col [a] deriving (Show,Eq,Ord)\n\n  class Coleccion n where\n    esVacia::n-&gt;Bool\n    insertar::n-&gt;a-&gt;n\n    primero::n-&gt;a\n    eliminar:: n-&gt;n\n    size::n-&gt;Int;\n\n\n\n  instance Coleccion (Pila a) where\n    esVacia (Pil [])= True\n    esVacia (Pil _ )= False\n    primero (Pil x) = last x\n    eliminar (Pil x)= (Pil (init x))\n    size (Pil []) = 0\n    size (Pil pila) = length pila;\n</code></pre>\n\n<p>And when I compile it with GHCI I have:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018a1\u2019 with actual type \u2018a\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the instance declaration at Coleccion.hs:18:12-29\n      \u2018a1\u2019 is a rigid type variable bound by\n        the type signature for:\n          primero :: forall a1. Pila a -&gt; a1\n        at Coleccion.hs:21:5-11\n    \u2022 In the expression: last x\n      In an equation for \u2018primero\u2019: primero (Pil x) = last x\n      In the instance declaration for \u2018Coleccion (Pila a)\u2019\n    \u2022 Relevant bindings include\n        x :: [a] (bound at Coleccion.hs:21:18)\n        primero :: Pila a -&gt; a1 (bound at Coleccion.hs:21:5)\n</code></pre>\n\n<p>The functions that I have a problem with them are functions that have a type distinct from n or predefined types (Bool, Integer...) like, for example, primero. For example, esVacia, size &amp; eliminar are working OK.\nI don't know what is wrong in declarations or in instance code.\nThank you.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1513012927, "post_id": 47757513, "comment_id": 82477382, "body": "Define a sum type with one variant for each different object type (e.g. <code>data SomeObj = AnAgent Agent | AJob Job | AJobRequest JobRequest</code>) and define the <code>fromJSON</code> function by checking that the given <code>Value</code> is an <code>Object</code> and then checking that the hashmap for that object has exactly one field, whose key is one of the three keys for your variants, and then recursively parsing the <code>Value</code> corresponding to that key."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1513013287, "post_id": 47757513, "comment_id": 82477573, "body": "<a href=\"https://hackage.haskell.org/package/aeson-1.2.3.0/docs/src/Data-Aeson-Types-FromJSON.html#line-1506\" rel=\"nofollow noreferrer\">Here&#39;s</a> how it&#39;s done in aeson itself; the only difference will be the values matched against <code>key</code>."}], "answers": [{"comments": [{"owner": {"reputation": 156, "user_id": 8948343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tzwVi.jpg?s=128&g=1", "display_name": "Gabriel Rufino", "link": "https://stackoverflow.com/users/8948343/gabriel-rufino"}, "edited": false, "score": 0, "creation_date": 1513090518, "post_id": 47763855, "comment_id": 82511995, "body": "Thanks you very much! it&#39;s already helping me a lot. Although I came by a scenario, where it doesn&#39;t seem to be parsing the input if you put it in some order... I get Error in $[4]: key &quot;job_request&quot; not present, the weird thing is that if I place a job request instead of the present object (new_agent), it parses the object, so I imagine it is getting stuck in job_request... Also, could you tell me exactly which object Ima put in the array? is it variable ps or variable d?"}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "reply_to_user": {"reputation": 156, "user_id": 8948343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tzwVi.jpg?s=128&g=1", "display_name": "Gabriel Rufino", "link": "https://stackoverflow.com/users/8948343/gabriel-rufino"}, "edited": false, "score": 0, "creation_date": 1513110375, "post_id": 47763855, "comment_id": 82523252, "body": "This may mean that there is something wrong with the &quot;new_agent&quot; object that you are parsing.  In this case, what would happen is that all three parsers ( parseAgent, parseJob, parseJobRequest) would fail.  After each of the first two failures (parseAgent, parseJob ), the code goes on to try the next parser (parseJob, parseJobRequest).  After the last failure ( parseJobRequest),  you get the &#39;key &quot;job_request&quot; not present&#39; error."}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "reply_to_user": {"reputation": 156, "user_id": 8948343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tzwVi.jpg?s=128&g=1", "display_name": "Gabriel Rufino", "link": "https://stackoverflow.com/users/8948343/gabriel-rufino"}, "edited": false, "score": 0, "creation_date": 1513110620, "post_id": 47763855, "comment_id": 82523396, "body": "Variable ps holds a list of SomeObj.  Variable d either holds the same list of SomeObj or an error if it was unable to parse the json."}], "tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": true, "score": 1, "last_activity_date": 1513040400, "creation_date": 1513040400, "answer_id": 47763855, "question_id": 47757513, "link": "https://stackoverflow.com/questions/47757513/haskell-json-queue/47763855#47763855", "title": "Haskell JSON queue", "body": "<p>The code below should get you most of the way to doing what you want to do.  It uses a similar technique to what was suggested by user2407038 .  The three different data types are collected into a sum type : <code>SomeObj</code> .  Three different parsers are created for the <code>SomeObj</code> type and the first one to succeed is the one used - the other two are not used.</p>\n\n<p>When possible I let the compiler automatically define the JSON functionality.  </p>\n\n<p>I added additional code to verify the results by converting back to JSON and then decoding that JSON.</p>\n\n<p>The \"<code>DuplicateRecordFields</code>\" language extension was needed so that both <code>Agent</code> and <code>Job</code> could have an <code>id</code> field.</p>\n\n<p>Once the JSON is parsed you should be able to use <code>List</code> functionality to do the search and update operations that you described.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, DeriveGeneric #-}\n{-# LANGUAGE DuplicateRecordFields #-}\nimport Data.Aeson\nimport Data.Text\nimport Control.Applicative\nimport Control.Monad\nimport qualified Data.ByteString.Lazy as B\nimport GHC.Generics\n\ndata Agent = \n    Agent { id :: Text\n          , name :: Text\n          , primary_skillset :: [Text]\n          , secondary_skillset :: [Text]\n          } deriving (Show, Generic)\n\ninstance FromJSON Agent\ninstance ToJSON Agent\n\ndata Job = \n    Job { id :: Text\n        , tipo :: Text\n        , urgent :: Bool\n        } deriving (Show, Generic)\n\ninstance FromJSON Job\ninstance ToJSON Job\n\nnewtype JobRequest = \n    JobRequest { agent_id :: Text\n               } deriving (Show, Generic)\n\ninstance FromJSON JobRequest\ninstance ToJSON JobRequest\n\ndata SomeObj = \n      AnAgent Agent\n    | AJob Job\n    | AJobRequest JobRequest\n    deriving (Show, Generic)\n\nnewAgentTag = \"new_agent\"\nnewJobTag = \"new_job\"\njobRequestTag = \"job_request\"\n\ninstance FromJSON SomeObj where\n  parseJSON (Object v) =\n    let -- create multiple parsers.\n        parseAgent = AnAgent &lt;$&gt; (v .: newAgentTag)\n        parseJob = AJob &lt;$&gt; (v .: newJobTag)\n        parseJobRequest = AJobRequest &lt;$&gt; (v .: jobRequestTag)\n    in -- Use one of the collection of parsers.\n        parseAgent &lt;|&gt; parseJob &lt;|&gt; parseJobRequest\n\n  parseJSON _ = mzero\n\ninstance ToJSON SomeObj where\n  toJSON (AnAgent agent) = object [newAgentTag .= agent]\n  toJSON (AJob job) = object [newJobTag .= job]\n  toJSON (AJobRequest jobRequest) = object [jobRequestTag .= jobRequest]\n\njsonFile :: FilePath\njsonFile = \"sample-input.json\"\n-- Read the local copy of the JSON file.\ngetJSON :: IO B.ByteString\ngetJSON = B.readFile jsonFile\nmain :: IO ()\nmain = do\n -- Get JSON data and decode it\n  d &lt;- (eitherDecode &lt;$&gt; getJSON) :: IO (Either String [SomeObj])\n\n  -- If d is Left, the JSON was malformed.\n  -- In that case, we report the error.\n  -- Otherwise, we perform the operation of\n  -- our choice. In this case, just print it.\n  case d of\n    Left err -&gt; putStrLn err\n    Right ps -&gt; do\n      print ps\n\n      -- convert back to JSON.\n      let j2 = encode ps -- \n      print j2\n\n      -- decode the newly converted JSON\n      let d2 = eitherDecode j2 :: Either String [SomeObj]\n      case d2 of\n        Left err -&gt; putStrLn err\n        Right ps2 -&gt; do\n          print ps2\n</code></pre>\n"}], "owner": {"reputation": 156, "user_id": 8948343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tzwVi.jpg?s=128&g=1", "display_name": "Gabriel Rufino", "link": "https://stackoverflow.com/users/8948343/gabriel-rufino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 47763855, "answer_count": 1, "score": 2, "last_activity_date": 1513040400, "creation_date": 1513010717, "last_edit_date": 1513036884, "question_id": 47757513, "link": "https://stackoverflow.com/questions/47757513/haskell-json-queue", "title": "Haskell JSON queue", "body": "<p>I would like some help with Haskell, I am really new to the language and to Functional Programming (have had contact with it in JavaScript, but nothing much)</p>\n\n<p>I need to parse different types of JSON objects, that are defined by a parameter, and at first store them for later treatments, example:</p>\n\n<pre><code>[\n  {\n    \"new_agent\": {\n      \"id\": \"8ab86c18-3fae-4804-bfd9-c3d6e8f66260\",\n      \"name\": \"BoJack Horseman\",\n      \"primary_skillset\": [\"bills-questions\"],\n      \"secondary_skillset\": []\n    }\n  },\n  {\n    \"new_job\": {\n      \"id\": \"f26e890b-df8e-422e-a39c-7762aa0bac36\",\n      \"tipo\": \"rewards-question\",\n      \"urgent\": false\n    }\n  },\n  {\n    \"job_request\": {\n      \"agent_id\": \"ed0e23ef-6c2b-430c-9b90-cd4f1ff74c88\"\n    }\n  }\n]\n</code></pre>\n\n<p>That means I need to store 3 different types of arrays, which will have to interact with each other in the future.</p>\n\n<p>So far with tutorials I have found instruction enough that led me to this simple code for printing one object with fromJSON and toJSON, which I could replicate to the others, but I still don't know how to grab the object by the first parameter (new_agent, new_job, job_request), before deciding how to parse it:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, DeriveGeneric #-}\nimport Data.Aeson\nimport Data.Text\nimport Control.Applicative\nimport Control.Monad\nimport qualified Data.ByteString.Lazy as B\nimport GHC.Generics\ndata Agent =\n  Agent { agentId  :: Text\n         , name   :: Text\n         , primary_skillset  :: [Text]\n         , secondary_skillset :: [Text]\n           } deriving Show\n\ninstance FromJSON Agent where\n parseJSON (Object v) =\n    Agent &lt;$&gt; v .: \"id\"\n           &lt;*&gt; v .: \"name\"\n           &lt;*&gt; v .: \"primary_skillset\"\n           &lt;*&gt; v .: \"secondary_skillset\"\n parseJSON _ = mzero          \n\ninstance ToJSON Agent where\n toJSON (Agent agentId name primary_skillset secondary_skillset) =\n    object [ \"id\"  .= agentId\n           , \"name\"   .= name\n           , \"primary_skillset\"        .= primary_skillset\n           , \"secondary_skillset\" .= secondary_skillset\n             ] \n\njsonFile :: FilePath\njsonFile = \"sample-input.json\"  \n-- Read the local copy of the JSON file.\ngetJSON :: IO B.ByteString\ngetJSON = B.readFile jsonFile   \nmain :: IO ()    \nmain = do\n -- Get JSON data and decode it\n d &lt;- (eitherDecode &lt;$&gt; getJSON) :: IO (Either String [Agent])\n -- If d is Left, the JSON was malformed.\n -- In that case, we report the error.\n -- Otherwise, we perform the operation of\n -- our choice. In this case, just print it.\n case d of\n  Left err -&gt; putStrLn err\n  Right ps -&gt; print ps\n</code></pre>\n\n<p>I am looking for an answer (if possible with code snippets) to the following questions:</p>\n\n<ul>\n<li><p>how to grab the object within an object by its id and then add it to an array</p></li>\n<li><p>after storing the object in an array, how do I \"iterate\" over it whenever I need to use that one specific info again (search by object key)</p></li>\n<li><p>how to assign (update) the JSON inside the array, keeping it there</p></li>\n</ul>\n"}, {"tags": ["haskell", "counter", "io-monad"], "answers": [{"comments": [{"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513012139, "post_id": 47757746, "comment_id": 82476934, "body": "Your solution have at least syntax. Also I am not getting the \\. Thanks, anyway :) ."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1513012444, "post_id": 47757746, "comment_id": 82477116, "body": "This won&#39;t work because each recursive call to <code>traverseFlatDst</code> will number the printed lines starting at 0."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513012629, "post_id": 47757746, "comment_id": 82477234, "body": "@AlexeyOrlov fixed typo. If you want counter to preserve its value for nested calls, there is nothing you can do except introducing an additional argument."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513013053, "post_id": 47757746, "comment_id": 82477458, "body": "Some trouble is still there. Never mind, I see the idea now. And yes, I want to keep the counter right through. But where can I introduce that magic argument?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1513014127, "post_id": 47757746, "comment_id": 82478022, "body": "In <code>traverseFlatDst</code>."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 0, "last_activity_date": 1513012530, "last_edit_date": 1513012530, "creation_date": 1513011614, "answer_id": 47757746, "question_id": 47757509, "link": "https://stackoverflow.com/questions/47757509/haskell-how-to-keep-count/47757746#47757746", "title": "Haskell: how to keep count", "body": "<p>From nowhere? Of course not.</p>\n\n<p>You can zip your <code>files</code> with numbers, though, and then <code>mapM</code> over them:</p>\n\n<pre><code>mapM_ (\\(file, counter) -&gt; putStrLn (printf \"%d: %s\" counter (strp file))) (zip [0..] files)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513015629, "post_id": 47758577, "comment_id": 82478749, "body": "Thanks! Your suggestion is quite reasonable. I&#39;d like to pursue also the &quot;invasive&quot; take. Any ideas how to perfect it? (See the UPD)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513016383, "post_id": 47758577, "comment_id": 82479140, "body": "@AlexeyOrlov Not sure what you mean by &quot;the &quot;invasive&quot; take&quot;. The first function in this answer is the one which solves the problem as originally stated."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513016518, "post_id": 47758577, "comment_id": 82479218, "body": "The UPD part above. Is it a dead end?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513016809, "post_id": 47758577, "comment_id": 82479377, "body": "I&#39;m not sure what that code is trying to do. You don&#39;t need the entire <code>[Int]</code> list of indices as a function parameter, just the next index. Furthermore, <code>cnt</code> never changes in that function. Do you see how the recursive call to <code>loop</code> is called with <code>i+length files</code> instead of the previous value <code>i</code>?"}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513018760, "post_id": 47758577, "comment_id": 82480388, "body": "Would you please add type annotation to you uppermost version of <code>traverseFlatDst</code> (and check syntax again)?"}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513019661, "post_id": 47758577, "comment_id": 82480797, "body": "` parse error on input \u2018&lt;-\u2019     Perhaps this statement should be within a &#39;do&#39; block?`"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513020213, "post_id": 47758577, "comment_id": 82481082, "body": "I&#39;ve verified there are no syntax errors and added type annotations. <a href=\"http://lpaste.net/3278097500493316096\" rel=\"nofollow noreferrer\">Here</a> is the complete file"}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513020674, "post_id": 47758577, "comment_id": 82481309, "body": "Thank you very much! I grokked the syntax, but there is still a hiccup (two number one files, UPD2)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513021144, "post_id": 47758577, "comment_id": 82481534, "body": "So it turns out the logic of my function wasn&#39;t correct when there are multiple subdirectories to be traversed. See edit for the fixed version. Also note that the version which returns the list of files doesn&#39;t suffer this problem."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513022211, "post_id": 47758577, "comment_id": 82482124, "body": "Thanks! I&#39;ll have to think it over."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 3, "last_activity_date": 1513021072, "last_edit_date": 1513021072, "creation_date": 1513014731, "answer_id": 47758577, "question_id": 47757509, "link": "https://stackoverflow.com/questions/47757509/haskell-how-to-keep-count/47758577#47758577", "title": "Haskell: how to keep count", "body": "<p>You can accomplish this by adding an additional effect to your function; namely, the state effect.</p>\n\n<pre><code>import Control.Monad.State\n\nprintPath :: (PrintfArg t, Show a) =&gt; (t, a) -&gt; IO ()\nprintPath (l, file) = printf \"%d : %s\\n\" l (show file)\n\ntraverseFlatDst :: Path Abs Dir -&gt; IO ()\ntraverseFlatDst =\n  let loop srcDir = do\n        (dirs, files) &lt;- listDir srcDir\n        i &lt;- get\n        put (i + length files)\n        mapM_ (liftIO . printPath) $ zip [i..] files\n        mapM_ loop dirs\n  in \\s -&gt; evalStateT (loop s) 0\n</code></pre>\n\n<p>(NB: I've also removed unused parameters for clarity).</p>\n\n<p>However, I don't suggest writing this function this way. Semantically, your function is collecting a bunch of file paths. Instead of printing them, you should just return them from the function; you can always print them later! The logic of the modified version is actually quite simpler:</p>\n\n<pre><code>traverseFlatDst' :: Path Abs Dir -&gt; IO [Path Abs File]\ntraverseFlatDst' srcDir = do\n  (dirs, files) &lt;- listDir srcDir\n  (concat . (files:)) &lt;$&gt; mapM traverseFlatDst' dirs\n</code></pre>\n\n<p>You can use this function to print the files with numbers without keeping track of some state explicitly, since you have access to all the files 'at once':</p>\n\n<pre><code>&gt; traverseFlatDst' somePath &gt;&gt;= mapM_ printPath . zip [0..]\n</code></pre>\n\n<p>Note also that the 2nd version is much more strict than the first; it will traverse the entire directory tree before starting to print anything. As a general rule, the strict version is better anyways, but if you want the lazy version, you can write it using <code>unsafeInterleaveIO</code>:</p>\n\n<pre><code>import System.IO.Unsafe (unsafeInterleaveIO)\n\ntraverseFlatDst' :: Path Abs Dir -&gt; IO [Path Abs File]\ntraverseFlatDst' srcDir = do\n  (dirs, files) &lt;- listDir srcDir\n  files' &lt;- unsafeInterleaveIO $ mapM traverseFlatDst' dirs\n  return $ concat $ files:files'\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1513022082, "last_edit_date": 1513022082, "creation_date": 1513019367, "answer_id": 47759727, "question_id": 47757509, "link": "https://stackoverflow.com/questions/47757509/haskell-how-to-keep-count/47759727#47759727", "title": "Haskell: how to keep count", "body": "<p>I would probably use a streaming library like <a href=\"http://hackage.haskell.org/package/streaming-0.2.0.0/docs/Streaming-Prelude.html\" rel=\"nofollow noreferrer\">streaming</a> to separate enumerating the files from adding the numbers and from printing the decorated entries:</p>\n\n<pre><code>import Streaming\nimport qualified Streaming.Prelude as S\n\ntraverseFlatDst :: FilePath -&gt; Int -&gt; Int -&gt; FilePath -&gt; Stream (Of FilePath) IO ()\ntraverseFlatDst dstRoot total totw srcDir = do\n  (dirs, files) &lt;- liftIO $ listDir srcDir\n  S.each files\n  mapM_ (traverseFlatDst dstRoot total totw) dirs\n\ndecorate :: Stream (Of FilePath) IO r -&gt; Stream (Of (Int,FilePath)) IO r\ndecorate stream = S.zip (S.enumFrom 1) stream\n\ndisplay:: Stream (Of (Int,FilePath)) IO () -&gt; IO ()\ndisplay = S.mapM_ $ \\(index,path) -&gt;  putStrLn $ show index ++ \" \" ++ path\n</code></pre>\n\n<p>Where <a href=\"http://hackage.haskell.org/package/streaming-0.2.0.0/docs/Streaming-Prelude.html#v:each\" rel=\"nofollow noreferrer\"><code>S.each</code></a>, <a href=\"http://hackage.haskell.org/package/streaming-0.2.0.0/docs/Streaming-Prelude.html#v:zip\" rel=\"nofollow noreferrer\"><code>S.zip</code></a>, <a href=\"http://hackage.haskell.org/package/streaming-0.2.0.0/docs/Streaming-Prelude.html#v:mapM_\" rel=\"nofollow noreferrer\"><code>S.mapM_</code></a> are from <em>streaming</em>.</p>\n"}, {"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1513038580, "post_id": 47763381, "comment_id": 82488656, "body": "Using an <code>IORef</code> to implement something which can be written as a pure function is typically considered &#39;ugly&#39; (i.e. not idiomatic)."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1513100364, "post_id": 47763381, "comment_id": 82518061, "body": "How do you mean? If pure functions were not useless for the job, this class of topics wouldn&#39;t have existed."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1513113062, "post_id": 47763381, "comment_id": 82524556, "body": "I think @user2407038 is suggesting that <code>IORef</code>s should only be used when <code>StateT</code> can&#39;t do the job. For example, if you build data structures that include <code>IORef</code>s (especially if they have lots of them, and/or also have <code>IOArray</code>s), then you&#39;re probably doing something legit. The same holds if you&#39;re using an <code>IORef</code> to implement inter-thread communication using CAS. But if you just have one counter doing counter business, it smells a bit off."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513143248, "post_id": 47763381, "comment_id": 82533393, "body": "I see. On the other hand, the very existence of this particular counter is due to i/o needs. So it belongs where it should."}], "tags": [], "owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "is_accepted": false, "score": 0, "last_activity_date": 1513036762, "creation_date": 1513036762, "answer_id": 47763381, "question_id": 47757509, "link": "https://stackoverflow.com/questions/47757509/haskell-how-to-keep-count/47763381#47763381", "title": "Haskell: how to keep count", "body": "<p>Final solution, borrowed from <a href=\"https://stackoverflow.com/questions/6302249/how-to-implement-a-global-counter-using-monad\">How to implement a global counter using Monad?</a></p>\n\n<pre><code>import Data.IORef\n\ntype Counter = Int -&gt; IO Int\n\nmakeCounter :: IO Counter\nmakeCounter = do\n  r &lt;- newIORef 0\n  return (\\i -&gt; do modifyIORef r (+i)\n                   readIORef r)\n\n\nprintPath :: Counter -&gt; FilePath -&gt; IO ()\nprintPath counter file = do\n  n &lt;- counter 1\n  putStrLn (printf \"%d : %s\" n (strp file))\n\n\ntraverseFlatDst :: FilePath -&gt; Int -&gt; Int -&gt; Counter -&gt; FilePath -&gt; IO ()\ntraverseFlatDst dstRoot total totw cnt srcDir = do\n  (dirs, files) &lt;- listDir srcDir\n  let iterate = printPath cnt\n  mapM_  iterate files                -- tracing\n  let traverse = traverseFlatDst dstRoot total totw cnt\n  mapM_ traverse dirs\n\n\ngroom :: FilePath -&gt; FilePath -&gt; Int -&gt; IO ()\ngroom src dst total = do\n  counter &lt;- makeCounter\n  let totWidth = length $ show total\n  traverseFlatDst dst total totWidth counter src\n  putStrLn (printf \"total: %d, width: %d\" total totWidth)\n</code></pre>\n\n<p>Still caged and can't be used anywhere, but it's OK. Not ugly.</p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 0, "last_activity_date": 1513110517, "last_edit_date": 1513110517, "creation_date": 1513104641, "answer_id": 47779612, "question_id": 47757509, "link": "https://stackoverflow.com/questions/47757509/haskell-how-to-keep-count/47779612#47779612", "title": "Haskell: how to keep count", "body": "<p>This solution doesn't require additional libraries, processes each file the moment it is found and, for the sake of separating concerns, doesn't require <code>traverseFlatDst</code> to know what is being done with the produced files.</p>\n\n<p>This last feature is achieved by passing a small effectful state machine (a step function, really) as a parameter to <code>traverseFlatDst</code>, and making <code>traverseFlatDst</code> polymorphic in the machine state, so it doesn't know anything about it:</p>\n\n<pre><code>{-# language RankNTypes #-}\nimport Control.Monad (foldM)\n\ntype Source e = forall s. (s -&gt; e -&gt; IO s) -&gt; s -&gt; IO s\n\ntraverseFlatDst :: FilePath -&gt; Int -&gt; Int -&gt; FilePath -&gt; Source FilePath\ntraverseFlatDst dstRoot total totw srcDir step state = do\n  (dirs, files) &lt;- listDir srcDir\n  state' &lt;- foldM step state files\n  foldM (\\s path -&gt; traverseFlatDst dstRoot total totw path step s) state' dirs\n\n-- Pass this as the step argument to traverseFlatDst\n-- The counter is the state.\nstep :: Int -&gt; FilePath -&gt; IO Int\nstep index path = do\n    putStrLn $ show index ++ \" \" ++ path\n    return $ succ index\n</code></pre>\n"}], "owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1328, "favorite_count": 0, "accepted_answer_id": 47758577, "answer_count": 5, "score": 1, "last_activity_date": 1513110517, "creation_date": 1513010708, "last_edit_date": 1513035782, "question_id": 47757509, "link": "https://stackoverflow.com/questions/47757509/haskell-how-to-keep-count", "title": "Haskell: how to keep count", "body": "<p>I'm walking a directory recursively, in a conventional way. This is a <strong>working</strong> prototype:</p>\n\n<pre><code>traverseFlatDst :: FilePath -&gt; Int -&gt; Int -&gt; FilePath -&gt; IO ()\ntraverseFlatDst dstRoot total totw srcDir = do\n  (dirs, files) &lt;- listDir srcDir\n  mapM_ (\\file -&gt; putStrLn (printf \"%s\" (strp file))) files    -- tracing\n  let traverse = traverseFlatDst dstRoot total totw\n  mapM_ traverse dirs\n</code></pre>\n\n<p>I have a not so unusual request: every trace line should be numbered (it is not really for tracing). Like this:</p>\n\n<pre><code>traverseFlatDst :: FilePath -&gt; Int -&gt; Int -&gt; FilePath -&gt; IO ()\ntraverseFlatDst dstRoot total totw srcDir = do\n  (dirs, files) &lt;- listDir srcDir\n  mapM_ (\\file -&gt; putStrLn (printf \"%d: %s\" counterFromNowhere (strp file))) files\n  let traverse = traverseFlatDst dstRoot total totw\n  mapM_ traverse dirs\n</code></pre>\n\n<p>All the solutions I've seen so far are ugly beyond imagination, if applicable at all. Is there a nice way to manage it?</p>\n"}, {"tags": ["haskell", "tree", "functional-programming"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1513010058, "post_id": 47757073, "comment_id": 82475709, "body": "I would approach this in two steps:  First, find all the roots of the result forest by identifying all <code>ID</code>s that are never used as a <code>parentId</code>.  Once you have that list, recursively construct the tree from each root by scanning the input items to find the children of the current node. Each step is O(n^2) done naively, but could be improve to O(n log n) by pulling in appropriate data types like <code>Data.Map</code>."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1513018881, "post_id": 47757073, "comment_id": 82480452, "body": "Whoops. My description for how to handle roots is actually how to find leaves. Slightly backwards. At least roots are easier to find. Just O(n), even in the naive case."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1513056979, "post_id": 47757920, "comment_id": 82493050, "body": "If you use <a href=\"https://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Map-Lazy.html#v:fromListWith\" rel=\"nofollow noreferrer\"><code>Map.fromListWith</code></a> to organize the list of items into a map from each id to the list of its children, and then use that map to <code>buildTreeFrom</code> instead of filtering, you will get an asymptotic speedup -- I think from n^2 to n log n."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 2, "last_activity_date": 1513012245, "creation_date": 1513012245, "answer_id": 47757920, "question_id": 47757073, "link": "https://stackoverflow.com/questions/47757073/grow-a-tree-from-parent-relations-in-haskell/47757920#47757920", "title": "Grow a tree from parent relations in Haskell", "body": "<p>In a functional language, you write such a program by keeping a state which you pass around as a function parameter. In this case, the state is the 'current' item at which you're looking. </p>\n\n<pre><code>import Data.Maybe (isNothing)\nimport Data.Tree\n\ntype ID = Int\n\ndata Item a = Item\n  { _id :: ID\n  , _parentId :: Maybe ID\n  , _value :: a\n  } deriving (Show)\n\ntype Items a = [Item a]\ntype ItemTree a = Tree (ID, a)\n\nbuildTreeFrom :: Items a -&gt; Item a -&gt; ItemTree a\nbuildTreeFrom m (Item i _ v) = Node (i,v) (map (buildTreeFrom m) . filter ((== Just i) . _parentId) $ m)\n</code></pre>\n\n<p>Note that this relies on your stated assumptions. The algorithm is simple and follows directly from the requirements of the function:</p>\n\n<ul>\n<li>the value of the current node is the ID/value pair of the given <code>Item</code></li>\n<li>the subforest of the current node is all of the trees whose root nodes' parent IDs are the ID of the current node</li>\n</ul>\n\n<p>Then the function you want simply calls <code>buildTreeFrom</code> on every <code>Item</code> which is a root node (i.e. which has no parent):</p>\n\n<pre><code>buildForest :: Items a -&gt; Forest (ID, a)\nbuildForest m = map (buildTreeFrom m) . filter (isNothing . _parentId) $ m\n</code></pre>\n\n<p>And a simple test (using the very handy <code>Data.Tree.drawForest</code>):</p>\n\n<pre><code>&gt;test0 = [ Item 0 Nothing 'a', Item 1 (Just 0) 'b', Item 2 (Just 0) 'c', Item 3 (Just 1) 'd'\n        , Item 4 Nothing 'a', Item 5 (Just 4) 'b', Item 6 (Just 5) 'c', Item 7 (Just 6) 'd' ]\n&gt;putStrLn $ drawForest $ (fmap.fmap) show $ buildForest test0\n(0,'a')\n|\n+- (1,'b')\n|  |\n|  `- (3,'d')\n|\n`- (2,'c')\n\n(4,'a')\n|\n`- (5,'b')\n   |\n   `- (6,'c')\n      |\n      `- (7,'d')\n</code></pre>\n\n<p>Note that I've made no effort to optimize this program. If you think it's too slow, profile first!</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1513110274, "last_edit_date": 1513110274, "creation_date": 1513108603, "answer_id": 47780577, "question_id": 47757073, "link": "https://stackoverflow.com/questions/47757073/grow-a-tree-from-parent-relations-in-haskell/47780577#47780577", "title": "Grow a tree from parent relations in Haskell", "body": "<p>Convert your <code>[Item a]</code> to <code>Map (Maybe ID) [Item a]</code>, keyed on the parent ID of each item. </p>\n\n<p>Now you will have the roots under <code>Nothing</code>, and for each root ID you can pull its children from the map (dict) with <a href=\"https://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Map-Strict.html#v:lookup\" rel=\"nofollow noreferrer\"><code>lookup</code></a>, and populate the tree's next level this way, recursively.</p>\n\n<p>To be used as key in <code>Map</code>, <code>ID</code> must be in <code>Ord</code>. I think it's a reasonable assumption. I'll use <code>Int</code> here:</p>\n\n<pre><code>import qualified Data.Map.Strict as Map\nimport Data.Maybe (maybeToList)\n\ntype ID = Int\n\ndata Item a = Item { id :: ID\n                   , parentId :: Maybe ID\n                   , payload :: a\n                   } deriving Show\n\ndata ItemTree a = ItemTree ID a [ItemTree a] deriving Show\n\nbuildForest :: [Item a] -&gt; [ItemTree a]\nbuildForest items = map mkTree roots\n   where\n   -- dict :: Map.Map (Maybe ID) [Item a]\n      dict  = Map.fromListWith (++) [ (parentId i, [i]) | i &lt;- items ]\n      itemsUnder k = join . maybeToList . Map.lookup k $ dict\n      roots = itemsUnder Nothing \n      mkTree item =                 -- using `dict`, recursively build the tree\n        ItemTree (id item) (payload item) \n               . map mkTree $ itemsUnder (Just $ id item) \n</code></pre>\n\n<p>Here instead of passing the dict around, we have it in (shared, inner)  scope.</p>\n"}], "owner": {"reputation": 493, "user_id": 1250621, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/gisqt.jpg?s=128&g=1", "display_name": "Luftzig", "link": "https://stackoverflow.com/users/1250621/luftzig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 0, "accepted_answer_id": 47757920, "answer_count": 2, "score": 3, "last_activity_date": 1513110274, "creation_date": 1513009235, "question_id": 47757073, "link": "https://stackoverflow.com/questions/47757073/grow-a-tree-from-parent-relations-in-haskell", "title": "Grow a tree from parent relations in Haskell", "body": "<p>I have the following data:</p>\n\n<pre><code>data Item a = { id :: ID\n              , parentId :: Maybe ID\n              , data :: a\n              }\n\ndata ItemTree a = ItemTree ID a [ItemTree a]\n</code></pre>\n\n<p>And I want to to have this function: <code>buildForest :: [Item a] -&gt; [ItemTree a]</code> which will return a non-trivial forest (that is, a respect parent relations). I can assume that <code>ID</code> for each item is unique, and that all items have their parent the list, if that matters.</p>\n\n<p>I've been trying to wrap my mind around this for several days now. I've implemented a similar code in javascript by mutating the objects (in fact, a copy of them), but I would have liked to know how can this be done Haskell.</p>\n\n<p>My best thoughts on the topic so far where this:</p>\n\n<pre><code>toRelations :: Item a -&gt; ((ID, ID), Item a)\ntoRelations it@{id, parentId} = ((parentId, id), it)\n</code></pre>\n\n<p>So now I can have a list of relations from parent to children, So the arrows point at the right direction. I still need to construct a tree from it, while avoiding doing slow lookups. Does that make sense?</p>\n"}, {"tags": ["haskell", "combinatorics", "powerset"], "comments": [{"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1513004614, "post_id": 47755231, "comment_id": 82472171, "body": "It\u2019s worth noting that if you want to find the entire powerset (ie no lazy shortcutting) of a list of length n, you need to do at least O(2^n) work. Thus such a function may never be \u201cfast\u201d for reasonably long lists."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1513004893, "post_id": 47755231, "comment_id": 82472364, "body": "@DanRobertson: that is correct. But if we calculate the complement for every of these items, we will thus (if the complement <code>(\\\\)</code> is calculated in <i>O(n^2)</i>), have a <i>O(n^2 2^n)</i> algorithm. I agree that <i>O(n^2)</i> will probably be small compared to <i>O(2^n)</i>, but it is still a factor to take into account."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1513043087, "post_id": 47755490, "comment_id": 82489710, "body": "Elegant solution.  Using a <a href=\"https://hackage.haskell.org/package/dlist-0.8.0.3/docs/Data-DList.html\" rel=\"nofollow noreferrer\">difference list</a> will eliminate the appending overhead, which is significant here."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1513045168, "post_id": 47755490, "comment_id": 82490172, "body": "Actually, to my surprise, it isn&#39;t that much faster with dlist.  <a href=\"https://github.com/luqui/experiments/blob/master/pset.hs\" rel=\"nofollow noreferrer\">benchmark</a>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1513048518, "post_id": 47755490, "comment_id": 82490944, "body": "But doing a &quot;CPS transformation&quot; of sorts improves things a lot.  See my answer."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 10, "last_activity_date": 1513004806, "last_edit_date": 1513004806, "creation_date": 1513003900, "answer_id": 47755490, "question_id": 47755231, "link": "https://stackoverflow.com/questions/47755231/fast-powerset-implementation-with-complement-set/47755490#47755490", "title": "Fast powerset implementation with complement set", "body": "<p>Well you should see a powerset like this: you enumerate over the items of the set, and you decide whether you put these in the \"selection\" (first item of the tuple), or not (second item of the tuple). By enumerating over these selections exhaustively, we get the powerset.</p>\n\n<p>So we can do the same, for instance using recursion:</p>\n\n<pre><code>import Control.Arrow(first, second)\n\npowersetWithComplements [] = [([],[])]\npowersetWithComplements (x:xs) = map (second (x:)) rec ++ map (first (x:)) rec\n    where rec = powersetWithComplements xs\n</code></pre>\n\n<p>So here the <code>map (second (x:)</code> prepends all the second items of the tuples of the <code>rec</code> with <code>x</code>, and the <code>map (second (x:)</code> does the same for the first item of the tuples of <code>rec</code>. where <code>rec</code> is the recursion on the tail of the items.</p>\n\n<pre><code>Prelude Control.Arrow&gt; powersetWithComplements [1,2,3]\n[([],[1,2,3]),([3],[1,2]),([2],[1,3]),([2,3],[1]),([1],[2,3]),([1,3],[2]),([1,2],[3]),([1,2,3],[])]\n</code></pre>\n\n<p>The advantage of this approach is that we do <em>not</em> generate a complement list for every list we generate: we concurrently build the selection, and complement. Furthermore we can <em>reuse</em> the lists we construct in the recursion, which will reduce the memory footprint.</p>\n\n<p>In both time complexity and memory complexity, the <code>powersetWithComplements</code> function will be equal (note that this is <em>complexity</em>, of course in terms of processing time it will require more time, since we do an extra amount of work) like the <code>powerset</code> function, since prepending a list is usually done in <em>O(1)</em>), and we now build two lists (and a tuple) for every original list.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 2, "last_activity_date": 1513047905, "creation_date": 1513047905, "answer_id": 47764748, "question_id": 47755231, "link": "https://stackoverflow.com/questions/47755231/fast-powerset-implementation-with-complement-set/47764748#47764748", "title": "Fast powerset implementation with complement set", "body": "<p>Since you are looking for a \"fast\" implementation, I thought I would share some <a href=\"https://github.com/luqui/experiments/blob/master/pset.hs\" rel=\"nofollow noreferrer\">benchmark experiments</a> I did with Willem's solution.</p>\n\n<p>I thought using a <a href=\"https://hackage.haskell.org/package/dlist-0.8.0.3/docs/Data-DList.html\" rel=\"nofollow noreferrer\">DList</a> instead of a plain list would be a big improvement, since DLists have constant-time append, whereas appending lists is linear in the size of the left argument.  </p>\n\n<pre><code>psetDL :: [a] -&gt; [([a],[a])]\npsetDL = toList . go\n    where\n    go [] = DList.singleton ([],[])\n    go (x:xs) = (second (x:) &lt;$&gt; rec) &lt;&gt; (first (x:) &lt;$&gt; rec)\n        where\n        rec = go xs\n</code></pre>\n\n<p>But that did not have a significant effect.</p>\n\n<p>I suspected this is because we are traversing both sublists anyway because of the fmap (<code>&lt;$&gt;</code>).  We can avoid the traversal by doing something similar to CPS-converting the function, passing down the accumulated sets as parameters rather than returning them.  </p>\n\n<pre><code>psetTail :: [a] -&gt; [([a],[a])]\npsetTail = go [] []\n    where\n    go a b [] = [(a,b)]\n    go a b (x:xs) = go a (x:b) xs &lt;&gt; go (x:a) b xs\n</code></pre>\n\n<p>This yielded a 220% improvement on a list of size 20.  Now since we aren't traversing the lists from fmapping, we can get rid of the append traversal by using a DList:</p>\n\n<pre><code>psetTailDL :: [a] -&gt; [([a],[a])]\npsetTailDL = toList . go [] []\n    where\n    go a b [] = DList.singleton (a,b)\n    go a b (x:xs) = go a (x:b) xs &lt;&gt; go (x:a) b xs\n</code></pre>\n\n<p>Which yields an additional 20% improvement.</p>\n"}, {"tags": [], "owner": {"reputation": 115, "user_id": 3403811, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ddb70d1c41a978fab65e15ca4d9ffcf?s=128&d=identicon&r=PG", "display_name": "Roman Czyborra", "link": "https://stackoverflow.com/users/3403811/roman-czyborra"}, "is_accepted": false, "score": 0, "last_activity_date": 1524166270, "last_edit_date": 1524166270, "creation_date": 1524165616, "answer_id": 49928691, "question_id": 47755231, "link": "https://stackoverflow.com/questions/47755231/fast-powerset-implementation-with-complement-set/49928691#49928691", "title": "Fast powerset implementation with complement set", "body": "<p>I guess the best is inspired by your <code>reverse</code> discovery</p>\n\n<pre><code>partitions s=filterM(const[False,True])s\n        `zip`filterM(const[True,False])s\n</code></pre>\n\n<p>rather than a likely stackoverflower</p>\n\n<pre><code>partitions[]=[([],[])]\npartitions(x:xs)=[p|(f,t)&lt;-partitions xs,p&lt;-[(l,x:r),(x:l,r)]]\n</code></pre>\n\n<p>or a space-and-time-efficient finite list indexer</p>\n\n<pre><code>import Data.Array\nimport Data.Bits\nimport Data.List\npartitions s=[(map(a!)f,map(a!)t)\n             |n&lt;-[length s],a&lt;-[listArray(0,n-1)s],\n              m&lt;-[0..2^n-1],(f,t)&lt;-[partition(testBit m)[0..n-1]]]\n</code></pre>\n"}], "owner": {"reputation": 1972, "user_id": 1747134, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/696bad3bd2c5e16ded04f3cdf436623f?s=128&d=identicon&r=PG", "display_name": "user1747134", "link": "https://stackoverflow.com/users/1747134/user1747134"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 1, "accepted_answer_id": 47755490, "answer_count": 3, "score": 8, "last_activity_date": 1524166270, "creation_date": 1513003022, "last_edit_date": 1513003519, "question_id": 47755231, "link": "https://stackoverflow.com/questions/47755231/fast-powerset-implementation-with-complement-set", "title": "Fast powerset implementation with complement set", "body": "<p>I would like to have a function</p>\n\n<pre><code>powersetWithComplements :: [a] -&gt; [([a], [a])]\n</code></pre>\n\n<p>Such that for example:</p>\n\n<pre><code>powersetWithComplements [1,2,3] = [([],[1,2,3]),([3],[1,2]),([2],[1,3]),([2,3],[1]),([1],[2,3]),([1,3],[2]),([1,2],[3]),([1,2,3],[])]\n</code></pre>\n\n<p>It is easy to obtain some implementation, for example</p>\n\n<pre><code>powerset :: [a] -&gt; [[a]]\npowerset = filterM (const [False, True])\n\npowersetWithComplements s = let p = powerset s in zip p (reverse p)\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>powersetWithComplements s = [ (x, s \\\\ x) | x &lt;- powerset s]\n</code></pre>\n\n<p>But I estimate that the performance of both these would be really poor. What would be an optimal approach? It is possible to use different data structure than the <code>[]</code> list.</p>\n"}, {"tags": ["list", "file", "haskell", "partition", "io-monad"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1513002667, "post_id": 47755054, "comment_id": 82470829, "body": "There&#39;s a function in <code>Data.List</code> called <code>partition</code> that looks like what you ask for."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1513002707, "post_id": 47755054, "comment_id": 82470860, "body": "@MarkSeemann: I think that a problem here is that the predicate is monadic (<code>FilePath -&gt; IO Bool</code>)"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1513003044, "post_id": 47755054, "comment_id": 82471069, "body": "Related: <a href=\"https://stackoverflow.com/q/31419429/126014\">stackoverflow.com/q/31419429/126014</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1513003136, "post_id": 47755054, "comment_id": 82471136, "body": "n.m. is right: there&#39;s no way to know whether a path refers to a file or directory, short of actually accessing that path, which is an <code>IO</code> operation. That is, unless you&#39;re ok with a heuristic like whether there is a standard file-extension, but this wouldn&#39;t be very reliable in general."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1513003143, "post_id": 47755054, "comment_id": 82471143, "body": "@n.m. this just means that the type should be <code>getFilesAndDirs :: [FilePath] -&gt; IO ([FilePath], [FilePath])</code>. I&#39;m sure the OP will take <i>that</i> as an answer, as it is &quot;a <i>newbie</i> question&quot;."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1513003418, "post_id": 47755054, "comment_id": 82471320, "body": "<code>partitionM :: Monad m =&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m ([a], [a])</code> from <a href=\"http://hoogle.haskell.org/?hoogle=partitionM\" rel=\"nofollow noreferrer\"><code>extra&#39;s Control.Monad.Extra</code></a> seems to be the ticket."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1513005401, "post_id": 47755054, "comment_id": 82472702, "body": "Thank you very much! This is absolutely the ticket."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1513009050, "post_id": 47755054, "comment_id": 82475072, "body": "(there used to be an insightful comment here by user n.m. about how if the function must do any I/O there <i>must</i> be <code>IO</code> somewhere in its type.)"}], "answers": [{"comments": [{"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1513003560, "post_id": 47755289, "comment_id": 82471427, "body": "Aren&#39;t you missing the monad on the result type of <code>selectM</code>? Also, is the lazy pattern match worth it?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1513003637, "post_id": 47755289, "comment_id": 82471489, "body": "@SebastianRedl: thanks. It is indeed probably not worth it :)"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1513004911, "post_id": 47755289, "comment_id": 82472374, "body": "While it&#39;s a matter of style, I prefer using <code>do</code> notation and to &#39;pull the values out of <code>IO</code>&#39; and then pass them to pure functions. The end result is the same, but see my answer for an alternative."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1513003584, "last_edit_date": 1513003584, "creation_date": 1513003205, "answer_id": 47755289, "question_id": 47755054, "link": "https://stackoverflow.com/questions/47755054/haskell-how-to-make-a-list-of-files-and-a-list-of-directories-out-of-one-common/47755289#47755289", "title": "Haskell: how to make a list of files and a list of directories out of one common list", "body": "<p>The <code>Data.List</code> package has the <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List.html#v:partition\" rel=\"nofollow noreferrer\"><strong><code>partition :: (a -&gt; Bool) -&gt; [a] -&gt; ([a],[a])</code></strong></a> function which splits a list of <code>a</code>s into a tuple of two lists of <code>a</code>s based on a predicate.</p>\n\n<p>The problem is however that when we check if a file is a directory, we probably will use <a href=\"https://hackage.haskell.org/package/system-fileio-0.1/docs/System-Directory.html\" rel=\"nofollow noreferrer\"><strong><code>isDirectory :: FilePath -&gt; IO Bool</code></strong></a> so we can not directly use this as a predicate (since <code>IO Bool</code> is not equal to <code>Bool</code>).</p>\n\n<p>We can write our own <code>partitionM</code> however, and use that one:</p>\n\n<pre><code>import Data.Bool(bool)\nimport Data.Foldable(foldrM)\n\npartitionM :: (Foldable t, Monad m) =&gt; (a -&gt; m Bool) -&gt; t a -&gt; m ([a], [a])\npartitionM p = foldrM (selectM p) ([],[])\n\nselectM :: Monad m =&gt; (a -&gt; m Bool) -&gt; a -&gt; ([a], [a]) -&gt; m ([a], [a])\nselectM p x (ts,fs) = p x &gt;&gt;= return . bool (ts, x:fs) (x:ts,fs)\n</code></pre>\n\n<p>we can then use it like:</p>\n\n<pre><code>import System.Directory(isDirectory)\n\ngetFilesAndDirs :: [FilePath] -&gt; <b>IO</b> ([FilePath], [FilePath])\ngetFilesAndDirs = partitionM isDirectory</code></pre>\n\n<p>Note that it is an <code>IO ([FilePath], [FilePath])</code>, since we need to perform I/O to check if a path is indeed a directory (and not a file).</p>\n"}, {"tags": [], "owner": {"reputation": 79, "user_id": 7245456, "user_type": "registered", "profile_image": "https://graph.facebook.com/1059074607535906/picture?type=large", "display_name": "Imaddin Ahmed Mohamed", "link": "https://stackoverflow.com/users/7245456/imaddin-ahmed-mohamed"}, "is_accepted": false, "score": 0, "last_activity_date": 1513021720, "last_edit_date": 1513021720, "creation_date": 1513004354, "answer_id": 47755646, "question_id": 47755054, "link": "https://stackoverflow.com/questions/47755054/haskell-how-to-make-a-list-of-files-and-a-list-of-directories-out-of-one-common/47755646#47755646", "title": "Haskell: how to make a list of files and a list of directories out of one common list", "body": "<pre><code>module SeparateFiles where\n    import Data.String\n    import System.FilePath.Posix\n\n\n    type Path = FilePath\n    getFilesAndDirs :: Path -&gt; [(Path,Path)]\n    getFilesAndDirs path = [splitFileName path]\n</code></pre>\n\n<p>I understand that you want to split your FilePath extracting into a file and directory. I provide you a very short example.</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1513004688, "creation_date": 1513004688, "answer_id": 47755744, "question_id": 47755054, "link": "https://stackoverflow.com/questions/47755054/haskell-how-to-make-a-list-of-files-and-a-list-of-directories-out-of-one-common/47755744#47755744", "title": "Haskell: how to make a list of files and a list of directories out of one common list", "body": "<p>You can use <code>do</code> notation to orchestrate the impure parts of your program, and then use the built-in (pure) functions like <code>partition</code> to do the actual work. Here's an example:</p>\n\n<pre><code>module Q47755054 (getFilesAndDirs) where\n\nimport Data.List (partition)\nimport Data.Bifunctor (bimap)\nimport System.Directory (doesDirectoryExist)\n\ntagPath :: FilePath -&gt; IO (FilePath, Bool)\ntagPath path = do\n  isDirectory &lt;- doesDirectoryExist path\n  return (path, isDirectory)\n\ngetFilesAndDirs :: [FilePath] -&gt; IO ([FilePath], [FilePath])\ngetFilesAndDirs paths = do\n  taggedPaths &lt;- mapM tagPath paths\n  return $ bimap (fmap fst) (fmap fst) $ partition snd taggedPaths\n</code></pre>\n\n<p>Notice that this uses the built-in <code>mapM</code> function to get an impure list of values (<code>IO [(FilePath, Bool)]</code>), but due to the <code>do</code> syntax and the <code>&lt;-</code> binding, <code>taggedPaths</code> 'looks' like a pure value (<code>[(FilePath, Bool)]</code>), and therefore you can pass it to <code>partition</code>.</p>\n\n<p>Notice, additionally, that <code>tagPath</code> is just a module-level helper function that isn't exported by the module.</p>\n"}], "owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 0, "accepted_answer_id": 47755289, "answer_count": 3, "score": 3, "last_activity_date": 1513021720, "creation_date": 1513002428, "last_edit_date": 1513005026, "question_id": 47755054, "link": "https://stackoverflow.com/questions/47755054/haskell-how-to-make-a-list-of-files-and-a-list-of-directories-out-of-one-common", "title": "Haskell: how to make a list of files and a list of directories out of one common list", "body": "<p>This is a newbie question. Suppose I want to separate a list of files and directories into a list of files and a list of directories:</p>\n\n<pre><code>getFilesAndDirs :: [FilePath] -&gt; ([FilePath], [FilePath])\ngetFilesAndDirs paths =\n  let ...\n  in (dirs, files)\n</code></pre>\n\n<p>Probably this is a hopeless duplicate, I just miss the right keywords.\nWhat is the right way to do (and call) this?</p>\n\n<p>The files and the directories occur randomly.</p>\n"}, {"tags": ["haskell", "template-haskell"], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 1, "last_activity_date": 1513009708, "creation_date": 1513009708, "answer_id": 47757229, "question_id": 47753664, "link": "https://stackoverflow.com/questions/47753664/how-to-call-constructor-from-template-haskell/47757229#47757229", "title": "How to call constructor from Template Haskell", "body": "<p>It depends entirely on how you want to use this expression. You can write e.g. </p>\n\n<pre><code>mkCons :: Name -&gt; Q Exp\nmkCons ty = do\n  TyConI (DataD ctx nm tyVars mbKind cs derivs) &lt;- reify ty\n  let cons = ListE $ map (\\(NormalC c _) -&gt; ConE c) cs\n  [| [c | c &lt;- $(pure cons), c /= specialValue] |]\n</code></pre>\n\n<p>which is a splice whose result is the constructors of <code>ty</code> except <code>specialValue</code>.</p>\n\n<p>But if you want to manipulate the resulting list within the splice (e.g. generate some code for all constructors except <code>specialValue</code>) then the situation is much more complicated. You'll need to have a nested splice which manipulates the result of the above splice:</p>\n\n<pre><code>mkSome :: Name -&gt; Q Exp\nmkSome ty =\n  [| do e1 &lt;- mapM lift $(mkCons ty)\n        let mkD (ConE n) = DataD [] (mkName $ \"Foo\" ++ nameBase n) [] Nothing [] [] -- example function\n        pure $ map mkD e1\n    |]\n</code></pre>\n\n<p>Note also the use of <code>lift</code>; the result of <code>$(mkCons ty)</code> has type <code>[OtherData]</code> (in this case) but <code>lift</code> gives you the TH AST corresponding to those constructors.</p>\n\n<p>Also note that the functions above use the <code>Eq</code>, <code>Lift</code> and <code>MyClass</code> instances of the given type. Due to the stage restriction, you have to define these instances in a seperate module than the use of the splice. So the following won't work:</p>\n\n<pre><code>module A where\n\nimport TH (mkSome)\n\ndata OtherData = A | B | C deriving (Lift, Eq)\ninstance MyClass OtherData where\n  specialValue = C\n\n$( $(mkSome ''OtherData) )\n</code></pre>\n\n<p>You must use it like so:</p>\n\n<pre><code>-- A.hs\nmodule A where\n\ndata OtherData = A | B | C deriving (Lift, Eq)\ninstance MyClass OtherData where\n  specialValue = C\n\n-- B.hs\nmodule B where\n\nimport TH (mkSome)\nimport A\n\n$( $(mkSome ''OtherData) )\n</code></pre>\n\n<p>The result:</p>\n\n<pre><code>    mkSome ''OtherData\n  ======&gt;\n    do { e1_adJ0 &lt;- mapM\n                      lift [c_adJ2 | c_adJ2 &lt;- [A, B, C], (c_adJ2 /= specialValue)];\n         let mkD_adJ1 (ConE n_adJ3)\n               = DataD\n                   [] (mkName $ (\"Foo\" ++ (nameBase n_adJ3))) [] Nothing [] [];\n         (pure $ (map mkD_adJ1 e1_adJ0)) }\n\n\n    (do { e1_adJ0 &lt;- mapM\n                       lift [c_adJ2 | c_adJ2 &lt;- [A, B, C], (c_adJ2 /= specialValue)];\n          let mkD_adJ1 (ConE n_adJ3)\n                = DataD\n                    [] (mkName $ (\"Foo\" ++ (nameBase n_adJ3))) [] Nothing [] [];\n          (pure $ (map mkD_adJ1 e1_adJ0)) })\n  ======&gt;\n    data FooA\n    data FooB\n</code></pre>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 47757229, "answer_count": 1, "score": 1, "last_activity_date": 1513009708, "creation_date": 1512997574, "question_id": 47753664, "link": "https://stackoverflow.com/questions/47753664/how-to-call-constructor-from-template-haskell", "title": "How to call constructor from Template Haskell", "body": "<p>I have function (let's call it <code>mkSome</code>) which constructs some data type with Template Haskell. It has typical signature <code>Name -&gt; Q [Dec]</code>.\nSomewhere in its body I'm extracting constructors of another type with\npattern-matching:</p>\n\n<pre><code>case tyCons of\n  DataD ctx nm tyVars mbKind cs derivs -&gt; ...\n</code></pre>\n\n<p>Type of those constructors <code>cs</code> instantiates some class like this:</p>\n\n<pre><code>class MyClass a where\n  specialValue :: a\n</code></pre>\n\n<p>So, I'm iterating over those <code>cs</code> but I want to skip one of them which is\nequal to <code>specialValue</code>. Something like this:</p>\n\n<pre><code>[c | c &lt;- cs, c /= specialValue]\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>data OtherData = A | B | C\ninstance MyClass OtherData where\n  specialValue = C\n$(mkSome ''OtherData) -- mkSome must skip C-constructor!\n</code></pre>\n\n<p>How to do this in Template Haskell's (with <code>Con</code> type: <code>c</code> is it) ? Sure, I can't simply call constructor to compare created value with a <code>specialValue</code> because it's AST node, not real constructor</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1512975375, "post_id": 47747706, "comment_id": 82455668, "body": "I would just go with &quot;algebraic data type&quot; aka &quot;ADT&quot;"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512981855, "post_id": 47747706, "comment_id": 82458289, "body": "A <i>hetrogenous</i> type?"}], "answers": [{"comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 1, "creation_date": 1512975525, "post_id": 47747782, "comment_id": 82455739, "body": "This is like saying <code>1 + 2 + 2*4</code> is a product. It isn&#39;t. What it (and <code>User</code>) is, is sum of products."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 2, "last_activity_date": 1513009319, "last_edit_date": 1513009319, "creation_date": 1512975287, "answer_id": 47747782, "question_id": 47747706, "link": "https://stackoverflow.com/questions/47747706/is-rgb-int-int-int-transparent-a-sum-or-product-type/47747782#47747782", "title": "Is &quot;RGB Int Int Int | Transparent&quot; a sum or product type?", "body": "<p>The <code>Maybe Int</code> type is a sum type because it has an alternation</p>\n\n<pre><code>data SumType = This | That\n</code></pre>\n\n<p>the fact that it has arguments on its constructors doesn't affect its \"sum-ness.\" Sum types can also contain product constructors, such as:</p>\n\n<pre><code>type Username = String\ntype Email    = String\n-- User is a sum of three products\ndata User = NotLoggedIn                    -- nullary constructor\n          | Guest Username                 -- unary constructor\n          | RegisteredUser Username Email  -- binary constructor\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1513009369, "post_id": 47749294, "comment_id": 82475266, "body": "Re. the last paragraph OP might check out Chris Taylor&#39;s series here: <a href=\"http://chris-taylor.github.io/blog/2013/02/10/the-algebra-of-algebraic-data-types/\" rel=\"nofollow noreferrer\">chris-taylor.github.io/blog/2013/02/10/&hellip;</a>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 12, "last_activity_date": 1512982763, "creation_date": 1512982763, "answer_id": 47749294, "question_id": 47747706, "link": "https://stackoverflow.com/questions/47747706/is-rgb-int-int-int-transparent-a-sum-or-product-type/47749294#47749294", "title": "Is &quot;RGB Int Int Int | Transparent&quot; a sum or product type?", "body": "<p>All <code>data</code> types are \"sums of products\".\nWe sum over the number of constructors, and for each constructor we multiply over the number of arguments.</p>\n\n<p>Sometimes the sum is trivial. When there is a single constructor, or none at all, we sum over a singleton or empty set. Summing over a single constructor makes the resulting type isomorphic to a product. Summing over no constructors makes the type to be empty (e.g. <code>Data.Void.Void</code>).</p>\n\n<p>Sometimes, some of the products are trivial as well. When there is a single argument, or none at all, we multiply over a singleton or empty set. Multiplying over a single argument <code>T</code> simply produces <code>T</code> (after lifting). Multiplying over no arguments produces a type with only one value (e.g. <code>()</code>).</p>\n\n<p>Hence, sometimes our <code>data</code> is a non-trivial sum of trivial products, and we call it a \"sum\"; sometimes it is a trivial sum of non-trivial products, and we call it a \"product\". But, in the general case, it is always a \"sum of products\".</p>\n\n<p>Note that algebraic types (up to isomorphism) form a commutative semiring, satisfying roughly the same laws of high school algebra for sums and products. In high school algebra, we can turn any expression involving nested sums and products into a polynomial, i.e. into a \"sum of products\". This also happens with types (up to isomorphism), hence the choice of making <code>data</code> types to be \"sums of products\" is rather expressive.</p>\n"}], "owner": {"reputation": 6426, "user_id": 3946931, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a45b621c0a6b96ea0996dfd51867c541?s=128&d=identicon&r=PG&f=1", "display_name": "therewillbecode", "link": "https://stackoverflow.com/users/3946931/therewillbecode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "accepted_answer_id": 47749294, "answer_count": 2, "score": 0, "last_activity_date": 1517683404, "creation_date": 1512974885, "last_edit_date": 1517683404, "question_id": 47747706, "link": "https://stackoverflow.com/questions/47747706/is-rgb-int-int-int-transparent-a-sum-or-product-type", "title": "Is &quot;RGB Int Int Int | Transparent&quot; a sum or product type?", "body": "<h3>Sum type</h3>\n\n<p>The <code>Maybe Int</code> type is a sum type.</p>\n\n<pre><code>data Maybe Int = Nothing | Just Int\n</code></pre>\n\n<p>From my understanding, this is due to the fact that the <code>Nothing</code> value constructor takes no arguments and the second value constructor called <code>Just</code> takes only one argument. Therefore, because no value constructor takes more than one argument, this type is a product type.</p>\n\n<h3>Product type</h3>\n\n<p>The type below is a product type since its data constructor takes two arguments and therefore is a product type. </p>\n\n<pre><code>data Colour = Person String Int\n</code></pre>\n\n<p>However, I am not sure how we would classify the following type in the context of the <em>sum and product types</em>. How should we refer to this?</p>\n\n<pre><code>data Shade = RGB Int Int Int | Transparent\n</code></pre>\n"}, {"tags": ["haskell", "lambda"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1512972452, "post_id": 47747184, "comment_id": 82454600, "body": "I would start by adding type signatures to all of your top-level functions. Even if that doesn\u2019t fix the problem, it will almost certainly make your type errors much more comprehensible."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1513011697, "post_id": 47747184, "comment_id": 82476701, "body": "You might enjoy pondering the following definition: <code>foo = (\\x -&gt; x+v1, \\x -&gt; x++v2) where v1 = 3*x; v2 = &quot;hello, &quot; ++ x</code>. Which <code>x</code> (if any) should be in scope in that <code>where</code> clause? What type should it have? (For the purposes of this question, the interesting nugget in the question remains even if you reduce the complexity by saying that all numeric literals are <code>Integer</code> so we don&#39;t have any oddities with Haskell&#39;s <code>Num</code> hierarchy.)"}], "answers": [{"comments": [{"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "edited": false, "score": 0, "creation_date": 1512983812, "post_id": 47749170, "comment_id": 82459311, "body": "I want composer to return a lambda that composes f and g. That&#39;s my intention"}, {"owner": {"reputation": 307, "user_id": 5739278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29179e06448ab37f9d4bc759cfd16f34?s=128&d=identicon&r=PG&f=1", "display_name": "mbw", "link": "https://stackoverflow.com/users/5739278/mbw"}, "reply_to_user": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "edited": false, "score": 0, "creation_date": 1512984408, "post_id": 47749170, "comment_id": 82459650, "body": "Like I said, this is what this version already does. The function arrow associates to the right, so any function of type <code>a -&gt; b -&gt; c -&gt; d</code> can alternatively be read as <code>a -&gt; (b -&gt; (c -&gt; d))</code>. So you can get your function like <code>let myLambda = composeV2 f g</code>."}], "tags": [], "owner": {"reputation": 307, "user_id": 5739278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29179e06448ab37f9d4bc759cfd16f34?s=128&d=identicon&r=PG&f=1", "display_name": "mbw", "link": "https://stackoverflow.com/users/5739278/mbw"}, "is_accepted": true, "score": 0, "last_activity_date": 1512985898, "last_edit_date": 1512985898, "creation_date": 1512982240, "answer_id": 47749170, "question_id": 47747184, "link": "https://stackoverflow.com/questions/47747184/haskell-lambda-function-error-escape-their-scope/47749170#47749170", "title": "Haskell: Lambda function - error - escape their scope", "body": "<p><code>composerV2</code> type-checks for me if I don't write the <code>x</code> on the left-hand side:</p>\n\n<pre><code>composerV2 f g x =\n     (c, b ++ \", \" ++ d) where (a,b) = f x\n                               (c,d) = g a\n</code></pre>\n\n<p>The problem is that in the <code>where</code> clause, the identifier <code>x</code> wasn't actually in scope. The error message is kind of confusing, but becomes precise if you add a type signature, which is good practice anyway.</p>\n\n<p>Alternatively, you could have used a <code>let</code> binding.</p>\n\n<p>Note that <code>composerV2 f g = let ... in \\x -&gt; ...</code> and <code>composerV2 f g x = ...</code> are semantically the same, since you can just partially apply the second version.</p>\n\n<p>Edit: The version using a <code>let</code> binding looks like this:</p>\n\n<pre><code>composerV2' f g = \\x -&gt;\n  let (a,b) = f x\n      (c,d) = g a\n  in (c, b ++ \", \" ++ d)\n</code></pre>\n"}], "owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 47749170, "answer_count": 1, "score": 3, "last_activity_date": 1512985898, "creation_date": 1512971760, "last_edit_date": 1512984091, "question_id": 47747184, "link": "https://stackoverflow.com/questions/47747184/haskell-lambda-function-error-escape-their-scope", "title": "Haskell: Lambda function - error - escape their scope", "body": "<p>I have the following module defined:</p>\n\n<pre><code>module ComplexCompose where\n\nisEven x =\n if x `rem` 2 == 0 then\n  (True, \"Is Even\")\n else\n  (False, \"Is Odd\")\n\n\nnegateIt x = ( not x, \"negated\")\n\n\n\ncomposer x =\n (c, b ++ \", \" ++ d) where (a,b) = isEven x\n                           (c,d) = negateIt a\n</code></pre>\n\n<p>The following modification to composer works fine:</p>\n\n<pre><code>composerV1 x f g =\n (c, b ++ \", \" ++ d) where (a,b) = f x\n                           (c,d) = g a\n</code></pre>\n\n<p>I want to make the composer function return a lamda that composes f and g. I tried this:</p>\n\n<pre><code>composerV2 f g =\n     \\x -&gt; (c, b ++ \", \" ++ d) where (a,b) = f x\n                                     (c,d) = g a\n</code></pre>\n\n<p>It doesn't work. What is the problem with this version?</p>\n\n<p>Compiler output:</p>\n\n<pre><code> \u2022 Couldn't match expected type \u2018t0 -&gt; (t5, t4)\u2019\n                  with actual type \u2018t3\u2019\n        because type variables \u2018t4\u2019, \u2018t5\u2019 would escape their scope\n      These (rigid, skolem) type variables are bound by\n        the inferred type of\n        a :: t5\n        b :: t4\n        at complex-compose.hs:27:34-44\n    \u2022 In the expression: f x\n      In a pattern binding: (a, b) = f x\n      In an equation for \u2018c4\u2019:\n          c4 f g\n            = \\ x -&gt; (c, b ++ \", \" ++ d)\n            where\n                (a, b) = f x\n                (c, d) = g a\n    \u2022 Relevant bindings include\n        a :: t5 (bound at complex-compose.hs:27:35)\n        b :: t4 (bound at complex-compose.hs:27:37)\n        f :: t3 (bound at complex-compose.hs:26:4)\n        c4 :: t3 -&gt; (t2 -&gt; (t1, [Char])) -&gt; t -&gt; (t1, [Char])\n          (bound at complex-compose.hs:26:1)\n</code></pre>\n\n<p>Btw, the following simple function works:</p>\n\n<p>fn f g =\n     \\x = g(f x)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512984258, "post_id": 47746127, "comment_id": 82459564, "body": "I think the example should read <code>..., Just 2, Just 5, Nothing, Just 4</code>."}], "answers": [{"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 3, "last_activity_date": 1512965566, "creation_date": 1512965566, "answer_id": 47746332, "question_id": 47746127, "link": "https://stackoverflow.com/questions/47746127/haskell-pattern-matching-list-of-chars-to-ints/47746332#47746332", "title": "Haskell pattern matching list of chars to Ints", "body": "<blockquote>\n  <p>Anyways, the error I get when i execute the code is:</p>\n  \n  <blockquote>\n    <p>Couldn't match the type '[Char]' with 'Int' Expected type: [Maybe Int]\n    Actual type: [Maybe [Char]]</p>\n  </blockquote>\n</blockquote>\n\n<p>This is a type error, from the compiler (in particular from the type-checker). This runs early in the compilation process, i.e. way before execution.</p>\n\n<p>The first problem is I think you're not sure what your input is supposed to be. You give the sample input as:</p>\n\n<blockquote>\n  <p>example = [\"3..25.4\"]</p>\n</blockquote>\n\n<p>This is a list with <em>a single string element</em>, and it has type <code>[String]</code> (or equivalently <code>[[Char]]</code>, since <code>String</code> is a synonym for <code>[Char]</code>). It seems to me that you probably want the type of <code>yb</code> to be:</p>\n\n<blockquote>\n  <p>yb :: [Char] -> [Maybe Int]</p>\n</blockquote>\n\n<p>and to take inputs like <code>\"3..25.4\" :: [Char]</code></p>\n\n<p>I think you'll be able to solve it from here. If you have trouble understanding the type errors you'll get, google or other SO questions can be helpful.</p>\n\n<p>One last thing: you are writing function calls in the style of the <code>C</code> tradition, but that's not how they work in haskell; you should write just <code>yb xs</code> not <code>yb(xs)</code>. Likewise if a function gets three arguments it's called like <code>f x y z</code>.</p>\n\n<p>All of these are equivalent:</p>\n\n<pre><code>yb xs\nyb(xs)\nyb (xs)\nyb ((xs)) -- all of these parens are redundant\n</code></pre>\n\n<p>Also of interest, if <code>yb</code> took three arguments then all of these would be equivalent:</p>\n\n<pre><code>yb x y z\n(yb x) y z\n(yb x y) z\n((yb x ) y ) z\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 2, "last_activity_date": 1512966283, "creation_date": 1512966283, "answer_id": 47746408, "question_id": 47746127, "link": "https://stackoverflow.com/questions/47746127/haskell-pattern-matching-list-of-chars-to-ints/47746408#47746408", "title": "Haskell pattern matching list of chars to Ints", "body": "<p>The nice thing about your code is that it's working in <code>map</code>'s wheelhouse, that is:</p>\n\n<pre><code>input  :: [a]\noutput :: [b] -- where each b matches an a\n</code></pre>\n\n<p>Remember that <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code>, so you'll just have to write a function <code>a -&gt; b</code>, which in this case is <code>[Char] -&gt; [Maybe Int]</code>. Wait a second -- isn't that another instance of <code>[a] -&gt; [b]</code>??!</p>\n\n<pre><code>map . map :: (a -&gt; b) -&gt; [[a]] -&gt; [[b]]\n</code></pre>\n\n<p>the function in this case is then <code>Char -&gt; Maybe Int</code>.</p>\n\n<pre><code>import Data.Char (digitToInt)\n\nf :: Char -&gt; Maybe Int\nf '.' = Nothing\nf x   = Just . digitToInt $ x\n</code></pre>\n\n<p>(or you can implement <code>digitToInt</code> yourself).</p>\n\n<p>Your code then operates <code>[[Char]] -&gt; Maybe Int</code>, which is <code>(map . map) f example</code></p>\n"}, {"tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": false, "score": 1, "last_activity_date": 1512974714, "last_edit_date": 1512974714, "creation_date": 1512966546, "answer_id": 47746439, "question_id": 47746127, "link": "https://stackoverflow.com/questions/47746127/haskell-pattern-matching-list-of-chars-to-ints/47746439#47746439", "title": "Haskell pattern matching list of chars to Ints", "body": "<p>Since the type of your list is <code>[[Char]]</code>, when you pattern match <code>(x:xs)</code>, your looking at each <code>[Char]</code> in the list, not each <code>Char</code>. So when you check <code>x == \".\"</code>, your checking if <code>\".\" == \"3..25.4\"</code>, which is not what you want. </p>\n\n<p>Additionally, if your constructing a list of <code>[Maybe Int]</code>, you need to convert the strings to integers first, before applying <code>Just x</code>. Otherwise, you'd be applying <code>Just Char</code>, which is not the right data type. This can be done with <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Char.html#v:digitToInt\" rel=\"nofollow noreferrer\"><code>digitToInt</code></a> from <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Char.html\" rel=\"nofollow noreferrer\"><code>Data.Char</code></a>. </p>\n\n<p>I would suggest making a function that converts a <code>[Char]</code> to a <code>[Maybe Int]</code>:</p>\n\n<pre><code>import Data.Char\n\none_string :: [Char] -&gt; [Maybe Int]\none_string [] = []\none_string (x:xs) \n    | x == '.' = Nothing : one_string xs\n    | otherwise = Just (digitToInt x) : one_string xs\n</code></pre>\n\n<p>Which works like this:</p>\n\n<pre><code>*Main&gt; one_string \"3..25.4\"\n[Just 3,Nothing,Nothing,Just 2,Just 5,Nothing,Just 4]\n</code></pre>\n\n<p>Then you could apply this function on every <code>[Char]</code> within your list:</p>\n\n<pre><code>yb :: [[Char]] -&gt; [[Maybe Int]]\nyb [] = []\nyb (x:xs) = one_string x : yb xs\n</code></pre>\n\n<p>Which outputs:</p>\n\n<pre><code>*Main&gt; yb [\"3..25.4\", \"43..32\"]\n[[Just 3,Nothing,Nothing,Just 2,Just 5,Nothing,Just 4],[Just 4,Just 3,Nothing,Nothing,Just 3,Just 2]]\n</code></pre>\n\n<p><strong>Note:</strong> The only difference here is that this returns a <code>[[Maybe Int]]</code> data type, which makes sense if you have multiple strings in your list. I also kept the above code as simple as possible, their are higher order functions you can use, as other answers have shown. </p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>You could also use <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:map\" rel=\"nofollow noreferrer\"><code>map</code></a>:</p>\n\n<pre><code>yb :: [[Char]] -&gt; [[Maybe Int]]\nyb lst = map one_string lst\n    where one_string [] = []\n          one_string (x:xs)\n            | x == '.' = Nothing : one_string xs\n            | otherwise = Just (digitToInt x) : one_string xs\n</code></pre>\n\n<p>or something more concise:</p>\n\n<pre><code>yb :: [[Char]] -&gt; [[Maybe Int]]\nyb = (map . map) (\\x -&gt; if x == '.' then Nothing else Just (digitToInt x))\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9052196, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-6pgwtQHMzoY/AAAAAAAAAAI/AAAAAAAAABo/1yjZFltHk1Q/photo.jpg?sz=128", "display_name": "Brandon Ajax", "link": "https://stackoverflow.com/users/9052196/brandon-ajax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 465, "favorite_count": 0, "answer_count": 3, "score": -2, "last_activity_date": 1512974714, "creation_date": 1512963772, "question_id": 47746127, "link": "https://stackoverflow.com/questions/47746127/haskell-pattern-matching-list-of-chars-to-ints", "title": "Haskell pattern matching list of chars to Ints", "body": "<p>I'm fairly new to Haskell. I'm looking to convert a list of Chars into Maybe Ints</p>\n\n<p>Suppose I have a single list </p>\n\n<pre><code>example = [\"3..25.4\"]\n</code></pre>\n\n<p>and I want to convert this list into Maybe Ints in the format:</p>\n\n<pre><code>[Just 3, Nothing, Nothing, Just 2, Just 5, Just 4]\n</code></pre>\n\n<p>where a full stop (.) is replaced with Nothing and n is replaced with Just n</p>\n\n<p>This is my code so far:</p>\n\n<pre><code>yb :: [[Char]] -&gt; [Maybe Int]\nyb [[]] = []\nyb (x:xs) = if x == '.' then Nothing:yb(xs) else Just x:yb(xs)\n</code></pre>\n\n<p>Not fully sure what to do next / what's wrong, although I'm aware that even if my code functioned that the order would be reversed, so that's another issue</p>\n\n<p>Anyways, the error I get when i execute the code is:</p>\n\n<pre><code>Couldn't match the type '[Char]' with 'Int'\nExpected type: [Maybe Int]    Actual type: [Maybe [Char]]\n</code></pre>\n"}, {"tags": ["haskell", "yesod", "shakespeare-text"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 1948914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uspHG.jpg?s=128&g=1", "display_name": "Yunis", "link": "https://stackoverflow.com/users/1948914/yunis"}, "edited": false, "score": 0, "creation_date": 1513007868, "post_id": 47749795, "comment_id": 82474331, "body": "thank you for that @Sibi Its not quite the solution i was hoping for but i can work with it :)"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 3, "last_activity_date": 1512984618, "creation_date": 1512984618, "answer_id": 47749795, "question_id": 47745784, "link": "https://stackoverflow.com/questions/47745784/can-you-load-a-widget-with-parameters-in-a-hamlet-file-in-yesod/47749795#47749795", "title": "can you load a widget with parameters in a hamlet file in yesod?", "body": "<p>Note that Hamlet template can embed only hamlet template. If you want to embed a widget, use <code>whamlet</code>.</p>\n\n<p>Also, yes - you can pass parameters to a widget. An example stack script demonstrating the concept:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack\n     --resolver lts-9.0\n     --install-ghc\n     runghc\n     --package yesod-core\n     --package yesod\n     --package shakespeare\n-}\n\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes       #-}\n{-# LANGUAGE TemplateHaskell   #-}\n{-# LANGUAGE TypeFamilies      #-}\nimport           Yesod\n\ndata App = App\nmkYesod \"App\" [parseRoutes|\n/ HomeR GET\n|]\n\ninstance Yesod App\n\ndata Person = Person { id :: Int, name :: String, email :: String } deriving (Show, Eq, Ord)\n\ncollections = [Person 1 \"Sibi\" \"sibi@domain.com\", Person 2 \"Michael\" \"michael@domain.com\"]\n\n\nwhamlet1 :: Widget\nwhamlet1 = [whamlet| &lt;p&gt;hello\n                   $forall Person _ pname pemail &lt;- collections\n                     ^{whamlet2 pname pemail}\n           |]\n\nwhamlet2 :: String -&gt; String -&gt; Widget\nwhamlet2 pname pemail = [whamlet| &lt;h1&gt; #{pname} #{pemail} |]\n\ngetHomeR = defaultLayout $ do\n    setTitle \"My Page Title\"\n    toWidget [lucius| h1 { color: green; } |]\n    whamlet1\n\nmain = warp 3000 App\n</code></pre>\n\n<p>The <a href=\"https://www.yesodweb.com/book/widgets\" rel=\"nofollow noreferrer\">widgets chapter</a> on Yesod book explains them more deeply.</p>\n"}], "owner": {"reputation": 23, "user_id": 1948914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uspHG.jpg?s=128&g=1", "display_name": "Yunis", "link": "https://stackoverflow.com/users/1948914/yunis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1513106574, "creation_date": 1512960493, "last_edit_date": 1513106574, "question_id": 47745784, "link": "https://stackoverflow.com/questions/47745784/can-you-load-a-widget-with-parameters-in-a-hamlet-file-in-yesod", "title": "can you load a widget with parameters in a hamlet file in yesod?", "body": "<p>what is the best way to load html from a widget if your looping through a data set?</p>\n\n<p>i.e. in a hamlet file </p>\n\n<pre><code>$forall Entity id val &lt;- collection\n    ^{myWidget (p1 val) (p2 val)}\n</code></pre>\n"}, {"tags": ["haskell", "tree"], "comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1512988588, "post_id": 47745674, "comment_id": 82462126, "body": "Try writing a function <code>buildTree&#39; :: [Char] -&gt; (Tree Char, [Char])</code>, which builds a tree from the given preorder and also returns the remainder, i.e <code>buildTree&#39; &quot;AB&quot; == (Branch &#39;A&#39; Empty Empty, &quot;B&quot;)</code>. Then you can build the left subtree from <code>xs</code> and the right subtree from the remainder of <code>buildTree xs</code>."}], "owner": {"reputation": 21, "user_id": 9081642, "user_type": "registered", "profile_image": "https://graph.facebook.com/10156929411429922/picture?type=large", "display_name": "Aaron Jay Rothman", "link": "https://stackoverflow.com/users/9081642/aaron-jay-rothman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 127, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1512959731, "creation_date": 1512959403, "last_edit_date": 1512959731, "question_id": 47745674, "link": "https://stackoverflow.com/questions/47745674/creating-a-binary-tree-from-a-list-of-a-preorder-traversal-with-known-internal-n", "title": "Creating a Binary Tree from a list of a preorder traversal with known Internal nodes in Haskell", "body": "<p>\nI am attempting to reconstruct a Binary Tree from a given Preorder where all internal nodes have the value  * .  No external nodes have the value *.</p>\n\n<p>The Preorder given in the test case is * * B * * DECA</p>\n\n<p>\n\n<pre><code>    data Tree a = Empty | Branch a (Tree a) (Tree a) deriving (Show)\n\n    buildTree :: [Char] -&gt; Tree Char  \n    buildTree [] = Empty\n    buildTree [x] = Branch x Empty Empty\n    buildTree (x:xs) = Branch x (buildTree (takeWhile (=='*') xs)) (buildTree (snd(splitAt(length(takeWhile(=='*') xs))xs)))\n</code></pre>\n\n<p>\nI expect a tree that has the same structure as the input.\n\nI get what appears to be the correct tree, but the inorder is wrong.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1512950769, "post_id": 47744504, "comment_id": 82449728, "body": "Types are not represented at runtime. Is this specifically about <code>Cofree</code> vs specific implementations? Because <code>Cofree</code> is well-known to be non-performant."}, {"owner": {"reputation": 123, "user_id": 3958330, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e45ef50d43d5a4fbfdf35a6f3178e12?s=128&d=identicon&r=PG", "display_name": "Matthew Leon", "link": "https://stackoverflow.com/users/3958330/matthew-leon"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1512955744, "post_id": 47744504, "comment_id": 82450687, "body": "@AJFarmar do you have any links that explain why <code>Cofree</code> has poor performance, then?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1512981607, "post_id": 47744504, "comment_id": 82458178, "body": "Somewhat: <a href=\"https://markkarpov.com/post/free-monad-considered-harmful.html\" rel=\"nofollow noreferrer\">markkarpov.com/post/free-monad-considered-harmful.html</a>"}], "answers": [{"tags": [], "owner": {"reputation": 307, "user_id": 5739278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29179e06448ab37f9d4bc759cfd16f34?s=128&d=identicon&r=PG&f=1", "display_name": "mbw", "link": "https://stackoverflow.com/users/5739278/mbw"}, "is_accepted": false, "score": 1, "last_activity_date": 1512984250, "creation_date": 1512984250, "answer_id": 47749689, "question_id": 47744504, "link": "https://stackoverflow.com/questions/47744504/ghc-performance-implications-of-parametric-types/47749689#47749689", "title": "GHC performance implications of parametric types", "body": "<p>I think a more classic concrete example would be something like vectors or arrays. The <a href=\"https://www.stackage.org/lts-9.17/package/vector-0.12.0.1\" rel=\"nofollow noreferrer\">vector package</a> exports both \"boxed\" and \"unboxed\" vectors. While boxed vectors can contain any Haskell type (including functions), unboxed vectors requires its elements to be an instance of the <code>Unbox</code> type class. Although this implies a more efficient packed memory representation without pointer indirections, you can't define a <code>Functor</code> instance for unboxed vectors anymore, so it comes with a loss of generality.</p>\n\n<p>If you made use of</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; Vector a -&gt; Vector b\n</code></pre>\n\n<p>in a function of type</p>\n\n<pre><code>f :: Functor f =&gt; f SomeType -&gt; f SomeOtherType\n</code></pre>\n\n<p>a \"Dictionary\", that is, a record with the corresponding <code>fmap</code> implementation will be passed at run-time as an additional implicit argument. You can actually see this by looking at the \"Core\" output produced by GHC, using the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/debugging.html#dumping-out-compiler-intermediate-structures\" rel=\"nofollow noreferrer\"><code>-ddump-simpl</code></a> flag. Specifically, the arity of <code>f</code> above would be two instead of one.</p>\n\n<p>In some cases, GHC can optimize this overhead away by creating specialized versions of your functions. You can help out via using <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#pragmas\" rel=\"nofollow noreferrer\">SPECIALIZE/INLINABLE/...</a> pragmas, using explicit export lists, maybe adding some strictness, and a few other tweaks which are also described <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/sooner.html#faster-producing-a-program-that-runs-quicker\" rel=\"nofollow noreferrer\">in the documentation</a>.</p>\n\n<p>Regarding the overhead of using parametrically polymorphic types, it of course depends. My personal worst case was a factor 100 in an inner numeric loop (which was resolved by adding one SPECIALIZE pragma), so it <em>can</em> indeed bite you. Luckily, using the profiling tools and remembering that dictionaries influence a function's arity, tracking these issues down becomes very systematic.</p>\n"}], "owner": {"reputation": 123, "user_id": 3958330, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e45ef50d43d5a4fbfdf35a6f3178e12?s=128&d=identicon&r=PG", "display_name": "Matthew Leon", "link": "https://stackoverflow.com/users/3958330/matthew-leon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1512984250, "creation_date": 1512947839, "question_id": 47744504, "link": "https://stackoverflow.com/questions/47744504/ghc-performance-implications-of-parametric-types", "title": "GHC performance implications of parametric types", "body": "<p>I'll motivate the general question with a more specific one:</p>\n\n<p>In GHC Haskell, should a <code>Cofree [] a</code> have the same performance as a <code>containers</code>-style <code>Data.Tree a</code>? Or does the additional polymorphism result in some kind of runtime cost?</p>\n\n<p>Generally speaking, is there additional runtime cost associated with increasing \"arity\" of a type's kind?</p>\n"}, {"tags": ["haskell", "typing"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1512940754, "post_id": 47743563, "comment_id": 82447238, "body": "What should happen in case somebody enters something invalid?"}, {"owner": {"reputation": 143, "user_id": 8303951, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6cd7cd0fc6bf782e041f0f641f3cf29a?s=128&d=identicon&r=PG&f=1", "display_name": "Joao Albuquerque", "link": "https://stackoverflow.com/users/8303951/joao-albuquerque"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512940867, "post_id": 47743563, "comment_id": 82447280, "body": "One exception message, and repeating the getLine."}, {"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 1, "creation_date": 1512941841, "post_id": 47743563, "comment_id": 82447565, "body": "Make a function which wraps getLine, and validates the input with something like <code>isLetter</code> from <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Char.html#v:isLetter\" rel=\"nofollow noreferrer\">Data.Char</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1513020040, "post_id": 47743563, "comment_id": 82480987, "body": "I know this isn&#39;t the point, but in any real application you should be very careful about the restrictions you put on names. Whatever &quot;all names should&quot; rule you come up with is pretty likely to be violated by some actual person&#39;s name."}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 8303951, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6cd7cd0fc6bf782e041f0f641f3cf29a?s=128&d=identicon&r=PG&f=1", "display_name": "Joao Albuquerque", "link": "https://stackoverflow.com/users/8303951/joao-albuquerque"}, "edited": false, "score": 0, "creation_date": 1512943096, "post_id": 47743745, "comment_id": 82447906, "body": "Nice! Thx. How can I use this example to only allow letters?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 143, "user_id": 8303951, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6cd7cd0fc6bf782e041f0f641f3cf29a?s=128&d=identicon&r=PG&f=1", "display_name": "Joao Albuquerque", "link": "https://stackoverflow.com/users/8303951/joao-albuquerque"}, "edited": false, "score": 2, "creation_date": 1512943877, "post_id": 47743745, "comment_id": 82448112, "body": "@JoaoAlbuquerque modify the loop. Also, <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">hoogle</a> <code>all</code> and <code>isLetter</code>."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 5, "last_activity_date": 1512942078, "creation_date": 1512942078, "answer_id": 47743745, "question_id": 47743563, "link": "https://stackoverflow.com/questions/47743563/how-to-allow-only-one-type-in-haskell-getline/47743745#47743745", "title": "How to allow only one type in Haskell getLine", "body": "<p>From the <code>Read</code> class source:</p>\n\n<pre><code>class Read a where\n  readsPrec :: Int -&gt; ReadS a\n  -- (...)\n</code></pre>\n\n<p>What's this <code>ReadS</code>? From <a href=\"https://www.haskell.org/hoogle/?hoogle=readS\" rel=\"noreferrer\">hoogle</a>:</p>\n\n<pre><code>type ReadS a = String -&gt; [(a, String)]\n</code></pre>\n\n<p>This allows us to write reads that can fail:</p>\n\n<pre><code>maybeRead :: Read a =&gt; String -&gt; Maybe a\nmaybeRead str = case readsPrec 0 str of\n    [(a, \"\")] -&gt; Just a\n--    ^   ^---- no remaining input string\n--    |- output\n    _         -&gt; Nothing\n</code></pre>\n\n<p>It's then a simple case of modifying your IO. Here's a quick dirty example:</p>\n\n<pre><code>main = do\n  putStrLn \"Enter an integer:\"\n\n  let loop = do\n        str &lt;- getLine\n        maybe loop return (maybeRead str :: Maybe Int)\n\n  num &lt;- loop\n  print $ num + 1\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 8303951, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6cd7cd0fc6bf782e041f0f641f3cf29a?s=128&d=identicon&r=PG&f=1", "display_name": "Joao Albuquerque", "link": "https://stackoverflow.com/users/8303951/joao-albuquerque"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 1, "accepted_answer_id": 47743745, "answer_count": 1, "score": 1, "last_activity_date": 1512942078, "creation_date": 1512940718, "question_id": 47743563, "link": "https://stackoverflow.com/questions/47743563/how-to-allow-only-one-type-in-haskell-getline", "title": "How to allow only one type in Haskell getLine", "body": "<p>I have this code that adds a person to my txt. But in the name, for example, I want to allow only letters. As well as in age, I just want to allow numbers</p>\n\n<pre><code>add = do\n    putStrLn \"Name:\"\n    name &lt;- getLine\n    putStrLn \"Age:\"\n    age &lt;- getLine\n    let new =  (name ++ \" \"++ idade ++ \"\\n\")\n    appendFile \"funcionarios.txt\" new\n    putStrLn \"Success!\"\n</code></pre>\n"}, {"tags": ["haskell", "parallel-processing", "parallelism-amdahl"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1512943420, "post_id": 47743094, "comment_id": 82447990, "body": "I think this is a sort of black art, where one can initially make only an educated guess, knowing that, at the end, only careful profiling can provide a satisfactory answer."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1512946159, "post_id": 47743094, "comment_id": 82448714, "body": "It <i>is</i> still a bit of a black art. The good thing is that there&#39;s a substantial \u201cwiggle room\u201d around the optimal number of sparks, where you&#39;ll still get very good performance. A handful of sparks too many will not usually make much of a difference. What&#39;s more challenging is to ensure that the sparks actually do what you intended, and not fizzle / hand back lazy thunks with the most important work yet to be done. Also, memory issues often get in the way of ideal parallel scaling."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1512963947, "post_id": 47743094, "comment_id": 82452384, "body": "If this were a question about <code>forkIO</code> I would be able to give an answer (something like &quot;your computation should take &gt; 5 us to experience parallelism&quot;). The answer for sparks should  some amount smaller than that, but this is all made pretty complicated by the runtime&#39;s scheduling interval, see here <a href=\"https://stackoverflow.com/questions/46586941/why-are-ghc-sparks-fizzling\" title=\"why are ghc sparks fizzling\">stackoverflow.com/questions/46586941/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "edited": false, "score": 0, "creation_date": 1512984284, "post_id": 47744799, "comment_id": 82459582, "body": "Thanks, but what was the point of opening with an apology? Seems natural to expect someone to want an answer based on facts..."}], "tags": [], "owner": {"reputation": 1, "user_id": 3666197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79fc6c23061326c7e6a6f82a1663634b?s=128&d=identicon&r=PG", "display_name": "user3666197", "link": "https://stackoverflow.com/users/3666197/user3666197"}, "is_accepted": true, "score": 0, "last_activity_date": 1526634942, "last_edit_date": 1526634942, "creation_date": 1512950366, "answer_id": 47744799, "question_id": 47743094, "link": "https://stackoverflow.com/questions/47743094/how-non-trivial-should-a-computation-be-to-make-it-reasonable-to-get-it-sparked/47744799#47744799", "title": "How non-trivial should a computation be to make it reasonable to get it sparked for a parallel execution in Haskell?", "body": "<h2>This subject is facts, not opinions based.</h2>\n\n<p>Please take <a href=\"https://stackoverflow.com/a/46603680\">notice of a few facts on the actual overhead costs</a> before reading:</p>\n\n<blockquote>\n  <p><sub>\".. creating spark <strong>doesn't</strong> immediately wakeup idle capability, see <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Scheduler#Sparksandtheparoperator\" rel=\"nofollow noreferrer\">here</a>. By default scheduling interval is 20ms, so when you create a spark, <strong>it will take up to 20 ms to turn it to a real thread.</strong> By that time the calling thread most likely will already evaluate the thunk, and the spark will be either GC'd or fizzled.</p>\n  \n  <p>By contrast, <code>forkIO</code> will immediately wakeup idle capability if any. That is why explicit concurrency is more reliable then parallel strategies.\"</sub></p>\n</blockquote>\n\n<p>So, remember to add +20 ms and/or the benchmarked costs of <code>forkIO</code>-spawned functional block, to the below cited add-on overheads in the realistically achievable cost/benefit ( speedup ) formulae.</p>\n\n<hr>\n\n<h2>This problem has been solved by Dr. Gene AMDAHL many decades ago</h2>\n\n<p>A bit more recent generations of C/S students or practitioners just seem that have somehow forgotten the elementary process-scheduling logic ( i.e. the rules, not art, of proper organising the flow of code-execution over the system's restricted physical resources ).</p>\n\n<p>Though a fair objection may and will come from the nature of the functional languages, where lambda-calculus can and often does harnesses a space, otherwise hidden for imperative languages, for going into a smart, fine-grain, parallelism, derived right from the laws of lambda- or pi- calculi.</p>\n\n<p>Yet the core message holds and is here, for more than 60 years.</p>\n\n<hr>\n\n<h2>A piece of quantitative, fair, records-of-evidence based rationale on this is well enough:<sub> ( no magic, no hidden Art of whatever nature )</sub></h2>\n\n<p>Please, first try to do one's own best to first fully understand both the <a href=\"https://stackoverflow.com/revisions/18374629/3\">original formulation of the <strong>Amdahl's Law, plus</strong> kindly also revise the <strong>recent criticism</strong></a> and overhead-strict, resources-aware re-formulation of the original, generally valid, universal system-scheduling law.</p>\n\n<p>Additions, in the [ <strong>Criticism</strong> ]  section, were meant exactly to match what actually happens, when someone comes to a piece of code with an idea to \"re-organise\" the computing graph and enter into the process-flow some either \"just\"-<a href=\"https://stackoverflow.com/tags/parallel-processing/info\"><strong><code>[CONCURRENT]</code></strong></a> or true-<a href=\"https://stackoverflow.com/tags/parallel-processing/info\"><strong><code>[PARALLEL]</code></strong></a> computing syntax-constructors ( whatever the actual code-execution tools are ).</p>\n\n<hr>\n\n<h2>Having got the <a href=\"https://stackoverflow.com/revisions/18374629/3\">overhead-strict Amdahl's Law theory</a>, let's measure:</h2>\n\n<p>This part is easy and systematic: my students often rant, but going forward, each of them collects a set of hands on experience, what it actually takes ( in costs ) to go into any form of a promise to use a parallelised code-execution.</p>\n\n<p><strong>1 )</strong> create a NOP-function - a function, that indeed does nothing, except of being run ( without an obligation to pass any, the less any remarkable in volume, arguments, without trying to allocate any single bit of memory during its ( empty )-code-execution and without returning any value \"back\" ). This is an idealised NOP-function payload, to let it being spawned / sparked / distributed into parallelism-tool of choice driven execution.</p>\n\n<p>Having the NOP-fun ready, lets benchmark the pure-overhead of such NOP-fun code-execution in multiple instances and measure the time it took.</p>\n\n<p>Being sure all such instances were doing indeed nothing \"there\", the lump sum of time spent between the two time-lines were -- hoooray -- the pure overhead cost of going parallelised and process re-collection overhead cost.</p>\n\n<p>So simple, so easy.</p>\n\n<p>Different tool differ in how much costs a user-programme will accrue, but both the metric and the methodology is crystal-clear.</p>\n\n<pre><code> CuT_start &lt;- liftIO $ getCurrentTime  -- a Code_Under_Test___START\n                                       -- I use a ZeroMQ Stopwatch() instance\n                                       -- having a better than [us] resolution\n                                       -- but haven't found it in Haskell binding\n --CuT_TIMING_CRITICAL_SECTION_/\\/\\/\\/\\/\\/\\\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\\n &lt;_CuT_a_Code_syntax-constructor_Under_Test_&gt;\n --CuT_TIMING_CRITICAL_SECTION_/\\/\\/\\/\\/\\/\\\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\\n\n CuT_end &lt;- liftIO $ getCurrentTime    -- a Code_Under_Test___END\n\n liftIO $ print ( diffUTCTime CuT_end CuT_start )\n</code></pre>\n\n<p><strong>2 )</strong> having registered a net cost of spawning / sparking the intended amount of jobs, one may forward with:<br>\n  - adding \"remote\" memory allocations ( literally till the swapping kills the O/S )<br>\n  - adding \"remote\" CPU-bound processing ( again, as far as one smells the fatigue of the O/S kernel's scheduling efforts to create some yet feasible hardware-threads mapping )<br>\n  - adding \"remote\" process testing as per the call-interface scaling ( volume of data with a need to pass from caller to callee ) dependencies<br>\n  - adding \"remote\" process return value(s)<br>\n  - adding \"remote\" process needs to access some shared resource  </p>\n\n<hr>\n\n<h2>The final decision Go - No Go :</h2>\n\n<p>All these, above collected and recorded add-on costs, just increase the real-world code overhead costs, that have to be entered into the recent, <a href=\"https://stackoverflow.com/revisions/18374629/3\"><strong>re-formulated Amdahl's Law</strong></a>.</p>\n\n<p><strong>If and only if</strong><br>\nthe overhead-strict, resources-aware <strong>speedup</strong> result is <strong>>> 1.00</strong> it makes sense to go into parallelised code-execution</p>\n\n<p><strong>In all cases, where</strong><br>\nthe \"<strong><em>improved</em></strong>\" speedup is actually <strong>&lt;= 1.00</strong> it would be indeed a very bad idea to pay more than one receives from such an <em>\"improvement\"</em></p>\n\n<p>( A reversed formulation is always possible -- derive a minimum amount of processing, that will at least justify the above systematically benchmarked costs of using a respective type of a parallelised-code syntax-constructor )</p>\n\n<p>Q.E.D.</p>\n"}], "owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 1, "closed_date": 1512984315, "accepted_answer_id": 47744799, "answer_count": 1, "score": 3, "last_activity_date": 1526634942, "creation_date": 1512937510, "last_edit_date": 1512951159, "question_id": 47743094, "link": "https://stackoverflow.com/questions/47743094/how-non-trivial-should-a-computation-be-to-make-it-reasonable-to-get-it-sparked", "closed_reason": "Duplicate", "title": "How non-trivial should a computation be to make it reasonable to get it sparked for a parallel execution in Haskell?", "body": "<p>According to the <a href=\"https://hackage.haskell.org/package/parallel-3.2.1.1/docs/Control-Parallel.html\" rel=\"nofollow noreferrer\">doumentation for <strong><code>Control.Parallel</code></strong></a>, one should make sure that the computation being sparked is non-trivial so that creating the spark is cheaper than the computation itself.</p>\n\n<p>This makes sense, but after listening to Bartosz Milewski talk about how cheap sparks are, I'm wondering how experienced Haskell programmers determine whether or not a computation is worthy of parallelism.</p>\n"}, {"tags": ["c++", "templates", "haskell", "polymorphism"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1512936761, "post_id": 47742898, "comment_id": 82446141, "body": "The first thing I see is that in <code>template &lt;typename Function, typename Input, typename Output&gt;</code>, the relationship between <code>Function</code> and <code>Input</code> and <code>Output</code> is not specified.  How about <code>std::vector&lt;Output&gt; map(Func&lt;Input,Output&gt;, const std::vector&lt;Input&gt; &amp;xs)</code>, for a suitable definition of <code>Func</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1512937060, "post_id": 47742898, "comment_id": 82446220, "body": "@luqui C++ has SFINAE, which somewhat encourages the original style, I think, since it produces a more general template."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1512937210, "post_id": 47742898, "comment_id": 82446268, "body": "The issue here seems to be that <code>map(pigLatin, words(input))</code> is producing a string instead of a vector -- the wrong overload is being chosen."}, {"owner": {"reputation": 303, "user_id": 1664444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a9d7bf4591bea4c21c4cf0fb846aec3?s=128&d=identicon&r=PG", "display_name": "evanrelf", "link": "https://stackoverflow.com/users/1664444/evanrelf"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512937314, "post_id": 47742898, "comment_id": 82446291, "body": "@chi Exactly, and I don&#39;t know how to tell it to use the correct one."}, {"owner": {"reputation": 303, "user_id": 1664444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a9d7bf4591bea4c21c4cf0fb846aec3?s=128&d=identicon&r=PG", "display_name": "evanrelf", "link": "https://stackoverflow.com/users/1664444/evanrelf"}, "edited": false, "score": 0, "creation_date": 1512937447, "post_id": 47742898, "comment_id": 82446333, "body": "<code>map</code> was working fine when I only allowed <code>std::vector&lt;Type&gt; -&gt; std::vector&lt;Type&gt;</code> and <code>std::string -&gt; std::string</code>. One I tried allowing them to cross over, it stopped working."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 1, "creation_date": 1512993600, "post_id": 47742898, "comment_id": 82465249, "body": "Really neat idea! And a great learning exercise. Two factors to consider: 1. Your <code>std::vector</code> implementations will be strictly evaluated, and to get lazy behavior, you would need a container with thunks. 2. If you\u2019ll be copying a lot of large list elements, consider storing <code>std::shared_ptr&lt;T&gt;</code> in your vectors. So you might want a variant of <code>map</code> and catamorphisms that does this."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 1, "creation_date": 1512993788, "post_id": 47742898, "comment_id": 82465378, "body": "An interesting special case you can overload and optimize: if your function has the same input and output type, and the input <code>vector</code> is a non-const rvalue reference, you could create the output <code>vector</code> in-place."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 1, "creation_date": 1513024811, "post_id": 47742898, "comment_id": 82483340, "body": "Also, if the input is an rvalue, you could do an <code>.emplace_back(f(std::move(x)))</code> and possibly get a more-efficient implementation for some <code>f</code>. E.g., if <code>f</code> is scalar multiplication, you could get the behavior of <code>*=</code> rather than creating a temporary."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1513071645, "post_id": 47742898, "comment_id": 82499814, "body": "a bystander question: have you considered using iterators and std::transform? could it work?"}], "answers": [{"comments": [{"owner": {"reputation": 303, "user_id": 1664444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a9d7bf4591bea4c21c4cf0fb846aec3?s=128&d=identicon&r=PG", "display_name": "evanrelf", "link": "https://stackoverflow.com/users/1664444/evanrelf"}, "edited": false, "score": 0, "creation_date": 1512941355, "post_id": 47743558, "comment_id": 82447433, "body": "It sounds like this is the best answer. It&#39;s disappointing this is so tedious to deal with in C++. Is there no way to specify the type of the function argument? Something like <code>... map(const Function&lt;int, bool&gt; &amp;f ...</code> to only accept functions that take an <code>int</code> and return a <code>bool</code>."}, {"owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "reply_to_user": {"reputation": 303, "user_id": 1664444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a9d7bf4591bea4c21c4cf0fb846aec3?s=128&d=identicon&r=PG", "display_name": "evanrelf", "link": "https://stackoverflow.com/users/1664444/evanrelf"}, "edited": false, "score": 0, "creation_date": 1512941609, "post_id": 47743558, "comment_id": 82447502, "body": "@evanrelf Well, you can take a <code>std::function&lt;bool(int)&gt;</code> but I&#39;m not sure why you&#39;d actually want to do that. Why do you think you need to specify the type of the function argument? You <i>really</i> don&#39;t."}, {"owner": {"reputation": 303, "user_id": 1664444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a9d7bf4591bea4c21c4cf0fb846aec3?s=128&d=identicon&r=PG", "display_name": "evanrelf", "link": "https://stackoverflow.com/users/1664444/evanrelf"}, "edited": false, "score": 0, "creation_date": 1512941856, "post_id": 47743558, "comment_id": 82447573, "body": "So could I write <code>filter</code> using <code>std::function&lt;bool(Type)&gt;</code> to restrict the first argument to only functions that take the type that is in the container and return a <code>bool</code>?"}, {"owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "reply_to_user": {"reputation": 303, "user_id": 1664444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a9d7bf4591bea4c21c4cf0fb846aec3?s=128&d=identicon&r=PG", "display_name": "evanrelf", "link": "https://stackoverflow.com/users/1664444/evanrelf"}, "edited": false, "score": 0, "creation_date": 1512942229, "post_id": 47743558, "comment_id": 82447684, "body": "@evanrelf No, don&#39;t do that. The right way to do that is to verify that <code>std::invoke_result_t&lt;F, X&gt;</code> is <code>bool</code> (or, really, is convertible to bool). (i.e. with <code>std::enable_if</code>)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512942968, "post_id": 47743558, "comment_id": 82447883, "body": "@Barry In the future, do you think we will also include C++ concepts among the &quot;right&quot; ways?"}, {"owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512943145, "post_id": 47743558, "comment_id": 82447926, "body": "@chi Once we have a compiler that implements the working draft&#39;s definitions of concepts, sure :-)"}], "tags": [], "owner": {"reputation": 245138, "user_id": 2069064, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e4V2X.jpg?s=128&g=1", "display_name": "Barry", "link": "https://stackoverflow.com/users/2069064/barry"}, "is_accepted": true, "score": 8, "last_activity_date": 1512940667, "creation_date": 1512940667, "answer_id": 47743558, "question_id": 47742898, "link": "https://stackoverflow.com/questions/47742898/problems-implementing-haskells-map-function-with-c-templates/47743558#47743558", "title": "Problems implementing Haskell&#39;s `map` function with C++ templates", "body": "<p>In this declaration:</p>\n\n<pre><code>template &lt;typename Function, typename Input, typename Output&gt;\nstd::vector&lt;Output&gt; map(const Function &amp;f, const std::vector&lt;Input&gt; &amp;xs);\n</code></pre>\n\n<p><code>Output</code> is a non-deduced context. The compiler will deduce the type of <code>Function</code> and <code>Input</code> from the provided arguments, but <code>Output</code> cannot be deduced - it would have to be explicitly provided. That's not going to happen.</p>\n\n<p>What you want to do is yourself compute what <code>Output</code> is as a function of <code>Function</code> and <code>Input</code>. With a C++17 compiler/library, that's <a href=\"http://en.cppreference.com/w/cpp/types/result_of\" rel=\"noreferrer\"><code>std::invoke_result_t</code></a> (on C++11, use <code>result_of</code>). That is:</p>\n\n<pre><code>template &lt;typename Function, typename Input,\n    typename Output = std::invoke_result_t&lt;Function const&amp;, Input const&amp;&gt;&gt;\nstd::vector&lt;Output&gt; map(const Function &amp;f, const std::vector&lt;Input&gt; &amp;xs);\n</code></pre>\n\n<p>It's a defaulted template parameter, but since the user won't actually ever provide it, the default argument will get used, which is what you want. Now this isn't entirely right either, since <code>invoke_result_t</code> could return something that you can't put in a <code>vector</code> (like, a reference). So we need to <a href=\"http://en.cppreference.com/w/cpp/types/decay\" rel=\"noreferrer\"><code>std::decay</code></a> it. Moreover, you'll want to reserve the output vector since we know up front what its size will be:</p>\n\n<pre><code>template &lt;typename Function, typename Input,\n    typename Output = std::decay_t&lt;std::invoke_result_t&lt;Function&amp;, Input const&amp;&gt;&gt;&gt;\nstd::vector&lt;Output&gt; map(Function&amp;&amp; f, const std::vector&lt;Input&gt; &amp;xs)\n{\n    std::vector&lt;Output&gt; res;\n    res.reserve(xs.size());\n    for (auto&amp;&amp; elem : xs) {\n        res.push_back(f(elem));\n    }\n    return res;\n}\n</code></pre>\n\n<hr />\n\n<p>Now, if you want this to be able to take a <code>string</code> and either return a <code>vector&lt;X&gt;</code> <em>or</em> a <code>string</code>, that's now getting pretty complicated. You can't overload on return type in C++, so providing those two overloads is ill-formed. It happens to work in your case now, since the <code>string --&gt; vector&lt;X&gt;</code> overload will be removed from consideration due to <code>X</code> not being deducible. But once you fix that, you'll run into that problem. </p>\n"}], "owner": {"reputation": 303, "user_id": 1664444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a9d7bf4591bea4c21c4cf0fb846aec3?s=128&d=identicon&r=PG", "display_name": "evanrelf", "link": "https://stackoverflow.com/users/1664444/evanrelf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 499, "favorite_count": 2, "accepted_answer_id": 47743558, "answer_count": 1, "score": 6, "last_activity_date": 1512941332, "creation_date": 1512936103, "question_id": 47742898, "link": "https://stackoverflow.com/questions/47742898/problems-implementing-haskells-map-function-with-c-templates", "title": "Problems implementing Haskell&#39;s `map` function with C++ templates", "body": "<p>I love using Haskell but am forced to use C++ for school assignments. I am writing my own library for C++ that emulates Haskell's Prelude functions so I can write in a more concise and functional style in C++ if I wish (<a href=\"https://github.com/evanrelf/cpp-prelude/tree/65a4cd6af8e6dd25de11c536397a8727bf34d7cf\" rel=\"noreferrer\">repo on GitHub</a>).</p>\n\n<p>A problem I have run into is implementing functions like <code>map</code> that operate on lists. In Haskell, <code>String</code> is equivalent to <code>[Char]</code>, so you can use strings in functions that take lists. In C++, <code>std::string</code> is <em>not</em> the same thing as <code>std::vector&lt;char&gt;</code>, so I have to write multiple versions of functions to take <code>std::string</code> or <code>std::vector&lt;Type&gt;</code>. This works fine for functions like <code>filter</code> or <code>tail</code> because their input and output are the same type. But with <code>map</code>, I need to be able to transform a vector of <code>int</code>s into <code>char</code>s, or a <code>string</code> into a vector of <code>bool</code>s.</p>\n\n<hr>\n\n<p>When trying to run a simple pig latin converter (<a href=\"https://github.com/evanrelf/cpp-prelude/blob/65a4cd6af8e6dd25de11c536397a8727bf34d7cf/examples/pigLatin.cpp\" rel=\"noreferrer\"><code>pigLatin.cpp</code> on GitHub</a>), the <code>unwords</code> function fails because <code>map</code> isn't working.</p>\n\n<pre><code>examples/pigLatin.cpp:20:29: error: no matching function for call to 'unwords'\n  std::string translation = unwords(map(pigLatin, words(input)));\n                            ^~~~~~~\nexamples/../prelude.hpp:591:15: note: candidate function not viable: no known conversion from 'std::string' (aka 'basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt; &gt;') to 'const std::vector&lt;std::string&gt;'\n      (aka 'const vector&lt;basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt; &gt; &gt;') for 1st argument\n  std::string unwords(const std::vector&lt;std::string&gt; &amp;xs) {\n              ^\n1 error generated.\n</code></pre>\n\n<p>How can I write my <code>map</code> function such that it behaves like the one in Haskell (<a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:map\" rel=\"noreferrer\"><code>map</code> on Hackage</a>):</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>I don't know enough about the nuances of C++ templates to figure this one out. This is what I have so far (<a href=\"https://github.com/evanrelf/cpp-prelude/blob/65a4cd6af8e6dd25de11c536397a8727bf34d7cf/prelude.hpp#L11-L53\" rel=\"noreferrer\"><code>map</code> from <code>prelude.hpp</code> on GitHub</a>):</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>// map :: (a -&gt; b) -&gt; [a] -&gt; [b]\ntemplate &lt;typename Function, typename Input, typename Output&gt;\nstd::vector&lt;Output&gt; map(const Function &amp;f, const std::vector&lt;Input&gt; &amp;xs) {\n  const int size = xs.size();\n  std::vector&lt;Output&gt; temp;\n  for (int i = 0; i &lt; size; ++i) {\n    temp.push_back(f(xs[i]));\n  }\n  return temp;\n}\n\n// map :: (String -&gt; a) -&gt; String -&gt; [a]\ntemplate &lt;typename Function, typename Output&gt;\nstd::vector&lt;Output&gt; map(const Function &amp;f, const std::string &amp;xs) {\n  const int size = xs.size();\n  std::vector&lt;Output&gt; temp;\n  for (int i = 0; i &lt; size; ++i) {\n    temp.push_back(f(xs[i]));\n  }\n  return temp;\n}\n\n// map :: (a -&gt; String) -&gt; [a] -&gt; String\ntemplate &lt;typename Function, typename Input&gt;\nstd::string map(const Function &amp;f, const std::vector&lt;Input&gt; &amp;xs) {\n  const int size = xs.size();\n  std::string temp;\n  for (int i = 0; i &lt; size; ++i) {\n    temp += f(xs[i]);\n  }\n  return temp;\n}\n\n// map :: (String -&gt; String) -&gt; String -&gt; String\ntemplate &lt;typename Function&gt;\nstd::string map(const Function &amp;f, const std::string &amp;xs) {\n  const int size = xs.size();\n  std::string temp;\n  for (int i = 0; i &lt; size; ++i) {\n    temp += f(xs[i]);\n  }\n  return temp;\n}\n</code></pre>\n"}, {"tags": ["haskell", "type-constraints", "type-families", "higher-rank-types"], "answers": [{"comments": [{"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "edited": false, "score": 0, "creation_date": 1512953549, "post_id": 47744741, "comment_id": 82450243, "body": "Ah, I didn&#39;t see the restriction of being able to determine the field type as any type which fit the equality check. What&#39;s the solution for <code>IntGenerator</code> to be able to hold any instance of the class, then - make <code>v</code> a type parameter?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1513037478, "post_id": 47744741, "comment_id": 82488356, "body": "I suspect you meant <code>data IntGenerator where Gen :: forall v. (ValueGen v, Output v ~ Integer) =&gt; { generator :: v } -&gt; IntGenerator</code>"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1513037526, "post_id": 47744741, "comment_id": 82488375, "body": "That is precisely what I was thinking of!"}], "tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 1, "last_activity_date": 1512949908, "last_edit_date": 1592644375, "creation_date": 1512949908, "answer_id": 47744741, "question_id": 47742542, "link": "https://stackoverflow.com/questions/47742542/why-cant-ghc-deduce-type-equality-on-a-class-type-family-in-a-rank-2-type/47744741#47744741", "title": "Why can&#39;t GHC deduce type equality on a class type family in a Rank 2 type?", "body": "<p>Definition you have written means that for <code>IntGenorator</code> you have:</p>\n<blockquote>\n<p>If you give me an <code>IntGenorator</code> and think of some type <code>v</code> such that <code>Output v ~ Integer</code> then I will give you something of type <code>v</code> based on whatever is inside the <code>IntGenorator</code></p>\n<p>If for any type <code>v</code> such that <code>Output v ~ Integer</code>, you can give me something of type <code>v</code> then you can construct something of type <code>IntGenorator</code></p>\n</blockquote>\n<p>Because the type family is not injective there could be other types <code>v</code> than <code>Integer</code> such that <code>Output v ~ Integer</code> (note they could be in modules which ghc hasn\u2019t compiled yet or which haven\u2019t been written yet). Therefore ghc cant prove that the only type <code>v</code> with <code>Output v ~ Integer</code> is <code>Integer</code> (or rather some set of types which implement <code>Num</code>) and that therefore <code>3 :: Integer</code> (or rather <code>3 :: Num a =&gt; a</code>) is a valid value of the type <code>forall v. (Output v ~ Integer) =&gt; v</code>.</p>\n<p>E.g. what if someone added an instance <code>ValueGen Char</code> with <code>Output Char = Integer</code>. Then <code>3</code> is certainly not of type <code>Char</code> (unless one implements <code>Num Char</code>) so you can\u2019t put it inside an <code>IntGenerator</code></p>\n"}], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 47744741, "answer_count": 1, "score": 0, "last_activity_date": 1512949908, "creation_date": 1512933715, "question_id": 47742542, "link": "https://stackoverflow.com/questions/47742542/why-cant-ghc-deduce-type-equality-on-a-class-type-family-in-a-rank-2-type", "title": "Why can&#39;t GHC deduce type equality on a class type family in a Rank 2 type?", "body": "<p>As a very trimmed-down version of what I'm experiencing:</p>\n\n<pre><code>{-# LANGUAGE ExplicitForAll #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE TypeFamilies #-}\nclass ValueGen v where\n  type Output v\n  generate :: v -&gt; Output v\n\ninstance ValueGen Integer where\n  type Output (Integer) = Integer\n  generate n = n + 1\n\nnewtype IntGenerator = Gen { generator :: forall v. ValueGen v =&gt; ((Output v) ~ Integer) =&gt; v }\n\nmyGen :: IntGenerator\nmyGen = Gen (3 :: Integer)\n</code></pre>\n\n<p>The error that GHC gives is</p>\n\n<pre><code>Could not deduce: v ~ Integer\nfrom the context: (ValueGen v, Output v ~ Integer)\n  bound by a type expected by the context:\n            forall v. (ValueGen v, Output v ~ Integer) =&gt; v\n</code></pre>\n\n<p>This works fine if I just try to restrict <code>v</code> by type equality.</p>\n\n<p>What is the issue that GHC is encountering? Why is it trying to deduce the restriction <code>v ~ Integer</code> if that's already informed by the typing of <code>3 :: Integer</code>? Shouldn't the restriction check be that <code>Output Integer</code>, which resolves to <code>Integer</code>, is equal to <code>Integer</code>, and then pass?</p>\n\n<h3>Abstract</h3>\n\n<p>I hit this trying to write a rank 2 type which contained two <code>Pipeline</code> class instances which share some intermediate type. The essential idea was to get two pipelines like</p>\n\n<pre><code>a|---|b  b|---|c\n</code></pre>\n\n<p>and produce a new type <code>Joined</code> which is then an instance of <code>Pipeline</code></p>\n\n<pre><code>a|------------|c\na|---|b  b|---|c\n</code></pre>\n\n<p>The issue is that the inner pipelines are stored with internal <code>forall</code>s using a restriction of type equality to a type parameter of <code>Joined</code> - but GHC seems to not recognise when the restriction is satisfied.</p>\n"}, {"tags": ["haskell", "functional-programming", "coercion"], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1512952786, "post_id": 47742925, "comment_id": 82450115, "body": "&quot;such proofs are then discarded during the compilation by GHC&quot;. Hopefully, but certainly not always. If only..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1512982062, "post_id": 47742925, "comment_id": 82458373, "body": "@Alec No, I&#39;m reasonably sure they are erased at some point. Note that the <code>a :~: b</code> proofs are not erased, instead -- only the proofs in the special coercion language are (I think)."}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 1, "creation_date": 1512996272, "post_id": 47742925, "comment_id": 82466835, "body": "Indeed, Sulzmann et al. say &quot;Like types, coercions are erased before running the program, so they are guaranteed to have no run-time cost.&quot; (<a href=\"https://dl.acm.org/citation.cfm?id=1190324\" rel=\"nofollow noreferrer\">dl.acm.org/citation.cfm?id=1190324</a>) and it&#39;s fair to assume this property is preserved in GHC Core, which is built on top of future evolutions of this paper."}, {"owner": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "edited": false, "score": 0, "creation_date": 1544827988, "post_id": 47742925, "comment_id": 94427354, "body": "&quot;but is the necessary price to pay for having unlimited recursion, which allows for non terminating programs&quot;. For completeness, corecursion exists in Agda and is another way that allows non-terminating programs while also guaranteeing &quot;forward progress&quot;."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 23, "last_activity_date": 1513106831, "last_edit_date": 1513106831, "creation_date": 1512936270, "answer_id": 47742925, "question_id": 47742519, "link": "https://stackoverflow.com/questions/47742519/what-does-it-mean-to-rely-on-the-consistency-of-a-coercion-language/47742925#47742925", "title": "What does it mean to rely on the consistency of a coercion language?", "body": "<p>Coq and Agda are dependently typed <em>total</em> languages. They are inspired by their relative type-theoretic foundations, which involve a (typed) lambda calculus which is (strongly) normalizing. This means that reducing any lambda term eventually has to halt.</p>\n\n<p>This property makes it possible to use Coq and Agda as proof systems: one can prove mathematical facts using them. Indeed, by the Curry-Howard correspondence, if</p>\n\n<pre><code>someExpression :: someType\n</code></pre>\n\n<p>then <code>someType</code> corresponds to a logical (intuitionistic) tautology.</p>\n\n<p>In Haskell, this is not the case, since any type can be \"proved\" by</p>\n\n<pre><code>undefined :: someType\n</code></pre>\n\n<p>i.e. we can cheat using a \"bottom\" value. This makes Haskell, as a logic, inconsistent. We can prove <code>undefined :: Data.Void.Void</code>, which corresponds to the logical \"false\" proposition, for instance. This is bad, but is the necessary price to pay for having unlimited recursion, which allows for non terminating programs. </p>\n\n<p>By comparison, Coq and Agda have only primitive recursion (which can never recurse forever).</p>\n\n<p>Now, to the point. It is well known that adding the axiom <code>* :: *</code> to Coq / Agda makes the logic to be no longer consistent. We can derive a proof of \"false\" using Girard's paradox. That would be very bad, since we can then even prove things like <code>lemma :: Int :~: String</code>, and derive a coercion function <code>coerce :: Int -&gt; String</code>.</p>\n\n<pre><code>lemma :: Int :~: String\nlemma = -- exploit Girard's paradox here\n\n-- using Haskell syntax:\ncoerce :: Int -&gt; String\ncoerce x = case lemma of Refl -&gt; x\n</code></pre>\n\n<p>If we implemented that naively, <code>coerce</code> would simply perform an unsafe cast, reinterpreting the underlying bits -- after all, that is justified by the <code>lemma</code>, stating that these types are exactly the same! In that way we would even lose runtime type safety. Doom awaits.</p>\n\n<p>In Haskell, even if we don't add <code>* :: *</code> we are inconsistent anyway, so we can simply have</p>\n\n<pre><code>lemma = undefined\n</code></pre>\n\n<p>and derive <code>coerce</code> anyway! So, adding <code>* :: *</code> does not really increase the number of issues. It is just another source of inconsistency.</p>\n\n<p>One might then wonder why in Haskell <code>coerce</code> is type safe, then. Well, in Haskell <code>case lemma of Refl -&gt;...</code> forces the evaluation of <code>lemma</code>. This can only trigger an exception, or fail to terminate, so the <code>...</code> part is never reached. Haskell can <em>not</em> optimize <code>coerce</code> as an unsafe cast, unlike Agda / Coq.</p>\n\n<p>There is another aspect of Haskell that the quoted paragraph mentions: the coercion language. Internally, when we write</p>\n\n<pre><code>case lemma1 of\n  Refl -&gt; case lemma2 of\n    Refl -&gt; ...\n      ...\n        Refl -&gt; expression\n</code></pre>\n\n<p>we introduce a lot of type equalities that must be exploited to prove that <code>expression</code> has indeed the required type. In Coq, the programmer must use a sophisticated form of matching (dependent matching) to justify where and how to exploit the type equalities. In Haskell, the compiler writes this proof for us (in Coq the type system is richer, and that would involve higher order unification, I think, which is undecidable). This proof is NOT written in Haskell! Indeed, Haskell is inconsistent, so we can't rely on that. Instead, Haskell uses another custom coercion language for that, which is guaranteed to be consistent. We only need to rely on that.</p>\n\n<p>We can see some glimpses of that internal coercion language if we dump Core. For instance, compiling a transitivity proof</p>\n\n<pre><code>trans :: a :~: b -&gt; b :~: c -&gt; a :~: c\ntrans Refl Refl = Refl\n</code></pre>\n\n<p>we get</p>\n\n<pre><code>GADTtransitivity.trans\n  :: forall a_au9 b_aua c_aub.\n     a_au9 :~: b_aua -&gt; b_aua :~: c_aub -&gt; a_au9 :~: c_aub\n[GblId, Arity=2, Caf=NoCafRefs, Str=DmdType]\nGADTtransitivity.trans =\n  \\ (@ a_auB)\n    (@ b_auC)\n    (@ c_auD)\n    (ds_dLB :: a_auB :~: b_auC)\n    (ds1_dLC :: b_auC :~: c_auD) -&gt;\n    case ds_dLB of _ [Occ=Dead] { Refl cobox0_auF -&gt;\n    case ds1_dLC of _ [Occ=Dead] { Refl cobox1_auG -&gt;\n    (Data.Type.Equality.$WRefl @ * @ a_auB)\n    `cast` ((&lt;a_auB&gt;_N :~: (Sym cobox0_auF ; Sym cobox1_auG))_R\n            :: ((a_auB :~: a_auB) :: *) ~R# ((a_auB :~: c_auD) :: *))\n    }\n    }\n</code></pre>\n\n<p>Note the <code>cast</code> at the end, which exploits the proof in the coercion language</p>\n\n<pre><code>(&lt;a_auB&gt;_N :~: (Sym cobox0_auF ; Sym cobox1_auG))_R\n</code></pre>\n\n<p>In this proof, we can see <code>Sym cobox0_auF ; Sym cobox1_auG</code> which I guess uses symmetry <code>Sym</code> and transitivity <code>;</code> to reach the wanted goal: the proof that <code>Refl :: a_auB :~: a_auB</code> can indeed be safely casted to the wanted <code>a_auB :~: c_auD</code>.</p>\n\n<p>Finally, note that I'm pretty sure that such proofs are then discarded during the compilation by GHC, and that <code>cast</code> ultimately reduces to an unsafe cast at runtime (<code>case</code> still evaluates the two input proofs, to preserve type safety). However, having an intermediate proof strongly ensures that the compiler is doing the right thing.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 565, "favorite_count": 2, "accepted_answer_id": 47742925, "answer_count": 1, "score": 19, "last_activity_date": 1513106831, "creation_date": 1512933532, "last_edit_date": 1512995131, "question_id": 47742519, "link": "https://stackoverflow.com/questions/47742519/what-does-it-mean-to-rely-on-the-consistency-of-a-coercion-language", "title": "What does it mean to rely on the consistency of a coercion language?", "body": "<p>From <a href=\"https://ghc.haskell.org/trac/ghc/wiki/DependentHaskell\" rel=\"noreferrer\">https://ghc.haskell.org/trac/ghc/wiki/DependentHaskell</a>,</p>\n\n<blockquote>\n  <p>unlike Coq and Agda, Haskell relies on the consistency of a coercion language, which is not threatened by * :: *. See the paper for more details.</p>\n</blockquote>\n\n<p>The \"paper\" cited is a <a href=\"http://www.cis.upenn.edu/~eir/papers/2013/fckinds/fckinds.pdf\" rel=\"noreferrer\">broken link</a>, but, by Googling and reading it, I noticed it is describing how to add explicit kind equality to system FC, but not directly addressing the implicit question: <strong>what it means to rely on the consistency of a coercion language</strong>?</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1512933409, "post_id": 47742484, "comment_id": 82445091, "body": "If <code>x</code> is <code>&quot;bird&quot;</code>, then <code>length x</code> is <code>4</code> (since bird has four characters)."}, {"owner": {"reputation": 192, "user_id": 2948807, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6f6af6efc1224a28933cd0f61da58f32?s=128&d=identicon&r=PG&f=1", "display_name": "ZzAnt&#225;res", "link": "https://stackoverflow.com/users/2948807/zzant%c3%a1res"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512933683, "post_id": 47742484, "comment_id": 82445186, "body": "Oh! I get it, <code>x</code> refers to each element, not the whole list! I totally misunderstood that."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512933741, "post_id": 47742484, "comment_id": 82445208, "body": "you should see <code>x</code> as a <i>loop variable</i> (if we would write it imperatively), so indeed <code>x</code> refers to an individual item, <i>not</i> the list of strings."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1512937000, "post_id": 47742484, "comment_id": 82446201, "body": "<a href=\"https://wiki.haskell.org/Keywords#.7C\" rel=\"nofollow noreferrer\">read list comprehensions</a> as &quot;list of (x,y)s for x in ...; for y in ...&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 1, "last_activity_date": 1512933801, "creation_date": 1512933801, "answer_id": 47742559, "question_id": 47742484, "link": "https://stackoverflow.com/questions/47742484/haskell-unexpected-result-on-list-comprehension-evaluation/47742559#47742559", "title": "Haskell: Unexpected result on list comprehension evaluation", "body": "<p><strong>Short answer</strong>: <code>x</code> takes as value the <strong>items</strong> of the list, <strong>not</strong> the list itself.</p>\n\n<p>You can see list comprehension in Haskell like it is done in Python:</p>\n\n<pre><code>[(x, y) | x &lt;- [\"cat\", \"dog\", \"bird\"]\n        , y &lt;- [1..length x]]\n</code></pre>\n\n<p>is equivalent to:</p>\n\n<pre><code>[(x,y) for x in [\"cat\", \"dog\", \"bird\"] for y in range(1, 1+len(x))]\n</code></pre>\n\n<p>Or in a precedural way:</p>\n\n<pre><code>result = []\nfor x in [\"cat\", \"dog\", \"bird\"]:\n    for y in range(1, 1+len(x)):\n        result.append((x,y))\n</code></pre>\n\n<p>So we iterate with <code>x</code> over the list <code>[\"cat\", \"dog\", \"bird\"]</code>, and then for every value <code>x</code>, we iterate over <code>range(1, 1+len(x))</code> with <code>y</code>. For the last item of the list, <code>\"bird\"</code> it thus means that the <code>length</code> / <code>len</code> of <code>\"bird\"</code> is four (since bird is a word with four characters). And thus <code>y</code> will iterate four times for bird.</p>\n\n<p>In case you want to take the <code>minimum</code> of the lengths of <code>x</code>, you can use:</p>\n\n<pre><code>[(x, y) | x &lt;- [\"cat\", \"dog\", \"bird\"]\n        , y &lt;- [1..minimum (map length) [\"cat\", \"dog\", \"bird\"]]]\n</code></pre>\n\n<p>In case you want to take the <code>length</code> of the list of strings itself, you can use <code>length</code> of that list, so:</p>\n\n<pre><code>[(x, y) | x &lt;- [\"cat\", \"dog\", \"bird\"]\n        , y &lt;- [1..length [\"cat\", \"dog\", \"bird\"]]]\n</code></pre>\n"}], "owner": {"reputation": 192, "user_id": 2948807, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6f6af6efc1224a28933cd0f61da58f32?s=128&d=identicon&r=PG&f=1", "display_name": "ZzAnt&#225;res", "link": "https://stackoverflow.com/users/2948807/zzant%c3%a1res"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 47742559, "answer_count": 1, "score": 1, "last_activity_date": 1512933801, "creation_date": 1512933298, "question_id": 47742484, "link": "https://stackoverflow.com/questions/47742484/haskell-unexpected-result-on-list-comprehension-evaluation", "title": "Haskell: Unexpected result on list comprehension evaluation", "body": "<p>I'm just learning some Haskell and while playing with list comprehensions in the repl I can't understand how the tuple <code>(\"bird\", 4)</code> is generated in the following code:</p>\n\n\n\n<pre><code>*Main&gt; :{\n*Main| [(x, y) | x &lt;- [\"cat\", \"dog\", \"bird\"]\n*Main|         , y &lt;- [1..length x]]\n*Main| :}\n[(\"cat\",1),(\"cat\",2),(\"cat\",3),(\"dog\",1),(\"dog\",2),(\"dog\",3),(\"bird\",1),(\"bird\",2),(\"bird\",3),(\"bird\",4)]\n</code></pre>\n\n<p>\nAs of my understanding, the length of <code>x</code> is never bigger than <code>3</code>, I would expect to see three tuples of <code>bird</code> as they are three for <code>cat</code> and three for <code>dog</code>.</p>\n\n<p>\nWhy does this happen? What does Haskell sees?</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 2, "creation_date": 1512939272, "post_id": 47742296, "comment_id": 82446789, "body": "Seems that your input JSON has a single field named <code>dailygameschedule</code>, but you&#39;re trying to find a field named <code>gameentry</code>. This field is not present, which the library helpfully points out for you."}, {"owner": {"reputation": 49, "user_id": 6850759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8170739a2a526163a0d0a0c8e9555d5?s=128&d=identicon&r=PG&f=1", "display_name": "Rhett D", "link": "https://stackoverflow.com/users/6850759/rhett-d"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1512949885, "post_id": 47742296, "comment_id": 82449564, "body": "@FyodorSoikin that cleared up my issue, thank you. I hadn&#39;t realized to go &quot;up&quot; one more level in the response."}], "owner": {"reputation": 49, "user_id": 6850759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8170739a2a526163a0d0a0c8e9555d5?s=128&d=identicon&r=PG&f=1", "display_name": "Rhett D", "link": "https://stackoverflow.com/users/6850759/rhett-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 376, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1512933430, "creation_date": 1512931943, "last_edit_date": 1512933430, "question_id": 47742296, "link": "https://stackoverflow.com/questions/47742296/haskell-key-not-present-error-when-parsing-json-using-aeson", "title": "Haskell: &quot;key \\&quot;...&quot;\\ not present&quot; error when parsing json using aeson", "body": "<p>Having some difficulty getting some json to parse with aeson for Haskell. Help would be much appreciated. This is the JSON I'm trying to parse:</p>\n\n<pre><code>{\"dailygameschedule\":{\"lastUpdatedOn\":\"2017-12-10 1:05:34 PM\",\"gameentry\":\n[{\"id\":\"34567\",\"scheduleStatus\":\"Normal\",\"originalDate\":null,\"originalTime\":null,\"delayedOrPostponedReason\":null,\"date\":\"2017-01-18\",\"time\":\"7:00PM\",\"awayTeam\":{\"ID\":\"81\",\"City\":\"Toronto\",\"Name\":\"Raptors\",\"Abbreviation\":\"TOR\"},\"homeTeam\":{\"ID\":\"85\",\"City\":\"Philadelphia\",\"Name\":\"76ers\",\"Abbreviation\":\"PHI\"},\"location\":\"Wells Fargo Center\"},\n....\n,{\"id\":\"34575\",\"scheduleStatus\":\"Normal\",\"originalDate\":null,\"originalTime\":null,\"delayedOrPostponedReason\":null,\"date\":\"2017-01-18\",\"time\":\"10:30PM\",\"awayTeam\":{\"ID\":\"87\",\"City\":\"Indiana\",\"Name\":\"Pacers\",\"Abbreviation\":\"IND\"},\"homeTeam\":{\"ID\":\"103\",\"City\":\"Sacramento\",\"Name\":\"Kings\",\"Abbreviation\":\"SAC\"},\"location\":\"Sleep Train Arena\"}]}}\n</code></pre>\n\n<p>How I'm trying to parse it:</p>\n\n<pre><code>module Models.Games where\n\nimport Control.Monad\nimport Data.Aeson\nimport Data.Time.Clock\n\nnewtype GameList = GameList [GameEntry] deriving (Show, Eq)\n\ndata GameEntry = GameEntry { eid :: Integer\n                           , scheduleStatus :: String\n                           , date :: UTCTime\n                           , time :: UTCTime\n                           , awayTeam :: Team\n                           , homeTeam :: Team\n                           , location :: String\n                           } deriving (Show, Eq)\n\ndata Team = Team { tid :: Integer\n                 , city :: String\n                 , name :: String\n                 , abbreviation :: String\n                 } deriving (Show, Eq)\n\ninstance FromJSON GameList where\n  parseJSON (Object o) =\n    GameList &lt;$&gt; (o .: \"gameentry\")\n  parseJSON _          = mzero\n\n\ninstance FromJSON GameEntry where\n  parseJSON (Object o) =\n    GameEntry &lt;$&gt; (o .: \"id\")\n              &lt;*&gt; (o .: \"scheduleStatus\")\n              &lt;*&gt; (o .: \"date\")\n              &lt;*&gt; (o .: \"time\")\n              &lt;*&gt; (o .: \"awayTeam\")\n              &lt;*&gt; (o .: \"homeTeam\")\n              &lt;*&gt; (o .: \"location\")\n  parseJSON _          = mzero\n\ninstance FromJSON Team where\n  parseJSON (Object o) =\n    Team &lt;$&gt; (o .: \"ID\")\n         &lt;*&gt; (o .: \"City\")\n         &lt;*&gt; (o .: \"Name\")\n         &lt;*&gt; (o .: \"Abbreviation\")\n  parseJSON _          = mzero\n</code></pre>\n\n<p>Caller (in another file):</p>\n\n<pre><code>....\nimport Network.HTTP.Simple\n...\ngetGamesAPI :: IO GameList\ngetGamesAPI = do\n      un &lt;- username\n      pw &lt;- password\n      let encoded = encode . fromString $ un ++ \":\" ++ pw\n          authstr = (fromString \"Basic \") `mappend` encoded\n          request = setRequestHeaders [ (\"Accept-Encoding\", \"gzip\")\n                                      , (\"Authorization\", authstr)\n                                      ]\n                  $ fullSeasonGames\n      response &lt;- httpJSON request\n      return $ getResponseBody response\n</code></pre>\n\n<p>However when I try to run it, I get something like this right at the end:</p>\n\n<pre><code>...(\"homeTeam\",Object (fromList [(\"Abbreviation\",String \"GSW\"),(\"City\",String \"Golden State\"),(\"Name\",String \"Warriors\"),(\"ID\",String \"101\")])),(\"id\",String \"34574\"),(\"delayedOrPostponedReason\",Null)]),Object (fromList [(\"time\",String \"10:30PM\"),(\"location\",String \"Sleep Train Arena\"),(\"originalDate\",Null),(\"awayTeam\",Object (fromList [(\"Abbreviation\",String \"IND\"),(\"City\",String \"Indiana\"),(\"Name\",String \"Pacers\"),(\"ID\",String \"87\")])),(\"scheduleStatus\",String \"Normal\"),(\"date\",String \"2017-01-18\"),(\"originalTime\",Null),(\"homeTeam\",Object (fromList [(\"Abbreviation\",String \"SAC\"),(\"City\",String \"Sacramento\"),(\"Name\",String \"Kings\"),(\"ID\",String \"103\")])),(\"id\",String \"34575\"),(\"delayedOrPostponedReason\",Null)])]),\n...(\"lastUpdatedOn\",String \"2017-12-10 1:05:34 PM\")]))]),\nresponseCookieJar = CJ {expose = [Cookie {cookie_name = \"JSESSIONID\", cookie_value = \"9E7F8296FEC1EF68F6827F411D9AA1B9\",\ncookie_expiry_time = 3017-04-12 00:00:00 UTC, cookie_domain = \"api.mysportsfeeds.com\", cookie_path = \"/leaguemanager-web\",\ncookie_creation_time = 2017-12-10 18:12:56.681505 UTC, cookie_last_access_time = 2017-12-10 18:12:56.681505 UTC,\ncookie_persistent = False, cookie_host_only = True, cookie_secure_only = False, cookie_http_only = True}]}, \nresponseClose' = ResponseClose}) \"key \\\"gameentry\\\" not present\"\n</code></pre>\n\n<p>I'm a little confused at this message because it seems to have parsed fine before it? I've tried restructuring my datatypes in a few ways to take care of the <code>\"key \\\"gameentry\\\" not present\"</code> message, but no such luck.</p>\n"}, {"tags": ["haskell", "template-haskell"], "answers": [{"comments": [{"owner": {"reputation": 2692, "user_id": 625791, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/996a20b9eae1def21e8db462e9bf1cf7?s=128&d=identicon&r=PG", "display_name": "theduke", "link": "https://stackoverflow.com/users/625791/theduke"}, "edited": false, "score": 1, "creation_date": 1512930527, "post_id": 47742071, "comment_id": 82444157, "body": "Haha ouch. Well, that&#39;s embarrasing... Thanks for the quick response, I&#39;ll accept once the time limit expires."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 5, "last_activity_date": 1512930437, "creation_date": 1512930437, "answer_id": 47742071, "question_id": 47742054, "link": "https://stackoverflow.com/questions/47742054/haskell-makelenses-data-constructor-not-in-scope/47742071#47742071", "title": "Haskell: makeLenses - data constructor not in scope", "body": "<p>It's <code>''SearchRequest</code>, not <code>SearchRequest''</code>.</p>\n"}], "owner": {"reputation": 2692, "user_id": 625791, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/996a20b9eae1def21e8db462e9bf1cf7?s=128&d=identicon&r=PG", "display_name": "theduke", "link": "https://stackoverflow.com/users/625791/theduke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 400, "favorite_count": 0, "accepted_answer_id": 47742071, "answer_count": 1, "score": 0, "last_activity_date": 1512930437, "creation_date": 1512930338, "question_id": 47742054, "link": "https://stackoverflow.com/questions/47742054/haskell-makelenses-data-constructor-not-in-scope", "title": "Haskell: makeLenses - data constructor not in scope", "body": "<p>I have this simple code here to define a type and use <code>makeLenses</code> to generate lenses.</p>\n\n<pre><code>module Api.Jira.Types.Search\n  (\n    SearchRequest(..)\n  ) where\n\nimport GHC.Generics\nimport qualified Data.Text as T\nimport Data.Aeson (FromJSON, ToJSON)\nimport Control.Lens\nimport Data.Aeson\nimport Data.Aeson.Types\n\ndata SearchRequest = SearchRequest\n  { _jql :: T.Text\n  , _startAt :: Maybe Int\n  , _maxResults :: Maybe Int\n  , _fields :: Maybe [T.Text]\n  , _expand :: Maybe [T.Text]\n  , _properties :: Maybe [T.Text]\n  } deriving (Show, Generic)\n\ninstance ToJSON SearchRequest where\n  toJSON = genericToJSON defaultOptions {\n             fieldLabelModifier = drop 1 }\n\ninstance FromJSON SearchRequest where\n  parseJSON = genericParseJSON defaultOptions {\n                fieldLabelModifier = drop 1 }\n\nmakeLenses SearchRequest''\n</code></pre>\n\n<p>This results in the error:</p>\n\n<blockquote>\n  <p>Data constructor not in scope:\n          SearchRequest''\n            :: template-haskell-2.11.1.0:Language.Haskell.TH.Syntax.Name\n      \u2022 Perhaps you meant one of these:\n          \u2018SearchRequest\u2019 (line 20), variable \u2018searchRequest\u2019 (line 39)</p>\n</blockquote>\n\n<p>I have found two somewhat related problems on SO, but they are related to declaration order and don't seem to apply here, since all types contained in <code>SearchRequest</code> are already defined.</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/20876147/haskell-template-haskell-and-the-scope\">Haskell: Template Haskell and the scope</a></li>\n<li><a href=\"https://stackoverflow.com/questions/31979147/type-synonyms-not-in-scope-when-using-template-haskell\">Type synonyms &quot;not in scope&quot; when using Template Haskell</a></li>\n</ul>\n\n<p>Any ideas what is causing this?</p>\n"}, {"tags": ["shell", "haskell", "tree-traversal", "io-monad", "haskell-turtle"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1512930708, "post_id": 47742039, "comment_id": 82444227, "body": "What is <code>Turtle</code>?"}, {"owner": {"reputation": 1239, "user_id": 8887578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3nMBo.png?s=128&g=1", "display_name": "Do Say Lazy", "link": "https://stackoverflow.com/users/8887578/do-say-lazy"}, "edited": false, "score": 0, "creation_date": 1512930711, "post_id": 47742039, "comment_id": 82444230, "body": "What is the type of <code>length</code>?"}, {"owner": {"reputation": 1239, "user_id": 8887578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3nMBo.png?s=128&g=1", "display_name": "Do Say Lazy", "link": "https://stackoverflow.com/users/8887578/do-say-lazy"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1512930737, "post_id": 47742039, "comment_id": 82444238, "body": "@melpomene <a href=\"https://hackage.haskell.org/package/turtle\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/turtle</a> it seems"}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512930835, "post_id": 47742039, "comment_id": 82444259, "body": "Right you are, The Aspiring Hacker."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512931011, "post_id": 47742039, "comment_id": 82444311, "body": "<code>length :: t a -&gt; Int</code>; used mainly on lists. Pretty polymorphic, but not enough for <code>Shell FilePath</code> :)"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1512931221, "post_id": 47742039, "comment_id": 82444369, "body": "<a href=\"http://hackage.haskell.org/package/turtle-1.4.5/docs/Turtle-Prelude.html#v:sort\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/turtle-1.4.5/docs/&hellip;</a> looks close."}, {"owner": {"reputation": 1239, "user_id": 8887578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3nMBo.png?s=128&g=1", "display_name": "Do Say Lazy", "link": "https://stackoverflow.com/users/8887578/do-say-lazy"}, "edited": false, "score": 0, "creation_date": 1512931268, "post_id": 47742039, "comment_id": 82444381, "body": "Does <code>length</code> have typeclass constraints? Which package is it from?"}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512931581, "post_id": 47742039, "comment_id": 82444477, "body": "<code>length</code> is from <code>Data.Foldable</code>, it&#39;s one of the bedrock tools. It&#39;s beside the point, though. One has understand <code>Shell</code> to solve this problem. I&#39;ve no idea so far."}, {"owner": {"reputation": 1239, "user_id": 8887578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3nMBo.png?s=128&g=1", "display_name": "Do Say Lazy", "link": "https://stackoverflow.com/users/8887578/do-say-lazy"}, "edited": false, "score": 0, "creation_date": 1512931723, "post_id": 47742039, "comment_id": 82444514, "body": "I just looked. <code>Shell</code> has to implement <code>Foldable</code>, then."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1512934332, "post_id": 47742039, "comment_id": 82445395, "body": "<a href=\"http://hackage.haskell.org/package/turtle-1.4.5/docs/Turtle-Shell.html#\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/turtle-1.4.5/docs/&hellip;</a> says it has <code>IO a -&gt; Shell a</code>, so it can&#39;t possibly be <code>Foldable</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512932494, "post_id": 47742239, "comment_id": 82444768, "body": "Couldn&#39;t match expected type \u2018Shell FilePath                                     -&gt; Fold a1 Int -&gt; Int\u2019                   with actual type \u2018Fold a0 [a0]\u2019     \u2022 The function \u2018F.list\u2019 is applied to two arguments,       but its type \u2018Fold a0 [a0]\u2019 has none       In the expression: F.list (lstree src) F.length       In an equation for \u2018treeCount\u2019:           <code>treeCount src = F.list (lstree src) F.length</code>"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512932769, "post_id": 47742239, "comment_id": 82444852, "body": "@AlexeyOrlov That needs to be <code>fold (lstree src) F.list</code>."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512933148, "post_id": 47742239, "comment_id": 82444992, "body": "No instance for (MonadIO []) arising from a use of \u2018fold\u2019"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512933276, "post_id": 47742239, "comment_id": 82445045, "body": "@AlexeyOrlov Did you give it the wrong type signature? It should return <code>IO [FilePath]</code>."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512933502, "post_id": 47742239, "comment_id": 82445117, "body": "It compiles, thanks! I&#39;m taking a timeout: I have to grok it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512933951, "post_id": 47742239, "comment_id": 82445277, "body": "@AlexeyOrlov I&#39;m not familiar with Shell, but there seems to be a lot going on here. <code>Shell</code> is a monad, where <code>Shell a</code> stands for a stream of <code>a</code> values, each produced with a side effect. The library provides functions like <code>Turtle.Shell.fold</code> to &quot;convert&quot; a <code>Shell</code> computation into an <code>IO</code> one, as long as a folding function is provided to &quot;compress&quot; the stream into a single value (e.g. <code>F.length</code> above)."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512934313, "post_id": 47742239, "comment_id": 82445384, "body": "Thanks again! I&#39;m falling behind, though. I hope for tomorrow."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512984107, "post_id": 47742239, "comment_id": 82459471, "body": "I am not the first one to be trapped by IO monad: <a href=\"https://stackoverflow.com/questions/11467066/how-to-get-normal-value-from-io-action-in-haskell\" title=\"how to get normal value from io action in haskell\">stackoverflow.com/questions/11467066/&hellip;</a>"}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512984166, "post_id": 47742239, "comment_id": 82459508, "body": "There is even an icon: <a href=\"https://photos.smugmug.com/Humor/Lambdacats/trapd-in-IO-monad-plz-help/960526421_MnNqB-S-1.jpg\" rel=\"nofollow noreferrer\">photos.smugmug.com/Humor/Lambdacats/trapd-in-IO-monad-plz-he&zwnj;&#8203;lp/&hellip;</a>"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 1, "last_activity_date": 1512931623, "creation_date": 1512931623, "answer_id": 47742239, "question_id": 47742039, "link": "https://stackoverflow.com/questions/47742039/haskell-turtle-managing-shell-type/47742239#47742239", "title": "Haskell: Turtle: Managing Shell type", "body": "<p>I haven't actually tried this, but just looking at the type signatures the following might work:</p>\n\n<pre><code>import qualified Control.Foldl as F\n\ntreeCount :: FilePath -&gt; IO Int\ntreeCount src = fold (lstree src) F.length\n</code></pre>\n\n<p>Fold with <code>F.list</code> to get <code>[FilePath]</code> instead.</p>\n"}], "owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 47742239, "answer_count": 1, "score": 0, "last_activity_date": 1555323830, "creation_date": 1512930257, "last_edit_date": 1555323830, "question_id": 47742039, "link": "https://stackoverflow.com/questions/47742039/haskell-turtle-managing-shell-type", "title": "Haskell: Turtle: Managing Shell type", "body": "<p>This a working snippet:</p>\n\n<pre><code>import Turtle\n...\ngroom :: FilePath -&gt; IO ()\ngroom src = do\n  view (ls src)\n...\n</code></pre>\n\n<p>I can see a list of paths on the console. Actually I'd like to have something like <code>[FilePath]</code> for use, e.g.:</p>\n\n<pre><code>treeCount :: FilePath -&gt; Int\ntreeCount src = length (lstree src)\n</code></pre>\n\n<p>Naturally, it won't compile, <code>lstree</code> being what it is:</p>\n\n<pre><code>lstree :: FilePath -&gt; Shell FilePath\n</code></pre>\n\n<p>What is the correct way to treat this <code>Shell</code> thing? It's a newbie question, sorry.</p>\n"}, {"tags": ["windows", "haskell", "gcc", "compilation", "cygwin"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 3, "creation_date": 1512926406, "post_id": 47739930, "comment_id": 82442822, "body": "I would recommend starting up with Stack: <a href=\"https://haskell-lang.org/get-started\" rel=\"nofollow noreferrer\">haskell-lang.org/get-started</a>"}, {"owner": {"reputation": 9137, "user_id": 5171219, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G5x4vEoGRJc/AAAAAAAAAAI/AAAAAAAAENA/5wwtFtwYH3Q/photo.jpg?sz=128", "display_name": "Emmanuel Rosa", "link": "https://stackoverflow.com/users/5171219/emmanuel-rosa"}, "edited": false, "score": 0, "creation_date": 1512935213, "post_id": 47739930, "comment_id": 82445700, "body": "I second Sibi. I installed Stack on Windows and it worked flawlessly."}, {"owner": {"reputation": 117, "user_id": 7908951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-R7FxQtZZw2Q/AAAAAAAAAAI/AAAAAAAAARI/W3lm0URTsog/photo.jpg?sz=128", "display_name": "Julien Rhapsodos Girard", "link": "https://stackoverflow.com/users/7908951/julien-rhapsodos-girard"}, "edited": false, "score": 0, "creation_date": 1513034561, "post_id": 47739930, "comment_id": 82487511, "body": "Using stack allowed me to progress further into the build. Thanks. I still have an issue but I think I&#39;d better open a new question."}], "answers": [{"comments": [{"owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "edited": false, "score": 0, "creation_date": 1513112489, "post_id": 47763092, "comment_id": 82524290, "body": "You&#39;re getting the error with platform because you didn&#39;t follow step2 from <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow noreferrer\">haskell.org/platform</a>"}], "tags": [], "owner": {"reputation": 117, "user_id": 7908951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-R7FxQtZZw2Q/AAAAAAAAAAI/AAAAAAAAARI/W3lm0URTsog/photo.jpg?sz=128", "display_name": "Julien Rhapsodos Girard", "link": "https://stackoverflow.com/users/7908951/julien-rhapsodos-girard"}, "is_accepted": true, "score": 1, "last_activity_date": 1513034809, "creation_date": 1513034809, "answer_id": 47763092, "question_id": 47739930, "link": "https://stackoverflow.com/questions/47739930/gcc-not-working-during-compiling-haskell-programs-on-windows/47763092#47763092", "title": "GCC not working during compiling haskell programs on Windows", "body": "<p>Fixed (partially) by using Stack. Building is failing but for another reason, so I'll ask another question.</p>\n\n<p>Thanks again.</p>\n"}], "owner": {"reputation": 117, "user_id": 7908951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-R7FxQtZZw2Q/AAAAAAAAAAI/AAAAAAAAARI/W3lm0URTsog/photo.jpg?sz=128", "display_name": "Julien Rhapsodos Girard", "link": "https://stackoverflow.com/users/7908951/julien-rhapsodos-girard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "accepted_answer_id": 47763092, "answer_count": 1, "score": 1, "last_activity_date": 1513034809, "creation_date": 1512917042, "last_edit_date": 1512918626, "question_id": 47739930, "link": "https://stackoverflow.com/questions/47739930/gcc-not-working-during-compiling-haskell-programs-on-windows", "title": "GCC not working during compiling haskell programs on Windows", "body": "<p>I'd like to compile a Haskell project with a .cabal file under windows.</p>\n\n<p>I have installed the Haskell Platform and Cygwin. One of the dependancies is <code>time</code>, which fail to build during the <code>cabal install</code> command.</p>\n\n<p>The error message is the following:</p>\n\n<pre><code>checking for gcc... C:\\PROGRA~1\\HASKELL~1\\826561~1.1\\mingw\\bin\\gcc.exe\nchecking if the C compiler is working... no\nconfigure error: C compiler cannot create executable\n</code></pre>\n\n<p>So I downloaded another <code>gcc</code> withing Cygwin that, I suppose, will work better. \nHowever, this <a href=\"https://stackoverflow.com/questions/20367937/has-anyone-successfully-built-a-cygwin-version-of-ghc\">other question</a> mention that the Haskell platform now uses MinGW rater than Cygwin to run GNU software.</p>\n\n<p>I changed in the cabal <code>configure</code> file the location of <code>gcc</code>, but I still get the same error message (but with the new location of <code>gcc</code>).</p>\n\n<p>So I'm a bit confused here: what is exactly the problem with <code>gcc</code>? Do you have any inputs on how I could continue the building of my software?</p>\n"}, {"tags": ["windows", "haskell", "deployment", "compilation", "cross-compiling"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1512908478, "post_id": 47738693, "comment_id": 82437757, "body": "You want cross-compile? If not, I don&#39;t get what&#39;s the problem. Setup Windows, install Haskell, compile your program, copy .exe."}, {"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1512908774, "post_id": 47738693, "comment_id": 82437855, "body": "@arrowd, yes, I want to cross-compile or use a free build service. (Windows is non-free.)"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 2, "creation_date": 1512910337, "post_id": 47738693, "comment_id": 82438291, "body": "At some point you are going to need to install and test your app on a fresh Windows machine to make sure it works there."}, {"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1512910441, "post_id": 47738693, "comment_id": 82438323, "body": "@PaulJohnson, eventually, yes. Let&#39;s say at the moment I&#39;m content with relying on a build service for that, or just trust that whatever method of cross-compilation I&#39;d be using works."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1512911815, "post_id": 47738693, "comment_id": 82438673, "body": "You could set up a virtual Linux machine and install the Windows version of GHC under Wine."}, {"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1512912090, "post_id": 47738693, "comment_id": 82438764, "body": "@PaulJohnson, that&#39;s an interesting idea. What kind of virtual machine would I need? Couldn&#39;t I install a windows GHC under Wine directly?"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1512912481, "post_id": 47738693, "comment_id": 82438864, "body": "@Turion: I didn&#39;t quite get that right. You need to <i>test</i> the build on a clean machine. Its easy to fail to include all the libraries you need in your installer. It works fine on the build machine because that already has the necessary libraries, but then fails when you install it on a clean machine. So create a clean VM with Wine installed, and then test your build by cloning the clean VM and installing on that, then destroy the clone."}, {"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1513068902, "post_id": 47738693, "comment_id": 82498149, "body": "@PaulJohnson, in theory, it would work, but in practice, wine crashes all the time. Is there no other way?"}], "owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 483, "favorite_count": 3, "answer_count": 0, "score": 6, "last_activity_date": 1512908826, "creation_date": 1512907745, "last_edit_date": 1512908826, "question_id": 47738693, "link": "https://stackoverflow.com/questions/47738693/how-to-compile-or-deploy-a-haskell-executable-to-windows", "title": "How to compile or deploy a Haskell executable to Windows", "body": "<ul>\n<li>I have a simple, self contained, open source Haskell app that compiles on a Windows system with <code>cabal build</code>. Let's assume it uses one or two nontrivial C libraries, such as OpenGL.</li>\n<li>I develop on Linux, with no access to a Windows machine.</li>\n</ul>\n\n<p><strong>Question</strong>: How do I compile my app to a simple <code>.exe</code> file that Windows users can download and run without further hassles?</p>\n\n<p>Restrictions: </p>\n\n<ul>\n<li>No paid-for build services (e.g. AppVeyor)</li>\n<li>No usage of non-free software on my part (in particular, I won't install Windows)</li>\n<li>No installation of a Haskell development environment on the client side</li>\n<li>If possible, no installation of third party software on the client side (e.g. additional libraries etc.)</li>\n</ul>\n\n<p>Some possible solutions:</p>\n\n<ul>\n<li>Cross-compilation</li>\n<li>A free build service (e.g. like travis-ci, but for Windows)</li>\n</ul>\n"}, {"tags": ["haskell", "prolog", "lazy-evaluation"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1512905951, "post_id": 47738453, "comment_id": 82437075, "body": "No, Prolog does eager evaluation."}], "owner": {"reputation": 61, "user_id": 8974469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9ec53c99a7bbae0ce3364f9e481c26?s=128&d=identicon&r=PG&f=1", "display_name": "Cathal Hughes", "link": "https://stackoverflow.com/users/8974469/cathal-hughes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "closed_date": 1512910944, "answer_count": 0, "score": 2, "last_activity_date": 1512910178, "creation_date": 1512905930, "question_id": 47738453, "link": "https://stackoverflow.com/questions/47738453/does-prolog-use-lazy-evaluation-like-haskell", "closed_reason": "Duplicate", "title": "Does Prolog use lazy evaluation like Haskell?", "body": "<p>Haskell generates values as it needs them, is this the same for Prolog? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1512904289, "post_id": 47738147, "comment_id": 82436637, "body": "What do you mean by &quot;asynchronously sleep&quot;?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512904303, "post_id": 47738147, "comment_id": 82436644, "body": "Why is there a <code>do</code> in the <code>syncClockTime</code>?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1512904692, "post_id": 47738147, "comment_id": 82436746, "body": "I don&#39;t know F# or C#."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1512904916, "post_id": 47738147, "comment_id": 82436797, "body": "So ... synchronous sleep? That&#39;s <code>threadDelay</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1512904976, "post_id": 47738147, "comment_id": 82436811, "body": "This question looks like a duplicate of <a href=\"https://stackoverflow.com/questions/13482958/haskell-convert-utctime-to-seconds-and-milliseconds\" title=\"haskell convert utctime to seconds and milliseconds\">stackoverflow.com/questions/13482958/&hellip;</a> and <a href=\"https://stackoverflow.com/questions/35477808/haskell-create-thread-write-to-screen-sleep-thread-write-something-else-to\" title=\"haskell create thread write to screen sleep thread write something else to\">stackoverflow.com/questions/35477808/&hellip;</a>, so it&#39;s probably too broad."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1512906931, "post_id": 47738147, "comment_id": 82437344, "body": "<code>UTCTime</code> doesn&#39;t have a separate seconds component. It stores a day number and the number of picoseconds since midnight."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512908122, "post_id": 47738147, "comment_id": 82437673, "body": "@user1892538: <code>do</code> has <i>nothing</i> to do with <code>if</code>-<code>then</code>-<code>else</code>. <code>if</code>-<code>then</code>-<code>else</code> in fact just maps on the <code>ifThenElse :: Bool -&gt; a -&gt; a -&gt; a</code> function. <code>do</code> is used as syntactical sugar for a monad (e.g. <code>IO</code> monad)."}], "answers": [{"comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1512917768, "post_id": 47739227, "comment_id": 82440234, "body": "Not sure about the distinction you are making between sync and async, but if you only have one thread then &quot;delay&quot; will sleep your entire process. I don&#39;t know about .Net threads, but Haskell threads are indeed very light."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1512923797, "post_id": 47739227, "comment_id": 82442036, "body": "@user1892538: &quot;mod&quot; only works with integral types. The formula I gave does the equivalent of &quot;mod&quot;, but with fractional types."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 2, "last_activity_date": 1512911749, "creation_date": 1512911749, "answer_id": 47739227, "question_id": 47738147, "link": "https://stackoverflow.com/questions/47738147/extracting-seconds-from-utctime-and-asynchronously-sleep/47739227#47739227", "title": "extracting seconds from UTCTime and asynchronously sleep", "body": "<p>Question 2 is simple: you can make your Haskell process sleep for a specified number of microseconds using <a href=\"https://hackage.haskell.org/package/concurrent-extra-0.5/docs/Control-Concurrent-Thread-Delay.html\" rel=\"nofollow noreferrer\"><code>delay</code></a>.</p>\n\n<p>If I understand your Question 1, you want to be able to specify, say 30 seconds, and wait until the next time the system clock is 30 seconds past the minute. So if you call your function at 13:23:27 it will wait 3 seconds until 13:23:30, but if you called it at 13:23:33 then it will wait 57 seconds until 13:24:30.</p>\n\n<p>That is a matter of doing arithmetic on the number of seconds. I would suggest you take the current Posix time using <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/time-1.8.0.2/Data-Time-Clock-POSIX.html#t:POSIXTime\" rel=\"nofollow noreferrer\"><code>getPOSIXTime</code></a>. This returns a <code>NominalDiffTime</code>, which is an instance of <code>Real</code> and <code>RealFrac</code>, so normal arithmetic works fine. The code you want is:</p>\n\n<pre><code>t &lt;- getPOSIXTime\nlet secs = t - fromIntegral (floor (t/60) * 60)\n</code></pre>\n\n<p>Once you have the number of seconds past the minute you can figure out how long to wait until your target time.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6996876"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1512952588, "creation_date": 1512903637, "last_edit_date": 1512952588, "question_id": 47738147, "link": "https://stackoverflow.com/questions/47738147/extracting-seconds-from-utctime-and-asynchronously-sleep", "title": "extracting seconds from UTCTime and asynchronously sleep", "body": "<pre><code>syncClockTime :: TimeZone -&gt; UTCTime -&gt; Pico -&gt; Pico\nsyncClockTime zone time secondTo = do\n    let (TimeOfDay hour minute secondFrom) = localTimeOfDay $ utcToLocalTime zone time\n    if secondTo &gt; secondFrom then\n        secondTo - secondFrom\n    else\n        60 + secondTo - secondFrom\n</code></pre>\n\n<p>I have a couple of questions related to the above code</p>\n\n<ol>\n<li>is there a way to directly extract the seconds <code>secondFrom</code> from the <code>UTCTime</code> <strong>without</strong> converting it to local time and <strong>without</strong> specifying a time zone? (if yes: how? if no: why?)</li>\n<li>How to actually make the running thread/task to <strong>asynchronously sleep</strong> for the above found number of seconds?</li>\n</ol>\n"}, {"tags": ["bash", "haskell", "ghci"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 3, "creation_date": 1512878685, "post_id": 47735327, "comment_id": 82431945, "body": "Have you tried just piping the script into GHCi via the shell? E.g.: <code>ghci &lt; filename</code>. If you just want to run some commands and then exit, that should work fine."}, {"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1512951959, "post_id": 47735327, "comment_id": 82449976, "body": "Thanks @JonPurdy - I tried that - and got the output, but in a long sequence of commands, without seeing the input it was difficult to see where you were up to - and sometimes excluded newlines. This would work in a pinch, but I&#39;m open to something better."}], "answers": [{"tags": [], "owner": {"reputation": 1596, "user_id": 6605742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/541e05b738eac1c7923d85279df2a4b3?s=128&d=identicon&r=PG&f=1", "display_name": "Silvan Mosberger", "link": "https://stackoverflow.com/users/6605742/silvan-mosberger"}, "is_accepted": true, "score": 6, "last_activity_date": 1512917869, "creation_date": 1512917869, "answer_id": 47740035, "question_id": 47735327, "link": "https://stackoverflow.com/questions/47735327/is-there-a-way-to-script-a-ghci-session/47740035#47740035", "title": "Is there a way to script a ghci session?", "body": "<p>You'll want to use <a href=\"https://linux.die.net/man/1/expect\" rel=\"noreferrer\">expect</a> for that, it allows you to interactively control a REPL with simple commands. This script does what you want:</p>\n\n<pre><code>#!/usr/bin/env expect\n\nlog_user 0\nspawn ghci\nlog_user 1\n\nexpect \".*&gt; \"\nsend \":set prompt \\\"ghci&gt; \\\"\\n\"\n\nexpect \"ghci&gt; \"\nsend \"import System.Random\\n\"\nexpect \"ghci&gt; \"\nsend \"random (mkStdGen 100) :: (Int, StdGen)\\n\"\n\ninteract\n</code></pre>\n\n<p>Running this gives you the following:</p>\n\n<pre><code>$ ./ghci-interactive\nGHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :set prompt \"ghci&gt; \"\nghci&gt; import System.Random\nghci&gt; random (mkStdGen 100) :: (Int, StdGen)\n(-3633736515773289454,693699796 2103410263)\nghci&gt; \n</code></pre>\n\n<p>Note: You might need to adjust this a bit to be resistant to users setting the prompt in <code>~/.ghci</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "is_accepted": false, "score": 0, "last_activity_date": 1512994762, "creation_date": 1512994762, "answer_id": 47752836, "question_id": 47735327, "link": "https://stackoverflow.com/questions/47735327/is-there-a-way-to-script-a-ghci-session/47752836#47752836", "title": "Is there a way to script a ghci session?", "body": "<p>Thanks @SilvanMosberger - you solved the issue so I'll leave yours as correct. </p>\n\n<p>I wanted to generalise this approach so it could load instructions specified in a file - eg <code>RandomPair.ghci</code> with the following contents:</p>\n\n<pre><code>import System.Random \n\nrandom (mkStdGen 100) :: (Int, StdGen)  \nrandom (mkStdGen 949488) :: (Float, StdGen)  \nrandom (mkStdGen 949488) :: (Bool, StdGen)  \nrandom (mkStdGen 949488) :: (Integer, StdGen) \n</code></pre>\n\n<p>Now a script to run this looks like the file <code>RandomPair-ghci.bash</code></p>\n\n<pre><code>#!/usr/bin/env expect\n\nlog_user 0\nspawn ghci\nlog_user 1\n\nexpect \".*&gt; \"\nsend \":set prompt \\\"ghci&gt; \\\"\\n\"\n\nset f [open \"RandomPair.ghci\"]\nset replcommands [split [read $f] \"\\n\"]\nclose $f\n\nforeach replcommand $replcommands {\n    set replcommand1 [string map {\"\\\"\" \"\\\\\\\"\"} $replcommand] \n\n    expect \"ghci&gt; \"\n    send -- \"$replcommand1 \\n\"\n}\n\nexpect \"ghci&gt; \"\nsend \":quit\\n\"\n\ninteract\n</code></pre>\n\n<p>This gives a result similar to:</p>\n\n<pre><code>$ ./RandomPair-ghci.bash \nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :set prompt \"ghci&gt; \"\nghci&gt; import System.Random  \nghci&gt;  \nghci&gt;  \nghci&gt; random (mkStdGen 100) :: (Int, StdGen)   \n(-3633736515773289454,693699796 2103410263)\nghci&gt; random (mkStdGen 949488) :: (Float, StdGen)   \n(0.3718226,1597344447 1655838864)\nghci&gt; random (mkStdGen 949488) :: (Bool, StdGen)   \n(False,1485632275 40692)\nghci&gt; random (mkStdGen 949488) :: (Integer, StdGen)  \n(9159618695640234475,587416689 2103410263)\nghci&gt;  \nghci&gt;  \nghci&gt; :quit\nLeaving GHCi.\n$\n</code></pre>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 500, "favorite_count": 0, "accepted_answer_id": 47740035, "answer_count": 2, "score": 5, "last_activity_date": 1512994762, "creation_date": 1512873387, "question_id": 47735327, "link": "https://stackoverflow.com/questions/47735327/is-there-a-way-to-script-a-ghci-session", "title": "Is there a way to script a ghci session?", "body": "<p>My goal is to pipe some steps for <code>ghci</code> to run from a bash script and then exit cleanly. The commentary online <a href=\"https://stackoverflow.com/a/8676361/15441\">says</a> to use <code>runhaskell</code> for this. </p>\n\n<p>This is the <a href=\"http://learnyouahaskell.com/input-and-output#randomness\" rel=\"noreferrer\">command</a> I'm trying to run:</p>\n\n<pre><code>ghci&gt; import System.Random \n\nghci&gt; random (mkStdGen 100) :: (Int, StdGen) \n</code></pre>\n\n<p>With expected result similar to:</p>\n\n<pre><code>(-3633736515773289454,693699796 2103410263)\n</code></pre>\n\n<p>When I drop this into a file <code>randomtest.hs</code> and execute it with <code>runhaskell</code> I get the following error:. </p>\n\n<pre><code>randomtest.hs:3:1: error:\n    Invalid type signature: random (mkStdGen 100) :: ...\n    Should be of form &lt;variable&gt; :: &lt;type&gt;\n</code></pre>\n\n<p>It seems I can't use the <code>runhaskell</code> method to blindly execute <code>ghci</code> inputs.</p>\n\n<p>Now the way to work around this is to add extra commands to the file that is passed to <code>runhaskell</code>:</p>\n\n<pre><code>main = do print (random (mkStdGen 100) :: (Int, StdGen))\n</code></pre>\n\n<p>My goal is to automate the running of ghci work for a haskell course I'm using. I want to be able to run the ghci command from a bash script - in the format that ghci expects, and have it cleanly exit from ghci (or whatever runs it). </p>\n\n<p>My question is: <strong>Is there a way to script a ghci session?</strong></p>\n"}, {"tags": ["haskell", "ghci", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 3, "last_activity_date": 1512879001, "creation_date": 1512879001, "answer_id": 47735779, "question_id": 47735067, "link": "https://stackoverflow.com/questions/47735067/how-do-i-pass-command-to-stack-ghci-repl-from-command-line/47735779#47735779", "title": "How do I pass command to stack GHCi repl from command line", "body": "<p>You could pipe the commands into GHCi from the shell:</p>\n\n<pre><code>echo ':browse! *Main' | stack ghci | grep Button\n</code></pre>\n"}], "owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 47735779, "answer_count": 1, "score": 1, "last_activity_date": 1529252507, "creation_date": 1512870266, "last_edit_date": 1529252507, "question_id": 47735067, "link": "https://stackoverflow.com/questions/47735067/how-do-i-pass-command-to-stack-ghci-repl-from-command-line", "title": "How do I pass command to stack GHCi repl from command line", "body": "<p>I want to say something like:</p>\n\n<blockquote>\n  <p>stack ghci exec ':browse! *Main' | grep Button</p>\n</blockquote>\n\n<p>Is it possible to pass a command to stack ghci and then use the result in grep?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 1, "creation_date": 1512890309, "post_id": 47734895, "comment_id": 82433790, "body": "I tried compiling your code with <code>NoMonomorphismRestriction</code> on ghc 8.2.2 and it seems to work just fine."}, {"owner": {"reputation": 1730, "user_id": 890793, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7b22cd8540bf40a30fd85e964a342be2?s=128&d=identicon&r=PG", "display_name": "Sh4pe", "link": "https://stackoverflow.com/users/890793/sh4pe"}, "reply_to_user": {"reputation": 6300, "user_id": 370902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e44a2a4b5dc35fe1415552e02ee9def?s=128&d=identicon&r=PG", "display_name": "John Wiegley", "link": "https://stackoverflow.com/users/370902/john-wiegley"}, "edited": false, "score": 0, "creation_date": 1512896226, "post_id": 47734895, "comment_id": 82434840, "body": "@JohnWiegley I don&#39;t need to be <code>t</code> dynamic at run time. Could you please show me the code I&#39;d have to use? My understanding of <code>Proxy t</code> is very limited yet, so I could really use some help."}, {"owner": {"reputation": 1730, "user_id": 890793, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7b22cd8540bf40a30fd85e964a342be2?s=128&d=identicon&r=PG", "display_name": "Sh4pe", "link": "https://stackoverflow.com/users/890793/sh4pe"}, "reply_to_user": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 0, "creation_date": 1512998767, "post_id": 47734895, "comment_id": 82468422, "body": "@Rufflewind Using <code>NoMonomorphismRestriction</code> solved the problem for me. If you add a quick answer, I&#39;ll accept it :)"}, {"owner": {"reputation": 6300, "user_id": 370902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e44a2a4b5dc35fe1415552e02ee9def?s=128&d=identicon&r=PG", "display_name": "John Wiegley", "link": "https://stackoverflow.com/users/370902/john-wiegley"}, "edited": false, "score": 0, "creation_date": 1513153635, "post_id": 47734895, "comment_id": 82537989, "body": "@Sh4pe Since the right answer to this issue was given, I\u2019ve deleted my inaccurate one."}], "answers": [{"comments": [{"owner": {"reputation": 1730, "user_id": 890793, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7b22cd8540bf40a30fd85e964a342be2?s=128&d=identicon&r=PG", "display_name": "Sh4pe", "link": "https://stackoverflow.com/users/890793/sh4pe"}, "edited": false, "score": 0, "creation_date": 1513082439, "post_id": 47759885, "comment_id": 82506589, "body": "Thank you very much for your answer!"}], "tags": [], "owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "is_accepted": true, "score": 2, "last_activity_date": 1513020042, "creation_date": 1513020042, "answer_id": 47759885, "question_id": 47734895, "link": "https://stackoverflow.com/questions/47734895/error-because-type-variable-t-would-escape-its-scope-using-package-serv/47759885#47759885", "title": "Error: &quot;...because type variable \u2018t\u2019 would escape its scope&quot; using package &quot;servant&quot; in Haskell", "body": "<p>I wasn't able to reproduce the errors you saw using GHC 8.2.2.  Instead I got something along the lines of \u201cOverloaded signature conflicts with monomorphism restriction\u201d.</p>\n\n<p>I reproduced error messages you saw using an online GHC 7.10 compiler, so it seems GHC's errors have improved.  In both GHC 8.2 and 7.10, the error goes away if you enable <code>NoMonomorphismRestriction</code>, so that fixes the problem.</p>\n\n<p>My best guess is that when monomorphism restriction is enabled, the type of <code>queryFunction1 :&lt;|&gt; queryFunction2</code> is assumed to be fully monomorphic (no type parameters at all), because you did not declare its type signature (not that you could in this case!).  This conflicts with your type signatures for <code>queryFunction1</code> and <code>queryFunction2</code>, which both contain type parameters.</p>\n\n<p>Here is a minimal test that reproduces the exact issue:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>h :: Show z =&gt; (Maybe z, Maybe z)\nh = (Nothing, Nothing)\n\nf :: Show x =&gt; Maybe x\ng :: Show y =&gt; Maybe y\n(f, g) = h\n</code></pre>\n\n<p>To reproduce this kind of error, you need some kind of constraint (e.g. <code>Show</code>) and some kind of type constructor around the variable (e.g. <code>Maybe</code>).</p>\n\n<p>The errors you get in GHC 7.10 are:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>source_file.hs:6:1:\n    Couldn't match type \u2018z0\u2019 with \u2018x\u2019\n      because type variable \u2018x\u2019 would escape its scope\n    This (rigid, skolem) type variable is bound by\n      the inferred type for \u2018f\u2019: Show x =&gt; Maybe x\n      at source_file.hs:6:1-10\n    Expected type: forall x. Show x =&gt; Maybe x\n      Actual type: Maybe z0\n    When checking that \u2018f\u2019 has the specified type\n      f :: forall x. Show x =&gt; Maybe x\n    Probable cause: the inferred type is ambiguous\n\nsource_file.hs:6:1:\n    Couldn't match type \u2018z0\u2019 with \u2018y\u2019\n      because type variable \u2018y\u2019 would escape its scope\n    This (rigid, skolem) type variable is bound by\n      the inferred type for \u2018g\u2019: Show y =&gt; Maybe y\n      at source_file.hs:6:1-10\n    Expected type: forall y. Show y =&gt; Maybe y\n      Actual type: Maybe z0\n    When checking that \u2018g\u2019 has the specified type\n      g :: forall y. Show y =&gt; Maybe y\n    Probable cause: the inferred type is ambiguous\n\nsource_file.hs:6:10:\n    No instance for (Show z0) arising from a use of \u2018h\u2019\n    The type variable \u2018z0\u2019 is ambiguous\n    Relevant bindings include\n      f :: Maybe z0\n        (bound at source_file.hs:6:2)\n      g :: Maybe z0\n        (bound at source_file.hs:6:5)\n    Note: there are several potential instances:\n      instance Show a =&gt; Show (Maybe a) -- Defined in \u2018GHC.Show\u2019\n      instance Show Ordering -- Defined in \u2018GHC.Show\u2019\n      instance Show Integer -- Defined in \u2018GHC.Show\u2019\n      ...plus 22 others\n    In the expression: h\n    In a pattern binding: (f, g) = h\n</code></pre>\n"}], "owner": {"reputation": 1730, "user_id": 890793, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7b22cd8540bf40a30fd85e964a342be2?s=128&d=identicon&r=PG", "display_name": "Sh4pe", "link": "https://stackoverflow.com/users/890793/sh4pe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 548, "favorite_count": 0, "accepted_answer_id": 47759885, "answer_count": 1, "score": 3, "last_activity_date": 1513020042, "creation_date": 1512868049, "question_id": 47734895, "link": "https://stackoverflow.com/questions/47734895/error-because-type-variable-t-would-escape-its-scope-using-package-serv", "title": "Error: &quot;...because type variable \u2018t\u2019 would escape its scope&quot; using package &quot;servant&quot; in Haskell", "body": "<p>I'm building code for querying a REST API using <a href=\"https://hackage.haskell.org/package/servant-0.12\" rel=\"nofollow noreferrer\">servant</a>. For some of the endpoints, I want the return value to be dependent on some type <code>t</code>. When I'm trying to combine multiple such APIs using <code>:&lt;|&gt;</code>, I get a compile error. </p>\n\n<p>I've tried to build a boiled-down example of the problem. Sadly, the shortest version is still not very short. Here is my code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeOperators #-}\nmodule Sana.ArangoDB.RTest where\n\nimport Servant.API\nimport Servant.Client\nimport Data.Aeson.Types (typeMismatch)\nimport Data.Proxy (Proxy(..))\nimport Data.Yaml (FromJSON(..), (.:))\nimport qualified Data.Yaml as Y\n\ndata SomeStructure t = SomeStructure { _a :: Bool , _b :: t }\n\ninstance FromJSON t =&gt; FromJSON (SomeStructure t) where\n  parseJSON (Y.Object v) = SomeStructure &lt;$&gt; v .: \"a\" &lt;*&gt; v .: \"b\"\n  parseJSON i = typeMismatch \"SomeStructure\" i\n\ntype MyAPI t = \"api\" :&gt; Header \"SomeHeader\" String :&gt; Get '[JSON] (SomeStructure t)\ntype MyOtherAPI t = \"api2\" :&gt; Header \"SomeHeader\" String :&gt; Get '[JSON] (SomeStructure t)\n\ntype TheAPI t = MyAPI t :&lt;|&gt; MyOtherAPI t\n\ntheAPI :: Proxy (TheAPI t)\ntheAPI = Proxy\n\nqueryFunction1 :: (FromJSON t ) =&gt; Maybe String -&gt; ClientM (SomeStructure t)\nqueryFunction2 :: (FromJSON t ) =&gt; Maybe String -&gt; ClientM (SomeStructure t)\n\nqueryFunction1 :&lt;|&gt; queryFunction2 = client theAPI\n</code></pre>\n\n<p>This does not compile, however. The error I'm getting is this:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018t0\u2019 with \u2018t\u2019\n    because type variable \u2018t\u2019 would escape its scope\n  This (rigid, skolem) type variable is bound by\n    the inferred type for \u2018queryFunction1\u2019:\n      FromJSON t =&gt; Maybe String -&gt; ClientM (SomeStructure t)\n    at /Users/david/devel/sana/src/Sana/ArangoDB/RTest.hs:31:1-50\n  Expected type: Maybe String -&gt; ClientM (SomeStructure t)\n    Actual type: Maybe [Char] -&gt; ClientM (SomeStructure t0)\n</code></pre>\n\n<p>Does anybody have any advice how I could avoid this error and make my code work?</p>\n"}, {"tags": ["haskell", "functional-dependencies", "type-families"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512868914, "post_id": 47734825, "comment_id": 82430357, "body": "Note that <code>g = f @ X</code> also type checks. It seems that the inference algorithm does not commit to choosing the type variable <code>f</code> as <code>X</code>. I can&#39;t see why -- usually, it&#39;s because there could be another value of <code>f</code> making the type <code>(forall k. (F k ~ B f) =&gt; f k) -&gt; A</code> equal to <code>(forall k. (F k ~ B X) =&gt; X k) -&gt; A</code>. Here, <code>f ~ X</code> seems to be the unique solution to me (isn&#39;t it?). Interesting."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512871270, "post_id": 47734825, "comment_id": 82430739, "body": "@chi I think so, too, but I don\u2019t know enough about this particular case of the typechecker to confidently open a bug. Perhaps I ought to open a ticket anyway, and if it\u2019s intended behavior, I will at least probably learn why?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1512873914, "post_id": 47734825, "comment_id": 82431212, "body": "Interesting indeed! I&#39;ve now twice cycled my opinion as to whether this should actually typecheck with <i>neither</i> fundeps not type families, or only with fundeps, or with both. I just don&#39;t understand well enough how the constraints are resolved to decide. But at least I don&#39;t consider it implausible that only the fundep version should work: the crucial difference seems to be that typeclasses with their superclasses can be \u201cunravelled\u201d (the <code>f</code> be extracted out of <code>B f</code>), but from an equality constraint this is not possible."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1512914024, "post_id": 47734825, "comment_id": 82439218, "body": "Not an answer, but on your point &quot;I have heard people claim that functional dependencies like this one are equivalent to a type family plus an equality&quot; - yeah, it&#39;s a bit of an oversimplification. When you think about Core, you can see where the semantic differences come from. Type family instances are expressed as top-level coercions, so <code>type instance F Int = Bool</code> gets turned into <code>f_int :: F Int ~ Bool</code>. Fundeps just show up as constraints during unification, they don&#39;t affect coercions. That&#39;s why it&#39;s <a href=\"https://stackoverflow.com/q/43821747/1523776\">hard to convert between them</a>."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1512969672, "post_id": 47734825, "comment_id": 82453672, "body": "Sorry, I don&#39;t have an answer either, but a beware: you haven&#39;t shown the FunDep version &quot;allows <code>f</code> to be instantiated.&quot; Because you haven&#39;t declared any instances for <code>C</code> (and got <code>f</code> to work with them). Type family validation is more eager than for FunDeps. So you might have that actually the two forms are equivalent in the sense: the Type family form doesn&#39;t compile; the FunDep form has no inhabited instantiations for <code>f</code>. Perhaps that&#39;s why you can define only <code>f _ = undefined</code>. So declare an instance for <code>C</code>; try to apply <code>f</code> to something. Similarly try to apply <code>g</code>."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1512972229, "post_id": 47734825, "comment_id": 82454528, "body": "@AntC This is a reduction of a larger actual example where <code>C</code> is actually <code>Reifies</code> from <code>Data.Reflection</code>. I assure you, it really does typecheck without any bottoms anywhere <i>and</i> after applying <code>g</code>. You can even get this example to typecheck without bottoms yourself by changing <code>C</code> to <code>Reifies</code> and changing <code>f</code>\u2019s definition to <code>f m = reify B (\\(_ :: Proxy s) -&gt; m @s </code>seq` A)` (after making <code>A</code> and <code>B</code> inhabited, of course)."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1514853450, "post_id": 47734825, "comment_id": 83081125, "body": "to answer @chi&#39;s first comment: with <code>g = f</code>, yes that fixes the types s.t. <code>f ~ X</code>. If you take out the definition for <code>g</code>, then <code>f</code> can be any constructor type -- such as <code>Maybe</code>."}], "answers": [{"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1512876768, "post_id": 47735521, "comment_id": 82431674, "body": "While what you say makes some sense, I\u2019m a little skeptical of this answer. Here\u2019s why: if you change <code>data B</code> to <code>type family B</code>, the version with the functional dependency still typechecks! This seems like it would contradict your explanation for why the fundep version works the way it does, since <code>B f ~ B X</code> does not imply <code>f ~ X</code> if <code>B</code> is a type family."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1512875834, "creation_date": 1512875834, "answer_id": 47735521, "question_id": 47734825, "link": "https://stackoverflow.com/questions/47734825/why-does-this-haskell-code-typecheck-with-fundeps-but-produce-an-untouchable-err/47735521#47735521", "title": "Why does this Haskell code typecheck with fundeps but produce an untouchable error with type families?", "body": "<p>I don't know if I should post this as an answer because it's still pretty hand-wavey, but I do think this is what's essentially going on:</p>\n\n<p>To evaluate a <code>(C k (B X)) =&gt; X k</code> value, you have to choose a concrete type for <code>k</code>, and point to the <code>instance C k (B X)</code> that fulfills the constraints. To do that, you must phrase out that the typeclass' <code>a</code> argument has the form <code>B f</code>, from which the compiler can extract the <code>f</code> type (and find out that it's <code>X</code> in this case) &ndash; importantly, it can do this <em>before actually looking at the instance</em>, which would be the point at which <code>f</code> would become untouchable.</p>\n\n<p>To evaluate a <code>(F k ~ B X) =&gt; X k</code>, it's a bit different. Here you don't need to point to a concrete instance, you merely need to guarantee that <em>if the compiler looked up</em> the typefamily for <code>F k</code>, then this type would be the same type as <code>B X</code>. But before actually looking up the instance, the compiler cannot here infer that <code>F k</code> has the form <code>B f</code>, and hence also not use this to unify <code>f</code> with the outer quantification argument because of untouchable.</p>\n\n<p>Therefore, GHC's behaviour is at least not completely unreasonable. I'm still not sure if it <em>should</em> behave this way.</p>\n"}, {"comments": [{"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 0, "creation_date": 1514855325, "post_id": 48048570, "comment_id": 83081401, "body": "BTW you get a similar <code>f0 is untouchable</code> rejection with this signature <code>f :: forall f. (forall k. f ~ X =&gt; f k) -&gt; A</code>. No Type Family or FunDep in sight."}], "tags": [], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "is_accepted": false, "score": 1, "last_activity_date": 1514801204, "last_edit_date": 1514801204, "creation_date": 1514799467, "answer_id": 48048570, "question_id": 47734825, "link": "https://stackoverflow.com/questions/47734825/why-does-this-haskell-code-typecheck-with-fundeps-but-produce-an-untouchable-err/48048570#48048570", "title": "Why does this Haskell code typecheck with fundeps but produce an untouchable error with type families?", "body": "<p>OK I've had a chance to play with this. There's several distractions:</p>\n\n<p>In the Type Family version, just the definition for <code>f</code> gives error <code>'f0' is untouchable</code>. (You can suppress that with <code>AllowAmbiguousTypes</code>; that just postpones the error to appear against <code>g</code>.) Let's ignore <code>g</code> here on.</p>\n\n<p>Then without <code>AllowAmbiguousTypes</code>, the error message for f gives more info:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018f0\u2019 with \u2018f\u2019\n    \u2018f0\u2019 is untouchable\n      inside the constraints: F k ~ B f0\n      bound by the type signature for:\n                 f :: F k ~ B f0 =&gt; f0 k\n  \u2018f\u2019 is a rigid type variable bound by\n    the type signature for:\n      f :: forall (f :: * -&gt; *). (forall k. F k ~ B f =&gt; f k) -&gt; A\n  Expected type: f0 k\n    Actual type: f k\n</code></pre>\n\n<p>Aha! a <code>rigid type variable</code> problem. I guess because <code>f</code> is fixed by the equality constraint from <code>k</code>, which is also rigid because ...</p>\n\n<p>Turning to the <code>FunDep</code> version without <code>g</code>, at what types can we call <code>f</code>? Try</p>\n\n<pre><code>f (undefined undefined :: X a)           -- OK\nf (undefined \"string\"  :: X String)      -- rejected\nf  Nothing                               -- OK\nf (Just 'c')                             -- rejected\n</code></pre>\n\n<p>The rejection message (for the <code>X String</code> example) is</p>\n\n<pre><code>\u2022 Couldn't match type \u2018k\u2019 with \u2018String\u2019\n  \u2018k\u2019 is a rigid type variable bound by\n    a type expected by the context:\n      forall k. C k (B X) =&gt; X k\n  Expected type: X k\n    Actual type: X String\n\u2022 In the first argument of \u2018f\u2019, namely\n    \u2018(undefined \"string\" :: X String)\u2019\n</code></pre>\n\n<p>Note the message is about <code>k</code>, <em>not</em> <code>f</code> which is determined from the FunDep -- or would be if we could find a suitable <code>k</code>.</p>\n\n<p><strong>Explanation</strong></p>\n\n<p>The signature for function <code>f</code> says <code>k</code> is existentially quantified/higher ranked. Then we can't allow any type information about <code>k</code> to escape into the surrounding context. We can't supply any (non-bottom) value for <code>k</code>, because its type would invade the <code>forall</code>.</p>\n\n<p>Here's a simpler example:</p>\n\n<pre><code>f2 :: forall f. (forall k. f k) -&gt; A\nf2 _ = undefined\n\nf2 Nothing                                 -- OK\nf2 (Just 'c')                              -- rejected rigid type var\n</code></pre>\n\n<p>So that the original <code>FunDep</code> version compiles is a distraction: it can't be inhabited. (And that's a common symptom with <code>FunDep</code>s, as per my earlier suspicion.)</p>\n"}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 430, "favorite_count": 2, "answer_count": 2, "score": 10, "last_activity_date": 1514801204, "creation_date": 1512867238, "question_id": 47734825, "link": "https://stackoverflow.com/questions/47734825/why-does-this-haskell-code-typecheck-with-fundeps-but-produce-an-untouchable-err", "title": "Why does this Haskell code typecheck with fundeps but produce an untouchable error with type families?", "body": "<p>Given some type definitions:</p>\n\n<pre><code>data A\ndata B (f :: * -&gt; *)\ndata X (k :: *)\n</code></pre>\n\n<p>\u2026and this typeclass:</p>\n\n<pre><code>class C k a | k -&gt; a\n</code></pre>\n\n<p>\u2026these (highly contrived for the purposes of a minimal example) function definitions typecheck:</p>\n\n<pre><code>f :: forall f. (forall k. (C k (B f)) =&gt; f k) -&gt; A\nf _ = undefined\n\ng :: (forall k. (C k (B X)) =&gt; X k) -&gt; A\ng = f\n</code></pre>\n\n<p>However, if we use a type family instead of a class with a functional dependency:</p>\n\n<pre><code>type family F (k :: *)\n</code></pre>\n\n<p>\u2026then the equivalent function definitions fail to typecheck:</p>\n\n<pre><code>f :: forall f. (forall k. (F k ~ B f) =&gt; f k) -&gt; A\nf _ = undefined\n\ng :: (forall k. (F k ~ B X) =&gt; X k) -&gt; A\ng = f\n</code></pre>\n\n<p></p>\n\n<pre><code>\u2022 Couldn't match type \u2018f0\u2019 with \u2018X\u2019\n    \u2018f0\u2019 is untouchable\n      inside the constraints: F k ~ B f0\n      bound by a type expected by the context:\n                 F k ~ B f0 =&gt; f0 k\n  Expected type: f0 k\n    Actual type: X k\n\u2022 In the expression: f\n  In an equation for \u2018g\u2019: g = f\n</code></pre>\n\n<p>I read Section 5.2 of <a href=\"https://www.microsoft.com/en-us/research/publication/outsideinx-modular-type-inference-with-local-assumptions/\" rel=\"noreferrer\">the OutsideIn(X) paper</a>, which describes touchable and untouchable type variables, and I <em>sort of</em> understand what\u2019s going on here. If I add an extra argument to <code>f</code> that pushes the choice of <code>f</code> outside the inner <code>forall</code>, then the program typechecks:</p>\n\n<pre><code>f :: forall f a. f a -&gt; (forall k. (F k ~ B f) =&gt; f k) -&gt; A\nf _ _ = undefined\n\ng :: forall a. X a -&gt; (forall k. (F k ~ B X) =&gt; X k) -&gt; A\ng = f\n</code></pre>\n\n<p>However, what specifically has me so confused in this particular example is why the functional dependency has different behavior. I have heard people claim at various times that functional dependencies like this one are equivalent to a type family plus an equality, but this demonstrates that isn\u2019t actually true.</p>\n\n<p>What information does the functional dependency provide in this case that allows <code>f</code> to be instantiated in a way that the type family does not?</p>\n"}, {"tags": ["csv", "haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1512857953, "post_id": 47733766, "comment_id": 82428143, "body": "<code>if x then True else False</code> better written as <code>x</code>."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1512859945, "post_id": 47733766, "comment_id": 82428638, "body": "<code>when x y = if x then y else return ()</code>. <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Debugging/CompiledCode\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/wiki/Debugging/CompiledCode</a> might let you figure out which of your dependencies causes this, so you can file an issue on their github."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512860030, "post_id": 47733766, "comment_id": 82428663, "body": "How large is your &quot;large CSV&quot;? Check if your program is simply allocating too much, using some resource monitor."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1512861328, "post_id": 47733766, "comment_id": 82428922, "body": "You could try shrinking your input files until the problem goes away to find a minimal example, then remove code as long as that doesn&#39;t get rid of the segfault, and so on. In particular, if you manage to only directly use Cassava&#39;s code and still get a segfault, you can go to their github immediately. (afaik segfaults in Haskell imply you used Unsafe modules or it&#39;s somebody elses problem, corollary: it doesn&#39;t happen whenever one allocates too much)"}, {"owner": {"reputation": 11, "user_id": 9077923, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/671b9385b3fd1eef3c8337ee885d619b?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan Ford", "link": "https://stackoverflow.com/users/9077923/ryan-ford"}, "edited": false, "score": 0, "creation_date": 1512921409, "post_id": 47733766, "comment_id": 82441317, "body": "@ago I reduced the size of the files and it works now, so what can I do to make the bigger files work? Do I allocate more memory to the program, and how would I do that?"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1517610768, "post_id": 47733766, "comment_id": 84180869, "body": "The program should arguably be able to allocate memory as it requires it. However, there are options to control its mechanisms more granularly documented here: <a href=\"http://downloads.haskell.org/~ghc//8.2.2/docs/html/users_guide/runtime_control.html#rts-options-to-control-the-garbage-collector\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc//8.2.2/docs/html/users_guide/&hellip;</a>"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1517613254, "post_id": 47733766, "comment_id": 84181676, "body": "@RyanFord btw can you provide an indication of what size file started with that caused this problem? I&#39;d like to see if it can be reproduced..."}], "owner": {"reputation": 11, "user_id": 9077923, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/671b9385b3fd1eef3c8337ee885d619b?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan Ford", "link": "https://stackoverflow.com/users/9077923/ryan-ford"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1512857714, "creation_date": 1512857714, "question_id": 47733766, "link": "https://stackoverflow.com/questions/47733766/haskell-segmentation-fault-using-big-csv-file-and-cassava", "title": "Haskell: Segmentation Fault using big CSV file and Cassava", "body": "<p>I am trying to use cassava with 2 large CSV files. The code compiles, but just gives 'Segmentation Fault' when I run it. Here is the full code:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Applicative\nimport qualified Data.ByteString.Internal\nimport qualified Data.ByteString.Lazy as BL\nimport qualified Data.ByteString.Lazy.Search as BLS\nimport Data.Csv\nimport Data.Char\nimport qualified Data.Vector as V\n\nlang1 :: String\nlang1 = \"eng\"\n\npattern :: Data.ByteString.Internal.ByteString\npattern = \"\"\n\ncheckIfLang :: String -&gt; Bool\ncheckIfLang x =\nif x == lang1\n    then True\n    else False\n\nmyOptions = defaultDecodeOptions {\n  decDelimiter = fromIntegral (ord '\\t')\n}\n\nmain :: IO ()\nmain = do\nsentenceCSV &lt;- BL.readFile \"sentenceData/sentences.csv\"\nlinksCSV &lt;- BL.readFile \"sentenceData/links.csv\"\ncase decodeWith myOptions NoHeader (BLS.replace \"\\\"\" pattern sentenceCSV) of\n    Left err -&gt; putStrLn err\n    Right v -&gt; V.forM_ v $ \\ (id :: Int, lang :: String, sentence :: String) -&gt;\n        if checkIfLang lang\n          then do putStrLn $ show id ++ \" has lang of \" ++ lang ++ \"and is:\"\n                  putStrLn $ sentence\n          else return ()\n</code></pre>\n\n<p>I am unsure what to do, since I can't figure out how to do it from just googling. Any corrections, even if not related to my problem, will help me a lot in learning Haskell. I am extremely new to it.</p>\n"}, {"tags": ["list", "haskell", "int", "prefix"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1512854909, "post_id": 47733248, "comment_id": 82427278, "body": "<code>[5,6]</code> is <i>not</i> a prefix of <code>[1,5,6,7]</code>, <code>[1,5,6]</code> is. <code>[5,6]</code> is a <i>sublist</i> of <code>[1,5,6,7]</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1512854968, "post_id": 47733248, "comment_id": 82427295, "body": "<a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Data-List.html#v:isPrefixOf\" rel=\"nofollow noreferrer\">hackage.haskell.org/packages/archive/base/latest/doc/html/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 8863334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab38d2ef8fd5564b21653289447123bc?s=128&d=identicon&r=PG&f=1", "display_name": "Nasser", "link": "https://stackoverflow.com/users/8863334/nasser"}, "edited": false, "score": 1, "creation_date": 1512943855, "post_id": 47733322, "comment_id": 82448103, "body": "@CommuSoft Much appreciated!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1512854433, "creation_date": 1512854433, "answer_id": 47733322, "question_id": 47733248, "link": "https://stackoverflow.com/questions/47733248/haskell-check-if-the-first-list-is-a-prefix-of-the-second/47733322#47733322", "title": "Haskell: Check if the first list is a prefix of the second", "body": "<p>Your code does not make much sense if we look at the types:</p>\n\n<pre><code>prefix [Int] -&gt; [Int] -&gt; Bool \nprefix [] [] = [] \nprefix y (x:xs)  \n| x == y    = prefix y xs \n| otherwise = 0\n</code></pre>\n\n<p>Since the two arguments are lists (<code>[Int]</code>), this thus means that <code>y</code> is an <code>[Int]</code>, <code>x</code> is an <code>Int</code>, and <code>xs</code> is an <code>[Int]</code>. But then you compare <code>x == y</code>, you can not compare a list with an element. <code>(==)</code> is defined as <code>(==) :: Eq a =&gt; a -&gt; a -&gt; Bool</code>.</p>\n\n<p>There are also other problems here: you return a list in the first clause, but the return type is a <code>Bool</code>, and later you return a <code>0</code> (again, it should be a <code>Bool</code>).</p>\n\n<p>In case we define a function, we first need to define a certain model for it. When is a list <em>l1</em> a prefix of a list <em>l2</em>? In case <em>l1</em> is an empty list, then <em>l1</em> is always a prefix, regardless of the value of the second list, so:</p>\n\n<pre><code>prefix [] _ = True\n</code></pre>\n\n<p>In case <em>l1</em> is a list (i.e. <code>(x:xs)</code>), then it is <em>not</em> a prefix in two cases: (1) in case <em>l2</em> is an empty list; and (2) in case the first item of <em>l2</em> (<code>y</code> in <code>(y:ys))</code> is not equal to <code>x</code>, so:</p>\n\n<pre><code>prefix _ [] = False\nprefix (x:xs) (y:ys) | x /= y = False\n                     | otherwise = ...\n</code></pre>\n\n<p>Now the question is what to do with <code>prefix (x:xs) (y:ys)</code> in case <code>x == y</code>. In that case we recurse on the two list, so the result of <code>prefix (x:xs) (y:ys) == prefix xs ys</code> (only in case <code>x == y</code>), so:</p>\n\n<pre><code>                     | otherwise = prefix xs ys\n</code></pre>\n\n<p>Or now in full:</p>\n\n<pre><code>prefix :: [Int] -&gt; [Int] -&gt; Bool\nprefix [] _ = True\nprefix _ [] = False\nprefix (x:xs) (y:ys) | x /= y = False\n                     | otherwise = prefix xs ys\n</code></pre>\n\n<p>We can further generalize the expression to <code>Eq a =&gt; [a] -&gt; [a] -&gt; Bool</code> such that it works with <em>any</em> type <code>a</code> that is an <code>Eq</code> instance (so there is a <code>(==)</code> instance defined over <code>a</code>):</p>\n\n<pre><code>prefix :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\nprefix [] _ = True\nprefix _ [] = False\nprefix (x:xs) (y:ys) | x /= y = False\n                     | otherwise = prefix xs ys\n</code></pre>\n\n<p>We can also swap the conditions, since usually <em>positive logic</em> is easier to understand than negative logic:</p>\n\n<pre><code>prefix :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\nprefix [] _ = True\nprefix _ [] = False\nprefix (x:xs) (y:ys) | x == y = prefix xs ys\n                     | otherwise = False\n</code></pre>\n\n<p>now we can furthermore remove the guards, and use an <code>(&amp;&amp;) :: Bool -&gt; Bool -&gt; Bool</code> instead:</p>\n\n<pre><code>prefix :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\nprefix [] _ = True\nprefix _ [] = False\nprefix (x:xs) (y:ys) = x == y &amp;&amp; prefix xs ys\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 8863334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab38d2ef8fd5564b21653289447123bc?s=128&d=identicon&r=PG&f=1", "display_name": "Nasser", "link": "https://stackoverflow.com/users/8863334/nasser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1204, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1512903715, "creation_date": 1512853926, "last_edit_date": 1512903715, "question_id": 47733248, "link": "https://stackoverflow.com/questions/47733248/haskell-check-if-the-first-list-is-a-prefix-of-the-second", "title": "Haskell: Check if the first list is a prefix of the second", "body": "<p>I am trying to write a program that checks if the first list is a prefix of the second list. for example, [5,6] is prefix of [1,5,6,7]. here is my working code but basically I don't have an idea on how to do it.</p>\n\n<pre><code>prefix [Int] -&gt; [Int] -&gt; Bool \nprefix [] [] = [] \nprefix y (x:xs)  \n| x == y    = prefix y xs \n| otherwise = 0 \n</code></pre>\n\n<p>any help please ? </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1512854584, "post_id": 47733282, "comment_id": 82427199, "body": "After I wrote this question, I peeked at the core and discovered, to my surprise, that type equalities have runtime witnesses, at least at the core level. Is there some information somewhere about how type equality witnesses work? Can I (unsafely) provide something else in place of the equality witness? Changing my code ever so slightly to <code>unsafeCoerce (Magic k :: Magic a r) (const a) () Proxy</code> works, but I\u2019m afraid it might not always work."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1512854647, "post_id": 47733282, "comment_id": 82427212, "body": "@AlexisKing, that&#39;s a good question to which I do not know the answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1512854796, "post_id": 47733282, "comment_id": 82427255, "body": "@AlexisKing, another option (I think) might be to make <code>reflect&#39;</code> return a GADT giving evidence that <code>a ~ Reflects s</code>. I haven&#39;t worked through that yet."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1512855046, "post_id": 47733282, "comment_id": 82427310, "body": "@AlexisKing, Actually, I might have an answer... Look at &quot;System F with Type Equality Coercions&quot;. Find a version with the post-publication appendix. That probably explains things to people like you (and unlike me) who understand all that type theory stuff."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1512855107, "post_id": 47733282, "comment_id": 82427323, "body": "I think you gravely overestimate how much I understand what I\u2019m doing. :) But thanks, I\u2019ll take a look."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1512855709, "post_id": 47733282, "comment_id": 82427457, "body": "@AlexisKing, you wrote a type checker in <code>syntax-case</code>. That&#39;s nothing to sneeze at."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 6, "last_activity_date": 1512854826, "last_edit_date": 1512854826, "creation_date": 1512854202, "answer_id": 47733282, "question_id": 47732667, "link": "https://stackoverflow.com/questions/47732667/is-it-possible-to-implement-data-reflection-s-trick-using-type-families-instead/47733282#47733282", "title": "Is it possible to implement Data.Reflection\u2019s trick using type families instead of fundeps?", "body": "<p>The <code>unsafeCoerce</code> trick takes advantage of the fact that</p>\n\n<pre><code>Reifies s a =&gt; Proxy s -&gt; r\n</code></pre>\n\n<p>has exactly the same representation, at run-time, as</p>\n\n<pre><code>a -&gt; Proxy s -&gt; r\n</code></pre>\n\n<p>By enlarging the constraint to <code>(Reifies s a, a ~ Reflects s)</code>, you violate this critical assumption. There are several ways to fix this. Here's one:</p>\n\n<pre><code>{-# language MultiParamTypeClasses, TypeFamilies, PolyKinds, KindSignatures,\n       RankNTypes, ScopedTypeVariables, TypeOperators #-}\nmodule TFReifies where\nimport Data.Proxy\nimport Unsafe.Coerce\nimport Data.Type.Equality\n\nclass Reifies s a where\n  type Reflects s :: *\n  reflect' :: proxy s -&gt; a\n\nreflect :: (Reifies s a, a ~ Reflects s) =&gt; proxy s -&gt; a\nreflect = reflect'\n\n\nnewtype Magic a r = Magic (forall (s :: *). (Reifies s a) =&gt; Proxy s -&gt; r)\n\nreify' :: forall a r. a -&gt; (forall (s :: *). (Reifies s a) =&gt; Proxy s -&gt; r) -&gt; r\nreify' a k = unsafeCoerce (Magic k :: Magic a r) (const a) Proxy\n\nreify :: forall a r. a -&gt; (forall (s :: *). (Reifies s a, a ~ Reflects s) =&gt; Proxy s -&gt; r) -&gt; r\nreify a f = reify' a (\\(p :: Proxy s) -&gt; case unsafeCoerce Refl :: a :~: Reflects s of Refl -&gt; f p)\n</code></pre>\n\n<hr>\n\n<p>Here's a version closer to yours:</p>\n\n<pre><code>class Reifies s where\n  type Reflects s :: *\n  reflect :: proxy s -&gt; Reflects s\n\nnewtype Magic a r = Magic (forall (s :: *). (Reifies s) =&gt; Proxy s -&gt; r)\n\nreify :: forall a r. a -&gt; (forall (s :: *). (Reifies s, a ~ Reflects s) =&gt; Proxy s -&gt; r) -&gt; r\nreify a f = reify' a (\\(p :: Proxy s) -&gt; case unsafeCoerce Refl :: a :~: Reflects s of Refl -&gt; f p)\n  where\n    -- This function is totally bogus in other contexts, so we hide it.\n    reify' :: forall a r. a -&gt; (forall (s :: *). (Reifies s) =&gt; Proxy s -&gt; r) -&gt; r\n    reify' a k = unsafeCoerce (Magic k :: Magic a r) (const a) Proxy\n</code></pre>\n"}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 1, "accepted_answer_id": 47733282, "answer_count": 1, "score": 7, "last_activity_date": 1512854826, "creation_date": 1512849965, "question_id": 47732667, "link": "https://stackoverflow.com/questions/47732667/is-it-possible-to-implement-data-reflection-s-trick-using-type-families-instead", "title": "Is it possible to implement Data.Reflection\u2019s trick using type families instead of fundeps?", "body": "<p>The GHC implementation of <a href=\"https://hackage.haskell.org/package/reflection/docs/Data-Reflection.html\" rel=\"noreferrer\"><code>Data.Reflection</code></a> from the <a href=\"https://hackage.haskell.org/package/reflection\" rel=\"noreferrer\"><code>reflection</code></a> package uses a trick involving <code>unsafeCoerce</code> that takes advantage of the way GHC compiles typeclasses using dictionary passing. The implementation is short, so I can reproduce it in its entirety here:</p>\n\n<pre><code>class Reifies s a | s -&gt; a where\n  reflect :: proxy s -&gt; a\n\nnewtype Magic a r = Magic (forall (s :: *). Reifies s a =&gt; Proxy s -&gt; r)\n\nreify :: forall a r. a -&gt; (forall (s :: *). Reifies s a =&gt; Proxy s -&gt; r) -&gt; r\nreify a k = unsafeCoerce (Magic k :: Magic a r) (const a) Proxy\n</code></pre>\n\n<p>This makes it possible to reify a value at the type level, then reflect it back:</p>\n\n<pre><code>ghci&gt; reify (42 :: Integer) (\\p -&gt; reflect p) :: Integer\n42\n</code></pre>\n\n<p>I was interested in using this technique, but I thought it would be convenient for my purposes to use a type family with <code>Reifies</code> rather than a functional dependency, so I attempted to rewrite the implementation using the usual transformation:</p>\n\n<pre><code>class Reifies s where\n  type Reflects s\n  reflect :: Proxy s -&gt; Reflects s\n\nnewtype Magic a r = Magic (forall (s :: *). (Reifies s, Reflects s ~ a) =&gt; Proxy s -&gt; r)\n\nreify :: forall a r. a -&gt; (forall (s :: *). (Reifies s, Reflects s ~ a) =&gt; Proxy s -&gt; r) -&gt; r\nreify a k = unsafeCoerce (Magic k :: Magic a r) (const a) Proxy\n</code></pre>\n\n<p>Sadly, however, this no longer works! This changes compilation significantly enough to break the <code>unsafeCoerce</code> trick:</p>\n\n<pre><code>ghci&gt; reify (42 :: Integer) (\\p -&gt; reflect p) :: Integer\n2199023255808\n</code></pre>\n\n<p>However, I\u2019m not familiar enough with how GHC works to understand why. Is it possible to implement <code>Data.Reflection</code> using an associated type instead of a functional dependency? If so, what needs to change? If not, why not?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512859551, "post_id": 47732502, "comment_id": 82428555, "body": "I&#39;d consider that to be an antipattern. Just use a <code>data MBR = MBR [DateSpan] [MultiBalanceReportRow] MultiBalanceReportTotals</code> and avoid the tupling, using only the <code>MBR</code> constructor."}], "answers": [{"tags": [], "owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "is_accepted": false, "score": 4, "last_activity_date": 1512849155, "creation_date": 1512849155, "answer_id": 47732532, "question_id": 47732502, "link": "https://stackoverflow.com/questions/47732502/haskell-retrieve-nth-value-from-type-which-is-a-tuple/47732532#47732532", "title": "Haskell: Retrieve nth value from type which is a tuple", "body": "<p>You need to include the newtype in your pattern match</p>\n\n<pre><code>getDates :: MultiBalanceReport -&gt; [DateSpan]\ngetDates (MultiBalanceReport (date,_,_)) = date\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 3, "last_activity_date": 1512849210, "creation_date": 1512849210, "answer_id": 47732544, "question_id": 47732502, "link": "https://stackoverflow.com/questions/47732502/haskell-retrieve-nth-value-from-type-which-is-a-tuple/47732544#47732544", "title": "Haskell: Retrieve nth value from type which is a tuple", "body": "<p>You're really close. You're pattern matching on a tuple type, but the actual value you have is a <code>MultiBalanceReport</code> which <em>contains</em> a tuple.</p>\n\n<pre><code>getDates :: MultiBalanceReport -&gt; [DateSpan]\ngetDates (MultiBalanceReport (date,_,_)) = date\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1512849229, "creation_date": 1512849229, "answer_id": 47732549, "question_id": 47732502, "link": "https://stackoverflow.com/questions/47732502/haskell-retrieve-nth-value-from-type-which-is-a-tuple/47732549#47732549", "title": "Haskell: Retrieve nth value from type which is a tuple", "body": "<p>A <code>newtype</code> is a data type <strong>with a constructor</strong>, so you need to <strong>unwrap</strong> the tuple out of the constructor <code>MultiBalanceReport</code> first:</p>\n\n<pre><code>getDates :: MultiBalanceReport -&gt; [DateSpan]\ngetDates <b>(MultiBalanceReport</b> (date,_,_)<b>)</b> = date</code></pre>\n"}], "owner": {"reputation": 363, "user_id": 4514393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PYwMM.png?s=128&g=1", "display_name": "jeevcat", "link": "https://stackoverflow.com/users/4514393/jeevcat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 47732549, "answer_count": 3, "score": 3, "last_activity_date": 1513093529, "creation_date": 1512848954, "last_edit_date": 1513093529, "question_id": 47732502, "link": "https://stackoverflow.com/questions/47732502/haskell-retrieve-nth-value-from-type-which-is-a-tuple", "title": "Haskell: Retrieve nth value from type which is a tuple", "body": "<p>I am trying to access some data inside a type from an imported package. </p>\n\n<p>The type is declared (by the package authors) as so:</p>\n\n<pre><code>newtype MultiBalanceReport =\n  MultiBalanceReport ([DateSpan]\n                     ,[MultiBalanceReportRow]\n                     ,MultiBalanceReportTotals\n                     )\n</code></pre>\n\n<p>And I'm trying to extract the first list in the type with a function like so:</p>\n\n<pre><code>getDates :: MultiBalanceReport -&gt; [DateSpan]\ngetDates (date,_,_) = date\n</code></pre>\n\n<p>But when I use the function, the compiler complains that the types aren't the same:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018MultiBalanceReport\u2019\n              with actual type \u2018([DateSpan], t7, t8)\u2019\n</code></pre>\n\n<p>I feel like the compiler just doesn't know the inner details of the <code>MultiBalanceReport</code> type? Am I not importing the package which defines the type correctly? </p>\n\n<p>I'm new to Haskell, so sorry if I'm using the wrong nomenclature to try to describe my problem.</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 2, "creation_date": 1512846948, "post_id": 47732100, "comment_id": 82424911, "body": "<code>randomIO :: IO Float</code> will produce a float between 0 and 1, so what you probably mean to do here is compare <code>num</code> with <code>0.7</code> rather than <code>7</code>."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1512847547, "last_edit_date": 1592644375, "creation_date": 1512847547, "answer_id": 47732282, "question_id": 47732100, "link": "https://stackoverflow.com/questions/47732100/random-io-typing-in-haskell/47732282#47732282", "title": "Random IO typing in haskell", "body": "<p><code>randomIO</code> works like <a href=\"https://hackage.haskell.org/package/random-1.1/docs/System-Random.html#v:random\" rel=\"nofollow noreferrer\"><code>random</code></a>, which uses <code>[0,1)</code> for fractional types.</p>\n<blockquote>\n<pre><code>random :: RandomGen g =&gt; g -&gt; (a, g)\n</code></pre>\n<p>The same as <code>randomR</code>, but using a default range determined by the type:</p>\n<ul>\n<li>For bounded types (instances of Bounded, such as Char), the range is normally the whole type.</li>\n<li><em><strong>For fractional types, the range is normally the semi-closed interval [0,1).</strong></em> [emphasis mine]</li>\n<li>For Integer, the range is (arbitrarily) the range of <code>Int</code>.</li>\n</ul>\n</blockquote>\n<p>Use <a href=\"https://hackage.haskell.org/package/random-1.1/docs/System-Random.html#v:randomRIO\" rel=\"nofollow noreferrer\"><code>randomRIO</code></a> instead, e.g.</p>\n<pre><code>num &lt;- randomRIO (0, 10) :: IO Float\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 8303951, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6cd7cd0fc6bf782e041f0f641f3cf29a?s=128&d=identicon&r=PG&f=1", "display_name": "Joao Albuquerque", "link": "https://stackoverflow.com/users/8303951/joao-albuquerque"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 310, "favorite_count": 0, "accepted_answer_id": 47732282, "answer_count": 1, "score": 0, "last_activity_date": 1512847547, "creation_date": 1512846281, "question_id": 47732100, "link": "https://stackoverflow.com/questions/47732100/random-io-typing-in-haskell", "title": "Random IO typing in haskell", "body": "<p>I want the function to draw a number, and if it is greater than 7, send an approval message and call this add function.</p>\n\n<p>However, my function only falls on the 'else'. The \"disapproved\" message appears. I think it's the IO Float typing with Float. How can I solve this?</p>\n\n<pre><code>mySort:: Float -&gt; Int\nmySort = ceiling(10 * x)\n\n\nnumberSort:: IO ()\nnumberSort = do    \n    num &lt;- randomIO :: IO Float\n    print $ mySort num\n    if(num &gt;= 7) then\n        do\n            putStrLn (\"approved!\" ++ \"\\n\") &gt;&gt; add\n        else\n        do\n            putStrLn \"disapproved!\"\n</code></pre>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1512837448, "post_id": 47730695, "comment_id": 82421895, "body": "How much do you understand about lazy evaluation? You need to understand this before you can understand strictness."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1512838645, "post_id": 47730695, "comment_id": 82422280, "body": "When there is only one argument, I think you understand it pretty well. With multiple arguments, it&#39;s more subtle. Sometimes, as in <code>const x y</code> one argument is evaluated, another is not, so it&#39;s clear. Sometimes, as in your other example, we have &quot;conditional strictness&quot; in the sense that some argument may be evaluated or not, depending on the others. I&#39;m unsure about a completely standard, widespread term for such cases. (IIRC GHC&#39;s internal strictness analyzer calls &quot;absent&quot; those args which are surely never evaluated, &quot;strict&quot; those who surely always are, and &quot;lazy&quot; the rest)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512838830, "post_id": 47730695, "comment_id": 82422333, "body": "By the way, I think your doubt is about the multi-argument case, not the single argument one (which I believe you understood). If so, I&#39;d suggest to make the title more precise."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1512839223, "post_id": 47730949, "comment_id": 82422461, "body": "Yikes, after a bit of thought, I can&#39;t work out a really good convention for when to <code>monospace</code> things in this answer, so the formatting here is a bit inconsistent. Please let me know if the formatting has caused confusion and I&#39;ll try again."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1512843447, "post_id": 47730949, "comment_id": 82423894, "body": "I think it&#39;s a bit of a stretch to claim that <code>const</code> is applied to three arguments, even when treating curried functions as if they were multi-argument functions."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 7, "last_activity_date": 1512839327, "last_edit_date": 1512839327, "creation_date": 1512838909, "answer_id": 47730949, "question_id": 47730695, "link": "https://stackoverflow.com/questions/47730695/what-is-strictness/47730949#47730949", "title": "What is strictness?", "body": "<p>\"Strict\" is one of those words that has a precise technical meaning that has been coopted by the community to mean something a bit less formal. Here's the technical definition.</p>\n\n<h3>Function <code>f</code> is <em>strict</em> if <code>f \u22a5 = \u22a5</code>.</h3>\n\n<p>Here \u22a5 is the standard symbol for an undefined computation; generally in denotational semantics there is just one and all undefined computations are indistinguishable from each other, but in Haskell as a concession to practicality we have many different kinds that can be distinguished: exceptions, infinite loops, pattern match failures, and so on. For the purposes of this answer, we'll consider them all equal.</p>\n\n<p>Let's ask if <code>const</code> is strict. We have</p>\n\n<pre><code>const = \\x -&gt; \\y -&gt; x\n</code></pre>\n\n<p>hence</p>\n\n<pre><code>const \u22a5 = \\y -&gt; \u22a5 \u2260 \u22a5\n</code></pre>\n\n<p>and therefore <code>const</code> is not strict. But, oh, we've lost some very important communication power here! There is a good sense in which, when applied to undefined behavior, <code>const</code> doesn't behave well. So many people will say \"strict in the <em>n</em>th argument\" and we'll pretty much understand what they mean. It isn't obvious how to define what they mean formally, but a half-decent first stab at it goes something like this:</p>\n\n<h3>If function <code>f</code> has <em>m</em> arguments, then it is <em>strict in the nth argument</em> for some <em>n</em> \u2264 <em>m</em> when \u2200 a1, ..., am. f a1 a2 ... a(n-1) \u22a5 a(n+1) ... am = \u22a5.</h3>\n\n<p>(Aside: why isn't this quite right? For many functions -- including <code>const</code> -- we can't statically know how many arguments it has. Although <code>const</code> looks like it might be a two-argument function, <code>const id () ()</code> is perfectly well typed and applies <code>const</code> to three arguments.)</p>\n\n<p>Now we can say something like \"<code>const</code> is strict on its first argument\" and have it mean what we want it to mean (provided, as above, that <code>const</code> actually is a two-argument function), because \u2200<code>y</code>. <code>const \u22a5 y = \u22a5</code> does indeed hold.</p>\n\n<p>We now also have the tools to address your question about <code>ifFun</code>, namely: is <code>ifFun</code> strict on its second argument? That is, can we cook up <code>pred</code> and <code>alt</code> such that</p>\n\n<pre><code>ifFun pred \u22a5 alt \u2260 \u22a5 -- ?\n</code></pre>\n\n<p>I think it's clear we can do so, since:</p>\n\n<pre><code>ifFun False \u22a5 () = if False then \u22a5 else () = () \u2260 \u22a5\n</code></pre>\n\n<p>A similar argument shows that <code>ifFun</code> is \"not strict on its third argument\" in the popular understanding of this phrase (again modulo the provisos discussed above), but <em>is</em> \"strict on its first argument\".</p>\n"}], "owner": {"reputation": 239, "user_id": 2882340, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d1f73d60b88e9dff05bdb5d8bfb30f23?s=128&d=identicon&r=PG&f=1", "display_name": "Florian", "link": "https://stackoverflow.com/users/2882340/florian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1512839327, "creation_date": 1512837317, "question_id": 47730695, "link": "https://stackoverflow.com/questions/47730695/what-is-strictness", "title": "What is strictness?", "body": "<p>In Haskell, I try to understand the notion of strictness. I understand that</p>\n\n<pre><code>const x y = x\n</code></pre>\n\n<p>is strict on the first argument but not on the second.\nBut is</p>\n\n<pre><code> ifFun pred cons alt = if pred then cons else alt\n</code></pre>\n\n<p>strict? It is strict on the first argument. I understand that the fact that cons and alt are evaluated depending on the value of pred. Does that mean the function is not strict on those arguments? </p>\n"}, {"tags": ["haskell", "testing", "haskell-stack", "ambiguous", "doctest"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1512835039, "post_id": 47730105, "comment_id": 82421238, "body": "Could you show the main.hs file I guess you are not hiding stdout there - maybe you have a <code>import System.IO as Something</code> instead of <code>import qualified ..</code> there. Also  try <code>stack clean</code> just to make sure."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1512836241, "post_id": 47730105, "comment_id": 82421595, "body": "Main.hs added. Looks like everything is taken care of. Besides, non-testing builds are successful."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1512836244, "post_id": 47730105, "comment_id": 82421598, "body": "&quot;imported from \u2018Turtle\u2019 at app/Main.hs:7:1-13&quot; You are also importing <code>stdout</code> from <code>Turtle</code>."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512836448, "post_id": 47730105, "comment_id": 82421652, "body": "What&#39;s wrong with that? It builds and runs. <code>$ stack test</code> is the problem."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1512837333, "post_id": 47730105, "comment_id": 82421871, "body": "At a guess: doctest has a list of default imports that it makes sure is available when running a doctest, and this is causing the conflict. If so you may need to qualify all mentions of conflicting imports (and possibly qualify all imports of conflicting names, depending on exactly what&#39;s going on here). Luckily this isn&#39;t so terrible if you give nice short names to your imported modules with <code>as</code>."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512838332, "post_id": 47730105, "comment_id": 82422178, "body": "If you are right, it is not nice at all. Compilers shouldn&#39;t do such things."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1512840507, "post_id": 47730105, "comment_id": 82422971, "body": "@AlexeyOrlov Not sure what that means. 1. The compiler isn&#39;t at fault here if doctest is explicitly requesting additional imports. 2. Every compiler I know of silently brings a few things into scope, and it would be extremely painful if they didn&#39;t. So in my view, compilers <i>should</i> do such things and also your problem is <i>not</i> the result of a compiler doing such things."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1512840848, "post_id": 47730105, "comment_id": 82423081, "body": "I added <code>import Turtle hiding (stdout, stderr)</code> to <code>Main.hs</code>. So far so good."}], "owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1512849668, "creation_date": 1512833289, "last_edit_date": 1512849668, "question_id": 47730105, "link": "https://stackoverflow.com/questions/47730105/ambiguous-occurrence-stdout", "title": "Ambiguous occurrence \u2018stdout\u2019", "body": "<p>I've been trying to put on unit testing via <code>doctest</code>. Getting error:</p>\n\n<pre><code>hs-procr-0.1.0.0: test (suite: hs-procr-test)\n\nProgress: 1/2\n&lt;interactive&gt;:5:14: error:\nAmbiguous occurrence \u2018stdout\u2019\nIt could refer to either \u2018Turtle.stdout\u2019,\n                         imported from \u2018Turtle\u2019 at app/Main.hs:7:1-13\n                         (and originally defined in \u2018Turtle.Prelude\u2019)\n                      or \u2018System.IO.stdout\u2019,\n                         imported from \u2018System.IO\u2019\n                         (and originally defined in \u2018GHC.IO.Handle.FD\u2019)\n</code></pre>\n\n<p>I've got no idea why; all my <code>*.hs</code> files got</p>\n\n<pre><code>import System.IO hiding (FilePath, stdout, stderr)\n</code></pre>\n\n<p><code>package.yaml</code>:</p>\n\n<pre><code>...\ntests:\n  hs-procr-test:\n    main:                Spec.hs\n    source-dirs:         test\n    ghc-options:\n    - -threaded\n    - -rtsopts\n    - -with-rtsopts=-N\n    dependencies:\n    - hs-procr\n</code></pre>\n\n<p><code>Spec.hs</code>:</p>\n\n<pre><code>module Main (main) where\n\nimport Test.DocTest\nimport System.IO hiding (FilePath, stdout, stderr)\n\nmain :: IO ()\nmain = doctest [ \"app/Main.hs\"\n               ]\n</code></pre>\n\n<p>I use <code>stack</code>, there is no *.cabal file. What have I missed?</p>\n\n<p><code>Main.hs</code>:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main ( main\n            , strStripNumbers\n            ) where\n\nimport Lib\nimport Turtle\nimport Prelude hiding (FilePath)\nimport System.IO hiding (FilePath, stdout, stderr)\nimport Text.Regex.TDFA\n...\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1512841193, "post_id": 47729879, "comment_id": 82423199, "body": "There are an infinite number of strings that, presumably, are not valid days for a class to meet. Use a more specific type instead, something like: <code>data ClassDay = Mon | Tue | Wed | Thu | Fri</code>; then <code>subjectDays :: [(String, [ClassDay])]; subjectDays = [(&quot;maths&quot;, [Mon, Tue]), (&quot;science&quot;, [Mon, Wed])]</code>."}, {"owner": {"reputation": 2474, "user_id": 1076915, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/c3MuU.jpg?s=128&g=1", "display_name": "kk-dev11", "link": "https://stackoverflow.com/users/1076915/kk-dev11"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1513168456, "post_id": 47729879, "comment_id": 82547153, "body": "@chepner yes, you&#39;re right. I updated my program with data types. Thank you."}], "answers": [{"comments": [{"owner": {"reputation": 2474, "user_id": 1076915, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/c3MuU.jpg?s=128&g=1", "display_name": "kk-dev11", "link": "https://stackoverflow.com/users/1076915/kk-dev11"}, "edited": false, "score": 0, "creation_date": 1512833058, "post_id": 47729907, "comment_id": 82420640, "body": "<code>comb (subject, days) = [ (subject, d) | d &lt;- days]</code> but it produces a different result than I expected   <code>[[(&quot;maths&quot;,&quot;mon&quot;),(&quot;maths&quot;,&quot;tue&quot;)],[(&quot;science&quot;,&quot;mon&quot;),(&quot;scie&zwnj;&#8203;nce&quot;,&quot;wed&quot;)]]</code>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1512841995, "last_edit_date": 1512841995, "creation_date": 1512831932, "answer_id": 47729907, "question_id": 47729879, "link": "https://stackoverflow.com/questions/47729879/haskell-combinations-list-of-list/47729907#47729907", "title": "Haskell: Combinations (list of list)", "body": "<p>From the comment below, I now realize that you want another output than the one I initially understood.</p>\n\n<p>Essentially, you want each sublist to contain each subject (exactly once), paired with one of its days. If we still take <code>combinations</code> as defined below (the \"wrong\" output) we realize that we want to take the \"cartesian product\" of all the lists inside <code>combinations</code>. This cartesian product can be obtained using <code>Control.Monad.sequence</code>.</p>\n\n<pre><code>wantedCombinations = sequence combinations\n</code></pre>\n\n<hr>\n\n<p>Here's a hint.</p>\n\n<p>First, write a function to expand a single pair of yours into a list.</p>\n\n<pre><code>combs :: (a,[b]) -&gt; [(a,b)]\ncombs (subject, days) = ...\n</code></pre>\n\n<p>This could be solved using a list comprehension, for instance. Or <code>map</code>.</p>\n\n<p>Then, we can apply <code>combs</code> to each pair in the list</p>\n\n<pre><code>combinations = map combs subjectDays\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1512835629, "creation_date": 1512835629, "answer_id": 47730445, "question_id": 47729879, "link": "https://stackoverflow.com/questions/47729879/haskell-combinations-list-of-list/47730445#47730445", "title": "Haskell: Combinations (list of list)", "body": "<p>write an expand function to work on a single pair</p>\n\n<pre><code>expand :: (a,[b]) -&gt; [(a,b)]\nexpand (x,[]) = []\nexpand (x,(y:ys)) = (x,y): expand (x,ys)\n</code></pre>\n\n<p>map to your structure and take the transpose (Data.List)</p>\n\n<pre><code>transpose $ map expand subjectDays \n</code></pre>\n"}], "owner": {"reputation": 2474, "user_id": 1076915, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/c3MuU.jpg?s=128&g=1", "display_name": "kk-dev11", "link": "https://stackoverflow.com/users/1076915/kk-dev11"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "accepted_answer_id": 47729907, "answer_count": 2, "score": 0, "last_activity_date": 1512841995, "creation_date": 1512831716, "question_id": 47729879, "link": "https://stackoverflow.com/questions/47729879/haskell-combinations-list-of-list", "title": "Haskell: Combinations (list of list)", "body": "<p>I have a list of subjects and weekdays, on which the subject is taught.</p>\n\n<pre><code>subjectDays = [(\"maths\", [\"mon\", \"tue\"]),\n               (\"science\", [\"mon\", \"wed\"])]\n</code></pre>\n\n<p>Now I would like to generate a list of combinations.\nThe result should look like as follows.</p>\n\n<pre><code>combinations = [[(\"maths\", \"mon\"), (\"science\", \"mon\")],\n                [(\"maths\", \"mon\"), (\"science\", \"wed\")]\n                -- etc.\n               ]\n</code></pre>\n\n<p>Could anyone please help me to write a function in <em>Haskell</em> to produce the above result?</p>\n\n<p>Thank you very much in advance.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 2, "creation_date": 1512830750, "post_id": 47729722, "comment_id": 82419923, "body": "Minimum is a function that works on lists. You&#39;re probably looking for <code>min</code>. That said, I&#39;m not sure what funkiness is going on here, probably some identity for tuples as lists or something. I remember a question a few days ago that was similar I think."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1512830802, "post_id": 47729722, "comment_id": 82419941, "body": "<a href=\"https://www.youtube.com/watch?v=87re_yIQMDw\" rel=\"nofollow noreferrer\">youtube.com/watch?v=87re_yIQMDw</a> (FWIW, I think it <i>is</i> a <a href=\"https://www.destroyallsoftware.com/talks/wat\" rel=\"nofollow noreferrer\">Wat</a>.)"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1512831352, "post_id": 47729722, "comment_id": 82420131, "body": "<a href=\"https://stackoverflow.com/questions/36113469/why-is-tolist-1-2-2/36133838\">Related: <code>Why is toList (1, 2) == [2]</code></a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512831656, "post_id": 47729722, "comment_id": 82420219, "body": "Note <code>minimum (True, 3)</code> also type checks, and evaluates to <code>3</code>. This is because the foldable instance is <code>Foldable ((,) a)</code>, so only the second component matters. Indeed, we can&#39;t take the minimum between two components which could be of two different types."}], "answers": [{"tags": [], "owner": {"reputation": 1663, "user_id": 1376652, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0d5115b8dac70e66f6023a0753b413b4?s=128&d=identicon&r=PG", "display_name": "storaged", "link": "https://stackoverflow.com/users/1376652/storaged"}, "is_accepted": false, "score": 1, "last_activity_date": 1512830783, "creation_date": 1512830783, "answer_id": 47729752, "question_id": 47729722, "link": "https://stackoverflow.com/questions/47729722/why-minimum-1-2-returns-2-in-haskell/47729752#47729752", "title": "Why `minimum (1, 2)` returns 2 in Haskell?", "body": "<p>When you look to the <a href=\"https://www.haskell.org/hoogle/?hoogle=minimum\" rel=\"nofollow noreferrer\">documentation</a> you will find out that minimum can have various inputs (in the sense of argument's type). </p>\n\n<p>In your case you want to apply a <code>list</code> to the minimum function to get a minimal element, so try</p>\n\n<pre><code>minimum [1,2]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512831755, "post_id": 47729787, "comment_id": 82420250, "body": "... and it couldn&#39;t include both components in the list since <code>toList (&quot;hello&quot;, 2)</code> also type checks, but <code>[&quot;hello&quot;, 2]</code> does not."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 7, "last_activity_date": 1512831074, "creation_date": 1512831074, "answer_id": 47729787, "question_id": 47729722, "link": "https://stackoverflow.com/questions/47729722/why-minimum-1-2-returns-2-in-haskell/47729787#47729787", "title": "Why `minimum (1, 2)` returns 2 in Haskell?", "body": "<p>The type of <code>minimum</code> is</p>\n\n<pre><code> (Ord a, Foldable t) =&gt; t a -&gt; a\n</code></pre>\n\n<p>The <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/src/Data.Foldable.html#line-311\" rel=\"noreferrer\"><code>Foldable</code></a> instance for pairs refers only to the second element of the pair, which you can see with <code>toList</code>:</p>\n\n<pre><code>toList (1,2)\n&gt; [2]\n</code></pre>\n\n<p>the minimum element in that collection is <code>2</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1512832239, "last_edit_date": 1512832239, "creation_date": 1512831863, "answer_id": 47729900, "question_id": 47729722, "link": "https://stackoverflow.com/questions/47729722/why-minimum-1-2-returns-2-in-haskell/47729900#47729900", "title": "Why `minimum (1, 2)` returns 2 in Haskell?", "body": "<p>The reason for this behaviour is twofold:</p>\n\n<ul>\n<li>Since the <a href=\"https://wiki.haskell.org/Foldable_Traversable_In_Prelude\" rel=\"nofollow noreferrer\">FTP</a>, the functions like <code>minimum</code> or <code>length</code> (these are <a href=\"https://en.wikipedia.org/wiki/Catamorphism\" rel=\"nofollow noreferrer\">catamorphisms</a>, i.e. functions which simmer down a container structure to a single value) don't just operate on lists anymore, but on general <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Foldable.html\" rel=\"nofollow noreferrer\"><code>Foldable</code></a> instances. That's very useful, for instance you can directly calculate the minimum of an array, map or trie without first having to convert it to a list. (Prior to the FTP, your expression would have just been a type error, because the argument is not a list but a tuple.)</li>\n<li><p>Tuples are functors, and specifically, they are functors <em>in the second argument</em>. This allows doing stuff like</p>\n\n<pre><code>Prelude&gt; fmap (+1) &lt;$&gt; [(\"Bla\",2), (\"blub\",3)]\n[(\"Bla\",3),(\"blub\",4)]\n</code></pre>\n\n<p>That it's the second argument arises from the fact that <code>(a,b)</code> is actually syntactic sugar for <code>((,) a) b</code>, i.e. we're dealing with the <code>((,)a)</code> functor here. This is <em>the only possible way</em> you can make a Haskell tuple functor instance!<br>IMHO, having that instance at all isn't really a good feature though<sup>&dagger;</sup>, because tuples are supposed to be in a sense <em>symmetric</em> between there elements. Well, Haskell tuples aren't symmetric, they are &ldquo;containers containing one polymorphic element&rdquo;, namely the second one.</p></li>\n</ul>\n\n<p>That wouldn't too bad by itself, but tuples also have a <code>Foldable</code> instance: once you decide that a tuple is a container for the second element specifically, it's natural to also want to run catamorphisms on it. They're not very exciting catamorphisms, working only ever on one element, and in particular it's really confusing that even if the first element has the same type, the catamorphism just ignores it. But oh well, here we are.</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>The proper way to write the above is IMO <code>second (+1) &lt;$&gt; [(\"Bla\",2), (\"blub\",3)]</code>, using <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Arrow.html#v:second\" rel=\"nofollow noreferrer\"><code>second</code> from <code>Control.Arrow</code></a>, which is equivalent to <code>fmap</code> on tuples but avoids the confusion between the two elements. (Also, it's more general, but not in a way that would make a difference for most applications: it can be used with general <em>arrows</em>, not just with functions.)</sub></p>\n"}], "owner": {"reputation": 5469, "user_id": 7083401, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eA15o.png?s=128&g=1", "display_name": "ice1000", "link": "https://stackoverflow.com/users/7083401/ice1000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 755, "favorite_count": 1, "closed_date": 1512839748, "accepted_answer_id": 47729787, "answer_count": 3, "score": 2, "last_activity_date": 1512832239, "creation_date": 1512830518, "question_id": 47729722, "link": "https://stackoverflow.com/questions/47729722/why-minimum-1-2-returns-2-in-haskell", "closed_reason": "Duplicate", "title": "Why `minimum (1, 2)` returns 2 in Haskell?", "body": "<p>Why <code>minimum (1, 2)</code> is 2 in Haskell?</p>\n\n<p>My test result in GHCi,</p>\n\n<pre><code>GHCi, version 8.2.1: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; minimum (1, 2)\n2\n</code></pre>\n\n<p>Shouldn't it return 1?</p>\n"}, {"tags": ["haskell", "cabal", "nix", "nixos"], "answers": [{"tags": [], "owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "is_accepted": true, "score": 6, "last_activity_date": 1512982784, "last_edit_date": 1512982784, "creation_date": 1512982318, "answer_id": 47749193, "question_id": 47729044, "link": "https://stackoverflow.com/questions/47729044/how-to-add-package-to-cabal2nix-generated-env/47749193#47749193", "title": "How to add package to cabal2nix generated `env`?", "body": "<p>The <code>nix-shell</code> commands builds all dependencies of a project, sets all environment variables to their respective derivation attribute values and sources (<a href=\"http://www.tldp.org/HOWTO/Bash-Prompt-HOWTO/x237.html\" rel=\"noreferrer\">bash</a>) <code>$stdenv/setup</code>. For more details, see <a href=\"https://nixos.org/nix/manual/#sec-nix-shell\" rel=\"noreferrer\">the Nix manual about <code>nix-shell</code></a>.</p>\n\n<p>So in your last example, if you run <code>echo $buildInputs</code> you'll see your built package as a build input. So that works, but it's not what you want.</p>\n\n<p>Instead, you need to reuse the Haskell-specific environment derivation, <code>myPackage.env</code>. This dummy derivation for <code>nix-shell</code> has a GHC that is set up to discover only your dependencies etc.</p>\n\n<pre><code>pkgs.lib.overrideDerivation myPackage.env (old: {\n    buildInputs = old.buildInputs ++ [ pkgs.haskellPackages.hlint ];\n})\n</code></pre>\n\n<hr>\n\n<p><em>Unsolicited advice ;)</em></p>\n\n<p>In my projects, I use a <code>shell.nix</code> file for this. This also lets me avoid the <code>lib.inNixShell</code> value that breaks referential transparency.</p>\n\n<p>If your project consists of more than a Haskell package, I recommend writing an overlay. It will make your project much more coherent.</p>\n\n<p><code>shell.nix</code></p>\n\n<pre><code># This imports the project + overlay. The overlay takes care of\n# adding `myPackage` to `haskellPackages`, to make it available\n# throughout the project.\nattrs@{...}:\nlet pkgs = (import ../nix attrs);\n\n# Adapt myPackage.env\nin pkgs.lib.overrideDerivation pkgs.haskellPackages.myPackage.env (old: {\n    buildInputs = old.buildInputs ++ [ pkgs.haskellPackages.hlint ];\n})\n</code></pre>\n\n<p>For an example of an overlay, see <a href=\"https://github.com/zimbatm/todomvc-nix/blob/master/nix/default.nix\" rel=\"noreferrer\">zimbatm's todomvc-nix</a>.</p>\n"}], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 905, "favorite_count": 0, "accepted_answer_id": 47749193, "answer_count": 1, "score": 5, "last_activity_date": 1512982784, "creation_date": 1512825972, "last_edit_date": 1512827451, "question_id": 47729044, "link": "https://stackoverflow.com/questions/47729044/how-to-add-package-to-cabal2nix-generated-env", "title": "How to add package to cabal2nix generated `env`?", "body": "<p>I use this <code>default.nix</code> to build my package with <code>nix-build</code> and get the <code>env</code> with <code>nix-shell</code></p>\n\n<pre><code>{ pkgs ? import &lt;nixpkgs&gt; {} }:\nwith pkgs;\nwith haskellPackages;\n\nlet\n  myPackage = callPackage ./myPackage.nix {};\nin\n  if lib.inNixShell then myPackage.env else myPackage\n</code></pre>\n\n<p><code>myPackage.nix</code> generated using <code>cabal2nix . &gt; myPackage.nix</code></p>\n\n<pre><code>{ mkDerivation, base, split, stdenv }:\nmkDerivation {\n  pname = \"myPackage\";\n  version = \"0.1.0.0\";\n  src = ./.;\n  isLibrary = false;\n  isExecutable = true;\n  executableHaskellDepends = [ base split ];\n  license = stdenv.lib.licenses.bsd3;\n}\n</code></pre>\n\n<p>This working fine for building but I want to add development helper tools while I working on it. I don't want to edit <code>myPackage.nix</code>. I want to re-run <code>cabal2nix</code> when I edit <code>myPackage.cabal</code>.</p>\n\n<p>I try to use <code>buildInputs</code> of <code>mkDerivation</code> but did not seem to work.</p>\n\n<pre><code>let\n  myPackage = callPackage ./myPackage.nix {};\nin\n  stdenv.mkDerivation {\n    name = myPackage.name;\n\n    buildInputs = [ myPackage hlint hasktags ];\n}\n</code></pre>\n\n<p>Beside <code>nix-build</code> stop working, it also drop me in the shell with executable of <code>myPackage</code> but without <code>myPackage</code>'s env.</p>\n\n<p>I know this because <code>ghc</code> is not avaliable while it exists in <code>myPackage</code>'s env when using <code>default.nix</code> above.</p>\n\n<p>How can I add those tools to <code>env</code> generated from <code>cabal2nix</code> ?</p>\n"}, {"tags": ["haskell", "record"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 7, "creation_date": 1512825751, "post_id": 47728980, "comment_id": 82418465, "body": "This is the sort of problem lenses were invented to solve."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1512840770, "post_id": 47728980, "comment_id": 82423060, "body": "See also <a href=\"https://stackoverflow.com/q/7365425/791604\">Is there a Haskell idiom for updating a nested data structure?</a>, though I hesitate to mark this as a duplicate because the modern answer has changed so much. This question has a much better exposition of the modern answer."}], "answers": [{"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1512949678, "post_id": 47729546, "comment_id": 82449507, "body": "&quot;generic-lens&quot; <a href=\"http://hackage.haskell.org/package/generic-lens-0.5.0.0/docs/Data-Generics-Product-Fields.html#t:HasField\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/generic-lens-0.5.0.0/docs/&hellip;</a> provides a <code>field</code> lens that works for all records which derive <code>Generic</code>, without the need for Template Haskell <a href=\"http://kcsongor.github.io/generic-lens/\" rel=\"nofollow noreferrer\">kcsongor.github.io/generic-lens</a>"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 8, "last_activity_date": 1512834129, "last_edit_date": 1512834129, "creation_date": 1512829487, "answer_id": 47729546, "question_id": 47728980, "link": "https://stackoverflow.com/questions/47728980/how-can-i-concisely-modify-a-records-field/47729546#47729546", "title": "How can I concisely modify a record&#39;s field?", "body": "<p>One way of generalizing <code>incrementPersonCounter</code> is to abstract over the modification function:</p>\n\n<pre><code>modifyPersonCounter :: (Int -&gt; Int) -&gt; Person -&gt; Person\nmodifyPersonCounter f p = (\\c -&gt; p { counter = c}) $ f (counter p)\n</code></pre>\n\n<p>In fact, a common pattern is to abstract as well over the <em>effect</em> we want to perform in the field:</p>\n\n<pre><code>counterLens :: forall f. Functor f =&gt; (Int -&gt; f Int) -&gt; (Person -&gt; f Person)\ncounterLens f p = (\\c -&gt; p { counter = c }) &lt;$&gt; f (counter p)\n</code></pre>\n\n<p>For example, we might want to read the counter increase from console, or from a database (both <code>IO</code> effects).</p>\n\n<p>We can give a <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Lens.html#t:Lens\" rel=\"nofollow noreferrer\">synonym</a> to the type of functions that, given a (possibly effectful) way of changing a field, return a function that transforms the whole record:</p>\n\n<pre><code>type Lens' a b = forall f. Functor f =&gt; (b -&gt; f b) -&gt; (a -&gt; f a)\n</code></pre>\n\n<p>To modify a record <em>purely</em>, now we need an auxiliary function we can call <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Setter.html#v:over\" rel=\"nofollow noreferrer\"><code>over</code></a>, which only needs to be defined once:</p>\n\n<pre><code>over :: Lens' a b -&gt; (b -&gt; b) -&gt; a -&gt; a\nover l f p = runIdentity $ l (Identity . f) p\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>*Main&gt; over counterLens (+1) (Person \"foo\" 40)\nPerson {name = \"foo\", counter = 41}\n</code></pre>\n\n<hr>\n\n<p>We have abstracted over the modification function and its possible effects, but we still need to define these \"lenses\" for each field, which is annoying. In practice, people use <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-TH.html#v:makeLenses\" rel=\"nofollow noreferrer\">Template Haskell</a> to define them automatically and avoid boilerplate.</p>\n\n<p>But what if we wanted a <em>single</em> function that let us specify the name of the field? That is, sadly, more complex. You need a way to pass type-level strings as arguments, and a <a href=\"http://hackage.haskell.org/package/overloaded-records-0.4.2.0/docs/Data-OverloadedRecords.html#t:HasField\" rel=\"nofollow noreferrer\">multi-parameter type class</a> that encodes the relationship between a field's name, the type of the record, and the type of the field. There are <a href=\"http://hackage.haskell.org/package/overloaded-records-0.4.2.0/docs/Data-OverloadedRecords.html\" rel=\"nofollow noreferrer\">some packages</a> which do that (again, with Template Haskell help for the boilerplate) but to my knowledge they are not widely used.</p>\n\n<p>The main library for lenses is called <a href=\"http://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lens</a>, and there is also <a href=\"http://hackage.haskell.org/package/microlens\" rel=\"nofollow noreferrer\">microlens</a>, an alternative with a lighter dependency footprint. They are interoperable: lenses defined using one library work with the other.</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 5, "last_activity_date": 1512829739, "creation_date": 1512829739, "answer_id": 47729589, "question_id": 47728980, "link": "https://stackoverflow.com/questions/47728980/how-can-i-concisely-modify-a-records-field/47729589#47729589", "title": "How can I concisely modify a record&#39;s field?", "body": "<p>Using <a href=\"http://hackage.haskell.org/package/lens\" rel=\"noreferrer\">lens</a> you can write it like this:</p>\n\n<pre><code>incrementPersonCounter :: Person -&gt; Person\nincrementPersonCounter = counter +~ 1\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>\u03bb&gt; incrementPersonCounter $ Person \"foo\" 42\nPerson {_name = \"foo\", _counter = 43}\n</code></pre>\n\n<hr>\n\n<p>Full code:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nmodule Lib where\n\nimport Control.Lens\n\ndata Person = Person\n  {\n    _name :: String\n  , _counter :: Int\n  } deriving (Show, Eq)\nmakeLenses ''Person\n\nincrementPersonCounter :: Person -&gt; Person\nincrementPersonCounter = counter +~ 1\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1033, "favorite_count": 0, "accepted_answer_id": 47729546, "answer_count": 2, "score": 5, "last_activity_date": 1513333994, "creation_date": 1512825439, "last_edit_date": 1513333994, "question_id": 47728980, "link": "https://stackoverflow.com/questions/47728980/how-can-i-concisely-modify-a-records-field", "title": "How can I concisely modify a record&#39;s field?", "body": "<pre><code>data Person = Person\n  {\n    name :: String\n  , counter :: Int\n  }\n\nincrementPersonCounter :: Person -&gt; Person\nincrementPersonCounter p@(Person _ c) = p { counter = c + 1 }\n</code></pre>\n\n<p>Is there a more concise way of doing the above? Is there a function I could use, where I specify the record, one of its fields (<code>name</code> / <code>counter</code> in this case) and a function to apply to the return value?</p>\n\n<hr>\n\n<p>I was thinking something along the lines of:</p>\n\n<pre><code>applyRecord r f f' = r\n  { f = f' (f r) }\n</code></pre>\n\n<p>Though this won't work because:</p>\n\n<pre><code>error: Not in scope: \u2018f\u2019\n   |\n13 |   { f = f' (f r) }\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1512819267, "post_id": 47728051, "comment_id": 82416710, "body": "<code>in</code> needs to be on the same column as <code>let</code>. Also, which line is line 7? Please write the full error message."}, {"owner": {"reputation": 141, "user_id": 4583687, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/0lHfL.jpg?s=128&g=1", "display_name": "someoneb100", "link": "https://stackoverflow.com/users/4583687/someoneb100"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1512819460, "post_id": 47728051, "comment_id": 82416765, "body": "This is the full error message. The above code is the entire program. line 7 is the one before the <code>in</code> statement. i tried indenting in, does not work"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1512819582, "post_id": 47728051, "comment_id": 82416791, "body": "Did you <a href=\"https://stackoverflow.com/questions/35855170/why-shouldnt-i-mix-tabs-and-spaces\">mix tabs and spaces</a>?"}, {"owner": {"reputation": 141, "user_id": 4583687, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/0lHfL.jpg?s=128&g=1", "display_name": "someoneb100", "link": "https://stackoverflow.com/users/4583687/someoneb100"}, "edited": false, "score": 0, "creation_date": 1512819640, "post_id": 47728051, "comment_id": 82416800, "body": "I thought of that, so i replaced all tab with spaces. Did not work"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1512820281, "post_id": 47728051, "comment_id": 82416974, "body": "Your follow up question is completely unrelated to the former."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1512820255, "last_edit_date": 1512820255, "creation_date": 1512819678, "answer_id": 47728181, "question_id": 47728051, "link": "https://stackoverflow.com/questions/47728051/trying-to-understand-indentations-in-haskell/47728181#47728181", "title": "Trying to understand indentations in haskell", "body": "<p>Your <code>where</code> has to come <em>after</em> all guards.</p>\n\n<pre><code>hanoi :: [Int] -&gt; String\nhanoi n\n    | n &gt; 0     = hanoi' n \"1\" \"2\" \"3\"\n    | otherwise = \"Number must be greater than 0!!!\"\n  where hanoi' n a b c\n         | n == 0    = \"|\"\n         | otherwise = let pre   = hanoi' (n-1) a c b\n                           posle = hanoi' (n-1) b c a\n                       in pre ++ a ++ \" ~~&gt; \" ++ c ++ posle\n</code></pre>\n\n<p>This is <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-830004.4.3\" rel=\"nofollow noreferrer\">stated in 4.4.3</a>, although it's somewhat hidden if you're not used to BNF-like syntax:</p>\n\n<pre><code>decl    \u2192   (funlhs | pat) rhs\n\nfunlhs  \u2192   var apat { apat }\n    |   pat varop pat\n    |   ( funlhs ) apat { apat }\n\nrhs     \u2192   = exp [where decls]\n    |   gdrhs [where decls] \n\ngdrhs   \u2192   guards = exp [gdrhs]\n\nguards  \u2192   | guard1, \u2026, guardn         (n \u2265 1)\n\nguard   \u2192   pat &lt;- infixexp         (pattern guard)\n    |   let decls       (local declaration)\n    |   infixexp        (boolean guard) \n</code></pre>\n\n<p><code>rhs</code> is the important token. It's the only part that contains the optional <code>where</code>. A <code>guard</code> may only contain expressions and be followed by other guards.</p>\n"}], "owner": {"reputation": 141, "user_id": 4583687, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/0lHfL.jpg?s=128&g=1", "display_name": "someoneb100", "link": "https://stackoverflow.com/users/4583687/someoneb100"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 47728181, "answer_count": 1, "score": 1, "last_activity_date": 1512820484, "creation_date": 1512818708, "last_edit_date": 1512820484, "question_id": 47728051, "link": "https://stackoverflow.com/questions/47728051/trying-to-understand-indentations-in-haskell", "title": "Trying to understand indentations in haskell", "body": "<p>I am trying to make a program that solves the tower of hanoi. I made it a bit complicated just for exercise:</p>\n\n<pre><code>hanoi :: [Int] -&gt; String\nhanoi n\n    | n &gt; 0     = hanoi' n \"1\" \"2\" \"3\"\n                    where hanoi' n a b c\n                            | n == 0    = \"|\"\n                            | otherwise = let pre   = hanoi' (n-1) a c b\n                                              posle = hanoi' (n-1) b c a\n                                              in pre ++ a ++ \" ~~&gt; \" ++ c ++ posle    \n    | otherwise = \"Number must be greater than 0!!!\"\n</code></pre>\n\n<p>But i get:</p>\n\n<pre><code>hanoi.hs:7:97: parse error on input \u2018=\u2019\n</code></pre>\n\n<p>Can someone please explain to me what is going on? I see now that i don't understand an important part of the language.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1512845067, "post_id": 47727970, "comment_id": 82424360, "body": "Try running <code>stack test --test-arguments &quot;--help&quot;</code> to discover what kind of options you can pass to the test suite."}, {"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1512876101, "post_id": 47727970, "comment_id": 82431577, "body": "Thanks @sjakobi - that&#39;s helpful."}], "answers": [{"tags": [], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "is_accepted": true, "score": 0, "last_activity_date": 1512876582, "creation_date": 1512876582, "answer_id": 47735592, "question_id": 47727970, "link": "https://stackoverflow.com/questions/47727970/how-to-run-an-individual-test-with-stack-and-haskell-test-framework/47735592#47735592", "title": "How to run an individual test with Stack and Haskell Test.Framework?", "body": "<p>Thanks to @sjakobi for this answer. </p>\n\n<p>The process is - list the available test commands:</p>\n\n<pre><code>stack test --test-arguments \"--help\" haskoin-core:test-haskoin-core\n</code></pre>\n\n<p>This gives the following result:</p>\n\n<pre><code>haskoin-core-0.4.2: test (suite: test-haskoin-core, args: --help)\n\nUsage: test-haskoin-core [OPTIONS]\n                   --help                                       show this help message\n  -j NUMBER        --threads=NUMBER                             number of threads to use to run tests\n                   --test-seed=NUMBER|random                    default seed for test random number generator\n  -a NUMBER        --maximum-generated-tests=NUMBER             how many automated tests something like QuickCheck should try, by default\n                   --maximum-unsuitable-generated-tests=NUMBER  how many unsuitable candidate tests something like QuickCheck should endure before giving up, by default\n  -s NUMBER        --maximum-test-size=NUMBER                   to what size something like QuickCheck should test the properties, by default\n  -d NUMBER        --maximum-test-depth=NUMBER                  to what depth something like SmallCheck should test the properties, by default\n  -o NUMBER        --timeout=NUMBER                             how many seconds a test should be run for before giving up, by default\n                   --no-timeout                                 specifies that tests should be run without a timeout, by default\n  -l               --list-tests                                 list available tests but don't run any; useful to guide subsequent --select-tests\n  -t TEST-PATTERN  --select-tests=TEST-PATTERN                  only tests that match at least one glob pattern given by an instance of this argument will be run\n                   --jxml=FILE                                  write a JUnit XML summary of the output to FILE\n                   --jxml-nested                                use nested testsuites to represent groups in JUnit XML (not standards compliant)\n                   --plain                                      do not use any ANSI terminal features to display the test run\n                   --color                                      use ANSI terminal features to display the test run\n                   --hide-successes                             hide sucessful tests, and only show failures\n\n\nTest suite failure for package haskoin-core-0.4.2\n    test-haskoin-core:  exited with: ExitFailure 1\nLogs printed to console\n</code></pre>\n\n<p>From that we can build a command to list the tests:</p>\n\n<pre><code>stack test --test-arguments \"--list-tests\" haskoin-core:test-haskoin-core\n</code></pre>\n\n<p>From there we can use this command to glob for a particular test</p>\n\n<pre><code>stack test --test-arguments=--select-tests=Bloom*Filter haskoin-core:test-haskoin-core\n</code></pre>\n\n<p>Note the <code>*</code> in place of the space, there seems to be <a href=\"https://github.com/commercialhaskell/stack/issues/172\" rel=\"nofollow noreferrer\">some</a> <a href=\"https://github.com/commercialhaskell/stack/issues/3091\" rel=\"nofollow noreferrer\">discussion</a> about how to handle spaces in this scenario. </p>\n\n<p>Now this selects the tests we want to run:</p>\n\n<pre><code>haskoin-core-0.4.2: test (suite: test-haskoin-core, args: --select-tests=Bloom*Filter)\n\nBinary encoding and decoding of bloom types:\n  BloomFilter: [OK, passed 100 tests]\nBloom Filters:\n  Bloom Filter Vector 1: [OK]\n  Bloom Filter Vector 2: [OK]\n  Bloom Filter Vector 3: [OK]\n\n         Properties  Test Cases  Total      \n Passed  1           3           4          \n Failed  0           0           0          \n Total   1           3           4          \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "is_accepted": false, "score": 0, "last_activity_date": 1565821273, "creation_date": 1565821273, "answer_id": 57502776, "question_id": 47727970, "link": "https://stackoverflow.com/questions/47727970/how-to-run-an-individual-test-with-stack-and-haskell-test-framework/57502776#57502776", "title": "How to run an individual test with Stack and Haskell Test.Framework?", "body": "<p>As of mid 2019, I think <code>stack</code> has changed.</p>\n\n<ol>\n<li><p>See <code>--help</code> for options:</p>\n\n<p><code>stack test --test-arguments \"--help\"</code></p></li>\n<li><p>Do a <code>--dry-run</code> to see what tests will run:</p>\n\n<p><code>stack test --test-arguments \"--dry-run\"</code></p></li>\n<li><p>Select tests with <code>--match</code>. Note, this alleges glob patterns will work but they don't seem to for me:</p>\n\n<p><code>stack test --test-arguments \"--match=foobar\"</code></p></li>\n</ol>\n\n<p>AFAICT, <code>\"foobar\"</code> is interpreted like a glob of <code>*foobar*</code>, but I can't be explicit about it.</p>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1105, "favorite_count": 0, "accepted_answer_id": 47735592, "answer_count": 2, "score": 1, "last_activity_date": 1565821273, "creation_date": 1512818108, "last_edit_date": 1512873563, "question_id": 47727970, "link": "https://stackoverflow.com/questions/47727970/how-to-run-an-individual-test-with-stack-and-haskell-test-framework", "title": "How to run an individual test with Stack and Haskell Test.Framework?", "body": "<p>I'm cloning the <a href=\"https://github.com/haskoin/haskoin\" rel=\"nofollow noreferrer\">following repository</a> and making one change to the <code>stack.yaml</code> by adding at the end:</p>\n\n<pre><code>docker:\n    enable: true\n</code></pre>\n\n<p>To run all the tests for <code>haskoin-core</code> I'm using</p>\n\n<pre><code>stack test haskoin-core:test-haskoin-core\n</code></pre>\n\n<p>What I want to do is run just one test. If this were <code>HSpec</code> (which it is not) I'd be running <a href=\"https://stackoverflow.com/a/39365910/15441\">something like</a>:</p>\n\n<pre><code>stack test --test-arguments -m \"Network.Haskoin.Network.Units\"\n</code></pre>\n\n<p>Now what I could do is modify the file <code>haskcoin-core/test/Main.hs</code> and comment out all the tests I don't want to run. But ya know - there should be a simpler way to run it with just command line parameters. (Mutating the file system goes agains the whole functional grain of Haskell). </p>\n\n<p>I'd also be open to running it with <code>stack ghci</code> somehow. </p>\n\n<p>My question is: <strong>How to run an individual test with Stack and Haskell Test.Framework?</strong></p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1512798173, "post_id": 47725555, "comment_id": 82412038, "body": "What about <code>_2 . name</code>?"}, {"owner": {"reputation": 105, "user_id": 4298567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9c8164ca27914d0bc7184a144b41768?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Pan", "link": "https://stackoverflow.com/users/4298567/louis-pan"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1512806795, "post_id": 47725555, "comment_id": 82413671, "body": "That gives the type <code>forall s t b (f :: * -&gt; *).               (Field2 s t b b, HasPerson b, Functor f) =&gt;               (String -&gt; f String) -&gt; s -&gt; f t</code> which is not <code>Lens&#39; (a, Person) (a, String)</code>"}, {"owner": {"reputation": 105, "user_id": 4298567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9c8164ca27914d0bc7184a144b41768?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Pan", "link": "https://stackoverflow.com/users/4298567/louis-pan"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1512808212, "post_id": 47725555, "comment_id": 82413956, "body": "That is, the type<code>Lens&#39; (a, Person) String</code>, not <code>Lens&#39; (a, Person) (a, String)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 4298567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9c8164ca27914d0bc7184a144b41768?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Pan", "link": "https://stackoverflow.com/users/4298567/louis-pan"}, "edited": false, "score": 0, "creation_date": 1512811031, "post_id": 47726632, "comment_id": 82414542, "body": "Thank you, that is exactly what I was looking for"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 6, "last_activity_date": 1512807604, "last_edit_date": 1512807604, "creation_date": 1512806974, "answer_id": 47726632, "question_id": 47725555, "link": "https://stackoverflow.com/questions/47725555/combine-lens-into-a-lens-of-a-tuple/47726632#47726632", "title": "Combine Lens into a Lens of a tuple", "body": "<p><a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Lens.html#v:alongside\" rel=\"noreferrer\"><code>alongside</code></a> turns a pair of lenses into a lens that works over a pair.</p>\n\n<p>Because in the example you don't focus into the first component, you could simply pass <code>id</code> as the first lens.</p>\n\n<pre><code>sndPerson :: Lens' (a, Person) (a, String)\nsndPerson = alongside id name\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 4298567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9c8164ca27914d0bc7184a144b41768?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Pan", "link": "https://stackoverflow.com/users/4298567/louis-pan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 414, "favorite_count": 0, "accepted_answer_id": 47726632, "answer_count": 1, "score": 3, "last_activity_date": 1512810347, "creation_date": 1512796750, "question_id": 47725555, "link": "https://stackoverflow.com/questions/47725555/combine-lens-into-a-lens-of-a-tuple", "title": "Combine Lens into a Lens of a tuple", "body": "<p>Given</p>\n\n<pre><code>data Person = Person { _name :: String }\nmakeClassy ''Person\n</code></pre>\n\n<p>which creates a</p>\n\n<pre><code>name :: Lens' Person String\n</code></pre>\n\n<p>I can define the following lens which uses <code>name</code> inside a tuple.</p>\n\n<pre><code>sndPerson :: Lens' (a, Person) (a, String)\nsndPerson = lens\n    (\\(a, p) -&gt; (a, p ^. name)) \n    (\\(_, p) (a, n) -&gt; (a, p &amp; name .~ n))\n</code></pre>\n\n<p>Is there a nicer/canonical way to define <code>sndPerson</code> above?</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack", "euterpea"], "answers": [{"tags": [], "owner": {"reputation": 1069, "user_id": 4299824, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LKWkrlvV9UE/AAAAAAAAAAI/AAAAAAAABYQ/OWKjHFpdGGs/photo.jpg?sz=128", "display_name": "YAMAMOTO Yuji", "link": "https://stackoverflow.com/users/4299824/yamamoto-yuji"}, "is_accepted": true, "score": 9, "last_activity_date": 1512792394, "creation_date": 1512792394, "answer_id": 47725226, "question_id": 47724988, "link": "https://stackoverflow.com/questions/47724988/why-is-stack-build-altering-my-cabal-file/47725226#47725226", "title": "Why is `stack build` altering my .cabal file?", "body": "<p>Make sure <code>package.yaml</code> exists in the root of your project directory.</p>\n\n<p><code>package.yaml</code> is a new file format to improve the syntax of cabal, converted by <a href=\"https://github.com/sol/hpack\" rel=\"noreferrer\">hpack</a>.</p>\n\n<p>Stack supports hpack as strongly as the <code>stack build</code> command automatically converts package.yaml into a cabal file with <code>hpack</code> command.</p>\n\n<p>So, delete <code>package.yaml</code> or edit <code>package.yaml</code> to add Euterpea package.\nEditing it would not be so difficult as its format is YAML.</p>\n"}, {"tags": [], "owner": {"reputation": 454, "user_id": 7350753, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/TqdKq.png?s=128&g=1", "display_name": "Franklin Antony", "link": "https://stackoverflow.com/users/7350753/franklin-antony"}, "is_accepted": false, "score": 1, "last_activity_date": 1611151394, "last_edit_date": 1611151394, "creation_date": 1611104034, "answer_id": 65801672, "question_id": 47724988, "link": "https://stackoverflow.com/questions/47724988/why-is-stack-build-altering-my-cabal-file/65801672#65801672", "title": "Why is `stack build` altering my .cabal file?", "body": "<p>I want to add to the <a href=\"https://stackoverflow.com/users/4299824/yamamoto-yuji\">YAMAMOTO Yuji's</a> answer. The solution is absolutely right. But I just wanted to add few things, it is not hard to edit the <code>package.yaml</code>.</p>\n<p><strong>Step 1</strong> : The trickiest part is <strong>finding the correct package name</strong>.</p>\n<blockquote>\n<p>Use <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">Hoogle</a> or <a href=\"https://www.stackage.org/\" rel=\"nofollow noreferrer\">Stackage</a> to find the package where the module\nresides. Read more about how to find package name in this <a href=\"https://stackoverflow.com/a/49291575/7350753\">post</a>.</p>\n</blockquote>\n<p><strong>Step 2</strong> : Now you have to open the package.yaml file and add the package name. In your case add <em>'Euterpea'</em> package in the list of dependencies.</p>\n<pre><code>dependencies:\n...\n- your-package-name\n</code></pre>\n<blockquote>\n<p>Please note that <strong>Euterpea</strong> package has to be added in a different way. Please read <a href=\"https://stackoverflow.com/a/49291575/7350753\">this\npost</a> for better understanding.</p>\n</blockquote>\n<p><strong>Step 3</strong> : Open <code>project-name.cabal</code> in project root and add required package name under <code>build-depends</code>:</p>\n<pre><code>library\n  hs-source-dirs:\n      src\n\n  build-depends:\n      base &gt;= 4.7 &amp;&amp; &lt; 5\n    , your-package-name\n\n  exposed-modules:\n      Lib\n</code></pre>\n<p><strong>Step 4</strong> :Issue <code>stack build</code> to download and build dependencies\n(or <code>stack ghci</code> if you plan to use it in the <em>REPL</em>)</p>\n<p>Hope this works! Happy coding! :)</p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 479, "favorite_count": 0, "accepted_answer_id": 47725226, "answer_count": 2, "score": 5, "last_activity_date": 1611151394, "creation_date": 1512789649, "last_edit_date": 1571475628, "question_id": 47724988, "link": "https://stackoverflow.com/questions/47724988/why-is-stack-build-altering-my-cabal-file", "title": "Why is `stack build` altering my .cabal file?", "body": "<p>I am attempting to build a project which uses <a href=\"https://hackage.haskell.org/package/Euterpea-2.0.2/docs/Euterpea.html\" rel=\"nofollow noreferrer\">Euterpea</a>.</p>\n\n<p>Running <code>stack build</code> I get the following error, suggesting that I need to add <code>Euterpea</code> to the <code>build-depends</code> section of my <code>.cabal</code> file.</p>\n\n<pre><code>$ sb\ncomposition-0.1.0.0: build (lib + exe)\nPreprocessing library composition-0.1.0.0...\n[2 of 2] Compiling Lib              ( src/Lib.hs, .stack-work/dist/x86_64-linux-nix/Cabal-1.24.2.0/build/Lib.o )\n\n/home/matthew/backup/composition/composition/src/Lib.hs:5:1: error:\n    Failed to load interface for \u2018Euterpea\u2019\n    It is a member of the hidden package \u2018Euterpea-2.0.4\u2019.\n    Perhaps you need to add \u2018Euterpea\u2019 to the build-depends in your .cabal file.\n    Use -v to see a list of the files searched for.\n\n--  While building package composition-0.1.0.0 using:\n      /home/matthew/.stack/setup-exe-cache/x86_64-linux-nix/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-linux-nix/Cabal-1.24.2.0 build lib:composition exe:composition-exe --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>I add <code>Euterpea</code> there, and the <code>library</code> section of my <code>.cabal</code> file then is the following.</p>\n\n<pre><code>library\n  hs-source-dirs:\n      src\n  build-depends:   base &gt;= 4.7 &amp;&amp; &lt; 5\n                 , Euterpea\n  exposed-modules:\n      Lib\n  other-modules:\n      Paths_composition\n  default-language: Haskell2010\n</code></pre>\n\n<p>However, when I then run <code>stack build</code> again, it gives the same error -- and changes my <code>.cabal</code> file back to what it was originally, with the <code>library</code> section then looking like</p>\n\n<pre><code>library\n  hs-source-dirs:\n      src\n  build-depends:\n      base &gt;= 4.7 &amp;&amp; &lt; 5\n  exposed-modules:\n      Lib\n  other-modules:\n      Paths_composition\n  default-language: Haskell2010\n</code></pre>\n\n<p>Why is <code>stack build</code> altering my <code>cabal</code> file? I have never seen that occurring before.</p>\n\n<hr>\n\n<p>Side note:\nNot sure if it is related, but the <code>.cabal</code> file's format appears to be different than it normally does. Here as with previous projects I auto-initialized by running <code>stack new &lt;project-name&gt;</code>. I don't know what I might have done different from previous projects to cause this unexpected behavior of <code>stack build</code>.</p>\n"}, {"tags": ["haskell", "serialization", "cloud-haskell"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1512794114, "post_id": 47724724, "comment_id": 82411379, "body": "Are you sure <code>myDecode = staticPtr (static decode)</code> doesn&#39;t work? It seems to me that you just traded the <code>Binary</code> constraint for a <code>StaticDecode</code> constraint, but you say it&#39;s working."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1512796273, "post_id": 47724724, "comment_id": 82411716, "body": "Sorry, the last function should be called <code>myPure</code>, not <code>myDecode</code>. Hopefully that makes more sense. But in a sense you&#39;re right, but inside the <code>StaticDecode</code> instance I&#39;m calling static (which works) but when I grab <code>decode</code> first from the Binary instance then apply static it fails.   I&#39;m guessing (this is entirely a guess) that each instance of <code>StaticDecode</code> generates a unique static pointer so this works fine."}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 2, "last_activity_date": 1512804299, "last_edit_date": 1512804299, "creation_date": 1512801676, "answer_id": 47726059, "question_id": 47724724, "link": "https://stackoverflow.com/questions/47724724/cloud-haskell-how-to-write-pure-for-closures/47726059#47726059", "title": "Cloud Haskell - How to write &quot;pure&quot; for Closures?", "body": "<p>Let's take a moment to consider what you are asking for.  Recall that typeclasses are basically shorthand for dictionary passing.  So let's rewrite:</p>\n\n<pre><code>data BinaryDict a = BinaryDict \n  { bdEncode :: a -&gt; ByteString\n  , bdDecode :: ByteString -&gt; a\n  }\n</code></pre>\n\n<p>Now you wish to write a function:</p>\n\n<pre><code>closurePure :: (Typeable a) =&gt; BinaryDict a -&gt; a -&gt; Closure a\n</code></pre>\n\n<p>Your attempt is:</p>\n\n<pre><code>closurePure bdict = closure (staticPtr (static (bdDecode bdict))) . bdEncode bdict\n</code></pre>\n\n<p>Now that we can see what's going on explicitly, we can see that <code>static</code>'s argument cannot be closed.  If <code>BinaryDict</code>s were allowed to be created willy nilly, say from user data, this function would be impossible.  We would instead need:</p>\n\n<pre><code>closurePure :: (Typeable a) =&gt; Static (BinaryDict a) -&gt; a -&gt; Closure a\n</code></pre>\n\n<p>That is, we need entries for the needed <code>Binary</code> instances in the static pointer table.  Hence your enumeration solution, and why I suspect that such a solution is required.  We also can't expect to enumerate it <em>too</em> automatically, because there are infinitely many instances.</p>\n\n<p>It seems silly to me, however, since instances seem like just the sorts of things that you would want to be static automatically.  They are static by nature (what's that, <a href=\"https://hackage.haskell.org/package/reflection\" rel=\"nofollow noreferrer\"><code>reflection</code></a>? I can't hear you).  This was probably at least ruminated about in the distributed Haskell papers (I haven't read them).</p>\n\n<p>We could solve this problem in general by simply creating a class that concretely enumerates every instance of every class (<a href=\"https://www.microsoft.com/en-us/research/publication/scrap-your-boilerplate-a-practical-approach-to-generic-programming/\" rel=\"nofollow noreferrer\">d\u00e9j\u00e0 vu</a>?).</p>\n\n<pre><code>class c =&gt; StaticConstraint c where\n    staticConstraint :: StaticPtr (Dict c)\ninstance StaticConstraint (Show Int) where\n    staticConstraint = static Dict\n-- a handful more lines...\n</code></pre>\n\n<p>Somewhat more seriously, if you really don't want to enumerate (I don't blame you), you can at least ease the pain with a calling convention:</p>\n\n<pre><code>closurePure :: (Typeable a, Binary a) =&gt; StaticPtr (ByteString -&gt; a) -&gt; a -&gt; Closure a\nclosurePure decodePtr = closure (staticPtr decodePtr) . encode\n\nsomeClosure :: Closure Int\nsomeClosure = closurePure (static decode) 42\n</code></pre>\n\n<p>This nonsense is necessary because <code>static</code> is a \"syntactic form\" rather than a function -- by mentioning it, we indicate that the <code>Binary</code> instance for <code>Int</code> must actually be generated and recorded in the static pointer table.</p>\n\n<p>If you are feeling cheeky you could enable <code>{-# LANGUAGE CPP #-}</code> and</p>\n\n<pre><code>-- PURE :: (Binary a, Typeable a) =&gt; a -&gt; Closure a, I promise\n#define PURE (closurePure (static decode))\n\nsomeClosure :: Closure Int\nsomeClosure = PURE 42\n</code></pre>\n\n<p>Maybe someday Haskell will take the next step and graduate to the time-tested <code>Segmentation fault (core dumped)</code> of its predecessors instead of spouting off those arrogant type errors.</p>\n"}, {"tags": [], "owner": {"reputation": 1768, "user_id": 1555575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/912457d15233f8da7851987f91a551e7?s=128&d=identicon&r=PG", "display_name": "macron", "link": "https://stackoverflow.com/users/1555575/macron"}, "is_accepted": true, "score": 4, "last_activity_date": 1512820817, "last_edit_date": 1512820817, "creation_date": 1512807637, "answer_id": 47726700, "question_id": 47724724, "link": "https://stackoverflow.com/questions/47724724/cloud-haskell-how-to-write-pure-for-closures/47726700#47726700", "title": "Cloud Haskell - How to write &quot;pure&quot; for Closures?", "body": "<p>You're right, <code>Closure</code> has an applicative-<em>like</em> structure, a fact made even more explicit in both the interface and the implementation of <a href=\"http://hackage.haskell.org/package/distributed-closure-0.3.4.0/docs/Control-Distributed-Closure.html\" rel=\"nofollow noreferrer\">distributed-closure</a>. It's not quite applicative, because in the <code>pure</code> case we do have the additional constraint that the argument must somehow be serializable.</p>\n\n<p>Actually, we have a stronger constraint. Not only must the argument be serializable, but the constraint must itself be serializable. Just like it's hard to serialize functions directly, you can imagine that it's hard to serialize constraints. But just like for functions, the trick is to serialize a <em>static pointer</em> to the constraint itself, if such a static pointer exists. How do we know that such a pointer exists? We could introduce a type class with a single method that gives us the name of the pointer, given a constraint:</p>\n\n<pre><code>class GimmeStaticPtr c where\n  gimmeStaticPtr :: StaticPtr (Dict c)\n</code></pre>\n\n<p>There's a slight technical trick going on here. The kind of the type index for <code>StaticPtr</code> is the kind <code>*</code>, whereas a constraint has kind <code>Constraint</code>.  So we reuse a trick from the <a href=\"http://hackage.haskell.org/package/constraints\" rel=\"nofollow noreferrer\">constraints</a> library that consists in wrapping a constraint into a data type (<code>Dict</code> above), which like all data types is of kind <code>*</code>. Constraints that have an associated <code>GimmeStaticPtr</code> instance are called <em>static constraints</em>.</p>\n\n<p>In general, it's sometimes useful to compose static constraints to get more static constraints. <code>StaticPtr</code> is not composable, but <code>Closure</code> is. so what <code>distributed-closure</code> actually does is define a similar class, that we'll call,</p>\n\n<pre><code>class GimmeClosure c where\n  gimmeClosure :: Closure (Dict c)   \n</code></pre>\n\n<p>Now we can define <code>closurePure</code> in a similar way that you did:</p>\n\n<pre><code>closurePure :: (Typeable a, GimmeClosure (Binary a)) =&gt; a -&gt; Closure a\n</code></pre>\n\n<p>It would be great if in the future, the compiler could resolve <code>GimmeClosure</code> constraints on-the-fly by generating static pointers as needed. But for now, the thing that comes closest is Template Haskell. distributed-closure provides a module to autogenerate <code>GimmeClosure (Cls a)</code> constraints at the definition site for class <code>Cls</code>. See <code>withStatic</code> <a href=\"http://hackage.haskell.org/package/distributed-closure-0.3.4.0/docs/Control-Distributed-Closure-TH.html\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>Incidentally, Edsko de Vries gave a <a href=\"https://skillsmatter.com/skillscasts/10632-static-pointers-closures-and-polymorphism\" rel=\"nofollow noreferrer\">great talk</a> about distributed-closure and the ideas embodied therein.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 0, "accepted_answer_id": 47726700, "answer_count": 2, "score": 6, "last_activity_date": 1512820817, "creation_date": 1512786375, "last_edit_date": 1512796126, "question_id": 47724724, "link": "https://stackoverflow.com/questions/47724724/cloud-haskell-how-to-write-pure-for-closures", "title": "Cloud Haskell - How to write &quot;pure&quot; for Closures?", "body": "<p>I've been playing with <a href=\"http://haskell-distributed.github.io/\" rel=\"noreferrer\">Cloud Haskell</a>. I've noticed <a href=\"https://hackage.haskell.org/package/distributed-static-0.3.8/docs/Control-Distributed-Static.html#t:Closure\" rel=\"noreferrer\">in the hackage documentation</a> there's a kind of applicative interface. But in particular I'm trying to find or write a function <code>closurePure</code> with the following signature:</p>\n\n<pre><code>closurePure :: (Typeable a, Binary a) =&gt; a -&gt; Closure a\n</code></pre>\n\n<p>This is basically a restricted version of pure.</p>\n\n<p>Whilst the <code>Closure</code> datatype itself is abstract, the following <a href=\"https://hackage.haskell.org/package/distributed-static-0.3.8/docs/Control-Distributed-Static.html#v:closure\" rel=\"noreferrer\"><code>closure</code></a> provided:</p>\n\n<pre><code>closure :: Static (ByteString -&gt; a) -&gt; ByteString -&gt; Closure a\n</code></pre>\n\n<p>So I can get this far:</p>\n\n<pre><code>closurePure :: (Typeable a, Binary a) =&gt; a -&gt; Closure a\nclosurePure x = closure ??? (encode x)\n</code></pre>\n\n<p>The problem is what to put where the <code>???</code>s are.</p>\n\n<p>My first attempt was the following:</p>\n\n<pre><code>myDecode :: (Typeable a, Binary a) =&gt; Static (ByteString -&gt; a)\nmyDecode = staticPtr (static decode)\n</code></pre>\n\n<p>But upon reading the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#static-semantics-of-static-pointers\" rel=\"noreferrer\">GHC docs on static pointers</a>, the <code>show</code> example suggested to me that you can't have a constraint because a constrained function doesn't have a <code>Typeable</code> instance. So I tried the work around suggested using <a href=\"https://hackage.haskell.org/package/constraints-0.9.1/docs/Data-Constraint.html#t:Dict\" rel=\"noreferrer\"><code>Dict</code></a>:</p>\n\n<pre><code>myDecode :: Typeable a =&gt; Static (Dict (Binary a) -&gt; ByteString -&gt; a)\nmyDecode = staticPtr (static (\\Dict -&gt; decode))\n</code></pre>\n\n<p>But now I've got the wrong type that doesn't fit into the <code>closure</code> function above.</p>\n\n<p>Is there anyway to write <code>closurePure</code> or something similar (or have I missed it in the Cloud Haskell docs)? Raising <code>binary</code> plain types to <code>Closure</code>s seems essential to using the applicative interface given, but I can't work out how to do it. </p>\n\n<p>Note that I can do this:</p>\n\n<pre><code>class StaticDecode a where\n  staticPtrDecode :: StaticPtr (ByteString -&gt; a)\n\ninstance StaticDecode Int where\n  staticPtrDecode = static Data.Binary.decode\n\ninstance StaticDecode Float where\n  staticPtrDecode = static Data.Binary.decode\n\ninstance StaticDecode Integer where\n  staticPtrDecode = static Data.Binary.decode\n\n-- More instances etc...\n\nmyPure :: forall a. (Typeable a, StaticDecode a, Binary a) =&gt; a -&gt; Closure a\nmyPure x = closure (staticPtr staticPtrDecode) (encode x)\n</code></pre>\n\n<p>Which works well but basically requires me to repeat an instance for each <code>Binary</code> instance. It seems messy and I'd prefer another way.</p>\n"}, {"tags": ["bash", "haskell", "ghci", "runhaskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1512778555, "post_id": 47723885, "comment_id": 82408604, "body": "GHCi is a tool for checking how code behaves. GHCi is not a way of running Haskell programs, and should not be treated as such."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1512830883, "post_id": 47723885, "comment_id": 82419975, "body": "Do you mean that you want a way of writing a script that, when run, produces a sort of live transcript of what the GHCi session would look like if you were typing the commands manually (with prompts, input, and output all shown)?"}, {"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1512873454, "post_id": 47723885, "comment_id": 82431133, "body": "Thanks @K.A.Buhr - I&#39;ve pushed that issue into another question to make this question more focused."}, {"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1512873467, "post_id": 47723885, "comment_id": 82431138, "body": "Thanks @AJFarmar - that&#39;s helpful."}], "answers": [{"comments": [{"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 0, "creation_date": 1512779334, "post_id": 47723948, "comment_id": 82408762, "body": "Cool - is there a way to script ghci so it runs from the bash script and exits cleanly?"}, {"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "reply_to_user": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 0, "creation_date": 1512780576, "post_id": 47723948, "comment_id": 82409066, "body": "@hawkeye Not sure exactly what you&#39;re trying to achieve. Ghci isn&#39;t really suited to scripting."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1512781186, "post_id": 47723948, "comment_id": 82409204, "body": "You can use <code>runhaskell</code> in a shebang.  Would an example help?"}, {"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 0, "creation_date": 1512781217, "post_id": 47723948, "comment_id": 82409211, "body": "Thanks that&#39;s helpful. I&#39;m trying to run some commands from a book repeatably and in sequence, automated from the bash command prompt. Specifically, I&#39;m trying to replicate running some ghci commands in a way that exits cleanly. (Ie not stuck in the ghci REPL)."}, {"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "reply_to_user": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 0, "creation_date": 1512782430, "post_id": 47723948, "comment_id": 82409452, "body": "@hawkeye You can simply combine your commands in a do block, and then run it with runhaskell, e.g. <code>main = do print (random (mkStdGen 100) :: (Int, StdGen)); putStrLn &quot;hello!&quot;</code> (You only need semi colons if you do it on one line, like comments are constrainted to)"}], "tags": [], "owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "is_accepted": true, "score": 3, "last_activity_date": 1512784236, "last_edit_date": 1512784236, "creation_date": 1512778446, "answer_id": 47723948, "question_id": 47723885, "link": "https://stackoverflow.com/questions/47723885/why-does-ghci-behave-differently-to-runhaskell/47723948#47723948", "title": "Why does ghci behave differently to runHaskell?", "body": "<p><code>ghci</code> is a REPL (Read, Eval, Print Loop). However, <code>runhaskell</code> is nearly the same as compiling a program into an executable, and then running it. GHCI lets us run individual functions and arbitrary expressions, wheras runhaskell just calls the main function and interprets the file, instead of compiling it, and running that. </p>\n\n<p>As @AJFarmar points out, GHCI is best used to debug and test a program you're building, whilst runhaskell is a nice way to run a whole program without having to compile.</p>\n\n<p>So, to fix your issue, we just need to give the program a main function. <code>ghci</code> calls <code>print</code> on the result of every expression which is typed into the interpreter and not bound to a variable.</p>\n\n<p>So, our main function can just be:</p>\n\n<p><code>main = print (random (mkStdGen 100) :: (Int, StdGen))</code></p>\n\n<p>We still need to import <code>System.Random</code>, so the whole file becomes:</p>\n\n<pre><code>import System.Random\n\nmain = print (random (mkStdGen 100) :: (Int, StdGen))\n</code></pre>\n\n<p>Then, we can run as expected:</p>\n\n<pre><code>[~]\u03bb runhaskell randomtest.hs \n(-3633736515773289454,693699796 2103410263)\n</code></pre>\n\n<p>If we want to multiple commands from runhaskell we can just add more to a do block in main:</p>\n\n<pre><code>import System.Random\n\nmain = do\n    print (random (mkStdGen 100) :: (Int, StdGen))\n    let x = 5 * 5\n    print x\n    putStrLn \"Hello world!\"\n</code></pre>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 0, "accepted_answer_id": 47723948, "answer_count": 1, "score": -1, "last_activity_date": 1515578947, "creation_date": 1512777942, "last_edit_date": 1515578947, "question_id": 47723885, "link": "https://stackoverflow.com/questions/47723885/why-does-ghci-behave-differently-to-runhaskell", "title": "Why does ghci behave differently to runHaskell?", "body": "<p>My goal is to pipe some steps for <code>ghci</code> to run from a bash script and then exit cleanly. The commentary online <a href=\"https://stackoverflow.com/a/8676361/15441\">says</a> to use <code>runhaskell</code> for this. </p>\n\n<p>This is the <a href=\"http://learnyouahaskell.com/input-and-output#randomness\" rel=\"nofollow noreferrer\">command</a> I'm trying to run:</p>\n\n<pre><code>ghci&gt; import System.Random \n\nghci&gt; random (mkStdGen 100) :: (Int, StdGen) \n</code></pre>\n\n<p>With expected result similar to:</p>\n\n<pre><code>(-3633736515773289454,693699796 2103410263)\n</code></pre>\n\n<p>When I drop this into a file <code>randomtest.hs</code> and execute it with <code>runhaskell</code> I get the following error:. </p>\n\n<pre><code>randomtest.hs:3:1: error:\n    Invalid type signature: random (mkStdGen 100) :: ...\n    Should be of form &lt;variable&gt; :: &lt;type&gt;\n</code></pre>\n\n<p>I need a hint to go in the right direction. </p>\n\n<p>My question is: <strong>Why does ghci behave differently to runHaskell?</strong></p>\n"}, {"tags": ["haskell", "io", "palindrome"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1512768989, "post_id": 47722475, "comment_id": 82405586, "body": "Hint: <code>palindrome &lt;- getLine</code> binds the result of <code>getline</code> to a local variable named <code>palindrome</code>, unrelated to the top level unction named <code>palindrome</code>."}, {"owner": {"reputation": 11, "user_id": 6895315, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207530554358330/picture?type=large", "display_name": "Bren Bailey", "link": "https://stackoverflow.com/users/6895315/bren-bailey"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1512769878, "post_id": 47722475, "comment_id": 82405956, "body": "Ok then why doesn&#39;t this work  (sorry if this isn&#39;t formatted right I can never format my damn code right in responses since it doesn&#39;t have the {} formatting tool and indenting never works.      code:     inline <code>palindrome :: String -&gt; Bool     palindrome x = x == reverse x     main = do       putStrLn &quot;Brendon Bailey CSCI 4200-DB&quot;       putStrLn &quot;Enter Word&quot;       x &lt;- getLine       palindrome x       putStrLn &quot;thanks&quot;</code>"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1512770288, "post_id": 47722475, "comment_id": 82406078, "body": "&quot;Doesn&#39;t work&quot; is not a problem description. What do you want <code>palindrome x</code> to do? Right now you&#39;re getting an error because <code>palindrome x</code> is just a boolean, and it doesn&#39;t make sense to put <code>False</code> or <code>True</code> in the middle of your program."}, {"owner": {"reputation": 11, "user_id": 6895315, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207530554358330/picture?type=large", "display_name": "Bren Bailey", "link": "https://stackoverflow.com/users/6895315/bren-bailey"}, "edited": false, "score": 0, "creation_date": 1512770498, "post_id": 47722475, "comment_id": 82406152, "body": "I just want to output the boolean result."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1512770636, "post_id": 47722475, "comment_id": 82406204, "body": "So ... <code>print (palindrome x)</code>?"}, {"owner": {"reputation": 11, "user_id": 6895315, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207530554358330/picture?type=large", "display_name": "Bren Bailey", "link": "https://stackoverflow.com/users/6895315/bren-bailey"}, "edited": false, "score": 0, "creation_date": 1512770811, "post_id": 47722475, "comment_id": 82406269, "body": "Oh. wow. I have been trying many different versions of that line but I kept getting the &quot;too many arguements etc&quot; errors. I wasn&#39;t putting parentheses so it thought I wanted to use multiple separate arguments. Thanks for pointing that out."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1512771092, "post_id": 47722475, "comment_id": 82406412, "body": "&quot;Also how can I set up a haskell script to just run when loaded? (...)&quot; Have you heard of compilation? Do you know about GHC?"}, {"owner": {"reputation": 11, "user_id": 6895315, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207530554358330/picture?type=large", "display_name": "Bren Bailey", "link": "https://stackoverflow.com/users/6895315/bren-bailey"}, "edited": false, "score": 0, "creation_date": 1512771474, "post_id": 47722475, "comment_id": 82406561, "body": "Yes I have. I want the do block to activate without requiring the user to enter &quot;main&quot;."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1512771583, "post_id": 47722475, "comment_id": 82406607, "body": "@BrenBailey... that&#39;s exactly what compilation does."}, {"owner": {"reputation": 11, "user_id": 6895315, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207530554358330/picture?type=large", "display_name": "Bren Bailey", "link": "https://stackoverflow.com/users/6895315/bren-bailey"}, "edited": false, "score": 0, "creation_date": 1512771811, "post_id": 47722475, "comment_id": 82406712, "body": "And to justify my previous confusion with the print output. If you just have the palindrome code outside of the do block and the user enters &quot;palindrome &quot;etc&quot;&quot;  in GHCi the program returns the boolean as output so I think it was pretty reasonable to assume the boolean would return as output when executed in a do block but thanks for the tinges of pompousness y&#39;all. StackExchange wouldn&#39;t be the same without belittling responses."}, {"owner": {"reputation": 11, "user_id": 6895315, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207530554358330/picture?type=large", "display_name": "Bren Bailey", "link": "https://stackoverflow.com/users/6895315/bren-bailey"}, "edited": false, "score": 0, "creation_date": 1512771888, "post_id": 47722475, "comment_id": 82406740, "body": "So are you saying there is a difference between compilation and using :load to run a program from GHCi? I&#39;m afraid I&#39;m confused about haskell code execution then."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1512772172, "post_id": 47722475, "comment_id": 82406857, "body": "@BrenBailey Ok, this question has become hugely broad. Have you read <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">learn you a haskell</a>? Also, calling people pompous isn&#39;t going to help you get an answer, please refrain from insulting people."}, {"owner": {"reputation": 11, "user_id": 6895315, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207530554358330/picture?type=large", "display_name": "Bren Bailey", "link": "https://stackoverflow.com/users/6895315/bren-bailey"}, "edited": false, "score": 0, "creation_date": 1512772488, "post_id": 47722475, "comment_id": 82406955, "body": "actually yes I&#39;ve been using this site. I guess I&#39;ll dig back into it. I&#39;m in a class where our professor gave us literally 2 days to write 5 programs in a functional language (which I&#39;ve never used since all of my classes including this one have been java, c++) ! So thanks and wish me luck!"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1512774563, "post_id": 47722475, "comment_id": 82407597, "body": "ghci is a developer tool. It&#39;s not how you normally run a program. For that you&#39;d either compile it (<code>ghc foo.hs</code>) and run the resulting executable, or you&#39;d use the interpreter (<code>runghc foo.hs</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6895315, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207530554358330/picture?type=large", "display_name": "Bren Bailey", "link": "https://stackoverflow.com/users/6895315/bren-bailey"}, "edited": false, "score": 1, "creation_date": 1512774726, "post_id": 47723418, "comment_id": 82407642, "body": "Fantastic explanation. This was very helpful and I appreciate you taking the time to explain."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 4, "last_activity_date": 1512774774, "last_edit_date": 1512774774, "creation_date": 1512774371, "answer_id": 47723418, "question_id": 47722475, "link": "https://stackoverflow.com/questions/47722475/haskell-how-to-read-user-input-to-be-used-in-a-function-inside-of-a-do-block/47723418#47723418", "title": "Haskell: How to read user input to be used in a function inside of a do block?", "body": "<p>This question is multiple questions in one, so I'll try to address each problem. I will address these in a different order to which they were stated in.</p>\n\n<p>Before we begin, it must be said that you have critical misconceptions about the way Haskell works. I strongly recommend reading <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">Learn You a Haskell for Great Good</a>, which may seem juvenile, but is in fact a stellar introduction to functional programming, and in fact is the way many of us began learning Haskell.</p>\n\n<h2>Question 1: Compilation, GHC, and Haskell executables</h2>\n\n<blockquote>\n  <p><em>(...) how can I set up a haskell script to just run when loaded? I don't want the user to have to type \"main\" I want it to just run.</em></p>\n</blockquote>\n\n<p>You are confusing <em>interpreted</em> scripting languages like Python, Javascript, or Ruby, with <em>compiled</em> languages like C, Java, or Haskell. </p>\n\n<p>Programs in <em>interpreted</em> languages are run by a program on the computer that contains information on how to interpret the text written, hence the name 'interpreted'. However, <em>compiled</em> languages are written, then converted from text into <em>machine code</em>, which is almost unreadable by humans, but which computers can run quickly.</p>\n\n<p>When we write a complete, executable program in Haskell, we expect to compile it with The Glasgow Haskell Compiler, GHC (<em>not</em> GHCi). This looks something like this:</p>\n\n<pre><code>$ cat MyProgram.hs\nmain :: IO ()\nmain = putStrLn \"This is my program!\"\n$ ghc MyProgram.hs\n[1 of 1] Compiling Main             ( MyProgram.hs, MyProgram.o )\nLinking MyProgram ...\n$ ./MyProgram\nThis is my program!\n</code></pre>\n\n<p>Now, <code>MyProgram.hs</code> was converted by GHC from a Haskell source code file into an executable, <code>MyProgram</code>. We defined an IO action, called <code>main</code>, to tell the compiler where we wanted it to begin. This is called an <em>entry point</em>, and is necessary to create a standalone executable. <strong>This is how Haskell programs are created and run.</strong></p>\n\n<p>Crucially, <strong>GHCi is <em>not</em> how Haskell programs are run.</strong> GHCi is an interactive environment for experimenting with Haskell functions and definitions. GHCi allows you to evaluate expressions (such as <code>palindrome \"Hello\"</code>, or <code>main</code>) but is <em>not</em> intended as the way to run Haskell programs, in the same way that python's IDLE is for Python programs.</p>\n\n<h2>Question 2: Functions vs IO actions</h2>\n\n<blockquote>\n  <p><em>(...) If you just have the palindrome code outside of the do block and the user enters \"palindrome \"etc\"\" in GHCi the program returns the boolean as output (...)</em></p>\n</blockquote>\n\n<p>Haskell does <em>not</em> behave like languages you may be used to. <strong>Functions in Haskell are <em>not</em> programs.</strong> When you defined your function <code>palindrome</code>, you made a way for the computer to convert a <code>String</code> into a <code>Bool</code>. You did <em>not</em> tell it how to output that <code>Bool</code> in any way. Hence, there is an extra step: the <code>IO</code> monad.</p>\n\n<p>Haskell programs are, in a way, represented as data, hence the somewhat strange type signature <code>main :: IO ()</code>. I will not be explaining monads in detail here, but put simply, in a <code>do</code>-block, you can only state things of type <code>IO a</code> where <code>a</code> is any type. So, when you wrote:</p>\n\n<pre><code>main = do\n    -- (...)\n    palindrome x\n    -- (...)\n</code></pre>\n\n<p>It didn't make sense. Think of it this way: how can you 'run' or 'execute' a <code>Bool</code>? It's a boolean, not a program!</p>\n\n<p>However, there is a function, called <code>print</code>, which allows you to do exactly that. Your line should be:</p>\n\n<pre><code>main = do\n    -- (...)\n    print (palindrome x)\n    -- (...)\n</code></pre>\n\n<p>I won't go into <code>print</code>s type signature, but rest assured that it does indeed return an <code>IO ()</code>, which allows us to put it into a <code>do</code>-block. By the way, if you write:</p>\n\n<pre><code>palindrome :: String -&gt; Bool\npalindrome x = x == reverse x\n\nmain = do\n  putStrLn \"Brendon Bailey CSCI 4200-DB\"\n  putStrLn \"Enter Word\"\n  x &lt;- getLine\n  print (palindrome x)\n  putStrLn \"thanks\"\n</code></pre>\n\n<p>...and compile the file with GHC, you will get the desired effect, assuming you did in fact want the program to output <code>True</code> or <code>False</code>. In fact, I compiled this as <code>Palindromes.hs</code>, and here's the result:</p>\n\n<pre><code>$ ghc Palindromes.hs \n[1 of 1] Compiling Main             ( Palindromes.hs, Palindromes.o )\nLinking Palindromes ...\n$ ./Palindromes\nBrendon Bailey CSCI 4200-DB\nEnter Word\namanaplanacanalpanama\nTrue\nthanks\n</code></pre>\n\n<h2>Question 3: GHCi as a testing environment</h2>\n\n<blockquote>\n  <p><em>[My code] works when \"palindrome \"etc\"\" is entered in GHCi then why doesn't my second code version do the same thing???</em></p>\n</blockquote>\n\n<p>GHCi, as stated before, is different from GHC, in that it is an environment to test and 'play' with Haskell code before writing standalone programs.</p>\n\n<p>In GHCi, you write expressions, and they are evaluated (using GHC's machinery), the result is printed, and it loops, Hence, this kind of system is often called a Read-Evaluate-Print-Loop, or a REPL.</p>\n\n<p>Let's examine a bit of code in GHCi:</p>\n\n<pre><code>\u03bb let plusOne n = n + 1\n\u03bb plusOne 5\n6\n</code></pre>\n\n<p>The first line defines a value (here a function) that we can use later. The second line, however, is not a definition, but an expression. Hence, GHCi evaluates it, and prints the result.</p>\n\n<p>GHCi can also execute IO actions:</p>\n\n<pre><code>\u03bb let myProgram = putStrLn \"Hello!\"\n\u03bb myProgram\nHello!\n</code></pre>\n\n<p>This works because evaluating an IO action in Haskell is equivalent to executing them: this is how Haskell is designed to work - it's a truly brilliant idea provided that you grasp it.</p>\n\n<p>Even though we see these similarities, <strong>GHCi is not equivalent to a Haskell program, as one might expect after using Python.</strong> GHCi unfortunately bears little resemblance to 'real' Haskell code, because Haskell works in a fundamentally different way to most other languages. </p>\n\n<p>GHCi is nothing more than a useful way to quickly see results of our code, as well as other useful information that I won't explain here.</p>\n\n<h2>Other points</h2>\n\n<p>Monads are a key part of the problem here. There have been many, many questions on Monads here on StackOverflow as they tend to be a sticking point, so any questions you may have are likely here. This makes things difficult, since Haskell IO cannot be fully appreciated without an understanding of Monads. There is an <a href=\"http://learnyouahaskell.com/a-fistful-of-monads\" rel=\"nofollow noreferrer\">LYAH chapter on Monads</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 794, "user_id": 3717658, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vtnZE.jpg?s=128&g=1", "display_name": "Naqib Hakimi", "link": "https://stackoverflow.com/users/3717658/naqib-hakimi"}, "is_accepted": false, "score": 1, "last_activity_date": 1512775044, "last_edit_date": 1512775044, "creation_date": 1512774399, "answer_id": 47723422, "question_id": 47722475, "link": "https://stackoverflow.com/questions/47722475/haskell-how-to-read-user-input-to-be-used-in-a-function-inside-of-a-do-block/47723422#47723422", "title": "Haskell: How to read user input to be used in a function inside of a do block?", "body": "<p>because they are not the same thing Haskell is a pure functional programming .\nwith no side effects ,for example if a sum function changes a global variable, or prints the sum before returning it, those are side effects. Functions in most other languages frequently have side effects, typically making them hard to analyze. Functional programming languages seek to avoid side effects when possible.</p>\n\n<p>in this case reading and writing to IO is side effects. \noperations that have side effects are handled by Monad (do) == (>>=) </p>\n\n<p>this is valid code</p>\n\n<pre><code>palindrome :: String -&gt; Bool\npalindrome x = x == reverse x\nmain = do\n  putStrLn \"Brendon Bailey CSCI 4200-DB\"\n  putStrLn \"Enter Word\"\n  x &lt;- getLine\n  let y = palindrome x\n  putStrLn \"thanks\"\n  print y\n</code></pre>\n\n<p>here is a good explanations about <a href=\"http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html\" rel=\"nofollow noreferrer\">Monads</a> </p>\n"}], "owner": {"reputation": 11, "user_id": 6895315, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207530554358330/picture?type=large", "display_name": "Bren Bailey", "link": "https://stackoverflow.com/users/6895315/bren-bailey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4552, "favorite_count": 0, "accepted_answer_id": 47723418, "answer_count": 2, "score": -2, "last_activity_date": 1512775044, "creation_date": 1512768763, "last_edit_date": 1512771047, "question_id": 47722475, "link": "https://stackoverflow.com/questions/47722475/haskell-how-to-read-user-input-to-be-used-in-a-function-inside-of-a-do-block", "title": "Haskell: How to read user input to be used in a function inside of a do block?", "body": "<p>I am attempting to run a simple palindrome program in Haskell but I want to request input from the user to be used in the program.</p>\n\n<p>code:</p>\n\n<pre><code>palindrome :: String -&gt; Bool\npalindrome x = x == reverse x\nmain = do\n  putStrLn \"Brendon Bailey CSCI 4200-DB\"\n  putStrLn \"Enter word to test for Palindrome\"\n  palindrome &lt;- getLine\n  putStrLn \"Thanks\"\n</code></pre>\n\n<p>The code works but it just displays \"thanks\". If I exclude the last line of the block I get the \"last line of do block must be expression\" and if I include the actual palindrome code above the do block I get errors saying I need a \"let\" statement but incorporating one causes more errors. I am brand new to Haskell (and functional programming in general. I do java, c++, and web langs) I think the explanation here will be simple but after reading input output documentation on haskell I still can't figure out the proper way to accomplish this.</p>\n\n<p>I'm doing it this way because my assignment stipulates that I must show the class info when the program is run. The palindrome part works fine without the do block. I'm just attempting to automatically output my text before testing a palindrome. Also how can I set up a haskell script to just run when loaded? I don't want the user to have to type \"main\" I want it to just run.</p>\n\n<p>edit: </p>\n\n<pre><code>palindrome :: String -&gt; Bool\npalindrome x = x == reverse x\nmain = do\n  putStrLn \"Brendon Bailey CSCI 4200-DB\"\n  putStrLn \"Enter Word\"\n  x &lt;- getLine\n  palindrome x\n  putStrLn \"thanks\"\n</code></pre>\n\n<p>This also doesn't work. How do I get the users input to use in the palindrome???</p>\n\n<p>If the code:</p>\n\n<pre><code>palindrome :: String -&gt; Bool\npalindrome x = x == reverse x\n</code></pre>\n\n<p>works when \"palindrome \"etc\"\" is entered in GHCi then why doesn't my second code version do the same thing???</p>\n\n<p>edit 2: \nDon't forget to enclose print statements in parentheses or Haskell will think it separate input is a separate argument. Dumb mistake but easy to make.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1239, "user_id": 8887578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3nMBo.png?s=128&g=1", "display_name": "Do Say Lazy", "link": "https://stackoverflow.com/users/8887578/do-say-lazy"}, "edited": false, "score": 0, "creation_date": 1512759529, "post_id": 47720257, "comment_id": 82401631, "body": "Could you post the relevant source code and the Cabal file? Perhaps the error is in there."}], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1512761358, "post_id": 47720563, "comment_id": 82402484, "body": "While I understand being self-deprecating, give yourself a bit of credit, too. No one remembers every module name. And you did figure it out yourself. Worst I can say is you&#39;re a bit trigger-happy on jumping to stack overflow. That&#39;s far from idiotic."}], "tags": [], "owner": {"reputation": 361, "user_id": 8514646, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/pNkTZ.png?s=128&g=1", "display_name": "kuwze", "link": "https://stackoverflow.com/users/8514646/kuwze"}, "is_accepted": false, "score": 0, "last_activity_date": 1512759399, "creation_date": 1512759399, "answer_id": 47720563, "question_id": 47720257, "link": "https://stackoverflow.com/questions/47720257/trouble-trying-to-use-cmdargs-in-haskell-failed-to-load-interface-for-cmdargs/47720563#47720563", "title": "Trouble trying to use CmdArgs in Haskell (Failed to load interface for \u2018CmdArgs\u2019)", "body": "<p>It turns out like usual I am an idiot.</p>\n\n<p>The correct thing to do is to check the full path of a library; for my example the page for <code>CmdArgs</code> specifies that the library path for the module is <code>System.Console.CmdArgs</code>.</p>\n"}], "owner": {"reputation": 361, "user_id": 8514646, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/pNkTZ.png?s=128&g=1", "display_name": "kuwze", "link": "https://stackoverflow.com/users/8514646/kuwze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1512759399, "creation_date": 1512757942, "last_edit_date": 1512759188, "question_id": 47720257, "link": "https://stackoverflow.com/questions/47720257/trouble-trying-to-use-cmdargs-in-haskell-failed-to-load-interface-for-cmdargs", "title": "Trouble trying to use CmdArgs in Haskell (Failed to load interface for \u2018CmdArgs\u2019)", "body": "<p>I am currently trying to use CmdArgs and I am running into some trouble.</p>\n\n<p>The code is <a href=\"https://github.com/kuwze/gc2\" rel=\"nofollow noreferrer\">here on github</a> and the error I am getting is this:</p>\n\n<pre><code> $ stack build\n\n gc2-0.1.0.0: configure (lib + exe) Configuring\n gc2-0.1.0.0... gc2-0.1.0.0: build (lib + exe) Preprocessing library\n gc2-0.1.0.0... Preprocessing executable 'gc2-exe' for gc2-0.1.0.0...\n [1 of 1] Compiling Main             ( app/Main.hs,\n .stack-work/dist/x86_64-linux-nopie/Cabal-1.24.2.0/build/gc2-exe/gc2-exe-tmp/Main.o )\n\n /home/kuwze/src/haskell/gc2/app/Main.hs:6:1: error:\n     Failed to load interface for \u2018CmdArgs\u2019\n     Use -v to see a list of the files searched for.\n\n --  While building package gc2-0.1.0.0 using:\n       /home/kuwze/.stack/setup-exe-cache/x86_64-linux-nopie/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-linux-nopie/Cabal-1.24.2.0 build lib:gc2 exe:gc2-exe --ghc-options \" -ddump-hi -ddump-to-file\"\n     Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>Any help would be greatly appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1512755572, "post_id": 47719323, "comment_id": 82399802, "body": "Updating only a part of a large structure is what <i>lenses</i> are for. But lenses are fairly advanced. I&#39;d recommend you write you own custom update function, something like <code>update :: Int -&gt; a -&gt; [a] -&gt; [a]</code>. This should be implementable by recursion."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 5, "creation_date": 1512755632, "post_id": 47719323, "comment_id": 82399835, "body": "Don&#39;t think of it as updating the list. Instead, think of it as computing a new list based on the old list, the position, and the value to append."}], "answers": [{"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1512764500, "creation_date": 1512764500, "answer_id": 47721612, "question_id": 47719323, "link": "https://stackoverflow.com/questions/47719323/add-element-to-sublist-of-a-list/47721612#47721612", "title": "Add element to sublist of a list", "body": "<p>If writing the recursive update function is difficult for you, you can convert your list structure to a synthetic indexed array with <code>zip</code></p>\n\n<pre><code>zip [0..] [[1],[2],[3],[4]]\n</code></pre>\n\n<p>and write your concat version based on the index as you do in other languages with indexed arrays</p>\n\n<pre><code>appendAt n a = map (\\(i,x) -&gt; if i==n then x++[a] else x) . zip [0..]\n</code></pre>\n\n<p>then, </p>\n\n<pre><code>appendAt 2 3 numbers\n</code></pre>\n\n<p>wll give you the desired result.</p>\n"}, {"tags": [], "owner": {"reputation": 794, "user_id": 3717658, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vtnZE.jpg?s=128&g=1", "display_name": "Naqib Hakimi", "link": "https://stackoverflow.com/users/3717658/naqib-hakimi"}, "is_accepted": false, "score": 1, "last_activity_date": 1512777604, "creation_date": 1512777604, "answer_id": 47723838, "question_id": 47719323, "link": "https://stackoverflow.com/questions/47719323/add-element-to-sublist-of-a-list/47723838#47723838", "title": "Add element to sublist of a list", "body": "<p>other way is by take and drop </p>\n\n<pre><code>take 2 numbers ++[(numbers !! 2) ++ [3]]++drop 3 numbers\n</code></pre>\n\n<ol>\n<li>take the first 2 array --> [[1],[2]]  </li>\n<li>find the target array and [3] to it --> [[3]++[3]] returns [[3,3]]</li>\n<li><p>drop 3 first array --> [[4]]</p>\n\n<p>[[1],[2]] ++ [[3]++[3]] ++ [[4]] = [[1],[2],[3,3],[4]]</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 0, "last_activity_date": 1512833936, "creation_date": 1512833936, "answer_id": 47730195, "question_id": 47719323, "link": "https://stackoverflow.com/questions/47719323/add-element-to-sublist-of-a-list/47730195#47730195", "title": "Add element to sublist of a list", "body": "<p>As chi already commented, the best way to do such an <em>update on part of a structure</em> in modern Haskell is with <em>lense combinators</em>, specifically, <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-At.html#v:ix\" rel=\"nofollow noreferrer\"><code>ix</code></a>:</p>\n\n<pre><code>Prelude Control.Lens&gt; let numbers = [[1],[2],[3],[4]]\nPrelude Control.Lens&gt; numbers &amp; ix 2 %~ (++[3])\n[[1],[2],[3,3],[4]]\n</code></pre>\n\n<p>(Don't be scared of lenses. The main <code>lens</code> package is huge and dependency-heavy, but most of its killer features, including <code>ix</code>, are also covered by the compatible and much smaller <a href=\"http://hackage.haskell.org/package/microlens\" rel=\"nofollow noreferrer\"><code>microlens</code> package</a>.)</p>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1512835047, "creation_date": 1512835047, "answer_id": 47730363, "question_id": 47719323, "link": "https://stackoverflow.com/questions/47719323/add-element-to-sublist-of-a-list/47730363#47730363", "title": "Add element to sublist of a list", "body": "<p>As others have noted, in Haskell you don't normally modify a data structure in place.  Instead, you break it apart, introduce your modification, and put it back together to create a new data structure that incorporates the change.</p>\n\n<p>For making changes to a specific list element, I've found the <code>splitAt</code> function to be useful for breaking apart lists.  For example, if you split your list at index 2, it produces the following pair of lists:</p>\n\n<pre><code>&gt; splitAt 2 numbers\n( [[1],[2]] , [[3],[4]] )  -- spaces added to make it clearer\n</code></pre>\n\n<p>Note that the element you want to change is the first element of the second list.  You can use Haskell's pattern matching to process this pair conveniently:</p>\n\n<pre><code>&gt; let (a, x:b) = splitAt 2 numbers\n&gt; a          -- initial part of list\n[[1],[2]]\n&gt; x          -- element to change\n[3]\n&gt; b          -- rest of list\n[[4]]\n&gt; a ++ x : b              -- put list back together unchanged\n[[1],[2],[3],[4]]\n&gt; a ++ (x ++ [3]) : b     -- put list together w/ modification\n[[1],[2],[3,3],[4]]\n</code></pre>\n\n<p>If this was turned into a Haskell function, it would probably look like:</p>\n\n<pre><code>appendSublist :: Int -&gt; [a] -&gt; [[a]] -&gt; [[a]]\nappendSublist idx y lst\n  = let (a, x:b) = splitAt idx lst\n    in  a ++ (x ++ y) : b\n</code></pre>\n\n<p>which you'd use like this:</p>\n\n<pre><code>&gt; appendSublist 2 [3] numbers\n[[1],[2],[3,3],[4]]\n</code></pre>\n\n<p>This basic pattern:</p>\n\n<pre><code>let (a, x:b) = splitAt idx lst in a ++ (...replacement for x...) : b\n</code></pre>\n\n<p>is worth memorizing, since it's pretty useful.</p>\n\n<p>Eventually, you'll probably want to learn to use the <code>lens</code> library for this kind of thing.  Lenses are more concise and more flexible (i.e., work for all sorts of things, not just specific list items), but there's a pretty big learning curve, as you can maybe guess from @leftaroundabout's answer.</p>\n"}], "owner": {"reputation": 41, "user_id": 8972834, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1084d7ea140fbad38f6db15e43552489?s=128&d=identicon&r=PG&f=1", "display_name": "JohnnyPire", "link": "https://stackoverflow.com/users/8972834/johnnypire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "answer_count": 4, "score": -2, "last_activity_date": 1512835047, "creation_date": 1512753854, "last_edit_date": 1512833636, "question_id": 47719323, "link": "https://stackoverflow.com/questions/47719323/add-element-to-sublist-of-a-list", "title": "Add element to sublist of a list", "body": "<p>I have the following code:</p>\n\n<pre><code>let numbers = [[1],[2],[3],[4]]\n</code></pre>\n\n<p>I want to append \"3\" to the sublist at index 2 of the list (<code>[3]</code>), like this:</p>\n\n<pre><code>(numbers !! 2) ++ [3]\n</code></pre>\n\n<p>to get this:</p>\n\n<pre><code>numbers = [[1],[2],[3,3],[4]]\n</code></pre>\n\n<p>But Im very confused :P Any idea?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1512748260, "post_id": 47717654, "comment_id": 82395751, "body": "Expand the definition of <code>.</code> in <code>(fmap . fmap)</code>. Then simplify. Then notice that one of your uses of <code>fmap</code> is taking a function as its second argument..."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1512749569, "post_id": 47717654, "comment_id": 82396525, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/47498896/apply-function-on-maybe-types\">apply function on Maybe types?</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1512756031, "post_id": 47717654, "comment_id": 82400043, "body": "@FyodorSoikin, that question looks almost completely unrelated."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1512756910, "post_id": 47717654, "comment_id": 82400449, "body": "The accepted answer explains why and how this works."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1512777227, "post_id": 47717654, "comment_id": 82408286, "body": "@FyodorSoikin The question here looks almost like the exact opposite: we have a function that <i>does</i> have this behavior and the question is why does it work. In the linked question, they describe the behavior and they are looking for an implementation."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 9, "last_activity_date": 1512748439, "creation_date": 1512748439, "answer_id": 47717824, "question_id": 47717654, "link": "https://stackoverflow.com/questions/47717654/why-do-the-types-in-fmap-fmap-sum-just-1-2-3-work/47717824#47717824", "title": "Why do the types in `(fmap . fmap) sum Just [1, 2, 3]` work?", "body": "<p>That isn't lifting over both <code>Maybe</code> and <code>List</code> (that would be <code>(fmap . fmap) sum (Just [1,2,3])</code>, which has a type problem), but over the function type <code>(-&gt;)</code> and <code>Maybe</code>.</p>\n\n<pre><code>Just :: a -&gt; Maybe a\n     -- ((-&gt;) a) (Maybe a)\n     -- f (g a)   for f ~ ((-&gt;) a)  and  g ~ Maybe\n\n(fmap . fmap) :: (a   -&gt; b) -&gt; f (g a  ) -&gt; f (g b)\n     -- Num x =&gt; ([x] -&gt; x) -&gt; f (g [x]) -&gt; f (g x)\n     -- Num x =&gt; ([x] -&gt; x) -&gt; ([x] -&gt; Maybe [x]) -&gt; [x] -&gt; Maybe x\n     --          ^             ^                     ^\n     --          sum           Just                  [1,2,3]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1512756472, "post_id": 47717995, "comment_id": 82400261, "body": "Since <code>sum</code> has a more general type these days, you might want to give it a type signature."}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1512760894, "post_id": 47717995, "comment_id": 82402272, "body": "In this situation it is just <code>Num a =&gt; [a] -&gt; a</code> and the more general type signature does not change things."}], "tags": [], "owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "is_accepted": true, "score": 7, "last_activity_date": 1512749373, "last_edit_date": 1512749373, "creation_date": 1512748954, "answer_id": 47717995, "question_id": 47717654, "link": "https://stackoverflow.com/questions/47717654/why-do-the-types-in-fmap-fmap-sum-just-1-2-3-work/47717995#47717995", "title": "Why do the types in `(fmap . fmap) sum Just [1, 2, 3]` work?", "body": "<p>If you don't understand how a particular answer works, line up the argument you are supplying with the type from the previous step.</p>\n\n<pre><code>Prelude&gt; :t (fmap . fmap) sum\n(fmap . fmap) sum\n  :: (Functor f, Functor f1, Num b) =&gt; f (f1 [b]) -&gt; f (f1 b)\n</code></pre>\n\n<p>So in order for this work, <code>Just</code> has to have type <code>f (f1 [b])</code>, and then <code>(fmap . fmap) sum Just</code> has to have type <code>f (f1 b)</code>.</p>\n\n<pre><code>Just :: (Functor f, Functor f1, Num b) =&gt; f (f1 [b])\n</code></pre>\n\n<p>It's not obvious what <code>f</code> or <code>f1</code> should be here, so let's try the RHS instead. We can cheat and ask GHCi to check what the actual value of <code>(fmap . fmap) sum Just</code> should be:</p>\n\n<pre><code>Prelude&gt; :t (fmap . fmap) sum Just\n(fmap . fmap) sum Just :: Num b =&gt; [b] -&gt; Maybe b\n</code></pre>\n\n<p>But this <em>should</em> match:</p>\n\n<pre><code>(Functor f, Functor f1, Num b) =&gt; f (f1 b)\n</code></pre>\n\n<p>We're trying to figure out what <code>f</code> and <code>f1</code> are here. So we have to rewrite it a little bit so it has the same structure (remember that <code>-&gt;</code> is syntactic sugar and gets in the way sometimes):</p>\n\n<pre><code>(fmap . fmap) sum Just :: Num b =&gt; [b] -&gt; Maybe b\n-- Same as...\n(fmap . fmap) sum Just :: Num b =&gt; (-&gt;) [b] (Maybe b)\n-- Or...\n(fmap . fmap) sum Just :: Num b =&gt; ((-&gt;) [b]) (Maybe b)\n--                     Functor f = ((-&gt;) [b])\n--                                Functor f1 = Maybe\n</code></pre>\n\n<p>So we can figure out that in order for the types to match, the <code>Functor f</code>  has to be <code>(-&gt;) [b]</code>\u2026 remember that functions are functors too! And the <code>Functor f1</code> is <code>Maybe</code>, which is a bit more obvious.</p>\n\n<p>We can test this out:</p>\n\n<pre><code>Prelude&gt; :t (fmap . fmap) sum :: Num b =&gt; ([b] -&gt; Maybe [b]) -&gt; ([b] -&gt; Maybe b)\n(fmap . fmap) sum :: Num b =&gt; ([b] -&gt; Maybe [b]) -&gt; ([b] -&gt; Maybe b)\n  :: Num b =&gt; ([b] -&gt; Maybe [b]) -&gt; [b] -&gt; Maybe b\n</code></pre>\n\n<p>And GHCi thinks it type checks just fine.</p>\n\n<p>The only part here that's easy to forget is just that <code>(-&gt;) [b]</code> is a valid functor!</p>\n"}], "owner": {"reputation": 664, "user_id": 3655449, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/URJfw.jpg?s=128&g=1", "display_name": "javinor", "link": "https://stackoverflow.com/users/3655449/javinor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 47717995, "answer_count": 2, "score": 8, "last_activity_date": 1512749373, "creation_date": 1512747897, "question_id": 47717654, "link": "https://stackoverflow.com/questions/47717654/why-do-the-types-in-fmap-fmap-sum-just-1-2-3-work", "title": "Why do the types in `(fmap . fmap) sum Just [1, 2, 3]` work?", "body": "<p>I'm having the time of my life reading the wonderful <a href=\"http://haskellbook.com/\" rel=\"noreferrer\">Haskell Programming from first principles</a> and I came by the following example that I'm just not able to take apart (Page 1286 e-reader):</p>\n\n<pre><code>Prelude&gt; (fmap . fmap) sum Just [1, 2, 3]\nJust 6\n</code></pre>\n\n<p>It is obvious to me how the following works:</p>\n\n<pre><code>Prelude&gt; fmap sum $ Just [1,2,3]\nJust 6\n</code></pre>\n\n<p>And I already manually deconstructed <code>(fmap . fmap)</code> to understand how the types work. But when thinking about this as \"lifting twice\" it doesn't make sense, since I'm lifting over both the Just and List data constructors.</p>\n\n<p>I typed out the following in <code>ghci</code>:</p>\n\n<pre><code>Prelude&gt; :t (fmap . fmap)\n(fmap . fmap)\n  :: (Functor f, Functor f1) =&gt; (a -&gt; b) -&gt; f1 (f a) -&gt; f1 (f b)\n\nPrelude&gt; :t (fmap . fmap) sum\n(fmap . fmap) sum\n  :: (Num b, Foldable t, Functor f, Functor f1) =&gt;\n     f1 (f (t b)) -&gt; f1 (f b)\n\nPrelude&gt; :t (fmap . fmap) sum Just\n(fmap . fmap) sum Just :: (Num b, Foldable t) =&gt; t b -&gt; Maybe b\n</code></pre>\n\n<p>I don't understand how to derive the last output. When feeding <code>(fmap . fmap) sum</code> the <code>Just</code> data constructor, How does the compiler know to replace both <code>f1</code> and <code>f</code> for <code>Maybe</code>? After I'll get a good answer here, how could I have figured it out myself?</p>\n"}, {"tags": ["haskell", "shared-state", "ioref"], "answers": [{"tags": [], "owner": {"reputation": 1069, "user_id": 4299824, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LKWkrlvV9UE/AAAAAAAAAAI/AAAAAAAABYQ/OWKjHFpdGGs/photo.jpg?sz=128", "display_name": "YAMAMOTO Yuji", "link": "https://stackoverflow.com/users/4299824/yamamoto-yuji"}, "is_accepted": true, "score": 6, "last_activity_date": 1512722716, "creation_date": 1512722716, "answer_id": 47710587, "question_id": 47710123, "link": "https://stackoverflow.com/questions/47710123/how-to-share-ioref-state-between-two-function-invocations-in-haskell-when-using/47710587#47710587", "title": "How to share IORef state between two function invocations in Haskell when using IO?", "body": "<p>Seems that you confused <code>IO IORefState</code> with <code>IORefState</code> (without <code>IO</code>), more generally, <code>IO a</code> with <code>a</code>.</p>\n\n<p>In your case, the value of <code>IO IORefState</code> is <em>the action</em> <code>newIORef empty</code>, which represents \"an action that creates a fresh new <code>IORef</code> from scratch\".<br>\nBy contrast, <code>IORefState</code> (without <code>IO</code>) is the right, <em>raw object</em> that you should share among the functions that use it (<code>saveStringToState</code>, and <code>findStringInState</code>).<br>\nThen, both <code>saveStringToState</code> and <code>findStringInState</code> separately call <code>newIORef empty</code>, i.e. each of them create a different <code>IORefState</code> object, which cannot be affected by the other.</p>\n\n<p>To fix, you must call <code>newIORef empty</code> (as an <code>IO</code> action using <code>&lt;-</code>) in <code>doStuff</code> function and share the <code>IORefState</code> created by <code>newIORef empty</code> instead of <code>IO IORefState</code>:</p>\n\n<pre><code>  saveStringToState :: IORefState -&gt; String -&gt; IO String\n  ...\n\n  findStringInState :: IORefState -&gt; String -&gt; IO (Maybe String)\n  ...\n\n  let stateIO = newIORef empty\n  in do ioRef &lt;- stateIO\n        saveStringToState ioRef \"string1\"\n        findStringInState ioRef \"string1\"\n  -- Or, more simply:\n  do ioRef &lt;- newIORef empty\n     saveStringToState ioRef \"string1\"\n     findStringInState ioRef \"string1\"\n</code></pre>\n\n<p>In my opinion, the difference between <code>IO a</code> with <code>a</code> is similar to the difference between \"a function object that returns a value typed as <code>a</code> (with some side effects)\" and \"just a raw value typed as <code>a</code>\" in the other programming languages.</p>\n"}], "owner": {"reputation": 28942, "user_id": 398441, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/a8950160c2b3d7d0bf948d8c1f937e7f?s=128&d=identicon&r=PG", "display_name": "Johan", "link": "https://stackoverflow.com/users/398441/johan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "accepted_answer_id": 47710587, "answer_count": 1, "score": 2, "last_activity_date": 1526820644, "creation_date": 1512720415, "last_edit_date": 1526820644, "question_id": 47710123, "link": "https://stackoverflow.com/questions/47710123/how-to-share-ioref-state-between-two-function-invocations-in-haskell-when-using", "title": "How to share IORef state between two function invocations in Haskell when using IO?", "body": "<p>I'm trying to learn Haskell and I'm playing around with IORef to which I try to save and find records. My <a href=\"https://github.com/johanhaleby/rps-haskell\" rel=\"nofollow noreferrer\">code</a> looks something like this (note that I've chosen \"String\" as IORef type in this example only for convienence and briefty, in my actual code I'm using a record. And also ignore that I'm using a Set instead of a Map, I will change that):</p>\n\n<pre><code>module MyTest where\n\nimport           Data.IORef\nimport           Data.Set\nimport           Data.Foldable          (find)\n\ntype State = (Set String)\ntype IORefState = IORef State\n\nsaveStringToState :: IO IORefState -&gt; String -&gt; IO String\nsaveStringToState stateIO string = do\n  state &lt;- stateIO\n  atomicModifyIORef\n    state\n    (\\oldStrings -&gt;\n       let updatedStrings = insert string oldStrings\n       in (updatedStrings, updatedStrings))\n  stringsState &lt;- readIORef state :: IO State\n  putStrLn (\"### saved: \" ++ show stringsState)\n  return string\n\nfindStringInState :: IO IORefState -&gt; String -&gt; IO (Maybe String)\nfindStringInState stateIO soughtString = do\n  state &lt;- stateIO :: IO IORefState\n  strings &lt;- readIORef state :: IO State\n  putStrLn (\"Looking for \" ++ soughtString ++ \" in: \" ++ show strings)\n  return $ find (== soughtString) strings\n\ndoStuff =\n  let stateIO = newIORef empty\n  in do saveStringToState stateIO \"string1\"\n        findStringInState stateIO \"string1\"\n</code></pre>\n\n<p>What I want to achieve is to share the state (Set) between the two function calls so that <code>findStringInState</code> can return the <code>String</code> that I just inserted into the Set. But when I run the <code>doStuff</code> function I get this:</p>\n\n<pre><code>*MyTest&gt; doStuff\n### saved: fromList [\"string1\"]\nLooking for string1 in: fromList []\nNothing\n</code></pre>\n\n<p>I've probably misunderstood something since I thought the IORef should indeed be the container for my state. </p>\n\n<ol>\n<li>Why is this not working?</li>\n<li>What can I do to make it work?</li>\n</ol>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1512732385, "last_edit_date": 1512732385, "creation_date": 1512727079, "answer_id": 47711834, "question_id": 47709283, "link": "https://stackoverflow.com/questions/47709283/what-is-the-cause-of-this-mysterious-haskell-type-error-involving-reflection/47711834#47711834", "title": "What is the cause of this mysterious Haskell type error involving reflection?", "body": "<pre><code>reify :: forall a r. a -&gt; (forall s. Reifies s a =&gt; Proxy s -&gt; r) -&gt; r\n</code></pre>\n\n<p>The skolem requirement essentially states that <code>r</code> in the type above can not depend on the <code>s</code> which is being quantified in the second argument. Otherwise, indeed it would \"escape\" its scope since <code>reify</code> returns <code>r</code>.</p>\n\n<p>In</p>\n\n<pre><code>reifyBad :: (forall s. Reifies s s =&gt; Proxy s) -&gt; ()\nreifyBad p = reify undefined (\\(_ :: Proxy t) -&gt; p @t `seq` ())\n</code></pre>\n\n<p>we see that the second argument of <code>reify</code> is <code>\\(_ :: Proxy t) -&gt; p @t `seq` ()</code>, so the type <code>r</code> would be return type of that function, which is <code>()</code>. Since <code>r ~ ()</code> does not depend on <code>s</code>, there's no escaping problem here.</p>\n\n<p>However, <code>p @t</code> according to the type of <code>p</code> requires <code>Reifies t t</code>. \nSince <code>reify</code> will choose <code>t ~ s</code>, the constraint is the same as <code>Reifies s s</code>.\nInstead, <code>reify</code> only provides <code>Reifies s a</code> where <code>a</code> is the type of <code>undefined</code>.</p>\n\n<p>The subtle point here is that, while <code>undefined</code> can produce any type <code>a</code>, the type checker can not unify <code>s</code> and <code>a</code>. This is because a function with the same type as <code>reify</code> is entitled to receive only one value of a fixed (rigid) type <code>a</code>, and then choose as many types <code>s</code> as wanted. Unifying all such <code>s</code>s with a single <code>a</code> would be wrong, effectively constraining the choice of <code>s</code> by <code>reify</code>.</p>\n\n<p>Instead, in the variant</p>\n\n<pre><code>reifyBad' :: (forall s. Reifies s s =&gt; Proxy s) -&gt; ()\nreifyBad' p = reify undefined (\\(_ :: Proxy t) -&gt; p @t) `seq` ()\n</code></pre>\n\n<p>here <code>r</code> is inferred to be the return type of <code>\\(_ :: Proxy t) -&gt; p @t</code>, which is <code>Proxy t</code>, where <code>t ~ s</code>. Since <code>r ~ Proxy s</code> does depend on <code>s</code>, we trigger a skolem error.</p>\n"}], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 495, "favorite_count": 0, "accepted_answer_id": 47711834, "answer_count": 1, "score": 8, "last_activity_date": 1512732385, "creation_date": 1512716486, "question_id": 47709283, "link": "https://stackoverflow.com/questions/47709283/what-is-the-cause-of-this-mysterious-haskell-type-error-involving-reflection", "title": "What is the cause of this mysterious Haskell type error involving reflection?", "body": "<p>I was playing with the Haskell <a href=\"https://hackage.haskell.org/package/reflection\" rel=\"noreferrer\">reflection</a> package, and I ran into a type error I do not fully understand. First, I tried to write the following function, which happily typechecks:</p>\n\n<pre><code>{-# LANGUAGE TypeApplications #-}\n\nreifyGood :: (forall s. Reifies s a =&gt; Proxy a) -&gt; ()\nreifyGood p = reify undefined (\\(_ :: Proxy t) -&gt; p @t `seq` ())\n</code></pre>\n\n<p>Interestingly, however, this slightly different program does <em>not</em> typecheck:</p>\n\n<pre><code>reifyBad :: (forall s. Reifies s s =&gt; Proxy s) -&gt; ()\nreifyBad p = reify undefined (\\(_ :: Proxy t) -&gt; p @t `seq` ())\n</code></pre>\n\n<p></p>\n\n<pre><code>\u2022 Could not deduce (Reifies s s) arising from a use of \u2018p\u2019\n  from the context: Reifies s a0\n    bound by a type expected by the context:\n               Reifies s a0 =&gt; Proxy s -&gt; ()\n\u2022 In the first argument of \u2018seq\u2019, namely \u2018p @t\u2019\n  In the expression: p @t `seq` ()\n  In the second argument of \u2018reify\u2019, namely\n    \u2018(\\ (_ :: Proxy t) -&gt; p @t `seq` ())\u2019\n</code></pre>\n\n<p>The expressions are identical, but note the difference between the type signatures:</p>\n\n<pre><code>reifyGood :: (forall s. Reifies s a =&gt; Proxy a) -&gt; ()\nreifyBad  :: (forall s. Reifies s s =&gt; Proxy s) -&gt; ()\n</code></pre>\n\n<p>I find this curious. At first glance, this is invalid because, in the second example, the skolem <code>s</code> would escape its scope. However, this is not actually true\u2014the error message never mentions skolem escape, in contrast with this slightly different program:</p>\n\n<pre><code>reifyBad' :: (forall s. Reifies s s =&gt; Proxy s) -&gt; ()\nreifyBad' p = reify undefined (\\(_ :: Proxy t) -&gt; p @t) `seq` ()\n</code></pre>\n\n<p></p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018t0\u2019 with actual type \u2018Proxy s\u2019\n    because type variable \u2018s\u2019 would escape its scope\n  This (rigid, skolem) type variable is bound by\n    a type expected by the context:\n      Reifies s a0 =&gt; Proxy s -&gt; t0\n\u2022 In the expression: p @t\n  In the second argument of \u2018reify\u2019, namely\n    \u2018(\\ (_ :: Proxy t) -&gt; p @t)\u2019\n  In the first argument of \u2018seq\u2019, namely\n    \u2018reify undefined (\\ (_ :: Proxy t) -&gt; p @t)\u2019\n</code></pre>\n\n<p>So perhaps something else is at play here.</p>\n\n<p>Examining the type of <code>reify</code>, it becomes a little clear that something is amiss:</p>\n\n<pre><code>reify :: forall a r. a -&gt; (forall s. Reifies s a =&gt; Proxy s -&gt; r) -&gt; r\n</code></pre>\n\n<p>The scopes of <code>a</code> and <code>s</code> are clearly different, so it seems to make sense that GHC would not allow them to unify. However, it seems something about the local equality constraint introduced by the functional dependency on <code>Reifies</code> causes some sort of odd behavior. Interestingly, this pair of functions typechecks:</p>\n\n<pre><code>foo :: forall a r. Proxy a -&gt; (forall s. (s ~ a) =&gt; Proxy s -&gt; r) -&gt; r\nfoo _ f = f Proxy\n\nbar :: (forall a. Proxy a) -&gt; ()\nbar p = let p' = p in foo p' (\\(_ :: Proxy s) -&gt; (p' :: Proxy s) `seq` ())\n</code></pre>\n\n<p>\u2026but removing the equality constraint in the type signature of <code>foo</code> makes them fail to typecheck, producing a skolem escape error:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018a0\u2019 with \u2018s\u2019\n    because type variable \u2018s\u2019 would escape its scope\n  This (rigid, skolem) type variable is bound by\n    a type expected by the context:\n      Proxy s -&gt; ()\n  Expected type: Proxy s\n    Actual type: Proxy a0\n\u2022 In the first argument of \u2018seq\u2019, namely \u2018(p' :: Proxy s)\u2019\n  In the expression: (p' :: Proxy s) `seq` ()\n  In the second argument of \u2018foo\u2019, namely\n    \u2018(\\ (_ :: Proxy s) -&gt; (p' :: Proxy s) `seq` ())\u2019\n</code></pre>\n\n<p>At this point, I\u2019m perplexed. I have a couple (highly related) questions.</p>\n\n<ol>\n<li><p>Why does <code>reifyBad</code> fail to typecheck in the first place?</p></li>\n<li><p>More specifically, why does it produce a <em>missing instance</em> error?</p></li>\n</ol>\n\n<p>Moreover, is this behavior expected and well-defined, or is it merely a strange edge case of the typechecker that happens to produce this particular result?</p>\n"}, {"tags": ["haskell", "fibonacci"], "comments": [{"owner": {"reputation": 1239, "user_id": 8887578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3nMBo.png?s=128&g=1", "display_name": "Do Say Lazy", "link": "https://stackoverflow.com/users/8887578/do-say-lazy"}, "edited": false, "score": 0, "creation_date": 1512712695, "post_id": 47708534, "comment_id": 82376934, "body": "Have you tried using <code>read</code> to convert the <code>String</code> to an <code>Int</code>?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1512712700, "post_id": 47708534, "comment_id": 82376937, "body": "What should happen if your command line arguments are not numbers?"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1512734739, "post_id": 47708534, "comment_id": 82387933, "body": "Hint: if you use <code>map fibonacci . catMaybes . map readMaybe</code> from <code>Data.Maybe</code> on the list of strings, you\u2019ll get a list of <code>Int</code> values that skips all non-integer inputs. You could also wrap <code>readMaybe</code> in a function that calls <code>error</code> on invalid input and also tells the compiler what type to read to."}], "answers": [{"tags": [], "owner": {"reputation": 1239, "user_id": 8887578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3nMBo.png?s=128&g=1", "display_name": "Do Say Lazy", "link": "https://stackoverflow.com/users/8887578/do-say-lazy"}, "is_accepted": false, "score": 1, "last_activity_date": 1512713376, "last_edit_date": 1512713376, "creation_date": 1512713051, "answer_id": 47708614, "question_id": 47708534, "link": "https://stackoverflow.com/questions/47708534/fibonacci-sequence-in-haskell/47708614#47708614", "title": "Fibonacci sequence in Haskell", "body": "<p>You should use the <code>read</code> or <code>readMaybe</code> functions to get an <code>Int</code> from the <code>String</code>:</p>\n\n<pre><code>fibonacci_wrapper :: [String] -&gt; Maybe Int\nfibonacci_wrapper (x:_) =\n    case readMaybe x of\n        Just n -&gt; Just (fibonacci n)\n        Nothing -&gt; Nothing -- read failed\n-- Not enough args\nfibonacci_wrapper _ = Nothing\n</code></pre>\n\n<p>However, if you want to take multiple arguments, you should return the rest of the argument list along with the <code>Int</code> result so that you can continue consuming arguments.</p>\n"}, {"tags": [], "owner": {"reputation": 48, "user_id": 6093436, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0GvDe.jpg?s=128&g=1", "display_name": "DRTorresRuiz", "link": "https://stackoverflow.com/users/6093436/drtorresruiz"}, "is_accepted": false, "score": 1, "last_activity_date": 1512737437, "last_edit_date": 1512737437, "creation_date": 1512736225, "answer_id": 47714469, "question_id": 47708534, "link": "https://stackoverflow.com/questions/47708534/fibonacci-sequence-in-haskell/47714469#47714469", "title": "Fibonacci sequence in Haskell", "body": "<p><strong>Wrapper</strong> solution could be:</p>\n\n<pre><code>wrapperStringToInt :: [String] -&gt; [Int]\nwrapperStringToInt [] = []\nwrapperStringToInt (x:xs) = (read x :: Int) : wrapperStringToInt xs\n</code></pre>\n\n<p>You could use tuples to return <code>fibonacci 4 is 3</code>. The function <strong><code>printFibonacci</code></strong> prints that for each tuple.</p>\n\n<pre><code>printFibonacci :: [(Int, Int)] -&gt; IO ()\nprintFibonacci [] = return ()\nprintFibonacci ((x, z):xs) = \n    do  putStrLn $ \"fibonacci \" ++ show x ++ \" is \" ++ show z\n        printFibonacci xs\n</code></pre>\n\n<p>The command </p>\n\n<pre><code>map f (wrapperStringToInt arguments)\n    where\n        f = (\\ x -&gt; (x, fibonacci x))\n</code></pre>\n\n<p>returns an array with tuples <code>( Input, Output )</code> (e.g. With <code>[3,4,5]</code> this command returns <code>[(3,2),(4,3),(5,5)]</code>).</p>\n\n<pre><code>main = do\n    arguments &lt;- getArgs\n    printFibonacci $ map f (wrapperStringToInt arguments)\n        where f = (\\ x -&gt; (x, fibonacci x))\n</code></pre>\n\n<p>After that, run in the terminal:</p>\n\n<pre><code>runhaskell Fibonacci.hs &lt;INPUT&gt;\n</code></pre>\n\n<p>(e.g. <code>runhaskell Fibonacci.hs 3 4 5</code>)</p>\n\n<p>Finally, to execute this program like <code>./program 4 5 6</code>, you could write an executable bash program, for example:</p>\n\n<pre><code>#!/bin/bash\nrunhaskell Fibonacci.hs \"$@\"\n</code></pre>\n\n<p>If error control is important you should use Maybe as other users have commented. I hope you find this information useful.</p>\n"}], "owner": {"reputation": 1, "user_id": 9070915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c7befd21b02b67477b06aefa5981bf?s=128&d=identicon&r=PG&f=1", "display_name": "Hopsain", "link": "https://stackoverflow.com/users/9070915/hopsain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 414, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1513137119, "creation_date": 1512712518, "last_edit_date": 1513137119, "question_id": 47708534, "link": "https://stackoverflow.com/questions/47708534/fibonacci-sequence-in-haskell", "title": "Fibonacci sequence in Haskell", "body": "<p>I am trying to build a fibonacci wrapper function that takes in multiple command line arguments and computes the associated Fibonacci number for each argument</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1512693578, "post_id": 47705484, "comment_id": 82372253, "body": "Yes I see it. Shouldn&#39;t I have to <code>(unsafe)Thaw</code> again before I can write?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1512693975, "post_id": 47705484, "comment_id": 82372351, "body": "Unsafe freezing is in principle very cheap, in fact a no-op. And no, I don&#39;t think you&#39;d have to thaw anything, provided you strictly evaluate the max-index before resuming the monadic computation. But better test&amp;bench it..."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1512694210, "post_id": 47705484, "comment_id": 82372399, "body": "@leftaroundabout hrm I&#39;m confused then. What does <code>unsafeFreeze</code> do if not ensure that the MVector in-place freezes to an immutable <code>Vector</code>? If that&#39;s already been done, how can I then write to that position in memory?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1512695891, "post_id": 47705484, "comment_id": 82372805, "body": "<code>unsafeFreeze</code> does not ensure anything, that&#39;s why it&#39;s called <i>unsafe</i>. It simply pretends the memory associated with a mutable vector actually belongs to an immutable one. Of course that can go catastrophically wrong when you clobber that memory whilst something is still processing the frozen version, but for a pure scanning operation like <code>maxIndex</code> I don&#39;t see any reason why you shouldn&#39;t be ok mutating the memory again <i>after the index has been found and is in NF</i>. But I&#39;m not completely sure about this."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1512776841, "post_id": 47705484, "comment_id": 82408210, "body": "@leftaroundabout, my understanding is that what you say is true for unboxed vectors: unsafe freezing and thawing do nothing. For boxed vectors, I believe freezing and thawing actually twiddle some bits that the GC cares about."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1512751599, "post_id": 47705648, "comment_id": 82397613, "body": "I expect this should work for his situation since he needs the maxIndex prior to performing mutation, but if there was an operation like <code>get max index ; mutation 1 ; force max index ; mutation of max index</code> then I&#39;d strongly suspect that let floating and other optimizations could get you the index as the array stands after the first mutation.  This complexity is why I discourage the unsafeFreeze option."}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": false, "score": 1, "last_activity_date": 1512741731, "last_edit_date": 1512741731, "creation_date": 1512690249, "answer_id": 47705648, "question_id": 47705484, "link": "https://stackoverflow.com/questions/47705484/maxindex-of-an-mvector/47705648#47705648", "title": "maxIndex of an MVector", "body": "<p>Have you considered freezing the vector with <code>unsafeFreeze</code> which is supposed to be fast (i.e. <code>\u0398(1)</code>)? For example you can define <code>maxIndex</code> for mutable vectors like this:</p>\n\n<pre><code>maxIndex = fmap V.maxIndex . V.unsafeFreeze\n</code></pre>\n\n<p>This assumes that you have imported the following:</p>\n\n<pre><code>import qualified Data.Vector.Unboxed         as V\n</code></pre>\n\n<p><code>unsafeFreeze</code> doesn't actually copy any data and should be fast, but it would be interesting to run a criterion benchmark to see if this approach is actually faster compared to an explicit loop.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1512696308, "post_id": 47706191, "comment_id": 82372916, "body": "Question is, if you mutate a tree in the forest and the statis-demanding elves are already gone, does it still make a noise?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1512753228, "post_id": 47706191, "comment_id": 82398562, "body": "This worked great for me, and mucking with the exact promises made by a function named <code>unsafe</code> seemed ill-advised. Thanks for your help! For what it&#39;s worth, I realized too-late that I needed to freeze these results anyway to store in a <code>Data.Set.Set</code>, since my predicate is <code>Data.Set.member</code>. I opted to ignore mutability and just generate a bunch of immutable Vectors for this implementation, but the insights gleaned are still immensely useful!"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 1, "last_activity_date": 1512694573, "creation_date": 1512694573, "answer_id": 47706191, "question_id": 47705484, "link": "https://stackoverflow.com/questions/47705484/maxindex-of-an-mvector/47706191#47706191", "title": "maxIndex of an MVector", "body": "<p>I see lots of talk about unsafe freezing which seems suspect since you plan to mutate this memory later, thus violating the assurance you are implicitly giving when calling <code>unsafeFreeze</code>.</p>\n\n<p>My suggestion is to just write an imperative-style maxIndex function.  The below is typed but not tested:</p>\n\n<pre><code>import qualified Data.Vector.Unboxed.Mutable as MV\nimport           Control.Monad.ST\nimport           Control.Monad               (mapM_)\n\nmaxIndex :: (Ord a, MV.Unbox a) =&gt; MV.MVector s a -&gt; ST s (Maybe Int)\nmaxIndex mv | len == 0  = pure Nothing\n            | otherwise = Just &lt;$&gt; go 0 0\n where\n len = MV.length mv\n go n i | i &gt;=len   = pure n\n        | otherwise = do\n     nVal &lt;- MV.unsafeRead mv n\n     iVal &lt;- MV.unsafeRead mv i\n     if nVal &lt; iVal then go i (i+1)\n                    else go n (i+1)\n</code></pre>\n"}], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 47706191, "answer_count": 2, "score": 2, "last_activity_date": 1512741731, "creation_date": 1512689059, "question_id": 47705484, "link": "https://stackoverflow.com/questions/47705484/maxindex-of-an-mvector", "title": "maxIndex of an MVector", "body": "<p><a href=\"https://hackage.haskell.org/package/vector-0.12.0.1\" rel=\"nofollow noreferrer\"><code>Data.Vector</code></a> includes a function <code>maxIndex</code> with type <code>maxIndex :: (Ord a) =&gt; Vector a -&gt; Int</code> that returns the index of the <code>maximum</code> value in that Vector. I'm working with mutable Vectors, however, and <code>MVector</code> doesn't have <code>maxIndex</code> defined for it.</p>\n\n<p>What's the best way of getting the data I want out of the <code>MVector</code> I have? My code currently is:</p>\n\n<pre><code>import qualified Data.Vector.Unboxed.Mutable as MV\nimport           Control.Monad.ST\nimport           Control.Monad               (mapM_)\n\ntype MaxIndex = Int\n\nstep :: forall s. MV.MVector s Int -&gt; MaxIndex -&gt; ST s ()\nstep vec i = do\n    n &lt;- MV.unsafeRead vec i\n    MV.write vec i 0\n    let l      = MV.length vec\n        (k, x) = n `divMod` l\n    mapM_ (\\j -&gt; MV.modify vec (+k) j) [0..l-1]  -- side note, this is just\n                                                 -- fmap (+k) vec, but MVector is not\n                                                 -- a functor. Is there a better way?\n    mapM_ (\\j -&gt; MV.modify vec (+1) (j `mod` l)) [i+1..i+x]\n</code></pre>\n\n<p>where <code>i</code> is the index I'm looking to derive inside <code>step</code>. I'm doing this because the actions here need to eventually be wrapped inside an <code>until</code> and repeated until a predicate is satisfied, and freezing and thawing every cycle sounds ludicrously expensive.</p>\n"}, {"tags": ["haskell", "lambda-calculus"], "comments": [{"owner": {"reputation": 3, "user_id": 9069853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef425685f640af0f6ae4ca134e7f61f7?s=128&d=identicon&r=PG&f=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/9069853/jason"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1512686525, "post_id": 47704945, "comment_id": 82370188, "body": "The implementation. If someone can give me some code in haskell for alpha equivalence on this Data type"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1512688614, "post_id": 47704945, "comment_id": 82370918, "body": "Can you show us what you\u2019ve tried?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1512705378, "post_id": 47704945, "comment_id": 82374898, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/40316605/implementing-alpha-equivalence-in-haskell\">Implementing Alpha-Equivalence in haskell</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 1, "last_activity_date": 1512690229, "last_edit_date": 1512690229, "creation_date": 1512689580, "answer_id": 47705549, "question_id": 47704945, "link": "https://stackoverflow.com/questions/47704945/haskell-lambda-alpha-equivalence/47705549#47705549", "title": "Haskell Lambda Alpha Equivalence", "body": "<p>So two expressions are alpha equivalent if you can turn one into the other by renaming variables. So how could we capture this? There are two main ways:</p>\n\n<ol>\n<li>Keep track of which variable names must correspond to one another in the two expressions.</li>\n<li>(Explicitly or implicitly) convert into a form where instead of variable names, the number of the enclosing scope is used.</li>\n</ol>\n\n<p>Let\u2019s go for the first one</p>\n\n<pre><code>-- helper functions for association lists\ntype Alist a = [(a,a)]\nassoc, rassoc :: Eq a =&gt; a -&gt; Alist a -&gt; a\nassoc x ((a,b):ps) = if x == a then b else assoc x ps\nrassoc x = assoc x . map (\\(a,b) -&gt; (b,a))\nacons a b l = (a,b):l\n\n(=*=) :: Expr -&gt; Expr -&gt; Bool\na =*= b = eq [] a b where\n  eq l (Lam n x) (Lam m y) = eq (acons n m l) x y\n  eq l (Var n) (Var m) = assoc n l == m &amp;&amp; n == rassoc m l\n  eq l (App f u) (App g v) = eq l f g &amp;&amp; eq l u v\n  eq l _ _ = False\n</code></pre>\n\n<p>The only real subtlety here is the case of comparing variables. To check that <code>x</code> and <code>y</code> are alpha equivalent we need to check that the binding for <code>x</code> corresponds to a binding of <code>y</code> AND the binding for <code>y</code> corresponds to a binding for <code>x</code>. Otherwise we might say that <code>\\x.\\y.x</code> is alpha equivalent to <code>\\y.\\y.y</code>.</p>\n\n<p>It\u2019s also worth noting that malformed expressions will result in match failures.</p>\n\n<p>Here\u2019s how to implicitly do the second option:</p>\n\n<pre><code>varN :: Eq a =&gt; a -&gt; [a] -&gt; Int\nvarN a xs = v 0 xs where\n  v n (x:xs) = if a == x then n else v (n+1) xs\n\na =*= b = eq [] [] a b in where\n  eq k l (Lam n x) (Lam m y) = eq (n:k) (m:l) x y\n  eq k l (Var n) (Var m) = varN n k == varN m l\n  eq k l (App f u) (App g v) = eq k l f g &amp;&amp; eq k l u v\n  eq k l _ _ = False\n</code></pre>\n\n<p>Hopefully you can see that these are equivalent</p>\n"}], "owner": {"reputation": 3, "user_id": 9069853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef425685f640af0f6ae4ca134e7f61f7?s=128&d=identicon&r=PG&f=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/9069853/jason"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 741, "favorite_count": 0, "accepted_answer_id": 47705549, "answer_count": 1, "score": -5, "last_activity_date": 1512690229, "creation_date": 1512685967, "last_edit_date": 1512686461, "question_id": 47704945, "link": "https://stackoverflow.com/questions/47704945/haskell-lambda-alpha-equivalence", "title": "Haskell Lambda Alpha Equivalence", "body": "<p>I am trying to  write down an alpha equivalence function in Haskell for lambda.</p>\n\n<p><code>data Expr = App Expr Expr | Lam Int Expr | Var Int  deriving (Show,Eq)</code></p>\n\n<p>I've read some online resources but I can't transform them into code. \nThank you</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1955, "user_id": 160466, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a63cd97a85054261d3521719ec6205db?s=128&d=identicon&r=PG", "display_name": "dividebyzero", "link": "https://stackoverflow.com/users/160466/dividebyzero"}, "edited": false, "score": 2, "creation_date": 1512684270, "post_id": 47704506, "comment_id": 82369315, "body": "You question might look a little better if you removed that URL from the title and instead put it in the question body, as an actual clickable link"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1512684613, "post_id": 47704506, "comment_id": 82369444, "body": "You&#39;ve got the answer right there. You&#39;ve applied <code>(*)</code> to too many arguments, as the error states. Replace <code>m</code> with <code>2</code>."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 8942073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1c836f1905feee2d4e7eed88128fb49?s=128&d=identicon&r=PG&f=1", "display_name": "Joey", "link": "https://stackoverflow.com/users/8942073/joey"}, "edited": false, "score": 1, "creation_date": 1512707202, "post_id": 47704738, "comment_id": 82375316, "body": "The utter simplicity of your answer put a big smile on my face! Many thanks to all who responded."}], "tags": [], "owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "is_accepted": true, "score": 1, "last_activity_date": 1512686107, "last_edit_date": 1512686107, "creation_date": 1512684947, "answer_id": 47704738, "question_id": 47704506, "link": "https://stackoverflow.com/questions/47704506/how-to-make-multiplylist-work-haskell-ref-https-en-wikibooks-org-wiki-haskel/47704738#47704738", "title": "How to make multiplyList work? Haskell ref: https://en.wikibooks.org/wiki/Haskell/Lists_II", "body": "<p>The type signature of multiplyList: </p>\n\n<p><code>Integer -&gt; [Integer] -&gt; [Integer]</code> </p>\n\n<p>says it takes an integer, a list of integers, and it returns a list of integers.</p>\n\n<p>Therefore, multiplyList is intended to take the parameter to multiply the list by. </p>\n\n<p>If we want to multiply by 2, using the definition of multiplyList:</p>\n\n<p><code>multiplyList m = applyToIntegers ((*) m)</code> </p>\n\n<p>we can just call <code>multiplyList 2 [1..3] == [2,4,6]</code>.</p>\n\n<p>It's a bit easier to demonstrate how multiplyList works if we simply the definition to </p>\n\n<p><code>multiplyList n xs = applyToIntegers (\\x -&gt; x * n) xs</code>.</p>\n\n<p>This is exactly the same as the previous definition, just written in a way which you might find easier to understand.</p>\n\n<p>This says that multiplyList takes an integer <code>n</code>, and a list <code>xs</code>, and passes a function which multiplies by <code>n</code>, and the list <code>xs</code> to applyToIntegers.</p>\n\n<p><code>applyToIntegers</code> then applies that multiply function to every item in the list.</p>\n\n<p>In conclusion, you simply need to call <code>multiplyList</code> with the value to multiply by. We could separate this into a separate function, if you like:</p>\n\n<p><code>multiplyListByTwo xs = multiplyList 2 xs</code></p>\n\n<p>which can be eta reduced to <code>multiplyListByTwo = multiplyList 2</code></p>\n\n<p>We can then use this function on any list, and the values will be multiplied by 2. </p>\n\n<p><code>multiplyListByTwo [1..3]</code> would give <code>[2,4,6]</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 8942073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1c836f1905feee2d4e7eed88128fb49?s=128&d=identicon&r=PG&f=1", "display_name": "Joey", "link": "https://stackoverflow.com/users/8942073/joey"}, "edited": false, "score": 0, "creation_date": 1512709214, "post_id": 47704808, "comment_id": 82375848, "body": "Although it doesn&#39;t show, I did register a &quot;like&quot; for this answer.  It is helping me wrap my head around how Haskell can get the missing integer from the left hand side of the equation as an argument in multiplyList  which looks to me as though it takes only one argument , namely,  &quot;m&quot;."}, {"owner": {"reputation": 1955, "user_id": 160466, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a63cd97a85054261d3521719ec6205db?s=128&d=identicon&r=PG", "display_name": "dividebyzero", "link": "https://stackoverflow.com/users/160466/dividebyzero"}, "reply_to_user": {"reputation": 21, "user_id": 8942073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1c836f1905feee2d4e7eed88128fb49?s=128&d=identicon&r=PG&f=1", "display_name": "Joey", "link": "https://stackoverflow.com/users/8942073/joey"}, "edited": false, "score": 0, "creation_date": 1512718332, "post_id": 47704808, "comment_id": 82379073, "body": "Every function in Haskell actually &quot;takes one argument&quot;, and returns potentially another function that will take another argument. So you can think of <code>multiplyList</code> either as function taking one number and returning a function that takes a list, or as a function that takes a number and a list. Partial application is Haskell&#39;s bread and butter."}], "tags": [], "owner": {"reputation": 1955, "user_id": 160466, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a63cd97a85054261d3521719ec6205db?s=128&d=identicon&r=PG", "display_name": "dividebyzero", "link": "https://stackoverflow.com/users/160466/dividebyzero"}, "is_accepted": false, "score": 0, "last_activity_date": 1512718043, "last_edit_date": 1512718043, "creation_date": 1512685308, "answer_id": 47704808, "question_id": 47704506, "link": "https://stackoverflow.com/questions/47704506/how-to-make-multiplylist-work-haskell-ref-https-en-wikibooks-org-wiki-haskel/47704808#47704808", "title": "How to make multiplyList work? Haskell ref: https://en.wikibooks.org/wiki/Haskell/Lists_II", "body": "<p>It's all about currying. <code>(*)</code> is a function with signature <code>Integer -&gt; Integer -&gt; Integer</code>. <code>((*) 2)</code> generates a function with signature <code>Integer -&gt; Integer</code>, that you can apply to a second number and get a product. This function is provided to <code>applyToIntegers</code> to produce a function <code>multiplyList</code> that will take a list as an argument. You could also see <code>multiplyList</code> as a function that takes two arguments, <code>m</code>, which is a number (e.g. 2), and a list.</p>\n\n<p>So the compiler message is pretty on the spot, it's telling you <code>applyToIntegers</code> expected a function ((*) 2), but you provided a number (2*m). You must call it like</p>\n\n<p><code>multiplyList 2 [1,2,3]</code></p>\n\n<p>Just like in the previous example in the book chapter. This same function is just being rewritten in another way, where the arguments become implicit, \"higher-order\" style...</p>\n"}, {"tags": [], "owner": {"reputation": 794, "user_id": 3717658, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vtnZE.jpg?s=128&g=1", "display_name": "Naqib Hakimi", "link": "https://stackoverflow.com/users/3717658/naqib-hakimi"}, "is_accepted": false, "score": 1, "last_activity_date": 1512779674, "creation_date": 1512779674, "answer_id": 47724076, "question_id": 47704506, "link": "https://stackoverflow.com/questions/47704506/how-to-make-multiplylist-work-haskell-ref-https-en-wikibooks-org-wiki-haskel/47724076#47724076", "title": "How to make multiplyList work? Haskell ref: https://en.wikibooks.org/wiki/Haskell/Lists_II", "body": "<p>let's take a look at both functions definition</p>\n\n<pre><code>applyToIntegers :: (Integer -&gt; Integer) -&gt; [Integer] -&gt; [Integer]\nmultiplyList :: Integer -&gt; [Integer] -&gt; [Integer]\n</code></pre>\n\n<p>now the return type of functions are the some [Integer] . now</p>\n\n<pre><code>multiplyList m = applyToIntegers ((2*) m)\n</code></pre>\n\n<p>starting from right to left we see that applyToIntegers require 2 argument but given 1 . the expression inside () is calculate and then returned as result.</p>\n\n<pre><code>multiplyList m = applyToIntegers (2*) m\n</code></pre>\n\n<p>in this point we now the type m is [Integer] and multiplyList require one argument not 2 rewriting the definition for multiplyList</p>\n\n<pre><code>multiplyList ::[Integer] -&gt; [Integer]\n</code></pre>\n\n<p>result :</p>\n\n<pre><code>applyToIntegers :: (Integer -&gt; Integer) -&gt; [Integer] -&gt; [Integer]\napplyToIntegers _ [] = []\napplyToIntegers f (n:ns) = (f n) : applyToIntegers f ns\n\nmultiplyList :: [Integer] -&gt; [Integer]\nmultiplyList m = applyToIntegers ((2*) m)\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8942073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1c836f1905feee2d4e7eed88128fb49?s=128&d=identicon&r=PG&f=1", "display_name": "Joey", "link": "https://stackoverflow.com/users/8942073/joey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 47704738, "answer_count": 3, "score": 2, "last_activity_date": 1512779674, "creation_date": 1512683835, "last_edit_date": 1512684671, "question_id": 47704506, "link": "https://stackoverflow.com/questions/47704506/how-to-make-multiplylist-work-haskell-ref-https-en-wikibooks-org-wiki-haskel", "title": "How to make multiplyList work? Haskell ref: https://en.wikibooks.org/wiki/Haskell/Lists_II", "body": "<p>I am exercising the <code>multiplyList</code> function that uses <code>applyToIntegers</code> in GHCi.  I want it to multiply a list by 2. Below is what I tried and the error I got. Below that, for convenience, is an excerpt from Lists II. </p>\n\n<p>The code in Lists II compiles OK. My problem is: where do I put the multiplier in the code?</p>\n\n<p>I can use <code>applyToIntegers</code> by itself OK, and I can duplicate what it does using <code>map</code>. I just can't make the connection from <code>multiplyList</code> to <code>applyToIntgers</code>.</p>\n\n<p>This is my first post as I am learning Haskell (which I had never heard of before last month!) from the excellent Haskell wikibook, and I must say that Haskell is the most beautiful high-level programming language I've ever encountered.</p>\n\n<pre><code>applyToIntegers :: (Integer -&gt; Integer) -&gt; [Integer] -&gt; [Integer]\napplyToIntegers _ [] = []\napplyToIntegers f (n:ns) = (f n) : applyToIntegers f ns\n-- E.g., applyToIntegers (2*) [1..5] = [2,4,6,8,10], also\n-\u2013  map (2*) [1..5] = [2,4,6,8,10]\n\n-- Unable to come up with a working example:\nmultiplyList :: Integer -&gt; [Integer] -&gt; [Integer]\n--multiplyList m = applyToIntegers ((*) m) -- Compiles OK.\n-- If I try:\nmultiplyList m = applyToIntegers ((2*) m)\n</code></pre>\n\n<p>I get the following:</p>\n\n<pre><code>*Main&gt; :l ods.hs\n[1 of 1] Compiling Main             ( ods.hs, interpreted )\n\nods.hs:15:35: error:\n    \u2022 Couldn't match expected type \u2018Integer -&gt; Integer\u2019\n                  with actual type \u2018Integer\u2019\n    \u2022 Possible cause: \u20182 *\u2019 is applied to too many arguments\n      In the first argument of \u2018applyToIntegers\u2019, namely \u2018((2 *) m)\u2019\n      In the expression: applyToIntegers ((2 *) m)\n      In an equation for \u2018multiplyList\u2019:\n      multiplyList m = applyToIntegers ((2 *) m)\nFailed, modules loaded: none.\nPrelude&gt;\n</code></pre>\n\n<p><hr>\n<a href=\"https://en.wikibooks.org/w/index.php?title=Haskell/Lists_II&amp;oldid=3242682\" rel=\"nofollow noreferrer\">https://en.wikibooks.org/w/index.php?title=Haskell/Lists_II&amp;oldid=3242682</a></p>\n\n<blockquote>\n  <p>We need a function that takes any other appropriate function and applies the<br>\n      given function to the elements of a list:</p>\n\n<pre><code>applyToIntegers :: (Integer -> Integer) -> [Integer] -> [Integer]\napplyToIntegers _ [] = []\napplyToIntegers f (n:ns) = (f n) : applyToIntegers f ns\n</code></pre>\n  \n  <p>With <code>applyToIntegers</code>, we can take any <code>Integer -&gt; Integer</code> function and apply \n      it to the elements of a list of Integers. We can thus use this generalized \n      function to redefine multiplyList:<pre><code>multiplyList :: Integer -> [Integer] -> [Integer]\nmultiplyList m = applyToIntegers ((*) m)</code></pre></p>\n  \n  <p>That uses the <code>(*)</code> function with a single initial argument to create a new \n      function which is ready to take one more argument (which, in this use case, \n      will come from the numbers in a given list).</p>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1512682431, "post_id": 47703453, "comment_id": 82368416, "body": "functor really can&#39;t do this, due to it&#39;s nature."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1512684782, "post_id": 47703453, "comment_id": 82369510, "body": "Why not <code>fmap . fmap :: (a -&gt; b) -&gt; [[a]] -&gt; [[b]]</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1512680275, "post_id": 47703575, "comment_id": 82367425, "body": "Is there really no way to do this with an <code>fmap</code>? I jumped on this question quickly, thinking it was easy to fix. Then it didn&#39;t sit right and I tried it quickly and couldn&#39;t get it to work. Is it because of the kind of <code>Functor</code> hiding the <code>a</code> in your instance declaration?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 2, "creation_date": 1512680417, "post_id": 47703575, "comment_id": 82367480, "body": "@jkeuhlen You can certainly make <code>Block</code> an instance of <code>Functor</code>; e.g. <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/src/Data.Functor.Compose.html#line-97\" rel=\"nofollow noreferrer\"><code>instance Functor Block where fmap f (Block x) = Block (fmap (fmap f) x)</code></a>. But the type of <code>fmap</code> doesn&#39;t unify with the type of <code>onBlock</code>, so using <code>onBlock</code> as the implementation is a non-starter."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1512680830, "post_id": 47703575, "comment_id": 82367687, "body": "Ahh right, because the <code>a</code> in <code>fmap :: (a -&gt; b) -&gt; f a -&gt; f b</code> will never unify with <code>[[a]]</code>. Is my understanding correct?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1512681057, "post_id": 47703575, "comment_id": 82367796, "body": "@jkeuhlen, kind of?  Basically, the signature of <code>fmap</code> is short for <code>forall a b. (a -&gt; b) -&gt; f a -&gt; f b</code>, in other words, it has to work for <i>any types</i> <code>a</code> and <code>b</code> -- including ones which are not lists.  An &quot;fmap&quot; that does not do this doesn&#39;t count as a functor -- for example, the generic function <code>foo x = fmap (+1) x</code> should work if <code>x</code> is an <code>f Int</code>, but it wouldn&#39;t work on <code>Block Int</code> if you got your way."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 9, "last_activity_date": 1512679923, "creation_date": 1512679923, "answer_id": 47703575, "question_id": 47703453, "link": "https://stackoverflow.com/questions/47703453/fmap-applied-to-types-other-than-the-type-variable/47703575#47703575", "title": "fmap applied to types other than the type variable", "body": "<p>Sorry, you can't call that function <code>fmap</code>. But that's okay, there's lots of other good names out there.</p>\n\n<pre><code>onBlock :: ([[a]] -&gt; [[b]]) -&gt; Block a -&gt; Block b\nonBlock f (Block v) = Block (f v)\n</code></pre>\n\n<p>You can even give it a name full of infixy punctuation goodness if you want.</p>\n\n<pre><code>(&lt;#&gt;) :: ([[a]] -&gt; [[b]]) -&gt; Block a -&gt; Block b\nf &lt;#&gt; Block v = Block (f v)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1512683168, "creation_date": 1512683168, "answer_id": 47704367, "question_id": 47703453, "link": "https://stackoverflow.com/questions/47703453/fmap-applied-to-types-other-than-the-type-variable/47704367#47704367", "title": "fmap applied to types other than the type variable", "body": "<p>The easiest way to achieve that would be</p>\n\n<pre><code>newtype BlockWr a = Block a deriving (Functor)\ntype Block a = BlockWr [[a]]\n</code></pre>\n\n<p>Now <code>transposeBlock = (transpose &lt;$&gt;)</code> would work.</p>\n\n<p>But I wouldn't recommend this. <code>BlockWr</code> is just the identity functor, this is not very useful.</p>\n\n<p>Really, the point is that <code>Block a</code> is <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Iso.html\" rel=\"nofollow noreferrer\">isomorphic</a> to <code>[[a]]</code>. You can witness that:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport Control.Lens\nimport Control.Lens.TH\n\nnewtype Block a = Block {_blockMat::[[a]]}\nmakeLenses ''Block\n\ntransposeBlock :: Block a -&gt; Block a\ntransposeBlock = blockMat %~ transpose\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1512765491, "post_id": 47704686, "comment_id": 82404169, "body": "Nice, I&#39;m ashamed I didn&#39;t think of this myself! Though I disagree, in that I bet <code>onBlock</code> is still worth defining -- every time I have tried to use <code>coerce</code> bare, I end up drowning in type annotations."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1512769512, "post_id": 47704686, "comment_id": 82405805, "body": "@DanielWagner That&#39;s true! <code>coerce</code> is powerful, but sometimes it needs to be restricted."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1512684692, "creation_date": 1512684692, "answer_id": 47704686, "question_id": 47703453, "link": "https://stackoverflow.com/questions/47703453/fmap-applied-to-types-other-than-the-type-variable/47704686#47704686", "title": "fmap applied to types other than the type variable", "body": "<p>Others have already commented on the opportunity of using <code>fmap</code> for this.</p>\n\n<p>Wrapping / unwrapping <code>newtype</code>s is boring, but safe coercions can make this immediate.</p>\n\n<pre><code>import Data.Coerce\n\nnewtype Block a = Block [[a]]\n\nonBlock :: ([[a]] -&gt; [[b]]) -&gt; Block a -&gt; Block b\nonBlock = coerce\n</code></pre>\n\n<p>Indeed, one might even avoid <code>onBlock</code> completely, and directly use <code>coerce</code> as needed.</p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 47703575, "answer_count": 3, "score": 3, "last_activity_date": 1512684692, "creation_date": 1512679462, "last_edit_date": 1512682665, "question_id": 47703453, "link": "https://stackoverflow.com/questions/47703453/fmap-applied-to-types-other-than-the-type-variable", "title": "fmap applied to types other than the type variable", "body": "<p>I have a datatype which keeps track of a 'block' of numbers (kinda like a matrix).</p>\n\n<pre><code>newtype Block a = Block [[a]]\n</code></pre>\n\n<p>I would like to make it an instance of <code>Functor</code>. However, I am trying to do it in such a way that fmap can apply to the whole list block, so that fmap has type <code>fmap :: [[a]] -&gt; [[b]]</code> instead of type <code>fmap :: a -&gt; b</code>.</p>\n\n<p>The reason is because I would like to map into my <code>Block</code> functor functions like <code>transpose</code> which apply to the list block <code>[[a]]</code> not to each element <code>a</code>. That is, I would like to be able to define functions like</p>\n\n<pre><code>transposeBlock :: Block a -&gt; Block a\ntransposeBlock = (transpose &lt;$&gt;)\n</code></pre>\n\n<p>I tried to declare my functor instance as the following.</p>\n\n<pre><code>instance Functor (Block [[a]]) where\n  fmap f (Block x) = Block (f x)\n</code></pre>\n\n<p>But I ran into the type errors that arise from attempting to compile this.</p>\n\n<pre><code>error:\n\u2022 Expecting one fewer argument to \u2018Block [[a]]\u2019\n  Expected kind \u2018* -&gt; *\u2019, but \u2018Block [[a]]\u2019 has kind \u2018*\u2019\n\u2022 In the first argument of \u2018Functor\u2019, namely \u2018Block [[a]]\u2019\n  In the instance declaration for \u2018Functor (Block [[a]])\u2019\n</code></pre>\n\n<p>What are some ways that I could map functions into the list block <code>[[a]]</code> of my <code>Block</code> type?</p>\n"}, {"tags": ["haskell", "ghc", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 3, "last_activity_date": 1512674263, "creation_date": 1512674263, "answer_id": 47702243, "question_id": 47702242, "link": "https://stackoverflow.com/questions/47702242/passing-ddump-splices-to-stack-script-interpreter/47702243#47702243", "title": "Passing -ddump-splices to Stack script interpreter", "body": "<p>Yes, you have to use <code>--</code> before passing the actual ghc option. i.e:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack\n     --resolver lts-9.0\n     --install-ghc\n     runghc\n     --package yesod\n     --package yesod-core\n     -- -ddump-splices\n-}\n</code></pre>\n\n<p>You can use <code>ghc --show-options</code> to see the kind of options you can pass. For more information, see here: <a href=\"https://github.com/commercialhaskell/stack/issues/650#issuecomment-123470879\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/650#issuecomment-123470879</a></p>\n"}], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 47702243, "answer_count": 1, "score": 3, "last_activity_date": 1535279669, "creation_date": 1512674263, "last_edit_date": 1535279669, "question_id": 47702242, "link": "https://stackoverflow.com/questions/47702242/passing-ddump-splices-to-stack-script-interpreter", "title": "Passing -ddump-splices to Stack script interpreter", "body": "<p>I'm using Stack interpreter feature and having a code like this:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack\n     --resolver lts-9.0\n     --install-ghc\n     runghc\n     --package yesod\n     --package yesod-core\n-}\n\n\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes       #-}\n{-# LANGUAGE TemplateHaskell   #-}\n-- and the code goes on\n</code></pre>\n\n<p>I want to pass the <code>ddump-splices</code> option to the stack interpreter to it. Is it possible ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1512673022, "post_id": 47701880, "comment_id": 82363758, "body": "<code>country { f = new }</code> this is your problem. this message is self-explanatory."}, {"owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "edited": false, "score": 0, "creation_date": 1512673130, "post_id": 47701880, "comment_id": 82363816, "body": "<code>country { f = new }</code> doesn&#39;t even make sense: <code>f</code> is a function and doesn&#39;t have anything to do with <code>Country</code>&#39;s fields."}, {"owner": {"reputation": 13, "user_id": 4017465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d14a9fed23447ac97f20a1affa6d223?s=128&d=identicon&r=PG&f=1", "display_name": "Rui Reis", "link": "https://stackoverflow.com/users/4017465/rui-reis"}, "edited": false, "score": 0, "creation_date": 1512673514, "post_id": 47701880, "comment_id": 82364005, "body": "But is there any way i could pass f or anything else as one of the Country&#39;s fields?"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 3, "creation_date": 1512674274, "post_id": 47701880, "comment_id": 82364444, "body": "The thing you are looking for is probably lenses. It\u2019s going to mean a lot of learning until you get it though"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1512676874, "post_id": 47701880, "comment_id": 82365810, "body": "Yes, it looks like your in the process of re-inventing <a href=\"http://lens.github.io/\" rel=\"nofollow noreferrer\">lenses</a>."}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 5, "last_activity_date": 1512676864, "creation_date": 1512676864, "answer_id": 47702877, "question_id": 47701880, "link": "https://stackoverflow.com/questions/47701880/defining-a-high-order-function-that-acesses-data-records/47702877#47702877", "title": "Defining a High Order function that acesses data records", "body": "<p>As the comments mention, the normal solution to this is to use lenses:</p>\n\n<pre><code>upDetail :: Lens Country [a]\n         -&gt; ([a] -&gt; b -&gt; [a])\n         -&gt; b -&gt; Country -&gt; Country\nupDetail f g b country = set f country new\n         where old = get f country\n               new = g old b\n</code></pre>\n\n<p>However, lenses aren't that hard to get a handle on, especially for so simple a purpose.</p>\n\n<p>The simplest way of expressing a lens is as a getter and a setter function:</p>\n\n<pre><code>data Lens s a = Lens\n  { get :: s -&gt; a\n  , set :: s -&gt; a -&gt; s\n  }\n\n_states :: Lens Country [State]\n_states = Lens states $ \\c new -&gt; c { states = new }\n\n_cities :: Lens Country [City]\n_cities = Lens cities $ \\c new -&gt; c { cities = new }\n</code></pre>\n\n<p>This lets us modify the cities or states of a country pretty easily:</p>\n\n<pre><code>\u03bb Country [] []\nCountry {states = [], cities = []}\n\u03bb upDetail _cities (\\cs c -&gt; c:cs) (C \"Hereford\" 100 3000) it                                                        \nCountry {states = [], cities = [C \"Hereford\" 100 3000.0]}\n\u03bb upDetail _states (\\cs c -&gt; c:cs) (S \"Delmarva\" 4) it                                                        \nCountry {states = [S \"Delmarva\" 4.0], cities = [C \"Hereford\" 100 3000.0]}\n</code></pre>\n\n<p>Lens get slightly more complex once you start thinking about composing lenses, which you're not getting into here, but you could.</p>\n"}], "owner": {"reputation": 13, "user_id": 4017465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d14a9fed23447ac97f20a1affa6d223?s=128&d=identicon&r=PG&f=1", "display_name": "Rui Reis", "link": "https://stackoverflow.com/users/4017465/rui-reis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 47702877, "answer_count": 1, "score": 1, "last_activity_date": 1512676864, "creation_date": 1512672807, "question_id": 47701880, "link": "https://stackoverflow.com/questions/47701880/defining-a-high-order-function-that-acesses-data-records", "title": "Defining a High Order function that acesses data records", "body": "<p>I pretend to create a high order function that uses as one of its parameters a function which belongs to the record of a certain Data Type. </p>\n\n<p>For Example:</p>\n\n<pre><code>type Debt = Float\ntype Power = Int\n\nData State = S String Debt \nData City = C String Power Debt\nData Country = Country\n   { states :: [State]\n   , cities :: [City] }\n\nupDetail :: (Country -&gt; [a]) \n         -&gt; ([a] -&gt; b -&gt; [a])\n         -&gt; b -&gt; Country -&gt; Country\nupDetail f g b country = country { f = new }\n         where old = f country\n               new = g old b\n</code></pre>\n\n<p>What the function above is supposed to do is pick an element of the record of the Country (with the function type <code>Country -&gt; [a]</code>) and alter it according to a certain function type <code>[a] -&gt; b -&gt; [a]</code> and a certain <code>b</code></p>\n\n<p>However, when i try to compile this i get an error saying :</p>\n\n<blockquote>\n  <p>\u2018f\u2019 is not a (visible) constructor field name</p>\n</blockquote>\n\n<p>Is there any way i can overcome this problem? I thought of using <strong>Maybe Country</strong> as my result but i don't know how to do this.</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1512720852, "post_id": 47700983, "comment_id": 82380107, "body": "It seems, the function you need is <code>resourcesFromString :: String -&gt; [ResourceTree String]</code> from <code>Yesod.Routes.Parse</code> module. But it isn&#39;t exported, so I&#39;m not sure."}, {"owner": {"reputation": 1699, "user_id": 783825, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/cce2622c5ccd49a3cbf2007491ab1075?s=128&d=identicon&r=PG", "display_name": "Neikos", "link": "https://stackoverflow.com/users/783825/neikos"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1512721187, "post_id": 47700983, "comment_id": 82380249, "body": "Will this also work for sub-sites? From what I gather in the documentation it is meant to parse the routes configuration string."}], "owner": {"reputation": 1699, "user_id": 783825, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/cce2622c5ccd49a3cbf2007491ab1075?s=128&d=identicon&r=PG", "display_name": "Neikos", "link": "https://stackoverflow.com/users/783825/neikos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1512669098, "creation_date": 1512669098, "question_id": 47700983, "link": "https://stackoverflow.com/questions/47700983/how-to-print-all-routes-for-a-yesod-application", "title": "How to print all routes for a Yesod Application", "body": "<p>I have a compiling yesod application and would like it to print all the route information it has, including sub-sites.</p>\n\n<p>What do I need to do to achieve this? Google has not given me any information on this.</p>\n\n<p>I would like to do something similar to what Ruby on Rails has, with <code>rails routes</code>.</p>\n"}, {"tags": ["haskell", "docker", "build", "haskell-stack"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1512669467, "post_id": 47700598, "comment_id": 82361996, "body": "Did you try reading the log file it said it wrote? What&#39;s in there?"}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1512670389, "post_id": 47700598, "comment_id": 82362464, "body": "Clock.hsc:44:0: warning: &quot;hsc_alignment&quot; redefined /usr/bin/ld: final link failed: Nonrepresentable section on output collect2: error: ld returned 1 exit status"}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1512670511, "post_id": 47700598, "comment_id": 82362529, "body": "Log is a bit longer, but still pleasantly short. A warning and an error, absolutely cryptic, if you ask me :) ."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1512670699, "post_id": 47700598, "comment_id": 82362619, "body": "Are you using Arch? See <a href=\"https://github.com/commercialhaskell/stack/issues/3507\" rel=\"nofollow noreferrer\">this github issues thread</a> that appeared when I searched your error message."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1512671834, "post_id": 47700598, "comment_id": 82363142, "body": "Yes, I&#39;m using Arch :) . Thanks! Let me research it. Bugreport closed..."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1512674384, "post_id": 47700598, "comment_id": 82364493, "body": "I tried it. The first part (your link) successful, but makes no difference. The second part (desbot) won&#39;t build. I have no idea why ncurses should make any difference, and how desbot is relevant."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1512675242, "post_id": 47700598, "comment_id": 82364942, "body": "Sounds like it&#39;s an issue with your dev environment then"}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1512675815, "post_id": 47700598, "comment_id": 82365243, "body": "<code>stack</code> provides sandboxed environment, or so they say. There should be a way to order the right thing. Is it so?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1512676820, "post_id": 47700598, "comment_id": 82365789, "body": "kind of? It&#39;s sandboxed away from other installations of GHC, but it&#39;s not going to set up your dev environment for you -- it&#39;s not a Docker container."}, {"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1512677605, "post_id": 47700598, "comment_id": 82366179, "body": "What constitutes &quot;dev environment&quot; (something all the sandboxes share)?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512683473, "post_id": 47700598, "comment_id": 82368948, "body": "Since this a linker error, you could examine the intermediate (generated) files which actually produce the error (use <code>-keep-tmp-files</code>). But since you&#39;ve already found people with this same problem (and potential solutions that haven&#39;t worked for you) your best is likely to post on those issue trackers and describe how the problem manifests on your machine. The <code>stack</code> people seem to be pretty adamant that this is an Arch issue, so I would begin there (after trying all of the different fixes people have posted in on the stack issue tracker, of course)."}], "answers": [{"tags": [], "owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "is_accepted": true, "score": 0, "last_activity_date": 1512744888, "creation_date": 1512744888, "answer_id": 47716803, "question_id": 47700598, "link": "https://stackoverflow.com/questions/47700598/haskell-app-build-troubleshooting-docker-primer/47716803#47716803", "title": "Haskell: app build troubleshooting (docker primer)", "body": "<p>You'd better drain the swamp.</p>\n\n<p><a href=\"https://www.fpcomplete.com/blog/2015/08/stack-docker\" rel=\"nofollow noreferrer\">https://www.fpcomplete.com/blog/2015/08/stack-docker</a></p>\n\n<p><a href=\"https://docs.haskellstack.org/en/stable/docker_integration\" rel=\"nofollow noreferrer\">https://docs.haskellstack.org/en/stable/docker_integration</a></p>\n\n<p><a href=\"https://hub.docker.com/r/fpco/stack-build\" rel=\"nofollow noreferrer\">https://hub.docker.com/r/fpco/stack-build</a></p>\n\n<p>It took me just installing <code>docker</code> from the reps,</p>\n\n<pre><code>$  docker pull fpco/stack-build\n...\n$ docker image ls\nREPOSITORY          TAG                 IMAGE ID            CREATED SIZE\n...\nfpco/stack-build    latest              4e3c147fca48        4 months ago        4.3GB\n...\n</code></pre>\n\n<p>and adding three lines to <code>stack.yaml</code> of my project:</p>\n\n<pre><code>docker:\n  enable: true\n  image: 4e3c147fca48\n</code></pre>\n\n<p>The image is not quite lightweight, but well worth it.</p>\n\n<p>You can probably put the image name right into <code>stack.yaml</code> with impunity:</p>\n\n<pre><code>docker:\n  enable: true\n  repo: \"fpco/stack-build\"\n</code></pre>\n"}], "owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 47716803, "answer_count": 1, "score": -2, "last_activity_date": 1512916830, "creation_date": 1512667782, "last_edit_date": 1512916830, "question_id": 47700598, "link": "https://stackoverflow.com/questions/47700598/haskell-app-build-troubleshooting-docker-primer", "title": "Haskell: app build troubleshooting (docker primer)", "body": "<p>How am I supposed to go about troubleshooting if an imported library won't build?</p>\n\n<pre><code>$ stack new any-tool simple\n$ cd any-tool/\n$ stack build\n</code></pre>\n\n<p>The boilerplate builds.</p>\n\n<p>Adding <code>import Turtle</code> to <code>Main.hs</code>:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Turtle\n\nmain :: IO ()\nmain = do\n  putStrLn \"hello world\"\n</code></pre>\n\n<p>Adding <code>turtle</code> to <code>any-tool.cabal</code>:</p>\n\n<pre><code>....\nexecutable any-tool\n  hs-source-dirs:      src\n  main-is:             Main.hs\n  default-language:    Haskell2010\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                     , turtle\n</code></pre>\n\n<p>Won't build:</p>\n\n<pre><code>$ stack build\nclock-0.7.2: configure\nclock-0.7.2: build\nhashable-1.2.6.1: download\nhashable-1.2.6.1: configure\nhashable-1.2.6.1: build\nhashable-1.2.6.1: copy/register\nProgress: 2/30\n--  While building custom Setup.hs for package clock-0.7.2 using:\n      /home/alexey/.stack/setup-exe-cache/x86_64-linux-tinfo6-nopie/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0 build --ghc-options \" -ddump-hi -ddump-to-file\"\nProcess exited with code: ExitFailure 1\nLogs have been written to: /home/alexey/spaces/haskell/any-tool/.stack-work/logs/clock-0.7.2.log\n\n...\n</code></pre>\n\n<p>Looks like no particular surprise: turtle has a couple of dozen dependencies, any incompatibility and there she goes. The question is, what is my next step?</p>\n"}, {"tags": ["function", "haskell", "partially-applied-type"], "comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 1, "creation_date": 1512663637, "post_id": 47699238, "comment_id": 82358748, "body": "Consider the function <code>take</code>. You could for example write <code>take 4 [2,3,5,7,11,13,17,19]</code> and it would evaluate to <code>[2,3,5,7]</code>. However, you could also define <code>takeFour = take 4</code> and now you have a partially applied <code>take</code> function. It&#39;s partially applied because it&#39;s not been given the second input. This <code>takeFour</code> function can be applied to any list and it&#39;ll return the first four elements of that list. What we essentially did was create a specialized version of <code>take</code> by only giving <code>take</code> one argument instead of two."}, {"owner": {"reputation": 14830, "user_id": 3757232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/kLzML.jpg?s=128&g=1", "display_name": "Jared Smith", "link": "https://stackoverflow.com/users/3757232/jared-smith"}, "edited": false, "score": 0, "creation_date": 1512663782, "post_id": 47699238, "comment_id": 82358834, "body": "Note that this doesn&#39;t really have anything to do with partially applied type parameters..."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1512664369, "post_id": 47699238, "comment_id": 82359190, "body": "The short answer is: all functions in Haskell take <i>exactly</i> one argument, and so there is no partial application. A call like <code>take 4 primes</code> is really an expression consisting of <i>two</i> function calls; <code>take 4</code> returns a new function which is then applied to <code>primes</code> (the equivalent explicitly parenthesized expression is <code>(take 4) primes</code>). The term &quot;partial application&quot; is used, though, to describe the situation where you aren&#39;t making all the function calls needed to ultimately get a non-function value."}], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": false, "score": 2, "last_activity_date": 1512664277, "last_edit_date": 1512664277, "creation_date": 1512663833, "answer_id": 47699453, "question_id": 47699238, "link": "https://stackoverflow.com/questions/47699238/partially-applied-functions/47699453#47699453", "title": "Partially applied functions", "body": "<p>A function by itself can't be \"partially applied\" or not. It's a meaningless concept.</p>\n\n<p>When you say that a function is \"partially applied\", you refer to how the function is <em>called</em> (aka \"applied\"). If the function is called with all its parameters, then it is said to be \"fully applied\". If some of the parameters are missing, then the function is said to be \"partially applied\".</p>\n\n<p>For example:</p>\n\n<pre><code>-- The function `take` is fully applied here:\noneTwoThree = take 3 [1,2,3,4,5]\n\n-- The function `take` is partially applied here:\ntake10 = take 10   -- see? it's missing one last argument\n\n-- The function `take10` is fully applied here:\noneToTen = take10 [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,42]\n</code></pre>\n\n<p>The result of a partial function application is another function - a function that still \"expects\" to get its missing arguments - like the <code>take10</code> in the example above, which still \"expects\" to receive the list.</p>\n\n<hr>\n\n<p>Of course, it all gets a bit more complicated once you get into the higher-order functions - i.e. functions that take other functions as arguments or return other functions as result. Consider this function:</p>\n\n<pre><code>mkTake n = take (n+5)\n</code></pre>\n\n<p>The function <code>mkTake</code> has only one parameter, but it returns another function as result. Now, consider this:</p>\n\n<pre><code>x = mkTake 10\ny = mkTake 10 [1,2,3]\n</code></pre>\n\n<p>On the first line, the function <code>mkTake</code> is, obviously, \"fully applied\", because it is given one argument, which is exactly how many arguments it expects. But the second line is also valid: since <code>mkTake 10</code> returns a function, I can then call this function with another parameter. So what does it make <code>mkTake</code>? \"Overly applied\", I guess?</p>\n\n<p>Then consider the fact that (barring compiler optimizations) all functions are, mathematically speaking, functions of exactly one argument. How could this be? When you declare a function <code>take n l = ...</code>, what you're \"conceptually\" saying is <code>take = \\n -&gt; \\l -&gt; ...</code> - that is, <code>take</code> is a function that takes argument <code>n</code> and returns another function that takes argument <code>l</code> and returns some result.</p>\n\n<p>So the bottom line is that the concept of \"partial application\" isn't really that strictly defined, it's just a handy shorthand to refer to functions that \"ought to\" (as in common sense) take N arguments, but are instead given M &lt; N arguments.</p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 2, "last_activity_date": 1512663836, "creation_date": 1512663836, "answer_id": 47699454, "question_id": 47699238, "link": "https://stackoverflow.com/questions/47699238/partially-applied-functions/47699454#47699454", "title": "Partially applied functions", "body": "<p>the classic example is</p>\n\n<pre><code>add     :: Int -&gt; Int -&gt; Int\nadd x y = x + y\n</code></pre>\n\n<p><code>add</code> function takes two arguments and adds them, we can now implement</p>\n\n<pre><code>increment = add 1\n</code></pre>\n\n<p>by partially applying <code>add</code>, which now waits for the other argument.</p>\n"}, {"tags": [], "owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "is_accepted": false, "score": 0, "last_activity_date": 1512664558, "last_edit_date": 1512664558, "creation_date": 1512663973, "answer_id": 47699498, "question_id": 47699238, "link": "https://stackoverflow.com/questions/47699238/partially-applied-functions/47699498#47699498", "title": "Partially applied functions", "body": "<p>This is best understood by example. Here's the type of the addition operator:</p>\n\n<pre><code>(+) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>What does it mean? As you know, it takes two numbers and outputs another one. Right? Well, <em>sort of</em>.</p>\n\n<p>You see, <code>a -&gt; a -&gt; a</code> actually means this: <code>a -&gt; (a -&gt; a)</code>. Whoa, looks weird! This means that <code>(+)</code> is a function that takes <em>one argument</em> and outputs a <em>function</em>(!!) that also takes one argument and outputs a value.</p>\n\n<p>What this means is you can supply that <em>one value</em> to <code>(+)</code> to get another, <em>partially applied</em>, function:</p>\n\n<pre><code>(+ 5) :: Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>This function takes one argument and adds five to it. Now, call that new function with some argument:</p>\n\n<pre><code>Prelude&gt; (+5) 3\n8\n</code></pre>\n\n<p>Here you go! Partial function application at work!</p>\n\n<p>Note the type of <code>(+ 5) 3</code>:</p>\n\n<pre><code>(+5) 3 :: Num a =&gt; a\n</code></pre>\n\n<p>Look what we end up with:</p>\n\n<ol>\n<li><code>(+)    :: Num a =&gt; a -&gt; a -&gt; a</code></li>\n<li><code>(+ 5)  :: Num a =&gt; a -&gt; a</code></li>\n<li><code>(+5) 3 :: Num a =&gt; a</code></li>\n</ol>\n\n<p>Do you see how the number of <code>a</code>s in the type signature decreases by one every time you add a new argument?</p>\n\n<ol>\n<li>Function with one argument that outputs a function with one argument that in turn, outputs a value</li>\n<li>Function with one argument that outputs a value</li>\n<li>The value itself</li>\n</ol>\n\n<hr>\n\n<p>\"...something like the built-in function <code>take</code> is considered to be partially applied\" - I don't quite understand what this means. The function <code>take</code> itself is not partially applied. A function is <em>partially applied</em> when it is the result of supplying between 1 and (N - 1) arguments to a function that takes N arguments. So, <code>take 5</code> is a partially applied function, but <code>take</code> and <code>take 5 [1..10]</code> are not.</p>\n"}, {"comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1512672715, "post_id": 47700022, "comment_id": 82363595, "body": "It think it will make it clearer if you remove 2nd line in the last example."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1512678193, "post_id": 47700022, "comment_id": 82366454, "body": "@karafka I want to leave it there to demonstrate all the various ways to write the same fundamental expression, but I see your point. I&#39;ve moved that form aside to a comment to emphasize the parameterized assignments."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1512678094, "last_edit_date": 1512678094, "creation_date": 1512665756, "answer_id": 47700022, "question_id": 47699238, "link": "https://stackoverflow.com/questions/47699238/partially-applied-functions/47700022#47700022", "title": "Partially applied functions", "body": "<p>Strictly speaking, partial application refers to a situation where you supply fewer arguments than expected to a function, and get back a new function created on the fly that expects the remaining arguments.</p>\n\n<p>Also strictly speaking, this does not apply in Haskell, because every function takes <em>exactly</em> one argument. There is no partial application, because you either apply the function to its argument or you don't.</p>\n\n<p>However, Haskell provides syntactic sugar for defining functions that includes emulating multi-argument functions. In Haskell, then, \"partial application\" refers to supplying fewer than the full number of arguments needed to obtain a value that cannot be further applied to another argument. Using everyone's favorite <code>add</code> example,</p>\n\n<pre><code>add :: Int -&gt; Int -&gt; Int\nadd x y = x + y\n</code></pre>\n\n<p>the type indicates that <code>add</code> takes one argument of type <code>Int</code> and returns a function of type <code>Int -&gt; Int</code>. The <code>-&gt;</code> type constructor is right-associative, so it helps to explicitly parenthesize it to emphasize the one-argument nature of a Haskell function: <code>Int -&gt; (Int -&gt; Int)</code>.</p>\n\n<p>When <em>calling</em> such a \"multi-argument\" function, we take advantage of the fact the function application is <em>left</em>-associative, so we can write <code>add 3 5</code> instead of <code>(add 3) 5</code>. The call <code>add 3</code> is thought of as partial application, because we could further apply the result to another argument.</p>\n\n<hr>\n\n<p>I mentioned the syntactic sugar Haskell provides to ease defining complex higher-order functions. There is one fundamental way to define a function: using a lambda expression. For example, to define a function that adds 3 to its argument, we write</p>\n\n<pre><code>\\x -&gt; x + 3\n</code></pre>\n\n<p>For ease of reference, we can assign a name to this function:</p>\n\n<pre><code>add = \\x -&gt; x + 3\n</code></pre>\n\n<p>To further ease the defintion, Haskell lets us write in its place</p>\n\n<pre><code>add x = x + 3\n</code></pre>\n\n<p>hiding the explicit lambda expression.</p>\n\n<p>For higher-order, \"multiargument\" functions, we would write a function to add two values as</p>\n\n<pre><code>\\x -&gt; \\y -&gt; x + y\n</code></pre>\n\n<p>To hide the currying, we can write instead</p>\n\n<pre><code>\\x y -&gt; x + y.\n</code></pre>\n\n<p>Combined with the syntactic sugar of replacing a lambda expression with a paramterized name, all of the following are equivalent definitions for the explicitly typed function <code>add :: Num a =&gt; a -&gt; a -&gt; a</code>:</p>\n\n<pre><code>add = \\x -&gt; \\y -&gt; x + y -- or \\x y -&gt; x + y as noted above\nadd x = \\y -&gt; x + y\nadd x y = x + y\n</code></pre>\n"}], "owner": {"reputation": 159, "user_id": 8260539, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45974390fcb7548c100f887df0ad6496?s=128&d=identicon&r=PG&f=1", "display_name": "bubu", "link": "https://stackoverflow.com/users/8260539/bubu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1078, "favorite_count": 0, "closed_date": 1512671849, "answer_count": 4, "score": 1, "last_activity_date": 1512678094, "creation_date": 1512663137, "last_edit_date": 1512664393, "question_id": 47699238, "link": "https://stackoverflow.com/questions/47699238/partially-applied-functions", "closed_reason": "Duplicate", "title": "Partially applied functions", "body": "<p>While studying functional programming, the concept partially applied functions comes up a lot. In Haskell, something like the built-in function <code>take</code> is considered to be partially applied.</p>\n\n<p>I am still unclear as to what it exactly means for a function to be partially applied or the use/implication of it.</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1512653350, "post_id": 47692576, "comment_id": 82351916, "body": "What <code>Date</code> type are you talking about?"}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1512665897, "post_id": 47692576, "comment_id": 82360026, "body": "It&#39;s hypothetical <code>Date</code>. As I&#39;ve said I couldn&#39;t find any package that has it."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1512682019, "post_id": 47692576, "comment_id": 82368225, "body": "What is missing in <code>parseTimeM</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1512665984, "post_id": 47696346, "comment_id": 82360076, "body": "What instance are you talking about?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1512681900, "post_id": 47696346, "comment_id": 82368167, "body": "<a href=\"http://hackage.haskell.org/package/aeson-1.2.3.0/docs/src/Data-Aeson-Types-FromJSON.html#line-1682\" rel=\"nofollow noreferrer\"><code>FromJSON Day</code></a>"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1512653725, "creation_date": 1512653725, "answer_id": 47696346, "question_id": 47692576, "link": "https://stackoverflow.com/questions/47692576/how-to-make-a-type-with-date-field-deserializable-from-json/47696346#47696346", "title": "How to make a type with date field deserializable from json", "body": "<p><code>parseTimeM</code> has type <code>(Monad m, ParseTime t) =&gt; ... -&gt; m t</code>, which if you specialize it at <code>Day</code>, is <code>... -&gt; m Day</code>, so you need to chain monadic actions (with <code>m ~ Parser</code>) or unwrap <code>m</code> somehow (e.g., <code>m ~ Maybe</code>).</p>\n\n<pre><code>(x .: pack \"date\") &gt;&gt;= parseTimeM True defaultTimeLocale \"%F\"\n</code></pre>\n\n<p>Also, <code>Day</code> already has an instance, that parses the <code>YYYY-MM-DD</code> format.</p>\n"}, {"tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": false, "score": 3, "last_activity_date": 1512654534, "creation_date": 1512654534, "answer_id": 47696542, "question_id": 47692576, "link": "https://stackoverflow.com/questions/47692576/how-to-make-a-type-with-date-field-deserializable-from-json/47696542#47696542", "title": "How to make a type with date field deserializable from json", "body": "<p>And for reference a fully working code example:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Datetimetest where\n\nimport Data.Time.Format\nimport Data.Time.Calendar\nimport Data.Aeson\nimport Data.Text\nimport Data.Maybe\n\nnewtype Some = Some { date :: Day } deriving Show\n\ninstance FromJSON Some where\n  parseJSON (Object x) = (x .: pack \"date\") &gt;&gt;= \\v -&gt; Some &lt;$&gt; parseTimeM True defaultTimeLocale \"%F\" v\n\ntest :: Some\ntest = fromJust $ (decode \"{\\\"date\\\":\\\"1999-12-01\\\"}\" :: Maybe Some)\n</code></pre>\n"}], "owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1512654534, "creation_date": 1512641518, "last_edit_date": 1512648768, "question_id": 47692576, "link": "https://stackoverflow.com/questions/47692576/how-to-make-a-type-with-date-field-deserializable-from-json", "title": "How to make a type with date field deserializable from json", "body": "<p>I need to define data type that would have <code>date</code> field and deserialize it from json. Here's my attempt.</p>\n\n<pre><code>data Some = Some { date :: Data.Time.Calendar.Day } deriving (Show, Generic) \n\ninstance FromJSON Day where\n     parseJSON (Object x) = parseTimeM True defaultTimeLocale \"%F\" &lt;$&gt; x .: (pack \"date\") \n</code></pre>\n\n<p>Here's errors.</p>\n\n<pre><code>\u2022 Couldn't match type \u2018m0 t0\u2019 with \u2018Day\u2019\n  Expected type: aeson-1.2.3.0:Data.Aeson.Types.Internal.Parser Day\n    Actual type: aeson-1.2.3.0:Data.Aeson.Types.Internal.Parser\n                   (m0 t0)\n\u2022 In the expression:\n    parseTimeM True defaultTimeLocale \"%F\" &lt;$&gt; x .: (pack \"date\")\n  In an equation for \u2018parseJSON\u2019:\n      parseJSON (Object x)\n        = parseTimeM True defaultTimeLocale \"%F\" &lt;$&gt; x .: (pack \"date\")\n  In the instance declaration for \u2018FromJSON Day\u2019\n</code></pre>\n\n<p>I find it very strange that I can't find any data type with exposed constructor for creating <code>Date</code> objects. And I can't find the function that would parse <code>Date</code> from <code>String</code></p>\n"}, {"tags": ["bash", "haskell", "ssh", "haskell-turtle", "shelly"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1512637361, "post_id": 47690412, "comment_id": 82341354, "body": "Note that this has been fixed in the latest version of Shelly:<a href=\"https://github.com/yesodweb/Shelly.hs/issues/146\" rel=\"nofollow noreferrer\">github.com/yesodweb/Shelly.hs/issues/146</a>"}, {"owner": {"reputation": 529, "user_id": 7208627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/601ef91c31fe9a352ab3feb4cef3b8c6?s=128&d=identicon&r=PG&f=1", "display_name": "Inc&#246;mplete", "link": "https://stackoverflow.com/users/7208627/inc%c3%b6mplete"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1512644576, "post_id": 47690412, "comment_id": 82346243, "body": "@Sibi not really, see <a href=\"https://github.com/yesodweb/Shelly.hs/pull/147#issuecomment-349934385\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1512648782, "post_id": 47690412, "comment_id": 82349061, "body": "Ah okay. I will look into it. Note that other option for use is shell-conduit: <a href=\"https://github.com/psibi/shell-conduit\" rel=\"nofollow noreferrer\">github.com/psibi/shell-conduit</a> ( Disclosure: I&#39;m it&#39;s current maintainer)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512666885, "post_id": 47690412, "comment_id": 82360654, "body": "If <code>sshPairs</code> doesn&#39;t do quoting correctly, you could try to implement the correct quoting yourself and then run the command with a more primitive functionality, like <a href=\"https://hackage.haskell.org/package/turtle-1.4.5/docs/Turtle-Prelude.html#v:shell\" rel=\"nofollow noreferrer\"><code>shell</code></a>. Also note that the documentation on <code>sshPairs</code> explicitly states: &quot;the commands will not be shell escaped&quot;. Neither library attempts to solve the problem of fragility of shell quoting (indeed, trying to solve this problem in a shell interop lib doesn&#39;t make sense, since there are so many different shells out there)"}, {"owner": {"reputation": 529, "user_id": 7208627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/601ef91c31fe9a352ab3feb4cef3b8c6?s=128&d=identicon&r=PG&f=1", "display_name": "Inc&#246;mplete", "link": "https://stackoverflow.com/users/7208627/inc%c3%b6mplete"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512714916, "post_id": 47690412, "comment_id": 82377694, "body": "@user2407038 guess have to do it manually then"}], "owner": {"reputation": 529, "user_id": 7208627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/601ef91c31fe9a352ab3feb4cef3b8c6?s=128&d=identicon&r=PG&f=1", "display_name": "Inc&#246;mplete", "link": "https://stackoverflow.com/users/7208627/inc%c3%b6mplete"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 309, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1512634254, "creation_date": 1512634254, "question_id": 47690412, "link": "https://stackoverflow.com/questions/47690412/run-a-command-via-ssh-with-shelly-turtle", "title": "Run a command via ssh with Shelly/Turtle", "body": "<p>Given a command:</p>\n\n<pre><code>ssh user@host command\n</code></pre>\n\n<p>where <code>command</code>, when executed on the remote host <code>host</code>, should be:</p>\n\n<pre><code>somecmd --option1 'option value with spaces' 'arg1 with spaces' 'arg2 with weird chars, like ('\n</code></pre>\n\n<p>How can I execute this command using the <a href=\"https://hackage.haskell.org/package/shelly\" rel=\"nofollow noreferrer\">Haskell Shelly</a>\nor the <a href=\"https://hackage.haskell.org/package/turtle\" rel=\"nofollow noreferrer\">Haskell Turtle</a>?</p>\n\n<p>Shelly provides a <code>sshPairs</code>, but it didn't quote <code>command</code> correctly.</p>\n\n<p>Quoting in a bash script can be fragile, does these two libraries, (or any Haskell libraries, for that matter),\ntries to improve this?</p>\n"}, {"tags": ["haskell", "weekday"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512635730, "post_id": 47689964, "comment_id": 82340437, "body": "You should always start your function by providing a type annotation, to declare your intent. Otherwise, GHC will infer the type of your functions, but in the case of a type error, GHC can not compare what it inferred and your intended type, producing only more vague error messages."}, {"owner": {"reputation": 1, "user_id": 8979205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e0a0857804499a20c49dfb796e7ad00?s=128&d=identicon&r=PG&f=1", "display_name": "M. Moz", "link": "https://stackoverflow.com/users/8979205/m-moz"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512638515, "post_id": 47689964, "comment_id": 82342084, "body": "I edited it now"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1512639011, "post_id": 47689964, "comment_id": 82342400, "body": "What are these y1, x, m mean and where is <code>year</code> defined?"}, {"owner": {"reputation": 1, "user_id": 8979205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e0a0857804499a20c49dfb796e7ad00?s=128&d=identicon&r=PG&f=1", "display_name": "M. Moz", "link": "https://stackoverflow.com/users/8979205/m-moz"}, "edited": false, "score": 0, "creation_date": 1512639169, "post_id": 47689964, "comment_id": 82342509, "body": "y1, x and m are from the gregorian way to calculate the day when given a date. year is the same Integer variable witch is given to weekday."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1512639292, "post_id": 47689964, "comment_id": 82342582, "body": "&quot;from the gregorian way&quot; Are they constants? What is their type? They are top level names, give them type annotations. Also, what does <code>(14 - zahlmonth)</code> mean? <code>zahlmonth</code> is a function of type <code>Month -&gt; Integer</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1512639532, "post_id": 47689964, "comment_id": 82342741, "body": "I think you maybe wanted to make y1, x, m parameters of some function(s), but as they stand now they are top level variables with cryptic names and unclear purpose."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1512649763, "creation_date": 1512649763, "answer_id": 47695182, "question_id": 47689964, "link": "https://stackoverflow.com/questions/47689964/weekday-in-haskel-wtih-gregorian-calender-formula/47695182#47695182", "title": "Weekday in Haskel wtih gregorian calender formula", "body": "<p>The issue here is that you did not add the types for all your top-level bindings, so some of them are being inferred to the wrong type. If only there were a type annotation, GHC would have reported the error immediately, but in absence of that, GHC has no way to see that the inferred type is wrong and so takes it at face value.</p>\n\n<p>Much later on, the wrong type will cause issues, and only then GHC will report the problem -- on irrelevant code.</p>\n\n<p>More in detail, here's what happens:</p>\n\n<pre><code>m = zahlmonth + ...\n</code></pre>\n\n<p>Here <code>zahlmonth</code> is a function <code>Month -&gt; Integer</code>. Since the result type of <code>+</code> is the same of the arguments, <code>m</code> is also a function <code>Month -&gt; Integer</code>.</p>\n\n<p>Had <code>m :: Integer</code> been present, GHC would stop here with an error. But, alas, GHC can't know that this is the issue.</p>\n\n<p>Then,</p>\n\n<pre><code>weekdays day zahlmonth year\n    | mod (day + x + ((31*m) / 12)) 7 == 0 = So\n</code></pre>\n\n<p>Since the operations <code>+,*,/</code> work on the same type, we get that\n<code>day</code>, <code>x</code> have the same type of <code>m</code>, i.e. <code>Month -&gt; Integer</code>.</p>\n\n<p>If <code>weekdays</code> had a type signature GHC would have spot the error, but without that it will happily carry on.</p>\n\n<p>Finally,</p>\n\n<pre><code>weekday day month year = weekdays day (zahlmonth month) year\n</code></pre>\n\n<p>Here <code>weekday</code> has a signature, saying that <code>day :: Integer</code>. But above we inferred that <code>weekdays</code> expects <code>day :: Month -&gt; Integer</code>. This triggers the type error</p>\n\n<pre><code> Couldn't match expected type `Month -&gt; Integer'\n                  with actual type `Integer'\n    * In the first argument of `weekdays', namely `day'\n</code></pre>\n\n<p>which is crystal clear, after one understands what's going on above during the inference.</p>\n\n<p>The key point is that, however, ... understanding what's going on during the inference is not easy at all! In general, it is very hard to follow GHC in its auto-inferring of types around the program. Fortunately, this is not needed, provided one writes code carefully, annotating the types on the bindings, so that type errors can be caught as early as possible.</p>\n"}], "owner": {"reputation": 1, "user_id": 8979205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e0a0857804499a20c49dfb796e7ad00?s=128&d=identicon&r=PG&f=1", "display_name": "M. Moz", "link": "https://stackoverflow.com/users/8979205/m-moz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 128, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1512649763, "creation_date": 1512632510, "last_edit_date": 1512638481, "question_id": 47689964, "link": "https://stackoverflow.com/questions/47689964/weekday-in-haskel-wtih-gregorian-calender-formula", "title": "Weekday in Haskel wtih gregorian calender formula", "body": "<p>Thx for the first Help. Now I changed this. but still a bog error. Is my whole Code wrong or just the part with the weekdays function. \nHow can i call a function inside another function?</p>\n\n<pre><code>data Wochentag = Mo | Di | Mi | Do | Fr | Sa | So\nderiving (Eq, Ord, Show, Enum)\n\ndata Month = Jan | Feb | M\u00e4rz | April | Mai | Juni | Juli | Aug | Sep | Okt | Nov | Dec\nderiving (Eq, Ord, Show, Enum)\n\n\nweekday :: Integer -&gt; Month -&gt; Integer -&gt; Wochentag\nweekday day month year = weekdays day (zahlmonth month) year\n\ny1 = year - (14 - zahlmonth) /12\nx = y1 + (y1 /4) - (y1 /100) + (y1 /400)\nm = zahlmonth + 12 * ((14- zahlmonth) /12) -2\n\n\nweekdays day zahlmonth year\n    | mod (day + x + ((31*m) / 12)) 7 == 0 = So\n    | mod (day + x + ((31*m) / 12)) 7 == 1 = Mo\n    | mod (day + x + ((31*m) / 12)) 7 == 2 = Di \n    | mod (day + x + ((31*m) / 12)) 7 == 3 = Mi \n    | mod (day + x + ((31*m) / 12)) 7 == 4 = Do \n    | mod (day + x + ((31*m) / 12)) 7 == 5 = Fr\n    | mod (day + x + ((31*m) / 12)) 7 == 6 = Sa \n    | otherwise = error \"kein Tag\"\n\n\n\nzahlmonth :: Month -&gt; Integer\nzahlmonth month = case month of\n  Jan -&gt; 1\n  Feb -&gt; 2\n  M\u00e4rz -&gt; 3\n  April -&gt; 4\n  Mai -&gt; 5\n  Juni -&gt; 6\n  Juli -&gt; 7\n  Aug -&gt; 8\n  Sep -&gt; 9\n  Okt -&gt; 10\n  Nov -&gt; 11\n  Dec -&gt; 12\n</code></pre>\n\n<p>The error Log is:</p>\n\n<pre><code> Couldn't match expected type `Month -&gt; Integer'\n                  with actual type `Integer'\n    * In the first argument of `weekdays', namely `day'\n      In the expression: weekdays day (zahlmonth month) year\n      In an equation for `weekday':\n          weekday day month year = weekdays day (zahlmonth month) year\n   |\n95 | weekday day month year = weekdays day (zahlmonth month) year\n   |                                   ^^^\n\n   Variable not in scope: year :: Month -&gt; Integer\n   |\n97 | y1 = year - (14 - zahlmonth) /12\n   |      ^^^^\n</code></pre>\n\n<p>Totally strange but have no idea how to fix it. When i give weekdays an description it becomes even worse.</p>\n"}, {"tags": ["haskell", "escaping"], "comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1512633513, "post_id": 47689708, "comment_id": 82339336, "body": "Are you producing your output with <code>show</code> (including <code>print</code> or just evaluating it at the ghci prompt)? <code>show</code> is designed to produce <b>Haskell syntax</b> for your value, not to pretty print it for display to an end user. So, since you need to escape backslashes in strings in Haskell syntax <code>show</code> will give you extra backslashes to do the escaping."}, {"owner": {"reputation": 1601, "user_id": 3258708, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/WBG4I.png?s=128&g=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/3258708/matt"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1512634064, "post_id": 47689708, "comment_id": 82339602, "body": "If I do, for instance, show &quot;\\\\&quot; in Prelude I get &quot;\\&quot;\\\\\\\\\\&quot;&quot; as an output. At the moment I literally have it as a function Expr -&gt; String, with the = being what I put in my question."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1512635236, "post_id": 47689708, "comment_id": 82340173, "body": "It is fine as it is. <code>show</code> on strings is supposed to add quotes and escape funny chars. Try <code>putStrLn yourString</code> to print it raw. You&#39;ll discover that your pretty printing function is OK. Just avoid <code>show</code> or <code>print</code> to check your final output, or interpret their result as if it is escaped."}, {"owner": {"reputation": 1601, "user_id": 3258708, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/WBG4I.png?s=128&g=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/3258708/matt"}, "edited": false, "score": 0, "creation_date": 1512636415, "post_id": 47689708, "comment_id": 82340826, "body": "Ok that works, thank you very much!"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1512641327, "post_id": 47689708, "comment_id": 82343983, "body": "Surely this is already a dup of... something."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1512665163, "post_id": 47689708, "comment_id": 82359612, "body": "Does <a href=\"https://stackoverflow.com/questions/47541845/printing-a-single-backslash-in-haskell-using-showstring/47542700#47542700\" title=\"printing a single backslash in haskell using showstring\">stackoverflow.com/questions/47541845/&hellip;</a> resolve your confusion?"}], "owner": {"reputation": 1601, "user_id": 3258708, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/WBG4I.png?s=128&g=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/3258708/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 446, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1512631434, "creation_date": 1512631434, "question_id": 47689708, "link": "https://stackoverflow.com/questions/47689708/trying-to-print-backslash-instead-getting-two", "title": "Trying to print backslash, instead getting two", "body": "<p>I have a function that converts a lambda Expr to a String (pretty printing). The issue is I want to print a single backslash \"\\\" before a list of bound variables. To do so I believe I need to escape it, so my string could be formatted as follows:</p>\n\n<pre><code>\"\\\\\" ++ other String stuff\n</code></pre>\n\n<p>The problem is I get that literal output - two backslashes. I'm not entirely sure how to fix that so if anybody has any pointers it'd be greatly appreciated.</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1512612374, "post_id": 47686289, "comment_id": 82332493, "body": "It&#39;s there - I guess it looks a bit funny (<code>Functor ((-&gt;) LiftedRep LiftedRep r)</code>)"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 2, "creation_date": 1512613461, "post_id": 47686289, "comment_id": 82332789, "body": "The funny rendering seems to have been fixed recently too. <a href=\"https://github.com/haskell/haddock/issues/713\" rel=\"nofollow noreferrer\">github.com/haskell/haddock/issues/713</a>"}], "owner": {"reputation": 1002, "user_id": 2016455, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/17d5b8c3cce04fa2071d7919d8671b4d?s=128&d=identicon&r=PG", "display_name": "Albert Netymk", "link": "https://stackoverflow.com/users/2016455/albert-netymk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1512611034, "creation_date": 1512611034, "question_id": 47686289, "link": "https://stackoverflow.com/questions/47686289/why-is-functor-r-not-shown-on-the-functor-documentation", "title": "Why is `Functor ((-&gt;) r)` not shown on the Functor documentation", "body": "<p>In the source code, <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.Base.html#line-801\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.Base.html#line-801</a>, ((->) r) is defined as an instance of Functor, but I can't find the corresponding entry on its documentation page, <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Functor.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Functor.html</a>.</p>\n\n<p>Why is this? Is this intentional or what? </p>\n"}]