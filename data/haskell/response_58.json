[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1455757467, "post_id": 35470100, "comment_id": 58637130, "body": "I&#39;m not sure what you mean by &quot;thunk problem&quot;? Your first solution is simple and performant. How does it not meet your expectations?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1455760032, "post_id": 35470100, "comment_id": 58637969, "body": "What does &quot;overflow&quot; mean to you? To me, it means adding up to a number so big it can&#39;t be stored in an <code>Int</code> -- which is definitely possible -- but since that has nothing to do with thunks, your title and the remainder of your question makes me think you are worried about a different problem."}], "answers": [{"comments": [{"owner": {"reputation": 1176, "user_id": 2415118, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f71ca7d457d223d598b1f439ff171ecd?s=128&d=identicon&r=PG", "display_name": "abden003", "link": "https://stackoverflow.com/users/2415118/abden003"}, "edited": false, "score": 0, "creation_date": 1455906717, "post_id": 35474267, "comment_id": 58715569, "body": "Is it possible for group and map sum to execute simultaneously, or does group have to fully evaluate before map sum can evaluate over its output?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1176, "user_id": 2415118, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f71ca7d457d223d598b1f439ff171ecd?s=128&d=identicon&r=PG", "display_name": "abden003", "link": "https://stackoverflow.com/users/2415118/abden003"}, "edited": false, "score": 1, "creation_date": 1455915477, "post_id": 35474267, "comment_id": 58720344, "body": "@abden003, yes, they will certainly be able to interleave execution, either with your original code or with my suggested modifications."}, {"owner": {"reputation": 1176, "user_id": 2415118, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f71ca7d457d223d598b1f439ff171ecd?s=128&d=identicon&r=PG", "display_name": "abden003", "link": "https://stackoverflow.com/users/2415118/abden003"}, "edited": false, "score": 0, "creation_date": 1455916220, "post_id": 35474267, "comment_id": 58720720, "body": "is there a word or topic for this?  I would like to look into how haskell determines when and where to interleave."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1176, "user_id": 2415118, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f71ca7d457d223d598b1f439ff171ecd?s=128&d=identicon&r=PG", "display_name": "abden003", "link": "https://stackoverflow.com/users/2415118/abden003"}, "edited": false, "score": 0, "creation_date": 1455922473, "post_id": 35474267, "comment_id": 58723728, "body": "@abden003, it doesn&#39;t decide. It&#39;s just a consequence of lazy evaluation."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1455777603, "last_edit_date": 1455777603, "creation_date": 1455776477, "answer_id": 35474267, "question_id": 35470100, "link": "https://stackoverflow.com/questions/35470100/would-this-solution-be-susceptible-to-overflow-via-thunks/35474267#35474267", "title": "Would this solution be susceptible to overflow via thunks", "body": "<p>I'm guessing you might be worried that the groups will actually be put together first, so they'll all be sitting in memory. This <em>could happen</em>. In particular, if whoever consumes the result of your function steps through the list, holding on to the beginning, <em>without forcing its elements along the way</em>, then you could potentially have a problem. This is fairly unlikely in practice, but if it's a concern in your application, you could replace <code>map</code> by the following:</p>\n\n<pre><code>smap :: (a -&gt; b) -&gt; [a] -&gt; [b]\nsmap f = foldr go [] where\n  go x = (:) $! f x\n</code></pre>\n\n<p>This refuses to produce a \"cons\" before evaluating its \"car\". In your application, it ensures that each group is summed before the next is started, which will actually cause each group to be summed <em>incrementally</em> as long as strictness analysis and/or other optimizations work out properly.</p>\n\n<p>To avoid relying on any such optimizations, you'll have to replace <code>sum</code> by</p>\n\n<pre><code>sum' :: Num a =&gt; [a] -&gt; a\nsum' = foldl' (+) 0\n</code></pre>\n\n<p>As for <code>group</code> itself, you have nothing to worry about&mdash;it's written lazily, so you can access (and discard) the elements of a group as that group is being formed.</p>\n\n<hr>\n\n<p>The simplest example of an \"evil consumer\" I could think of:</p>\n\n<pre><code>forceSpine :: [a] -&gt; ()\nforceSpine [] = ()\nforceSpine (_ : xs) = forceSpine xs\n\nevil :: ([a] -&gt; r) -&gt; [a] -&gt; r\nevil f xs = forceSpine xs `seq` f xs\n</code></pre>\n"}], "owner": {"reputation": 1176, "user_id": 2415118, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f71ca7d457d223d598b1f439ff171ecd?s=128&d=identicon&r=PG", "display_name": "abden003", "link": "https://stackoverflow.com/users/2415118/abden003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 35474267, "answer_count": 1, "score": 2, "last_activity_date": 1455777603, "creation_date": 1455752989, "question_id": 35470100, "link": "https://stackoverflow.com/questions/35470100/would-this-solution-be-susceptible-to-overflow-via-thunks", "title": "Would this solution be susceptible to overflow via thunks", "body": "<p>The following problem is to sum consecutive integers in an array.  Here is one solution:</p>\n\n<pre><code>import Data.List (group)\n\nsumConsecutives :: [Int] -&gt; [Int]\nsumConsecutives = map sum . group\n</code></pre>\n\n<p>I was wondering whether this solution would cause an overflow, and my other question was whether the runtime of the algorithm would be O(n)?  Since Haskell is lazy I assume the group function would not be called, and would be called lazily with the map, so that the list is gone over only once.  The other solution to the problem was the following:</p>\n\n<pre><code>import Data.List\n\nsummer :: ([Int], Maybe Int) -&gt; Int -&gt; ([Int], Maybe Int) \nsummer ([], _) next = next `seq` ([next], Just next)\nsummer (xs, Nothing) next = next `seq` (xs, Just next)\nsummer ((x:xs), Just prev) next\n  | next == prev = next `seq` (((x + next):xs), Just prev)\n  | otherwise    = next `seq` ((next:x:xs), Just next)\n\nsumConsecutives :: [Int] -&gt; [Int]\nsumConsecutives s = reverse . fst $ foldl' summer ([], Nothing) s\n</code></pre>\n\n<p>This solution tries to solve the thunk problem in the previous solution.</p>\n"}, {"tags": ["haskell", "serialization", "database-migration"], "answers": [{"tags": [], "owner": {"reputation": 11669, "user_id": 76123, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c933fbb8685a083234fe385df8e9025f?s=128&d=identicon&r=PG", "display_name": "Daniel Pratt", "link": "https://stackoverflow.com/users/76123/daniel-pratt"}, "is_accepted": false, "score": 1, "last_activity_date": 1455754985, "creation_date": 1455754985, "answer_id": 35470475, "question_id": 35469749, "link": "https://stackoverflow.com/questions/35469749/haskell-why-does-derivingsafecopy-depend-only-on-the-types-passed-into-the-cons/35470475#35470475", "title": "Haskell: Why does derivingSafeCopy depend only on the types passed into the Constructor?", "body": "<p>Suppose that the data was tagged with the serialized type, as you seem to think it should. How would you use this information? Even if it were possible to deserialize a value without specifying the type, how would you use the resulting value (you don't know its type, after all).</p>\n\n<p>Consider making a type like this:</p>\n\n<pre><code>data C = TagA A | TagB B\n</code></pre>\n\n<p>Now you can put <code>A</code> and <code>B</code> values in a <code>C</code> <em>wrapper</em> and serialize the result. When you deserialize values of type <code>C</code>, you now have a tag (the constructor) to indicate the type of the contained value.</p>\n\n<p>Disclaimer: I have never had an occasion to use these libraries.</p>\n"}], "owner": {"reputation": 141, "user_id": 4960278, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh5.googleusercontent.com/-rhXMnM2laZQ/AAAAAAAAAAI/AAAAAAAAAZM/zTJL6P6VbSE/photo.jpg?sz=128", "display_name": "Timothy Chu", "link": "https://stackoverflow.com/users/4960278/timothy-chu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1455754985, "creation_date": 1455751274, "question_id": 35469749, "link": "https://stackoverflow.com/questions/35469749/haskell-why-does-derivingsafecopy-depend-only-on-the-types-passed-into-the-cons", "title": "Haskell: Why does derivingSafeCopy depend only on the types passed into the Constructor?", "body": "<p>I want to use derivingSafeCopy from <a href=\"https://hackage.haskell.org/package/safecopy-0.9.0.1/docs/Data-SafeCopy.html\" rel=\"nofollow\">https://hackage.haskell.org/package/safecopy-0.9.0.1/docs/Data-SafeCopy.html</a> , for serializing my data types to store them in a Database -- this is because I want to be able to migrate types in my database easily.</p>\n\n<p>According to the specs, if I have something like:</p>\n\n<pre><code>data A = A\ndata B = B\nderiveSafeCopy 1 'base ''A\nderiveSafeCopy 1 'base ''B\n</code></pre>\n\n<p>the output of putCopy A and putCopy B will be identical. I would hope that putCopy A and putCopy B would be different, since I'm serializing A and B using runGet . safeGet, and want A and B would serialize to something different. Why does it work this way, and how can I get A and B to serialie to different things in a way that will allow me to migrate data types easily?</p>\n"}, {"tags": ["parsing", "haskell", "parsec", "parser-combinators"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455793546, "post_id": 35465807, "comment_id": 58653098, "body": "You can get around this with a huge hack - write an exact copy of the <code>ParsecT</code> type in your own module, then use <code>unsafeCoerce</code> to convert between the two - &quot;guaranteed&quot; to work, as long you never forget to update your code when the library changes the internal representation of the type. The real solution is to get the maintainer to internal an &quot;Internal&quot; module which exports the constructor, but that could be a lot of work. Or just fork the library."}, {"owner": {"reputation": 5171, "user_id": 2718186, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ca44ca18bf615e74f930d28a89d01508?s=128&d=identicon&r=PG", "display_name": "MicroVirus", "link": "https://stackoverflow.com/users/2718186/microvirus"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1456139489, "post_id": 35465807, "comment_id": 58792208, "body": "@user2407038 Thanks for the ideas. I was hoping for a compatible solution, but it doesn&#39;t seem like there is any. I don&#39;t feel like forking the library, so in practice I&#39;ll just use the alternative/work-around."}, {"owner": {"reputation": 689, "user_id": 6217179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/633461a7b7bd893feebbc9285d0fb049?s=128&d=identicon&r=PG&f=1", "display_name": "sapanoia", "link": "https://stackoverflow.com/users/6217179/sapanoia"}, "edited": false, "score": 0, "creation_date": 1475269128, "post_id": 35465807, "comment_id": 66892630, "body": "Could you explain why <code>sign &gt;&gt;= \\s -&gt; (try (number s) &lt;|&gt; identifier s)</code> does not give the result you need?"}, {"owner": {"reputation": 5171, "user_id": 2718186, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ca44ca18bf615e74f930d28a89d01508?s=128&d=identicon&r=PG", "display_name": "MicroVirus", "link": "https://stackoverflow.com/users/2718186/microvirus"}, "reply_to_user": {"reputation": 689, "user_id": 6217179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/633461a7b7bd893feebbc9285d0fb049?s=128&d=identicon&r=PG&f=1", "display_name": "sapanoia", "link": "https://stackoverflow.com/users/6217179/sapanoia"}, "edited": false, "score": 0, "creation_date": 1475269472, "post_id": 35465807, "comment_id": 66892743, "body": "@sapanoia Separation of concern mostly; I don&#39;t want to mix knowledge of identifiers into a function that parses numbers, if it can at all be helped. A similar workaround I mentioned in my post, but here I was looking for an elegant resolution."}, {"owner": {"reputation": 689, "user_id": 6217179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/633461a7b7bd893feebbc9285d0fb049?s=128&d=identicon&r=PG&f=1", "display_name": "sapanoia", "link": "https://stackoverflow.com/users/6217179/sapanoia"}, "edited": false, "score": 0, "creation_date": 1475270816, "post_id": 35465807, "comment_id": 66893227, "body": "@MicroVirus I see why you do not want to bake them together and, unfortunately, I do not have a solution. In simple cases with a constant prefix, it might be possible to have a function for merging those parsers: <code>merge [number, identifier]</code>, but I think it would likely require an Arrows-based parser."}], "owner": {"reputation": 5171, "user_id": 2718186, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ca44ca18bf615e74f930d28a89d01508?s=128&d=identicon&r=PG", "display_name": "MicroVirus", "link": "https://stackoverflow.com/users/2718186/microvirus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1455736923, "creation_date": 1455736923, "question_id": 35465807, "link": "https://stackoverflow.com/questions/35465807/defining-a-new-primitive-combinator-in-parsec", "title": "Defining a new primitive combinator in Parsec", "body": "<h1>Problem context</h1>\n\n<p>I am writing a toy parser (for Scheme), that should be able to distinguish between <code>-</code> and <code>+</code> as identifiers and as a part of a number (e.g. <code>+i</code>, <code>-2.4</code>, <code>+5</code>). I would like to try-parse anything starting with <code>+</code> or <code>-</code> as a number, but with a catch: if the parses consumes the sign, but not any characters after the sign, then I would like it to act as if it was wrapped in a <code>try</code>, but if any input was consumed after the sign then I'd like it to fail, getting a nice contextual error message and line number/position for the offending character; wrapping the entire parser in a <code>try</code> would always backtrack, which is not what I want.</p>\n\n<h1>New combinator: <code>followedBy</code></h1>\n\n<p>To this end, I want to create a combinator, which I dubbed <code>followedBy</code>\u00b9, that mirrors bind (<code>&gt;&gt;=</code>) and takes a parser <code>m</code> and a function <code>k</code> that returns a parser,</p>\n\n<pre><code>followedBy :: ParsecT s u m a -&gt; (a -&gt; ParsecT s u m b) -&gt; ParsecT s u m b\nm `followedBy` k = ...\n</code></pre>\n\n<p>and acts as <code>&gt;&gt;=</code> except when <code>m</code> consumes ok and <code>k</code> empty fails, in which case I want the combinator to empty fail. This combinator can then be used as such:</p>\n\n<pre><code>(char '+') `followedBy` (\\sign -&gt; parseUnsignedNumber sign)\n</code></pre>\n\n<p>to try to parse as a number, fail if it is partially a number but malformed, and empty fail if what follows <code>+</code> is not at all like a number.</p>\n\n<hr>\n\n<h2>Low-level implementation</h2>\n\n<p>I have adjusted the <code>parserBind</code> code from <code>Text.Parsec.Prim</code> to do exactly this\u00b2, but because it uses symbols that are not exported by Parsec I can't compile it. Is there a way to write the same thing using higher-level constructs that are exported by Parsec?</p>\n\n<p>My (uncompilable) implementation for <code>followedBy</code> is:</p>\n\n<pre><code>import Text.Parsec.Prim\n\nfollowedBy :: ParsecT s u m a -&gt; (a -&gt; ParsecT s u m b) -&gt; ParsecT s u m b\n-- Code adjusted from parserBind in Text.Parsec.Prim. Changed is that mcok.peerr uses eerr instead.\nfollowedBy m k\n  = ParsecT $ \\s cok cerr eok eerr -&gt;\n    let\n    -- consumed-okay case for m\n    mcok x s' err =\n        let\n         -- if (k x) consumes, those go straight up\n         pcok = cok\n         pcerr = cerr\n\n         -- if (k x) doesn't consume input, but is okay,\n         -- we still return in the consumed continuation\n         peok x s err' = cok x s (mergeError err err')\n\n         -- if (k x) doesn't consume input, but errors,\n         -- then we return the empty error (not consuming m or k)\n         peerr err' = eerr (mergeError err err')\n        in  unParser (k x) s pcok pcerr peok peerr                      \n\n    -- empty-ok case for m\n    meok x s err =\n        let\n        -- in these cases, (k x) can return as empty\n        pcok = cok\n        peok x s err' = eok x s (mergeError err err')\n        pcerr = cerr\n        peerr err' = eerr (mergeError err err') \n        in  unParser (k x) s pcok pcerr peok peerr\n    -- consumed-error case for m\n    mcerr = cerr\n\n    -- empty-error case for m\n    meerr = eerr\n\n    in unParser m s mcok mcerr meok meerr\n</code></pre>\n\n<hr>\n\n<h2>Possible alternative</h2>\n\n<p>I know that there is also an alternative, namely to <code>try</code>-parse <code>+</code> as an identifier, along the lines of <code>char '+' &gt;&gt; parseDelimiter</code>, and I will take this route if the <code>followedBy</code> does not work and another (elegant) solution does not present itself, but I am really curious if <code>followedBy</code> can be implemented and, if so, how.</p>\n\n<hr>\n\n<p><em>\u00b9) Anyone having a better name for it is welcome to comment.</em></p>\n\n<p><em>\u00b2) I have not been able to test it, so I don't know for sure if my code works correctly.</em></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1455739095, "post_id": 35465539, "comment_id": 58628668, "body": "Note that <code>Data.List</code> offers the <code>intercalate</code> function for this."}, {"owner": {"reputation": 626, "user_id": 2841937, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/QkMye.jpg?s=128&g=1", "display_name": "Eugene", "link": "https://stackoverflow.com/users/2841937/eugene"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1455741609, "post_id": 35465539, "comment_id": 58630179, "body": "The code above is for learning purposes, but in a real project I&#39;ll use the function you suggest."}], "answers": [{"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1455786738, "post_id": 35465778, "comment_id": 58648320, "body": "If it makes you feel any better, this is at least the second question this month I&#39;ve seen with <code>[x:xs]</code> rather than <code>(x:xs)</code>..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1455798695, "post_id": 35465778, "comment_id": 58656468, "body": "@MathematicalOrchid Indeed, this is a common mistake. I have also seen <code>f [x] = ...</code> where <code>x</code> is assumed to match with the input list many times. I always wonder what is the cause of the diffusion of these mistakes."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1455763341, "last_edit_date": 1455763341, "creation_date": 1455736818, "answer_id": 35465778, "question_id": 35465539, "link": "https://stackoverflow.com/questions/35465539/haskell-head-tail-vs-pattern-matching/35465778#35465778", "title": "Haskell head/tail vs pattern matching", "body": "<p>Use parentheses, not brackets:</p>\n\n<pre><code>   -- vvvvvv\njoins (x:xs) d = x ++ d ++ (joins xs d)\n</code></pre>\n\n<p>The pattern <code>[x:xs]</code> matches only with a list of length one, whose single element is a nonempty list <code>x:xs</code>.</p>\n\n<p>Since yours is a list of strings, <code>[x:xs]</code> matches with <code>[\"banana\"]</code> (where <code>x='b', xs=\"anana\"</code>), with <code>[\"a\"]</code> (<code>x='a', xs=\"\"</code>) but not with <code>[\"banana\", \"split\"]</code> nor with <code>[\"\"]</code>.</p>\n\n<p>This is clearly not what you want, so use plain parentheses.</p>\n\n<p>(By the way, the parentheses in <code>... ++ (joins xs d)</code> are not needed: function application binds more than any binary operator in Haskell.)</p>\n"}], "owner": {"reputation": 626, "user_id": 2841937, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/QkMye.jpg?s=128&g=1", "display_name": "Eugene", "link": "https://stackoverflow.com/users/2841937/eugene"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1476, "favorite_count": 0, "accepted_answer_id": 35465778, "answer_count": 1, "score": 1, "last_activity_date": 1455763341, "creation_date": 1455736112, "last_edit_date": 1455742698, "question_id": 35465539, "link": "https://stackoverflow.com/questions/35465539/haskell-head-tail-vs-pattern-matching", "title": "Haskell head/tail vs pattern matching", "body": "<p>Here are two pieces of code.</p>\n\n<p>Working:</p>\n\n<pre><code>joins :: [String] -&gt; String -&gt; String\njoins [] _ = \"\"\njoins [x] _ = x\njoins xs d = head xs ++ d ++ (joins (tail xs) d)\n</code></pre>\n\n<p>Not working:</p>\n\n<pre><code>joins :: [String] -&gt; String -&gt; String\njoins [] _ = \"\"\njoins [x] _ = x\njoins [x:xs] d = x ++ d ++ (joins xs d)\n</code></pre>\n\n<p>The error log for the latter is:</p>\n\n<pre><code>test.hs:4:18:\nCouldn't match expected type `[Char]' with actual type `Char'\nIn the first argument of `(++)', namely `x'\nIn the expression: x ++ d ++ (joins xs d)\nIn an equation for `joins':\n    joins [x : xs] d = x ++ d ++ (joins xs d)\n\ntest.hs:4:35:\nCouldn't match type `Char' with `[Char]'\nExpected type: [String]\n  Actual type: [Char]\nIn the first argument of `joins', namely `xs'\nIn the second argument of `(++)', namely `(joins xs d)'\nIn the second argument of `(++)', namely `d ++ (joins xs d)'\n</code></pre>\n\n<p>What am I missing here?</p>\n"}, {"tags": ["database", "haskell", "functional-programming", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "is_accepted": false, "score": 2, "last_activity_date": 1456009316, "last_edit_date": 1456009316, "creation_date": 1455997545, "answer_id": 35528168, "question_id": 35465354, "link": "https://stackoverflow.com/questions/35465354/haskell-storing-composed-adt-with-persistent-definitions/35528168#35528168", "title": "Haskell storing composed ADT with Persistent definitions", "body": "<p>To store ADTs with Persistent, you just need to tell Persistent how to serialize/deserialize that value from the database. To do that, make it an instance of <code>PersistField</code> (to convert it to and from a basic type like <code>Text</code> or <code>ByteString</code>) and <code>PersistFieldSql</code> (to specify what type of database column to use).</p>\n\n<p>You have several options on (de)serializing the data. I imagine encoding/decoding to binary values would be faster, but I recommend JSON because:</p>\n\n<ul>\n<li>It's human readable from the database level</li>\n<li>Some databases have built-in support for it</li>\n<li>It's portable</li>\n<li>Support is built into Persistent via <code>to/fromPersistValueJSON</code>.</li>\n</ul>\n\n<p>Here's an example of that:</p>\n\n<pre><code>-- Add this extension to derive To/FromJSON instances; see Data.Aeson for details\n{-# LANGUAGE DeriveGeneric #-}\n\nmodule Models.Work where\n\nimport Database.Persist.Sql (PersistFieldSql(..))\nimport ClassyPrelude.Yesod\nimport Data.Aeson\n\ndata TemporalUnity = Hour | Day | Week | Month deriving (Generic)\n\ninstance FromJSON TemporalUnity\ninstance ToJSON TemporalUnity\n\ndata WorkDuration = WorkDurationUndefined\n                  | WorkDurationEstimated { workDurationEstimatedUnity :: TemporalUnity\n                                          , workDurationEstimatedQuantity :: Int }\n                  | WorkDurationPermanent deriving (Generic)\n\ninstance FromJSON WorkDuration\ninstance ToJSON WorkDuration\n\n-- Store the values as as SqlString. The actual column type will be dependent on the database backend. SqlString will be something like varchar/text types.\n-- You can also use PersistByteString, which might be faster\ninstance PersistFieldSql WorkDuration where\n  sqlType _ = SqlString\n\n\ninstance PersistField WorkDuration where\n  toPersistValue = toPersistValueJSON\n  fromPersistValue = fromPersistValueJSON\n</code></pre>\n\n<p>Here's what it looks like to select from Postgres:</p>\n\n<pre><code>foo=# SELECT * FROM \"user\";\n id | ident  | password |                                               duration\n----+--------+----------+-------------------------------------------------------------------------------------------------------\n  5 | foo123 |          | {\"tag\":\"WorkDurationPermanent\",\"contents\":[]}\n  6 | bar456 |          | {\"tag\":\"WorkDurationEstimated\",\"workDurationEstimatedQuantity\":1,\"workDurationEstimatedUnity\":\"Hour\"}\n</code></pre>\n\n<p>I'm not super familiar with native JSON support in MySQL or Postgres, but you may want to look into that if you want to do queries based on the underlying JSON data.</p>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1456009316, "creation_date": 1455735556, "question_id": 35465354, "link": "https://stackoverflow.com/questions/35465354/haskell-storing-composed-adt-with-persistent-definitions", "title": "Haskell storing composed ADT with Persistent definitions", "body": "<p>How could I create <strong>Yesod Persistent</strong> Entities which resembles this <code>ADTs</code>:</p>\n\n<pre><code>import Data.Ratio\n\ndata Work = Work { name :: String\n                 , payment :: WorkPayment\n                 , duration :: WorkDuration }\n\ndata WorkPayment = WorkPaymentUndefined\n                 | WorkPaymentEstimated { workPaymentEstimatedUnity :: TemporalUnity\n                                        , workPaymentEstimatedValue :: Ratio Int }\n                 | WorkPaymentTotal { workPaymentTotalValue :: Ratio Int }\n\ndata WorkDuration = WorkDurationUndefined\n                  | WorkDurationEstimated { workDurationEstimatedUnity :: TemporalUnity\n                                          , workDurationEstimatedQuantity :: Int }\n                  | WorkDurationPermanent\n\ndata TemporalUnity = Hour | Day | Week | Month\n</code></pre>\n\n<p>The long names could be avoided by using separated modules but I preffered putting them all together for this example.</p>\n\n<p>For easy <code>Enums</code> it seems quite straight forward but I cannot figure out how will be the tables in this situation like in a <strong>relational database</strong> like MySQL</p>\n"}, {"tags": ["haskell", "biginteger"], "comments": [{"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 3, "creation_date": 1455733514, "post_id": 35464697, "comment_id": 58625155, "body": "<b>Hint:</b> Is the arithmetic that you do on a piece of paper arbitrarily limited to some number of digits?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1455733761, "post_id": 35464697, "comment_id": 58625295, "body": "Try it in ghci: <code>10^(10^6)</code> has a million place values. It ain&#39;t a billion, but what&#39;s a factor of <code>10^(10^9-10^6)</code> between friends?"}, {"owner": {"reputation": 431, "user_id": 5186934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/aEulW.jpg?s=128&g=1", "display_name": "HandsomeGorilla", "link": "https://stackoverflow.com/users/5186934/handsomegorilla"}, "edited": false, "score": 0, "creation_date": 1455733775, "post_id": 35464697, "comment_id": 58625304, "body": "Gahh my brain! I mean... technically I&#39;m restricted by the quantity of graphite or ink at my disposal and the total surface area of the medium that receives aforementioned ink/graphite.  But given a sufficiently large sheet of paper and quantity of ink/graphite, no."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1455733812, "post_id": 35464697, "comment_id": 58625328, "body": "@HandsomeGorilla The numbers you can work with using <code>Integer</code> are similarly limited by the total amount of RAM you have."}], "answers": [{"comments": [{"owner": {"reputation": 431, "user_id": 5186934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/aEulW.jpg?s=128&g=1", "display_name": "HandsomeGorilla", "link": "https://stackoverflow.com/users/5186934/handsomegorilla"}, "edited": false, "score": 0, "creation_date": 1455734037, "post_id": 35464803, "comment_id": 58625471, "body": "Ah okay.  This gives me a more intuitive notion of how it works.  Could I think about an <code>Integer</code> as a list of character digits, where position indicates place value? Is that an over-simplification?"}, {"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "reply_to_user": {"reputation": 431, "user_id": 5186934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/aEulW.jpg?s=128&g=1", "display_name": "HandsomeGorilla", "link": "https://stackoverflow.com/users/5186934/handsomegorilla"}, "edited": false, "score": 3, "creation_date": 1455734510, "post_id": 35464803, "comment_id": 58625714, "body": "Yes, with the caveat that a digit isn&#39;t necessarily a decimal digit (base ten).  Bigint libraries can, and often do, use some other base like 256 (byte digits) or 65536 (sixteen bit word digits)."}, {"owner": {"reputation": 27437, "user_id": 95954, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iD0qO.png?s=128&g=1", "display_name": "Rudy Velthuis", "link": "https://stackoverflow.com/users/95954/rudy-velthuis"}, "edited": false, "score": 0, "creation_date": 1455833080, "post_id": 35464803, "comment_id": 58679371, "body": "Good Bignum libraries store numbers as a collection of machine words instead of digits. That makes life a lot easier, and makes calcualtions a lot faster. The latter is important because BigNums are generally not hardware supported and therefore a lot slower than machine supported ones. Many languages will use machine words/integers as much as possible, and only resort to BigNums if the results get too large for one machine word."}], "tags": [], "owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "is_accepted": true, "score": 4, "last_activity_date": 1455733759, "creation_date": 1455733759, "answer_id": 35464803, "question_id": 35464697, "link": "https://stackoverflow.com/questions/35464697/haskell-integers-what-exactly-is-going-on-here/35464803#35464803", "title": "Haskell Integers; What exactly is going on here?", "body": "<p>Haskell's <code>Integer</code> type is colloquially known as a <a href=\"https://en.wikipedia.org/wiki/Arbitrary-precision_arithmetic\" rel=\"nofollow\">bignum</a> type.  It works in much the same way as you might perform math calculations by hand: by dealing with numeric digits instead of fixed-precision binary words.</p>\n\n<p>Bignum libraries typically store numbers as a <em>collection of digits.</em>  Arithmetic works the same way as if you had performed it by hand; by manipulating the digits.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1455792144, "last_edit_date": 1455792144, "creation_date": 1455734363, "answer_id": 35464974, "question_id": 35464697, "link": "https://stackoverflow.com/questions/35464697/haskell-integers-what-exactly-is-going-on-here/35464974#35464974", "title": "Haskell Integers; What exactly is going on here?", "body": "<blockquote>\n  <p>Say I had enough RAM available to hold a number with a billion place values. Would Haskell be able to work with that number?</p>\n</blockquote>\n\n<pre><code>Prelude&gt; length . show $ 10^1000000000\n1000000001\n</code></pre>\n\n<p>Granted, it did take quite a lot of memory</p>\n\n<p><a href=\"https://i.stack.imgur.com/KJdxg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KJdxg.png\" alt=\"enter image description here\"></a></p>\n\n<p>But if you think about it &ndash; one byte can actually store numbers up to 256>100, i.e. you can store more than two decimal digits in each byte. A number with a billion digits should therefore take less than 500 MB to store... well, evidently there is some overhead here with the multiplications needed (also when I <code>show</code> the number I'm generating an inefficient list-string) but nothing dramatic.</p>\n\n<p>BTW, it's not Haskell/GHC which does these computations but <a href=\"https://gmplib.org/\" rel=\"nofollow noreferrer\">GMP</a>, which is used by GHC.</p>\n\n<p>But you <em>could</em> easily implement such a type yourself in Haskell. E.g. for simplicity, with a list of decimal digits as you suggested<sup>&dagger;</sup></p>\n\n<pre><code>newtype DecDigit = DD { getDecDig :: Int }\n\ninstance Num [DecDigit] where\n  fromInteger n | n &lt; 10     = [DD $ fromInteger n]\n                | otherwise  = let (cs,ls) = n`divMod`10\n                               in DD $ fromInteger ls : fromInteger cs\n  n + [] = n\n  [] + n = n\n  (DD n\u2080 : n) + (DD m\u2080 : m)\n     | s\u2080&lt;10      = DD s\u2080 : n+m\n     | otherwise  = DD (s\u2080-10) : n+m+[DD 1]\n   where s\u2080 = n\u2080+m\u2080\n\n  ...\n</code></pre>\n\n<p>Multiplication is a tad more difficult, but basically, as said by Robert Harvey, it's all like you'd calculate with pen and paper.</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>This is very inefficient! Actual implementation would use not decimal digits, but fully exploit machine-size words (probably using 128-bit or even 256-bit primitive operation of modern processors).</sub></p>\n"}], "owner": {"reputation": 431, "user_id": 5186934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/aEulW.jpg?s=128&g=1", "display_name": "HandsomeGorilla", "link": "https://stackoverflow.com/users/5186934/handsomegorilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 35464803, "answer_count": 2, "score": 0, "last_activity_date": 1455792144, "creation_date": 1455733432, "question_id": 35464697, "link": "https://stackoverflow.com/questions/35464697/haskell-integers-what-exactly-is-going-on-here", "title": "Haskell Integers; What exactly is going on here?", "body": "<p>Having recently become curious about Haskell, I've started doing some reading.  <code>Integer</code>s are blowing my mind.</p>\n\n<p>When we say that an <code>Integer</code> can be arbitrarily large, does that mean what I think it means (i.e. the size of an <code>Integer</code> is not restricted by the address width of the OS)?</p>\n\n<p>Say I had enough RAM available to hold a number with a billion place values.  Would Haskell be able to work with that number?</p>\n\n<p>Can anybody describe to me what's going on under the hood to make this possible?</p>\n"}, {"tags": ["haskell", "functional-programming", "agda", "theorem-proving", "floyd-cycle-finding"], "comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 3, "creation_date": 1455731640, "post_id": 35464008, "comment_id": 58624068, "body": "<a href=\"http://ideone.com/aKcgNZ\" rel=\"nofollow noreferrer\">Why</a> the accumulator?"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1455732230, "post_id": 35464008, "comment_id": 58624432, "body": "@user3237465 For efficient tail recursion. Either way, it doesn&#39;t make any difference to the actual problem."}, {"owner": {"reputation": 2342, "user_id": 1683460, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2535857ac59d18baeda7b081c645f901?s=128&d=identicon&r=PG", "display_name": "Twan van Laarhoven", "link": "https://stackoverflow.com/users/1683460/twan-van-laarhoven"}, "edited": false, "score": 4, "creation_date": 1455732261, "post_id": 35464008, "comment_id": 58624444, "body": "This <code>floyd acc [] (y \u2237 ys)</code> case can arise, just by calling that function directly. You could give it a dummy implementation."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 2342, "user_id": 1683460, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2535857ac59d18baeda7b081c645f901?s=128&d=identicon&r=PG", "display_name": "Twan van Laarhoven", "link": "https://stackoverflow.com/users/1683460/twan-van-laarhoven"}, "edited": false, "score": 0, "creation_date": 1455732474, "post_id": 35464008, "comment_id": 58624566, "body": "@TwanvanLaarhoven Indeed, it could arise if we call the <code>floyd</code> function directly. However, we&#39;re not supposed to. The Haskell type for the <code>floyd</code> function is too permissive. I was hoping we could give <code>floyd</code> a stricter type in Agda. Perhaps a dependent type?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 3, "creation_date": 1455732558, "post_id": 35464008, "comment_id": 58624608, "body": "@Aadit M Shah, it&#39;s not efficient \u2014 it&#39;s unnecessary strict, which means that you can&#39;t garbage collect elements of a list as soon as possible, which results in very bad performance. Nobody defines functions like <code>map</code>, <code>_++_</code> and others using tail recursion, especially in a dependently-typed setting."}, {"owner": {"reputation": 2342, "user_id": 1683460, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2535857ac59d18baeda7b081c645f901?s=128&d=identicon&r=PG", "display_name": "Twan van Laarhoven", "link": "https://stackoverflow.com/users/1683460/twan-van-laarhoven"}, "edited": false, "score": 4, "creation_date": 1455732618, "post_id": 35464008, "comment_id": 58624643, "body": "You could give it the type <code>floyd : {A : Set} \u2192 List A \u2192 (xs : List A) \u2192 (ys : List A) \u2192 length xs \u2265 length ys \u2192 List A &#215; List A</code>."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1455733189, "post_id": 35464008, "comment_id": 58624974, "body": "@user3237465 I&#39;m used to strict functional programming languages like OCaml and hence I tend to use an accumulator. I keep forgetting that Haskell is non-strict. In OCaml we have both tail recursive and non tail recursive versions of <code>map</code>, etc."}, {"owner": {"reputation": 792, "user_id": 3550444, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8a06f855d0b44ead04edffa576cd943e?s=128&d=identicon&r=PG", "display_name": "Musa Al-hassy", "link": "https://stackoverflow.com/users/3550444/musa-al-hassy"}, "edited": false, "score": 1, "creation_date": 1455733313, "post_id": 35464008, "comment_id": 58625038, "body": "Okay, this is the first time I&#39;ve heard of this algorithm and it seems pretty neat and a quick google search gave me variations/alternates of it that accomplished goals different than yours. Would you please explain the goal that this particular floyd is supposed to accomplish. With such a specification in hand, we can then discuss a dependent type for it ;)"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 792, "user_id": 3550444, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8a06f855d0b44ead04edffa576cd943e?s=128&d=identicon&r=PG", "display_name": "Musa Al-hassy", "link": "https://stackoverflow.com/users/3550444/musa-al-hassy"}, "edited": false, "score": 1, "creation_date": 1455733836, "post_id": 35464008, "comment_id": 58625347, "body": "@MusaAl-hassy I added a visual example of how the algorithm works in the question."}, {"owner": {"reputation": 792, "user_id": 3550444, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8a06f855d0b44ead04edffa576cd943e?s=128&d=identicon&r=PG", "display_name": "Musa Al-hassy", "link": "https://stackoverflow.com/users/3550444/musa-al-hassy"}, "edited": false, "score": 1, "creation_date": 1455736494, "post_id": 35464008, "comment_id": 58626950, "body": "Here&#39;s an attempt for a dependent type.  <code>\u2200 {n A} \u2192 (xs : Vec A n) \u2192 \u03a3 left \u2236 Vec A \u2308 n &#47;2\u2309  \u2022 \u03a3 right \u2236 Vec A \u230a n &#47;2 \u230b \u2022 xs \u2261 left ++ right</code> where I write <code>\u03a3 x \u2236 X \u2022 Y</code> for the dependent product instead of <code>Data.Product</code>&#39;s clunky <code>\u03a3[ x \u2208 A] Y</code> ---eww looks like set theory!--- and the ceiling/floor properties can be found in <code>Data.Nat.Properties</code>.  Of course, as others will note, a separation of concerns might be in order. If the proofs get out of hand, one might form the operation then prove that it satisfies the specification."}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1455733124, "post_id": 35464500, "comment_id": 58624941, "body": "You can often dispense with proofs of <code>\u2264</code> by requiring that the length of one <code>Vec</code> be &quot;something plus&quot; the length of the other: <code>forall {m} -&gt; Vec A n -&gt; Vec A (n + m) -&gt; ...</code>"}, {"owner": {"reputation": 792, "user_id": 3550444, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8a06f855d0b44ead04edffa576cd943e?s=128&d=identicon&r=PG", "display_name": "Musa Al-hassy", "link": "https://stackoverflow.com/users/3550444/musa-al-hassy"}, "edited": false, "score": 0, "creation_date": 1455733167, "post_id": 35464500, "comment_id": 58624963, "body": "I think you might have a typo since you&#39;re never making any real use of <code>ys</code> within <code>floyd</code> ... cf <a href=\"http://ideone.com/aKcgNZ\" rel=\"nofollow noreferrer\">ideone.com/aKcgNZ</a> which was posted by @user3237465 earlier as a comment"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 792, "user_id": 3550444, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8a06f855d0b44ead04edffa576cd943e?s=128&d=identicon&r=PG", "display_name": "Musa Al-hassy", "link": "https://stackoverflow.com/users/3550444/musa-al-hassy"}, "edited": false, "score": 1, "creation_date": 1455733332, "post_id": 35464500, "comment_id": 58625050, "body": "@Musa Al-hassy, the only use for <code>ys</code> we need is to shorten two times faster than <code>xs</code>."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1455734826, "post_id": 35464500, "comment_id": 58625930, "body": "@BenjaminHodgson But then you&#39;d have to prove that you can split <code>n</code> into <code>ceil (n &#47; 2) + floor (n &#47; 2)</code> to kick off the algorithm. Which is what floyd seems to be doing in the first place."}, {"owner": {"reputation": 2342, "user_id": 1683460, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2535857ac59d18baeda7b081c645f901?s=128&d=identicon&r=PG", "display_name": "Twan van Laarhoven", "link": "https://stackoverflow.com/users/1683460/twan-van-laarhoven"}, "edited": false, "score": 0, "creation_date": 1455881530, "post_id": 35464500, "comment_id": 58699614, "body": "<code>\u2264-refl</code> and <code>\u2264-step</code> are in <code>Data.Nat.Properties</code>"}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": true, "score": 6, "last_activity_date": 1455736322, "last_edit_date": 1495535297, "creation_date": 1455732813, "answer_id": 35464500, "question_id": 35464008, "link": "https://stackoverflow.com/questions/35464008/how-to-implement-floyds-hare-and-tortoise-algorithm-in-agda/35464500#35464500", "title": "How to implement Floyd&#39;s Hare and Tortoise algorithm in Agda?", "body": "<p>The same thing as <strong>Twan van Laarhoven</strong> suggests in the comments but with <code>Vec</code>s. His version is probably better.</p>\n\n<pre><code>open import Function\nopen import Data.Nat.Base\nopen import Data.Product renaming (map to pmap)\nopen import Data.List.Base\nopen import Data.Vec hiding (split)\n\n\u2264-step : \u2200 {m n} -&gt; m \u2264 n -&gt; m \u2264 suc n\n\u2264-step  z\u2264n     = z\u2264n\n\u2264-step (s\u2264s le) = s\u2264s (\u2264-step le)\n\n\u2264-refl : \u2200 {n} -&gt; n \u2264 n\n\u2264-refl {0}     = z\u2264n\n\u2264-refl {suc n} = s\u2264s \u2264-refl\n\nfloyd : \u2200 {A : Set} {n m} -&gt; m \u2264 n -&gt; Vec A n -&gt; Vec A m -&gt; List A \u00d7 List A\nfloyd  z\u2264n            xs       []          = [] , toList xs\nfloyd (s\u2264s  z\u2264n)     (x \u2237 xs) (y \u2237 [])     = x \u2237 [] , toList xs\nfloyd (s\u2264s (s\u2264s le)) (x \u2237 xs) (y \u2237 z \u2237 ys) = pmap (x \u2237_) id (floyd (\u2264-step le) xs ys)\n\nsplit : \u2200 {A : Set} -&gt; List A -&gt; List A \u00d7 List A\nsplit xs = floyd \u2264-refl (fromList xs) (fromList xs)\n\nopen import Relation.Binary.PropositionalEquality\n\ntest\u2081 : split (1 \u2237 2 \u2237 3 \u2237 4 \u2237 5 \u2237 []) \u2261 (1 \u2237 2 \u2237 3 \u2237 [] , 4 \u2237 5 \u2237 [])\ntest\u2081 = refl\n\ntest\u2082 : split (1 \u2237 2 \u2237 3 \u2237 4 \u2237 5 \u2237 6 \u2237 []) \u2261 (1 \u2237 2 \u2237 3 \u2237 [] , 4 \u2237 5 \u2237 6 \u2237 [])\ntest\u2082 = refl\n</code></pre>\n\n<p>Also, functions like <code>\u2264-refl</code> and <code>\u2264-step</code> are somewhere in the standard library, but I was lazy to search.</p>\n\n<hr>\n\n<p>Here is a silly thing I <a href=\"https://stackoverflow.com/questions/33345899/how-to-enumerate-the-elements-of-a-list-by-fins-in-linear-time\">like</a> to do:</p>\n\n<pre><code>open import Function\nopen import Data.Nat.Base\nopen import Data.Product renaming (map to pmap)\nopen import Data.List.Base\nopen import Data.Vec hiding (split)\n\nfloyd : \u2200 {A : Set}\n      -&gt; (k : \u2115 -&gt; \u2115)\n      -&gt; (\u2200 {n} -&gt; Vec A (k (suc n)) -&gt; Vec A (suc (k n)))\n      -&gt; \u2200 n\n      -&gt; Vec A (k n)\n      -&gt; List A \u00d7 List A\nfloyd k u  0            xs = [] , toList xs\nfloyd k u  1            xs with u xs\n... | x \u2237 xs' = x \u2237 [] , toList xs'\nfloyd k u (suc (suc n)) xs with u xs\n... | x \u2237 xs' = pmap (x \u2237_) id (floyd (k \u2218 suc) u n xs')\n\nsplit : \u2200 {A : Set} -&gt; List A -&gt; List A \u00d7 List A\nsplit xs = floyd id id (length xs) (fromList xs)\n\nopen import Relation.Binary.PropositionalEquality\n\ntest\u2081 : split (1 \u2237 2 \u2237 3 \u2237 4 \u2237 5 \u2237 []) \u2261 (1 \u2237 2 \u2237 3 \u2237 [] , 4 \u2237 5 \u2237 [])\ntest\u2081 = refl\n\ntest\u2082 : split (1 \u2237 2 \u2237 3 \u2237 4 \u2237 5 \u2237 6 \u2237 []) \u2261 (1 \u2237 2 \u2237 3 \u2237 [] , 4 \u2237 5 \u2237 6 \u2237 [])\ntest\u2082 = refl\n</code></pre>\n\n<p>This is partly based on the <strong>Benjamin Hodgson</strong> suggestion in the comment below.</p>\n"}], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 1, "accepted_answer_id": 35464500, "answer_count": 1, "score": 7, "last_activity_date": 1455736322, "creation_date": 1455731192, "last_edit_date": 1455734043, "question_id": 35464008, "link": "https://stackoverflow.com/questions/35464008/how-to-implement-floyds-hare-and-tortoise-algorithm-in-agda", "title": "How to implement Floyd&#39;s Hare and Tortoise algorithm in Agda?", "body": "<p>I want to translate the following Haskell code into Agda:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Arrow (first)\nimport Control.Monad (join)\n\nsafeTail :: [a] -&gt; [a]\nsafeTail []     = []\nsafeTail (_:xs) = xs\n\nfloyd :: [a] -&gt; [a] -&gt; ([a], [a])\nfloyd xs     []     = ([], xs)\nfloyd (x:xs) (_:ys) = first (x:) $ floyd xs (safeTail ys)\n\nsplit :: [a] -&gt; ([a], [a])\nsplit = join floyd\n</code></pre>\n\n<p>This allows us to efficiently split a list into two:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>split [1,2,3,4,5]   = ([1,2,3], [4,5])\nsplit [1,2,3,4,5,6] = ([1,2,3], [4,5,6])\n</code></pre>\n\n<p>So, I tried to convert this code to Agda:</p>\n\n<pre><code>floyd : {A : Set} \u2192 List A \u2192 List A \u2192 List A \u00d7 List A\nfloyd xs        []        = ([] , xs)\nfloyd (x :: xs) (_ :: ys) = first (x ::_) (floyd xs (safeTail ys))\n</code></pre>\n\n<p>The only problem is that Agda complains that I'm missing the case for <code>floyd [] (y :: ys)</code>. However, this case should never arise. How can I prove to Agda that this case should never arise?</p>\n\n<hr>\n\n<p>Here's a visual example of how this algorithm works:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>+-------------+-------------+\n|   Tortoise  |     Hare    |\n+-------------+-------------+\n| ^ 1 2 3 4 5 | ^ 1 2 3 4 5 |\n| 1 ^ 2 3 4 5 | 1 2 ^ 3 4 5 |\n| 1 2 ^ 3 4 5 | 1 2 3 4 ^ 5 |\n| 1 2 3 ^ 4 5 | 1 2 3 4 5 ^ |\n+-------------+-------------+\n</code></pre>\n\n<p>Here's another example:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>+---------------+---------------+\n|    Tortoise   |      Hare     |\n+---------------+---------------+\n| ^ 1 2 3 4 5 6 | ^ 1 2 3 4 5 6 |\n| 1 ^ 2 3 4 5 6 | 1 2 ^ 3 4 5 6 |\n| 1 2 ^ 3 4 5 6 | 1 2 3 4 ^ 5 6 |\n| 1 2 3 ^ 4 5 6 | 1 2 3 4 5 6 ^ |\n+---------------+---------------+\n</code></pre>\n\n<p>When the hare (the second argument to <code>floyd</code>) reaches the end of the list, the tortoise (the first argument to <code>floyd</code>) reaches the middle of the list. Thus, by using two pointers (the second one moving twice as fast as the first) we can efficiently split a list into two.</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3970496"}, "edited": false, "score": 0, "creation_date": 1455731886, "post_id": 35463950, "comment_id": 58624242, "body": "<a href=\"http://adit.io/posts/2013-06-10-three-useful-monads.html#the-reader-monad\" rel=\"nofollow noreferrer\">adit.io/posts/&hellip;</a> has a nice pictorial explanation of the reader monad."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1455735048, "post_id": 35464119, "comment_id": 58626056, "body": "It&#39;s under a BSD-style license, so it should be safe to copy and paste with attribution."}, {"owner": {"reputation": 1, "user_id": 5941680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/751b8ff03bec22d2ce3975c3893faf62?s=128&d=identicon&r=PG&f=1", "display_name": "umeshu", "link": "https://stackoverflow.com/users/5941680/umeshu"}, "edited": false, "score": 0, "creation_date": 1455782924, "post_id": 35464119, "comment_id": 58646202, "body": "Firstly thanks @Carsten for your answer. My difficulty to understand the type of the local function, streamed out from the type class constraint.  For the bind function, I could easy see that the <code>m</code> is required to be a Monad instance while for the local function, at first I thought the product of <code>r m</code> is required to be a Monad instance. This would be confusing since obviously the kind of <code>r</code> is <code>*</code> and the kind of <code>m</code> is <code>* -&gt; *</code>. Does this means that the declaration of type class constraint can&#39;t be taken as a functional operation?"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 2, "last_activity_date": 1455732386, "last_edit_date": 1455732386, "creation_date": 1455731522, "answer_id": 35464119, "question_id": 35463950, "link": "https://stackoverflow.com/questions/35463950/type-class-constraint-with-multiple-variables/35464119#35464119", "title": "Type class constraint with multiple variables", "body": "<p>In those cases it's best to look at the class (<a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Reader-Class.html#t:MonadReader\" rel=\"nofollow\">MonadReader</a>) here.</p>\n\n<p>There you'll find this:</p>\n\n<pre><code>class Monad m =&gt; MonadReader r m | m -&gt; r where\n</code></pre>\n\n<p>and quite a bit more.</p>\n\n<p>So here <code>m</code> is some monad and <code>r</code> will be the thing you read from (<code>MonadReader</code> is a so called monad-transformer ... well ok not quite - it's the class that is common to all those transformers - <code>ReaderT</code> is the transformer ... but that's really horrible to explain ... sorry)</p>\n\n<p><code>local</code> is used to <em>change</em> the thing you read from (I like to think of it as the configuration or the environment) - the <code>r-&gt;r</code> part - giving you a computation in the monad <code>m</code> that will do this change.</p>\n\n<p>And if you read on in the documentation there is even an example of how to use this:</p>\n\n<pre><code>calculateContentLen :: Reader String Int\ncalculateContentLen = do\n    content &lt;- ask\n    return (length content);\n\n-- Calls calculateContentLen after adding a prefix to the Reader content.\ncalculateModifiedContentLen :: Reader String Int\ncalculateModifiedContentLen = local (\"Prefix \" ++) calculateContentLen\n\nmain = do\n    let s = \"12345\";\n    let modifiedLen = runReader calculateModifiedContentLen s\n    let len = runReader calculateContentLen s\n    putStrLn $ \"Modified 's' length: \" ++ (show modifiedLen)\n    putStrLn $ \"Original 's' length: \" ++ (show len)\n</code></pre>\n\n<p>as you can see <code>local</code> is used here to add <code>\"Prefix \"</code> in front of the string</p>\n\n<p><strong>please note</strong> that the monad <code>m</code> in this example is <strong>not</strong> <code>IO</code> - it's <code>Identity</code> (basically nothing - it has no effect)</p>\n\n<hr>\n\n<p>(I hope it's ok to copy and paste it ... if not please let me know or remove it)</p>\n"}], "owner": {"reputation": 1, "user_id": 5941680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/751b8ff03bec22d2ce3975c3893faf62?s=128&d=identicon&r=PG&f=1", "display_name": "umeshu", "link": "https://stackoverflow.com/users/5941680/umeshu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1455732386, "creation_date": 1455731026, "last_edit_date": 1455731090, "question_id": 35463950, "link": "https://stackoverflow.com/questions/35463950/type-class-constraint-with-multiple-variables", "title": "Type class constraint with multiple variables", "body": "<p>I have a hard time to grasp the following type class constraint of a Monad Reader function, that receive multiple variables,</p>\n\n<pre><code>local :: MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a  \n</code></pre>\n\n<p>How to correctly understand the type class constraint? which one is the type constructor, <code>r</code> or <code>m</code> or both? (from the <code>m a</code> part it suggests the type constructor is <code>m</code>).  </p>\n\n<p>Compared with for example the bind function, where the type class constraint admitted only single parameter;</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b \n</code></pre>\n\n<p>Unlike the local function above, it's obvious and easy to comprehend that the type class constraint for the bind function demand type constructor <code>m</code> to be a Monad instance.    </p>\n"}, {"tags": ["haskell", "haskell-turtle"], "answers": [{"comments": [{"owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "edited": false, "score": 0, "creation_date": 1455776793, "post_id": 35465233, "comment_id": 58643273, "body": "Thank you very much, Zeta! The <code>settingsP</code> approach is excellent."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1455735179, "creation_date": 1455735179, "answer_id": 35465233, "question_id": 35463892, "link": "https://stackoverflow.com/questions/35463892/haskell-turtle-command-line-parser/35465233#35465233", "title": "Haskell: Turtle: command line parser", "body": "<p>Your first step is to have something where you can store and retrieve your options easily:</p>\n\n<pre><code>data Settings = Settings\n   { settingsVerbose      :: Bool\n   , settingsFileTitle    :: Bool\n   , settingsSource       :: FilePath\n   , settingsDestination  :: FilePath\n   }\n</code></pre>\n\n<p>Afterwards, you write parsers for your options. To make things clear, let's be a little bit verbose first:</p>\n\n<pre><code>verboseParser :: Parser Bool\nverboseParser = switch \"verbose\" 'v' \"Be more verbose\"\n\nfileTitleParser :: Parser Bool\nfileTitleParser = switch \"filetitle\" 'f' \"...\"\n\nsourceParser :: Parser FilePath\nsourceParser = argPath \"src\" \"Source directory\"\n\ndestinationParser :: Parser FilePath\ndestinationParser = argPath \"dst\" \"Destination directory\"\n</code></pre>\n\n<p>Since <code>Parser</code> is an instance of <code>Applicative</code> we can then combine all options in a single parser:</p>\n\n<pre><code>settingsParser :: Parser Settings\nsettingsParser = \n    Settings &lt;$&gt; verboseParser\n             &lt;*&gt; fileTitleParser\n             &lt;*&gt; sourceParser\n             &lt;*&gt; destinationParser\n</code></pre>\n\n<p>We've combined all four parsers into a single parser, similar to the combination via <code>(,)</code>. Now we can parse the options with a <strong>single</strong> call to <code>options</code>. After all, either all arguments are correct, or we have to present the user the proper usage:</p>\n\n<pre><code>main = do\n   s &lt;- options \"Description of your program\" settingsParser\n\n   echo (format (\"verbose: \"%w)   (settingsVerbose s))\n   echo (format (\"filetitle: \"%w) (settingsFileTitle s))\n   echo (format (\"src: \"%fp)      (settingsSource s))\n   echo (format (\"dst: \"%fp)      (settingsDestination s))\n</code></pre>\n\n<p>You probably want to use shorter names, though, and maybe write the parsers in <code>settingsParser</code>:</p>\n\n<pre><code>data Settings = Settings\n   { sVerbose     :: Bool\n   , sFileTitle   :: Bool\n   , sSource      :: FilePath\n   , sDestination :: FilePath\n   }\n\nsettingsP :: Parser Settings\nsettingsP = \n  Settings &lt;$&gt; switch \"verbose\"   'v' \"Be more verbose\"\n           &lt;*&gt; switch \"filetitle\" 'f' \"...\"\n           &lt;*&gt; argPath \"src\" \"Source directory\"\n           &lt;*&gt; argPath \"dest\" \"Destination directory\"\n\ndescription :: Description\ndescription = \"Description of your program\"\n\nmain = do\n  (Settings verbose filetitle source dest) &lt;- options description settingsP\n  ...\n</code></pre>\n"}], "owner": {"reputation": 1584, "user_id": 1134071, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/DicCu.jpg?s=128&g=1", "display_name": "Alexey Orlov", "link": "https://stackoverflow.com/users/1134071/alexey-orlov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 0, "accepted_answer_id": 35465233, "answer_count": 1, "score": 3, "last_activity_date": 1455735179, "creation_date": 1455730856, "question_id": 35463892, "link": "https://stackoverflow.com/questions/35463892/haskell-turtle-command-line-parser", "title": "Haskell: Turtle: command line parser", "body": "<p>I've been trying to build a command line parser with Turtle, nothing fancy: <a href=\"https://github.com/Tyrn/go-procr\" rel=\"nofollow\">https://github.com/Tyrn/go-procr</a></p>\n\n<pre><code>#!/usr/bin/env stack\n{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Turtle\nimport Prelude hiding (FilePath)\n\nparserSwitch :: Parser (Bool, Bool)\nparserSwitch = (,) &lt;$&gt; switch \"verbose\" 'v' \"Unless verbose, just progress bar is shown\"\n                   &lt;*&gt; switch \"filetitle\" 'f' \"Use file name for title tag\"\n\nparserArg :: Parser (FilePath, FilePath)\nparserArg = (,)    &lt;$&gt; argPath \"src\" \"Source directory\"\n                   &lt;*&gt; argPath \"dst\" \"Destination directory\"\n\nmain :: IO ()\nmain = do\n  (verbose, filetitle) &lt;- options \"Flags\" parserSwitch\n  echo (format (\"verbose: \"%w) verbose)\n  echo (format (\"filetitle: \"%w) filetitle)\n  (src, dst) &lt;- options \"Args\" parserArg\n  echo (format (\"src: \"%fp) src)\n  echo (format (\"dst: \"%fp) dst)\n</code></pre>\n\n<p>There are three kinds of arguments required: boolean flags; options, text and integer; positional arguments. So far I got stuck at boolean flags and positional arguments. Unfortunately, the examples seem to be too basic even for this.</p>\n\n<ol>\n<li><p>Do I really have to build separate parsers for different kinds of options (I did not manage to satisfy syntax with a single parser)?</p></li>\n<li><p>It won't work as expected, anyway.</p></li>\n</ol>\n\n<p>I can't figure out what my next step should be.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1455732717, "post_id": 35463720, "comment_id": 58624694, "body": "Not to put too fine a point on it, but the point here is that <code>x</code> (and not <code>getLine</code>!) is the thing which lazy evaluation allows you to avoid evaluating. You can verify this by executing <code>do { x &lt;- return (error &quot;oh, I guess x was evaluated after all&quot;); putStrLn &quot;nah, x wasn&#39;t evaluated&quot; }</code> in ghci. (You can know <code>x</code> isn&#39;t evaluated because you can see it isn&#39;t mentioned inside the lambda body; but you can&#39;t know <code>getLine</code> isn&#39;t evaluated unless you are privy to the implementation of <code>&gt;&gt;=</code>.)"}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1455734244, "post_id": 35463720, "comment_id": 58625568, "body": "@DanielWagner So, is there some internal definition for <code>&gt;&gt;=</code> in the IO monad that forces evaluation of the actions in both sides? I tried to find this implementation but couldn&#39;t. Where can I see it?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 1, "creation_date": 1455735350, "post_id": 35463720, "comment_id": 58626231, "body": "@mljrg <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/src/GHC.Base.html#bindIO\" rel=\"nofollow noreferrer\">There is indeed.</a> Beware: deep magic!"}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1455736250, "post_id": 35463720, "comment_id": 58626764, "body": "@DanielWagner Ok, I know it&#39;s using the State monad, but I suspect that the <code>ccall</code> construct is always executed, irrespective if its value is used or not in a subsequent action. Or .. or ... that <code>(World, a)</code> that every IO action returns and consumes is forcing all IO actions that involve side-effects to be executed irrespective if their values <code>a</code> are being subsequently used or not (Just guessing)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1455737223, "post_id": 35463720, "comment_id": 58627414, "body": "@mljrg It isn&#39;t using the standard <code>State</code> monad, but it is using something similar. You are correct that there&#39;s a piece in the runtime system that has to cooperate with the apparently (but appearances are deceptive) pure-Haskell implementation; this is commonly described by separating &quot;execution&quot; from &quot;evaluation&quot;, as I think you are doing."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1455745319, "post_id": 35463720, "comment_id": 58632273, "body": "@DanielWagner Can you give a reference where the topic separating &quot;execution&quot; from &quot;evaluation&quot; is well explained in clear way?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1455752986, "post_id": 35463720, "comment_id": 58635682, "body": "@mljrg No, I don&#39;t. =("}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 4, "last_activity_date": 1455747490, "last_edit_date": 1455747490, "creation_date": 1455730354, "answer_id": 35463720, "question_id": 35463578, "link": "https://stackoverflow.com/questions/35463578/why-is-getline-being-evaluated-when-its-value-is-not-required/35463720#35463720", "title": "Why is getLine being evaluated when its value is not required?", "body": "<p>Its result is being used, just not in the way you necessarily expect.  This de-sugars to</p>\n\n<pre><code>fa = getLine &gt;&gt;= (\\x -&gt; return \"hello\")\n</code></pre>\n\n<p>So the result of <code>getLine</code> is still passed to the function <code>\\x -&gt; return \"hello\"</code>.  Monads are inherently about sequencing actions together (among other things); that sequencing still occurs even if results are later not used.  If that weren't the case, then</p>\n\n<pre><code>main = do\n    print \"Hello\"\n    print \"World\"\n</code></pre>\n\n<p>wouldn't do anything as a program, since the results of both calls to <code>print</code> aren't being used.</p>\n"}, {"comments": [{"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1455794257, "post_id": 35463971, "comment_id": 58653539, "body": "This answer is incomplete; see that of @MathematicalOrchid."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1455745407, "last_edit_date": 1455745407, "creation_date": 1455731091, "answer_id": 35463971, "question_id": 35463578, "link": "https://stackoverflow.com/questions/35463578/why-is-getline-being-evaluated-when-its-value-is-not-required/35463971#35463971", "title": "Why is getLine being evaluated when its value is not required?", "body": "<p>Congratulations, you've just discovered why Haskell is a pure functional language!</p>\n\n<p>The result<sup>&dagger;</sup> of <code>getLine</code> is <em>not</em> a string. It's an IO action which happens to &ldquo;produce&rdquo; a string. That string is indeed not evaluated, but the action itself is (since it turns up in a <code>do</code> block bound to <code>main</code>), and this is all that matters as far as side-effects are concerned.</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>Really just the <em>value</em> of <code>getLine</code>. This is not a function, so it doesn't actually have a result.</sub></p>\n"}, {"comments": [{"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1455791958, "post_id": 35477579, "comment_id": 58651999, "body": "Thanks for your answer, but I have two questions to make. First, when you desugar <code>foobar &gt;&gt;= (\\ x -&gt; return &quot;hello&quot;)</code> it desugars to <code>... Just x -&gt; return &quot;hello&quot;</code> isn&#39;t it? Second, I am not afraid of &quot;deep magic&quot;, so, can you show to me such magic behind the implementation of <code>&gt;&gt;=</code> in the IO monad, so that we can close this Stackoverflow question in a complete and useful way for others to come? Thanks."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1455792194, "post_id": 35477579, "comment_id": 58652203, "body": "Yes, it&#39;s <code>Just x -&gt; return &quot;hello&quot;</code>. And then, from the definition of <code>return</code> we get <code>Just x -&gt; Just &quot;hello&quot;</code>."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1455792243, "post_id": 35477579, "comment_id": 58652231, "body": "My point is, this effect is nothing to do with the magical low-level implementation of I/O (which varies between GHC versions); it&#39;s common to <i>most</i> monads, including <code>Maybe</code>."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1455794022, "post_id": 35477579, "comment_id": 58653382, "body": "You said &quot;the magical low-level implementation of I/O (which varies between GHC versions)&quot;. I hope the case if for an improved implementation across successive versions, keeping the same behavior ..."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1455794099, "post_id": 35477579, "comment_id": 58653426, "body": "The <i>behavior</i> of the <code>IO</code> monad is specified in the Haskell Report, and does not change. The <i>implementation</i> is not specified at all, and can be whatever GHC (or any other compiler) wants it to be."}, {"owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "edited": false, "score": 0, "creation_date": 1455794404, "post_id": 35477579, "comment_id": 58653637, "body": "I will read the Haskell Report one day (lack of time now). Know I am going through Real World Haskell, and despite being an old book, there&#39;s still lots to learn. Thanks for your clear answer."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 2, "last_activity_date": 1455792259, "last_edit_date": 1455792259, "creation_date": 1455787956, "answer_id": 35477579, "question_id": 35463578, "link": "https://stackoverflow.com/questions/35463578/why-is-getline-being-evaluated-when-its-value-is-not-required/35477579#35477579", "title": "Why is getLine being evaluated when its value is not required?", "body": "<p>Be careful now... ;-)</p>\n\n<p>The result of <code>getLine</code> isn't a string, it's an \"I/O command object\", if you will. The code actually desugars to</p>\n\n<pre><code>getLine &gt;&gt;= (\\ x -&gt; return \"hello\")\n</code></pre>\n\n<p>The <code>&gt;&gt;=</code> operator constructs a new I/O command object out of an existing one and a function... OK, that's a bit much to wrap your mind around. The important thing is, the I/O action gets executed (because of the implementation of <code>&gt;&gt;=</code> for <code>IO</code>), but its result doesn't necessarily get evaluated (because of laziness).</p>\n\n<p>So let's look at the implementation of the <code>IO</code> monad... erm, actually you know what? Let's <em>not</em>. (It's deep magic, hard-wired into the compiler, and as such it's implementation-specific.) But this phenomenon isn't unique to <code>IO</code> by any means. Let's look at the <code>Maybe</code> monad:</p>\n\n<pre><code>instance Monad Maybe where\n  mx &gt;&gt;= f =\n    case mx of\n      Nothing -&gt; Nothing\n      Just  x -&gt; f x\n\n  return x = Just x\n</code></pre>\n\n<p>So if I do something like</p>\n\n<pre><code>do\n  x &lt;- foobar\n  return \"hello\"\n</code></pre>\n\n<p>Will <code>x</code> get evaluated? Let's look. It desugars to:</p>\n\n<pre><code>foobar &gt;&gt;= (\\ x -&gt; return \"hello\")\n</code></pre>\n\n<p>then this becomes</p>\n\n<pre><code>case foobar of\n  Nothing -&gt; Nothing\n  Just  x -&gt; Just \"hello\"\n</code></pre>\n\n<p>As you can see, <code>foobar</code> is clearly going to be evaluated, because we need to know whether the result is <code>Nothing</code> or <code>Just</code>. But the actual <code>x</code> <em>won't</em> be evaluated, because nothing looks at it.</p>\n\n<p>It's kind of the same way that <code>length</code> evaluates the list nodes, but not the list elements they point to.</p>\n"}], "owner": {"reputation": 3485, "user_id": 1483503, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/652348761699d4193e073409caa287d6?s=128&d=identicon&r=PG", "display_name": "mljrg", "link": "https://stackoverflow.com/users/1483503/mljrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 35477579, "answer_count": 3, "score": 0, "last_activity_date": 1455792259, "creation_date": 1455729932, "question_id": 35463578, "link": "https://stackoverflow.com/questions/35463578/why-is-getline-being-evaluated-when-its-value-is-not-required", "title": "Why is getLine being evaluated when its value is not required?", "body": "<p>If Haskell is lazy, why does <code>getLine</code> is evaluated in both of the following cases? Being lazy I would expect that in the case of <code>fa</code> the <code>getLine</code> would not be evaluated because its result is not being used subsequently:</p>\n\n<pre><code>let fa = do {\n  x &lt;- getLine;\n  return \"hello\"\n}\n\nlet fb = do {\n  x &lt;- getLine;\n  return $ x\n}\n</code></pre>\n\n<p>(I tested both cases in GHCi)</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "tree"], "comments": [{"owner": {"reputation": 11669, "user_id": 76123, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c933fbb8685a083234fe385df8e9025f?s=128&d=identicon&r=PG", "display_name": "Daniel Pratt", "link": "https://stackoverflow.com/users/76123/daniel-pratt"}, "edited": false, "score": 0, "creation_date": 1455715829, "post_id": 35458015, "comment_id": 58612442, "body": "Is this helpful? <a href=\"https://www.haskell.org/hoogle/?hoogle=Monoid+a+%3D%3E+t+a+-%3E+%5Ba%5D\" rel=\"nofollow noreferrer\">haskell.org/hoogle/?hoogle=Monoid+a+%3D%3E+t+a+-%3E+%5Ba%5D</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1455715831, "post_id": 35458015, "comment_id": 58612444, "body": "flatten is <code>Data.Foldable.toList</code>"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1455716621, "post_id": 35458015, "comment_id": 58612986, "body": "Data.Tree.flatten is no good: <a href=\"http://ideone.com/CvvBHe\" rel=\"nofollow noreferrer\">ideone.com/CvvBHe</a>"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1455716865, "post_id": 35458015, "comment_id": 58613167, "body": "Neither is toList: <a href=\"http://ideone.com/qgK3RU\" rel=\"nofollow noreferrer\">ideone.com/qgK3RU</a> . Both don&#39;t include the uptree elements."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1455718418, "post_id": 35458015, "comment_id": 58614367, "body": "What would you want the result of <code>f (Tree 1 [Tree 2 []])</code> to be?"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 1, "creation_date": 1455718705, "post_id": 35458015, "comment_id": 58614587, "body": "Well f ( Tree (Sum 1) [Tree (Sum 2) []] ) should be [1,3]"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1455719515, "post_id": 35458015, "comment_id": 58615239, "body": "Oh, sorry, I missed the part about <code>a</code> being Monoid and just looked at <code>f</code>&#39;s signature. Nevermind then."}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1455722804, "post_id": 35459438, "comment_id": 58617836, "body": "Well of course you can do that, but you need to pattern match on the constructor at some point. I.e. flatten is specific to the Tree data type and is not expressible via folds and traverses alone. It&#39;s a new operation. Now the question is, can Tree/flatten be generalized into some <i>nice</i> type class?"}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 3, "last_activity_date": 1455719740, "last_edit_date": 1455719740, "creation_date": 1455719314, "answer_id": 35459438, "question_id": 35458015, "link": "https://stackoverflow.com/questions/35458015/what-abstraction-exactly-is-a-tree-traversal-combining-nodes-to-the-root/35459438#35459438", "title": "What abstraction exactly is a &quot;tree traversal&quot; combining nodes to the root?", "body": "<p>In terms of abstractions, if you generalize the tree type to any <em>foldable container</em> (not just lists),\n<a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Foldable.html#v:concatMap\" rel=\"nofollow\"><code>concatMap</code></a>, <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Monoid.html#t:Monoid\" rel=\"nofollow\"><code>Monoid</code></a>, <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Foldable.html\" rel=\"nofollow\"><code>Foldable</code></a> would apply:</p>\n\n<pre><code>import Prelude hiding (concatMap)\nimport Control.Applicative ((&lt;$&gt;))\nimport Data.Foldable (Foldable, concatMap)\nimport Data.Monoid (Monoid, mappend, mconcat)\n\ndata Tree a f = Tree a (f (Tree a f))\n\nflatten :: (Monoid a, Foldable t) =&gt; Tree a t -&gt; [a]\nflatten (Tree r tr) = r: (mappend r &lt;$&gt; concatMap flatten tr)\n</code></pre>\n\n<p>then</p>\n\n<pre><code>\\&gt; let tr = Tree \"a\" [Tree \"b\" [], Tree \"c\" [Tree \"d\" []]]\n\\&gt; flatten tr\n[\"a\",\"ab\",\"ac\",\"acd\"]\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 1, "accepted_answer_id": 35459438, "answer_count": 1, "score": 3, "last_activity_date": 1455719740, "creation_date": 1455715603, "last_edit_date": 1455716915, "question_id": 35458015, "link": "https://stackoverflow.com/questions/35458015/what-abstraction-exactly-is-a-tree-traversal-combining-nodes-to-the-root", "title": "What abstraction exactly is a &quot;tree traversal&quot; combining nodes to the root?", "body": "<p><a href=\"https://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Tree.html\" rel=\"nofollow\"><code>Data.Tree</code></a> has a <code>Tree a</code> data type which is basically as:</p>\n\n<pre><code>Tree a = Tree a [Tree a]\n</code></pre>\n\n<p>(not exactly but that's the basic idea)</p>\n\n<p>This structure (almost) looks very nice for a filesystem style tree.</p>\n\n<p>Lets say I've got this structure, and I want to make a function of type: </p>\n\n<pre><code>f :: Tree a -&gt; [a]\n</code></pre>\n\n<p>Which basically does the following:</p>\n\n<pre><code>f (Tree \"a\" [Tree \"b\" [], Tree \"c\" [Tree \"d\" []]] \n  == [\"a\", \"ab\", \"ac\", \"acd\"]\n</code></pre>\n\n<p>now I'm not asking how to code this up, indeed it's fairly trivial to do. But the data type <code>Tree</code> is an instance of <code>Foldable</code>, <code>Traversable</code>, <code>Monad</code>, etc.</p>\n\n<p>Could I implement <code>f</code> in terms of folds, maps, etc? Or is there some other abstraction that <code>f</code> is similar too? I'm happy for you to assume that <code>a</code> is a <code>Monoid</code> if that helps. </p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1455709183, "post_id": 35455614, "comment_id": 58607754, "body": "Start a new <code>do</code> block after <code>in</code>."}, {"owner": {"reputation": 30926, "user_id": 767890, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e169a8a6d170a77b83dd8244df5f6890?s=128&d=identicon&r=PG", "display_name": "InBetween", "link": "https://stackoverflow.com/users/767890/inbetween"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1455709987, "post_id": 35455614, "comment_id": 58608296, "body": "@Jubobs duh...(facepalm) Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "is_accepted": false, "score": 5, "last_activity_date": 1455709851, "creation_date": 1455709851, "answer_id": 35455931, "question_id": 35455614, "link": "https://stackoverflow.com/questions/35455614/chaining-actions-sharing-data-in-a-do-block/35455931#35455931", "title": "Chaining actions sharing data in a do block", "body": "<p>Just remove the curly braces and use a plain <code>let</code>:</p>\n\n<pre><code>main = do\n   bytes &lt;- loadFile \"....\"\n   let d = processData bytes\n   printf (extractFoo d address1)\n   printf (extractFoo d address2)\n</code></pre>\n\n<p>I renamed your <code>data</code> to <code>d</code> since <code>data</code> is a keyword in Haskell.</p>\n"}], "owner": {"reputation": 30926, "user_id": 767890, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e169a8a6d170a77b83dd8244df5f6890?s=128&d=identicon&r=PG", "display_name": "InBetween", "link": "https://stackoverflow.com/users/767890/inbetween"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1455709851, "creation_date": 1455709009, "question_id": 35455614, "link": "https://stackoverflow.com/questions/35455614/chaining-actions-sharing-data-in-a-do-block", "title": "Chaining actions sharing data in a do block", "body": "<p>Ok, suppose I have an <code>IO</code> operation; <code>loadFile :: FilePath -&gt; ByteString</code> which I process with <code>processData :: ByteString -&gt; ProcessedData</code> being this operation pretty expesnive and I want to use this processed data in two actions like so:</p>\n\n<pre><code>main = do\n{\n   bytes &lt;- loadFile \"....\";\n   let data = processData bytes\n   in printf (extractFoo data address1)\n      printf (extractFoo data address2) -- Compiler error    \n}\n</code></pre>\n\n<p>I know I can do this, which is basically not sharing <code>data</code> between both actions:</p>\n\n<pre><code>main = do\n{\n   bytes &lt;- loadFile \"....\";\n   let data = processData bytes\n   in printf (extractFoo data address1);\n   let data = processData bytes\n   in printf (extractFoo data address2);    \n}\n</code></pre>\n\n<p>How can I share <code>data</code> in both <code>printf</code>? I'm very new to Haskell and I am struggling with the IO monad. I'm trying to understand it but its a slow process up till now.</p>\n"}, {"tags": ["sockets", "http", "haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1455712243, "post_id": 35455468, "comment_id": 58609879, "body": "I think you are talking about berkeley sockets. An example client for that <a href=\"https://github.com/jaspervdj/websockets/blob/master/example/client.hs\" rel=\"nofollow noreferrer\">github.com/jaspervdj/websockets/blob/master/example/client.h&zwnj;&#8203;s</a> is available through the websockets package."}], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 2, "last_activity_date": 1455709070, "creation_date": 1455709070, "answer_id": 35455642, "question_id": 35455468, "link": "https://stackoverflow.com/questions/35455468/connecting-to-a-local-http-socket-in-haskell/35455642#35455642", "title": "Connecting to a local HTTP socket in Haskell", "body": "<p>I think it is possible with <a href=\"http://hackage.haskell.org/package/http-client\" rel=\"nofollow\">http-client</a>. You should <a href=\"http://hackage.haskell.org/package/http-client-0.4.27/docs/Network-HTTP-Client.html#v:newManager\" rel=\"nofollow\">create</a> <code>Manager</code> with <a href=\"http://hackage.haskell.org/package/http-client-0.4.27/docs/Network-HTTP-Client.html#v:managerRawConnection\" rel=\"nofollow\">custom hook</a> to make a connection.</p>\n"}, {"tags": [], "owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "is_accepted": false, "score": 0, "last_activity_date": 1455716547, "creation_date": 1455716547, "answer_id": 35458368, "question_id": 35455468, "link": "https://stackoverflow.com/questions/35455468/connecting-to-a-local-http-socket-in-haskell/35458368#35458368", "title": "Connecting to a local HTTP socket in Haskell", "body": "<p>Another, perhaps more primitive option is to use second-transfer, there is a functional <a href=\"https://hackage.haskell.org/package/second-transfer-0.10.0.1/docs/SecondTransfer-Http1-Proxy.html#v:ioProxyToConnection\" rel=\"nofollow\">HTTP/1.1 request-maker</a> inside:</p>\n\n<pre><code>...\nimport Data.Conduit\nimport SecondTransfer.Http1.Proxy  (ioProxyToConnection)\nimport SecondTransfer.Http1.Types\nimport Control.Lens\n\nmain = \n  do\n    ...\n    -- Somehow get a socket from the networking package, i.e, with type \n    -- Network.Socket.Socket . AF_UNIX sockets are OK, and then wrap it \n    -- in a set of I/O callbacks:\n    io_callbacks &lt;- handshake =&lt;&lt; socketIOCallbacks my_socket\n\n    -- Puts and receives the data for the http request, get the results. Only needs the  \n    -- headers that will be sent over the tube, and the streaming contents\n    -- with request data.\n    let \n        request :: HttpResponse IO\n        request = HttpRequest [(\"host\", \n                               \"http://127.0.0.1:8080\"), \n                          ...]\n                          (yield \"\")\n\n    -- Perform the request, get the response.\n    response &lt;- ioProxyToConnection io_callbacks request\n\n    -- Use the lens interface to access the headers:\n    putStrLn . show $ response ^. headers_Rp\n\n    -- You can consume a streaming response using response ^. body_Rp\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 4075387, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-A3PHcDX-Zlk/AAAAAAAAAAI/AAAAAAAAAKU/rsxiG8UMdQY/photo.jpg?sz=128", "display_name": "Richard Fergie", "link": "https://stackoverflow.com/users/4075387/richard-fergie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1455716547, "creation_date": 1455708577, "question_id": 35455468, "link": "https://stackoverflow.com/questions/35455468/connecting-to-a-local-http-socket-in-haskell", "title": "Connecting to a local HTTP socket in Haskell", "body": "<p>What is the best way to connect to a local socket in Haskell?</p>\n\n<p>Once the connection is made HTTP is used to communicate (I want to connect to the local Docker socket)</p>\n\n<p>wreq and http-client seem to deal only with URLs rather than sockets.</p>\n\n<p>On the command line I can use <code>curl --unix-socket /var/run/docker.sock http:/containers/json</code> but I can't find the equivalent of <code>--unix-socket</code> in the curl package on hackage.</p>\n"}, {"tags": ["haskell", "cabal", "gloss"], "comments": [{"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1455709046, "post_id": 35454991, "comment_id": 58607645, "body": "&quot;Very basic&quot; Haskell program don&#39;t involve Graphics :) Did you executed <code>cabal update</code> to get the latest index of packages? Did you add the dependency <code>gloss</code> to your .cabal file? Where did you get the error message, I guess from an editor? Did you execute <code>cabal install --only-denepdencies</code> and by doing so install all the dependencies into the sandbox or globally? You may read <a href=\"https://www.haskell.org/cabal/users-guide/\" rel=\"nofollow noreferrer\">the manual</a> again for detailed explanation."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1455723765, "post_id": 35454991, "comment_id": 58618599, "body": "Please show the line you used to install gloss.  Please show what you typed and the full error message that you showed us a fragment of.  Without these we are stuck in mind-reader mode."}], "answers": [{"tags": [], "owner": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "is_accepted": false, "score": 1, "last_activity_date": 1455738450, "creation_date": 1455738450, "answer_id": 35466302, "question_id": 35454991, "link": "https://stackoverflow.com/questions/35454991/how-do-i-get-cabal-gloss-working-on-ios-el-capitan/35466302#35466302", "title": "How do I get cabal gloss working on IOS el Capitan?", "body": "<p>The first steps on this website shows you, how you can run Haskell program with gloss <a href=\"http://andrew.gibiansky.com/blog/haskell/haskell-gloss/\" rel=\"nofollow\">http://andrew.gibiansky.com/blog/haskell/haskell-gloss/</a></p>\n"}], "owner": {"reputation": 11, "user_id": 5940039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/429de689f0a60788300797fda00a7af0?s=128&d=identicon&r=PG&f=1", "display_name": "Abbe Hjelm", "link": "https://stackoverflow.com/users/5940039/abbe-hjelm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1455738450, "creation_date": 1455707391, "last_edit_date": 1455709066, "question_id": 35454991, "link": "https://stackoverflow.com/questions/35454991/how-do-i-get-cabal-gloss-working-on-ios-el-capitan", "title": "How do I get cabal gloss working on IOS el Capitan?", "body": "<p>After I installed cabal and try to run my (very basic) haskell code in which include import Graphics.Gloss</p>\n\n<p>I get an error message <code>Could not find module \u2018Graphics.Gloss\u2019</code>.\n Can\u00b4t figure out why as I seem to have installed it the correct way...</p>\n\n<p>Can anyone help me in this!!</p>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1455708432, "post_id": 35454935, "comment_id": 58607230, "body": "Could you please post a self-contained example? I didn&#39;t see where the <code>Queue</code> type came from. Is it a TBMQueue?"}, {"owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1455712899, "post_id": 35454935, "comment_id": 58610357, "body": "It can be an amqp queue or it can be a kafka partition. I don&#39;t think it matters that much, but I will update my question with one of these examples."}], "answers": [{"comments": [{"owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "edited": false, "score": 1, "creation_date": 1455714455, "post_id": 35456829, "comment_id": 58611468, "body": "Wouldn&#39;t it still wait for all the sources to emit before producing a next value? For example, if queue &quot;a&quot; has 1000msg/sec and &quot;b&quot; has 1msg/sec I still want the result source to emit 1000 &quot;a&quot; and 1 &quot;b&quot; and so on"}, {"owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "reply_to_user": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "edited": false, "score": 0, "creation_date": 1455717295, "post_id": 35456829, "comment_id": 58613500, "body": "In that case, yes this would not be applicable because it would only produce output once all <code>Source</code>s have produced a value. I suggest you read the answers to <a href=\"http://stackoverflow.com/questions/15594556/fusing-conduits-with-multiple-inputs\">this question</a>, which seems to be the same problem as you are having. Note it does look like it something that conduit is not well suited to."}], "tags": [], "owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "is_accepted": false, "score": 4, "last_activity_date": 1455712332, "creation_date": 1455712332, "answer_id": 35456829, "question_id": 35454935, "link": "https://stackoverflow.com/questions/35454935/merge-conduits-into-one/35456829#35456829", "title": "Merge conduits into one", "body": "<p>Have a look at <a href=\"https://hackage.haskell.org/package/conduit-1.2.6.2/docs/Data-Conduit.html#g:15\" rel=\"nofollow\"><code>ZipSource</code></a>, which is a newtype wrapper whose <code>Applicative</code> lets you combine <code>Source</code>s in the way that you want. </p>\n\n<p>Once you have a <code>ZipSource</code>, you can use <a href=\"https://hackage.haskell.org/package/conduit-1.2.6.2/docs/Data-Conduit.html#v:sequenceSources\" rel=\"nofollow\"><code>zipSources</code></a> to combine the <code>Source</code>s in a <code>Traversable</code> (e.g. a list) into a <code>Source</code> of <code>Traversable</code>s.</p>\n\n<p>The only difference to your desired result type is that it is a <code>Source</code> over a <code>Traversable</code> of values, rather than just a single value, but that shouldn't be much of an issue.</p>\n"}, {"comments": [{"owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "edited": false, "score": 0, "creation_date": 1455939140, "post_id": 35457978, "comment_id": 58727887, "body": "This is pretty much what I am currently using, but there is an interesting edge case here. Say, I only want to take 3 elements from the result stream so I use <code>=$= take 3</code> combinator. After that my stream is finished and my resources (connection, channel) are disposed. But since the actual sources are asynchronous they have no idea about it and still try to consume more messages and put them into the <code>TMChan</code>. And when they do that I get an exception. Any idea how this can be handled?"}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "reply_to_user": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "edited": false, "score": 0, "creation_date": 1455942236, "post_id": 35457978, "comment_id": 58728432, "body": "@AlexeyRaga I don&#39;t think it&#39;s possible to deal with that edge case with functionality of <code>stm-conduit</code> alone. A the intermediate channel created by <code>mergeSources</code> is only closed when all the upstream sources are closed. You may have to pack some finalization code into your source I guess. I once thought methods in <a href=\"http://stackoverflow.com/questions/35141939/how-to-exit-a-conduit-when-using-mergesources/35153141#35153141\">another question</a> will work but I now doubt if it really works."}], "tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 1, "last_activity_date": 1455716096, "last_edit_date": 1455716096, "creation_date": 1455715469, "answer_id": 35457978, "question_id": 35454935, "link": "https://stackoverflow.com/questions/35454935/merge-conduits-into-one/35457978#35457978", "title": "Merge conduits into one", "body": "<p><code>mergeSources</code> in <code>stm-conduit</code> maintains a <code>TBMChannel</code> behind the scene. All your Sources / Producers are first connected to the <code>TBMChannel</code>, then it will create a single Source that try pulling values out from the channel FIFO. </p>\n\n<p>You can set the bound of the intermediate <code>TBMChannel</code> when using <code>mergeSources</code>. Say you set the bound to n, then the first n values produced by all the Sources will be dumped to the <code>TBMChannel</code> and the <code>AmqpConn</code> immediately, assuming it's not blocked at the <code>AmqpConn</code> end, and your consumer is slower than the sources (BTW <code>AmqpConn</code> uses unbounded <code>Control.Concurrent.Chan</code> so it won't block). After that the TBMChannel is full so anymore Sources trying to yield a value to the channel is blocked. Your consumer takes value one by one out of the combined source so it's sequential after the first n elements. </p>\n\n<p>To make sure it's sequential from the beginning you can set the bound to 1, however it may cause some performance issues.</p>\n"}], "owner": {"reputation": 7207, "user_id": 338846, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/f1871f7b7f5b4b39d59b72dfbe42b8f5?s=128&d=identicon&r=PG", "display_name": "Alexey Raga", "link": "https://stackoverflow.com/users/338846/alexey-raga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 1, "accepted_answer_id": 35457978, "answer_count": 2, "score": 4, "last_activity_date": 1466011669, "creation_date": 1455707226, "last_edit_date": 1455715162, "question_id": 35454935, "link": "https://stackoverflow.com/questions/35454935/merge-conduits-into-one", "title": "Merge conduits into one", "body": "<p>I am looking for a function that can do something similar to:</p>\n\n<pre><code>merge :: MonadIO m =&gt; [Producer m a] -&gt; Producer m a\n</code></pre>\n\n<p>I had a quick look at <code>stm-conduit</code>, it looks similar but I am not sure if it fits  my requirements:</p>\n\n<pre><code>messagesSource :: MonadIO m =&gt; AmqpConn -&gt; Ack -&gt; Text -&gt; Producer m (Message, Envelope)\nmessagesSource conn ack q = loop\n  where\n    loop = do\n      mmsg &lt;- liftIO $ getMsg chan ack q\n      case mmsg of\n        Just (m, e) -&gt; do\n          yield (m, e)\n          liftIO $ ackMsg chan (envDeliveryTag e) False\n          loop\n        Nothing     -&gt; loop\n    chan = fst $ amqpChan conn\n</code></pre>\n\n<p>As you can see, this conduit producer acks a message after yielding it. In a simple \"single-threaded\" pipeline it works well, the message makes its way to the sink and is then acked.</p>\n\n<p>However with <code>stm-conduit</code> this may change because, as far as I can understand, the producer would not wait for the message to be consumed by the sink, they would work in parallel instead and the message could be acked prematurely.</p>\n\n<p>Is my understanding of <code>stm-conduit</code> correct?<br>\nAnd what would be the way to merge separate sources into one to have a nice single-stream semantics?</p>\n\n<p><strong>UPDATE</strong>: Updated code to a real working AMQP example as requested (however it may be a bit noisier).</p>\n\n<p><strong>UPDATE 2</strong>: I think what I am after could be an Alternative instance for conduit sources so I could do something like <code>let src = src1 &lt;|&gt; src2</code>. Is it possible somehow?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 1, "creation_date": 1455696487, "post_id": 35450713, "comment_id": 58598913, "body": "Try remove everything and install stack only. If you have homebrew run <code>brew install haskell-stack</code> and <code>stack setup</code> will install everything including ghc and cabal for you."}, {"owner": {"reputation": 3799, "user_id": 1196339, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d8e9205169decaeecd9827dd2f40c6cb?s=128&d=identicon&r=PG", "display_name": "nackjicholson", "link": "https://stackoverflow.com/users/1196339/nackjicholson"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1455697785, "post_id": 35450713, "comment_id": 58599658, "body": "I didn&#39;t install via brew, I installed via the manual download. Apparently the version of stack in that package is <code>0.1.0.2</code> which is super old, and this bug is very dated. I don&#39;t know why the .org downloads page installs an ancient version of the tool, but my fix ended up being to download stack manually from here: <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/install_and_upgrade.md\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/blob/master/doc/&hellip;</a> and then once I downloaded the zip I ran <code>mv ~&#47;Downloads&#47;stack-1.0.2-osx-x86_64&#47;stack &#47;Applications&#47;ghc-7.10.2.app&#47;Contents&#47;bin&#47;stack</code> to put the updated stack in place of the old one. Seems to work!"}, {"owner": {"reputation": 3799, "user_id": 1196339, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d8e9205169decaeecd9827dd2f40c6cb?s=128&d=identicon&r=PG", "display_name": "nackjicholson", "link": "https://stackoverflow.com/users/1196339/nackjicholson"}, "reply_to_user": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1455699844, "post_id": 35450713, "comment_id": 58600900, "body": "The old version is actually <code>0.1.2.0</code>, typo"}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1455700807, "post_id": 35450713, "comment_id": 58601558, "body": "The homepage of other languages are usually maintained by compiler team and / or big companies, while the homepage of haskell is maintained by volunteers. So almost everything on www.haskell.org is outdated. They still recommend MinGHC for installation on windows but if you click the link you will see <b>&quot;MinGHC is dead. Please use Stack.&quot;</b> in bold and big font. You&#39;d better stick with the community for latest news (by community I mean /r/haskell, haskell-cafe and here)."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1455703734, "post_id": 35450713, "comment_id": 58603802, "body": "@nackjicholson can you add your comment as an answer? (maybe including what zakyggaps said)?"}], "answers": [{"tags": [], "owner": {"reputation": 3799, "user_id": 1196339, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d8e9205169decaeecd9827dd2f40c6cb?s=128&d=identicon&r=PG", "display_name": "nackjicholson", "link": "https://stackoverflow.com/users/1196339/nackjicholson"}, "is_accepted": true, "score": 1, "last_activity_date": 1455753882, "creation_date": 1455753882, "answer_id": 35470264, "question_id": 35450713, "link": "https://stackoverflow.com/questions/35450713/haskell-stack-resolver-error-just-trying-to-run-ghci/35470264#35470264", "title": "Haskell Stack Resolver error just trying to run ghci", "body": "<p>Apparently the version of stack in that package is 0.1.2.0 which is super old, and this bug is very dated. I don't know why the .org downloads page installs an ancient version of the tool, but my fix ended up being to download stack manually from here: <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/install_and_upgrade.md\" rel=\"nofollow\">https://github.com/commercialhaskell/stack/blob/master/doc/install_and_upgrade.md</a> and then once I downloaded the zip I ran </p>\n\n<pre><code>mv ~/Downloads/stack-1.0.2-osx-x86_64/stack /Applications/ghc-7.10.2.app/Contents/bin/stack\n</code></pre>\n\n<p>That command puts the updated stack in place of the old one and things then seem to work!</p>\n\n<p>As a note: Learning more about installing haskell, it seems everyone suggests that you never install haskell via haskell.org but instead install stack on it's own and use it to install haskell.</p>\n"}], "owner": {"reputation": 3799, "user_id": 1196339, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d8e9205169decaeecd9827dd2f40c6cb?s=128&d=identicon&r=PG", "display_name": "nackjicholson", "link": "https://stackoverflow.com/users/1196339/nackjicholson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 560, "favorite_count": 0, "accepted_answer_id": 35470264, "answer_count": 1, "score": 0, "last_activity_date": 1602795685, "creation_date": 1455695321, "last_edit_date": 1602795685, "question_id": 35450713, "link": "https://stackoverflow.com/questions/35450713/haskell-stack-resolver-error-just-trying-to-run-ghci", "title": "Haskell Stack Resolver error just trying to run ghci", "body": "<p>I'm a haskell newcomer, I've tried googling, IRC, and doing what the CLI tells me to do, but can't seem to get basic haskell ecosystem tools to play nice.</p>\n<p>I installed ghc, stack, and cabal via the minimal installers OSX link on this page <a href=\"https://www.haskell.org/downloads\" rel=\"nofollow noreferrer\">https://www.haskell.org/downloads</a> and now I'm running into some strange resolver problems while trying to get started with stack. I run <code>stack ghci</code> it tells me that it wants 7.10.3 and to run <code>stack setup</code>. Setup then says it installed ghc@7.10.2. Any help would be much appreciated, thank you!</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1455690715, "post_id": 35449353, "comment_id": 58596105, "body": "I think this is a good question and the answer would be interesting to me as well - I know: the caption is asking for an tutorial and that is technically no ok on SO - on the other hand SO is often extremely unfriendly so I feel that Haskell has it&#39;s own kind of nicer community ;) - in this case: a example would IMO be a valuable addition for further reference (so I am voting for reopen) -- I really wish moderators (not active on the subtopic) would wait a bit before force-closing questions (if it will turn out in spam <b>then</b> close it please)"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1455701939, "post_id": 35449353, "comment_id": 58602379, "body": "@Carsten: Missing documentation/examples is a deficit of the library or program and should be filed as an issue there instead. I think this question is <i>too broad</i>, by the way, since the expected parsing result and other specifications are missing. Also, if you think that a question should be on-topic and was closed by a moderator in error, make sure to post on <a href=\"https://meta.stackoverflow.com\">Meta Stack Overflow</a>, not in a comment (but feel free to link to the meta-discussion in a comment)."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1455702373, "post_id": 35449353, "comment_id": 58602722, "body": "@Zeta I rarely step into that ant nest (MSO) - I just thought that I should somehow explain my vote to reopen"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1455707569, "post_id": 35449353, "comment_id": 58606606, "body": "The edit still doesn&#39;t state what the result of the parser should be. Should it translate back to regular Haskell code (which probably isn&#39;t feasible), just checked for syntactic correctness, parsed into some kind of user defined ADT?"}, {"owner": {"reputation": 588, "user_id": 3804671, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/48b73e1e5ecec13d1edb985bfd90cf71?s=128&d=identicon&r=PG&f=1", "display_name": "ankitrokdeonsns", "link": "https://stackoverflow.com/users/3804671/ankitrokdeonsns"}, "edited": false, "score": 0, "creation_date": 1455716522, "post_id": 35449353, "comment_id": 58612910, "body": "Assuming we are writing a parser in haskell, the result would be a data structure which will represent all possible execution paths of the program.  In this particular case it will be some sort of tree which of height one with one branch for true and the other one for false"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1455726034, "post_id": 35449353, "comment_id": 58620394, "body": "<code>-ddump-simpl</code> output is designed for human consumption rather than machine consumption (yes, I know it&#39;s still not that easy to read!) I would suggest getting your hands on the Core through the GHC API instead."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1455819335, "post_id": 35449353, "comment_id": 58671667, "body": "I&#39;m pretty sure this exact same question was asked some time ago and the &quot;final answer&quot; was: currently there&#39;s no way to parse it."}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1456058185, "post_id": 35536189, "comment_id": 58760948, "body": "Note that the code as given will create <code>.hi</code> and <code>.o</code> files. You can probably change the <code>dflags</code> to omit that."}, {"owner": {"reputation": 588, "user_id": 3804671, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/48b73e1e5ecec13d1edb985bfd90cf71?s=128&d=identicon&r=PG&f=1", "display_name": "ankitrokdeonsns", "link": "https://stackoverflow.com/users/3804671/ankitrokdeonsns"}, "edited": false, "score": 0, "creation_date": 1456376606, "post_id": 35536189, "comment_id": 58920238, "body": "This example is quite useful. @Cactus can you share a couple of links from where I can learn more about GHC core library?"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 2, "last_activity_date": 1456058104, "creation_date": 1456058104, "answer_id": 35536189, "question_id": 35449353, "link": "https://stackoverflow.com/questions/35449353/how-can-i-parse-ghc-core/35536189#35536189", "title": "How can I parse GHC core?", "body": "<p>I think the easiest way is to forego these external Core libraries and just use GHC as a library directly. Based on <a href=\"https://wiki.haskell.org/GHC/As_a_library\" rel=\"nofollow\">this example from the Haskell wiki</a>, we can make a simple function that turns a module into Core:</p>\n\n<pre><code>import GHC\nimport GHC.Paths (libdir)\nimport HscTypes (mg_binds)\nimport CoreSyn\nimport DynFlags\nimport Control.Monad ((&lt;=&lt;))\n\ncompileToCore :: String -&gt; IO [CoreBind]\ncompileToCore modName = runGhc (Just libdir) $ do\n    setSessionDynFlags =&lt;&lt; getSessionDynFlags\n    target &lt;- guessTarget (modName ++ \".hs\") Nothing\n    setTargets [target]\n    load LoadAllTargets\n    ds &lt;- desugarModule &lt;=&lt; typecheckModule &lt;=&lt; parseModule &lt;=&lt; getModSummary $ mkModuleName modName\n    return $ mg_binds . coreModule $ ds\n</code></pre>\n\n<p>Here's a silly example usage that processes its output to count the number of cases:</p>\n\n<pre><code>-- Silly example function that analyzes Core\ncountCases :: [CoreBind] -&gt; Int\ncountCases = sum . map countBind\n  where\n    countBind (NonRec _ e) = countExpr e\n    countBind (Rec bs) = sum . map (countExpr . snd) $ bs\n\n    countExpr (Case e _ _ alts) = countExpr e + sum (map countAlt alts)\n    countExpr (App f e) = countExpr f + countExpr e\n    countExpr (Lam _ e) = countExpr e\n    countExpr (Let b e) = countBind b + countExpr e\n    countExpr (Cast e _) = countExpr e\n    countExpr (Tick _ e) = countExpr e\n    countExpr _ = 0\n\n    countAlt (_, _, rhs) = 1 + countExpr rhs\n</code></pre>\n\n<p>Let's run it on your example:</p>\n\n<pre><code>main :: IO ()\nmain = do\n   core &lt;- compileToCore \"MyNot\"\n   print $ countCases core\n</code></pre>\n\n<p>This outputs 2, as expected.</p>\n"}], "owner": {"reputation": 588, "user_id": 3804671, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/48b73e1e5ecec13d1edb985bfd90cf71?s=128&d=identicon&r=PG&f=1", "display_name": "ankitrokdeonsns", "link": "https://stackoverflow.com/users/3804671/ankitrokdeonsns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1456058123, "creation_date": 1455690261, "last_edit_date": 1456058123, "question_id": 35449353, "link": "https://stackoverflow.com/questions/35449353/how-can-i-parse-ghc-core", "title": "How can I parse GHC core?", "body": "<p>I am trying to parse ghc core code obtained from running <code>ghc -c -ddump-simpl myfile.hs</code>.</p>\n\n<p>I know <a href=\"https://hackage.haskell.org/package/extcore\" rel=\"nofollow\"><code>extcore</code></a> and <a href=\"https://hackage.haskell.org/package/core\" rel=\"nofollow\"><code>core</code></a> libraries are my options.</p>\n\n<p>I am looking for a simple example depicting the use of these libraries.</p>\n\n<p>[EDIT] Parsing result should be a data structure from which it should be easy to trace different paths a function can take.</p>\n\n<p>Consider a simple <code>not</code> function</p>\n\n<pre><code>not True = False\nnot False = True\n</code></pre>\n\n<p>GHC will turn this into case expressions (consider output from <code>ghc -c -ddump-simple</code> only). I am looking to parse this output of GHC core.</p>\n"}, {"tags": ["haskell", "generics", "ghc-generics"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 3, "last_activity_date": 1455695343, "last_edit_date": 1455695343, "creation_date": 1455674490, "answer_id": 35446578, "question_id": 35445676, "link": "https://stackoverflow.com/questions/35445676/how-to-create-a-mk-instance-for-ghc-generics-u1/35446578#35446578", "title": "How to create a Mk instance for GHC.Generics.U1?", "body": "<p>Since <code>U1</code> has no structure, you should be able to <code>mk</code> one out of thin air in <code>Identity</code>:</p>\n\n<pre><code>import Control.Monad.Identity\n\ninstance Mk U1 Identity where\n    mk = pure U1\n</code></pre>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1455695343, "creation_date": 1455668803, "last_edit_date": 1495540765, "question_id": 35445676, "link": "https://stackoverflow.com/questions/35445676/how-to-create-a-mk-instance-for-ghc-generics-u1", "title": "How to create a Mk instance for GHC.Generics.U1?", "body": "<p>I'm working through content at the blog posting <a href=\"https://ocharles.org.uk/blog/posts/2014-04-26-constructing-generically.html\" rel=\"nofollow noreferrer\">Building data constructors with GHC Generics</a>. My previous question is <a href=\"https://stackoverflow.com/questions/35419297/understanding-how-to-construct-ghc-generics-reps-and-convert-back-to-values\">here</a>. </p>\n\n<p>The posting has the following code to create a <code>Rep</code>:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FunctionalDependencies #-}\n{-# LANGUAGE FlexibleInstances, UndecidableInstances #-}\n{-# LANGUAGE TypeOperators #-}\n\nimport GHC.Generics\nimport Data.Functor.Compose\n\nclass Functor f =&gt; Mk rep f | rep -&gt; f where\n  mk :: f (rep a)\n\ninstance Mk (K1 i c) ((-&gt;) c) where\n  mk = \\x -&gt; K1 x\n\ninstance (Mk l fl, Mk r fr) =&gt; Mk (l :*: r) (Compose fl fr) where\n  mk = Compose (fmap (\\l -&gt; fmap (\\r -&gt; l :*: r) mk) mk)\n\ninstance (Mk f f') =&gt; Mk (M1 i c f) f' where\n  mk = M1 &lt;$&gt; mk\n</code></pre>\n\n<p>Is it possible to create a similar instance for <code>U1</code>? If so, how?</p>\n"}, {"tags": ["api", "rest", "haskell", "asynchronous", "message-queue"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1455662053, "post_id": 35443453, "comment_id": 58586791, "body": "See the async package"}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1455687113, "post_id": 35443453, "comment_id": 58594666, "body": "Sweet, that looks really close. Can you help me understand how I would use it to match the data found by a global subscriber to what&#39;s going on in the request function?"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1455659506, "creation_date": 1455658480, "last_edit_date": 1455659506, "question_id": 35443453, "link": "https://stackoverflow.com/questions/35443453/respond-to-a-web-request-with-outside-event", "title": "Respond to a web request with outside event", "body": "<p>I have a route in my API which kicks off a job to a message queue (I'm using the <a href=\"https://hackage.haskell.org/package/amqp\" rel=\"nofollow\">AMQP</a> package). I would like to leave the connection open and respond to the web request when the job finishes. </p>\n\n<p>With AMQP, I have no way of knowing when a job I started will finish. Instead, I can subscribe to a channel that will report when a job finishes. </p>\n\n<p>Here's some pseudo-code: </p>\n\n<pre><code>main = do\n  doneChannel = openAMQPChannel \"done\"\n\n  -- assume some other program subscribes to jobs, performs them\n  -- and puts them onto \"done\" when finished. \n  jobsChannel = openAMQPChannel \"jobs\"\n  forkIO $ subscribeAMQP doneChannel onDone\n  startServer\n\nonDone jobId info = do\n  -- How can I return this info in my request?\n  -- assume it has unique identifying information\n  ???\n\nstartServer jobs = do\n  Warp.run 8000 $ do\n    post \"/jobs\" $ \\payload -&gt; do\n      jobId &lt;- generateUniqueId\n      publishAMQP jobs jobId payload\n\n      -- TODO wait until onDone happens for my particular request\n      info &lt;- waitForJobToComplete jobId\n      return info\n</code></pre>\n\n<p>(See <a href=\"https://hackage.haskell.org/package/amqp-0.13.0/docs/Network-AMQP.html\" rel=\"nofollow\">here</a> for the real AMQP interface. I'm using <a href=\"http://hackage.haskell.org/package/servant-server\" rel=\"nofollow\">Servant</a> for routing)</p>\n\n<p>Is there some way to do this with <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Control-Concurrent\" rel=\"nofollow\"><code>Control.Concurrent</code></a>? <code>MVar</code> and <code>Chan</code> don't seem to be addressable by an ID like this. How could I implement it in such a way that I could handle thousands of requests at once?</p>\n\n<p>Any other ideas? </p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 3, "creation_date": 1455656215, "post_id": 35442783, "comment_id": 58583553, "body": "You are asking what exactly? Does your function not work as you expect?"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 1, "creation_date": 1455657135, "post_id": 35442783, "comment_id": 58584127, "body": "Does <code>plusplus = flip (foldr (:))</code> work for you?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 1, "creation_date": 1455657187, "post_id": 35442783, "comment_id": 58584156, "body": "@AaditMShah good one - but I think this would miss the <i>exercise recursion</i> part of the problem ;)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1455658145, "post_id": 35442783, "comment_id": 58584720, "body": "@Carsten, moreover, it misses the important role of <code>augment</code> in list fusion!"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 5, "last_activity_date": 1455657430, "last_edit_date": 1455657430, "creation_date": 1455656594, "answer_id": 35442915, "question_id": 35442783, "link": "https://stackoverflow.com/questions/35442783/how-to-recursively-define-my-own-haskell-function-for-appending-two-lists/35442915#35442915", "title": "How to recursively define my own haskell function for appending two lists?", "body": "<p>ok basically the only problem you have here is a missing case:</p>\n\n<pre><code>pluspluse (x:xs) [] = ...\n</code></pre>\n\n<p>is missing (and will cause an error)</p>\n\n<p>but you can clean up quite a bit:</p>\n\n<p>The first two cases are basically the same: whatever the second input is will be the result - so you can just it those a name (say <code>ys</code>) and write:</p>\n\n<pre><code>plusplus [] ys = ys\n</code></pre>\n\n<p>(can you see how this includes your first two cases? - what is <code>ys</code> in those?)</p>\n\n<hr>\n\n<p>your 3rd line one will be covered by the correct last case (see below) - to see this remember that <code>[x] == x:[]</code></p>\n\n<hr>\n\n<p>I'll give you the complete answer in a few minutes - but you should try to figure it out:</p>\n\n<pre><code>plusplus :: [Int] -&gt; [Int] -&gt; [Int]\nplusplus [] ys = ys\nplusplus (x:xs) ? = ??\n</code></pre>\n\n<p>try to find the correct things to replace <code>?</code> and <code>??</code> with</p>\n\n<hr>\n\n<p>you almost had it - and the answer can be:</p>\n\n<pre><code>plusplus :: [Int] -&gt; [Int] -&gt; [Int]\nplusplus [] ys = ys\nplusplus (x:xs) ys = x: plusplus xs ys\n</code></pre>\n\n<p>as you can see you never have to <em>touch</em> the second list - but need to recreate all of the first list (to link to the second)</p>\n"}, {"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1455657505, "post_id": 35443145, "comment_id": 58584328, "body": "exactly - as I said: you almost had it ;)"}], "tags": [], "owner": {"reputation": 65, "user_id": 5576579, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4fdea2d0d89bbcf62837f2404f91389a?s=128&d=identicon&r=PG&f=1", "display_name": "andy", "link": "https://stackoverflow.com/users/5576579/andy"}, "is_accepted": false, "score": 1, "last_activity_date": 1455657481, "last_edit_date": 1455657481, "creation_date": 1455657401, "answer_id": 35443145, "question_id": 35442783, "link": "https://stackoverflow.com/questions/35442783/how-to-recursively-define-my-own-haskell-function-for-appending-two-lists/35443145#35443145", "title": "How to recursively define my own haskell function for appending two lists?", "body": "<p>Thanks guys! With the help of Carsten spotting my silly mistake. </p>\n\n<pre><code>plusplus :: [Int] -&gt; [Int] -&gt; [Int]\nplusplus [] [] = []\nplusplus (x:xs) [] = x:xs\nplusplus [] (x:xs) = x:xs\nplusplus (x:xs) (y:ys) = x: plusplus xs (y:ys)\n</code></pre>\n\n<p>This works.\nSo for input: </p>\n\n<pre><code>plusplus [1,2,3] [4,5,6]\n</code></pre>\n\n<p>Output is: </p>\n\n<pre><code>[1,2,3,4,5,6]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1455658696, "post_id": 35443366, "comment_id": 58585004, "body": "to be honest I see this as a <i>proof</i>  that <code>flip (foldr (:)) = plusplus</code> if I read it bottom to top (which is of course symmetric) - I just <i>believe</i> that the last definition is closer (the same?) to what you would define list comprehension to be (inductively) - but hey nice explanation"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1455670676, "post_id": 35443366, "comment_id": 58589829, "body": "@Carsten That&#39;s because <code>foldr</code> is the <a href=\"http://www.dipmat.unict.it/~barba/LinguaggiII.html/READING_MATERIAL/RecursionAndInduction.HTM\" rel=\"nofollow noreferrer\">recursion principle</a> for lists."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1455685472, "post_id": 35443366, "comment_id": 58594085, "body": "... you should say <a href=\"https://en.wikipedia.org/wiki/Catamorphism\" rel=\"nofollow noreferrer\">Catamorphism</a> - it sounds way more intimidating ;)"}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 2, "last_activity_date": 1455658124, "creation_date": 1455658124, "answer_id": 35443366, "question_id": 35442783, "link": "https://stackoverflow.com/questions/35442783/how-to-recursively-define-my-own-haskell-function-for-appending-two-lists/35443366#35443366", "title": "How to recursively define my own haskell function for appending two lists?", "body": "<p>We know that <code>plusplus = flip (foldr (:))</code>. Here's the definition of <code>foldr</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldr step = let fold acc []     = acc\n                 fold acc (x:xs) = step x (fold acc xs)\n             in  fold\n</code></pre>\n\n<p>On specializing, we get:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foldr     :: (a -&gt;  b  -&gt;  b)  -&gt;  b  -&gt; [a] -&gt;  b\n              |     |      |       |      |      |\n              |     |      |       |      |      |\n      (:) :: (a -&gt; [a] -&gt; [a])     |      |      |\n                                   |      |      |\nfoldr (:) ::                      [a] -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>Here's the definition of the specialized function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>fold :: [a] -&gt; [a] -&gt; [a]\nfold acc []     = acc\nfold acc (x:xs) = x : fold acc xs\n</code></pre>\n\n<p>Ofcourse, we need to <code>flip</code> the arguments:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>plusplus :: [a] -&gt; [a] -&gt; [a]\nplusplus []     ys = ys\nplusplus (x:xs) ys = x : plusplus xs ys\n</code></pre>\n\n<p>That's the reason why <code>plusplus</code> is defined the way it is.</p>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 1, "last_activity_date": 1455686658, "creation_date": 1455686658, "answer_id": 35448565, "question_id": 35442783, "link": "https://stackoverflow.com/questions/35442783/how-to-recursively-define-my-own-haskell-function-for-appending-two-lists/35448565#35448565", "title": "How to recursively define my own haskell function for appending two lists?", "body": "<p>This is really a riff on Carsten's answer, but I think it's worth going into and won't fit into a comment.  One of the keys to avoiding non-exhaustive pattern errors in function definitions is to approach writing functions in a more mechanical, formulaic manner.  The definition of the list type is something like this:</p>\n\n<pre><code>data [a] = [] | a : [a]\n</code></pre>\n\n<p>So list types have two data constructors, <code>[]</code> and <code>:</code>.  So a good first thing to try when starting your function is to write two equations, one for each of the constructors.  Carsten's template (which I'm mostly copying now) is following that pattern:</p>\n\n<pre><code>plusplus :: [Int] -&gt; [Int] -&gt; [Int]\nplusplus []     ys = _                -- Equation for empty list\nplusplus (x:xs) ys = _                -- Equation for list cells\n</code></pre>\n\n<p>Now since we've written one pattern for each of the constructors of the type, we're now <em>guaranteed</em> that our patterns are exhaustive.  So we stare at what we got a bit, and now we see the solution:</p>\n\n<pre><code>plusplus :: [Int] -&gt; [Int] -&gt; [Int]\nplusplus []     ys = ys\nplusplus (x:xs) ys = x : plusplus xs ys\n</code></pre>\n\n<p>Let's try another one!  Signature:</p>\n\n<pre><code>-- | Merge two lists by alternating elements of one with the\n-- other.  After either list runs out, just continue with the\n-- remaining elements of the other.\ninterleave :: [a] -&gt; [a] -&gt; [a]\ninterleave xs ys = _\n</code></pre>\n\n<p>Let's expand this to two equations by splitting the <code>xs</code> variable according to the two constructors, and fill in the easy parts on the right hand side:</p>\n\n<pre><code>interleave :: [a] -&gt; [a] -&gt; [a]\ninterleave [] ys     = ys       -- this one was easy\ninterleave (x:xs) ys = x : _    -- we know it has to start with `x`\n</code></pre>\n\n<p>Now we can go two ways.  The first one is we could take the second equation and split it into two cases for <code>ys</code>:</p>\n\n<pre><code>interleave :: [a] -&gt; [a] -&gt; [a]\ninterleave []     ys     = ys\ninterleave (x:xs) []     = x : _\ninterleave (x:xs) (y:ys) = x : _\n</code></pre>\n\n<p>And filling in those blanks is easy:</p>\n\n<pre><code>interleave :: [a] -&gt; [a] -&gt; [a]\ninterleave []     ys     = ys\ninterleave (x:xs) []     = x : xs\ninterleave (x:xs) (y:ys) = x : y : interleave xs ys\n</code></pre>\n\n<p>The second way is, instead of splitting <code>ys</code> on the constructors' cases, to notice that this works:</p>\n\n<pre><code>interleave :: [a] -&gt; [a] -&gt; [a]\ninterleave []     ys = ys\ninterleave (x:xs) ys = x : interleave ys xs\n</code></pre>\n\n<p>So by going about it systematically based on the constructors we know for sure that all combinations are covered.</p>\n"}], "owner": {"reputation": 65, "user_id": 5576579, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4fdea2d0d89bbcf62837f2404f91389a?s=128&d=identicon&r=PG&f=1", "display_name": "andy", "link": "https://stackoverflow.com/users/5576579/andy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1208, "favorite_count": 0, "accepted_answer_id": 35442915, "answer_count": 4, "score": 1, "last_activity_date": 1455686658, "creation_date": 1455656114, "last_edit_date": 1455674541, "question_id": 35442783, "link": "https://stackoverflow.com/questions/35442783/how-to-recursively-define-my-own-haskell-function-for-appending-two-lists", "title": "How to recursively define my own haskell function for appending two lists?", "body": "<p>How would I define an append function that takes two lists and output 1 list. </p>\n\n<p>So <code>plusplus [1,2,3] [4,5,6]</code> should return <code>[1,2,3,4,5,6]</code>. </p>\n\n<p>I have the following so far:</p>\n\n<pre><code>plusplus :: [Int] -&gt; [Int] -&gt; [Int]\nplusplus [] [] = []\nplusplus [] [x] = [x]\nplusplus [x] [] = [x]\nplusplus (x:xs) (y:ys) = x: plusplus xs (y:ys)\n</code></pre>\n\n<p>I want to define my own <code>++</code> function, but with recursion. The code above gives an error when I actually execute it with two lists. </p>\n\n<p>This is an example of an error I get with the command: </p>\n\n<pre><code>plusplus [1,2,3] [4,5,6] \n[1,2,3*** Exception: baby.hs:(...): Non-exhaustive patterns in function plusplus\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1455655637, "post_id": 35442568, "comment_id": 58583212, "body": "Isn&#39;t that essentially the same as <a href=\"https://projecteuler.net/problem=14\" rel=\"nofollow noreferrer\">Project Euler 14</a>? In this case, you might be interested <a href=\"http://stackoverflow.com/q/22416292/1139697\">in one of my older answers</a>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1455655652, "post_id": 35442568, "comment_id": 58583220, "body": "This problem is why I wrote <a href=\"https://hackage.haskell.org/package/data-memocombinators\" rel=\"nofollow noreferrer\"><code>data-memocombinators</code></a>.   If you only memoize the cycle length function for inputs below a threshold (e.g. using <code>arrayRange</code>) it works very well."}, {"owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "edited": false, "score": 4, "creation_date": 1455659864, "post_id": 35442568, "comment_id": 58585664, "body": "Perhaps sharing your code will enable us to help you more effectively."}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 4513188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/609cd019a4304cc8d0bbb4b0fc6f4076?s=128&d=identicon&r=PG&f=1", "display_name": "haskell looks great", "link": "https://stackoverflow.com/users/4513188/haskell-looks-great"}, "edited": false, "score": 0, "creation_date": 1460700227, "post_id": 35444856, "comment_id": 60873161, "body": "Thanks for the answer. But I have tried submit your code (both version), SPOJ won&#39;t accept it, though..."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 113, "user_id": 4513188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/609cd019a4304cc8d0bbb4b0fc6f4076?s=128&d=identicon&r=PG&f=1", "display_name": "haskell looks great", "link": "https://stackoverflow.com/users/4513188/haskell-looks-great"}, "edited": false, "score": 0, "creation_date": 1460702549, "post_id": 35444856, "comment_id": 60874236, "body": "@haskelllooksgreat i just checked that the code i have posted on pastebin <a href=\"http://pastie.org/pastes/10726632/text\" rel=\"nofollow noreferrer\">(here)</a> does in fact get accepted by spoj"}, {"owner": {"reputation": 113, "user_id": 4513188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/609cd019a4304cc8d0bbb4b0fc6f4076?s=128&d=identicon&r=PG&f=1", "display_name": "haskell looks great", "link": "https://stackoverflow.com/users/4513188/haskell-looks-great"}, "edited": false, "score": 0, "creation_date": 1460722140, "post_id": 35444856, "comment_id": 60886760, "body": "I re-submitted a second time, and it indeed got accepted (resulting in 0.42 second runtime)!"}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 4, "last_activity_date": 1455759568, "last_edit_date": 1455759568, "creation_date": 1455664341, "answer_id": 35444856, "question_id": 35442568, "link": "https://stackoverflow.com/questions/35442568/haskell-ways-to-the-3n1-challenge/35444856#35444856", "title": "Haskell ways to the 3n+1 challenge", "body": "<p><strong>>>></strong> using the approach bellow, I could <a href=\"http://www.spoj.com/ranks/PROBTRES/lang=HASK\" rel=\"nofollow\">submit an accepted answer to SPOJ</a>. You may check the entire code from <a href=\"http://pastie.org/10726632\" rel=\"nofollow\">here</a>.</p>\n\n<hr>\n\n<p>The problem has bounds <code>0 &lt; n &lt; 1,000,000</code>. Pre-calculate <em>all</em> of them and store them inside an array; then <em>freeze</em> the array. The array can be used as <em>its own cache / memoization space</em>.</p>\n\n<p>The problem would then reduce to a <em>range query problem</em> over an array, which can be done very efficiently using trees.</p>\n\n<p>With the code bellow I can get Collatz of <code>1..1,000,000</code> in a fraction of a second:</p>\n\n<pre class=\"lang-bsh prettyprint-override\"><code>$ time echo 1000000 | ./collatz \n525\n\nreal    0m0.177s\nuser    0m0.173s\nsys     0m0.003s\n</code></pre>\n\n<p>Note that <code>collatz</code> function below, uses mutable <code>STUArray</code> internally, but itself is a pure function:</p>\n\n<pre><code>import Control.Monad.ST (ST)\nimport Control.Monad (mapM_)\nimport Control.Applicative ((&lt;$&gt;))\nimport Data.Array.Unboxed (UArray, elems)\nimport Data.Array.ST (STUArray, readArray, writeArray, runSTUArray, newArray)\n\ncollatz :: Int -&gt; UArray Int Int\ncollatz size = out\n    where\n    next i = if odd i then 3 * i + 1 else i `div` 2\n\n    loop :: STUArray s Int Int -&gt; Int -&gt; ST s Int\n    loop arr k\n        | size &lt; k  = succ &lt;$&gt; loop arr (next k)\n        | otherwise = do\n            out &lt;- readArray arr k\n            if out /= 0 then return out\n            else do\n                out &lt;- succ &lt;$&gt; loop arr (next k)\n                writeArray arr k out\n                return out\n\n    out = runSTUArray $ do\n        arr &lt;- newArray (1, size) 0\n        writeArray arr 1 1\n        mapM_ (loop arr) [2..size]\n        return arr\n\nmain = do\n    size &lt;- read &lt;$&gt; getLine\n    print . maximum . elems $ collatz size\n</code></pre>\n\n<p>In order to perform range queries on this array, you may build a balanced tree as simple as below:</p>\n\n<pre><code>type Range = (Int, Int)\ndata Tree  = Leaf Int | Node Tree Tree Range Int\n\nbuild_tree :: Int -&gt; Tree\nbuild_tree size = loop 1 cnt\n    where\n    ctz = collatz size\n    cnt = head . dropWhile (&lt; size) $ iterate (*2) 1\n\n    (Leaf a)       +: (Leaf b)       = max a b\n    (Node _ _ _ a) +: (Node _ _ _ b) = max a b\n\n    loop lo hi\n        | lo == hi  = Leaf $ if size &lt; lo then minBound else ctz ! lo\n        | otherwise = Node left right (lo, hi) (left +: right)\n        where\n        i = (lo + hi) `div` 2\n        left  = loop lo i\n        right = loop (i + 1) hi\n\nquery_tree :: Tree -&gt; Int -&gt; Int -&gt; Int\nquery_tree (Leaf x) _ _ = x\nquery_tree (Node l r (lo, hi) x) i j\n    | i &lt;= lo &amp;&amp; hi &lt;= j = x\n    | mid &lt; i       = query_tree r i j\n    | j   &lt; 1 + mid = query_tree l i j\n    | otherwise     = max (query_tree l i j) (query_tree r i j)\n    where mid = (lo + hi) `div` 2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 2, "last_activity_date": 1455690517, "last_edit_date": 1455690517, "creation_date": 1455690056, "answer_id": 35449306, "question_id": 35442568, "link": "https://stackoverflow.com/questions/35442568/haskell-ways-to-the-3n1-challenge/35449306#35449306", "title": "Haskell ways to the 3n+1 challenge", "body": "<p>Here is the same as in the other answer, but with an immutable recursively defined array (and it also leaks slightly (can someone say why?) and so two times slower):</p>\n\n<pre><code>import Data.Array\n\nupper = 10^6\n\nstep :: Integer -&gt; Int\nstep i = 1 + colAt (if odd i then 3 * i + 1 else i `div` 2)\n\ncolAt :: Integer -&gt; Int\ncolAt i | i &gt; upper = step i\ncolAt i = col!i\n\ncol :: Array Integer Int\ncol = array (1, upper) $ (1, 1) : [(i, step i) | i &lt;- [2..upper]]\n\nmain = print $ maximum $ elems col\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 4513188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/609cd019a4304cc8d0bbb4b0fc6f4076?s=128&d=identicon&r=PG&f=1", "display_name": "haskell looks great", "link": "https://stackoverflow.com/users/4513188/haskell-looks-great"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1455759568, "creation_date": 1455655338, "last_edit_date": 1495541959, "question_id": 35442568, "link": "https://stackoverflow.com/questions/35442568/haskell-ways-to-the-3n1-challenge", "title": "Haskell ways to the 3n+1 challenge", "body": "<p>Here is a simple programming problem from SPOJ: <a href=\"http://www.spoj.com/problems/PROBTRES/\" rel=\"nofollow noreferrer\">http://www.spoj.com/problems/PROBTRES/</a>.</p>\n\n<p>Basically, you are asked to output the biggest Collatz cycle for numbers between i and j. (Collatz cycle of a number $n$ is the number of steps to eventually get from $n$ to 1.)</p>\n\n<p>I have been looking for a Haskell way to solve the problem with comparative performance than that of Java or C++ (so as to fits in the allowed run-time limit). Although a simple Java solution that memoizes the cycle length of any already computed cycles will work. I haven't been successful at applying the idea to obtain a Haskell solution.</p>\n\n<p>I have tried the Data.Function.Memoize, as well as home-brewed log time memoization technique using the idea from this post: <a href=\"https://stackoverflow.com/questions/3208258/memoization-in-haskell\">Memoization in Haskell?</a>. Unfortunately, memoization actually makes the computation of cycle(n) even slower. I believe the slow down comes from the overhead of haskell way. (I tried running with the compiled binary code, instead of interpreting.)</p>\n\n<p>I also suspect that simply iterating numbers from i to j can be costly ($i,j\\le10^6$). So I even tried precompute everything for the range query, using idea from <a href=\"http://blog.openendings.net/2013/10/range-trees-and-profiling-in-haskell.html\" rel=\"nofollow noreferrer\">http://blog.openendings.net/2013/10/range-trees-and-profiling-in-haskell.html</a>. However, this still gives \"Time Limit Exceeding\" error. </p>\n\n<p>Can you help to inform a neat competitive Haskell program for this?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "recursion", "pattern-matching", "pattern-synonyms"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1455674739, "post_id": 35439671, "comment_id": 58591000, "body": "Author of <code>PatternSynonyms</code> here: this is a good point and worth opening a ticket for. This might not be easy to implement, though, because, if I remember right, GHC doesn&#39;t expose much information about &quot;why&quot; something ends up in the set of free variables."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1455655386, "post_id": 35442201, "comment_id": 58583048, "body": "Well, I didn&#39;t suggest that plain bidirectional pattern synonyms should get allowed to be recursive. Only with view patterns can this make sense; but then it could allow some nice applications indeed."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1455656065, "post_id": 35442201, "comment_id": 58583454, "body": "Well <code>L</code> is a recursive pattern synonym and needs to be rejected, so it matches the title of your question. I agree that when the recursion goes through a function, it might be okay."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 5, "last_activity_date": 1455653907, "creation_date": 1455653907, "answer_id": 35442201, "question_id": 35439671, "link": "https://stackoverflow.com/questions/35439671/why-are-all-recursive-pattern-synonyms-rejected/35442201#35442201", "title": "Why are all recursive pattern synonyms rejected?", "body": "<p>Some recursive patterns are problematic, like</p>\n\n<pre><code>f :: [()] -&gt; Bool\nf L = True\nf _ = False\n\npattern L &lt;- () : L\n</code></pre>\n\n<p>What is this supposed to desugar to?</p>\n\n<p>Patterns aren't first-class values. They are just replaced with their definitions where they appear. For such a language, recursive definitions are not generally sensible.</p>\n"}], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1455656530, "creation_date": 1455645126, "last_edit_date": 1455656530, "question_id": 35439671, "link": "https://stackoverflow.com/questions/35439671/why-are-all-recursive-pattern-synonyms-rejected", "title": "Why are all recursive pattern synonyms rejected?", "body": "<pre><code>{-# LANGUAGE PatternSynonyms, ViewPatterns #-}\n\ndata Quun = Foo | Bar | Oink Quun\n\nfooey :: Quun -&gt; Bool\nfooey Foo = True\nfooey (Oink Yum) = True\nfooey _ = False\n\npattern Yum &lt;- (fooey -&gt; True)\n</code></pre>\n\n<p>This doesn't compile (at least in GHC-7.10.2)</p>\n\n<pre><code>/tmp/wtmpf-file10227.hs:1:1:\n    Recursive pattern synonym definition with following bindings:\n      foo (defined at /tmp/wtmpf-file10227.hs:(6,1)-(8,13))\n      Yum (defined at /tmp/wtmpf-file10227.hs:10:1-28)\n</code></pre>\n\n<p>Sure, for simple directly self-referring patterns this would make sense. But is there some fundamental reason why even a view-pattern mediated layout as above isn't possible? I can't find this convincing; after all it's possible to inline the view pattern and get a perfectly harmless (well... at least, <em>allowed</em>) definition:</p>\n\n<pre><code>fooey :: Quun -&gt; Bool\nfooey Foo = True\nfooey (Oink (fooey -&gt; True)) = True\nfooey _ = False\n\npattern Yum &lt;- (fooey -&gt; True)\n</code></pre>\n\n<p>So, are such synonyms just not available yet for technical reasons, and will we get them in the future?</p>\n"}, {"tags": ["python", "haskell", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1455631642, "post_id": 35434565, "comment_id": 58567471, "body": "I know that fusion would work only with pure functions, what I was asking is is there a way to do that in Python (maybe not with stream fusion, but something else) (I assume your answer is no)."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 0, "last_activity_date": 1455631169, "creation_date": 1455631169, "answer_id": 35434565, "question_id": 35434320, "link": "https://stackoverflow.com/questions/35434320/efficient-functional-list-iteration-in-python/35434565#35434565", "title": "Efficient functional list iteration in Python", "body": "<p>Yes, fusion in Haskell will often turn something written as two passes into a single pass.  Though in the case of lists, it's actually foldr/build fusion rather than stream fusion.</p>\n\n<p>That's not generally possible in languages that don't enforce purity, though.  When side effects are involved, it's no longer correct to fuse multiple passes into one.  What if each pass performed output?  Unfused, you get all the output from each pass separately.  Fused, you get the output from both passes interleaved.</p>\n\n<p>It's possible to write a fusion-style framework in Python that will work correctly if you promise to only ever use it with pure functions. But I'm doubtful such a thing exists at the moment. (I'd loved to be proven wrong, though.)</p>\n"}, {"comments": [{"owner": {"reputation": 76206, "user_id": 108205, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ef459127edc89cc575d80a73cd8c567a?s=128&d=identicon&r=PG", "display_name": "jsbueno", "link": "https://stackoverflow.com/users/108205/jsbueno"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1455640935, "post_id": 35436625, "comment_id": 58574310, "body": "Hmmm..more like an S.O. + back and forth navigation buttons glitch - I intended just to edit this one to add the final comment."}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "edited": false, "score": 0, "creation_date": 1455691939, "post_id": 35436625, "comment_id": 58596682, "body": "do_something_with_filtered is a functions that takes a list, not an item. But I see what you did here."}, {"owner": {"reputation": 76206, "user_id": 108205, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ef459127edc89cc575d80a73cd8c567a?s=128&d=identicon&r=PG", "display_name": "jsbueno", "link": "https://stackoverflow.com/users/108205/jsbueno"}, "edited": false, "score": 0, "creation_date": 1455709670, "post_id": 35436625, "comment_id": 58608086, "body": "I wrote the most usual pattern - each item is consumed as it is generated. Otherwise, just call <code>multifilter</code> in a generator_expression (or list comprehension if you really need a list) you will get a full list that can be passed along:  <code>do_something_with_filtered_items([item for item in multifilter(data, predicates)])</code>"}], "tags": [], "owner": {"reputation": 76206, "user_id": 108205, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ef459127edc89cc575d80a73cd8c567a?s=128&d=identicon&r=PG", "display_name": "jsbueno", "link": "https://stackoverflow.com/users/108205/jsbueno"}, "is_accepted": true, "score": 0, "last_activity_date": 1455640956, "last_edit_date": 1455640956, "creation_date": 1455636834, "answer_id": 35436625, "question_id": 35434320, "link": "https://stackoverflow.com/questions/35434320/efficient-functional-list-iteration-in-python/35436625#35436625", "title": "Efficient functional list iteration in Python", "body": "<p>Python has a strong support to \"stream processing\" in the form of its iterators - and what you ask seens just trivial to do. You just have to have a way to group your predicates and attributes to it - it could be a dictionary where the predicate itself is the key.</p>\n\n<p>That said, a simple iterator function that takes in your predicate data structure, along with the data to be processed could do what you want. TThe iterator would have the side effect of changing your data-structure with the predicate-information. If you want \"pure functions\" you'd just have to duplicate the predicate information before, and maybe passing and retrieving all predicate and counters valus to the iterator (through the <code>send</code> method) for each element - I don\u00b4 t think it would be worth that level of purism.</p>\n\n<p>That said you could have your code something along:</p>\n\n<pre><code>from collections import OrderedDict\n\n\ndef predicate1(...):\n    ...\n\n...\n\ndef preticateN(...):\n    ...\n\ndef do_something_with_filtered(item):\n    ...\n\ndef multifilter(data, predicates):\n    for item in data:\n        for predicate in predicates:\n            if predicate(item):\n                predicates[predicate] += 1\n                break\n        else:\n            yield item\n\n\ndef do_it(data):\n    predicates = OrderedDict([(predicate1, 0), ..., (predicateN, 0)  ])\n    for item in multifilter(data, predicates):\n        do_something_with_filtered(item)\n\n    for predicate, value in predicates.items():\n        print(\"{} filtered out {} items\".format(predicate.__name__, value)\n\n\na = ...\ndo_it(a)\n</code></pre>\n\n<p>(If you have to count an item for all predicates that it fails, then an obvious change from the \"break\" statement to a state flag variable is enough)</p>\n"}], "owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 35436625, "answer_count": 2, "score": 1, "last_activity_date": 1455640956, "creation_date": 1455630441, "question_id": 35434320, "link": "https://stackoverflow.com/questions/35434320/efficient-functional-list-iteration-in-python", "title": "Efficient functional list iteration in Python", "body": "<p>So suppose I have an array of some elements. Each element have some number of properties.</p>\n\n<p>I need to filter this list from some subsets of values determined by predicates. This subsets of course can have intersections.\nI also need to determine amount of values in each such subset.</p>\n\n<p>So using imperative approach I could write code like that and it would have running time of 2*n. One iteration to copy array and another one to filter it count subsets sizes.</p>\n\n<pre><code>from split import import groupby\n\na = [{'some_number': i, 'some_time': str(i) + '0:00:00'} for i in range(10)]\n\n\n# imperative style\n\nwrong_number_count = 0\nwrong_time_count = 0\n\nfor item in a[:]:\n    if predicate1(item):\n        delete_original(item, a)\n        wrong_number_count += 1\n\n    if predicate2(item):\n        delete_original(item, a)\n        wrong_time_count += 1\n\n    update_some_data(item)\n\ndo_something_with_filtered(a)\n\n\ndef do_something_with_filtered(a, c1, c2):\n    print('filtered a {}'.format(a))\n    print('{} items had wrong number'.format(c1))\n    print('{} items had wrong time'.format(c2))\n\n\ndef predicate1(x):\n    return x['some_number'] &lt; 3\n\n\ndef predicate2(x):\n    return x['some_time'] &lt; '50:00:00'\n</code></pre>\n\n<p>Somehow I can't think of the way to do that in Python in functional way with same running time.\nSo in functional style I could have used groupby multiple times probably or write a comprehension for each predicate, but that's obviously would be slower than imperative approach.</p>\n\n<p>I think such thing possible in Haskell using Stream Fusion (am I right?)\nBut how do that in Python?</p>\n"}, {"tags": ["multithreading", "haskell", "ghc"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 5, "creation_date": 1455623937, "post_id": 35431919, "comment_id": 58561960, "body": "well <i>-threaded</i>  adds overhead (and as you said you don&#39;t need it with this) - to get faster I would probably try non-lazy-IO or pipe/conduit (how big is big.txt?)"}, {"owner": {"reputation": 3462, "user_id": 914859, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/52bf147a3e31747586f594049359d3d1?s=128&d=identicon&r=PG", "display_name": "Michael Fox", "link": "https://stackoverflow.com/users/914859/michael-fox"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1455625321, "post_id": 35431919, "comment_id": 58562958, "body": "Thank you @Carsten. I will try pipes. <code>big.txt</code> is for benchmarking and could be unlimited. It might help if ByteString used bigger chunks (or smaller, who knows?). Better would be to avoid allocation and use a fixed buffer like C if it were possible. I would like to put some further processing in other threads (such as counting characters and lines) but with such overhead there is no advantage in doing so."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1455627897, "post_id": 35431919, "comment_id": 58564759, "body": "The bottleneck is clearly IO and perhaps memory here; the CPU doesn&#39;t do anything interesting at all. The garbage collector may well be the culprit, I believe multithreaded GC is substentially more complicated."}], "answers": [{"tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 8, "last_activity_date": 1455631184, "last_edit_date": 1455631184, "creation_date": 1455630719, "answer_id": 35434408, "question_id": 35431919, "link": "https://stackoverflow.com/questions/35431919/why-does-threaded-make-it-slower/35434408#35434408", "title": "Why does `-threaded` make it slower?", "body": "<p>It's GC. Executed your program with <code>+RTS -s</code> and the results told everything.</p>\n\n<p>-N1</p>\n\n<pre><code>D:\\&gt;a +RTS -qa -N1 -s &lt; lorem.txt\n15470835\n   4,558,095,152 bytes allocated in the heap\n       1,746,720 bytes copied during GC\n          77,936 bytes maximum residency (118 sample(s))\n         131,856 bytes maximum slop\n               2 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      8519 colls,     0 par    0.016s   0.021s     0.0000s    0.0001s\n  Gen  1       118 colls,     0 par    0.000s   0.004s     0.0000s    0.0001s\n\n  TASKS: 3 (1 bound, 2 peak workers (2 total), using -N1)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.000s  (  0.001s elapsed)\n  MUT     time    0.842s  (  0.855s elapsed)\n  GC      time    0.016s  (  0.025s elapsed)\n  EXIT    time    0.016s  (  0.000s elapsed)\n  Total   time    0.874s  (  0.881s elapsed)\n\n  Alloc rate    5,410,809,512 bytes per MUT second\n\n  Productivity  98.2% of total user, 97.4% of total elapsed\n\ngc_alloc_block_sync: 0\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n</code></pre>\n\n<p>-N4</p>\n\n<pre><code>D:\\&gt;a +RTS -qa -N4 -s &lt; lorem.txt\n15470835\n   4,558,093,352 bytes allocated in the heap\n       1,720,232 bytes copied during GC\n          77,936 bytes maximum residency (113 sample(s))\n         160,432 bytes maximum slop\n               4 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      8524 colls,  8524 par    4.742s   1.678s     0.0002s    0.0499s\n  Gen  1       113 colls,   112 par    0.031s   0.027s     0.0002s    0.0099s\n\n  Parallel GC work balance: 1.40% (serial 0%, perfect 100%)\n\n  TASKS: 6 (1 bound, 5 peak workers (5 total), using -N4)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.000s  (  0.001s elapsed)\n  MUT     time    1.950s  (  1.415s elapsed)\n  GC      time    4.774s  (  1.705s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    6.724s  (  3.121s elapsed)\n\n  Alloc rate    2,337,468,786 bytes per MUT second\n\n  Productivity  29.0% of total user, 62.5% of total elapsed\n\ngc_alloc_block_sync: 21082\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n</code></pre>\n\n<p>The most significant parts are</p>\n\n<pre><code>                                   Tot time (elapsed)  Avg pause  Max pause\nGen  0      8524 colls,  8524 par    4.742s   1.678s     0.0002s    0.0499s\n</code></pre>\n\n<p>and</p>\n\n<pre><code>Parallel GC work balance: 1.40% (serial 0%, perfect 100%)\n</code></pre>\n\n<p>When <code>-threaded</code> switch is on, at runtime ghc will try its best to balance any work among threads as far as possible. Your whole program is a sequential process so the only work can be moved to other threads are GC, while your program in fact cannot be GCed in parallel so these threads wait for one another to complete their job, resulting a lot of time wasted on synchronization. </p>\n\n<p>If you tell the runtime not to balance among threads by <code>+RTS -qm</code> then sometimes -N4 is as fast as -N1.</p>\n"}], "owner": {"reputation": 3462, "user_id": 914859, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/52bf147a3e31747586f594049359d3d1?s=128&d=identicon&r=PG", "display_name": "Michael Fox", "link": "https://stackoverflow.com/users/914859/michael-fox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 35434408, "answer_count": 1, "score": 3, "last_activity_date": 1455631184, "creation_date": 1455623649, "question_id": 35431919, "link": "https://stackoverflow.com/questions/35431919/why-does-threaded-make-it-slower", "title": "Why does `-threaded` make it slower?", "body": "<p>A simple plan:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy.Char8 as BS\n\nmain = do\n  wc &lt;- length . BS.words &lt;$&gt; BS.getContents\n  print wc\n</code></pre>\n\n<p>Build for speed:</p>\n\n<pre><code>ghc -fllvm -O2 -threaded -rtsopts Words.hs\n</code></pre>\n\n<p>More CPUs means more slowly?</p>\n\n<pre><code>$ time ./Words +RTS -qa -N1 &lt; big.txt\n331041862\n\nreal  0m25.963s\nuser  0m21.747s\nsys 0m1.528s\n$ time ./Words +RTS -qa -N2 &lt; big.txt\n331041862\n\nreal  0m36.410s\nuser  0m34.910s\nsys 0m6.892s\n$ time ./Words +RTS -qa -N4 &lt; big.txt\n331041862\n\nreal  0m42.150s\nuser  0m55.393s\nsys 0m16.227s\n</code></pre>\n\n<p>For good measure:</p>\n\n<pre><code>$time wc -w big.txt\n 331041862 big.txt\n\nreal    0m8.277s\nuser    0m7.553s\nsys 0m0.529s\n</code></pre>\n\n<p>Clearly, this is a single-threaded activity. Still, I wonder why it slows down so much.</p>\n\n<p>Also, do you have any tips, how I can make it competitive with wc?</p>\n"}, {"tags": ["haskell", "functional-programming", "proof"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455621958, "post_id": 35431131, "comment_id": 58560530, "body": "&quot;But how would one prove/disprove such a predicate?&quot; By induction, I assume. If you are a real genius you could probably do it by inspection, but for the rest of us, induction has been the way to go for quite a few centuries. It isn&#39;t actually true - what you probabl want is the weaker statement - <code>foldr f x xs `f` foldr f x ys = foldr f x (xs ++ ys)</code>."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455622142, "post_id": 35431131, "comment_id": 58560667, "body": "But is the proof the same as the proofs for <code>forall xs ys. length (xs ++ ys) = length xs + length ys</code>? How does one prove by induction for functions? What is <code>n</code> and <code>n + 1</code> in terms of functions?"}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1455622195, "post_id": 35431131, "comment_id": 58560702, "body": "How did you even arrive at that more general law? It doesn&#39;t typecheck with the specific one (suddenly <code>f</code> needs to return a list), and even with concatenation is trivially disproven by substituting <code>tail</code> for <code>f</code>: <code>tail ([1] ++ [2]) == [2]</code> whereas <code>tail [1] ++ tail [2] == []</code>."}], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 4, "creation_date": 1455624676, "post_id": 35431326, "comment_id": 58562503, "body": "For the record, such functions are called <a href=\"https://ncatlab.org/nlab/show/homomorphism\" rel=\"nofollow noreferrer\">homomorphisms</a> (magma homomorphisms in this case)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1455622048, "creation_date": 1455622048, "answer_id": 35431326, "question_id": 35431131, "link": "https://stackoverflow.com/questions/35431131/haskell-is-it-true-that-function-application-distributes-over-list-concatenatio/35431326#35431326", "title": "Haskell: Is it true that function application distributes over list concatenation?", "body": "<p>No, this is clearly not true in general:</p>\n\n<pre><code>f [_] = []\nf l = l\n</code></pre>\n\n<p>then</p>\n\n<pre><code>f ([1] ++ [2]) = f [1,2] = [1,2]\n</code></pre>\n\n<p>but</p>\n\n<pre><code>f [1] ++ f [2] = [] ++ [] = []\n</code></pre>\n\n<p>I'm sure the functions which do have this problem form an interesting class, but general functions can do pretty much anything to a list's structure which thwarts such invariants.</p>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 3, "last_activity_date": 1455670837, "last_edit_date": 1455670837, "creation_date": 1455656676, "answer_id": 35442939, "question_id": 35431131, "link": "https://stackoverflow.com/questions/35431131/haskell-is-it-true-that-function-application-distributes-over-list-concatenatio/35442939#35442939", "title": "Haskell: Is it true that function application distributes over list concatenation?", "body": "<blockquote>\n  <p>And after looking at the inductive proof of <code>forall xs ys. length (xs ++ ys) = length xs + length ys</code> from the Haskell School of Music (page 164).</p>\n  \n  <p>It seemed to me that function application distributes over list concatenation.</p>\n</blockquote>\n\n<p>Well, clearly that is not the case.  For example:</p>\n\n<pre><code>reverse ([1..3] ++ [4..6]) /= reverse [1..3] ++ reverse [4..6]\n</code></pre>\n\n<p>The example that you're quoting is a special case that's called a <strong>monoid morphism</strong>: a function <code>f :: m -&gt; n</code> such that:</p>\n\n<ol>\n<li><code>m</code> and <code>n</code> are monoids with binary operation <code>&lt;&gt;</code> and identity <code>mempty</code>;</li>\n<li><code>f mempty = mempty</code></li>\n<li><code>f (m &lt;&gt; m') == f m &lt;&gt; f m'</code></li>\n</ol>\n\n<p>So <code>length :: [a] -&gt; Int</code> is a monoid morphism, sending <code>[]</code> to <code>0</code> and <code>++</code> to <code>+</code>:</p>\n\n<pre><code>length [] = 0\nlength (xs ++ ys) = length xs + length ys\n</code></pre>\n"}], "owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 1, "accepted_answer_id": 35431326, "answer_count": 2, "score": 1, "last_activity_date": 1455670837, "creation_date": 1455621534, "last_edit_date": 1495542200, "question_id": 35431131, "link": "https://stackoverflow.com/questions/35431131/haskell-is-it-true-that-function-application-distributes-over-list-concatenatio", "title": "Haskell: Is it true that function application distributes over list concatenation?", "body": "<p>After reading this question: <a href=\"https://stackoverflow.com/questions/3252189/functional-proofs-haskell\">Functional proofs (Haskell)</a></p>\n\n<p>And after looking at the inductive proof of <code>forall xs ys. length (xs ++ ys) = length xs + length ys</code> from the Haskell School of Music (page 164).</p>\n\n<p>It seemed to me that function application distributes over list concatenation.</p>\n\n<p>Hence the more general law might be that <code>forall f xs ys. f (xs ++ ys) = f xs ++ f ys</code>.</p>\n\n<p>But how would one prove/disprove such a predicate?</p>\n\n<p>-- EDIT --</p>\n\n<p>I made a typo it was meant to be: <code>forall f xs ys. f (xs ++ ys) = f xs + f ys</code>, which matches what the previous question and the Haskell SoM uses. That being said, because of this typo, it's no longer \"distributivity\" property. However, @leftaroundabout made the correct answer for my original typoed question. And as for my intended question, the law is still not correct, because functions don't need the preserve the structural value. The <code>f</code> might give a completely different answer depending on the length of the list it is applied to.</p>\n"}, {"tags": ["haskell", "syntax", "pattern-matching", "pattern-synonyms"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1455630418, "post_id": 35429144, "comment_id": 58566589, "body": "This is a duplicate of <a href=\"http://stackoverflow.com/questions/35417305/constants-in-haskell-and-pattern-matching\">a question asked only 15 hours earlier</a>! Seriously, couldn&#39;t you have seen that? \u2014 However, your question is formulated rather better than the other one (and Benjamin Hodgson&#39;s answer is much better than <a href=\"http://stackoverflow.com/a/35417393/745903\">mine over there</a>), so I <a href=\"http://meta.stackexchange.com/a/9277/180171\">closed the other question instead</a>. But, meh."}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 3, "creation_date": 1455620050, "post_id": 35429844, "comment_id": 58559400, "body": "He can, but if you&#39;re just matching against true in the end, you could&#39;ve just used guards. It seems to me that unless the case the OP is dealing with is more complicated than that just sticking with guards is the better solution."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1455622593, "post_id": 35429844, "comment_id": 58560986, "body": "@Cubic Well, he want pattern matching (not guards) I think you are right but your comments fit better at the main question. In any case, use <code>PatternSynonyms</code> looks a better solution (I think should be the accepted one, adding <code>ViewPatterns</code> for not only constructors)."}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": false, "score": 2, "last_activity_date": 1455619739, "last_edit_date": 1455619739, "creation_date": 1455618146, "answer_id": 35429844, "question_id": 35429144, "link": "https://stackoverflow.com/questions/35429144/haskell-using-a-constant-in-pattern-matching/35429844#35429844", "title": "Haskell - Using a constant in pattern matching", "body": "<p>You can use <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ViewPatterns#Examples\" rel=\"nofollow\">ViewPattern</a> extension</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\ndata A = A Int | B Char deriving (Eq, Show)\n\ncomplexA = A 34\ncomplexB = B 'z'\n\nisComplexA = (complexA ==)\nisComplexB = (complexB ==)\n\ncomplexF (isComplexA -&gt; True) = print \"complexA\"\ncomplexF (isComplexB -&gt; True) = print \"complexB\"\ncomplexF _                    = print \"too complex\"\n\nmain = do\n    complexF complexA\n    complexF complexB\n    complexF $ A 55\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1455622384, "post_id": 35431387, "comment_id": 58560836, "body": "&quot;If your defaultA consists only of constructor calls&quot; ... even it is some arbitrary expression, if it admits an Eq instance as in the case of the question, you can still write <code>pattern DefaultA = ((== defaultA) -&gt; True)</code> using ViewPatterns."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455622448, "post_id": 35431387, "comment_id": 58560880, "body": "Yep, good point, though that requires <code>ViewPatterns</code> as well as <code>PatternSynonyms</code> (and is still not as simple as a guard clause in my opinion)."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1455623250, "post_id": 35431387, "comment_id": 58561479, "body": "I removed the guards in the Haskell 98 version; I am not against verbosity for the sake of clarity but in this case it doesn&#39;t serve to clarify anything."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1455623305, "post_id": 35431387, "comment_id": 58561532, "body": "@Cubic I put them back. The point is not that I&#39;m pulling a <code>Bool</code> out of an <code>A</code>, the point is that I&#39;m using guards to test whether it&#39;s <code>defaultA</code>. Perhaps I should change the return type to clarify that"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1455630927, "post_id": 35431387, "comment_id": 58566940, "body": "I don&#39;t quite agree with your recommendation of equality guards \u2013 equality comparisons should IMO be avoided as much as possible. But, nice answer."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 6, "last_activity_date": 1457343859, "last_edit_date": 1457343859, "creation_date": 1455622211, "answer_id": 35431387, "question_id": 35429144, "link": "https://stackoverflow.com/questions/35429144/haskell-using-a-constant-in-pattern-matching/35431387#35431387", "title": "Haskell - Using a constant in pattern matching", "body": "<p>If the definiton of <code>defaultA</code> consists only of constructor calls, you could use a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/syntax-extns.html#pattern-synonyms\" rel=\"nofollow\">pattern synonym</a>.</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\n\ndata A = A Int\n\npattern DefaultA = A 3\n\nisDefaultA DefaultA = putStrLn \"it was a default\"\nisDefaultA _ = putStrLn \"it was not a default\"\n</code></pre>\n\n<p>This isn't a particularly idiomatic deployment of <code>PatternSynonyms</code> though. I'd probably stick with Haskell 98, using a very-slightly-more-verbose guard clause with an equality test.</p>\n\n<pre><code>data A = A Int deriving Eq\n\ndefaultA = A 3\n\nisDefaultA a\n    | a == defaultA = putStrLn \"it was a default\"\n    | otherwise = putStrLn \"it was not a default\"\n</code></pre>\n\n<hr>\n\n<p>Where pattern synonyms <em>do</em> come in useful is for wrapping up noisy library constructor calls imposed on you when you're doing datatype-generic programming with a pattern like <em>free monads</em> or <a href=\"https://www.staff.science.uu.nl/~swier004/Publications/DataTypesALaCarte.pdf\" rel=\"nofollow\"><em>Data Types a la Carte</em></a>.</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\n{-# LANGUAGE TypeOperators #-}\n\n-- fixed point of functor\nnewtype Expr f = In (f (Expr f))\n\n-- functor coproduct\ndata (f :+: g) a = Inl (f a) | Inr (g a)\n\n\n-- now plug in custom code\ndata Add r = Add_ r r\ndata Val r = Val_ Int\ntype HuttonsRazor = Expr (Add :+: Val)\n\npattern Add x y = In (Inl (Add_ x y))\npattern Val x = In (Inr (Val_ x))\n\neval :: HuttonsRazor -&gt; Int\neval (Add x y) = eval x + eval y\neval (Val x) = x\n</code></pre>\n"}], "owner": {"reputation": 4972, "user_id": 1964342, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce48e3381ac19802f017e34b80e0536c?s=128&d=identicon&r=PG", "display_name": "tohava", "link": "https://stackoverflow.com/users/1964342/tohava"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 463, "favorite_count": 1, "accepted_answer_id": 35431387, "answer_count": 2, "score": 3, "last_activity_date": 1457343859, "creation_date": 1455616442, "last_edit_date": 1455675015, "question_id": 35429144, "link": "https://stackoverflow.com/questions/35429144/haskell-using-a-constant-in-pattern-matching", "title": "Haskell - Using a constant in pattern matching", "body": "<p>Let's say I have the following code (text in <code>&lt;&gt;</code> is a shorthand, not actually part of the code):</p>\n\n<pre><code>data A = &lt;something&gt;\ndefaultA :: A\ndefaultA = &lt;Really complicated expression of type A&gt;\n</code></pre>\n\n<p>Now I want to have a function pattern match on <code>defaultA</code>, like this:</p>\n\n<pre><code>f defaultA = &lt;case 1&gt;\nf _ = &lt;case 2&gt;\n</code></pre>\n\n<p>However, <code>defaultA</code> in the first line becomes a new variable, not a condition that means the parameter will equal <code>defaultA</code>. The best way I know to achieve something like what I want is:</p>\n\n<pre><code>f x | x == defaultA = &lt;case 1&gt;\nf _ = &lt;case 2&gt;\n</code></pre>\n\n<p>Does anyone know a better way?</p>\n"}, {"tags": ["haskell", "list-comprehension", "quickcheck"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1455603151, "post_id": 35425002, "comment_id": 58549554, "body": "&quot;Where do I get <code>floats</code> from?&quot; is quite a question; I don&#39;t see that it can be answered from the information given. What do you want to be in that list...?"}, {"owner": {"reputation": 12230, "user_id": 1479269, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c8d6345c6e01f0f4ce8acf0792d7769c?s=128&d=identicon&r=PG", "display_name": "dmvianna", "link": "https://stackoverflow.com/users/1479269/dmvianna"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1455603249, "post_id": 35425002, "comment_id": 58549586, "body": "@DanielWagner, check my edit. That workaround works and gives me the  kind of values I expect."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1455605399, "post_id": 35425002, "comment_id": 58550524, "body": "It seems your actual question is how to generate an infinite list of random floats? The list comprehension in the question is perfectly fine for filtering zero elements out of an infinite list of floats."}], "answers": [{"comments": [{"owner": {"reputation": 12230, "user_id": 1479269, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c8d6345c6e01f0f4ce8acf0792d7769c?s=128&d=identicon&r=PG", "display_name": "dmvianna", "link": "https://stackoverflow.com/users/1479269/dmvianna"}, "edited": false, "score": 0, "creation_date": 1455603409, "post_id": 35425124, "comment_id": 58549647, "body": "Does that work for you? I tried it before, and <code>sample divGen</code> gave me an infinite loop."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1455603438, "post_id": 35425124, "comment_id": 58549662, "body": "Does <code>arbitrary</code> loop infinitely or always return 0?"}, {"owner": {"reputation": 12230, "user_id": 1479269, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c8d6345c6e01f0f4ce8acf0792d7769c?s=128&d=identicon&r=PG", "display_name": "dmvianna", "link": "https://stackoverflow.com/users/1479269/dmvianna"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1455603593, "post_id": 35425124, "comment_id": 58549718, "body": "@ThomasM.DuBuisson, I ran it in <code>Interactive-Haskell</code> (Emacs) and it just hanged until I interrupted it. No value was returned."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1455606241, "post_id": 35425124, "comment_id": 58550907, "body": "You want <code>arbitrary `suchThat` (&#47;= 0)</code>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1455603340, "creation_date": 1455603340, "answer_id": 35425124, "question_id": 35425002, "link": "https://stackoverflow.com/questions/35425002/remove-zero-from-infinite-float-list/35425124#35425124", "title": "remove zero from infinite float list", "body": "<blockquote>\n  <p>Could I do it with a list comprehension?</p>\n</blockquote>\n\n<p>Sure, that comprehension looks fine to me.</p>\n\n<blockquote>\n  <p>Where do I get <code>floats</code> from?</p>\n</blockquote>\n\n<p>Depends what you want to be in it.</p>\n\n<p>For your generator code, the only comment I would make is that rejection sampling is the usual trick:</p>\n\n<pre><code>divGen = do\n    x &lt;- arbitrary\n    if x /= 0 then return x else divGen\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 12230, "user_id": 1479269, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c8d6345c6e01f0f4ce8acf0792d7769c?s=128&d=identicon&r=PG", "display_name": "dmvianna", "link": "https://stackoverflow.com/users/1479269/dmvianna"}, "edited": false, "score": 0, "creation_date": 1455658980, "post_id": 35425931, "comment_id": 58585126, "body": "It is a hard choice between yours and @Zeta&#39;s answer. Both improved my knowledge of QuickCheck. Thanks!"}, {"owner": {"reputation": 634, "user_id": 4575363, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/QUCj2.jpg?s=128&g=1", "display_name": "The Hoff", "link": "https://stackoverflow.com/users/4575363/the-hoff"}, "edited": false, "score": 0, "creation_date": 1607464319, "post_id": 35425931, "comment_id": 115280194, "body": "Where does the <code>=~=</code> operator come from?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1607495123, "post_id": 35425931, "comment_id": 115287057, "body": "<code>=~=</code> here is meant to be a sufficiently inexact comparator (since comparing <code>Double</code>s exactly isn&#39;t a good idea). See e.g. <a href=\"https://hackage.haskell.org/package/elynx-tools-0.5.0/docs/ELynx-Tools.html#v:-61--126--61-\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/elynx-tools-0.5.0/docs/&hellip;</a>"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 7, "last_activity_date": 1455606371, "creation_date": 1455606371, "answer_id": 35425931, "question_id": 35425002, "link": "https://stackoverflow.com/questions/35425002/remove-zero-from-infinite-float-list/35425931#35425931", "title": "remove zero from infinite float list", "body": "<p>You can generate <code>arbitrary</code> values that satisfy a given predicate using the <a href=\"https://hackage.haskell.org/package/QuickCheck-2.8.2/docs/Test-QuickCheck-Gen.html#v:suchThat\" rel=\"noreferrer\"><code>suchThat</code></a> combinator of QuickCheck:</p>\n\n<pre><code>divisor :: Gen Float\ndivisor = arbitrary `suchThat` (/= 0)\n</code></pre>\n\n<p>Example usage:</p>\n\n<pre><code>my_prop x = forAll divisor $ \\d -&gt; (x / d) * d =~= x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 5, "last_activity_date": 1455640764, "last_edit_date": 1455640764, "creation_date": 1455611195, "answer_id": 35427349, "question_id": 35425002, "link": "https://stackoverflow.com/questions/35425002/remove-zero-from-infinite-float-list/35427349#35427349", "title": "remove zero from infinite float list", "body": "<p>That's already in QuickCheck, namely <a href=\"https://hackage.haskell.org/package/QuickCheck-2.8.2/docs/Test-QuickCheck-Modifiers.html#v:NonZero\" rel=\"nofollow\"><code>NonZero</code></a>. Your infinite list of floats can be modeled as</p>\n\n<pre><code>nonZeroFloat :: Gen Float\nnonZeroFloat = fmap getNonZero arbitrary\n\n-- You probably want to use a shorter name:\ninfiniteListOfNonZeroFloats :: Gen [Float]\ninfiniteListOfNonZeroFloats = infiniteListOf nonZeroFloat\n</code></pre>\n\n<p>Afterwards, you can use <code>forAll</code>:</p>\n\n<pre><code>prop_something = forAll infiniteListOfNonZeroFloats $ \\xs -&gt; ...\n-- or\nprop_something = forAll (infinitelistOf $ getNonZero `fmap` arbitrary) $ \\xs -&gt;\n                    ...\n</code></pre>\n\n<p>Note that the use of <code>NonZero</code> is a lot smoother with pattern matching:</p>\n\n<pre><code>prop_nonzero :: NonZero Float -&gt; ...\nprop_nonzero (NonZero x) = ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1158, "user_id": 4956078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44600007f35ab98b7badbf1110df0687?s=128&d=identicon&r=PG&f=1", "display_name": "JMAA", "link": "https://stackoverflow.com/users/4956078/jmaa"}, "edited": false, "score": 0, "creation_date": 1539203156, "post_id": 52747920, "comment_id": 92421014, "body": "Welcome to Stackoverflow! Did you know you can use markdown-style formatting in your answers and preview them before you post? I&#39;ve submitted an edit to your answer to make it more readable, but I&#39;m not very familiar with Haskell, so feel free to fix any errors I may have accidentally introduced."}], "tags": [], "owner": {"reputation": 33, "user_id": 9945479, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mjHOj.jpg?s=128&g=1", "display_name": "Ishratur Rahman", "link": "https://stackoverflow.com/users/9945479/ishratur-rahman"}, "is_accepted": false, "score": 1, "last_activity_date": 1539221838, "last_edit_date": 1539221838, "creation_date": 1539201662, "answer_id": 52747920, "question_id": 35425002, "link": "https://stackoverflow.com/questions/35425002/remove-zero-from-infinite-float-list/52747920#52747920", "title": "remove zero from infinite float list", "body": "<p>So if you intend only to remove zeros from a list then you can do the following:</p>\n\n<ol>\n<li><p>Function definition:</p>\n\n<pre><code>withoutZeros:: (Eq a,Num a)-&gt;[a]-&gt;[a] \n</code></pre></li>\n<li><p>This code will drop all the zeros. You can drop any number just by changing the condtion inside the (/=).</p>\n\n<pre><code>withoutZeros =filter (/=0)  \n</code></pre></li>\n</ol>\n\n<p>I used  <code>(Eq a,Num a)</code> in my function definition because <code>Eq a-&gt;</code> is required for the comparison (i.e. <code>(/=)</code>) and <code>Num a-&gt;</code>. This will let you use this function on both Integer and Float lists.</p>\n"}], "owner": {"reputation": 12230, "user_id": 1479269, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c8d6345c6e01f0f4ce8acf0792d7769c?s=128&d=identicon&r=PG", "display_name": "dmvianna", "link": "https://stackoverflow.com/users/1479269/dmvianna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 779, "favorite_count": 1, "accepted_answer_id": 35425931, "answer_count": 4, "score": 1, "last_activity_date": 1539221838, "creation_date": 1455602866, "last_edit_date": 1455616019, "question_id": 35425002, "link": "https://stackoverflow.com/questions/35425002/remove-zero-from-infinite-float-list", "title": "remove zero from infinite float list", "body": "<p>I want to sample from an infinite list of floats for <strong>QuickCheck</strong> consumption. However, as I intend to use division, I want to remove <strong>zero</strong> from that list. It is such a conceptually simple problem I was wondering if I could do it with a list comprehension, and if not, which would be the simplest way to achieve this in Haskell?</p>\n\n<pre><code>[x | x &lt;- floats, x /= 0] -- this seems reasonable, but where do I get floats from?\n</code></pre>\n\n<p>My current workaround (yuck):</p>\n\n<pre><code>import Test.QuickTest\n\ndivGen :: Gen (Maybe Float)\ndivGen = do\n    x &lt;- arbitrary\n    if x /= 0\n    then return $ Just x\n    else return Nothing\n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1455598139, "post_id": 35423903, "comment_id": 58547730, "body": "What is the problem with your current solution?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1455599513, "post_id": 35423903, "comment_id": 58548187, "body": "@dfeuer probably that it&#39;s not a correct one (not producing all partitions)?"}], "answers": [{"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 4, "last_activity_date": 1455600476, "creation_date": 1455600476, "answer_id": 35424464, "question_id": 35423903, "link": "https://stackoverflow.com/questions/35423903/haskell-all-possible-partitions-of-a-list/35424464#35424464", "title": "Haskell All possible partitions of a list", "body": "<p>Here is the function you need:</p>\n\n<pre><code>bloat :: a -&gt; [[a]] -&gt; [[[a]]]\nbloat x  []      = [[[x]]]\nbloat x (xs:xss) = ((x:xs):xss) : map (xs:) (bloat x xss)\n</code></pre>\n\n<p>E.g. <code>bloat 'a' [\"b\", \"c\", \"de\"]</code> equals</p>\n\n<pre><code>[[\"ab\",\"c\",\"de\"],[\"b\",\"ac\",\"de\"],[\"b\",\"c\",\"ade\"],[\"b\",\"c\",\"de\",\"a\"]]\n</code></pre>\n\n<p>i.e. prepend <code>a</code> to each sublist (and at the end of the list) and duplicate the remaining sublists.</p>\n\n<p>Then <code>partitionSet</code> is simply</p>\n\n<pre><code>partitionSet :: [a] -&gt; [[[a]]]\npartitionSet  []    = [[]]\npartitionSet (x:xs) = [ys | yss &lt;- partitionSet xs, ys &lt;- bloat x yss]\n</code></pre>\n\n<p>Or in more idiomatic Haskell</p>\n\n<pre><code>partitionSet :: [a] -&gt; [[[a]]]\npartitionSet = foldr (\\x r -&gt; r &gt;&gt;= bloat x) [[]]\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 5933002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdc47a0df6517aa875653989bdc99b64?s=128&d=identicon&r=PG&f=1", "display_name": "User2877", "link": "https://stackoverflow.com/users/5933002/user2877"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1126, "favorite_count": 1, "closed_date": 1455641815, "answer_count": 1, "score": 3, "last_activity_date": 1455643214, "creation_date": 1455597679, "last_edit_date": 1455643214, "question_id": 35423903, "link": "https://stackoverflow.com/questions/35423903/haskell-all-possible-partitions-of-a-list", "closed_reason": "Duplicate", "title": "Haskell All possible partitions of a list", "body": "<p>I need to write a function that produces all of the possible partitions of a list, including non-contiguous partitions.  It should look something like this:</p>\n\n<pre><code>*Main&gt; ps [1,2,3,4]\n[[21, 3, 4],[31, 2, 4],[41, 2, 3],[431, 2],[21, 43],[4321],[31, 42],[421, 3],[41, 32],[321, 4],[1, 32, 4],[1, 42, 3],[1, 432],[1, 2, 43],[1, 2, 3, 4]]\n</code></pre>\n\n<p>So far I have only been able to produce a recursive function using list comprehension to produce the contiguous partitions.</p>\n\n<pre><code>ps [] = [[]]\nps (x:xs) = [[x]:qs | qs &lt;- ps xs] ++ [(x:gs):gss | (gs):gss &lt;- ps xs]\n</code></pre>\n\n<p>I have an idea of moving the tail of each partition and prepending it to the first element of each partition, but I am not sure how I would do this in Haskell.  I'm still a newbie to this language.  Any help would be greatly appreciated!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1455593083, "post_id": 35423011, "comment_id": 58546294, "body": "You should expect that this function will be recursive. Therefore the standard questions to ask yourself are: What is the base case? What should the function return in the base case? What is the recursive case? How can I use the result of calling this function on some smaller input in the recursive case? I encourage you to ponder these questions, then update your question to discuss the thoughts you have had, and where if anywhere you find it difficult to address these standard questions."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1455600767, "post_id": 35423011, "comment_id": 58548661, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/35397857/haskell-recursive-function-on-sets\">Haskell: Recursive Function on Sets</a>"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 0, "creation_date": 1455609101, "post_id": 35423011, "comment_id": 58552343, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/35388734/haskell-recursive-list-function\">Haskell: Recursive List Function</a>"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1455597947, "creation_date": 1455597947, "answer_id": 35423956, "question_id": 35423011, "link": "https://stackoverflow.com/questions/35423011/all-possible-orders-of-a-list/35423956#35423956", "title": "All possible orders of a list", "body": "<p>Expanding on Daniel Wagner's comment:</p>\n\n<p>First, explain precisely what you want. I would put it like this:</p>\n\n<blockquote>\n  <p>Given a list, <code>xs :: [a]</code>, whose elements are all distinct, produce a list <code>yss :: [[[a]]]</code> representing all the ways to partition the elements of <code>xs</code> into non-empty lists.</p>\n</blockquote>\n\n<p>Now, consider cases:</p>\n\n<pre><code>ways :: [a] -&gt; [[[a]]]\nways [] = ?\nways (ys : yss) = ?\n</code></pre>\n\n<p>You can expect the second case to be recursive. You can also expect to need to write at least one helper function.</p>\n"}], "owner": {"reputation": 53, "user_id": 5927617, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/415b65efd5744b4b4395b69ea79d2c87?s=128&d=identicon&r=PG&f=1", "display_name": "Minmater", "link": "https://stackoverflow.com/users/5927617/minmater"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1455597947, "creation_date": 1455592423, "question_id": 35423011, "link": "https://stackoverflow.com/questions/35423011/all-possible-orders-of-a-list", "title": "All possible orders of a list", "body": "<p>I'm trying to teach myself Haskell and the book I'm using has said to create a list of all possible formations of said list, the example is as follows (roughly translated): </p>\n\n<p>Given the list, ls = [1,2,3], there are 5 possible form in which this could occur:</p>\n\n<pre><code>[[1],[2],[3]]\n[[1,2],[3]]\n[[1,3],[2]]\n[[2,3],[1]]\n[[1,2,3]]\n</code></pre>\n\n<p>How would I even start about coding this?</p>\n\n<p>Thank you and sorry for English, it is not my first language.</p>\n"}, {"tags": ["haskell", "ghc", "hpc"], "comments": [{"owner": {"reputation": 2013, "user_id": 2704853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6658407c0b56fc68b8615c33767c8682?s=128&d=identicon&r=PG&f=1", "display_name": "jev", "link": "https://stackoverflow.com/users/2704853/jev"}, "edited": false, "score": 1, "creation_date": 1455574478, "post_id": 35419977, "comment_id": 58540731, "body": "try addin <code>--make -fforce-recomp</code> to the compiler flags"}, {"owner": {"reputation": 1, "user_id": 5932160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1a9a81cd9ae078dd31008164adf8cc?s=128&d=identicon&r=PG&f=1", "display_name": "Vitor Dias", "link": "https://stackoverflow.com/users/5932160/vitor-dias"}, "reply_to_user": {"reputation": 2013, "user_id": 2704853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6658407c0b56fc68b8615c33767c8682?s=128&d=identicon&r=PG&f=1", "display_name": "jev", "link": "https://stackoverflow.com/users/2704853/jev"}, "edited": false, "score": 0, "creation_date": 1455576296, "post_id": 35419977, "comment_id": 58541549, "body": "i tried, but still nothing appear.  i compiled the program like this &quot;ghc filename.hs&quot; and it compiled without any problem. After i did &quot; ghc -fhpc --make -fforce-recomp filename&quot;. Did i something wrong?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 5932160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1a9a81cd9ae078dd31008164adf8cc?s=128&d=identicon&r=PG&f=1", "display_name": "Vitor Dias", "link": "https://stackoverflow.com/users/5932160/vitor-dias"}, "edited": false, "score": 0, "creation_date": 1455576606, "post_id": 35420435, "comment_id": 58541688, "body": "if i execute it, i will get the result of using TestList that i put in the .hs file. Something like &quot;Cases: 2 Tried: 2 ...&quot;."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1, "user_id": 5932160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1a9a81cd9ae078dd31008164adf8cc?s=128&d=identicon&r=PG&f=1", "display_name": "Vitor Dias", "link": "https://stackoverflow.com/users/5932160/vitor-dias"}, "edited": false, "score": 0, "creation_date": 1455576696, "post_id": 35420435, "comment_id": 58541724, "body": "@VitorDias ...and presumably <i>also</i> a tix file, no?"}, {"owner": {"reputation": 1, "user_id": 5932160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1a9a81cd9ae078dd31008164adf8cc?s=128&d=identicon&r=PG&f=1", "display_name": "Vitor Dias", "link": "https://stackoverflow.com/users/5932160/vitor-dias"}, "edited": false, "score": 0, "creation_date": 1455577007, "post_id": 35420435, "comment_id": 58541832, "body": "No, thats the problem...if i get it i would be able to do the next command i want &quot;hpc report filename.tix&quot;"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 1, "user_id": 5932160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1a9a81cd9ae078dd31008164adf8cc?s=128&d=identicon&r=PG&f=1", "display_name": "Vitor Dias", "link": "https://stackoverflow.com/users/5932160/vitor-dias"}, "edited": false, "score": 0, "creation_date": 1455577769, "post_id": 35420435, "comment_id": 58542118, "body": "@VitorDias See my edit.  If you can&#39;t reproduce my results there then I suspect you should try reinstalling GHC."}, {"owner": {"reputation": 1, "user_id": 5932160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1a9a81cd9ae078dd31008164adf8cc?s=128&d=identicon&r=PG&f=1", "display_name": "Vitor Dias", "link": "https://stackoverflow.com/users/5932160/vitor-dias"}, "edited": false, "score": 0, "creation_date": 1455577911, "post_id": 35420435, "comment_id": 58542177, "body": "@ThomasM.DuBuisson I dont know exactly why, but i did &quot;ghc -fforce-recomp -fhpc x.hs&quot; and i get it.  Thank you very much!"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 3, "last_activity_date": 1455577722, "last_edit_date": 1455577722, "creation_date": 1455576043, "answer_id": 35420435, "question_id": 35419977, "link": "https://stackoverflow.com/questions/35419977/haskell-program-coverage/35420435#35420435", "title": "Haskell program coverage", "body": "<p>You must execute the program. HPC shows the coverage of a particular run, it isn't a static analysis that occurs at compile time.</p>\n\n<p>EDIT</p>\n\n<p>For example.  Does this not work for you?</p>\n\n<pre><code>% cat x.hs\nmain = getChar &gt;&gt;= print\n% ghc -fforce-recomp -fhpc x.hs\n[1 of 1] Compiling Main             ( x.hs, x.o )\nLinking x ...\n% ./x\nx\n'x'\n% ls x.tix\nx.tix\n</code></pre>\n\n<p>If the above doesn't work then you have a tooling issue.</p>\n\n<p>EDIT 2:</p>\n\n<p>If your program isn't terminating normally then the <code>.tix</code> file might not be getting written.  You need a normal termination and not some sort of segfaulted or otherwise-aborted run.</p>\n"}], "owner": {"reputation": 1, "user_id": 5932160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1a9a81cd9ae078dd31008164adf8cc?s=128&d=identicon&r=PG&f=1", "display_name": "Vitor Dias", "link": "https://stackoverflow.com/users/5932160/vitor-dias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1455577722, "creation_date": 1455573994, "last_edit_date": 1455574546, "question_id": 35419977, "link": "https://stackoverflow.com/questions/35419977/haskell-program-coverage", "title": "Haskell program coverage", "body": "<p>I'm trying to use the <code>ghc -fhpc</code> command in order to create a <code>.tix</code> file, but after I enter the command <code>ghc -fhpc filename</code>, nothing appears.</p>\n\n<p>What should I do?</p>\n"}, {"tags": ["haskell", "vector", "data-structures"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1455575363, "post_id": 35419908, "comment_id": 58541133, "body": "<code>f1</code> shouldn&#39;t be so slow; this ought to be a simple traversal of  (in this case) 10 elements and then an adjustment of the index and offset in the <code>Vector</code>. <code>dropWhile</code> eventually seems to be implemented with this stream fusion stuff which I assume must not be behaving nicely <a href=\"http://hackage.haskell.org/package/vector-0.11.0.0/docs/src/Data-Vector-Fusion-Stream-Monadic.html#dropWhileM\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/vector-0.11.0.0/docs/src/&hellip;</a>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1455575875, "post_id": 35419908, "comment_id": 58541359, "body": "the data structure that comes to my mind  is <code>Seq a</code> from <code>Data.Sequence</code>, which might suit your problem if the <code>vector</code> issue prevails."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 3, "creation_date": 1455576483, "post_id": 35419908, "comment_id": 58541639, "body": "I think it would be helpful to file a bug report"}], "answers": [{"comments": [{"owner": {"reputation": 1109, "user_id": 525201, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/546d49d70075eb2ad32f415cf5a214fe?s=128&d=identicon&r=PG", "display_name": "Nickolay Kolev", "link": "https://stackoverflow.com/users/525201/nickolay-kolev"}, "edited": false, "score": 1, "creation_date": 1455619063, "post_id": 35420278, "comment_id": 58558718, "body": "Thank you! I have filed an issue for this: <a href=\"https://github.com/haskell/vector/issues/108\" rel=\"nofollow noreferrer\">github.com/haskell/vector/issues/108</a>"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 1109, "user_id": 525201, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/546d49d70075eb2ad32f415cf5a214fe?s=128&d=identicon&r=PG", "display_name": "Nickolay Kolev", "link": "https://stackoverflow.com/users/525201/nickolay-kolev"}, "edited": false, "score": 0, "creation_date": 1455649978, "post_id": 35420278, "comment_id": 58580103, "body": "Thanks for your effort."}, {"owner": {"reputation": 445, "user_id": 189176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/274a52c00e4f37979f33423fc8acf371?s=128&d=identicon&r=PG", "display_name": "Carter Tazio Schonwald", "link": "https://stackoverflow.com/users/189176/carter-tazio-schonwald"}, "edited": false, "score": 0, "creation_date": 1455730977, "post_id": 35420278, "comment_id": 58623684, "body": "i&#39;ve commented on the ticket with a few hypotheses that should allow digging into this question :)"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1455575372, "creation_date": 1455575372, "answer_id": 35420278, "question_id": 35419908, "link": "https://stackoverflow.com/questions/35419908/efficient-alternative-to-data-vector-dropwhile/35420278#35420278", "title": "Efficient alternative to Data.Vector.dropWhile", "body": "<p>There's something wrong with <code>Vector</code>'s <code>dropWhile</code>. I think it's most probable that stream fusion fails to kick in correctly and we pay for costly stream/bundle building. Some further investigation is probably due.</p>\n\n<p>As a stopgap measure, you can implement a custom <code>dropWhile</code>. I used your benchmark with the following code:</p>\n\n<pre><code>dropWhile' :: (a -&gt; Bool) -&gt; V.Vector a -&gt; V.Vector a\ndropWhile' p v = V.drop (go 0) v where\n  go n | n == V.length v       = n\n       | p (V.unsafeIndex v n) = go (n + 1)\n       | otherwise             = n\n</code></pre>\n\n<p>And got the following results:</p>\n\n<pre><code>benchmarking funcs/f1\ntime                 57.70 ns   (56.35 ns .. 59.46 ns)\n\nbenchmarking funcs/f2\ntime                 19.68 ns   (19.44 ns .. 19.91 ns)\n</code></pre>\n"}], "owner": {"reputation": 1109, "user_id": 525201, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/546d49d70075eb2ad32f415cf5a214fe?s=128&d=identicon&r=PG", "display_name": "Nickolay Kolev", "link": "https://stackoverflow.com/users/525201/nickolay-kolev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 1, "accepted_answer_id": 35420278, "answer_count": 1, "score": 7, "last_activity_date": 1455575372, "creation_date": 1455573672, "question_id": 35419908, "link": "https://stackoverflow.com/questions/35419908/efficient-alternative-to-data-vector-dropwhile", "title": "Efficient alternative to Data.Vector.dropWhile", "body": "<p>Consider the following:</p>\n\n<pre><code>module Main where\n\nimport           Criterion.Main\nimport qualified Data.Vector    as V\n\nf1 :: V.Vector Double -&gt; Double\nf1 xs\n  | V.null xs = 0\n  | otherwise = V.last xss / V.head xss\n    where xss = V.dropWhile (&lt; 10) xs\n\nf2 :: V.Vector Double -&gt; Double\nf2 xs\n  | V.null xs = 0\n  | otherwise = V.last xs / V.head xs\n\nsetupEnv :: IO (V.Vector Double)\nsetupEnv = return $ V.enumFromN 0 10000000\n\nmain :: IO ()\nmain = defaultMain [\n  env setupEnv $ \\v -&gt;\n    bgroup \"funcs\" [bench \"f1\" $ nf f1 v , bench \"f2\" $ nf f2 v]\n  ]\n</code></pre>\n\n<p>Compiling with <code>--make -O2</code> and running gives the following result:</p>\n\n<pre><code>app $ ./A\nbenchmarking funcs/f1\ntime                 81.87 ms   (78.34 ms .. 86.06 ms)\n                     0.998 R\u00b2   (0.996 R\u00b2 .. 1.000 R\u00b2)\nmean                 85.87 ms   (84.16 ms .. 87.13 ms)\nstd dev              2.351 ms   (1.169 ms .. 3.115 ms)\n\nbenchmarking funcs/f2\ntime                 27.50 ns   (27.11 ns .. 27.95 ns)\n                     0.998 R\u00b2   (0.996 R\u00b2 .. 0.999 R\u00b2)\nmean                 27.62 ns   (27.21 ns .. 28.05 ns)\nstd dev              1.391 ns   (1.154 ns .. 1.744 ns)\nvariance introduced by outliers: 73% (severely inflated)\n</code></pre>\n\n<p>The mean execution time of simply taking the first and last elements and dividing them is ~27ns. Dropping the first 9 elements and performing the same operation has a mean of ~85ms or 3000x slower.</p>\n\n<p>Using an unboxed vector improves the performance of <code>f1</code> by more than half, yet I need to support elements which have no instances of the \"Unboxed\" class.</p>\n\n<p>According to the <a href=\"https://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector.html#g:27\">dropWhile documentation</a> it has a complexity of O(n) yet it does no copying. Is there a data structure in the Haskell libraries which supports an efficient dropWhile-type operation and O(1) access to the first and last elements?</p>\n"}, {"tags": ["scala", "haskell", "typeclass", "implicit", "scala-implicits"], "answers": [{"comments": [{"owner": {"reputation": 10789, "user_id": 471478, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/30a04c96b889896beaffeb7c52cdb914?s=128&d=identicon&r=PG", "display_name": "scravy", "link": "https://stackoverflow.com/users/471478/scravy"}, "edited": false, "score": 0, "creation_date": 1455576891, "post_id": 35420017, "comment_id": 58541787, "body": "Ingenious! Thank you very much :)"}], "tags": [], "owner": {"reputation": 64109, "user_id": 515054, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8c2392da041304fda667e525f3e80fdd?s=128&d=identicon&r=PG", "display_name": "0__", "link": "https://stackoverflow.com/users/515054/0"}, "is_accepted": true, "score": 12, "last_activity_date": 1455574168, "creation_date": 1455574168, "answer_id": 35420017, "question_id": 35419894, "link": "https://stackoverflow.com/questions/35419894/scala-vs-haskell-typeclasses-catchall-instances/35420017#35420017", "title": "Scala vs Haskell typeclasses: &quot;catchall&quot; instances", "body": "<p>You would construct the instance from an implicit parameter for the instance of the peer type <code>A</code>. For example:</p>\n\n<pre><code>implicit def AbleOption[A](implicit peer: Able[A]) = new Able[Option[A]] {\n  def able(a: Option[A]) = a match {\n    case Some(x) =&gt; peer.able(x)\n    case None    =&gt; 0\n  }\n}\n\nassert(implicitly[Able[Option[Int]]].able(None)    == 0)\nassert(implicitly[Able[Option[Int]]].able(Some(3)) == 3)\n</code></pre>\n"}], "owner": {"reputation": 10789, "user_id": 471478, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/30a04c96b889896beaffeb7c52cdb914?s=128&d=identicon&r=PG", "display_name": "scravy", "link": "https://stackoverflow.com/users/471478/scravy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 4, "accepted_answer_id": 35420017, "answer_count": 1, "score": 8, "last_activity_date": 1455574181, "creation_date": 1455573593, "question_id": 35419894, "link": "https://stackoverflow.com/questions/35419894/scala-vs-haskell-typeclasses-catchall-instances", "title": "Scala vs Haskell typeclasses: &quot;catchall&quot; instances", "body": "<p>The following Haskell type class and instance:</p>\n\n<pre><code>class Able a where\n  able :: a -&gt; Int\n\ninstance Able Int where\n  able x = x\n</code></pre>\n\n<p>is commonly translated to Scala like so:</p>\n\n<pre><code>trait Able[A] {\n  def able(a: A): Int\n}\n\nimplicit object AbleInt extends Able[Int] {\n  def able(a: Int) = a\n}\n</code></pre>\n\n<p>In Haskell I can now define a sort of catch-all instance and thereby create an instance for all Maybe types:</p>\n\n<pre><code>instance Able a =&gt; Able (Maybe a) where\n  able (Just a) = able a\n  able Nothing  = 0\n</code></pre>\n\n<p>This defines an instance of <code>Able</code> for <code>Maybe Int</code>, <code>Maybe Bool</code>, etc. provided that there is an instance <code>Able</code> for <code>Int</code>, <code>Bool</code>, etc.</p>\n\n<p>How would one do that in Scala?</p>\n"}, {"tags": ["haskell", "generics", "ghc", "ghc-generics"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1455600288, "post_id": 35419297, "comment_id": 58548473, "body": "Note there are two seperate design &quot;goals&quot; (so to speak) at play here - generically deriving a function, and having that function be &quot;nice&quot;. The author wanted to write a polyvariadic function, like <code>a -&gt; b -&gt; ... -&gt; R</code> instead of having a chain of <code>Compose</code> which is what the <code>Mk</code> class generates: <code>Compose ((-&gt;) a) (Compose ((-&gt;) b) ... R</code>. If you are trying to understand generics, I think you can ignore everything other than the <code>Mk</code> class, which is the workhorse for generics here. I don&#39;t know why the author chose to write everything with Compose, then &quot;convert&quot; it to a polyvariadic function."}], "answers": [{"tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": true, "score": 1, "last_activity_date": 1455623308, "last_edit_date": 1455623308, "creation_date": 1455600324, "answer_id": 35424427, "question_id": 35419297, "link": "https://stackoverflow.com/questions/35419297/understanding-how-to-construct-ghc-generics-reps-and-convert-back-to-values/35424427#35424427", "title": "Understanding how to construct GHC.Generics Rep&#39;s and convert back to values", "body": "<blockquote>\n  <ol>\n  <li>What is <code>mk</code> returning?</li>\n  </ol>\n</blockquote>\n\n<p>Let's go through a much simpler example In the documentation of GHC.Generics first. To achieve a generic function <code>encode :: Generic a =&gt; a -&gt; [Bool]</code> that bit serialize every data type which has a Generic instance, they defined the type class below : </p>\n\n<pre><code>class Encode' rep where\n  encode' :: rep p -&gt; [Bool]\n</code></pre>\n\n<p>By defining <code>Encode'</code> instances for every Rep type (M1, K1, etc.), they made the function work universally on every data types.</p>\n\n<p>In <a href=\"https://ocharles.org.uk/blog/posts/2014-04-26-constructing-generically.html\" rel=\"nofollow\">Building data constructors with GHC Generics</a>, the author's final goal is a generic function <code>make :: Generic a =&gt; TypeOfConstructor a</code>, so naively one may define:</p>\n\n<pre><code>class Mk rep where\n  mk :: (? -&gt; p) -- what should '?' be?\n</code></pre>\n\n<p>And soon realize that it's impossible due to a few problems:</p>\n\n<ol>\n<li><code>-&gt;</code>, the function type in haskell only takes one argument at a time, so <code>mk</code> won't be able to return anything sensible if the constructor takes more than one argument.</li>\n<li>The number and type of the arguments are unclear: it's relative to the <code>rep</code> type in concern.</li>\n<li>It cannot be plain <code>p</code> as the result type. Without the <code>rep</code> context it's impossible to derive instances for <code>:*:</code> or <code>:+:</code>, and the function will no longer work on any nested data type.</li>\n</ol>\n\n<p>Issue 1 can be solved with Data.Functor.Compose. A function of type <code>a -&gt; b -&gt; c</code> can be encoded into <code>Compose ((-&gt;) a) ((-&gt;) b) c</code>, it can be further composed while keeps a whole lot of information about argument types. And by making it a type parameter of <code>Mk</code>, issue 2 is solved too:</p>\n\n<pre><code>class Functor f =&gt; Mk rep f | rep -&gt; f where\n  mk :: f (rep p)\n</code></pre>\n\n<p>where <code>f</code> is generalization over <code>Compose f g</code> and <code>(-&gt;) a</code>, which contains type-level information to construct a <code>rep p</code>, i.e. everything before the final <code>-&gt;</code> in <code>a -&gt; b -&gt; c -&gt; ... -&gt; rep p</code>. </p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>I'm guessing <code>Compose</code> comes from <code>Data.Functor.Compose</code>, which means that when I do <code>fmap f x</code>, it does the <code>fmap</code> two levels deep into the composed functors. But I can't make sense of the nested <code>fmap</code>s inside the <code>Compose</code>. </li>\n  </ol>\n</blockquote>\n\n<p>In the <code>Mk</code> instance of <code>:*:</code>:</p>\n\n<pre><code>instance (Mk l fl, Mk r fr) =&gt; Mk (l :*: r) (Compose fl fr) where\n  mk = Compose (fmap (\\l -&gt; fmap (\\r -&gt; l :*: r) mk) mk)\n</code></pre>\n\n<p><code>fmap</code> changes only the inner-most type of a nested Compose, in this case changes the final result of a n-ary function. <code>mk</code> here is literally concatenating two argument lists <code>fl</code> and <code>fr</code>, putting their results into a product type, namely</p>\n\n<pre><code>f :: Compose ((-&gt;) a) ((-&gt;) b) (f r)\ng :: Compose ((-&gt;) c) ((-&gt;) d) (g r)\nmk f g :: Compose (Compose ((-&gt;) a) ((-&gt;) b)) (Compose ((-&gt;) c) ((-&gt;) d)) ((:*:) f g r)\n\n-- or unwrapped and simplified\n(a -&gt; b -&gt; r) -&gt; (c -&gt; d -&gt; r') -&gt; a -&gt; b -&gt; c -&gt; d -&gt; (r, r')\n</code></pre>\n\n<blockquote>\n  <ol start=\"3\">\n  <li>For the instance of <code>M1 i c f</code>, I thought it would just wrap the inner values in <code>M1</code>, so the need to <code>M1 &lt;$&gt; mk</code> or <code>fmap M1 mk</code> makes no sense to me.</li>\n  </ol>\n</blockquote>\n\n<p>It does just wrap the inner values in <code>M1</code>, but it's unclear how long the argument list of the underlying <code>f</code> is. If it takes one argument then <code>mk</code> is a function, otherwise it's a Compose. <code>fmap</code> wraps the inner-most value of them both.</p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "accepted_answer_id": 35424427, "answer_count": 1, "score": 2, "last_activity_date": 1455623308, "creation_date": 1455571176, "last_edit_date": 1495540766, "question_id": 35419297, "link": "https://stackoverflow.com/questions/35419297/understanding-how-to-construct-ghc-generics-reps-and-convert-back-to-values", "title": "Understanding how to construct GHC.Generics Rep&#39;s and convert back to values", "body": "<p>I'm trying to learn about how to use <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/GHC-Generics.html\" rel=\"nofollow noreferrer\"><code>GHC.Generics</code></a>. A fascinating topic but daunting.</p>\n\n<p>While reading through the blog entry <a href=\"https://ocharles.org.uk/blog/posts/2014-12-16-derive-generic.html\" rel=\"nofollow noreferrer\">24 Days of GHC Extensions: DeriveGeneric</a>, I learned how to take a value and navigate its <code>Rep</code>. Okay.</p>\n\n<p>However, reading the blog entry <a href=\"https://ocharles.org.uk/blog/posts/2014-04-26-constructing-generically.html\" rel=\"nofollow noreferrer\">Building data constructors with GHC Generics</a> which describes the analog of constructing the <code>Rep</code> and converting it back to a value, I got stumped. I've read through <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/GHC-Generics.html\" rel=\"nofollow noreferrer\">a</a> <a href=\"https://wiki.haskell.org/GHC.Generics\" rel=\"nofollow noreferrer\">number</a> <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/generic-programming.html\" rel=\"nofollow noreferrer\">of</a> <a href=\"https://stackoverflow.com/questions/17750867/how-to-construct-generic-functor-instances-using-ghc-generics-or-other-similar\">other</a> <a href=\"https://www.reddit.com/r/haskell/comments/23luc9/explain_like_im_not_a_phd_datatypeable_and/\" rel=\"nofollow noreferrer\">resources</a>, but to no great help.</p>\n\n<p>In the blog entry is the following code. First, constructing the <code>Rep</code>:</p>\n\n<pre><code>class Functor f =&gt; Mk rep f | rep -&gt; f where\n  mk :: f (rep a)\n\ninstance Mk (K1 i c) ((-&gt;) c) where\n  mk = \\x -&gt; K1 x\n\ninstance (Mk l fl, Mk r fr) =&gt; Mk (l :*: r) (Compose fl fr) where\n  mk = Compose (fmap (\\l -&gt; fmap (\\r -&gt; l :*: r) mk) mk)\n\ninstance (Mk f f') =&gt; Mk (M1 i c f) f' where\n  mk = M1 &lt;$&gt; mk\n</code></pre>\n\n<p>Then, dealing with the <code>Compose</code>:</p>\n\n<pre><code>class Functor f =&gt; Apply f a b | f a -&gt; b where\n  apply :: f a -&gt; b\n\ninstance Apply ((-&gt;) a) b (a -&gt; b) where\n  apply = id\n\ninstance (Apply g a b, Apply f b c) =&gt; Apply (Compose f g) a c where\n  apply (Compose x) = apply (fmap apply x)\n</code></pre>\n\n<p>Then dealing with type ambiguity:</p>\n\n<pre><code>type family Returns (f :: *) :: * where\n  Returns (a -&gt; b) = Returns b\n  Returns r = r\n\nmake :: forall b f z. (Generic (Returns b), Apply f (Returns b) b, Mk (Rep (Returns b)) f) =&gt; b\nmake = apply (fmap (to :: Rep (Returns b) z -&gt; (Returns b)) (mk :: f (Rep (Returns b) z)))\n</code></pre>\n\n<p>Wow. </p>\n\n<p>Really, I'm stuck at the very beginning, at the class <code>Mk</code> where <code>mk</code> returns a functor. My questions:</p>\n\n<ol>\n<li><p>What is <code>mk</code> returning? Why is it a functor? What is the interpretation of its result? I can see that the <code>K1 i c</code> instance of <code>Mk</code> returns a function (I understand this is a functor) that takes a value and wraps it in <code>K1</code>, but <code>mk</code> for <code>Mk (l :*: r)</code> and <code>Mk (M1 i c f)</code> are completely lost on me.</p></li>\n<li><p>I'm guessing <code>Compose</code> comes from <code>Data.Functor.Compose</code>, which means that when I do <code>fmap f x</code>, it does the <code>fmap</code> two levels deep into the composed functors. But I can't make sense of the nested <code>fmap</code>s inside the <code>Compose</code>. </p></li>\n<li><p>For the instance of <code>M1 i c f</code>, I thought it would just wrap the inner values in <code>M1</code>, so the need to <code>M1 &lt;$&gt; mk</code> or <code>fmap M1 mk</code> makes no sense to me.</p></li>\n</ol>\n\n<p>Obviously I'm not grokking the intent or meaning of these instances and how these instances interact to create the final <code>Rep</code>. I am hoping someone can enlighten me and provide a good explanation of how to use <code>GHC.Generics</code> along the way.</p>\n"}, {"tags": ["haskell", "serialization"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1455568123, "post_id": 35418256, "comment_id": 58537600, "body": "woops .. I just saw that this will not work at all - the cases you defined yield this functions: <code>Cons1 :: forall a . a -&gt; Gadt Int</code> so I think you are really trying to do something else?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1455569450, "post_id": 35418256, "comment_id": 58538258, "body": "You may want to look into <a href=\"https://hackage.haskell.org/package/instant-generics\" rel=\"nofollow noreferrer\">instant-generics</a>, which is intended to deal with GADTs generically. I haven&#39;t looked very far into it myself yet, but it seems interesting."}, {"owner": {"reputation": 141, "user_id": 4960278, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh5.googleusercontent.com/-rhXMnM2laZQ/AAAAAAAAAAI/AAAAAAAAAZM/zTJL6P6VbSE/photo.jpg?sz=128", "display_name": "Timothy Chu", "link": "https://stackoverflow.com/users/4960278/timothy-chu"}, "edited": false, "score": 0, "creation_date": 1455581001, "post_id": 35418256, "comment_id": 58543202, "body": "Yeah, I guess I ddid want Cons1 :: Int -&gt; Gadt Int. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1455574890, "post_id": 35418507, "comment_id": 58540905, "body": "Helpful observations, just pointing out that it does not answer the question about generics"}, {"owner": {"reputation": 141, "user_id": 4960278, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh5.googleusercontent.com/-rhXMnM2laZQ/AAAAAAAAAAI/AAAAAAAAAZM/zTJL6P6VbSE/photo.jpg?sz=128", "display_name": "Timothy Chu", "link": "https://stackoverflow.com/users/4960278/timothy-chu"}, "edited": false, "score": 0, "creation_date": 1455581186, "post_id": 35418507, "comment_id": 58543254, "body": "I still can&#39;t make generics on GADTs. If I try to make Gadt derive Generics, I get :      &quot;Can&#39;t make a derived instance of \u2018Generic (Gadt a)\u2019:       Constructor \u2018Cons1&#39; has existentials or constraints in its type&quot;"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 141, "user_id": 4960278, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh5.googleusercontent.com/-rhXMnM2laZQ/AAAAAAAAAAI/AAAAAAAAAZM/zTJL6P6VbSE/photo.jpg?sz=128", "display_name": "Timothy Chu", "link": "https://stackoverflow.com/users/4960278/timothy-chu"}, "edited": false, "score": 0, "creation_date": 1455599545, "post_id": 35418507, "comment_id": 58548195, "body": "@TimothyChu this is still with the <code>Cons1 :: a -&gt; Gadt Int</code> right?` - the problem is in the first part where I try to explain why the <code>a</code> here can be <i>anything</i> (this is the <i>existentials</i> the compiler is complaining about - there is a <a href=\"https://wiki.haskell.org/Existential_type\" rel=\"nofollow noreferrer\">good article about this on wiki.Haskell.org</a> )"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 141, "user_id": 4960278, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh5.googleusercontent.com/-rhXMnM2laZQ/AAAAAAAAAAI/AAAAAAAAAZM/zTJL6P6VbSE/photo.jpg?sz=128", "display_name": "Timothy Chu", "link": "https://stackoverflow.com/users/4960278/timothy-chu"}, "edited": false, "score": 0, "creation_date": 1455599703, "post_id": 35418507, "comment_id": 58548261, "body": "@TimothyChu The GHC generics mechanism does not support constructors like those in your question. Generally all GADT constructors with indices are excluded from having a Generic instance. If you want generics for this type, there is indeed a library for generics with indexed data types - it was mentioned in a comment on your question."}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 4, "last_activity_date": 1455599550, "last_edit_date": 1455599550, "creation_date": 1455568260, "answer_id": 35418507, "question_id": 35418256, "link": "https://stackoverflow.com/questions/35418256/generic-instance-for-gadt-in-haskell/35418507#35418507", "title": "Generic Instance for GADT in Haskell", "body": "<h2>disclaimer</h2>\n\n<p><strong>this does not answer the question about <code>generics</code> as @luqui pointed out</strong></p>\n\n<hr>\n\n<p>ok turns out your definition is kindof strange (note that the <code>a</code> in <code>Cons1 :: a -&gt;</code> is a <code>forall a</code> and is not related to the <code>a</code> in <code>Gadt a</code> - I cannot see what you did try to do here - sorry)</p>\n\n<p>Basically you could put any value you want int there like</p>\n\n<pre><code>- Cons1 \"Hello\" -- :: Gadt Int\n- Cons2 'c'     -- :: Gadt Bool\n- Cons2 [1,2,3] -- :: Gadt Bool\n</code></pre>\n\n<p>all would give you either a <code>Gadt Int</code> or a <code>Gadt Bool</code> - but when you pattern match on it there is no way to make anything meaningful with the value as it really could be anything (including something which is not an instance of <code>NFData</code> itself)</p>\n\n<hr>\n\n<p>But in principle you declare instances just like you would with normal ADTs - that is by giving defining <code>rnf</code> in here for the different cases.</p>\n\n<p>So let's say I change your GADT into this:</p>\n\n<pre><code>data Gadt a where \n  Cons1 :: Int  -&gt; Gadt Int\n  Cons2 :: Bool -&gt; Gadt Bool\n</code></pre>\n\n<p>then this instance declaration would be fine:</p>\n\n<pre><code>instance NFData (Gadt a) where\n    rnf (Cons1 a) = rnf a\n    rnf (Cons2 a) = rnf a \n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 4960278, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh5.googleusercontent.com/-rhXMnM2laZQ/AAAAAAAAAAI/AAAAAAAAAZM/zTJL6P6VbSE/photo.jpg?sz=128", "display_name": "Timothy Chu", "link": "https://stackoverflow.com/users/4960278/timothy-chu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 800, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1455599550, "creation_date": 1455567347, "last_edit_date": 1455581207, "question_id": 35418256, "link": "https://stackoverflow.com/questions/35418256/generic-instance-for-gadt-in-haskell", "title": "Generic Instance for GADT in Haskell", "body": "<p>I'm attempting to serialize data types in Haskell, and would like to know how to serialize a GADT. The method I have attempted looks something like (using Control.DeepSeq):</p>\n\n<pre><code>data Gadt a where \n  Cons1 :: Int -&gt; Gadt Int\n  Cons2 :: Bool -&gt; Gadt Bool\n\ninstance NFData Cons1 where rnf = genericRnf\ninstance NFData Cons2 where rnf = genericRnf\n\nderiveSafeCopy ......\n</code></pre>\n\n<p>However, this does not compile: GHC tells me that Cons1 and Cons2 are not valid constructors. I can serialize standard data types just fine. What is the optimal way to serialize GADTs?</p>\n\n<p>The reason I want to serialize GADTs is since this data type is a key in a Redis Database that I'm using for my project.</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 3116, "user_id": 353187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdc97f71e1b8c257ae1bbd52989785d?s=128&d=identicon&r=PG", "display_name": "xnyhps", "link": "https://stackoverflow.com/users/353187/xnyhps"}, "edited": false, "score": 2, "creation_date": 1455568383, "post_id": 35417620, "comment_id": 58537732, "body": "Do you plan to do any queries that need to treat the Ratio as a number? Like SELECT * FROM table WHERE amount &gt; 10"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 3116, "user_id": 353187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdc97f71e1b8c257ae1bbd52989785d?s=128&d=identicon&r=PG", "display_name": "xnyhps", "link": "https://stackoverflow.com/users/353187/xnyhps"}, "edited": false, "score": 0, "creation_date": 1455570361, "post_id": 35417620, "comment_id": 58538693, "body": "@xnyhps, I think a numerator/denominator approach will work fine for that kind of query. It might be tougher to get the database to sort the results correctly by that value, however."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 3116, "user_id": 353187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdc97f71e1b8c257ae1bbd52989785d?s=128&d=identicon&r=PG", "display_name": "xnyhps", "link": "https://stackoverflow.com/users/353187/xnyhps"}, "edited": false, "score": 0, "creation_date": 1455571235, "post_id": 35417620, "comment_id": 58539144, "body": "@xnyhps I think that for now I don&#39;t, but it would be good if I could because, imagine I will use a external tool to create reports, like Jasper Reports, it would be useful for me in several ways to be able to do such comparisons in SQL instead of Java"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1455571893, "post_id": 35417620, "comment_id": 58539499, "body": "If I used varchar, I could use procedures to convert them into numbers, for the purpose of comparing, and also procedures to add, subtract, etc... Don&#39;t you think?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1455576151, "post_id": 35417620, "comment_id": 58541492, "body": "You could also consider using fixed-point numbers, which amount to choosing a single denominator to use for all your values."}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1455649396, "post_id": 35417620, "comment_id": 58579772, "body": "I like @DanielWagner&#39;s idea. I think the common practice is to use a fixed-point number, like MySQL&#39;s <code>DECIMAL</code>, for financial data."}], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1455570991, "post_id": 35417744, "comment_id": 58539033, "body": "So, I will have a numerator and a denominator which will represent the Ratio type, for instance, I may use Integer type in MySQL. next question, I would like to save it in a single field, I have considered the option of creating a Table and use foreign keys, but I think it will be too much for such thing... How would I store the numerator and denominator in a single field efficiently so?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 3, "creation_date": 1455574324, "post_id": 35417744, "comment_id": 58540670, "body": "@FtheBuilder Personally, I would suggest revisiting the goal of saving it in a single field. What advantage does that actually hold over using two fields?"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1455575062, "post_id": 35417744, "comment_id": 58540988, "body": "I will reconsider, I made that goal because (if I normalize using a table for instance Ratio), there would be a lot of extra joins, even if I just want to print a formatted monetary value onto the screen... But I posted this question exactly to get better approaches. Another thing would be to avoid normalization by using amountNumerator and amountDenominator in each case, which will be a pattern and will not look good"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 1, "creation_date": 1455576490, "post_id": 35417744, "comment_id": 58541644, "body": "@FtheBuilder I admit I&#39;m not a database expert; but it&#39;s not clear to me why normalization would result in a separate table for fractions rather than just two columns. There&#39;s no data redundancy there, unless you expect fractions to be aliased between rows -- in which case you will need a separate table no matter what representation you use."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1455577320, "post_id": 35417744, "comment_id": 58541950, "body": "You are right. (Maybe it is craziness), but when I am creating things in database, I try to imagine the database as if the columns had no names, so, how much information would I get from the relationships if I couldn&#39;t read the name, if I used another table, to represent Ratio, it would be clear that those fields are closely related, and although I would use 1 to 1 relationship, I think that in this case it would be clearer... What do you think, am I crazy?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 1, "creation_date": 1455577953, "post_id": 35417744, "comment_id": 58542189, "body": "@FtheBuilder All columns in a single row are closely related. That is (part of) why they are called relational databases."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1455578144, "post_id": 35417744, "comment_id": 58542263, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/103546/discussion-between-fthebuilder-and-daniel-wagner\">continue this discussion in chat</a>."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1455579090, "post_id": 35417744, "comment_id": 58542566, "body": "<code>Ratio</code> is an entity, the stuff inside a (for instance) <code>Sale</code> table is related to the <code>Sale</code>, but the relationship between these two columns (numerator and denominator) is mindedly related with the <code>Ratio</code>, and it will be an entity which may appear on other tables which are also made of a <code>Ratio</code>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1455565359, "creation_date": 1455565359, "answer_id": 35417744, "question_id": 35417620, "link": "https://stackoverflow.com/questions/35417620/yesod-persistent-best-way-to-store-a-ratio/35417744#35417744", "title": "Yesod/Persistent best way to store a Ratio", "body": "<p>Assuming you have a way to store whatever number type you are using as the backend for <code>Ratio</code>, you can use the following three functions to \"serialize\" a <code>Ratio a</code> into its constituent <code>a</code> values and back:</p>\n\n<pre><code>(%) :: Integral a =&gt; a -&gt; a -&gt; Ratio a\nnumerator :: Integral a =&gt; Ratio a -&gt; a\ndenominator :: Integral a =&gt; Ratio a -&gt; a \n</code></pre>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 35417744, "answer_count": 1, "score": 1, "last_activity_date": 1455565359, "creation_date": 1455564898, "question_id": 35417620, "link": "https://stackoverflow.com/questions/35417620/yesod-persistent-best-way-to-store-a-ratio", "title": "Yesod/Persistent best way to store a Ratio", "body": "<p>I have been thinking about how to use the benefits of <code>Ratio</code> type to not lose precision with calculations like monetary ones, which seems to me a quite reasonable approach.\nMy question is, what are the good ways to use it with <strong>Persistent</strong>, considering that my backend will be <strong>MySQL</strong>. I have thought about saving it as a varchar, and then passing it to a function to get a Ratio back but I think that might be better approaches.</p>\n"}, {"tags": ["haskell", "pattern-matching", "pattern-synonyms"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1455565737, "post_id": 35417305, "comment_id": 58536403, "body": "You should clarify that you are not looking for a guard <code>f x | x==someconstant = putStrLn &quot;is 3&quot;</code>, but you really want a pattern. (Right?)"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 12, "last_activity_date": 1455586703, "last_edit_date": 1455586703, "creation_date": 1455564058, "answer_id": 35417393, "question_id": 35417305, "link": "https://stackoverflow.com/questions/35417305/constants-in-haskell-and-pattern-matching/35417393#35417393", "title": "Constants in Haskell and pattern matching", "body": "<p>You can define a <a href=\"https://ghc.haskell.org/trac/ghc/wiki/PatternSynonyms\" rel=\"nofollow\">pattern synonym</a>:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\n\npattern SomeConstant :: Int\npattern SomeConstant = 3\n\nf :: Int -&gt; IO ()\nf SomeConstant = putStrLn \"Arg is 3\"\nf _            = putStrLn \"Arg is not 3\"\n</code></pre>\n\n<p>But also consider whether it's not better to match on a custom variant type instead of an <code>Int</code>.</p>\n"}], "owner": {"reputation": 1479, "user_id": 4673683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/106a6b52825462b10ef0904466351c00?s=128&d=identicon&r=PG", "display_name": "user19018", "link": "https://stackoverflow.com/users/4673683/user19018"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "closed_date": 1455630180, "accepted_answer_id": 35417393, "answer_count": 1, "score": 3, "last_activity_date": 1455586703, "creation_date": 1455563675, "last_edit_date": 1455586656, "question_id": 35417305, "link": "https://stackoverflow.com/questions/35417305/constants-in-haskell-and-pattern-matching", "closed_reason": "Duplicate", "title": "Constants in Haskell and pattern matching", "body": "<p>How is it possible to define a macro constant in Haskell? Especially, I would like the following snippet to run without the second pattern match to be overlapped.</p>\n\n<pre><code>someconstant :: Int\nsomeconstant = 3\n\nf :: Int -&gt; IO ()\nf someconstant = putStrLn \"Arg is 3\"\nf _            = putStrLn \"Arg is not 3\"\n</code></pre>\n"}, {"tags": ["haskell", "dependencies", "cabal", "yesod"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1455556687, "post_id": 35414626, "comment_id": 58531401, "body": "Note that the recommended way of <a href=\"http://www.yesodweb.com/page/quickstart\" rel=\"nofollow noreferrer\">installing Yesod</a> is by using Stack."}, {"owner": {"reputation": 39, "user_id": 5930692, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fe29ed666f069ae2744b84c04a6a9c23?s=128&d=identicon&r=PG&f=1", "display_name": "the_inquiry", "link": "https://stackoverflow.com/users/5930692/the-inquiry"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1455714848, "post_id": 35414626, "comment_id": 58611767, "body": "Yes I&#39;ve tried that too."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1455717511, "post_id": 35414626, "comment_id": 58613671, "body": "Does that work ? If it doesn&#39;t, then it&#39;s a bug. But the last time I tried, it worked for me perfectly."}, {"owner": {"reputation": 39, "user_id": 5930692, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fe29ed666f069ae2744b84c04a6a9c23?s=128&d=identicon&r=PG&f=1", "display_name": "the_inquiry", "link": "https://stackoverflow.com/users/5930692/the-inquiry"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1455734715, "post_id": 35414626, "comment_id": 58625858, "body": "Initially no, but I tried to it on a 64-bit system and it worked."}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 5930692, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fe29ed666f069ae2744b84c04a6a9c23?s=128&d=identicon&r=PG&f=1", "display_name": "the_inquiry", "link": "https://stackoverflow.com/users/5930692/the-inquiry"}, "edited": false, "score": 0, "creation_date": 1455734749, "post_id": 35414761, "comment_id": 58625882, "body": "I was using a i686 architecture. problem solved, thanks."}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 2, "last_activity_date": 1455555023, "creation_date": 1455555023, "answer_id": 35414761, "question_id": 35414626, "link": "https://stackoverflow.com/questions/35414626/cabal-cryptonite-failed-to-install/35414761#35414761", "title": "Cabal: Cryptonite failed to install", "body": "<p>The relevant part seems to be the next:</p>\n\n<pre><code>cbits/ed448/x448.c:21:9:\n     error: unknown type name \u2018__uint128_t\u2019\n     typedef __uint128_t decaf_dword_t;\n             ^\n</code></pre>\n\n<p>AFAIK <code>__uint128_t</code> is a <code>gcc</code> <a href=\"https://gcc.gnu.org/onlinedocs/gcc-4.8.1/gcc/_005f_005fint128.html#_005f_005fint128\" rel=\"nofollow\">extension</a>, so it is probably not available with your compiler. Try to contact <a href=\"https://github.com/haskell-crypto/cryptonite/issues\" rel=\"nofollow\">package maintainer</a>.</p>\n\n<p>ADD: Are you using <code>i686</code> architecture? Looks like the issue is already <a href=\"https://github.com/haskell-crypto/cryptonite/issues/67\" rel=\"nofollow\">reported</a>.</p>\n"}], "owner": {"reputation": 39, "user_id": 5930692, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fe29ed666f069ae2744b84c04a6a9c23?s=128&d=identicon&r=PG&f=1", "display_name": "the_inquiry", "link": "https://stackoverflow.com/users/5930692/the-inquiry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "accepted_answer_id": 35414761, "answer_count": 1, "score": 2, "last_activity_date": 1455555023, "creation_date": 1455554605, "last_edit_date": 1495541204, "question_id": 35414626, "link": "https://stackoverflow.com/questions/35414626/cabal-cryptonite-failed-to-install", "title": "Cabal: Cryptonite failed to install", "body": "<p>I tried to install Yesod with Cabal. Yesod depends on Cryptonite to work, however it failed to install. Here is the error message:</p>\n\n<pre><code>the-inquiry@the-inquiry-pc:~/workspace$ cabal install cryptonite\nResolving dependencies...\nConfiguring cryptonite-0.11...\nBuilding cryptonite-0.11...\nFailed to install cryptonite-0.11\nBuild log ( /home/the-inquiry/.cabal/logs/cryptonite-0.11.log ):\nConfiguring cryptonite-0.11...\nBuilding cryptonite-0.11...\nPreprocessing library cryptonite-0.11...\n[  1 of 101] Compiling Crypto.Internal.CompatPrim ( Crypto/Internal/CompatPrim.hs, dist/build/Crypto/Internal/CompatPrim.o )\n[  2 of 101] Compiling Crypto.Random.Entropy.Source ( Crypto/Random/Entropy/Source.hs, dist/build/Crypto/Random/Entropy/Source.o )\n[  3 of 101] Compiling Crypto.Random.Entropy.Unix ( Crypto/Random/Entropy/Unix.hs, dist/build/Crypto/Random/Entropy/Unix.o )\n[  4 of 101] Compiling Crypto.Internal.Words ( Crypto/Internal/Words.hs, dist/build/Crypto/Internal/Words.o )\n[  5 of 101] Compiling Crypto.Random.Entropy.Backend ( Crypto/Random/Entropy/Backend.hs, dist/build/Crypto/Random/Entropy/Backend.o )\n[  6 of 101] Compiling Crypto.Random.Entropy.Unsafe ( Crypto/Random/Entropy/Unsafe.hs, dist/build/Crypto/Random/Entropy/Unsafe.o )\n[  7 of 101] Compiling Crypto.PubKey.Internal ( Crypto/PubKey/Internal.hs, dist/build/Crypto/PubKey/Internal.o )\n[  8 of 101] Compiling Crypto.Number.Compat ( Crypto/Number/Compat.hs, dist/build/Crypto/Number/Compat.o )\n[  9 of 101] Compiling Crypto.Number.Basic ( Crypto/Number/Basic.hs, dist/build/Crypto/Number/Basic.o )\n[ 10 of 101] Compiling Crypto.Number.ModArithmetic ( Crypto/Number/ModArithmetic.hs, dist/build/Crypto/Number/ModArithmetic.o )\n[ 11 of 101] Compiling Crypto.Number.Serialize.Internal ( Crypto/Number/Serialize/Internal.hs, dist/build/Crypto/Number/Serialize/Internal.o )\n[ 12 of 101] Compiling Crypto.Internal.DeepSeq ( Crypto/Internal/DeepSeq.hs, dist/build/Crypto/Internal/DeepSeq.o )\n[ 13 of 101] Compiling Crypto.Data.Padding ( Crypto/Data/Padding.hs, dist/build/Crypto/Data/Padding.o )\n[ 14 of 101] Compiling Crypto.Cipher.DES.Primitive ( Crypto/Cipher/DES/Primitive.hs, dist/build/Crypto/Cipher/DES/Primitive.o )\n[ 15 of 101] Compiling Crypto.Internal.Compat ( Crypto/Internal/Compat.hs, dist/build/Crypto/Internal/Compat.o )\n[ 16 of 101] Compiling Crypto.Internal.WordArray ( Crypto/Internal/WordArray.hs, dist/build/Crypto/Internal/WordArray.o )\n[ 17 of 101] Compiling Crypto.Cipher.Blowfish.Box ( Crypto/Cipher/Blowfish/Box.hs, dist/build/Crypto/Cipher/Blowfish/Box.o )\n[ 18 of 101] Compiling Crypto.Internal.ByteArray ( Crypto/Internal/ByteArray.hs, dist/build/Crypto/Internal/ByteArray.o )\n[ 19 of 101] Compiling Crypto.Number.Serialize ( Crypto/Number/Serialize.hs, dist/build/Crypto/Number/Serialize.o )\n[ 20 of 101] Compiling Crypto.Random.Entropy ( Crypto/Random/Entropy.hs, dist/build/Crypto/Random/Entropy.o )\n[ 21 of 101] Compiling Crypto.Random.EntropyPool ( Crypto/Random/EntropyPool.hs, dist/build/Crypto/Random/EntropyPool.o )\n[ 22 of 101] Compiling Crypto.Cipher.Types.Utils ( Crypto/Cipher/Types/Utils.hs, dist/build/Crypto/Cipher/Types/Utils.o )\n[ 23 of 101] Compiling Crypto.Internal.Imports ( Crypto/Internal/Imports.hs, dist/build/Crypto/Internal/Imports.o )\n[ 24 of 101] Compiling Crypto.Cipher.ChaCha ( Crypto/Cipher/ChaCha.hs, dist/build/Crypto/Cipher/ChaCha.o )\n[ 25 of 101] Compiling Crypto.Cipher.RC4 ( Crypto/Cipher/RC4.hs, dist/build/Crypto/Cipher/RC4.o )\n[ 26 of 101] Compiling Crypto.Cipher.Salsa ( Crypto/Cipher/Salsa.hs, dist/build/Crypto/Cipher/Salsa.o )\n[ 27 of 101] Compiling Crypto.Random.Types ( Crypto/Random/Types.hs, dist/build/Crypto/Random/Types.o )\n[ 28 of 101] Compiling Crypto.Error.Types ( Crypto/Error/Types.hs, dist/build/Crypto/Error/Types.o )\n[ 29 of 101] Compiling Crypto.Number.F2m ( Crypto/Number/F2m.hs, dist/build/Crypto/Number/F2m.o )\n[ 30 of 101] Compiling Crypto.Number.Generate ( Crypto/Number/Generate.hs, dist/build/Crypto/Number/Generate.o )\n[ 31 of 101] Compiling Crypto.Hash.Types ( Crypto/Hash/Types.hs, dist/build/Crypto/Hash/Types.o )\n[ 32 of 101] Compiling Crypto.Hash.IO   ( Crypto/Hash/IO.hs, dist/build/Crypto/Hash/IO.o )\n[ 33 of 101] Compiling Crypto.Hash.Blake2s ( Crypto/Hash/Blake2s.hs, dist/build/Crypto/Hash/Blake2s.o )\n[ 34 of 101] Compiling Crypto.Hash.Blake2sp ( Crypto/Hash/Blake2sp.hs, dist/build/Crypto/Hash/Blake2sp.o )\n[ 35 of 101] Compiling Crypto.Hash.Blake2b ( Crypto/Hash/Blake2b.hs, dist/build/Crypto/Hash/Blake2b.o )\n[ 36 of 101] Compiling Crypto.Hash.Blake2bp ( Crypto/Hash/Blake2bp.hs, dist/build/Crypto/Hash/Blake2bp.o )\n[ 37 of 101] Compiling Crypto.Hash.MD2  ( Crypto/Hash/MD2.hs, dist/build/Crypto/Hash/MD2.o )\n[ 38 of 101] Compiling Crypto.Hash.MD4  ( Crypto/Hash/MD4.hs, dist/build/Crypto/Hash/MD4.o )\n[ 39 of 101] Compiling Crypto.Hash.MD5  ( Crypto/Hash/MD5.hs, dist/build/Crypto/Hash/MD5.o )\n[ 40 of 101] Compiling Crypto.Hash.SHA1 ( Crypto/Hash/SHA1.hs, dist/build/Crypto/Hash/SHA1.o )\n[ 41 of 101] Compiling Crypto.Hash.SHA224 ( Crypto/Hash/SHA224.hs, dist/build/Crypto/Hash/SHA224.o )\n[ 42 of 101] Compiling Crypto.Hash.SHA256 ( Crypto/Hash/SHA256.hs, dist/build/Crypto/Hash/SHA256.o )\n[ 43 of 101] Compiling Crypto.Hash.SHA384 ( Crypto/Hash/SHA384.hs, dist/build/Crypto/Hash/SHA384.o )\n[ 44 of 101] Compiling Crypto.Hash.SHA512 ( Crypto/Hash/SHA512.hs, dist/build/Crypto/Hash/SHA512.o )\n[ 45 of 101] Compiling Crypto.Hash.SHA512t ( Crypto/Hash/SHA512t.hs, dist/build/Crypto/Hash/SHA512t.o )\n[ 46 of 101] Compiling Crypto.Hash.SHA3 ( Crypto/Hash/SHA3.hs, dist/build/Crypto/Hash/SHA3.o )\n[ 47 of 101] Compiling Crypto.Hash.Keccak ( Crypto/Hash/Keccak.hs, dist/build/Crypto/Hash/Keccak.o )\n[ 48 of 101] Compiling Crypto.Hash.RIPEMD160 ( Crypto/Hash/RIPEMD160.hs, dist/build/Crypto/Hash/RIPEMD160.o )\n[ 49 of 101] Compiling Crypto.Hash.Tiger ( Crypto/Hash/Tiger.hs, dist/build/Crypto/Hash/Tiger.o )\n[ 50 of 101] Compiling Crypto.Hash.Skein256 ( Crypto/Hash/Skein256.hs, dist/build/Crypto/Hash/Skein256.o )\n[ 51 of 101] Compiling Crypto.Hash.Skein512 ( Crypto/Hash/Skein512.hs, dist/build/Crypto/Hash/Skein512.o )\n[ 52 of 101] Compiling Crypto.Hash.Whirlpool ( Crypto/Hash/Whirlpool.hs, dist/build/Crypto/Hash/Whirlpool.o )\n[ 53 of 101] Compiling Crypto.Hash.Algorithms ( Crypto/Hash/Algorithms.hs, dist/build/Crypto/Hash/Algorithms.o )\n[ 54 of 101] Compiling Crypto.Hash      ( Crypto/Hash.hs, dist/build/Crypto/Hash.o )\n[ 55 of 101] Compiling Crypto.Data.AFIS ( Crypto/Data/AFIS.hs, dist/build/Crypto/Data/AFIS.o )\n[ 56 of 101] Compiling Crypto.MAC.HMAC  ( Crypto/MAC/HMAC.hs, dist/build/Crypto/MAC/HMAC.o )\n[ 57 of 101] Compiling Crypto.KDF.PBKDF2 ( Crypto/KDF/PBKDF2.hs, dist/build/Crypto/KDF/PBKDF2.o )\n[ 58 of 101] Compiling Crypto.KDF.Scrypt ( Crypto/KDF/Scrypt.hs, dist/build/Crypto/KDF/Scrypt.o )\n[ 59 of 101] Compiling Crypto.KDF.HKDF  ( Crypto/KDF/HKDF.hs, dist/build/Crypto/KDF/HKDF.o )\n[ 60 of 101] Compiling Crypto.PubKey.MaskGenFunction ( Crypto/PubKey/MaskGenFunction.hs, dist/build/Crypto/PubKey/MaskGenFunction.o )\n[ 61 of 101] Compiling Crypto.PubKey.DSA ( Crypto/PubKey/DSA.hs, dist/build/Crypto/PubKey/DSA.o )\n[ 62 of 101] Compiling Crypto.PubKey.ECC.Types ( Crypto/PubKey/ECC/Types.hs, dist/build/Crypto/PubKey/ECC/Types.o )\n[ 63 of 101] Compiling Crypto.PubKey.RSA.Types ( Crypto/PubKey/RSA/Types.hs, dist/build/Crypto/PubKey/RSA/Types.o )\n[ 64 of 101] Compiling Crypto.PubKey.RSA.Prim ( Crypto/PubKey/RSA/Prim.hs, dist/build/Crypto/PubKey/RSA/Prim.o )\n[ 65 of 101] Compiling Crypto.Random.ChaChaDRG ( Crypto/Random/ChaChaDRG.hs, dist/build/Crypto/Random/ChaChaDRG.o )\n[ 66 of 101] Compiling Crypto.Random.SystemDRG ( Crypto/Random/SystemDRG.hs, dist/build/Crypto/Random/SystemDRG.o )\n[ 67 of 101] Compiling Crypto.Random    ( Crypto/Random.hs, dist/build/Crypto/Random.o )\n[ 68 of 101] Compiling Crypto.Random.Probabilistic ( Crypto/Random/Probabilistic.hs, dist/build/Crypto/Random/Probabilistic.o )\n[ 69 of 101] Compiling Crypto.Number.Prime ( Crypto/Number/Prime.hs, dist/build/Crypto/Number/Prime.o )\n[ 70 of 101] Compiling Crypto.PubKey.DH ( Crypto/PubKey/DH.hs, dist/build/Crypto/PubKey/DH.o )\n[ 71 of 101] Compiling Crypto.PubKey.RSA ( Crypto/PubKey/RSA.hs, dist/build/Crypto/PubKey/RSA.o )\n[ 72 of 101] Compiling Crypto.PubKey.RSA.PKCS15 ( Crypto/PubKey/RSA/PKCS15.hs, dist/build/Crypto/PubKey/RSA/PKCS15.o )\n[ 73 of 101] Compiling Crypto.PubKey.RSA.PSS ( Crypto/PubKey/RSA/PSS.hs, dist/build/Crypto/PubKey/RSA/PSS.o )\n[ 74 of 101] Compiling Crypto.PubKey.RSA.OAEP ( Crypto/PubKey/RSA/OAEP.hs, dist/build/Crypto/PubKey/RSA/OAEP.o )\n[ 75 of 101] Compiling Crypto.PubKey.ECC.Prim ( Crypto/PubKey/ECC/Prim.hs, dist/build/Crypto/PubKey/ECC/Prim.o )\n[ 76 of 101] Compiling Crypto.PubKey.ECC.ECDSA ( Crypto/PubKey/ECC/ECDSA.hs, dist/build/Crypto/PubKey/ECC/ECDSA.o )\n[ 77 of 101] Compiling Crypto.PubKey.ECC.Generate ( Crypto/PubKey/ECC/Generate.hs, dist/build/Crypto/PubKey/ECC/Generate.o )\n[ 78 of 101] Compiling Crypto.PubKey.ECC.DH ( Crypto/PubKey/ECC/DH.hs, dist/build/Crypto/PubKey/ECC/DH.o )\n[ 79 of 101] Compiling Crypto.Cipher.Types.GF ( Crypto/Cipher/Types/GF.hs, dist/build/Crypto/Cipher/Types/GF.o )\n[ 80 of 101] Compiling Crypto.PubKey.ElGamal ( Crypto/PubKey/ElGamal.hs, dist/build/Crypto/PubKey/ElGamal.o )\n[ 81 of 101] Compiling Crypto.Error     ( Crypto/Error.hs, dist/build/Crypto/Error.o )\n[ 82 of 101] Compiling Crypto.Cipher.Blowfish.Primitive ( Crypto/Cipher/Blowfish/Primitive.hs, dist/build/Crypto/Cipher/Blowfish/Primitive.o )\n[ 83 of 101] Compiling Crypto.KDF.BCrypt ( Crypto/KDF/BCrypt.hs, dist/build/Crypto/KDF/BCrypt.o )\n[ 84 of 101] Compiling Crypto.Cipher.Camellia.Primitive ( Crypto/Cipher/Camellia/Primitive.hs, dist/build/Crypto/Cipher/Camellia/Primitive.o )\n[ 85 of 101] Compiling Crypto.MAC.Poly1305 ( Crypto/MAC/Poly1305.hs, dist/build/Crypto/MAC/Poly1305.o )\n[ 86 of 101] Compiling Crypto.Cipher.ChaChaPoly1305 ( Crypto/Cipher/ChaChaPoly1305.hs, dist/build/Crypto/Cipher/ChaChaPoly1305.o )\n[ 87 of 101] Compiling Crypto.Cipher.Types.Base ( Crypto/Cipher/Types/Base.hs, dist/build/Crypto/Cipher/Types/Base.o )\n[ 88 of 101] Compiling Crypto.Cipher.Types.AEAD ( Crypto/Cipher/Types/AEAD.hs, dist/build/Crypto/Cipher/Types/AEAD.o )\n[ 89 of 101] Compiling Crypto.Cipher.Types.Block ( Crypto/Cipher/Types/Block.hs, dist/build/Crypto/Cipher/Types/Block.o )\n[ 90 of 101] Compiling Crypto.Cipher.Types.Stream ( Crypto/Cipher/Types/Stream.hs, dist/build/Crypto/Cipher/Types/Stream.o )\n[ 91 of 101] Compiling Crypto.Cipher.Types ( Crypto/Cipher/Types.hs, dist/build/Crypto/Cipher/Types.o )\n[ 92 of 101] Compiling Crypto.Cipher.AES.Primitive ( Crypto/Cipher/AES/Primitive.hs, dist/build/Crypto/Cipher/AES/Primitive.o )\n[ 93 of 101] Compiling Crypto.Cipher.Blowfish ( Crypto/Cipher/Blowfish.hs, dist/build/Crypto/Cipher/Blowfish.o )\n[ 94 of 101] Compiling Crypto.Cipher.Camellia ( Crypto/Cipher/Camellia.hs, dist/build/Crypto/Cipher/Camellia.o )\n[ 95 of 101] Compiling Crypto.Cipher.DES ( Crypto/Cipher/DES.hs, dist/build/Crypto/Cipher/DES.o )\n[ 96 of 101] Compiling Crypto.Cipher.TripleDES ( Crypto/Cipher/TripleDES.hs, dist/build/Crypto/Cipher/TripleDES.o )\n[ 97 of 101] Compiling Crypto.PubKey.Curve25519 ( Crypto/PubKey/Curve25519.hs, dist/build/Crypto/PubKey/Curve25519.o )\n[ 98 of 101] Compiling Crypto.PubKey.ECC.P256 ( Crypto/PubKey/ECC/P256.hs, dist/build/Crypto/PubKey/ECC/P256.o )\n[ 99 of 101] Compiling Crypto.PubKey.Ed25519 ( Crypto/PubKey/Ed25519.hs, dist/build/Crypto/PubKey/Ed25519.o )\n[100 of 101] Compiling Crypto.PubKey.Ed448 ( Crypto/PubKey/Ed448.hs, dist/build/Crypto/PubKey/Ed448.o )\n[101 of 101] Compiling Crypto.Cipher.AES ( Crypto/Cipher/AES.hs, dist/build/Crypto/Cipher/AES.o )\n\ncbits/ed448/x448.c:21:9:\n     error: unknown type name \u2018__uint128_t\u2019\n     typedef __uint128_t decaf_dword_t;\n             ^\n\ncbits/ed448/x448.c:22:9:\n     error: unknown type name \u2018__int128_t\u2019\n     typedef __int128_t decaf_sdword_t;\n             ^\ncbits/ed448/x448.c: In function \u2018gf_mul\u2019:\n\ncbits/ed448/x448.c:83:48:\n     warning: right shift count &gt;= width of type [-Wshift-count-overflow]\n         accum[X448_LIMBS-1] += accum[X448_LIMBS-2] &gt;&gt; LBITS;\n                                                    ^\n\ncbits/ed448/x448.c:85:48:\n     warning: right shift count &gt;= width of type [-Wshift-count-overflow]\n         accum[X448_LIMBS/2] += accum[X448_LIMBS-1] &gt;&gt; LBITS;\n                                                    ^\n\ncbits/ed448/x448.c:87:45:\n     warning: right shift count &gt;= width of type [-Wshift-count-overflow]\n             accum[j] += accum[(j-1)%X448_LIMBS] &gt;&gt; LBITS;\n                                                 ^\n\ncbits/ed448/x448.c:50:8:\n     note: in definition of macro \u2018FOR_LIMB_U\u2019\n            op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; \\\n            ^\n\ncbits/ed448/x448.c:87:45:\n     warning: right shift count &gt;= width of type [-Wshift-count-overflow]\n             accum[j] += accum[(j-1)%X448_LIMBS] &gt;&gt; LBITS;\n                                                 ^\n\ncbits/ed448/x448.c:50:16:\n     note: in definition of macro \u2018FOR_LIMB_U\u2019\n            op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; \\\n                    ^\n\ncbits/ed448/x448.c:87:45:\n     warning: right shift count &gt;= width of type [-Wshift-count-overflow]\n             accum[j] += accum[(j-1)%X448_LIMBS] &gt;&gt; LBITS;\n                                                 ^\n\ncbits/ed448/x448.c:50:24:\n     note: in definition of macro \u2018FOR_LIMB_U\u2019\n            op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; \\\n                            ^\n\ncbits/ed448/x448.c:87:45:\n     warning: right shift count &gt;= width of type [-Wshift-count-overflow]\n             accum[j] += accum[(j-1)%X448_LIMBS] &gt;&gt; LBITS;\n                                                 ^\n\ncbits/ed448/x448.c:50:32:\n     note: in definition of macro \u2018FOR_LIMB_U\u2019\n            op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; \\\n                                    ^\n\ncbits/ed448/x448.c:87:45:\n     warning: right shift count &gt;= width of type [-Wshift-count-overflow]\n             accum[j] += accum[(j-1)%X448_LIMBS] &gt;&gt; LBITS;\n                                                 ^\n\ncbits/ed448/x448.c:50:40:\n     note: in definition of macro \u2018FOR_LIMB_U\u2019\n            op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; \\\n                                            ^\n\ncbits/ed448/x448.c:87:45:\n     warning: right shift count &gt;= width of type [-Wshift-count-overflow]\n             accum[j] += accum[(j-1)%X448_LIMBS] &gt;&gt; LBITS;\n                                                 ^\n\ncbits/ed448/x448.c:50:48:\n     note: in definition of macro \u2018FOR_LIMB_U\u2019\n            op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; \\\n                                                    ^\n\ncbits/ed448/x448.c:87:45:\n     warning: right shift count &gt;= width of type [-Wshift-count-overflow]\n             accum[j] += accum[(j-1)%X448_LIMBS] &gt;&gt; LBITS;\n                                                 ^\n\ncbits/ed448/x448.c:50:56:\n     note: in definition of macro \u2018FOR_LIMB_U\u2019\n            op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; \\\n                                                            ^\n\ncbits/ed448/x448.c:87:45:\n     warning: right shift count &gt;= width of type [-Wshift-count-overflow]\n             accum[j] += accum[(j-1)%X448_LIMBS] &gt;&gt; LBITS;\n                                                 ^\n\ncbits/ed448/x448.c:50:64:\n     note: in definition of macro \u2018FOR_LIMB_U\u2019\n            op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; op;i++; \\\n                                                                    ^\ncbits/ed448/x448.c: In function \u2018gf_canon\u2019:\n\ncbits/ed448/x448.c:186:15:\n     warning: right shift count &gt;= width of type [-Wshift-count-overflow]\n             carry &gt;&gt;= LBITS;\n                   ^\n\ncbits/ed448/x448.c:64:76:\n     note: in definition of macro \u2018FOR_LIMB\u2019\n     #define FOR_LIMB(i,op) { unsigned int i=0; for (i=0; i&lt;X448_LIMBS; i++)  { op; }}\n                                                                                ^\n\ncbits/ed448/x448.c:196:15:\n     warning: right shift count &gt;= width of type [-Wshift-count-overflow]\n             carry &gt;&gt;= LBITS;\n                   ^\n\ncbits/ed448/x448.c:64:76:\n     note: in definition of macro \u2018FOR_LIMB\u2019\n     #define FOR_LIMB(i,op) { unsigned int i=0; for (i=0; i&lt;X448_LIMBS; i++)  { op; }}\n                                                                                ^\ncbits/ed448/x448.c: In function \u2018gf_deser\u2019:\n\ncbits/ed448/x448.c:207:91:\n     warning: right shift count &gt;= width of type [-Wshift-count-overflow]\n             for (bits += 8; (bits&gt;=LBITS || i==X448_BYTES-1) &amp;&amp; k&lt;X448_LIMBS; bits-=LBITS, buf&gt;&gt;=LBITS) {\n                                                                                               ^\n\ncbits/ed448/x448.c:213:59:\n     warning: right shift count &gt;= width of type [-Wshift-count-overflow]\n         FOR_LIMB(i, accum = (accum + s-&gt;limb[i] - P-&gt;limb[i]) &gt;&gt; WBITS );\n                                                               ^\n\ncbits/ed448/x448.c:64:76:\n     note: in definition of macro \u2018FOR_LIMB\u2019\n     #define FOR_LIMB(i,op) { unsigned int i=0; for (i=0; i&lt;X448_LIMBS; i++)  { op; }}\n                                                                                ^\ncabal: Error: some packages failed to install:\ncryptonite-0.11 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>I've already tried the following solution but it gave the same error message: <br />\n<a href=\"https://stackoverflow.com/questions/23510242/cabal-dependency-resolution-fail-for-lens\">cabal dependency resolution fail for &#39;lens&#39;</a></p>\n\n<p>My OS is Ubuntu 15.10</p>\n\n<p>Thank you</p>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1455554252, "post_id": 35414221, "comment_id": 58529838, "body": "I&#39;d guess not, since <code>x,y</code> are not in scope. As written, that would essentially involve existential types, which are not &quot;first-class&quot; in Haskell."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1455555686, "post_id": 35414221, "comment_id": 58530827, "body": "<code>type family Fst x where Fst (x,y) = x; type family Snd x where Snd (x,y) = y; type instance TF Int t = (Int, Fst t, Snd t)</code>. The simpler thing to do is to give your index a single, closed family which only reduces for pairs: <code>type instance TF Int x = TF_Int x; type family TF_Int x where TF_Int (x,y) = (Int, x, y)</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455570667, "post_id": 35414221, "comment_id": 58538846, "body": "@user2407038, I believe the <code>Fst</code>/<code>Snd</code> approach is &quot;lazier&quot;, and will therefore allow more useful reductions."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455598900, "post_id": 35415129, "comment_id": 58547988, "body": "&quot;It is really programming with partial functions at the type level.&quot; I don&#39;t think this is exactly true here - it would be more true without the <code>TypeError</code> case. In that case, you get <code>TF Int Bool ~ (Int, Fst Bool, Snd Bool)</code> - the last two types are &quot;stuck&quot; (i.e. they can <i>never</i> be reduced) but they do not produce a type error. But <code>Fst Bool</code> is still inhabited by bottom! The point of <code>TypeError</code> is so if it <i>ever</i> appears in a type, it is really a type error. <code>Fst Bool</code> <i>with</i> the TypeError is <i>not</i> inhabited by bottom - because the type itself simply does not exist."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455634288, "post_id": 35415129, "comment_id": 58569359, "body": "I don&#39;t follow. If I don&#39;t have a <code>TypeError</code> case, then <code>Fst</code> is total; <code>Fst Int</code> is a stuck type like you say. The purpose of <code>TypeError</code> is to make <code>Fst Int</code> an error, so <code>Fst</code> becomes partial."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 4, "last_activity_date": 1455556162, "creation_date": 1455556162, "answer_id": 35415129, "question_id": 35414221, "link": "https://stackoverflow.com/questions/35414221/equality-constraints-in-type-instances/35415129#35415129", "title": "Equality constraints in type instances", "body": "<p>You might be able to do this in GHC 8.0 using the new <a href=\"https://downloads.haskell.org/~ghc/8.0.1-rc1/docs/html/users_guide/glasgow_exts.html#custom-compile-time-errors\" rel=\"nofollow\">TypeError</a> feature, depending on what you mean by \"force the second argument to be a pair\". </p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, DataKinds, TypeOperators, UndecidableInstances #-}\n\nmodule Pair where\n\nimport GHC.TypeLits\n\ntype family Fst p where\n  Fst (x, y) = x\n  Fst _t = TypeError (Text \"Fst: expected a pair, but got \" :&lt;&gt;: ShowType _t)\n\ntype family Snd p where\n  Snd (x, y) = y\n  Snd _t = TypeError (Text \"Snd: expected a pair, but got \" :&lt;&gt;: ShowType _t)\n\ntype family TF a b\ntype instance TF Int t = (Int, Fst t, Snd t)\n</code></pre>\n\n<p>Now you should get a compile error if you try to apply <code>TF Int</code> to a non-tuple:</p>\n\n<pre><code>*Pair&gt; let x = x in x :: TF Int Bool\n\n&lt;interactive&gt;:9:1: error:\n    \u2022 Fst: expected a pair, but got Bool\n    \u2022 When checking the inferred type\n        it :: (Int, (TypeError ...), (TypeError ...))\n</code></pre>\n\n<p>However, this doesn't really \"force\" the argument to be a pair any more than calling <code>fromJust</code> \"forces\" its argument to be of the form <code>Just x</code>. It is really programming with partial functions at the type level.</p>\n\n<p>Well-formedness of type family applications is totally determined by the kind of the type family, and a pair <code>(x, y)</code> has the same kind <code>*</code> as, say, <code>Bool</code> does. You can't magically incur a constraint simply by writing down an application of a type family. If you want to get a constraint at the type level, you have to write it to the left side of <code>=&gt;</code>.</p>\n\n<p>In the linked question, <code>CanFilter (b -&gt; c) a</code> is already a constraint, so it can imply <code>b ~ c</code>.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1455556162, "creation_date": 1455553370, "last_edit_date": 1495541734, "question_id": 35414221, "link": "https://stackoverflow.com/questions/35414221/equality-constraints-in-type-instances", "title": "Equality constraints in type instances", "body": "<p>Let's say I have the following:</p>\n\n<pre><code>type family TF a b\n</code></pre>\n\n<p>Can I write something like this</p>\n\n<pre><code>type instance TF Int t = (t ~ (x,y)) =&gt; (Int,x,y)\n</code></pre>\n\n<p>as a perhaps silly example.</p>\n\n<p>This question is along the same theme as the accepted answer to this question: <a href=\"https://stackoverflow.com/questions/11553705/haskell-equality-constraint-in-instance\">Haskell: Equality constraint in instance</a></p>\n\n<p>I want to match the type instance even if I'm not sure the second argument is a pair then force the second argument to be a pair (with a resulting compile error if this is not successful).</p>\n"}, {"tags": ["haskell", "command-line-arguments", "applicative", "optparse-applicative"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1455553207, "post_id": 35414140, "comment_id": 58529104, "body": "You did try <code>&lt;exectuable-name&gt; &lt;command&gt; --help</code>, right?"}, {"owner": {"reputation": 5476, "user_id": 285471, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2d3ebf74428923994e0aa87353e5b6e9?s=128&d=identicon&r=PG", "display_name": "David V.", "link": "https://stackoverflow.com/users/285471/david-v"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1455565600, "post_id": 35414140, "comment_id": 58536341, "body": "Of course, the output is right in the question. I&#39;ll edit so that it&#39;s more clear"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1455566085, "post_id": 35414140, "comment_id": 58536582, "body": "You&#39;ve tried <code>manipro --help</code>. Note that I&#39;ve asked whether you&#39;ve tried <code>manipro &lt;command&gt; --help</code>, e.g. <code>manipro export --help</code>."}, {"owner": {"reputation": 5476, "user_id": 285471, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2d3ebf74428923994e0aa87353e5b6e9?s=128&d=identicon&r=PG", "display_name": "David V.", "link": "https://stackoverflow.com/users/285471/david-v"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1455609312, "post_id": 35414140, "comment_id": 58552446, "body": "That was it. If you write an answer I&#39;ll accept it."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1455610635, "creation_date": 1455610635, "answer_id": 35427162, "question_id": 35414140, "link": "https://stackoverflow.com/questions/35414140/optparse-applicative-subcommand-help-text/35427162#35427162", "title": "optparse-applicative subcommand help text", "body": "<p><code>optparse-applicative</code> hides the detailed description of a command deliberately if you only use <code>--help</code>. After all, you might have a dozen commands. For example, <code>stack</code> has 34. Listing probably fills your terminal vertically. If it displayed all possible arguments, you would end up with a lot of text.</p>\n\n<p>Instead, <code>--help</code> will only show the <em>common</em> arguments and a list of commands. In order to show the description of a single command, you have to use <code>&lt;executable&gt; &lt;command&gt; --help</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ stack --help | head\nstack - The Haskell Tool Stack\n\nUsage: stack [--help] [--version] [--numeric-version] [--docker*] [--nix*]\n             ([--verbosity VERBOSITY] | [-v|--verbose]) [--work-dir WORK-DIR]\n             [--[no-]system-ghc] [--[no-]install-ghc] [--arch ARCH] [--os OS]\n             [--ghc-variant VARIANT] [-j|--jobs JOBS] [--extra-include-dirs DIR]\n             [--extra-lib-dirs DIR] [--[no-]skip-ghc-check] [--[no-]skip-msys]\n             [--local-bin-path DIR] [--[no-]modify-code-page]\n             [--resolver RESOLVER] [--compiler COMPILER] [--[no-]terminal]\n             [--stack-yaml STACK-YAML] COMMAND|FILE\n\n$ stack --help | grep clean\n  clean                    Clean the local packages\n\n$ stack clean --help\nUsage: stack clean [PACKAGE] [--help]\n  Clean the local packages\n\nAvailable options:\n  PACKAGE                  If none specified, clean all local packages\n  --help                   Show this help text\n\nRun 'stack --help' for global options that apply to all subcommands.\n</code></pre>\n\n<p>This reduces the clutter somewhat. It also follows the same rules as other popular multi-command applications, such as <code>git</code> and <code>hg</code> (with the small exception that <code>&lt;executable&gt; --help &lt;command&gt;</code> will still show only the general help).</p>\n"}, {"tags": [], "owner": {"reputation": 43, "user_id": 6742614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/245e70a6328dc77e5696faa4dc7d7f99?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisL", "link": "https://stackoverflow.com/users/6742614/chrisl"}, "is_accepted": false, "score": 3, "last_activity_date": 1471858830, "creation_date": 1471858830, "answer_id": 39076135, "question_id": 35414140, "link": "https://stackoverflow.com/questions/35414140/optparse-applicative-subcommand-help-text/39076135#39076135", "title": "optparse-applicative subcommand help text", "body": "<p>As Zeta points out, the description of a single command is shown on <code>&lt;executable&gt; &lt;command&gt; --help</code>. But for this to work, in <code>optparse-applicative</code> a parser for the option <code>--help</code> is needed for every command's subparser. You've only defined one for <code>&lt;executable&gt; --help</code> (see second line of your haskell code block). Without a help-parser for a specific command the output of <code>&lt;executable&gt; &lt;command&gt; --help</code> will be no help message, but a notification about an <code>invalid option --help</code> and a usage note. </p>\n\n<p>The general pattern would be to sequentially applicate the parser for the <code>--help</code> option, i.e. <code>helper</code>, to the parser for your command's arguments, like so: <code>command \"command-name\" (info (yourCommandArgParser &lt;**&gt; helper) (fullDesc &lt;&gt; progDesc \"your commands description\" &lt;&gt; ...))</code>.</p>\n\n<p>So for the <code>export</code> command you could write:</p>\n\n<pre><code>argCmdExport = command \"export\" infos\n    where\n    infos = info (options &lt;**&gt; helper) desc\n    desc  = progDesc \"text4\" \n    options = ArgCmdExport &lt;$&gt; \n        argModeExport &lt;*&gt; \n        argTableExport &lt;*&gt; \n        argOptExport\n</code></pre>\n\n<p>PS. The question is old, but I stumbled over it, when I had the same problem. And there is still nothing about it on the web.</p>\n"}], "owner": {"reputation": 5476, "user_id": 285471, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2d3ebf74428923994e0aa87353e5b6e9?s=128&d=identicon&r=PG", "display_name": "David V.", "link": "https://stackoverflow.com/users/285471/david-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 745, "favorite_count": 0, "accepted_answer_id": 35427162, "answer_count": 2, "score": 1, "last_activity_date": 1505238530, "creation_date": 1455553110, "last_edit_date": 1505238530, "question_id": 35414140, "link": "https://stackoverflow.com/questions/35414140/optparse-applicative-subcommand-help-text", "title": "optparse-applicative subcommand help text", "body": "<p>I'm using optparse-applicative that comes with stackage lts 5.1\nI have a parser with subcommands and I have described a help text for their options, but they don't show.</p>\n\n<p>This is the output when I run the executable with <code>--help</code> :</p>\n\n<pre><code>[david@devcentos65 manipro]$ /home/david/.local/bin/manipro --help\nmanipro - text1\n\nUsage: manipro COMMAND [-v|--verbose]   text2\n\nAvailable options:  \n  -h,--help                Show this help text  \n  -v,--verbose             text3\n\nAvailable commands:   \n  export                   text4\n  dico                     text9\n</code></pre>\n\n<p>The code :</p>\n\n<pre><code>parserArgs :: ParserInfo ArgApp\nparserArgs = info (helper &lt;*&gt; args) desc\n    where\n    desc =  \n        fullDesc &lt;&gt; \n        progDesc \"text1\"  &lt;&gt; \n        header \"text2\"\n\n\nargs = ArgApp &lt;$&gt; argCmd &lt;*&gt; optverbose\n    where\n    optverbose = switch ( \n        short 'v' &lt;&gt; long \"verbose\" &lt;&gt; \n        help \"text3\" )\n\nargCmd = subparser (argCmdExport &lt;&gt; argCmdDico)\n\nargCmdExport = command \"export\" infos\n    where\n    infos = info options desc\n    desc  = progDesc \"text4\" \n    options = ArgCmdExport &lt;$&gt; \n        argModeExport &lt;*&gt; \n        argTableExport &lt;*&gt; \n        argOptExport\n\nargModeExport  = argument auto (metavar \"FORMAT\")\nargTableExport = argument text (metavar \"TABLE\")\n\nargOptExport = ArgOptExport &lt;$&gt; optional noesc &lt;*&gt; optional cols &lt;*&gt;\n    ens &lt;*&gt; tst\n    where\n    noesc = option textList (long \"noesc\" &lt;&gt; metavar \"CHAMPS\" &lt;&gt; help \"text5\" )\n    cols = option textList (long \"cols\" &lt;&gt; metavar \"CHAMPS\" &lt;&gt; help \"text6\" )\n    ens = flag EnsEtoile  EnsDollar (short 'd' &lt;&gt; long \"dollar\" &lt;&gt; \n        help \"text7\") \n    tst = flag False True (short 't' &lt;&gt; long \"test\" &lt;&gt; \n        help \"text8\")\n\nargCmdDico    = command \"dico\" infos\n    where\n    infos = info options desc\n    desc  = progDesc \"text9\" \n    options = ArgCmdDico &lt;$&gt; \n        argOptDico\n\nargOptDico = ArgOptDico &lt;$&gt; optional tables\n    where\n    tables = option textList (long \"tables\" &lt;&gt; metavar \"TABLES\" &lt;&gt;\n        help \"text10\" )\n\n\ntext = str &gt;&gt;= return . pack\ntextList = str &gt;&gt;= return . splitOn \",\" . pack\n</code></pre>\n"}, {"tags": ["haskell", "svg", "graph", "haskell-diagrams"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 1, "creation_date": 1455556957, "post_id": 35413656, "comment_id": 58531555, "body": "What have you tried so far? Have a look at <a href=\"http://projects.haskell.org/diagrams/doc/quickstart.html\" rel=\"nofollow noreferrer\">projects.haskell.org/diagrams/doc/quickstart.html</a> Also: why do you want to use <code>diagrams</code> which has no global coordinate system for this task? Might be easier to generate an SVG directly..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1455563358, "post_id": 35413656, "comment_id": 58535123, "body": "@mb21: diagrams does have a \u201cglobal coordinate system\u201d. Only, it&#39;s properly treated as an affine space instead of a vector space, and it&#39;s not <i>that</i> global \u2013 any nesting of objects can override it by applying transformations. Still, it&#39;s perfectly possible to draw diagrams with absolute coordinates, though of course the real power of the library are the tools which allow you to get along <i>without</i> needing to specify such coordinates."}, {"owner": {"reputation": 1143, "user_id": 1233615, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/b941941886b3fdc1e8a3596ff5cd3f0a?s=128&d=identicon&r=PG", "display_name": "fuji", "link": "https://stackoverflow.com/users/1233615/fuji"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1455605715, "post_id": 35413656, "comment_id": 58550650, "body": "@mb21 I chose <code>diagrams</code> because it looks pretty much like batteries included, but I am not fixated on this solution. I guess for writing SVGs directly, I would use the <code>blaze-svg</code> package? I think this is what <code>diagrams</code> is using on the SVG backend."}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1455573669, "post_id": 35417001, "comment_id": 58540378, "body": "how cool is the <code>plotWindow</code> function - diagrams is always full of surprises  : +1 for that (also for the answer)"}, {"owner": {"reputation": 1143, "user_id": 1233615, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/b941941886b3fdc1e8a3596ff5cd3f0a?s=128&d=identicon&r=PG", "display_name": "fuji", "link": "https://stackoverflow.com/users/1233615/fuji"}, "edited": false, "score": 0, "creation_date": 1455605868, "post_id": 35417001, "comment_id": 58550735, "body": "Thank you very much for your answer, I did not know the <code>moveTo</code> function. The list comprehension is a really cool way to do handle multiple objects."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1455562985, "last_edit_date": 1455562985, "creation_date": 1455562544, "answer_id": 35417001, "question_id": 35413656, "link": "https://stackoverflow.com/questions/35413656/draw-points-and-lines-with-given-coordinates-using-haskell-diagrams/35417001#35417001", "title": "draw points and lines with given coordinates using haskell diagrams", "body": "<p>You can use <a href=\"http://hackage.haskell.org/package/diagrams-lib/docs/Diagrams-Transform.html#v:moveTo\" rel=\"nofollow noreferrer\"><code>moveTo</code></a> to, well, <em>move</em> some object to an absolute-specified position. And to draw edges between absolutely-defined vertices, you can use <a href=\"http://hackage.haskell.org/package/diagrams-lib/docs/Diagrams-TrailLike.html#v:fromVertices\" rel=\"nofollow noreferrer\"><code>fromVertices</code></a>. Note that both don't accept tuples as arguments but <a href=\"http://hackage.haskell.org/package/diagrams-lib-1.3.1.0/docs/Diagrams-TwoD-Types.html#t:P2\" rel=\"nofollow noreferrer\">points</a> &ndash; but it's easy enough <a href=\"http://hackage.haskell.org/package/diagrams-lib-1.3.1.0/docs/Diagrams-TwoD-Types.html#v:p2\" rel=\"nofollow noreferrer\">to convert to these</a>.</p>\n\n<pre><code>&gt; :m +Diagrams.Prelude Graphics.Dynamic.Plot.R2\n&gt; plotWindow $ (shapePlot &lt;$&gt; [circle 1 &amp; moveTo (p2 p) | p&lt;-points]\n                           ++ [fromVertices [p2 p, p2 q] | (p,q)&lt;-edges]) \n            ++ [dynamicAxes]\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/q864g.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/q864g.png\" alt=\"Auto-coloured view with dynamic axes\"></a></p>\n\n<p>To combine these elements to a single diagram, you can just use the monoid instance, i.e. <code>mconcat</code> the list.</p>\n\n<pre><code>plotWindow [shapePlot . mconcat $ [circle 1 &amp; fcA transparent &amp; moveTo (p2 p) | p&lt;-points] ++ [fromVertices [p2 p, p2 q] | (p,q)&lt;-edges]]\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/5zNZX.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5zNZX.png\" alt=\"Flat combined view\"></a></p>\n"}], "owner": {"reputation": 1143, "user_id": 1233615, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/b941941886b3fdc1e8a3596ff5cd3f0a?s=128&d=identicon&r=PG", "display_name": "fuji", "link": "https://stackoverflow.com/users/1233615/fuji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 690, "favorite_count": 1, "accepted_answer_id": 35417001, "answer_count": 1, "score": 0, "last_activity_date": 1455562985, "creation_date": 1455551691, "question_id": 35413656, "link": "https://stackoverflow.com/questions/35413656/draw-points-and-lines-with-given-coordinates-using-haskell-diagrams", "title": "draw points and lines with given coordinates using haskell diagrams", "body": "<p>I have a list of points with absolute x and y coordinates:</p>\n\n<pre><code>points :: [(1,1), (2,2), (3,3), (-105, -42.42)]\n</code></pre>\n\n<p>And a list of edges as tuple of points:</p>\n\n<pre><code>edges :: [((1,1), (2,2)), ((1,1),(-105, -42.42)), ((3,3), (-105, -42.42))]\n</code></pre>\n\n<p>I now want to draw this using the <code>diagrams</code> package, using circles for the nodes and lines for the edges. I have found the type <code>Located</code> which should provide this functionality. On the other hand there is the <code>atPoints</code> function, however they don't seem to achieve the same thing (<code>atPoints</code> only moves the local origin).</p>\n\n<p>What would be the idomatic way to achieve this? How do I use the <code>Located</code> type?</p>\n"}, {"tags": ["sql", "haskell", "persist"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1455556391, "last_edit_date": 1455556391, "creation_date": 1455555882, "answer_id": 35415041, "question_id": 35413077, "link": "https://stackoverflow.com/questions/35413077/haskell-persist-query/35415041#35415041", "title": "Haskell Persist query", "body": "<p><code>rawSql</code> gives you raw power! With that you can literally do anything. In your case, this should work:</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nUser\n    age Int\n    deriving Show\n|]\n\ngetUser :: MonadIO m =&gt; ReaderT SqlBackend m [Entity User]\ngetUser = rawSql \"select ?? from user where age * ? &gt; ?\" [PersistInt64 2, PersistInt64 40]\n\nmain :: IO ()\nmain = runSqlite \"/home/sibi/test.db\" $ do\n         runMigration migrateAll\n\n         johnId &lt;- insert $ User 40\n         janeId &lt;- insert $ User 41\n\n         users &lt;- getUser\n         liftIO $ print (users :: [Entity User])\n</code></pre>\n\n<p>For knowing more about the special placeholders <code>?</code> and <code>??</code>, read the <a href=\"http://haddock.stackage.org/lts-5.3/persistent-2.2.4/Database-Persist-Sql.html#g:1\" rel=\"nofollow\">documentation here</a>. I have added quite a big example there to make things clear. Let me know if you are still having trouble.</p>\n\n<p>The above code will produce an output of this:</p>\n\n<pre><code>$ ./sqlitePersist\n[Entity {entityKey = UserKey {unUserKey = SqlBackendKey {unSqlBackendKey = 1}}, entityVal = User {userAge = 40}},Entity {entityKey = UserKey {unUserKey = SqlBackendKey {unSqlBackendKey = 2}}, entityVal = User {userAge = 41}}]\n</code></pre>\n"}], "owner": {"reputation": 779, "user_id": 1829853, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/42a73b47c8415dbe221dec8838031132?s=128&d=identicon&r=PG&f=1", "display_name": "miro", "link": "https://stackoverflow.com/users/1829853/miro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "accepted_answer_id": 35415041, "answer_count": 1, "score": 0, "last_activity_date": 1455556391, "creation_date": 1455550000, "question_id": 35413077, "link": "https://stackoverflow.com/questions/35413077/haskell-persist-query", "title": "Haskell Persist query", "body": "<p>I'm using Persistent.Sqlite for my DB IO,...and I'm struggling with following:</p>\n\n<p>Lets say I have a table User with columns: User_id and User_age, and I want to run following query:</p>\n\n<pre><code>select * from User where (User_age * val_1) &gt; val_2;\n</code></pre>\n\n<p>I have tried using *=. but that query combinator is allowed only for Update type. Most probably I might need to use rawSql?,..but then I'm not sure how to pass value to the query. </p>\n"}, {"tags": ["haskell", "gcc", "linker", "ghc"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1455551822, "post_id": 35412579, "comment_id": 58528117, "body": "The <code>_2</code> suffix seems to be the operand size in bytes. My best guess is that your gcc is configured to by default target an architecture version that can&#39;t support these operations, like 486."}, {"owner": {"reputation": 428, "user_id": 1520657, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/599f6ac58a187b4e89ad8cb576304166?s=128&d=identicon&r=PG", "display_name": "MichaelO", "link": "https://stackoverflow.com/users/1520657/michaelo"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1455554262, "post_id": 35412579, "comment_id": 58529842, "body": "Hm, my gcc documentation says: &quot;GCC will allow any integral scalar or pointer type that is 1, 2, 4 or 8 bytes in length.&quot;, so it should take basically any basic datatype. So just why have the suffixes be added?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1455558130, "post_id": 35412579, "comment_id": 58532235, "body": "GHC doesn&#39;t add the suffixes. (You can look in <code>libraries&#47;ghc-prim&#47;cbits&#47;atomic.c</code>.) Test if <code>__sync_val_compare_and_swap</code> works on <code>uint16_t</code> for you at all, GHC aside."}, {"owner": {"reputation": 428, "user_id": 1520657, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/599f6ac58a187b4e89ad8cb576304166?s=128&d=identicon&r=PG", "display_name": "MichaelO", "link": "https://stackoverflow.com/users/1520657/michaelo"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1455640019, "post_id": 35412579, "comment_id": 58573641, "body": "Yup, seems that my gcc is too old for ghc."}], "answers": [{"tags": [], "owner": {"reputation": 428, "user_id": 1520657, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/599f6ac58a187b4e89ad8cb576304166?s=128&d=identicon&r=PG", "display_name": "MichaelO", "link": "https://stackoverflow.com/users/1520657/michaelo"}, "is_accepted": true, "score": 1, "last_activity_date": 1455640069, "creation_date": 1455640069, "answer_id": 35437828, "question_id": 35412579, "link": "https://stackoverflow.com/questions/35412579/link-error-on-compiling-ghc-7-10-3-on-sles11/35437828#35437828", "title": "Link error on compiling ghc 7.10.3 on SLES11", "body": "<p>Ok, so I did install a newer gcc (4.9.3) locally and then the compilation of ghc was successful. </p>\n"}], "owner": {"reputation": 428, "user_id": 1520657, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/599f6ac58a187b4e89ad8cb576304166?s=128&d=identicon&r=PG", "display_name": "MichaelO", "link": "https://stackoverflow.com/users/1520657/michaelo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 35437828, "answer_count": 1, "score": 1, "last_activity_date": 1457062399, "creation_date": 1455548429, "last_edit_date": 1457062399, "question_id": 35412579, "link": "https://stackoverflow.com/questions/35412579/link-error-on-compiling-ghc-7-10-3-on-sles11", "title": "Link error on compiling ghc 7.10.3 on SLES11", "body": "<p>I want to compile ghc 7.10.3 on a SLES11 instance since the downloaded binary doesn't work. Now I am getting link errors in the end:</p>\n\n<pre><code>/home/oswald/build/ghc-7.10.3/libraries/ghc-prim/dist-install/build/libHSghc-prim-0.4.0.0-8TmvWUcS1U1IKHT0levwg3-ghc7.10.3.so: undefined reference to `__sync_val_compare_and_swap_2'\n/home/oswald/build/ghc-7.10.3/libraries/ghc-prim/dist-install/build/libHSghc-prim-0.4.0.0-8TmvWUcS1U1IKHT0levwg3-ghc7.10.3.so: undefined reference to `__sync_fetch_and_nand_2'\n</code></pre>\n\n<p>with a lot lines more. These seem to be GCC primitives. The installed gcc version on this machine is 4.3.4, which has primitives, but I did not find the _2 and _1 endings in the documentation (it uses variable arguments list as I understand it).</p>\n\n<p>Any idea on how to solve this?</p>\n"}, {"tags": ["haskell", "type-conversion"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 6, "creation_date": 1455548511, "post_id": 35412431, "comment_id": 58525912, "body": "<code>div</code> has nothing to do with real numbers of any kind, or rounding anything. It is the integer division function. It is defined entirely in terms of integers."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1455577030, "post_id": 35412431, "comment_id": 58541847, "body": "see also <code>mod</code> and <code>divMod</code> (and also <code>quot</code>, <code>rem</code>, and <code>quotRem</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1455550492, "post_id": 35412599, "comment_id": 58527235, "body": "You may want to mention that <code>(-9) `quot` 10</code> behaves like Java, returning 0."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 3, "last_activity_date": 1455549658, "last_edit_date": 1455549658, "creation_date": 1455548486, "answer_id": 35412599, "question_id": 35412431, "link": "https://stackoverflow.com/questions/35412431/does-haskell-do-a-default-conversion-from-double-to-integer/35412599#35412599", "title": "Does Haskell do a default conversion from double to integer?", "body": "<blockquote>\n  <p>Does Haskell cut off values like in java</p>\n</blockquote>\n\n<p>no it does not.</p>\n\n<p>When doing <strong>integer division</strong>, Java rounds <em>towards zero</em>, whereas Haskell rounds <em>downwards</em>; so in Haskell</p>\n\n<pre><code>\\&gt; (-9) `div` 10\n-1\n</code></pre>\n\n<p>whereas in Java <code>-9 / 10</code> is zero:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>public class IntDiv{\n     public static void main(String []args){\n         double a = (-9) / 10;\n         System.out.printf(\"%.2f\\n\", a); // would print 0.00\n     }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 9, "last_activity_date": 1455548696, "creation_date": 1455548696, "answer_id": 35412667, "question_id": 35412431, "link": "https://stackoverflow.com/questions/35412431/does-haskell-do-a-default-conversion-from-double-to-integer/35412667#35412667", "title": "Does Haskell do a default conversion from double to integer?", "body": "<p><code>div 1 2</code> doesn't return 0.5, which is then converted to the integer 0. It returns 0 in the first place. <code>div</code> performs integer division and as such always returns an integer (or other Integral type depending on which type you used it with). There's no doubles involved.</p>\n\n<p>When you do convert a double to an integer, the method of rounding depends on which method you used. For example <code>floor</code> would round the number down whereas <code>round</code> would round to the nearest integer. There are no implicit conversions in Haskell, so any conversion will happen through a function.</p>\n"}], "owner": {"reputation": 1871, "user_id": 1479976, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/6da8c804cd3731fc9dd8dbf5fd621523?s=128&d=identicon&r=PG", "display_name": "Simons0n", "link": "https://stackoverflow.com/users/1479976/simons0n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 532, "favorite_count": 0, "accepted_answer_id": 35412667, "answer_count": 2, "score": 2, "last_activity_date": 1455549658, "creation_date": 1455548024, "last_edit_date": 1455548700, "question_id": 35412431, "link": "https://stackoverflow.com/questions/35412431/does-haskell-do-a-default-conversion-from-double-to-integer", "title": "Does Haskell do a default conversion from double to integer?", "body": "<p>I have a function that has the type <code>Int -&gt; Int -&gt; Int -&gt; Int</code>. When i use <code>div a b</code> as a value for a variable in the function it seems, that the value gets rounded down to 0 if the return of <code>div a b</code> is 1/2 or anything double like.</p>\n\n<p>Is this correct? Does Haskell cut of values like in java, if a double is forced into an integer?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 10, "last_activity_date": 1455538809, "last_edit_date": 1455538809, "creation_date": 1455532739, "answer_id": 35407123, "question_id": 35406947, "link": "https://stackoverflow.com/questions/35406947/neater-way-of-writing-proxy-proxy-42-using-datakinds-extension/35407123#35407123", "title": "Neater way of writing (Proxy :: Proxy 42) using DataKinds extension", "body": "<p>First, if you enable <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/partial-type-signatures.html\" rel=\"noreferrer\"><code>PartialTypeSignatures</code></a>, you can omit a <code>Proxy</code>:</p>\n\n<pre><code>{-# LANGUAGE PartialTypeSignatures #-}\n\n(Proxy :: _ 42)\n</code></pre>\n\n<p>Second, <a href=\"https://ghc.haskell.org/trac/ghc/wiki/TypeApplication\" rel=\"noreferrer\"><code>TypeApplications</code></a> in GHC 8 is a neater solution. It lets us supply <code>forall</code>-bound arguments explicitly with a <code>@</code> prefix:</p>\n\n<pre><code>{-# LANGUAGE TypeApplications, RankNTypes, DataKinds, TypeFamilies #-}\n\nimport Data.Proxy\nimport GHC.TypeLits\n\nfoo :: forall (n :: Nat) a. a -&gt; a\nfoo x = x\n\nbar :: ()\nbar = foo @10 () -- apply the type nat literal explicitly\n</code></pre>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1455538809, "creation_date": 1455532211, "question_id": 35406947, "link": "https://stackoverflow.com/questions/35406947/neater-way-of-writing-proxy-proxy-42-using-datakinds-extension", "title": "Neater way of writing (Proxy :: Proxy 42) using DataKinds extension", "body": "<p>I've been using the <code>DataKinds</code> extension to pass typelevel <code>Nat</code>s to functions in a type safe way, I was just wondering if there was a nicer way of writing:</p>\n\n<pre><code>(Proxy :: Proxy 42)\n</code></pre>\n\n<p>for example, is there any extension that will automatically promote the literal <code>42</code> to <code>(Proxy :: Proxy 42)</code> if the type system sees the argument requires it?</p>\n\n<p>I thought I read of one somewhere but I can't find it now. Getting users to write <code>(Proxy :: Proxy 42)</code> is a bit ugly I think.</p>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1455539412, "post_id": 35406651, "comment_id": 58519621, "body": "the problem is that a <code>elt -&gt; FS.FastSet elt</code> is not <i>injective</i> (meaning there might be <code>elt</code> and <code>elt&#39;</code> with the same <code>FS.FastSet elt ~ FS.FastSet elt&#39;</code> - right now you cannot do much here but injective type-families are on their way ;)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1455539588, "post_id": 35406651, "comment_id": 58519742, "body": "I <i>think</i> you can come up with something working if you change your operations to <code>union :: elt -&gt; elt -&gt; elt</code> instead"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1455540982, "post_id": 35406651, "comment_id": 58520597, "body": "I suspect <code>FastSet</code> should better be an associated <code>data</code> family, rather than type family. These <i>are</i> injective."}], "answers": [{"tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": false, "score": 3, "last_activity_date": 1455543875, "last_edit_date": 1455543875, "creation_date": 1455534377, "answer_id": 35407736, "question_id": 35406651, "link": "https://stackoverflow.com/questions/35406651/typechecking-failure-in-code-using-type-families/35407736#35407736", "title": "Typechecking failure in code using Type Families", "body": "<p>I suspect you are somewhat misusing associated types. It should not be the case that practically every argument of your methods is a type family.</p>\n\n<p>The class definition readily allows an instance like:</p>\n\n<pre><code>instance HasFastSet Int where\n    type FastSet Int = Bool\n    -- ...\n</code></pre>\n\n<p>And now, for that instance, <code>union :: Bool -&gt; Bool -&gt; Bool</code> which GHC is going to have a hard time knowing that's the <code>Int</code> instance's <code>union</code>, especially because, as the error message states, you could have an instance for <code>Char</code> with <code>type FastSet Char :: Bool</code>.</p>\n\n<p>So what's happening in your code is when you are using <code>union</code>, it doesn't know what <code>union</code> to use.  Because type families are not injective, it's irrelevant that the parameters have type <code>FastSet elt</code> because <code>FastSet elt ~ FastSet elt1</code> is possible.  Similarly, the class context is also irrelevant.  At that use of <code>union</code> GHC doesn't care what the class constraints on the function as a whole are, and even if it did you could just be missing a constraint, so the constraints you provided won't resolve the issue.</p>\n\n<p>A more normal usage of associated types would be more like having an element type associated to a class parameterized by a collection type, something like, then you get type family instances like <code>type Elem [Int] = Int</code> and the methods are resolvable without having to guess the type family instance.  You could switch to data families, but I think that you would be better off reconsidering your approach entirely.</p>\n"}], "owner": {"reputation": 51, "user_id": 1257479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/442776d37755979ba251e2cce3f149a3?s=128&d=identicon&r=PG", "display_name": "zarazek", "link": "https://stackoverflow.com/users/1257479/zarazek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1455543875, "creation_date": 1455531353, "last_edit_date": 1455531683, "question_id": 35406651, "link": "https://stackoverflow.com/questions/35406651/typechecking-failure-in-code-using-type-families", "title": "Typechecking failure in code using Type Families", "body": "<p>I have module Data.FastSet, where this typeclass is defined:</p>\n\n<pre><code>    {-# LANGUAGE TypeFamilies #-}\n\n    class HasFastSet elt where\n      type FastSet elt :: *\n      empty :: FastSet elt\n      fromList :: [elt] -&gt; FastSet elt\n      member :: elt -&gt; FastSet elt -&gt; Bool\n      eq :: FastSet elt -&gt; FastSet elt -&gt; Bool\n      insert :: elt -&gt; FastSet elt -&gt; FastSet elt\n      union :: FastSet elt -&gt; FastSet elt -&gt; FastSet elt\n      filter :: (elt -&gt; Bool) -&gt; FastSet elt -&gt; FastSet elt\n</code></pre>\n\n<p>along with a couple of instances. Then, in some other module, I'm trying to use it:</p>\n\n<pre><code>    {-# LANGUAGE RankNTypes, TypeFamilies, ScopedTypeVariables #-}\n    import qualified Data.FastSet as FS\n\n    data StaticInfo elt = StaticInfo { matchesEmpty :: Bool,\n                                       starters :: FS.FastSet elt }\n\n\n    sequentialCompose :: forall m elt. (Monad m, FS.HasFastSet elt) =&gt;\n    m (StaticInfo elt) -&gt; m (StaticInfo elt) -&gt; m (StaticInfo elt)\n    sequentialCompose si1 si2 = do \n      StaticInfo me1 st1 &lt;- si1\n      case me1 of\n        False -&gt; si1\n        True  -&gt; do\n                   StaticInfo me2 st2 &lt;- si2\n                   let together = FS.union st1 st2 :: FS.FastSet elt\n                   return (StaticInfo me2 together)\n</code></pre>\n\n<p>As you see, I've tried to use ScopedTypeVariables extension to tell typechecker that result of union of two sets has the same type as sets themselves. When I try to compile this, it gives me type error (and it's the same regardless of my attempt to give explicit type to <code>together</code> variable:</p>\n\n<pre><code>Couldn't match expected type \u2018FS.FastSet elt\u2019\n            with actual type \u2018FS.FastSet elt1\u2019\nNB: \u2018FS.FastSet\u2019 is a type function, and may not be injective\nThe type variable \u2018elt1\u2019 is ambiguous\nRelevant bindings include\n  together :: FS.FastSet elt\n    (bound at /home/olympia/concurrency-talk/chat-benchmark/src/Text/Parsing/StaticInfo.hs:24:20)\n  st2 :: FS.FastSet elt\n    (bound at /home/olympia/concurrency-talk/chat-benchmark/src/Text/Parsing/StaticInfo.hs:23:31)\n  st1 :: FS.FastSet elt\n    (bound at /home/olympia/concurrency-talk/chat-benchmark/src/Text/Parsing/StaticInfo.hs:19:18)\n  si2 :: m (StaticInfo elt)\n    (bound at /home/olympia/concurrency-talk/chat-benchmark/src/Text/Parsing/StaticInfo.hs:18:23)\n  si1 :: m (StaticInfo elt)\n    (bound at /home/olympia/concurrency-talk/chat-benchmark/src/Text/Parsing/StaticInfo.hs:18:19)\n  sequentialCompose :: m (StaticInfo elt)\n                       -&gt; m (StaticInfo elt) -&gt; m (StaticInfo elt)\n    (bound at /home/olympia/concurrency-talk/chat-benchmark/src/Text/Parsing/StaticInfo.hs:18:1)\nIn the expression: FS.union st1 st2 :: FS.FastSet elt\nIn an equation for \u2018together\u2019:\n    together = FS.union st1 st2 :: FS.FastSet elt\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell", "input"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455541644, "post_id": 35406605, "comment_id": 58520995, "body": "What exactly have you entered to get that error? The examples in the answer are all valid."}], "answers": [{"comments": [{"owner": {"reputation": 8989, "user_id": 1684058, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lhdm7.jpg?s=128&g=1", "display_name": "Lim H.", "link": "https://stackoverflow.com/users/1684058/lim-h"}, "edited": false, "score": 3, "creation_date": 1455531540, "post_id": 35406685, "comment_id": 58514667, "body": "Or we can also enable multiline mode <code>:set +m</code>"}, {"owner": {"reputation": 297, "user_id": 1862770, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/15a836e86c505bf852fcbae4e420eb6d?s=128&d=identicon&r=PG", "display_name": "user1862770", "link": "https://stackoverflow.com/users/1862770/user1862770"}, "edited": false, "score": 0, "creation_date": 1455532026, "post_id": 35406685, "comment_id": 58514992, "body": "The solution with the brackets does not seem to work at all, the multiline code gives me an error, see edit above"}, {"owner": {"reputation": 297, "user_id": 1862770, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/15a836e86c505bf852fcbae4e420eb6d?s=128&d=identicon&r=PG", "display_name": "user1862770", "link": "https://stackoverflow.com/users/1862770/user1862770"}, "edited": false, "score": 0, "creation_date": 1455532157, "post_id": 35406685, "comment_id": 58515076, "body": "to explain: I am trying to solve this old excercise for practicing purposes: <a href=\"http://code.google.com/codejam/contest/351101/dashboard#s=p1\" rel=\"nofollow noreferrer\">code.google.com/codejam/contest/351101/dashboard#s=p1</a>  I have never participated in that, so I suppose I simply have to copy what they give as input into the command line."}, {"owner": {"reputation": 297, "user_id": 1862770, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/15a836e86c505bf852fcbae4e420eb6d?s=128&d=identicon&r=PG", "display_name": "user1862770", "link": "https://stackoverflow.com/users/1862770/user1862770"}, "edited": false, "score": 0, "creation_date": 1455532349, "post_id": 35406685, "comment_id": 58515184, "body": "I would try with java or python to but run into the same problem."}, {"owner": {"reputation": 297, "user_id": 1862770, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/15a836e86c505bf852fcbae4e420eb6d?s=128&d=identicon&r=PG", "display_name": "user1862770", "link": "https://stackoverflow.com/users/1862770/user1862770"}, "edited": false, "score": 0, "creation_date": 1455534895, "post_id": 35406685, "comment_id": 58516763, "body": "+chi, to simply save in a file and then read the file is of course possible and easy, but I do wonder if this is what is whished for in the exercise. Does not the exercise say it has to work from commandline somehow?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 297, "user_id": 1862770, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/15a836e86c505bf852fcbae4e420eb6d?s=128&d=identicon&r=PG", "display_name": "user1862770", "link": "https://stackoverflow.com/users/1862770/user1862770"}, "edited": false, "score": 1, "creation_date": 1455538154, "post_id": 35406685, "comment_id": 58518886, "body": "@user1862770 Such exercises typically assume input is provided as STDIN and output is expected to STDOUT. I&#39;m also pretty sure that they do not require using GHCi at all -- programs will be compiled with <code>ghc</code> and then run (or run through interpreters, for other languages such as <code>python</code>)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 297, "user_id": 1862770, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/15a836e86c505bf852fcbae4e420eb6d?s=128&d=identicon&r=PG", "display_name": "user1862770", "link": "https://stackoverflow.com/users/1862770/user1862770"}, "edited": false, "score": 1, "creation_date": 1455538291, "post_id": 35406685, "comment_id": 58518955, "body": "@user1862770 Or even, in same contests, they will not ask for the program at all. They will provide a few input samples, and you are expected to upload the correct output -- it doesn&#39;t matter how you have generated that, as long it is exact. Try to check the FAQ/rules/whatever to see if there&#39;s more information somewhere for this particular contest."}, {"owner": {"reputation": 297, "user_id": 1862770, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/15a836e86c505bf852fcbae4e420eb6d?s=128&d=identicon&r=PG", "display_name": "user1862770", "link": "https://stackoverflow.com/users/1862770/user1862770"}, "edited": false, "score": 0, "creation_date": 1455542081, "post_id": 35406685, "comment_id": 58521279, "body": "Correct, you are requiered to upload the correct output, but the code also. I am not sure if they will really check the code."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1455532825, "last_edit_date": 1455532825, "creation_date": 1455531472, "answer_id": 35406685, "question_id": 35406605, "link": "https://stackoverflow.com/questions/35406605/is-it-possible-to-read-a-string-with-newlines-from-the-commandline/35406685#35406685", "title": "Is it possible to read a string with newlines from the commandline", "body": "<p>GHCi session:</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| 3 +\nPrelude|   4 +\nPrelude|   5\nPrelude| :}\n12\n</code></pre>\n\n<p>If you are trying to insert actual newlines in a string, I fear that this is indeed forbidden by Haskell, in favor of the following style:</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| putStr \"Hello\\n\\\nPrelude|     \\world!\\n\\\nPrelude|     \\ -- THE END\\n\"\nPrelude| :}\nHello\nworld!\n -- THE END\n</code></pre>\n\n<p>Here we needed to use <code>\\n</code> for explicit newlines. Also note that <code>\\</code> has to be used <em>both</em> at the end-of-line and at the beginning of the next line. The spaces before the latter <code>\\</code> will be ignored so to allow any indentation.</p>\n\n<p>Also consider this style:</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| putStrLn $ unlines\nPrelude|   [ \"Hello\"\nPrelude|   , \"world!\"\nPrelude|   , \" -- THE END\"\nPrelude|   ]\nPrelude| :}\nHello\nworld!\n -- THE END\n</code></pre>\n\n<hr>\n\n<p>If all you need to do is reading the input, you can simply save it in a file (say <code>test.txt</code>) and read it as a string:</p>\n\n<pre><code>Prelude&gt; test &lt;- readFile \"test.txt\"\nPrelude&gt; putStr test\n5\nthis is a test\nfoobar\nall your base\nclass\npony along\n</code></pre>\n"}], "owner": {"reputation": 297, "user_id": 1862770, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/15a836e86c505bf852fcbae4e420eb6d?s=128&d=identicon&r=PG", "display_name": "user1862770", "link": "https://stackoverflow.com/users/1862770/user1862770"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 35406685, "answer_count": 1, "score": 0, "last_activity_date": 1455542149, "creation_date": 1455531247, "last_edit_date": 1455542149, "question_id": 35406605, "link": "https://stackoverflow.com/questions/35406605/is-it-possible-to-read-a-string-with-newlines-from-the-commandline", "title": "Is it possible to read a string with newlines from the commandline", "body": "<p>I have tried with 3 languages so far: Haskell, Python, Java.</p>\n\n<p>I am a bit at a loss.</p>\n\n<p>What I really want to do is the following:</p>\n\n<pre><code>*MyModule&gt; myfunction arg1\n                      arg1a\n</code></pre>\n\n<p>So my argument is actually a string containing a real newline.\nAbove the input for Haskell.</p>\n\n<p>However, I have not found any examples for this, and when I try this with a real command line, I always get a crash because the interpreter or compiler assumes that at the linebreak there must surely be a new argument. \nYes, I have tried to surround the string with \"\". No difference.</p>\n\n<p>Is there an obvious way around this which I just have not found?</p>\n\n<p>enable multiline gives the following error:</p>\n\n<pre><code>   lexical error in string/character literal at character '\\n'\n</code></pre>\n\n<p>On request: The input I actually used was:</p>\n\n<pre><code>  3\n  this is a test\n  foobar\n  all your base\n</code></pre>\n"}, {"tags": ["json", "parsing", "haskell", "aeson"], "comments": [{"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1455536986, "post_id": 35404541, "comment_id": 58518114, "body": "By <code>V.head</code> you got the first element in the <code>weather</code> array which is an object, so it should be <code>lambda3 = withObject &quot;weatherMain&quot; (.: &quot;main&quot;) </code>."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 4, "last_activity_date": 1455529318, "creation_date": 1455529318, "answer_id": 35405916, "question_id": 35404541, "link": "https://stackoverflow.com/questions/35404541/how-do-i-parse-this-json-with-aeson/35405916#35405916", "title": "How do I parse this JSON with Aeson?", "body": "<p>In my opinion, you are making this too complicated. Something like this should work:</p>\n\n<pre><code>instance FromJSON WeatherResponse where\n  parseJSON (Object v) = do\n      weatherValue &lt;- head &lt;$&gt; v .: \"weather\"\n      WeatherResponse &lt;$&gt; ((v .: \"main\") &gt;&gt;= (.: \"temp\"))\n                          &lt;*&gt; ((v .: \"main\") &gt;&gt;= (.: \"humidity\"))\n                          &lt;*&gt; weatherValue .: \"main\"\n</code></pre>\n\n<p>It's output:</p>\n\n<pre><code>[nix-shell:~/haskell-sample]$ ./weather\nRight (WeatherResponse {temp = 271.979, humidity = 100.0, weatherMain = \"Clouds\"})\n</code></pre>\n"}], "owner": {"reputation": 2982, "user_id": 391411, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3de2d5c3d7af24ae0b8575dcb1b138e8?s=128&d=identicon&r=PG", "display_name": "Varun Madiath", "link": "https://stackoverflow.com/users/391411/varun-madiath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 2, "accepted_answer_id": 35405916, "answer_count": 1, "score": 5, "last_activity_date": 1455529318, "creation_date": 1455524801, "question_id": 35404541, "link": "https://stackoverflow.com/questions/35404541/how-do-i-parse-this-json-with-aeson", "title": "How do I parse this JSON with Aeson?", "body": "<p>I have the following JSON snippet:</p>\n\n<pre><code>{\n  \"weather\": [\n    {\n      \"id\": 803,\n      \"main\": \"Clouds\",\n      \"description\": \"broken clouds\",\n      \"icon\": \"04n\"\n    }\n  ],\n  \"main\": {\n    \"temp\": 271.979,\n    \"pressure\": 1024.8,\n    \"humidity\": 100,\n    \"temp_min\": 271.979,\n    \"temp_max\": 271.979,\n    \"sea_level\": 1028.51,\n    \"grnd_level\": 1024.8\n  },\n  \"id\": 6332485,\n  \"name\": \"Queensbridge Houses\",\n  \"cod\": 200\n}\n</code></pre>\n\n<p>I want to get parse the following type from it:</p>\n\n<pre><code>data WeatherResponse = WeatherResponse\n  { temp :: Double\n  , humidity :: Double\n  , weatherMain :: T.Text\n  } deriving Show\n</code></pre>\n\n<p>I've been trying to use the following code to do it, but I keep running into errors. I've finally got all the types to match up, but it parses incorrectly and don't really understand where it's failing.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE RecordWildCards #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.Aeson\nimport Data.Aeson.Types (Parser, Array)\nimport Data.Time (defaultTimeLocale, formatTime, getZonedTime)\n\nimport qualified Data.ByteString.Lazy as BL\nimport qualified Data.Vector as V\nimport qualified Data.Text as T\n\ndata WeatherResponse = WeatherResponse\n  { temp :: Double\n  , humidity :: Double\n  , weatherMain :: T.Text\n  } deriving Show\n\nlambda3 :: Value -&gt; Parser T.Text\nlambda3 o = do\n  withText \"main\" (\\t -&gt; do\n                      return t\n                  ) o\n\nparseInner :: Value -&gt; Parser T.Text\nparseInner a = withArray \"Inner Array\" (lambda3 . (V.head)) a\n\ninstance FromJSON WeatherResponse where\n  parseJSON =\n    withObject \"Root Object\" $ \\o -&gt; do\n    mainO &lt;- o .: \"main\"\n    temp &lt;- mainO .: \"temp\"\n    humidity &lt;- mainO .: \"humidity\"\n    weatherO &lt;- o .: \"weather\"\n    weatherMain &lt;- parseInner weatherO\n    return $ WeatherResponse temp humidity weatherMain\n\ngetSampleData = BL.readFile \"/home/vmadiath/.xmonad/weather.json\"\n\nmain = do\n  text &lt;- getSampleData\n  let (result :: Either String WeatherResponse) = eitherDecode text\n  putStrLn . show  $ result\n</code></pre>\n\n<p>I simply get the following output which doesn't give me enough to know where I've gone wrong.</p>\n\n<pre><code>$ runhaskell lib/code.hs\nLeft \"Error in $: expected main, encountered Object\"\n</code></pre>\n\n<p>I've put the entire thing in a gist viewable <a href=\"https://gist.github.com/vamega/7c04b1ee22bad8eca7ba\" rel=\"noreferrer\">here</a></p>\n\n<p>I'd like to know what's wrong with the code, and how I can fix it. If you have suggestions of how to write this in a more readable way I'd love to know that too. Currently I'm mostly annoyed with the  two separate functions <code>lambda3</code> and <code>parseInner</code> is annoying)</p>\n"}, {"tags": ["haskell", "functional-programming", "category-theory"], "comments": [{"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "edited": false, "score": 0, "creation_date": 1455513035, "post_id": 35401811, "comment_id": 58505526, "body": "Returning a function still leaves it&#39;s parameters available! <code>(a -&gt; b) -&gt; (m a -&gt; m b)</code> does not leave <code>(m a -&gt; m b)</code> opaque! This is the nature of currying"}], "answers": [{"comments": [{"owner": {"reputation": 379, "user_id": 4109231, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2e87fcd086c4117dee2176405836a74e?s=128&d=identicon&r=PG", "display_name": "Asterisk", "link": "https://stackoverflow.com/users/4109231/asterisk"}, "edited": false, "score": 0, "creation_date": 1455513766, "post_id": 35401902, "comment_id": 58505756, "body": "I seem to understand it a bit . It seems map ( higher order function) is applying  f to a generator over m a. Can you please explain the syntax a bit in English . Sorry I come from a imperative / oo background and still learning Haskell ."}, {"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "reply_to_user": {"reputation": 379, "user_id": 4109231, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2e87fcd086c4117dee2176405836a74e?s=128&d=identicon&r=PG", "display_name": "Asterisk", "link": "https://stackoverflow.com/users/4109231/asterisk"}, "edited": false, "score": 0, "creation_date": 1455515969, "post_id": 35401902, "comment_id": 58506503, "body": "Sure!! It&#39;s actually far more simple. The two type signatures are the same:      <code>map : (a -&gt; b) -&gt; (m a -&gt; m b) ~     map : (a -&gt; b) -&gt; m a -&gt; m b</code>  This could be seen as <code>-&gt;</code> being &quot;right-associative&quot;, basically saying that <code>x &lt;&gt; y &lt;&gt; z == x &lt;&gt; (y &lt;&gt; z)</code>. This is the nature of higher-order implication logic because supplying <i>part</i> of the data to a prolonged execution should <i>return</i> a prolonged execution (in the case that there&#39;s still more data needed), or just the data itself. In this scenario, prolonged executions are treated in the exact same way as data."}, {"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "reply_to_user": {"reputation": 379, "user_id": 4109231, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2e87fcd086c4117dee2176405836a74e?s=128&d=identicon&r=PG", "display_name": "Asterisk", "link": "https://stackoverflow.com/users/4109231/asterisk"}, "edited": false, "score": 0, "creation_date": 1455516053, "post_id": 35401902, "comment_id": 58506537, "body": "You should also take care to note that my usage of &quot;prolonged execution&quot; is <i>really</i> sloppy - I&#39;m not talking about strictness, thunks, or what normal-form is. This is strictly talking about functions - <code>a -&gt; b</code> could be seen as a prolonged execution to the data of <code>b</code>, provided once we have <code>a</code> (sorry fellow haskellers for this botched explanation :&#41;"}, {"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "reply_to_user": {"reputation": 379, "user_id": 4109231, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2e87fcd086c4117dee2176405836a74e?s=128&d=identicon&r=PG", "display_name": "Asterisk", "link": "https://stackoverflow.com/users/4109231/asterisk"}, "edited": false, "score": 0, "creation_date": 1455516125, "post_id": 35401902, "comment_id": 58506562, "body": "Also, <code>map f x == (map f) x</code>, if that make sense. That is, if <code>f : a -&gt; b</code>, and <code>x : m a</code>."}, {"owner": {"reputation": 379, "user_id": 4109231, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2e87fcd086c4117dee2176405836a74e?s=128&d=identicon&r=PG", "display_name": "Asterisk", "link": "https://stackoverflow.com/users/4109231/asterisk"}, "edited": false, "score": 0, "creation_date": 1455521533, "post_id": 35401902, "comment_id": 58508855, "body": "Thanks for explaining this !"}], "tags": [], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "is_accepted": false, "score": 4, "last_activity_date": 1455513163, "creation_date": 1455513163, "answer_id": 35401902, "question_id": 35401811, "link": "https://stackoverflow.com/questions/35401811/confusing-map-function-definition-in-wadlers-paper/35401902#35401902", "title": "Confusing map function definition in Wadler&#39;s paper", "body": "<p>The second argument is the <em>first</em> argument for the <em>returned</em> function:</p>\n\n<pre><code>map : (a -&gt; b) -&gt; m a -&gt; m b\nmap = \\(f : a -&gt; b) -&gt; \\(x : m a) -&gt;\n        x &gt;&gt;= (\\a -&gt; return (f a))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 379, "user_id": 4109231, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2e87fcd086c4117dee2176405836a74e?s=128&d=identicon&r=PG", "display_name": "Asterisk", "link": "https://stackoverflow.com/users/4109231/asterisk"}, "edited": false, "score": 0, "creation_date": 1455533604, "post_id": 35406888, "comment_id": 58515993, "body": "Thanks . This clears my doubt . I have seen explanations that make no distinction between map being a mapper from a normal function to a monadic function. And map being a higher order function that takes a normal function and a (ex. list) monad. Can you please elaborate a bit on \\m-&gt;m ? I am unsure how to read it ."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 379, "user_id": 4109231, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2e87fcd086c4117dee2176405836a74e?s=128&d=identicon&r=PG", "display_name": "Asterisk", "link": "https://stackoverflow.com/users/4109231/asterisk"}, "edited": false, "score": 0, "creation_date": 1455534155, "post_id": 35406888, "comment_id": 58516326, "body": "@Asterisk I added all the parentheses to guide reading. Precedence can indeed be confusing here."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 379, "user_id": 4109231, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2e87fcd086c4117dee2176405836a74e?s=128&d=identicon&r=PG", "display_name": "Asterisk", "link": "https://stackoverflow.com/users/4109231/asterisk"}, "edited": false, "score": 0, "creation_date": 1456114593, "post_id": 35406888, "comment_id": 58780055, "body": "@Asterisk Part of the point of the way Haskell&#39;s syntax works is that you don&#39;t need to make a distinction between those two &quot;ways of being&quot; for <code>map</code>. They are in fact merely different points of view on <i>exactly the same concept</i>. Because they&#39;re exactly the same, you never have to worry about neglecting one of those interpretations; you can use whichever point of view has the least mental friction in the context you&#39;re working, even freely flip-flopping between them (as happened in your quoted example between the type signature and the implementation, which is indeed a little confusing)."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1455534126, "last_edit_date": 1455534126, "creation_date": 1455532026, "answer_id": 35406888, "question_id": 35401811, "link": "https://stackoverflow.com/questions/35401811/confusing-map-function-definition-in-wadlers-paper/35406888#35406888", "title": "Confusing map function definition in Wadler&#39;s paper", "body": "<p>A definition of the form</p>\n\n<pre><code>foo x y z = bar\n</code></pre>\n\n<p>is equivalent to all of the following ones</p>\n\n<pre><code>foo x y = \\z -&gt; bar\nfoo x = \\y z -&gt; bar\nfoo = \\x y z -&gt; bar\n</code></pre>\n\n<p>Hence, the posted code could also be written as</p>\n\n<pre><code>map :: (a \u2192 b) \u2192 (M a \u2192 M b)     \nmap f = \\m -&gt; m &gt;= \\a -&gt; unit (f a)\n-- which is parsed as\n-- map f = \\m -&gt; (m &gt;= (\\a -&gt; (unit (f a))))\n</code></pre>\n\n<p>The above indeed emphasizes that <code>map</code> maps functions to functions, and is arguably clearer. However, it is a bit more verbose, so it is common in Haskell to move the arguments to the left side of <code>=</code> as much as possible.</p>\n"}], "owner": {"reputation": 379, "user_id": 4109231, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2e87fcd086c4117dee2176405836a74e?s=128&d=identicon&r=PG", "display_name": "Asterisk", "link": "https://stackoverflow.com/users/4109231/asterisk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 1, "accepted_answer_id": 35406888, "answer_count": 2, "score": 1, "last_activity_date": 1531180258, "creation_date": 1455512643, "last_edit_date": 1531180258, "question_id": 35401811, "link": "https://stackoverflow.com/questions/35401811/confusing-map-function-definition-in-wadlers-paper", "title": "Confusing map function definition in Wadler&#39;s paper", "body": "<p>Can someone please help me understand this map definition in Professor Wadler's original paper Monads for Functional Programming (Haskell). </p>\n\n<pre><code>map :: (a \u2192 b) \u2192(M a \u2192M b)     \nmap  f m =m &gt;= \u03bba.unit(f a)\n</code></pre>\n\n<p>I understand why it is declared as a morphism from f::a -> b to g::Ma -> Mb. Why is it confusingly defined as seemingly taking 2 args f and m. m is a computation ( function with side effects) that I assume can be defined as data or type.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 0, "creation_date": 1455505770, "post_id": 35400891, "comment_id": 58503794, "body": "What would you consider &quot;simpler&quot;?"}, {"owner": {"reputation": 8989, "user_id": 1684058, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lhdm7.jpg?s=128&g=1", "display_name": "Lim H.", "link": "https://stackoverflow.com/users/1684058/lim-h"}, "reply_to_user": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 0, "creation_date": 1455506085, "post_id": 35400891, "comment_id": 58503860, "body": "@jwodder I think I am looking for an one-liner combination of parsers"}], "answers": [{"comments": [{"owner": {"reputation": 8989, "user_id": 1684058, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lhdm7.jpg?s=128&g=1", "display_name": "Lim H.", "link": "https://stackoverflow.com/users/1684058/lim-h"}, "edited": false, "score": 0, "creation_date": 1455512820, "post_id": 35401824, "comment_id": 58505458, "body": "Thank you. Exactly what I was looking for"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 12, "last_activity_date": 1455517845, "last_edit_date": 1455517845, "creation_date": 1455512730, "answer_id": 35401824, "question_id": 35400891, "link": "https://stackoverflow.com/questions/35400891/simplify-do-notation/35401824#35401824", "title": "Simplify do notation", "body": "<p>Since your <code>Parser</code> should also be an instance of <a href=\"https://wiki.haskell.org/Typeclassopedia#Applicative\"><code>Applicative</code></a>:</p>\n\n<pre><code>timeParser :: Parser Time\ntimeParser = Time &lt;$&gt; (digits &lt;* colon) &lt;*&gt; (digits &lt;* colon) &lt;*&gt; digits &lt;*&gt; period\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8989, "user_id": 1684058, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lhdm7.jpg?s=128&g=1", "display_name": "Lim H.", "link": "https://stackoverflow.com/users/1684058/lim-h"}, "edited": false, "score": 0, "creation_date": 1455520956, "post_id": 35402429, "comment_id": 58508563, "body": "Thanks this is pretty great as well"}], "tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": false, "score": 3, "last_activity_date": 1455517159, "last_edit_date": 1455517159, "creation_date": 1455516014, "answer_id": 35402429, "question_id": 35400891, "link": "https://stackoverflow.com/questions/35400891/simplify-do-notation/35402429#35402429", "title": "Simplify do notation", "body": "<p>By simply tossing out the results of <code>colon</code>, a shortened version of your function (that still uses do-notation) might look something like this:</p>\n\n<pre><code>timeParser :: Parser Time\ntimeParser = do\n  hh &lt;-          digits\n  mm &lt;- colon &gt;&gt; digits\n  ss &lt;- colon &gt;&gt; digits\n  p  &lt;- period\n  return $ Time hh mm ss p\n</code></pre>\n\n<p>Any further desugaring of the do-notation would sacrifice readability. </p>\n\n<p>That being said, I really like Zeta's answer and the applicative style of programming in Haskell floors me.</p>\n"}], "owner": {"reputation": 8989, "user_id": 1684058, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lhdm7.jpg?s=128&g=1", "display_name": "Lim H.", "link": "https://stackoverflow.com/users/1684058/lim-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 1, "accepted_answer_id": 35401824, "answer_count": 2, "score": 2, "last_activity_date": 1455517845, "creation_date": 1455505645, "question_id": 35400891, "link": "https://stackoverflow.com/questions/35400891/simplify-do-notation", "title": "Simplify do notation", "body": "<p>I'm trying to perform very simple parsing of time string</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Time = Time Int Int Int String\n\n-- example input: 07:00:00AM\ntimeParser :: Parser Time\ntimeParser = do\n    hh &lt;- digits\n    _ &lt;- colon\n    mm &lt;- digits\n    _ &lt;-colon\n    ss &lt;- digits\n    p &lt;- period\n    return $ Time hh mm ss p\n</code></pre>\n\n<p>Is there any way to simplify the <code>do</code> block with a combination of <code>(&gt;&gt;)</code> and <code>(&gt;&gt;=)</code> operators?</p>\n"}, {"tags": ["debugging", "haskell", "stack-trace", "compiler-options"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1455517100, "post_id": 35400613, "comment_id": 58506891, "body": "As far as I know, no. There&#39;s an interface for RTS options, but none for compiler options."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1455533768, "creation_date": 1455533768, "answer_id": 35407515, "question_id": 35400613, "link": "https://stackoverflow.com/questions/35400613/haskell-program-get-compiler-args-programmatically/35407515#35407515", "title": "Haskell program get compiler args programmatically?", "body": "<p>Perhaps <code>GHC.RTS.Flags.getProfFlags</code> provides enough information?</p>\n\n<p>No profiling:</p>\n\n<pre><code>ProfFlags {doHeapProfile = NoHeapProfiling, \n           heapProfileInterval = 100000000, heapProfileIntervalTicks = 10,\n           includeTSOs = False, showCCSOnException = False, \n           maxRetainerSetSize = 0, ccsLength = 0, modSelector = Nothing, \n           descrSelector = Nothing, typeSelector = Nothing, ccSelector = Nothing,\n           ccsSelector = Nothing, retainerSelector = Nothing, bioSelector = Nothing}\n</code></pre>\n\n<p>With <code>-prof</code>:</p>\n\n<pre><code>ProfFlags {doHeapProfile = NoHeapProfiling, heapProfileInterval = 100000000,\n           heapProfileIntervalTicks = 100, includeTSOs = False,\n           showCCSOnException = False, maxRetainerSetSize = 107374182408,\n           ccsLength = 25, modSelector = Nothing, descrSelector = Nothing, \n           typeSelector = Nothing, ccSelector = Nothing, ccsSelector = Nothing,\n           retainerSelector = Nothing, bioSelector = Nothing}\n</code></pre>\n\n<p>I guess that these are dynamic parameters, but they seem to be affected by <code>-prof</code>. So, perhaps it's enough for your purposes (?)</p>\n"}], "owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1548145942, "creation_date": 1455503303, "last_edit_date": 1548145942, "question_id": 35400613, "link": "https://stackoverflow.com/questions/35400613/haskell-program-get-compiler-args-programmatically", "title": "Haskell program get compiler args programmatically?", "body": "<p>Is it possible to get the compiler args programmatically in Haskell? </p>\n\n<p>I am writing a stack trace formatting library and I would find it very useful to know if \"-prof\" and \"-fprof-auto\" were used when compiling.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455500658, "post_id": 35399742, "comment_id": 58502796, "body": "Have you tried writing the function, and letting it infer the type? Alternatively if you cannot do that, there is a fairly good explanation of <code>mtl</code> monad transformers <a href=\"https://en.wikibooks.org/wiki/Haskell/Monad_transformers\" rel=\"nofollow noreferrer\">here</a> including examples."}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 1, "last_activity_date": 1455516867, "creation_date": 1455516867, "answer_id": 35402623, "question_id": 35399742, "link": "https://stackoverflow.com/questions/35399742/monad-transformers-random-error-log-for-board-game-service/35402623#35402623", "title": "Monad transformers - random + error + log for board game service", "body": "<p>You can use monad trasformers to make up a monad, that would provide a way to generate random numbers, hold state and other things you want to do.</p>\n\n<p>Let's start with <code>MonadRandom</code>. The documentation says that <code>IO</code> is an instance of it, so we can use it as base monad:</p>\n\n<pre><code>newtype Game a = Game (IO a)\n</code></pre>\n\n<p>To make <code>Game</code> store and modify data let's make it a <code>MonadState</code> by wrapping it into <code>StateT</code>:</p>\n\n<pre><code>data GameState = GameState {\n                 , numPlayers :: Int\n                 , deck :: [Int]\n                 , hands :: [[Int]]\n                 }\n\nnewtype Game a = Game (StateT GameState (IO a))\n</code></pre>\n\n<p>In the same way you can teach <code>Game</code> to provide logging facilities via <code>WriterT</code>:</p>\n\n<pre><code>type LogType = String\n\nnewtype Game a = Game (WriterT LogType (StateT GameState (IO a)))\n</code></pre>\n"}], "owner": {"reputation": 318, "user_id": 155498, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b390179c534051b8937d51f2f11e22ff?s=128&d=identicon&r=PG", "display_name": "beefsack", "link": "https://stackoverflow.com/users/155498/beefsack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1455516867, "creation_date": 1455495951, "question_id": 35399742, "link": "https://stackoverflow.com/questions/35399742/monad-transformers-random-error-log-for-board-game-service", "title": "Monad transformers - random + error + log for board game service", "body": "<p>I'm currently trying to port a significantly sized project from Go to Haskell (board games by email service) as I've been having fun writing Haskell recently and find it models game logic quite well.</p>\n\n<p>I've got a fairly clear idea of what I want to achieve having written the service and 25 games previously, but I'm not certain it's the best way to go about it or exactly how to implement it.</p>\n\n<p>The majority of the exposed board game functions have the following:</p>\n\n<ul>\n<li>Randomness</li>\n<li>Errors (mainly validation, when doing things that would break game rules)</li>\n<li>Logging (a human readable log is produced when things happen in the game)</li>\n</ul>\n\n<p>The monads I've been attempting to use are the following:</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/MonadRandom-0.1.7/docs/Control-Monad-Random-Class.html#t:MonadRandom\" rel=\"nofollow\">MonadRandom</a></li>\n<li><a href=\"https://hackage.haskell.org/package/category-extras-0.52.0/docs/Control-Monad-Either.html\" rel=\"nofollow\">Either</a></li>\n<li><a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Writer.html\" rel=\"nofollow\">Writer</a></li>\n</ul>\n\n<p>My problem is that I'm struggling to figure out how I can use all three in a single function.  For a fairly contrived example, I define a type for the game data and pass that into and return it from a number of these function:</p>\n\n<pre><code>data Game = Game { rnd :: Int\n                 , numPlayers :: Int\n                 , deck :: [Int]\n                 , hands :: [[Int]]\n                 }\n\n-- newGame takes a player count and returns a Game.  Needs randomness, errors and logging.\nnewGame :: Int -&gt; ? Game\n\n-- drawCard takes a player number and an existing Game and returns a Game.  Needs errors and logging.\ndrawCard :: Int -&gt; Game -&gt; ? Game\n</code></pre>\n\n<p>Actual implementations of these sorts of functions aren't an issue if they just return <code>Game</code> or use a single monad.  The moment I start needing to combine monads is when I start tripping over myself.</p>\n\n<p>If anyone is able to provide an example of how you would combine monads for the two contrived functions I'd be hugely appreciative.  I think once I have a couple of examples I can jump this hurdle and keep learning as I go.</p>\n"}, {"tags": ["haskell", "non-exhaustive-patterns"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1455493576, "post_id": 35399267, "comment_id": 58501209, "body": "Whoever wrote the comment <code>postcondition: NNF (\u03c6) computes a NNF for \u03c6</code> deserves a decent spanking."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1455498284, "post_id": 35399267, "comment_id": 58502258, "body": "Why reject implications?"}, {"owner": {"reputation": 5, "user_id": 5364621, "user_type": "registered", "profile_image": "https://graph.facebook.com/1501823066795689/picture?type=large", "display_name": "Johnny", "link": "https://stackoverflow.com/users/5364621/johnny"}, "edited": false, "score": 0, "creation_date": 1455589700, "post_id": 35399267, "comment_id": 58545461, "body": "actually,  this nnf function is part of the Conjunction Normal Form(CNF). and the parameter for the nnf is a imply free formulas. I also finish a function called IMPY_FREE.    CNF is implemented as: CNF(NNF(IMPY_FREE( Wff ) ) )"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1455493899, "creation_date": 1455493899, "answer_id": 35399509, "question_id": 35399267, "link": "https://stackoverflow.com/questions/35399267/haskell-negation-normal-forms-function-get-non-exhaustive-pattern-exception/35399509#35399509", "title": "haskell: negation normal form&#39;s function get &quot;Non-exhaustive pattern&quot; exception", "body": "<p>You're simply inserting the line at the wrong place. <code>nnf (Not p) = ...</code> is a catch-all for negations. If you then later add other clauses that deal with more specific negations like <code>Not (And p q)</code>, they can't possibly trigger anymore.</p>\n\n<p>The catch-all clause needs to come last, i.e.</p>\n\n<pre><code>nnf (Var p) = Var p\nnnf (Not (Not p)) = (nnf p)\nnnf (And p q) = And (nnf p) (nnf q)\nnnf (Or p q) = Or (nnf p) (nnf q)\nnnf (Not (And p q)) = Or (nnf $ Not p) (nnf $ Not q)\nnnf (Not (Or p q)) = And (nnf $ Not p) (nnf $ Not q)\nnnf (Not p) = Not $ nnf p\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 5364621, "user_type": "registered", "profile_image": "https://graph.facebook.com/1501823066795689/picture?type=large", "display_name": "Johnny", "link": "https://stackoverflow.com/users/5364621/johnny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 602, "favorite_count": 1, "accepted_answer_id": 35399509, "answer_count": 1, "score": 0, "last_activity_date": 1455498143, "creation_date": 1455492154, "last_edit_date": 1455498143, "question_id": 35399267, "link": "https://stackoverflow.com/questions/35399267/haskell-negation-normal-forms-function-get-non-exhaustive-pattern-exception", "title": "haskell: negation normal form&#39;s function get &quot;Non-exhaustive pattern&quot; exception", "body": "<pre><code>-- | data type definition of WFF: well formed formula\ndata Wff = Var String \n        | Not Wff\n        | And Wff Wff \n        | Or Wff Wff\n        | Imply Wff Wff\n\n-- | Negation norm form  nnf function\n--   precondition: \u03c6 is implication free\n--   postcondition: NNF (\u03c6) computes a NNF for \u03c6\nnnf :: Wff -&gt; Wff\nnnf (Var p) = Var p\nnnf (Not (Not p)) = (nnf p)\nnnf (And p q) = And (nnf p) (nnf q)\nnnf (Or p q) = Or (nnf p) (nnf q)\nnnf (Not (And p q)) = Or (nnf(Not p)) (nnf(Not q))\nnnf (Not (Or p q)) = And (nnf(Not p)) (nnf(Not q))\n</code></pre>\n\n<p>Test case: &not;(<em>p</em> &vee; <em>Q</em>)</p>\n\n<pre><code>(*** Exception:: Non-exhaustive patterns in function nnf\n</code></pre>\n\n<p>However, if I add <code>nnf (Not p) = Not (nnf p)</code> into the function, it will show</p>\n\n<pre><code>Pattern match(es) are overlapped\nIn an equation for \u2018nnf\u2019:\n    nnf (Not (Not p)) = ...\n    nnf (Not (And p q)) = ...\n    nnf (Not (Or p q)) = ...\n</code></pre>\n\n<p>I am wondering what I am doing wrong?</p>\n"}, {"tags": ["haskell", "abstract-syntax-tree", "pretty-print"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1455488498, "post_id": 35398355, "comment_id": 58499730, "body": "There is no such language feature in Haskell as there is Coq - you are likely stuck writing a parser yourself. The standard <a href=\"https://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Expr.html\" rel=\"nofollow noreferrer\">parsec</a> can handle this use case quite easily. <a href=\"https://hackage.haskell.org/package/boomerang-1.4.5.1\" rel=\"nofollow noreferrer\">Some</a> <a href=\"https://hackage.haskell.org/package/invertible-syntax\" rel=\"nofollow noreferrer\">libraries</a> allow you to define both a parser and pretty printer from some specification of the grammar."}], "answers": [{"tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": true, "score": 4, "last_activity_date": 1455521853, "creation_date": 1455521853, "answer_id": 35403826, "question_id": 35398355, "link": "https://stackoverflow.com/questions/35398355/pretty-printing-syntax-tree-with-operator-precedence-and-associativity-in-haskel/35403826#35403826", "title": "Pretty Printing Syntax Tree with Operator Precedence and Associativity in Haskell", "body": "<p>A <code>Show</code> instance for <code>Formula</code> might look like this:</p>\n\n<pre><code>instance Show Formula where\n  showsPrec _ (Atom name) = showString name\n  showsPrec p (Not formula) = showParen (p &gt; 3) $\n    showString \"\\\\+ \" . showsPrec 3 formula\n  showsPrec p (And lhs rhs) = showParen (p &gt; 2) $\n    showsPrec 3 lhs . showString \" /\\\\ \" . showsPrec 2 rhs\n  showsPrec p (Or lhs rhs) = showParen (p &gt; 1) $\n    showsPrec 2 lhs . showString \" \\\\/ \" . showsPrec 1 rhs\n  showsPrec p (Imp lhs rhs) = showParen (p &gt; 0) $\n    showsPrec 1 lhs . showString \" -&gt; \" . showsPrec 0 rhs\n</code></pre>\n\n<p>Which will allow any <code>Formula</code> to be <code>show</code>n with appropriate parens:</p>\n\n<pre><code>main = print $ Imp (And (Imp (Atom \"A\") (Atom \"B\")) (Atom \"A\")) (Atom \"B\")\n</code></pre>\n\n<p>Prints (<code>print</code> is <code>putStrLn . show</code>):</p>\n\n<pre><code>(A -&gt; B) /\\ A -&gt; B\n</code></pre>\n"}], "owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 743, "favorite_count": 5, "accepted_answer_id": 35403826, "answer_count": 1, "score": 5, "last_activity_date": 1526637436, "creation_date": 1455486236, "question_id": 35398355, "link": "https://stackoverflow.com/questions/35398355/pretty-printing-syntax-tree-with-operator-precedence-and-associativity-in-haskel", "title": "Pretty Printing Syntax Tree with Operator Precedence and Associativity in Haskell", "body": "<p>Is there any commonly used method or even a library for pretty printing (and parsing) a syntax tree with (binary) operators that have an associativity and a precedence level assigned, so that the result uses as few brackets as possible?</p>\n\n<hr>\n\n<p>Take the formulas of propositional calculus as an example:</p>\n\n<pre><code>data Formula\n    = Atom String\n    | Not (Formula)\n    | And (Formula) (Formula)\n    | Or (Formula) (Formula)\n    | Imp (Formula) (Formula) \n</code></pre>\n\n<p>Assume that the precedence is <code>Imp</code> &lt; <code>Or</code> &lt; <code>And</code> &lt; <code>Not</code> (so <code>Not</code> binds the most) and that <code>And</code>, <code>Or</code> and <code>Imp</code> should associate to the right; so for example <code>Imp (And (Imp (Atom \"A\") (Atom \"B\")) (Atom \"A\")) (Atom \"B\")</code> should print something like <code>(A -&gt; B) /\\ A -&gt; B</code>.</p>\n\n<hr>\n\n<p>Of course this could be achieved by pattern matching but this is tedious and very unpleasant; I'm looking for something similarly simple to this notation from the Coq proof assistant:</p>\n\n<pre><code>Notation \"A /\\ B\" := (and A B) (at level 80, right associativity).\n</code></pre>\n\n<p>which generates a parser and a pretty printer.</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1455485579, "post_id": 35398161, "comment_id": 58498787, "body": "does it help you if you rephrase it as <code>fmap f (undefined :: String -&gt; (Int -&gt; Bool))</code>? Because this is what you are saying (basically <code>String</code> stays <code>String</code> but you replace <code>Int</code> with <code>Int -&gt; Bool</code>  to <i>match the needed pattern</i>)"}, {"owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1455486907, "post_id": 35398161, "comment_id": 58499240, "body": "@Carsten I understand that grouping, but no it doesn&#39;t help me because I&#39;m still left with the same type signature. If my function of type <code>String -&gt; Int -&gt; Bool</code> is opaque to me, then there&#39;d be no way for me to implement this <code>fmap</code>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1455487333, "post_id": 35398161, "comment_id": 58499397, "body": "no there is no way to implement the <code>fmap</code> fo <code>f a = (String -&gt; Int) -&gt; Bool -&gt; a</code> - at least not directly - you can always wrap this into something like <code>newtype MyMap a = String -&gt; Int -&gt; Bool -&gt; a</code> and make <code>MyMap</code> an instance of <code>Functor</code> - but then you have to wrap/unwarp the constructor"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1455503255, "post_id": 35398161, "comment_id": 58503273, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/5310203/how-to-use-instances-of-monad-and-confusion-about\">How to use (-&gt;) instances of Monad and confusion about (-&gt;)</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1455498067, "post_id": 35398570, "comment_id": 58502220, "body": "You can unify the layers; you just can&#39;t do it with a standard <code>Monad</code>. You certainly can do something like <code>uncurry</code> generally. I would also guess that given an appropriate  relationship between the argument types, you could probably do something with indexed monads."}, {"owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "edited": false, "score": 0, "creation_date": 1455520690, "post_id": 35398570, "comment_id": 58508430, "body": "I think <code>\\f -&gt; fmap (fmap f) (undefined :: String -&gt; Int -&gt; Bool) :: (Bool -&gt; b) -&gt; String -&gt; Int -&gt; b</code> is what I was looking for. Thanks!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1455503415, "last_edit_date": 1455503415, "creation_date": 1455487408, "answer_id": 35398570, "question_id": 35398161, "link": "https://stackoverflow.com/questions/35398161/how-to-interpret-fmap-where-f-a-c-d-e/35398570#35398570", "title": "How to interpret fmap where f a = c -&gt; d -&gt; e", "body": "<p>There is actually no such thing as a function with two parameters in Haskell. Every function has exactly one parameter.</p>\n\n<p>In particular, <code>String -&gt; Int -&gt; Bool</code> is a function which accepts one <code>String</code> parameter. (Of course, knowing that the result is again a function you are able to use it <em>as if it were</em> a function with two parameters.) So if you want to unify this with <code>f a</code>, you need</p>\n\n<pre><code>f ~ (String-&gt;)\na ~ Int-&gt;Bool\n</code></pre>\n\n<p>Indeed <code>Int-&gt;Bool</code> can itself be interpreted as a functor-application<sup>&dagger;</sup></p>\n\n<pre><code>f ~ (String-&gt;)\ng ~ (Int-&gt;)\nb ~ Bool\n</code></pre>\n\n<p>so that <code>String-&gt;Int-&gt;Bool ~ f (g b)</code>; thus</p>\n\n<pre><code>\\f -&gt; fmap (fmap f) (undefined :: String -&gt; Int -&gt; Bool)\n       :: (Bool -&gt; b) -&gt; String -&gt; Int -&gt; b\n</code></pre>\n\n<p>I don't think the function family of functors is really a good example for grasping properties of functors/applicatives/monads. List and maybes are generally much less confusing; instead of the plain function functor the equivalent <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Reader.html\" rel=\"nofollow\"><code>Reader</code></a> is preferred when you need that functionality (pun not intended).</p>\n\n<p>Regarding your original expression, that is actually not meaningless. If we translate it to a tamer functor, we could for instance write</p>\n\n<pre><code>&gt; fmap ($2) [(&gt;1), (&gt;2), (&gt;3)]\n            [True, False, False]\n</code></pre>\n\n<p>Much the same thing can be done with the function functor:</p>\n\n<pre><code>&gt; fmap ($2) (&lt;) 1\nTrue\n&gt; fmap ($2) (&lt;) 2\nFalse\n&gt; fmap ($2) (&lt;) 3\nFalse\n</code></pre>\n\n<p>Of course that example is a bit too simple to be useful, but you can also implement nontrivial ones.</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>Note that <code>f</code> and <code>g</code> are actually <em>not the same functor</em>. We tend to call them both &ldquo;<em>the</em> function functor&rdquo;, but really you get a different functor for every partial application of the <code>(-&gt;)</code> constructor. That means, you can't in any way unify the two layers, even though there's a <code>Monad (a-&gt;)</code> instance.</sub></p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 35398570, "answer_count": 1, "score": 0, "last_activity_date": 1455503415, "creation_date": 1455485108, "last_edit_date": 1455487027, "question_id": 35398161, "link": "https://stackoverflow.com/questions/35398161/how-to-interpret-fmap-where-f-a-c-d-e", "title": "How to interpret fmap where f a = c -&gt; d -&gt; e", "body": "<p>I'm trying to understand some code and I'm getting myself tangled fairly well. Please help me to understand my logic, or lack thereof ...</p>\n\n<p>To start:</p>\n\n<pre><code>*Main&gt; :t fmap\nfmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>If I just want <code>f a</code> to be a function that takes one parameter, it's okay and makes sense:</p>\n\n<pre><code>*Main&gt; :t \\f -&gt; fmap f (undefined :: String -&gt; Int)\n\\f -&gt; fmap f (undefined :: String -&gt; Int) :: (Int -&gt; b) -&gt; String -&gt; b\n</code></pre>\n\n<p>I can pass in a <code>String</code> in the second param, which generates an <code>Int</code>, and then use the function in the first param to generate the <code>b</code>.</p>\n\n<p>Now, I want <code>f a</code> to be a function that takes two parameters, so I substitute that in:</p>\n\n<pre><code>*Main&gt; :t \\f -&gt; fmap f (undefined :: String -&gt; Int -&gt; Bool)\n\\f -&gt; fmap f (undefined :: String -&gt; Int -&gt; Bool) \n    :: ((Int -&gt; Bool) -&gt; b) -&gt; String -&gt; b\n</code></pre>\n\n<p>At this point, I'm confused. I already provided the function that converts from the <code>String</code> and the <code>Int</code> into the <code>Bool</code>. How can I now provide another function that <em>takes</em> a <code>Int -&gt; Bool</code> to convert into a <code>b</code>? Is this non-sensical or am I not reading this right? </p>\n\n<p>Or maybe this is a case of a functor within a functor and more needs to be done to make this make sense? In which case, what?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 2, "creation_date": 1455485578, "post_id": 35397857, "comment_id": 58498786, "body": "answer to your original question: <a href=\"http://stackoverflow.com/a/35392818/625914\">stackoverflow.com/a/35392818/625914</a>"}, {"owner": {"reputation": 7618, "user_id": 1509744, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/1f661ea35aa6e2858e56717c813c8280?s=128&d=identicon&r=PG&f=1", "display_name": "gen", "link": "https://stackoverflow.com/users/1509744/gen"}, "edited": false, "score": 0, "creation_date": 1455543441, "post_id": 35397857, "comment_id": 58522248, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/35388734/haskell-recursive-list-function\">Haskell: Recursive List Function</a>"}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 5924314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b8b2e82edbf036a083f245a1bd8bbe?s=128&d=identicon&r=PG&f=1", "display_name": "K. Anderson", "link": "https://stackoverflow.com/users/5924314/k-anderson"}, "edited": false, "score": 0, "creation_date": 1455491753, "post_id": 35397993, "comment_id": 58500658, "body": "Thanks. I am trying to experiment with this function to try and really understand what is happening, but the only problem is I can&#39;t get what you provided to compile. Am I missing something here? Any ideas?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 71, "user_id": 5924314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b8b2e82edbf036a083f245a1bd8bbe?s=128&d=identicon&r=PG&f=1", "display_name": "K. Anderson", "link": "https://stackoverflow.com/users/5924314/k-anderson"}, "edited": false, "score": 0, "creation_date": 1455492643, "post_id": 35397993, "comment_id": 58500945, "body": "@K.Anderson no, it&#39;s just that my code didn&#39;t work yet. Fixed now."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1455492603, "last_edit_date": 1455492603, "creation_date": 1455483967, "answer_id": 35397993, "question_id": 35397857, "link": "https://stackoverflow.com/questions/35397857/haskell-recursive-function-on-sets/35397993#35397993", "title": "Haskell: Recursive Function on Sets", "body": "<p>The problem is that with <code>[(b:qs):qss | (qs:qss) &lt;- separate bs]</code>, you only prepend <code>b</code> to the <em>first</em> subset of each of the <code>bs</code> partitions. You want to prepend it to <em>every</em> subset.</p>\n\n<pre><code>separate (b:bs) = [[b]:s | s &lt;- separate bs]\n               ++ (singleModifies (b:) =&lt;&lt; separate bs)\n\n-- | All possibilities of applying a function to exactly one element in the list.\nsingleModifies :: (a-&gt;a) -&gt; [a] -&gt; [[a]]\nsingleModifies _ [] = []\nsingleModifies f (x:xs) = (f x:xs) : map (x:) (singleModifies f xs) \n</code></pre>\n\n<p>In case you don't understand what the <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:-62--62--61-\" rel=\"nofollow\"><code>=&lt;&lt;</code></a> operator does: it &ldquo;flattens&rdquo; the nesting of lists. <code>separate bs</code> already generates a list of partitions; for each of these we get another list from <code>singleModifies</code>, but in the end we're not interested in which list came from where, so we just <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Control-Monad.html#v:join\" rel=\"nofollow\">join</a> (aka <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:concat\" rel=\"nofollow\">concat</a>) them together. Another way for writing this would be</p>\n\n<pre><code>separate (b:bs) = [[b]:s | s &lt;- separate bs]\n               ++ concat [singleModifies (b:) bp | bp &lt;- separate bs]\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 5924314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b8b2e82edbf036a083f245a1bd8bbe?s=128&d=identicon&r=PG&f=1", "display_name": "K. Anderson", "link": "https://stackoverflow.com/users/5924314/k-anderson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1455504728, "creation_date": 1455483149, "last_edit_date": 1455504728, "question_id": 35397857, "link": "https://stackoverflow.com/questions/35397857/haskell-recursive-function-on-sets", "title": "Haskell: Recursive Function on Sets", "body": "<p>I am new to Haskell and I am trying to write a (somewhat) basic recursive function that generates the partitions of a set. I am referencing this wiki page (<a href=\"https://en.wikipedia.org/wiki/Partition_of_a_set\" rel=\"nofollow\">https://en.wikipedia.org/wiki/Partition_of_a_set</a>) for my definition of set partitions.</p>\n\n<p>I currently have a function that produces most, but not all, of the partitions:</p>\n\n<pre><code>separate :: [a] -&gt; [[[a]]]\nseparate [] = [[]]\nseparate (b:bs) = [[b]:s | s &lt;- separate bs] ++ [(b:qs):qss | (qs:qss) &lt;- separate bs]\n\n&gt;separate [1,2,3]\n[[[1],[2],[3]],[[1],[2,3]],[[1,2],[3]],[[1,2,3]]]\n</code></pre>\n\n<p>As you can see it is missing the <code>[[1,3],[2]]</code> variant.</p>\n\n<p>I was wondering if this function could be easily modified to accommodate my requirements, or if a whole new function would need to be created. Thanks.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 3, "last_activity_date": 1455482928, "last_edit_date": 1455482928, "creation_date": 1455482200, "answer_id": 35397684, "question_id": 35397488, "link": "https://stackoverflow.com/questions/35397488/parsing-dates-from-csv-with-cassava/35397684#35397684", "title": "Parsing dates from csv with cassava", "body": "<p>You are using <code>show</code>, which wraps the value in double quotes. <code>parseTimeM</code> is receiving the value <code>\"\\\"2001/12/18\\\"\"</code>, and it doesn't know expect the quotes at the beginning and end of the string. Remove those quotes and you should be fine.</p>\n"}, {"tags": [], "owner": {"reputation": 1502, "user_id": 2545980, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FaKkG.jpg?s=128&g=1", "display_name": "Alojzy Leszcz", "link": "https://stackoverflow.com/users/2545980/alojzy-leszcz"}, "is_accepted": false, "score": 0, "last_activity_date": 1609382281, "creation_date": 1609382281, "answer_id": 65515990, "question_id": 35397488, "link": "https://stackoverflow.com/questions/35397488/parsing-dates-from-csv-with-cassava/65515990#65515990", "title": "Parsing dates from csv with cassava", "body": "<p>The question is pretty old, but I've just dealt with it myself, so let me post it here.</p>\n<p>According to the manual, <code>parseField</code> is a function of type:</p>\n<pre class=\"lang-hs prettyprint-override\"><code>parseField :: Field -&gt; Parser a \n</code></pre>\n<p>In our case we want type <code>a</code> to be <code>Day</code>, while <code>Field</code> is just a type alias</p>\n<pre class=\"lang-hs prettyprint-override\"><code>type Field = ByteString\n</code></pre>\n<p>The function that you use:</p>\n<pre><code>parseTimeM True defaultTimeLocale &quot;%Y/%m/%d&quot;\n</code></pre>\n<p>Expects a <code>String</code>, not a <code>ByteString</code>. So in order to make everything correct, you need to provide an adapter function <code>ByteString -&gt; String</code>.</p>\n<p>Using <code>show</code> makes it all type check, but it has the flaw that it leaves the quotation marks in the resulting string.\nA better choice would be to use <code>unpack</code> function that is meant to perform the conversion between the types.</p>\n<p>So the entire code is:</p>\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.ByteString.Char8 (unpack)\n\ninstance FromField Data.Time.Day where\n    parseField = parseTimeM True defaultTimeLocale &quot;%Y/%m/%d&quot; . unpack\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 3843434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4de61fb91fb3ba094c87f518533d617b?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/3843434/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 441, "favorite_count": 0, "accepted_answer_id": 35397684, "answer_count": 2, "score": 6, "last_activity_date": 1609382281, "creation_date": 1455481053, "question_id": 35397488, "link": "https://stackoverflow.com/questions/35397488/parsing-dates-from-csv-with-cassava", "title": "Parsing dates from csv with cassava", "body": "<p>I'm trying to parse a csv file with data like this.  I can parse with the date as a string, but haven't been able to get them in a day format.  I finally got this to type check, but now I have a parse error and am hoping for some help.</p>\n\n<pre><code>2001/12/18, 281\n2001/12/19, 280\n2001/12/20, 276\n2001/12/21, 278\n</code></pre>\n\n<p>Here's my code so far.</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nimport qualified Data.ByteString.Lazy as BL\nimport Data.Csv\nimport qualified Data.Vector as V\nimport Data.Time\nimport Generics.Deriving\n\ndatadir=\"/home/john/.stack/test/data/\"  \n\ndata Sample = Sample { dateMeasure :: !Data.Time.Day \n                 , valueMeasure :: !Int \n                 } deriving (Generic, Show)   \n\ninstance FromRecord Sample \n\ninstance FromField Data.Time.Day where\n    parseField = parseTimeM True defaultTimeLocale \"%Y/%m/%d\" . show \n\nprintRecord :: Sample -&gt; IO ()\nprintRecord r  = putStrLn $  show (dateMeasure r) ++ \" measurement is \" ++    show (valueMeasure r) \n\nmain :: IO ()\nmain = do\n    csvData &lt;- BL.readFile $ datadir ++ \"sample.csv\"\n    case decode NoHeader csvData :: Either String (V.Vector Sample) of\n        Left err -&gt; putStrLn err\n        Right v -&gt; V.forM_ v $ printRecord   \n</code></pre>\n\n<p>Here is the error I am getting</p>\n\n<pre><code>~/.stack/test/ stack exec test\nparse error (Failed reading: conversion error: parseTimeM: no parse of \"\\\"2001/12/18\\\"\") at \n2001/12/19, 280\n2001/12/20, 276\n2001/12/21, 278\n2001/12/26, 278\n2001/12/27, 278\n2001/12/28, 2 (truncated)\n</code></pre>\n"}, {"tags": ["debugging", "haskell", "printing", "stdout"], "answers": [{"comments": [{"owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "edited": false, "score": 0, "creation_date": 1455481324, "post_id": 35397297, "comment_id": 58497519, "body": "Sorry, but I will totally use GHC.Stack in my library"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1455479957, "creation_date": 1455479957, "answer_id": 35397297, "question_id": 35397202, "link": "https://stackoverflow.com/questions/35397202/how-to-print-statement-with-line-and-stack-trace-in-haskell/35397297#35397297", "title": "How to print statement with line and stack trace in Haskell?", "body": "<p>You might like to play with <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/GHC-Stack.html\" rel=\"nofollow\">GHC.Stack</a> in the latest release of GHC.</p>\n"}, {"tags": [], "owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "is_accepted": false, "score": 0, "last_activity_date": 1455481131, "last_edit_date": 1455481131, "creation_date": 1455480550, "answer_id": 35397390, "question_id": 35397202, "link": "https://stackoverflow.com/questions/35397202/how-to-print-statement-with-line-and-stack-trace-in-haskell/35397390#35397390", "title": "How to print statement with line and stack trace in Haskell?", "body": "<p>Either use this...</p>\n\n<ol>\n<li><a href=\"http://i.imgur.com/av57mTS.png\" rel=\"nofollow\">Haskell Print Debugger</a> - <a href=\"http://hackage.haskell.org/package/print-debugger\" rel=\"nofollow\">http://hackage.haskell.org/package/print-debugger</a></li>\n</ol>\n\n<p>Or use this...</p>\n\n<ol start=\"2\">\n<li><a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Debug-Trace.html\" rel=\"nofollow\">Debug.Trace.traceStack</a> - <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Debug-Trace.html\" rel=\"nofollow\">https://hackage.haskell.org/package/base-4.8.2.0/docs/Debug-Trace.html</a></li>\n</ol>\n\n<p>The former can print a single line formatted. The latter can print multiple lines unformatted.</p>\n\n<p>Debug.Trace.traceStack requires compiling with -frof and -fprof-auto and running with +RTS -xc</p>\n\n<p>Debug.Trace.traceStack Example (from \"<a href=\"http://dev.stephendiehl.com/hask/\" rel=\"nofollow\">What I Wish I Knew When Learning Haskell</a>\"): </p>\n\n<pre><code>http://dev.stephendiehl.com/hask/):\n    $ ghc -O0 -rtsopts=all -prof -auto-all --make stacktrace.hs\n    ./stacktrace +RTS -xc\n</code></pre>\n\n<p>Haskell Print Debugger Example:</p>\n\n<p>-- <a href=\"http://i.imgur.com/av57mTS.png\" rel=\"nofollow\">http://i.imgur.com/av57mTS.png</a></p>\n\n<pre><code>import Debug.Print.StackTraceDebug\n\nmain = debugTraceIO \"This has a stack trace.\"\n\n____________________________________________\nThis has a stack trace. in thread \"1\" :\n    at Main.call(Main.hs:5)\n</code></pre>\n\n<p>If you just need to find your print statements the first option is a better choice.</p>\n\n<hr>\n\n<p>p.s. I am advertising my own package located here:</p>\n\n<p><a href=\"https://github.com/JohnReedLOL/HaskellPrintDebugger\" rel=\"nofollow\">https://github.com/JohnReedLOL/HaskellPrintDebugger</a></p>\n"}], "owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 558, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1455481131, "creation_date": 1455478925, "question_id": 35397202, "link": "https://stackoverflow.com/questions/35397202/how-to-print-statement-with-line-and-stack-trace-in-haskell", "title": "How to print statement with line and stack trace in Haskell?", "body": "<p>How do you make a print statement with a line number and stack trace in Haskell?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 0, "creation_date": 1455469533, "post_id": 35394493, "comment_id": 58492871, "body": "in <code>a -&gt; b -&gt; c</code>, the <code>a</code> itself can be resolved to <code>d -&gt; e</code> which then the signature would be <code>(d -&gt; e) -&gt; b -&gt; c</code>, or it can be resolved to <code>d -&gt; e -&gt; f</code> which then it would be <code>(d -&gt; e -&gt; f) -&gt; b -&gt; c</code>"}, {"owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "reply_to_user": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 0, "creation_date": 1455469813, "post_id": 35394493, "comment_id": 58492966, "body": "In the case I wrote the function I wanna apply as first argument <code>(a -&gt; b -&gt; a)</code> has to be <code>Num</code> instance right?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1455470749, "post_id": 35394493, "comment_id": 58493296, "body": "Yes, exactly. That is what <code>Num (a -&gt; b -&gt; a) =&gt;</code> says."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1455612999, "post_id": 35397727, "comment_id": 58554472, "body": "Unfortunately, the <code>Monoid</code> class has just such an unfortunate instance. It&#39;s valid, because monoids don&#39;t have cancellation or anything, but it&#39;s <i>weird</i>. Better would be <code>newtype Pull a b = Pull (a -&gt; b)</code> with that instance, and <code>newtype Cat c a b = Cat (c a b)</code> with <code>instance (a ~ b, Category c) =&gt; Monoid (Cat c a b)</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1455619604, "post_id": 35397727, "comment_id": 58559081, "body": "@dfeuer: true, though I recall there was some pretty nice application of that monoid instance, which wouldn&#39;t have worked as nicely with a newtype. (Nor with <code>Num</code>.)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1455482425, "creation_date": 1455482425, "answer_id": 35397727, "question_id": 35394493, "link": "https://stackoverflow.com/questions/35394493/passing-function-as-parameter-weird-case/35397727#35397727", "title": "Passing function as parameter, weird case", "body": "<p>There is <em>nothing special</em> about function types. A polymorphic function <code>a -&gt; a</code> can obviously be used as, say, <code>Int -&gt; Int</code>, or <code>String -&gt; String</code>. But it can just as well be used as <code>(Char-&gt;Double) -&gt; (Char-&gt;Double)</code>. In the example you've tried, you use basically</p>\n\n<pre><code>(+) :: (a-&gt;b-&gt;a) -&gt; (a-&gt;b-&gt;a) -&gt; (a-&gt;b-&gt;a)\n</code></pre>\n\n<p>Parentheses on the result can be ommitted, so this is</p>\n\n<pre><code>(+) :: (a-&gt;b-&gt;a) -&gt; (a-&gt;b-&gt;a) -&gt; a -&gt; b -&gt; a\n</code></pre>\n\n<p>If we supply a <code>const</code>, we then get</p>\n\n<pre><code>(const +) :: (a-&gt;b-&gt;a) -&gt; a -&gt; b -&gt; a\n</code></pre>\n\n<p>So far I didn't bother about the <code>Num</code> constraint. That constraint is actually a problem, though it's not completely nonsensical &ndash; it is <em>in principle</em> possible to declare a <code>Num</code> instance for function types:</p>\n\n<pre><code>instance (Num r) =&gt; Num (a-&gt;r) where\n  fromInteger = const . fromInteger\n  f + g = \\x -&gt; f x + g x\n  negate f = negate . f\n  ...\n</code></pre>\n\n<p>Then the constraint <code>Num (a-&gt;b-&gt;a)</code> would be equivalent to <code>Num (b-&gt;a)</code>, which in turn would be equivalent to <code>Num a</code> alone. You can then actually use addition of functions like <code>const</code>: since this is a two-parameter function, the result of the addition will</p>\n\n<pre><code>&gt; (const + \\x y -&gt; y) 1 1\n2\n&gt; (const + \\x y -&gt; x*y) 1 0\n1\n</code></pre>\n\n<p>and so on.</p>\n\n<p><em>However</em>, just because it's possible to define an instance doesn't necessarily mean it's a good idea; it can also lead to weird unexpected behaviour. In particular, the <code>Num</code> instance for functions fails to fulfill the <a href=\"https://en.wikipedia.org/wiki/Field_%28mathematics%29\" rel=\"nofollow\">field axioms</a>. The instance is not defined in the standard library, and IMO this is good. Hence, <code>(+) const</code> does not <em>actually</em> make any sense in Haskell.</p>\n"}, {"tags": [], "owner": {"reputation": 9436, "user_id": 444705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e754cabb8c4f443410c1fd107ecdfd8?s=128&d=identicon&r=PG", "display_name": "Pi Delport", "link": "https://stackoverflow.com/users/444705/pi-delport"}, "is_accepted": false, "score": 1, "last_activity_date": 1455610865, "creation_date": 1455610865, "answer_id": 35427240, "question_id": 35394493, "link": "https://stackoverflow.com/questions/35394493/passing-function-as-parameter-weird-case/35427240#35427240", "title": "Passing function as parameter, weird case", "body": "<p>Any type variable can be instantiated with a function type, too.</p>\n\n<p>The simplest example that gave me an \"a ha\" moment was to realise that:</p>\n\n<pre><code>($) :: (a -&gt; b) -&gt; (a -&gt; b)\n</code></pre>\n\n<p>is just a special case of:</p>\n\n<pre><code>id :: a -&gt; a\n</code></pre>\n\n<p>In other words, you can use <code>id</code> just like <code>$</code>, as an infix application operator:</p>\n\n<pre><code>ghci&gt; negate $ 5\n-5\nghci&gt; negate `id` 5\n-5\nghci&gt; map ($ 5) [negate,(2*),(1+)]\n[-5,10,6]\nghci&gt; map (`id` 5) [negate,(2*),(1+)]\n[-5,10,6]\n</code></pre>\n\n<p>You can literally define <code>($)</code> as <code>id</code>, just with the type narrowed down to functions:</p>\n\n<pre><code>($) :: (a -&gt; b) -&gt; a -&gt; b\n($) = id\n</code></pre>\n\n<p>So, in summary, anywhere you see a type variable like <code>a</code>, you can choose to instantiate it with a function type like <code>(b -&gt; c)</code>.</p>\n"}], "owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 35397727, "answer_count": 2, "score": 1, "last_activity_date": 1455610865, "creation_date": 1455469310, "last_edit_date": 1455470253, "question_id": 35394493, "link": "https://stackoverflow.com/questions/35394493/passing-function-as-parameter-weird-case", "title": "Passing function as parameter, weird case", "body": "<p>I fear that it might come out as extremely cringy, but I don't know where else to ask.</p>\n\n<p>For a while I thought if a function accepts another function as parameter it had to specifically say it in the type, i.e <code>f :: (a -&gt; a -&gt; a) -&gt; b -&gt; c</code>. So that I can pass something like <code>g :: a -&gt; a -&gt; a</code> as its first paramater and concrete type parameter as second, but nothing else.</p>\n\n<p>But I have just discovered that I can apply <code>const :: a -&gt; b -&gt; a</code> to <code>(+) :: Num a =&gt; a -&gt; a -&gt; a</code>. And the result is weird <code>(+) const :: Num (a -&gt; b -&gt; a) =&gt; (a -&gt; b -&gt; a ) -&gt; a -&gt; b -&gt; a</code>. </p>\n\n<p>Also how is this <code>foldr :: ( a -&gt; b -&gt; b) ...</code> taking <code>(\\b g x -&gt; g (f x b))</code> as it's first parameter.</p>\n\n<pre><code>foldl :: (a -&gt; b -&gt; a) -&gt; a -&gt; [b] -&gt; a\nfoldl f a bs =\n   foldr (\\b g x -&gt; g (f x b)) id bs a\n</code></pre>\n\n<p>What's going on here? I don't even know how to call it, so that I can't do google search or use appropriate title on my question here.</p>\n\n<p>Where can I learn about this? What is this called? What's the application and theory of it?</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 3, "last_activity_date": 1455472539, "creation_date": 1455472539, "answer_id": 35395107, "question_id": 35394222, "link": "https://stackoverflow.com/questions/35394222/composable-lensing/35395107#35395107", "title": "Composable Lensing", "body": "<p>It sure is. The type signature you specified for <code>getRepoStat</code> is its type signature as a <a href=\"http://hackage.haskell.org/package/lens-4.13.2/docs/Control-Lens-Setter.html\" rel=\"nofollow\">setter</a>. If you want to be able to use it as a <a href=\"http://hackage.haskell.org/package/lens-4.13.2/docs/Control-Lens-Lens.html\" rel=\"nofollow\">lens</a> in its full generality then the type signature should be</p>\n\n<pre><code>getRepoStat :: Functor f =&gt; String -&gt; String -&gt; (RepoStat -&gt; f RepoStat) -&gt; RepoStats -&gt; f RepoStats\n-- same definition\n</code></pre>\n\n<p>This is probably the inferred type of <code>getRepoStat</code>, too.</p>\n"}, {"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 1, "last_activity_date": 1455473027, "last_edit_date": 1455473027, "creation_date": 1455472658, "answer_id": 35395136, "question_id": 35394222, "link": "https://stackoverflow.com/questions/35394222/composable-lensing/35395136#35395136", "title": "Composable Lensing", "body": "<p>It's useful to just remove the type signature:</p>\n\n<pre><code>getRepoStat k1 k2 = at k1 . non M.empty . at k2 . non (makeStat k2 0 0)\n</code></pre>\n\n<p>Now we can look at the inferred type with <code>:t getRepoStat</code> in ghci. </p>\n\n<p>It's a bit messy, chiefly because <a href=\"https://hackage.haskell.org/package/lens-4.13.2/docs/Control-Lens-At.html\" rel=\"nofollow\"><code>at</code></a> is overloaded:</p>\n\n<pre><code>getRepoStat\n  :: (Functor f, At m, IxValue m ~ M.Map String RepoStat) =&gt;\n     Index m -&gt; String -&gt; (RepoStat -&gt; f RepoStat) -&gt; m -&gt; f m\n</code></pre>\n\n<p>We can recognize though that we return a <a href=\"https://hackage.haskell.org/package/lens-4.13.2/docs/Control-Lens-Type.html#t:Lens-39-\" rel=\"nofollow\"><code>Lens'</code></a> and we can also restrict the context of the lens to <code>RepoStats</code>:</p>\n\n<pre><code>getRepoStat :: String -&gt; String -&gt; Lens' RepoStats RepoStat\ngetRepoStat k1 k2 = at k1 . non M.empty . at k2 . non (makeStat k2 0 0)\n</code></pre>\n"}], "owner": {"reputation": 1516, "user_id": 496112, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/772ab2a207cb180ed699d22959b72dd9?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/496112/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 35395136, "answer_count": 2, "score": 0, "last_activity_date": 1455473027, "creation_date": 1455467915, "question_id": 35394222, "link": "https://stackoverflow.com/questions/35394222/composable-lensing", "title": "Composable Lensing", "body": "<p>I have the following Haskell types</p>\n\n<pre><code>import Control.Lens\nimport Data.Map.Lens\nimport qualified Data.Map as M\n\ntype RepoStats = M.Map String (M.Map String RepoStat)\ndata RepoStat = RepoStat {\n  _full_name :: String,\n  _bug_count :: Maybe Int,\n  _commit_count :: Maybe Int\n  }\n  deriving (Generic, Show, Eq, Read)\nmakeLenses ''RepoStat\n</code></pre>\n\n<p>I would like to be able to abstract out the nested checking for the values and giving defaults:</p>\n\n<pre><code>makeStat name bug commit =\n    RepoStat\n    { _full_name = name\n    , _bug_count = Just bug\n    , _commit_count = Just commit\n    }\n\ngetRepoStat :: String -&gt; String -&gt; (RepoStat -&gt; Identity RepoStat) -&gt; RepoStats -&gt; Identity RepoStats\ngetRepoStat k1 k2 = at k1 . non (M.empty) . at k2 . non (makeStat k2 0 0)\n\nfakeMap = M.empty :: RepoStats\nsetBug = fakeMap &amp; (getRepoStat \"a\" \"b\") . bug_count ?~ 4\ngetBug = fakeMap ^. (getRepoStat \"a\" \"b\") . bug_count\n</code></pre>\n\n<p>setBug compiles and works, but getBug does not. </p>\n\n<pre><code>test/Spec.hs:65:21: Couldn't match type \u2018Identity RepoStats\u2019 \u2026\n                   with \u2018Const RepoStat RepoStats\u2019\n    Expected type: Getting RepoStat RepoStats RepoStat\n      Actual type: (RepoStat -&gt; Identity RepoStat)\n                   -&gt; RepoStats -&gt; Identity RepoStats\n    In the second argument of \u2018(^.)\u2019, namely \u2018(getRepoStat \"a\" \"b\")\u2019\n    In the expression: fakeDb ^. (getRepoStat \"a\" \"b\")\nCompilation failed.\n</code></pre>\n\n<p>Is it possible to abstract out a lens in this way? </p>\n"}, {"tags": ["haskell", "lambda", "church-encoding"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1455464579, "post_id": 35393476, "comment_id": 58491052, "body": "Church numbers are functions that accept two arguments, and the <code>church</code> variable is just such a number. So it is being called with two arguments, one is a lambda expression and the other one is 0."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1455464743, "post_id": 35393476, "comment_id": 58491130, "body": "Ok, thank you! But the expression (\\x-&gt; (x + 1)) only has 1 argument, so when 0 is substituted, this becomes 0 + 1. But how does it work for 5 or so? I still don&#39;t quite get it. Is church a predefined thing in the Haskell language?"}, {"owner": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "edited": false, "score": 0, "creation_date": 1455464788, "post_id": 35393476, "comment_id": 58491150, "body": "Perhaps you could step through what <code>getNum zero</code> evaluates to, then <code>getNum one</code>, then <code>getNum two</code>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1455465122, "post_id": 35393476, "comment_id": 58491270, "body": "A Church number N accepts two arguments: one is a function <code>f</code>, and the other is some other thing <code>x</code>. It takes <code>f</code> and applies it to <code>x</code> N times, so <code>five f x</code> is <code>f(f(f(f(f(x)))))</code>. <code>f</code>itself accepts one argument and returns a result of the same type. So if <code>x</code> is a normal integer number, then <code>f</code> must be a function that takes and returns integers. If <code>x</code> is zero and <code>f</code> is a function that adds 1 to its argument, then <code>five (\\x-&gt; (x + 1)) 0</code> is a function that starts with 0 and adds 1 5 times, which gives us... surprise... 5."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "edited": false, "score": 0, "creation_date": 1455465218, "post_id": 35393676, "comment_id": 58491308, "body": "Oh ok, I see now. Thank you very much for your clear explanation :)"}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 4, "last_activity_date": 1455466513, "last_edit_date": 1455466513, "creation_date": 1455464931, "answer_id": 35393676, "question_id": 35393476, "link": "https://stackoverflow.com/questions/35393476/what-does-this-haskell-expression-mean/35393676#35393676", "title": "What does this haskell expression mean", "body": "<p>It's the second argument to the \"church\" function. Church numerals are a way of doing counting in Lambda Calculus. They work in a similar way to Peano numbers. In those you count like this</p>\n\n<pre><code>Z = 0\nS Z = 1\nS S Z = 2\n</code></pre>\n\n<p>Read \"Z\" as \"Zero\" and \"S\" as \"Successor\". So 1 is the successor of 0, and 2 is the successor of 1. In effect its unary counting.</p>\n\n<p>In Lambda Calculus you only have function application, so you can define 2 as a function that takes an argument \"f\" and applies it twice.</p>\n\n<p>In your example the Church numbers zero, one and two are defined. Each is a function that takes two arguments. The first argument is the function to apply, and the second is the value to apply it to. The <code>getnum</code> function uses the function <code>succ</code> (i.e. <code>\\x -&gt; x+1</code>) which is then applied N times to the base case \"0\".</p>\n\n<p>You could also define</p>\n\n<pre><code>getPeano church = church ('S':) \"Z\"\n</code></pre>\n\n<p>This will prepend the right number of \"S\"s to the Z to translate a Church number into a Peano number.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 35393676, "answer_count": 1, "score": 0, "last_activity_date": 1455466513, "creation_date": 1455463832, "question_id": 35393476, "link": "https://stackoverflow.com/questions/35393476/what-does-this-haskell-expression-mean", "title": "What does this haskell expression mean", "body": "<p>I just started learning about Haskell and I'm trying to use the lambda calculus in Haskell. I found this expression which converts a church numeral to a number but I can't seem to figure out what the 0 in this expression means. I can't find it anywhere:</p>\n\n<pre><code>zero = (\\f -&gt; \\x -&gt; x)\none = (\\f -&gt; \\x -&gt; f x)\ntwo = (\\f -&gt; \\x -&gt; f (f x))\n\ngetNum church = church (\\x-&gt; (x + 1)) 0\n</code></pre>\n\n<p>It's the very last zero that confuses me. Is it the base case or some argument to this lambda expression?</p>\n"}, {"tags": ["arrays", "algorithm", "haskell", "mutable"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1455459111, "post_id": 35392658, "comment_id": 58489262, "body": "Type signatures, please..."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1455459510, "post_id": 35392658, "comment_id": 58489387, "body": "Just interested to know if your Java solution, passes all the time slab test at the site ?"}, {"owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1455460651, "post_id": 35392658, "comment_id": 58489696, "body": "@leftaroundabout sorry. Does lack of type signature make it less readable? I thought less code = more readable, silly me."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1455460795, "post_id": 35392658, "comment_id": 58489734, "body": "Yes, but type signatures serve at least as much as self-documentation as they do as code."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464798550, "post_id": 35392658, "comment_id": 62635466, "body": "It&#39;s really hard to read code without type signatures."}], "answers": [{"comments": [{"owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "edited": false, "score": 1, "creation_date": 1455465889, "post_id": 35393612, "comment_id": 58491526, "body": "Wow, it&#39;s almost instant as compared to the other java solution. However that <code>foldr go (const []) (zip [n,n - 1..] xs) (empty, k)</code> part is tripping me up a little bit. How should I try and understand that part? Can you add more parentheses @behzad.nouri ?"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "edited": false, "score": 2, "creation_date": 1455466166, "post_id": 35393612, "comment_id": 58491627, "body": "@DulguunOtgon <a href=\"https://wiki.haskell.org/Foldl_as_foldr\" rel=\"nofollow noreferrer\">this page</a> or <a href=\"https://wiki.haskell.org/Foldl_as_foldr_alternative\" rel=\"nofollow noreferrer\">this one</a> should help. you can push <code>foldr</code> <i>lean so far right</i> that it comes back left again :). that page explains how this is done (by currying the folding function)."}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "edited": false, "score": 1, "creation_date": 1455547440, "post_id": 35393612, "comment_id": 58525196, "body": "@DulguunOtgon edited answer with an alternative solution using mutable STUArrays"}, {"owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "edited": false, "score": 0, "creation_date": 1455655293, "post_id": 35393612, "comment_id": 58583002, "body": "in what areas do I have to get skilled in order to write and understand something like that first version?"}, {"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "reply_to_user": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "edited": false, "score": 0, "creation_date": 1455665408, "post_id": 35393612, "comment_id": 58588188, "body": "@DulguunOtgon i came across that <code>foldr</code> trick here on stackoverflow. if you have enough exposure to books, blogs and Q&amp;A website you pick up such techniques over time."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1464799150, "post_id": 35393612, "comment_id": 62635858, "body": "BTW, <code>IntMap</code> tends to be much faster than <code>Map Int</code>."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 7, "last_activity_date": 1464833954, "last_edit_date": 1464833954, "creation_date": 1455464500, "answer_id": 35393612, "question_id": 35392658, "link": "https://stackoverflow.com/questions/35392658/optimizing-mutable-array-state-heavy-manipulation-code/35393612#35393612", "title": "Optimizing mutable array state heavy manipulation code", "body": "<p>One optimization you can do to mutable arrays is not to use them at all. In particular, the problem you have linked to has a <em>right fold solution</em>. </p>\n\n<p>The idea being that you fold the list and greedily swap the items with the largest value to the right and maintain swaps already made in a <a href=\"https://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Map-Strict.html\" rel=\"nofollow\"><code>Data.Map</code></a>:</p>\n\n<pre><code>import qualified Data.Map as M\nimport Data.Map (empty, insert)\n\nsolve :: Int -&gt; Int -&gt; [Int] -&gt; [Int]\nsolve n k xs = foldr go (\\_ _ _ -&gt; []) xs n empty k\n    where\n    go x run i m k\n        -- out of budget to do a swap or no swap necessary\n        | k == 0 || y == i = y : run (pred i) m k\n        -- make a swap and record the swap made in the map\n        | otherwise        = i : run (pred i) (insert i y m) (k - 1)\n        where\n        -- find the value current position is swapped with\n        y = find x\n        find k = case M.lookup k m of\n            Just a  -&gt; find a\n            Nothing -&gt; k\n</code></pre>\n\n<p>In above, <code>run</code> is a function which given the <em>reverse index</em> <code>i</code>, current mapping <code>m</code> and the remaining swap budget <code>k</code>, solves the rest of the list onwards. By <em>reverse index</em> I mean indices of the list in the reverse direction: <code>n, n - 1, ..., 1</code>.</p>\n\n<p>The folding function <code>go</code>, builds the <code>run</code> function at each step by updating values of <code>i</code>, <code>m</code> and <code>k</code> which are passed to the next step. At the end we call this function with initial parameters <code>i = n</code>, <code>m = empty</code> and initial swap budget <code>k</code>.</p>\n\n<p>The recursive search in <code>find</code> can be optimized out by maintaining a reverse map, but this already performs much faster than the java code you have posted.</p>\n\n<hr>\n\n<p><em>Edit</em>: Above solution, still pays a logarithmic cost for tree access. Here is an alternative solution using mutable <a href=\"http://hackage.haskell.org/package/array-0.5.1.0/docs/Data-Array-ST.html#t:STUArray\" rel=\"nofollow\"><code>STUArray</code></a> and monadic fold <a href=\"http://hackage.haskell.org/package/base-4.8.2.0/docs/Control-Monad.html#v:foldM_\" rel=\"nofollow\"><code>foldM_</code></a>, which in fact performs faster than above:</p>\n\n<pre><code>import Control.Monad.ST (ST)\nimport Control.Monad (foldM_)\nimport Data.Array.Unboxed (UArray, elems, listArray, array)\nimport Data.Array.ST (STUArray, readArray, writeArray, runSTUArray, thaw)\n\n-- first 3 args are the scope, which will be curried\nswap :: STUArray s Int Int -&gt; STUArray s Int Int -&gt; Int\n     -&gt; Int -&gt; Int -&gt; ST s Int\nswap   _   _ _ 0 _ = return 0  -- out of budget to make a swap\nswap arr rev n k i = do\n    xi &lt;- readArray arr i\n    if xi + i == n + 1\n    then return k -- no swap necessary\n    else do -- make a swap, and reduce budget\n        j &lt;- readArray rev (n + 1 - i)\n        writeArray rev xi j\n        writeArray arr j  xi\n        writeArray arr i (n + 1 - i)\n        return $ pred k\n\nsolve :: Int -&gt; Int -&gt; [Int] -&gt; [Int]\nsolve n k xs = elems $ runSTUArray $ do\n    arr &lt;- thaw (listArray (1, n) xs :: UArray Int Int)\n    rev &lt;- thaw (array (1, n) (zip xs [1..]) :: UArray Int Int)\n    foldM_ (swap arr rev n) k [1..n]\n    return arr\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9372, "user_id": 4585963, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8Yzwc.jpg?s=128&g=1", "display_name": "hilberts_drinking_problem", "link": "https://stackoverflow.com/users/4585963/hilberts-drinking-problem"}, "is_accepted": false, "score": 1, "last_activity_date": 1455950018, "creation_date": 1455950018, "answer_id": 35520017, "question_id": 35392658, "link": "https://stackoverflow.com/questions/35392658/optimizing-mutable-array-state-heavy-manipulation-code/35520017#35520017", "title": "Optimizing mutable array state heavy manipulation code", "body": "<p>Not exactly an answer to #2, but there is a left fold solution that requires loading at most ~K values in memory at a time.</p>\n\n<p>Because the problem deals with permutations, we know that 1 through N will appear in the output. If K > 0, at least the first K terms are going to be N, N-1, ... N - K, because we can afford at least K swaps. In addition, we expect some (K/N) digits to be in their optimal position.</p>\n\n<p>This suggests an algorithm:</p>\n\n<p>Initialize a map / dictionary and scan input <code>xs</code> as <code>zip xs [n, n-1..]</code>. For every <code>(x, i)</code>, if <code>x \\= i</code>, we 'decrement' <code>K</code> and update out dictionary s.t. <code>dct[i] = x</code>. This procedure terminates when <code>K == 0</code> (out of swaps) or we run out of input (can output {N, N-1, ... 1}).</p>\n\n<p>Next, if we have any more <code>x &lt;- xs</code> we look at each one and print <code>x</code> if <code>x</code> is not in our dictionary or <code>dct[x]</code> otherwise.</p>\n\n<p>The above algorithm can fail to produce an optimal permutation only if our dictionary contains a cycle. In that case, we moved around elements with absolute value >= <code>K</code> using <code>|cycle|</code> swaps. But this means that we moved one element to its original position! So we can always save a swap on every cycle (i.e. increment <code>K</code>).</p>\n\n<p>Finally, this gives the memory efficient algorithm.</p>\n\n<p>Step 0: get N, K</p>\n\n<p>Step 1: Read the input permutation and output {N, N-1, ... N-K-E}, N &lt;- N - K - E, K &lt;- 0, update dict as per above, </p>\n\n<p>where E = number of elements X equal to N - (index of X)</p>\n\n<p>Step 2: remove and count cycles from dict; let <code>cycles</code> = number of cycles; if <code>cycles &gt; 0</code>, let <code>K &lt;- |cycles|</code>, go to step 1,</p>\n\n<p>else go to step 3. We can make this step more efficient by optimizing the dict.</p>\n\n<p>Step 3: Output the rest of the input as is.</p>\n\n<p>The following Python code implements the idea and can be made quite fast if better cycle detection is used. Of course, data better be read in chunks, unlike below.</p>\n\n<pre><code>from collections import deque\n\nn, t = map(int, raw_input().split())\n\nxs = deque(map(int, raw_input().split()))\n\ndct = {}\n\ncycles = True\nwhile cycles:\n    while t &gt; 0 and xs:\n        x = xs.popleft()\n        if x != n:\n            dct[n] = x\n            t -= 1\n        print n,\n        n -= 1\n\n    cycles = False\n    for k, v in dct.items():\n        visited = set()\n        cycle = False\n        while v in dct:\n            if v in visited:\n                cycle = True\n                break\n            visited.add(v)\n            v, buf = dct[v], v\n            dct[buf] = v\n        if cycle:\n            cycles = True\n            for i in visited:\n                del dct[i]\n            t += 1\n        else:\n            dct[k] = v\n\nwhile xs:\n    x = xs.popleft()\n    print dct.get(x, x),\n</code></pre>\n"}], "owner": {"reputation": 1729, "user_id": 3859522, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fe4a78465ab98520ed124337edad97c8?s=128&d=identicon&r=PG&f=1", "display_name": "Dulguun Otgon", "link": "https://stackoverflow.com/users/3859522/dulguun-otgon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 1, "accepted_answer_id": 35393612, "answer_count": 2, "score": 2, "last_activity_date": 1464833954, "creation_date": 1455458575, "question_id": 35392658, "link": "https://stackoverflow.com/questions/35392658/optimizing-mutable-array-state-heavy-manipulation-code", "title": "Optimizing mutable array state heavy manipulation code", "body": "<p>I've been trying to complete <a href=\"https://www.hackerrank.com/challenges/largest-permutation\" rel=\"nofollow noreferrer\">this</a> exercise on hackerrank in time. \nBut my following Haskell solution fails on test case 13 to 15 due to time out. \n<a href=\"https://i.stack.imgur.com/772bT.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/772bT.jpg\" alt=\"enter image description here\"></a></p>\n\n<h3>My Haskell solution</h3>\n\n<pre><code>import           Data.Vector(Vector(..),fromList,(!),(//),toList)\nimport           Data.Vector.Mutable\nimport qualified Data.Vector as V \nimport           Data.ByteString.Lazy.Char8 (ByteString(..))\nimport qualified Data.ByteString.Lazy.Char8 as L\nimport Data.ByteString.Lazy.Builder\nimport Data.Maybe\nimport Control.Applicative\nimport Data.Monoid\nimport Prelude hiding (length)\n\nreadInt' = fst . fromJust . L.readInt \ntoB []     = mempty\ntoB (x:xs) = string8 (show x) &lt;&gt; string8 \" \" &lt;&gt; toB xs\n\nmain = do \n  [firstLine, secondLine] &lt;- L.lines &lt;$&gt; L.getContents\n  let [n,k] = map readInt' $ L.words firstLine\n  let xs = largestPermutation n k $ fromList $ map readInt' $ Prelude.take n $ L.words secondLine\n  L.putStrLn $ toLazyByteString $ toB $ toList xs\n\n\nlargestPermutation n k v\n  | i &gt;= l || k == 0 = v \n  | n == x           = largestPermutation (n-1) k v\n  | otherwise        = largestPermutation (n-1) (k-1) (replaceOne n x (i+1) (V.modify (\\v' -&gt; write v' i n) v))\n        where l = V.length v \n              i = l - n\n              x = v!i\n\nreplaceOne n x i v\n  | n == h = V.modify (\\v' -&gt; write v' i x ) v\n  | otherwise = replaceOne n x (i+1) v\n    where h = v!i \n</code></pre>\n\n<p>Most optimal solution that I've found constantly updates 2 arrays. One array being the main target, and other array being for fast index look ups.</p>\n\n<h3>Better Java solution</h3>\n\n<pre><code>public static void main(String[] args) {\n  Scanner input = new Scanner(System.in);\n  int n = input.nextInt();\n  int k = input.nextInt();\n  int[] a = new int[n];\n  int[] index = new int[n + 1];\n  for (int i = 0; i &lt; n; i++) {\n      a[i] = input.nextInt();\n      index[a[i]] = i;\n  }\n  for (int i = 0; i &lt; n &amp;&amp; k &gt; 0; i++) {\n      if (a[i] == n - i) {\n          continue;\n      }\n      a[index[n - i]] = a[i];\n      index[a[i]] = index[n - i];\n      a[i] = n - i;\n      index[n - i] = i;\n      k--; \n  }\n  for (int i = 0; i &lt; n; i++) {\n      System.out.print(a[i] + \" \");\n  }\n}\n</code></pre>\n\n<h3>My question is</h3>\n\n<ol>\n<li>What's the elegant and fast implementation of this algorithm in Haskell?</li>\n<li>Is there a faster way to do this problem than the Java solution?</li>\n<li>How should I deal with heavy array update elegantly and yet efficiently in Haskell in general?</li>\n</ol>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1455451212, "post_id": 35391463, "comment_id": 58486831, "body": "I&#39;m not really sure what you are trying to accomplish here - can you try to elaborate a bit?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455453716, "post_id": 35391463, "comment_id": 58487527, "body": "You probably want something like <code>type family IsPair (x :: *) :: Constraint where IsPair (a,b) = ()</code>. You can go one further and extract the arguments immediately - <code>type family PairArgs (x :: *) :: Maybe (*,*) where PairArgs (a,b) = &#39;Just &#39;(a,b); PairArgs x = &#39;Nothing</code>. In cases where you just want to know its a pair (like in your type family), you can write <code>IsJust (PairArgs t)</code>. When you want to get the args, you can write <code>PairArgs t ~ &#39;Just &#39;(a,b)</code>. Kind of boring with pairs but generalizes quite nicely."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455454044, "post_id": 35391748, "comment_id": 58487622, "body": "The <code>ExistentialPair</code> type is not very useful.. you can&#39;t do anything with the values inside - you might as well store a <code>((), ())</code>. <code>data IsPair (x :: *) where IsPair :: (a,b) -&gt; IsPair (a,b)</code> is probably actually useful"}, {"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455457272, "post_id": 35391748, "comment_id": 58488686, "body": "Sure it&#39;s not useful as is. But there wasn&#39;t more context, and I assumed that the need for adding more type context would be clear anyway, if one wants to use existentials in practise."}], "tags": [], "owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "is_accepted": false, "score": 0, "last_activity_date": 1455457029, "last_edit_date": 1455457029, "creation_date": 1455452960, "answer_id": 35391748, "question_id": 35391463, "link": "https://stackoverflow.com/questions/35391463/using-generic-constraint-kinds/35391748#35391748", "title": "Using generic constraint kinds", "body": "<p>I think the equality constraint here doesn't really make sense in that form. <code>~</code> should have a sort like <code>k -&gt; k -&gt; Constraint</code>, so <code>t</code> in that context would need to have kind <code>Constraint</code> on the left side, while on the right side you need to end with <code>*</code>... </p>\n\n<p>However, if I have understood the problem correctly, you need to have existential type for <code>a</code> and <code>b</code>; so maybe this is what you want:</p>\n\n<pre><code>data PairConstraintParam\n\ndata ExistentialPair :: * where\n  Exists :: (a, b) -&gt; ExistentialPair\n\ntype family MyConstraint (p :: *) (t :: *) :: Constraint where\n  MyConstraint PairConstraintParam t = t ~ ExistentialPair\n\ntest :: (MyConstraint PairConstraintParam t) =&gt; t\ntest = Exists (1, \"hi\")\n</code></pre>\n\n<p>Meaning that \"there exist <code>a, b</code>, such that <code>t ~ (a, b)</code>\" (up to isomorphism). Of course, you would want to add some more constraints to actually do something useful.</p>\n\n<p>Another variant I can think of is the following:</p>\n\n<pre><code>data ConstraintVariant = PairConstraint\n\nclass IsPair p where\ninstance IsPair (a, b)\n\ntype family ConstrainedBy (c :: ConstraintVariant) :: * -&gt; Constraint where\n  ConstrainedBy PairConstraint = IsPair\n\ndata Thing c t where\n  Thing :: (c t) =&gt; t -&gt; Thing c t\n\ntest2 :: Thing (ConstrainedBy PairConstraint) (Int, String)\ntest2 = Thing (1, \"hi\")\n</code></pre>\n\n<p>Which lets you recover both the constraint and the underlying type.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 110, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1455457029, "creation_date": 1455451064, "question_id": 35391463, "link": "https://stackoverflow.com/questions/35391463/using-generic-constraint-kinds", "title": "Using generic constraint kinds", "body": "<p>I can quite validly write a type like this in Haskell:</p>\n\n<pre><code>(t ~ (a, b)) =&gt; t\n</code></pre>\n\n<p>Which in a roundabout way says that <code>t</code> is some pair.</p>\n\n<p>But lets say I want to do this:</p>\n\n<pre><code>type family MyConstraint t :: Constraint\n\ndata PairConstraintParam\n\ntype instance MyConstraint PairConstraintParam = ...\n\n(t ~ MyConstraint PairConstraintParam) =&gt; t\n</code></pre>\n\n<p>What can I place after the <code>type instance MyConstraint PairConstraintParam =</code></p>\n\n<p>I tried <code>(a,b)</code> but GHC complained <code>a</code> and <code>b</code> were not on the RHS. It didn't seem to like <code>forall</code>s either.</p>\n\n<p>This may seem like a silly example, there's potentially different constraints for different instances of a class, so hence this roundabout scheme. As the constraints affect and depend on parameters to a method in a class, I can't just place them in the instance head. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455429497, "post_id": 35388734, "comment_id": 58481769, "body": "Why do you include <code>132</code> but not <code>123</code> or <code>321</code>? I would take &quot;partition&quot; to mean that the output should not be re-arranged, i.e. <code>concat (concat (seperate x)) == x</code>, so <code>123</code> should be included but not <code>132</code> or <code>321</code>."}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 5924314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b8b2e82edbf036a083f245a1bd8bbe?s=128&d=identicon&r=PG&f=1", "display_name": "K. Anderson", "link": "https://stackoverflow.com/users/5924314/k-anderson"}, "edited": false, "score": 0, "creation_date": 1455433212, "post_id": 35389063, "comment_id": 58482405, "body": "Thanks for the detailed reply, as a beginner it really helps. I do have two questions though. After noSplit where does the &quot;ys&quot; come from? Also, from the Wikipedia page I was using to reference the definition of a partitioned list it also has [[&quot;13&quot;,&quot;2&quot;]] listed as a possible outcome of &quot;123&quot;. With this in mind how much more implementation would be needed to satisfy this condition?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 71, "user_id": 5924314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b8b2e82edbf036a083f245a1bd8bbe?s=128&d=identicon&r=PG&f=1", "display_name": "K. Anderson", "link": "https://stackoverflow.com/users/5924314/k-anderson"}, "edited": false, "score": 0, "creation_date": 1455435186, "post_id": 35389063, "comment_id": 58482782, "body": "What wikipedia page is this? It&#39;s hard to envision a problem statement that includes [13,2] but not, say, [3,12], so I can&#39;t say how you would make your desired change in a meaningful way. As for <code>ys</code>: each item in <code>recur</code> is a list of lists, so when we bind <code>(y:ys)</code> to a single item, we are letting <code>y</code> be the first list, and <code>ys</code> be all the rest of the lists."}, {"owner": {"reputation": 71, "user_id": 5924314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b8b2e82edbf036a083f245a1bd8bbe?s=128&d=identicon&r=PG&f=1", "display_name": "K. Anderson", "link": "https://stackoverflow.com/users/5924314/k-anderson"}, "edited": false, "score": 0, "creation_date": 1455435568, "post_id": 35389063, "comment_id": 58482859, "body": "Ah, that makes sense, thanks. As for the wiki page: <a href=\"https://en.wikipedia.org/wiki/Partition_of_a_set\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Partition_of_a_set</a> is what I was referencing. Specifically the &quot;Examples&quot; section."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 71, "user_id": 5924314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b8b2e82edbf036a083f245a1bd8bbe?s=128&d=identicon&r=PG&f=1", "display_name": "K. Anderson", "link": "https://stackoverflow.com/users/5924314/k-anderson"}, "edited": false, "score": 2, "creation_date": 1455438844, "post_id": 35389063, "comment_id": 58483562, "body": "So you&#39;re basically trying to work with sets, not lists. This explains the confusion everyone has had with your examples, since you specifically talk about lists, but are looking for a set-based algorithm. You can apply the same principles to come up with a similar function that works on sets, but it&#39;s not just a simple change to my answer: you&#39;d have to rewrite it. Perhaps you should ask another question, that&#39;s more clear about what you want from an answer."}, {"owner": {"reputation": 33882, "user_id": 13855, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/b77449b8f50156a990b943706370410e?s=128&d=identicon&r=PG", "display_name": "eulerfx", "link": "https://stackoverflow.com/users/13855/eulerfx"}, "edited": false, "score": 1, "creation_date": 1508980038, "post_id": 35389063, "comment_id": 80835945, "body": "What about <code>[&quot;13&quot;,&quot;2&quot;]</code>?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 33882, "user_id": 13855, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/b77449b8f50156a990b943706370410e?s=128&d=identicon&r=PG", "display_name": "eulerfx", "link": "https://stackoverflow.com/users/13855/eulerfx"}, "edited": false, "score": 1, "creation_date": 1509138734, "post_id": 35389063, "comment_id": 80914363, "body": "@eulerfx What about it? What are you asking that&#39;s different than the other comments on this answer that mention that same value?"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 3, "last_activity_date": 1455431393, "creation_date": 1455431393, "answer_id": 35389063, "question_id": 35388734, "link": "https://stackoverflow.com/questions/35388734/list-partitioning-implemented-recursively/35389063#35389063", "title": "List partitioning implemented recursively", "body": "<p>You can think of this function as choosing, for each place in between two list elements, whether to include a split there. So for starters, there should be 2<sup>n-1</sup> partitions for an n-element list: you can use that as a quick sanity check on a possible solution.</p>\n\n<p>One good way to model non-determinism is with the list monad (or equivalently with list comprehensions), so let's do it that way.</p>\n\n<p>First, let's write the type and a base case:</p>\n\n<pre><code>separate :: [a] -&gt; [[[a]]]\nseparate [] = [[]]\n</code></pre>\n\n<p>There is a single way to separate an empty list: the empty list itself, with no possibility of splits. Easy enough.</p>\n\n<p>Now, given we have one element and a list of remaining elements, one thing we'll need for sure is a list of all the ways to split the remaining elements:</p>\n\n<pre><code>separate :: [a] -&gt; [[[a]]]\nseparate [] = [[]]\nseparate (x:xs) = let recur = separate xs\n                  in undefined -- TODO\n</code></pre>\n\n<p>Here's where the interesting stuff starts. As I said, you can view this as choosing, for each item, whether to put a split after it. Two choices means concatenating together two lists, so let's do that:</p>\n\n<pre><code>separate :: [a] -&gt; [[[a]]]\nseparate [] = [[]]\nseparate (x:xs) = let recur = separate xs\n                      split = undefined -- TODO\n                      noSplit = undefined -- TODO\n                  in split ++ noSplit\n</code></pre>\n\n<p>Now, how do we introduce a split after the item <code>x</code>? We do it by, for each partition in <code>recur</code>, adding <code>[x]</code> to the front of it as a new partition:</p>\n\n<pre><code>separate :: [a] -&gt; [[[a]]]\nseparate [] = [[]]\nseparate (x:xs) = let recur = separate xs\n                      split = do\n                        partition &lt;- recur\n                        return $ [x] : partition\n                      noSplit = undefined -- TODO\n                  in split ++ noSplit\n</code></pre>\n\n<p>What about not splitting? Pretty similar! For each partition in <code>recur</code>, we add <code>x</code> to the front of the first sub-partition:</p>\n\n<pre><code>separate :: [a] -&gt; [[[a]]]\nseparate [] = [[]]\nseparate (x:xs) = let recur = separate xs\n                      split = do\n                        partition &lt;- recur\n                        return $ [x] : partition\n                      noSplit = do\n                        (y:ys) &lt;- recur\n                        return $ (x:y):ys\n                  in split ++ noSplit\n</code></pre>\n\n<p>And with that, we're done:</p>\n\n<pre><code>*Temp&gt; separate \"123\"\n[[\"1\",\"2\",\"3\"],[\"1\",\"23\"],[\"12\",\"3\"],[\"123\"]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": false, "score": 0, "last_activity_date": 1455485312, "last_edit_date": 1455485312, "creation_date": 1455459558, "answer_id": 35392818, "question_id": 35388734, "link": "https://stackoverflow.com/questions/35388734/list-partitioning-implemented-recursively/35392818#35392818", "title": "List partitioning implemented recursively", "body": "<p>A right fold solution would be:</p>\n\n<pre><code>import Control.Applicative ((&lt;$&gt;))\n\nseparate :: Foldable t =&gt; t a -&gt; [[[a]]]\nseparate = foldr (\\i -&gt; concatMap (inc i)) [[]]\n    where\n    inc i []     = [[[i]]]\n    inc i (x:xs) = ((i:x):xs):((x:) &lt;$&gt; inc i xs)\n</code></pre>\n\n<p>then:</p>\n\n<pre><code>\\&gt; separate [1, 2]\n[[[1,2]],[[2],[1]]]\n\n\\&gt; separate [1, 2, 3]\n[[[1,2,3]],[[2,3],[1]],[[1,3],[2]],[[3],[1,2]],[[3],[2],[1]]]\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 5924314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b8b2e82edbf036a083f245a1bd8bbe?s=128&d=identicon&r=PG&f=1", "display_name": "K. Anderson", "link": "https://stackoverflow.com/users/5924314/k-anderson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 771, "favorite_count": 2, "answer_count": 2, "score": 1, "last_activity_date": 1455675112, "creation_date": 1455428320, "last_edit_date": 1455675112, "question_id": 35388734, "link": "https://stackoverflow.com/questions/35388734/list-partitioning-implemented-recursively", "title": "List partitioning implemented recursively", "body": "<p>I am a Haskell beginner and I have been experimenting with recursive functions. </p>\n\n<p>I am working on a function: </p>\n\n<pre><code> separate :: [a] -&gt; [[[a]]]\n</code></pre>\n\n<p>that takes in a list and outputs all of the partitions of that list.</p>\n\n<p>For example 123 becomes:</p>\n\n<pre><code>1|2|3\n12|3\n1|23\n13|2\n132\n</code></pre>\n\n<p>I have only been able to implement a recursive function that creates the <code>1|2|3</code> variant:</p>\n\n<pre><code>separate' :: [a] -&gt; [[a]]\nseparate' (r:rs) = [r]:separate' xs\n\n&gt;separate [1,2,3]\n[[1],[2],[3]]\n</code></pre>\n\n<p>I am stuck with trying to create the other variants with recursion.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 5, "creation_date": 1455427388, "post_id": 35388605, "comment_id": 58481433, "body": "This example illustrates the Maybe instance of Applicative, not the <code>(-&gt;) a</code> instance."}], "answers": [{"comments": [{"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1455428103, "post_id": 35388671, "comment_id": 58481544, "body": "Fantastic! That is the piece that I was missing, that Applicative Maybe was actually the one being applied. For future reference, how could I have known that it is the right-hand side that determines the class instance? Is this documented somewhere?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 5, "creation_date": 1455428870, "post_id": 35388671, "comment_id": 58481683, "body": "Both sides determine it: they must be the same. I was describing the process the type inferencer (GHCI&#39;s, and the one in your head) goes through to discover which instance is being used. The type of <code>&lt;*&gt;</code> is <code>Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b</code>, and all three <code>f</code>s are necessarily the same. Since the right-hand side is clearly &quot;locked&quot; at <code>f ~ Maybe</code>, you can infer that the left-hand side (and return type) must also have <code>f ~ Maybe</code>, and that&#39;s how you discover which <code>pure</code> and <code>&lt;*&gt;</code> are in play."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 3, "creation_date": 1455443425, "post_id": 35388671, "comment_id": 58484790, "body": "@kurzweil4 Don&#39;t forget that if <code>x::a</code> then <code>pure x</code> will be of type <code>f a</code> for any applicative <code>f</code>. In your case, <code>a</code> already involves an applicative (<code>(-&gt;) b</code>), but that is irrelevant. By comparison, <code>(+) &lt;*&gt; ...</code> forces <code>&lt;*&gt;</code> to work on the <code>(-&gt;) b</code> applicative, since that&#39;s what&#39;s on the left; however, <code>pure (+) &lt;*&gt; ...</code> does not force any particular one, and will adapt to whichever applicative is on the right side."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 6, "last_activity_date": 1455427592, "creation_date": 1455427592, "answer_id": 35388671, "question_id": 35388605, "link": "https://stackoverflow.com/questions/35388605/confusion-over-applicative/35388671#35388671", "title": "Confusion Over Applicative (-&gt;)", "body": "<p>Since the right-hand-side argument to <code>&lt;*&gt;</code> is <code>Just 3</code>, then the Applicative instance being used must be that of Maybe, not of functions. So, the left-hand side must be a Maybe as well, thus <code>pure (+) == Just (+)</code>. Now you can see how <code>&lt;*&gt;</code> combines these: it unwraps the two <code>Just</code> constructors, applies the function, and puts the result back into a <code>Just</code>: this is the same as <code>Just ((+) 3)</code>, or <code>Just (3 +)</code>. And as you can see in ghci, those two things have the same type.</p>\n"}], "owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 35388671, "answer_count": 1, "score": 1, "last_activity_date": 1455427592, "creation_date": 1455426870, "question_id": 35388605, "link": "https://stackoverflow.com/questions/35388605/confusion-over-applicative", "title": "Confusion Over Applicative (-&gt;)", "body": "<p>Given that <code>Applicative (-&gt;)</code> is implemented as:</p>\n\n<pre><code>instance Applicative ((-&gt;) a) where\n    pure = const\n    (&lt;*&gt;) f g x = f x (g x)\n</code></pre>\n\n<p>I am confused how the following works:</p>\n\n<pre><code>pure (+) &lt;*&gt; Just 3\n</code></pre>\n\n<p>My understanding is that:</p>\n\n<pre><code>f = pure (+)\ng = Just 3\n</code></pre>\n\n<p>Based on that understanding, <code>&lt;*&gt;</code> would become:</p>\n\n<pre><code>-- f x (g x)\n(pure (+)) x ((Just 3) x)\n</code></pre>\n\n<p>But this does not work since <code>(Just 3)</code> takes no parameters. So I apparently must be unaware of something, though I am not sure what that is.</p>\n\n<p>I am baffled as to how this happens:</p>\n\n<pre><code>Prelude&gt; :t pure (+) &lt;*&gt; Just 3\npure (+) &lt;*&gt; Just 3 :: Num a =&gt; Maybe (a -&gt; a)\n</code></pre>\n\n<p>Please explain how this works. Doing the steps manually, based on my understanding of things, I am not able to reach the same outcome as <code>ghci</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1455419899, "post_id": 35387916, "comment_id": 58480282, "body": "This code will never reach the <code>return</code> line. Each time you call <code>combat</code>, it will call itself with arguments reversed, but never complete because it will call itself again before having a chance to get past that line."}, {"owner": {"user_type": "does_not_exist", "display_name": "user5924029"}, "reply_to_user": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1455423912, "post_id": 35387916, "comment_id": 58480906, "body": "@PeterHall Alright, that makes sense. But, I get a type error when I put <code>combat damaged a</code> exclusively in the else statement (it wants a regular String, but it&#39;s getting an IO String), which is the problem I was trying to solve when I put the recursion above the if statement."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 2, "last_activity_date": 1455426577, "creation_date": 1455426577, "answer_id": 35388576, "question_id": 35387916, "link": "https://stackoverflow.com/questions/35387916/haskell-infinite-loop-in-do-block/35388576#35388576", "title": "Haskell infinite loop in do block", "body": "<p>Please try to post minimum compile-able examples in the future.</p>\n\n<p>As stated in the comments, calling <code>combat</code> unconditionally from within the body of <code>combat</code> is a non-starter.  Instead, sink it down into the proper arm of the if-then-else.</p>\n\n<p>You also mentioned you had a type error when placing <code>combat</code> in one of the cases.  I'm guessing you were using <code>return $ if ...</code> which means either branch will be wrapped in another layer of <code>IO ...</code> but your <code>combat</code> is already of of type <code>IO _</code>.</p>\n\n<pre><code>combat :: Player -&gt; Player -&gt; IO String\ncombat a b = do\n    damaged &lt;- a `attacks` b\n    if (victor a damaged) /= \"No victor yet\"\n         then return (victor a damaged)\n         else combat damaged a\n</code></pre>\n\n<p>Now there are two other warts.  One is the repeated statement calling <code>victor</code>.  The other is using string comparison to determine program flow, ugh!  Instead how about you make <code>victor</code> return a ADT?</p>\n\n<pre><code>data Status = Dead String | Alive\n\ncombat :: Player -&gt; Player -&gt; IO String\ncombat a b = do\n    damaged &lt;- a `attacks` b\n    case victor a damaged of\n        Alive  -&gt; combat damaged a\n        Dead s -&gt; return s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 3, "last_activity_date": 1455426610, "creation_date": 1455426610, "answer_id": 35388578, "question_id": 35387916, "link": "https://stackoverflow.com/questions/35387916/haskell-infinite-loop-in-do-block/35388578#35388578", "title": "Haskell infinite loop in do block", "body": "<p>As mentioned in the comments, you need to do the termination check before you do the recursive step, or you will never be able to terminate. Here's a small reordering:</p>\n\n<pre><code>combat :: Player -&gt; Player -&gt; IO String\ncombat a b = do\n    damaged &lt;- a `attacks` b\n    case victor a damaged of\n      \"No victor yet\" -&gt; combat damaged a\n      winner -&gt; return winner\n</code></pre>\n\n<p>Note that this would be much nicer if <code>victor</code> returned <code>Maybe String</code> instead, so that you wouldn't depend on this magical string <code>\"No victor yet\"</code>. Then you could write:</p>\n\n<pre><code>combat :: Player -&gt; Player -&gt; IO String\ncombat a b = do\n    damaged &lt;- a `attacks` b\n    case victor a damaged of\n      Nothing -&gt; combat damaged a\n      Just winner -&gt; return winner\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5924029"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 477, "favorite_count": 0, "accepted_answer_id": 35388578, "answer_count": 2, "score": 2, "last_activity_date": 1455426610, "creation_date": 1455419118, "question_id": 35387916, "link": "https://stackoverflow.com/questions/35387916/haskell-infinite-loop-in-do-block", "title": "Haskell infinite loop in do block", "body": "<p>I'm writing a program in Haskell to simulate combat between two players in D&amp;D. The method I'm using is to store players as Maps, and then have 'attack' functions that take a Player, and return an IO Player with updated health, based on whether or not the attack connected. All of my code seems to be working as intended, up until the last function, <code>combat</code>. <code>combat</code> is supposed to take two players, have the first one attack the second, check if the second is dead, and if not, recur with the order of the players reversed. Instead, it appears to be looping infinitely.</p>\n\n<p>The function itself is as follows -</p>\n\n<pre><code>combat :: Player -&gt; Player -&gt; IO String\ncombat a b = do\n    damaged &lt;- a `attacks` b\n    nextRound &lt;- combat damaged a\n    return $ if (victor a damaged) /= \"No victor yet\" then (victor a damaged) else nextRound\n</code></pre>\n\n<p>The <code>attacks</code> function takes two players, checks the ID of the first one, and applies the appropriate sequence of attacks to the second one. It works just fine when I use it on its own in GHCi, so I don't think there's a problem there.</p>\n\n<p>The <code>victor</code> function takes two players, checks if either of them is dead (defined as HP &lt;= 0), and returns a string describing the result. When I wrote a toy version of <code>combat</code> without any recursion that just returned \"test\" when the condition wasn't met, it was returning a combination of \"Player 1 wins!\" and \"test\", so I don't think there's a problem there.</p>\n\n<p>I did come across a similar looking question with let bindings, where somebody was running into an infinite loop when they had code like <code>let n = n + 1</code>, but I'm not sure if <code>&lt;-</code> works in the same way (or, if it did, how else I could write it).</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "functor"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 4, "creation_date": 1455412288, "post_id": 35387237, "comment_id": 58478899, "body": "this is easier seen with the flipped version of <code>(&gt;&gt;=)</code>, <a href=\"https://stackoverflow.com/questions/34545818/is-monad-bind-operator-closer-to-function-composition-chaining-or-functi/34561605#34561605\"><code>(=&lt;&lt;)</code></a>. With <code>(g &lt;$&gt;) :: f a -&gt; f b</code>, the function <code>g :: a -&gt; b</code> has no influence on the <code>f</code> &quot;wrapping&quot; -- doesn&#39;t change it. With <code>(k =&lt;&lt;) :: m a -&gt; m b</code>, the function <code>k :: a -&gt; m b</code> itself <i>creates</i> the new <code>m</code> &quot;wrapping&quot;, so it can change."}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1455412601, "post_id": 35387237, "comment_id": 58478967, "body": "@WillNess I can &quot;understand&quot; this, but I can&#39;t see it. I think the real problem I have is that I can&#39;t see what <code>&gt;&gt;=</code> can do that <code>fmap</code> can&#39;t do. In my head they&#39;re equivalent because I haven&#39;t seen an example, which shows that fmap is inadequate."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 4, "creation_date": 1455412670, "post_id": 35387237, "comment_id": 58478980, "body": "going with lists, try to filter out some elements from a list, using <code>map</code>. you can&#39;t. but with <code>concatMap</code>, you can: <code>map (\\x-&gt;x+1) [1,2,3]</code> vs <code>concatMap (\\x-&gt; [x,x+1|even x]) [1,2,3])</code>."}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1455412812, "post_id": 35387237, "comment_id": 58479012, "body": "@WillNess okay I see! I always thought a <code>filter</code> operation was just a sugary variant of <code>map</code>, but just now I&#39;ve realized that&#39;s not even possible."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1495481195, "post_id": 35387237, "comment_id": 75260621, "body": "we can code <i>almost</i>-filter with <code>map (\\x -&gt; [x|even x]) [1,2,3]</code> but  it produces <code>[[],[2],[]]</code> and another level of interpretation done by <code>concat</code> is then needed to make it really a <code>filter</code>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1455432774, "post_id": 35388235, "comment_id": 58482309, "body": "One example of a classic/common functor that&#39;s not a monad is <code>newtype Const a b = Const a</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1455433125, "post_id": 35388235, "comment_id": 58482387, "body": "<code>pure x &gt;&gt;= f</code> is required by a monad law to be <code>f x</code>, but <code>pure :: b -&gt; Const a b</code> cannot possibly use its argument."}, {"owner": {"reputation": 221, "user_id": 4005988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84134c950b0b002689b67c899f051deb?s=128&d=identicon&r=PG", "display_name": "HEGX64", "link": "https://stackoverflow.com/users/4005988/hegx64"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1455436918, "post_id": 35388235, "comment_id": 58483142, "body": "@dfeuer This seams <a href=\"https://ncatlab.org/nlab/show/too+simple+to+be+simple\" rel=\"nofollow noreferrer\">too simple to be simple</a>. Also I can&#39;t find a way to write a Functor instance other than <code>fmap f (Const x) = Const x</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1455454876, "post_id": 35388235, "comment_id": 58487913, "body": "@HEGX64: right. but for <code>Functor</code> this is no problem \u2013 in fact, it immediately guarantees the functor law <code>fmap id \u2261 id</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1455521832, "post_id": 35388235, "comment_id": 58508995, "body": "A less simple example: in FRP frameworks, events and signals tend to be functors, but not monads. This turns out to be important for efficient implementation."}], "tags": [], "owner": {"reputation": 221, "user_id": 4005988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84134c950b0b002689b67c899f051deb?s=128&d=identicon&r=PG", "display_name": "HEGX64", "link": "https://stackoverflow.com/users/4005988/hegx64"}, "is_accepted": false, "score": 7, "last_activity_date": 1516529702, "last_edit_date": 1516529702, "creation_date": 1455422784, "answer_id": 35388235, "question_id": 35387237, "link": "https://stackoverflow.com/questions/35387237/difference-in-capability-between-fmap-and-bind/35388235#35388235", "title": "Difference in capability between fmap and bind?", "body": "<p>Short answer is that if you can turn <code>m (m a)</code> into <code>m a</code> in a way which makes sense then it's a Monad. This is possible for all Monads but not necessarily for Functors.</p>\n\n<p>I think the most confusing thing is that all of the common examples of Functors (e.g. <code>List</code>, <code>Maybe</code>, <code>IO</code>) are also Monads. We need an example of something that is a Functor but not a Monad.</p>\n\n<p>I'll use an example from a hypothetical calendar program. The following code defines an <code>Event</code>  Functor which stores some data that goes with the event and the time that it occurs.</p>\n\n<pre><code>import Data.Time.LocalTime\n\ndata Event a = MkEvent LocalTime a\n\ninstance Functor Event where\n    fmap f (MkEvent time a) = MkEvent time (f a)\n</code></pre>\n\n<p>The <code>Event</code> object stores the time that the event occurs and some extra data that can be changed using <code>fmap</code>. Now lets try and make it a Monad:</p>\n\n<pre><code>instance Monad Event where\n    (&gt;&gt;=) (MkEvent timeA a) f = let (MkEvent timeB b) = f a in\n                                MkEvent &lt;notSureWhatToPutHere&gt; b\n</code></pre>\n\n<p>We find that we can't because you will end up with two <code>LocalTime</code> objects. <code>timeA</code> from the given <code>Event</code> and <code>timeB</code> from the <code>Event</code> given by the result of <code>f a</code>. Our <code>Event</code> type is defined as having only one <code>LocalTime</code> (<code>time</code>) that it occurs at and so making it a Monad isn't possible without turning two <code>LocalTime</code>s into one. (There may be some case where doing so might make sense and so you could turn this into a monad if you really wanted to).</p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1455448596, "last_edit_date": 1455448596, "creation_date": 1455446396, "answer_id": 35390809, "question_id": 35387237, "link": "https://stackoverflow.com/questions/35387237/difference-in-capability-between-fmap-and-bind/35390809#35390809", "title": "Difference in capability between fmap and bind?", "body": "<p>Assume for a moment that <code>IO</code> were just a <code>Functor</code>, and not a <code>Monad</code>. How could we sequence two actions? Say, like <code>getChar :: IO Char</code> and <code>putChar :: Char -&gt; IO ()</code>.</p>\n\n<p>We could try mapping over <code>getChar</code> (an action that, when executed, reads a <code>Char</code> from stdin) using <code>putChar</code>.</p>\n\n<pre><code>fmap putChar getChar :: IO (IO ())\n</code></pre>\n\n<p>Now we have a program that, when executed, reads a <code>Char</code> from stdin and produces a program that, when executed, writes the <code>Char</code> to stdout. But what we actually want is a program that, when executed, reads a <code>Char</code> from stdin and writes the <code>Char</code> to stdout. So we need a \"flattening\" (in the <code>IO</code> case, \"sequencing\") function with type:</p>\n\n<pre><code>join :: IO (IO ()) -&gt; IO ()\n</code></pre>\n\n<p><code>Functor</code> by itself does not provide this function. But it is a function of <code>Monad</code>, where it has the more general type:</p>\n\n<pre><code>join :: Monad m =&gt; m (m a) -&gt; m a\n</code></pre>\n\n<p>What does all of this have to do with <code>&gt;&gt;=</code>? As it happens, monadic bind is just a combination of <code>fmap</code> and <code>join</code>:</p>\n\n<pre><code>:t \\m f -&gt; join (fmap f m)\n(Monad m) =&gt; m a1 -&gt; (a1 -&gt; m a) -&gt; m a\n</code></pre>\n\n<p>Another way of seeing the difference is that <code>fmap</code> never changes the overall structure of the mapped value, but <code>join</code> (and therefore <code>&gt;&gt;=</code> as well) can do that.</p>\n\n<p>In terms of <code>IO</code> actions, <code>fmap</code> will <em>never</em> cause addicional reads/writes or other effects. But <code>join</code> sequences the read/writes of the inner action after those of the outer action.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 4, "creation_date": 1455477579, "post_id": 35392450, "comment_id": 58496519, "body": "just for completeness, Applicative can return <code>Nothing</code> too: <code>Nothing &lt;*&gt; Just 3</code>. The difference is, the &quot;piping&quot; (i.e. computational structure) is <i>fixed</i> when the computation is composed, <i>before</i> it <i>&quot;runs&quot;</i>. But with Monads the piping can change depending on the values produced <i>while</i> it &quot;runs&quot;. (in case of IO, <code>3</code> presumably is received e.g. as user&#39;s input). -- The <i>list</i> example is esp. good here: <code>(foo &lt;$&gt;)</code> keeps the structure (list&#39;s length); <code>([baz, quux] &lt;*&gt;)</code> will change the structure <i>predictably</i> (create length-6 list); with Monad all bets are off."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 18, "last_activity_date": 1455457163, "creation_date": 1455457163, "answer_id": 35392450, "question_id": 35387237, "link": "https://stackoverflow.com/questions/35387237/difference-in-capability-between-fmap-and-bind/35392450#35392450", "title": "Difference in capability between fmap and bind?", "body": "<p>Well, <code>(&lt;$&gt;)</code> is an alias for <code>fmap</code>, and <code>(=&lt;&lt;)</code> is the same as <code>(&gt;&gt;=)</code> with the arguments swapped:</p>\n\n<pre><code>(&lt;$&gt;) :: (x -&gt;   y) -&gt; b x -&gt; b y\n(=&lt;&lt;) :: (x -&gt; b y) -&gt; b x -&gt; b y\n</code></pre>\n\n<p>The difference is now fairly clear: with the bind function, we apply a function that returns a <code>b y</code> rather than a <code>y</code>. So what difference does that make?</p>\n\n<p>Consider this small example:</p>\n\n<pre><code>foo &lt;$&gt; Just 3\n</code></pre>\n\n<p>Notice that <code>(&lt;$&gt;)</code> will apply <code>foo</code> to <code>3</code>, and put the result back into a <code>Just</code>. In other words, the result of this computation <em>cannot</em> be <code>Nothing</code>. On the contrary:</p>\n\n<pre><code>bar =&lt;&lt; Just 3\n</code></pre>\n\n<p>This computation <em>can</em> return <code>Nothing</code>. (For example, <code>bar x = Nothing</code> will do it.)</p>\n\n<p>We can do a similar thing with the list monad:</p>\n\n<pre><code>foo &lt;$&gt; [Red, Yellow, Blue]   -- Result is guaranteed to be a 3-element list.\nbar =&lt;&lt; [Red, Yellow, Blue]   -- Result can be ANY size.\n</code></pre>\n\n<p>In short, with <code>(&lt;$&gt;)</code> (i.e., <code>fmap</code>), the \"structure\" of the result is always identical to the input. But with <code>(=&lt;&lt;)</code> (i.e., <code>(&gt;&gt;=)</code>), the structure of the result can change. This allows conditional execution, reacting to input, and a whole bunch of other things.</p>\n"}], "owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2888, "favorite_count": 5, "accepted_answer_id": 35392450, "answer_count": 3, "score": 17, "last_activity_date": 1516529702, "creation_date": 1455411882, "last_edit_date": 1455504800, "question_id": 35387237, "link": "https://stackoverflow.com/questions/35387237/difference-in-capability-between-fmap-and-bind", "title": "Difference in capability between fmap and bind?", "body": "<p>I'm new to functional programming (coming from javascript), and I'm having a hard time telling the difference between the two, which is also messing with my understand of functors vs. monads.</p>\n\n<p>Functor:</p>\n\n<pre><code>class Functor f where\n    fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>Monad (simplified):</p>\n\n<pre><code>class Monad m where\n    (&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<ul>\n<li><code>fmap</code> takes a function and a functor, and returns a functor.</li>\n<li><code>&gt;&gt;=</code> takes a function and a monad, and returns a monad.</li>\n</ul>\n\n<p>The difference between the two is in the function parameter:</p>\n\n<ul>\n<li><code>fmap</code> - <code>(a -&gt; b)</code></li>\n<li><code>&gt;&gt;=</code> - <code>(a -&gt; m b)</code></li>\n</ul>\n\n<p><code>&gt;&gt;=</code> takes a function parameter that returns a monad. I know that this is significant, but I'm having difficulty seeing how this one slight thing makes monads much more powerful than functors. Can someone explain?</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack", "build-dependencies", "hackage"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455421282, "post_id": 35386808, "comment_id": 58480475, "body": "I have not personally used stack very much so my understanding of it is not paramount. But it looks like you need a <a href=\"https://github.com/commercialhaskell/stack/wiki/Custom-Snapshot\" rel=\"nofollow noreferrer\">custom snapshot</a> if none of the &quot;standard&quot; snapshots will allow your package to build. Perhaps you are simply using the wrong snapshot, or your cabal file itself is wrong."}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 3, "last_activity_date": 1455459864, "creation_date": 1455459864, "answer_id": 35392852, "question_id": 35386808, "link": "https://stackoverflow.com/questions/35386808/remove-stack-cabal-packages-and-install-older-versions/35392852#35392852", "title": "Remove Stack/Cabal packages and install older versions", "body": "<p>You can override a specific snapshot package in your stack.yaml file via extra-deps, e.g.:</p>\n\n<pre><code>extra-deps:\n- http-types-0.8.6\n</code></pre>\n\n<p>Once you start including packages that have conflicting version bounds versus the snapshot you're using, you can end up running into these problems pretty quickly. My recommended solution is:</p>\n\n<ul>\n<li>Ask package maintainers to get their packages into Stackage so that you don't have to fiddle with the versions manually</li>\n<li>Stick to packages in Stackage whenever possible</li>\n</ul>\n\n<p>You can add a package to Stackage yourself, even if you're not the author. For instructions, see <a href=\"https://github.com/fpco/stackage/blob/master/MAINTAINERS.md\" rel=\"nofollow\">the maintainer guide</a>.</p>\n"}], "owner": {"reputation": 1387, "user_id": 1197913, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/acJS3.jpg?s=128&g=1", "display_name": "accraze", "link": "https://stackoverflow.com/users/1197913/accraze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 706, "favorite_count": 0, "accepted_answer_id": 35392852, "answer_count": 1, "score": 2, "last_activity_date": 1455459864, "creation_date": 1455408013, "last_edit_date": 1455408920, "question_id": 35386808, "link": "https://stackoverflow.com/questions/35386808/remove-stack-cabal-packages-and-install-older-versions", "title": "Remove Stack/Cabal packages and install older versions", "body": "<p>I'm new to Haskell and am using Stack to build a small personal project on Mac OSX. I've recently added some new build-deps to my cabal file but now when I run <code>stack build</code>, I get the following error:</p>\n\n<pre><code>--  While attempting to add dependency,\n    Could not find package api-builder in known packages\n\n--  Failure when adding dependencies:\n      api-builder: needed (==0.11.0.0), not present in build plan (latest applicable is 0.11.0.0)\n      http-client: needed (==0.4.20), 0.4.27 found (latest applicable is 0.4.20)\n      http-types: needed (==0.8.6), 0.9 found (latest applicable is 0.8.6)\n    needed for package: music-haskell-0.1.0.0\n\nRecommended action: try adding the following to your extra-deps in /Users/.../src/music-haskell/stack.yaml\n- api-builder-0.11.0.0\n\nYou may also want to try the 'stack solver' command\n</code></pre>\n\n<p>When I run <code>stack solver</code> I get an error about the http-types package</p>\n\n<pre><code>cabal: Could not resolve dependencies:\ntrying: music-haskell-0.1.0.0 (user goal)\nnext goal: http-types (dependency of music-haskell-0.1.0.0)\nrejecting: http-types-0.9 (conflict: music-haskell =&gt; http-types==0.8.6)\nrejecting: http-types-0.8.6, 0.8.5, 0.8.4, 0.8.3, 0.8.2................\n(global constraint requires ==0.9)\nDependency tree exhaustively searched.\n</code></pre>\n\n<p>From what I understand, it looks like I already installed <code>http-types-0.9</code> but now I need <code>http-types-0.8.6</code>. I initially tried to install it manually with <code>$stack install http-types</code>, but I got the following error:</p>\n\n<pre><code>Error parsing targets: Specified target version 0.8.6 for package http-types does not match snapshot version 0.9\n</code></pre>\n\n<p>When I looked to see if I could do <code>$ stack uninstall</code> but it looks like that is deprecated.</p>\n\n<p>How can I get rid of the snapshot/global target for <code>http-type</code>??</p>\n"}, {"tags": ["haskell", "types", "coroutine"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1455405883, "post_id": 35386480, "comment_id": 58477460, "body": "Is it really necessary to put IO into the functor, rather than using it as the &#39;base monad&#39; of <code>Coroutine f m</code> ? Intuitively that&#39;s where it belongs."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1455406122, "post_id": 35386480, "comment_id": 58477530, "body": "If I delete the appearances of IO in <code>IORequest</code>, I can write <code>requestString m = lift m &gt;&gt;= \\x -&gt; suspend (GetString x return)</code> with essentially the same type, <code>requestString  :: Monad m =&gt; m String -&gt; Coroutine IORequest m String</code>"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1455407478, "post_id": 35386480, "comment_id": 58477878, "body": "I&#39;m not having trouble with the existential type, <a href=\"http://lpaste.net/1570704776058896384\" rel=\"nofollow noreferrer\">lpaste.net/1570704776058896384</a> . Of course it&#39;s equivalent to <code>newtype IORequest x = IORequest {runIORequest :: IO x}</code>, no?"}, {"owner": {"reputation": 550, "user_id": 3809223, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a86c2d7227577450956bbbe1ea6662d8?s=128&d=identicon&r=PG&f=1", "display_name": "ksaveljev", "link": "https://stackoverflow.com/users/3809223/ksaveljev"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1455407568, "post_id": 35386480, "comment_id": 58477905, "body": "It&#39;s just an experiment. I thought about separating pure code from IO. Let&#39;s say this coroutine is huge, and it needs to do some IO calls from time to time. I don&#39;t know if it will do any good, will ghc be able to do better optimisations to this coroutine in its current form or will the code that entirely runs in IO do better? I have no idea and would like to find out, to experiment."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1455408215, "post_id": 35386480, "comment_id": 58478056, "body": "Right, I&#39;m not opposing it, just making points. I think that if you are using something like this type it is likely to be better to use IO at the bottom, rather than Identity; you are already paying for the complexity, so to speak. Coroutine does have an instance for MonadIO. But a suspension alternative  like <code>ReadFile FilePath (Text -&gt; x)</code> would go better with the spirit of the library I think."}, {"owner": {"reputation": 550, "user_id": 3809223, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a86c2d7227577450956bbbe1ea6662d8?s=128&d=identicon&r=PG&f=1", "display_name": "ksaveljev", "link": "https://stackoverflow.com/users/3809223/ksaveljev"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1455408377, "post_id": 35386480, "comment_id": 58478098, "body": "I also got this example working with the existential type, but my main code doesn&#39;t work. I would need to update this example a bit (which I&#39;m not able to do at this moment)"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1455409384, "post_id": 35386480, "comment_id": 58478349, "body": "Oddly <code>monad-coroutine</code> and FreeT don&#39;t have <a href=\"http://hackage.haskell.org/package/streaming-0.1.4.0/docs/Streaming.html#v:distribute\" rel=\"nofollow noreferrer\">distribute</a> but the state handling will be much simpler if it is done separately this way and not crammed into <code>loop</code>, your interpreter. Of course you can also write a <code>loop :: MonadIO m =&gt; Coroutine IORequest m r -&gt; m r</code>, and then emerge with <code>StateT IO r</code> which you run the usual way."}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 1, "last_activity_date": 1455423171, "creation_date": 1455423171, "answer_id": 35388275, "question_id": 35386480, "link": "https://stackoverflow.com/questions/35386480/generalize-coroutine-suspension-type/35388275#35388275", "title": "Generalize Coroutine suspension type", "body": "<p>Your comment about changing the data type to contain an existential quantifier seems perfectly reasonable. Most of your functions do not change.</p>\n\n<pre><code>data IORequest x = forall a . RunIO (IO a) (a -&gt; x)\n\ninstance Functor IORequest where \n  fmap f (RunIO x g) = RunIO x (f.g) \n</code></pre>\n\n<p>Replace the other constructors with <code>RunIO</code>: </p>\n\n<pre><code>request :: Monad m =&gt; IO () -&gt; Coroutine IORequest m ()\nrequest x = suspend (RunIO x return)\n\nrequestString :: Monad m =&gt; IO String -&gt; Coroutine IORequest m String\nrequestString x = suspend (RunIO x return)\n</code></pre>\n\n<p>And your loop function doesn't really change either - you just need to <em>not</em> ignore the value inside of <code>RunIO</code>: </p>\n\n<pre><code>loop :: Coroutine IORequest (State Int) Int -&gt; Int -&gt; IO ()\nloop routine state =\n  do let (request, state') = runState (resume routine) state\n     case request of\n       Left (RunIO cmd q') -&gt; do\n         a &lt;- cmd\n         loop (q' a) state'\n       Right result -&gt; do\n         print result\n</code></pre>\n\n<p>Note that your <code>IORequest</code> can also be defined thus (if you have a fairly recent GHC):</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms, ViewPatterns #-}\n\nimport Data.Functor.Kan.Lan (Lan(..)) \nimport Data.Functor.Identity (Identity(..))\n\ntype IORequest = Lan Identity IO \n\npattern RunIO :: IO a -&gt; (a -&gt; x) -&gt; IORequest x \npattern RunIO x f &lt;- Lan ((.Identity) -&gt; f) x \n  where RunIO x f = Lan (f.runIdentity) x \n</code></pre>\n\n<p>Then it is clear to see that <code>IORequest</code> is now just isomorphic to <code>IO</code>. This follows from the laws of the left kan extension (namely, that <code>lanToComposedAdjoint</code> and <code>composedAdjointToLan</code> are witness to an isomorphism) but can be written directly:</p>\n\n<pre><code>actuallyJustIO_1 :: IORequest a -&gt; IO a \nactuallyJustIO_1 = fmap runIdentity . lanToComposedAdjoint \n\nactuallyJustIO_2 :: IO a -&gt; IORequest a \nactuallyJustIO_2 = composedAdjointToLan . fmap Identity \n</code></pre>\n\n<p>These two functions are clearly each others' left and right inverse, witnessing the isomorphism between <code>IORequest</code> and <code>IO</code>. </p>\n"}], "owner": {"reputation": 550, "user_id": 3809223, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a86c2d7227577450956bbbe1ea6662d8?s=128&d=identicon&r=PG&f=1", "display_name": "ksaveljev", "link": "https://stackoverflow.com/users/3809223/ksaveljev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1455423171, "creation_date": 1455405409, "question_id": 35386480, "link": "https://stackoverflow.com/questions/35386480/generalize-coroutine-suspension-type", "title": "Generalize Coroutine suspension type", "body": "<p>I am trying things out and have a coroutine which is going to request all <code>IO</code> actions from the outside. Therefore I have my custom suspension type <code>IORequest</code>. The problem is that for every kind of return type I need to add an extra constructor to <code>IORequest</code>.</p>\n\n<p>Here is a working example (which requires <a href=\"https://hackage.haskell.org/package/mtl\" rel=\"nofollow\">mtl</a> and <a href=\"https://hackage.haskell.org/package/monad-coroutine\" rel=\"nofollow\">monad-coroutine</a>)</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\nmodule Main where\n\nimport Control.Monad.State\nimport Control.Monad.Coroutine\n\nmain :: IO ()\nmain = loop coroutine initialState\n\ninitialState :: Int\ninitialState = 65432\n\ndata IORequest x\n  = RunIO (IO ()) (() -&gt; x)\n  | GetString (IO String) (String -&gt; x)\n  deriving Functor\n\nrequest :: Monad m =&gt; IO () -&gt; Coroutine IORequest m ()\nrequest x = suspend (RunIO x return)\n\nrequestString :: Monad m =&gt; IO String -&gt; Coroutine IORequest m String\nrequestString x = suspend (GetString x return)\n\ncoroutine :: Coroutine IORequest (State Int) Int\ncoroutine = do\n  str &lt;- requestString (readFile \"my.txt\")\n  request (print \"hello\")\n  return 5\n\nloop :: Coroutine IORequest (State Int) Int -&gt; Int -&gt; IO ()\nloop routine state =\n  do let (request, state') = runState (resume routine) state\n     case request of\n       Left (GetString cmd q') -&gt; do\n         str &lt;- cmd\n         loop (q' str) state'\n       Left (RunIO cmd q') -&gt; do\n         cmd\n         loop (q' ()) state'\n       Right result -&gt; do\n         print result\n</code></pre>\n\n<p>As you can see if at some point I need to run action <code>IO Bool</code> I will need to extend my <code>IORequest</code> and provide another helper method to be able to successfully use it (and also extending the pattern match in <code>loop</code>).</p>\n\n<p>The question: can the <code>IORequest</code> be generalised somehow to allow general <code>(IO a) -&gt; a</code> transition?</p>\n\n<p>Something like</p>\n\n<pre><code>data IORequest x\n  = forall a. RunIO (IO a) (a -&gt; x)\n</code></pre>\n\n<p>(I wasn't able to make it work though, as <code>a</code> would escape when we try running it in <code>str &lt;- cmd</code> for example)</p>\n"}, {"tags": ["haskell", "dpll"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1455405299, "post_id": 35386296, "comment_id": 58477320, "body": "If you are &quot;quite new to Haskell&quot; and you &quot;won&#39;t be able to do anything complicated&quot; maybe writing a DPLL SAT solver is not the most appropriate choice for a first exercise. By all means, give it a try, but it could be helpful to get familiar with the language solving some more basic task, at first."}], "answers": [{"comments": [{"owner": {"reputation": 165, "user_id": 5857949, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e83895d561b94f0c697aab40e0f9658c?s=128&d=identicon&r=PG&f=1", "display_name": "karambit", "link": "https://stackoverflow.com/users/5857949/karambit"}, "edited": false, "score": 0, "creation_date": 1455405314, "post_id": 35386374, "comment_id": 58477323, "body": "Is this really correct? I don&#39;t see how your code would let the last 2 ifs to run?"}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "reply_to_user": {"reputation": 165, "user_id": 5857949, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e83895d561b94f0c697aab40e0f9658c?s=128&d=identicon&r=PG&f=1", "display_name": "karambit", "link": "https://stackoverflow.com/users/5857949/karambit"}, "edited": false, "score": 0, "creation_date": 1455405796, "post_id": 35386374, "comment_id": 58477436, "body": "@karambit I assumed that you have functions like <code>find_pure_symbol</code> and <code>find_unit_symbol</code> that return a tuple <code>(p, value)</code>. The pattern guard clause with the <code>&lt;-</code> applies the function, and the following condition (separated with a comma) is your <i>if</i>. I also assumed the existence of the functions <code>nonnull</code>, <code>rest</code> and <code>first</code>"}], "tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": true, "score": 4, "last_activity_date": 1455404947, "last_edit_date": 1455404947, "creation_date": 1455404611, "answer_id": 35386374, "question_id": 35386296, "link": "https://stackoverflow.com/questions/35386296/haskell-multiple-if-statements/35386374#35386374", "title": "Haskell - multiple IF statements", "body": "<p>Use pattern guards. For example</p>\n\n<pre><code>dpll clauses symbols modell\n  | \"all clauses true\" = true\n  | \"some clauses false\" = false\n  | (p,value) &lt;- find_pure_symbol symbols clauses model,\n    nonnull p = dpll clauses ...\n  | (p,value) &lt;- find_unit_clause clauses model,\n    nonnull p = dpll clauses ...\n  | p &lt;- first symbols, r &lt;- rest symbols =\n                dpll clauses ... || dpll clauses ....\n</code></pre>\n\n<p>(It looks like not all clauses true does not mean some clauses false, otherwise you could never reach the 3rd and following cases.)</p>\n\n<p>The challenge is then to formulate the conditions, in the example I have marked them with \" around them, but they are normal haskell expressions of type Bool.</p>\n"}], "owner": {"reputation": 165, "user_id": 5857949, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e83895d561b94f0c697aab40e0f9658c?s=128&d=identicon&r=PG&f=1", "display_name": "karambit", "link": "https://stackoverflow.com/users/5857949/karambit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 899, "favorite_count": 0, "accepted_answer_id": 35386374, "answer_count": 1, "score": 0, "last_activity_date": 1580476031, "creation_date": 1455404005, "last_edit_date": 1580476031, "question_id": 35386296, "link": "https://stackoverflow.com/questions/35386296/haskell-multiple-if-statements", "title": "Haskell - multiple IF statements", "body": "<p><a href=\"https://i.stack.imgur.com/KxJqV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KxJqV.png\" alt=\"enter image description here\"></a></p>\n\n<p>I would like to implement the DPLL algorithm above in Haskell. But the problem is I don't know how to get multiple if statements to run.\nSo I was thinking, you can pattern match for the first 2 if statements. But you can't do it for the third and fourth? Because both of them must run and the return statement must run too.</p>\n\n<p>How do I make multiple if statements like the above in Haskell? Also I'm quite new to Haskell so I won't be able to do anything 'complicated'.</p>\n"}, {"tags": ["haskell", "parallel-processing"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1455405886, "post_id": 35385901, "comment_id": 58477463, "body": "Try reading <a href=\"https://wiki.haskell.org/Applications_and_libraries/Concurrency_and_parallelism\" rel=\"nofollow noreferrer\">wiki.haskell.org/Applications_and_libraries/&hellip;</a> Also, <code>parMap</code> from <code>Control.Parallel.Strategies</code> could solve the first, albeit for very simple functions like those above it could also make performance worse."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1455407782, "post_id": 35385901, "comment_id": 58477960, "body": "Welcome to stackoverflow, please tell us what you have tried, and show us some effort on your side. How much haskell do you already know. Using multiple cores is usually not a beginners problem. You might find some information in <a href=\"http://chimera.labs.oreilly.com/books/1230000000929\" rel=\"nofollow noreferrer\">Simon Marlowe&#39;s excellent book</a>. Also before going parallel - just check if the simple single core solution is fast enough."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 5230506, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-FgvU8vBSeKI/AAAAAAAAAAI/AAAAAAAAAGY/kVqeduGWqck/photo.jpg?sz=128", "display_name": "Rodrigo Caetano Rocha", "link": "https://stackoverflow.com/users/5230506/rodrigo-caetano-rocha"}, "edited": false, "score": 0, "creation_date": 1455411374, "post_id": 35387147, "comment_id": 58478728, "body": "I guess this is the most efficient way of implementing the map operator in parallel with Haskell. Let me know if there is a more efficient way."}], "tags": [], "owner": {"reputation": 11, "user_id": 5230506, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-FgvU8vBSeKI/AAAAAAAAAAI/AAAAAAAAAGY/kVqeduGWqck/photo.jpg?sz=128", "display_name": "Rodrigo Caetano Rocha", "link": "https://stackoverflow.com/users/5230506/rodrigo-caetano-rocha"}, "is_accepted": false, "score": 1, "last_activity_date": 1455411153, "creation_date": 1455411153, "answer_id": 35387147, "question_id": 35385901, "link": "https://stackoverflow.com/questions/35385901/implementing-efficient-parallel-map-and-reduce-in-haskell/35387147#35387147", "title": "Implementing efficient parallel map and reduce in Haskell", "body": "<p>For the functional map, an equivalent sequential version in Haskell would be:</p>\n\n<pre><code>f x = 2*x\ndxs = map f [1,2,3,4]\nmain = print dxs\n</code></pre>\n\n<p>A parallel version in Haskell would be:</p>\n\n<pre><code>import Control.Parallel.Strategies\nimport Control.Parallel\n\nf x = 2*x\ndxs = parMap rpar f [1,2,3,4]\nmain = print(dxs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "is_accepted": false, "score": 0, "last_activity_date": 1455462442, "creation_date": 1455462442, "answer_id": 35393259, "question_id": 35385901, "link": "https://stackoverflow.com/questions/35385901/implementing-efficient-parallel-map-and-reduce-in-haskell/35393259#35393259", "title": "Implementing efficient parallel map and reduce in Haskell", "body": "<p>Another way is</p>\n\n<pre><code>import Control.Parallel\n\nnewtype PMonoid a = PM {unPM :: a}\n\ninstance Monoid a =&gt; Monoid (PMonoid a) where\n    mempty = PM mempty\n    (PM a) &lt;&gt; (PM b) = PM (a `par` b `pseq` a &lt;&gt; b)\n</code></pre>\n\n<p>This will make <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Foldable.html#v:foldMap\" rel=\"nofollow\"><code>foldMap</code></a> parallel. (In particular, the map operation gains parallelism by virtue of laziness.)</p>\n\n<p>You many want to incoporate <a href=\"https://hackage.haskell.org/package/deepseq\" rel=\"nofollow\"><code>deepseq</code></a>, but it not necesarrily necessary.</p>\n"}], "owner": {"reputation": 11, "user_id": 5230506, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-FgvU8vBSeKI/AAAAAAAAAAI/AAAAAAAAAGY/kVqeduGWqck/photo.jpg?sz=128", "display_name": "Rodrigo Caetano Rocha", "link": "https://stackoverflow.com/users/5230506/rodrigo-caetano-rocha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 405, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1455462442, "creation_date": 1455401324, "last_edit_date": 1455411275, "question_id": 35385901, "link": "https://stackoverflow.com/questions/35385901/implementing-efficient-parallel-map-and-reduce-in-haskell", "title": "Implementing efficient parallel map and reduce in Haskell", "body": "<p>Given the following examples in Python, I would like to know how to implement equivalent code in Haskell that is also efficient and parallel.</p>\n\n<p>First example in Python: functional map</p>\n\n<pre><code>f = lambda x: 2*x\nprint map(f, [1,2,3,4])\n</code></pre>\n\n<p>Second example in Python: functional reduce</p>\n\n<pre><code>g = lambda x,y: x*y\nprint reduce(g, [1,2,3,4], 1)\n</code></pre>\n\n<p>I would like the parallel code in Haskell to be able to efficiently exploit multicore processors.</p>\n\n<p>Note: These are just toy examples, I don't intend to have speedups with these toy examples. They are just meant to illustrate how to implement the operators map and reduce in parallel with Haskell.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1455395474, "post_id": 35384736, "comment_id": 58474395, "body": "One thing to consider: What do you want to happen if there is no tuple (i.e. your <code>Maybe</code> value contains a <code>Nothing</code>)?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1455396166, "post_id": 35384736, "comment_id": 58474624, "body": "try <code>maybe undefined fst</code>, or <code>(fst &lt;$&gt;)</code>."}, {"owner": {"reputation": 4089, "user_id": 625359, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6e1b6d314418caa2db1aad5f8e225037?s=128&d=identicon&r=PG", "display_name": "Darkenor", "link": "https://stackoverflow.com/users/625359/darkenor"}, "edited": false, "score": 1, "creation_date": 1484939547, "post_id": 35384736, "comment_id": 70732975, "body": "Why was this downvoted?"}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 3, "last_activity_date": 1455394156, "creation_date": 1455394156, "answer_id": 35384777, "question_id": 35384736, "link": "https://stackoverflow.com/questions/35384736/haskell-how-to-get-element-from-a-maybe-tuple/35384777#35384777", "title": "Haskell: How to get element from a Maybe tuple", "body": "<p>You can pattern match on <code>Maybe</code> value using <code>case</code>, for example:</p>\n\n<pre><code>case mbVal of\n  Just x -&gt; fst x\n  Nothing -&gt; ...\n</code></pre>\n\n<p>You can also use <code>fromJust</code> if you are sure the value is <code>Just</code>.</p>\n\n<p>Finally, you can match the first element of a tuple right away:</p>\n\n<pre><code>case mbVal of\n  Just (x,_) -&gt; x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 8, "last_activity_date": 1455562422, "last_edit_date": 1455562422, "creation_date": 1455561883, "answer_id": 35416796, "question_id": 35384736, "link": "https://stackoverflow.com/questions/35384736/haskell-how-to-get-element-from-a-maybe-tuple/35416796#35416796", "title": "Haskell: How to get element from a Maybe tuple", "body": "<p>Since <code>Maybe</code> is a functor, use <code>fmap</code> to lift <code>fst :: (a, b) -&gt; a</code> to work with <code>Maybe (a,b)</code>.</p>\n\n<pre><code>&gt; :t fmap fst\nfmap fst :: Functor f =&gt; f (b, b1) -&gt; f b\n&gt; fmap fst $ Just (3, 6)\nJust 3\n&gt; fmap fst $ Nothing\nNothing\n</code></pre>\n\n<p>Of course, this returns a <code>Maybe a</code>, not an <code>a</code>, so you can use the <code>maybe</code> function to unpack the result (and provide a default value if the <code>Maybe (a, b)</code> is actually <code>Nothing</code>):</p>\n\n<pre><code>&gt; import Data.Maybe\n&gt; maybe 0 fst (Just (3, 6))\n3\n&gt; maybe 0 fst Nothing\n0\n</code></pre>\n"}], "owner": {"reputation": 165, "user_id": 5857949, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e83895d561b94f0c697aab40e0f9658c?s=128&d=identicon&r=PG&f=1", "display_name": "karambit", "link": "https://stackoverflow.com/users/5857949/karambit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2203, "favorite_count": 0, "accepted_answer_id": 35416796, "answer_count": 2, "score": 3, "last_activity_date": 1455562422, "creation_date": 1455393824, "last_edit_date": 1455394509, "question_id": 35384736, "link": "https://stackoverflow.com/questions/35384736/haskell-how-to-get-element-from-a-maybe-tuple", "title": "Haskell: How to get element from a Maybe tuple", "body": "<p>How do you extract the first element from a <code>Maybe</code> tuple? I have tried to use <code>fst</code> but that doesn't seem to work.</p>\n"}, {"tags": ["haskell", "types", "constructor"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1455393570, "post_id": 35384562, "comment_id": 58473819, "body": "Is this, by any chance, homework? Because it doesn&#39;t fit to decouple the ratings from the game: a <code>Game</code> isn&#39;t <b><i>either</i></b> a <code>Title</code> or a <code>Rating</code>; it&#39;s a title accustomed with (possible zero) ratings."}, {"owner": {"reputation": 7, "user_id": 5404540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZMPWy.jpg?s=128&g=1", "display_name": "Ona", "link": "https://stackoverflow.com/users/5404540/ona"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1455393639, "post_id": 35384562, "comment_id": 58473841, "body": "No, I&#39;m trying to grasp a specific concept - I just used an arbitrary concept for an example."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1455394376, "post_id": 35384562, "comment_id": 58474054, "body": "Allright; just asking whether possible answers could change <code>Game</code>&#39;s definition."}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 0, "last_activity_date": 1455393294, "creation_date": 1455393294, "answer_id": 35384647, "question_id": 35384562, "link": "https://stackoverflow.com/questions/35384562/multiple-elements-for-a-constructor-function-of-a-data-type-without-making-it-a/35384647#35384647", "title": "Multiple elements for a constructor function of a data type without making it a list?", "body": "<p>Yes, you can, but you need to put <code>Ratings</code> before each tuple in the list:</p>\n\n<pre><code>testDatabase = [Title \"example\", Ratings (\"Amy\",5), Ratings (\"Bill\",8), Ratings (\"Ian\",7), Ratings (\"Megan\",4)]\n</code></pre>\n\n<p>You can also omit the tuple in this case:</p>\n\n<pre><code>data Game = Title String\n          | Ratings String Int\n\ntestDatabase = [Title \"example\", Ratings \"Amy\" 5, Ratings \"Bill\" 8 ...]\n</code></pre>\n\n<p>Finally, i suppose, you wanted this:</p>\n\n<pre><code>data Game = Game String [Rating]\ndata Rating = Rating String Int\n\ntestDatabase = Game \"example\" [Ratings \"Amy\" 5, Ratings \"Bill\" 8 ...]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7, "user_id": 5404540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZMPWy.jpg?s=128&g=1", "display_name": "Ona", "link": "https://stackoverflow.com/users/5404540/ona"}, "edited": false, "score": 0, "creation_date": 1455393848, "post_id": 35384650, "comment_id": 58473912, "body": "Synonym types were the missing piece to this puzzle I suppose, thank you."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 7, "user_id": 5404540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZMPWy.jpg?s=128&g=1", "display_name": "Ona", "link": "https://stackoverflow.com/users/5404540/ona"}, "edited": false, "score": 0, "creation_date": 1455403908, "post_id": 35384650, "comment_id": 58476958, "body": "Well, it works just as well without the type synonyms: <code>data Game = Game String [(String, Int)]</code>. I just find type synonyms often make <code>data</code> declarations more readable in a lighter-weight way than using a record would: <code>data Game = Game {title :: String, ratings :: [(String, Int)]}</code>. In a real program I&#39;d use a better type for <code>Rating</code> too. Probably another <code>data</code>, but a newtype over the tuple could be fine too."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 1, "last_activity_date": 1455393302, "creation_date": 1455393302, "answer_id": 35384650, "question_id": 35384562, "link": "https://stackoverflow.com/questions/35384562/multiple-elements-for-a-constructor-function-of-a-data-type-without-making-it-a/35384650#35384650", "title": "Multiple elements for a constructor function of a data type without making it a list?", "body": "<p>If you want one Game to have a single string title, and a list of rating tuples, you want only one constructor, not multiple:</p>\n\n<pre><code>type Title = String\ntype Rating = (String, Int)\n\ndata Game = Game Title [Rating] \n</code></pre>\n\n<p>Then you can define a game with just a single call to the Game constructor:</p>\n\n<pre><code>stDatabase :: [Game]\ntestDatabase = [Game \"example\" [(\"Amy\",5), (\"Bill\",8), (\"Ian\",7), (\"Megan\",4)]]\n</code></pre>\n"}], "owner": {"reputation": 7, "user_id": 5404540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZMPWy.jpg?s=128&g=1", "display_name": "Ona", "link": "https://stackoverflow.com/users/5404540/ona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 35384650, "answer_count": 2, "score": 0, "last_activity_date": 1455393302, "creation_date": 1455392825, "question_id": 35384562, "link": "https://stackoverflow.com/questions/35384562/multiple-elements-for-a-constructor-function-of-a-data-type-without-making-it-a", "title": "Multiple elements for a constructor function of a data type without making it a list?", "body": "<p>suppose I have constructed the following data type for a videogame within a videogame rating system (values dont matter, just an example):</p>\n\n<pre><code>data Game = Title String\n          | Ratings (String, Int)\n</code></pre>\n\n<p>and suppose I have test database in this format (only showing one game - also, there can be multiple ratings for one game):</p>\n\n<pre><code>testDatabase :: [Game]\ntestDatabase = [Title \"example\", Ratings (\"Amy\",5), (\"Bill\",8), (\"Ian\",7), (\"Megan\",4)]\n</code></pre>\n\n<p>Is there a way to correctly implement this without having to make the Ratings constructor function a list of tuples? i.e.</p>\n\n<pre><code>data Game = Title String\n          | Ratings [(String, Int)]\n</code></pre>\n\n<p>I cannot find a way to do it otherwise.</p>\n"}, {"tags": ["haskell", "yesod", "hamlet"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1455383043, "post_id": 35382639, "comment_id": 58470045, "body": "If i get you right, you need to add some parameter to <code>@{EntityR}</code> like this: <code>@{EntityR param}</code>"}, {"owner": {"reputation": 349, "user_id": 2635503, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/795ac058dbfa6848b9b17c39adabfdd5?s=128&d=identicon&r=PG", "display_name": "Markus Barthlen", "link": "https://stackoverflow.com/users/2635503/markus-barthlen"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1455383197, "post_id": 35382639, "comment_id": 58470092, "body": "You are completely right, I looked at the wrong place (since the line number refered to the line containing [whamlet|). Please post an answer so that I can mark the question as answered. Thank you very much."}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 2, "last_activity_date": 1455383466, "creation_date": 1455383466, "answer_id": 35382788, "question_id": 35382639, "link": "https://stackoverflow.com/questions/35382639/having-trouble-compiling-yesod-route-after-introducing-a-parameter/35382788#35382788", "title": "Having trouble compiling yesod route after introducing a parameter", "body": "<p>After modifying your route you forgot to pass newly added parameter into <code>@{EntityR}</code> interpolation, something like this: <code>@{EntityR param}</code>.</p>\n"}], "owner": {"reputation": 349, "user_id": 2635503, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/795ac058dbfa6848b9b17c39adabfdd5?s=128&d=identicon&r=PG", "display_name": "Markus Barthlen", "link": "https://stackoverflow.com/users/2635503/markus-barthlen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 35382788, "answer_count": 1, "score": 1, "last_activity_date": 1455383466, "creation_date": 1455382628, "last_edit_date": 1495541249, "question_id": 35382639, "link": "https://stackoverflow.com/questions/35382639/having-trouble-compiling-yesod-route-after-introducing-a-parameter", "title": "Having trouble compiling yesod route after introducing a parameter", "body": "<p>I am running a modified example of \n<a href=\"http://www.yesodweb.com/book/blog-example-advanced\" rel=\"nofollow noreferrer\">http://www.yesodweb.com/book/blog-example-advanced</a></p>\n\n<p>that previously did not use a parameter id of type DBEntitySchemaId.\nSince introducing it, I am getting</p>\n\n<pre><code>Handler/Entity.hs:146:34:\n    Couldn't match type \u2018DBEntitySchemaId -&gt; Route App\u2019\n                  with \u2018Route (HandlerSite (WidgetT App IO))\u2019\n    Expected type: WidgetT\n                    App IO ((DBEntitySchemaId -&gt; Route App) -&gt; [(Text, Text)] -&gt; Text)\n     Actual type: WidgetT\n                    App\n                    IO\n                    (Route (HandlerSite (WidgetT App IO)) -&gt; [(Text, Text)] -&gt; Text)\n   In the first argument of \u2018(&gt;&gt;=)\u2019, namely \u2018getUrlRenderParams\u2019\n   In a stmt of a 'do' block:\n     (getUrlRenderParams\n      &gt;&gt;=\n        (\\ urender_akdM\n           -&gt; (asWidgetT GHC.Base.. toWidget)\n                (toHtml (\\ u_akdN -&gt; urender_akdM u_akdN [] EntityR))))\n</code></pre>\n\n<p>which refers to the line using the defaultLayout. \nThe relevant code is:</p>\n\n<pre><code>getEntityR :: DBEntitySchemaId -&gt; Handler Html\ngetEntityR id = do\n  oldEntities &lt;- runDB $ selectList [DBEntityDbentitySchemaId ==. id] []\n  fields &lt;- runDB $ selectList [DBFieldDbentitySchemaId ==. id, DBFieldFieldTypeId ==. (toSqlKey 1)] []\n  mauthId &lt;- maybeAuthId\n  ((res, widget), enctype) &lt;- runFormPost (form fields)\n  case (mauthId,res) of\n    (Just userId, FormSuccess (attributeValues)) -&gt; do\n      setMessageI $ MsgSubmittedKarma\n      let entity = DBEntity \"Test\" id\n      entId &lt;- runDB $ insert entity\n      let fieldsNVals = zip fields attributeValues\n      let einfuegen field attributeValue = case (field, attributeValue) of\n                                      ((Entity fldId _), (FormSuccess val)) -&gt; do\n                                         a &lt;- runDB $ insert (Attribute {attributeEntityId = entId, attributeDbfieldId = fldId, attributeStringValue =  val})\n                                         return (Just a)\n                                      _ -&gt; return Nothing\n      _ &lt;- forM fieldsNVals (\\(field, attributeValue) -&gt; einfuegen field attributeValue)\n\n      redirect $ (EntityR id)\n    _ -&gt; do        \n      --render &lt;- getUrlRenderParams\n      --return $ renderHtml $ [hamlet|\n      defaultLayout [whamlet|\n          $if null oldEntities\n              &lt;p&gt;There are no entities\n          $else\n              &lt;ul&gt;\n                  $forall Entity entityId entity  &lt;- oldEntities\n                      &lt;li&gt;\n                          &lt;p&gt;#{dBEntityName entity}\n          $if mauthId == Nothing\n              &lt;form method=post action=@{EntityR} enctype=#{enctype}&gt;\n                  &lt;input type=submit value=_{MsgPleaseLogin}&gt;\n          $else\n              &lt;form method=post action=@{EntityR} enctype=#{enctype}&gt;\n                  ^{widget}\n                  &lt;input type=submit&gt;\n      |]\n</code></pre>\n\n<p>What I already tried was changing whamlet to hamlet and \nadding some lines of code from here (commented out)</p>\n\n<p><a href=\"https://stackoverflow.com/questions/10080459/trying-to-send-an-email-in-yesod-using-hamlet\">Trying to send an email in yesod using hamlet</a></p>\n\n<p>and \nchanging </p>\n\n<pre><code>[whamlet| \n</code></pre>\n\n<p>to </p>\n\n<pre><code>[whamlet|@{getEntityR}/#{id}|\n</code></pre>\n\n<p>and</p>\n\n<pre><code>[whamlet||@?{urlParams id}|\n</code></pre>\n\n<p>and some variations of this inspired by</p>\n\n<p><a href=\"https://stackoverflow.com/questions/19399274/render-url-with-query-parameters\">Render url with query parameters</a>\n<a href=\"https://groups.google.com/forum/#!topic/yesodweb/q1gtkOgM32I\" rel=\"nofollow noreferrer\">https://groups.google.com/forum/#!topic/yesodweb/q1gtkOgM32I</a></p>\n\n<p>I assume there is only a small modification to make. However my understanding of whamlet/hamlet is not too great. So I am posting this in case it is a trivial problem. I fully understand that I need to put in more work, I am just having trouble googling my problem. So please bear with me.</p>\n"}, {"tags": ["haskell", "io-monad", "haskell-spock"], "answers": [{"comments": [{"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1455386001, "post_id": 35383025, "comment_id": 58471120, "body": "From where to I import <code>liftIO</code>?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1455386300, "post_id": 35383025, "comment_id": 58471223, "body": "<a href=\"http://haddock.stackage.org/lts-5.1/transformers-0.4.2.0/Control-Monad-IO-Class.html\" rel=\"nofollow noreferrer\">haddock.stackage.org/lts-5.1/transformers-0.4.2.0/&hellip;</a>"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1455386340, "post_id": 35383025, "comment_id": 58471245, "body": "And here you can search for modules/functions: <a href=\"https://www.stackage.org/lts-5.1/hoogle?q=liftIO\" rel=\"nofollow noreferrer\">stackage.org/lts-5.1/hoogle?q=liftIO</a> You can even search by type!"}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 6, "last_activity_date": 1455388472, "last_edit_date": 1455388472, "creation_date": 1455384729, "answer_id": 35383025, "question_id": 35381853, "link": "https://stackoverflow.com/questions/35381853/how-can-i-use-an-io-string-inside-a-spock-request-handler/35383025#35383025", "title": "How can I use an `IO String` inside a Spock request handler?", "body": "<p>The <code>ActionT</code> type is an instance of <code>MonadIO</code> typeclass. That means you can use <code>liftIO</code> to perform IO actions inside this monad. In your case you seem to need <code>liftIO $ rstr n</code> instead of plain <code>rstr n</code>.</p>\n\n<p>This demonstrates what I'm referring to:</p>\n\n<pre><code>import Control.Monad.IO.Class\n...\nmain :: IO ()\nmain =\n    runSpock 8080 $ spockT id $\n    do get root $\n           redirect \"/data/1\"\n       get (\"data\" &lt;//&gt; var) $ \\n -&gt;\n          do\n           str &lt;- liftIO $ rstr n\n           text $ pack str\n</code></pre>\n"}], "owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 0, "accepted_answer_id": 35383025, "answer_count": 1, "score": 4, "last_activity_date": 1455388472, "creation_date": 1455378438, "last_edit_date": 1455381347, "question_id": 35381853, "link": "https://stackoverflow.com/questions/35381853/how-can-i-use-an-io-string-inside-a-spock-request-handler", "title": "How can I use an `IO String` inside a Spock request handler?", "body": "<p>I have the following function that produces a random string of characters in multiples of 1024:</p>\n\n<pre><code>import System.Random\n\nrchars :: Int -&gt; [IO Char]\nrchars n = map (\\_ -&gt; randomRIO ('a', 'z')) [n | n &lt;- [0..n]] -- a wasteful \"iteration\"-like func\n\nrstr :: Int -&gt; IO String\nrstr n = sequence $ rchars (1024 * n)\n</code></pre>\n\n<p>I want to expose this to the web using Spock, for example:</p>\n\n<pre><code>import Data.Monoid\nimport Data.Text\nimport Lib\nimport Web.Spock.Safe\n\nmain :: IO ()\nmain =\n    runSpock 8080 $ spockT id $\n    do get root $\n           redirect \"/data/1\"\n       get (\"data\" &lt;//&gt; var) $ \\n -&gt;\n          do\n           str &lt;- rstr n\n           text (\"boo:\" &lt;&gt; str &lt;&gt; \"!\")\n</code></pre>\n\n<p>but this is incorrect, as the innermost <code>do</code>-block yields an <code>IO b0</code>, not the expected type from Spock:</p>\n\n<pre><code>Couldn't match type \u2018ActionT IO ()\u2019 with \u2018IO b0\u2019\nExpected type: Int -&gt; IO b0\n  Actual type: hvect-0.2.0.0:Data.HVect.HVectElim\n                 '[Int] (ActionT IO ())\nThe lambda expression \u2018\\ n -&gt; ...\u2019 has one argument,\nbut its type \u2018hvect-0.2.0.0:Data.HVect.HVectElim\n                '[Int] (ActionT IO ())\u2019\nhas none\nIn the second argument of \u2018($)\u2019, namely\n  \u2018\\ n\n     -&gt; do { str &lt;- rstr n;\n             text (\"boo:\" &lt;&gt; str &lt;&gt; \"!\") }\u2019\nIn a stmt of a 'do' block:\n  get (\"data\" &lt;//&gt; var)\n  $ \\ n\n      -&gt; do { str &lt;- rstr n;\n              text (\"boo:\" &lt;&gt; str &lt;&gt; \"!\") }\n</code></pre>\n\n<p>How can I use my <code>IO</code>-driven random string function inside the Spock get request handler?</p>\n"}, {"tags": ["haskell", "ghc", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "edited": false, "score": 0, "creation_date": 1455396299, "post_id": 35382282, "comment_id": 58474676, "body": "Thanks. The web page started with a standalone version instead of being associated with a type class. Can you illustrate how the standalone version would be defined also?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455421880, "post_id": 35382282, "comment_id": 58480569, "body": "&quot;Associated&quot; type and data families differ very little. They are not really &quot;associated&quot; in any way other than the compiler will give you warning if you implement the class and not the family (also you can have defaults for associated type and data families). If you move <code>XList</code> out of the class, the only difference here is syntactic: <code>data XList .. where ...</code> becomes <code>data instance XList ... where ...</code> and it is moved outside of the instance declaration."}], "tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 1, "last_activity_date": 1455383829, "last_edit_date": 1455383829, "creation_date": 1455380645, "answer_id": 35382282, "question_id": 35381732, "link": "https://stackoverflow.com/questions/35381732/how-to-write-the-related-functions-for-this-ghc-type-families-example/35382282#35382282", "title": "How to write the related functions for this GHC type families example?", "body": "<p>For <code>XList Char</code> it could be:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\nimport Prelude hiding ((!!), length)\nimport qualified Prelude\n\nclass XList' a where\n    data family XList a :: *\n    fromList :: [a] -&gt; XList a\n    length   :: XList a -&gt; Int\n    (!!)     :: XList a -&gt; Int -&gt; a\n\ninstance XList' Char where\n    data XList Char = XCons !Char !(XList Char) | XNil\n\n    fromList []     = XNil\n    fromList (x:xs) = XCons x (fromList xs)\n\n    length XNil         = 0\n    length (XCons x xs) = 1 + length xs\n\n    XNil         !! _ = error \"index error!\"\n    (XCons x xs) !! 0 = x\n    (XCons x xs) !! k = xs !! (k - 1)\n</code></pre>\n\n<p>then:</p>\n\n<pre><code>\\&gt; let a = fromList \"wxyz\"\n\\&gt; :t a\na :: XList Char\n\\&gt; length a\n4\n\\&gt; a !! 2\n'y'\n</code></pre>\n\n<p>similarly for <code>XList ()</code>:</p>\n\n<pre><code>instance XList' () where\n    data XList () = XListUnit !Int\n\n    fromList a = XListUnit $ Prelude.length a\n    length (XListUnit n) = n\n\n    (XListUnit n) !! k\n        | k &lt; 0 || n &lt;= k = error \"index error!\"\n        | otherwise       = ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 0, "last_activity_date": 1455604865, "creation_date": 1455604865, "answer_id": 35425486, "question_id": 35381732, "link": "https://stackoverflow.com/questions/35381732/how-to-write-the-related-functions-for-this-ghc-type-families-example/35425486#35425486", "title": "How to write the related functions for this GHC type families example?", "body": "<p>Just a small addendum:</p>\n\n<p>You can keep <code>XList a</code> as a non-typeclass-associated type family and just add a typeclass for the <code>XList</code>-y types that hold the operations; e.g.:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\n-- Original definition from your question\ndata family XList a\ndata instance XList Char = XCons !Char !(XList Char) | XNil\ndata instance XList () = XListUnit !Int\n\n-- New class for XList-y types\nclass XListy a where\n    length :: XList a -&gt; Int\n    (!!) :: XList a -&gt; Int -&gt; a\n    fromList :: [a] -&gt; XList a\n\ninstance XListy () where\n    length (XListUnit n) = n\n    _ !! _ = ()\n    fromList xs = XListUnit $ Prelude.length xs\n</code></pre>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 35382282, "answer_count": 2, "score": 1, "last_activity_date": 1455604865, "creation_date": 1455377696, "question_id": 35381732, "link": "https://stackoverflow.com/questions/35381732/how-to-write-the-related-functions-for-this-ghc-type-families-example", "title": "How to write the related functions for this GHC type families example?", "body": "<p>At the <a href=\"https://wiki.haskell.org/GHC/Type_families\" rel=\"nofollow\">GHC/Type families</a> web page, it has half a starter example of why type families are useful.</p>\n\n<pre><code>data family XList a\ndata instance XList Char = XCons !Char !(XList Char) | XNil\ndata instance XList () = XListUnit !Int\n</code></pre>\n\n<p>Basically, it says that a list of <code>Char</code> can be represented by cons cells. A list of <code>()</code> carries no useful information except its length, so we can represent the list by its length.</p>\n\n<p>That's great. So what about the rest of the implementation of this list. How would <code>length</code> be defined, and how would <code>!!</code> or <code>fromList</code> be defined? </p>\n"}, {"tags": ["haskell", "coroutine", "type-safety"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455365953, "post_id": 35379304, "comment_id": 58464339, "body": "Turn each constructor into its own type, and use a type class with an associated data or type family."}], "answers": [{"tags": [], "owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "is_accepted": false, "score": 2, "last_activity_date": 1455375423, "last_edit_date": 1455375423, "creation_date": 1455364487, "answer_id": 35379504, "question_id": 35379304, "link": "https://stackoverflow.com/questions/35379304/improve-coroutine-request-type-safety/35379504#35379504", "title": "Improve Coroutine Request type safety", "body": "<p>Phantom types and GADTs may help you achieve more type safety here.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nimport qualified Data.Vector as V\n\ndata Important\ndata SomethingElse\n\ndata Request a where\n  GetImportantData :: Int -&gt; Request Important\n  OtherRequest :: Float -&gt; Request SomethingElse\n\ndata Response a where\n  ImportantData :: V.Vector Int -&gt; Response Important\n  OtherResponse :: Int -&gt; Response SomethingElse\n\n-- a typical use case\ncontroller :: Request Important -&gt; Response Important\ncontroller (GetImportantData n) = ImportantData $ V.singleton n\n\n-- or, more generally\ncontroller' :: Request a -&gt; Response a\ncontroller' (GetImportantData n) = ImportantData $ V.singleton n\n\n-- error: Couldn't match type 'Important' with 'SomethingElse'\nbadController :: Request a -&gt; Response a\nbadController (GetImportantData n) = OtherResponse n\n</code></pre>\n\n<p><code>Request a</code> and <code>Response a</code> are phantom types because the type parameter <code>a</code> has nothing to do with the underlying values (e.g. <code>Int</code> in <code>GetImportantData</code>) . Phantom type is widely used for ensuring type safety.</p>\n\n<p>The language extension <code>GADTs</code> permits explicit type declaration of a constructor, make it easy to distinguish between constructors of a data type.</p>\n\n<p>Instead of</p>\n\n<pre><code>data Foo = Bar | Qux\n</code></pre>\n\n<p>where <code>Bar</code> and <code>Qux</code> both have type <code>Foo</code>, with <code>GADTs</code> one can define</p>\n\n<pre><code>data Foo a where\n  Bar :: Foo Int\n  Qux :: Foo Float\n</code></pre>\n\n<p>by doing so <code>Bar</code> and <code>Qux</code> have different types.</p>\n\n<p>There are some brilliant tutorials about this topic on WikiBooks and Haskell wiki.</p>\n\n<ul>\n<li><a href=\"https://wiki.haskell.org/Phantom_type\" rel=\"nofollow\">https://wiki.haskell.org/Phantom_type</a>  </li>\n<li><a href=\"https://en.wikibooks.org/wiki/Haskell/GADT\" rel=\"nofollow\">https://en.wikibooks.org/wiki/Haskell/GADT</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 3, "last_activity_date": 1455385692, "last_edit_date": 1455385692, "creation_date": 1455377117, "answer_id": 35381640, "question_id": 35379304, "link": "https://stackoverflow.com/questions/35379304/improve-coroutine-request-type-safety/35381640#35381640", "title": "Improve Coroutine Request type safety", "body": "<p>Rather than using the monad-coroutine-provided</p>\n\n<pre><code>data Request request response x = Request request (response -&gt; x)\n</code></pre>\n\n<p>define your own suspension type</p>\n\n<pre><code>data MySuspension x\n  = GetImportantData Int (Vector Float -&gt; x)\n  | GetOtherImportantStuff Float (Int -&gt; x)\n  | ...\n  deriving (Functor)\n</code></pre>\n\n<p>Or you can use a GADT</p>\n\n<pre><code>data MyRequest r where\n  GetImportantData :: Int -&gt; MyRequest (Vector Float)\n  GetOtherImportantStuff :: Float -&gt; MyRequest Int\n  ...\n</code></pre>\n\n<p>and a corresponding suspension type involving an existential, as in the <a href=\"http://hackage.haskell.org/package/operational-0.2.3.2/docs/Control-Monad-Operational.html\" rel=\"nofollow\">operational</a> package. (monad-coroutine just provides a free monad transformer, and operational provides a slightly different kind of free monad transformer. <code>Coroutine MySuspension m r</code> is essentially the same as <code>ProgramT MyRequest m r</code>.)</p>\n"}], "owner": {"reputation": 550, "user_id": 3809223, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a86c2d7227577450956bbbe1ea6662d8?s=128&d=identicon&r=PG&f=1", "display_name": "ksaveljev", "link": "https://stackoverflow.com/users/3809223/ksaveljev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1455404789, "creation_date": 1455363084, "question_id": 35379304, "link": "https://stackoverflow.com/questions/35379304/improve-coroutine-request-type-safety", "title": "Improve Coroutine Request type safety", "body": "<p>Working with <a href=\"https://hackage.haskell.org/package/monad-coroutine\" rel=\"nofollow\">monad-coroutine</a> package I have some coroutine doing a lot of work and it needs some input from time to time:</p>\n\n<pre><code>Coroutine (Request SomeRequest SomeResponse) (State MyState) a\n</code></pre>\n\n<p>where</p>\n\n<pre><code>data SomeRequest\n  = GetImportantData Int\n  | OtherImportantStuff Float\n  | SomethingElse (Vector Int)\n  | ...\n\ndata SomeResponse\n  = ImprtantData (Vector Float)\n  | ImportantStuff Int\n  | ...\n</code></pre>\n\n<p>As you can see for each entry in <code>SomeRequest</code> I have a respective entry in <code>SomeResponse</code>.</p>\n\n<p>During the runtime of this coroutine I have something like this:</p>\n\n<pre><code>...\nImportantData info &lt;- request (GetImportantData 666)\n...\n</code></pre>\n\n<p>Now I'm afraid that this approach is not good because what I want is to make sure that whenever I request important data with <code>GetImportantData</code> the only possible response is <code>ImportantData</code> and nothing else. With my current approach I have to pattern match every single time I make a request (to make sure that the input is actually what I want).</p>\n\n<p>Any way I can improve the design/approach to make sure that for <code>GetImportantData</code> I get <code>ImportantData</code> back only, for <code>OtherImportantStuff</code> I get <code>ImportantStuff</code> only, etc ?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 7, "creation_date": 1455360753, "post_id": 35378922, "comment_id": 58462917, "body": "You may either write <code>[x,y]</code> or <code>x:y:[]</code>. They are both equivalent. The pattern <code>[x:y]</code> means &quot;match a list that contains exactly one element, which is itself a list, which contains exactly two elements named <code>x</code> and <code>y</code>&quot;, which isn&#39;t what you meant."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1455360842, "post_id": 35378922, "comment_id": 58462938, "body": "@MathematicalOrchid Oh, I see. Thank you very much!"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 9, "creation_date": 1455360955, "post_id": 35378922, "comment_id": 58462967, "body": "Actually, no, that&#39;s wrong... <code>[x:y]</code> means <code>x</code> is the first element and <code>y</code> is the remaining sublist. (Think <code>[x:xs]</code>.) Sorry about that... Either way, it&#39;s not what you meant."}, {"owner": {"reputation": 1781, "user_id": 1248563, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8105b89ccc12fd51cdf9267f8ea5704f?s=128&d=identicon&r=PG", "display_name": "cornuz", "link": "https://stackoverflow.com/users/1248563/cornuz"}, "edited": false, "score": 0, "creation_date": 1455361366, "post_id": 35378922, "comment_id": 58463063, "body": "Also, your last rule seems in contradiction with the requirement &quot;exactly 2 elements&quot;. I would suggest to match what you need first (<code>[x,_]</code>), then match anything else with a catch-all pattern (<code>_</code>) as an error."}], "answers": [{"tags": [], "owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "is_accepted": true, "score": 22, "last_activity_date": 1455363742, "creation_date": 1455363742, "answer_id": 35379402, "question_id": 35378922, "link": "https://stackoverflow.com/questions/35378922/pattern-match-list-with-exactly-2-elements-in-haskell/35379402#35379402", "title": "Pattern match list with exactly 2 elements in Haskell", "body": "<pre><code>myButLast :: [a] -&gt; a\nmyButLast [] = error \"empty list\"\nmyButLast [x] = error \"too few elements\"\nmyButLast [x, _] = x\nmyButLast (x: xs) = myButLast xs\n</code></pre>\n\n<p>This is the second quesion in <a href=\"https://wiki.haskell.org/99_questions/1_to_10\" rel=\"noreferrer\">99 questions</a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4424299"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17324, "favorite_count": 1, "accepted_answer_id": 35379402, "answer_count": 1, "score": 14, "last_activity_date": 1455363742, "creation_date": 1455360471, "question_id": 35378922, "link": "https://stackoverflow.com/questions/35378922/pattern-match-list-with-exactly-2-elements-in-haskell", "title": "Pattern match list with exactly 2 elements in Haskell", "body": "<p>I just started learning Haskell and I'm trying to use pattern matching to match a list that has exactly 2 elements. As an exercise, I'm trying to write a function which returns the one but last element from a list. So far I found this:</p>\n\n<pre><code>myButLast :: [a] -&gt; a\nmyButLast [] = error \"Cannot take one but last from empty list!\"\nmyButLast [x] = error \"Cannot take one but last from list with only one element!\"\nmyButLast [x:y] = x\nmyButLast (x:xs) = myButLast xs\n</code></pre>\n\n<p>Now the line with myButLast [x:y] is clearly incorrect, but I don't know how to match a list that has exactly 2 elements, as that is what I'm trying to do there. I read this (<a href=\"http://learnyouahaskell.com/syntax-in-functions#pattern-matching\" rel=\"noreferrer\">http://learnyouahaskell.com/syntax-in-functions#pattern-matching</a>) page and it helped me a lot, but I'm not completely there yet...</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "is_accepted": false, "score": 1, "last_activity_date": 1455348514, "creation_date": 1455348514, "answer_id": 35377303, "question_id": 35377205, "link": "https://stackoverflow.com/questions/35377205/haskell-cabal-update-wont-work-local-and-remote-files-match/35377303#35377303", "title": "Haskell Cabal update won&#39;t work - &quot;Local and remote files match&quot;", "body": "<p>Self answer:</p>\n\n<p>They apparently update their package list every 5 minutes or so - you can't make it any faster</p>\n"}], "owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1455348514, "creation_date": 1455347834, "question_id": 35377205, "link": "https://stackoverflow.com/questions/35377205/haskell-cabal-update-wont-work-local-and-remote-files-match", "title": "Haskell Cabal update won&#39;t work - &quot;Local and remote files match&quot;", "body": "<p>I did \"cabal update\", bumped the version number on my project, and then did \"cabal update\" again...</p>\n\n<pre><code>&gt;cabal update\nDownloading the latest package list from hackage.haskell.org\nSkipping download: Local and remote files match.\n</code></pre>\n\n<p>^ The cabal respository changed but the update won't appear without a ~5 minutes delay.</p>\n\n<pre><code>&gt;cabal --version\ncabal-install version 1.22.6.0\nusing version 1.22.5.0 of the Cabal library\n\n&gt;ghci --version\nThe Glorious Glasgow Haskell Compilation System, version 7.10.3\n\n&gt;ver\nMicrosoft Windows [Version 10.0.10586]\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455333920, "post_id": 35375143, "comment_id": 58457209, "body": "You mention &quot;compilation&quot; several times but you also say you are using ghci. Are you compiling or interpreting? It makes a big difference. Compiling with <code>-O0</code> is not the same as interpreting, and if you are interpreting, then the <code>-O</code> switch does nothing anyways. What is your compilation time from scratch, i.e. how does it compare to the 3 minutes? If you make a change at the module at the top of the hierarchy, then it will recompile every single module - in general it couldn&#39;t tell whether it has to or not."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455334111, "post_id": 35375143, "comment_id": 58457260, "body": "Also, TH does indeed cause massive slowdowns past a few hundred lines of generated code or so. There is no way around it, other than to improve the implementation of TH. You can sometimes speed up TH by reducing the number of splices (i.e. moving multiple splices into a single splice). If you are working on a module with a lot of TH, but not changing that TH code, consider moving the TH to a separate module."}, {"owner": {"reputation": 141, "user_id": 4960278, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh5.googleusercontent.com/-rhXMnM2laZQ/AAAAAAAAAAI/AAAAAAAAAZM/zTJL6P6VbSE/photo.jpg?sz=128", "display_name": "Timothy Chu", "link": "https://stackoverflow.com/users/4960278/timothy-chu"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455335613, "post_id": 35375143, "comment_id": 58457555, "body": "well, I sometimes compile (stack install), sometimes I use stack ghci and its set up to autoload my entire project. They both take about the same time. My bad for conflating the two."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455335967, "post_id": 35375143, "comment_id": 58457611, "body": "It&#39;s very surprising &amp; unexpected that a compile and interpret take the same amount of time! I am not familiar with stack, so I don&#39;t know what commands it actually runs when you do <code>stack install</code> as compared to <code>stack ghci</code>. If you could discover this it may be helpful. Have you tried it just with <code>cabal</code> - i.e. <code>cabal build</code> vs. <code>cabal repl</code>? If these two differ significantly, then you know stack is doing something funnny. If they do not, then something weird is up with your proj (perhaps compile time is mainly dominated by TH or large type reductions? Can you give details of the proj?)"}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1455349981, "post_id": 35375143, "comment_id": 58460271, "body": "Stack is written in Haskell, you can profile it with RTS options like any other Haskell programs."}, {"owner": {"reputation": 141, "user_id": 4960278, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh5.googleusercontent.com/-rhXMnM2laZQ/AAAAAAAAAAI/AAAAAAAAAZM/zTJL6P6VbSE/photo.jpg?sz=128", "display_name": "Timothy Chu", "link": "https://stackoverflow.com/users/4960278/timothy-chu"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455391147, "post_id": 35375143, "comment_id": 58472948, "body": "@user2407038 : For some reason, stack ghci tells me it&#39;s compiling my project, instead of just interpreting it. So I suppose it is not interpreting that is taking a while, but that stack ghci is actually compiling my project (not sure why). Compile time is dominated by my Type files, some of which have a lot of TH and some of which don&#39;t.   @ zakygapps. This sounds like an answer that&#39;s great for someone who&#39;s an expert at Stack, but as someone who without context about stack&#39;s internals it is not helpful. What concrete steps would I take in order to profile compilation time of my program?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455420459, "post_id": 35375143, "comment_id": 58480349, "body": "@TimothyChu If stack is compiling your project, then launching GHCI with the compiled project in scope of the interpreter, then you aren&#39;t interpreting your project, you are compiling it. You will <i>never</i> have any compilation time reduction with this method. Profiling anything won&#39;t help here. Again, I don&#39;t know much about stack, but you must get it to launch the project itself in the interpreter. Or, <code>cabal repl</code> will probably work, if the GHC provided by stack is in the PATH (if not place it there temporarily or permanently)."}, {"owner": {"reputation": 141, "user_id": 4960278, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh5.googleusercontent.com/-rhXMnM2laZQ/AAAAAAAAAAI/AAAAAAAAAZM/zTJL6P6VbSE/photo.jpg?sz=128", "display_name": "Timothy Chu", "link": "https://stackoverflow.com/users/4960278/timothy-chu"}, "edited": false, "score": 0, "creation_date": 1455566845, "post_id": 35375143, "comment_id": 58536952, "body": "Got it. I ended up solving this problem by using stack install --fast. Doesn&#39;t tell me why compilation times are long, but it does make my build times tolerable. Can you explain what you mean when you say &#39;launching GHCI with the compiled project in scope of the interpreter?"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 1, "creation_date": 1457061048, "post_id": 35375143, "comment_id": 59245572, "body": "@TimothyChu if you found the solution to your question, you should post it as an answer so this question doesn&#39;t remain unanswered..."}, {"owner": {"reputation": 141, "user_id": 4960278, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh5.googleusercontent.com/-rhXMnM2laZQ/AAAAAAAAAAI/AAAAAAAAAZM/zTJL6P6VbSE/photo.jpg?sz=128", "display_name": "Timothy Chu", "link": "https://stackoverflow.com/users/4960278/timothy-chu"}, "edited": false, "score": 0, "creation_date": 1467606449, "post_id": 35375143, "comment_id": 63781007, "body": "I have not! But thank you for the reminder."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1479924922, "post_id": 35375143, "comment_id": 68767017, "body": "Depending on the module graph of the package, I sometimes see handy speedups when I add <code>--ghc-options -j3</code> to <code>stack build</code>."}], "answers": [{"tags": [], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "is_accepted": false, "score": 2, "last_activity_date": 1511929700, "creation_date": 1511929700, "answer_id": 47545048, "question_id": 35375143, "link": "https://stackoverflow.com/questions/35375143/haskell-debugging-long-compilation-times-on-stack-projects/47545048#47545048", "title": "Haskell: Debugging Long Compilation Times on Stack Projects", "body": "<p>In case this question is still relevant, you could try this:</p>\n\n<pre><code>stack ghci --fast --no-build --ghc-options=\"-fbyte-code\"\n</code></pre>\n\n<p>IIRC using this got me the quickest results with <code>stack ghci</code>.</p>\n\n<p>If this doesn't help enough, you could look in the direction of <code>--ghc-options=\"-dshow-passes\"</code>. I myself am also looking in this direction currently to try to speed up a build/ghci-reload.</p>\n"}], "owner": {"reputation": 141, "user_id": 4960278, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh5.googleusercontent.com/-rhXMnM2laZQ/AAAAAAAAAAI/AAAAAAAAAZM/zTJL6P6VbSE/photo.jpg?sz=128", "display_name": "Timothy Chu", "link": "https://stackoverflow.com/users/4960278/timothy-chu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 650, "favorite_count": 2, "answer_count": 1, "score": 7, "last_activity_date": 1511929700, "creation_date": 1455328142, "last_edit_date": 1495541231, "question_id": 35375143, "link": "https://stackoverflow.com/questions/35375143/haskell-debugging-long-compilation-times-on-stack-projects", "title": "Haskell: Debugging Long Compilation Times on Stack Projects", "body": "<p>I'm currently using Stack to build a project, which totals about 80 modules and 13,000 lines of code. Currently, compilation takes about 3 minutes for a minor change in my types files, which is unacceptable -- it prevents me from rapidly testing my code via stack ghci. It also significantly slows down a number of things: for instance, pair programming with peers or consulting with experts.</p>\n\n<p>I would like to be able to figure out why compilation is taking so long, and what I can do to speed it up.  Is there some way to profile compilation times?</p>\n\n<p>Additionally, how can I tell whether it is stack or ghc that is slow?</p>\n\n<p>I know about setting -O0, though this does not seem to help compilation times. I also know that TemplateHaskell and Typeclass Resolution  can take a while -- is there any way I can get better resolution on how long these are taking?</p>\n\n<p>Note: i have seen <a href=\"https://stackoverflow.com/questions/15662984/speed-up-compilation-in-ghc/15665851\">Speed up compilation in GHC</a>, but that was from 2013, and hdevtools currently does not work on my setup.</p>\n"}, {"tags": ["debugging", "haskell", "hackage"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455330689, "post_id": 35375051, "comment_id": 58456533, "body": "Well, if you <i>just</i> uploaded that package, you&#39;ll have to do <code>cabal update</code> to get it to see it. After doing a <code>cabal update</code> I can see your package, however it doesn&#39;t build (due to a missing source file). Perhaps you have placed something in the wrong directory?"}, {"owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455337627, "post_id": 35375051, "comment_id": 58457929, "body": "@user2407038 - I did do &quot;cabal update&quot;. I think my install of build-essentials from the Ubuntu 14.04 software repo is complete crap and I need to get rid of it and install something else."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455341407, "post_id": 35375051, "comment_id": 58458556, "body": "Then run <code>cabal install print-debugger -v3</code> and see where exactly it fails."}, {"owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455341448, "post_id": 35375051, "comment_id": 58458564, "body": "@user2407038 - Can you try this out for me: <a href=\"https://hackage.haskell.org/package/print-debugger\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/print-debugger</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455342535, "post_id": 35375051, "comment_id": 58458797, "body": "Can&#39;t do it as you have listed <code>base &lt;4.8.2.0</code> as a dependency and I don&#39;t have such an old compiler any more."}, {"owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455345097, "post_id": 35375051, "comment_id": 58459354, "body": "@user2407038 I don&#39;t understand. &quot;base &lt; 4.8.2.0&quot; means that you can use any base that is less than 4.8.2.0 (the version of base that I am currently using). Do you want me to change it to &quot;base =&lt; 4.8.2.0&quot;? I don&#39;t understand. Also, how/where do you specify the compiler? This project requires GHC 7.10.1 (or greater) because of the stack trace."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455349238, "post_id": 35375051, "comment_id": 58460104, "body": "Sorry I may have misspoke. I have base-4.8.2.0, so <code>base&lt;4.8.2.0</code> will not work for me but <code>base&lt;=4.8.2.0</code> will. However, you probably want to specify a <i>lower</i> bound, not an upper one, for the first version which had stack traces. You can&#39;t specify the version of the compiler, but the version of the <code>base</code> library is completely tied to the compiler version."}], "answers": [{"comments": [{"owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "edited": false, "score": 0, "creation_date": 1455341422, "post_id": 35376192, "comment_id": 58458558, "body": "^ Can you try this out for me:  <a href=\"https://hackage.haskell.org/package/print-debugger\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/print-debugger</a>"}, {"owner": {"reputation": 1620, "user_id": 643684, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/sGlFM.jpg?s=128&g=1", "display_name": "Colin Woodbury", "link": "https://stackoverflow.com/users/643684/colin-woodbury"}, "reply_to_user": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "edited": false, "score": 0, "creation_date": 1455396545, "post_id": 35376192, "comment_id": 58474784, "body": "I should have been clearer. <code>stack</code> uses <a href=\"https://www.stackage.org\" rel=\"nofollow noreferrer\">stackage.org</a>. Unless your package has been uploaded to stackage, you would need to add it to the <code>extra-deps</code> field in your <code>stack.yaml</code> config file for the project that uses it. Then it pulls it from hackage instead."}], "tags": [], "owner": {"reputation": 1620, "user_id": 643684, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/sGlFM.jpg?s=128&g=1", "display_name": "Colin Woodbury", "link": "https://stackoverflow.com/users/643684/colin-woodbury"}, "is_accepted": false, "score": -1, "last_activity_date": 1455338857, "creation_date": 1455338857, "answer_id": 35376192, "question_id": 35375051, "link": "https://stackoverflow.com/questions/35375051/haskell-how-to-get-code-from-hackage-into-project-cabal-install-project-failed/35376192#35376192", "title": "Haskell how to get code from Hackage into project? Cabal install project failed", "body": "<p>If you have problems with <code>cabal</code>, you might consider trying <a href=\"http://docs.haskellstack.org/en/stable/README.html\" rel=\"nofollow\">stack</a> in the future. It's very helpful for coordinating dependencies between projects.</p>\n"}, {"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1456168868, "creation_date": 1456168868, "answer_id": 35562055, "question_id": 35375051, "link": "https://stackoverflow.com/questions/35375051/haskell-how-to-get-code-from-hackage-into-project-cabal-install-project-failed/35562055#35562055", "title": "Haskell how to get code from Hackage into project? Cabal install project failed", "body": "<p>It appears as though version 0.0 failed to install due to missing files (see: <a href=\"https://hackage.haskell.org/package/print-debugger-0.0/reports/1\" rel=\"nofollow\">https://hackage.haskell.org/package/print-debugger-0.0/reports/1</a>) but that later versions have fixed this issue and now things should work smoothly.</p>\n"}], "owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1456168868, "creation_date": 1455327379, "last_edit_date": 1455327695, "question_id": 35375051, "link": "https://stackoverflow.com/questions/35375051/haskell-how-to-get-code-from-hackage-into-project-cabal-install-project-failed", "title": "Haskell how to get code from Hackage into project? Cabal install project failed", "body": "<p>I created <a href=\"https://hackage.haskell.org/package/print-debugger\" rel=\"nofollow\">a project in hackage</a> that I want to import into my code.</p>\n\n<p>Rather than manually copy-pasting the code from \"<a href=\"https://hackage.haskell.org/package/print-debugger-0.0/src/\" rel=\"nofollow\">print-debugger-0.0.tar.gz</a>\" into the src folder of my cabal project, I want to be able to do this...</p>\n\n<p>// project.cabal file</p>\n\n<pre><code>name:              project\n...\nexecutable project\n  main-is:         Main.hs\n  hs-source-dirs:  src\n  build-depends:   base, split, print-debugger\n</code></pre>\n\n<p>And do this...</p>\n\n<pre><code>cabal install print-debugger\n</code></pre>\n\n<p>And import \"StackTraceDebug\" into my project.</p>\n\n<p>When I try I get messages...</p>\n\n<pre><code>\"this package is not installed\"\n\"cabal: There is no package named 'print-debugger'\"\n</code></pre>\n\n<p><strong>How do I get my code out of hackage and into my project without manually copying and pasting?</strong></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1455325604, "post_id": 35374643, "comment_id": 58455511, "body": "Your intuition is quite good, but it is more like <code>($ 3) (4 +)</code>. Then maybe <code>($) :: (a -&gt; b) -&gt; a -&gt; b</code> will help you to understand."}], "answers": [{"tags": [], "owner": {"reputation": 1356, "user_id": 3760021, "user_type": "registered", "accept_rate": 17, "profile_image": "https://graph.facebook.com/1168165975/picture?type=large", "display_name": "RafaelCaballero", "link": "https://stackoverflow.com/users/3760021/rafaelcaballero"}, "is_accepted": false, "score": 1, "last_activity_date": 1455324943, "creation_date": 1455324943, "answer_id": 35374744, "question_id": 35374643, "link": "https://stackoverflow.com/questions/35374643/how-is-used-in-higher-order-functions/35374744#35374744", "title": "How is $ used in higher order functions ?", "body": "<p>The operator $ calls the function which is its left hand argument on the value which is its right hand argument. In the use of the example it \"puts\" the value 3 as additional argument of the sections in the list </p>\n\n<p>Thus <code>($ 3) (4+)</code> is  <code>(4+3)</code>. Analogously <code>($ 2) (4/)</code> is  <code>(4/2)</code></p>\n\n<p>The use of sections is easier to grasp using normal arithmetic operations. For instance: <code>(/2) 4</code> is the same as <code>4/2</code> and thus 2</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1455325434, "last_edit_date": 1455325434, "creation_date": 1455325028, "answer_id": 35374758, "question_id": 35374643, "link": "https://stackoverflow.com/questions/35374643/how-is-used-in-higher-order-functions/35374758#35374758", "title": "How is $ used in higher order functions ?", "body": "<blockquote>\n  <p>how is this of meaning :</p>\n\n<pre><code>$3 4+\n</code></pre>\n</blockquote>\n\n<p>That's not actually of meaning, indeed. But that's not what it simplifies to! It simplifies to</p>\n\n<pre><code>($3) (4+)\n</code></pre>\n\n<p>These things are <em>operator sections</em>.</p>\n\n<pre><code>($ 3) \u2261 \\x -&gt; x $ 3\n(4+)  \u2261 \\x -&gt; 4 + x\n(10*) \u2261 \\x -&gt; 10*x\n(^2)  \u2261 \\x -&gt; x^2\n</code></pre>\n\n<p>so</p>\n\n<pre><code>($3) (4+) \u2261 (\\f -&gt; f $ 3) (\\y -&gt; 4 + y)\n          \u2261 (\\y -&gt; 4 + y) $ 3 \n          \u2261 (\\y -&gt; 4 + y) 3\n          \u2261 4 + 3\n</code></pre>\n\n<p>Perhaps it's easier to understand if you visualise the &ldquo;holes&rdquo;:</p>\n\n<pre><code>map (\u25a1 $ 3) [(4+\u25a1), (10*\u25a1), (\u25a1^2), sqrt \u25a1]\n\u2261 [(4+\u25a1) $ 3, (10*\u25a1) $ 3, (\u25a1^2) $ 3, (sqrt \u25a1) $ 3]\n\u2261 [(4+3), (10*3), (3^2), (sqrt 3)]\n</code></pre>\n"}], "owner": {"reputation": 3684, "user_id": 4224575, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/Nvq43.gif?s=128&g=1", "display_name": "Lorah Attkins", "link": "https://stackoverflow.com/users/4224575/lorah-attkins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "closed_date": 1455326133, "accepted_answer_id": 35374758, "answer_count": 2, "score": 1, "last_activity_date": 1455325434, "creation_date": 1455324244, "question_id": 35374643, "link": "https://stackoverflow.com/questions/35374643/how-is-used-in-higher-order-functions", "closed_reason": "Duplicate", "title": "How is $ used in higher order functions ?", "body": "<p>This concerns an example encountered in <a href=\"http://learnyouahaskell.com/higher-order-functions#function-application\" rel=\"nofollow\">Learn you a Haskell for Great Good</a>, namely this one : </p>\n\n<pre><code>ghci&gt; map ($ 3) [(4+), (10*), (^2), sqrt]  \n</code></pre>\n\n<p>I'm trying to understand it but it makes no sense to me. Of course, the list of functions will be applied to the input (number 3) but I don't see how the <code>$</code> operator helps. I'm trying to trace the order of application of things (if there's a haskell IDE with a step through compiler please let me know) and can't understand how <code>$</code> being right associative allows flipping the function application, ie when I see <code>map</code> like this</p>\n\n<pre><code>map fun [1, 2 .. n]\n</code></pre>\n\n<p>I imagine the following happening to form the output list</p>\n\n<pre><code>fun 1\nfun 2\n.\n.\nfun n\n</code></pre>\n\n<p>but for the example at hand, how is this of meaning : </p>\n\n<pre><code>$3 4+\n</code></pre>\n"}, {"tags": ["haskell", "monads", "writer-monad"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455323268, "post_id": 35373694, "comment_id": 58454928, "body": "I think it is somewhat unclear what you&#39;re asking. &quot;I am little unsure what is the best way to implement this.&quot; - what is wrong with the current implementation? If you explain which parts of your current implementation are unsatisfactory, then the question becomes much, much clearer. If the solution is completely satisfactory, then I can&#39;t imagine there would even be a question..."}, {"owner": {"reputation": 1286, "user_id": 675799, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/87c5d0a7b707c5bfc04b415e96edef11?s=128&d=identicon&r=PG", "display_name": "krokodil", "link": "https://stackoverflow.com/users/675799/krokodil"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455325469, "post_id": 35373694, "comment_id": 58455472, "body": "I have clarified some of my questions."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1455325770, "post_id": 35373694, "comment_id": 58455554, "body": "I would use the <code>wbplus</code> formulation - it naturally fits better since <code>+</code> is morally a binary operator. You don&#39;t need to use <code>foldM</code> - <code>foldr wbplus :: WInt -&gt; [WInt] -&gt; WInt</code>. And you would probably &quot;represent&quot; a list as <code>[WInt]</code> because you can convert that to <code>Writer Any [Int]</code> but not the other way around (<code>sequence :: [Writer Any Int] -&gt; Writer Any [Int]</code>)"}], "answers": [{"tags": [], "owner": {"reputation": 589, "user_id": 1486400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b6c720fd6b86fdf2293eefb5188d46b?s=128&d=identicon&r=PG", "display_name": "int_index", "link": "https://stackoverflow.com/users/1486400/int-index"}, "is_accepted": true, "score": 1, "last_activity_date": 1458737896, "creation_date": 1458737896, "answer_id": 36178869, "question_id": 35373694, "link": "https://stackoverflow.com/questions/35373694/haskell-write-monad-for-expressions/36178869#36178869", "title": "Haskell Write Monad for expressions", "body": "<p>You can derive <code>bplus</code> from <code>wbplus</code> and vice versa using the appropriate monadic operations:</p>\n\n<pre><code>import Control.Monad\n\napM2 :: Monad m =&gt; (a -&gt; b -&gt; m c) -&gt; m a -&gt; m b -&gt; m c\napM2 f ma mb = do\n  a &lt;- ma\n  b &lt;- mb\n  f a b\n\npureM2 :: Monad m =&gt; (m a -&gt; m b -&gt; m c) -&gt; a -&gt; b -&gt; m c\npureM2 f a b = f (return a) (return b)\n</code></pre>\n\n<p>They are inverses of each other, evident from the type signatures of their compositions:</p>\n\n<pre><code>ghci&gt; :t pureM2 . apM2\npureM2 . apM2 :: Monad m =&gt; (a -&gt; b -&gt; m c) -&gt; a -&gt; b -&gt; m c\n\nghci&gt; :t apM2 . pureM2\napM2 . pureM2 :: Monad m =&gt; (m a -&gt; m b -&gt; m c) -&gt; m a -&gt; m b -&gt; m c\n</code></pre>\n\n<p>Now you can define <code>wbplus = apM2 bplus</code> or <code>bplus = pureM2 wbplus</code>. There's no definite answer which one is better, use your taste and judgement. TemplateHaskell goes with the <code>wbplus</code> approach and defines all operations to work with values in the <code>Q</code> monad. See <a href=\"http://haddock.stackage.org/lts-5.9/template-haskell-2.10.0.0/Language-Haskell-TH-Lib.html\" rel=\"nofollow\">Language.Haskell.TH.Lib</a>.</p>\n\n<p>Regarding <code>[m a]</code> vs <code>m [a]</code>, you can only go in one direction (via <code>sequence :: Monad m =&gt; [m a] -&gt; m [a]</code>). Would you ever want to go in the opposite direction? Do you care about individual values having their own flags or would you rather annotate the computation as a whole with flags?</p>\n\n<p>The real question is, what is your mental model for this? However, let's think about some consequences of each design choice.</p>\n\n<ol>\n<li><p>If you choose to represent each value as <code>Writer Any a</code> and have all operations work with it, you can start with a <code>newtype</code>:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nimport Control.Monad.Writer\n\nnewtype Value a = Value (Writer Any a)\n  deriving (Functor, Applicative, Monad)\n</code></pre>\n\n<p>Now you can define instances of standard type classes for your\nvalues:</p>\n\n<pre><code>instance (Num a, Eq a) =&gt; Num (Value a) where\n  va + vb = do\n    a &lt;- va\n    b &lt;- vb\n    (Value . tell . Any) (b == 0 || a == 0)\n    return (a + b)\n  (*) = liftM2 (*)\n  abs = fmap abs\n  signum = fmap signum\n  negate = fmap negate\n  fromInteger = return . fromInteger\n\n  instance Monoid a =&gt; Monoid (Value a) where\n    mempty = pure mempty\n    mappend = liftM2 mappend\n</code></pre>\n\n<p>For an EDSL this gives a huge advantage: terseness and syntactic support from the compiler. You can now write <code>getValue (42 + 0)</code> instead of <code>wbplus (pure 42) (pure 0)</code>.</p></li>\n<li><p>If, instead, you don't think about flags as a part of your values and rather see them as an external effect, it's better to go with the alternative approach. But rather than write something like <code>Writer Any [Int]</code>, use corresponding classes from <code>mtl</code>: <code>MonadWriter Any m =&gt; m [Int]</code>.\nThis way, if you later find out that you need to use other effects, you can easily add them to some (but not all) operations. For example, you might want to raise an error in case of division by zero:</p>\n\n<pre><code>  data DivisionByZero = DivisionByZero\n\n  divZ :: (MonadError DivisionByZero m, Fractional a, Eq a) =&gt; a -&gt; a -&gt; m a\n  divZ a b\n    | b == 0 = throwError DivisionByZero\n    | otherwise = pure (a / b)\n\n  plusF :: (MonadWriter Any m, Num a, Eq a) =&gt; a -&gt; a -&gt; m a\n  plusF a b = do\n    tell (Any (b == 0 || a == 0))\n    return (a + b)\n</code></pre>\n\n<p>Now you can use <code>plusF</code> and <code>divZ</code> together within one monad, although they have different effects. If you'll later find yourself in need to integrate with some external library, this flexibility will come in handy.</p></li>\n</ol>\n\n<p>Now, I didn't give it too much thought, but perhaps you could combine those approaches using something like <code>newtype Value m a = Value { getValue :: m a }</code>. Good luck exploring the design space :)</p>\n"}], "owner": {"reputation": 1286, "user_id": 675799, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/87c5d0a7b707c5bfc04b415e96edef11?s=128&d=identicon&r=PG", "display_name": "krokodil", "link": "https://stackoverflow.com/users/675799/krokodil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 36178869, "answer_count": 1, "score": 1, "last_activity_date": 1458737896, "creation_date": 1455318134, "last_edit_date": 1455325454, "question_id": 35373694, "link": "https://stackoverflow.com/questions/35373694/haskell-write-monad-for-expressions", "title": "Haskell Write Monad for expressions", "body": "<p>I am trying to design embedded language, where operations can raise certain flags depending on values. I foresee operation on scalar values as well as on vectors (e.g. map, fold, etc.) My idea is to use Writer Monad to keep track of flags. Simplified example, where actual type is \"Int\" and flag is raised if any of argument is 0.</p>\n\n<pre><code>import Control.Monad.Identity\nimport Control.Monad.Writer\nimport Data.Monoid    \n\ntype WInt = Writer Any Int\n\nbplus :: Int -&gt; Int -&gt; WInt\nbplus a b =\n    do\n      tell (Any (a == 0 || b == 0)) ;\n           return (a+b)\n\nwbplus :: WInt -&gt; WInt -&gt; WInt\nwbplus wa wb =\n    do\n      a &lt;- wa ;\n      b &lt;- wb ;\n      tell (Any (a == 0 || b == 0)) ;\n           return (a+b)\n\nex0 = runWriter (bplus 1 2) \nex1 = runWriter (bplus 0 2)\n\nex2 = runWriter (wbplus (return 1) (return 2))\nex3 = runWriter (wbplus (return 0) (return 2))\n\nex4 = runWriter (wbplus (wbplus (return 1) (return 2)) (return 2))\nex5 = runWriter (wbplus (wbplus (return 0) (return 2)) (return 2))\nex6 = runWriter (wbplus (wbplus (return 1) (return 2)) (return 0))\n</code></pre>\n\n<p>I am little unsure what is the best way to implement this. Some questions:</p>\n\n<ol>\n<li><p>Should I define all operations like I did for <code>bplus</code> or like for <code>wbplus</code>. Laters makes composition easier, it seems. But to use <code>foldM</code> binary operator should have type <code>Int -&gt; Int -&gt; WInt</code>.</p></li>\n<li><p>What would be the appropriate type for lists: <code>Writer Any [Int]</code> or <code>[Wint]</code>?</p></li>\n</ol>\n\n<p>Any suggestions or thoughts are appreciated.</p>\n"}, {"tags": ["haskell", "interactive", "gloss"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1455485827, "post_id": 35371840, "comment_id": 58498875, "body": "For me, on OS-X the shift+tab combination is coming through as <code>EventKey (Char &#39;\\EM&#39;) Down (Modifiers {shift = Down, ctrl = Up, alt = Up})</code>.  And since <code>SpecialKey KeyTab &#47;= Char &#39;\\EM&#39;</code> we have a problem.  I&#39;m not sure where the bug sits, this might be very much a platform specific issue.  You could just roll with it and treat <code>(Char &#39;\\EM&#39;)</code> the same as tab."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1455798738, "post_id": 35371840, "comment_id": 58656501, "body": "The event is not even received by the application in my case! It&#39;s a weird one. I really don&#39;t get it given that these shortcuts are already used by other programs (eg. chrome)."}], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1455309770, "creation_date": 1455309770, "question_id": 35371840, "link": "https://stackoverflow.com/questions/35371840/react-to-shifttab-in-gloss", "title": "React to Shift+Tab in Gloss", "body": "<p>I am currently writing a game using <code>gloss</code>' <a href=\"https://hackage.haskell.org/package/gloss-1.9.4.1/docs/Graphics-Gloss.html#v:play\" rel=\"nofollow\"><code>play</code></a>. The basic structure of this game is very simple: I have a board with units on it, one of which is in focus.</p>\n\n<p>I have added the ability to change the focus by cycling through the units on the board using <code>KeyTab</code>. Quite quickly, I realised that I wanted to also be able to cycle back so I thought I'd use <code>Shift + KeyTab</code> to do so as is customary in this situation.</p>\n\n<p><code>gloss</code>' <a href=\"https://hackage.haskell.org/package/gloss-1.9.4.1/docs/Graphics-Gloss-Interface-IO-Game.html#t:Event\" rel=\"nofollow\"><code>Event</code>s</a> come with <a href=\"https://hackage.haskell.org/package/gloss-1.9.4.1/docs/Graphics-Gloss-Interface-IO-Game.html#t:Modifiers\" rel=\"nofollow\"><code>Modifiers</code></a>, one of which is <code>shift</code>. Perfect? Well... not quite: whenever I press <code>Shift + KeyTab</code>, the event is never received by the window (I used <code>Debug.Trace</code>'s <code>trace</code> to print all the received <code>Event</code>s).</p>\n\n<p>With CAPS LOCK, I do receive <code>KeyTab</code> with the <code>shift</code> modifier marked as <code>Down</code>. If I switch to using <code>Ctrl + KeyTab</code> as my shortcut, it works perfectly well. Here is a minimal example reproducing the problem:</p>\n\n<pre><code>module Main where\n\nimport Graphics.Gloss\nimport Graphics.Gloss.Interface.Pure.Game\n\ndata Board = Board Color Color Color\n\nforward :: Board -&gt; Board\nforward (Board x y z) = Board y z x\n\nbackward :: Board -&gt; Board\nbackward (Board x y z) = Board z x y\n\ndisplayPoint :: Point -&gt; Color -&gt; Picture\ndisplayPoint (x, y) c = translate x y $ color c $ circle 10\n\ndisplayBoard :: Board -&gt; Picture\ndisplayBoard (Board x y z) =\n  Pictures $ zipWith displayPoint coordinates [x, y, z]\n  where coordinates = [(0, 30), (-30, -30), (30, -30)]\n\nreact :: Event -&gt; Board -&gt; Board\nreact (EventKey (SpecialKey KeyTab) Down mods _) b =\n  case shift mods of\n    Up   -&gt; forward b\n    Down -&gt; backward b\nreact _ b = b\n\nmain :: IO ()\nmain =\n  let window = InWindow \"Buggy\" (100, 100) (200, 200)\n      board  = Board blue red yellow\n  in play window black 24 board displayBoard react (const id)\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1455300643, "post_id": 35369000, "comment_id": 58444788, "body": "can you give us some more information about the running application - say a <code>ghc-pkg list</code> or a <code>cabal sandbox hc-pkg list</code>, another option is to use stack (<a href=\"http://docs.haskellstack.org/en/stable/README.html\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/README.html</a>)"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1455300673, "post_id": 35369000, "comment_id": 58444805, "body": "also in the older application which cabal/ghc versions do you use"}, {"owner": {"reputation": 222, "user_id": 3438721, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/hc759.jpg?s=128&g=1", "display_name": "dacDave", "link": "https://stackoverflow.com/users/3438721/dacdave"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1455304387, "post_id": 35369000, "comment_id": 58446844, "body": "The last time that this built successfully I was running a 2014 Haskell platform. I no longer have the exact version, as I had to uninstall it before I could install the new version."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1455304611, "post_id": 35369000, "comment_id": 58446974, "body": "do you have time to chat?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 222, "user_id": 3438721, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/hc759.jpg?s=128&g=1", "display_name": "dacDave", "link": "https://stackoverflow.com/users/3438721/dacdave"}, "edited": false, "score": 0, "creation_date": 1455304804, "post_id": 35369000, "comment_id": 58447086, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/103332/discussion-between-epsilonhalbe-and-dacdave\">continue this discussion in chat</a>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1455314509, "post_id": 35369000, "comment_id": 58451726, "body": "Please, in the future, don&#39;t paste such long output samples (or indeed any information relevant to answer) in comments. Edit it into your question instead."}, {"owner": {"reputation": 222, "user_id": 3438721, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/hc759.jpg?s=128&g=1", "display_name": "dacDave", "link": "https://stackoverflow.com/users/3438721/dacdave"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1455421258, "post_id": 35369000, "comment_id": 58480472, "body": "@epsilonhalbe, Can we pick a time for a chat. I will make myself available on your schedule."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1455493221, "post_id": 35369000, "comment_id": 58501109, "body": "we can talk feb 15 - 22:00 gmt+1 ?"}, {"owner": {"reputation": 222, "user_id": 3438721, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/hc759.jpg?s=128&g=1", "display_name": "dacDave", "link": "https://stackoverflow.com/users/3438721/dacdave"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1455507977, "post_id": 35369000, "comment_id": 58504279, "body": "@epsilonhalbe, As I understand you are in Austria (GMT+1) and I am in EST (GMT-5). If this is correct, your 22:00 (10 PM) is my 16:00 (4 PM). I will be here at that time. Thank you for this offer."}, {"owner": {"reputation": 222, "user_id": 3438721, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/hc759.jpg?s=128&g=1", "display_name": "dacDave", "link": "https://stackoverflow.com/users/3438721/dacdave"}, "edited": false, "score": 0, "creation_date": 1455569063, "post_id": 35369000, "comment_id": 58538069, "body": "I tried adding the LANGUAGE pragma Haskell98 to see if this might be something that changed in recent Haskell. I think the last time I built this program with the 2014 Haskell platform we were already beyond the Haskell 98 changes, but I tried it anyway. No change."}], "answers": [{"tags": [], "owner": {"reputation": 222, "user_id": 3438721, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/hc759.jpg?s=128&g=1", "display_name": "dacDave", "link": "https://stackoverflow.com/users/3438721/dacdave"}, "is_accepted": false, "score": 1, "last_activity_date": 1455928910, "creation_date": 1455928910, "answer_id": 35517641, "question_id": 35369000, "link": "https://stackoverflow.com/questions/35369000/cabal-could-not-find-module-snap-internal-http-server-exception/35517641#35517641", "title": "cabal could not find module snap.internal.http.server.exception", "body": "<p>With the help of, and gratitude to, epsilonhalbe we found a solution to this problem. I still do not know why the import of Snap.Internal.Http.Server.Exception started to throw an error from the compiler. However, removing that import and adding a type declaration to the variable now allows the code to build without error. i.e. catch ((_ :: IOException) -> return True).</p>\n"}], "owner": {"reputation": 222, "user_id": 3438721, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/hc759.jpg?s=128&g=1", "display_name": "dacDave", "link": "https://stackoverflow.com/users/3438721/dacdave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1455928910, "creation_date": 1455299019, "last_edit_date": 1455421138, "question_id": 35369000, "link": "https://stackoverflow.com/questions/35369000/cabal-could-not-find-module-snap-internal-http-server-exception", "title": "cabal could not find module snap.internal.http.server.exception", "body": "<p>I have a Haskell desktop application that uses Snap. This application has been building for years now and is an everyday part of our fielded solution. I upgraded to a new development machine some months ago, running Windows 10 with version 7.10.3 of the GHC and 1.22.3.0 of the cabal library with 1.22.4.0 of cabal-install. I have installed version 0.9.8.0 of snap-core and version 0.9.5.1 of snap-server.</p>\n\n<p>When I try and build my application in this environment, it get the following error:</p>\n\n<pre><code>Could not find module `Snap.Internal.Http.Server.Exception'\nPerhaps you meant\n  Snap.Internal.Http.Server.Backend\n  Snap.Internal.Http.Server.Config\n  Snap.Internal.Http.Server.Date\n</code></pre>\n\n<p>I cannot find this module in Hackage. Did something change in Snap since I last built this code? Please, any advice will be appreciated.</p>\n\n<p>Dave</p>\n\n<p>P.S. Here are links to the output of the ghc-pkg list command and to the cabal file for this project.</p>\n\n<p><a href=\"http://zelda.designacourse.com/dave/ghc-pkg_list.txt\" rel=\"nofollow\">http://zelda.designacourse.com/dave/ghc-pkg_list.txt</a>\n<a href=\"http://zelda.designacourse.com/dave/PreviewWrapper.cabal\" rel=\"nofollow\">http://zelda.designacourse.com/dave/PreviewWrapper.cabal</a></p>\n"}, {"tags": ["haskell", "recursion", "types", "yesod", "persistent"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455323714, "post_id": 35370972, "comment_id": 58455039, "body": "Those manually written instances are identical to the derived ones are far as I can see. You should be able to write <code>deriving instance PersistEntity record =&gt; Eq (Jab record) </code>"}, {"owner": {"reputation": 11, "user_id": 5919620, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-r4u2Eaqcqpc/AAAAAAAAAAI/AAAAAAAAAGA/z-tyX7QqwcM/photo.jpg?sz=128", "display_name": "Felix Paulusma", "link": "https://stackoverflow.com/users/5919620/felix-paulusma"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455476026, "post_id": 35370972, "comment_id": 58495088, "body": "You are actually right. I see that I went wrong in that I tried the <code>deriving instance</code> with <code>Eq (Key record)</code> instead of <code>Jab</code>. (Still had to make my own <code>PersistField</code> instance, but that&#39;s to be expected.)"}], "tags": [], "owner": {"reputation": 11, "user_id": 5919620, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-r4u2Eaqcqpc/AAAAAAAAAAI/AAAAAAAAAGA/z-tyX7QqwcM/photo.jpg?sz=128", "display_name": "Felix Paulusma", "link": "https://stackoverflow.com/users/5919620/felix-paulusma"}, "is_accepted": false, "score": 1, "last_activity_date": 1455306328, "creation_date": 1455306328, "answer_id": 35370972, "question_id": 35368294, "link": "https://stackoverflow.com/questions/35368294/error-recursive-data-type-persistent-model-with-yesod/35370972#35370972", "title": "Error RECURSIVE data type Persistent model with YESOD", "body": "<p>Turns out writing my own instances for <code>(Jab record)</code> fixed this issue.</p>\n\n<p>This is how I fixed it, for reference:</p>\n\n<ul>\n<li>Removing the <code>Eq</code>, <code>Show</code> and <code>Read</code> from the <code>deriving</code> clause of <code>Jab</code></li>\n<li>Making my own <code>Eq</code>, <code>Show</code> and <code>Read</code> instances for <code>(Jab record)</code></li>\n<li>After that compiled I had to consequently make a <code>PersistField</code> instance for <code>(Bar record)</code></li>\n</ul>\n\n<p>(The following is all put in a separate file to be imported to <code>Models.hs</code>)</p>\n\n<pre><code>module Custom.TypesAndInstances where\n\nimport ClassyPrelude.Yesod\n\nimport Prelude (read)\nimport qualified Data.Text as T\nimport qualified Text.Read.Lex as L\nimport Text.ParserCombinators.ReadPrec\nimport GHC.Read\nimport GHC.Show (appPrec)\n\n-- instance for PersistField (Bar record)\n\ninstance (PersistEntity record, PersistField record) =&gt; PersistField (Bar record) where\n    toPersistValue = PersistText . T.pack . show\n    fromPersistValue (PersistText t) = Right $ read $ T.unpack t\n\n-- instances for Jab Eq, Read and Show\n\ninstance PersistEntity record =&gt; Eq (Jab record) where\n    Jab x a == Jab y b = x == y &amp;&amp; a == b  \n\ninstance PersistEntity record =&gt; Show (Jab record) where\n    show (Jab x a) = \"Jab \" ++ show x ++ \" \" ++ show a\n\ninstance PersistEntity record =&gt; Read (Jab record) where\n    readPrec = parens\n        (prec appPrec (do\n            expectP (L.Ident \"Jab\")\n            x &lt;- step readPrec\n            y &lt;- step readPrec\n            return (Jab x y))\n        )\n    readListPrec = readListPrecDefault\n    readList = readListDefault\n\n----------------------\ndata Bar record = Bar { a :: [Jab record]\n                                    }\n  deriving (Eq, Show, Read, Typeable)\n\ndata Jab record = Jab { b :: Key record  \n                      , c :: Int\n                      }\n  deriving (Typeable)\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 5919620, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-r4u2Eaqcqpc/AAAAAAAAAAI/AAAAAAAAAGA/z-tyX7QqwcM/photo.jpg?sz=128", "display_name": "Felix Paulusma", "link": "https://stackoverflow.com/users/5919620/felix-paulusma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1455306328, "creation_date": 1455296684, "last_edit_date": 1455300380, "question_id": 35368294, "link": "https://stackoverflow.com/questions/35368294/error-recursive-data-type-persistent-model-with-yesod", "title": "Error RECURSIVE data type Persistent model with YESOD", "body": "<h2>TL;DR How to make (Key record) an instance of Eq/Show/Read in Yesod</h2>\n\n<hr>\n\n<p>I'm having a problem with module recursion. I've declared some of my own data types in a file which I want to be available to Models.hs, since I need to use it in the config/models file.\nBut one of the types needs data types from the DB. A FooId (i.e. Key Foo) to be precise.</p>\n\n<p>It looks something like this:</p>\n\n<p>config/models</p>\n\n<pre><code>Foo\n    name Text\n    thingy (Bar Foo) Maybe\n    UniqueName name\n    deriving Eq Show Read Typeable\n</code></pre>\n\n<p>My own file contains these</p>\n\n<pre><code>data Bar record = Bar { a :: [Jab record] }\n  deriving (Eq, Show, Read, Typeable)\n\ndata Jab record = Jab { b :: Key record\n                      , c :: Int\n                      }\n  deriving (Eq, Show, Read, Typeable)\n</code></pre>\n\n<p>Now I need to import Model.hs to get Key to work, but I also need to import my file into Model.hs for it to work.\nI've also tried adding my own types to Models.hs, but I get these errors:</p>\n\n<pre><code>Model.hs:24:13:\n    No instance for (Eq (Key record))\n      arising from the first field of \u2018Jab\u2019 (type \u2018Key record\u2019)\n    Possible fix:\n      use a standalone 'deriving instance' declaration,\n        so you can specify the instance context yourself\n    When deriving the instance for (Eq (Jab record))\n</code></pre>\n\n<p>And adding a \"deriving instance Eq a => Eq (Key a)\" \ntogether with the {-# LANGUAGE StandaloneDeriving #-} doesn't work either.</p>\n\n<p>If anyone knows how to remedy this, it'd help me immensely.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 4, "creation_date": 1455290017, "post_id": 35365877, "comment_id": 58437786, "body": "hint: have a look at your <code>otherwise</code> case - do you really want just <code>xs</code> here? - btw: right now you can never get something like <code>[[a,b,c],..]</code> - because you only add lists with 2 elements in there"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1455290469, "post_id": 35365877, "comment_id": 58438076, "body": "Since getting the last element of the list is costly, I&#39;d keep the last seen range element as a function parameter and pass it around for comparison with the next coming element."}, {"owner": {"reputation": 3040, "user_id": 4308453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc596d8352ad2c4254536343139b5b82?s=128&d=identicon&r=PG&f=1", "display_name": "zakyggaps", "link": "https://stackoverflow.com/users/4308453/zakyggaps"}, "edited": false, "score": 0, "creation_date": 1455292143, "post_id": 35365877, "comment_id": 58439287, "body": "You can make a differential list first, then you can split the list while viewing only one element at a time."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1455294811, "post_id": 35365877, "comment_id": 58441179, "body": "I guess that a &quot;blandly increasing range&quot; is a list where every number is followed by itself or its successor (or the end of the list). Maybe you should define it more precisely (or is it standard, and I am unaware of that ?)."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1455295694, "post_id": 35365877, "comment_id": 58441765, "body": "based on how much experience you have with this kind of stuff it should not be to hard to implement this using <code>foldr</code> - the first thing that comes to (my) mind is using a tuple of an <i>accumulator</i> list (to collect inner lists) and an result list of lists - as you are moving form the <i>right</i> you can use pattern matching on the head of the <i>accumulator</i>  to decide if you want to <i>keep accumulating</i> or if it is time to push and start a new <i>accumulator</i> - after the fold you need an additional step to <i>cons</i> the tuple ^^"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1455296836, "post_id": 35365877, "comment_id": 58442539, "body": "@chi, maybe it&#39;s a local synonym for monotone? I don&#39;t really know. I also don&#39;t see how that actually relates to the way the list is being split."}, {"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1455296899, "post_id": 35365877, "comment_id": 58442578, "body": "@dfeuer yes. monotone, non-decreasing is more precise."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1455297240, "post_id": 35365877, "comment_id": 58442795, "body": "But what does that have to do with how the list is split? Or are you really trying to say something else? Will the list always be monotone? If not, how should that affect the results? Is it always brown into groups of three? A better verbal description and more examples would be good."}, {"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1455298200, "post_id": 35365877, "comment_id": 58443390, "body": "@dfeuer I hope I cleared out your doubts with my edit"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1455299060, "post_id": 35365877, "comment_id": 58443880, "body": "@dfeuer No, &quot;monotone&quot; is weaker than what the OP wants.  It seems that each part must be of the form <code>[a..b]</code>, except with numbers possibly being repeated. As I wrote in my comment above, each number must be followed by itself or its successor (AFAICS). So perhaps it&#39;s &quot;splitting in non-decreasing contiguous (maximal) parts&quot;."}, {"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1455299127, "post_id": 35365877, "comment_id": 58443917, "body": "@chi Exactly,you said it perfectly"}], "answers": [{"tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 2, "last_activity_date": 1455317111, "last_edit_date": 1495540766, "creation_date": 1455295307, "answer_id": 35367835, "question_id": 35365877, "link": "https://stackoverflow.com/questions/35365877/split-ranges-in-haskell/35367835#35367835", "title": "Split ranges in Haskell", "body": "<p>Try breaking the problem into more manageable parts. </p>\n\n<p>First, how would you split just one blandly increasing range from the start of a list? Lets guess that should be <code>splitOne :: [Integer] -&gt; ([Integer], [Integer])</code>.</p>\n\n<p>Second, how can you repeatedly apply splitOne to the left-over list? Try implementing <code>splitMany :: [Integer] -&gt; [[Integer]]</code> by using splitOne.</p>\n\n<p>For splitOne, what should you be trying to find? The first position to split at. What are \"split positions\"? Lets make that up.</p>\n\n<pre><code>split    0     1      2      3      4      \u2026\nlist  [  | x1, |  x2, |  x3, |  x4, |  x5, \u2026]\n</code></pre>\n\n<p>So a split at 0 is <code>([], [x1,x2,x3,x4,x5,\u2026])</code>, and a split at 3 is <code>([x1,x2,x3],[x4,x5,\u2026])</code>. What relationship can you see between the split position and the split list?</p>\n\n<p>How do you determine the first split position of the list? Lets say that is implemented as <code>firstSplitPos :: [Integer] -&gt; Integer</code>. What is the first split position of an empty list?</p>\n\n<p>Can you now implement splitOne using firstSplitPos?</p>\n\n<h2>One Possible Answer</h2>\n\n<hr>\n\n<pre><code>-- What are the adjacencies for:\n--   1) empty lists?\n--   2) lists with one element?\n--   3) lists with more than one element?\n--\n-- Bonus: rewrite in point-free form using &lt;*&gt;\n--\nadjacencies :: [a] -&gt; [(a,a)]\nadjacencies xxs = zip xxs (drop 1 xxs)\n\n-- Bonus: rewrite in point-free form\n--\nwithIndices :: [a] -&gt; [(Int,a)]\nwithIndices xxs = zip [0..] xxs\n\n-- This is the most involved part of the answer. Pay close\n-- attention to:\n--   1) empty lists\n--   2) lists with one element\n--   3) lists which are a blandly increasing sequence\n--\nfirstSplitPos :: (Eq a, Num a) =&gt; [a] -&gt; Int\nfirstSplitPos xxs = maybe (length xxs) pos (find q searchList)\n  where q (_,(a,b)) = a /= b &amp;&amp; a + 1 /= b\n        searchList  = withIndices (adjacencies xxs)\n        -- Why is the split position one more than the index?\n        pos (i,_)   = i + 1\n--\n\n-- Bonus: rewrite in point-free form using &lt;*&gt;\n--\nsplitOne :: (Eq a, Num a) =&gt; [a] -&gt; ([a],[a])\nsplitOne xxs = splitAt (firstSplitPos xxs) xxs\n\nsplitMany :: (Eq a, Num a) =&gt; [a] -&gt; [[a]]\n-- What happens if we remove the case for []?\nsplitMany []  = []\nsplitMany xxs = let (l, r) = splitOne xxs in l : splitMany r\n</code></pre>\n\n<h2>Another Approach</h2>\n\n<hr>\n\n<p>This is my explanation of <a href=\"https://stackoverflow.com/a/35369590/260584\">Carsten's solution</a>. It is already succinct but I have elected for a variation which does not use a 2-tuple.</p>\n\n<p>We know that Haskell lists are defined inductively. To demonstrate this, we can define an equivalent data type.</p>\n\n<pre><code>data List a = Cons a (List a) -- Cons = (:)\n            | Nil             -- Nil  = []\n</code></pre>\n\n<p>Then ask the question: can we use induction on lists for the solution? If so, we only have to solve two cases: Cons and Nil. The type signature of <code>foldr</code> shows us exactly that:</p>\n\n<pre><code>foldr ::     (a -&gt; b -&gt; b) -- Cons case\n          -&gt; b             -- Nil case\n          -&gt; [a]           -- The list \n          -&gt; b             -- The result\n</code></pre>\n\n<p>What if the list is Nil? Then the only blandly increasing sequence is the empty sequence. Therefore:</p>\n\n<pre><code>nilCase = [[]]\n</code></pre>\n\n<p>We might want <code>nilCase = []</code> instead, as that also seems reasonable \u2014 i.e. there are no blandly increasing sequences.</p>\n\n<p>Now you need some imagination. In the Cons case we only get to look at one new element at a time. With this new element, we could decide whether it belongs to the right-adjacent sequence or if it begins a new sequence.</p>\n\n<p>What do I mean by right-adjacent? In <code>[5,4,1,2,2,7]</code>, <code>1</code> belongs to the right-adjacent sequence <code>[2,2]</code>.</p>\n\n<p>How might this look?</p>\n\n<pre><code>-- The rest of the list is empty\nconsCase new []      = [new] : []\n\n-- The right-adjacent sequence is empty\nconsCase new ([]:ss) = [new] : ss\n\n-- The right-adjacent sequence is non-empty\n-- Why `new + 1 == x` and not `new == x + 1`?\nconsCase new sss@(xxs@(x:_):ss)\n  | new == x || new + 1 == x = (new:xxs):ss\n  | otherwise                = [new]:sss\n</code></pre>\n\n<p>Now that we solved the Nil case and the Cons case, we are done!</p>\n\n<pre><code>splitRanges = foldr consCase nilCase\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "edited": false, "score": 0, "creation_date": 1455308643, "post_id": 35369590, "comment_id": 58449031, "body": "A bug in your solution, it creates decreasing sequences, the fix is <code>x `elem` [y, y-1] = (x:y:ys,xs)</code> . I have tried but not succeeded in writing it by myself but will analyze yours to learn in another way."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "edited": false, "score": 0, "creation_date": 1455309833, "post_id": 35369590, "comment_id": 58449589, "body": "what do you mean by <i>decreasing sequences</i>? The examples are actual output from GHCi and seem to be what you expected above"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "edited": false, "score": 0, "creation_date": 1455309988, "post_id": 35369590, "comment_id": 58449658, "body": "or are you talking about that it will accept <code>5,4,3,...</code> also? I thought this is what you wanted - if not just remove the <code>abs (x-y)</code> with <code>0 &lt;= y-x &amp;&amp; y-x &lt;= 1</code>"}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "reply_to_user": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "edited": false, "score": 0, "creation_date": 1455317154, "post_id": 35369590, "comment_id": 58452837, "body": "@Caridorc This is a great solution Carsten. I have posted my own explanation of the answer. <a href=\"http://stackoverflow.com/a/35367835/260584\">stackoverflow.com/a/35367835/260584</a>"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 1, "last_activity_date": 1455310167, "last_edit_date": 1455310167, "creation_date": 1455301176, "answer_id": 35369590, "question_id": 35365877, "link": "https://stackoverflow.com/questions/35365877/split-ranges-in-haskell/35369590#35369590", "title": "Split ranges in Haskell", "body": "<p>I hope you don't mind spoiling part of it, but as the comments are discussing what you want (and I hope I've got it) maybe you are interested in another possible solution?</p>\n\n<p>I don't want to spoil it all but I think you can easily work this out:</p>\n\n<pre><code>blandly :: (Ord a, Num a) =&gt; [a] -&gt; [[a]]\nblandly = g . foldr f ([],[])\n  where f x ([],xss)       = ([x],xss)\n        f x (y:ys,xss)\n          | abs (x-y) &lt;= 1 = undefined\n          | otherwise      = undefined\n        g (ys,xss)         = undefined\n</code></pre>\n\n<p>you just have to fill in the <code>undefined</code> holes</p>\n\n<p>The idea is just to fold the list from the right, accumulating your inner lists in the first item of the tuple, s long as the elements are not to far away; and if they are: to push it to the second item.</p>\n\n<p>If done correctly it will yield:</p>\n\n<pre><code>\u03bb&gt; blandly [1,3]\n[[1],[3]]\n\u03bb&gt; blandly [1,2,5]\n[[1,2],[5]]\n\u03bb&gt; blandly [0,0,1]\n[[0,0,1]]\n\u03bb&gt; blandly [1,5,7,9]\n[[1],[5],[7],[9]]\n</code></pre>\n\n<p>which seems to be what you want</p>\n\n<hr>\n\n<p>1 hour later - I think I can post <em>my</em> solution - just stop reading if you don't want to get spoiled</p>\n\n<pre><code>blandly :: (Ord a, Num a) =&gt; [a] -&gt; [[a]]\nblandly = uncurry (:) . foldr f ([],[])\n  where f x ([],xs) = ([x],xs)\n        f x (y:ys,xs)\n          | abs (x-y) &lt;= 1 = (x:y:ys,xs)\n          | otherwise     = ([x],(y:ys):xs)\n</code></pre>\n\n<p>maybe I have a slight misunderstanding here (the examples did not specify it) - but if you want on only monotonic increasing inner lists you just have to change the <code>abs</code> part:</p>\n\n<pre><code>blandly :: (Ord a, Num a) =&gt; [a] -&gt; [[a]]\nblandly = uncurry (:) . foldr f ([],[])\n  where f x ([],xss)    = ([x],xss)\n        f x (y:ys,xss)\n          | 0 &lt;= y-x\n            &amp;&amp; y-x &lt;= 1 = (x:y:ys,xss)\n          | otherwise   = ([x],(y:ys):xss)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "is_accepted": false, "score": 1, "last_activity_date": 1455302600, "creation_date": 1455302600, "answer_id": 35369941, "question_id": 35365877, "link": "https://stackoverflow.com/questions/35365877/split-ranges-in-haskell/35369941#35369941", "title": "Split ranges in Haskell", "body": "<p>It would be useful and idiomatic to write your function to take a predicate, instead of writing your split condition into the function itself:</p>\n\n<pre><code>splitBy2 :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]\nsplitBy2 ok xs = snd $ f xs [] []\n  where f (a:b:xs) acc_list acc_out_lists | ok a b = ...\n</code></pre>\n"}], "owner": {"reputation": 3409, "user_id": 3105485, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4c41125ff9c7b20ca07d0845e7af7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Caridorc", "link": "https://stackoverflow.com/users/3105485/caridorc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 361, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1455317111, "creation_date": 1455289697, "last_edit_date": 1455298175, "question_id": 35365877, "link": "https://stackoverflow.com/questions/35365877/split-ranges-in-haskell", "title": "Split ranges in Haskell", "body": "<p>Given a list like:</p>\n\n<pre><code>[1, 2, 2, 6, 7, 8, 10, 11, 12, 15]\n</code></pre>\n\n<p>Split it into blandly increasing ranges (maybe equal):</p>\n\n<pre><code>[[1, 2, 2], [6, 7, 8], [10, 11, 12], [15]]\n</code></pre>\n\n<p>I tried using a recursive approach:</p>\n\n<pre><code>splitRanges [] = [[]]\nsplitRanges (x:y:xs) \n  | x `elem` [y, y + 1] = [x, y] : splitRanges xs\n  | otherwise = xs\n</code></pre>\n\n<p>So if the item is one less or equal to the item after I fuse them. But it says I am trying to build an infinite type:</p>\n\n<pre><code>Occurs check: cannot construct the infinite type: a0 = [a0]\nExpected type: [[a0]]\n  Actual type: [a0]\n</code></pre>\n\n<blockquote>\n  <p>But what does [the fact that it is monotone] have to do with how the list is split?</p>\n</blockquote>\n\n<p>That being strictly increasing would give different results.</p>\n\n<blockquote>\n  <p>Or are you really trying to say something else? </p>\n</blockquote>\n\n<p>I hope I am not.</p>\n\n<blockquote>\n  <p>Will the list always be monotone? </p>\n</blockquote>\n\n<p>No, splitting a monotone list means making it into just one sub-list.</p>\n\n<blockquote>\n  <p>If not, how should that affect the results?</p>\n</blockquote>\n\n<p>If it is not monotone, you will have many sublists.</p>\n\n<blockquote>\n  <p>Is it always brown into groups of three? </p>\n</blockquote>\n\n<p>No, the groups may contain n elements.</p>\n\n<blockquote>\n  <p>More examples would be good</p>\n</blockquote>\n\n<pre><code>splitRanges [1, 3] == [[1], [3]]\nsplitRanges [1, 2, 5] == [[1, 2], [3]]\nsplitRanges [0, 0, 1] == [[0, 0, 1]]\nsplitRanges [1, 5, 7, 9] == [[1], [5], [7], [9]]\n</code></pre>\n\n<p>I appreciate hints rather than full answers, as I would like to improve myself, copy-pasting is not improvement.</p>\n"}, {"tags": ["haskell", "user-input", "ghc"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1455284550, "post_id": 35364007, "comment_id": 58433992, "body": "Is this your actual code? Have you tried to run it? Your snippet doesn&#39;t compile for me because you are missing parentheses around <code>a:c:b</code>. When I add the parentheses it behaves as expected."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1455284794, "post_id": 35364007, "comment_id": 58434154, "body": "I think you should probably disable buffering (with <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/System-IO.html#v:hSetBuffering\" rel=\"nofollow noreferrer\">hSetBuffering</a>) - this should fix those issues"}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 3, "last_activity_date": 1455285333, "last_edit_date": 1455285333, "creation_date": 1455284963, "answer_id": 35364243, "question_id": 35364007, "link": "https://stackoverflow.com/questions/35364007/getline-doesnt-stop/35364243#35364243", "title": "getLine doesn&#39;t stop", "body": "<p>I think I know what you are talking about (even if your code does not compile) and this should fix it (at least it does usual.y for me):</p>\n\n<pre><code>import System.IO\n\nhSetBuffering stdin NoBuffering\nhSetBuffering stdout NoBuffering\n</code></pre>\n\n<p>BTW: I think I have those issues in <em>eshell</em> and on windows inside GHCi but I am not 100% sure - never had in bash though</p>\n\n<hr>\n\n<p>of course it might be the strange combination of <code>getChar</code> and <code>getLine</code> too ;)</p>\n\n<p>Anyway this:</p>\n\n<pre><code>import System.IO\n\nmain :: IO ()\nmain = do\n\n  hSetBuffering stdin NoBuffering\n  hSetBuffering stdout NoBuffering\n\n  putStrLn \"input a\"\n  a &lt;- getLine\n  putStrLn \"input b\"\n  b &lt;- getLine\n  putStrLn \"input c\"\n  c &lt;- getLine\n  print (a,b,c)\n</code></pre>\n\n<p>should print the prompt and let you enter the 3 inputs, finally printing the tuple</p>\n"}, {"tags": [], "owner": {"reputation": 6751, "user_id": 1417063, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mwy5e.jpg?s=128&g=1", "display_name": "Davide Spataro", "link": "https://stackoverflow.com/users/1417063/davide-spataro"}, "is_accepted": false, "score": 6, "last_activity_date": 1455290809, "last_edit_date": 1455290809, "creation_date": 1455285305, "answer_id": 35364344, "question_id": 35364007, "link": "https://stackoverflow.com/questions/35364007/getline-doesnt-stop/35364344#35364344", "title": "getLine doesn&#39;t stop", "body": "<p>The problem is caused by   <strong>stdin buffering</strong> that is enabled by default.</p>\n\n<ol>\n<li><p><strong>Import IO at top level of your file</strong></p>\n\n<pre><code>import System.IO\n</code></pre></li>\n<li><p>Add to your <strong>main</strong> (before any <em>getChar</em> call)</p>\n\n<pre><code>hSetBuffering stdin NoBuffering\n</code></pre></li>\n</ol>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>import System.IO\nmain = do\n  hSetBuffering stdin NoBuffering\n  putStrLn \"input a\"\n  a &lt;- getChar\n  putStrLn \"input b\"\n  b &lt;- getLine\n  putStrLn \"input c\"\n  c &lt;- getChar\n  print $ a:(c:b)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 12230, "user_id": 1479269, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c8d6345c6e01f0f4ce8acf0792d7769c?s=128&d=identicon&r=PG", "display_name": "dmvianna", "link": "https://stackoverflow.com/users/1479269/dmvianna"}, "edited": false, "score": 0, "creation_date": 1455490730, "post_id": 35364347, "comment_id": 58500346, "body": "While using <code>stdin NoBuffering</code> was the correct thing to do, this answer explained the problem better. The actual code has multiple <code>do</code> statements. In order to understand in which ones to use <code>stdin NoBuffering</code> I needed to understand what was happening in the first place. There is no reason why I should change <code>stdout</code> defaults."}], "tags": [], "owner": {"reputation": 11978, "user_id": 774651, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d174682a9c2469488ac0cd91f0253215?s=128&d=identicon&r=PG&f=1", "display_name": "Lol4t0", "link": "https://stackoverflow.com/users/774651/lol4t0"}, "is_accepted": true, "score": 7, "last_activity_date": 1455285319, "creation_date": 1455285319, "answer_id": 35364347, "question_id": 35364007, "link": "https://stackoverflow.com/questions/35364007/getline-doesnt-stop/35364347#35364347", "title": "getLine doesn&#39;t stop", "body": "<p>When you press <kbd>X</kbd> and then <kbd>Enter</kbd> you get <code>X\\n</code> into your keyboard buffer. </p>\n\n<p><code>getChar</code> reads <code>X</code> but leaves <code>\\n</code>. Then <code>getLine</code> just reads <code>\\n</code> and finishes immediately.</p>\n\n<p>You can read trailing <code>\\n</code> with another <code>getLine</code> to clean keyboard buffer before reading <code>b</code></p>\n\n<pre><code>main :: IO String\nmain = do\n  putStrLn \"input a\"\n  a &lt;- getChar\n  getLine --clean kbd buffer\n  putStrLn \"input b\"\n  b &lt;- getLine\n  putStrLn \"input c\"\n  c &lt;- getChar\n  return (a:c:b)\n</code></pre>\n"}], "owner": {"reputation": 12230, "user_id": 1479269, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c8d6345c6e01f0f4ce8acf0792d7769c?s=128&d=identicon&r=PG", "display_name": "dmvianna", "link": "https://stackoverflow.com/users/1479269/dmvianna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 464, "favorite_count": 1, "accepted_answer_id": 35364347, "answer_count": 3, "score": 2, "last_activity_date": 1455290809, "creation_date": 1455284178, "question_id": 35364007, "link": "https://stackoverflow.com/questions/35364007/getline-doesnt-stop", "title": "getLine doesn&#39;t stop", "body": "<p>My program goes something like</p>\n\n<pre><code>main :: IO String\nmain = do\n  putStrLn \"input a\"\n  a &lt;- getChar\n  putStrLn \"input b\"\n  b &lt;- getLine\n  putStrLn \"input c\"\n  c &lt;- getChar\n  return a:c:b\n</code></pre>\n\n<p>Behaviour: I get \"input a\" printed, and the program waits for me to type a Char and press return. From there, it scrolls past <strong>getLine</strong> without ever letting me input something. How can I make it do what I intend it to?</p>\n\n<p>P.S.: There are probably more problems with this code, but let's focus on my present question.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1455281854, "post_id": 35362963, "comment_id": 58432204, "body": "why don&#39;t you just call the first &#39;Empty&#39; - <code>Nil</code> and the second one <code>Leaf</code> ? then it would &#39;feel right&#39;. But ultimately you have to - do this - otherwise <code>Empty</code> can be used to construct Trees or Lists - maybe some LANGUAGE extension can help you - i am thinking of <code>AllowAmbiguousTypes</code>, but i am not sure."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 5, "creation_date": 1455282087, "post_id": 35362963, "comment_id": 58432349, "body": "Another option is that - as they are unrelated - create two modules - MyList and MyTree -  then, as namespaces are per module, the problem is solved, if you then use both within one file you have to do qualified imports. Take a look at the <a href=\"https://hackage.haskell.org/package/containers\" rel=\"nofollow noreferrer\"><code>containers</code></a> package to see a neatly organised example."}], "answers": [{"comments": [{"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1455310674, "post_id": 35363721, "comment_id": 58449997, "body": "This is a correct answer, but I can&#39;t help but point out that the computer would be able to cope with the <code>x = Empty</code> definition if the language required type declarations for ambiguous definitions like this one. Haskell already does this for numeric literals. So it&#39;s a language-imposed rule, not some law of nature."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1455313811, "post_id": 35363721, "comment_id": 58451413, "body": "@LuisCasillas I agree, and indeed some languages are more flexible than Haskell about overlapping names of different types; Haskell chooses to prioritise type inference instead. Numeric literals aren&#39;t quite the same thing, though; they&#39;re polymorphic, with a type of <code>Num n =&gt; n</code>, so the type is chosen using Haskell&#39;s normal instance selection rules."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1455283366, "creation_date": 1455283366, "answer_id": 35363721, "question_id": 35362963, "link": "https://stackoverflow.com/questions/35362963/using-haskell-sum-type-to-make-recursive-lists-recursion-anchor/35363721#35363721", "title": "Using Haskell sum type to make recursive lists - recursion anchor?", "body": "<p>Suppose that you were allowed to declare two datatypes with an <code>Empty</code> constructor, as you have done. Given the definition</p>\n\n<pre><code>x = Empty\n</code></pre>\n\n<p>what would be the type of <code>x</code>? It could be <code>EList</code> or <code>ETree</code>, but the computer can't know which one you meant. That's why in general, you're can't declare the same name more than once in a given file.</p>\n\n<p>One simple solution is simply to use different names. Here I'm using <code>Nil</code> for the empty list and <code>Leaf</code> for the empty tree, as is conventional.</p>\n\n<pre><code>data List = Cons Point List | Nil\ndata Tree = Node Int Tree Tree | Leaf\n</code></pre>\n\n<p>(Aside: It's usually not a good idea to declare record fields in a sum type because it means the extractors will be partial functions.)</p>\n\n<p>An alternative is to put your two overlapping names in different files.</p>\n\n<p>List.hs:</p>\n\n<pre><code>module List where\ndata List = Cons Point List | Empty\n</code></pre>\n\n<p>Tree.hs:</p>\n\n<pre><code>module Tree where\ndata Tree = Node Int Tree Tree | Empty\n</code></pre>\n\n<p>Now, if you import both of these modules, referring to <code>Empty</code> is disallowed because once again the machine doesn't know which one you meant. But this time, you can sort it out yourself using qualified names.</p>\n\n<pre><code>import List\nimport Tree\n\nemptyList = List.Empty\nemptyTree = Tree.Empty\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 5773867, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2c31d1e0baa31a1b81027888a8957be4?s=128&d=identicon&r=PG&f=1", "display_name": "prinz_minz", "link": "https://stackoverflow.com/users/5773867/prinz-minz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 35363721, "answer_count": 1, "score": 2, "last_activity_date": 1455283366, "creation_date": 1455280964, "last_edit_date": 1495542200, "question_id": 35362963, "link": "https://stackoverflow.com/questions/35362963/using-haskell-sum-type-to-make-recursive-lists-recursion-anchor", "title": "Using Haskell sum type to make recursive lists - recursion anchor?", "body": "<p>Trying to understand Haskell better, I want to build some recursive list structures using sum types. </p>\n\n<p>These two types are unrelated, but in the same file:</p>\n\n<pre><code>data EList = EList {elem::Point, rest::EList} | Empty\ndata ETree = ENode {val:: Int, left::ETree, right::ETree} | Empty\n</code></pre>\n\n<p>So I get a \"multiple declarations of 'Empty'\" error. Reading <a href=\"https://stackoverflow.com/questions/32541929/haskell-sum-type-multiple-declaration-error\">this</a> post, I understand that 'Empty' is not a keyword (as I assumed when this data type was presented in class). </p>\n\n<p>If I want to use n types like this in my program, I have to come up with n different names for the empty element, that doesn't seem right. </p>\n\n<p>Is there a common expression to determine the end of the list?\nOr should I just not be using this 'homemade' type?</p>\n"}, {"tags": ["haskell", "attoparsec"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1455270586, "post_id": 35358797, "comment_id": 58424861, "body": "I don&#39;t think you need lookahead for this. Just parse the log times apart by matching on time stamps, and only <i>within</i> each time-entry parse the sub-entries."}, {"owner": {"reputation": 18287, "user_id": 1029453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/x570w.jpg?s=128&g=1", "display_name": "Richard Huxton", "link": "https://stackoverflow.com/users/1029453/richard-huxton"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1455273972, "post_id": 35358797, "comment_id": 58427139, "body": "Hmm - I think I see what you mean. I&#39;ve been thinking about it in a line-oriented way. If I make my delimiter &quot;\\n&lt;timestamp&gt;&quot; we might sidestep the issue altogether. Thanks - I&#39;ll try it this evening if I get a chance."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1455279266, "post_id": 35358797, "comment_id": 58430539, "body": "Doesn&#39;t seem too complicated with <code>attoparsec</code>, but you should post your attempt so far."}], "answers": [{"comments": [{"owner": {"reputation": 18287, "user_id": 1029453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/x570w.jpg?s=128&g=1", "display_name": "Richard Huxton", "link": "https://stackoverflow.com/users/1029453/richard-huxton"}, "edited": false, "score": 0, "creation_date": 1455378555, "post_id": 35378448, "comment_id": 58468608, "body": "Thanks. The twin ideas of thinking about failure and <code>*&gt;</code> to provide a desired return value got it to click for me."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 2, "last_activity_date": 1582202275, "last_edit_date": 1582202275, "creation_date": 1455357424, "answer_id": 35378448, "question_id": 35358797, "link": "https://stackoverflow.com/questions/35358797/multi-line-non-match-with-attoparsec/35378448#35378448", "title": "Multi-line *non* match with attoparsec", "body": "<p>The combinator I shared on many attoparsec questions:</p>\n\n<pre><code>notFollowedBy p = p &gt;&gt; fail \"not followed by\"\n</code></pre>\n\n<p>Your solution would be something like</p>\n\n<pre><code>parseLogLine :: Parser LogStatement\nparseLogLine = do\n    log_ts &lt;- parseTimestamp\n    spaces\n    log_sql &lt;- parseSqlStmt\n    newlineLeftover &lt;- ((notFollowedBy parseTimestamp) *&gt; parseSqlStmt) &lt;|&gt; pure \"\"\n    let ls = LogStatement log_ts (log_sql ++ newlineLeftover\n    return ls\n</code></pre>\n\n<p>The right hand of <code>*&gt;</code> for <code>newlineLeftOver</code> expression would need some more work, i guess, but overall idea is like that.</p>\n"}], "owner": {"reputation": 18287, "user_id": 1029453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/x570w.jpg?s=128&g=1", "display_name": "Richard Huxton", "link": "https://stackoverflow.com/users/1029453/richard-huxton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 35378448, "answer_count": 1, "score": 0, "last_activity_date": 1582202275, "creation_date": 1455268764, "last_edit_date": 1455378460, "question_id": 35358797, "link": "https://stackoverflow.com/questions/35358797/multi-line-non-match-with-attoparsec", "title": "Multi-line *non* match with attoparsec", "body": "<p>I was playing around with parsing (PostgreSQL) logs which can have entries that are multi-line.</p>\n\n<pre><code>2016-01-01 01:01:01 entry1\n2016-01-01 01:01:02 entry2a\n    entry2b\n2016-01-01 01:01:03 entry3\n</code></pre>\n\n<p>So - with a Perl or Python script I'd just grab the next line and if it wasn't starting with a timestamp append it to the previous log entry. What is a sensible way to approach this with <code>attoparsec</code> hooked up to <code>io-streams</code>? I clearly want to do something with <code>lookAhead</code> and failing to match a timestamp but my brain is just missing something.</p>\n\n<hr>\n\n<p>Nope - still can't see it. I've stripped back what I've got. Parsing a single line is easy. I can't figure out how to parse \"up to\" another parsing pattern - I can see a lookAhead function I can use, but I don't see how that fits in with applying a \"not\" condition.</p>\n\n<p>I can't see how I can match  either. Entirely possible my brain has seized up.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule DummyParser (\n    LogStatement (..), parseLogLine\n    -- and, so we can test it...\n    , LogTimestamp , parseTimestamp\n    , parseSqlStmt\n    , newLineAndTimestamp\n) where\n\n{-  we want to parse...\nTIME001 statement: SELECT true;\nTIME002 statement: SELECT 'b',\n  'c';\nTIME003 statement: SELECT 3;\n-}\n\nimport           Data.Attoparsec.ByteString.Char8\nimport qualified Data.ByteString.Char8            as B\n\ntype LogTimestamp = Int\n\ndata LogStatement = LogStatement {\n     l_ts  :: LogTimestamp\n    ,l_sql :: String\n} deriving (Eq, Show)\n\n\nrestOfLine :: Parser B.ByteString\nrestOfLine = do\n    rest &lt;- takeTill (== '\\n')\n    isEOF &lt;- atEnd\n    if isEOF then\n        return rest\n    else\n        (char '\\n') &gt;&gt; return rest\n\n\n-- e.g. TIME001\nparseTimestamp :: Parser LogTimestamp\nparseTimestamp  = do\n  string \"TIME\"\n  digits  &lt;- count 3 digit\n  return (read digits)\n\n\n-- e.g. statement: SELECT 1\nparseSqlStmt :: Parser String\nparseSqlStmt = do\n    string \"statement: \"\n    -- How can I match until the next timestamp?\n    sql &lt;- restOfLine\n    return (B.unpack sql)\n\n\nnewLineAndTimestamp :: Parser LogTimestamp\nnewLineAndTimestamp = (char '\\n') *&gt; parseTimestamp\n\n\nspaces :: Parser ()\nspaces = do\n    skipWhile (== ' ')\n\n\n-- e.g. TIME001 statement: SELECT * FROM schema.table;\nparseLogLine :: Parser LogStatement\nparseLogLine = do\n    log_ts &lt;- parseTimestamp\n    spaces\n    log_sql &lt;- parseSqlStmt\n    let ls = LogStatement log_ts log_sql\n    return ls\n</code></pre>\n\n<hr>\n\n<p>EDIT: So, this was what I finally ended up with thank's to arrowd's help</p>\n\n<pre><code>isTimestampNext = lookAhead parseTimestamp *&gt; pure()\n\nparseLogLine :: Parser LogStatement\nparseLogLine = do\n    log_ts &lt;- parseTimestamp\n    spaces\n    log_sql &lt;- parseSqlStmt\n    extraLines &lt;- manyTill restOfLine (endOfInput &lt;|&gt; isTimestampNext)\n    let ls = LogStatement log_ts (log_sql ++ (B.unpack $ B.concat extraLines))\n    return ls\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1455264617, "post_id": 35357198, "comment_id": 58421483, "body": "I don&#39;t think there is a way to do that (I tried hard). The issue with <code>attempting to use module \u2018Prelude\u2019</code> is reported <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10920\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1455265941, "post_id": 35357198, "comment_id": 58422092, "body": "Could you share a full example of 1) that works? Because it doesn&#39;t work for me :( And I&#39;m now sure where I helped your :)"}, {"owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "reply_to_user": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 2, "creation_date": 1455266509, "post_id": 35357198, "comment_id": 58422386, "body": "I created a separate cabal project called <code>base-myprelude</code>. This defines some things and export <code>Prelude.hs</code> (I had to use some <code>NoImplicitPrelude</code> in some submodules as it tended to circle). Then I have my own project, &#39;my-project&#39; that in the cabal depends on <code>base-noprelude, base-myprelude</code>. The project I&#39;m working on isn&#39;t public, so I cannot point you to a repo. Update: <code>cabal repl</code> doesn&#39;t work in <code>base-myprelude</code>, but works in <code>my-project</code>, if that&#39;s what you are asking."}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1455267114, "post_id": 35357198, "comment_id": 58422712, "body": "Wow, moving prelude into a separate package is the key trick, thanks! You should post it as a real answer so that we can upvote it."}], "answers": [{"tags": [], "owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "is_accepted": true, "score": 3, "last_activity_date": 1455277586, "creation_date": 1455277586, "answer_id": 35361831, "question_id": 35357198, "link": "https://stackoverflow.com/questions/35357198/how-to-correctly-define-your-company-prelude/35361831#35361831", "title": "How to correctly define your &#39;company&#39; Prelude", "body": "<p>I ended up with this setup that seems to work:</p>\n\n<ul>\n<li><p>Create a special package <code>my-prelude</code>. This package exports the <code>Prelude</code>, can contain other modules, it can depend on <code>base</code>. You may need to use <code>{-# LANGUAGE NoImplicitPrelude #-}</code> in some modules to avoid circular dependencies. E.g. you may want to have some orphan instances defined and exported by your custom <code>Prelude</code> in separate files (e.g. <code>Orphans.Lib_aeson</code>), these files need the <code>NoImplicitPrelude</code>.</p></li>\n<li><p>In your main project, libraries etc. change the dependencies in cabal from <code>base</code> to <code>base-noprelude, my-prelude</code>. </p></li>\n</ul>\n\n<p>What works:</p>\n\n<ul>\n<li><code>cabal repl</code></li>\n<li>ghci/runghc works, but you have to start it with <code>ghci -hide-package base</code>; otherwise there will be conflict between <code>base</code> and <code>my-prelude</code></li>\n</ul>\n\n<p>What does not work:</p>\n\n<ul>\n<li><code>cabal repl</code> in the <code>my-prelude</code> package.</li>\n</ul>\n"}], "owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 533, "favorite_count": 2, "accepted_answer_id": 35361831, "answer_count": 1, "score": 5, "last_activity_date": 1455277586, "creation_date": 1455262792, "last_edit_date": 1455265487, "question_id": 35357198, "link": "https://stackoverflow.com/questions/35357198/how-to-correctly-define-your-company-prelude", "title": "How to correctly define your &#39;company&#39; Prelude", "body": "<p>I have decided to use my own <code>Prelude</code> for a larger project (containing some libraries and some executables). The Prelude doesn't export some partial functions and exports some common functions (i.e. from <code>Control.Monad</code> etc.). However, I am fighting with the way how to do it. I have tried:</p>\n\n<ol>\n<li><p>use <code>base-noprelude</code>. Create <code>Prelude.hs</code> in module <code>my-common-module</code>.</p></li>\n<li><p>Same as above, but in the <code>my-common-module</code> create <code>My.Prelude</code> instead. In every other module create a directory 'prelude', put it into <code>hs-source-dirs</code> cabal section, create a file <code>prelude/Prelude.hs</code> with <code>import My.Prelude</code></p></li>\n</ol>\n\n<p>The problem is that in 1) I cannot just run <code>ghci</code>, as I get conflicting <code>base</code> and <code>my-common-module</code>. In 2) <code>ghci</code> works, <code>cabal repl</code> somehow doesn't as it fails mysteriously with 'attempting to use module \u2018Prelude\u2019 (prelude/Prelude.hs) which is not loaded'. Additionally, <code>base-noprelude</code> doesn't seem to like <code>ghcjs</code>, which I want to use for part of the project (code sharing).</p>\n\n<p>It seems to me the only way currently is to start each and every file with:</p>\n\n<pre><code>import Prelude ()\nimport My.Prelude\n</code></pre>\n\n<p>or</p>\n\n<pre><code>{-# LANGUAGE NoImplicitPrelude #-} -- or extensions: NoImplicitPrelude in .cabal\n...\nimport My.Prelude\n</code></pre>\n\n<p>The 'extensions: NoImplicitPrelude' option seems to me best as it requires every file to import <code>My.Prelude</code> otherwise it won't work. Am I missing some obvious way that would achieve custom Prelude and at the same time work with <code>cabal repl</code> and <code>ghcjs</code>?</p>\n\n<p>Update: base-noprelude works with GHCJS when I manually remove the reexport of GHC.Event. </p>\n\n<p>Update: Ok, I spent some time with this and I should have spent more. It seems to me that 1) is the right way to go. <code>cabal repl</code> works (thanks Yuras), ghci must be loaded with <code>ghci -hide-package base</code> and works too. </p>\n"}, {"tags": ["haskell", "polymorphism"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1455254064, "post_id": 35355220, "comment_id": 58417222, "body": "Make a <code>Zip</code> class...?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 3, "creation_date": 1455254370, "post_id": 35355220, "comment_id": 58417328, "body": "I think I see where you are going but are you sure you need all those classes? For example your <code>Finite s</code> does not guarantee <i>finiteness</i> at all - it just gives a common way to get to an <i>empty</i>  thing. For example you could make a list obviously into a instance of both and we all know lists might be infinite too (in theory) - it looks like you want to differentiate between streams and lists instead(?)"}, {"owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1455254648, "post_id": 35355220, "comment_id": 58417422, "body": "@Carsten Yeah, I do want to differentiate between streams and lists - as some list functions (like <code>head</code>) make sense for streams, while others (like <code>reverse</code>) do not. However, I would also like to have the ability to generically deal with all kinds of sequences - including <code>Vector</code>s for example. The <code>Seq</code> is close to what I want, but it&#39;s specifically for finite things. What I&#39;d like is <code>Seq</code>, plus <code>SeqPlus</code> which also includes streams (and other infinite sequences)."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1455254997, "post_id": 35355220, "comment_id": 58417553, "body": "As Daniel wrote: Zip-Class"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 1, "creation_date": 1455256519, "post_id": 35355220, "comment_id": 58418080, "body": "You can just add <code>emptyS :: Maybe (s a)</code> to <code>Sequential</code> and consider <code>Nothing</code> as infinite and <code>Just (s a)</code> otherwise. I think that would be the simplest solution."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1455259147, "post_id": 35355220, "comment_id": 58419101, "body": "There is a problem with your <code>zip</code>: <code>zip xs (zip ys zs)</code> is ambiguous, because neither the first argument specifies the type of the second nor both the arguments specify the resulting type. Why not simply <code>zip :: Sequential s =&gt; s a -&gt; s a -&gt; s a</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1455265460, "post_id": 35355220, "comment_id": 58421869, "body": "I think <code>Alternative</code> gets you everything you&#39;re asking from <code>Finite</code> and more. <code>headEx</code> makes no more sense in the possibly-null case than what you can get from <code>Foldable</code>, and <code>null</code> is a <code>Foldable</code> thing in general, but not so useful for infinite sequences. Frankly, I think you&#39;re probably asking too much of one type class."}], "owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1455253645, "creation_date": 1455253645, "question_id": 35355220, "link": "https://stackoverflow.com/questions/35355220/how-to-make-a-sequence-polymorphic-zip-function-that-works-for-both-finite-and-i", "title": "How to make a sequence-polymorphic zip function that works for both finite and infinite sequences?", "body": "<p>I'm trying to write some sequence-related functions for my own edification and interest. So far, I have the following typeclasses:</p>\n\n<pre><code>class (Traversable s, Monad s) =&gt; Sequential s where\n   infixr 5 ~:\n   (~:) :: a -&gt; s a -&gt; s a\n   headEx :: s a -&gt; a\n   tailEx :: s a -&gt; s a\n   null :: s a -&gt; Bool\n\nclass (Sequential s) =&gt; Finite s where\n   emptyS :: s a\n</code></pre>\n\n<p>The first of these (<code>Sequential</code>) is meant to represent all sequency things (including both finite and infinite sequences), while the second is for <em>only</em> finite sequency things. </p>\n\n<p>I'm having some polymorphism-related issues in defining some typical list functions based on these. An example of these would be <code>zip</code>, which to my initial guess, would have a type signature of:</p>\n\n<pre><code>zip :: (Sequential s1, Sequential s2, Sequential s3) =&gt; s1 a -&gt; s2 b -&gt; s3 (a, b)\n</code></pre>\n\n<p>However, I run up against a problem - if I want to zip together an infinite sequence and a finite sequence, I obviously want the result to be a finite sequence as well. However, my attempt at an implementation fails, as <code>Sequence</code> has no concept of emptiness (and indeed cannot have such a concept, because infinite sequences can't be empty). Additionally, I cannot see any way of checking whether one of the <code>Sequential</code>s being passed in is actually a <code>Finite</code>, which would lead to a <code>Finite</code> result. As a result, I am not sure how I could write an implementation of this in its most general form.</p>\n\n<p>I'm not sure whether my approach is at fault, or there's something in the language I am missing, but I would really like to know how I can implement a <code>zip</code> generic across finite <em>and</em> infinite sequences in any combination.</p>\n"}, {"tags": ["haskell", "ubuntu-14.04", "stack-trace", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455249495, "post_id": 35354153, "comment_id": 58415958, "body": "<code>GHC.SrcLoc</code> is a module in the <i>base</i> package which only appears in recent versions of GHC. To use it, you will have to upgrade GHC. The import likely works on Windows and not Ubuntu because you probably got a recent version of GHC on windows, whereas the &quot;official&quot; Ubuntu version lags far behind. If you want to use the <i>srcloc</i> pacakge, you must import <a href=\"http://hackage.haskell.org/package/srcloc\" rel=\"nofollow noreferrer\"><code>Data.Loc</code></a>, <i>not</i> <code>GHC.SrcLoc</code>."}, {"owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455250881, "post_id": 35354153, "comment_id": 58416344, "body": "@user2407038 I tried that (Attemp #2) and it says &quot;Could not find module &#39;Data.Loc&#39;&quot;. This is such a pain because Java has had stack traces forever and I have to go through all this hassle just to get IDE friendly trace traces."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1455259145, "post_id": 35354153, "comment_id": 58419100, "body": "@MichaelLafayette: While those screenshots make your question colorful, they don&#39;t provide the necessary information. Which GHC do you use on Windows? Which version of srcloc is installed on either? Which version of cabal do you use?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1455267944, "post_id": 35354153, "comment_id": 58423161, "body": "I should point out that, because Haskell is lazy, it doesn&#39;t really <i>have</i> a call stack at run-time. (At least, not one with a useful shape.) So being able to have stack traces <i>at all</i> is something of an achievement. But that doesn&#39;t really address your question..."}, {"owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1455292614, "post_id": 35354153, "comment_id": 58439626, "body": "@MathematicalOrchid - I&#39;m actually just using an implicit call stack - the &quot;-prof&quot; option isn&#39;t being used. That being said, in order to be used in industry, Haskell can&#39;t be the whiteboard language that it was. Something as simple as &quot; <a href=\"http://i.imgur.com/KCXYHNk.png\" rel=\"nofollow noreferrer\">i.imgur.com/KCXYHNk.png</a> &quot; can be a real convenience to humans, even if it isn&#39;t &quot;pure&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "edited": false, "score": 0, "creation_date": 1455248512, "post_id": 35354320, "comment_id": 58415697, "body": "I tried that, both from my home directory and the IntelliJ plugin project directory. Still getting &quot;Error:(11, 8) ghc: Could not find module `GHC.SrcLoc&#39;     Use -v to see a list of the files searched for.&quot; on &quot;import GHC.SrcLoc&quot;"}, {"owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "edited": false, "score": 0, "creation_date": 1455248747, "post_id": 35354320, "comment_id": 58415766, "body": ":-( I worked so hard on this little tool to make my print statements appear as hyperlinks in the IDE and it won&#39;t even work."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1455247624, "creation_date": 1455247624, "answer_id": 35354320, "question_id": 35354153, "link": "https://stackoverflow.com/questions/35354153/haskell-cannot-import-ghc-srcloc/35354320#35354320", "title": "Haskell cannot import GHC.SrcLoc", "body": "<p>You must install the <code>srcloc</code> package; in the simple case where you are not using sandboxes, this is done by running <code>cabal install srcloc</code> at the command line.</p>\n"}, {"tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 3, "last_activity_date": 1455259290, "creation_date": 1455259290, "answer_id": 35356347, "question_id": 35354153, "link": "https://stackoverflow.com/questions/35354153/haskell-cannot-import-ghc-srcloc/35356347#35356347", "title": "Haskell cannot import GHC.SrcLoc", "body": "<p>Since <code>Data.SrcLoc</code> is a part of the GHC distribution and it wasn't added until (I believe) GHC 7.10.1, it will not exist in GHC 7.6.3. If you install the latest version of GHC, this should work fine.</p>\n\n<p>The package you are seeing that is called <code>srcloc</code> appears to be unrelated to what you want, and does not provide the <code>GHC.SrcLoc</code> module. The <code>GHC.SrcLoc</code> module is instead provided by the GHC <code>base</code> standard library, which is included in (and requires) a newer version of GHC.</p>\n\n<p>Newer versions of GHC also include a lot of other nice features that 7.6.3 (which was released more than 2 years ago) doesn't have.</p>\n\n<p>You also mentioned stack traces, so you might be interested in <a href=\"https://wiki.haskell.org/Debugging#Stack_trace\" rel=\"nofollow\">this</a>.</p>\n"}], "owner": {"reputation": 2650, "user_id": 4993125, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/FaHVT.jpg?s=128&g=1", "display_name": "Michael Lafayette", "link": "https://stackoverflow.com/users/4993125/michael-lafayette"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 1, "accepted_answer_id": 35356347, "answer_count": 2, "score": -2, "last_activity_date": 1455293960, "creation_date": 1455246379, "last_edit_date": 1455293960, "question_id": 35354153, "link": "https://stackoverflow.com/questions/35354153/haskell-cannot-import-ghc-srcloc", "title": "Haskell cannot import GHC.SrcLoc", "body": "<p>I can't get module \"GHC.SrcLoc\" in package \"srcloc\" on Ubuntu Haskell ...</p>\n\n<p>-- \"import\" works on Windows, but not on Ubuntu 14.04</p>\n\n<p><a href=\"https://i.stack.imgur.com/Qnu1x.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Qnu1x.png\" alt=\"Could not find GHC.SrcLoc\"></a></p>\n\n<p>-- Module name is \"GHC.SrcLoc\"</p>\n\n<p><a href=\"https://i.stack.imgur.com/aCpDA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/aCpDA.png\" alt=\"GHC.SrcLoc documentation\"></a></p>\n\n<p>-- Cabal build error below</p>\n\n<p><a href=\"https://i.stack.imgur.com/fk8o6.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fk8o6.png\" alt=\"enter image description here\"></a></p>\n\n<p>Take 2: tried adding package \"srcloc\" to Cabal dependencies</p>\n\n<p><a href=\"https://i.stack.imgur.com/t49FQ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/t49FQ.png\" alt=\"enter image description here\"></a></p>\n\n<p>^ Adding \"srcloc\" to dependencies causes \"cabal configuration failed\". ^</p>\n\n<p>GHCI version...</p>\n\n<pre><code>$ ghci --version\nThe Glorious Glasgow Haskell Compilation System, version 7.6.3\n</code></pre>\n\n<p>Please help</p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/GHC-SrcLoc.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/base-4.8.2.0/docs/GHC-SrcLoc.html</a></p>\n\n<p>My Haskell Code...</p>\n\n<p><a href=\"https://github.com/JohnReedLOL/HaskellPrintDebugger\" rel=\"nofollow noreferrer\">https://github.com/JohnReedLOL/HaskellPrintDebugger</a></p>\n\n<p><strong>* Attempt #1 *</strong></p>\n\n<pre><code>:~/IdeaProjects/IntelliJHaskellPrintDebugger$ cabal install srcloc\nResolving dependencies...\nAll the requested packages are already installed:\nsrcloc-0.5.1.0\nUse --reinstall if you want to reinstall anyway.\n</code></pre>\n\n<p><strong>* Attempt #2 *</strong></p>\n\n<p>-- Tried replacing \"import GHC.SrcLoc\" with \"import Data.Loc\", but failed.</p>\n\n<p><a href=\"https://i.stack.imgur.com/2zv66.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2zv66.png\" alt=\"enter image description here\"></a></p>\n\n<p>-- Tried adding \"srcLock\" to \"build-depends\" in .cabal, but failed.</p>\n\n<p><a href=\"https://i.stack.imgur.com/ulXMX.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ulXMX.png\" alt=\"enter image description here\"></a></p>\n\n<p>^ Hopeless</p>\n"}, {"tags": ["c++", "haskell", "recursion"], "comments": [{"owner": {"reputation": 1368, "user_id": 3878405, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cd7fbf1b3f55fad1bb62300c97593fe5?s=128&d=identicon&r=PG&f=1", "display_name": "Poriferous", "link": "https://stackoverflow.com/users/3878405/poriferous"}, "edited": false, "score": 3, "creation_date": 1455246451, "post_id": 35354042, "comment_id": 58415125, "body": "What&#39;s the purpose of the function? Explain. In Haskell, recursive functions usually require at least two parameters where there&#39;s the head, and the tail of a set of elements."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1455247394, "creation_date": 1455247394, "answer_id": 35354284, "question_id": 35354042, "link": "https://stackoverflow.com/questions/35354042/how-to-use-my-recursive-function-in-haskell/35354284#35354284", "title": "How to use my recursive function in Haskell?", "body": "<p>There are several syntax errors:</p>\n\n<ul>\n<li>add parentheses around negative numbers when using them as arguments</li>\n<li>to avoid starting a fresh line in the module block, indent <code>where</code> (and all following lines) a little bit</li>\n<li>add the missing semicolon to the line before <code>return ()</code></li>\n</ul>\n\n<p>And one type error: you should write <code>lol :: IO ()</code>. After fixing these, you may write <code>main = lol</code> to use it (or simply name it <code>main</code> instead of <code>lol</code>). No idea whether it does what it's supposed to do, but that seems like a thing you should be able to test once you get it running.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1455248985, "post_id": 35354302, "comment_id": 58415835, "body": "The way you use <code>fmap</code> there will pile up a bunch of &quot;stack&quot;. You should make <code>ans</code> an argument to <code>go</code> (and make it strict). Or use <code>StateT</code> or (less efficient) an <code>IORef</code>."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1455249433, "post_id": 35354302, "comment_id": 58415938, "body": "@dfeuer, since you ask :) I did not make <code>acc</code> strict, after all, we are striking for clarity hear, not performance."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1455249775, "post_id": 35354302, "comment_id": 58416023, "body": "With <code>BangPatterns</code>, that&#39;s as simple as <code>go i prev !acc = ...</code>. But I guess you don&#39;t feel like a language pragma."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1455250195, "post_id": 35354302, "comment_id": 58416143, "body": "@dfeuer Precisely. :)"}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": false, "score": 2, "last_activity_date": 1455249672, "last_edit_date": 1455249672, "creation_date": 1455247508, "answer_id": 35354302, "question_id": 35354042, "link": "https://stackoverflow.com/questions/35354042/how-to-use-my-recursive-function-in-haskell/35354302#35354302", "title": "How to use my recursive function in Haskell?", "body": "<p>How about this. I just translated it directly from C++</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Main where\n\n\ngo :: Int -&gt; Int -&gt; Int -&gt; IO Int\ngo i prev acc\n  | i &gt; 0   = do p &lt;- readLn\n                 if p &gt; prev\n                   then go (i-1) p (acc + (p - prev))\n                   else go (i-1) p acc\n  | otherwise = return acc\n\nmain :: IO ()\nmain = do\n  count &lt;- readLn :: IO Int\n  ans &lt;- go count 0 0\n  print ans\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 5916542, "user_type": "registered", "profile_image": "https://graph.facebook.com/1129408123738204/picture?type=large", "display_name": "Harris", "link": "https://stackoverflow.com/users/5916542/harris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1455249672, "creation_date": 1455245726, "question_id": 35354042, "link": "https://stackoverflow.com/questions/35354042/how-to-use-my-recursive-function-in-haskell", "title": "How to use my recursive function in Haskell?", "body": "<pre><code>lol :: IO int\nlol = go -1 0 0 0\nwhere go k m n p = case k of\n        -1 -&gt; do{\n                q &lt;- readLn ;\n                go 0 0 0 q\n            }\n        p -&gt; do{\n                putStrLn $ show $ n\n            }\n        _ -&gt; do{\n                q &lt;- readLn ;\n                go (k+1) q (if q &gt; m then n+q-m else n) p\n                return()\n            }\n</code></pre>\n\n<p>I(a haskell beginner) am doing some practise questions. I have written a recursive function but i don't know how to use it in main. Please help me to do solve this problem. This is my idea in C++ and I got it accepted.</p>\n\n<pre><code>#include&lt;iostream&gt;\nusing namespace std;\nint main(){\n    long long int prev=0;\n    long long int count,ans=0;\n    cin &gt;&gt; count;\n    long long int p;\n    for(int i=0; i&lt;count ;i++){\n        cin &gt;&gt; p;\n        if(p&gt;prev){\n            ans+=p-prev;\n        }\n        prev=p;\n    }\n    cout &lt;&lt; ans &lt;&lt; endl;\n}\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 4, "creation_date": 1455241684, "post_id": 35353404, "comment_id": 58413911, "body": "First, you should put a complete working example: What&#39;s a cell? What&#39;s GameState? With this code, is impossible to understand what&#39;s happening beside a type error on your function <code>movePawnBack</code>."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1455242334, "post_id": 35353404, "comment_id": 58414072, "body": "First of all you have a syntax error <code>BP = findCells g E</code> this is invalid, there is no assignment or mutation or whatever you are trying to do there. Secondly what is <code>E</code>, <code>WP</code>, <code>BP</code> and where did they come from?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1455243723, "post_id": 35353404, "comment_id": 58414386, "body": "@AlexeyKuleshevich, I don&#39;t think it&#39;s a syntax error, per se, but it&#39;s clearly a mistake. It means &quot;calculate <code>findCells g E</code>, check if the result is <code>BP</code>, and if it&#39;s not, throw an error.&quot;"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1455245747, "post_id": 35353404, "comment_id": 58414942, "body": "@dfeuer I don&#39;t think it means (or is intended to mean) that. After all, <code>BP</code> doesn&#39;t look at all like a <code>[(Int, Int)]</code>, which is the kind of thing <code>findCells</code> returns. But it&#39;s very unclear what it <i>is</i> intended to mean!"}, {"owner": {"reputation": 51, "user_id": 5188622, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3bd98c7e0c526724730137041a25d58e?s=128&d=identicon&r=PG&f=1", "display_name": "AVC", "link": "https://stackoverflow.com/users/5188622/avc"}, "edited": false, "score": 0, "creation_date": 1455247200, "post_id": 35353404, "comment_id": 58415331, "body": "Ok I will put more code up. WK and BP are coming from a different module and E means Empty, So if I have an empty cell I want to fill it, so BP is now in the empty spot"}, {"owner": {"reputation": 51, "user_id": 5188622, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3bd98c7e0c526724730137041a25d58e?s=128&d=identicon&r=PG&f=1", "display_name": "AVC", "link": "https://stackoverflow.com/users/5188622/avc"}, "edited": false, "score": 0, "creation_date": 1455247230, "post_id": 35353404, "comment_id": 58415338, "body": "The cells have coordinates x and y and are called BP WK or E for example"}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 5188622, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3bd98c7e0c526724730137041a25d58e?s=128&d=identicon&r=PG&f=1", "display_name": "AVC", "link": "https://stackoverflow.com/users/5188622/avc"}, "edited": false, "score": 0, "creation_date": 1455247105, "post_id": 35353610, "comment_id": 58415304, "body": "Hello sorry was away. I am trying to replace the empty spot with a certain pawn, I will see if that works!"}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": false, "score": 1, "last_activity_date": 1455243147, "last_edit_date": 1455243147, "creation_date": 1455242689, "answer_id": 35353610, "question_id": 35353404, "link": "https://stackoverflow.com/questions/35353404/how-to-code-the-output-value-in-haskell-that-equals-a-function/35353610#35353610", "title": "How to code the output value in Haskell that equals a function?", "body": "<p>Is that what you are trying to do?</p>\n\n<pre><code>movePawnBack :: GameState -&gt; Player -&gt; (Cell -&gt; [(Int, Int)])\nmovePawnBack g p = if p == Black then (findCells g) else (findCells g)\n</code></pre>\n\n<p>In order to return a function, besides currying, as it is done above, you can also use lambda</p>\n\n<pre><code>movePawnBack :: GameState -&gt; Player -&gt; (Cell -&gt; [(Int, Int)])\nmovePawnBack g p = if p == Black then (\\bp -&gt; findCells g bp) else (\\wp -&gt; findCells g wp)\n</code></pre>\n\n<p>Also note the return type <code>(Cell -&gt; [(Int, Int)])</code>, whenever it is in parenthesis, it usually means a function, although it is not required in above case, I put it there because of your question title: <code>output value in Haskell that equals a function?</code>. For instance map takes a function:</p>\n\n<pre><code>&gt;&gt;&gt; :t map\nmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>So is that what you were looking for?</p>\n"}], "owner": {"reputation": 51, "user_id": 5188622, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3bd98c7e0c526724730137041a25d58e?s=128&d=identicon&r=PG&f=1", "display_name": "AVC", "link": "https://stackoverflow.com/users/5188622/avc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1455243147, "creation_date": 1455241221, "last_edit_date": 1455241991, "question_id": 35353404, "link": "https://stackoverflow.com/questions/35353404/how-to-code-the-output-value-in-haskell-that-equals-a-function", "title": "How to code the output value in Haskell that equals a function?", "body": "<p>I have a function that finds empty cells in a chess game I am making, and I want to replace one of my pieces into that empty spot that I found. I have a function for findCells, so I have a code something like this </p>\n\n<pre><code>movePawnBack :: GameState -&gt; Player -&gt; [[Cell]]\nmovePawnBack g p = if p == Black then BP = findCells g E else WP = findCells g E\n\n\nfindCells :: GameState -&gt; Cell -&gt; [(Int, Int)]\nfindCells b c = [(x, y) | x &lt;- [0..4], y &lt;-[0..4], getFromBoard (theBoard b) (x, y) == c]\n</code></pre>\n\n<p>However, it gives me an error that I don't have an <code>else</code> cause and if I do something like this <code>BP ==...</code> then I just return a boolean type which is not what I want. Is there an easier way to do this? </p>\n"}, {"tags": ["haskell", "iteration"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1455240993, "post_id": 35353234, "comment_id": 58413738, "body": "This is <code>foldl (flip f) l</code>. Also see <code>foldr f l</code>."}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1455241245, "post_id": 35353234, "comment_id": 58413796, "body": "@user2407038 works a charm, thanks!"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1455253724, "post_id": 35353234, "comment_id": 58417125, "body": "@user2407038 please at this as an answer (maybe explaining it a bit and linking the funciton) - thanks"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1455240296, "creation_date": 1455240296, "question_id": 35353234, "link": "https://stackoverflow.com/questions/35353234/haskell-function-iteration", "title": "Haskell: function iteration", "body": "<p>if I have a function that takes a tuple and a list of lists and returns a list of lists</p>\n\n<p><code>f :: (Int,Int) -&gt; [[a]] -&gt; [[a]]</code></p>\n\n<p>how do I iterate this function using a list of tuples, with each iteration using the result from the previous iteration as input.</p>\n\n<p>ie </p>\n\n<pre><code>t:: [(Int,Int)]\nt = [(1,2),(2,4),(1,3)]\n\nl :: [[a]]\n\nf (1,3) $ f (2,4) $ f (1,2) l\n</code></pre>\n\n<p>I would like to be able to run this over a long list of tuples.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "typeclass", "gadt"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1455231591, "post_id": 35350471, "comment_id": 58410792, "body": "I think you might be interested in <a href=\"https://hackage.haskell.org/package/servant\" rel=\"nofollow noreferrer\">servant</a>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1455240535, "post_id": 35350471, "comment_id": 58413595, "body": "Firstly, using an existing library like servant is definitely the way to go here for practical purposes. If this is about learning, then you can address this issue by using <a href=\"https://wiki.haskell.org/GHC/Type_families#Detailed_definition_of_data_families\" rel=\"nofollow noreferrer\">data families</a> - allowing you to essentially have an &quot;open&quot; datatype. Then you can have a class with the <code>buildHttpRequest</code> request function, the <code>Command</code> data family, and anything else you need. As a side note, the type you have named &quot;Void&quot; is usually just called <code>()</code> in Haskell (Void is usually reserved for the <i>empty</i> type)."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1455242395, "creation_date": 1455242395, "answer_id": 35353577, "question_id": 35350471, "link": "https://stackoverflow.com/questions/35350471/modeling-a-post-api-in-a-type-safe-way/35353577#35353577", "title": "Modeling a POST API in a type safe way", "body": "<p>Since the only thing you do differently in <code>execute</code> for different commands is call <code>buildHttpRequest</code>, I propose the following alternate data type:</p>\n\n<pre><code>type Command a = Tagged a HttpRequest\n</code></pre>\n\n<p>(I don't know the return type of <code>buildHttpRequest</code>, so I made something up and assumed it returned an <code>HttpRequest</code>. Hopefully the idea will be clear enough even though I'm sure I got this part wrong.) The <code>Tagged</code> type comes from <a href=\"https://hackage.haskell.org/package/tagged-0.8.3/docs/Data-Tagged.html#t:Tagged\" rel=\"nofollow\">tagged</a>, and lets you attach a type to a value; it is the urphantom type. In our case, we will use the attached type to decide how to decode JSON in the <code>execute</code> step.</p>\n\n<p>The type of <code>execute</code> needs a slight modification to demand that the attached type can be decoded:</p>\n\n<pre><code>execute :: FromJSON a =&gt; Command a -&gt; IO a\n</code></pre>\n\n<p>However, its implementation remains basically unchanged; simply replace <code>buildHttpRequest</code> with <code>untag</code>. These commands are not conveniently introspectable, but you will be able to split things up along module boundaries; e.g.</p>\n\n<pre><code>module FancyApp.Login (Credentials(..), LoginResponse(..), login) where\n\nimport FancyApp.Types\n\ndata Credentials = Credentials\ndata LoginResponse = LoginResponse\n\nlogin :: Credentials -&gt; Command LoginResponse\nlogin = {- the old implementation of buildHttpRequest for Login -}\n\nmodule FancyApp.Logout (LogoutResponse(..), logout) where\n\nimport FancyApp.Types\n\ndata LogoutResponse = LogoutResponse\n\nlogout :: Command LogoutResponse\nlogout = {- the old implementation of buildHttpRequest for Logout -}\n</code></pre>\n"}], "owner": {"reputation": 2322, "user_id": 33841, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/5xaqb.jpg?s=128&g=1", "display_name": "kmelvn", "link": "https://stackoverflow.com/users/33841/kmelvn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1455242395, "creation_date": 1455226367, "question_id": 35350471, "link": "https://stackoverflow.com/questions/35350471/modeling-a-post-api-in-a-type-safe-way", "title": "Modeling a POST API in a type safe way", "body": "<p>Haskell beginner here, trying to wrap a HTTP REST API in a safe way and with automatic Aeson decoding of return values. I started with a Haskell function for every API call. It was a bit boilerplateish, but ok.</p>\n\n<p>Looking to improve things I wanted to turn each API call into a data type of its own. For example for logging in, I would model that as <code>Login</code> type that specifies the method, <code>Credentials</code> type for method parameters and <code>LoginReponse</code> for the result of the API call. Parameters and response types of course have corresponding FromJSON and ToJSON instances.</p>\n\n<p>For two API calls it looks something like this (using GADTs):</p>\n\n<pre><code>data Void           = Void\ndata Credentials    = Credentials {...}\ndata LoginResponse  = LoginResponse {...}\ndata LogoutResponse = LogoutResponse {...}\n\ndata Command a where\n    Login  :: Credentials -&gt; Command LoginResponse\n    Logout :: Void        -&gt; Command LogoutResponse\n\nexecute :: FromJSON a =&gt; Command a -&gt; IO a\nexecute cmd = do\n    manager &lt;- newManager tlsManagerSettings\n    let request = buildHttpRequest cmd\n\n    result &lt;- httpLbs request manager\n    let body = responseBody result\n    let parsed = fromJust $ decode body\n\n    return parsed\n</code></pre>\n\n<p>This works great for my use case - I can introspect Commands before executing them, I can't construct invalid API calls and Aeson knows how to decode the return values!</p>\n\n<p>Only problem with this approach is that I have to keep all of my Commands in a single file under single data declaration. </p>\n\n<p>I'd like to move method definitions (in my example <code>Login</code> and <code>Logout</code>) to separate modules, but to keep the <code>execute</code> function similar, and of course keep the type safety and Aeson decoding.</p>\n\n<p>I've tried to make something using type classes, but got nowhere.</p>\n\n<p>Any tips how to do that are welcome!</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "edited": false, "score": 0, "creation_date": 1455251266, "post_id": 35349603, "comment_id": 58416433, "body": "I understand the part of an inner state machine within an encapsulating state machine. Maybe I misunderstand it, but what is missing in your explanation is the transmission of <code>1:2:s</code> into the parameter of the state machine <code>push 10</code> i.e. <code>State $ \\t -&gt; ((),10:t)</code>. That &quot;magic&quot; is the work of join (if I understand it right). Without join, the two elements of the result tuple (specifically in the encapsulating state machine) don&#39;t &quot;talk&quot; to each other, i.e. the stack is not being sent as a parameter to the inner state machine. So I wanted to understand how join does that &quot;magic&quot;. Hope I&#39;m clear"}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 3, "last_activity_date": 1455287435, "last_edit_date": 1455287435, "creation_date": 1455223200, "answer_id": 35349603, "question_id": 35349159, "link": "https://stackoverflow.com/questions/35349159/haskell-join-on-state-monad/35349603#35349603", "title": "Haskell: Join on State Monad", "body": "<p>If you specialise the type of <code>join</code> for <code>State s</code> you get:</p>\n\n<pre><code>join :: State s (State s a) -&gt; State s a\n</code></pre>\n\n<p>so given a stateful computation which returns a result which is another stateful computation, <code>join</code> combines them into a single one.</p>\n\n<p>The definition of <code>push</code> is not given in your question but I assume it looks like:</p>\n\n<pre><code>push :: a -&gt; State [a] ()\npush x = modify (x:)\n</code></pre>\n\n<p>along with some <code>State</code> type like</p>\n\n<pre><code>data State s a = State (s -&gt; (a, s))\n</code></pre>\n\n<p>A value of <code>State s a</code> is a function which, given a value for the current state of type <code>s</code> returns a pair containing a result of type <code>a</code> and a new state value. Therefore</p>\n\n<pre><code>State $ \\s -&gt; (push 10,1:2:s)\n</code></pre>\n\n<p>has type <code>State [Int] (State [Int] ())</code> (or some other numeric type other than <code>Int</code>. The outer <code>State</code> function returns as its result another <code>State</code> computation, and updates the state to have the values <code>1</code> and <code>2</code> pushed onto it.</p>\n\n<p>An implementation of <code>join</code> for this <code>State</code> type would look like:</p>\n\n<pre><code>join :: State s (State s a) -&gt; State s a\njoin outer = State $ \\s -&gt;\n  let (inner, s') = runState outer s\n  in  runState inner s'\n</code></pre>\n\n<p>so it constructs a new stateful computation which first runs the outer computation to return a pair containing the inner computation and the new state. The inner computation is then run with the intermediate state.</p>\n\n<p>If you plug your example into this definition then</p>\n\n<pre><code>outer = (State $ \\s -&gt; (push 10,1:2:s))\ns = [0,0,0]\ninner = push 10\ns' = [1,2,0,0,0]\n</code></pre>\n\n<p>and the result is therefore the result of <code>runState (push 10) [1,2,0,0,0]</code> which is <code>((),[10,1,2,0,0,0])</code></p>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1455224198, "post_id": 35349638, "comment_id": 58407013, "body": "Comparing the lazy and non-lazy implementations, I can&#39;t see what makes the strict version stricter. Would you mind explaining that some more?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1455224268, "post_id": 35349638, "comment_id": 58407050, "body": "@amalloy, it&#39;s <code>let</code> vs. <code>case</code>. In the strict version, <code>&gt;&gt;=</code> case-scrutinizes the tuple before handing things over to <code>f</code>."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1455224369, "post_id": 35349638, "comment_id": 58407115, "body": "But aren&#39;t both of those just pattern-matching against a tuple? I was not aware that there was a difference between pattern-matching in a let vs pattern-matching in a single-clause <code>case</code> (for a type with only one constructor, anyway)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1455224678, "post_id": 35349638, "comment_id": 58407286, "body": "@amalloy, there is a difference, yes. <code>case x of pat -&gt; e</code> (where <code>pat</code> is a pattern and not just a variable) is equivalent to <code>let !pat = x in e</code>. <code>let pat = x in e</code> is equivalent to <code>case x of ~pat -&gt; e</code>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1455224853, "post_id": 35349638, "comment_id": 58407377, "body": "@amalloy There is a difference, and it is precisely in the laziness of the pattern matching. To wit, <code>case</code>-ing on an <code>undefined</code> value will blow up, whereas binding it to a pattern in a <code>let</code> expression won&#39;t (until someone tries to evaluate one of the pattern variables)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1455224989, "post_id": 35349638, "comment_id": 58407456, "body": "@BenjaminHodgson, it will blow up on an undefined value as long as the pattern is non-trivial <i>and matches on <code>data</code> and not <code>newtype</code></i> (I missed that in my remark above)."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1455225239, "post_id": 35349638, "comment_id": 58407607, "body": "@dfeuer Yep, subtleties abound when <code>_|_</code>&#39;s around (hey, I&#39;m a poet and I didn&#39;t even realise that I was making those words rhyme). I like to pretend it doesn&#39;t exist ;)"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1455223353, "creation_date": 1455223353, "answer_id": 35349638, "question_id": 35349159, "link": "https://stackoverflow.com/questions/35349159/haskell-join-on-state-monad/35349638#35349638", "title": "Haskell: Join on State Monad", "body": "<p>The classic definition of <code>State</code> is pretty simple.</p>\n\n<pre><code>newtype State s a = State {runState :: s -&gt; (a,s) }\n</code></pre>\n\n<p>A <code>State s a</code> is a \"computation\" (actually just a function) that takes something of type <code>s</code> (the initial state) and produces something of type <code>a</code> (the result) and something of type <code>s</code> (the final state).</p>\n\n<p>The definition you give in your question for <code>&gt;&gt;=</code> makes <code>State s a</code> a \"lazy state transformer\". This is useful for some things, but a little harder to understand and less well-behaved than the strict version, which goes like this:</p>\n\n<pre><code>m &gt;&gt;= f = State $ \\s -&gt;\n  case runState m s of\n    (x, s') -&gt; runState (f x) s'\n</code></pre>\n\n<p>I've removed the laziness and also taken the opportunity to use a record selector rather than pattern matching on <code>State</code>. </p>\n\n<p>What's this say? Given an initial state, I <code>runState m s</code> to get a result <code>x</code> and a new state <code>s'</code>. I apply <code>f</code> to <code>x</code> to get a state transformer, and then run that with initial state <code>s'</code>.</p>\n\n<p>The lazy version just uses lazy pattern matching on the tuple. This means that the function <code>f</code> can try to produce a state transformer without inspecting its argument, and that transformer can try to run without looking at the initial state. You can use this laziness in some cases to tie recursive knots, implement funny functions like <code>mapAccumR</code>, and use state in lazy incremental stream processing, but most of the time you don't really want/need that.</p>\n\n<p>Lee explains pretty well what <code>join</code> does, I think.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 0, "last_activity_date": 1455229076, "last_edit_date": 1455229076, "creation_date": 1455227144, "answer_id": 35350690, "question_id": 35349159, "link": "https://stackoverflow.com/questions/35349159/haskell-join-on-state-monad/35350690#35350690", "title": "Haskell: Join on State Monad", "body": "<p>You mentioned following the definitions for <code>join</code> and <code>&gt;&gt;=</code>, so, let's try that.</p>\n\n<pre><code>runState (join (State $ \\s -&gt; (push 10,1:2:s))) [0,0,0] = ?\n</code></pre>\n\n<p>The definitions are, again</p>\n\n<pre><code>instance Monad (State s) where  \n    -- return :: a -&gt; State s a\n    return x = State $ \\s -&gt; (x,s)  \n</code></pre>\n\n<p>so for <code>x :: a</code>, <code>State $ \\s -&gt; (x,s) :: State s a</code>;  <em>(*) ----></em></p>\n\n<pre><code>    (State h) &gt;&gt;= f = State $ \\s -&gt; let (a, newState) = h s  \n                                        (State g) = f a  \n                                    in  g newState  \n\njoin m = m &gt;&gt;= id\n</code></pre>\n\n<p>and <code>runState :: State s a -&gt; s -&gt; (a, s)</code>, i.e. it should be  <em>(*) &lt;----</em></p>\n\n<p><code>runState (State g) s = g s</code>. So, following the definitions we have</p>\n\n<pre><code>runState (join (State $ \\s -&gt; (push 10,1:2:s))) [0,0,0]\n = runState (State g) [0,0,0] \n     where (State g) = join (State $ \\s -&gt; (push 10,1:2:s))\n                     = (State $ \\s -&gt; (push 10,1:2:s)) &gt;&gt;= id\n                    -- (State      h                 ) &gt;&gt;= f \n                     = State $ \\s -&gt; let (a, newState) = h s  \n                                         (State g) = id a  \n                                         h s = (push 10,1:2:s)\n                                     in g newState  \n                     = State $ \\s -&gt; let (a, newState) = (push 10,1:2:s)  \n                                         (State g) = a\n                                     in g newState  \n                     = State $ \\s -&gt; let (State g) = push 10\n                                     in g (1:2:s)\n</code></pre>\n\n<p>Now, <code>push 10 :: State s a</code> is supposed to match with <code>State g</code> where <code>g :: s -&gt; (a, s)</code>; most probably it's defined as  <code>push 10 = State \\s-&gt; ((),(10:) s)</code>; so we have</p>\n\n<pre><code>                     = State $ \\s -&gt; let (State g) = State \\s-&gt; ((),(10:) s)\n                                     in g (1:2:s)\n                     = State $ \\s -&gt; let g s = ((),(10:) s)\n                                     in g (1:2:s)\n                     = State $ \\s -&gt; ((),(10:) (1:2:s))\n\n = runState (State $ \\s -&gt; ((),(10:) (1:2:s)) ) [0,0,0] \n = (\\s -&gt; ((),(10:) (1:2:s))) [0,0,0]\n = ((), 10:1:2:[0,0,0]) \n</code></pre>\n\n<p>. So you see that <code>push 10</code> is first <em>produced</em> as a result-value (with <code>(a, newState) = (push 10,1:2:s)</code>); <em>then</em> it is treated as the computation-description of type <code>State s a</code>, so is run <em>last</em> (not first, as you thought). </p>\n\n<p>As Lee describes, <code>join :: State s (State s a) -&gt; State s a</code>; the meaning of this type is, a computation of type <code>State s (State s a)</code> is one that produces <code>State s a</code> as its result-value, and that is <code>push 10</code>; we can run it only after we get hold of it.</p>\n"}], "owner": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1455287435, "creation_date": 1455221594, "last_edit_date": 1455222152, "question_id": 35349159, "link": "https://stackoverflow.com/questions/35349159/haskell-join-on-state-monad", "title": "Haskell: Join on State Monad", "body": "<p>How to formally calculate/interpret the following expression?</p>\n\n<pre><code>runState (join (State $ \\s -&gt; (push 10,1:2:s))) [0,0,0]\n</code></pre>\n\n<p>I understand the informal explanation, which says: first run the outer stateful computation and then the resulting one.</p>\n\n<p>Well, that's quite strange to me since if I follow the <code>join</code> and <code>&gt;&gt;=</code> definitions, it looks to me like I have to start from the internal monad (<code>push 10</code>) as the parameter of the <code>id</code>, and then do... hmmmm... well... I'm not sure what.... in order to get what is supposedly the result:</p>\n\n<pre><code>((),[10,1,2,0,0,0])  \n</code></pre>\n\n<p>However how to explain it by the formal definitions:</p>\n\n<pre><code>instance Monad (State s) where  \n    return x = State $ \\s -&gt; (x,s)  \n    (State h) &gt;&gt;= f = State $ \\s -&gt; let (a, newState) = h s  \n                                        (State g) = f a  \n                                    in  g newState  \n</code></pre>\n\n<p>and </p>\n\n<pre><code>join :: Monad m =&gt; m (m a) -&gt; m a\njoin n = n &gt;&gt;= id\n</code></pre>\n\n<p>Also, the definition of the State Monad's bind (<code>&gt;&gt;=</code>) is quite hard to grasp as having some \"intuitive\"/visual meaning (as opposed to just a formal definition that would satisfy the Monad laws). Does it have a less formal and more intuitive meaning?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1455210202, "post_id": 35345428, "comment_id": 58398258, "body": "<code>(Expr -&gt; Expr)</code> is just a function type, so at the simplest you could pass the function <code>id</code> which just returns it&#39;s argument, so <code>transform id</code> would be a &quot;do nothing&quot; operation.  You could have something like <code>incrConst (Const a) = Const (a + 1); incrConst other = other</code> so that <code>transform incrConst</code> would be a function <code>Expr -&gt; Expr</code> that would increment all values wrapped in the <code>Const</code> constructor."}, {"owner": {"reputation": 1638, "user_id": 1542957, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/21947a7967845f6b37128794589b8692?s=128&d=identicon&r=PG", "display_name": "southpaw93", "link": "https://stackoverflow.com/users/1542957/southpaw93"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1455211462, "post_id": 35345428, "comment_id": 58399102, "body": "@bheklilr can you give me a full <code>transform</code> input that would work ? defining the <code>inscrConst</code> and doing <code>transform incrConst</code> gave me the following error: No instance for (Show (Expr -&gt; Expr)) ( maybe you haven&#39;t  applied enough arguments to a function?)"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1455211673, "post_id": 35345428, "comment_id": 58399231, "body": "You have to fully apply the function.  <code>transform</code> takes two arguments and is what is known as a higher order function, like <code>map</code> or <code>filter</code>.  Something like <code>transform incrConst (Const 1)</code> would return <code>Const 2</code>, although it wouldn&#39;t be very interesting.  However <code>transform incrConst (Plus (Const 1) (Const 2))</code> would return <code>Plus (Const 2) (Const 3)</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1455216328, "post_id": 35345428, "comment_id": 58402184, "body": "Don&#39;t take it personally. If you understand the individual pieces here (which I would expect anyone familiar with Haskell to be able to do easily), but don&#39;t understand how they fit together, then you should have written your question in a way that reflects and demonstrates that. You say that you &quot;searched everywhere for a solution&quot; but not what you did and did not manage to figure out about what the code does."}], "answers": [{"comments": [{"owner": {"reputation": 1638, "user_id": 1542957, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/21947a7967845f6b37128794589b8692?s=128&d=identicon&r=PG", "display_name": "southpaw93", "link": "https://stackoverflow.com/users/1542957/southpaw93"}, "edited": false, "score": 0, "creation_date": 1455211964, "post_id": 35346076, "comment_id": 58399393, "body": "in this example: <code>transform id (Neg (Const 5))</code> the <code>t</code> from <code>transform</code> function takes the <code>id</code> parameter that I pass?"}, {"owner": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "edited": false, "score": 1, "creation_date": 1455213813, "post_id": 35346076, "comment_id": 58400591, "body": "Yes.  The first argument goes to the first parameter."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 4, "last_activity_date": 1455211655, "creation_date": 1455211655, "answer_id": 35346076, "question_id": 35345428, "link": "https://stackoverflow.com/questions/35345428/working-with-data-types-in-haskell/35346076#35346076", "title": "working with data types in haskell", "body": "<p><code>transform</code> takes two arguments.</p>\n\n<ul>\n<li>A function (any function) that accepts an <code>Expr</code> and returns an <code>Expr</code>.</li>\n<li>An <code>Expr</code> to apply this function to.</li>\n</ul>\n\n<p>It looks like the idea is similar to <code>map</code>: take a function and apply it to every part of something. (Although, as written, it only deals with <code>Neg</code> and <code>Plus</code>.)</p>\n\n<p>You could try the <code>id</code> function, which won't do anything:</p>\n\n<pre><code>&gt; transform id (Neg (Const 5))\nNeg (Const 5)\n</code></pre>\n\n<p>Or you could apply some more interesting function:</p>\n\n<pre><code>&gt; transform reduce (Neg (Const 5))\nConst (-5)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "is_accepted": false, "score": 2, "last_activity_date": 1455212813, "creation_date": 1455212813, "answer_id": 35346470, "question_id": 35345428, "link": "https://stackoverflow.com/questions/35345428/working-with-data-types-in-haskell/35346470#35346470", "title": "working with data types in haskell", "body": "<p>The type <code>Expr</code> defines an abstract syntax tree:  a datastructure describing the parsed form of a very simple expression language.</p>\n\n<p>You can define functions that take an <code>Expr</code> as an argument, do some manipulation on it, and return another <code>Expr</code> as their result.  The function <code>reduce</code> in your code example is one of these -- if the root of the tree is something it can \"reduce\", it will do so, otherwise it will return its input unprocessed</p>\n\n<p>The function <code>transform</code> takes a function like <code>reduce</code>, and returns another one.  Specifically, for the exact cases that <code>reduce</code> is able to reduce, <code>transform</code> applies the input function recursively, so that the subtrees of the <code>Neg</code> and <code>Plus</code> cases are \"transformed\" first, before the input function is applied to the <code>Neg</code> or <code>Plus</code> node itself.</p>\n\n<p>The upshot is:  if you compose an <code>Expr</code> tree out of only <code>Plus</code> and <code>Neg</code> nodes, with only <code>Const</code> leaves, then applying <code>transform reduce</code> will \"reduce\" the entire tree, returning a <code>Const</code> value which contains the result of evaluating the expression described by the input tree.</p>\n"}], "owner": {"reputation": 1638, "user_id": 1542957, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/21947a7967845f6b37128794589b8692?s=128&d=identicon&r=PG", "display_name": "southpaw93", "link": "https://stackoverflow.com/users/1542957/southpaw93"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 35346076, "answer_count": 2, "score": -2, "last_activity_date": 1455212813, "creation_date": 1455209817, "question_id": 35345428, "link": "https://stackoverflow.com/questions/35345428/working-with-data-types-in-haskell", "title": "working with data types in haskell", "body": "<p>So I have this code(Haskell) here which I am trying to figure out, I've searched everywhere for a solution and I couldn't find any.</p>\n\n<pre><code>data Expr = Var String | Const Int | Neg Expr | Expr `Plus` Expr | Expr `Times` Expr \n     deriving (Show,Eq)\n\ntransform::(Expr-&gt;Expr)-&gt;Expr-&gt;Expr\ntransform t (Neg e) = t (Neg(transform t e))\ntransform t (e1 `Plus` e2) = t ((transform t e1) `Plus` transform t e2)\ntransform t e = t e\n\nsublocal :: (String-&gt;Expr)-&gt;Expr-&gt;Expr\nsublocal t (Var s) = t s\nsublocal t exp = exp\n\nsubstitute :: (String-&gt;Expr)-&gt;Expr-&gt;Expr\nsubstitute t exp = transform (sublocal t) exp\n\nreduce :: Expr-&gt;Expr\nreduce (Neg(Const x)) = Const(-x)\nreduce ((Const x) `Plus` (Const y)) = Const(x+y)\nreduce e = e\n\nsimplify ::(String -&gt;Expr)-&gt;Expr-&gt;Expr\nsimplify t e = transform reduce (substitute t e)\n</code></pre>\n\n<p>I don't understand this here:</p>\n\n<pre><code>transform::(Expr-&gt;Expr)-&gt;Expr-&gt;Expr\ntransform t (Neg e) = t (Neg(transform t e))\ntransform t (e1 `Plus` e2) = t ((transform t e1) `Plus` transform t e2)\ntransform t e = t e\n</code></pre>\n\n<p>What valid inputs can this function receive in order for it to work ? Can you please show me some valid inputs for the function to work ?\nI don't understand what values to pass to the function to match this definition: <code>(Expr-&gt;Expr)</code></p>\n"}, {"tags": ["haskell", "memory", "ghci", "haskell-stack"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1455205529, "post_id": 35342591, "comment_id": 58394639, "body": "I don&#39;t understand your example. I added an import and loaded it into <code>ghci fib.hs +RTS -M256M -K256M</code>. But the largest computation I can do with <code>fib</code> is <code>fib 9999</code> which can be done in far less than 256MB of space. Can you give an example which actually demonstrates the issue?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1455207528, "post_id": 35342591, "comment_id": 58396258, "body": "(And, if I make the number 10000 bigger so that I can try <code>fib 100000</code>, I get an error <code>&lt;interactive&gt;: Heap exhausted; Current maximum heap size is 268435456 bytes (256 MB); use </code>+RTS -M&lt;size&gt;&#39; to increase it.`)"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1455207867, "post_id": 35342591, "comment_id": 58396518, "body": "Windows or Linux? How much physical RAM do you have? What are the exact options are you giving GHCi? What exact expression are you evaluating?"}, {"owner": {"reputation": 4251, "user_id": 1829329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f345b0578d338c5b52e9af599f7a9f19?s=128&d=identicon&r=PG", "display_name": "Zelphir Kaltstahl", "link": "https://stackoverflow.com/users/1829329/zelphir-kaltstahl"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1455210918, "post_id": 35342591, "comment_id": 58398747, "body": "@ReidBarton @MathematicalOrchid Well, when I didn&#39;t have that limitation and tried <code>fib 1000000</code> it froze my computer for 3 minutes before I could barely spam <code>ctrl-c</code> and <code>ctrl-d</code> to make it stop. It filled almost all of my RAM (<code>4Gb</code>) despite having the limitations in place. I am using a <code>Xubuntu 14.04</code>. Exact options I gave GHCI are: <code>+RTS -M256m -K256m</code> Without the limitations, my machine becomes a brick."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1455211223, "post_id": 35342591, "comment_id": 58398949, "body": "Hmm, that doesn&#39;t sound right. What version of GHC?"}, {"owner": {"reputation": 4251, "user_id": 1829329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f345b0578d338c5b52e9af599f7a9f19?s=128&d=identicon&r=PG", "display_name": "Zelphir Kaltstahl", "link": "https://stackoverflow.com/users/1829329/zelphir-kaltstahl"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1455212080, "post_id": 35342591, "comment_id": 58399460, "body": "@MathematicalOrchid added that information as well."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1455212446, "creation_date": 1455212446, "answer_id": 35346337, "question_id": 35342591, "link": "https://stackoverflow.com/questions/35342591/haskell-limit-ghci-memory/35346337#35346337", "title": "Haskell, Limit GHCI memory", "body": "<p>Your issue is in the invocation.</p>\n\n<pre><code>stack ghci +RTS -M256m -K256m\n</code></pre>\n\n<p>Stack does not pass these parameters through to ghci:</p>\n\n<pre><code>/.../.stack/programs/x86_64-osx/ghc-7.10.2/lib/ghc-7.10.2/bin/ghc -B/.../.stack/programs/x86_64-osx/ghc-7.10.2/lib/ghc-7.10.2 --interactive -odir=/.../.stack/global/.stack-work/odir/ -hidir=/.../.stack/global/.stack-work/odir/\n</code></pre>\n\n<p>If you instead invoke ghci directly:</p>\n\n<pre><code>/usr/local/lib/ghc-7.10.3/bin/ghc -B/usr/local/lib/ghc-7.10.3 --interactive +RTS -M256m -K256m\n</code></pre>\n\n<p>Yay!  Arguments!</p>\n\n<p>I suspect your <code>+RTS ...</code> is actually being consumed by stack's own RTS - as in, stack is written in Haskell and is following these constraints when you actually desire ghci to follow said constraints.  So... submit an issue for stack.</p>\n"}, {"comments": [{"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1574454883, "post_id": 35346343, "comment_id": 104253187, "body": "Is it possible to also dump some information of which allocation caused the overflow once the limit is reached?"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 8, "last_activity_date": 1455212473, "creation_date": 1455212473, "answer_id": 35346343, "question_id": 35342591, "link": "https://stackoverflow.com/questions/35342591/haskell-limit-ghci-memory/35346343#35346343", "title": "Haskell, Limit GHCI memory", "body": "<blockquote>\n<pre><code>stack ghci +RTS -M256m -K256m\n</code></pre>\n</blockquote>\n\n<p>That's not setting the RTS options of GHCi, but <code>stack</code>. After all, <code>stack</code> is also written in Haskell and therefore can take RTS options too.</p>\n\n<p>Use <code>--ghci-options</code> to provide additional options to GHCi instead:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>stack ghci --ghci-options=\"+RTS -M256m -K256m -RTS\"\n</code></pre>\n\n<p>The closing <code>-RTS</code> is necessary since <code>stack</code> provides some more options to GHCi.</p>\n"}], "owner": {"reputation": 4251, "user_id": 1829329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f345b0578d338c5b52e9af599f7a9f19?s=128&d=identicon&r=PG", "display_name": "Zelphir Kaltstahl", "link": "https://stackoverflow.com/users/1829329/zelphir-kaltstahl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 655, "favorite_count": 1, "accepted_answer_id": 35346343, "answer_count": 2, "score": 4, "last_activity_date": 1455216731, "creation_date": 1455202401, "last_edit_date": 1495540721, "question_id": 35342591, "link": "https://stackoverflow.com/questions/35342591/haskell-limit-ghci-memory", "title": "Haskell, Limit GHCI memory", "body": "<p>I already found <a href=\"https://stackoverflow.com/questions/3766656/is-there-a-way-to-limit-the-memory-ghci-can-have\">this question</a> and the answers to it.</p>\n\n<p>On the <a href=\"https://stackoverflow.com/a/3766973/1829329\">accepted answer</a> you can see my comment about the solution. It doesn't seem to work for example for this function:</p>\n\n<pre><code>fiblist = 0 : 1 : (zipWith (+) fiblist (tail fiblist))\n\nfib :: (Integral a) =&gt; a -&gt; String\nfib n\n  | n &lt; 10000 = show (genericIndex fiblist n)\n  | otherwise = error \"The number is too high and the calculation might freeze your machine.\"\n</code></pre>\n\n<p>It still renders the system unusable, even if I only give GHCI 256Mb Heap and 256Mb Stack space. For a simple call of <code>length</code> (of an infinite list) it does work.</p>\n\n<p>My question now is: What does the solution for all cases look like? (Is there one? If not, why not?)</p>\n\n<p><strong>Edit #1: Additional information</strong></p>\n\n<ul>\n<li>OS: Xubuntu 14.04</li>\n<li>RAM: 4GB</li>\n<li>Exact command I used for GHCI: <code>stack ghci +RTS -M256m -K256m</code></li>\n<li><p>GHC Version: <code>stack ghc -v</code> results in:</p>\n\n<pre><code>Version 1.0.2, Git revision fa09a980d8bb3df88b2a9193cd9bf84cc6c419b3 (3084 commits) x86_64\n... (a lot of other stuff) ...\n</code></pre></li>\n</ul>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1466084620, "post_id": 35340857, "comment_id": 63179266, "body": "Wow, somebody is using it!"}], "answers": [{"tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": true, "score": 5, "last_activity_date": 1455199987, "creation_date": 1455199987, "answer_id": 35341646, "question_id": 35340857, "link": "https://stackoverflow.com/questions/35340857/making-a-request-inside-an-api-endpoint-in-servant/35341646#35341646", "title": "Making a request inside an API endpoint in Servant", "body": "<p>Your error is at</p>\n\n<pre><code>Just msg \u2192 return $ reply token msg \"Testing!\"\n</code></pre>\n\n<p>you are on</p>\n\n<pre><code>EitherT ServantErr IO Message\n</code></pre>\n\n<p>monad but <code>reply</code> has type</p>\n\n<pre><code>reply :: Token \u2192 Message \u2192 Text \u2192 IO Message\n</code></pre>\n\n<p>then simply <code>lift</code> that <code>IO</code> action into your monad, it works</p>\n\n<pre><code>postWebhook :: Token \u2192 Update \u2192 BotHandler Message\npostWebhook token update = case message update of\n  Just msg \u2192 lift $ reply token msg \"Testing!\"\n  Nothing  \u2192 left err400\n</code></pre>\n\n<p>(Is not easy to me explain all things involved here) I think you should practice more about monads, transformers, ... before these complex examples but you're brave! :)</p>\n"}], "owner": {"reputation": 3139, "user_id": 818057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76246a9173234bb76590e972019ddbfd?s=128&d=identicon&r=PG", "display_name": "mrlee", "link": "https://stackoverflow.com/users/818057/mrlee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 1, "accepted_answer_id": 35341646, "answer_count": 1, "score": 3, "last_activity_date": 1455199987, "creation_date": 1455197873, "question_id": 35340857, "link": "https://stackoverflow.com/questions/35340857/making-a-request-inside-an-api-endpoint-in-servant", "title": "Making a request inside an API endpoint in Servant", "body": "<p>I'm trying to build a Telegram bot using <a href=\"https://github.com/klappvisor/haskell-telegram-api\" rel=\"nofollow\">telegram-api</a>. I haven't had an issues with that so far since I could read the tests to understand how things worked, but I've had a lot of trouble when it comes to building a webhook endpoint with <a href=\"http://haskell-servant.github.io\" rel=\"nofollow\">Servant</a>. The overall idea is that when I receive an <code>Update</code> from the webhook, I send a reply back.</p>\n\n<p>The problem, is to do with my <code>postWebhook</code> code, where it expects to receive a <code>Message</code> but instead receives an <code>IO Message</code>. I think this is because Servant isn't expecting me to make a request inside that function because I have the type <code>EitherT ServantError IO (IO Message)</code> (partially applied by <code>BotHandler</code>) when really it should be <code>EitherT ServantError IO Message</code>.</p>\n\n<p>I'm still learning Haskell but I understand that I somehow have to get the message out of the IO monad? Updating <code>BotAPI</code> to return a <code>Post '[JSON] (IO Message)</code> gives me this: <code>No instance for (Foldable IO) arising from a use of \u2018serve\u2019</code>, which is getting beyond my beginner knowledge, and I can see that fiddling with the types just moves the same problem to a different part of the code. I just don't know how to work around it.</p>\n\n<p>Here is the code with sensitive strings removed:</p>\n\n<pre><code>{-# LANGUAGE DataKinds         #-}\n{-# LANGUAGE DeriveAnyClass    #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE TypeOperators     #-}\n\nmodule Main where\n\nimport           Control.Monad\nimport           Control.Monad.Trans.Either\nimport           Data.Proxy\nimport           Data.Text                  (Text, pack)\nimport           Network.Wai.Handler.Warp\nimport           Servant\nimport           Web.Telegram.API.Bot\n\nreply :: Token -&gt; Message -&gt; Text -&gt; IO Message\nreply token msg response = do\n  Right MessageResponse { message_result = m } &lt;-\n    sendMessage token $ SendMessageRequest chatId response (Just Markdown) Nothing Nothing Nothing\n  return m\n  where chatId = pack . show $ chat_id (chat msg)\n\ntype BotAPI = \"webhook\" :&gt; ReqBody '[JSON] Update :&gt; Post '[JSON] Message\ntype BotHandler a = EitherT ServantErr IO a\n\nbotApi :: Proxy BotAPI\nbotApi = Proxy\n\ninitWebhook :: Token -&gt; IO Bool\ninitWebhook token = do\n  Right SetWebhookResponse { webhook_result = w } &lt;-\n    setWebhook token $ Just \"https://example.com/webhook\"\n  return w\n\npostWebhook :: Token -&gt; Update -&gt; BotHandler (IO Message)\npostWebhook token update = case message update of\n  Just msg -&gt; return $ reply token msg \"Testing!\"\n  Nothing -&gt; left err400\n\nserver :: Token -&gt; Server BotAPI\nserver = postWebhook\n\nmain :: IO ()\nmain = do\n  initWebhook token\n  run port $ serve botApi (server token)\n  where token = Token \"&lt;token&gt;\"\n        port = 8080\n</code></pre>\n\n<p>Apologies for what might not be ideal Haskell code. Thank you in advance :)</p>\n"}]