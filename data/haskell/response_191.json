[{"tags": ["api", "csv", "haskell", "servant"], "comments": [{"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 3, "creation_date": 1536194433, "post_id": 52194423, "comment_id": 91339581, "body": "You can use <a href=\"https://hackage.haskell.org/package/servant-cassava-0.10/docs/Servant-CSV-Cassava.html\" rel=\"nofollow noreferrer\">servant-cassava</a> to get a <code>CSV</code> content type instead of the <code>JSON</code> one you saw in that youtube video. May I also recommend <a href=\"https://haskell-servant.readthedocs.io/\" rel=\"nofollow noreferrer\">the official tutorial</a> which will walk you through content types among other things."}, {"owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "reply_to_user": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1536356550, "post_id": 52194423, "comment_id": 91409515, "body": "@AlpMestanogullari Sometimes websites set the <code>Content-Type</code> as <code>text&#47;plain</code> instead of <code>text&#47;csv</code> for <code>CSV</code> contents. How to deal with this situation with <code>servant-cassava</code>?"}, {"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 1, "creation_date": 1536446977, "post_id": 52194423, "comment_id": 91428686, "body": "You&#39;ll want to define a custom <code>EncodeOpts</code> instance for which <code>csvContentType</code> will return <code>text&#47;plain</code>. Let me know if you have a hard time figuring this out :)"}], "owner": {"reputation": 1502, "user_id": 2545980, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FaKkG.jpg?s=128&g=1", "display_name": "Alojzy Leszcz", "link": "https://stackoverflow.com/users/2545980/alojzy-leszcz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1536188608, "creation_date": 1536188608, "question_id": 52194423, "link": "https://stackoverflow.com/questions/52194423/servant-consuming-csv-api", "title": "Servant consuming CSV API", "body": "<p>I've found this walkthrough:\n<a href=\"https://www.youtube.com/watch?v=TQB2JbxNEUI\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=TQB2JbxNEUI</a></p>\n\n<p>and wanted to give it a go. I've found out however that my API returns CSV data, not JSON. What would be the alternative implementation for this piece of code ?</p>\n\n<pre><code>instance FromJSON GuardianResponse where\n  parseJSON = withObject \"response\" $ \\o -&gt; do\n    r &lt;- o .: \"response\"\n    t &lt;- r .: \"total\"\n    return $ GuardianResponse t\n</code></pre>\n\n<p>The API I want to consume comes from Alpha Vantage and is represented in the following way:</p>\n\n<pre><code>timestamp,open,high,low,close,volume\n2018-09-05,111.0100,111.4200,108.1000,108.4900,28246869\n2018-09-04,110.8500,111.9550,110.2200,111.7100,22557931\n2018-08-31,111.6850,112.7770,111.5150,112.3300,23222713\n2018-08-30,111.6700,112.6100,111.4400,111.9500,22798702\n// ...\n</code></pre>\n\n<p>I've tried searching online, but looks like my knowledge on Haskell ecosystem is too small. Sorry - still learning hard :). So I'm happy to hear about useful sources of Haskell knowledge as well.</p>\n"}, {"tags": ["haskell", "interrupt", "ghc", "ffi"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1536191170, "post_id": 52194650, "comment_id": 91339008, "body": "This is probably the right idea. Perhaps one also needs to declare <code>volatile int stop</code> (?). Further, I guess SIGPIPE could be raised before the signal handler is installed, and there&#39;s a small window for a race condition -- it could be unavoidable, though."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1536192436, "post_id": 52194650, "comment_id": 91339223, "body": "I added <code>volatile</code>.  I can&#39;t see what to do about the initial race, either."}, {"owner": {"reputation": 1378, "user_id": 2195721, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/37ff0c10acb6603393e11b44132b23cb?s=128&d=identicon&r=PG", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/2195721/cthulhu"}, "edited": false, "score": 0, "creation_date": 1536194206, "post_id": 52194650, "comment_id": 91339547, "body": "Is there anything I could do if c loop is not under my control? I could set up handler and call end_loop if library provided such, but what if not?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1378, "user_id": 2195721, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/37ff0c10acb6603393e11b44132b23cb?s=128&d=identicon&r=PG", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/2195721/cthulhu"}, "edited": false, "score": 0, "creation_date": 1536222904, "post_id": 52194650, "comment_id": 91348688, "body": "@Cthulhu I don&#39;t think there&#39;s anything sensible to do in such case. I mean, one could try to run that call in a OS thread and then kill that thread to force its termination, but this will likely leave the C side in an inconsistent state, triggering undefined behavior the next time we enter C land if not earlier. I mean, suppose your loop is reversing a C doubly-linked list, juggling pointers as usual. You can&#39;t really interrupt that loop in the middle and hope that your pointers still form a list, i.e. that your &quot;list&quot; is in a consistent state."}, {"owner": {"reputation": 1378, "user_id": 2195721, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/37ff0c10acb6603393e11b44132b23cb?s=128&d=identicon&r=PG", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/2195721/cthulhu"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1536223414, "post_id": 52194650, "comment_id": 91348955, "body": "@chi I guess it makes sense, that C is just too low level and does not provide tools for this exceptions-like flow."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1536196350, "last_edit_date": 1536196350, "creation_date": 1536190629, "answer_id": 52194650, "question_id": 52194264, "link": "https://stackoverflow.com/questions/52194264/how-to-make-ffi-call-interruptible/52194650#52194650", "title": "How to make FFI call interruptible", "body": "<p>As per the documentation, the way the RTS attempts to interrupt the thread engaged in the foreign call is by sending it a SIGPIPE signal.  Since the handler installed by the RTS ignores the signal, the only effect is that -- if the thread is engaged in a long-running system call -- that call is likely to return immediately with an EINTR.  Since your foreign function doesn't check the return calls of <code>printf</code> and <code>sleep</code> to see if they were interrupted, the thread goes merrily on its way.</p>\n\n<p>Now in an ideal world, it would be enough to modify your function to check for return values indicating that the functions had been interrupted, like so: </p>\n\n<pre><code>void loopForever()\n{\n  for (;;)\n  {\n    if (printf(\"Tick\\n\") &lt; 0) break;\n    if (sleep(1) != 0) break;\n  }\n}\n</code></pre>\n\n<p>Unfortunately, the interface for <code>sleep()</code> is braindead -- if it's interrupted, it returns the number of full seconds left to go, <strong>and if this is zero -- which it always is in your function -- it returns zero</strong>.  Sigh...</p>\n\n<p>You can either switch to <code>usleep</code> which sensibly returns <code>-1</code> if interrupted, or you can use the trick of setting <code>errno</code> to zero and checking if <code>printf</code> or <code>sleep</code> change it (to EINTR, but you might as well abort on any non-zero number):</p>\n\n<pre><code>/* cbits.c */\n\n#include &lt;errno.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n\n#include \"cbits.h\"\n\nvoid loopForever()\n{\n  errno = 0;\n  while (!errno)\n  {\n    printf(\"Tick\\n\");\n    sleep(1);\n  }\n}\n</code></pre>\n\n<p>That should do what you want.</p>\n\n<p>Now, depending on your real-world use case, you may find it more helpful to install a SIGPIPE handler, particularly if you expect the thread to be blocked in a long running computation (without any syscalls to interrupt).  Just be sure to de-install the handler when you're done.  Here's an example:</p>\n\n<pre><code>/* cbits.c */\n\n#include &lt;errno.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;unistd.h&gt;\n\n#include \"cbits.h\"\n\nvolatile sig_atomic_t stop = 0;\n\nvoid sigpipe_handler()\n{\n  stop = 1;\n}\n\nvoid loopForever()\n{\n  struct sigaction oldact, newact;\n  bzero(&amp;newact, sizeof(newact));\n  newact.sa_handler = sigpipe_handler;\n  sigaction(SIGPIPE, &amp;newact, &amp;oldact);\n  while (!stop)\n  {\n    // loop forever until interrupted\n  }\n  printf(\"Stopped!\");\n  sigaction(SIGPIPE, &amp;oldact, NULL);\n}\n</code></pre>\n"}], "owner": {"reputation": 1378, "user_id": 2195721, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/37ff0c10acb6603393e11b44132b23cb?s=128&d=identicon&r=PG", "display_name": "Cthulhu", "link": "https://stackoverflow.com/users/2195721/cthulhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 52194650, "answer_count": 1, "score": 5, "last_activity_date": 1536196350, "creation_date": 1536187283, "question_id": 52194264, "link": "https://stackoverflow.com/questions/52194264/how-to-make-ffi-call-interruptible", "title": "How to make FFI call interruptible", "body": "<p>According to <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ffi-chap.html#interruptible-foreign-calls\" rel=\"noreferrer\">GHC user guide</a> foreign call can be marked <code>interruptible</code>, however, I cannot make it work. I'm using <code>ghc 8.4.3</code> on GNU/Linux.</p>\n\n<p>See for example this cbits.h:</p>\n\n<pre><code>/* cbits.h */\n\nvoid loopForever();\n</code></pre>\n\n<p>cbits.c:</p>\n\n<pre><code>/* cbits.c */\n\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n\n#include \"cbits.h\"\n\nvoid loopForever()\n{\n  for (;;)\n  {\n    printf(\"Tick\\n\");\n    sleep(1);\n  }\n}\n</code></pre>\n\n<p>And finally Test.hs:</p>\n\n<pre><code>-- Test.hs\n\n{-# LANGUAGE InterruptibleFFI #-}\n\nmodule Main where\n\nimport Control.Concurrent\nimport Control.Concurrent.Async\n\nmain :: IO ()\nmain = race_ loopForever $ do\n  threadDelay 2000000\n  putStrLn \"Finished\"\n\nforeign import ccall interruptible \"cbits.h\"\n  loopForever :: IO ()\n</code></pre>\n\n<p>I compiled it all together with <code>ghc -threaded -o a.out cbits.c Test.hs</code>.</p>\n\n<p><strong>Now, I expected</strong> the code to stop after 2 seconds, <strong>however it keeps going</strong> even after \"Finished\" is printed. It did mention that <code>This is **usually** enough to cause a blocking system call to return &lt;...&gt;</code> in user guide, so is this the case that my c function is bad in particular, or am I doing something wrong on the Haskell side?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1536178722, "post_id": 52192793, "comment_id": 91335393, "body": "re: the &quot;objects&quot; bubbles should be changed to ... contain sets of matrices:  It really seems like a distraction.  The picture would be clearer if you got rid of matrices as objects at all and only focus on their role as morphisms."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1536178901, "post_id": 52192793, "comment_id": 91335478, "body": "@luqui On one hand yes, however the fact that you can have objects which contain morphisms is actually quite good to know in particular to prepare for a cartesian closed category such as <b>Hask</b>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1536179152, "last_edit_date": 1536179152, "creation_date": 1536178460, "answer_id": 52192793, "question_id": 52192516, "link": "https://stackoverflow.com/questions/52192516/vector-space-plus-matrix-as-category/52192793#52192793", "title": "Vector Space plus Matrix as category", "body": "<p>One thing that's perhaps not quite accurate in your picture: it's important that the objects are vector <em>spaces</em> (not vectors!), whereas the morphisms are matrices (I prefer to say, <em>linear mappings</em>. These are single entities at any rate, not \u201cspaces of matrices\u201d). And while matrices are themselves elements of vector spaces, a matrix is not a vector space but just a single vector. So, the \u201cobjects\u201d bubbles should be changed to contain not matrices but <em>sets of matrices</em>. And, getting more into details: a linear mapping between spaces of 3\u00d73 matrices would actually be a 9\u00d79 matrix, not another 3\u00d73 matrix (though it makes sense to see it as a (3\u00d73)\u00d7(3\u00d73) tensor).<br>Apart from that, great! I think the category vector spaces is a very good entry point to category theory.</p>\n\n<p>This does however not directly relate to \u201cwhat is category in Haskell\u201d, except insofar as categories in Haskell also obey the category laws. If you just wanted to understand these laws by some example to grok categories in general and ultimately also use them in Haskell \u2013 fair.\n<br>\nBut if you actually want to use particular categories such as <strong>Vect</strong><sub><em>k</em></sub> themselves in Haskell, that's a bit more of a tricky story because what most people call \u201ccategories in Haskell\u201d are actually way too weak: they require that <em>all Haskell types</em> can be objects. But most types can't sensibly be seen as vector spaces, so you need a more nuanced notion of category. This is provided by the <a href=\"http://hackage.haskell.org/package/subhask\" rel=\"nofollow noreferrer\"><code>subhask</code> library</a> or my own <a href=\"http://hackage.haskell.org/package/constrained-categories\" rel=\"nofollow noreferrer\"><code>constrained-categories</code></a>. Both have been used to implement the category of vector spaces:</p>\n\n<p><a href=\"http://hackage.haskell.org/package/subhask-0.1.1.0/docs/SubHask-Algebra-Vector.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/subhask-0.1.1.0/docs/SubHask-Algebra-Vector.html</a>\n<a href=\"http://hackage.haskell.org/package/linearmap-category-0.3.4.0/docs/Math-LinearMap-Category.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/linearmap-category-0.3.4.0/docs/Math-LinearMap-Category.html</a></p>\n"}], "owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 52192793, "answer_count": 1, "score": 1, "last_activity_date": 1536179152, "creation_date": 1536177173, "question_id": 52192516, "link": "https://stackoverflow.com/questions/52192516/vector-space-plus-matrix-as-category", "title": "Vector Space plus Matrix as category", "body": "<p>I try to understand what is category in Haskell with Vector Space.\nI draw a picture, can anyone review it for me. \nI'm not sure this is good/right picture for category.</p>\n\n<p><a href=\"https://i.stack.imgur.com/GSJcj.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/GSJcj.jpg\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell", "haskell-diagrams"], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 6, "last_activity_date": 1536173666, "creation_date": 1536173666, "answer_id": 52191763, "question_id": 52189911, "link": "https://stackoverflow.com/questions/52189911/how-to-make-line-as-thick-as-circle/52191763#52191763", "title": "How to make line as thick as circle?", "body": "<p>You want <code>lwL</code>, which stands for \"line weight, local\", and uses the same units for line thickness as for length.</p>\n\n<p>There are more details in <a href=\"https://archives.haskell.org/projects.haskell.org/diagrams/doc/manual.html#measurement-units\" rel=\"noreferrer\">the manual</a>, here is a relevant excerpt:</p>\n\n<blockquote>\n  <p>local units are the most straightforward to explain. Values in local units are interpreted in the context of the local vector space, just as most other length measurements (e.g. arguments to functions like circle and square). For example, square 1 # lwL 0.2 specifies a square which is drawn with lines one fifth as wide as its sides are long\u2014and will always be, even if it is scaled: the line width scales right along with the square. (The L in lwL stands for \"Local\".)</p>\n</blockquote>\n"}], "owner": {"reputation": 2966, "user_id": 3014199, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/72332b0ac6ee78bc829c378c6c747e0e?s=128&d=identicon&r=PG", "display_name": "peer", "link": "https://stackoverflow.com/users/3014199/peer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 52191763, "answer_count": 1, "score": 2, "last_activity_date": 1536173666, "creation_date": 1536165593, "question_id": 52189911, "link": "https://stackoverflow.com/questions/52189911/how-to-make-line-as-thick-as-circle", "title": "How to make line as thick as circle?", "body": "<p>I want to make a rounded line with a width equal to the diameter of a circle.\nAfter much trial and error this seems to produce the wanted output.</p>\n\n<pre><code>import Diagrams.Prelude\nimport Diagrams.Backend.Cairo.CmdLine\nmain = mainWith example\n\npath = fromVertices [p2 (0,0), p2 (3,0)] # lw 80\n\nexample :: Diagram B\nexample = atPoints [p2 (0,0)] n\n  &lt;&gt; (path # lineCap LineCapRound  . lineJoin LineJoinRound)\n  &lt;&gt; atPoints [p2 (3,0)] n\n  &lt;&gt; square 10 # lw none # fc white\n where\n   n =[circle 1 # fc green # lw none]\n</code></pre>\n\n<p>However it feels wrong. I would expect <code>lw 2</code> to correspond to <code>circle 1</code> because 2 is twice the radius, but certainly not <code>lw 80</code>?!<br>\nWhy does it work with 80?\nAssumning I missed something, how does one make a rounded line as wide as a circle?</p>\n"}, {"tags": ["haskell", "state-monad"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1536162447, "post_id": 52189019, "comment_id": 91327891, "body": "Why can you not just use <code>STArray</code>s?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1536164344, "post_id": 52189019, "comment_id": 91328926, "body": "@leftaroundabout Say I want to modify a cell in array1, calculated from  cells in array2. Then modify a cell in array2, calculated from  cells in array1. Repeat until done. Is this possible with just two STArrays? I don&#39;t see a way..."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1536164677, "post_id": 52189019, "comment_id": 91329083, "body": "@leftaroundabout Hmm I guess it can be done with monad transformers. Stack the two states and lift as needed. Is this correct?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1536164785, "post_id": 52189019, "comment_id": 91329142, "body": "@n.m. Why monad transformers? Why not just put them both in ST? (Ok, I don&#39;t think it&#39;d work with runSTArray because of the quantifiers, but I feel like there ought to be a way to do it - just use unsafeFreeze directly?)"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1536167067, "post_id": 52189019, "comment_id": 91330211, "body": "@Cubic I somehow was under impression that you can only have one piece of state inside runST. Totally incorrect."}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1536166789, "post_id": 52190064, "comment_id": 91330063, "body": "Gosh, I feel so stupid now. Why didn&#39;t I see this. Thank you."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1536166310, "creation_date": 1536166310, "answer_id": 52190064, "question_id": 52189019, "link": "https://stackoverflow.com/questions/52189019/a-monad-for-piecewise-mutable-state/52190064#52190064", "title": "A monad for piecewise mutable state", "body": "<p>Here are some options.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\nmodule TestSTArray where\n\nimport Control.Monad.ST\nimport Data.Array.ST\nimport Data.Array\nimport Data.Array.MArray\n\n-- not needed until later on    \nimport GHC.Arr (unsafeFreezeSTArray)\n</code></pre>\n\n<p>The basic, safe way is to freeze. This will cause a copy, though.</p>\n\n<pre><code>test2Safe :: (Array Int Char, Array Int Bool)\ntest2Safe = runST $ do\n   a1 &lt;- newArray (0,9) 'A' :: ST s (STArray s Int Char)\n   a2 &lt;- newArray (0,9) False :: ST s (STArray s Int Bool)\n   writeArray a1 5 'B'\n   x &lt;- readArray a2 6\n   writeArray a1 7 (if x then 'X' else 'Y')\n   writeArray a2 5 True\n   arr1 &lt;- freeze a1\n   arr2 &lt;- freeze a2\n   return (arr1, arr2)\n</code></pre>\n\n<p>More risky, but probably still safe is to leverage lower lever / unsafe GHC primitives and build an extended variant of the safe <code>runSTArray</code>. In this way we avoid the copy.</p>\n\n<pre><code>runSTArray2 :: (forall s. ST s (STArray s i1 e1, STArray s i2 e2))\n            -&gt; (Array i1 e1, Array i2 e2) \nrunSTArray2 st = runST $ do\n  (a1, a2) &lt;- st\n  (,) &lt;$&gt; unsafeFreezeSTArray a1 &lt;*&gt; unsafeFreezeSTArray a2\n</code></pre>\n\n<p>I believe the above use of <code>unsafe</code> stuff is actually safe, since we no longer use <code>a1,a2</code> after the unsafe freeze, so no copy should be needed.</p>\n\n<p>The above wrapper can be generalized to more arrays, of course. Arguably, a more general version should be put in the libraries.</p>\n\n<p>Finally, we can exploit the auxiliary function:</p>\n\n<pre><code>test2LessSafe :: (Array Int Char, Array Int Bool)\ntest2LessSafe = runSTArray2 $ do\n   a1 &lt;- newArray (0,9) 'A' :: ST s (STArray s Int Char)\n   a2 &lt;- newArray (0,9) False :: ST s (STArray s Int Bool)\n   writeArray a1 5 'B'\n   x &lt;- readArray a2 6\n   writeArray a1 7 (if x then 'X' else 'Y')\n   writeArray a2 5 True\n   return (a1, a2)\n</code></pre>\n"}], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 1, "accepted_answer_id": 52190064, "answer_count": 1, "score": 5, "last_activity_date": 1536169084, "creation_date": 1536162181, "last_edit_date": 1536169084, "question_id": 52189019, "link": "https://stackoverflow.com/questions/52189019/a-monad-for-piecewise-mutable-state", "title": "A monad for piecewise mutable state", "body": "<p>I know how ordinary <code>State</code> works (<strong>edit: apparently not!</strong>).</p>\n\n<p>If i need to create an array, and it is inconvenient to create the entire array at once, I can create an <code>STArray</code>, populate it, and then freeze and return a normal immutable array to the user.</p>\n\n<p>Now suppose I need to create two arrays of different types simultaneously.</p>\n\n<p>More generally, I may want to create an arbitrary graph with mutable nodes, modify it node by node for a while like I would modify an <code>STArray</code> cell by cell, and then freeze the whole graph at once and return normal immutable data.</p>\n\n<p>I don't want to resort to <code>IOArray</code>s or anything in the <code>IO</code> monad. What are my options?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 3, "last_activity_date": 1536165255, "creation_date": 1536165255, "answer_id": 52189835, "question_id": 52188481, "link": "https://stackoverflow.com/questions/52188481/graceful-shutdown-of-a-process/52189835#52189835", "title": "Graceful shutdown of a process", "body": "<p>You can use <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Exception-Base.html#v:bracket\" rel=\"nofollow noreferrer\">bracket</a>.  Like:</p>\n\n<pre><code>let connect = EventStore.connect EventStore.defaultSettings (EventStore.Static \"127.0.0.1\" 1113))\nbracket connect close $ \\eventStoreConnection -&gt;\n    scotty 3000 $ ...\n</code></pre>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 52189835, "answer_count": 1, "score": 2, "last_activity_date": 1536165255, "creation_date": 1536160358, "question_id": 52188481, "link": "https://stackoverflow.com/questions/52188481/graceful-shutdown-of-a-process", "title": "Graceful shutdown of a process", "body": "<p>I want to close a store connection (adding a function like <code>close eventStoreConnection</code>) when the process is about to shutdown :</p>\n\n<pre><code>main = do\n     eventStoreConnection &lt;- EventStore.connect EventStore.defaultSettings (EventStore.Static \"127.0.0.1\" 1113)\n     scotty 3000 $ do\n       get  \"/health/liveness\" $ do html \"OK\"\n       post \"/introduceIdea\" $ do\n          command &lt;- jsonData\n          liftIO $ persist eventStoreConnection command\n          html \"OK\"\n</code></pre>\n"}, {"tags": ["haskell", "pointfree", "partial-application"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1536166448, "post_id": 52187970, "comment_id": 91329911, "body": "It helps if you remember that there&#39;s really no such thing as a partially applied function; you either apply a function to its single required argument or not. <code>(+)</code> is a function that takes an argument and returns <i>another</i> function, and Haskell&#39;s syntax lets you pretend that <code>(+) 3 5</code> is a function applied to two arguments, something that is harder to do with the explicitly parenthesized version <code>((+) 3) 5</code>. In some sense, a &quot;fully applied&quot; function is just an expression that doesn&#39;t return another function."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9640427"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1536214886, "post_id": 52187970, "comment_id": 91344501, "body": "good answer, thanks"}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1536161303, "post_id": 52188131, "comment_id": 91327257, "body": "I always found it ironic how point-free Haskell code is particularly littered with <code>.</code> points..."}], "tags": [], "owner": {"reputation": 3969, "user_id": 187261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/994de0373c6a35a5f7108b274d0b1cb9?s=128&d=identicon&r=PG", "display_name": "Nazarii Bardiuk", "link": "https://stackoverflow.com/users/187261/nazarii-bardiuk"}, "is_accepted": true, "score": 3, "last_activity_date": 1536160221, "last_edit_date": 1536160221, "creation_date": 1536159204, "answer_id": 52188131, "question_id": 52187970, "link": "https://stackoverflow.com/questions/52187970/point-free-style-and-partially-applied-functions/52188131#52188131", "title": "point-free style and partially applied functions", "body": "<p>Pointfree style - a style of function implementation</p>\n\n<p>Partially applied function - it is a technique of creating new functions</p>\n\n<p>Point-free uses partially applied functions but there are other techniques and combinators <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Pointfree</a></p>\n\n<p>Another common Pointfree technique is function composition</p>\n\n<pre><code>plus2 = increment . increment\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9640427"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 52188131, "answer_count": 1, "score": 0, "last_activity_date": 1536166032, "creation_date": 1536158794, "last_edit_date": 1536166032, "question_id": 52187970, "link": "https://stackoverflow.com/questions/52187970/point-free-style-and-partially-applied-functions", "title": "point-free style and partially applied functions", "body": "<p>In Haskell there are two concepts that doesn't look like they are the same, but I don't understand the difference. They are \"point-free style\" and \"partially applied functions\".</p>\n\n<p>For point-free styles I'm going to get <a href=\"https://en.wikipedia.org/wiki/Tacit_programming\" rel=\"nofollow noreferrer\">this</a> example:</p>\n\n<pre><code>instead of: sum xs = foldr (+) 0 xs\nwe can use: sum = foldr (+) 0\n</code></pre>\n\n<p>Because <code>xs</code> is on both sides we can omit it.</p>\n\n<p>And for partially applied functions, I'm going to get <a href=\"https://stackoverflow.com/a/47699454\">this</a> example:</p>\n\n<pre><code>increment = add 1   \n</code></pre>\n\n<p>which could be <code>increment n = add 1 n</code>, because at the moment of calling it, you need to do it with the argument, just as the first example.</p>\n\n<p>So, what's the real difference between them?</p>\n\n<p>But, for me, in the end it's the same.</p>\n"}, {"tags": ["haskell", "typeclass", "existential-type", "associated-types"], "answers": [{"comments": [{"owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "edited": false, "score": 0, "creation_date": 1536178217, "post_id": 52188523, "comment_id": 91335191, "body": "Thanks for your reply. I&#39;ve edited the original post with my original intent, as you&#39;ve requested."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "edited": false, "score": 0, "creation_date": 1536178701, "post_id": 52188523, "comment_id": 91335379, "body": "Ok, but this description is a bit vague. Perhaps you should properly explain it in a new question. What you want might be only doable with Template Haskell, or simply with GHC generics."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1536160493, "creation_date": 1536160493, "answer_id": 52188523, "question_id": 52187916, "link": "https://stackoverflow.com/questions/52187916/how-to-write-a-type-instance-for-a-compound-type-having-existentially-quantified/52188523#52188523", "title": "How to write a type instance for a compound type having existentially quantified type variables?", "body": "<p>It can't be done. An existentially quantified type is only chosen at runtime, whereas a type family instantiation (associated or otherwise) must be fixed at compile time.</p>\n\n<p>This is probably an <a href=\"https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">XY problem</a>. Instead of an associated type family, you should deal with the type information in some other way, but it would require knowledge of the problem you're trying to solve to say how.</p>\n"}], "owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536178164, "creation_date": 1536158620, "last_edit_date": 1536178164, "question_id": 52187916, "link": "https://stackoverflow.com/questions/52187916/how-to-write-a-type-instance-for-a-compound-type-having-existentially-quantified", "title": "How to write a type instance for a compound type having existentially quantified type variables?", "body": "<p>I have a typeclass with an associated type:</p>\n\n<pre><code>class Foo a where\n  type Bar a :: *\n  ...\n</code></pre>\n\n<p>Now, I'd like to instance this class for a compound type containing existentially quantified type variables:</p>\n\n<pre><code>data Blat = forall a. Blat a\n\ninstance Foo Blat where\n  type Bar Blat = ???\n</code></pre>\n\n<p>In my actual application, the \"???\" needs to make use of the existentially hidden \"a\" in <code>Blat a</code>, in order for the program logic to be correct.</p>\n\n<p>Is this doable in Haskell?<br>\nIf so, how?</p>\n\n<p>===</p>\n\n<p>In response to @leftaroundabout 's request for full disclosure of my original intent:</p>\n\n<p>I'm trying to build representations of types, using only a small set of \"primitives\" (i.e. - unit, sum, and product).\nAnd, for compound types, I'd like to enlist the help of the pre-existing representation instances for the fields making up the new type.\nFor explicitly parameterized field types this is straightforward.\nHowever, I'd like to be able to do it for field types using existentially hidden type parameters, also.</p>\n"}, {"tags": ["haskell", "numbers", "tuples"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1536157813, "post_id": 52187553, "comment_id": 91324883, "body": "<a href=\"https://hackage.haskell.org/package/bifunctors-3.2.0.1/docs/Data-Biapplicative.html#v:biliftA2\" rel=\"nofollow noreferrer\"><code>biliftA2 (+)</code></a>?"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1536158026, "creation_date": 1536158026, "answer_id": 52187690, "question_id": 52187553, "link": "https://stackoverflow.com/questions/52187553/sum-tuples-of-num-instances/52187690#52187690", "title": "Sum tuples of Num instances", "body": "<p>Use <a href=\"http://hackage.haskell.org/package/vector-space\" rel=\"noreferrer\">vector-space</a>.</p>\n\n<pre><code>Prelude&gt; :m +Data.VectorSpace\nPrelude Data.VectorSpace&gt; (1,2) ^+^ (3,4)\n(4,6)\nPrelude Data.VectorSpace&gt; (1,2,5) ^+^ (3,4,6)\n(4,6,11)\nPrelude Data.VectorSpace&gt; ((1,2),(9,8)) ^+^ ((3,4),(6,7))\n((4,6),(15,15))\nPrelude Data.VectorSpace&gt; ((1,2),(9,8)) ^+^ ((3,4),0)  -- dimension mismatch\n\n&lt;interactive&gt;:5:1: error:\n    \u2022 No instance for (Num (Integer, Integer))\n        arising from a use of \u2018it\u2019\n    \u2022 In the first argument of \u2018print\u2019, namely \u2018it\u2019\n      In a stmt of an interactive GHCi command: print it\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3969, "user_id": 187261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/994de0373c6a35a5f7108b274d0b1cb9?s=128&d=identicon&r=PG", "display_name": "Nazarii Bardiuk", "link": "https://stackoverflow.com/users/187261/nazarii-bardiuk"}, "is_accepted": false, "score": 5, "last_activity_date": 1536159076, "last_edit_date": 1536159076, "creation_date": 1536158099, "answer_id": 52187720, "question_id": 52187553, "link": "https://stackoverflow.com/questions/52187553/sum-tuples-of-num-instances/52187720#52187720", "title": "Sum tuples of Num instances", "body": "<p>Pair implements Monoid if both elements are Monoids.</p>\n\n<p>For Num you can use newtype wrapper to choose Monoid</p>\n\n<pre><code>&gt; :m +Data.Monoid\n&gt; (Sum 1, Sum 2) &lt;&gt; (Sum 3, Sum 4)\n(Sum {getSum = 4},Sum {getSum = 6})\n</code></pre>\n\n<p>You can then add the two numbers together by uncurrying <code>&lt;&gt;</code>:</p>\n\n<pre><code>&gt; uncurry (&lt;&gt;) $ (Sum 1, Sum 2) &lt;&gt; (Sum 3, Sum 4)\nSum {getSum = 10}\n</code></pre>\n"}], "owner": {"reputation": 1453, "user_id": 2018010, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/fwCYF.gif?s=128&g=1", "display_name": "magras", "link": "https://stackoverflow.com/users/2018010/magras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 52187690, "answer_count": 2, "score": 0, "last_activity_date": 1536159076, "creation_date": 1536157645, "question_id": 52187553, "link": "https://stackoverflow.com/questions/52187553/sum-tuples-of-num-instances", "title": "Sum tuples of Num instances", "body": "<p>Is there a standard way to sum tuples of <code>Num</code>s?</p>\n\n<pre><code>(1, 2) + (3, 4)\n</code></pre>\n\n<p>I think there are many ways to achieve this. To name a few: writing your own function/operator, making <code>(Num a, Num b) =&gt; (a, b)</code> an instance of <code>Num</code>, wrapping a tuple in a <code>newtype</code> and so on.</p>\n\n<p>It seems like this problem should emerge regularly, but I don't see any standard solutions at google or SO search results. Am I missing something?</p>\n"}, {"tags": ["haskell", "networking", "web", "https"], "comments": [{"owner": {"reputation": 31408, "user_id": 243245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aed5c13647d581ae231f019a886e05a8?s=128&d=identicon&r=PG", "display_name": "Rup", "link": "https://stackoverflow.com/users/243245/rup"}, "edited": false, "score": 0, "creation_date": 1536155871, "post_id": 52186630, "comment_id": 91323615, "body": "When you say &quot;not working&quot; you mean it&#39;s connecting fine but not passing the username and password?"}, {"owner": {"reputation": 13, "user_id": 5073326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00f7e1b7d119c235eed54e8f3c9b7d4e?s=128&d=identicon&r=PG&f=1", "display_name": "andreib", "link": "https://stackoverflow.com/users/5073326/andreib"}, "reply_to_user": {"reputation": 31408, "user_id": 243245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aed5c13647d581ae231f019a886e05a8?s=128&d=identicon&r=PG", "display_name": "Rup", "link": "https://stackoverflow.com/users/243245/rup"}, "edited": false, "score": 1, "creation_date": 1536156346, "post_id": 52186630, "comment_id": 91323937, "body": "I get a &#39;Name or service not known&#39; message"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 5073326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00f7e1b7d119c235eed54e8f3c9b7d4e?s=128&d=identicon&r=PG&f=1", "display_name": "andreib", "link": "https://stackoverflow.com/users/5073326/andreib"}, "edited": false, "score": 0, "creation_date": 1536156593, "post_id": 52186765, "comment_id": 91324100, "body": "Thank you very much, but I have another stupid question. How can I download &quot;Network.HTTP.Simple&quot; using cabal? The &quot;cabal install Simple&quot; seems to install another &quot;Simple&quot; library"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 13, "user_id": 5073326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00f7e1b7d119c235eed54e8f3c9b7d4e?s=128&d=identicon&r=PG&f=1", "display_name": "andreib", "link": "https://stackoverflow.com/users/5073326/andreib"}, "edited": false, "score": 0, "creation_date": 1536156805, "post_id": 52186765, "comment_id": 91324230, "body": "@wasabi Network.HTTP.Simple is from the package http-conduit: <a href=\"https://www.stackage.org/haddock/lts-12.9/http-conduit-2.3.2/Network-HTTP-Simple.html\" rel=\"nofollow noreferrer\">stackage.org/haddock/lts-12.9/http-conduit-2.3.2/&hellip;</a>  You can start by creating a cabal project and specifying the dependency of the package there. Another alternative (which I strongly recommend) is to use Stack: <a href=\"https://docs.haskellstack.org/en/stable/\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable</a>  A quick way of running haskell scripts is to use script interpreter feature: <a href=\"https://docs.haskellstack.org/en/stable/GUIDE/#script-interpreter\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/GUIDE/#script-interpreter</a>"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1536155320, "creation_date": 1536155320, "answer_id": 52186765, "question_id": 52186630, "link": "https://stackoverflow.com/questions/52186630/https-authentication-using-haskell/52186765#52186765", "title": "https authentication using Haskell", "body": "<p>A sample example using the package <code>http-client</code>:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack script --resolver lts-12.7\n{-# LANGUAGE OverloadedStrings #-}\nimport qualified Data.ByteString.Lazy.Char8 as L8\nimport           Network.HTTP.Client        (defaultManagerSettings, Manager, applyBasicAuth)\nimport           Network.HTTP.Simple\nimport Network.HTTP.Client.TLS (getGlobalManager)\n\nmain :: IO ()\nmain = do\n    manager &lt;- getGlobalManager\n\n    printResponse manager \"http://some-domain.com\"\n\n\nprintResponse :: Manager -&gt; Request -&gt; IO ()    \nprintResponse mgr url = do\n  let request = setRequestManager mgr url\n      request' = applyBasicAuth \"user\" \"password\" request\n  response &lt;- httpLBS request'\n\n  putStrLn $ \"The status code was: \" ++  show (getResponseStatusCode response)\n  print $ getResponseHeader \"Content-Type\" response\n  L8.putStrLn $ getResponseBody response\n</code></pre>\n\n<p>Some Reference documentation:</p>\n\n<ul>\n<li><a href=\"https://haskell-lang.org/library/http-client\" rel=\"nofollow noreferrer\">https://haskell-lang.org/library/http-client</a></li>\n<li><a href=\"https://www.stackage.org/haddock/lts-12.9/http-client-0.5.13.1/Network-HTTP-Client.html#v:applyBasicAuth\" rel=\"nofollow noreferrer\">https://www.stackage.org/haddock/lts-12.9/http-client-0.5.13.1/Network-HTTP-Client.html#v:applyBasicAuth</a></li>\n</ul>\n"}], "owner": {"reputation": 13, "user_id": 5073326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00f7e1b7d119c235eed54e8f3c9b7d4e?s=128&d=identicon&r=PG&f=1", "display_name": "andreib", "link": "https://stackoverflow.com/users/5073326/andreib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 2, "accepted_answer_id": 52186765, "answer_count": 1, "score": 1, "last_activity_date": 1536155320, "creation_date": 1536154900, "question_id": 52186630, "link": "https://stackoverflow.com/questions/52186630/https-authentication-using-haskell", "title": "https authentication using Haskell", "body": "<p>I'm trying to write a haskell program that accesses a https url, where a file is automatically downloaded. The site requests authentication. \nI tried using the <a href=\"https://hackage.haskell.org/package/req\" rel=\"nofollow noreferrer\">Req</a> library but I couldn't understand all the web and networking concepts.</p>\n\n<p>Can anyone give me some template code or at least to tell me more precisely where i can find the functions I need?</p>\n\n<p>This is the code I wrote so far, but is'n not working:</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.IO.Class\nimport Data.Aeson\nimport Data.Default.Class\nimport Data.Maybe (fromJust)\nimport Data.Monoid ((&lt;&gt;))\nimport Data.Text as T\nimport GHC.Generics\nimport Network.HTTP.Req\nimport qualified Data.ByteString.Char8 as B\n\nmain = runReq def $ do\n    let myMethod = GET\n        myUrl = https $ T.pack \"https://...\"\n        myBody = NoReqBody\n        myProxy = ignoreResponse\n        myOption = basicAuth (B.pack \"user\") (B.pack \"password\")\n    m &lt;- req myMethod myUrl myBody myProxy myOption\n    return ()\n</code></pre>\n"}, {"tags": ["haskell", "parallel-processing", "hxt"], "answers": [{"comments": [{"owner": {"reputation": 152, "user_id": 3832665, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/520fa46dfc3474e5183d8810bc4ee58b?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/3832665/james"}, "edited": false, "score": 0, "creation_date": 1536346472, "post_id": 52223484, "comment_id": 91405873, "body": "Well I&#39;ve tested your diagnostics on why it still runs in one thread and you are completely correct! I&#39;ll get to work trying to get it fixed now! You have been a great help!"}], "tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": false, "score": 0, "last_activity_date": 1536326596, "creation_date": 1536326596, "answer_id": 52223484, "question_id": 52186329, "link": "https://stackoverflow.com/questions/52186329/parallel-haskell-with-hxt/52223484#52223484", "title": "Parallel Haskell with HXT", "body": "<p>First, it looks like you mislabeled the signature of <code>exec</code>, which should probably be:</p>\n\n<pre><code>exec :: FilePath -&gt; IO [CV_scene]\n</code></pre>\n\n<p>Now for the important part. I've commented inline on what I think you think is going on.</p>\n\n<pre><code>pExec xs = do\n   -- A. Parse the file found at each location via exec.\n   ex &lt;- mapM exec xs\n   -- B. Force the lazy parsing in parallel.\n   as &lt;- ex `usingIO` parList rdeepseq\n   return as\n</code></pre>\n\n<p>Note that line A does not happen in paralell, which you might think is okay since it will just set up the parsing thunks which are forced in parallel in B. This is a fair assumption, and a clever use of laziness, but the results pull that into question for me.</p>\n\n<p>I suspect that the implementation of <code>exec</code> forces most of the parsing before line B is even reached so that the deep seq doesn't do much. That fits pretty well with my experince parsing and the profiling supports that explanation.</p>\n\n<p>Without the ability to test your code, I can only make the following suggestions. First try separating the parsing of the file from the IO and put the parsing in the parallel execution strategy. In that case lines A and B become something like:</p>\n\n<pre><code>ex &lt;- mapM readFile xs\nas &lt;- ex `usingIO` parList (rdeepseq . exec')\n</code></pre>\n\n<p>with <code>exec'</code> the portion of <code>exec</code> after the file is read from disk.</p>\n\n<pre><code>    exec' :: FilePath -&gt; [CVScene]\n</code></pre>\n\n<p>Also, you may not even need <code>rdeepSeq</code> after this change.</p>\n\n<p>As an alternative, you can do the IO and parsing in parallel using Software Transactional Memory. STM approaches are normally used for separate IO threads which act more like services, rather than pure computations. But if for some reason you cant get the strategies based approach to work, this might be worth a try.</p>\n\n<pre><code>import Control.Concurrent.STM.TChan --(from stm package)\nimport Control.Concurrent(forkIO)\n\npExec'' :: [FilePath] -&gt; IO [[CVSene]]\npExec'' xs = do\n  -- A. create [(Filename,TChan [CVScene])]\n  tcx &lt;- mapM (\\x -&gt; (x,) &lt;$&gt; newTChanIO) xs\n  -- B. do the reading/parsing in separate threads\n  mapM_ (forkIO . exec'') tcx\n  -- C. Collect the results\n  cvs &lt;- mapM (atomically . readTChan . snd) tcx\n\nexec'' :: [(FilePath,TChan [CVScene])] -&gt; IO ()\nexec'' (x,tch) = do\n  --D. The original exec function\n  cv &lt;- exec x\n  --E. Put on the channel fifo buffer\n  atomically $ writeTChan tch cv\n</code></pre>\n\n<p>Good luck!</p>\n"}], "owner": {"reputation": 152, "user_id": 3832665, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/520fa46dfc3474e5183d8810bc4ee58b?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/3832665/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1536326596, "creation_date": 1536154009, "last_edit_date": 1536155357, "question_id": 52186329, "link": "https://stackoverflow.com/questions/52186329/parallel-haskell-with-hxt", "title": "Parallel Haskell with HXT", "body": "<p>I'm trying to get performance increases in a program I have that parses XML. The program can parse multiple XML files so I thought that I could make this run in parallel, but all my attempts have resulted in lower performance!</p>\n\n<p>For XML parsing, I am using HXT.</p>\n\n<p>I have a run function defined like this:</p>\n\n<pre><code>run printTasks xs = pExec xs &gt;&gt;= return . concat &gt;&gt;= doPrint printTasks 1\n</code></pre>\n\n<p>'pExec' is given a list of file names and is defined as:</p>\n\n<pre><code>pExec xs = do\n   ex &lt;- mapM exec xs\n   as &lt;- ex `usingIO` parList rdeepseq\n   return as\n</code></pre>\n\n<p>where 'exec' is defined as:</p>\n\n<pre><code>exec = runX . process\n</code></pre>\n\n<p>threadscope shows only one thread e ver being used (until the very end).</p>\n\n<p>Can anyone explain why I have failed so miserably to parallelise this code?</p>\n\n<p>In case it helps:</p>\n\n<pre><code>exec :: FilePath -&gt; [CV_scene]\npExec :: [FilePath] -&gt; IO [[CV_scene]]\n\ndata CV_scene = Scene [CV_layer] Time deriving (Show)\ndata CV_layer = Layer [DirtyRects] SourceCrop deriving (Show)\ndata Rect     = Rect Int Int Int Int deriving (Show)-- Left Top Width Height\n\ninstance NFData CV_scene where\n  rnf = foldScene reduceScene\n    where reduceScene l t = rnf (seq t l)\n\ninstance NFData CV_layer where\n  rnf = foldLayer reduceLayer\n    where reduceLayer d s = rnf (seq s d)\n\ninstance NFData Rect where\n  rnf = foldRect reduceRect\n    where reduceRect l t w h = rnf [l,t,w,h]\n\ntype SourceCrop = Rect\ntype DirtyRect  = Rect\ntype Time       = Int64\n</code></pre>\n\n<p>Thanks in advance for your help!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1536150745, "post_id": 52185187, "comment_id": 91320155, "body": "You can use <code>fromEnum</code>: <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:fromEnum\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.11.1.0/docs/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 429, "user_id": 9397607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23e35277fb9d355d70b0ae2f9472010e?s=128&d=identicon&r=PG", "display_name": "Jonas De Schouwer", "link": "https://stackoverflow.com/users/9397607/jonas-de-schouwer"}, "edited": false, "score": 0, "creation_date": 1605043473, "post_id": 52185292, "comment_id": 114531146, "body": "Can you do this the other way around?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 429, "user_id": 9397607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23e35277fb9d355d70b0ae2f9472010e?s=128&d=identicon&r=PG", "display_name": "Jonas De Schouwer", "link": "https://stackoverflow.com/users/9397607/jonas-de-schouwer"}, "edited": false, "score": 0, "creation_date": 1605043527, "post_id": 52185292, "comment_id": 114531163, "body": "@JonasDeSchouwer: what should be the result for values not equal to <code>0</code>/<code>1</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 429, "user_id": 9397607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23e35277fb9d355d70b0ae2f9472010e?s=128&d=identicon&r=PG", "display_name": "Jonas De Schouwer", "link": "https://stackoverflow.com/users/9397607/jonas-de-schouwer"}, "edited": false, "score": 0, "creation_date": 1605043577, "post_id": 52185292, "comment_id": 114531176, "body": "@JonasDeSchouwer: you can make use of <code>toEnum 0 :: Bool</code> to convert <code>0</code> to <code>False</code> and <code>1</code> to <code>True</code>. But this will raise an error for values outside the <code>0</code>/<code>1</code> range."}, {"owner": {"reputation": 429, "user_id": 9397607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23e35277fb9d355d70b0ae2f9472010e?s=128&d=identicon&r=PG", "display_name": "Jonas De Schouwer", "link": "https://stackoverflow.com/users/9397607/jonas-de-schouwer"}, "edited": false, "score": 0, "creation_date": 1605045506, "post_id": 52185292, "comment_id": 114531894, "body": "I didn\u2019t really care for values different from 0/1. It was for homework that I needed to define some different implementations of the not function. I based myself on the previous answer to find the fancy not = even.fromEnum. If one does not care about \u2018fanciness\u2019, you can just use x/=0."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 429, "user_id": 9397607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23e35277fb9d355d70b0ae2f9472010e?s=128&d=identicon&r=PG", "display_name": "Jonas De Schouwer", "link": "https://stackoverflow.com/users/9397607/jonas-de-schouwer"}, "edited": false, "score": 0, "creation_date": 1605045585, "post_id": 52185292, "comment_id": 114531925, "body": "@JonasDeSchouwer: well you can use <code>toEnum</code>, but unless some signature of the caller forces it to be a <code>Bool</code>, you thus will have to specify a type hint, so <code>toEnum 0 :: Bool</code>, <code>toEnum 1 :: Bool</code> will return <code>False</code> and <code>True</code> respectively."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 11, "last_activity_date": 1536153106, "last_edit_date": 1536153106, "creation_date": 1536150954, "answer_id": 52185292, "question_id": 52185187, "link": "https://stackoverflow.com/questions/52185187/haskell-treating-bool-as-int/52185292#52185292", "title": "Haskell: Treating Bool as Int", "body": "<p><code>Bool</code> is an instance of <code>Enum</code>: you can enumerate the two values of a <code>Bool</code>: <code>False</code>, and then <code>True</code>.</p>\n\n<p>As a result, it implements the <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:fromEnum\" rel=\"noreferrer\"><strong><code>fromEnum :: Enum a =&gt; a -&gt; Int</code></strong></a>, a function that maps a value of an <code>Enum</code> type to an <code>Int</code>: for a <code>Bool</code>, it maps <code>False</code> to <code>0</code>, and <code>True</code> to <code>1</code>.</p>\n\n<p>So we can use this like:</p>\n\n<pre><code>result = 5 - fromEnum cond1 - fromEnum cond2\n</code></pre>\n\n<p>Or for example with a list of conditions:</p>\n\n<pre><code>result = 5 - sum (map fromEnum [cond1, cond2, cond3])\n</code></pre>\n\n<p>where <code>cond1</code> and <code>cond2</code>, etc. are expressions of type <code>Bool</code>.</p>\n"}], "owner": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5737, "favorite_count": 1, "accepted_answer_id": 52185292, "answer_count": 1, "score": 7, "last_activity_date": 1536153106, "creation_date": 1536150653, "question_id": 52185187, "link": "https://stackoverflow.com/questions/52185187/haskell-treating-bool-as-int", "title": "Haskell: Treating Bool as Int", "body": "<p>How would one implement a function that started with an int, and subtracted 1 from it for every time (going through a finite number of possibilities) one of several (for example, 5) boolean values returned 1.</p>\n\n<p>How this would ideally look look is:</p>\n\n<pre><code>function list1 list2 = num\n  where\n      num = 4\n          - (condition from var1 = true)\n          - (condition from var2 = true)\n          - (so on, so forth as long as needed)\n</code></pre>\n\n<p>I have tried implementing these lines similarly to:</p>\n\n<pre><code>      num = startVal\n          - (list1conditional == desiredVal)\n          - (etc)\n</code></pre>\n\n<p>But this is returning type errors.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "is_accepted": false, "score": 0, "last_activity_date": 1536180996, "creation_date": 1536180996, "answer_id": 52193281, "question_id": 52184132, "link": "https://stackoverflow.com/questions/52184132/instance-for-regexmaker-regex-compoption-execoption-text-missing-when-using/52193281#52193281", "title": "instance for RegexMaker Regex CompOption ExecOption Text missing when using (=~)", "body": "<p>Missing is an import of the instances in <code>Text.Regex.TDFA.Text</code> (only the instances). Thus:</p>\n\n<pre><code>import Text.Regex.TDFA\nimport Text.Regex.TDFA.Text ()\n</code></pre>\n\n<p>It is unfortunate that there is so little up-to-date documentation and two many different implementations of regex for haskell. I took hours to identify which packages work together. </p>\n\n<p>I found the <a href=\"https://gabebw.com/blog/2015/10/11/regular-expressions-in-haskell\" rel=\"nofollow noreferrer\">blog</a> useful.</p>\n"}], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 19, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536180996, "creation_date": 1536147179, "question_id": 52184132, "link": "https://stackoverflow.com/questions/52184132/instance-for-regexmaker-regex-compoption-execoption-text-missing-when-using", "title": "instance for RegexMaker Regex CompOption ExecOption Text missing when using (=~)", "body": "<p>I try to find a way to use regex to search in text and not adding a dependency for template haskell. \nMy simplistic example is</p>\n\n<pre><code>import Text.Regex.TDFA\n\nd = t1 =~ pat4 :: Text\npat4 = \"([12][0,6-9][0-9][0-9])\" :: Text\nt1 = \"foodiebar 1933 some more 19456 text \" :: Text\n</code></pre>\n\n<p>The code works for <code>Text.Regex.PCRE</code> for <code>String</code> but when I change to Text and import <code>Text.Regex.TDFA</code> the compiler produces:</p>\n\n<pre><code>RegexMaker Regex CompOption ExecOption Text\n</code></pre>\n\n<p>what is additionally required? </p>\n"}, {"tags": ["forms", "haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "is_accepted": true, "score": 0, "last_activity_date": 1536461966, "creation_date": 1536461966, "answer_id": 52240963, "question_id": 52182020, "link": "https://stackoverflow.com/questions/52182020/handling-a-collection-of-data-in-a-yesod-form/52240963#52240963", "title": "Handling a collection of data in a Yesod Form", "body": "<p>You could create your own <code>FormInput</code> by defining the <code>unFormInput</code> function. This function could pull the field names from the form, extract the keys, and then you could use <code>ireq</code> to promote the relevant fields.</p>\n\n<p>This could look something like</p>\n\n<pre><code>getPeople :: FormInput (your handler type) [People]\ngetPeople = FormInput $ \\m l env fenv -&gt;\n    (unFormInput (peopleField peopleKeys)) m l env fenv\n        where\n            peopleKeys = getPeopleKeys env\n</code></pre>\n\n<h1>getPeopleKeys</h1>\n\n<p>This helper function would produce all the key values for the people in your form. They wouldn't need to be valid yet, since field parsing will take care of that later.</p>\n\n<pre><code>getPeopleKeys :: Env -&gt; [Text]\ngetPeopleKeys env = mapMaybe extractKey (keys env)\n    where\n        extractKey :: Text -&gt; Maybe Text\n        extractKey key = ... -- you could use e.g. regex here\n                             -- to pull the keys out of the field names\n                             -- and return Nothing otherwise\n</code></pre>\n\n<h1>peopleField</h1>\n\n<p>This helper produces the <code>FormInput</code>. It </p>\n\n<ol>\n<li>takes a list of keys, </li>\n<li>generates a <code>FormInput</code> from each one\n\n<ol>\n<li>generates a field for the first name and last name</li>\n<li>turns those fields into <code>FormInput</code>s</li>\n<li>produces a <code>FormInput</code> which combines them into a <code>Person</code></li>\n</ol></li>\n<li>concatenates the <code>FormInput</code>s' results into a <code>FormInput ... [Person]</code></li>\n</ol>\n\n<hr>\n\n<pre><code>peopleField :: Monad m =&gt; RenderMessage (HandlerSite m) FormMessage =&gt; [Text] -&gt; FormInput m [Person]\npeopleField = mapM personField\n    where\n        personField :: Text -&gt; Field ... Person\n        personField key = (liftA2 (Person)) (personFNameField) (personLNameField)\n            where\n                personFNameField = (ireq hiddenField) . fNameField key\n                personLNameField = (ireq hiddenField) . lNameField key\n\nfNameField key = ... -- this outputs \"person[${key}][firstName]\"\nlNameField key = ... -- etc.\n</code></pre>\n"}], "owner": {"reputation": 2447, "user_id": 2061783, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5fc1d7081d9f24bd0307795baea57d56?s=128&d=identicon&r=PG", "display_name": "danbroooks", "link": "https://stackoverflow.com/users/2061783/danbroooks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 52240963, "answer_count": 1, "score": 2, "last_activity_date": 1536510919, "creation_date": 1536140730, "last_edit_date": 1536510919, "question_id": 52182020, "link": "https://stackoverflow.com/questions/52182020/handling-a-collection-of-data-in-a-yesod-form", "title": "Handling a collection of data in a Yesod Form", "body": "<p>Is it possible in <a href=\"https://en.wikipedia.org/wiki/Yesod_(web_framework)\" rel=\"nofollow noreferrer\">Yesod</a> to handle forms that contain a collection of data? </p>\n\n<p>I have a form that the user can add multiple people to, on the frontend it currently looks like this:</p>\n\n<pre><code>{ people.map((person, key) =&gt; (\n  &lt;td&gt;\n    &lt;input type=\"hidden\" name={ `person[${key}][firstName]` } value={person.firstName} /&gt;\n    &lt;input type=\"hidden\" name={ `person[${key}][lastName]` } value={person.lastName} /&gt;\n    { person.firstName } { person.lastName }\n  &lt;/td&gt;\n)) }\n</code></pre>\n\n<p>I then want to be able to translate that over to the backend like so:</p>\n\n<pre><code>[Person \"Michael\" \"Snoyman\", Person \"Ed\" \"Kmett\"]\n</code></pre>\n\n<p>This list is variable in length, so it could have as many people in the <code>people</code> value as the user likes. So far I've been unable to work out how to replicate this kind of thing using <code>FormInput</code> in Yesod.</p>\n"}, {"tags": ["haskell", "data-structures"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1536142391, "post_id": 52181594, "comment_id": 91314988, "body": "Could you say a bit more about how you intend to use these models?  There will be very different answers depending on if you intend to, for example, draw these graphs, versus use them as the specification of a parallel computation, versus something else."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1536143061, "post_id": 52181594, "comment_id": 91315388, "body": "@luqui I extended my question, Hope it helps."}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "edited": false, "score": 0, "creation_date": 1536145473, "post_id": 52181594, "comment_id": 91316818, "body": "I suggest looking into zippers: <a href=\"http://learnyouahaskell.com/zippers\" rel=\"nofollow noreferrer\">learnyouahaskell.com/zippers</a>"}], "answers": [{"comments": [{"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1536148630, "post_id": 52183965, "comment_id": 91318783, "body": "Thanks for such extended answer. I already have lexer and parser which give me AST. Unfortunately idea which I want to try require a graph."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1536148979, "post_id": 52183965, "comment_id": 91319035, "body": "@talex ah I <i>have</i> assumed wrong!  You might want to look at hoopl (<a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/07/hoopl-haskell10.pdf\" rel=\"nofollow noreferrer\">paper</a> , <a href=\"http://hackage.haskell.org/package/hoopl\" rel=\"nofollow noreferrer\">library</a>) which is for dataflow analysis graphs."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 0, "last_activity_date": 1536147671, "last_edit_date": 1536147671, "creation_date": 1536146610, "answer_id": 52183965, "question_id": 52181594, "link": "https://stackoverflow.com/questions/52181594/suggestions-for-graph-like-data-structure/52183965#52183965", "title": "Suggestions for graph-like data structure", "body": "<p>Here's an indirect answer.  The vagueness of your question indicates you might be new to Haskell, forgive me if I have assumed wrong.  </p>\n\n<p>Graphs are not so nice to work with in pure FP, especially compared to how nice <a href=\"https://www.schoolofhaskell.com/school/starting-with-haskell/introduction-to-haskell/2-algebraic-data-types\" rel=\"nofollow noreferrer\">algebraic data types</a> (ADTs) are to work with.  ADTs are the usual way to represent abstract syntax, which is in turn what compilers usually manipulate and optimize (until you start generating machine code, where graphs do start to come into play more).</p>\n\n<p>Here is a ADT for a very simple imperative language to whet your appetite:</p>\n\n<pre><code>data Statement\n    = Assign String Expr\n    | Print Expr\n    | If Expr Statement Statement\n    | Block [Statement]\n\ndata Expr\n    = Variable String\n    | Add Expr Expr\n    | Multiply Expr Expr\n    | Constant Integer\n</code></pre>\n\n<p>The usual way to do a language is to define a type like this corresponding to the capabilities of your language, and organize most of the work around this type.  You use a <a href=\"https://wiki.haskell.org/Parsing_a_simple_imperative_language\" rel=\"nofollow noreferrer\">parser</a> to get from real source code to this representation.</p>\n\n<p>I have heard good things about <a href=\"https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours\" rel=\"nofollow noreferrer\">Write Yourself A Scheme in 48 Hours</a> both as an introduction to Haskell and as a simple implementation of a programming language using the standard tools. </p>\n\n<p>Beyond that, <a href=\"https://www.microsoft.com/en-us/research/publication/implementing-functional-languages-a-tutorial/?from=http%3A%2F%2Fresearch.microsoft.com%2Fen-us%2Fum%2Fpeople%2Fsimonpj%2Fpapers%2Fpj-lester-book%2F\" rel=\"nofollow noreferrer\">Implementing Functional Languages: A Tutorial</a> (by Simon Peyton Jones, the main guy behind GHC, and David Lester) goes into a lot more of the nitty gritty detail about implementing specifically Haskell-like languages.  It's from 1992, and the language has evolved a lot, as well as new techniques discovered since then, but the book should still give a lot of guidance.</p>\n\n<p>Good luck!</p>\n"}, {"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": false, "score": 0, "last_activity_date": 1536154771, "creation_date": 1536154771, "answer_id": 52186582, "question_id": 52181594, "link": "https://stackoverflow.com/questions/52181594/suggestions-for-graph-like-data-structure/52186582#52186582", "title": "Suggestions for graph-like data structure", "body": "<p>Using a combination of Haskells module system and a <code>newtype</code> constructor, define a <code>newtype</code> which wraps a graph but don't export its constructor from the module. Instead of providing the constructor, provide methods to construct and work with your graph-like structure that enforce the required invariants. It would look something like this:</p>\n\n<pre><code>module SpecialGraph \n  ( SpecialGraph --not e.g. SpecialGraph(..)\n  , specialGraph) where\n\nimport Graph\n\nnewtype SpecialGraph = Sg Graph \n\nspecialGraph :: Graph -&gt; Maybe SpecialGraph\nspecialGraph gr = ...\n</code></pre>\n\n<p>The underlying <code>Graph</code> library on which you would base your new type could be one of several libraries found in Hackage. I have used <code>fgl</code>, \"The Functional Graph Library\", and like it.</p>\n\n<p>In your compiler, you would import this module and work with <code>SpecialGraph</code> via the functions it provides.</p>\n\n<p>This is a standard approach to solving problems which don't have an easy ADT-only representation. The general idea here is that we restrict a more general data structure at the term level (normal haskell expressions). The <code>fgl</code> graphs are implemented similarly, being restrictions and utilities on different kinds of <code>Maps</code>, which in turn (i believe) are based on restrictions and utilities on underlying trees. </p>\n"}, {"tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": false, "score": 1, "last_activity_date": 1536706177, "creation_date": 1536706177, "answer_id": 52285151, "question_id": 52181594, "link": "https://stackoverflow.com/questions/52181594/suggestions-for-graph-like-data-structure/52285151#52285151", "title": "Suggestions for graph-like data structure", "body": "<p>You actually have a lot of freedom to do what you want here: the main issue to work around is that plain ADTs don't give you mutable references. Here are a few examples that you might use to get started. You may even wish to use more than one and convert between them.</p>\n\n<pre><code>-- Here we have a pair of int indexed maps: the first one associates each\n-- vertex index with a vertex value and a list of edge indices, and the\n-- second one associates each edge index with an edge value and a pair of\n-- vertex indices.\ndata Graph e v = Graph (M.Map Int (v, [Int])) (M.Map Int (e,Int,Int))\n\n-- Here we use mutable references\nnewtype Graph s e v = Graph (STRef s (v,[(e,Graph s e v)]))\n\n-- Here we use a single map and assume each vertex value is unique\nnewtype Graph e v = Graph (M.map v [(e,v)])\n\n-- Single map again: but using ints to distinguish the vertices\nnewtype Graph e v = Graph (M.map Int (v,[(e,Int)]))\n</code></pre>\n"}], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1536706177, "creation_date": 1536139357, "last_edit_date": 1536143028, "question_id": 52181594, "link": "https://stackoverflow.com/questions/52181594/suggestions-for-graph-like-data-structure", "title": "Suggestions for graph-like data structure", "body": "<p>I need data structure to represent graph like model.</p>\n\n<ul>\n<li>It have nodes with inputs and outputs.</li>\n<li>Those inputs and outputs can be connected by links. </li>\n<li>One input can be connected to at most one output.</li>\n<li>One output can be connected to multiple inputs.</li>\n</ul>\n\n<p>Two operation on performed the most is:</p>\n\n<ul>\n<li>Combining two models (linking some inputs to outputs).</li>\n<li>Replacing subgraph with different one.</li>\n</ul>\n\n<p>What is best data structure to represent this model?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I will use it as part of my compiler. This model represent computation where nodes are computation blocks and links is data passed between them.</p>\n\n<p>I need to build this model from source code. This is why I need combine operation. I will process source code statement-by-statement and adjust model adding new computation steps.</p>\n\n<p>Also I want to \"optimize\" my computation with various heuristics. This is why I need replace part of this graph by more optimized graph (optimization itself is out of the scope of the question, but I need \"replace\" operation).</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 3, "creation_date": 1536132585, "post_id": 52178550, "comment_id": 91308919, "body": "As given, <code>myArray1</code> and <code>myArray2</code> are neither arrays nor two-dimensional; they&#39;re linked lists of quadruples. That doesn&#39;t seem to correspond to the pseudo code. Could you provide some actual examples of input values, and what you&#39;d expect the result to be?"}, {"owner": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1536132856, "post_id": 52178550, "comment_id": 91309091, "body": "Apologies, I&#39;ve edited it to answer your questions &amp; correct the types."}, {"owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "edited": false, "score": 0, "creation_date": 1536133312, "post_id": 52178550, "comment_id": 91309375, "body": "In the top, do you mean to count <code>a==e | a==e | a==m</code> , and <code>b== f | b==j | b==n</code> ? Because as stated, it doesn&#39;t seem to fit with the pseudocode."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 1, "creation_date": 1536133470, "post_id": 52178550, "comment_id": 91309470, "body": "Maybe I&#39;m missing something here, but up to the pseudocode it seems that you want to count the number of times any element in linkedList1 is equal to any element in linkedList2 regardless of the index. Could you provide an actual example?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1536133829, "post_id": 52178550, "comment_id": 91309690, "body": "Please provide <a href=\"https://stackoverflow.com/help/mcve\">a minimal, complete, and verifiable example</a>. I understand that you&#39;re asking for help with implementing a function, so we don&#39;t expect you to supply the code for such a function (although an attempt would be nice). Some code that represents sample input values, and what the expected output values should be, would be a start. That code ought to compile."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1536134535, "post_id": 52178550, "comment_id": 91310065, "body": "The code and specifications seem to contradict each other. Based on your code, you want to count the number of tuple elements that are the same, so where for every tuple <code>t1</code> in <code>l1</code>, and every tuple <code>t2</code> in <code>l2</code>, <code>t1[i] == t2[i]</code>."}, {"owner": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "edited": false, "score": 0, "creation_date": 1536134884, "post_id": 52178550, "comment_id": 91310265, "body": "I&#39;m sorry everyone, clearly the sudocode didn&#39;t help clarify, so I&#39;ve removed it entirely and tried to explain myself as well as possible using examples."}, {"owner": {"reputation": 3946, "user_id": 1261166, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vL1Ud.jpg?s=128&g=1", "display_name": "Viktor Mellgren", "link": "https://stackoverflow.com/users/1261166/viktor-mellgren"}, "edited": false, "score": 1, "creation_date": 1536136663, "post_id": 52178550, "comment_id": 91311326, "body": "I think what is causing confusion is <code>[(a, b, c, d), (e, f, g, h)]</code> list of quadruples. Whereas you say &quot;list in list&quot;, which should be <code>[[a, b, c, d], [e, f, g, h]]</code>"}, {"owner": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "edited": false, "score": 0, "creation_date": 1536136945, "post_id": 52178550, "comment_id": 91311494, "body": "Apologies i meant list of quadruples, I&#39;ll edit now!"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1536148788, "post_id": 52181289, "comment_id": 91318897, "body": "In <code>length [equalAt x y idx | x&lt;-xs, y&lt;-ys, equalAt x y idx]</code> The first <code>equalAt x y idx</code> is immaterial, and could be replaced by anything else, e.g. <code>()</code>. Otherwise, another alternative is <code>length . filter id $ [equalAt x y idx | x&lt;-xs, y&lt;-ys]</code>, but your code is probably simpler."}, {"owner": {"reputation": 3946, "user_id": 1261166, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vL1Ud.jpg?s=128&g=1", "display_name": "Viktor Mellgren", "link": "https://stackoverflow.com/users/1261166/viktor-mellgren"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1536152189, "post_id": 52181289, "comment_id": 91321060, "body": "Yeah, you are correct, started without the predicate, so needed to check the bool there, just as your other suggestion."}], "tags": [], "owner": {"reputation": 3946, "user_id": 1261166, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vL1Ud.jpg?s=128&g=1", "display_name": "Viktor Mellgren", "link": "https://stackoverflow.com/users/1261166/viktor-mellgren"}, "is_accepted": true, "score": 3, "last_activity_date": 1536152219, "last_edit_date": 1536152219, "creation_date": 1536138515, "answer_id": 52181289, "question_id": 52178550, "link": "https://stackoverflow.com/questions/52178550/haskell-array-loop-comparison-equivalent/52181289#52181289", "title": "Haskell: Array Loop Comparison Equivalent", "body": "<p>This is what I came up with:</p>\n\n<pre><code>howManyEqualAtIndex l1 l2 0\n=&gt; 2\nhowManyEqualAtIndex l1 l2 1\n=&gt; 2\nhowManyEqualAtIndex l1 l2 2\n=&gt; 1\nhowManyEqualAtIndex l1 l2 3\n=&gt; 0\n</code></pre>\n\n<hr>\n\n<pre><code>l1 = [('a', 'b', 'c', 'd'), ('e', 'f', 'g', 'h')]\nl2 = [('a', 'f', 'k', 'l'), ('a', 'b', 'g', 'm')]\n\n--List comprehension checking all combinations.\n--Predicate that they are equal\nhowManyEqualAtIndex xs ys idx = length [() | x&lt;-xs, y&lt;-ys, equalAt x y idx]\n\n--Hardcoded for quads, can be extended to other n-tuples,\n--or changed to list version commented out below\nequalAt (a,_,_,_) (b,_,_,_) 0 = a == b\nequalAt (_,a,_,_) (_,b,_,_) 1 = a == b\nequalAt (_,_,a,_) (_,_,b,_) 2 = a == b\nequalAt (_,_,_,a) (_,_,_,b) 3 = a == b\n\n--equalAt :: (Eq a) =&gt;  [a] -&gt; [a] -&gt; Int -&gt; Bool\n--equalAt xs ys idx = xs !! idx == ys !! idx\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 52181289, "answer_count": 1, "score": 0, "last_activity_date": 1536152355, "creation_date": 1536129329, "last_edit_date": 1536152355, "question_id": 52178550, "link": "https://stackoverflow.com/questions/52178550/haskell-array-loop-comparison-equivalent", "title": "Haskell: Array Loop Comparison Equivalent", "body": "<p>I am trying to compare certain aspects of two linked lists.</p>\n\n<p>The arrays both have format (assume a...p derive Eq):</p>\n\n<pre><code>linkedList1 = [(a, b, c, d), (e, f, g, h)]\nlinkedList2 = [(a, f, k, l), (a, b, g, m)]\n</code></pre>\n\n<p>What I hope to accomplish here is as follows:</p>\n\n<ul>\n<li><p>I want to input an index, to be referenced in each quadruple.</p></li>\n<li><p>For that index, I want to find out, for each quadruple in linkedList 1, how many times the value at that index is identical to the value at the same index in each of the quadruples in linkedList 2.</p></li>\n</ul>\n\n<p>For example on the above linked lists, inputting the two linkedlists and the index 1 would return a value of 2 as the second value in the first quadruple of linkedList1 = the second value in the second quadruple of linkedList2.</p>\n\n<p>Inputting the two linkedlists and the index 3, however, will return 0 as none of the 4th letters in the quadruples of the 1st linked list match any of the 4th letters in the suadruples of the 2nd linked list.</p>\n\n<p>Any suggestions how to achieve this/get started? I've been trying to implement a recursive map function but it's been pretty choppy progress.</p>\n"}, {"tags": ["haskell", "cabal-install"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1536740036, "post_id": 52178277, "comment_id": 91528736, "body": "What if you ran ghci with <code>-XNoImplicitPrelude</code>?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1536761068, "post_id": 52178277, "comment_id": 91541972, "body": "@BartekBanachewicz If you use <code>cabal repl --ghc-options ...</code>, then the <code>...</code> is in effect for compiling all of the modules in my project that the repl loads. So <code>-XNoImplicitPrelude</code> doesn&#39;t really help. <code>-Wno-missing-import-lists</code>, though it&#39;s a bit irksome to do so manually on every invocation (I can make an alias, sure, but also configure any tooling that invokes <code>cabal repl</code>, etc)."}], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 181, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1536128227, "creation_date": 1536128227, "question_id": 52178277, "link": "https://stackoverflow.com/questions/52178277/different-warnings-settings-in-cabal-file-and-in-repl", "title": "Different warnings settings in cabal file and in repl", "body": "<p>I generally want to make sure I use either explicit import lists or qualified imports in Haskell, but frequently while making changes I just import everything from a module and then need a reminder to fix it up before I commit. So I've added <code>ghc-options: -Wmissing-import-lists</code> to my project's cabal file, which works great.</p>\n\n<p>However, during development I also use the repl a lot, and I usually want far less warnings in my repl session than I do when compiling my real code. So I had the same idea suggested <a href=\"https://stackoverflow.com/questions/25323686/how-to-set-ghci-options-for-cabal-repl\">in this question</a>; use a (project-local) <code>.ghci</code> file that turns off many of the warnings I set in my cabal file, including <code>-Wno-missing-import-lists</code>.</p>\n\n<p>The trouble is <code>cabal repl</code> does this:</p>\n\n<pre><code>Preprocessing library for example-0.1.0.0..\nGHCi, version 8.4.3: http://www.haskell.org/ghc/  :? for help\n\n&lt;interactive&gt;:1:1: warning: [-Wmissing-import-lists]\n    The module \u2018Prelude\u2019 does not have an explicit import list\nLoaded GHCi configuration from /home/ben/src/example/.ghci\nLoaded GHCi configuration from /home/ben/.ghci\n[1 of 1] Compiling Example          ( src/Example.hs, interpreted )\n*Example\n\u03bb \n</code></pre>\n\n<p>It applies <code>-Wmissing-import-lists</code> during its own implicit import of the <code>Prelude</code> before it even tries to read my .ghci file disabling the warning.<sup>1</sup></p>\n\n<p>I assume this would also be a problem with any other options that GHCi applies before reading any .ghci files (are there others?). So is there any other way to specify in the cabal file that some GHC options are only for building, not for repling?</p>\n\n<hr>\n\n<p><sup>1</sup> It's particularly irksome because building <code>Example.hs</code> with that warning doesn't actually complain about missing imports from the implicit <code>Prelude</code> import, and if I explicitly import <code>Prelude</code> with an import list then I still get the warning with <code>cabal repl</code> from its own import, even though those imports aren't actually in scope at the prompt!</p>\n"}, {"tags": ["list", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1536070245, "post_id": 52168050, "comment_id": 91286510, "body": "<code>x</code> is the <code>head allHumans</code>, i.e. the first in the list, a <i>single</i> human - it&#39;s type is <code>Human</code> not <code>[Human]</code>. And what type is <code>state</code>?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1536070264, "post_id": 52168050, "comment_id": 91286520, "body": "Is it <code>Person</code> or <code>Human</code>?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 4, "creation_date": 1536070294, "post_id": 52168050, "comment_id": 91286537, "body": "<code>([Human], state)</code> I don&#39;t know what you want this to do, but it most certainly doesn&#39;t do that."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1536070452, "post_id": 52168050, "comment_id": 91286651, "body": "Why are you using <code>subsequences</code>? Your first list comprehension already generates all the humans that you are interested in."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1536070466, "post_id": 52168050, "comment_id": 91286664, "body": "Ignoring state, you probably want something like this: <code>func=[[h,s,a]|h&lt;-&quot;ST&quot;, s&lt;-&quot;MF&quot;, a&lt;-&quot;AC&quot;]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1536070180, "post_id": 52168196, "comment_id": 91286474, "body": "Alternatively: <code>[&#39;T&#39;, &#39;S&#39;]</code> etc"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1536070266, "post_id": 52168196, "comment_id": 91286521, "body": "@Bergi: yes, perhaps that is not clear. I&#39;ve added it in the head of the answer. Thanks for the feedback :)"}, {"owner": {"reputation": 79, "user_id": 6933318, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/ff093c65ca23acd34ed2d8c958bfd625?s=128&d=identicon&r=PG&f=1", "display_name": "JokkeMedKniven", "link": "https://stackoverflow.com/users/6933318/jokkemedkniven"}, "edited": false, "score": 0, "creation_date": 1536070678, "post_id": 52168196, "comment_id": 91286828, "body": "Thank you for explaining. This made perfect sense and saved my problem!"}, {"owner": {"reputation": 79, "user_id": 6933318, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/ff093c65ca23acd34ed2d8c958bfd625?s=128&d=identicon&r=PG&f=1", "display_name": "JokkeMedKniven", "link": "https://stackoverflow.com/users/6933318/jokkemedkniven"}, "edited": false, "score": 0, "creation_date": 1536070822, "post_id": 52168196, "comment_id": 91286914, "body": "Just to make sure. How can I be sure this constructs only unique humans?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 79, "user_id": 6933318, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/ff093c65ca23acd34ed2d8c958bfd625?s=128&d=identicon&r=PG&f=1", "display_name": "JokkeMedKniven", "link": "https://stackoverflow.com/users/6933318/jokkemedkniven"}, "edited": false, "score": 0, "creation_date": 1536070865, "post_id": 52168196, "comment_id": 91286951, "body": "@JokkeMedKniven: this is the case since <code>height</code>, <code>sex</code> and <code>age</code> iterate over collectiohs that each contain <i>unique</i> elements. So it can not generate twice the same string."}, {"owner": {"reputation": 79, "user_id": 6933318, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/ff093c65ca23acd34ed2d8c958bfd625?s=128&d=identicon&r=PG&f=1", "display_name": "JokkeMedKniven", "link": "https://stackoverflow.com/users/6933318/jokkemedkniven"}, "edited": false, "score": 0, "creation_date": 1536071504, "post_id": 52168196, "comment_id": 91287402, "body": "@WillemVanOnsem sent you a message on codementor if you are interested!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 11, "last_activity_date": 1536070823, "last_edit_date": 1536070823, "creation_date": 1536070074, "answer_id": 52168196, "question_id": 52168050, "link": "https://stackoverflow.com/questions/52168050/trying-to-construct-a-list-of-a-custom-datatype-in-haskell/52168196#52168196", "title": "Trying to construct a list of a custom datatype in Haskell", "body": "<p>I think since <code>height</code>, <code>sex</code> and <code>age</code> are essentially <em>characters</em>, it is probably better to present these as characters. So we can write <code>height &lt;- ['T', 'S']</code> instead of <code>height &lt;- [\"T\", \"S\"]</code>, or even shorter <code>height &lt;- \"TS\"</code>. If we construct a list of <code>String</code>s, we do not construct a <code>String</code>, but - well - a list of <code>String</code>s.</p>\n\n<p>Since you have access to the characters, you can construct a list of the three characters <code>height</code>, <code>sex</code> and <code>age</code>, by <em>constructing a list</em>: a <code>String</code> is just a type alias for <code>[Char]</code>.</p>\n\n<p>We can also make other improvements. Since we construct a list of three elements, the length is always three, so we do not need to check this later in the process, and we can make <code>Human</code>s (I assume you mixed up <code>Person</code> and <code>Human</code>) directly.</p>\n\n<p>You specify <code>state</code>, in the signature, but that is a type variable. It would mean that it can be <em>anything</em>. Here however it is clearly a list of <code>Human</code>s, so you need to change the sgianture to <code>(Human, [Human])</code>.</p>\n\n<p>Finally we do not have to construct a <code>head</code> to obtain the first element, but can use pattern matching, nor do we have to remove that element from the list: since all elements are unique, the remaining elements are all in the <em>tail</em> (and no other element is in the tail):</p>\n\n<pre><code>func :: ([Human], [Human])\nfunc = (x, state_) where\n    (x:state_) = [Human [height, sex, age] | height &lt;- \"TS\", sex &lt;- \"MF\", age &lt;- \"AC\"]</code></pre>\n\n<p><strong>Possible improvements</strong></p>\n\n<p>I think the modeling might be better if you define a <code>Human</code> as:</p>\n\n<pre><code>data Human = Human Height Sex Age\ndata Height = Tall | Small\ndata Sex = Male | Female\ndata Age = Adult | Child\n</code></pre>\n\n<p>By doing this, you limit the number of humans that can be constructed <em>by design</em>. Indeed, right now it might be possible that a function contains a small error, and produces <code>Human \"ABC\"</code> (characters not in the \"domain\"), or <code>Human \"TM\"</code> (too few characters), or <code>Human \"AMT\"</code> (swapped order). This can result in a lot of trouble later in the process. By specifying the domains, etc. in the type, functions simply <em>can not</em> generate such values (well the compiler will raise an error). So it gives you \"stronger guarantees\" that the function is working properly. The function, of course, can still contain a <em>semantical</em> error.</p>\n\n<p>Furthermore by defining separate parameters, you also enforce that every human has these three attributes, and the constructor is now <em>curried</em>.</p>\n\n<p>It would also make the process of creating humans easier with the <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Functor.html#v:-60--36--62-\" rel=\"noreferrer\"><strong><code>(&lt;$&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b</code></strong></a> and <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Applicative.html#v:-60--42--62-\" rel=\"noreferrer\"><strong><code>(&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b</code></strong></a> functions:</p>\n\n<pre><code>Human &lt;$&gt; [Tall, Small] &lt;*&gt; [Male, Female] &lt;*&gt; [Adult, Child]\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 6933318, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/ff093c65ca23acd34ed2d8c958bfd625?s=128&d=identicon&r=PG&f=1", "display_name": "JokkeMedKniven", "link": "https://stackoverflow.com/users/6933318/jokkemedkniven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 939, "favorite_count": 0, "accepted_answer_id": 52168196, "answer_count": 1, "score": 0, "last_activity_date": 1536133999, "creation_date": 1536069557, "last_edit_date": 1536133999, "question_id": 52168050, "link": "https://stackoverflow.com/questions/52168050/trying-to-construct-a-list-of-a-custom-datatype-in-haskell", "title": "Trying to construct a list of a custom datatype in Haskell", "body": "<p>I am pretty new to Haskell and I am trying to create a list of a custom data type called <em>Human</em>. Human is defined like this: data Human = Human(String), so a Human is essentially a String. A human is defined by whether they are tall or short (S or T), female or male (F or M), and if they are an adult or child (A or C).</p>\n\n<p>I have tried writing a function which basically gives me a list of persons of every possible combination of the values above, i.e. = [\"SFA\", \"SFC, \"TMC\"...]. This is what I have come up with this far:</p>\n\n<pre><code>func :: ([Human], state)\nfunc = (x, state_) where\nremainingHumans = [[height, sex, age] | height &lt;- [\"T\", \"S\"], sex &lt;- [\"M\", \"F\"], age &lt;- [\"A\", \"C\"]]\nallHumans = [Person(human) | human &lt;- subsequences remainingHumans, length human == 3]\nx = head allHumans\nstate _ = allHumans \\\\ [x]\n</code></pre>\n\n<p>I am getting this error when I try to compile the program:</p>\n\n<pre><code>Couldn't match type \u2018[[Char]]\u2019 with \u2018Char\u2019\n  Expected type: String\n    Actual type: [[[Char]]]\n</code></pre>\n\n<p>As I am pretty new I am also pretty lost on how to proceed. Any help or hints would be greatly appriciated</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1536061844, "post_id": 52165658, "comment_id": 91280817, "body": "There are sevaral problems here: first of all you seem to do the opposite: print the <code>Foo</code> type to a string, furthermore the patterns you describe are <i>irrefutabled</i>: it will always match the <i>first</i> element."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1536061860, "post_id": 52165658, "comment_id": 91280828, "body": "Do you want to store the first three characters of a string into a <code>Foo</code>?"}, {"owner": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1536061974, "post_id": 52165658, "comment_id": 91280916, "body": "Yes I am trying to store the first three characters of a string (Which will always be three characters) into a Foo - as for the first comment, I can see now obviously that is a big error on my part - not sure it explains the error I am returning though"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1536065180, "post_id": 52165658, "comment_id": 91283011, "body": "You seem to be new to Haskell. I&#39;d recommend reading through the entirety of <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow noreferrer\">LYAH</a> before diving in further. If you&#39;d read that, you probably wouldn&#39;t be having to ask this question."}], "answers": [{"comments": [{"owner": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "edited": false, "score": 0, "creation_date": 1536062540, "post_id": 52165809, "comment_id": 91281271, "body": "This was a perfect explanation - very much appreciated"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1536062230, "creation_date": 1536062230, "answer_id": 52165809, "question_id": 52165658, "link": "https://stackoverflow.com/questions/52165658/haskell-parsing-string-to-custom-type/52165809#52165809", "title": "Haskell: Parsing String to Custom Type", "body": "<p>If I understand it the correct way, you want to store the first three characters of a string into a type <code>Foo</code> (which is an alias for a 3-tuple that contains three <code>Char</code>s).</p>\n\n<p>The signature seems correct (it is good practice to return a <code>Maybe</code> if something can go wrong, and here it is possible that the string contains less than three characters). A problem hwever is that you write an arrow character <code>\u2192</code> whereas signatures in Haskell usse <code>-&gt;</code> (two ASCII characters, a dash and a greater than symbol).</p>\n\n<p>So we can define the signature as:</p>\n\n<pre><code>parseFoo :: String -&gt; Maybe Foo\n</code></pre>\n\n<p>Now the second problem is that you here <em>define</em> a function <code>f</code> that maps <code>Foo</code>s to <code>String</code>s, so the reverse. You also make use of a syntax that is frequently used for indexing in languages of the C/C++/C#/Java programming language family, but indexing in Haskell is done with the <code>(!!)</code> operator, and since you define the function in reverse, it will not help.</p>\n\n<p>A string is a <em>list</em> of <code>Char</code>s, so:</p>\n\n<pre><code>type String = [Char]\n</code></pre>\n\n<p>We can thus define two patterns:</p>\n\n<ol>\n<li>a list with three (or more) characters; and</li>\n<li>a list with less than three characters.</li>\n</ol>\n\n<p>For the former, we return a 3-tuple with these characters (wrapped in a <code>Just</code>), for the latter we return <code>Nothing</code>:</p>\n\n<pre><code>parseFoo :: String -&gt; Maybe Foo\nparseFoo (a:b:c:_) = Just (a, b, c)\nparseFoo _ = Nothing\n</code></pre>\n\n<p>Or if we do not want to parse strings with more than three characters successfully:</p>\n\n<pre><code>parseFoo :: String -&gt; Maybe Foo\nparseFoo [a, b, c] = Just (a, b, c)\nparseFoo _ = Nothing\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 327, "favorite_count": 0, "accepted_answer_id": 52165809, "answer_count": 1, "score": -1, "last_activity_date": 1536062230, "creation_date": 1536061710, "last_edit_date": 1536061913, "question_id": 52165658, "link": "https://stackoverflow.com/questions/52165658/haskell-parsing-string-to-custom-type", "title": "Haskell: Parsing String to Custom Type", "body": "<p>I have declared a type:</p>\n\n<pre><code>type Foo = (Char, Char, Char)\n</code></pre>\n\n<p>And want to be able to parse a 3 letter string \"ABC\" to produce an output Foo with each of ABC as the three attributes of the type.</p>\n\n<p>My current attempt is; </p>\n\n<pre><code>parseFoo :: String \u2192 Maybe Foo\nparseFoo str = f where\n    f (a, _, _) = str[0]\n    f (_, b, _) = str[1]\n    f (_, _, c) = str[2]\n</code></pre>\n\n<p>This is returning an error:</p>\n\n<pre><code>Illegal operator \u2018\u2192\u2019 in type \u2018String \u2192 Maybe Foo\u2019\nUse TypeOperators to allow operators in types\n</code></pre>\n\n<p>My question is:</p>\n\n<ul>\n<li><p>How do I prevent this error on compilation?</p></li>\n<li><p>Am I even on the right track?</p></li>\n</ul>\n"}, {"tags": ["list", "haskell", "data-kinds"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1536050305, "post_id": 52162128, "comment_id": 91273776, "body": "You use <b><code>type</code></b> here? This means you are declaring a type, not a value."}, {"owner": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1536050477, "post_id": 52162128, "comment_id": 91273867, "body": "Okay I see - when I use data I get the same errors though. I will edit my question though - thank you"}], "answers": [{"comments": [{"owner": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "edited": false, "score": 0, "creation_date": 1536050617, "post_id": 52162223, "comment_id": 91273954, "body": "Thank you! I will try your first and third suggestions to see if this fixes it - regarding your second point, the three attributes can hold different values from eachother; sorry if that wasn&#39;t clear"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "edited": false, "score": 0, "creation_date": 1536050676, "post_id": 52162223, "comment_id": 91273987, "body": "@GabrielVega: but then your <code>type Foo = ...</code> is just an illegal statement, probably it already complained about this and GHCi probably ignored it."}, {"owner": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "edited": false, "score": 0, "creation_date": 1536050935, "post_id": 52162223, "comment_id": 91274139, "body": "Could you please explain to me why it&#39;s an illegal statement? Or perhaps the purpose of Foo isn&#39;t clear enough - I want it to be constructed using three attributes, each one is to be one of three unique char&#39;s (a different set of 3 for each attribute)."}, {"owner": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "edited": false, "score": 0, "creation_date": 1536050976, "post_id": 52162223, "comment_id": 91274163, "body": "Also, I&#39;m planning on using my fooList in different functions, so if I wanted to declare it as a type, then give it these values, how would I do so?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "edited": false, "score": 1, "creation_date": 1536051090, "post_id": 52162223, "comment_id": 91274224, "body": "You can define a <i>type</i> (note that this is a meta-level higher than value) with the name <code>FooList</code> (types start with uppercase) with <code>type FooList = [[Foo]]</code> (so <code>FooList Int Int Int</code> would then make a 2d list of <code>Foo</code>s)."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "edited": false, "score": 1, "creation_date": 1536051168, "post_id": 52162223, "comment_id": 91274275, "body": "The reason why this is an illegal statement is because <code>type Foo = ...</code> does not define a <i>new</i> type, it is an alias. So if you would define <code>type Foo = Int</code>, then you can write <code>Foo</code> instead of <code>Int</code>. But if you write <code>type Foo = Foo Int</code>, then you define the type in terms of itself, so it is an alias of an alias of a, the type would be something like <code>(((...) Int) Int) Int</code>."}, {"owner": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "edited": false, "score": 0, "creation_date": 1536051435, "post_id": 52162223, "comment_id": 91274439, "body": "Thank you very much for clarifying - I&#39;ll try and implement this new information"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1536050712, "last_edit_date": 1536050712, "creation_date": 1536050471, "answer_id": 52162223, "question_id": 52162128, "link": "https://stackoverflow.com/questions/52162128/errors-upon-creation-of-2d-list-of-my-own-types-in-haskell/52162223#52162223", "title": "Errors upon creation of 2d list of my own types in Haskell", "body": "<p>First of all the definition of <code>Foo</code> is incorrect. Since it here contains multiple values, and <code>Foo</code> is not an already defined type, you need to construct it like:</p>\n\n<pre><code><b>data</b> Foo = Foo Att1 Att2 Att3</code></pre>\n\n<p>If you define <code>type Foo = Foo Att1 Att2 Att3</code> then you define a <em>type alias</em>, but define a type alias to the same type (so recursively) does not make much sense here.</p>\n\n<p>Furthermore <code>Att2</code> and <code>Att3</code> are probably just <code>Att1</code>s:</p>\n\n<pre><code>data Foo = Foo Att1 Att<b>1</b> Att<b>1</b></code></pre>\n\n<p>Furthermore you do <em>not</em> need <code>type</code> or <code>data</code> to declarate a value. You can create a 2d list by specifying it as:</p>\n\n<pre><code>fooList = [[Foo A A A, Foo B A C], [Foo C A B, Foo B B A]]</code></pre>\n\n<p>So here we declare a variable that stores <em>values</em>: a list of lists and each element is a <code>Foo</code> item.</p>\n"}], "owner": {"reputation": 169, "user_id": 8718703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bdbcd3004d7093734cbd8a39b00e1311?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Vega", "link": "https://stackoverflow.com/users/8718703/gabriel-vega"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 52162223, "answer_count": 1, "score": 0, "last_activity_date": 1536272853, "creation_date": 1536050162, "last_edit_date": 1536272853, "question_id": 52162128, "link": "https://stackoverflow.com/questions/52162128/errors-upon-creation-of-2d-list-of-my-own-types-in-haskell", "title": "Errors upon creation of 2d list of my own types in Haskell", "body": "<p>Basically I've created a type with three attributes, lets call it \"Foo\"</p>\n\n<pre><code>type Foo = Foo Att1 Att2 Att3\n</code></pre>\n\n<p>Each attribute is one of 3 values, I declared each attribute with this format:</p>\n\n<pre><code>data Att1 = A | B | C\n</code></pre>\n\n<p>Now, after a little guesswork about the difference between when to use \"data\" or \"type\" I've tried to make a 2D list of Foo's:</p>\n\n<pre><code>type fooList = fooList [[Foo A A A, Foo B A C], [Foo C A B, Foo B B A]]\n</code></pre>\n\n<p>EDIT: I also get the same errors when I assemble this list with</p>\n\n<pre><code>data fooList = fooList [[Foo A A A, Foo B A C], [Foo C A B, Foo B B A]]\n</code></pre>\n\n<p>This is causing two main errors upon compilation:</p>\n\n<pre><code>Not in scope: type constructor or class \u2018A\u2019\nA data constructor of that name is in scope; did you mean DataKinds?\n</code></pre>\n\n<p>and</p>\n\n<pre><code>Illegal Type [\"Copy of foolist\"]. Perhaps you intended to use DataKinds\n</code></pre>\n\n<p>Where am I going wrong here? I've more or less tried to follow learnyouahaskell to a tee but no matter how many ways I've tried this, I keep getting similar errors.</p>\n"}, {"tags": ["parsing", "haskell", "megaparsec"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1536087935, "post_id": 52161488, "comment_id": 91295753, "body": "What&#39;s wrong with the code you wrote (<code>maybeNames &lt;- ...</code>)? It looks like it does exactly what you want to me."}, {"owner": {"reputation": 8049, "user_id": 2718064, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jEp0E.jpg?s=128&g=1", "display_name": "marcosh", "link": "https://stackoverflow.com/users/2718064/marcosh"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1536094248, "post_id": 52161488, "comment_id": 91298535, "body": "@DanielWagner the pieces by themselves work fine. I can parse correctly something like <code>names a b c</code> and <code>surnames d e f g</code>, but the parser fails for <code>names a b c surnames d e f g</code>. I don&#39;t know how to glue correctly the two parsers together"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1536099276, "post_id": 52161488, "comment_id": 91300177, "body": "Just use <code>(&gt;&gt;=)</code>, or consecutive lines in your <code>do</code> block..."}, {"owner": {"reputation": 8049, "user_id": 2718064, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jEp0E.jpg?s=128&g=1", "display_name": "marcosh", "link": "https://stackoverflow.com/users/2718064/marcosh"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1536126367, "post_id": 52161488, "comment_id": 91305728, "body": "you&#39;re right! I was writing my test wrong (missing a whitespace...) and I tought its failure was the parser fault... thanks for the help"}], "answers": [{"tags": [], "owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "is_accepted": false, "score": 0, "last_activity_date": 1536048934, "creation_date": 1536048934, "answer_id": 52161763, "question_id": 52161488, "link": "https://stackoverflow.com/questions/52161488/record-parsing-in-haskell/52161763#52161763", "title": "Record parsing in Haskell", "body": "<p>Start with writing the context free grammar for your format:</p>\n\n<pre><code>program  ::= lines\nlines    ::= line | line lines\nline     ::= names | surnames\nnames    ::= NAMES ids\nsurnames ::= SURNAMES ids\nids      ::= id | id ids\nid       ::= STRING\n</code></pre>\n\n<p>Where upper case names are for terminals,\nand lower case names are for non terminals.\nYou could then easily use <a href=\"https://www.haskell.org/alex/doc/html/introduction.html\" rel=\"nofollow noreferrer\">Alex + Happy</a> to parse your text file.</p>\n"}, {"comments": [{"owner": {"reputation": 8049, "user_id": 2718064, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jEp0E.jpg?s=128&g=1", "display_name": "marcosh", "link": "https://stackoverflow.com/users/2718064/marcosh"}, "edited": false, "score": 0, "creation_date": 1536057717, "post_id": 52164329, "comment_id": 91278222, "body": "thanks! The problem that I see in this is that it allows multiple <code>ifStmt</code>, while I can&#39;t allow multiple <code>names</code> sections. Moreover, here statements are separated by a <code>semi</code>, while I don&#39;t have any separator between sections"}, {"owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "reply_to_user": {"reputation": 8049, "user_id": 2718064, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jEp0E.jpg?s=128&g=1", "display_name": "marcosh", "link": "https://stackoverflow.com/users/2718064/marcosh"}, "edited": false, "score": 0, "creation_date": 1536058331, "post_id": 52164329, "comment_id": 91278590, "body": "I think this should help: <a href=\"https://stackoverflow.com/questions/33881260/parsec-parsing-a-list-of-lists-both-with-the-same-delimiter\" title=\"parsec parsing a list of lists both with the same delimiter\">stackoverflow.com/questions/33881260/&hellip;</a>"}, {"owner": {"reputation": 8049, "user_id": 2718064, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jEp0E.jpg?s=128&g=1", "display_name": "marcosh", "link": "https://stackoverflow.com/users/2718064/marcosh"}, "edited": false, "score": 0, "creation_date": 1536059541, "post_id": 52164329, "comment_id": 91279334, "body": "I thinks that&#39;s somehow a different problem. It can have repetitions of commands, while I can not. In other terms, it has a list of lists, while I have a record of lists"}], "tags": [], "owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "is_accepted": false, "score": 0, "last_activity_date": 1536057394, "creation_date": 1536057394, "answer_id": 52164329, "question_id": 52161488, "link": "https://stackoverflow.com/questions/52161488/record-parsing-in-haskell/52164329#52164329", "title": "Record parsing in Haskell", "body": "<p>You can do something similar to what appears in <a href=\"https://markkarpov.com/megaparsec/parsing-simple-imperative-language.html\" rel=\"nofollow noreferrer\">this guide</a> and use <code>&lt;|&gt;</code>\nto select optional arguments. Here are the essence of things:</p>\n\n<pre><code>whileParser :: Parser Stmt\nwhileParser = between sc eof stmt\n\nstmt :: Parser Stmt\nstmt = f &lt;$&gt; sepBy1 stmt' semi\n  where\n    -- if there's only one stmt return it without using \u2018Seq\u2019\n    f l = if length l == 1 then head l else Seq l\n\nstmt' = ifStmt\n  &lt;|&gt; whileStmt\n  &lt;|&gt; skipStmt\n  &lt;|&gt; assignStmt\n  &lt;|&gt; parens stmt\n\nifStmt :: Parser Stmt\nifStmt = do\n  rword \"if\"\n  cond  &lt;- bExpr\n  rword \"then\"\n  stmt1 &lt;- stmt\n  rword \"else\"\n  stmt2 &lt;- stmt\n  return (If cond stmt1 stmt2)\n\nwhileStmt :: Parser Stmt\nwhileStmt = do\n  rword \"while\"\n  cond &lt;- bExpr\n  rword \"do\"\n  stmt1 &lt;- stmt\n  return (While cond stmt1)\n</code></pre>\n"}], "owner": {"reputation": 8049, "user_id": 2718064, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jEp0E.jpg?s=128&g=1", "display_name": "marcosh", "link": "https://stackoverflow.com/users/2718064/marcosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 145, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1536057394, "creation_date": 1536047892, "question_id": 52161488, "link": "https://stackoverflow.com/questions/52161488/record-parsing-in-haskell", "title": "Record parsing in Haskell", "body": "<p>I am building a parser using Megaparsec and I don't know which is the best approach to parse a structure like</p>\n\n<pre><code>names a b c\nsurnames d e f g\n</code></pre>\n\n<p>where <code>names</code> and <code>surnames</code> are keywords followed by a list of strings, and each of the two line is optional. This means that also</p>\n\n<pre><code>names a b c\n</code></pre>\n\n<p>and</p>\n\n<pre><code>surnames d e f g\n</code></pre>\n\n<p>are valid.</p>\n\n<p>I can parse every line with something like</p>\n\n<pre><code>maybeNames &lt;- optional $ do\n    constant \"names\"\n    many identifier\n</code></pre>\n\n<p>where <code>identifier</code> parses a valid non-reserved string.</p>\n\n<p>Now, I'm not sure how to express that each line is optional, but still retrieve its value if it is present</p>\n"}, {"tags": ["haskell", "do-notation"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1536066616, "post_id": 52160092, "comment_id": 91283943, "body": "all the values to the right of <code>&lt;-</code> in the same <code>do</code> block must be of type <code>Monad m =&gt; m _</code>, for the same <code>m</code>."}, {"owner": {"reputation": 1141, "user_id": 1367497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1ab83696683e53a9940cd2a8c480894?s=128&d=identicon&r=PG", "display_name": "peeyush singh", "link": "https://stackoverflow.com/users/1367497/peeyush-singh"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1536114668, "post_id": 52160092, "comment_id": 91302926, "body": "Thanks all, I guess where I was tripping again and again was forgetting that the bind takes a method which will take a normal value (from within monad m) and then it needs to wrap it back (after processing) in the same type of monad m. In my mind I sort of forgot &lt;- is a syntactic shortcut for bind and was thinking as if &lt;- is more of a haskell operator which &quot;extracts&quot; some value (as per the context of monad) and leaves me free to do what I want with this normal value (which is not correct, since I am bound to call a method which has the constraint to  return the result in wrapped in moand m."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1536131104, "post_id": 52160092, "comment_id": 91308070, "body": "the point here is that you are extracting them from the <i>same</i> monad each time, while in the <i>same</i> <code>do</code> block. so trying to extract from different monads in the same <code>do</code> block doesn&#39;t work. <i>that</i> was your problem here, not what you wrote above. also, it&#39;s not always <i>you</i> that &quot;wraps&quot; the value; sometimes - like you have in your code, too - you are using a primitive of a given monad, like <code>putStrLn :: String -&gt; IO ()</code>, that returns a monadic action value all by itself. this &quot;wrapping&quot; thing is not a good metaphor."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 6, "last_activity_date": 1536043525, "creation_date": 1536043525, "answer_id": 52160275, "question_id": 52160092, "link": "https://stackoverflow.com/questions/52160092/how-does-the-operator-in-haskell-behave/52160275#52160275", "title": "How does the operator &lt;- in haskell behave?", "body": "<p>Every statement in a <code>do</code> block must be from the same monadic type.</p>\n\n<p>In</p>\n\n<pre><code>multWithLog = do\n  a &lt;- logNumber 3\n  return a\n</code></pre>\n\n<p>we have <code>logNumber 3 :: Writer [String] Int</code> and <code>return a :: (Monad m) =&gt; m Int</code> (which is polymorphic), so the whole thing typechecks as <code>Writer [String] Int</code> (with <code>m = Writer [String]</code>, which is a monad).</p>\n\n<p>In</p>\n\n<pre><code>main = do\n   putStrLn $ show $ logNumber 3\n   putStrLn $ show $ multWithLog\n    _ &lt;- logNumber 3\n   putStrLn \"test\"\n</code></pre>\n\n<p>we have <code>putStrLn ... :: IO ()</code> and <code>logNumber 3 :: Writer [String] Int</code>. This is a type error because <code>Writer [String]</code> is not the same as <code>IO</code>.</p>\n\n<p>The underlying reason is that <code>do</code> blocks are just syntactic sugar for calls to <code>&gt;&gt;=</code> and <code>&gt;&gt;</code>. E.g. your <code>main</code> really means</p>\n\n<pre><code>main =\n   (putStrLn $ show $ logNumber 3) &gt;&gt;\n   (putStrLn $ show $ multWithLog) &gt;&gt;\n   logNumber 3 &gt;&gt;= \\_ -&gt;\n   putStrLn \"test\"\n</code></pre>\n\n<p>with</p>\n\n<pre><code>(&gt;&gt;)  :: (Monad m) =&gt; m a -&gt; m b -&gt; m b\n(&gt;&gt;=) :: (Monad m) =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>which requires the type <code>m</code> to remain the same throughout.</p>\n"}, {"comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1536066703, "post_id": 52160368, "comment_id": 91283988, "body": "@WillNess I don&#39;t object to the word <i>extract</i>; I warn again the articles <i>the</i> and <i>a</i>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1536066759, "post_id": 52160368, "comment_id": 91284024, "body": "I&#39;m referring to the different sentence, this one: &quot;all values extracted must belong to the same Monad&quot;"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1536066872, "post_id": 52160368, "comment_id": 91284109, "body": "@WillNess Ah, would it be more correct to say that <i>all values extracted must originate from the same Monad?</i> Or something like that..."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1536068248, "post_id": 52160368, "comment_id": 91285145, "body": "maybe &quot;all Monadic action values (those to the right of <code>&lt;-</code>, or on a line of their own) must belong to the same Monad&quot;."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 3, "last_activity_date": 1536043824, "creation_date": 1536043824, "answer_id": 52160368, "question_id": 52160092, "link": "https://stackoverflow.com/questions/52160092/how-does-the-operator-in-haskell-behave/52160368#52160368", "title": "How does the operator &lt;- in haskell behave?", "body": "<p>Be careful with wording such as</p>\n\n<blockquote>\n  <p>extract the value from the monad</p>\n</blockquote>\n\n<p>A monad doesn't contain 'a' value. For example, <code>Maybe</code> contains zero or one value. List (<code>[]</code>) contains multiple values. See <a href=\"https://stackoverflow.com/a/51620647/126014\">this answer</a> for more details.</p>\n\n<p>In the list case, for example, the <code>&lt;-</code> operator extracts <em>each</em> of the list values, one at a time.</p>\n\n<p>When you use <code>do</code> notation, all values extracted must belong to the same <code>Monad</code>. In the OP, the compiler infers that the <code>Monad</code> in question is <code>IO</code>, since <code>putStrLn</code> returns <code>IO ()</code> values.</p>\n\n<p><code>logNumber</code>, on the other hand, returns <code>Writer [String] Int</code> values, and while that's also a <code>Monad</code> instance, it's not the same as <code>IO</code>. Therefore, the code doesn't type check.</p>\n"}, {"tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": false, "score": 1, "last_activity_date": 1536051208, "creation_date": 1536051208, "answer_id": 52162435, "question_id": 52160092, "link": "https://stackoverflow.com/questions/52160092/how-does-the-operator-in-haskell-behave/52162435#52162435", "title": "How does the operator &lt;- in haskell behave?", "body": "<p>Kepping things simple. These are two facts</p>\n\n<ol>\n<li><code>Writer [String]</code> is actually monad, so <code>Writer [String] Int</code> can be seen as <code>m Int</code></li>\n<li>Every action in a <code>do</code> block should happen within the same monad.</li>\n</ol>\n\n<p>In the <code>main</code> function the compiler is reasoning as follows: </p>\n\n<ol>\n<li>I am working within the <code>IO</code> monad since <code>putStrLn ...</code> is of type <code>IO ()</code> </li>\n<li>Let me compute <code>_ &lt;- logNumber 3</code>. Since I am in the <code>IO</code> monad, <code>logNumber 3</code> should be <code>IO WhatEver</code></li>\n<li><code>logNumber 3</code> is actually a monadic value of type <code>m Int</code></li>\n<li>Wait! <code>m</code> is the <code>Writer [String]</code> monad, not the <code>IO</code> monad</li>\n<li>Print an error saying that <code>Writer [String] Int</code> is incorrect an It should be <code>IO Int</code></li>\n</ol>\n\n<p>So that is where <code>IO Int</code> comes from. I am just triying to be pedagogic here. Check @melpomene's answer for a complete explanation</p>\n\n<p>Hope it helps. </p>\n"}], "owner": {"reputation": 1141, "user_id": 1367497, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1ab83696683e53a9940cd2a8c480894?s=128&d=identicon&r=PG", "display_name": "peeyush singh", "link": "https://stackoverflow.com/users/1367497/peeyush-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 1, "accepted_answer_id": 52160275, "answer_count": 3, "score": 2, "last_activity_date": 1536051208, "creation_date": 1536042742, "last_edit_date": 1536043857, "question_id": 52160092, "link": "https://stackoverflow.com/questions/52160092/how-does-the-operator-in-haskell-behave", "title": "How does the operator &lt;- in haskell behave?", "body": "<p>I understand (somewhat) monads and understand that the operator &lt;- will extract the value from the monad. </p>\n\n<p>But how does it work with different types? </p>\n\n<p>Typically, I have seen it being used to extract strings from IO monad. But in the example code below am not able to see why it fails in main 3rd line, complaining that it is expecting a type of IO int? How is the compiler infering that an IO int is needed?</p>\n\n<p>Also what does it (<code>&lt;-</code>) do in the <code>multWithLog</code> method?</p>\n\n<pre><code>import Control.Monad.Trans.Writer.Lazy\n\nmain = do\n   putStrLn $ show $ logNumber 3 -- prints WriterT (Identity (3,[\"Got Number: 3\"]))\n   putStrLn $ show $ multWithLog -- prints WriterT (Identity (3,[\"Got Number: 3\"]))\n    _ &lt;- logNumber 3 -- fails with Couldn't match type \u2018WriterT [String] Data.Functor.Identity.Identity\u2019 with \u2018IO\u2019\n                    -- Expected type: IO Int\n                    -- Actual type: Writer [String] Int\n   putStrLn \"test\"\n\n\nlogNumber :: Int -&gt; Writer [String] Int\nlogNumber x = writer (x, [\"Got Number: \" ++ show x])\n\nmultWithLog :: Writer [String] Int\nmultWithLog = do\n  a &lt;- logNumber 3\n  --b &lt;- logNumber 5\n  return a\n</code></pre>\n"}, {"tags": ["xml", "haskell", "yesod", "xml-conduit"], "answers": [{"comments": [{"owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 0, "creation_date": 1536034113, "post_id": 52158262, "comment_id": 91267315, "body": "Awesome, thanks. What are the guards doing in that first data structure? I&#39;m not sure I understand."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 1, "creation_date": 1536063982, "post_id": 52158262, "comment_id": 91282202, "body": "@Jono Those aren&#39;t guards. That is <a href=\"https://www.stackage.org/haddock/lts-12.9/xml-conduit-1.8.0/src/Text.XML.html#Node\" rel=\"nofollow noreferrer\">the definition of the <code>Node</code> type</a> (note the <code>data</code> keyword), which has four constructors."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1536064010, "last_edit_date": 1536064010, "creation_date": 1536030486, "answer_id": 52158262, "question_id": 52158181, "link": "https://stackoverflow.com/questions/52158181/in-haskells-xml-conduit-how-can-i-create-a-node/52158262#52158262", "title": "In Haskell&#39;s xml-conduit, how can I create a node?", "body": "\n\n<p>Here are the constructors and fields for <code>Node</code>...</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Node\n    = NodeElement Element\n    | NodeInstruction Instruction\n    | NodeContent Text\n    | NodeComment Text\n</code></pre>\n\n<p>... and <code>Element</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Element = Element\n    { elementName       :: Name\n    , elementAttributes :: Map.Map Name Text\n    , elementNodes      :: [Node]\n    }\n</code></pre>\n\n<p>Note that an <code>Element</code> holds a list of <code>Node</code>s, and so you can make it hold a <code>NodeContent</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>NodeElement $ Element \"b\" empty [ NodeContent \"Title\" ]\n</code></pre>\n\n<p>(Cf. <a href=\"https://www.yesodweb.com/book/xml#xml_xml_hamlet\" rel=\"nofollow noreferrer\">this example</a> in the linked tutorial.)</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 52158262, "answer_count": 1, "score": 0, "last_activity_date": 1536064010, "creation_date": 1536029648, "question_id": 52158181, "link": "https://stackoverflow.com/questions/52158181/in-haskells-xml-conduit-how-can-i-create-a-node", "title": "In Haskell&#39;s xml-conduit, how can I create a node?", "body": "<p>I'm a Haskell beginner. I'm using <a href=\"https://www.stackage.org/haddock/lts-12.9/xml-conduit-1.8.0/Text-XML.html#t:Node\" rel=\"nofollow noreferrer\">xml-conduit</a> to transform some XML into HTML, <a href=\"https://www.yesodweb.com/book/xml\" rel=\"nofollow noreferrer\">as seen in the Yesod tutorial</a>. I have some attributes and some content that I want to make into a node to add it to existing XML. What's the best way to create a Node? I've tried calling <code>Node</code>, but it says it's not in scope. I can make a node using <code>NodeContent \"content\"</code>, or using <code>NodeElement (Element ... )</code>, but how can I create a node, providing <em>both</em> elements and content? </p>\n\n<p>(The Yesod book suggests using Hamlet, but I'd rather not involve Hamlet, since I'm already using Blaze, and don't want to have to learn and maintain too many templating languages.)</p>\n"}, {"tags": ["haskell", "constraints", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1536185763, "post_id": 52158733, "comment_id": 91337866, "body": "Thanks.  Just a copy and paste error working through too many versions. It&#39;s fixed now."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1536185739, "last_edit_date": 1536185739, "creation_date": 1536034564, "answer_id": 52158733, "question_id": 52157911, "link": "https://stackoverflow.com/questions/52157911/how-to-handle-a-typeclass-instance-requiring-additional-type-constraints/52158733#52158733", "title": "How to handle a Typeclass Instance requiring additional Type Constraints", "body": "<p>I assume there's a bug in your program in the <code>toDataTree</code> guard and you meant:</p>\n\n<pre><code>| edges /= DM.empty = ...\n</code></pre>\n\n<p>However, you don't need <code>Eq</code> instances to check that a map is empty.  If you use <code>DM.null</code> instead, you can drop the <code>Eq</code> constraints from <code>toDataTree</code> and from the <code>Show</code> instance:</p>\n\n<pre><code>toDataTree :: Trie a -&gt; DT.Tree a\ntoDataTree (Node label edges isFinal)\n    | not (DM.null edges) = DT.Node label \n                             (map toDataTree (DM.elems edges))\n    | otherwise = DT.Node label []\n</code></pre>\n\n<p>In fact, if the map is empty, then mapping over its elements will produce an empty list anyway, so you can further simplify this to:</p>\n\n<pre><code>toDataTree :: Trie a -&gt; DT.Tree a\ntoDataTree (Node label edges isFinal)\n  = DT.Node label (map toDataTree (DM.elems edges))\n</code></pre>\n\n<p>Anyway, that should solve your immediate problem.</p>\n\n<p>Setting all that aside, the reason for the error is that you haven't provided any <code>Eq</code> instance for any <code>Trie</code>.  You could add a <code>deriving (Eq)</code> clause to the definition for <code>Trie</code>:</p>\n\n<pre><code>data Trie a = Node {\n    label :: a,\n    edges :: DM.Map a (Trie a),\n    isFinal :: Bool\n} deriving (Eq)\n</code></pre>\n\n<p>This might give you a scary warning about fragile inner bindings, but you can drop the <code>Eq (Trie a)</code> constraints (because they will be implied by the <code>Eq a</code> constraint) from both the <code>Show</code> instance and <code>toDataTree</code> to make the warning go away.</p>\n\n<p>Still, as mentioned, you don't really want to do this, because using <code>DM.null</code> and bypassing the <code>Eq</code> instances entirely is better practice.</p>\n"}], "owner": {"reputation": 3257, "user_id": 3578468, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7957773c9ae23195b8a064ade49af29?s=128&d=identicon&r=PG&f=1", "display_name": "lo tolmencre", "link": "https://stackoverflow.com/users/3578468/lo-tolmencre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 52158733, "answer_count": 1, "score": 1, "last_activity_date": 1536185739, "creation_date": 1536026942, "question_id": 52157911, "link": "https://stackoverflow.com/questions/52157911/how-to-handle-a-typeclass-instance-requiring-additional-type-constraints", "title": "How to handle a Typeclass Instance requiring additional Type Constraints", "body": "<p>I found myself in a situation where a typeclass instance I want to define requires additional type constraints. Specifically I want to define <code>Show</code> for a type <code>Trie a</code>:</p>\n\n<pre><code>data Trie a = Node {\n    label :: a,\n    edges :: DM.Map a (Trie a),\n    isFinal :: Bool\n}\n</code></pre>\n\n<p>while the instance for Show is:</p>\n\n<pre><code>import qualified Data.Tree as DT\n\ninstance (Show a, Eq a, Eq (Trie a)) =&gt; Show (Trie a) where\n    show trie@(Node label edges _) = DT.drawTree (mapTree show $ toDataTree trie)\n</code></pre>\n\n<p>I required <code>Eq a</code> and <code>Eq (Trie a)</code> here, as I use <code>toDataTree</code> which converts a <code>Trie a</code> to a <code>DT.Tree a</code> and entails these type constraints:</p>\n\n<pre><code>import qualified Data.Map as DM\n\ntoDataTree :: (Eq a, Eq (Trie a)) =&gt; Trie a -&gt; DT.Tree a\ntoDataTree (Node label edges isFinal)\n    | edges == DM.empty = DT.Node label (map toDataTree (DM.elems edges))\n    | otherwise = DT.Node label []\n\nmapTree :: (a -&gt; b) -&gt; DT.Tree a -&gt; DT.Tree b\nmapTree f (DT.Node rootLabel subForest) = DT.Node (f rootLabel) $ map (mapTree f) subForest\n</code></pre>\n\n<p>Now while this does compile, when I actually want to call <code>print</code> on a <code>Trie a</code> (where <code>a</code> = <code>Char</code> in this case) I get </p>\n\n<pre><code>\u2022 No instance for (Eq (Trie Char)) arising from a use of \u2018print\u2019\n\u2022 In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>This must be because I needed to add these additional type constraints to the instance of <code>Show</code>. So my approach is probably wrong.</p>\n\n<p>What is the correct solution for additional type constraints being required for a type class instance definition?</p>\n"}, {"tags": ["haskell", "constraints", "typeerror"], "answers": [{"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 6, "last_activity_date": 1536088413, "last_edit_date": 1536088413, "creation_date": 1536021162, "answer_id": 52157393, "question_id": 52157295, "link": "https://stackoverflow.com/questions/52157295/understanding-non-type-variable-argument-in-the-constraint/52157393#52157393", "title": "Understanding &quot;Non type-variable argument in the constraint&quot;", "body": "<p>In plain Haskell 2010, constraints can only be applied to type variables, like <code>a</code> or <code>b</code> or whatever, but not to anything more complex.</p>\n\n<p>Legal: <code>Show a =&gt; a -&gt; String</code></p>\n\n<p>Illegal: <code>Show (Maybe a) =&gt; a -&gt; String</code></p>\n\n<p>In this example, the <code>Show (Maybe a)</code> constraint is illegal, because <code>Maybe a</code> is not a type variable. <code>a</code> is a type variable, but <code>Maybe a</code> is not.</p>\n\n<p>In your code, the compiler complains that <code>Trie a</code> is not a type variable in the constraint <code>Eq (Trie a)</code>.</p>\n\n<p>Since there is no sound technical reason for not allowing such constraints, apart from it being harder to implement, an extension named <code>FlexibleContexts</code> was introduced (see <a href=\"https://prime.haskell.org/wiki/FlexibleContexts\" rel=\"nofollow noreferrer\">docs</a>) that makes such constraints legal. This is what the compiler is telling you. You can just turn on this extension, it doesn't have any drawbacks.</p>\n"}], "owner": {"reputation": 3257, "user_id": 3578468, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7957773c9ae23195b8a064ade49af29?s=128&d=identicon&r=PG&f=1", "display_name": "lo tolmencre", "link": "https://stackoverflow.com/users/3578468/lo-tolmencre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1207, "favorite_count": 1, "accepted_answer_id": 52157393, "answer_count": 1, "score": 1, "last_activity_date": 1536088413, "creation_date": 1536019919, "question_id": 52157295, "link": "https://stackoverflow.com/questions/52157295/understanding-non-type-variable-argument-in-the-constraint", "title": "Understanding &quot;Non type-variable argument in the constraint&quot;", "body": "<p>I want to convert a trie datat type I wrote to a <code>Data.Tree.Tree</code></p>\n\n<p>My trie type looks like this:</p>\n\n<pre><code>import qualified Data.Map as DM\n\ndata Trie a = Node {\n    label :: a,\n    edges :: DM.Map a (Trie a),\n    isFinal :: Bool\n}\n</code></pre>\n\n<p>Now I wrote this function for conversion:</p>\n\n<pre><code>import qualified Data.Tree as DT\n\ntoDataTree :: (Eq a, Eq (Trie a)) =&gt; Trie a -&gt; DT.Tree a\ntoDataTree (Node label edges isFinal)\n    | edges == DM.empty = DT.Node label (map toDataTree (DM.elems edges))\n    | otherwise = DT.Node label []\n</code></pre>\n\n<p>But it does not compile. I am getting</p>\n\n<pre><code>    \u2022 Non type-variable argument in the constraint: Eq (Trie a)\n      (Use FlexibleContexts to permit this)\n    \u2022 In the type signature:\n        toDataTree :: (Eq a, Eq (Trie a)) =&gt; Trie a -&gt; DT.Tree a\n   |\n19 | toDataTree :: (Eq a, Eq (Trie a)) =&gt; Trie a -&gt; DT.Tree a\n   |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nFailed, no modules loaded.\n</code></pre>\n\n<p>I don't understand that error message and the other questions I found when googling for the error were not really transferable to my code, as far as I could tell.</p>\n\n<p>What does that error mean in this context and what causes it?</p>\n"}, {"tags": ["haskell", "binary", "append", "disk"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1536015176, "post_id": 52156838, "comment_id": 91264061, "body": "Hard disks don&#39;t really wear out when repeatedly writing data. Though it <i>is</i> a waste of time of course. (SSDs might wear out, though this isn&#39;t really that much of an issue anymore.) \u2014 <code>binary</code> isn&#39;t really concerned much with (non-)strictness, that&#39;s more a property of the underlying data structure. And with a lazy bytestring, this <i>might</i> actually work out the way you want. For proper control of \u201clazy IO\u201d, you should check out one of the dedicated libraries; <a href=\"http://hackage.haskell.org/package/conduit\" rel=\"nofollow noreferrer\"><code>conduit</code></a> or <a href=\"http://hackage.haskell.org/package/pipes\" rel=\"nofollow noreferrer\"><code>pipes</code></a>."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1536015532, "post_id": 52156838, "comment_id": 91264118, "body": "@leftaroundabout I&#39;m a bit confused as to why you&#39;ve mentioned strictness, how does that relate to appending to files?"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1536016176, "post_id": 52156838, "comment_id": 91264215, "body": "Oh there is <code>toLazyByteString :: Builder -&gt; ByteString</code>, which would give me a <code>Bytestring</code> which I can then append to the file using <code>appendFile</code>. Will give this a try tomorrow!"}, {"owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "edited": false, "score": 0, "creation_date": 1536149329, "post_id": 52156838, "comment_id": 91319255, "body": "<a href=\"http://hackage.haskell.org/package/bytestring-0.10.8.2/docs/Data-ByteString.html#v:appendFile\" rel=\"nofollow noreferrer\">appendFile</a>, but you would probably have to append the new elements before (or after) adding them into the list"}, {"owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "edited": false, "score": 0, "creation_date": 1536240598, "post_id": 52156838, "comment_id": 91359542, "body": "I think the question misses the critical information: Is the <code>[Something]</code> list append-only as well, or do you change its contents in a different fashion?"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "edited": false, "score": 0, "creation_date": 1536269298, "post_id": 52156838, "comment_id": 91374172, "body": "Thanks @nh2 I too think that was critical to the question! And yes the list would be append only."}], "answers": [{"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 1, "last_activity_date": 1536257232, "creation_date": 1536257232, "answer_id": 52209899, "question_id": 52156838, "link": "https://stackoverflow.com/questions/52156838/can-i-append-to-a-file-using-binarys-data-binary/52209899#52209899", "title": "Can I append to a file using binary&#39;s Data.Binary?", "body": "<p>How large is your list? If it's millions, it makes sense to append, provided that you're able to extract the newly added elements at each round. If it's thousands or less, then it's probably easier to just write all of them every time.</p>\n\n<p>It seems that you could do appending to a file yourself. That is, <a href=\"http://hackage.haskell.org/package/binary-0.8.6.0/docs/Data-Binary.html#v:encode\" rel=\"nofollow noreferrer\">encode</a> the newly added elements into a <code>ByteString</code> and <a href=\"http://hackage.haskell.org/package/bytestring-0.10.8.2/docs/Data-ByteString-Lazy.html#v:appendFile\" rel=\"nofollow noreferrer\">append</a> them to a file. (Make <strong>sure</strong> that only one process at a time is doing that!)</p>\n\n<p>And then when reading the file, iterate <a href=\"http://hackage.haskell.org/package/binary-0.8.6.0/docs/Data-Binary.html#v:decodeOrFail\" rel=\"nofollow noreferrer\"><code>decodeOrFail</code></a>, feeding it the unconsumed input from the previous call, until you parse everything and reach an empty <code>ByteString</code>.</p>\n\n<hr>\n\n<p>Somewhat orthogonal, I found using <a href=\"http://hackage.haskell.org/package/safecopy\" rel=\"nofollow noreferrer\">safe-copy</a> very helpful. It allows making serialization forward/backward compatible very easy.</p>\n\n<p>If you don't mind writing the whole data all the time, then <a href=\"http://hackage.haskell.org/package/acid-state\" rel=\"nofollow noreferrer\">acid-state</a> gives you very strong guarantees about your data. It also has integration with safe-copy.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1536269242, "creation_date": 1536014633, "last_edit_date": 1536269242, "question_id": 52156838, "link": "https://stackoverflow.com/questions/52156838/can-i-append-to-a-file-using-binarys-data-binary", "title": "Can I append to a file using binary&#39;s Data.Binary?", "body": "<p>I've got a <code>[Something]</code> value, I'd like to save this value to disk every <strong>n</strong> seconds.</p>\n\n<p>However this value could have a large number of elements, and writing the complete value each time could potentially cause unnecessary disk wear. Therefore, I'm looking to append to a file instead.</p>\n\n<p>The list itself (<code>[Something]</code>) would always be appended to, and wouldn't have it's 'original' content modified in any way.</p>\n\n<p>Is it possible to use <code>Data.Binary</code> for this purpose?</p>\n\n<p>I did find the <code>append</code>(<a href=\"http://hackage.haskell.org/package/binary-0.8.6.0/docs/Data-Binary-Builder.html#v:append\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/binary-0.8.6.0/docs/Data-Binary-Builder.html#v:append</a>) function, but this does not seem to fulfill the above usecase.</p>\n\n<p>If it's not possible, is there an alternative library I can use? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1535968400, "post_id": 52147265, "comment_id": 91244330, "body": "The Haskell report describes an <i>algorithmic</i> way to do this: <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-470003.14\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/haskell2010/&hellip;</a>. In fact the Haskell compiler does this behind the curtains."}], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1535991073, "post_id": 52147319, "comment_id": 91256690, "body": "You can also remove <code>()</code> because precedence of <code>.</code> is higher than precedence of <code>&gt;&gt;=</code> operator."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 4, "creation_date": 1535991822, "post_id": 52147319, "comment_id": 91257009, "body": "@Shersh, yes, but then anyone reading it would also have to know that which is not how I like to write code. The precedence of <code>$</code> is easy enough to remember, but <code>&gt;&gt;=</code> vs <code>.</code> comes up rarely enough that it&#39;d be hard to parse for most people I think."}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 5, "last_activity_date": 1535968434, "creation_date": 1535968434, "answer_id": 52147319, "question_id": 52147265, "link": "https://stackoverflow.com/questions/52147265/replacing-do-by-for-a-scotty-post/52147319#52147319", "title": "Replacing do by &gt;&gt;= for a scotty post", "body": "<pre><code>post \"/introduceAnIdea\" $ jsonData &gt;&gt;= (json . handle)\n</code></pre>\n\n<p>I don't think that's necessarily better in this case though.</p>\n"}, {"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 3, "last_activity_date": 1536009618, "last_edit_date": 1536009618, "creation_date": 1535974240, "answer_id": 52148930, "question_id": 52147265, "link": "https://stackoverflow.com/questions/52147265/replacing-do-by-for-a-scotty-post/52148930#52148930", "title": "Replacing do by &gt;&gt;= for a scotty post", "body": "<p>Here's how to rewrite <code>do</code>-notation as <code>&gt;&gt;=</code> and <code>&gt;&gt;</code>: (NB: a newline becomes <code>;</code> in the c-like notation option, which I use here.)</p>\n\n<pre><code>do { a &lt;- m; b... } = m &gt;&gt;= \\a -&gt; do { b... }\n\ndo { a; b... } = a &gt;&gt; do { b... }\n\ndo { a } = a\n</code></pre>\n\n<p>So this becomes:</p>\n\n<pre><code>post \"/introduceAnIdea\"  $ do { command &lt;- jsonData; json $ handle command}\n= post \"/introduceAnIdea\" $ jsonData &gt;&gt;= \\command -&gt; do {json $ handle command}\n= post \"/introduceAnIdea\" $ jsonData &gt;&gt;= \\c -&gt; json $ handle c\n</code></pre>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 52148930, "answer_count": 2, "score": 4, "last_activity_date": 1536009618, "creation_date": 1535968235, "question_id": 52147265, "link": "https://stackoverflow.com/questions/52147265/replacing-do-by-for-a-scotty-post", "title": "Replacing do by &gt;&gt;= for a scotty post", "body": "<pre><code>post \"/introduceAnIdea\"  $ do\n        command &lt;- jsonData\n        json $ handle command\n</code></pre>\n\n<p>How would you remove the do and change it with >>= ?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1535970048, "post_id": 52143242, "comment_id": 91245257, "body": "In a basic Hindley-Milner system, types are generalized only by <code>let</code> (i.e. definitions). That would include, roughly, <code>f,g,h</code> but not anonymous lambdas. So, one could expect that <code>@ T</code> did not work on non-generalized bindings. With the Monomorphism Restriction, <code>f,g</code> would also not be generalized, and only <code>h</code> would work. Haskell apparently does something even different, since even <code>h</code> fails to work. It&#39;s puzzling that adding a type annotation to <code>h</code> with the same inferred type makes it work in <code>h @ T</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1535977592, "post_id": 52143242, "comment_id": 91249466, "body": "You say there is no distinction in the type of these objects, but you are not quite correct -- GHC does track a difference between them. In ghci, try <code>:set -fprint-explicit-foralls</code>, then <code>:type +v (+)</code> and <code>:type +v (\\x y -&gt; x + y)</code>: you will see that one wraps its type variable in braces and one doesn&#39;t."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 7, "last_activity_date": 1535998134, "last_edit_date": 1592644375, "creation_date": 1535950263, "answer_id": 52143313, "question_id": 52143242, "link": "https://stackoverflow.com/questions/52143242/why-does-x-y-x-y-integer-fails-but-integer-succeeds/52143313#52143313", "title": "Why does `(\\x y -&gt; x + y) @Integer` fails, but `(+) @Integer` succeeds?", "body": "<p>In most cases type applications can only be applied when there is an explicit type signature.  Quoting the GHC documents:</p>\n<blockquote>\n<p>If the function is an identifier (the common case), its type is considered known only when the identifier has been given a type signature.</p>\n<p>Why?</p>\n</blockquote>\n<p>I'd guess that design exists because the order of type variables is well defined when you have explicit signatures.</p>\n<blockquote>\n<p>Am I missing something obvious?</p>\n</blockquote>\n<p>Up to you how obvious the above is.  You can dig thought both the docs and the design discussion to see the evolution of the conversation but order of arguments, when type application can only be done strictly by the order, seems to jump out as an issue.</p>\n<blockquote>\n<p>Is this a bug?</p>\n</blockquote>\n<p>I don't believe so. Perhaps for the lambda case.</p>\n<blockquote>\n<p>Is this a feature?</p>\n</blockquote>\n<p>A feature in so far as consistency is good.</p>\n<blockquote>\n<p>Is this poor language design?\nIs this great language design?</p>\n</blockquote>\n<p>Perhaps a better language design is to allow simple examples, such as yours, to work when there are no possible ambiguities (the type argument order is implicit by virtue of there only being one type argument).</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 52143313, "answer_count": 1, "score": 5, "last_activity_date": 1535998134, "creation_date": 1535949651, "question_id": 52143242, "link": "https://stackoverflow.com/questions/52143242/why-does-x-y-x-y-integer-fails-but-integer-succeeds", "title": "Why does `(\\x y -&gt; x + y) @Integer` fails, but `(+) @Integer` succeeds?", "body": "<p>Consider:</p>\n\n<pre><code>\u03bb :type (+) @Integer\n(+) @Integer :: Integer -&gt; Integer -&gt; Integer\n\n\n\n\n\u03bb :type (\\x y -&gt; x + y) @Integer\n...\n...error...\n...Cannot apply expression...\n...\n\n\u03bb f = (+)\n\u03bb :type f @Integer\n...\n...error...\n...Cannot apply expression...\n...\n\n\u03bb g = \\x y -&gt; x + y\n\u03bb :type g @Integer\n...\n...error...\n...Cannot apply expression...\n...\n\n\u03bb h x y = x + y\n\u03bb :type h @Integer\n...\n...error...\n...Cannot apply expression...\n...\n</code></pre>\n\n<p>At the same time:</p>\n\n<pre><code>\u03bb :type (+)\n... :: Num a =&gt; a -&gt; a -&gt; a\n\n\u03bb :type (\\x y -&gt; x + y)\n... :: Num a =&gt; a -&gt; a -&gt; a\n\n\u03bb :type f\n... :: Num a =&gt; a -&gt; a -&gt; a\n\n\u03bb :type g\n... :: Num a =&gt; a -&gt; a -&gt; a\n\n\u03bb :type h\n... :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>So, even though there is no distinction in the type of these objects, they appear as distinct to the type application.</p>\n\n<ul>\n<li>Why?</li>\n<li>Am I missing something obvious?</li>\n<li>Is this a bug?</li>\n<li>Is this a feature?</li>\n<li>Is this poor language design?</li>\n<li>Is this great language design?</li>\n</ul>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1535892051, "post_id": 52137099, "comment_id": 91223806, "body": "You can&#39;t change <code>base</code> version, it&#39;s wired in with ghc, so try removing <code>- base-4.6.0.1</code> from extra-deps and setting <code>allow-newer: true</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535892070, "post_id": 52137099, "comment_id": 91223813, "body": "I think you will need to use another <i>snapshot</i> (the resoler <code>lts-12.8</code> probably is not compatible)."}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1535892168, "post_id": 52137099, "comment_id": 91223841, "body": "Yea, I&#39;ve tried setting my resolver to earlier versions, but it&#39;s like a guessing game. Is there some logical way I can find out what resolver I need?"}, {"owner": {"reputation": 10789, "user_id": 471478, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/30a04c96b889896beaffeb7c52cdb914?s=128&d=identicon&r=PG", "display_name": "scravy", "link": "https://stackoverflow.com/users/471478/scravy"}, "edited": false, "score": 1, "creation_date": 1540243771, "post_id": 52137099, "comment_id": 92785158, "body": "Hi! I&#39;m the author of <code>bed-and-breakfast</code> and I just released 0.5 which should fix these issues."}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1540282867, "post_id": 52137099, "comment_id": 92796636, "body": "Nice one Scravy - I&#39;ll check it out this weekend!"}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1540282955, "post_id": 52137099, "comment_id": 92796685, "body": "Does the update support non square matrix multiplication?"}], "answers": [{"comments": [{"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1535892812, "post_id": 52137191, "comment_id": 91224035, "body": "Right, this is actually one of the possible conclusions I had come to. I hear HMatrix is a good alternative, but when I include that as a dependency the build fails telling me I&#39;m missing OpenBLAS (which after some digging looks like I need to install mingw and setup a load of C dependencies... is there any easier way of setting up all this without going into building C libs etc?"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 1, "creation_date": 1535893209, "post_id": 52137191, "comment_id": 91224139, "body": "Yeah, switch to Linux ;) Just kidding. <code>HMatrix</code> is a wrapper around OpenBLAS so there is no way around it if you want to use that package. Depending on what operations you need there are other array manipulation libraries that might  work for you. I am an author of <code>massiv</code> package, but it doesn&#39;t have many algebraic operations included yet, but it is pure Haskell, so external dependencies needed."}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1535893468, "post_id": 52137191, "comment_id": 91224202, "body": "Well I actually started switching to linux for precisely this reason; windows is a very annoying environment to work in... but, vidya games xD  I will take a look at your massiv package (lol...), is it open source (i.e. if I roll my own matrix operations using pure haskell you might consider merging them in via PR if they match you&#39;re packages theme?)"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1535905961, "post_id": 52137191, "comment_id": 91227523, "body": "Yes, it is open source. You can find it on hackage and here github.com/lehins/massiv I&#39;ll be happy to accept a PR, but before doing the work it might be worth opening an issue for the things you might want to add."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535935193, "post_id": 52137191, "comment_id": 91233899, "body": "@AlexeyKuleshevich note that \u201cmatrix operations\u201d in the conventional sense (Matlab / NumPy / bed-and-breakfast / HMatrix / etc.) go rather against the grain of Haskell itself, what with their unsafe runtime dimensions. The idiomatic thing to do in Haskell is to distinguish vector spaces through the type system. You may want to check out <a href=\"http://hackage.haskell.org/package/linear\" rel=\"nofollow noreferrer\">linear</a>, which is 100% native and takes a very Haskell-specific approach. (Which I find not optimal either, mind, prompting me to write <a href=\"http://hackage.haskell.org/package/free-vector-spaces\" rel=\"nofollow noreferrer\">free-vector-spaces</a>.)"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 1, "creation_date": 1535972352, "post_id": 52137191, "comment_id": 91246439, "body": "@ThomasCook Note that even on windows you can often use pacman (<code>stack exec pacman</code>) to get necessary dependencies. Not sure if OpenBLAS is available through that, but its worth a try."}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 6, "last_activity_date": 1535892548, "creation_date": 1535892548, "answer_id": 52137191, "question_id": 52137099, "link": "https://stackoverflow.com/questions/52137099/haskell-dependency-hell/52137191#52137191", "title": "Haskell dependency hell", "body": "<p>Here is the constraint on the latest available <code>bed-and-breakfast</code> package: <code>base (&gt;=4.5 &amp;&amp; &lt;4.7)</code>, which means it will likely not even compile with GHC version higher then 7.6. Considering that there is even no LTS snapshot prior to GHC 7.8, you are out of luck with that package.</p>\n\n<p>To say it in another words, the package is outdated and your choices are:</p>\n\n<ul>\n<li>submit an issue and hope maintainer will do something about it</li>\n<li>try to make it work with newer ghc yourself </li>\n<li>Use a different package</li>\n</ul>\n"}], "owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 595, "favorite_count": 0, "accepted_answer_id": 52137191, "answer_count": 1, "score": 2, "last_activity_date": 1535906078, "creation_date": 1535891835, "last_edit_date": 1535906078, "question_id": 52137099, "link": "https://stackoverflow.com/questions/52137099/haskell-dependency-hell", "title": "Haskell dependency hell", "body": "<p>I'm trying to include a specific version of a library in a Haskell project. The library is bed-and-breakfast (which is used for martix operations), but I need the specific version 0.4.3 which fixed a bug with the multiplication implementation.</p>\n\n<p>So, my stack.yaml looks like this:</p>\n\n<pre><code>flags: {}\nextra-package-dbs: []\npackages:\n- .\nextra-deps:\n- bed-and-breakfast-0.4\n- base-4.6.0.1\nresolver: lts-12.8\n</code></pre>\n\n<p>But I'm getting this error when building:</p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for bed-and-breakfast-0.4:\n    base-4.11.1.0 from stack configuration does not match &gt;=4.5 &amp;&amp; &lt;4.7  (latest matching version\n                  is 4.6.0.1)\nneeded due to realworldhaskell-0.1.0.0 -&gt; bed-and-breakfast-0.4\n\nSome different approaches to resolving this:\n\n\n  * Set 'allow-newer: true' to ignore all version constraints and build anyway.\n\n  * Consider trying 'stack solver', which uses the cabal-install solver to attempt to find some\n    working build configuration. This can be convenient when dealing with many complicated\n    constraint errors, but results may be unpredictable.\n\n  * Recommended action: try adding the following to your extra-deps\n    in C:\\Users\\info\\Desktop\\Projects\\haskell\\stack.yaml:\n\n- base-4.6.0.1\n</code></pre>\n\n<p>I've done the recommended action but it didn't solve anything. I've tried using different resolvers to see if it's an issue with my GHCi version but nothings worked. What is the best way to interpret error messages like this and how should I proceed?</p>\n\n<p>EDIT:</p>\n\n<p>If I remove -base.4.6.0.1 and add allow-newer: true I get this:</p>\n\n<pre><code>WARNING: Ignoring out of range dependency (allow-newer enabled): base-4.11.1.0. bed-and-breakfast requires: &gt;=4.5 &amp;&amp; &lt;4.7\nbed-and-breakfast-0.4: configure\nProgress 1/2\n\n--  While building custom Setup.hs for package bed-and-breakfast-0.4 using:\n      C:\\sr\\setup-exe-cache\\x86_64-windows\\Cabal-simple_Z6RU0evB_2.2.0.1_ghc-8.4.3.exe --builddir=.stack-work\\dist\\7d103d30 configure --with-ghc=C:\\Users\\info\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-8.4.3\\bin\\ghc.EXE --with-g\nhc-pkg=C:\\Users\\info\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-8.4.3\\bin\\ghc-pkg.EXE --user --package-db=clear --package-db=global --package-db=C:\\sr\\snapshots\\76fd1958\\pkgdb --package-db=C:\\Users\\info\\Desktop\\Projects\\haskell\\\n.stack-work\\install\\8c390635\\pkgdb --libdir=C:\\Users\\info\\Desktop\\Projects\\haskell\\.stack-work\\install\\8c390635\\lib --bindir=C:\\Users\\info\\Desktop\\Projects\\haskell\\.stack-work\\install\\8c390635\\bin --datadir=C:\\Users\\info\\Desktop\\Proj\nects\\haskell\\.stack-work\\install\\8c390635\\share --libexecdir=C:\\Users\\info\\Desktop\\Projects\\haskell\\.stack-work\\install\\8c390635\\libexec --sysconfdir=C:\\Users\\info\\Desktop\\Projects\\haskell\\.stack-work\\install\\8c390635\\etc --docdir=C:\n\\Users\\info\\Desktop\\Projects\\haskell\\.stack-work\\install\\8c390635\\doc\\bed-and-breakfast-0.4 --htmldir=C:\\Users\\info\\Desktop\\Projects\\haskell\\.stack-work\\install\\8c390635\\doc\\bed-and-breakfast-0.4 --haddockdir=C:\\Users\\info\\Desktop\\Pr\nojects\\haskell\\.stack-work\\install\\8c390635\\doc\\bed-and-breakfast-0.4 --dependency=array=array-0.5.2.0 --dependency=base=base-4.11.1.0 --dependency=binary=binary-0.8.5.1 --dependency=deepseq=deepseq-1.4.3.0 --dependency=template-hask\nell=template-haskell-2.13.0.0 --extra-include-dirs=C:\\Users\\info\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\include --extra-lib-dirs=C:\\Users\\info\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\min\n\ngw64\\bin --extra-lib-dirs=C:\\Users\\info\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\lib --exact-configuration\n    Process exited with code: ExitFailure 1\n    Logs have been written to: C:\\Users\\info\\Desktop\\Projects\\haskell\\.stack-work\\logs\\bed-and-breakfast-0.4.log\n\n    Configuring bed-and-breakfast-0.4...\n    Cabal-simple_Z6RU0evB_2.2.0.1_ghc-8.4.3.exe: The package has an impossible\n    version range for a dependency on an internal library: bed-and-breakfast\n    ==0.3.2. This version range does not include the current package, and must be\n    removed as the current package's library will always be used.\n</code></pre>\n\n<p>EDIT 2:</p>\n\n<p>Ok, so I'm guessing that the bed-and-breakfast library needs base 4.11.1.0 which is included in GHCi 6.10.2 (according to <a href=\"https://wiki.haskell.org/Base_package\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Base_package</a>) so I need a resolver which matches that GHCi version. Where can I find out what resolver version that is?</p>\n"}, {"tags": ["haskell", "fedora-28"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1535875279, "post_id": 52134945, "comment_id": 91220045, "body": "Try <code>ghc-pkg list</code> to check if everything&#39;s alrite."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535875832, "post_id": 52134945, "comment_id": 91220178, "body": "Perhaps you installed the &quot;software&quot;, but did not register it in the package manager."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1535879671, "post_id": 52134945, "comment_id": 91220919, "body": "I suspect Fedora&#39;s <code>ghc-containers-0.5.10.2-66</code> package actually targets a different compiler from the one you&#39;re trying to use it with. Haskell packages are always built against one specific compiler and can&#39;t be used with another. Most people do not rely on OS-distro packages for this at all but install all needed packages with Cabal-install or Stack. I.e., <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow noreferrer\">haskell.org/platform</a> or <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/README</a>."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 5, "creation_date": 1535891289, "post_id": 52134945, "comment_id": 91223624, "body": "I don&#39;t know why its not working; perhaps a bug in the Fedora RPM. However you are probably better off without the Fedora version of GHC. It exists primarily as the compiler for other Haskell software that is packaged for Fedora. I suggest removing it and installing stack instead."}], "answers": [{"comments": [{"owner": {"reputation": 739, "user_id": 2359990, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1f7130d72f637bce50544029ccd6998a?s=128&d=identicon&r=PG", "display_name": "Max Maier", "link": "https://stackoverflow.com/users/2359990/max-maier"}, "edited": false, "score": 1, "creation_date": 1536001818, "post_id": 52147989, "comment_id": 91260446, "body": "I finally went with stack where the code works as expected. Thanks for clarifying this!"}], "tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": true, "score": 4, "last_activity_date": 1535970912, "creation_date": 1535970912, "answer_id": 52147989, "question_id": 52134945, "link": "https://stackoverflow.com/questions/52134945/could-not-find-module-data-set/52147989#52147989", "title": "Could not find module &#39;Data.Set&#39;", "body": "<p>I would skip the operating system packages and go with <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\"><code>stack</code></a>:</p>\n\n<pre><code>$ wget -o get-stack.sh https://get.haskellstack.org/\n$ chmod +x get-stack.sh\n$ ./get-stack.sh -d ~/.local/bin\n$ echo 'export PATH=\"~/.local/bin:$PATH\"' &gt;&gt; ~/.bashrc\n$ source ~/.bashrc\n$ stack --version\nVersion 1.7.1, Git revision ...\n</code></pre>\n\n<p>Then use <code>stack ghc</code> to run GHC; the first time it will install this:</p>\n\n<pre><code>$ stack ghc\nWriting implicit global project config file to: ...\nNote: You can change the snapshot via the resolver field there.\nUsing latest snapshot resolver: lts-12.9\nDownloaded lts-12.9 build plan.    \nPreparing to install GHC to an isolated location.\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 391, "user_id": 196479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b482000b6e3554ee69d69fddea82cf4e?s=128&d=identicon&r=PG", "display_name": "Albert Peschar", "link": "https://stackoverflow.com/users/196479/albert-peschar"}, "is_accepted": false, "score": 0, "last_activity_date": 1553245994, "creation_date": 1553245994, "answer_id": 55296268, "question_id": 52134945, "link": "https://stackoverflow.com/questions/52134945/could-not-find-module-data-set/55296268#55296268", "title": "Could not find module &#39;Data.Set&#39;", "body": "<p><code>ghc-containers</code> contains only the shared library (.so) for compiled programs that are linked to it.  If you wish to use the library in development, install <code>ghc-containers-devel</code>:</p>\n\n<pre><code>$ dnf install -y ghc-containers-devel\n$ ghci\nGHCi, version 8.2.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; import Data.Set\nPrelude Data.Set&gt; \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1315, "user_id": 7133623, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-oTRkmNT7RVY/AAAAAAAAAAI/AAAAAAAABjU/A9o9mSGxL60/photo.jpg?sz=128", "display_name": "cdimitroulas", "link": "https://stackoverflow.com/users/7133623/cdimitroulas"}, "is_accepted": false, "score": 2, "last_activity_date": 1577013935, "creation_date": 1577013935, "answer_id": 59443793, "question_id": 52134945, "link": "https://stackoverflow.com/questions/52134945/could-not-find-module-data-set/59443793#59443793", "title": "Could not find module &#39;Data.Set&#39;", "body": "<p>For anyone new like me who finds this, you need to add <code>containers</code> to your package.yaml dependencies in order to import <code>Data.Set</code>. My package.yaml dependencies looked like this to get a <code>Data.Set</code> import to work:</p>\n\n<pre><code>dependencies:\n  - base &gt;= 4.7 &amp;&amp; &lt; 5\n  - containers &gt; 0.6\n</code></pre>\n\n<p>Then you can import Data.Set in your file like </p>\n\n<pre><code>import Data.Set (Set)\nimport qualified Data.Set as Set\n</code></pre>\n"}], "owner": {"reputation": 739, "user_id": 2359990, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1f7130d72f637bce50544029ccd6998a?s=128&d=identicon&r=PG", "display_name": "Max Maier", "link": "https://stackoverflow.com/users/2359990/max-maier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2068, "favorite_count": 1, "accepted_answer_id": 52147989, "answer_count": 3, "score": 4, "last_activity_date": 1577013935, "creation_date": 1535874067, "last_edit_date": 1535876894, "question_id": 52134945, "link": "https://stackoverflow.com/questions/52134945/could-not-find-module-data-set", "title": "Could not find module &#39;Data.Set&#39;", "body": "<p>I have the following RPM packages installed on my Fedora 28 system:</p>\n\n<pre><code>ghc-ghc-8.2.2-66\nghc-containers-0.5.10.2-66\n</code></pre>\n\n<p>According to <a href=\"http://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Set.html\" rel=\"nofollow noreferrer\">hackage</a> the set module should be included in the given RPMs. However trying to <code>import Data.Set</code> results in</p>\n\n<pre><code>&lt;no location info&gt;: error:\n    Could not find module \u2018Data.Set\u2019\n    Perhaps you meant Data.Int (from base-4.10.1.0)\n</code></pre>\n\n<p>Did I miss something to install? How can I check which modules are available?</p>\n\n<p><strong>Edit:</strong></p>\n\n<pre><code>$ ghc-pkg list\n/usr/lib64/ghc-8.2.2/package.conf.d\n    base-4.10.1.0\n    ghc-prim-0.5.1.1\n    integer-gmp-1.0.1.0\n    rts-1.0\n</code></pre>\n\n<p>How do I register a module?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1535871649, "post_id": 52134705, "comment_id": 91219415, "body": "Well <code>deriving</code> is actually only automatically generting an instance. But you can write <code>class Typeable a =&gt; Persistent a where ...</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1535872307, "post_id": 52134705, "comment_id": 91219530, "body": "No, this is not possible. In <code>class Persistent a</code>, <code>a</code> doesn&#39;t have to represent a <i>data type declaration</i>. It&#39;s just a type. For example you can add a <code>Persistent</code> instance to <code>Maybe Integer</code>. So it doesn&#39;t make much sense to talk about &quot;adding a <code>deriving Typeable</code> clause to all <code>a</code>s that happen to be <code>Persistent</code>&quot; --- you cannot say <code>data Maybe Integer deriving Typeable</code> or anything like that."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1535872796, "post_id": 52134705, "comment_id": 91219620, "body": "@WillemVanOnsem <code>class Typeable a =&gt; Persistent a</code> adds a <i>constraint</i> that anything that is <code>Persistent</code> must also be <code>Typeable</code>. It is probably needed but it doesn&#39;t help you satisfy the constraint. You still need to produce <code>Typeable</code> instances one way or another (e,g. add <code>deriving (Typeable)</code> to all relevant <code>data</code> clauses)."}, {"owner": {"reputation": 2126, "user_id": 1097074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CJavk.jpg?s=128&g=1", "display_name": "Rodion Gorkovenko", "link": "https://stackoverflow.com/users/1097074/rodion-gorkovenko"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1535872958, "post_id": 52134705, "comment_id": 91219645, "body": "@n.m thanks for explanation and feel free to make it answer so I can &quot;accept&quot; it! Also thank for clarifying that adding constraint to typeclass doesn&#39;t help :)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1535906459, "post_id": 52134705, "comment_id": 91227689, "body": "But why do you need this? In each particular instance, you <i>know</i> the type -- you just wrote it down in the instance declaration!"}], "answers": [{"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1535896630, "post_id": 52134892, "comment_id": 91225014, "body": "<code>Typeable</code> is perhaps a special example, since in modern GHCs, everything is implicitly a member of the <code>Typeable</code> class, and <code>deriving Typeable</code> is a no-op. Therefore, the superclass constraint is good enough and is effectively \u201cfree\u201d, except for the runtime cost of passing the dictionaries around."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 2, "last_activity_date": 1535873604, "creation_date": 1535873604, "answer_id": 52134892, "question_id": 52134705, "link": "https://stackoverflow.com/questions/52134705/haskell-typeclass-deriving-from-other-typeclass/52134892#52134892", "title": "Haskell: typeclass deriving from other typeclass", "body": "<p>No, this is not possible. </p>\n\n<p>In <code>class Persistent a</code>, a doesn't have to represent a data type declaration. It's just a type. For example, one can add a <code>Persistent</code> instance for <code>Maybe Integer</code>.</p>\n\n<pre><code>instance Persistent (Maybe Integer) where ...\n</code></pre>\n\n<p>So it doesn't make much sense to talk about \"adding a <code>deriving (Typeable)</code> clause to all <code>a</code>s that happen to be <code>Persistent</code>\". One cannot say <code>data Maybe Integer deriving Typeable</code> or anything like that. </p>\n\n<hr>\n\n<p>If you are absolutely sure that every <code>Persistent</code> thing <em>must</em> be <code>Typeable</code>, you may want to add a <em>constraint</em> to your <code>Persistent</code> class:</p>\n\n<pre><code>class Typeable a =&gt; Persistent a where ...\n</code></pre>\n\n<p>This however doesn't help you in any way with automatic derivation of <code>Typeable</code>. It just <em>requires</em> that for every <code>Persistent</code> instance there should be a <code>Typeable</code> instance, which you still have to produce yourself one way or another (e.g. by adding <code>deriving (Typeable)</code> to all relevant data types).</p>\n"}], "owner": {"reputation": 2126, "user_id": 1097074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CJavk.jpg?s=128&g=1", "display_name": "Rodion Gorkovenko", "link": "https://stackoverflow.com/users/1097074/rodion-gorkovenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 52134892, "answer_count": 1, "score": 1, "last_activity_date": 1535873604, "creation_date": 1535871556, "question_id": 52134705, "link": "https://stackoverflow.com/questions/52134705/haskell-typeclass-deriving-from-other-typeclass", "title": "Haskell: typeclass deriving from other typeclass", "body": "<p>Suppose I have a typeclass for entities being kept in database. Some simplified example may look like this:</p>\n\n<pre><code>class Persistent a where\n    fetch :: Int -&gt; IO (Maybe a)\n    store :: a -&gt; IO Bool\n</code></pre>\n\n<p>Now I found that for <code>store</code> I may need to know the type of entity, so it should be also <code>Typeable</code>.</p>\n\n<p>Is there some way to tell that all <code>Persistent</code> entities are <code>Typeable</code> without adding <code>deriving (Typeable)</code> to every specific <code>data</code> clause? E.g. like this:</p>\n\n<pre><code>class Persistent a deriving (Typeable) where\n    fetch :: Int -&gt; IO (Maybe a)\n    store :: a -&gt; IO Bool\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535876109, "post_id": 52133440, "comment_id": 91220249, "body": "I think the important part here is: functions take precedence over operators. So <code>f a b + g c d</code> is always <code>(f a b) + (g c d)</code>.."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1535893074, "post_id": 52133440, "comment_id": 91224100, "body": "In GHCi, <code>:info (.)</code> will tell you that <code>(.)</code> is declared with <code>infix 9 .</code>, a right-associative operator with precedence 9."}], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 4, "creation_date": 1535860433, "post_id": 52133486, "comment_id": 91217999, "body": "Though application isn&#39;t an operator, you can pretty much imagine it is, with &quot;word break&quot; as its symbol, and it acts like it is <code>infixl 10</code>. Similarly, as-patterns <code>var@pat</code> act like they are <code>infixr 11</code>, and the function type constructor <code>(-&gt;)</code> acts like it is <code>infixr -1</code>."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1535860607, "post_id": 52133486, "comment_id": 91218022, "body": "@HTNW <code>info (-&gt;)</code> actually reports <code>infixr 0 `(-&gt;)` </code>"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 3, "creation_date": 1535860935, "post_id": 52133486, "comment_id": 91218058, "body": "@Ben <a href=\"https://ghc.haskell.org/trac/ghc/ticket/15235\" rel=\"nofollow noreferrer\">Yes, that&#39;s a bug</a>."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 10, "last_activity_date": 1535854768, "creation_date": 1535854768, "answer_id": 52133486, "question_id": 52133440, "link": "https://stackoverflow.com/questions/52133440/whats-the-priority-for-function-composition-in-haskell/52133486#52133486", "title": "What&#39;s the priority for function composition in Haskell?", "body": "<p>All of the built-in operators' respective precedences and fixities can be found in the <a href=\"https://www.haskell.org/onlinereport/decls.html\" rel=\"noreferrer\">Haskell Report section 4.4.2</a>. In particular, <code>.</code> and <code>!!</code> have precedence 9, which is the highest among <em>operators</em>. However, function application is not an operator. Function application is specifically designed to have precedence higher than <em>any</em> operator, so</p>\n\n<pre><code>map (double.double) [1,2,3,4]\n</code></pre>\n\n<p>This is applying the function <code>double . double</code> to each element of the list <code>[1, 2, 3, 4]</code></p>\n\n<pre><code>map double.double [1,2,3,4]\n</code></pre>\n\n<p>This is attempting to compose the functions <code>map double</code> and <code>double [1, 2, 3, 4]</code>, which is unlikely to be successful (though it is not technically impossible).</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 2, "last_activity_date": 1535860457, "creation_date": 1535860457, "answer_id": 52133833, "question_id": 52133440, "link": "https://stackoverflow.com/questions/52133440/whats-the-priority-for-function-composition-in-haskell/52133833#52133833", "title": "What&#39;s the priority for function composition in Haskell?", "body": "<p>Precedence (and associativity) are ways of resolving the ambiguity between multiple infix operators in an expression. If there are two operators next to an operand, precedence (and associativity) tells you which of them takes the operand as an argument and which of them takes the other applied-operator expression as an argument. For example, in the expression <code>1 + 2 * 3</code>, the <code>2</code> is next to both <code>+</code> and <code>*</code>. The higher precedence of <code>*</code> means that <code>*</code> gets the <code>2</code> as its left argument, while <code>+</code> takes the whole <code>2 * 3</code> sub-expression as its right argument.</p>\n\n<p>However that's not the case in <code>map double.double [1, 2, 3, 4]</code>. There's only one operator, with two operands on either side, so there's no question for precedence to answer for us. The two operands are <code>map double</code> and <code>double [1, 2, 3, 4]</code>; operands are <em>sequences</em> of one or more terms, not only the immediate left and right terms. Where there's more than one term the sequence is parsed as simple chained function application (i.e. <code>a b c d</code> is <code>((a b) c) d</code>).</p>\n\n<p>Another way to think of it is that there is an \"adjacency operator\" which has higher precedence than can be assigned to anything else, and is invisibly present between any two non-operator terms (but not anywhere else). In this way of thinking <code>map double.double [1, 2, 3, 4]</code> is really something like <code>map @ double . double @ [1, 2, 3, 4]</code> (where I've written this \"adjacency operator\" as <code>@</code>). Since <code>@</code> has higher precedence than <code>.</code>, this is <code>(map @ double) . (double @ [1, 2, 3, 4])</code>.<sup>1</sup></p>\n\n<p>Whichever way you choose to interpret it, there is a simple consequence. It is simply impossible for <em>any</em> applied operator expression to be passed as an argument in non-operator function application unless there are parentheses around the operator application. If there is an operator in an expression outside any parentheses, then the outermost layer of the expression is always going to be an operator application.</p>\n\n<hr>\n\n<p><sup>1</sup> This adjacency operator explanation seems to be pretty common. I personally think it is a poor explanation for how to parse expressions, since you need to partially parse an expression to know where to insert the adjacency operators.</p>\n\n<p>It's often called the \"whitespace operator\", which is even more confusing since not every piece of whitespace represents this operator, and you don't always need whitespace for it to be there. e.g. <code>length\"four\" + 1</code> </p>\n"}], "owner": {"reputation": 177, "user_id": 3489985, "user_type": "registered", "accept_rate": 18, "profile_image": "https://www.gravatar.com/avatar/9a5aa0db9fd86c13966ccbc9d8df3007?s=128&d=identicon&r=PG&f=1", "display_name": "user3489985", "link": "https://stackoverflow.com/users/3489985/user3489985"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 685, "favorite_count": 1, "accepted_answer_id": 52133486, "answer_count": 2, "score": 4, "last_activity_date": 1535860457, "creation_date": 1535853963, "last_edit_date": 1535854838, "question_id": 52133440, "link": "https://stackoverflow.com/questions/52133440/whats-the-priority-for-function-composition-in-haskell", "title": "What&#39;s the priority for function composition in Haskell?", "body": "<p>I saw this code on my textbook:</p>\n\n<pre><code>double :: (Num a) =&gt; a -&gt; a\ndouble x = x * 2\n\nmap (double.double) [1,2,3,4]\n</code></pre>\n\n<p>What I don't get is that if functional composition operation have the highest priority, why use parentheses to include double.double? If I remove those parentheses, I get error message. So what's exactly is functional composition's priority?</p>\n"}, {"tags": ["haskell", "free-monad"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1535807882, "creation_date": 1535807882, "answer_id": 52128492, "question_id": 52127882, "link": "https://stackoverflow.com/questions/52127882/freer-simple-freer-monads-how-do-i-unify-io-exception-handling-with-error-effect/52128492#52128492", "title": "Freer-Simple Freer Monads How do I Unify IO Exception Handling with Error Effect", "body": "<p><code>interpretM</code> takes an interpreter in <code>IO</code> (<a href=\"http://hackage.haskell.org/package/freer-simple-1.1.0.0/docs/Control-Monad-Freer.html#v:interpretM\" rel=\"nofollow noreferrer\">its first argument has type <code>eff ~&gt; m</code></a> with <code>m ~ IO</code> here), so that doesn't allow you to throw <code>AppError</code>s via the <code>Members '[Error AppError] effs</code> constraint.</p>\n\n<p>Instead you can use <code>interpret</code>, with full access to <code>effs</code>. That would roughly look like:</p>\n\n<pre><code>fileSystemIOInterpreter\n  :: forall effs a\n  .  (Members '[Error AppError] effs, LastMember IO effs)\n  =&gt; Eff (FileSystem ': effs) a -&gt; Eff effs a\nfileSystemIOInterpreter = interpret $ \\case\n    ReadFile path -&gt; do\n        r &lt;- sendM (try (F.readFileUTF8 path))\n        case r of\n            Left (e :: IOException) -&gt; throwError (ioToAppErr e)\n            Right f -&gt; pure f\n\n-- for some value of\nioToAppErr :: IOException -&gt; AppError\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 1798586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b1c9008ee67a450ada765469e3b8d66?s=128&d=identicon&r=PG", "display_name": "Sergey  Stretovich", "link": "https://stackoverflow.com/users/1798586/sergey-stretovich"}, "is_accepted": false, "score": 1, "last_activity_date": 1594117399, "creation_date": 1594117399, "answer_id": 62773111, "question_id": 52127882, "link": "https://stackoverflow.com/questions/52127882/freer-simple-freer-monads-how-do-i-unify-io-exception-handling-with-error-effect/62773111#62773111", "title": "Freer-Simple Freer Monads How do I Unify IO Exception Handling with Error Effect", "body": "<p>Here's a complete working example :</p>\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE LambdaCase #-}\n{-# LANGUAGE MonoLocalBinds #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nmodule Main where\n\nimport Data.String\nimport qualified Data.ByteString.Char8 as B\nimport Control.Exception\nimport Data.List\nimport Data.Text (Text, pack, unpack)\nimport Data.Text.IO\nimport Data.Text.Encoding (decodeUtf8)\nimport Control.Natural (type (~&gt;))\nimport qualified  Control.Monad.Freer.Error as ER\nimport Control.Monad.Freer\n  (\n    Eff\n  , LastMember\n  , Member\n  , Members\n  , interpret\n  , send\n  , sendM\n  , runM\n  )\n\nreadFileUTF8 :: String -&gt; IO Text\nreadFileUTF8 path = decodeUtf8 &lt;$&gt; B.readFile path\n\nioToAppErr :: IOException -&gt; AppError\nioToAppErr ioe = AppError (displayException ioe)\n\nnewtype AppError = AppError String deriving Show\n\ndata FileSystem r where\n  ReadFile :: FilePath -&gt; FileSystem Text\n\nreadFile :: Members '[FileSystem, ER.Error AppError] effs =&gt; FilePath -&gt; Eff effs Text\nreadFile fpath = if (elem 'x' fpath)\n                     then (ER.throwError  (AppError &quot;No Xs allowed in file name&quot;))\n                 else(send $ ReadFile fpath)\n\nrunAppError :: Eff (ER.Error AppError ': r) a -&gt; Eff r (Either AppError a)\nrunAppError = ER.runError\n\nfileSystemIOInterpreter\n  :: (Members '[ER.Error AppError] effs, LastMember IO effs)\n  =&gt; Eff (FileSystem ': effs) a -&gt; Eff effs a\nfileSystemIOInterpreter = interpret $ \\case\n    ReadFile path -&gt; do\n        r &lt;- sendM (try (readFileUTF8 path))\n        case r of\n            Left (e :: IOException) -&gt; ER.throwError (ioToAppErr e)\n            Right f -&gt; pure f\n\napplication :: Members '[FileSystem, ER.Error AppError] effs =&gt; FilePath -&gt; Eff effs Text\napplication = Main.readFile\n\nioApp :: FilePath -&gt; IO (Either AppError Text)\nioApp path = runM\n              $ runAppError\n              $ fileSystemIOInterpreter\n              $ application path\n\nmain :: IO ()\nmain = do\n  let pathX = &quot;C:\\\\text.info&quot;\n  let pathNoX = &quot;C:\\\\simple.t&quot;\n  let pathNoSuchAFile = &quot;C:\\\\habrahabr.bib&quot;\n  result &lt;- ioApp pathX\n  Data.Text.IO.putStrLn $ pack (show result)\n</code></pre>\n<p>dependencies:</p>\n<ul>\n<li>base &gt;= 4.7 &amp;&amp; &lt; 5</li>\n<li>text</li>\n<li>freer-simple</li>\n<li>natural-transformation</li>\n<li>bytestring</li>\n</ul>\n"}], "owner": {"reputation": 371, "user_id": 5589037, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a8e0afcaf170b7c13a53093cf2f5f84c?s=128&d=identicon&r=PG&f=1", "display_name": "John Walker", "link": "https://stackoverflow.com/users/5589037/john-walker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 1, "accepted_answer_id": 52128492, "answer_count": 2, "score": 3, "last_activity_date": 1594117399, "creation_date": 1535803156, "last_edit_date": 1535892719, "question_id": 52127882, "link": "https://stackoverflow.com/questions/52127882/freer-simple-freer-monads-how-do-i-unify-io-exception-handling-with-error-effect", "title": "Freer-Simple Freer Monads How do I Unify IO Exception Handling with Error Effect", "body": "<p>I am using <a href=\"http://hackage.haskell.org/package/freer-simple-1.1.0.0\" rel=\"nofollow noreferrer\">freer-simple</a> to write a super simple DSL. All it does is read a file.\nI have one rule regarding file names, they cannot contain the letter x. Any attempt to open a file with the letter x in it will result in a: Left <code>(AppError \"No Xs allowed in file name\")</code>. </p>\n\n<p>How would I catch an IO error when reading a file in <code>fileSystemIOInterpreter</code> and throw it as an application error? Ie. I am trying to convert selected IO exceptions into AppErrors (see <code>??????</code>). </p>\n\n<pre><code>{- File System Lang -}\n\ndata FileSystem r where\n  ReadFile :: Path a File -&gt; FileSystem StrictReadResult\n\nreadFile :: Members '[FileSystem, Error AppError] effs =&gt; Path a File -&gt; Eff effs StrictReadResult\nreadFile path = let\n                  pthStr = toStr $ toFilePath path\n                in\n                  F.elem 'x' pthStr\n                        ? throwError (AppError \"No Xs allowed in file name\")\n                        $ send $ ReadFile path\n\n{- Errors -}\n\nnewtype AppError = AppError String deriving Show\n\nrunAppError :: Eff (Error AppError ': r) a -&gt; Eff r (Either AppError a)\nrunAppError = runError\n\n{- File System IO Interpreter -}\n\nfileSystemIOInterpreter :: forall effs a. (Members '[Error AppError] effs, LastMember IO effs) =&gt; Eff (FileSystem ': effs) a -&gt; Eff effs a\nfileSystemIOInterpreter = interpretM $ \\case\n                                          ReadFile path -&gt; F.readFileUTF8 path\n                                          -- ??????\n\n-- this compiles: fileSystemIOInterpreter effs = throwError $ AppError \"BLahh\"\n\napplication :: Members '[FileSystem, Error AppError] effs =&gt; Path a File -&gt; Eff effs StrictReadResult\napplication = readFile\n\nioApp :: Path a File -&gt; IO (Either AppError StrictReadResult)\nioApp path = runM\n              $ runAppError\n              $ fileSystemIOInterpreter\n              $ application path\n\n-- running the app\n\ndemoPassApp = ioApp [absfile|C:\\Vids\\SystemDesign\\VidList.md|]\n&gt;&gt; Right (Right \"Text content of VidList.md\")\n\ndemoFailApp = ioApp [absfile|C:\\Vids\\SystemDesign\\VidList.txt|]\n&gt;&gt; Left (AppError \"No Xs allowed in file name\")\n\ndemoFailIOApp = ioApp [absfile|C:\\Vids\\SystemDesign\\MissingFile.md|]\n&gt;&gt; *** Exception: C:\\Vids\\SystemDesign\\MissingFile.md: openBinaryFile: does not exist (No such file or directory)\n-- I want to turn this into an AppError\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1535802171, "post_id": 52127733, "comment_id": 91205916, "body": "The closing tag is <code>:}</code>, not <code>}:</code>. The colon is actually <i>not</i> really part of the encapsulation, it is used to &quot;perform GHCi commands&quot;."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 4, "creation_date": 1535802309, "post_id": 52127733, "comment_id": 91205958, "body": "I.e. it&#39;s still waiting for you to close the block with <code>:}</code>."}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 7265671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42e4d4bc138d72a1ee48c3b365dbd1b1?s=128&d=identicon&r=PG&f=1", "display_name": "HayashiEsme", "link": "https://stackoverflow.com/users/7265671/hayashiesme"}, "edited": false, "score": 0, "creation_date": 1535803311, "post_id": 52127756, "comment_id": 91206189, "body": "Ah, thank you so much for that insight about the &gt; and the |. That&#39;ll be real helpful in the future. Sorry for asking a stupid question but how would you change up the last statement to get the thing to work? I&#39;m actually not understanding what I&#39;ve written that&#39;s causing the issue"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 161, "user_id": 7265671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42e4d4bc138d72a1ee48c3b365dbd1b1?s=128&d=identicon&r=PG&f=1", "display_name": "HayashiEsme", "link": "https://stackoverflow.com/users/7265671/hayashiesme"}, "edited": false, "score": 0, "creation_date": 1535805890, "post_id": 52127756, "comment_id": 91206849, "body": "@HayashiEsme there are two mistakes at once. First of all, you need parentheses, e.g. <code>sumCircle (x:restOfList)</code>. Otherwise you will match a list <i>inside of a list</i>, e.g. <code>[[1,2,3,4,5]]</code>, where <code>x</code> is <code>1</code> and <code>[2,3,4,5]</code>. And next, well, <code>sumCircle x</code> in the last line expects <code>x</code> to be a list. But that would make <code>restOfList</code> a list of lists, which would beget <code>x</code> as list of lists, which makes <code>restOfList</code> a list of list of lists, which\u2026 you get it. <code>sumCircle</code> only works for lists, yet you try to use it on a single element. It gets a lot more clear if you use explicit type signatures."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 6, "last_activity_date": 1535802432, "last_edit_date": 1535802432, "creation_date": 1535802112, "answer_id": 52127756, "question_id": 52127733, "link": "https://stackoverflow.com/questions/52127733/what-does-it-mean-if-ghci-doesnt-declare-a-function-type/52127756#52127756", "title": "What does it mean if GHCi doesn&#39;t declare a function type?", "body": "<p>Your delimiter for the multi-line input is swapped. You need <code>:}</code> in order to close multi-line input, not <code>}:</code>. Remember, the colon (<code>:</code>) signals GHCi that the lines content isn't Haskell, but instead a GHCi-specific construct.</p>\n\n<p>We can see that also at GHCi's prompt:</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| let sumCircle [] = error \"empty list\";\nPrelude|     sumCircle [x] = 3.14159*x^2;\nPrelude|     sumCircle [x:restOfList] = sumCircle x + sumCircle restOfList\nPrelude| }:\nPrelude|\n</code></pre>\n\n<p>Note that it's still <code>Prelude|</code>, not <code>Prelude&gt;</code>. As soon as we use <code>:}</code> instead, we end up with the syntax error due to the <code>}:</code>:</p>\n\n<pre><code>Prelude| :}\n\n&lt;interactive&gt;:5:1: error:\n    parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n\n<p>And if we use the proper delimiter from the start, we end up with the expected type error:</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| let sumCircle [] = error \"empty list\";\nPrelude|     sumCircle [x] = 3.14159*x^2;\nPrelude|     sumCircle [x:restOfList] = sumCircle x + sumCircle restOfList\nPrelude| :}\n\n&lt;interactive&gt;:4:56: error:\n    * Occurs check: cannot construct the infinite type: t ~ [t]\n    * In the first argument of `sumCircle', namely `restOfList'\n      In the second argument of `(+)', namely `sumCircle restOfList'\n      In the expression: sumCircle x + sumCircle restOfList\n    * Relevant bindings include\n        restOfList :: [t] (bound at &lt;interactive&gt;:4:18)\n        x :: t (bound at &lt;interactive&gt;:4:16)\n        sumCircle :: t -&gt; [t] (bound at &lt;interactive&gt;:2:5)\n</code></pre>\n\n<p>By the way, you can use <code>pi</code> instead of <code>3.1415926\u2026</code>, and with <code>sum</code> and <code>map</code> you don't need explicit recursion, but that's for the later cleanup.</p>\n"}], "owner": {"reputation": 161, "user_id": 7265671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42e4d4bc138d72a1ee48c3b365dbd1b1?s=128&d=identicon&r=PG&f=1", "display_name": "HayashiEsme", "link": "https://stackoverflow.com/users/7265671/hayashiesme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "closed_date": 1535857895, "accepted_answer_id": 52127756, "answer_count": 1, "score": 0, "last_activity_date": 1535802432, "creation_date": 1535801903, "question_id": 52127733, "link": "https://stackoverflow.com/questions/52127733/what-does-it-mean-if-ghci-doesnt-declare-a-function-type", "closed_reason": "Not suitable for this site", "title": "What does it mean if GHCi doesn&#39;t declare a function type?", "body": "<p>and I'm struggling to understand why this is wrong. GHCi hasn't been showing its function type or throwing an error which makes it hard for me to debug. Is there a reason: 1. Why it isn't throwing any error 2. What is making this code not work?</p>\n\n<pre><code>:{\nlet sumCircle [] = error \"empty list\";\n    sumCircle [x] = 3.14159*x^2;\n    sumCircle [x:restOfList] = sumCircle x + sumCircle restOfList\n}:\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack", "stackage"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1535827066, "post_id": 52126467, "comment_id": 91212623, "body": "I was wondering whether the <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#compiler-check\" rel=\"nofollow noreferrer\"><code>compiler-check</code> option</a> might be at play here, but even the <code>newer-minor</code> variant shouldn&#39;t allow this."}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1535831727, "post_id": 52126467, "comment_id": 91213852, "body": "thanks - the compiler check helped. I wonder why exact match is not default; a miss on the compiler makesa package compiling on one machine not compiling on another - which is what stack wants to achieve."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1535855607, "post_id": 52126467, "comment_id": 91217447, "body": "So the documentation is wrong then? Could you maybe report this on <code>stack</code>&#39;s issue tracker?"}], "answers": [{"tags": [], "owner": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "is_accepted": false, "score": 0, "last_activity_date": 1535803920, "creation_date": 1535803920, "answer_id": 52127977, "question_id": 52126467, "link": "https://stackoverflow.com/questions/52126467/lts-9-9-is-associated-with-ghc-8-0-2-why-does-it-use-8-0-1/52127977#52127977", "title": "lts 9.9 is associated with ghc 8.0.2. why does it use 8.0.1", "body": "<p>This can happen if <code>ghc-8.0.1</code> is a system-based installed version of <code>ghc</code>, and <code>stack</code> is configured to use it instead of its own sandboxed version.</p>\n\n<p>There is a pretty comprehensive page describing all the cases - <a href=\"https://docs.haskellstack.org/en/stable/faq/\" rel=\"nofollow noreferrer\">https://docs.haskellstack.org/en/stable/faq/</a></p>\n"}], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1535805597, "creation_date": 1535791417, "last_edit_date": 1535805597, "question_id": 52126467, "link": "https://stackoverflow.com/questions/52126467/lts-9-9-is-associated-with-ghc-8-0-2-why-does-it-use-8-0-1", "title": "lts 9.9 is associated with ghc 8.0.2. why does it use 8.0.1", "body": "<p>I have a stack yaml with resolver lts-9.9 which is associated with ghc 8.0.2 (see <a href=\"https://www.stackage.org/lts-9.9\" rel=\"nofollow noreferrer\">https://www.stackage.org/lts-9.9</a> but when I run <code>stack solver</code> I see:</p>\n\n<pre><code>Using resolver: lts-9.9\nUsing compiler: ghc-8.0.1\n</code></pre>\n\n<p>and not ghc-8.0.2. This seems to violate that a stack build is constrained to exactly one set of packages and ghc? What do I overlook?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1535791507, "post_id": 52126267, "comment_id": 91203579, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/27667628/the-meaning-of-tilde-in-haskell-types-type-equality\">The meaning of tilde in Haskell types (Type equality)</a>"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1535791814, "post_id": 52126267, "comment_id": 91203645, "body": "@AJFarmar That other thread does not address the question of why these two statements of type equality <i>(<code>instance D a a</code> is also a type equality statement, is it not?)</i> lead to different behaviours."}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1535792643, "post_id": 52126515, "comment_id": 91203848, "body": "Nice point about <code>~</code> being applied after instance selection! But notice that changing <code>(f x)</code> to <code>[x]</code> does not change anything in these examples. So, <code>D a a</code> is just as specific as <code>D a [x]</code>, even though the latter mentions a specific type constructor? And, therefore, the specificity of the instance head does not vary with the specificity of type constructors of kind <code>* -&gt; *</code>? This is very surprising, and this detail is what makes it hard for me to accept this explanation. Furthermore, it is very obscure what role does <code>overlapping</code> pragma play. Try removing it \u2014 everything breaks!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1535793060, "post_id": 52126515, "comment_id": 91203929, "body": "@IgnatInsarov I think the rule is, roughly: given <code>D a a</code>, can I somehow substitute <code>a</code> so that the instance becomes of the form <code>D a&#39; [x&#39;]</code>? If so, the latter is more specific. In your example, this can not be done.Further, given <code>D a [x]</code>, we can not substitute <code>a,x</code> so that it becomes of the form <code>D a&#39; a&#39;</code>. So neither is more specific: they are incomparable like <code>D a Char</code> and <code>D Char a</code> would be. Instead <code>D a a</code> would be less specific than <code>D [x] [x]</code> and <code>D Char Char</code>."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1535794058, "post_id": 52126515, "comment_id": 91204132, "body": "Oh, I see, so the instance heads are only partially ordered. That makes sense."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1535812213, "last_edit_date": 1535812213, "creation_date": 1535791829, "answer_id": 52126515, "question_id": 52126267, "link": "https://stackoverflow.com/questions/52126267/what-does-tilde-mean-in-an-instance-context-and-why-is-it-necessary-to-re/52126515#52126515", "title": "What does `~` (tilde) mean in an instance context, and why is it necessary to resolve overlap in some cases?", "body": "<p>First: only instance head matters during instance selection: what's on the left of <code>=&gt;</code> does not matter. So, <code>instance D a a</code> prevents selection unless they are equal; <code>instance ... =&gt; D u a</code> can always be selected.</p>\n\n<p>Now, the overlap pragmas only come into play if one instance is already more \"specific\" than the other. \"Specific\", in this case, means \"if there exists a substitution of type variables that can instantiate an instance head <code>A</code> to instance head <code>B</code>, then <code>B</code> is more specific than <code>A</code>\". In</p>\n\n<pre><code>instance D a a\ninstance {-# OVERLAPPING #-} D u (f x)\n</code></pre>\n\n<p>neither is more specific than the other, as there is no substitution <code>a := ?</code> that makes <code>D a a</code> into <code>D u (f x)</code>, nor is there any substitution <code>u := ?; f := ?; x := x</code> that makes <code>D u (f x)</code> into <code>D a a</code>. The <code>{-# OVERLAPPING #-}</code> pragma does nothing (at least, pertaining to the problem). So, when resolving the constraint <code>D [Integer] [Integer]</code>, the compiler finds both instances to be candidates, neither more specific than the other, and gives an error.</p>\n\n<p>In</p>\n\n<pre><code>instance (u ~ a) =&gt; D u a\ninstance {-# OVERLAPPING #-} D u (f x)\n</code></pre>\n\n<p>the second instance is more specific than the first one, because the first one can be instantiated with <code>u := u; a := f x</code> to get to the second one. The pragma now pulls its weight. When resolving <code>D [Integer] [Integer]</code>, both instances match, the first one with <code>u := [Integer]; a := [Integer]</code>, and the second with <code>u := [Integer]; f := []; x := Integer</code>. However, the second is both more specific and <code>OVERLAPPING</code>, so the first one is discarded as a candidate and the second instance is used. (Side note: I think the <em>first</em> instance should be <code>OVERLAPPABLE</code>, and the second instance should have no pragma. This way, all future instances implicitly overlap the catch-all instance, instead of having to annotate each one.)</p>\n\n<p>With that trick, selection is done with the right priority, and then equality between the two arguments is forced anyway. This combination achieves what you want, apparently.</p>\n\n<p>One way to visualize what is happening is a Venn diagram. From the first attempt, <code>instance D a a</code> and <code>instance D u (f x)</code> form two sets, the sets of the pairs of types that each one can match. These sets do overlap, but there are many pairs of types only <code>D a a</code> matches, and many pairs only <code>D u (f x)</code> matches. Neither can be said to be more specific, so the <code>OVERLAPPING</code> pragma fails. In the second attempt, <code>D u a</code> actually covers the entire <em>universe</em> of pairs of types, and <code>D u (f x)</code> is a subset (read: inside) of it. Now, the <code>OVERLAPPING</code> pragma works. Thinking in this way also shows us another way to make this work, by creating a new set that covers exactly the intersection of the first try.</p>\n\n<pre><code>instance D a a\ninstance D u (f x)\ninstance {-# OVERLAPPING #-} (f x) (f x)\n</code></pre>\n\n<p>But I'd go with the one with two instances unless you <em>really</em> need to use this one for some reason.</p>\n\n<p>Note, however, that overlapping instances are considered a bit fragile. As you noticed, it is often tricky to understand which instance is picked and why. One needs to consider all the instances in scope, their priorities, and essentially run a nontrivial selection algorithm in one's mind to understand what's going on. When the instances are defined across multiple modules (including orphans) things become even more complex, because selection rules might differ according to the local imports. This can even lead to incoherence. It is best to avoid them when possible.</p>\n\n<p>See also the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#instance-overlap\" rel=\"nofollow noreferrer\">GHC manual</a>.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 361, "favorite_count": 1, "accepted_answer_id": 52126515, "answer_count": 1, "score": 6, "last_activity_date": 1535812213, "creation_date": 1535789671, "last_edit_date": 1535792110, "question_id": 52126267, "link": "https://stackoverflow.com/questions/52126267/what-does-tilde-mean-in-an-instance-context-and-why-is-it-necessary-to-re", "title": "What does `~` (tilde) mean in an instance context, and why is it necessary to resolve overlap in some cases?", "body": "<h3>A complication.</h3>\n\n<p>Consider the following snippet:</p>\n\n<pre><code>class                        D u a     where printD :: u -&gt; a -&gt; String\ninstance                     D a a     where printD _ _ = \"Same type instance.\"\ninstance {-# overlapping #-} D u (f x) where printD _ _ = \"Instance with a type constructor.\"\n</code></pre>\n\n<p>And this is how it works:</p>\n\n<pre><code>\u03bb printD 1 'a'\n...\n...No instance for (D Integer Char)...\n...\n\n\u03bb printD 1 1\n\"Same type instance.\"\n\n\u03bb printD [1] [1]\n...\n...Overlapping instances for D [Integer] [Integer]\n...\n\n\u03bb printD [1] ['a']\n\"Instance with a type constructor.\"\n</code></pre>\n\n<p>Note that the overlapping instances are not resolved, despite the pragma being supplied to this\nend.</p>\n\n<p>&nbsp;</p>\n\n<h3>A solution.</h3>\n\n<p>It took some guesswork to arrive at the following adjusted definition:</p>\n\n<pre><code>class                        D' u a     where printD' :: u -&gt; a -&gt; String\ninstance (u ~ a) =&gt;          D' u a     where printD' _ _ = \"Same type instance.\"\ninstance {-# overlapping #-} D' u (f x) where printD' _ _ = \"Instance with a type constructor.\"\n</code></pre>\n\n<p>It works as I expected the previous to:</p>\n\n<pre><code>\u03bb printD' 1 'a'\n...\n...No instance for (Num Char)...\n...\n\n\u03bb printD' 1 1\n\"Same type instance.\"\n\n\u03bb printD' [1] [1]\n\"Instance with a type constructor.\"\n\n\u03bb printD' [1] ['a']\n\"Instance with a type constructor.\"\n</code></pre>\n\n<p>&nbsp;</p>\n\n<h3>My questions.</h3>\n\n<p>I am having a hard time understanding what is happening here. Is there an explanation?</p>\n\n<p>Particularly, I can put forward two separate questions:</p>\n\n<ol>\n<li>Why is the overlap not resolved in the first snippet?</li>\n<li>Why is the overlap resolved in the second snippet?</li>\n</ol>\n\n<p>But, if the issues are connected, perhaps a single, unified theory would serve explaining this case better.</p>\n\n<p>&nbsp;</p>\n\n<p><strong>P.S. concerning a close / duplicate vote</strong> &nbsp; I am aware that <code>~</code> signifies type equality, and I am consciously using it to obtain the behaviour I need <em>(particularly, <code>printD' 1 'a'</code> not matching)</em>. It hardly explains anything concerning specifically the case I presented, where the two ways of stating type equality <em>(the <code>~</code> and the <code>instance D a a</code>)</em> lead to two subtly distinct behaviours.</p>\n\n<p>&nbsp;</p>\n\n<hr>\n\n<p><strong>note</strong> &nbsp; I tested the snippets above with <code>ghc</code> <code>8.4.3</code> and <code>8.6.0.20180810</code></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1535788619, "post_id": 52126079, "comment_id": 91202898, "body": "Yes, don&#39;t use <code>(++)</code> since it takes <i>O(n)</i>."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1586374785, "last_edit_date": 1586374785, "creation_date": 1535788672, "answer_id": 52126131, "question_id": 52126079, "link": "https://stackoverflow.com/questions/52126079/efficient-string-swapping-in-haskell/52126131#52126131", "title": "Efficient string swapping in Haskell", "body": "<p>Affixing something at the end of the accumulator passed <em>into</em> a recursive call </p>\n\n<pre><code>    swapRec (x:y:xs) resultSoFar  =  swapRec xs \n         (resultSoFar ++ [y] ++ [x])\n</code></pre>\n\n<p>is the same as prepending it at the start of the result returned <em>from</em> the recursive call:</p>\n\n<pre><code>    swapRec (x:y:xs)  =  [y] ++ [x] ++ swapRec xs \n</code></pre>\n\n<p>You will have to amend your function accordingly throughout.</p>\n\n<p>This is known as guarded recursion. What you were using is known as tail recursion (a <em>left</em> fold).</p>\n\n<p>The added benefit is that it will now be <em>on-line</em> (i.e., taking <em>O(1)</em> time per each processed element). You were creating the <code>(++)</code> nesting on the <em>left</em> which leads to <em>quadratic</em> behaviour, as discussed e.g. <a href=\"https://stackoverflow.com/a/13879693/849891\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 9, "last_activity_date": 1535790802, "last_edit_date": 1535790802, "creation_date": 1535788947, "answer_id": 52126164, "question_id": 52126079, "link": "https://stackoverflow.com/questions/52126079/efficient-string-swapping-in-haskell/52126164#52126164", "title": "Efficient string swapping in Haskell", "body": "<p>Yes. If you use <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:-43--43-\" rel=\"noreferrer\"><strong><code>(++) :: [a] -&gt; [a] -&gt; [a]</code></strong></a>, then this takes linear time in the number of elements of the <em>first</em> list you want to concatenate. Since <code>result</code> can be large, this will result in a ineffeciency: the algorithm is then <em>O(n<sup>2</sup>)</em>.</p>\n\n<p>You however do not <em>need</em> to construct the result with an accumulator. You can return a list, and do the processing of the remaining elements with a recursive call, like:</p>\n\n<pre><code>swap :: [a] -&gt; [a]\nswap [] = []\nswap [x] = [x]\nswap (x:y:xs) = y : x : swap xs</code></pre>\n\n<p>The above also uncovered a problem with the implementation: if the list had an odd length, then the function would have crashed. Here in the second case, we handle a list with one element by returning that list (perhaps you need to modify this according to the specifications).</p>\n\n<p>Furthermore here we can benefit of Haskell's laziness: if we have a large list, want to pass it through the <code>swap</code> function, but are only interested in the first five elements, then we will <em>not</em> calculate the entire list.</p>\n\n<p>We can also process all kinds of list with the above function: a list of numbers, of strings, etc.</p>\n\n<p>Note that <code>(++)</code> itself is not <em>inherently</em> bad: if you need to concatenate, it is of course the most efficient way to do this. The problem is that you here in every recursive step will concatenate <em>again</em>, and the left list is growing each time.</p>\n"}], "owner": {"reputation": 345, "user_id": 5717066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zXUcs.jpg?s=128&g=1", "display_name": "Matteo Ugolotti", "link": "https://stackoverflow.com/users/5717066/matteo-ugolotti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 52126164, "answer_count": 2, "score": 5, "last_activity_date": 1586374785, "creation_date": 1535788174, "question_id": 52126079, "link": "https://stackoverflow.com/questions/52126079/efficient-string-swapping-in-haskell", "title": "Efficient string swapping in Haskell", "body": "<p>I'm trying to solve a problem for a functional programming exercise in Haskell. I have to implement a function such that, given a string with an even number of characters, the function returns the same string with character pairs swapped.</p>\n\n<p>Like this:</p>\n\n<p>\"helloworld\" -> \"ehllworodl\"</p>\n\n<p>This is my current implementation:</p>\n\n<pre><code>swap :: String -&gt; String\nswap s = swapRec s \"\"\n  where\n    swapRec :: String -&gt; String -&gt; String\n    swapRec [] result       = result\n    swapRec (x:y:xs) result = swapRec xs (result++[y]++[x])\n</code></pre>\n\n<p>My function returns the correct results, however the programming exercise is timed, and It seems like my code is running too slowly.</p>\n\n<p>Is there something I could do to make my code run faster, or I am following the wrong approach to the problem ?</p>\n"}, {"tags": ["haskell", "io", "monads", "type-mismatch", "do-notation"], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1536217481, "last_edit_date": 1536217481, "creation_date": 1535784738, "answer_id": 52125673, "question_id": 52125583, "link": "https://stackoverflow.com/questions/52125583/haskell-get-values-from-io-domain/52125673#52125673", "title": "Haskell get values from IO domain", "body": "<p>The thing about <code>do</code> notation is, every monadic action value in it (those to the right of <code>&lt;-</code>s, or on their own line) must belong to <em>the same</em> monad. It's</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code> do {\n      x &lt;- ma ;          -- ma :: m a     x       :: a\n      y &lt;- mb ;          -- mb :: m b     y       :: b   ( with the same m! )\n      return (foo x y)   --               foo x y :: c     return (foo x y) :: m c\n    }                    --    :: m                  c\n</code></pre>\n\n<p>Now, since <code>sequence [getLine, getLine, getLine] :: IO [String]</code>, this means your <code>do</code> block belongs in <code>IO</code>. </p>\n\n<p>But you can treat the values  in their own right, when you got them:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>fGetSeq :: IO ()\nfGetSeq = do\n  inputs &lt;- sequence [getLine, getLine, getLine]   -- inputs :: [String]\n  let vals = fTest inputs\n  mapM_ print vals\n\nfTest :: [String] -&gt; [Int]\nfTest =  map (read :: String -&gt; Int)\n\n-- or just\nfGetSeq1 = do\n  inputs &lt;- sequence [getLine, getLine, getLine]\n  mapM_ print ( fTest inputs )\n\n-- or\nfGetSeq2 = do { vals &lt;- fTest &lt;$&gt; sequence [getLine, getLine, getLine] ;\n                mapM_ print vals }   -- vals :: [Int]\n\n-- or even (with redundant parens for clarity)\nfGetSeq3 = mapM_ print =&lt;&lt; ( fTest &lt;$&gt; sequence [getLine, getLine, getLine] )\n    --   = mapM_ print . fTest =&lt;&lt; sequence [getLine, getLine, getLine]\n</code></pre>\n\n<p>The essence of Monad is the layering of the pure 'Haskell world' calculations in between the potentially impure, 'effectful'  computations. </p>\n\n<p>So we already are  in the pure Haskell world, on the left hand side of that <code>&lt;-</code>. Again, <code>inputs :: [String]</code>. A pure value.</p>\n"}, {"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": true, "score": 1, "last_activity_date": 1535961743, "last_edit_date": 1535961743, "creation_date": 1535789727, "answer_id": 52126275, "question_id": 52125583, "link": "https://stackoverflow.com/questions/52125583/haskell-get-values-from-io-domain/52126275#52126275", "title": "Haskell get values from IO domain", "body": "<blockquote>\n  <p>get a value from the IO domain, into the 'Haskell world'</p>\n</blockquote>\n\n<p>You use the bind operator: <code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code>.</p>\n\n<p>If <code>m = IO</code> it looks like: <code>(&gt;&gt;=) :: IO a -&gt; (a -&gt; IO b) -&gt; IO b</code>.</p>\n\n<p>As you can see, the function with type <code>a -&gt; IO b</code> addresses the <code>a</code> without <code>IO</code>.</p>\n\n<p>So given a value in the IO monad, e.g. <code>getLine :: IO String</code>:</p>\n\n<pre><code>getInt :: IO Int\ngetInt = getLine &gt;&gt;= (\\s -&gt; return (read s))\n</code></pre>\n\n<p>Here, <code>s :: String</code>, <code>read :: String -&gt; Int</code>, and <code>return :: Int -&gt; IO Int</code>.</p>\n\n<p>You can rewrite this using a do-block:</p>\n\n<pre><code>getInt :: IO Int\ngetInt = do\n  s &lt;- getLine\n  return (read s)\n</code></pre>\n\n<p>Or use the standard library function that does exactly this:</p>\n\n<pre><code>getInt :: IO Int\ngetInt = readLn\n</code></pre>\n\n<p>As for your example, you can immediately fix it using a let-binding:</p>\n\n<pre><code>foo :: IO ()\nfoo = do\n  input &lt;- sequence [getLine, getLine, getLine]\n  let ints = bar input\n  mapM_ print ints\n\nbar :: [String] -&gt; [Int]\nbar = map read\n</code></pre>\n\n<p>Or you can restructure it to use <code>getInt</code> as defined above:</p>\n\n<pre><code>foo :: IO ()\nfoo = sequence [getInt, getInt, getInt] &gt;&gt;= mapM_ print\n</code></pre>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 324, "favorite_count": 0, "accepted_answer_id": 52126275, "answer_count": 2, "score": 1, "last_activity_date": 1536217481, "creation_date": 1535784022, "last_edit_date": 1535784788, "question_id": 52125583, "link": "https://stackoverflow.com/questions/52125583/haskell-get-values-from-io-domain", "title": "Haskell get values from IO domain", "body": "<p>After reading the Haskell books I am kind of confused (or I simply forgot) how to get a value from the IO domain, into the 'Haskell world' to parse it, like so: </p>\n\n<pre><code>fGetSeq = do\n  input &lt;- sequence [getLine, getLine, getLine]\n  fTest input\n  mapM_ print input\n\nfTest =  map (read :: String -&gt; Int)\n</code></pre>\n\n<p>Obviously compiler complains. <code>Couldn't match [] with IO</code>. Is there a simple rule of thumb for passing values between 'worlds' or is it just my bad by omitting typesigs?</p>\n"}, {"tags": ["haskell", "recursion", "filtering", "permutation", "recursive-backtracking"], "comments": [{"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 0, "creation_date": 1535769898, "post_id": 52124356, "comment_id": 91200005, "body": "Your &quot;short-circuit&quot; version doesn&#39;t match the simple version. <code>condition</code> is applied recursively in the &quot;short-circuit&quot; version."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1535772670, "post_id": 52124356, "comment_id": 91200275, "body": "What are you trying to do exactly? It sounds like you have a predicate such that if it is false for some tail of a list then it is false for the entire list and so your goal is to write an algorithm that avoids generating and checking a bunch of permutations with the same bad tail, for performance reasons. Is that right?"}, {"owner": {"reputation": 479, "user_id": 4496701, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-SST61v329Q0/AAAAAAAAAAI/AAAAAAAAAFM/ihwdZ1nZE7Q/photo.jpg?sz=128", "display_name": "Cliff Stamp", "link": "https://stackoverflow.com/users/4496701/cliff-stamp"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1535772784, "post_id": 52124356, "comment_id": 91200284, "body": "@jberryman Yes, exactly."}, {"owner": {"reputation": 1889, "user_id": 4540658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/9vCJz.jpg?s=128&g=1", "display_name": "Dannyu NDos", "link": "https://stackoverflow.com/users/4540658/dannyu-ndos"}, "edited": false, "score": 1, "creation_date": 1535777621, "post_id": 52124356, "comment_id": 91200924, "body": "What do you want if <code>not (condition [])</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 3, "last_activity_date": 1539182411, "last_edit_date": 1539182411, "creation_date": 1535782275, "answer_id": 52125393, "question_id": 52124356, "link": "https://stackoverflow.com/questions/52124356/haskell-generating-pre-filtered-permutations/52125393#52125393", "title": "Haskell generating pre-filtered permutations", "body": "<p>Coding it up in <code>do</code> notation with recursion is pretty straightforward.</p>\n\n<pre><code>foo :: ([a] -&gt; Bool) -&gt; [a] -&gt; [[a]]\nfoo p xs = bar ([],xs)\n   where\n   bar (acc,[]) = return acc\n   bar (acc,xs) = do\n                   (x,ys) &lt;- picks xs      -- shrink the domain (ys)\n                   if ( p (x:acc) )        -- test soon\n                     then bar (x:acc,ys)   -- loop\n                     else mzero            -- fail early\n\npicks [] = []\npicks (x : xs) = (x, xs) : [(y, x : ys) | (y, ys) &lt;- picks xs]\n</code></pre>\n\n<p><code>picks</code> is from <a href=\"https://stackoverflow.com/questions/12869097/splitting-list-into-a-list-of-possible-tuples/12872133#12872133\">this answer</a>.</p>\n\n<p>Testing:</p>\n\n<pre><code>&gt; foo (const True) [1..3]\n[[3,2,1],[2,3,1],[3,1,2],[1,3,2],[2,1,3],[1,2,3]]\n\n&gt; foo (\\(x:xs) -&gt; not(null xs) || x &gt; 1) [1..3]\n[[3,1,2],[1,3,2],[2,1,3],[1,2,3]]\n</code></pre>\n\n<p>The last one starts producing its output immediately also for <code>[1..20]</code>, <code>[1..300]</code> etc.</p>\n\n<p>I'm sure this can be expressed neatly with higher-level stuff.</p>\n"}], "owner": {"reputation": 479, "user_id": 4496701, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-SST61v329Q0/AAAAAAAAAAI/AAAAAAAAAFM/ihwdZ1nZE7Q/photo.jpg?sz=128", "display_name": "Cliff Stamp", "link": "https://stackoverflow.com/users/4496701/cliff-stamp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 52125393, "answer_count": 1, "score": 2, "last_activity_date": 1613061179, "creation_date": 1535768525, "last_edit_date": 1613061179, "question_id": 52124356, "link": "https://stackoverflow.com/questions/52124356/haskell-generating-pre-filtered-permutations", "title": "Haskell generating pre-filtered permutations", "body": "<p>Is there a way to generated pre-filtered permutations, that is rather than doing :</p>\n<pre><code>filter condition $ permutations list\n</code></pre>\n<p>the permutation function can short-circuit. For example :</p>\n<pre><code>perms [] = [[]]\nperms xs = [ i:j | i &lt;- xs, j &lt;- perms $ delete i xs]\n</code></pre>\n<p>I tried a few obvious things like :</p>\n<pre><code>perms xs = [ i:j | i &lt;- xs, j &lt;- filter condition $ perms $ delete i xs]\n</code></pre>\n<p>I thought what would happen is this would set off a chain which would end up at <code>[]</code> and then work back up, but filtering along the way. However when feeding it a long list  and thus speeding up the process. This doesn't seem to happen as it bogged out (ghci) when trying to do a permutation of a 20 item list that would have only very few actually filtered permutations.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1535758789, "creation_date": 1535758789, "answer_id": 52123700, "question_id": 52123565, "link": "https://stackoverflow.com/questions/52123565/how-to-subject-the-function-argument-to-typeclass-instantiation/52123700#52123700", "title": "How to subject the function argument to typeclass instantiation?", "body": "<p>Yes, but only with a newtype:</p>\n\n<pre><code>newtype BackFun a b = BackFun (b -&gt; a)\n\ninstance Fun (BackFun a) where\n  fm g (BackFun f) = BackFun (f . g)\n</code></pre>\n\n<p>The problem is that, even with extensions, you can't use a partially applied type alias in an instance declaration, so:</p>\n\n<pre><code>type F b a = (-&gt;) a b\ninstance Fun (F b)\n</code></pre>\n\n<p>won't work because <code>F b</code> in the instance declaration hasn't been fully applied.</p>\n\n<p>The only other way to flip the order of the parameters to the <code>(-&gt;)</code> constructor is to wrap it in a newtype as above.</p>\n"}], "owner": {"reputation": 17898, "user_id": 562440, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/4nedy.jpg?s=128&g=1", "display_name": "Raffael", "link": "https://stackoverflow.com/users/562440/raffael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 52123700, "answer_count": 1, "score": 2, "last_activity_date": 1535758789, "creation_date": 1535757431, "last_edit_date": 1535757743, "question_id": 52123565, "link": "https://stackoverflow.com/questions/52123565/how-to-subject-the-function-argument-to-typeclass-instantiation", "title": "How to subject the function argument to typeclass instantiation?", "body": "<p>Okay, I can do this:</p>\n\n<pre><code>class Fun fun where\n    fm :: (b -&gt; b) -&gt; fun b -&gt; fun b\n\ninstance Fun ((-&gt;) a) where\n    fm g f = g . f\n</code></pre>\n\n<p>Can I also instantiate <code>Fun</code> with regard to the argument instead of the result?</p>\n\n<p>Something like this:</p>\n\n<pre><code>instance Fun (\\x -&gt; (-&gt;) x a) where\n    fm g f = f . g\n</code></pre>\n\n<p>That is just conceptual because I don't know how to write this correctly - but I hope the idea is made clear.</p>\n\n<p>I also tried this:</p>\n\n<pre><code>type F b a = (-&gt;) a b\n\ninstance Fun (F b) where\n    fm g f = f . g\n</code></pre>\n\n<p>But that seems to be fundamentally flawed.</p>\n\n<hr>\n\n<p>In other words: <code>(-&gt;) a b</code> is a <code>Fun</code>. Is <code>(&lt;-) a b</code> also a <code>Fun</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1535754454, "post_id": 52123102, "comment_id": 91197738, "body": "The error message has some advice for you.  What is it?"}, {"owner": {"reputation": 17898, "user_id": 562440, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/4nedy.jpg?s=128&g=1", "display_name": "Raffael", "link": "https://stackoverflow.com/users/562440/raffael"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1535754947, "post_id": 52123102, "comment_id": 91197840, "body": "Why doesn&#39;t <code>T</code> correspond to <code>((-&gt;) Int)</code> and <code>T a1</code> to <code>((-&gt;) Int) a1</code>? Basically that is what confuses me. Also logically I don&#39;t get why this doesn&#39;t work."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535754987, "post_id": 52123102, "comment_id": 91197851, "body": "<code>Int</code> is not a type variable, that&#39;s why it doesn&#39;t correspond."}, {"owner": {"reputation": 17898, "user_id": 562440, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/4nedy.jpg?s=128&g=1", "display_name": "Raffael", "link": "https://stackoverflow.com/users/562440/raffael"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535755068, "post_id": 52123102, "comment_id": 91197872, "body": "@leftaroundabout: yes, of course it isn&#39;t. I guess you wrote this before reading my comment - judging from the small difference of the timestamps."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1535755360, "post_id": 52123302, "comment_id": 91197930, "body": "Though if you don&#39;t need it it is a sign of an especially lovely design, IMO, giving you some confidence each type and class has a self-contained, compositional meaning.  In fact, this question is a good example: generalize your instance, it says!"}, {"owner": {"reputation": 17898, "user_id": 562440, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/4nedy.jpg?s=128&g=1", "display_name": "Raffael", "link": "https://stackoverflow.com/users/562440/raffael"}, "edited": false, "score": 0, "creation_date": 1535755750, "post_id": 52123302, "comment_id": 91198013, "body": "I still don&#39;t understand why I cannot interpret the error message such that <code>T</code> is representing <code>(-&gt;) Int</code>? In case of <code>(-&gt;) a b</code> (where it works fine): doesn&#39;t <code>T</code> correspond to <code>(-&gt;)</code> (and <code>a b</code> to <code>a1 a2</code>) as well as to <code>(-&gt;) a</code> (and <code>b</code> to <code>a1</code>)?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 2, "creation_date": 1535756414, "post_id": 52123302, "comment_id": 91198132, "body": "Not all of GHC&#39;s error messages are 100% accurate and precise. The actual rule (from section 4.3.2 of the Haskell 98 report) is that &quot;The type (T u1 ... uk) must take the form of a type constructor T applied to simple type variables u1, ... uk; furthermore, T must not be a type synonym, and the ui must all be distinct.&quot;"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1535754911, "creation_date": 1535754911, "answer_id": 52123302, "question_id": 52123102, "link": "https://stackoverflow.com/questions/52123102/why-is-this-instatiation-of-functor-not-working/52123302#52123302", "title": "Why is this instatiation of Functor not working?", "body": "<p>Yeah, and it <em>does</em> work sure enough if only you turn on that <code>-XFlexibleInstances</code> extension.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nclass F f where fm :: (a -&gt; b) -&gt; f a -&gt; f b\ninstance F ((-&gt;) Int) where fm g f = g . f\n</code></pre>\n\n<p>The reason it doesn't work without the extension is that standard Haskell has a strangely restricted notion of what's allowed as an instance. If you don't make the instance specific to a particular argument type, it actually works in Haskell98:</p>\n\n<pre><code>instance F ((-&gt;) a) where fm g f = g . f\n</code></pre>\n\n<p>I think this is really silly. The <code>FlexibleInstances</code> extension is thus extremely widespread, in fact I use it in almost every module. It is uncontroversial.</p>\n"}], "owner": {"reputation": 17898, "user_id": 562440, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/4nedy.jpg?s=128&g=1", "display_name": "Raffael", "link": "https://stackoverflow.com/users/562440/raffael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 52123302, "answer_count": 1, "score": 0, "last_activity_date": 1535754911, "creation_date": 1535753317, "question_id": 52123102, "link": "https://stackoverflow.com/questions/52123102/why-is-this-instatiation-of-functor-not-working", "title": "Why is this instatiation of Functor not working?", "body": "<p>To avoid conflicts with Prelude I define my own Functor class:</p>\n\n<pre><code>class F f where\n    fm :: (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>Why is this working ...</p>\n\n<pre><code>instance F ((-&gt;) a) where\n    fm g f = g . f\n</code></pre>\n\n<p>GHCI:</p>\n\n<pre><code>*Main&gt; fm (+1) (+10) $ 100\n111\n</code></pre>\n\n<p>... but this isn't?</p>\n\n<pre><code>instance F ((-&gt;) Int) where\n    fm g f = g . f\n</code></pre>\n\n<p>I don't get it - shouldn't the fact that I restrict the underlying set to functions mapping from <code>Int</code> be irrelevant to the mechanisms / definition of Functor?</p>\n\n<p>The error message doesn't help:</p>\n\n<pre><code>    \u2022 Illegal instance declaration for \u2018F ((-&gt;) Int)\u2019\n        (All instance types must be of the form (T a1 ... an)\n         where a1 ... an are *distinct type variables*,\n         and each type variable appears at most once in the instance head.\n         Use FlexibleInstances if you want to disable this.)\n    \u2022 In the instance declaration for \u2018F ((-&gt;) Int)\u2019\n  |\n4 | instance F ((-&gt;) Int) where\n  |          ^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "lisp", "parsec"], "comments": [{"owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "edited": false, "score": 0, "creation_date": 1535736221, "post_id": 52119827, "comment_id": 91191461, "body": "Is the value <code>1000</code> is getting passed unchanged to <code>dTime</code>?  Because <code>threadDelay</code> takes microseconds so you would only be pausing for a millisecond."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1535737111, "post_id": 52119827, "comment_id": 91191824, "body": "The terms &#39;delay&#39; and &#39;dTime&#39; do not appear in the &quot;full source&quot; you link.  Please make questions self contained including a runnable MCVE."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 8804133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/259497929ccf8b48a404a08c553a08eb?s=128&d=identicon&r=PG&f=1", "display_name": "Ninjacop", "link": "https://stackoverflow.com/users/8804133/ninjacop"}, "edited": false, "score": 0, "creation_date": 1535736592, "post_id": 52119999, "comment_id": 91191616, "body": "I have the exact same function <code>evalString</code> in my code, are you saying that I should apply it to <code>dTime</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 21, "user_id": 8804133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/259497929ccf8b48a404a08c553a08eb?s=128&d=identicon&r=PG&f=1", "display_name": "Ninjacop", "link": "https://stackoverflow.com/users/8804133/ninjacop"}, "edited": false, "score": 0, "creation_date": 1535737056, "post_id": 52119999, "comment_id": 91191804, "body": "You should apply it to <code>(delay 1000)</code>, if you want the delay to happen."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1535735335, "creation_date": 1535735335, "answer_id": 52119999, "question_id": 52119827, "link": "https://stackoverflow.com/questions/52119827/make-a-threaddelay-like-function-in-parsec-haskell/52119999#52119999", "title": "Make a threadDelay-like function in Parsec - Haskell", "body": "<p><code>dTime</code> yields a value that <em>contains</em> an <code>IO</code> action which, if you executed it, would suspend the thread. Good. But <code>showVal</code> never attemps executing any <code>IO</code> \u2013 it just sees, \u201cthere is an <code>IO</code> action here\u201d, but doesn't do anything with it. In fact it <em>can't</em> do anything with it, due to the pure signature <code>-&gt; String</code>. To make it eval too, you'll probably want to use <code>evalString :: Env -&gt; String -&gt; IO String</code> or something instead.</p>\n"}], "owner": {"reputation": 21, "user_id": 8804133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/259497929ccf8b48a404a08c553a08eb?s=128&d=identicon&r=PG&f=1", "display_name": "Ninjacop", "link": "https://stackoverflow.com/users/8804133/ninjacop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535735335, "creation_date": 1535734498, "last_edit_date": 1535734919, "question_id": 52119827, "link": "https://stackoverflow.com/questions/52119827/make-a-threaddelay-like-function-in-parsec-haskell", "title": "Make a threadDelay-like function in Parsec - Haskell", "body": "<p>I have been making my own Lisp-y language using Parsec in Haskell over the last few weeks, following the <a href=\"https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours\" rel=\"nofollow noreferrer\">\"Write Yourself a Scheme in 48 Hours\"</a> guide. Note that I am still a beginner at Haskell. </p>\n\n<p>I'm trying to implement a \"sleep\" function that waits a certain time then prints \"true\" after the command has been inputted at the REPL, using my custom types from Parsec (I am not using a lexer/tokens). The problem is is that when I input the <code>delay</code> function into the REPL, it just shows \"done\" instead of suspending the thread. Also, I'm using \"Control.Monad.Error\" instead of \"Control.Monad.Except\" because the tutorial is using Error.</p>\n\n<p>Here are my types (compressed for convenience): </p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- All the custom data types, which follows the syntax: [Name - Haskell Type]\ndata Values = Atom String\n         | Number Integer\n         | InOut (IO ()) \n         | IOFunc ([Values] -&gt; IOThrowsError Values) -- This is used for File and REPL IO\n\ninstance Show Values where show = showVal\n</code></pre>\n\n<p>This is my \"show\" function (compressed for convenience): </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>showVal :: Values -&gt; String\nshowVal (InOut _) = \"done\"\nshowVal (IOFunc _) = \"&lt;primitive&gt;\"\n</code></pre>\n\n<p>Finally, the function: </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Concurrent (threadDelay)\n\ndTime :: [Values] -&gt; IOThrowsError Values\ndTime [Number n] = \n    let delay' = fromIntegral n\n    in (return . InOut) (threadDelay delay')\n</code></pre>\n\n<p>REPL output: </p>\n\n<pre class=\"lang-lisp prettyprint-override\"><code>BuBBLE&gt; (delay 1000) ; it works partially, but it immediately outputs `done`\ndone \n</code></pre>\n\n<p>Does threadDelay only work in GHC, or what am I missing to make it work?</p>\n\n<p>Full source: <a href=\"https://github.com/Ninjacop/BuBBLE/\" rel=\"nofollow noreferrer\">Ninjacop/BuBBLE</a></p>\n"}, {"tags": ["haskell", "ghc", "state-monad", "st-monad"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1535724004, "post_id": 52116792, "comment_id": 91185023, "body": "I think you can determine whether a certain use of <code>STT</code> is safe without understanding <code>State#</code>. Specifically: is the <code>State#</code> used <a href=\"https://en.wikipedia.org/wiki/Substructural_type_system#Linear_type_systems\" rel=\"nofollow noreferrer\">affinely</a>? Then it is safe. Otherwise, not safe. You do not need to know the internal implementation details of <code>State#</code> to make this determination."}, {"owner": {"reputation": 345, "user_id": 2610474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c1c33bc50efcb00a277fd29737d8f73?s=128&d=identicon&r=PG", "display_name": "dremodaris", "link": "https://stackoverflow.com/users/2610474/dremodaris"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1535724279, "post_id": 52116792, "comment_id": 91185209, "body": "Yet <code>realWorld# :: State# RealWorld</code> is certainly not used affinely: it is used every time someone invokes <code>runST</code>. (I do not intend to use the <code>State#</code> affinely, and would like to understand what happens if I don&#39;t.)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1535724616, "post_id": 52116792, "comment_id": 91185411, "body": "@dremodaris You&#39;ll fork a bunch of parallel universes."}, {"owner": {"reputation": 345, "user_id": 2610474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c1c33bc50efcb00a277fd29737d8f73?s=128&d=identicon&r=PG", "display_name": "dremodaris", "link": "https://stackoverflow.com/users/2610474/dremodaris"}, "edited": false, "score": 0, "creation_date": 1535726026, "post_id": 52116792, "comment_id": 91186250, "body": "That&#39;s exactly what I want! Will each of them have its own copy of the state, or will they jointly be messing up a common state? To be clear, I intend to use the <code>STT s []</code> monad."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1535732957, "post_id": 52116792, "comment_id": 91189915, "body": "@dremodaris They will jointly be messing up a common state. The whole point of <code>ST</code> is to use the type system to guarantee a computation that uses mutable state is self-contained, so it can be treated as pure from the perspective of the surrounding context. Think of it as \u201ctype-safe, restricted <code>IO</code>\u201d, nothing more. The \u201cstate token\u201d does not include any actual state, it is merely an internal implementation detail used by <code>IO</code> and <code>ST</code> to ensure ordering. You cannot safely use <code>STT s []</code>, as the documentation states. If you want to be able to fork the state, you need to use <code>StateT</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1535736092, "post_id": 52116792, "comment_id": 91191395, "body": "@dremodaris Right. And the proof that <code>runST</code> is safe was very, very difficult -- an open question until very recently. Affine use of <code>State#</code> is a sufficient, though not necessary."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1535735318, "last_edit_date": 1535735318, "creation_date": 1535734899, "answer_id": 52119898, "question_id": 52116792, "link": "https://stackoverflow.com/questions/52116792/specification-of-state/52119898#52119898", "title": "Specification of `State#`", "body": "<p>You don't <em>really</em> need to understand how <code>State#</code> is implemented.  You just need to think of it as a token that's passed through a thread of computations to ensure a certain execution order of <code>ST</code> actions which might otherwise be optimized away.</p>\n\n<p>In an <code>STT s []</code> monad, you can think of the list actions as producing a tree of possible computations with the final answers at the leaves.  At each branching point, the <code>State#</code> token is split.  So, roughly speaking:</p>\n\n<ul>\n<li>within a particular path from root to leaf, a single <code>State#</code> token is threaded through the whole path, so all ST actions will be executed in order when the answer is demanded</li>\n<li>for two paths, ST actions within the portion of the tree they have in common (before splitting) are safe and properly \"shared\" between the two paths in the way you'd expect</li>\n<li>after two paths split, the relative ordering of the actions in the two independent branches is unspecified</li>\n</ul>\n\n<p>There's a further guarantee, I believe, though it's a little hard to reason about:</p>\n\n<p>If, in the final list of answers (i.e., the list produced by <code>runSTT</code>), you force the single answer at index <code>k</code> -- or, actually, I think if you just force the list constructor that proves there is an answer at index <code>k</code> -- then all actions in a depth-first traversal of the tree up to that answer will have been performed.  The catch is that other actions in the tree may have been executed as well.</p>\n\n<p>As an example, the following program:</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall #-}\n\nimport Control.Monad.Trans\nimport Control.Monad.ST.Trans\n\ntype M s = STT s []\n\nfoo :: STRef s Int -&gt; M s Int\nfoo r = do\n  _ &lt;- lift [1::Int,2,3]\n  writeSTRef r 1\n  n1 &lt;- readSTRef r\n  n2 &lt;- readSTRef r\n  let f = n1 + n2*2\n  writeSTRef r f\n  return f\n\nmain :: IO ()\nmain = print $ runSTT $ foo =&lt;&lt; newSTRef 9999\n</code></pre>\n\n<p>produces different answers under GHC 8.4.3 when compiled with <code>-O0</code> (answer is <code>[3,3,3]</code>) versus <code>-O2</code> (answer is <code>[3,7,15]</code>).</p>\n\n<p>In its (simple) tree of computations:</p>\n\n<pre><code>    root\n   /  |  \\\n  1   2   3          _ &lt;- lift [1,2,3]\n /    |    \\\nwr    wr    wr       writeSTRef r 1\n|     |     |\nrd    rd    rd       n1 &lt;- readSTRef r\n|     |     |\nrd    rd    rd       n2 &lt;- readSTRef r\n|     |     |\nwr    wr    wr       writeSTRef r (n1 + n2*2)\n|     |     |\nf     f     f        return (n1 + n2*2)\n</code></pre>\n\n<p>we can reason that when the first value is demanded, the write/read/read/write actions in the left branch have been executed.  (In this case, I <em>think</em> that the write and read on the middle branch have also been executed, as explained below, but I'm a little unsure.)</p>\n\n<p>When the second value is demanded, we know that all the actions in the left branch have been executed in order, and all the actions in the middle branch have been executed in order, but we don't know the relative order between those branches.  They may have been executed fully sequentially (giving the answer <code>3</code>), or they may have been interleaved so that the final write on the left branch fell between the two reads on the right branch (giving the answer <code>1 + 2*3 = 7</code>.</p>\n"}], "owner": {"reputation": 345, "user_id": 2610474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c1c33bc50efcb00a277fd29737d8f73?s=128&d=identicon&r=PG", "display_name": "dremodaris", "link": "https://stackoverflow.com/users/2610474/dremodaris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 52119898, "answer_count": 1, "score": 1, "last_activity_date": 1535735318, "creation_date": 1535722966, "last_edit_date": 1535731465, "question_id": 52116792, "link": "https://stackoverflow.com/questions/52116792/specification-of-state", "title": "Specification of `State#`", "body": "<p>However, the <a href=\"http://hackage.haskell.org/package/STMonadTrans-0.4.3/docs/Control-Monad-ST-Trans.html\" rel=\"nofollow noreferrer\">documentation for <code>STT</code></a> says:</p>\n\n<blockquote>\n  <p>This monad transformer should not be used with monads that can contain multiple answers, like the list monad. The reason is that the state token will be duplicated across the different answers and this causes Bad Things to happen (such as loss of referential transparency). Safe monads include the monads State, Reader, Writer, Maybe and combinations of their corresponding monad transformers.</p>\n</blockquote>\n\n<p>I would like to be able to judge for myself whether a certain use of the <code>STT</code> monad is safe. In particular, I want to understand the interaction with the List monad. I know that <code>STT sloc (ListT (ST sglob)) a</code> is <a href=\"https://stackoverflow.com/questions/51874362/combine-st-and-list-monads-in-haskell\">unsafe</a>, but what about <code>STT sloc []</code>?</p>\n\n<p>I figured out that (at least in GHC), <code>STT</code> is ultimately implemented using magical constructs like <code>MuteVar#</code>, <code>State#</code>, <code>realWorld#</code> etc. Is there any accurate documentation on how these objects behave?</p>\n\n<p>This is closely related to an <a href=\"https://stackoverflow.com/questions/51874362/combine-st-and-list-monads-in-haskell\">earlier question of mine</a>.</p>\n"}, {"tags": ["haskell", "unicode", "surrogate-pairs"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1535719431, "post_id": 52115653, "comment_id": 91182013, "body": "This has to do with the encoding: in UTF-16, this is simply not a <i>valid</i> character: it does <i>not</i> map on a character."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535719475, "post_id": 52115653, "comment_id": 91182041, "body": "See here: <a href=\"https://upload.wikimedia.org/wikipedia/commons/0/01/Unifont_Full_Map.png\" rel=\"nofollow noreferrer\">upload.wikimedia.org/wikipedia/commons/0/01/&hellip;</a>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1535719513, "post_id": 52115653, "comment_id": 91182061, "body": "You can use a &quot;binary writer&quot; to write the specified bytes. But as text it makes no sense."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 4, "creation_date": 1535719544, "post_id": 52115653, "comment_id": 91182075, "body": "If you want to write data that is not valid text, don&#39;t write it as text. Write as binary instead."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1535720415, "creation_date": 1535720415, "answer_id": 52116029, "question_id": 52115653, "link": "https://stackoverflow.com/questions/52115653/write-surrogate-pairs-to-file-using-haskell/52116029#52116029", "title": "Write surrogate pairs to file using Haskell", "body": "<p>Sure, just write the bytes you want:</p>\n\n<pre><code>import Data.ByteString as BS\nmain = BS.writeFile \"surrogate.txt\" (pack [0xd8, 0x00])\n</code></pre>\n"}], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 52116029, "answer_count": 1, "score": 1, "last_activity_date": 1535720415, "creation_date": 1535719124, "question_id": 52115653, "link": "https://stackoverflow.com/questions/52115653/write-surrogate-pairs-to-file-using-haskell", "title": "Write surrogate pairs to file using Haskell", "body": "<p>This is the code I have:</p>\n\n<pre><code>import qualified System.IO as IO\n\nwriteSurrogate :: IO ()\nwriteSurrogate = do\n  IO.writeFile \"/home/sibi/surrogate.txt\" ['\\xD800']\n</code></pre>\n\n<p>Executing the above code gives error:</p>\n\n<pre><code>text-tests: /home/sibi/surrogate.txt: commitBuffer: invalid argument (invalid character)\n</code></pre>\n\n<p>The reason being is that it is prevented by the GHC itself as they are surrogate code points: <a href=\"https://github.com/ghc/ghc/blob/21f0f56164f50844c2150c62f950983b2376f8b6/libraries/base/GHC/IO/Encoding/Failure.hs#L114\" rel=\"nofollow noreferrer\">https://github.com/ghc/ghc/blob/21f0f56164f50844c2150c62f950983b2376f8b6/libraries/base/GHC/IO/Encoding/Failure.hs#L114</a></p>\n\n<p>I want to write some test files which needs to have that data. Right now, I'm using Python to achieve what I want - But I would love to know if there is an way (workaround using Haskell) to achieve this.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535717322, "post_id": 52115153, "comment_id": 91180726, "body": "Can&#39;t you pass <code>--ghc-options -pj</code>?"}, {"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535717437, "post_id": 52115153, "comment_id": 91180797, "body": "It&#39;s not an option to GHC. GHC compiles with <code>+RTS</code> adding <code>-p</code> as a flag to the binary that it builds. I need to pass the flag to the executable."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1535729527, "post_id": 52115153, "comment_id": 91188210, "body": "On my phone right now, but <code>--test-arguments</code> may work for this."}, {"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 0, "creation_date": 1535742276, "post_id": 52115153, "comment_id": 91194056, "body": "I think that&#39;s almost right. It reports that it&#39;s called with these options: <code>test (suite: test, args: +RTS -p -RTS -pj)</code> but from the .prof-file that it creates it looks like <code>-p</code> has squelched <code>-pj</code>"}], "owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 258, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1535717463, "creation_date": 1535717211, "last_edit_date": 1535717463, "question_id": 52115153, "link": "https://stackoverflow.com/questions/52115153/passing-rts-opts-to-stack-test", "title": "Passing RTS-opts to `stack test`", "body": "<p>How can I pass RTS options to the test-suite of my project using stack?</p>\n\n<p><code>stack exec</code> allows for passing options to the executable, but since <code>stack test</code> is a synonym for <code>stack build --test</code> I can't see how to accomplish this.</p>\n\n<p>I'm trying to generate some JSON-formatted profiler output for my test-suite using the RTS option <code>-pj</code> (<a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html#rts-flag--pj\" rel=\"nofollow noreferrer\">GHC user guide</a>).</p>\n\n<p>I can see where stack places the regular executables, but not the executables for the test-suite.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1535708138, "post_id": 52110092, "comment_id": 91175589, "body": "Aren&#39;t you looking for <code>fmap</code>? Do you know how typeclasses work?"}, {"owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "edited": false, "score": 1, "creation_date": 1535709640, "post_id": 52110092, "comment_id": 91176448, "body": "What about sum type, eg. <code>data MoleculeResult = SingleMolecule (Maybe Db.Molecule) | MultiMolecule [Db.Molecule]</code>? It is closest I can image to &quot;match on type&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 2126, "user_id": 1097074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CJavk.jpg?s=128&g=1", "display_name": "Rodion Gorkovenko", "link": "https://stackoverflow.com/users/1097074/rodion-gorkovenko"}, "edited": false, "score": 0, "creation_date": 1535720412, "post_id": 52113210, "comment_id": 91182648, "body": "Yes, thanks! I&#39;ve just logged in to update the question as I also ended up this way. I realized that my question is not very correct, as I was trying to make Haskell working like Erlang (to which I&#39;ve got used to certain extent) - and this is wrong... The other option as I understand, is to create &quot;typeclass&quot; (or should it be just type?) for response, so it can be either Maybe, or some value... and create different processing functions via &quot;instances&quot; (?) - but it don&#39;t sound right even if it could really work (I&#39;m not sure)..."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1535710352, "creation_date": 1535710352, "answer_id": 52113210, "question_id": 52110092, "link": "https://stackoverflow.com/questions/52110092/allowing-function-to-accept-various-types-in-haskell/52113210#52113210", "title": "Allowing function to accept various types in Haskell", "body": "<p>I would do it this way:</p>\n\n<pre><code>doGetMolecule :: String -&gt; IO (Maybe [Db.Molecule])\ndoGetMolecule strId = fmap (:[]) &lt;$&gt; Db.fetchMolecule (read strId :: Int)\n\ndoGetAllMolecules :: IO (Maybe [Db.Molecule])\ndoGetAllMolecules = Just &lt;$&gt; Db.fetchAllMolecules\n</code></pre>\n\n<p>Now they have the same type: both have a chance at returning a list of molecules, so <code>doGet</code> need only handle that one type.</p>\n"}], "owner": {"reputation": 2126, "user_id": 1097074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CJavk.jpg?s=128&g=1", "display_name": "Rodion Gorkovenko", "link": "https://stackoverflow.com/users/1097074/rodion-gorkovenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 52113210, "answer_count": 1, "score": 0, "last_activity_date": 1535720643, "creation_date": 1535698762, "last_edit_date": 1535720643, "question_id": 52110092, "link": "https://stackoverflow.com/questions/52110092/allowing-function-to-accept-various-types-in-haskell", "title": "Allowing function to accept various types in Haskell", "body": "<p><em><strong>UPD</strong> I realized this question is not precisely correct for I was trying to do something which is common for me from Erlang experience. As answer explains my functions should be narrowed down in type, not type \"extended\" to adopt them...</em></p>\n\n<hr>\n\n<p><em>(this is a test project while trying to learn/assess Haskell)</em><br>\nHere is a part of intended basic web-endpoint, returning either single entity (for request with id) or list of all (for request without id):</p>\n\n<p>This naive code works:</p>\n\n<pre><code>doGet req resp =\n    let path = map T.unpack (pathInfo req)\n    in case path of\n        [\"molecule\"] -&gt; makeResponse resp doGetAllMolecules\n        [\"molecule\", strId] -&gt; makeResponse resp $ doGetMolecule strId\n\nmakeResponse resp f = do\n    res &lt;- f\n    resp $ responseLBS status200 [] (LC8.pack $ (show res) ++ \"\\n\")\n\ndoGetMolecule :: String -&gt; IO (Maybe Db.Molecule)\ndoGetMolecule strId = Db.fetchMolecule (read strId :: Int)\n\ndoGetAllMolecules :: IO [Db.Molecule]\ndoGetAllMolecules = Db.fetchAllMolecules\n</code></pre>\n\n<p>Now I want it to return <code>status404</code> when entity is not found:</p>\n\n<pre><code>makeResponse resp f = do\n    res &lt;- f\n    let s = case res of\n                Nothing -&gt; status404\n                _ -&gt; status200\n    resp $ responseLBS s [] (LC8.pack $ (show res) ++ \"\\n\")\n</code></pre>\n\n<p>this leads to error:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018[Db.Molecule]\u2019 with \u2018Maybe a0\u2019\n  Expected type: IO (Maybe a0)\n    Actual type: IO [Db.Molecule]\n\u2022 In the second argument of \u2018makeResponse\u2019, namely\n    \u2018doGetAllMolecules\u2019\n  In the expression: makeResponse resp doGetAllMolecules\n  In a case alternative:\n      [\"molecule\"] -&gt; makeResponse resp doGetAllMolecules\n</code></pre>\n\n<p>So what is the way to \"match on type\" of the value, allowing it to be either Maybe or anything else?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 5, "creation_date": 1535696702, "post_id": 52109535, "comment_id": 91169736, "body": "Variables in Haskell are not &quot;set&quot; even once. They are <i>defined</i> (or, rather, bound) and cannot be redefined, reset, reassigned, or anything like that."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1535697452, "post_id": 52109535, "comment_id": 91170037, "body": "&quot;If that&#39;s the case, why&quot; the short explanation is that Haskell is a pure functional language. The long explanation would consist of a definition of &quot;pure functional&quot;, but that would be <i>too</i> long. Fortunately you can look it up."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1535697547, "post_id": 52109535, "comment_id": 91170085, "body": "Oh and <code>do</code> doesn&#39;t really do what you think it does..."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 6, "creation_date": 1535697609, "post_id": 52109535, "comment_id": 91170109, "body": "&quot;Why?&quot; -- it&#39;s like Haskell&#39;s whole thing.  That and nice types.  No changing things and types.  That&#39;s what you get with your basic Haskell.  Haskell doesn&#39;t want to be python, it wants to be Haskell.  And so you can&#39;t change things.  Oh and lazy.  No changing things, don&#39;t do anything till you have to, and also types.  Haskell."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1535698515, "post_id": 52109535, "comment_id": 91170572, "body": "<a href=\"https://stackoverflow.com/questions/11922134/how-to-increment-a-variable-in-functional-programming\">related</a>. Instead of changing stuff we return an augmented copy, making the change explicit. As a hack, we can call the new thing by the old name, shadowing the old thing (making it inaccessible). It&#39;s easy esp. in <code>do</code> notation. Details in the linked entry."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1535699263, "post_id": 52109535, "comment_id": 91170904, "body": "I closed it as a duplicate. The question is a bit different, but the answers apply, I think."}, {"owner": {"reputation": 850, "user_id": 5484068, "user_type": "registered", "accept_rate": 18, "profile_image": "https://www.gravatar.com/avatar/a2ec720ad8a18aa36c86f0d6db5672fb?s=128&d=identicon&r=PG&f=1", "display_name": "vincedjango", "link": "https://stackoverflow.com/users/5484068/vincedjango"}, "edited": false, "score": 2, "creation_date": 1535750122, "post_id": 52109535, "comment_id": 91196697, "body": "Thanks, the answer you posted is exactly what I was looking for."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1535887743, "post_id": 52109535, "comment_id": 91222777, "body": "that&#39;s good to hear! :)"}], "owner": {"reputation": 850, "user_id": 5484068, "user_type": "registered", "accept_rate": 18, "profile_image": "https://www.gravatar.com/avatar/a2ec720ad8a18aa36c86f0d6db5672fb?s=128&d=identicon&r=PG&f=1", "display_name": "vincedjango", "link": "https://stackoverflow.com/users/5484068/vincedjango"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "closed_date": 1535699185, "answer_count": 0, "score": 0, "last_activity_date": 1535696308, "creation_date": 1535696308, "question_id": 52109535, "link": "https://stackoverflow.com/questions/52109535/can-you-change-the-value-of-variable-once-set", "closed_reason": "Duplicate", "title": "Can you change the value of variable once set?", "body": "<p>I have 2 dummy functions.\nIn <em>function 2</em>, I'm trying to set a parameter to a different value. In <em>function 1</em>, I copy the parameter value to a variable and then try to change the value of that variable.</p>\n\n<p>In both case, I get the same error (Shown below). I may not understand what is the cause of the error, but it seems that I can't modify the value of a variable once set. If that's the case, why? And if it is for a different reason, what is it?</p>\n\n<p><strong>Function1</strong></p>\n\n<pre><code>myFunction :: [Char] -&gt;[Char] -&gt; [Char]\nmyFunction a b = if length a &gt; 1\n                     then do\n                         let a1 = a\n                         a = a1 ++  \"333\"\n                  else\n                      b\n</code></pre>\n\n<p><strong>Function2</strong></p>\n\n<pre><code>myFunction :: [Char] -&gt;[Char] -&gt; [Char]\nmyFunction a b = if length a &gt; 1 then a = \"333\" else b\n</code></pre>\n\n<p><strong>Error</strong>    </p>\n\n<pre><code>Stackoverflow.hs:8:28: error:\n    parse error on input `='\n    Perhaps you need a 'let' in a 'do' block?\n    e.g. 'let x = 5' instead of 'x = 5'\n  |\n8 |                          a = a1 ++  \"333\"\n  |                            ^\n</code></pre>\n\n<p>Common <em>main</em> used for both function:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    putStrLn (myFunction \"stack\" \"overflow\")\n</code></pre>\n"}, {"tags": ["haskell", "nix", "nixos"], "comments": [{"owner": {"reputation": 521, "user_id": 7126380, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10207438513426512/picture?type=large", "display_name": "Johnny Liao", "link": "https://stackoverflow.com/users/7126380/johnny-liao"}, "edited": false, "score": 0, "creation_date": 1535696886, "post_id": 52108291, "comment_id": 91169801, "body": "Okay, I <code>ghc-pkg unregister --force mtl-2.2.2</code> and the example works! But I haven&#39;t solved the mystery of why nix-shell install acid-state with mtl-2.2.1 instead of 2.2.2."}], "answers": [{"comments": [{"owner": {"reputation": 521, "user_id": 7126380, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10207438513426512/picture?type=large", "display_name": "Johnny Liao", "link": "https://stackoverflow.com/users/7126380/johnny-liao"}, "edited": false, "score": 1, "creation_date": 1535776366, "post_id": 52111765, "comment_id": 91200722, "body": "Thanks for pointing out there are different existing packages. The Stack way works for me."}], "tags": [], "owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "is_accepted": true, "score": 1, "last_activity_date": 1535705312, "creation_date": 1535705312, "answer_id": 52111765, "question_id": 52108291, "link": "https://stackoverflow.com/questions/52108291/acid-state-example-compiled-error-no-no-instance-for-control-monad-reader-clas/52111765#52111765", "title": "Acid-State example compiled error. No No instance for (Control.Monad.Reader.Class.MonadReader FailureDb (Query FailureDb))", "body": "<p>Stack and Cabal-install have similar problems when dealing with GHC's package dbs, but these problems can be avoided:</p>\n\n<h2>Stack</h2>\n\n<p>When I use Stack, I don't run it in a nix-shell, so that the nix-shell can't add packages to the wrapped GHC command that Stack will then consider to be system packages ('global' in Cabal terminology). I am not sure whether this is the only valid approach though.</p>\n\n<h2>Cabal-install only</h2>\n\n<p>When calling Cabal in a nix-shell, you should add these flags to prevent GHC from looking at the wrong package db: <code>cabal configure --package-db=clear --package-db=global</code>. The GHC wrapper will make the Nix-managed dependencies appear in the 'global' package db.</p>\n"}], "owner": {"reputation": 521, "user_id": 7126380, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10207438513426512/picture?type=large", "display_name": "Johnny Liao", "link": "https://stackoverflow.com/users/7126380/johnny-liao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 52111765, "answer_count": 1, "score": 1, "last_activity_date": 1535705312, "creation_date": 1535688335, "question_id": 52108291, "link": "https://stackoverflow.com/questions/52108291/acid-state-example-compiled-error-no-no-instance-for-control-monad-reader-clas", "title": "Acid-State example compiled error. No No instance for (Control.Monad.Reader.Class.MonadReader FailureDb (Query FailureDb))", "body": "<p>I was trying acid <a href=\"https://gist.github.com/YuMingLiao/f451f7687a738a141de5d0008f1b9035\" rel=\"nofollow noreferrer\">example</a> but compile error.</p>\n\n<p><a href=\"https://gist.github.com/YuMingLiao/f451f7687a738a141de5d0008f1b9035#file-error\" rel=\"nofollow noreferrer\">The error message</a> says <code>no instance No instance for MonadState, No instance for MonadReader</code>.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/11068272/acid-state-monadstate-instance-for-update/11072232#11072232\">This article</a> says it is due to two different mtl versions installed.</p>\n\n<p>And I am using nix-shell in nixos: </p>\n\n<pre><code>ghc-pkg list | grep acid\n    acid-state-0.14.3\n\nghc-pkg list | grep mtl\n    mtl-2.2.1\n    mtl-2.2.2\n</code></pre>\n\n<p>However, if I don't use acid-state package when I enter nix-shell, I got:</p>\n\n<pre><code>ghc-pkg list | grep mtl\n    mtl-2.2.2\n</code></pre>\n\n<p>That probably means acid-state is using different mtl version than Control.Monad.Reader.</p>\n\n<p>But acid-state's stack.yaml in github is lts-11.15, which has mtl-2.2.2.</p>\n\n<p>So what should I do to make it work?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1535888120, "post_id": 52107912, "comment_id": 91222888, "body": "Yes, if you call <code>packed</code> twice, the vector will be recreated each time. How large are your <code>n</code>s? The speedup only becomes apparent for larger sizes. (Also note that <code>i - a &gt; 0</code> is equivalent to <code>i &gt; a</code>)."}, {"owner": {"reputation": 479, "user_id": 4496701, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-SST61v329Q0/AAAAAAAAAAI/AAAAAAAAAFM/ihwdZ1nZE7Q/photo.jpg?sz=128", "display_name": "Cliff Stamp", "link": "https://stackoverflow.com/users/4496701/cliff-stamp"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1535920995, "post_id": 52107912, "comment_id": 91231488, "body": "@PetrPudl&#225;k Large, 10**6-8"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1535999859, "post_id": 52107912, "comment_id": 91259789, "body": "Then switching from list to vector should bring very significant improvement. Indexing lists is <i>O(n)</i>, and will be very slow for sizes like this. Maybe the bottleneck is elsewhere?"}], "owner": {"reputation": 479, "user_id": 4496701, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-SST61v329Q0/AAAAAAAAAAI/AAAAAAAAAFM/ihwdZ1nZE7Q/photo.jpg?sz=128", "display_name": "Cliff Stamp", "link": "https://stackoverflow.com/users/4496701/cliff-stamp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1535729923, "creation_date": 1535684857, "last_edit_date": 1535729923, "question_id": 52107912, "link": "https://stackoverflow.com/questions/52107912/haskell-using-vector-in-a-knapsack-problem-optimization", "title": "Haskell - using Vector in a knapsack problem (optimization)", "body": "<p>I was playing with a generalized knapsack problem (the size of the packs are random) and coded up :</p>\n\n<pre><code>import Data.Vector (generate, (!)) \n\npacked :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Bool\npacked a b c n \n  | n `mod` a == 0 || n `mod` b == 0 || n `mod` c == 0  = True\n  | otherwise = packs!n where\n    packs = generate' (n+1) go \n    go i =  (i == 0) || (i == a) || (i == b) || (i == c) || \n            (i &gt; a &amp;&amp; packs!(i `rem` a ) )  ||\n            (i &gt; b &amp;&amp; packs!(i `rem` b ) )  ||\n            (i &gt; c &amp;&amp; packs!(i `rem` c ) )  ||\n            (i - a &gt; 0 &amp;&amp; packs!(i-a) ) || \n            (i - b &gt; 0 &amp;&amp; packs!(i-b) ) || \n            (i - c &gt; 0 &amp;&amp; packs!(i-c) ) \n\ngenerate' = Data.Vector.generate\n</code></pre>\n\n<p>But I was surprised that using Vector for access did little to nothing to speed up the code as I have seen it make significant changes in past code especially on large lists. Is there something wrong with the way it is being used in the above?</p>\n\n<p>As a general question, if I call that twice, the second time doesn't remember the first time so it has to run through everything again, correct? I think since  a and b and c change, then it can't be memoized as well so are the better approaches than the above to deal with the calculation?</p>\n\n<p>Ref :\n<a href=\"https://en.wikipedia.org/wiki/Knapsack_problem\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Knapsack_problem</a></p>\n"}, {"tags": ["haskell", "megaparsec"], "answers": [{"comments": [{"owner": {"reputation": 677, "user_id": 1865521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0507b7d11d629274263fb5ad3d1b5f31?s=128&d=identicon&r=PG", "display_name": "david king", "link": "https://stackoverflow.com/users/1865521/david-king"}, "edited": false, "score": 0, "creation_date": 1536099720, "post_id": 52115160, "comment_id": 91300269, "body": "I think I understand the approach you&#39;re describing, but were you able to get that to work with the example code/tests I gave? I ask because I can&#39;t seem to get your code and my code to play together and I feel like there must be something obvious I&#39;m missing. Can you throw yours up in a gist or something? I built this <a href=\"https://gist.github.com/ketralnis/bed6cdffa0d9dc981b5fca14f6711c13\" rel=\"nofollow noreferrer\">gist.github.com/ketralnis/bed6cdffa0d9dc981b5fca14f6711c13</a> out of it, but I can get it to parse negative numbers or parens, but not both which is a weird issue to have"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 677, "user_id": 1865521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0507b7d11d629274263fb5ad3d1b5f31?s=128&d=identicon&r=PG", "display_name": "david king", "link": "https://stackoverflow.com/users/1865521/david-king"}, "edited": false, "score": 1, "creation_date": 1536139236, "post_id": 52115160, "comment_id": 91313002, "body": "@davidking Sorry, I didn&#39;t test it at all because I wasn&#39;t at a computer with Haskell on it when I wrote my answer. And sure enough, a mistake got in. The problem was that the exponentiation wasn&#39;t optional (i.e. it expected a <code>^</code> after every term). I&#39;ve tested and fixed it now. PS: One of your test cases has too many parentheses, so that one&#39;s gonna fail, but that&#39;s because it&#39;s actually wrong."}, {"owner": {"reputation": 677, "user_id": 1865521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0507b7d11d629274263fb5ad3d1b5f31?s=128&d=identicon&r=PG", "display_name": "david king", "link": "https://stackoverflow.com/users/1865521/david-king"}, "edited": false, "score": 0, "creation_date": 1536215027, "post_id": 52115160, "comment_id": 91344577, "body": "Ah hah! I see how that works now, that makes a lot more sense than what I was trying to rig it into"}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 4, "last_activity_date": 1572336046, "last_edit_date": 1572336046, "creation_date": 1535717219, "answer_id": 52115160, "question_id": 52107488, "link": "https://stackoverflow.com/questions/52107488/operator-precedence-in-megaparsec/52115160#52115160", "title": "Operator precedence in megaparsec", "body": "<p><code>makeExprParser termParser [precN, ..., prec1]</code> will produce an expression parser that works in such a way that each level of precedence invokes the next-higher level of precedence. So if you'd manually define it, you'd have a rule for infix <code>+</code> and <code>-</code>, which uses the mult-and-div rule as the operands. That in turn would use the prefix rule as the operands and that would use the <code>^</code> rule as the operand. Finally the <code>^</code> rule uses <code>termParser</code> for the operands.</p>\n\n<p>The important thing to note here is that the <code>^</code> rule (or more generally: any rule with a higher precedence than the prefix operators) invokes a parser that won't accept prefix operators at the beginning. So prefix operators can't appear on the right of such operators (except inside parentheses).</p>\n\n<p>What this basically means is that your use case is not supported by <code>makeExprParser</code>.</p>\n\n<p>To work around this, you can use <code>makeExprParser</code> to only handle the infix operators with a lower precedence than the prefix operators and then handle the prefix operators and <code>^</code> manually, so that the right operand of <code>^</code> would \"loop back\" to the prefix operators. Something like this:</p>\n\n<pre><code>expressionParser =\n    makeExprParser prefixParser\n      [\n        [\n          InfixL $ BinOp BinaryMult &lt;$ symbol \"*\",\n          InfixL $ BinOp BinaryDiv &lt;$ symbol \"/\"\n        ],\n        [\n          InfixL $ BinOp BinaryPlus &lt;$ symbol \"+\",\n          InfixL $ BinOp BinaryMinus &lt;$ symbol \"-\"\n        ]\n      ]\n\nprefixParser =\n  do\n    prefixOps &lt;- many prefixOp\n    exp &lt;- exponentiationParser\n    return $ foldr ($) exp prefixOps\n  where\n    prefixOp = MonOp MonoMinus &lt;$ symbol \"-\" &lt;|&gt; MonOp MonoPlus &lt;$ symbol \"+\"\n\nexponentiationParser =\n  do\n    lhs &lt;- termParser\n    -- Loop back up to prefix instead of going down to term\n    rhs &lt;- optional (symbol \"^\" &gt;&gt; prefixParser)\n    return $ maybe lhs (BinOp BinaryExp lhs) rhs\n</code></pre>\n\n<p>Note that, unlike <code>makeExprParser</code>, this also allows multiple consecutive prefix operators (like <code>--x</code> for double negation). If you don't want that, replace <code>many</code> with <code>optional</code> in the definition of <code>prefixParser</code>.</p>\n"}], "owner": {"reputation": 677, "user_id": 1865521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0507b7d11d629274263fb5ad3d1b5f31?s=128&d=identicon&r=PG", "display_name": "david king", "link": "https://stackoverflow.com/users/1865521/david-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 423, "favorite_count": 0, "accepted_answer_id": 52115160, "answer_count": 1, "score": 3, "last_activity_date": 1572336046, "creation_date": 1535680623, "last_edit_date": 1535682884, "question_id": 52107488, "link": "https://stackoverflow.com/questions/52107488/operator-precedence-in-megaparsec", "title": "Operator precedence in megaparsec", "body": "<p>I'm having trouble using Megaparsec 6's <code>makeExprParser</code> helper. I can't seem to figure out how to bind both binary <code>^</code> and unary <code>-</code> at the precedence levels I'd expect.</p>\n\n<p>Using this <code>makeExprParser</code> expression parser:</p>\n\n<pre><code>expressionParser :: Parser Expression\nexpressionParser =\n    makeExprParser termParser\n      [\n        [InfixR $ BinOp BinaryExp &lt;$ symbol \"^\"],\n        [\n          Prefix $ MonOp MonoMinus &lt;$ symbol \"-\",\n          Prefix $ MonOp MonoPlus &lt;$ symbol \"+\"\n        ],\n        [\n          InfixL $ BinOp BinaryMult &lt;$ symbol \"*\",\n          InfixL $ BinOp BinaryDiv &lt;$ symbol \"/\"\n        ],\n        [\n          InfixL $ BinOp BinaryPlus &lt;$ symbol \"+\",\n          InfixL $ BinOp BinaryMinus &lt;$ symbol \"-\"\n        ]\n      ]\n</code></pre>\n\n<p>I would expect these tests to pass:</p>\n\n<pre><code>testEqual expressionParser \"1^2\" \"(1)^(2)\"\ntestEqual expressionParser \"-1^2\" \"-(1^2)\"\ntestEqual expressionParser \"1^-2\" \"1^(-2)\"\ntestEqual expressionParser \"-1^-2\" \"-(1^(-2))\"\n</code></pre>\n\n<p>That is, <code>-1^-2</code> should parse as the same thing as <code>-(1^(-2))</code>. This is how e.g. Python parses it:</p>\n\n<pre><code>&gt;&gt;&gt; 2**-2\n0.25\n&gt;&gt;&gt; -2**-2\n-0.25\n&gt;&gt;&gt; -2**2\n-4\n</code></pre>\n\n<p>and Ruby:</p>\n\n<pre><code>irb(main):004:0&gt; 2**-2\n=&gt; (1/4)\nirb(main):005:0&gt; -2**-2\n=&gt; (-1/4)\nirb(main):006:0&gt; -2**2\n=&gt; -4\n</code></pre>\n\n<p>But this Megaparsec parser instead fails to parse <code>1^-2</code> at all, instead giving me the helpful error:</p>\n\n<pre><code>(TrivialError (SourcePos {sourceName = \\\"test.txt\\\", sourceLine = Pos 1, sourceColumn = Pos 3} :| []) (Just (Tokens ('-' :| \\\"\\\"))) (fromList [Tokens ('(' :| \\\"\\\"),Label ('i' :| \\\"nteger\\\")]))\")\n</code></pre>\n\n<p>which I read to say \"I could have taken any of these characters here, but that <code>-</code> has me flummoxed\".</p>\n\n<p>If I adjust some of the precedence of the operator table like this (moving the exponent after the unary -):</p>\n\n<pre><code>expressionParser =\n    makeExprParser termParser\n      [\n        [\n          Prefix $ MonOp MonoMinus &lt;$ symbol \"-\",\n          Prefix $ MonOp MonoPlus &lt;$ symbol \"+\"\n        ],\n        [InfixR $ BinOp BinaryExp &lt;$ symbol \"^\"],\n        [\n          InfixL $ BinOp BinaryMult &lt;$ symbol \"*\",\n          InfixL $ BinOp BinaryDiv &lt;$ symbol \"/\"\n        ],\n        [\n          InfixL $ BinOp BinaryPlus &lt;$ symbol \"+\",\n          InfixL $ BinOp BinaryMinus &lt;$ symbol \"-\"\n        ]\n      ]\n</code></pre>\n\n<p>then I no longer get a parse failure, but <code>-1^2</code> incorrectly parses as <code>(-1)^2</code> (instead of the correct <code>-(1^2)</code>).</p>\n\n<p>Here is a complete self-contained parser to show the problem (it requires HUnit and of course megaparsec):</p>\n\n<pre><code>module Hascas.Minimal where\n\nimport Data.Void (Void)\nimport Test.HUnit hiding (test)\nimport Text.Megaparsec hiding (ParseError)\nimport Text.Megaparsec.Char\nimport Text.Megaparsec.Expr\nimport qualified Text.Megaparsec as MP\nimport qualified Text.Megaparsec.Char.Lexer as L\n\ndata Expression\n    = Literal Integer\n    | MonOp MonoOperator Expression\n    | BinOp BinaryOperator Expression Expression\n  deriving (Read, Show, Eq, Ord)\n\ndata BinaryOperator\n    = BinaryPlus\n    | BinaryMinus\n    | BinaryDiv\n    | BinaryMult\n    | BinaryExp\n  deriving (Read, Show, Eq, Ord)\n\ndata MonoOperator\n    = MonoPlus\n    | MonoMinus\n  deriving (Read, Show, Eq, Ord)\n\ntype Parser a = Parsec Void String a\ntype ParseError = MP.ParseError (Token String) Void\n\nspaceConsumer :: Parser ()\nspaceConsumer = L.space space1 lineComment blockComment\n  where\n    lineComment  = L.skipLineComment \"//\"\n    blockComment = L.skipBlockComment \"/*\" \"*/\"\n\nlexeme :: Parser a -&gt; Parser a\nlexeme = L.lexeme spaceConsumer\n\nsymbol :: String -&gt; Parser String\nsymbol = L.symbol spaceConsumer\n\nexpressionParser :: Parser Expression\nexpressionParser =\n    makeExprParser termParser\n      [\n        [InfixR $ BinOp BinaryExp &lt;$ symbol \"^\"],\n        [\n          Prefix $ MonOp MonoMinus &lt;$ symbol \"-\",\n          Prefix $ MonOp MonoPlus &lt;$ symbol \"+\"\n        ],\n        [\n          InfixL $ BinOp BinaryMult &lt;$ symbol \"*\",\n          InfixL $ BinOp BinaryDiv &lt;$ symbol \"/\"\n        ],\n        [\n          InfixL $ BinOp BinaryPlus &lt;$ symbol \"+\",\n          InfixL $ BinOp BinaryMinus &lt;$ symbol \"-\"\n        ]\n      ]\n\ntermParser :: Parser Expression\ntermParser = (\n        (try $ Literal &lt;$&gt; L.decimal)\n    &lt;|&gt; (try $ parens expressionParser))\n\nparens :: Parser a -&gt; Parser a\nparens x = between (symbol \"(\") (symbol \")\") x\n\nmain :: IO ()\nmain = do\n    -- just to show that it does work in the + case:\n    test expressionParser \"1+(-2)\" $\n      BinOp BinaryPlus (Literal 1) (MonOp MonoMinus $ Literal 2)\n    test expressionParser \"1+-2\" $\n      BinOp BinaryPlus (Literal 1 ) (MonOp MonoMinus $ Literal 2)\n\n    -- but not in the ^ case\n    test expressionParser \"1^-2\" $\n      BinOp BinaryExp (Literal 1) (MonOp MonoMinus $ Literal 2)\n    test expressionParser \"-1^2\" $\n      MonOp MonoMinus $ BinOp BinaryExp (Literal 1) (Literal 2)\n    test expressionParser \"-1^-2\" $\n      MonOp MonoMinus $ BinOp BinaryExp (Literal 1) (MonOp MonoMinus $ Literal 2)\n\n    -- exponent precedence is weird\n    testEqual expressionParser \"1^2\" \"(1)^(2)\"\n    testEqual expressionParser \"-1^2\" \"-(1^2)\"\n    testEqual expressionParser \"1^-2\" \"1^(-2)\"\n    testEqual expressionParser \"-1^-2\" \"-(1^(-2))\"\n    testEqual expressionParser \"1^2^3^4\" \"1^(2^(3^(4))))\"\n  where\n    test :: (Eq a, Show a) =&gt; Parser a -&gt; String -&gt; a -&gt; IO ()\n    test parser input expected = do\n      assertEqual input (Right expected) $ parse (spaceConsumer &gt;&gt; parser &lt;* eof) \"test.txt\" input\n\n    testEqual :: (Eq a, Show a) =&gt; Parser a -&gt; String -&gt; String -&gt; IO ()\n    testEqual parser input expected = do\n        assertEqual input (p expected) (p input)\n      where\n        p i = parse (spaceConsumer &gt;&gt; parser &lt;* eof) \"test.txt\" i\n</code></pre>\n\n<p>Is it possible to get Megaparsec to parse these operators at the precedence levels that other languages do?</p>\n"}, {"tags": ["haskell", "yesod", "hamlet", "shakespeare-text"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1535670408, "post_id": 52106432, "comment_id": 91163852, "body": "Right. Writing program logic within your templating language is <a href=\"https://www.youtube.com/watch?v=rKXFgWP-2xQ\" rel=\"nofollow noreferrer\">a recipe for disaster</a>. Well, <i>disaster</i> is a bit strong, but it is not a good idea. Mind, Haskell doesn&#39;t really need templating languages anyway \u2013 <code>blaze</code> can also be used perfectly well as an eDSL, without any Template Haskell. The Shakespearean templates are nice though when you need a large chunk of CSS or JavaScript <i>without</i> any serverside logic."}], "tags": [], "owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "is_accepted": true, "score": 5, "last_activity_date": 1535669900, "creation_date": 1535669900, "answer_id": 52106432, "question_id": 52106167, "link": "https://stackoverflow.com/questions/52106167/compact-if-then-else-in-hamlet-templates/52106432#52106432", "title": "Compact if-then-else in Hamlet templates", "body": "<p>Most Haskell syntax isn't supported inside these template expressions. I think that's by design, since you don't want your template to contain complex business logic.</p>\n\n<p>I would write the code as a function on the Haskell end, and call it from the template. Something like:</p>\n\n<pre><code>-- .hs file\naltclass, signclass :: Int -&gt; String\naltclass x = if even x then \"even\" else \"odd\"\nsignclass x = if x &gt; 0 then \"positive\" else \"non-positive\"\n\n-- .hamlet file\n&lt;span class=\"#{altclass x} #{signclass x}\"&gt;#{x}&lt;/span&gt;\n</code></pre>\n\n<p>Doing it this way properly separates the business logic out of the template, but still allows you to use in-template variables.</p>\n"}], "owner": {"reputation": 6008, "user_id": 1983772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f429722c8167802b89cbe4d324aa1e?s=128&d=identicon&r=PG", "display_name": "Norrius", "link": "https://stackoverflow.com/users/1983772/norrius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 52106432, "answer_count": 1, "score": 0, "last_activity_date": 1535669900, "creation_date": 1535668157, "question_id": 52106167, "link": "https://stackoverflow.com/questions/52106167/compact-if-then-else-in-hamlet-templates", "title": "Compact if-then-else in Hamlet templates", "body": "<p>I am trying to understand variable interpolation in Yesod's Hamlet, in particular implementing if-then-else-like logic. Let's say I want to add CSS styling based on what value the integer <code>x</code> has. The <code>x</code> comes from a for-loop in the template, i.e. I do not have access to it from the Haskell code.</p>\n\n<p>Desired result: </p>\n\n<pre class=\"lang-html prettyprint-override\"><code>&lt;span class=\"even positive\"&gt;2&lt;/span&gt;\n&lt;span class=\"odd positive\"&gt;13&lt;/span&gt;\n&lt;span class=\"odd non-positive\"&gt;-1&lt;/span&gt;\n&lt;span class=\"even non-positive\"&gt;0&lt;/span&gt;\n</code></pre>\n\n<p>Attempt at inline <code>if</code>:</p>\n\n<pre><code>&lt;span class=\"#{if even x then \"even\" else \"odd\"} ...\"&gt;#{x}&lt;/span&gt;\n</code></pre>\n\n<p>Attempt using <code>$with</code>:</p>\n\n<pre><code>$with cls &lt;- (if even x then \"even\" else \"odd\")\n    &lt;span class=\"#{cls}\"&gt;#{x}&lt;/span&gt;\n</code></pre>\n\n<p>Neither works; both result in </p>\n\n<pre><code>\u2022 Illegal variable name: \u2018if\u2019\n  When splicing a TH expression\n</code></pre>\n\n<p>Apparently that part of Haskell syntax is not implemented in the <code>#{...}</code> parser. Is there a clean way to do this? I can currently see only one way out, and it is ugly as hell:</p>\n\n<pre><code>$if ((even x) &amp;&amp; (x &gt; 0))\n    &lt;span class=\"even positive\"&gt;#{x}&lt;/span&gt;\n$elseif (even x)\n    &lt;span class=\"even non-positive\"&gt;#{x}&lt;/span&gt;\n$elseif (x &gt; 0)\n    &lt;span class=\"odd positive\"&gt;#{x}&lt;/span&gt;\n$else\n    &lt;span class=\"odd non-positive\"&gt;#{x}&lt;/span&gt;\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1535651052, "post_id": 52102421, "comment_id": 91156263, "body": "A quick way with <code>:set -XTypeApplications</code> is instantiating <code>a</code> to <code>Rational</code> (<code>&gt;&gt; :t (^^) @Rational</code>) which gives the type of <code>(^^) @Rational :: Integral b =&gt; Rational -&gt; b -&gt; Rational</code> \u2014 showing that <code>Fractional Rational</code> holds. To verify that this makes use of <code>Fractional Rational</code>, use <code>:t +v (^^) @Rational</code> (for info see <code>:?</code>) or try it with a type that is decidedly <i>not</i> <code>Fractional</code>, <code>:t (^^) @()</code> (&quot;Could not deduce (<code>Fractional ()</code>) arising from a use of \u2018^^\u2019 ..&quot;)"}], "answers": [{"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 6, "last_activity_date": 1535649741, "creation_date": 1535649741, "answer_id": 52102448, "question_id": 52102421, "link": "https://stackoverflow.com/questions/52102421/check-if-type-instantiates-a-typeclass-in-ghci/52102448#52102448", "title": "Check if type instantiates a typeclass in GHCI", "body": "<p>You want <code>:info</code>, which can also be abbreviated <code>:i</code>. Use <code>:info &lt;type&gt;</code> to list instances on that type or <code>:info &lt;class&gt;</code> to list instances of that class.</p>\n\n<p>In the case of <code>Rational</code>, since it is a type alias, <code>:info</code> will not list instances directly. However, it <em>will</em> tell you that it is a type alias, and you can follow that up by using <code>:info</code> on the type it\u2019s aliased to:</p>\n\n<pre><code>ghci&gt; :info Ratio\ndata Ratio a = !a :% !a     -- Defined in \u2018GHC.Real\u2019\ninstance Eq a =&gt; Eq (Ratio a) -- Defined in \u2018GHC.Real\u2019\ninstance Integral a =&gt; Ord (Ratio a) -- Defined in \u2018GHC.Real\u2019\ninstance Show a =&gt; Show (Ratio a) -- Defined in \u2018GHC.Real\u2019\ninstance (Integral a, Read a) =&gt; Read (Ratio a)\n  -- Defined in \u2018GHC.Read\u2019\ninstance Integral a =&gt; Enum (Ratio a) -- Defined in \u2018GHC.Real\u2019\ninstance Integral a =&gt; Fractional (Ratio a)\n  -- Defined in \u2018GHC.Real\u2019\ninstance Integral a =&gt; Num (Ratio a) -- Defined in \u2018GHC.Real\u2019\ninstance Integral a =&gt; Real (Ratio a) -- Defined in \u2018GHC.Real\u2019\ninstance Integral a =&gt; RealFrac (Ratio a) -- Defined in \u2018GHC.Real\u2019\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1535650206, "creation_date": 1535650206, "answer_id": 52102555, "question_id": 52102421, "link": "https://stackoverflow.com/questions/52102421/check-if-type-instantiates-a-typeclass-in-ghci/52102555#52102555", "title": "Check if type instantiates a typeclass in GHCI", "body": "<p>Here's a way:</p>\n\n<pre><code>&gt; :set -XFlexibleContexts\n&gt; :t undefined :: (Fractional Rational) =&gt; Int\n\n&lt;interactive&gt;:1:14: warning: [-Wsimplifiable-class-constraints]\n    \u2022 The constraint \u2018Fractional Rational\u2019\n        matches an instance declaration\n      instance Integral a =&gt; Fractional (GHC.Real.Ratio a)\n        -- Defined in \u2018GHC.Real\u2019\n      This makes type inference for inner bindings fragile;\n        either use MonoLocalBinds, or simplify it using the instance\n    \u2022 In an expression type signature: (Fractional Rational) =&gt; Int\n      In the expression: undefined :: (Fractional Rational) =&gt; Int\nundefined :: (Fractional Rational) =&gt; Int :: Int\n</code></pre>\n\n<p>This is only a warning, so the instance exists.</p>\n\n<pre><code>&gt; :t undefined :: (Fractional Bool) =&gt; Int\n\n&lt;interactive&gt;:1:1: error:\n    No instance for (Fractional Bool)\n      arising from an expression type signature\n</code></pre>\n\n<p>This is an error, so there is no instance.</p>\n\n<p>(The <code>Int</code> above is arbitrary, you can use any other type instead.)</p>\n"}], "owner": {"reputation": 115, "user_id": 8925788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c32a104e80abe1c8aeceb1a7f5553fd5?s=128&d=identicon&r=PG&f=1", "display_name": "Jamie Ballingall", "link": "https://stackoverflow.com/users/8925788/jamie-ballingall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "closed_date": 1535677130, "accepted_answer_id": 52102448, "answer_count": 2, "score": 2, "last_activity_date": 1535650206, "creation_date": 1535649634, "question_id": 52102421, "link": "https://stackoverflow.com/questions/52102421/check-if-type-instantiates-a-typeclass-in-ghci", "closed_reason": "Duplicate", "title": "Check if type instantiates a typeclass in GHCI", "body": "<p>Is there a way to ask GHCi if a type instantiates a typeclass? I was fooling around with the <code>^^</code> operator and typed:</p>\n\n<pre><code>Prelude&gt; :type (^^)\n(^^) :: (Integral b, Fractional a) =&gt; a -&gt; b -&gt; a\n</code></pre>\n\n<p>Very useful. Then I wanted to know if Rational instantiates Fractional. I found Rational on Hoogle, dereferenced to Ratio and finally found:</p>\n\n<pre><code>Integral a =&gt; Fractional (Ratio a)\n</code></pre>\n\n<p>Was there an easier way? Something like:</p>\n\n<pre><code>:listypeclasses Rational\n</code></pre>\n\n<p>or</p>\n\n<pre><code>:listinstances Fractional\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1535649993, "post_id": 52101503, "comment_id": 91155801, "body": "Can you encode the problem as a SAT or SMT problem? There is some crazy levels of clever in solvers these days, and it would completely sidestep your data structures question. Anyway I think you&#39;re overestimating the cost of copies. GHC (and generational garbage collection in general) is amazing at handling frequent, short-lived allocations."}, {"owner": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1535651322, "post_id": 52101503, "comment_id": 91156384, "body": "I have not evaluated the SAT or SMT approach, as I have never done them. The problem involves time intervals (and checking for their overlaps and separations in time) along with daily total work quotas and rest breaks. I have a feeling that the Haskell solution will be complete long before I would have this coded in first-order logic with the temporal stuff in the mix."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1535652692, "post_id": 52101503, "comment_id": 91157005, "body": "I don&#39;t think there&#39;s enough detail here to give a good/interesting answer. Can you provide some code that represents your problem? I appreciate the intent behind the question you&#39;re asking, but tend to agree with Daniel Wagner that it would be best for you to implement the solution that seems most natural and measure and optimize later if it doesn&#39;t perform the way you like"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1535652982, "post_id": 52101503, "comment_id": 91157144, "body": "Perhaps the backtracking monad is an option: <a href=\"http://hackage.haskell.org/package/monad-lgbt-0.0.2/docs/Control-Monad-Backtrack.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/monad-lgbt-0.0.2/docs/&hellip;</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1535665421, "post_id": 52101503, "comment_id": 91162549, "body": "@jhu Sounds perfect for SMT (with the theory of integers to represent time) to me. And to be clear, I&#39;m not proposing you code directly in first-order logic. You should absolutely still use Haskell to represent the problem inputs, and write a Haskell program to produce the SMT query/interpret its results. I don&#39;t think you&#39;ll be able to code up a solver for your problem faster than you can transform it into an <code>SBool</code> from sbv, say, and ship it off to a solver."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1535666241, "post_id": 52101503, "comment_id": 91162802, "body": "Have you tried just using <code>Data.Map</code>?"}, {"owner": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "edited": false, "score": 1, "creation_date": 1535725988, "post_id": 52101503, "comment_id": 91186224, "body": "The reason I am not too eager to start exploring SMT is that I actually <i>already wrote</i> a working, backtracking solver using <code>StateT</code> for this, one that I have tested with small toy data. In the current version I am using lists as data structures all along. I am just wondering, before I start applying the solver to real data, what the performance will be. But maybe I will do what some suggested: take the straightforward route and optimize later if need be. Or even turn to SMT if necessary. The boring stuff (parsing etc.) I need to do next won&#39;t be wasted in any case. Thanks."}], "owner": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1535645803, "creation_date": 1535645803, "question_id": 52101503, "link": "https://stackoverflow.com/questions/52101503/data-structure-for-state-modification-in-backtracking", "title": "Data structure for state modification in backtracking", "body": "<p>I am writing my first larger Haskell program. The resulting application must allocate resources under a set of constraints. The algorithmic approach is brute force, since allocating a resource for each of the tasks is dependent on previous allocations. This is basically backtracking with constraint checking after each allocation. I am now considering what data structures I should use to make this as efficient as possible.</p>\n\n<p>The output (value) of the program is the list of resource allocations. The set of resources available is handled as a state using the <code>StateT</code> monad transformer. The state is a container of containers of containers: container of people, each having a container of days, each having a container of allocated times (pre-allocated before the program has started, or allocated by the program).</p>\n\n<p>During the search for a feasible solution the containers at the lowest level (allocated times) will be modified when a task is assigned to a specific person on a specific day at a specific time. Given that the search is likely to backtrack a large number of times, this will result in a large number of \"copies\" of immutable data. To be more specific, during each state change, exactly one item will be added to exactly one container at the lowest level: one time on a specific day will be allocated to a specific person. My question is:</p>\n\n<p><em>Which data structure(s) should I use given the large number of copies of immutable data?</em></p>\n"}, {"tags": ["haskell", "ihaskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535639629, "post_id": 52099480, "comment_id": 91149772, "body": "<a href=\"https://github.com/gibiansky/IHaskell/issues/828\" rel=\"nofollow noreferrer\">github.com/gibiansky/IHaskell/issues/828</a> may be relevant. But, what do you mean by \u201chave all the output automatically processed by LaTeX? Please give some examples of the kind of output you mean and how you&#39;d like it to be rendered."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535642708, "post_id": 52099480, "comment_id": 91151842, "body": "Ok, why not just make it <code>class Latexable a where showlatex :: a -&gt; LaTeX</code>? Using a string for this \u2013 but then expecting IHaskell to interpret it as LaTeX \u2013 seems rather strange... \u2014 \u201cFor every output is a string, ultimately\u201d \u2190 no it isn&#39;t, why would you think so?"}, {"owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535644861, "post_id": 52099480, "comment_id": 91153202, "body": "the output cells in the notebook are ASCII text. (Well, you can arrange for the notebook to display images, but let&#39;s ignore that.) Likewise, using ghci in a terminal, its prints ASCII characters. That&#39;s what I mean by &quot;the output is  always a string&quot;, I meant &quot;the output is a text in ASCII&quot;. I would like this ASCII text to be processed by Latex (or to be understood as Markdown.) By the way, when you run Sagemath in a Jupyter Notebook, you get this behaviour exactly by using <code>%display typeset</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535645068, "post_id": 52099480, "comment_id": 91153328, "body": "In GHCi it is a string, yes, but IMO it&#39;s the main selling point of Jupyter that you&#39;re not limited to text but can have all that other stuff. Now in Python of course, you don&#39;t tend to rely on the type system to distinguish between different... <i>types</i>. of output, but in Haskell that&#39;s very much the natural thing to do."}, {"owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535645643, "post_id": 52099480, "comment_id": 91153638, "body": "I see what you mean, OK. But anyway, I&#39;m looking for an easy way to call Latex from the notebook. Oh and I&#39;m happy even with quick-and-dirty solutions, such as a way of quickly copying the output to the clipboard (then I can paste in a markdown cell, better than nothing -- having to use CTRL-C manually is VERY slow, on the other hand)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1535645801, "post_id": 52099480, "comment_id": 91153726, "body": "Well, for Quick&amp;Dirty, just wrap your results in <a href=\"http://hackage.haskell.org/package/HaTeX-3.19.0.0/docs/Text-LaTeX-Base-Commands.html#v:raw\" rel=\"nofollow noreferrer\"><code>LaTeX.raw</code></a>, or rather <a href=\"http://hackage.haskell.org/package/text-1.2.3.0/docs/Data-Text.html#v:pack\" rel=\"nofollow noreferrer\"><code>raw . Text.pack</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "is_accepted": false, "score": 1, "last_activity_date": 1535646145, "creation_date": 1535646145, "answer_id": 52101605, "question_id": 52099480, "link": "https://stackoverflow.com/questions/52099480/ihaskell-and-latex/52101605#52101605", "title": "IHaskell and Latex", "body": "<p>Here's a partial answer to my own question.</p>\n\n<p><code>import IHaskell.Display (latex)</code></p>\n\n<p>Then if you try, say</p>\n\n<p><code>latex \"$x+y$\"</code></p>\n\n<p>it works!</p>\n\n<p>It remains to find a mechanism so that <code>latex</code> is automatically called in certain situations, so the question remains open. But in most cases, I'm good.</p>\n"}], "owner": {"reputation": 213, "user_id": 10265597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc825899daab36c81d86511cf71cc01?s=128&d=identicon&r=PG", "display_name": "Pierre", "link": "https://stackoverflow.com/users/10265597/pierre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1535646145, "creation_date": 1535639256, "last_edit_date": 1535641805, "question_id": 52099480, "link": "https://stackoverflow.com/questions/52099480/ihaskell-and-latex", "title": "IHaskell and Latex", "body": "<p>Is it possible, when using IHaskell, to have all the output automatically processed by Latex, or understood as Markdown ?</p>\n\n<p>Perhaps this will involve (at least if I want it to work with data of type <code>MyType</code>) using <code>import IHaskell.Display</code> and <code>instance IHaskellDisplay MyType where...</code> but I don't know how to make this work!</p>\n\n<p>Thanks!</p>\n\n<p><strong>edit</strong> Someone asked for an example, so what I have in mind is: every string of output (for every output is a string, ultimately...) is processed as latex code (or markdown). If a function returns, say, an integer, the result will be barely visible, but if a function returns the string <code>$\\mathbb{Z}$</code> then what appears on the screen is</p>\n\n<p>$\\mathbb{Z}$ </p>\n\n<p>[<strong>alert !</strong> I thought we had latex formulae on stackoverflow, just like we do in mathoverflow, but if we don't, you need your imagination here!...]</p>\n\n<p>Ultimately i imagine I would have a <code>class Latexable a where showlatex :: a -&gt; String</code> and I would implement showlatex for some types.</p>\n\n<p>Well, I'm happy with various partial solutions, allowing me to have <em>some</em> formulae typeset directly in the notebook, it doesn't really matter whether <em>all</em> output is processed...</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 5, "creation_date": 1535638880, "post_id": 52099050, "comment_id": 91149221, "body": "Where have you defined an instance for <code>IsMark Int</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1535674087, "creation_date": 1535674087, "answer_id": 52106873, "question_id": 52099050, "link": "https://stackoverflow.com/questions/52099050/filtering-on-type-level/52106873#52106873", "title": "Filtering on type-level", "body": "<p>As was noted by @M.Aroosi, you need an instance of <code>IsMark</code> for <code>Int</code>:</p>\n\n<pre><code>type instance IsMark Int = 'False\n</code></pre>\n\n<p>after which the program will type check.  Of course, you don't want to have to define an instance for every non-mark type, and using:</p>\n\n<pre><code>type instance IsMark a = 'False\n</code></pre>\n\n<p>will lead to conflicting instances.</p>\n\n<p>The solution is to define a closed type family instead:</p>\n\n<pre><code>type family IsMark a :: Bool where\n  IsMark Uniq = 'True\n  IsMark NUniq = 'True\n  IsMark UUniq = 'True\n  IsMark a = 'False\n</code></pre>\n\n<p>after which it should all work:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nimport Data.Type.Bool\n\ndata Uniq = Uniq deriving Show\ndata NUniq = NUniq deriving Show\ndata UUniq = UUniq deriving Show\n\ntype family IsMark a :: Bool where\n  IsMark Uniq = 'True\n  IsMark NUniq = 'True\n  IsMark UUniq = 'True\n  IsMark a = 'False\n\ntype Id x = x\ntype Fn x y = x -&gt; y\n\ntype family TL2Fun xs where\n  TL2Fun '[x] = Id x\n  TL2Fun (x : xs) = Fn x (TL2Fun xs)\n\nf1 :: TL2Fun '[Int, Int, Int]\nf1 a b = a + b\n\ntype family WOMarks xs where\n  WOMarks '[] = '[]\n  WOMarks (x : xs) = If (IsMark x) (WOMarks xs) (x : (WOMarks xs))\n\nf2 :: TL2Fun (WOMarks '[Int, Int, Int, Uniq])\nf2 a b = a + b\n</code></pre>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 52106873, "answer_count": 1, "score": 1, "last_activity_date": 1535674087, "creation_date": 1535637930, "question_id": 52099050, "link": "https://stackoverflow.com/questions/52099050/filtering-on-type-level", "title": "Filtering on type-level", "body": "<p>Consider, I have types-markers:</p>\n\n<pre><code>data Uniq = Uniq deriving Show\ndata NUniq = NUniq deriving Show\ndata UUniq = UUniq deriving Show\n</code></pre>\n\n<p>and predicate to distinguish them:</p>\n\n<pre><code>type family IsMark a :: Bool\ntype instance IsMark Uniq = 'True\ntype instance IsMark NUniq = 'True\ntype instance IsMark UUniq = 'True\n</code></pre>\n\n<p>and \"convertor\" from <code>'[A, B, ..]</code> to <code>A -&gt; B -&gt; ..</code>:</p>\n\n<pre><code>type Id x = x\ntype Fn x y = x -&gt; y\n\ntype family TL2Fun xs where\n  TL2Fun '[x] = Id x\n  TL2Fun (x ': xs) = Fn x (TL2Fun xs)\n</code></pre>\n\n<p>so this signature is right:</p>\n\n<pre><code>f1 :: TL2Fun '[Int, Int, Int]\nf1 a b = a + b\n</code></pre>\n\n<p>Now I want this:</p>\n\n<pre><code>f2 :: TL2Fun (WOMarks '[Int, Int, Int, Uniq])\nf2 a b = a + b\n</code></pre>\n\n<p>i.e. filter-out <code>Uniq</code> from this list first. So, I add filter function based on my predicate:</p>\n\n<pre><code>type family WOMarks xs where\n  WOMarks '[] = '[]\n  WOMarks (x ': xs) = If (IsMark x) (WOMarks xs) (x ': (WOMarks xs))\n</code></pre>\n\n<p>where <code>If</code> is imported from <code>Data.Type.Bool</code> (or I can implement it with PolyKind)...</p>\n\n<p>But <code>f2</code> is not compiling, I get error like</p>\n\n<pre><code> \u2022 Couldn't match type \u2018TL2Fun\n                          (If\n                             (IsMark Int)\n                             (If\n                                (IsMark Int)\n                                (If (IsMark Int) '[] '[Int])\n                                (Int : If (IsMark Int) '[] '[Int]))\n                             (Int\n                                : If\n                                    (IsMark Int)\n                                    (If (IsMark Int) '[] '[Int])\n                                    (Int : If (IsMark Int) '[] '[Int])))\u2019\n                  with \u2018a0 -&gt; a0 -&gt; a0\u2019\n   Expected type: TL2Fun (WOMarks '[Int, Int, Int, Uniq])\n     Actual type: a0 -&gt; a0 -&gt; a0\n   The type variable \u2018a0\u2019 is ambiguous\n \u2022 The equation(s) for \u2018f2\u2019 have two arguments,\n   but its type \u2018TL2Fun (WOMarks '[Int, Int, Int, Uniq])\u2019 has none (intero)\n</code></pre>\n\n<p>which looks like <code>If</code> exists in my filtering attempt: it's tree of \"calls\", but it was not \"evaluated\" to filtered result (or something else, I'm not sure about error reason). How to achieve my goal, ie, to remove types by predicate?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 0, "creation_date": 1535637304, "post_id": 52089496, "comment_id": 91148072, "body": "Thanks Alexis, I tried your suggestion, and deleted the cached cabal file, but it still doesn&#39;t work, <code>stack build</code> passes again. I&#39;ve updated with my changes in the post. Did I still miss anything?"}, {"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 0, "creation_date": 1535638567, "post_id": 52089496, "comment_id": 91148988, "body": "Never mind. It works now. I should add them in either top level ghc-options, or library.ghc-options. But not both! :p"}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 5, "last_activity_date": 1535605134, "creation_date": 1535605134, "answer_id": 52089496, "question_id": 52089306, "link": "https://stackoverflow.com/questions/52089306/why-stack-build-doesnt-print-the-warning-but-stack-ghci-does/52089496#52089496", "title": "why `stack build` doesn&#39;t print the warning, but `stack ghci` does?", "body": "<p>You have set various GHC options for the <code>tt-exe</code> executable target, which corresponds to the <code>app/</code> directory due to the <code>source-dirs</code> setting, but your <code>Lib.hs</code> file appears to be in a <code>src/</code> directory. Presumably, this directory contains the source code for the <code>library</code> target, which has a separate set of GHC options.</p>\n\n<p>You need to specify those options for the relevant target in order for <code>stack build</code> to apply them properly. However, since you are using hpack, you can also extract them into a top-level <code>ghc-options</code> section, which will be shared between all targets. Either solution should make <code>stack build</code> produce the warning you expect.</p>\n\n<p>I don\u2019t know why <code>stack ghci</code> behaves the way it does, but I think the REPL is known to have trouble with certain multi-target or multi-project configurations, so I\u2019m not entirely surprised it does something wrong here.</p>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "accepted_answer_id": 52089496, "answer_count": 1, "score": 3, "last_activity_date": 1535638488, "creation_date": 1535603942, "last_edit_date": 1535638488, "question_id": 52089306, "link": "https://stackoverflow.com/questions/52089306/why-stack-build-doesnt-print-the-warning-but-stack-ghci-does", "title": "why `stack build` doesn&#39;t print the warning, but `stack ghci` does?", "body": "<p>I have a new project, with the following code in <code>Lib.hs</code></p>\n\n<pre><code>data ABC\n  = A\n  | B\n  | C\n\nabc :: ABC -&gt; Int\nabc A = 1\nabc B = 2\n</code></pre>\n\n<p>I want <code>stack build</code> to fail and hint me that I didn't handle <code>abc C</code>. </p>\n\n<p>I have the following flags turned on in <code>package.yaml</code>:</p>\n\n<pre><code>library:\n  source-dirs: src\n\nexecutables:\n  tt-exe:\n    main:                Main.hs\n    source-dirs:         app\n    ghc-options:\n    - -threaded\n    - -rtsopts\n    - -with-rtsopts=-N\n    dependencies:\n    - tt\n</code></pre>\n\n<p>But <code>stack build</code> compiles with no warning, no error. However, <code>stack ghci</code> is able to give me the following warnings:</p>\n\n<pre><code>/Users/leo/zhangchiqing/te/tt/src/Lib.hs:11:1: warning: [-Wincomplete-patterns]\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018abc\u2019: Patterns not matched: C\n   |\n11 | abc A = 1\n   | ^^^^^^^^^...\n</code></pre>\n\n<p>Did I miss anything, why <code>stack build</code> doesn't fail?</p>\n\n<p>GHC version 8.2.2, stack resolver: lts-11.1</p>\n"}, {"tags": ["haskell", "quickcheck"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1535595537, "post_id": 52088338, "comment_id": 91126992, "body": "How about you still generate random elements but also make a new <code>Collection</code> type and make the generation of <code>Collection</code>s of values that has the correct distribution?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1535632267, "post_id": 52088338, "comment_id": 91144426, "body": "<a href=\"https://www.xkcd.com/568/\" rel=\"nofollow noreferrer\">Panel 2</a> seems relevant here. I expect by the time you can say what you mean by &quot;generate a random 4-digit number and then some of the elements of that string should have that repeat say 25% of the time&quot; with enough precision for us to help you, you&#39;ll also be able to just write down the code that does it yourself."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 3, "last_activity_date": 1536049138, "creation_date": 1536049138, "answer_id": 52161822, "question_id": 52088338, "link": "https://stackoverflow.com/questions/52088338/generate-a-random-string-date-with-quickcheck/52161822#52161822", "title": "Generate a random string-date with QuickCheck", "body": "<p>Here's one attempt. You could start by defining a generator of those four-digit 'dates':</p>\n\n<pre><code>genDate :: Gen String\ngenDate = vectorOf 4 $ elements ['0'..'9']\n</code></pre>\n\n<p>Next, a function that, given a <code>String</code> will return a generator of 'courses':</p>\n\n<pre><code>genCourse :: String -&gt; Gen String\ngenCourse ns = do\n  ls &lt;- listOf1 $ elements ['a'..'z']\n  return (ls ++ \"-\" ++ ns)\n</code></pre>\n\n<p>In order to implement a <code>genArgs</code> function, one way to address the requirement could be to first generate a single <code>date</code>, and then use <code>frequency</code> to either return that randomly generated value, or other randomly generated dates:</p>\n\n<pre><code>genArgs :: Gen String\ngenArgs = do\n  date &lt;- genDate\n  dates &lt;- listOf1 $ frequency [(1, return date), (3, genDate)]\n  courses &lt;- traverse genCourse dates\n  return $ unwords courses\n</code></pre>\n\n<p>One out of four values will be generated by the constant generator <code>return date</code>, and three out of four will be generated randomly by <code>genDate</code>.</p>\n\n<p>This produces a list of 'date' strings that you can then traverse with <code>genCourse</code>.</p>\n\n<p>Here's some sample values:</p>\n\n<pre><code>*Main Lib&gt; sample genArgs\n\"u-8747\"\n\"sd-2575 l-3069\"\n\"rfn-1191 jbs-8962 kjtt-1909\"\n\"ezbtrj-6167 t-3474 daaht-0834 puc-2266\"\n\"epkbtz-8334 uj-8829 etu-9061 wkkro-5514 fque-4639 vgct-4572 daczohr-8683 zomo-5789\"\n\"mkrnvyrjfu-6765 vunu-6869 xjd-1135 rkritwi-6869 odmvxec-4236 mirrfp-1715 jccla-0998 qyasxozuq-3713\"\n\"cvyxjnvrqao-3675 rzsnkqplbv-3675 b-3675 ekchdgksbk-6463 nonz-3354 ue-3675 mwwoovthxusd-8882\"\n\"vwffdntpwawo-4565\"\n\"t-0278 dyauqxenubxjohr-7815 yvogox-5183 oz-4660 eufwzgabvo-3813 azetihbmuw-8622 tizuzbmacv-6102 tzqjz-9686 jsaaepngbi-7394 fzzpzykibohzf-7394 muhlolo-6770 tixpoi-7394 kqhvvw-5877 ulg-7394 ce-6817\"\n\"y-3550 tfakitqwrhyrpu-6923 gwzpegkpxjn-7222 jkvuwsf-2819 il-2268 sfmxdh-0004 vqmalaisvtqtg-1759 acxn-3146 fuhwps-4534 rtqgqzndtjhiygan-3326 yktgeeww-2819 irtrpnh-0198 ghqs-2819 lofyzpejuzw-8408 hd-2647\"\n\"kts-8877 kipbbttkzvopwkrmemsz-2158 xqblwsgdrhaupbfgg-0841 eminvqkvwl-9193 bjhzmafgnjyhdzuppar-9912 cg-7737 enjvjalpkstizymci-0039\"\n</code></pre>\n\n<p>Notice that for example <code>6869</code> is repeated twice in the sixth value, and <code>3675</code> is repeated four times in the seventh sample.</p>\n"}], "owner": {"reputation": 479, "user_id": 4496701, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-SST61v329Q0/AAAAAAAAAAI/AAAAAAAAAFM/ihwdZ1nZE7Q/photo.jpg?sz=128", "display_name": "Cliff Stamp", "link": "https://stackoverflow.com/users/4496701/cliff-stamp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "accepted_answer_id": 52161822, "answer_count": 1, "score": 1, "last_activity_date": 1568026777, "creation_date": 1535595327, "last_edit_date": 1568026777, "question_id": 52088338, "link": "https://stackoverflow.com/questions/52088338/generate-a-random-string-date-with-quickcheck", "title": "Generate a random string-date with QuickCheck", "body": "<p>I need to generate a string of names-date separated by spaces, where the name is just a random length of characters and the date is just four numbers. For example:</p>\n\n<p>\"dfghjkl-1234 derftgyhjuik-5678\"</p>\n\n<p>Currently I have this solution:</p>\n\n<pre><code>genArgs :: Gen String\ngenArgs = do\n  cs &lt;- listOf1 genCourse\n  return (unwords cs)\n\ngenCourse :: Gen String\ngenCourse = do\n  ns &lt;- elements [\"1111\",\"1234\",\"4567\",\"1411\",\"1284\",\"4517\"]\n  ls &lt;- listOf1 $ elements ['a'..'z']\n  return (ls ++ \"-\" ++ ns)\n</code></pre>\n\n<p>But I had to hard-code the list of numbers because some of them have to repeat (have the same numbers) and if I just randomly picked them it would be very unlikely that somethin like this ever happens:</p>\n\n<p>\"dfghjkl-1234 derftgyhjuik-5678 gyhujik-1234\"</p>\n\n<p>What I would like, is to generate a random 4-digit number and then some of the elements of that string should have that repeat, say 25% of the time. I imagine this is achieved with frequency?</p>\n"}, {"tags": ["haskell", "exception"], "answers": [{"comments": [{"owner": {"reputation": 1270, "user_id": 2383766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc13aeb9c9f89e097f48d815b81541d5?s=128&d=identicon&r=PG", "display_name": "Z-Y.L", "link": "https://stackoverflow.com/users/2383766/z-y-l"}, "edited": false, "score": 0, "creation_date": 1535595911, "post_id": 52088228, "comment_id": 91127073, "body": "Thanks a lot! It solves my puzzle, and it seems a long way to learn the exception control in Haskell."}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 10, "last_activity_date": 1535594647, "last_edit_date": 1592644375, "creation_date": 1535594206, "answer_id": 52088228, "question_id": 52088100, "link": "https://stackoverflow.com/questions/52088100/how-the-onexception-behaves/52088228#52088228", "title": "How the `onException` behaves", "body": "<p><strong>You\u2019ve been bitten by lazy evaluation.</strong></p>\n<p>One of the key guarantees of <code>throwIO</code> is that it guarantees <em>when</em> the exception will be raised with respect to the execution of other <code>IO</code> actions. From <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Exception.html#v:throwIO\" rel=\"noreferrer\">the documentation</a>:</p>\n<blockquote>\n<p>Although <code>throwIO</code> has a type that is an instance of the type of <code>throw</code>, the two functions are subtly different:</p>\n<pre><code>throw e   `seq` x  ===&gt; throw e\nthrowIO e `seq` x  ===&gt; x\n</code></pre>\n<p>The first example will cause the exception <code>e</code> to be raised, whereas the second one won't. In fact, <code>throwIO</code> will only cause an exception to be raised when it is used within the <code>IO</code> monad. The <code>throwIO</code> variant should be used in preference to throw to raise an exception within the <code>IO</code> monad because it guarantees ordering with respect to other <code>IO</code> operations, whereas <code>throw</code> does not.</p>\n</blockquote>\n<p>This means that, when the <code>throwIO e</code> action is executed (not merely evaluated!) as a part of the execution of the action produced by <code>onException</code>, it is guaranteed to actually raise an exception. Since the exception is raised within the dynamic extent of the execution of the exception handler, the exception is detected, and the handler function is executed.</p>\n<p>However, when you write <code>return e</code>, the action it produces does <em>not</em> evaluate <code>e</code> to WHNF when it is executed, and <code>e</code> is only evaluated if/when the action\u2019s result is itself evaluated. By the time the <code>div 4 0</code> expression is forced by GHCi by <code>show</code>ing the action\u2019s result, control has left the dynamic extent of the execution of <code>onException</code>, and the handler it installed is no longer on the stack. The exception is raised, but it is raised too late.</p>\n<p>To get the behavior you want, it\u2019s critical to ensure you evaluate <code>div 4 0</code> as a part of your action\u2019s execution, and not a moment before or after. This is what <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Exception.html#v:evaluate\" rel=\"noreferrer\">the <code>evaluate</code> function from <code>Control.Exception</code></a> is for. It evaluates its argument to WHNF as a part of the execution of the <code>IO</code> action itself, guaranteeing that any exceptions raised as part of that evaluation will be detected by a surrounding exception handler:</p>\n<pre><code>ghci&gt; onException (evaluate $ div 4 0) (putStrLn &quot;Oops!&quot;)\nOops!\n*** Exception: divide by zero\n</code></pre>\n<p>The moral: when handling exceptions in Haskell, be very careful about when things are evaluated to ensure the exception is raised within the dynamic extent of your exception handler and is not deferred due to lazy evaluation.</p>\n"}], "owner": {"reputation": 1270, "user_id": 2383766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc13aeb9c9f89e097f48d815b81541d5?s=128&d=identicon&r=PG", "display_name": "Z-Y.L", "link": "https://stackoverflow.com/users/2383766/z-y-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 52088228, "answer_count": 1, "score": 4, "last_activity_date": 1535594647, "creation_date": 1535593015, "question_id": 52088100, "link": "https://stackoverflow.com/questions/52088100/how-the-onexception-behaves", "title": "How the `onException` behaves", "body": "<p><code>finally</code> and <code>onException</code> are two functions from the module <code>Control.Exception</code>, which have the same signature but behave differently. \n <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base-4.11.1.0/Control-Exception.html#v:onException\" rel=\"nofollow noreferrer\">Here</a> is the document. \nFor <code>finally</code>, it says:</p>\n\n<pre><code>finally \n:: IO a  -- computation to run first\n-&gt; IO b  -- computation to run afterward (even if an exception was raised)\n-&gt; IO a\n</code></pre>\n\n<p>, while for <code>onException</code>, it says:</p>\n\n<blockquote>\n  <p>Like <code>finally</code>, but only performs the final action if there was an\n  exception raised by the computation.</p>\n</blockquote>\n\n<p>So I do the following test:</p>\n\n<pre><code>ghci&gt; finally (return $ div 4 2) (putStrLn \"Oops!\")\nOops!\n2\nghci&gt; finally (return $ div 4 0) (putStrLn \"Oops!\")\nOops!\n*** Exception: divide by zero\n</code></pre>\n\n<p>which acts as expected. </p>\n\n<p>However, <code>onException</code> does not:</p>\n\n<pre><code>ghci&gt; onException (return $ div 4 2) (putStrLn \"Oops!\")\n2\nghci&gt; onException (return $ div 4 0) (putStrLn \"Oops!\")  -- does not act as expected\n*** Exception: divide by zero\n</code></pre>\n\n<p>As describe above, <code>onException</code> only performs the final action if an exception was raised, but the example above shows that <code>onException</code> does not perform the final action, i.e. <code>putStrLn \"Oops!\"</code> when an exception raised.</p>\n\n<p>After checking the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base-4.11.1.0/src/Control.Exception.Base.html#onException\" rel=\"nofollow noreferrer\">source code</a> for <code>onException</code>, I try the test as follow:</p>\n\n<pre><code>ghci&gt; throwIO (SomeException DivideByZero) `catch` \\e -&gt; do {_ &lt;- putStrLn \"Oops!\"; throwIO (e :: SomeException)}\nOops!\n*** Exception: divide by zero\nghci&gt; onException (throwIO (SomeException DivideByZero)) (putStrLn \"Oops!\")\nOops!\n*** Exception: divide by zero\n</code></pre>\n\n<p>As can be seen, when an exception raised explicitly, the final action was performed. </p>\n\n<p>So the question is <code>return $ div 4 0</code> really throws an exception, but <strong>why <code>onException (return $ div 4 0) (putStrLn \"Oops!\")</code> does not perform the final action <code>putStrLn \"Oops!\"</code>? What am I missing? And how the exception was performed?</strong></p>\n\n<pre><code>ghci&gt; throwIO (SomeException DivideByZero)\n*** Exception: divide by zero\nghci&gt; (return $ div 4 0) :: IO Int\n*** Exception: divide by zero\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "memoization"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1535597935, "post_id": 52087644, "comment_id": 91127459, "body": "Well, you can certainly share all the subdefinitions between <code>m</code> and <code>f</code>.  This pair of sequences looks like you can do even better though, and generate them corecursively."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1535622327, "post_id": 52087644, "comment_id": 91137805, "body": "Note that <code>!!</code> on lists is inefficient, since it has a O(n) cost. If indexing can not be avoided, consider using some O(1) data structure, e.g. arrays. Also recursion depth should not be an issue unless it is really huge -- why do you mention that? (You are not using an ancient Hugs, right?)"}], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 3, "last_activity_date": 1535604640, "creation_date": 1535604640, "answer_id": 52089408, "question_id": 52087644, "link": "https://stackoverflow.com/questions/52087644/dynamic-programming-haskell-hofstader-m-f-sequence/52089408#52089408", "title": "Dynamic Programming (Haskell, Hofstader M/F sequence)", "body": "<p>First of all, you can pattern-match in a top-level binding.  Usually it doesn't mean much interesting is going on, but if you want to share local helpers between two top-level bindings, it can help.</p>\n\n<pre><code>m2 :: Int -&gt; Int\nf2 :: Int -&gt; Int\n(m2, f2) = (gom, gof)\n  where\n    gof 0 = 1\n    gof i = i - ms !! ( fs !! (i-1) )\n    gom 0 = 0\n    gom i = i - fs !! ( ms !! (i-1) )\n    fs = map gof [0..]\n    ms = map gom [0..]\n</code></pre>\n\n<p>You'll note there's one other trick in there.  Instead of bounding the lists <code>fs</code> and <code>ms</code> to their maximum size, I just let laziness handle bounding them.  The lists won't be created past where they're needed to memoize earlier results.</p>\n\n<p>But list indexing is O(n).  Getting rid of even some of it can be a significant speedup.  If you look at the pattern of recursion along the same function, you'll see that <code>gom i</code> always calls <code>gom (i-1)</code>, and the same with <code>gof</code>. You can use that to remove list indexing on those lookups by just passing along the previous value. Unfortunately, the same doesn't apply with the calls to the opposite function, as they don't follow so easily.  But it's still removing a big amount of work.  And it can be done in such a way as to utilize laziness even further:</p>\n\n<pre><code>m3, f3 :: Int -&gt; Int\n(m3, f3) = ((ms !!), (fs !!))\n  where\n    (ms, fs) = unzip pairs\n    pairs = (0, 1) : zipWith iter [1..] pairs\n    iter i (mp, fp) = (i - fs !! mp, i - ms !! fp)\n</code></pre>\n\n<p>The recursive helper functions have been replaced with simultaneous lazy creation of both result lists. This pattern differs from standard recursion in that it doesn't need a base case to reach, and it requires some sort of guard against trying to immediately find a base case before the complete answer can be provided. This pattern is known as co-recursion. (Or corecursion if I'm typing lazily.)  Same idea, but it produces the answer in the opposite direction.</p>\n"}, {"tags": [], "owner": {"reputation": 5755, "user_id": 394253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/985ef765f821b00d3b41ac5ca8aef6a0?s=128&d=identicon&r=PG", "display_name": "Ed&#39;ka", "link": "https://stackoverflow.com/users/394253/edka"}, "is_accepted": false, "score": 3, "last_activity_date": 1535714095, "last_edit_date": 1535714095, "creation_date": 1535632647, "answer_id": 52097287, "question_id": 52087644, "link": "https://stackoverflow.com/questions/52087644/dynamic-programming-haskell-hofstader-m-f-sequence/52097287#52097287", "title": "Dynamic Programming (Haskell, Hofstader M/F sequence)", "body": "<p>Or you can just use one of many <a href=\"https://wiki.haskell.org/Memoization\" rel=\"nofollow noreferrer\">memoization</a> packages which supports mutual recursive function. Below is the implementation that uses <a href=\"http://hackage.haskell.org/package/monad-memo\" rel=\"nofollow noreferrer\">monad-memo</a> which does require memoized function being defined in monadic form, but otherwise is just a direct translation of your original implementation.</p>\n\n<pre><code>import Control.Monad.Memo\nimport Control.Monad.ST\n\n-- Same function in monadic form\ngof 0 = return 1\ngof i = do\n  -- gof is memoized on level 0\n  fs &lt;- memol0 gof (i-1)\n  -- gom is on level 1\n  ms &lt;- memol1 gom fs\n  return (i - ms)\n\n-- Same here\ngom 0 = return 0\ngom i = do\n  ms &lt;- memol1 gom (i-1)\n  fs &lt;- memol0 gof ms\n  return (i - fs)\n\n-- Eval monadic form into normal Int -&gt; Int function\nfm :: Int -&gt; Int\n-- Data.Map-based memoization cache\nfm = startEvalMemo . startEvalMemoT . gof\n\nmm :: Int -&gt; Int\nmm = startEvalMemo . startEvalMemoT . gom   \n\n-- Or much faster vector-based memoization cashe\nfmv :: Int -&gt; Int\n-- We use two separate caches: mutable unboxed vectors of `(n+1)` length\nfmv n = runST $ (`evalUVectorMemo`(n+1)) . (`evalUVectorMemo`(n+1)) . gof $ n\n\nmmv :: Int -&gt; Int\nmmv n = runST $ (`evalUVectorMemo`(n+1)) . (`evalUVectorMemo`(n+1)) . gom $ n\n\n-- This is quite fast in comparison to the original solution\n-- but compile it with -O2 to be able to compute `f 1000000`\nmain :: IO ()\nmain =\n    print ((fm 100000, mm 100000),(fmv 1000000, mmv 1000000))\n</code></pre>\n"}], "owner": {"reputation": 479, "user_id": 4496701, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-SST61v329Q0/AAAAAAAAAAI/AAAAAAAAAFM/ihwdZ1nZE7Q/photo.jpg?sz=128", "display_name": "Cliff Stamp", "link": "https://stackoverflow.com/users/4496701/cliff-stamp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 52089408, "answer_count": 2, "score": 2, "last_activity_date": 1535714095, "creation_date": 1535588167, "question_id": 52087644, "link": "https://stackoverflow.com/questions/52087644/dynamic-programming-haskell-hofstader-m-f-sequence", "title": "Dynamic Programming (Haskell, Hofstader M/F sequence)", "body": "<p>This works :</p>\n\n<pre><code>f :: Int -&gt; Int\nf n = gof n where\n      gof 0 = 1\n      gof i = i - ms!! ( fs!! (i-1) )\n      gom 0 = 0\n      gom i = i - fs!! ( ms!! (i-1) )\n      fs = [gof j | j &lt;- [0..n]]\n      ms = [gom j | j &lt;- [0..n]]\n\nm n = gom n where\n      gof 0 = 1\n      gof i = i - ms!! ( fs!! (i-1) )\n      gom 0 = 0\n      gom i = i - fs!! ( ms!! (i-1) )\n      fs = [gof j | j &lt;- [0..n]]\n      ms = [gom j | j &lt;- [0..n]]\n</code></pre>\n\n<p>However it is really repetitive. Is there a way to avoid just repeating those chunks of code? A few references, this is an adaptation of :</p>\n\n<p><a href=\"http://jelv.is/blog/Lazy-Dynamic-Programming/\" rel=\"nofollow noreferrer\">http://jelv.is/blog/Lazy-Dynamic-Programming/</a></p>\n\n<p>Sequence ref :</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Hofstadter_sequence\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Hofstadter_sequence</a></p>\n\n<p>I checked it against the numbers :</p>\n\n<p><a href=\"https://oeis.org/A005378\" rel=\"nofollow noreferrer\">https://oeis.org/A005378</a>\n<a href=\"https://oeis.org/A005379\" rel=\"nofollow noreferrer\">https://oeis.org/A005379</a></p>\n\n<p>It generates the right numbers and it is way faster than the basic code which won't go very high at all before it starts having issues with recursion depth.</p>\n"}]