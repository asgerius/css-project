[{"tags": ["haskell", "attoparsec"], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 2, "last_activity_date": 1429772484, "creation_date": 1429772484, "answer_id": 29815999, "question_id": 29811022, "link": "https://stackoverflow.com/questions/29811022/parsing-n-hex-digits-using-attoparsec/29815999#29815999", "title": "parsing n hex digits using attoparsec", "body": "<p><a href=\"https://hackage.haskell.org/package/attoparsec-0.12.1.6/docs/Data-Attoparsec-ByteString-Char8.html#v:hexadecimal\" rel=\"nofollow\"><code>Data.Attoparsec.ByteString.Char8.hexadecimal</code></a> is <a href=\"https://hackage.haskell.org/package/attoparsec-0.10.1.1/docs/src/Data-Attoparsec-ByteString-Char8.html#hexadecimal\" rel=\"nofollow\">implemented as</a>:</p>\n\n<pre><code>hexadecimal :: (Integral a, Bits a) =&gt; Parser a\nhexadecimal = B8.foldl' step 0 `fmap` I.takeWhile1 isHexDigit\n  where\n    isHexDigit w = (w &gt;= 48 &amp;&amp; w &lt;= 57) ||\n                   (w &gt;= 97 &amp;&amp; w &lt;= 102) ||\n                   (w &gt;= 65 &amp;&amp; w &lt;= 70)\n    step a w | w &gt;= 48 &amp;&amp; w &lt;= 57  = (a `shiftL` 4) .|. fromIntegral (w - 48)\n             | w &gt;= 97             = (a `shiftL` 4) .|. fromIntegral (w - 87)\n             | otherwise           = (a `shiftL` 4) .|. fromIntegral (w - 55)\n</code></pre>\n\n<p>You can use pretty much the same, except that you need to insepct the result of <code>take</code>, as some of your characters might not be valid hexadecimal characters. You could use <code>(Maybe a -&gt; Word8 -&gt; Maybe a)</code> to put both in the same function, but for simplicity, I've used the functions from above:</p>\n\n\n\n<pre><code>fixedHexadecimal :: (Integral a, Bits a) =&gt; Int -&gt; Parser a\nfixedHexadecimal n = do\n    bytes &lt;- A.take n\n    if B8.all isHexDigit bytes \n      then B8.foldl' step 0 bytes\n      else fail \"fixedHexadecimal\"\n\n  where isHexDigit = -- see above\n        step       = -- see above\n</code></pre>\n"}], "owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 302, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1429772484, "creation_date": 1429746652, "question_id": 29811022, "link": "https://stackoverflow.com/questions/29811022/parsing-n-hex-digits-using-attoparsec", "title": "parsing n hex digits using attoparsec", "body": "<p>Okay so I need to parse n digits of hex and I am having a problem where I cant stop the standard attoparsec hex parser <code>hexadecimal</code>.</p>\n\n<p>My first idea was this: </p>\n\n<p><code>nHex n = take n *&gt; hexadecimal</code> but that doesnt work because it takes off 4 digits then parses the rest of the string xD</p>\n\n<p>next idea which works is this: </p>\n\n<pre><code>hex :: (Num a, Eq a) =&gt; Int -&gt; Parser a\nhex n = fst . head . readHex &lt;$&gt; count n (satisfy isHexDigit)\n</code></pre>\n\n<p>but the problem with that code is in the attoparsec library it warns against returning lists of chars for speed concerns and this hex parser is the base of my whole program </p>\n\n<p>next idea to try for better speed is this:</p>\n\n<pre><code>parseFragments :: (Bits a, Integral a) =&gt; Int -&gt; Parser a\nparseFragments n = do\n      fourChars &lt;- B.take n\n      let hexDigits = parseOnly hexadecimal fourChars\n      case hexDigits of  \n              Left err -&gt; fail err\n              Right x  -&gt; return x\n</code></pre>\n\n<p>But that feels like a terrible hack using parseOnly.\nIs there a fast way that is more idiomatic?</p>\n"}, {"tags": ["haskell", "ghc", "type-level-computation"], "comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1429738669, "post_id": 29809001, "comment_id": 47746779, "body": "Could you actually present code that compiles? There are lots of missing imports/definitions, and also typos (<code>c</code> in last line not in scope, <code>Applicative f -&gt;</code> ...). Nevertheless: the two instances you give a clearly overlapping; but doesn&#39;t it just work with <code>OverlappingInstances</code>?"}, {"owner": {"reputation": 71, "user_id": 4821419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65aace4e4fa869d5b2a17e3ccde90d79?s=128&d=identicon&r=PG&f=1", "display_name": "nick", "link": "https://stackoverflow.com/users/4821419/nick"}, "reply_to_user": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1429739691, "post_id": 29809001, "comment_id": 47747245, "body": "My apologies - the original definition of accumulate had an extra parameter of the same type as (&gt;+&lt;) to allow accumulation in both directions (meaning it could be passed both <code>(&gt;+&lt;)</code> and <code>flip (&gt;+&lt;)</code>. Also, I&#39;ve linked the full <a href=\"https://github.com/nickspinale/bigword/blob/master/Data/BigWord.hs\" rel=\"nofollow noreferrer\">source</a>, which includes imports and extensions. Unfortunately, -XOverlappingInstances is already there."}, {"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1429740944, "post_id": 29809001, "comment_id": 47747834, "body": "@nick: The link you provided has a different definition of <code>assemble</code> and doesn&#39;t have OverlappingInstances."}, {"owner": {"reputation": 71, "user_id": 4821419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65aace4e4fa869d5b2a17e3ccde90d79?s=128&d=identicon&r=PG&f=1", "display_name": "nick", "link": "https://stackoverflow.com/users/4821419/nick"}, "edited": false, "score": 0, "creation_date": 1429741413, "post_id": 29809001, "comment_id": 47748023, "body": "Wow - I feel pretty dumb right now. I somehow recall having tried -XOverlappingInstances (perhaps I did, in a previous version), and thought I still had it in that massive stack of pragmas. Thank you both for you help, and sorry for posting such a silly question..."}, {"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1429741636, "post_id": 29809001, "comment_id": 47748124, "body": "@nick: No problem, it was an interesting exercise to deduce &quot;n must divide into m&quot; when I missed that part of the question and tried to grok your instance."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1429769135, "post_id": 29809001, "comment_id": 47757285, "body": "So is there anything to answer here now?"}, {"owner": {"reputation": 71, "user_id": 4821419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65aace4e4fa869d5b2a17e3ccde90d79?s=128&d=identicon&r=PG&f=1", "display_name": "nick", "link": "https://stackoverflow.com/users/4821419/nick"}, "edited": false, "score": 0, "creation_date": 1429910951, "post_id": 29809001, "comment_id": 47841487, "body": "Nope :(. Should I do something to delete the question?"}], "owner": {"reputation": 71, "user_id": 4821419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65aace4e4fa869d5b2a17e3ccde90d79?s=128&d=identicon&r=PG&f=1", "display_name": "nick", "link": "https://stackoverflow.com/users/4821419/nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 126, "favorite_count": 1, "closed_date": 1429787085, "answer_count": 0, "score": 7, "last_activity_date": 1429739439, "creation_date": 1429737330, "last_edit_date": 1429739439, "question_id": 29809001, "link": "https://stackoverflow.com/questions/29809001/overlapping-instances-with-type-level-naturals-in-haskell", "closed_reason": "Not suitable for this site", "title": "Overlapping instances with type-level naturals in Haskell", "body": "<p>To make dealing with certain networking protocols, I've been using <code>GHC.TypeLits</code> to implement fixed-size bit-vectors as wrapped integers tagged with types of the kind <code>Nat</code>.</p>\n\n<pre><code>newtype W (n :: Nat) = W { getW :: Integer }\n</code></pre>\n\n<p>Along with instances for all sorts of classes (Integral, Num, Bits, etc), I've defined a function to combine them:</p>\n\n<pre><code>(&gt;+&lt;) :: forall n m. (KnownNat m, KnownNat n, KnownNat (m + n)) =&gt; W m -&gt; W n -&gt; W (m + n)\n(W x) &gt;+&lt; (W y) = fromInteger $ x + shift y (natValInt (Proxy :: Proxy m))\n</code></pre>\n\n<p>This next part is where I'm having trouble. I am attempting to create an applicative that results in a <code>W n</code> from one that results in a <code>W m</code>, where <code>m</code> is a divisor of <code>n</code>. For example, using attoparsec, should be able to write:</p>\n\n<pre><code>anyWord128 :: Parser (W 128)\nanyWord128 = assemble $ fmap (fromIntegral :: Word8 -&gt; W 8) anyWord8\n</code></pre>\n\n<p>Here is my attempt:</p>\n\n<pre><code>class (KnownNat d, KnownNat n) =&gt; d :|: n where\n    assemble :: forall f. Applicative f -&gt; f (W d) -&gt; f (W n)\n\ninstance KnownNat n =&gt; n :|: n where\n    assemble = id\n\ninstance (KnownNat n, CmpNat n d ~ GT, d :|: n', (d + n') ~ n) =&gt; d :|: n where\n    assemble f = liftA2 (&gt;+&lt;) f (assemble f)\n</code></pre>\n\n<p>The code compiles (with many language extensions, including -XOverlappingInstances, all of which are in the actual source linked below), loading the example usage of <code>assemble</code> causes GHCi to tell me that there are overlapping instances for <code>8 :|: 8</code>. I am guessing that this either because I don't know what I am doing or because of GHC's type-checker's limited computational abilities (or both).  </p>\n\n<p>Do any of you GHC wizards see a way of defining this class correctly?  </p>\n\n<p><strong>Edit</strong>  </p>\n\n<p>Fixed type in definition of assemble - thanks kosmikus.<br>\nAlso, here is the full <a href=\"https://github.com/nickspinale/bigword/blob/master/Data/BigWord.hs\" rel=\"nofollow\">source</a> (<code>:|:</code> is defined on line 159).</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 0, "last_activity_date": 1429769684, "creation_date": 1429769684, "answer_id": 29815176, "question_id": 29808812, "link": "https://stackoverflow.com/questions/29808812/place-holders-in-yesod-subsite/29815176#29815176", "title": "Place holders in Yesod subsite", "body": "<p>Looks like a pretty good solution to me. It's not so terribly different from how yesod-auth does its plugin capabilities, so there's certain some level of prior art.</p>\n"}], "owner": {"reputation": 682, "user_id": 3421913, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b267474c6f0ce7338d7bcd3ca14d9648?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastien", "link": "https://stackoverflow.com/users/3421913/sebastien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31, "favorite_count": 0, "accepted_answer_id": 29815176, "answer_count": 1, "score": 1, "last_activity_date": 1429769684, "creation_date": 1429736701, "question_id": 29808812, "link": "https://stackoverflow.com/questions/29808812/place-holders-in-yesod-subsite", "title": "Place holders in Yesod subsite", "body": "<p>Say I have a subsite <code>Profile</code> which can display the profile of an user (with his website, the name of his dog and all those matters), and another subsite <code>Social</code> which manage friendship between users.</p>\n\n<p>I would like that on the profile page of Michael, I can click on \"become friend with Michael\" (because he builds wonderful framework ;) ).  With respect to encapsulation, I can neither put this piece of code in <code>Profile</code> nor in <code>Social</code>. So I thought about word press and the ability we have to put placeholders in themes where we can put any widget we want.</p>\n\n<p>This led me to the following:</p>\n\n<pre><code>instance  YesodProfile App where\n        &lt;random stuff&gt;\n        placeholder userId = [ becomeFriendWidget userId, likeThisGuyWidget userId]\n</code></pre>\n\n<p>Then the <code>Profile</code> subsite has to display somewhere in the profile page the given widgets.</p>\n\n<p>Does it look to be a good solution? Does it exist another \"standard\" solution of this kind of issue?</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 6, "last_activity_date": 1429736638, "creation_date": 1429736638, "answer_id": 29808786, "question_id": 29808641, "link": "https://stackoverflow.com/questions/29808641/importing-files-from-different-folders-with-haskell-source-code/29808786#29808786", "title": "Importing files from different folders with Haskell source code", "body": "<p>If you create a <code>cabal</code> project this is pretty straightforward.  I would recommend a structure like</p>\n\n<pre><code>project-name/\n    src/\n        Euler/\n            P1.hs\n            P2.hs\n            P3.hs\n        Fermat/\n            GS/\n                Primes.hs\n</code></pre>\n\n<p>Then when you <code>cd /path/to/project-name</code>, run <code>cabal init</code>, fill in the information as it prompts you, and you're just about set.  The last thing you'll need to do is set up the module names.  A module's name should reflect its location in your <code>src</code> folder, and since all module names must start with upper case letters this means you need to make sure your folders are capitalized properly as well.  Here you would have the modules <code>Euler.P1</code>, <code>Euler.P2</code>, <code>Euler.P3</code>, and <code>Fermat.GS.Primes</code>.  Declare the module names as <code>module Module.Name where</code> in each file as appropriate, and then you can import each from each other as you please.  Module imports are always fully qualified as well, so if you want to import <code>src/Euler/P1.hs</code> in <code>src/Euler/P2.hs</code>, you would need to do it as <code>import Euler.P1</code></p>\n\n<p>You'll probably run into a few bumps along the way, but using cabal to manage your project is very useful in the long run.  Learn the basics and you'll be setting up projects with ease.</p>\n"}, {"comments": [{"owner": {"reputation": 255, "user_id": 1867985, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/52e6a539f8223ffe4f2bf731c8d4c551?s=128&d=identicon&r=PG", "display_name": "realityChemist", "link": "https://stackoverflow.com/users/1867985/realitychemist"}, "edited": false, "score": 0, "creation_date": 1438264156, "post_id": 29818360, "comment_id": 51387320, "body": "Going back through my old questions I realized I never actually accepted your answer!  There you go, that&#39;s worth a little bit of rep I think."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 4, "last_activity_date": 1429779180, "creation_date": 1429779180, "answer_id": 29818360, "question_id": 29808641, "link": "https://stackoverflow.com/questions/29808641/importing-files-from-different-folders-with-haskell-source-code/29818360#29818360", "title": "Importing files from different folders with Haskell source code", "body": "<p>Haskell expects to find the module <code>Foo.Bar.Baz</code> in the file <code>Foo/Bar/Baz.hs</code>. If you name your modules according to what folder they're in, and you load them with your current working directory at the root of the tree, everything should turn out fine. You don't actually need Cabal just to make that work. (Although as your programs get bigger, it of course becomes quite worth learning Cabal.)</p>\n\n<p>A Haskell file with no module declaration defaults to being called <code>Main</code>. To give the correct module name, you need to do something like</p>\n\n<pre><code>module Foo.Bar.Baz where\n</code></pre>\n\n<p>at the top of each source file. So, for example, if you start the file <code>Code/Haskell/Euler/P1</code> with the declaration</p>\n\n<pre><code>module Euler.P1 where\n</code></pre>\n\n<p>and start from a command prompt pointed at <code>Code/Haskell</code>, you should be good.</p>\n\n<p>Note that Haskell module names <em>must</em> start uppercase. I <em>believe</em> (but I'm not 100% certain) that matching against filenames is case-insensitive here. (Because Windows treats filenames as case-insensitive.)</p>\n"}], "owner": {"reputation": 255, "user_id": 1867985, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/52e6a539f8223ffe4f2bf731c8d4c551?s=128&d=identicon&r=PG", "display_name": "realityChemist", "link": "https://stackoverflow.com/users/1867985/realitychemist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 878, "favorite_count": 1, "accepted_answer_id": 29818360, "answer_count": 2, "score": 3, "last_activity_date": 1429779180, "creation_date": 1429736171, "question_id": 29808641, "link": "https://stackoverflow.com/questions/29808641/importing-files-from-different-folders-with-haskell-source-code", "title": "Importing files from different folders with Haskell source code", "body": "<p>Say I have some folders laid out like this:</p>\n\n<pre><code>\\Code\n    \\Haskell\n        \\euler\n            \\P1.hs\n            \\P2.hs\n            \\P3.hs\n        \\fermat\n            \\GS\n                \\primes.hs\n</code></pre>\n\n<p>There are some functions that I've written in <code>primes.hs</code> that I would like to use in <code>P3.hs</code>.  Is there a way to load the functions from <code>primes.hs</code> into <code>P3.hs</code> without just copying and pasting the code, similar to the way you can import modules that are in the same folder?  Can this be done with Cabal (I'm fairly new to Haskell, I haven't had a chance to become familiar with Cabal yet)?  I know there's some way to do it by loading <code>primes.hs</code> manually with ghci, but I'd like to just be able to run <code>P3.hs</code> and have it work.</p>\n"}, {"tags": ["algorithm", "haskell", "sieve-of-eratosthenes"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1429733979, "post_id": 29807762, "comment_id": 47744059, "body": "This is not the Sieve of Eratosthenes. It is a form of <a href=\"http://en.wikipedia.org/wiki/Trial_division\" rel=\"nofollow noreferrer\">trial division</a> and will be slow. For a better functional sieve, see the <a href=\"https://www.cs.hmc.edu/~oneill/papers/Sieve-JFP.pdf\" rel=\"nofollow noreferrer\">O&#39;Neill sieve</a>, which is closely based on Eratosthenes."}, {"owner": {"reputation": 14708, "user_id": 1041822, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fc976c3c3e2819f639f300378692c6d?s=128&d=identicon&r=PG", "display_name": "higuaro", "link": "https://stackoverflow.com/users/1041822/higuaro"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1429761387, "post_id": 29807762, "comment_id": 47754418, "body": "I was concerned about the slowness of this implementation, that is why I was looking to skip the first <code>p^2</code> numbers, but as I learn through the answers, it doesn&#39;t work that way. Thanks for the paper link."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1429764903, "post_id": 29807762, "comment_id": 47755472, "body": "O&#39;Neill&#39;s actual implementation is a little more complex (and much better) than the one in the paper. It&#39;s in <a href=\"https://hackage.haskell.org/package/NumberSieves-0.1.1/docs/Math-Sieve-ONeill.html\" rel=\"nofollow noreferrer\">Math.Sieve.ONeill</a> in the <code>NumberSieves</code> package."}], "answers": [{"tags": [], "owner": {"reputation": 17464, "user_id": 2040251, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UsW2G.jpg?s=128&g=1", "display_name": "kraskevich", "link": "https://stackoverflow.com/users/2040251/kraskevich"}, "is_accepted": false, "score": 1, "last_activity_date": 1429734115, "creation_date": 1429734115, "answer_id": 29808015, "question_id": 29807762, "link": "https://stackoverflow.com/questions/29807762/haskell-code-to-exclude-numbers-for-sieve-of-eratosthenes-not-working-as-expecte/29808015#29808015", "title": "Haskell code to exclude numbers for Sieve of Eratosthenes not working as expected", "body": "<p>This line of code:    </p>\n\n<pre><code>p:[x | x &lt;- sieve ps, x &gt; p ^ 2, (rem x p) /= 0] \n</code></pre>\n\n<p>says \"take all x from <code>sieve ps</code> such that  <code>x &gt; p^2</code> and <code>x</code> is not divisible by <code>p</code>\". Which means that all numbers less than or equal to <code>p^2</code> are thrown away. It is obviously not correct(the smallest counter example: <code>[2..3]</code>). </p>\n"}, {"comments": [{"owner": {"reputation": 14708, "user_id": 1041822, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fc976c3c3e2819f639f300378692c6d?s=128&d=identicon&r=PG", "display_name": "higuaro", "link": "https://stackoverflow.com/users/1041822/higuaro"}, "edited": false, "score": 0, "creation_date": 1429734558, "post_id": 29808020, "comment_id": 47744424, "body": "Thanks, really nice answer! Is there a way for jumping ahead in the list  using this approach or should I think of doing that in other way?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 14708, "user_id": 1041822, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fc976c3c3e2819f639f300378692c6d?s=128&d=identicon&r=PG", "display_name": "higuaro", "link": "https://stackoverflow.com/users/1041822/higuaro"}, "edited": false, "score": 1, "creation_date": 1429734770, "post_id": 29808020, "comment_id": 47744545, "body": "@higuaro as mentioned in the comment above by dfeuer you aren&#39;t actually implementing the sieve of eratosthenes with this style, it would be best to try a different route for finding prime numbers. List comprehensions do not allow you to jump ahead, they process each item in order."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14708, "user_id": 1041822, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fc976c3c3e2819f639f300378692c6d?s=128&d=identicon&r=PG", "display_name": "higuaro", "link": "https://stackoverflow.com/users/1041822/higuaro"}, "edited": false, "score": 1, "creation_date": 1429752652, "post_id": 29808020, "comment_id": 47751843, "body": "@higuaro, as far as I know, the only (reasonably simple) way to jump ahead is to use a <a href=\"http://en.wikipedia.org/wiki/Wheel_factorization\" rel=\"nofollow noreferrer\">wheel</a>, a technique O&#39;Neill explains much better in her paper. The problem with wheels seems to be that they get large rather quickly. Other approaches focus on chewing through the composites as fast as possible."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 2, "last_activity_date": 1429734127, "creation_date": 1429734127, "answer_id": 29808020, "question_id": 29807762, "link": "https://stackoverflow.com/questions/29807762/haskell-code-to-exclude-numbers-for-sieve-of-eratosthenes-not-working-as-expecte/29808020#29808020", "title": "Haskell code to exclude numbers for Sieve of Eratosthenes not working as expected", "body": "<p>You have</p>\n\n<pre><code>sieve [2..10]\n</code></pre>\n\n<p>Which expands to</p>\n\n<pre><code>2 : [x1 | x1 &lt;- sieve [3..10], x1 &gt; 4, rem x1 2 /= 0]\n    = 2 : [x1 | x1 &lt;- 3 : [x2 | x2 &lt;- sieve [4..10],\n                                x2 &gt; 9,\n                                x2 `rem` 3 /= 0],\n                x1 &gt; 4,\n                x1 `rem` 2 /= 0]\n</code></pre>\n\n<p>So first <code>x1</code> is <code>3</code>, but <code>3 &gt; 4</code> is <code>False</code> so we move to the next one:</p>\n\n<pre><code>    = 2 : [x1 | x1 &lt;- [x2 | x2 &lt;- sieve [4..10],\n                            x2 &gt; 9,\n                            x2 `rem` 3 /= 0],\n                x1 &gt; 4,\n                x1 `rem` 2 /= 0]\n\n    = 2 : [x1 | x1 &lt;- [x2 | x2 &lt;- 4 : [x3 | x3 &lt;- sieve [5..10],\n                                            x3 &gt; 16,\n                                            x3 `rem` 4 /= 0],\n                            x2 &gt; 9,\n                            x2 `rem` 3 /= 0],\n                x1 &gt; 4,\n                x1 `rem` 2 /= 0]\n</code></pre>\n\n<p>So if <code>x2</code> is <code>4</code>, <code>x2 &gt; 9</code> is false, so we move to the next element:</p>\n\n<pre><code>    = 2 : [x1 | x1 &lt;- [x2 | x2 &lt;- [x3 | x3 &lt;- sieve [5..10],\n                                        x3 &gt; 16,\n                                        x3 `rem` 4 /= 0],\n                            x2 &gt; 9,\n                            x2 `rem` 3 /= 0],\n                x1 &gt; 4,\n                x1 `rem` 2 /= 0]\n</code></pre>\n\n<p>So already we can see that the only actual value we know gets returned is <code>2</code>, <code>3</code> is skipped because <code>3 &gt; 4</code> is <code>False</code>.  <code>4</code> gets skipped, but for the wrong reason, and <code>5</code> will get skipped because <code>5 &gt; 16</code> is <code>False</code>, and so on.  The problem here is that your condition <code>x &gt; p ^ 2</code> filters the entire list, but you really want to just jump ahead in your list.  This means that values you're actually interested in are getting filtered out from the output.</p>\n"}], "owner": {"reputation": 14708, "user_id": 1041822, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fc976c3c3e2819f639f300378692c6d?s=128&d=identicon&r=PG", "display_name": "higuaro", "link": "https://stackoverflow.com/users/1041822/higuaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 29808020, "answer_count": 2, "score": 2, "last_activity_date": 1429734127, "creation_date": 1429733241, "question_id": 29807762, "link": "https://stackoverflow.com/questions/29807762/haskell-code-to-exclude-numbers-for-sieve-of-eratosthenes-not-working-as-expecte", "title": "Haskell code to exclude numbers for Sieve of Eratosthenes not working as expected", "body": "<p>I came with the following <a href=\"http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes\" rel=\"nofollow\">Sieve of Eratosthenes</a> implementation: </p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>sieve :: (Integral a) =&gt; [a] -&gt; [a]\nsieve [] = []\nsieve (p:ps) = p:[x | x &lt;- sieve ps, (rem x p) /= 0] \n\nprimes :: (Integral a) =&gt; [a]\nprimes = sieve [2..100]\n</code></pre>\n\n<p>Calling <code>primes</code> from <code>gchi</code> prints: </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97]\n</code></pre>\n\n<p>Adding the <a href=\"http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes#Implementation\" rel=\"nofollow\">optimization step</a> of starting marking numbers from <strong>p<sup>2</sup></strong>, I ended up with the following code: </p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>sieve :: (Integral a) =&gt; [a] -&gt; [a]\nsieve [] = []\nsieve (p:ps) = p:[x | x &lt;- sieve ps, x &gt; p ^ 2, (rem x p) /= 0] \n\nprimes :: (Integral a) =&gt; [a]\nprimes = sieve [2..100]\n</code></pre>\n\n<p>But it produces the following output: </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[2]\n</code></pre>\n\n<p>I'm new to Haskell so I'm having problem to understand why adding the <strong><code>x &gt; p ^ 2</code></strong> is producing this result. </p>\n\n<p>Can you please spot my mistake by explaining how is Haskell doing the evaluation of that expression? </p>\n"}, {"tags": ["windows", "haskell", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "is_accepted": true, "score": 3, "last_activity_date": 1429729652, "creation_date": 1429729652, "answer_id": 29806736, "question_id": 29806524, "link": "https://stackoverflow.com/questions/29806524/yesod-on-windows/29806736#29806736", "title": "Yesod on Windows", "body": "<p>When you install programs using the default Haskell Platform, the default install location on Windows is</p>\n\n<pre><code>C:\\Users\\SuperAwesomeUser\\AppData\\Roaming\\cabal\\bin\n</code></pre>\n\n<p>Opening a command prompt and typing <code>cabal install alex happy yesod-bin</code> successfully installed yesod in this location for me.</p>\n"}], "owner": {"reputation": 711, "user_id": 809102, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/062b1d54e88e8b951cc73e47eb12c601?s=128&d=identicon&r=PG", "display_name": "Treesrule14", "link": "https://stackoverflow.com/users/809102/treesrule14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 779, "favorite_count": 0, "accepted_answer_id": 29806736, "answer_count": 1, "score": 0, "last_activity_date": 1429729652, "creation_date": 1429728960, "last_edit_date": 1495539816, "question_id": 29806524, "link": "https://stackoverflow.com/questions/29806524/yesod-on-windows", "title": "Yesod on Windows", "body": "<p>I am trying to run the command yesod init. Obviously from the yesod library in Haskell. I tried to install the library using cabal install alex happy yesod-bin, the library works when running in ghc, but id really like to use the command line program yesod. </p>\n\n<p>I looked here\n<a href=\"https://stackoverflow.com/questions/24671225/yesod-init-command-does-not-work-on-windows\">yesod init command does not work on Windows</a></p>\n\n<p>But I couldn't actually find any of the files in question. I found the folder with the cabal executable (C:\\Program Files\\Haskell Platform\\2014.2.0.0\\lib\\extralibs\\bin) it contains alex and happy but not yesod.</p>\n\n<p>The really interesting thing is that I can keep reinstalling yesod-bin (which i can't do with say yesod). I figured this means I should read the cabal configuration file but i really couldn't find it and I am really not sure what to do.</p>\n"}, {"tags": ["javascript", "haskell", "ocaml", "type-inference", "coq"], "answers": [{"comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1429752069, "post_id": 29806802, "comment_id": 47751656, "body": "I just tested the following declaration in OCaml, <code>let rec foo x = foo (bar true) and bar x = x;;</code>. The inferred types were <code>val foo : bool -&gt; &#39;a</code> and <code>val bar : bool -&gt; bool</code>. However, in GHC when I tested <code>let foo x = foo (bar True); bar x = x</code> the inferred types were more general, <code>foo :: Bool -&gt; t</code> and <code>bar :: t -&gt; t</code>. I wonder how is GHC inferring the most general type of the function <code>bar</code>. Would you happen to know that?"}, {"owner": {"reputation": 1409, "user_id": 1213783, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fad673d01eb0a8048a1f6845bae66337?s=128&d=identicon&r=PG", "display_name": "Pierre Chambart", "link": "https://stackoverflow.com/users/1213783/pierre-chambart"}, "edited": false, "score": 1, "creation_date": 1429782334, "post_id": 29806802, "comment_id": 47765823, "body": "In your example bar is not recursive, its type can be inferred separately."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1429868750, "post_id": 29806802, "comment_id": 47814199, "body": "Haskell type checking starts by taking mutually recursive groups of definitions and dividing them into strongly connected components.  Each component is then treated on its own.  This gives more general types than treating the whole initial group at once.  (This isn&#39;t just for ghc, it&#39;s part of the Haskell spec.)"}], "tags": [], "owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "is_accepted": true, "score": 16, "last_activity_date": 1429729889, "creation_date": 1429729889, "answer_id": 29806802, "question_id": 29806121, "link": "https://stackoverflow.com/questions/29806121/how-to-type-check-recursive-definitions-using-algorithm-w/29806802#29806802", "title": "How to type check recursive definitions using Algorithm W?", "body": "<p>You could type check it using explicit recursion with a primitive <code>fix</code> having type <code>(a -&gt; a) -&gt; a</code>.  You can insert the fix by hand or automatically. </p>\n\n<p>If you want to extend the type inferences then that's quite easy too.  When encountering a recursive function f, just generate a new unification variable and put f with this type in the environment. After type checking the body, unify the body type with this variable and then generalize as usual.  I think this is what you suggest.  It will not allow you to infer polymorphic recursion, but this in general undecidable. </p>\n"}], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1380, "favorite_count": 5, "accepted_answer_id": 29806802, "answer_count": 1, "score": 18, "last_activity_date": 1429773840, "creation_date": 1429727692, "last_edit_date": 1429773840, "question_id": 29806121, "link": "https://stackoverflow.com/questions/29806121/how-to-type-check-recursive-definitions-using-algorithm-w", "title": "How to type check recursive definitions using Algorithm W?", "body": "<p>I am implementing <a href=\"http://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system#Algorithm_W\" rel=\"noreferrer\">Algorithm W</a> (the <a href=\"http://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system\" rel=\"noreferrer\">Hindley-Milner type system</a>) in JavaScript:</p>\n\n<p><img src=\"https://i.stack.imgur.com/QD3Fa.png\" alt=\"Algorithm W\"></p>\n\n<p>The function which implements the above rules is <code>typecheck</code> and it has the following signature:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>typecheck :: (Context, Expr) -&gt; Monotype\n</code></pre>\n\n<p>It is defined as follows:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>function typecheck(context, expression) {\n    switch (expression.type) {\n    case \"Var\":\n        var name = expression.name;\n        var type = context[name];\n        return inst(type);\n    case \"App\":\n        var fun = typecheck(context, expression.fun);\n        var dom = typecheck(context, expression.arg);\n        var cod = new Variable;\n        unify(fun, abs(dom, cod));\n        return cod;\n    case \"Abs\":\n        var param = expression.param;\n        var env   = Object.create(context);\n        var dom   = env[param] = new Variable;\n        var cod   = typecheck(env, expression.result);\n        return abs(dom, cod);\n    case \"Let\":\n        var assignments = expression.assignments;\n        var env = Object.create(context);\n\n        for (var name in assignments) {\n            var value = assignments[name];\n            var type  = typecheck(context, value);\n            env[name] = gen(context, type);\n        }\n\n        return typecheck(env, expression.result);\n    }\n}\n</code></pre>\n\n<p>A little bit about the data types:</p>\n\n<ol>\n<li><p>A context is an object which maps identifiers to polytypes.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type Context = Map String Polytype\n</code></pre></li>\n<li><p>An expression is defined by the following algebraic data type:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Expr = Var { name        :: String                          }\n          | App { fun         :: Expr,            arg    :: Expr }\n          | Abs { param       :: String,          result :: Expr }\n          | Let { assignments :: Map String Expr, result :: Expr }\n          | Rec { assignments :: Map String Expr, result :: Expr }\n</code></pre></li>\n</ol>\n\n<p>In addition, we have the following functions which are required by the algorithm but are not essential to the question:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>inst ::  Polytype -&gt; Monotype\nabs  :: (Monotype,   Monotype) -&gt; Monotype\ngen  :: (Context,    Monotype) -&gt; Polytype\n</code></pre>\n\n<p>The <code>inst</code> function specializes a polytype and the <code>gen</code> function generalizes a monotype.</p>\n\n<p>Anyway, I want to extend my <code>typecheck</code> function to allow <a href=\"http://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system#Recursive_definitions\" rel=\"noreferrer\">recursive definitions</a> as well:</p>\n\n<p><img src=\"https://i.stack.imgur.com/RbTCu.png\" alt=\"Recursive definitions\"></p>\n\n<p>Where:</p>\n\n<ol>\n<li><img src=\"https://i.stack.imgur.com/H6Jd0.png\" alt=\"Recursive definition context one\"></li>\n<li><img src=\"https://i.stack.imgur.com/CLYUG.png\" alt=\"Recursive definition context two\"></li>\n</ol>\n\n<p>However, I am stuck with a chicken and egg problem. Context number one has the assumptions <code>v_1 : \u03c4_1, ..., v_n : \u03c4_n</code>. Furthermore, it implies <code>e_1 : \u03c4_1, ..., e_n : \u03c4_n</code>. Hence, you first need to create the context in order to find the types of <code>e_1, ..., e_n</code> but in order to create the context you need to find the types of <code>e_1, ..., e_n</code>.</p>\n\n<p>How do you solve this problem? I was thinking of assigning new monotype variables to the identifiers <code>v_1, ..., v_n</code> and then unifying each monotype variable with its respective type. This is the method that OCaml uses for its <code>let rec</code> bindings. However, this method does not yield the most general type as is demonstrated by the following OCaml code:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>$\u00a0ocaml\n        OCaml version 4.02.1\n\n# let rec foo x = foo (bar true)     \n  and bar x = x;;\nval foo : bool -&gt; 'a = &lt;fun&gt;\nval bar : bool -&gt; bool = &lt;fun&gt;\n</code></pre>\n\n<p>However, GHC does compute the most general type:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>$ ghci\nGHCi, version 7.10.1: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; let foo x = foo (bar True); bar x = x\nPrelude&gt; :t foo\nfoo :: Bool -&gt; t\nPrelude&gt; :t bar\nbar :: t -&gt; t\n</code></pre>\n\n<p>As you can see, OCaml infers the type <code>val bar : bool -&gt; bool</code> while GHC infers the type <code>bar :: t -&gt; t</code>. How does Haskell infer the most general type of the function <code>bar</code>?</p>\n\n<p>I understand from @augustss' answer that type inference for recursive polymorphic functions is undecidable. For example, Haskell cannot infer the type of the following <code>size</code> function without additional type annotations:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Nested a = Epsilon | Cons a (Nested [a])\n\nsize Epsilon     = 0\nsize (Cons _ xs) = 1 + size xs\n</code></pre>\n\n<p>If we specify the type signature <code>size :: Nested a -&gt; Int</code> then Haskell accepts the program.</p>\n\n<p>However, if we only allow a subset of algebraic data types, <a href=\"https://en.wikipedia.org/wiki/Intuitionistic_type_theory#Inductive_types\" rel=\"noreferrer\">inductive</a> <a href=\"https://en.wikipedia.org/wiki/Induction-recursion_(type_theory)#The_Idea\" rel=\"noreferrer\">types</a>, then the data definition <code>Nested</code> becomes invalid because it is not inductive; and if I am not mistaken then the type inference of inductive polymorphic functions is indeed decidable. If so, then what is the algorithm used to infer the type of polymorphic inductive functions?</p>\n"}, {"tags": ["haskell", "matrix", "data-structures"], "comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1429726990, "post_id": 29805771, "comment_id": 47739664, "body": "The <a href=\"https://hackage.haskell.org/package/linear-1.18.0.1/docs/Linear-Matrix.html\" rel=\"nofollow noreferrer\">linear</a> package has some generic matrix operations expressed in terms of a handful of generic typeclasses, but I don&#39;t understand it well enough to explain how it works off-hand."}, {"owner": {"reputation": 965, "user_id": 229255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/588fe10267b620e1c0d0d188a8db2621?s=128&d=identicon&r=PG", "display_name": "Ian Ross", "link": "https://stackoverflow.com/users/229255/ian-ross"}, "edited": false, "score": 1, "creation_date": 1429728548, "post_id": 29805771, "comment_id": 47740616, "body": "If you want a simple &quot;Matlab in Haskell&quot; package, try <a href=\"http://hackage.haskell.org/package/hmatrix\" rel=\"nofollow noreferrer\">hmatrix</a> -- it has a pretty comprehensive and easy to understand API."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430521239, "post_id": 29806450, "comment_id": 48112246, "body": "I really just want a N-dimensional <b>convenient</b> data structure. That is, one which I can create a 3D tilemap, copy/paste blocks, modify bounded volumes, zip, map, filter, etc. REPA is really fast but is cumbersome to use. Array is very bad too. I can&#39;t, for example, use Linear&#39;s vectors to index those arrays. That sucks... I don&#39;t think any of those answers does it. :("}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430553295, "post_id": 29806450, "comment_id": 48118652, "body": "Ah. Well, perhaps you shouldn&#39;t have asked for <i>matrices</i> then... ...anyway, I think <code>array</code> is quite the right thing for your application, in particular you <i>can</i> use <code>linear</code>&#39;s <code>V</code> types to index them, since these have an <code>Ix</code> instance. What&#39;s your problem there?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430651505, "post_id": 29806450, "comment_id": 48144063, "body": "No idea how I can create multidimensional arrays with V and index them with V3 for example."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1430654005, "post_id": 29806450, "comment_id": 48144835, "body": "Like, <code>array (V2 0 0,V2 1 1) [(V2 0 0,1),(V2 0 1,2),(V2 1 0,2),(V2 1 1,3)] ! V2 1 0</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1429878426, "last_edit_date": 1429878426, "creation_date": 1429728710, "answer_id": 29806450, "question_id": 29805771, "link": "https://stackoverflow.com/questions/29805771/what-is-the-linguistic-way-to-program-matrices-on-haskell/29806450#29806450", "title": "What is the linguistic way to program matrices on Haskell?", "body": "<ul>\n<li><p>You mean, really just matrices (i.e. arrays with two index-dimensions)? Then <a href=\"http://hackage.haskell.org/package/hmatrix-0.16.1.5/docs/Numeric-LinearAlgebra-HMatrix.html\" rel=\"nofollow\">hmatrix</a> is probably the best fit for you. Its matrix type is little different from your <code>Vector</code> wrapper, and its interface really feels a lot like &ldquo;purely functional Matlab&rdquo; (a philosophy I personally can't abide, but oh well...) at any rate, you get efficient linear-algebra operations, slicing etc. through underlying GSL routines. Mind, this library does not really do stateful stuff, it keeps a purely-functional interface and relies on the optimisations of the built-in routines.</p></li>\n<li><p>You mean, general multi-dimensional arrays / tensors, are more interested in element-wise operations rather than linear algebra, and need stateful updates? Then the good old <a href=\"http://hackage.haskell.org/package/array-0.5.1.0/docs/Data-Array.html\" rel=\"nofollow\">array</a> library might be just right. It seems to have been somewhat eclipsed by <code>vector</code> and <code>repa</code> over the last years, but IMO, the <code>Data.Ix</code> indexing paradigm is actually pretty nice. Sort of a less mature, but also less &ldquo;overengineered&rdquo; version of <code>repa</code>.</p></li>\n<li><p>If you're actually <em>mostly</em> interested in linear algebra, then you should at least check out some of the more abstract libraries. I really like the <a href=\"http://hackage.haskell.org/package/vector-space-0.10.2\" rel=\"nofollow\">vector-space</a> interface, which is very general and mathematical, it completely eschews writing operations in a particular basis, which does a lot to catch &ldquo;mathematical bugs&rdquo;.</p></li>\n<li><p>And while you mention <code>lens</code>es, there is the <a href=\"http://hackage.haskell.org/package/linear\" rel=\"nofollow\">linear</a> &ndash; which is elegant and abstract in a different way. IMO it misses the point of linearity a bit (mathematically), but it's still pretty cool and definitely offers more operations than <code>vector-space</code>.</p></li>\n<li><p>Oh, and, finally, there's <a href=\"http://hackage.haskell.org/package/matrix-0.3.4.3/docs/Data-Matrix.html\" rel=\"nofollow\">matrix</a>. It's quite of similar to <code>hmatrix</code>, but implemented in native Haskell rather than GSL bindings, which means that it's not so rich in highly-optimised LA algorithms, but also not such a heavy dependency. Apart from that, it appears to be slightly more elegant.</p></li>\n</ul>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "accepted_answer_id": 29806450, "answer_count": 1, "score": 3, "last_activity_date": 1429878426, "creation_date": 1429726523, "last_edit_date": 1429726903, "question_id": 29805771, "link": "https://stackoverflow.com/questions/29805771/what-is-the-linguistic-way-to-program-matrices-on-haskell", "title": "What is the linguistic way to program matrices on Haskell?", "body": "<p>As simple as this should be, whenever I need to use matrices on Haskell, I struggle. My strategy is to chose a concrete type (REPA, Vector, List, IntMap, etc) and program for it. For example, I used REPA to solve Euler's <a href=\"https://projecteuler.net/problem=11\" rel=\"nofollow\">problem 11</a>, and I often use it on marathons. Unfortunately, REPA isn't a particularly friendly API - it requires complicate type annotations, thinking about the representation and tracking it, converting it around... also, indices are reversed. All that means I spend a good amount of time just looking at the docs and trying to align the types correctly, which is deadly when you are in a marathon. </p>\n\n<p>I could just use vectors/lists, but that is, too, awkward, since then I need to use <code>toIndex :: [Int] \u2192 Int; fromIndex Int \u2192 [Int]</code> functions every time I index the vector. </p>\n\n<p>I also tried creating a wrapper for Data.Vector such as <code>data Matrix a = Matrix { shape :: [a], buffer :: Vector a }</code>, but soon I noticed I also had to create a wrapper for every single vector function, and different types to match with mutable vectors and so on, and it was a mess.</p>\n\n<p>In the end, all I need is a simple way to deal with matrices - something like:</p>\n\n<pre><code>matrix = Matrix.fromList [3,3] [1,2,3,4,5,6,7,8,9]\nmain = do\n    matrix' &lt;- set matrix [1,1] 0\n    print $ get matrix [1,1]\n    print $ sum matrix\n</code></pre>\n\n<p>Or anything else that lets me just think about matrices as mathematical objects and not a concrete implementation, but I failed to find a simple linguistic way. How would you do it? I wonder if Lens can help somehow?</p>\n"}, {"tags": ["xml", "haskell", "hxt"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1429726468, "post_id": 29805202, "comment_id": 47739345, "body": "It might be better to reformulate it as <code>baz :: M.Map String Int -&gt; a (String, XmlTree) (Maybe Int, XmlTree)</code> and <code>foo :: a (Maybe Int, XmlTree) XmlTree</code>, or possibly some extra arrow between that gets rid of the <code>Maybe</code> problem.  Then you just have <code>bar &amp;&amp;&amp; arr id &gt;&gt;&gt; baz m &gt;&gt;&gt; foo</code>, which is much more readable.  Basically, if your inputs are coming from arrows, pass those values around using arrows.  At this point it&#39;s probably going to be worth learning the <code>proc</code> notation or it&#39;ll be even more difficult."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1429726734, "post_id": 29805202, "comment_id": 47739495, "body": "@bheklilr, I&#39;ve read HXT wiki, a paper called &quot;Programming with Arrows&quot;, but it&#39;s still difficult to come up with idiomatic arrow code sometimes. Maybe <code>proc</code> notation can help. Thanks for the comment, feel free to add it as an answer if you like."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1429733288, "post_id": 29805202, "comment_id": 47743673, "body": "Arrows are not particularly easy to work with in my experience.  They&#39;re weird, there aren&#39;t as many good tutorials for them, and they make the most intuitive sense when treated as functions, but all the really interesting arrows aren&#39;t.  On top of that there&#39;s a lot of <code>Arrow*</code> classes that implement more functionality on top of the basic arrows.  I can&#39;t say that I feel confident working with arrows yet, but I know the basics of how they work and how to use them.  While my answer below looks nice, it took me more than a few minutes to get it working!"}], "answers": [{"comments": [{"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1429764633, "post_id": 29807329, "comment_id": 47755400, "body": "Great answer, thank you very much! I only can add that <code>this</code> seems to be preferred in HXT, it&#39;s one more synonym for <code>returnA</code> and <code>arr id</code>."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1429765088, "post_id": 29807329, "comment_id": 47755539, "body": "I understand that we need <code>Arrows</code> language extension for <code>proc</code> notation, but what about <code>NoMonomorphismRestriction</code>? Why exactly it&#39;s needed here?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1429765323, "post_id": 29807329, "comment_id": 47755624, "body": "@Mark it was recommended in the docs at some point and I figured it couldn&#39;t hurt. You might be able to get away without it."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1430554835, "post_id": 29807329, "comment_id": 48118992, "body": "I&#39;ve added another solution, which I believe is more idiomatic for HXT."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 2, "last_activity_date": 1429764510, "last_edit_date": 1429764510, "creation_date": 1429731746, "answer_id": 29807329, "question_id": 29805202, "link": "https://stackoverflow.com/questions/29805202/hxt-how-to-use-output-of-an-arrow-as-function-argument/29807329#29807329", "title": "HXT: How to use output of an arrow as function argument?", "body": "<p>If you reformulate your type signatures a bit you can get this to line up pretty well.  Since you have values coming from the result of an arrow in <code>baz</code> affecting the behavior of <code>foo</code>, those values need to be fed to <code>foo</code> using the arrow instead of as a typical argument.  This actually simplifies things a lot, but I'll recommend creating a <code>foo</code>, then a <code>fooWrapper</code> that handles the decision itself.  With the correct types you'd have</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE Arrows, NoMonomorphismRestriction #-}\n\nimport qualified Data.Map as M\nimport Control.Arrow.ArrowTree\nimport Text.XML.HXT.Core\n\nfoo :: ArrowXml a =&gt; a (Int, XmlTree) XmlTree\nfoo = undefined\n\nbar :: ArrowXml a =&gt; a XmlTree String\nbar = undefined\n</code></pre>\n\n<p>Then for <code>baz</code>, it should be expecting both an <code>XmlTree</code> and the <code>String</code> input from <code>bar</code>, so it's arrow type needs to be <code>a (String, XmlTree) something</code>, and here I found it simplest to implement it as</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>baz :: ArrowXml a =&gt; M.Map String Int -&gt; a (String, XmlTree) (Maybe Int, XmlTree)\nbaz m = first $ arr $ flip M.lookup m\n</code></pre>\n\n<p>All this arrow is doing is converting the <code>String</code> into a lookup on the passed in <code>M.Map</code> (assuming this is given in the general environment already).  Then we need a wrapper to feed <code>(Maybe Int, XmlTree)</code> into <code>(Int, XmlTree)</code> if and only if the <code>Maybe Int</code> is a <code>Just something</code>.  Here is where the arrow syntax really comes in handy.  Since we're making a decision here it also requires that our arrow be an <code>ArrowChoice</code>, so</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>fooWrapper :: (ArrowXml a, ArrowChoice a) =&gt; a (Maybe Int, XmlTree) XmlTree\nfooWrapper = proc (lkup, tree) -&gt; do\n    case lkup of\n        Nothing -&gt; returnA -&lt; tree\n        Just v  -&gt; foo -&lt; (v, tree)\n</code></pre>\n\n<p>Now we can tie everything together into an overall application with nothing more than the built-in combinators (I also discovered that <code>returnA = arr id</code>, so you can use that instead, I just think it's easier to understand with <code>arr id</code>)</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>program :: (ArrowXml a, ArrowChoice a) =&gt; M.Map String Int -&gt; a XmlTree XmlTree\nprogram m =\n    bar &amp;&amp;&amp; arr id &gt;&gt;&gt; -- First split the input between bar and arr id\n    baz m          &gt;&gt;&gt; -- Feed this into baz m\n    fooWrapper         -- Feed the lookup into fooWrapper so it can make the\n                       -- decision on how to route the XmlTree\n</code></pre>\n\n<p>You don't need to worry about the <code>ArrowChoice</code> constraint, all the <code>ArrowXml</code> instances brought in scope from <code>Text.XML.HXT.Core</code> also implement <code>ArrowChoice</code>.</p>\n\n<p>If you're curious as to what this would look like without <code>proc</code> notation, even this simple case statement would get turned into (I think)</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>fooWrapper :: (ArrowXml a, ArrowChoice a) =&gt; a (Maybe Int, XmlTree) XmlTree\nfooWrapper =\n    arr (\\(lkup, tree) -&gt; case lkup of\n        Nothing -&gt; Left tree\n        Just v  -&gt; Right (v, tree)) &gt;&gt;&gt;\n    (returnA ||| foo)\n</code></pre>\n\n<p>The use of <code>|||</code> is what forces it to implement <code>ArrowChoice</code>.  While this isn't too bad, I wouldn't exactly call it readable and there is too much going on that doesn't really have anything to do with the actual business logic.  Once you move on to more complex situations this is going to explode in complexity as well, while the <code>proc</code> notation should remain relatively simple.</p>\n"}, {"tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": true, "score": 1, "last_activity_date": 1430554741, "creation_date": 1430554741, "answer_id": 30000014, "question_id": 29805202, "link": "https://stackoverflow.com/questions/29805202/hxt-how-to-use-output-of-an-arrow-as-function-argument/30000014#30000014", "title": "HXT: How to use output of an arrow as function argument?", "body": "<p>I took me some time to understand how to accomplish this, because when your\narrow has type like <code>a (b, XmlTree) XmlTree</code>, you can really use it, because\nof type conflicts with the rest of the API.</p>\n\n<p>Here is another solution that seems to be more idiomatic:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>baz :: ArrowXml a =&gt; M.Map String Int -&gt; a XmlTree XmlTree\nbaz m = maybe this foo $&lt; (bar &gt;&gt;&gt; arr (`M.lookup` m))\n</code></pre>\n\n<p>All the magic happens because of\n<a href=\"http://hackage.haskell.org/package/hxt-9.3.1.15/docs/Control-Arrow-ArrowList.html#v:-36--60-\" rel=\"nofollow\"><code>($&lt;)</code></a>\nfunction. From the documentation:</p>\n\n<blockquote>\n  <p>compute the parameter for an arrow with extra parameters from the input\n  and apply the arrow for all parameter values to the input</p>\n</blockquote>\n\n<p>See also this section of HXT Wiki: <a href=\"https://wiki.haskell.org/HXT#Transform_external_references_into_absolute_references\" rel=\"nofollow\">8.2 Transform external references into\nabsolute\nreferences</a>.</p>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 30000014, "answer_count": 2, "score": 2, "last_activity_date": 1430554741, "creation_date": 1429724672, "last_edit_date": 1429736188, "question_id": 29805202, "link": "https://stackoverflow.com/questions/29805202/hxt-how-to-use-output-of-an-arrow-as-function-argument", "title": "HXT: How to use output of an arrow as function argument?", "body": "<p>It's very difficult to give good title to this question\u2026 I'm stuck with HXT\nagain. I understand what I want to do, but I'm not sure how to make it play\nnicely with arrows. Here I give simplified description of the problem.</p>\n\n<p>Function <code>foo</code> takes an <code>Int</code> and returns an arrow:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foo :: ArrowXml a =&gt; Int -&gt; a XmlTree XmlTree\n</code></pre>\n\n<p>Function <code>bar</code> extracts value of some attribute:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>bar :: ArrowXml a =&gt; a XmlTree String\n</code></pre>\n\n<p>Now, I need to write <code>baz</code> that takes a map from <code>String</code>s to <code>Int</code>s and\nreturns an arrow:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import qualified Data.Map.Lazy as M\n\nbaz :: ArrowXml a =&gt; M.Map String Int -&gt; a XmlTree XmlTree\n</code></pre>\n\n<p>Logic of <code>baz</code>: extract value of the attribute with <code>bar</code> and look up it in\nthe map. If <code>M.lookup</code> returns <code>Just x</code>, invoke <code>foo x</code>, otherwise don't do\nanything (input of the arrow goes through unchanged).</p>\n\n<p>AFAIK every such an arrow works as a filter, so in reality <code>ArrowXml a =&gt; a\nXmlTree String</code> type means that it takes a <code>XmlTree</code> and returns (possibly\nempty) list of <code>String</code>s. This makes me reformulate logic of <code>baz</code>. For\ngiven input <code>XmlTree</code> there may be many strings, every string should be used\nto look up an integer and first found integer should be passed to <code>foo</code>. If\nall of them result in <code>Nothing</code>, don't do anything.</p>\n\n<p>Here what I've come up with:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>baz :: ArrowXml a =&gt; M.Map String Int -&gt; a XmlTree XmlTree\nbaz m = this &amp;&amp;&amp; (bar &gt;&gt;&gt; arr (`M.lookup` m)) &gt;&gt;&gt; arr (uncurry f)\n    where f xml Nothing  = xml\n          f xml (Just x) = foo x xml\n-- compiler says:          ^^^ not so fast, boy\n\nCould not deduce (ArrowXml (-&gt;)) arising from a use of \u2018foo\u2019\nfrom the context (ArrowXml a)\n  bound by the type signature for\n             baz :: ArrowXml a =&gt; M.Map String Int -&gt; a XmlTree XmlTree\n</code></pre>\n\n<p>Not only compiler doesn't like it, but it's difficult to reason about too.</p>\n"}, {"tags": ["haskell", "monads", "do-notation"], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 6, "last_activity_date": 1429724929, "creation_date": 1429724929, "answer_id": 29805293, "question_id": 29804823, "link": "https://stackoverflow.com/questions/29804823/understanding-do-notation-and-bindings/29805293#29805293", "title": "understanding do notation and bindings", "body": "<p>The <code>Parser</code> type wraps up a function that can 1) represent failure using <code>Maybe</code> and 2) returns the remaining text that was not parsed through <code>(a, String)</code> along with 3) some value <code>a</code> that was parsed, which can be anything.  The monad instance is the plumbing to tie them together.  The <code>return</code> implementation creates a <code>Parser</code> around a function that 1) succeeds with <code>Just</code> something, 2) does not modify its input text, and 3) directly passes the value given to it.  The <code>&gt;&gt;=</code> implementation takes a parser and a function, then returns a new parser created by first running the <code>p</code>, then based on whether that result passed or failed running <code>f</code>.</p>\n\n<p>In <code>takeThreeDropSecond</code>, first <code>c1 &lt;- item</code> says \"parse the given using <code>item</code>, assign its result to <code>c1</code>, and feed the rest of the input forward\".  This does not assign the function inside the <code>item</code> parser to <code>c1</code>, it assigns the result of running the function inside <code>item</code> against the current input.  Then you reach <code>item</code>, which parses a value using <code>item</code>, doesn't assign it to anything, and feeds the rest of the input forward.  Next you reach <code>c2 &lt;- item</code>, which does basically the same thing as the first line, and finally <code>return (c1, c2)</code>, which would expand to <code>Parser (\\cs -&gt; Just ((c1, c2), cs))</code>.  This means that <code>return (c1, c2)</code> has the type <code>Parser (Char, Char)</code>.  With type annotations it would be</p>\n\n<pre><code>takeThreeDropSecond :: Parser (Char, Char)\ntakeThreeDropSecond = do\n    (c1 :: Char) &lt;- (item :: Parser Char)\n    (item :: Parser Char)\n    (c2 :: Char) &lt;- (item :: Parser Char)\n    (return (c1, c2) :: Parser (Char, Char))\n</code></pre>\n\n<p>Note that the last line of any monadic do block must have the same type as the function it is a member of.  Since <code>return (c1, c2)</code> has type <code>Parser (Char, Char)</code>, so must <code>takeThreeDropSecond</code>, and vice-versa.</p>\n"}], "owner": {"reputation": 11202, "user_id": 886669, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c56f1eac6c5b31b32bdffa4f741f3aed?s=128&d=identicon&r=PG", "display_name": "yasar", "link": "https://stackoverflow.com/users/886669/yasar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 29805293, "answer_count": 1, "score": 1, "last_activity_date": 1429736145, "creation_date": 1429723552, "last_edit_date": 1429736145, "question_id": 29804823, "link": "https://stackoverflow.com/questions/29804823/understanding-do-notation-and-bindings", "title": "understanding do notation and bindings", "body": "<p>I am very new to haskell and I am trying to understand the methodology used to create Monadic parser in this document <a href=\"https://www.cs.nott.ac.uk/~gmh/pearl.pdf\" rel=\"nofollow\">https://www.cs.nott.ac.uk/~gmh/pearl.pdf</a></p>\n\n<p>Instead of following it exactly, I am trying to do it a little bit differently in order to understand it correctly, therefore, I ended up with this code</p>\n\n<pre><code>newtype Parser a = Parser (String -&gt; Maybe (a, String))\n\nitem :: Parser Char\nitem = Parser (\\cs -&gt; case cs of\n            \"\" -&gt; Nothing\n            (c:cs) -&gt; Just (c, cs))\n\ngetParser (Parser x) = x\n\ninstance Monad Parser where\n    return x = Parser (\\cs -&gt; Just (x,cs))\n    (Parser p) &gt;&gt;= f  = Parser (\\cs -&gt; let result = p cs in\n                  case result of\n                    Nothing -&gt; Nothing\n                    Just (c,cs') -&gt; getParser (f c) cs')\n\ntakeThreeDropSecond :: Parser (Char, Char)\ntakeThreeDropSecond = do\n    c1 &lt;- item\n    item\n    c2 &lt;- item\n    return (c1, c2)\n</code></pre>\n\n<p>This seems to be working, but I am having hard time following what is going on in do notation.</p>\n\n<p>For example; in <code>c1 &lt;- item</code>, what is assigned to <code>c1</code>? Is it the function that is contained in <code>Parser</code> type, or result of that computation, or what else? Moreover, second line in do notation is just <code>item</code>, so does it just run <code>item</code> but doesn't assign the result? And finally, what does <code>return (c1,c2)</code> produce? Is it <code>Parser (String -&gt; Maybe ((c1, c2)), String)</code> or just <code>Just (c1, c2)</code>?</p>\n"}, {"tags": ["haskell", "input", "io"], "answers": [{"comments": [{"owner": {"reputation": 12058, "user_id": 205756, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c43a4d8967538063b38e41f4559a975?s=128&d=identicon&r=PG", "display_name": "alternative", "link": "https://stackoverflow.com/users/205756/alternative"}, "edited": false, "score": 1, "creation_date": 1429754501, "post_id": 29803755, "comment_id": 47752430, "body": "Even more so, I don&#39;t think <code>wantReadableHandle_</code> is really a function you want to be using, so looking at the implementation is completely useless. Do note, however, that he was talking about <code>hGetLine</code> from <code>Data.Text.IO</code>, not the standard library."}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "reply_to_user": {"reputation": 12058, "user_id": 205756, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c43a4d8967538063b38e41f4559a975?s=128&d=identicon&r=PG", "display_name": "alternative", "link": "https://stackoverflow.com/users/205756/alternative"}, "edited": false, "score": 0, "creation_date": 1429777228, "post_id": 29803755, "comment_id": 47762085, "body": "@alternative You&#39;re correct on all accounts! I completely missed the Text type signature. Silly me. Same process applies, though."}], "tags": [], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "is_accepted": false, "score": 6, "last_activity_date": 1429720432, "creation_date": 1429720432, "answer_id": 29803755, "question_id": 29803664, "link": "https://stackoverflow.com/questions/29803664/haskell-hgetlines-implementation/29803755#29803755", "title": "haskell hGetLines implementation", "body": "<ol>\n<li><p>Find it on Hackage: <a href=\"https://hackage.haskell.org/package/base-4.6.0.1/docs/System-IO.html#v:hGetLine\">https://hackage.haskell.org/package/base-4.6.0.1/docs/System-IO.html#v:hGetLine</a></p></li>\n<li><p>Click the \"source\" link: <a href=\"https://hackage.haskell.org/package/base-4.6.0.1/docs/src/GHC-IO-Handle-Text.html#hGetLine\">https://hackage.haskell.org/package/base-4.6.0.1/docs/src/GHC-IO-Handle-Text.html#hGetLine</a></p></li>\n<li><p>Read source:</p>\n\n<pre><code>hGetLine h =\n  wantReadableHandle_ \"hGetLine\" h $ \\ handle_ -&gt; do\n    hGetLineBuffered handle_\n</code></pre></li>\n</ol>\n\n<p>But if you want to write a <code>hGetLines</code> function, you don't need to know how <code>hGetLine</code> is implemented. You can just use <code>hGetLine</code> in your implementation of <code>hGetLines</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 1, "last_activity_date": 1429779588, "creation_date": 1429779588, "answer_id": 29818537, "question_id": 29803664, "link": "https://stackoverflow.com/questions/29803664/haskell-hgetlines-implementation/29818537#29818537", "title": "haskell hGetLines implementation", "body": "<p>You don't need to know how <code>hGetLine</code> is implemented to do this:</p>\n\n<pre><code>hGetLines :: Handle -&gt; IO [Text]\nhGetLines h = do\n  line &lt;- hGetLine h\n  if null line\n    then return []\n    else do\n      lines &lt;- hGetLines h\n      return (line:lines)\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 4676799, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-y648oz0HCX0/AAAAAAAAAAI/AAAAAAAAAN0/xL7ihGVzOjI/photo.jpg?sz=128", "display_name": "Cristian Balint", "link": "https://stackoverflow.com/users/4676799/cristian-balint"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 0, "accepted_answer_id": 29818537, "answer_count": 2, "score": 0, "last_activity_date": 1429779588, "creation_date": 1429720186, "question_id": 29803664, "link": "https://stackoverflow.com/questions/29803664/haskell-hgetlines-implementation", "title": "haskell hGetLines implementation", "body": "<p>Does anyone know where can I find the</p>\n\n<pre><code>hGetLine :: Handle -&gt; IO Text\n</code></pre>\n\n<p>function implementation? I have to implement a HTTP server in haskell which has multiple subtasks. The first one is to write the implementation of a </p>\n\n<pre><code>hGetLines :: Handle -&gt; IO [Text]\n</code></pre>\n\n<p>function which reads everything from the IO channel until the first empty line and the lines are returned as a list of Text.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1429721551, "post_id": 29803575, "comment_id": 47735989, "body": "What\u2019s your version of GHC resp. base? I believe the use of <code>Data.Coerce.coerce</code> is a new one."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1429779717, "post_id": 29803575, "comment_id": 47763812, "body": "The identity functor is like the identity function &amp;mdash; it does nothing. That sounds completely useless, but actually turns out not to be&amp;hellip;"}], "answers": [{"comments": [{"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 1, "creation_date": 1429751648, "post_id": 29803887, "comment_id": 47751545, "body": "Identity is also a monad"}], "tags": [], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "is_accepted": false, "score": 5, "last_activity_date": 1429720891, "creation_date": 1429720891, "answer_id": 29803887, "question_id": 29803575, "link": "https://stackoverflow.com/questions/29803575/what-does-exactly-identity-functor-do/29803887#29803887", "title": "What does exactly Identity functor do?", "body": "<p>Where did you find that functor instance for <code>Identity</code>? This is the one I find in <code>Data.Functor.Identity</code>:</p>\n\n<pre><code>newtype Identity a = Identity { runIdentity :: a }\n\ninstance Functor Identity where\n  fmap f m = Identity (f (runIdentity m))\n</code></pre>\n\n<p>But as to what it does... it does absolutely nothing, and that's intentional. <code>fmap f (Idendity x)</code> is the same thing as <code>Idendity (f x)</code>. It just applies the function to the value it contains.</p>\n\n<p>Why would you want to have a functor that doesn't do anything? If your function requires a functor, but you only have a regular non-functor value, you can wrap your value in <code>Identity</code> and pass it in and it will behave correctly. It's basically a layer of wrapping just to satisfy the typechecker.</p>\n"}, {"comments": [{"owner": {"reputation": 1359, "user_id": 3346496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1230f0444613f0e8d74e5a71439d1e?s=128&d=identicon&r=PG&f=1", "display_name": "monocell", "link": "https://stackoverflow.com/users/3346496/monocell"}, "edited": false, "score": 0, "creation_date": 1429771372, "post_id": 29806013, "comment_id": 47758460, "body": "Searching for zero cost coercions leads to a very nice talk by spj himself on this issue."}], "tags": [], "owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "is_accepted": true, "score": 9, "last_activity_date": 1429727338, "creation_date": 1429727338, "answer_id": 29806013, "question_id": 29803575, "link": "https://stackoverflow.com/questions/29803575/what-does-exactly-identity-functor-do/29806013#29806013", "title": "What does exactly Identity functor do?", "body": "<p>The use of <code>coerce</code> is new in GHC 7.10 and is done for efficiency. The \"real\" definition is</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; (Identity a -&gt; Identity b)\nfmap f (Identity a) = Identity (f a)\n</code></pre>\n\n<p>The wrapping/unwrapping of the <code>Identity</code> constructor should be optimized away at compile time, but it seems like the <code>base</code> devs had reason to ensure that there is no performance penalty by using <code>coerce</code>.</p>\n\n<p>The reason we can use <code>coerce</code> is that <code>Identity a</code> is isomorphic to (the same as) <code>a</code>, so we can coerce <code>a -&gt; b</code> to <code>Identity a -&gt; Identity b</code> which happens to be the definition of <code>fmap</code> specialized to <code>Identity</code>!</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 986, "favorite_count": 0, "accepted_answer_id": 29806013, "answer_count": 2, "score": 3, "last_activity_date": 1429727338, "creation_date": 1429719943, "question_id": 29803575, "link": "https://stackoverflow.com/questions/29803575/what-does-exactly-identity-functor-do", "title": "What does exactly Identity functor do?", "body": "<p>It may be trivial, but I don't understand what does the following mean. </p>\n\n<pre><code>instance Functor Identity where\n    fmap     = coerce\n</code></pre>\n\n<p>So, I can try to define something similar:</p>\n\n<pre><code>Prelude Control.Lens Data.Functor.Identity&gt; :t fmap\nfmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nPrelude Control.Lens Data.Functor.Identity&gt; let z f g = coerce f g\nPrelude Control.Lens Data.Functor.Identity&gt; :t z\nz :: Contravariant ((-&gt;) t) =&gt; (t -&gt; a) -&gt; t -&gt; b\n</code></pre>\n\n<p>But, what does it mean in simpler terms?</p>\n"}, {"tags": ["haskell", "rounding", "monads"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1429717207, "post_id": 29801967, "comment_id": 47732903, "body": "<code>fmap :: (a -&gt; b) -&gt; (IO a -&gt; IO b)</code> is possible."}, {"owner": {"reputation": 3366, "user_id": 1756750, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/db2912f03e4de7e109367b40f874fea6?s=128&d=identicon&r=PG", "display_name": "Denis", "link": "https://stackoverflow.com/users/1756750/denis"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1429717398, "post_id": 29801967, "comment_id": 47733055, "body": "@AJFarmar, yep, I got it."}], "answers": [{"tags": [], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "is_accepted": true, "score": 3, "last_activity_date": 1429716389, "creation_date": 1429716389, "answer_id": 29802158, "question_id": 29801967, "link": "https://stackoverflow.com/questions/29801967/round-io-double-to-specified-number-of-digits-haskell/29802158#29802158", "title": "Round IO Double to specified number of digits - Haskell", "body": "<p>What you are asking for can't be had. The test cases you've written are for the function</p>\n\n<pre><code>tensRound :: Double -&gt; Double\n</code></pre>\n\n<p>but the type signature you wrote is for the function</p>\n\n<pre><code>ownRound :: IO Double -&gt; IO Double\n</code></pre>\n\n<p>If you meant to write your test cases as</p>\n\n<pre><code>ownRound (return 0.51) == return 0.5\nownRound (return 0.49) == return 0.5\n</code></pre>\n\n<p>and so on, where every number is wrapped into IO, then these implementations would work:</p>\n\n<pre><code>tensRound :: Double -&gt; Double\ntensRound d = fromInteger (round (d*10)) / 10\n\nownRound :: IO Double -&gt; IO Double\nownRound = fmap tensRound\n</code></pre>\n"}], "owner": {"reputation": 3366, "user_id": 1756750, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/db2912f03e4de7e109367b40f874fea6?s=128&d=identicon&r=PG", "display_name": "Denis", "link": "https://stackoverflow.com/users/1756750/denis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "accepted_answer_id": 29802158, "answer_count": 1, "score": 0, "last_activity_date": 1429716389, "creation_date": 1429715850, "question_id": 29801967, "link": "https://stackoverflow.com/questions/29801967/round-io-double-to-specified-number-of-digits-haskell", "title": "Round IO Double to specified number of digits - Haskell", "body": "<p>Is there a way to round <code>IO Double</code>? I looking for a function:</p>\n\n<pre><code>ownRound :: IO Double -&gt; IO Double\n</code></pre>\n\n<p>with these Unit tests:</p>\n\n<pre><code>ownRound 0.51 == 0.5\nownRound 0.49 == 0.5\nownRound 0.5 == 0.5\nownRound 0.7132 == 0.7\nownRound 0.39 == 0.4\n</code></pre>\n"}, {"tags": ["haskell", "noise", "perlin-noise"], "answers": [{"tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": false, "score": 3, "last_activity_date": 1429717236, "last_edit_date": 1429717236, "creation_date": 1429711087, "answer_id": 29799870, "question_id": 29799536, "link": "https://stackoverflow.com/questions/29799536/integer-to-noise-function-in-haskell/29799870#29799870", "title": "integer to noise function in Haskell", "body": "<p>Your error is</p>\n\n<pre><code>n = (shiftR m 13) `xor` m\n                  ^^^^^\n</code></pre>\n\n<p>(Instead of the power function <code>(^)</code>)</p>\n"}, {"comments": [{"owner": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "edited": false, "score": 0, "creation_date": 1429711323, "post_id": 29799890, "comment_id": 47728020, "body": "Yes that&#39;s it! Look&#39;s like I need to brush up my C, thank you!"}], "tags": [], "owner": {"reputation": 558, "user_id": 4751430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f424b8d7abc1bd4adaf69ca95412f3a?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Huschenbett", "link": "https://stackoverflow.com/users/4751430/martin-huschenbett"}, "is_accepted": true, "score": 5, "last_activity_date": 1429711119, "creation_date": 1429711119, "answer_id": 29799890, "question_id": 29799536, "link": "https://stackoverflow.com/questions/29799536/integer-to-noise-function-in-haskell/29799890#29799890", "title": "integer to noise function in Haskell", "body": "<p>The problem stems from your use of the <code>^</code>-operator. In C it is bitwise exclusive disjunction (xor), whereas in Haskell it is exponentiation. So, you just need to change the fourth line to</p>\n\n<pre><code>        n = (shiftR m 13) `xor` m\n</code></pre>\n\n<p>and everything should be fine.</p>\n"}], "owner": {"reputation": 304, "user_id": 4801494, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/w61dU.jpg?s=128&g=1", "display_name": "fayong lin", "link": "https://stackoverflow.com/users/4801494/fayong-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 1, "accepted_answer_id": 29799890, "answer_count": 2, "score": 1, "last_activity_date": 1429717236, "creation_date": 1429710308, "question_id": 29799536, "link": "https://stackoverflow.com/questions/29799536/integer-to-noise-function-in-haskell", "title": "integer to noise function in Haskell", "body": "<p>I am trying to implement a basic perlin noise function (I know there is a library that does just that, I just want to try my own), and I have some problem with the integer to noise function used to generate deterministic noise from integer inputs.</p>\n\n<p>the function I am trying to implement is defined there:\n<a href=\"http://libnoise.sourceforge.net/noisegen/index.html#continuousnoise\" rel=\"nofollow\">http://libnoise.sourceforge.net/noisegen/index.html#continuousnoise</a></p>\n\n<p>and my code so far look like this:</p>\n\n<pre><code>noise2d :: (Int32, Int32) -&gt; Double\nnoise2d (x, y) =\n    let m = x + y * 57\n        n = (shiftR m 13) ^ m\n        j = (n * (n * n * 15731 + 789221) + 1376312589) .&amp;. 0x7fffffff\n    in  1.0 - (fromIntegral j / 1073741824.0)\n</code></pre>\n\n<p>the code compile but I get the same result for any input, due to the fact that n is evaluated to 0.</p>\n\n<p>Is there a better way to do that?</p>\n"}, {"tags": ["json", "haskell", "bytestring", "aeson"], "comments": [{"owner": {"reputation": 897, "user_id": 1755520, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mqzKa.jpg?s=128&g=1", "display_name": "bartavelle", "link": "https://stackoverflow.com/users/1755520/bartavelle"}, "edited": false, "score": 0, "creation_date": 1429704868, "post_id": 29795776, "comment_id": 47722541, "body": "Looks to me like a build issue. I would guess that the compiler is trying to use lazy ByteStrings from two distinct packages, not sure how that could happen."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4201880"}, "reply_to_user": {"reputation": 897, "user_id": 1755520, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mqzKa.jpg?s=128&g=1", "display_name": "bartavelle", "link": "https://stackoverflow.com/users/1755520/bartavelle"}, "edited": false, "score": 0, "creation_date": 1429705403, "post_id": 29795776, "comment_id": 47722985, "body": "You&#39;re the second person who has suggested this could be the issue? Any ideas how I could resolve this?  Thanks."}, {"owner": {"reputation": 976, "user_id": 1274282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nBRxs.png?s=128&g=1", "display_name": "Taylor Fausak", "link": "https://stackoverflow.com/users/1274282/taylor-fausak"}, "edited": false, "score": 0, "creation_date": 1429707504, "post_id": 29795776, "comment_id": 47724757, "body": "You could try using <a href=\"https://www.haskell.org/cabal/users-guide/installing-packages.html#developing-with-sandboxes\" rel=\"nofollow noreferrer\">Cabal sandboxes</a>."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4201880"}, "edited": false, "score": 0, "creation_date": 1429706813, "post_id": 29797809, "comment_id": 47724172, "body": "Problem is it breaks aeson and a load of other packages :("}], "tags": [], "owner": {"reputation": 121, "user_id": 1781815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab0b878bcf73c8f016480de339a88154?s=128&d=identicon&r=PG", "display_name": "danplubell", "link": "https://stackoverflow.com/users/1781815/danplubell"}, "is_accepted": false, "score": 2, "last_activity_date": 1429706212, "creation_date": 1429706212, "answer_id": 29797809, "question_id": 29795776, "link": "https://stackoverflow.com/questions/29795776/haskell-json-issue/29797809#29797809", "title": "Haskell JSON Issue", "body": "<p>It looks like there are multiple versions of the bytestring package installed.\nYou can use the following command to find the bytestring packages:</p>\n\n<p>ghc-pkg list bytestring </p>\n\n<p>If there are more than one installed then the following could solve the problem:</p>\n\n<p>ghc-pkg unregister </p>\n\n<p>Or,</p>\n\n<p>build with ghc --make --hide-package </p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4201880"}, "edited": false, "score": 0, "creation_date": 1429710264, "post_id": 29799368, "comment_id": 47727069, "body": "I like the term Cabal Hell. I will give it a go and get back to you. Thanks."}], "tags": [], "owner": {"reputation": 842, "user_id": 4737779, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/009c3f05f9273268e5d530785ef14327?s=128&d=identicon&r=PG&f=1", "display_name": "Beerend Lauwers", "link": "https://stackoverflow.com/users/4737779/beerend-lauwers"}, "is_accepted": false, "score": 0, "last_activity_date": 1429709942, "creation_date": 1429709942, "answer_id": 29799368, "question_id": 29795776, "link": "https://stackoverflow.com/questions/29795776/haskell-json-issue/29799368#29799368", "title": "Haskell JSON Issue", "body": "<p>Ah. This is known as <a href=\"https://wiki.haskell.org/Cabal/Survival\" rel=\"nofollow\">Cabal Hell</a>. Fixing it is an active area of research in the Haskell community. My suggestions would be as follows:</p>\n\n<ul>\n<li><p>If you're using Windows:</p>\n\n<ul>\n<li>Install <a href=\"https://github.com/fpco/minghc\" rel=\"nofollow\">MinGHC</a></li>\n<li>Install Stackage (Stable Hackage). You can do this globally or on a per-project basis. Here's the global way:</li>\n<li>Download the <a href=\"https://www.stackage.org/snapshot/lts-2.4/cabal.config?global=true\" rel=\"nofollow\">global cabal.config file</a>.</li>\n<li>Now open your global cabal config file. Mine was in <code>C:\\Users\\blauwers\\AppData\\Roaming\\cabal</code> and was just called <code>config</code>.</li>\n<li>Copy and paste the contents of the file your downloaded to the end of that file.</li>\n<li>Your global cabal environment will now try to get packages from Stackage. </li>\n<li>For extra safety, comment out the other lines in the file that start with <code>remote-repo</code>. In my case that was only <code>remote-repo: hackage.haskell.org:http://hackage.haskell.org/packages/archive</code>.</li>\n<li>With the extra safety enabled, you'll have to <a href=\"https://wiki.haskell.org/Cabal/How_to_install_a_Cabal_package\" rel=\"nofollow\">manually download and install packages</a> that are not on Stackage.</li>\n</ul></li>\n<li><p>If you're using Linux: I don't know where the global cabal config file is, but the process is the same.</p></li>\n</ul>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4201880"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1429710890, "creation_date": 1429701281, "last_edit_date": 1429710890, "question_id": 29795776, "link": "https://stackoverflow.com/questions/29795776/haskell-json-issue", "title": "Haskell JSON Issue", "body": "<p>been trying to get this code working but the compiler is throwing out an error?</p>\n\n<pre><code> {-# LANGUAGE OverloadedStrings, DeriveGeneric #-}\n\n import Data.Aeson\n import Data.Text\n import Control.Applicative\n import Control.Monad\n import qualified Data.ByteString.Lazy as B\n import Network.HTTP.Conduit (simpleHttp)\n import GHC.Generics\n\n\ndata Temperatures =\nTemperatures { date  :: String\n     , temperature   :: Int\n     } deriving (Show,Generic)\n\n\ninstance FromJSON Temperatures\ninstance ToJSON Temperatures\n\njsonURL :: String\njsonURL = \"A JSON URL\"\n\ngetJSON :: IO B.ByteString\ngetJSON = simpleHttp jsonURL\n\nmain :: IO ()\nmain = do\nd &lt;- (eitherDecode &lt;$&gt; getJSON) :: IO (Either String [Temperatures])\ncase d of\nLeft err -&gt; putStrLn err\nRight ps -&gt; print ps\n</code></pre>\n\n<p>And the error message i'm getting is</p>\n\n<pre><code>Main.hs:25:11:\nCouldn't match type `bytestring-      0.10.0.2:Data.ByteString.Lazy.Internal.ByteString'\n              with `B.ByteString'\nExpected type: IO B.ByteString\n  Actual type: IO\n                 bytestring-0.10.0.2:Data.ByteString.Lazy.Internal.ByteString\nIn the return type of a call of `simpleHttp'\nIn the expression: simpleHttp jsonURL\nIn an equation for `getJSON': getJSON = simpleHttp jsonURL\n</code></pre>\n\n<p>Any suggestions of what's causing this error and how to fix it would be much appreciated. Thanks.</p>\n"}, {"tags": ["list", "function", "haskell", "dictionary"], "comments": [{"owner": {"reputation": 555, "user_id": 4108393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1616347e88a4828ad7b5eaf6dff2337?s=128&d=identicon&r=PG&f=1", "display_name": "G Philip", "link": "https://stackoverflow.com/users/4108393/g-philip"}, "edited": false, "score": 0, "creation_date": 1429705921, "post_id": 29795018, "comment_id": 47723416, "body": "The question is not clear to me: 1. You say you have two functions <code>accelerate</code> and <code>accelerateParticle</code>. Do you already have implementations of both these functions with you, or do you want to implement these functions? 2. You say you want to apply the <code>accelerateParticle</code> function to every element in <code>[Particle]</code>. <i>Where</i> do you want to do this? Are you trying to implement a third function, or are you trying to implement one of these two functions using the other? 3. What is&quot;the original <code>[particle]</code> that is given initally by <code>accelerate</code>&quot;? Is this the list which  <code>accelerate</code> returns?"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1429700161, "creation_date": 1429700161, "answer_id": 29795351, "question_id": 29795018, "link": "https://stackoverflow.com/questions/29795018/using-map-with-a-function/29795351#29795351", "title": "Using map with a function", "body": "<p>You might be looking for this:</p>\n\n<pre><code>accelerate :: Float -&gt; [Particle] -&gt; [Particle]\naccelerate x ps = map (\\p -&gt; accelerateParticle x p ps) ps\n</code></pre>\n\n<p>Note that the list of all particles <code>ps</code> is used both to <code>map</code> over it, and as a parameter of <code>accelerateParticle</code>.</p>\n"}], "owner": {"reputation": 33, "user_id": 3996007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grGLq.jpg?s=128&g=1", "display_name": "Oringal", "link": "https://stackoverflow.com/users/3996007/oringal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 29795351, "answer_count": 1, "score": 3, "last_activity_date": 1429700161, "creation_date": 1429699317, "last_edit_date": 1429699708, "question_id": 29795018, "link": "https://stackoverflow.com/questions/29795018/using-map-with-a-function", "title": "Using map with a function", "body": "<p>I have 2 Functions </p>\n\n<pre><code>accelerate :: Float -&gt; [Particle] -&gt; [Particle]\naccelerateParticle :: Float -&gt; Particle -&gt; [Particle] -&gt; Particle\n</code></pre>\n\n<p>and what I am trying to achieve is for every element in <code>[Particle]</code> apply the <code>accelerateParticle</code> function. The trouble I have run into is that the <code>accelerateParticle</code> function relies on using the original <code>[particle]</code> that is given initally by accelerate. I was thinking of using map like this</p>\n\n<p><code>map (\\particle -&gt; accelerateParticle Float particle [Particle]) [Particle]</code></p>\n\n<p>but I'm not very sure if this the correct format.</p>\n"}, {"tags": ["haskell", "pattern-matching", "idris"], "answers": [{"comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1429696263, "post_id": 29793693, "comment_id": 47715876, "body": "Nice, It makes sense now! But how would you actually add a special case covering <code>intersect (==) [0..] [2]</code> ?"}, {"owner": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "edited": false, "score": 0, "creation_date": 1429696284, "post_id": 29793693, "comment_id": 47715888, "body": "why does <code>_ [] _</code> look redundant?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "edited": false, "score": 1, "creation_date": 1429696396, "post_id": 29793693, "comment_id": 47715971, "body": "@Heather because <code>[x | x &lt;- xs , ...]</code> evaluates to <code>[]</code> immediately when <code>xs</code> is empty."}, {"owner": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "edited": false, "score": 0, "creation_date": 1429696448, "post_id": 29793693, "comment_id": 47716011, "body": "@chi but empty cases is using just everywhere in GHC prelude even in this function (at least used) <a href=\"https://github.com/ghc/ghc/blob/c5977c2e2951e9e346a8f4990d5a6bbdbf9cee0b/libraries/base/Data/OldList.hs#L436-L440\" rel=\"nofollow noreferrer\">github.com/ghc/ghc/blob/&hellip;</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1429696499, "post_id": 29793693, "comment_id": 47716053, "body": "@Sibi For instance <code>intersectBy xs [y] = [ y | elem y xs]</code>. I would not really add that in real code -- it&#39;s just for the sake of argument."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1429696699, "post_id": 29793693, "comment_id": 47716211, "body": "@chi That&#39;s not a valid implemenation for <code>intersectBy</code>. Also, what if something like this is the input: <code>intersect (==) [2] [0..]</code>. ? I think that&#39;s why that special case isn&#39;t considered."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "edited": false, "score": 0, "creation_date": 1429696773, "post_id": 29793693, "comment_id": 47716275, "body": "@Heather In other cases it is often necessary. Here it does not seem to be the case. Maybe the authors of that version of Prelude felt the code followed a better style in this way -- I have no idea."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1429697009, "post_id": 29793693, "comment_id": 47716422, "body": "@Sibi I forgot the &quot;by&quot;. Use instead <code>intersectBy eq xs [y] = [ y | any (eq y) xs]</code>. The symmetric case is already handled by the last general comprehension. Still, I feel these special cases make the semantics more complex, and are harder to understand. If one list is infinite and the other contains some element not in the former list, the intersection has to diverge anyway. Making special cases for null, singleton, or even finite lists feels tricky to me."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1429697686, "post_id": 29793693, "comment_id": 47716915, "body": "@chi Thanks for explaining. I think the prelude authors might have added the special cases just for the empty list in the presence of infinite lists. But that&#39;s just a guess.... :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1429733004, "post_id": 29793693, "comment_id": 47743490, "body": "I think you could argue that a correct intersection would be sure to terminate if <i>either</i> list is finite. This will not, however, be very pretty, especially given the <code>By</code> and no ordering."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 13, "last_activity_date": 1429731582, "last_edit_date": 1429731582, "creation_date": 1429696035, "answer_id": 29793693, "question_id": 29793426, "link": "https://stackoverflow.com/questions/29793426/where-and-why-should-i-use-extra-empty-patterns/29793693#29793693", "title": "Where and Why should I use extra empty patterns?", "body": "<p>Semantically speaking, the pattern</p>\n\n<pre><code>intersectBy _  [] _     =  []\n</code></pre>\n\n<p>looks redundant, even from a performance point of view. Instead, in Haskell</p>\n\n<pre><code>intersectBy _  _  []    =  []\n</code></pre>\n\n<p>is not redundant since otherwise</p>\n\n<pre><code>intersectBy (==) [0..] []\n</code></pre>\n\n<p>would diverge, since the comprehension would attempt to try all the elements <code>x &lt;- [0..]</code>.</p>\n\n<p>I am not sure I like this special case, though. Why shouldn't we add a special case covering <code>intersectBy (==) [0..] [2]</code> so that it returns <code>[2]</code>? Further, if performance is the concern, in many cases I'd like to use a O(n log n) approach through pre-sorting, even is this does not work on infinite lists and requires <code>Ord a</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1429740440, "post_id": 29809628, "comment_id": 47747603, "body": "Not likely, no. The compiler will erase unused bindings. It&#39;s true that in some (relatively unusual) circumstances, an unused argument will be created as a thunk, but that will happen regardless of whether it&#39;s bound."}, {"owner": {"reputation": 163, "user_id": 3955068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14cfb6b0b97806521aba8fe3fcc8e133?s=128&d=identicon&r=PG&f=1", "display_name": "Theodore Lief Gannon", "link": "https://stackoverflow.com/users/3955068/theodore-lief-gannon"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1429740658, "post_id": 29809628, "comment_id": 47747707, "body": "Interesting. So the general advice to not bind unless you&#39;re using it is just for good style, not any technical consideration?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1429740828, "post_id": 29809628, "comment_id": 47747787, "body": "Yes. It makes it clear to readers that it&#39;s not used. There&#39;s a compiler warning available for unused bindings (enabled by <code>-Wall</code> or by <code>-fwarn-unused-binds</code> or some such). It prevents you from accidentally forgetting to use something that you intended to, where that intent is signalled by binding a name that does not begin with an underscore."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1429740924, "post_id": 29809628, "comment_id": 47747825, "body": "Good style also recommends that arguments that are <i>sometimes</i> used be bound, where unused, to names that begin with underscores. <code>f 0 _x = 3; f _ x = x</code>. This is also likely an effective way to confuse Agda programmers, which is always a good goal."}], "tags": [], "owner": {"reputation": 163, "user_id": 3955068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14cfb6b0b97806521aba8fe3fcc8e133?s=128&d=identicon&r=PG&f=1", "display_name": "Theodore Lief Gannon", "link": "https://stackoverflow.com/users/3955068/theodore-lief-gannon"}, "is_accepted": false, "score": 5, "last_activity_date": 1429740488, "last_edit_date": 1495539813, "creation_date": 1429739753, "answer_id": 29809628, "question_id": 29793426, "link": "https://stackoverflow.com/questions/29793426/where-and-why-should-i-use-extra-empty-patterns/29809628#29809628", "title": "Where and Why should I use extra empty patterns?", "body": "<p>@chi explains the <code>_ _ []</code> case, but <code>_ [] _</code> serves a purpose as well: it dictates how <code>intersectBy</code> <a href=\"https://www.haskell.org/tutorial/patterns.html#sect4.2\" rel=\"nofollow noreferrer\">handles <code>bottom</code></a>. With the definition as written:</p>\n\n<pre><code>\u03bb. intersectBy undefined    []     undefined\n[]\n\u03bb. intersectBy   (==)    undefined    []\n*** Exception: Prelude.undefined\n</code></pre>\n\n<p>Remove the first pattern and it becomes:</p>\n\n<pre><code>\u03bb. intersectBy undefined undefined    []\n[]\n\u03bb. intersectBy   (==)       []     undefined\n*** Exception: Prelude.undefined\n</code></pre>\n\n<hr>\n\n<p><strike>I'm not 100% certain of this, but I believe there's also a performance benefit to not <em>binding</em> anything in the first pattern. The final pattern will give the same result for <code>xs == []</code> without <em>evaluating</em> <code>eq</code> or <code>ys</code>, but AFAIK it still <a href=\"https://stackoverflow.com/a/5132862/3955068\">allocates stack space</a> for their thunks.</strike></p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1429742295, "post_id": 29809901, "comment_id": 47748403, "body": "Wouldn&#39;t adding <code>intersectBy eq xs [y] = [y | any (eq y) xs]</code> make it even more defined, e.g. <code>intersectBy (==) [0..] [2]</code> ?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1429743302, "post_id": 29809901, "comment_id": 47748766, "body": "@chi, yes, I believe so, and I believe it should be possible to take that trick all the way, ensuring a finite result if either argument is finite. But the current implementation does not remove duplicates and does not change ordering, whereas yours removes duplicates and my hypothetical one would remove duplicates and reorder."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1429744037, "post_id": 29809901, "comment_id": 47749018, "body": "@dfeuer Good point about the duplicates -- one might argue that my addition changes the semantics of the original. About taking the trick all the way: it might be possible but it would require some non trivial &quot;fair scheduling&quot; since you don&#39;t know in advance which of these lists is the finite one. Also, you need to assume that the finite one is a subset of the other, since you can&#39;t check whether something is not an element of an infinite list."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1429745552, "post_id": 29809901, "comment_id": 47749561, "body": "@chi, good point about the semidecidability. I forgot about that!"}, {"owner": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "edited": false, "score": 0, "creation_date": 1429770333, "post_id": 29809901, "comment_id": 47757883, "body": "so it is optimization if I understand right but noone yet explained me the possible problems with reasoning sadly, for now it&#39;s added to idris without emty patterns."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 11, "last_activity_date": 1429740872, "creation_date": 1429740872, "answer_id": 29809901, "question_id": 29793426, "link": "https://stackoverflow.com/questions/29793426/where-and-why-should-i-use-extra-empty-patterns/29809901#29809901", "title": "Where and Why should I use extra empty patterns?", "body": "<p>There's no need to guess when you can look up the history through <code>git blame</code>, GHC Trac and the libraries mailing list.</p>\n\n<p>Originally the definition was just the third equation,</p>\n\n<pre><code>intersectBy eq xs ys    =  [x | x &lt;- xs, any (eq x) ys]\n</code></pre>\n\n<p>In <a href=\"https://github.com/ghc/ghc/commit/8e8128252ee5d91a73526479f01ace8ba2537667\" rel=\"noreferrer\">https://github.com/ghc/ghc/commit/8e8128252ee5d91a73526479f01ace8ba2537667</a> the second equation was added as a strictness/performance improvement, and at the same time, the first equation was added so as to make the new definition always at least as defined as the original. Otherwise, <code>intersectBy f [] _|_</code> would be <code>_|_</code> when it was <code>[]</code> before.</p>\n\n<p>It seems to me that this current definition is now maximally lazy: it is as defined as possible for any inputs, except that one has to choose whether to check the left or right list for emptiness first. (And, as I mentioned above, this choice is made to be consistent with the historical definition.)</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1429847389, "creation_date": 1429847389, "answer_id": 29838405, "question_id": 29793426, "link": "https://stackoverflow.com/questions/29793426/where-and-why-should-i-use-extra-empty-patterns/29838405#29838405", "title": "Where and Why should I use extra empty patterns?", "body": "<p>There <em>is</em> a big difference in Idris: Idris lists are always finite! Furthermore, Idris is a mostly strict (call-by-value) language, and optionally uses a totality checker, so it's pretty reasonable to assume there won't be any bottoms hiding in the argument lists. The significance of that difference is that the two definitions are much more nearly semantically identical in Idris than in Haskell. The choice of which to use may be made based on the ease of proving properties of the function, or may be based on simplicity.</p>\n"}], "owner": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 715, "favorite_count": 2, "accepted_answer_id": 29793693, "answer_count": 4, "score": 8, "last_activity_date": 1429847389, "creation_date": 1429695366, "question_id": 29793426, "link": "https://stackoverflow.com/questions/29793426/where-and-why-should-i-use-extra-empty-patterns", "title": "Where and Why should I use extra empty patterns?", "body": "<p>For example:</p>\n\n<pre><code>intersectBy : (a -&gt; a -&gt; Bool) -&gt; List a -&gt; List a -&gt; List a\nintersectBy _  [] _     =  []\nintersectBy _  _  []    =  []\nintersectBy eq xs ys    =  [x | x &lt;- xs, any (eq x) ys]\n</code></pre>\n\n<p>There are extra patterns for <code>[]</code> and seems like they are used in Haskell <code>Data.List</code> but what kind of optimization is that? And where is difference with Idris here?</p>\n\n<p>I ask because I heard that \"it will make reasoning about it more difficult\" and person who said me that had no time to fully explain it. </p>\n\n<p><em>I doubt if I can understand it doing \"reduce the proof\" of function.</em></p>\n\n<p>May someone explain me the politics of extra patterns here from positions of Haskell and Idris so I will be able to understand and see the difference.</p>\n"}, {"tags": ["haskell", "generic-programming", "haskell-linear"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 1, "last_activity_date": 1430720687, "creation_date": 1430720687, "answer_id": 30023789, "question_id": 29787585, "link": "https://stackoverflow.com/questions/29787585/how-to-derive-additive-generically-on-haskell-without-defining-an-applicative-i/30023789#30023789", "title": "How to derive Additive generically on Haskell, without defining an Applicative instance?", "body": "<p><strong>No.</strong></p>\n\n<p>The canonical example of a datatype which has two perfectly cromulent <code>Applicative</code> instances is <code>[]</code> / <code>ZipList</code>. This proves that a generic derivation of <code>Applicative</code> for <code>[]</code> would need to somehow choose one or the other, when in fact neither choice is more valid than the other.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1563316135, "creation_date": 1429675691, "last_edit_date": 1563316135, "question_id": 29787585, "link": "https://stackoverflow.com/questions/29787585/how-to-derive-additive-generically-on-haskell-without-defining-an-applicative-i", "title": "How to derive Additive generically on Haskell, without defining an Applicative instance?", "body": "<p>Given a type, there is only one obvious way to implement an <code>Additive</code> instance, from the Linear library, to it. Conveniently, <code>Additive</code> has a generic implementation, so we can use <code>deriving</code> for it. Unfortunately, it depends on the existence of an <code>Applicative</code> instance, which is not derivable, so you still have to declare it:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, DeriveFunctor #-}\n\nimport Linear\nimport GHC.Generics\nimport Control.Applicative\n\ndata Foo a = Foo a a a deriving (Show, Functor, Generic1)\n\ninstance Additive Foo\n\ninstance Applicative Foo where\n    pure x = Foo x x x\n    Foo f g h &lt;*&gt; Foo x y z = Foo (f x) (g y) (h z)\n\nmain = print $ Foo 1 2 3 ^+^ Foo 4 5 6\n</code></pre>\n\n<p>Is there any way to derive Additive automatically, without having to declare an Applicative instance?</p>\n"}, {"tags": ["haskell", "generic-programming", "applicative"], "answers": [{"comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 17, "creation_date": 1429674637, "post_id": 29787376, "comment_id": 47704265, "body": "Also, <code>[]</code> and <code>ZipList</code> are both, ultimately, two different, equally valid <code>Applicative</code> instances for the list type."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1429674669, "post_id": 29787376, "comment_id": 47704272, "body": "So maybe we need a Zippable class? That is, for things like deriving <code>Additive</code> (which, on turn, seems to have one obvious definition) without having to declare an <a href=\"http://lpaste.net/131202\" rel=\"nofollow noreferrer\">Applicative instance</a>. (Maybe I should ask another question?)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1429674838, "post_id": 29787376, "comment_id": 47704312, "body": "My bad. <a href=\"http://hackage.haskell.org/package/linear-1.18.0.1/docs/Linear-Vector.html\" rel=\"nofollow noreferrer\">Additive</a> is a class from Linear package which implements additive groups of vector spaces. For example, <code>[1,2,3] ^+^ [1,1,1] == [2,3,4]</code>. It has a generic implementation, but it depends on Applicative which isn&#39;t derivable, so you can&#39;t derive <code>Additive</code> for, say, <code>data Triple a = Triple a a a</code> regardless of having an obvious derivation. Edit: hm whoever asked what Additive is deleted it. I&#39;m not talking alone lol."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1429675031, "post_id": 29787376, "comment_id": 47704370, "body": "@Viclib Ha, that was me sorry. I just remembered that it was in <code>linear</code> and I was thinking no one saw it yet. Anyway, I think the major issue is that some types can have multiple equally valid <code>Applicative</code> instances, similar to <code>Monoid</code>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1429675218, "post_id": 29787376, "comment_id": 47704435, "body": "Yep, but not multiple equally valid <code>Additive</code> instances, right? So it seems like there is something wrong here..."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 18, "last_activity_date": 1543088218, "last_edit_date": 1543088218, "creation_date": 1429674465, "answer_id": 29787376, "question_id": 29787252, "link": "https://stackoverflow.com/questions/29787252/why-there-is-no-way-to-derive-applicative-functors-in-haskell/29787376#29787376", "title": "Why there is no way to derive Applicative Functors in Haskell?", "body": "<p>No, this is not obvious at all. Compare the following <code>Applicative</code> instances:</p>\n\n<ol>\n<li><code>[]</code></li>\n<li><code>ZipList</code></li>\n<li><a href=\"https://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Sequence.html\" rel=\"nofollow noreferrer\"><code>Data.Sequence.Seq</code></a>, whose <a href=\"https://github.com/haskell/containers/blob/7615e4238cd7968d4abc27539974afe9b0b5024b/Data/Sequence.hs#L275\" rel=\"nofollow noreferrer\"><code>Applicative</code> instance declaration</a> runs to several hundred lines.</li>\n<li><code>IO</code></li>\n<li><code>(-&gt;) r</code></li>\n<li>Parsers in <code>parsec</code>, <code>attoparsec</code>, <code>regex-applicative</code>.</li>\n<li><a href=\"https://hackage.haskell.org/package/pipes-4.1.5/docs/src/Pipes-Internal.html#Proxy\" rel=\"nofollow noreferrer\">Proxy</a> in the <code>pipes</code> package.</li>\n</ol>\n\n<p>There very little uniformity here, and most of the instances are non-obvious.</p>\n\n<hr>\n\n<p>As <a href=\"https://stackoverflow.com/users/2476735/david-young\">David Young</a> <a href=\"https://stackoverflow.com/questions/29787252/why-there-is-no-way-to-derive-applicative-functors-in-haskell/29787376#comment47704265_29787376\">comments</a>, the <code>[]</code> and <code>ZipList</code> instances \"are both, ultimately, two different, equally valid <code>Applicative</code> instances for the list type.\"</p>\n"}, {"comments": [{"owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "edited": false, "score": 1, "creation_date": 1541768844, "post_id": 53225790, "comment_id": 93339330, "body": "Here&#39;s a few more examples of using <code>DerivingVia</code> with <code>Generics</code>: <a href=\"https://github.com/Icelandjack/deriving-via/blob/master/examples/Generics.hs\" rel=\"nofollow noreferrer\">github.com/Icelandjack/deriving-via/blob/master/examples/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1958, "user_id": 939108, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/055cba8d3eb565a817f6f7f20f936814?s=128&d=identicon&r=PG", "display_name": "Hjulle", "link": "https://stackoverflow.com/users/939108/hjulle"}, "is_accepted": false, "score": 7, "last_activity_date": 1570447344, "last_edit_date": 1570447344, "creation_date": 1541766787, "answer_id": 53225790, "question_id": 29787252, "link": "https://stackoverflow.com/questions/29787252/why-there-is-no-way-to-derive-applicative-functors-in-haskell/53225790#53225790", "title": "Why there is no way to derive Applicative Functors in Haskell?", "body": "<p>Now that <a href=\"https://www.kosmikus.org/DerivingVia/deriving-via-paper.pdf\" rel=\"nofollow noreferrer\"><code>DerivingVia</code></a> has been released (GHC-8.6 or newer) it is actually possible to derive <code>Applicative</code> with the help of <code>DeriveGeneric</code> for any <em>deterministic</em> data type! That is to say, any data type with exactly one variant:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Foo x = Foo x | Fe  -- This is non-deterministic and can't derive Applicative\ndata Bar x = Bar x x (Bar x) -- This is deterministic and can derive Applicative\ndata Baz x = Baz (Either Int x) [x] -- This is also ok, since [] and Either Int\n                                    -- are both Applicative\ndata Void x -- This is not ok, since pure would be impossible to define.\n</code></pre>\n\n<p>To derive <code>Applicative</code>, we first need to define a wrapper for deriving via generics:</p>\n\n<pre><code>{-# LANGUAGE DerivingVia #-}\n{-# LANGUAGE DeriveFunctor #-}\n{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE DeriveGeneric #-}\nmodule Generically1 where\n\nimport GHC.Generics\n\nnewtype Generically1 f x = Generically1 { generically1 :: f x }\n\nfromg1 :: Generic1 f =&gt; Generically1 f a -&gt; Rep1 f a\nfromg1 = from1 . generically1\n\ntog1 :: Generic1 f =&gt; Rep1 f x -&gt; Generically1 f x\ntog1 = Generically1 . to1\n\ninstance (Functor f, Generic1 f, Functor (Rep1 f)) \n       =&gt; Functor (Generically1 f) where\n  fmap f (Generically1 x) = Generically1 $ fmap f x\n\ninstance (Functor f, Generic1 f, Applicative (Rep1 f)) \n       =&gt; Applicative (Generically1 f) where\n  pure = tog1 . pure\n  f &lt;*&gt; x = tog1 $ fromg1 f &lt;*&gt; fromg1 x\n\ninstance (Functor f, Generic1 f, Monad (Rep1 f)) =&gt; Monad (Generically1 f) where\n  return = pure\n  m &gt;&gt;= f = tog1 $ fromg1 m &gt;&gt;= fromg1 . f\n</code></pre>\n\n<p>and to use it we first derive <code>Generic1</code> for our data type and then derive <code>Applicative</code> via our new <code>Generically1</code> wrapper:</p>\n\n<pre><code>data Foo x = Foo x (Int -&gt; x) (Foo x)\n  deriving (Functor, Generic1)\n  deriving (Applicative, Monad) via Generically1 Foo\n\ndata Bar x = Bar x (IO x)\n  deriving (Functor, Generic1)\n  deriving (Applicative, Monad) via Generically1 Bar\n\ndata Baz f x = Baz (f x) (f x)\n  deriving (Show, Functor, Generic1)\n  deriving (Applicative, Monad) via Generically1 (Baz f)\n</code></pre>\n\n<p>As you can see, we did not only derive <code>Applicative</code> for our data types but could also derive <code>Monad</code>.</p>\n\n<hr>\n\n<p>The reason that this works is that there are instances for <code>Applicative</code> and <code>Monad</code> for the <code>Generic1</code> representations of these data types. See for example the <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/GHC-Generics.html#t::-42-:\" rel=\"nofollow noreferrer\">Product type (:*:)</a>. There is however no instance of <code>Applicative</code> for the <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/GHC-Generics.html#t::-43-:\" rel=\"nofollow noreferrer\">Sum type (:+:)</a>, which is why we can't derive it for non-deterministic types.</p>\n\n<p>You can see the <code>Generic1</code> representation of a data type by writing <code>:kind! Rep1 Foo</code> in GHCi. Here are simplified versions (excluding meta-data) of the representations for the types above:</p>\n\n<pre><code>type family Simplify x where\n  Simplify (M1 i c f) = Simplify f\n  Simplify (f :+: g) = Simplify f :+: Simplify g\n  Simplify (f :*: g) = Simplify f :*: Simplify g\n  Simplify x = x\n\n\u03bb&gt; :kind! Simplify (Rep1 Foo)\nSimplify (Rep1 Foo) :: * -&gt; *\n= Par1 :*: (Rec1 ((-&gt;) Int) :*: Rec1 Foo)\n\n\u03bb&gt; :kind! Simplify (Rep1 Bar)\nSimplify (Rep1 Bar) :: * -&gt; *\n= Par1 :*: Rec1 IO\n\n\u03bb&gt; :kind! forall f. Simplify (Rep1 (Baz f))\nforall f. Simplify (Rep1 (Baz f)) :: k -&gt; *\n= forall (f :: k -&gt; *). Rec1 f :*: Rec1 f\n</code></pre>\n\n<hr>\n\n<p>Edit: The <code>Generically1</code> wrapper is also available here: <a href=\"https://hackage.haskell.org/package/generic-data-0.7.0.0/docs/Generic-Data.html#t:Generically1\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/generic-data-0.7.0.0/docs/Generic-Data.html#t:Generically1</a></p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2194, "favorite_count": 4, "accepted_answer_id": 29787376, "answer_count": 2, "score": 17, "last_activity_date": 1570447344, "creation_date": 1429673745, "last_edit_date": 1475479869, "question_id": 29787252, "link": "https://stackoverflow.com/questions/29787252/why-there-is-no-way-to-derive-applicative-functors-in-haskell", "title": "Why there is no way to derive Applicative Functors in Haskell?", "body": "<p>In Haskell, you can derive <code>Functor</code>, <code>Foldable</code> and <code>Traversable</code> automatically using <code>deriving</code>. There is no way to derive <code>Applicative</code>, though. Considering there is one obvious way to define an <code>Applicative</code> instance (which would amount to a zipped application), isn't there any way to enable <code>deriving Applicative</code>?</p>\n"}, {"tags": ["haskell", "typeclass", "ambiguity", "ambiguous"], "answers": [{"comments": [{"owner": {"reputation": 667, "user_id": 1004609, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f3761bec22a1edb645f7cf0a94abd658?s=128&d=identicon&r=PG", "display_name": "danielpwright", "link": "https://stackoverflow.com/users/1004609/danielpwright"}, "edited": false, "score": 0, "creation_date": 1429690634, "post_id": 29790380, "comment_id": 47711875, "body": "Exactly the sort of thing I was looking for, thank you!  Yeah, I&#39;m basically abusing typeclasses to give me a sort of overloading on certain instructions in my EDSL -- in the end only those instructions and not the typeclass they rely on will be exported, so I think I should be safe.  Thanks!"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 5, "last_activity_date": 1429687097, "creation_date": 1429687097, "answer_id": 29790380, "question_id": 29786642, "link": "https://stackoverflow.com/questions/29786642/resolving-type-ambiguities-using-available-class-instances/29790380#29790380", "title": "Resolving type ambiguities using available class instances", "body": "<p>Quick solution with \"naughty pragmas\" with GHC 7.10:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleInstances #-}\n\nclass    C a where f :: a -&gt; ()\ninstance C T where f _ = ()\ninstance {-# INCOHERENT #-} (w ~ Word16) =&gt; C w where f _ = ()\n</code></pre>\n\n<p>And with GHC 7.8:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleInstances, IncoherentInstances #-}\n\nclass    C a where f :: a -&gt; ()\ninstance C T where f _ = ()\ninstance (w ~ Word16) =&gt; C w where f _ = ()\n</code></pre>\n\n<p>Here, GHC essentially picks an arbitrary most specific instance that remains after trying to unify the instances heads and constraints. </p>\n\n<p>You should only use this if</p>\n\n<ul>\n<li>You have a fixed set of instances and don't export the class.</li>\n<li>For all use cases of the class method, there is a single possible most specific instance (given the constraints).</li>\n</ul>\n\n<p>Many people advise against <em>ever</em> using <code>IncoherentInstances</code>, but I think it can be quite fun for DSL-s, if we observe the above considerations.</p>\n"}, {"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1429718582, "post_id": 29790612, "comment_id": 47733966, "body": "This last restriction is lifted by the <code>ExtendedDefaultRules</code> extension."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 5, "last_activity_date": 1429687661, "creation_date": 1429687661, "answer_id": 29790612, "question_id": 29786642, "link": "https://stackoverflow.com/questions/29786642/resolving-type-ambiguities-using-available-class-instances/29790612#29790612", "title": "Resolving type ambiguities using available class instances", "body": "<p>For anybody else wondering about <code>default</code> (I know I was!)</p>\n\n<p><a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-750004.3\">https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-750004.3</a></p>\n\n<p>Quoting section 4.3.4:</p>\n\n<blockquote>\n  <p>In situations where an ambiguous type is discovered, an ambiguous type variable, v, is defaultable if:</p>\n  \n  <ul>\n  <li>v appears only in constraints of the form C v, where C is a class, and</li>\n  <li>at least one of these classes is a numeric class, (that is, Num or a subclass of Num), and</li>\n  <li>all of these classes are defined in the Prelude or a standard library.</li>\n  </ul>\n</blockquote>\n\n<p>So that explains why your <code>default</code> clause is being completely ignored; <code>C</code> is not a standard library type-class.</p>\n\n<p>(As to <em>why</em> this is the rule&hellip; can't help you there. Presumably to avoid breaking arbitrary user-defined code.)</p>\n"}], "owner": {"reputation": 667, "user_id": 1004609, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f3761bec22a1edb645f7cf0a94abd658?s=128&d=identicon&r=PG", "display_name": "danielpwright", "link": "https://stackoverflow.com/users/1004609/danielpwright"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "accepted_answer_id": 29790380, "answer_count": 2, "score": 3, "last_activity_date": 1429687661, "creation_date": 1429669527, "question_id": 29786642, "link": "https://stackoverflow.com/questions/29786642/resolving-type-ambiguities-using-available-class-instances", "title": "Resolving type ambiguities using available class instances", "body": "<p>Given the following code:</p>\n\n<pre><code>import Data.Word\n\ndata T = T deriving (Eq, Show)\n\nclass    C a      where f :: a -&gt; ()\ninstance C T      where f _ = ()\ninstance C Word16 where f _ = ()\n\nmain = return $ f 0x16\n</code></pre>\n\n<p>GHC complains that it can't infer what the type for the literal <code>0x16</code> should be with the error:</p>\n\n<pre><code>No instance for (Num a0) arising from the literal \u201822\u2019\nThe type variable \u2018a0\u2019 is ambiguous\n</code></pre>\n\n<p>It is easy to see why this would be -- Haskell allows numeric literals to be of any type which has an instance of <code>Num</code>, and here we can't disambiguate what the type for the literal <code>0x16</code> (or 22) should be.</p>\n\n<p>It's also clear as a human reading this what I intended to do -- there is only one available instance of the class <code>C</code> which satisfies the <code>Num</code> constraint, so obviously I intended to use that one so <code>0x16</code> should be treated as a <code>Word16</code>.</p>\n\n<p>There are two ways that I know to fix it: Either annotate the literal with its type:</p>\n\n<pre><code>main = return $ f (0x16 :: Word16)\n</code></pre>\n\n<p>or define a function which essentially does that annotation for you:</p>\n\n<pre><code>w16 x = x :: Word16\nmain = return $ f (w16 0x16)\n</code></pre>\n\n<p>I have tried a third way, sticking <code>default (Word16)</code> at the top of the file in the hope that Haskell would pick that as the default type for numeric literals, but I guess I'm misunderstanding what the <code>default</code> keyword is supposed to do because that didn't work.</p>\n\n<p>I understand that typeclasses are open, so just because you can make the assumption in the context quoted above that <code>Word16</code> is the only numeric instance of <code>C</code> that may not hold in some other module.  But my question is: is there some mechanism by which I can assume/enforce that property, so that it is possible to use <code>f</code> and have Haskell resolve the type of its numeric argument to <code>Word16</code> without explicit annotations at the call site?</p>\n\n<p>The context is that I am implementing an EDSL, and I would rather not have to include manual type hints when I know that my parameters will either be <code>Word16</code> or some other non-numeric type.  I am open to a bit of dirty types/extensions abuse if it makes the EDSL feel more natural!  Although if solutions do involve the naughty pragmas I'd definitely appreciate hints on what I should be wary about when using them.</p>\n"}, {"tags": ["haskell", "warp", "haskell-wai", "acid-state"], "answers": [{"comments": [{"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1429701914, "post_id": 29796004, "comment_id": 47720123, "body": "<code>unsafePerformIO</code> is not a solution as it breaks horribly with side-effects."}], "tags": [], "owner": {"reputation": 1, "user_id": 3960984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c774035f0c24824bc880bfd46cae2de6?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi K Paladugu", "link": "https://stackoverflow.com/users/3960984/ravi-k-paladugu"}, "is_accepted": false, "score": -1, "last_activity_date": 1429701808, "creation_date": 1429701808, "answer_id": 29796004, "question_id": 29785737, "link": "https://stackoverflow.com/questions/29785737/avoiding-errors-caused-by-io-when-talking-to-a-database-inside-of-a-wai-handler/29796004#29796004", "title": "Avoiding Errors caused by IO when talking to a database inside of a WAI handler", "body": "<p>You are mixing between value in the context i.e. IO (* -><em>) and value (</em>). You can not do \"do\" type syntax for a value. Simple solution would be to use unsafePerformIO. Usage depends on your context (paying attention to word \"unsafe\"). Recommended approach would be to use monad transformer stack with IO at the end and then use liftIO to do your IO actions. </p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "edited": false, "score": 0, "creation_date": 1429720373, "post_id": 29800384, "comment_id": 47735215, "body": "This is an excellent answer. I understand the issue now. One question though - wai&#39;s <code>Application</code> is actually a synonym for <code>Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived</code>. The function <code>(Response -&gt; IO ResponseReceived)</code> takes a <code>Response</code>, not an <code>IO Response</code>. How can I feed an <code>IO Response</code> to this function?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "edited": false, "score": 0, "creation_date": 1429720851, "post_id": 29800384, "comment_id": 47735521, "body": "I believe I can do this with <code>&gt;&gt;=</code>, actually."}, {"owner": {"reputation": 1585, "user_id": 1413081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d8d1f596731eaae04f3ade303d211ca?s=128&d=identicon&r=PG", "display_name": "Reite", "link": "https://stackoverflow.com/users/1413081/reite"}, "edited": false, "score": 1, "creation_date": 1429728136, "post_id": 29800384, "comment_id": 47740345, "body": "I added a bit about this to the bottom of my post."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "edited": false, "score": 0, "creation_date": 1429728327, "post_id": 29800384, "comment_id": 47740465, "body": "Ah I see. I ended up solving this just like you suggested, except instead of using another <code>&lt;-</code> I used <code>(flip (&gt;&gt;=)) respond $ ....</code>"}, {"owner": {"reputation": 1585, "user_id": 1413081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d8d1f596731eaae04f3ade303d211ca?s=128&d=identicon&r=PG", "display_name": "Reite", "link": "https://stackoverflow.com/users/1413081/reite"}, "edited": false, "score": 1, "creation_date": 1429729345, "post_id": 29800384, "comment_id": 47741127, "body": "Yes that should be fine! <code>flip (&gt;&gt;=)</code> is the same as <code>=&lt;&lt;</code> so you can use it instead."}, {"owner": {"reputation": 165, "user_id": 707095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5429eae896b49ecaa12fb54966970c8?s=128&d=identicon&r=PG", "display_name": "Sam", "link": "https://stackoverflow.com/users/707095/sam"}, "edited": false, "score": 0, "creation_date": 1495397306, "post_id": 29800384, "comment_id": 75222805, "body": "Wow, this is a really great answer. Thank you for the detailed explanation!"}], "tags": [], "owner": {"reputation": 1585, "user_id": 1413081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d8d1f596731eaae04f3ade303d211ca?s=128&d=identicon&r=PG", "display_name": "Reite", "link": "https://stackoverflow.com/users/1413081/reite"}, "is_accepted": false, "score": 5, "last_activity_date": 1429727865, "last_edit_date": 1429727865, "creation_date": 1429712145, "answer_id": 29800384, "question_id": 29785737, "link": "https://stackoverflow.com/questions/29785737/avoiding-errors-caused-by-io-when-talking-to-a-database-inside-of-a-wai-handler/29800384#29800384", "title": "Avoiding Errors caused by IO when talking to a database inside of a WAI handler", "body": "<p>You seem to be having trouble with how to work with the IO type in Haskell. Your question isn't really related to warp, wai or acid-state. I will try to explain it in the context you asked the question.</p>\n\n<p>So the first thing you need to know is that <strong>you cant avoid <code>IO</code></strong> infecting your types when you actually perform <code>IO</code>. Talking to a database is inherently <code>IO</code> operations, so they will be infected. Your first example never actually adds anything to the database. You can go to GHCI and try it:</p>\n\n<pre><code>&gt; let myStrangeId x = let _ = print \"Haskell is fun!\" in x\n</code></pre>\n\n<p>Now check the type of this function:</p>\n\n<pre><code>&gt;:t myStrangeId\nmyStrangeId :: a -&gt; a\n</code></pre>\n\n<p>Now try to run it:</p>\n\n<pre><code>&gt; myStrangeId \"Hello\"\n\"Hello\"\n</code></pre>\n\n<p>As you see, it never actually prints the message, it just returns the argument. So actually the code defined in the let statement is completely dead, it doesn't do anything at all. The same thing is true in your <code>registerUser</code> function.</p>\n\n<p>So, as I stated above, you cant avoid your functions having a <code>IO</code> type because you want to do <code>IO</code> in the functions. This might seem like a problem, but its actually a very good thing because it makes it very explicit which parts of your program are doing <code>IO</code> and which aren't. You need to learn the haskell way which is to combine <code>IO</code> actions together to make a complete program.</p>\n\n<p>If you look at the <code>Application</code> type in <code>Wai</code> you will see that its just a type synonym that looks like this:</p>\n\n<pre><code>type Application = Request -&gt; IO Response\n</code></pre>\n\n<p>When you have finished your program this is the type signature you want to have. As you can see the <code>Response</code> is wrapped in an <code>IO</code> here. </p>\n\n<p>So lets start with your top function <code>authRoutes</code>. It currently has this signature:</p>\n\n<pre><code>authRoutes :: AcidState UserDatabase -&gt; Request -&gt; [Text.Text] -&gt; String -&gt; Response\n</code></pre>\n\n<p>We actually want it to have a slightly different signature, the <code>Response</code> should instead be <code>IO Response</code>:</p>\n\n<pre><code>authRoutes :: AcidState UserDatabase -&gt; Request -&gt; [Text.Text] -&gt; String -&gt; IO Response\n</code></pre>\n\n<p>Wrapping something in <code>IO</code> is pretty easy. Since <code>IO</code> is a monad you can use the <code>return :: a -&gt; IO a</code> function to do it. To get the required signature you could just add <code>return</code> after <code>=</code> in your function definition. This however doesn't accomplish what you want because <code>loginUser</code> and <code>registerUser</code>  also will return a <code>IO Response</code>, so you would end up with some doubly wrapped responses. Instead you can start by wrapping the pure responses:</p>\n\n<pre><code>authRoutes :: AcidState UserDatabase -&gt; Request -&gt; [Text.Text] -&gt; String -&gt; IO Response\nauthRoutes db request path body =\n  case path of\n    (\"register\":rest) -&gt; registerUser db (decode (LB.pack body) :: Maybe (Map.Map String String))\n    (\"login\":rest)    -&gt; loginUser db body\n    (\"access\":rest)   -&gt; return $ resPlain status404 \"Not implemented.\"\n    _                 -&gt; return $ resPlain status404 \"Not Found.\"\n</code></pre>\n\n<p>Notice that I added <code>return</code> before <code>resPlain</code> to wrap them in IO. </p>\n\n<p>Now lets look at <code>registerUser</code>. In fact its very possible to write it how you want to write it. Im going to assume that <code>nextRandom</code> has a signature that looks something like this: <code>nextRandom :: IO something</code>, then you can do:</p>\n\n<pre><code>registerUser :: AcidState UserDatabase -&gt; Maybe (Map.Map String String) -&gt; IO Response\nregisterUser db maybeUserMap =\n  case maybeUserMap of\n    (Just u) -&gt; do\n        uuid &lt;- nextRandom \n        update db (StoreUser (toString uuid) u)\n        return $ resPlain status200 (toString uuid)\n    Nothing  -&gt; return $ resPlain status401 \"Invalid user JSON.\"\n</code></pre>\n\n<p>And your <code>loginUser</code> function only needs some small changes:</p>\n\n<pre><code>loginUser :: AcidState UserDatabase -&gt; String -&gt; IO Response\nloginUser db username = do\n  maybeUserMap &lt;- query db (FetchUser username)\n  case maybeUserMap of\n    (Just u) -&gt; return $ resJSON u\n    Nothing  -&gt; return $ resPlain status401 \"Invalid username.\"\n</code></pre>\n\n<p>So to sum it up, you cant avoid <code>IO</code> infecting your types when you want to actually do <code>IO</code>. Instead you have to embrace it, and wrap your non-IO values in <code>IO</code>. It is best practice to limit the <code>IO</code> the smallest part of your application that is possible. If you can write a function without <code>IO</code> in the signature you should, and then rather wrap it with <code>return</code> later. However its very logical that a <code>loginUser</code> function has to perform some IO, so its not a problem that it has that signature.</p>\n\n<p><em>Edit:</em></p>\n\n<p>So as you said in the comment Wai has changed its application type to:</p>\n\n<pre><code>type Application = Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived\n</code></pre>\n\n<p>You can read about why <a href=\"http://www.yesodweb.com/blog/2014/04/disemboweling-wai\" rel=\"nofollow\">here</a> and <a href=\"http://www.yesodweb.com/blog/2014/05/wai-3-0-alpha\" rel=\"nofollow\">here</a>.</p>\n\n<p>To use your <code>IO Response</code> types with this you can do:</p>\n\n<pre><code>myApp :: Application\nmyApp request respond = do\n    response &lt;- authRoutes db request path body\n    respond response\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1429727865, "creation_date": 1429663463, "last_edit_date": 1429710361, "question_id": 29785737, "link": "https://stackoverflow.com/questions/29785737/avoiding-errors-caused-by-io-when-talking-to-a-database-inside-of-a-wai-handler", "title": "Avoiding Errors caused by IO when talking to a database inside of a WAI handler", "body": "<p>I am writing a web service in haskell using warp, wai, and acid-state. As of now, I have two handler functions that require database interaction, the latter of which is giving me trouble. </p>\n\n<p>The first, is registration:</p>\n\n<pre><code>registerUser :: AcidState UserDatabase -&gt; Maybe (Map.Map String String) -&gt; Response\nregisterUser db maybeUserMap =\n  case maybeUserMap of\n    (Just u) -&gt; let _ = fmap (\\id -&gt; update db (StoreUser (toString id) u)) (nextRandom)\n                in resPlain status200 \"User Created.\"\n    Nothing  -&gt; resPlain status401 \"Invalid user JSON.\"\n</code></pre>\n\n<p>As you can see, I manage to avoid <code>IO</code> from infecting the response by performing the update in the <code>let _ = ..</code>.</p>\n\n<p>In the login function (which currently only returns the user map), I can't avoid <code>IO</code>, because I need to actually send back the result in a response:</p>\n\n<pre><code>loginUser :: AcidState UserDatabase -&gt; String -&gt; Response\nloginUser db username = do\n  maybeUserMap &lt;- (query db (FetchUser username))\n  case maybeUserMap of\n    (Just u) -&gt; resJSON u\n    Nothing  -&gt; resPlain status401 \"Invalid username.\"\n</code></pre>\n\n<p>This causes the following error: </p>\n\n<pre><code>src/Main.hs:40:3:\n    Couldn't match type \u2018IO b0\u2019 with \u2018Response\u2019\n    Expected type: IO (EventResult FetchUser)\n                   -&gt; (EventResult FetchUser -&gt; IO b0) -&gt; Response\n      Actual type: IO (EventResult FetchUser)\n                   -&gt; (EventResult FetchUser -&gt; IO b0) -&gt; IO b0\n    In a stmt of a 'do' block:\n      maybeUserMap &lt;- (query db (FetchUser username))\n    In the expression:\n      do { maybeUserMap &lt;- (query db (FetchUser username));\n           case maybeUserMap of {\n             (Just u) -&gt; resJSON u\n             Nothing -&gt; resPlain status401 \"Invalid username.\" } }\n    In an equation for \u2018loginUser\u2019:\n        loginUser db username\n          = do { maybeUserMap &lt;- (query db (FetchUser username));\n                 case maybeUserMap of {\n                   (Just u) -&gt; resJSON u\n                   Nothing -&gt; resPlain status401 \"Invalid username.\" } }\n\nsrc/Main.hs:42:17:\n    Couldn't match expected type \u2018IO b0\u2019 with actual type \u2018Response\u2019\n    In the expression: resJSON u\n    In a case alternative: (Just u) -&gt; resJSON u\n\nsrc/Main.hs:43:17:\n    Couldn't match expected type \u2018IO b0\u2019 with actual type \u2018Response\u2019\n    In the expression: resPlain status401 \"Invalid username.\"\n    In a case alternative:\n        Nothing -&gt; resPlain status401 \"Invalid username.\"\n</code></pre>\n\n<p>I believe the error is caused by the db query returning an <code>IO</code> value. My first thought was to change <code>Response</code> in the type signature to <code>IO Response</code>, but then the top level function complained as it needs a <code>Response</code>, not an <code>IO Response</code>. </p>\n\n<p>On a similar note, I would have liked to write <code>registerUser</code> like this:</p>\n\n<pre><code>registerUser :: AcidState UserDatabase -&gt; Maybe (Map.Map String String) -&gt; Response\nregisterUser db maybeUserMap =\n  case maybeUserMap of\n    (Just u) -&gt; do uuid &lt;- (nextRandom)\n                   update db (StoreUser (toString uuid) u)\n                   resPlain status200 (toString uuid)\n    Nothing  -&gt; resPlain status401 \"Invalid user JSON.\"\n</code></pre>\n\n<p>But this causes a very similar error.</p>\n\n<p>For completeness, here is the function that calls <code>registerUser</code> and <code>loginUser</code>:</p>\n\n<pre><code>authRoutes :: AcidState UserDatabase -&gt; Request -&gt; [Text.Text] -&gt; String -&gt; Response\nauthRoutes db request path body =\n  case path of\n    (\"register\":rest) -&gt; registerUser db (decode (LB.pack body) :: Maybe (Map.Map String String))\n    (\"login\":rest) -&gt; loginUser db body\n    (\"access\":rest) -&gt; resPlain status404 \"Not implemented.\"\n    _ -&gt; resPlain status404 \"Not Found.\"\n</code></pre>\n\n<p>How can I avoid these IO errors?</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1429662945, "post_id": 29785373, "comment_id": 47701032, "body": "How are you compiling/running this program? (Are you running this in ghci?)"}, {"owner": {"reputation": 1460, "user_id": 3069720, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/989fe1d12842abba35fae55ed2cf98e5?s=128&d=identicon&r=PG&f=1", "display_name": "timeshift117", "link": "https://stackoverflow.com/users/3069720/timeshift117"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1429662999, "post_id": 29785373, "comment_id": 47701047, "body": "Yes ghci. I use :load <i>path</i>.hs then run using :main"}], "answers": [{"comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1429678655, "post_id": 29785691, "comment_id": 47705533, "body": "With <code>ghc</code>, it doesn&#39;t produce any output for me. If I pass <code>interact id</code> instead then it works. Compiler: 7.8.4"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1429687783, "post_id": 29785691, "comment_id": 47710110, "body": "My understanding was that you shouldn&#39;t do <i>anything</i> with a semi-closed handle. As in, once you call a function that semi-closes the handle, you can&#39;t do any normal handle things with that handle anymore."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1429692073, "post_id": 29785691, "comment_id": 47712799, "body": "@MathematicalOrchid Are you able to get any output for this ? I&#39;m confused that this works perfectly fine with <code>interact id</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1429723828, "post_id": 29785691, "comment_id": 47737497, "body": "@Sibi It produces the expected output for me. If I enter <code>2\\n1\\n3\\n\\EOT</code> I get back <code>[1,2,3]\\n\\EOT</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1429728134, "post_id": 29785691, "comment_id": 47740342, "body": "@Sibi (Perhaps you are not closing your input -- on Linux-alikes, this can be done with Ctrl-D.)"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1429729849, "post_id": 29785691, "comment_id": 47741468, "body": "@DanielWagner Thanks, that makes it work. Interestingly for <code>interact id</code>, it seems I don&#39;t need to use <code>Ctrl + D</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1429737409, "post_id": 29785691, "comment_id": 47746113, "body": "@Sibi Sorting requires traversing the entire input, of course. Can&#39;t hope to know what the smallest number is until you&#39;ve at least seen them all."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1429663221, "creation_date": 1429663221, "answer_id": 29785691, "question_id": 29785373, "link": "https://stackoverflow.com/questions/29785373/invalid-argument-hgetcontents-in-haskell/29785691#29785691", "title": "Invalid argument hGetContents in Haskell", "body": "<p><code>interact</code> (semi-)closes the input stream. This does not play well if you are in ghci, which expects to continue using the input stream.</p>\n\n<p>Compile and run your program with</p>\n\n<pre><code>ghc path.hs\npath\n</code></pre>\n\n<p>and this problem should not appear.</p>\n"}], "owner": {"reputation": 1460, "user_id": 3069720, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/989fe1d12842abba35fae55ed2cf98e5?s=128&d=identicon&r=PG&f=1", "display_name": "timeshift117", "link": "https://stackoverflow.com/users/3069720/timeshift117"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 719, "favorite_count": 1, "accepted_answer_id": 29785691, "answer_count": 1, "score": 2, "last_activity_date": 1429663221, "creation_date": 1429661268, "question_id": 29785373, "link": "https://stackoverflow.com/questions/29785373/invalid-argument-hgetcontents-in-haskell", "title": "Invalid argument hGetContents in Haskell", "body": "<p>I'm trying to sort a list of ints and print them out, but am receiving this exception:</p>\n\n<pre><code>Exception: &lt;stdin&gt;: hGetContents: invalid argument (Bad file descriptor)\n</code></pre>\n\n<p>The program:</p>\n\n<pre><code>import Data.List\n\nmain :: IO ()\nmain = do\n    interact maxTri\n    putStrLn \"\"\n\nreadInt :: String -&gt; Int\nreadInt = read\n\nmaxTri :: String -&gt; String\nmaxTri = show .\n    sort .\n    map readInt .\n    words\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1359, "user_id": 3346496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1230f0444613f0e8d74e5a71439d1e?s=128&d=identicon&r=PG&f=1", "display_name": "monocell", "link": "https://stackoverflow.com/users/3346496/monocell"}, "edited": false, "score": 0, "creation_date": 1429683711, "post_id": 29783927, "comment_id": 47707637, "body": "This might be unrelated to what you want to do, but have you looked at the markov-chain package?"}], "answers": [{"comments": [{"owner": {"reputation": 779, "user_id": 3570575, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/30a2edfaac6b765c148187caf22de160?s=128&d=identicon&r=PG&f=1", "display_name": "Halawa", "link": "https://stackoverflow.com/users/3570575/halawa"}, "edited": false, "score": 0, "creation_date": 1429655902, "post_id": 29784165, "comment_id": 47698691, "body": "great idea , but could you please define the first 2 functions as i am stuck ."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 779, "user_id": 3570575, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/30a2edfaac6b765c148187caf22de160?s=128&d=identicon&r=PG&f=1", "display_name": "Halawa", "link": "https://stackoverflow.com/users/3570575/halawa"}, "edited": false, "score": 2, "creation_date": 1429656406, "post_id": 29784165, "comment_id": 47698898, "body": "@Halawa What are you stuck on?  I don&#39;t want to just give you the solution, I want you to figure it out yourself.  Focus just on the first function, do you know of a way to pair elements of two lists together?  If you can pair the elements of two lists together, then dropping the first character of your text leaves you with two lists, including the original text."}, {"owner": {"reputation": 779, "user_id": 3570575, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/30a2edfaac6b765c148187caf22de160?s=128&d=identicon&r=PG&f=1", "display_name": "Halawa", "link": "https://stackoverflow.com/users/3570575/halawa"}, "edited": false, "score": 0, "creation_date": 1429657513, "post_id": 29784165, "comment_id": 47699316, "body": "i see your point of view but the problem is that i am a kind of new to haskell :D so it is a little bit hard for me to do that"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 779, "user_id": 3570575, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/30a2edfaac6b765c148187caf22de160?s=128&d=identicon&r=PG&f=1", "display_name": "Halawa", "link": "https://stackoverflow.com/users/3570575/halawa"}, "edited": false, "score": 1, "creation_date": 1429667139, "post_id": 29784165, "comment_id": 47702307, "body": "@Halawa The first function can be built using <code>zip :: [a] -&gt; [b] -&gt; [(a, b)]</code> combined with <code>tail</code>.  The <code>tail</code> function returns all but the first element of a list, and <code>zip</code> makes tuples by combining two lists element-wise.  So you&#39;d have <code>matchSuccessors text = zip text (tail text)</code>.  Does that help you get started?"}, {"owner": {"reputation": 779, "user_id": 3570575, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/30a2edfaac6b765c148187caf22de160?s=128&d=identicon&r=PG&f=1", "display_name": "Halawa", "link": "https://stackoverflow.com/users/3570575/halawa"}, "edited": false, "score": 0, "creation_date": 1429670153, "post_id": 29784165, "comment_id": 47703141, "body": "i have been trying to solve it for the last 2 hours and you made in one line :D thank you i think it is very hard for me because i am not an expert in the predefined functions in haskell"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 779, "user_id": 3570575, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/30a2edfaac6b765c148187caf22de160?s=128&d=identicon&r=PG&f=1", "display_name": "Halawa", "link": "https://stackoverflow.com/users/3570575/halawa"}, "edited": false, "score": 0, "creation_date": 1429670529, "post_id": 29784165, "comment_id": 47703254, "body": "If you haven&#39;t seen it, check out <a href=\"https://www.fpcomplete.com/hoogle\" rel=\"nofollow noreferrer\">hoogle</a> where you can search for function names, types, or even partial types.  You can search for something like <a href=\"https://www.fpcomplete.com/hoogle?q=String+-%3E+String+-%3E+%5B%28Char%2C+Char%29%5D&amp;env=ghc-7.8-stable-14.09\" rel=\"nofollow noreferrer\"><code>String -&gt; String -&gt; [(Char, Char)]</code></a>, and it brings up the more general <code>zip</code> function first."}, {"owner": {"reputation": 779, "user_id": 3570575, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/30a2edfaac6b765c148187caf22de160?s=128&d=identicon&r=PG&f=1", "display_name": "Halawa", "link": "https://stackoverflow.com/users/3570575/halawa"}, "edited": false, "score": 0, "creation_date": 1429672333, "post_id": 29784165, "comment_id": 47703702, "body": "could you please give me your mail or facebook or anything to contact you ?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 779, "user_id": 3570575, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/30a2edfaac6b765c148187caf22de160?s=128&d=identicon&r=PG&f=1", "display_name": "Halawa", "link": "https://stackoverflow.com/users/3570575/halawa"}, "edited": false, "score": 0, "creation_date": 1429675530, "post_id": 29784165, "comment_id": 47704542, "body": "@Halawa Sorry, no, I don&#39;t pass out my information very much.  You&#39;re welcome to keep asking questions here on SO, now you have several functions that you can ask individual questions about, and there are other places you can get help from the community in general.  The IRC channels are pretty friendly, and reddit.com/r/haskell usually treats newcomers well if it&#39;s a well written question."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 4, "last_activity_date": 1429654630, "creation_date": 1429654630, "answer_id": 29784165, "question_id": 29783927, "link": "https://stackoverflow.com/questions/29783927/occurrence-of-char-with-respect-to-its-neighbor-in-haskell/29784165#29784165", "title": "occurrence of char with respect to its neighbor in haskell", "body": "<p>Think about how you can transform your data, a <code>String</code> into something that can be processed to give you the result you want.  What you're really interested in is pairs of adjacent characters, so your first step would be to write a function which pairs each element with its successor:</p>\n\n<pre><code>matchSuccessors :: String -&gt; [(Char, Char)]\nmatchSuccessors text = undefined\n</code></pre>\n\n<p>Then you want to group these together by what the first element is, such as <code>'0'</code>.  For this you'll want to look at <code>sort/sortBy</code> and <code>group/groupBy</code> in <code>Data.List</code>:</p>\n\n<pre><code>organizeSuccessors :: [(Char, Char)] -&gt; [[(Char, Char)]]\norganizeSuccessors succs = undefined\n</code></pre>\n\n<p>At this point you should have something like</p>\n\n<pre><code>&gt; organizeSuccessors (matchSuccessors \"abababacacabac\")\n[[('a','b'),('a','b'),('a','b'),('a','b')],\n [('a','c'),('a','c'),('a','c')],\n [('b','a'),('b','a'),('b','a'),('b','a')],\n [('c','a'),('c','a')]\n]\n</code></pre>\n\n<p>(whitespace added for readability)</p>\n\n<p>Now you can very easily measure the length of each, pairing that with what element it was:</p>\n\n<pre><code>countSuccessorGroups :: [[(Char, Char)]] -&gt; [((Char, Char), Int)]\ncountSuccessorGroups grps = map (\\grp -&gt; (head grp, length grp)) grps\n</code></pre>\n\n<p>So now you would see</p>\n\n<pre><code>&gt; countSuccessorGroups $ organizeSuccessors $ matchSuccessors \"abababacacabac\"\n[(('a', 'b'), 4),\n (('a', 'c'), 3),\n (('b', 'a'), 4),\n (('c', 'a'), 2)\n]\n</code></pre>\n\n<p>Now armed with your knowledge of <code>sortBy</code> and <code>groupBy</code> you should be able to convert this into what you need:</p>\n\n<pre><code>organizeByFirstLetter :: [((Char, Char), Int)] -&gt; [(Char, [(Int, Char)])]\norganizeByFirstLetter succgrps = undefined\n</code></pre>\n\n<p>So your entire program would be</p>\n\n<pre><code>function\n    = organizeByFirstLetter\n    $ countSuccessorGroups\n    $ organizeSuccessors\n    $ matchSuccessors\n    $ test\n</code></pre>\n\n<p>You can also break up <code>organizeByFirstLetter</code> into multiple steps as necessary.</p>\n"}], "owner": {"reputation": 779, "user_id": 3570575, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/30a2edfaac6b765c148187caf22de160?s=128&d=identicon&r=PG&f=1", "display_name": "Halawa", "link": "https://stackoverflow.com/users/3570575/halawa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1429654630, "creation_date": 1429653567, "question_id": 29783927, "link": "https://stackoverflow.com/questions/29783927/occurrence-of-char-with-respect-to-its-neighbor-in-haskell", "title": "occurrence of char with respect to its neighbor in haskell", "body": "<p>i have a string something like that</p>\n\n<pre><code>test = \"fDfDfadsptupauOasufDfDfadsptupausapasdfogfdifdsudsaufuffxDfDfDfDfDfDfadsptupauOasufDfDfadsptupausap\"\n</code></pre>\n\n<p>and i would like to get the number of the occurrence for example of the char '0' with respect to the char coming after the '0' , so for example for the string test when i call my function it should give</p>\n\n<pre><code> ('0',[(8,'w'),(2,'q')])\n</code></pre>\n\n<p>which means that char '0' occurs 8 times in the form \"0w\" and 2 times in the form \"2q\"</p>\n\n<p>until now i manged to the total occurrence of '0' which is 10 but i cannot get it with respect to its neighbor , my code</p>\n\n<pre><code>freq c l = filter (==c) l\nfunction::[(Char ,Int)]\nfunction = [('0' , sum (map length (map (freq '0') test)))]\n</code></pre>\n\n<p>note my output should be of the type</p>\n\n<pre><code>function :: [(Char,[(Int,Char)])\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 2, "last_activity_date": 1429706647, "creation_date": 1429706647, "answer_id": 29797986, "question_id": 29783361, "link": "https://stackoverflow.com/questions/29783361/yesod-book-example-chat-and-scaffolding/29797986#29797986", "title": "Yesod book example chat and scaffolding", "body": "<p>You actually got almost the entire way there. I think you just need to change the line to:</p>\n\n<pre><code>getChat &lt;- fmap Chat newChan\n</code></pre>\n\n<p>Alternatively, if you're not familiar with he <code>fmap</code> function yet, you can use do notation and get:</p>\n\n<pre><code>chan &lt;- newChan\nlet getChat = Chat chan\n</code></pre>\n"}], "owner": {"reputation": 682, "user_id": 3421913, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b267474c6f0ce7338d7bcd3ca14d9648?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastien", "link": "https://stackoverflow.com/users/3421913/sebastien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 29797986, "answer_count": 1, "score": 2, "last_activity_date": 1429706647, "creation_date": 1429651322, "last_edit_date": 1429651521, "question_id": 29783361, "link": "https://stackoverflow.com/questions/29783361/yesod-book-example-chat-and-scaffolding", "title": "Yesod book example chat and scaffolding", "body": "<p>I'm trying to make the chat example from the <a href=\"https://rads.stackoverflow.com/amzn/click/com/1491915595\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">Yesod book</a> working in the scaffolding site.</p>\n\n<p>I think I've corrected almost all I had to correct, but all of that is completely new to me (it's my first \"real\" Haskell project) and I'm not very confident in all my modifications; moreover, I'm really stuck at the point 7. Could you comment all the following points if necessary, and helping me for the 7. (in <strong>bold</strong> some questions/remarks)?</p>\n\n<ol>\n<li>Copy/paste the Chat.hs and Chat/Data.hs in the root of my site,</li>\n<li>add <code>import Chat as Import</code> and <code>import Chat.Data as Import</code> to Import.NoFoundation,</li>\n<li>add import of IO, Bool, return, Maybe(Nothing), ($) in Data.hs, since the extension NoImplicitPrelude is on <strong>Seems very clumsy... Do we have to import all the standard operators on each new file?</strong></li>\n<li>in Fundation.hs, add <code>getChat</code> in the <code>App</code> record (after <code>appHttpManager</code> and <code>appLogger</code>)</li>\n<li><p>in Fundation.hs, add YesodChat instance for App: I had to modify the <code>getUserName</code> on the <code>Just uid</code> case (in the original example of Chat, it was just <code>Just uid -&gt; return uid</code>):</p>\n\n<pre><code>        Just uid -&gt; do\n        muser &lt;- runDB  $ get uid\n        case muser of\n            Nothing -&gt; error \"uid not in the DB\"\n            Just user -&gt;  return $ userIdent user\n</code></pre>\n\n<p><strong>This seems very long and nested... Can we do better?</strong></p></li>\n<li>In <code>Fundation.hs</code>, add <code>chatWidget ChatR</code> after the line <code>pc &lt;-  widgetToPageContent $ do</code> in the <code>defaultLayout</code> definition.</li>\n<li><p>Now, I have the following warning :  </p>\n\n<pre><code>Application.hs:60:36: Warning:\n\nFields of \u2018App\u2019 not initialised: getChat\nIn the expression: App {..}\n</code></pre>\n\n<p>I think I have to write something like <code>getChat &lt;- newChan &gt;&gt;=Chat</code> after the <code>appLogger &lt;- newStdoutLoggerSet defaultBufSize &gt;&gt;= makeYesodLogger</code> and <code>appStatic &lt;- ...</code> in the <code>makeFundation</code> definition, but the type doesn't match. <strong>I'm a totally lost here, I don't really understand how this function <code>makeFundation</code> works.</strong></p></li>\n</ol>\n"}, {"tags": ["haskell", "instance", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 3, "creation_date": 1429654433, "post_id": 29783408, "comment_id": 47698053, "body": "For <code>2.0</code> you need the <code>Fractional</code> class and its <code>fromRational</code> method too."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 9, "last_activity_date": 1429654572, "last_edit_date": 1495542184, "creation_date": 1429651508, "answer_id": 29783408, "question_id": 29783360, "link": "https://stackoverflow.com/questions/29783360/modify-type-of-number-with-haskell/29783408#29783408", "title": "Modify type of number with Haskell", "body": "<p>You need to finish the implementation of <code>Num MathExpress</code>:</p>\n\n<pre><code>instance Num MathExpress where\n    fromInteger n = MathDouble (fromInteger n)\n    ...\n</code></pre>\n\n<p>The <code>fromInteger</code> methods is what allows numeric literals to be polymorphic, so <code>1</code> can be interpreted as <code>Int</code>, <code>Integer</code>, <code>Double</code>, <code>Complex</code>, or in this case <code>MathExpress</code>.  If you want to have a number like <code>2.0</code> or <code>42.7</code> be interpreted as a <code>MathExpress</code> then you'll also need to implement the <code>Fractional</code> typeclass (<a href=\"https://stackoverflow.com/questions/29783360/modify-type-of-number-with-haskell/29783408?noredirect=1#comment47698053_29783408\">as noted by @\u00d8rjanJohansen</a>), and in particular the <code>fromRational</code> method, which can be implemented essentially identically to <code>fromInteger</code>.</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 29783408, "answer_count": 1, "score": 4, "last_activity_date": 1429654572, "creation_date": 1429651321, "question_id": 29783360, "link": "https://stackoverflow.com/questions/29783360/modify-type-of-number-with-haskell", "title": "Modify type of number with Haskell", "body": "<p>I'm working on a small symbolic library to perform some calculation with Haskell. </p>\n\n<p>To represent symbolic operation I created this data type : </p>\n\n<pre><code>data MathExpress =                        -- A math expression\n       MathDouble Double                  -- Represent a number      \n     | MathAdd MathExpress MathExpress    -- Add 2 expressions \n     | MathSoust MathExpress MathExpress  -- Subtract 2 expressions\n     | ...\n</code></pre>\n\n<p>I managed to create a <code>Num</code> instance to be able to use the operator <code>+</code> and <code>-</code> on my type <code>MathExpress</code>. </p>\n\n<pre><code>instance Num MathExpress where\n  (+) (expa) (expb)  = MathAdd expa expb\n  (-) (expa) (expb)  = MathSoust expa expb\n  ...\n</code></pre>\n\n<p>and when I write : </p>\n\n<pre><code>( MathExpress expression ) * MathDouble 2.0\n</code></pre>\n\n<p><strong>It's working !</strong></p>\n\n<p>Now, I would like to be able to use <code>+</code> and <code>-</code> with numbers too (<code>Double</code> or <code>Int</code>) to write more simply : </p>\n\n<pre><code>( MathExpress expression ) * 2.0\n</code></pre>\n\n<p>Is it possible (by creating an instance or anything) to make Haskell <strong>infer</strong> <code>2.0</code> as a <code>MathDouble 2.0</code> ?</p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 1409, "user_id": 1876583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdf666782fb48c703f4fae045f681c13?s=128&d=identicon&r=PG", "display_name": "WolfeFan", "link": "https://stackoverflow.com/users/1876583/wolfefan"}, "is_accepted": false, "score": 3, "last_activity_date": 1429651432, "creation_date": 1429651432, "answer_id": 29783388, "question_id": 29783113, "link": "https://stackoverflow.com/questions/29783113/how-to-return-a-function-calling-another-function-based-on-the-input/29783388#29783388", "title": "How to return a function calling another function based on the input?", "body": "<p>See if this does what you want:</p>\n\n<pre><code>switchFirstEgg eggCarton = \n  switchedCarton\n  where switchedCarton = case (eggCarton 1) of\n                         0 -&gt; \\position -&gt; if position == 1\n                                           then 2\n                                           else eggCarton position\n                         1 -&gt; \\position -&gt; if position == 1\n                                           then 0\n                                           else eggCarton position\n                         2 -&gt; \\position -&gt; if position == 1\n                                           then 1\n                                           else eggCarton position\n                         _ -&gt; \\position -&gt; eggCarton position\n</code></pre>\n\n<p>You can only have one <code>where</code> clause in a function definition (although function definitions within <code>where</code> clauses can have their own where clauses).</p>\n"}, {"comments": [{"owner": {"reputation": 1409, "user_id": 1876583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdf666782fb48c703f4fae045f681c13?s=128&d=identicon&r=PG", "display_name": "WolfeFan", "link": "https://stackoverflow.com/users/1876583/wolfefan"}, "edited": false, "score": 1, "creation_date": 1429652734, "post_id": 29783561, "comment_id": 47697278, "body": "I disagree that replacing <code>eggCarton</code> with <code>ec</code> and <code>switchedCarton</code> with <code>sc</code> contributes to readability. Otherwise, this is a good answer."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1409, "user_id": 1876583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdf666782fb48c703f4fae045f681c13?s=128&d=identicon&r=PG", "display_name": "WolfeFan", "link": "https://stackoverflow.com/users/1876583/wolfefan"}, "edited": false, "score": 1, "creation_date": 1429653106, "post_id": 29783561, "comment_id": 47697456, "body": "@WolfeFan: well, in this case the original version was very hard to read simply due to its enourmous width. It&#39;s certainly not always a good idea to shorten down variables to two letters, but any name that&#39;s written out as often as eight times <i>should</i> be kept short (or at least locally aliased to something short)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1429656053, "post_id": 29783561, "comment_id": 47698757, "body": "Nice answer. Note that the very last answer will crash if <code>pos</code> is <code>1</code> and <code>ec 1</code> is <code>3</code>, unlike the previous alternatives, since the case is non exhaustive. Of course, one can add <code>_ -&gt; ec pos</code> to the case to prevent that."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1429656699, "post_id": 29783561, "comment_id": 47699011, "body": "@chi: right. Or <code>n -&gt; n</code>, which I&#39;d prefer (since it only evaluates <code>ec pos \u2261 ec 1</code> once). Added to answer."}, {"owner": {"reputation": 127, "user_id": 4288004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c71a13ea10117773c01ac54bd2ca2a57?s=128&d=identicon&r=PG&f=1", "display_name": "xuiqzy", "link": "https://stackoverflow.com/users/4288004/xuiqzy"}, "edited": false, "score": 0, "creation_date": 1430498646, "post_id": 29783561, "comment_id": 48101662, "body": "Thanks for the long explanation, that helped a lot! :) But I really had a harder time understanding it with these variable names ;) You can change it back to the longer ones if you like or I can do it as I think it would be easier for others, too! Reducing the indentation was indeed helping readability."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1430499958, "post_id": 29783561, "comment_id": 48102348, "body": "Well, in the final version I <i>could</i> make the variable names longer again, but I would still prefer the abbreviated names. For a small scope like this, there&#39;s no need for the names themselves to be very descriptive, just unambiguous. It&#39;s not the purpose of a parameter variable name to <i>explain what the parameter is there for</i>, that should be clarified int the type signature (which is, after all, the only thing that appears in interface docs)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1429656662, "last_edit_date": 1429656662, "creation_date": 1429652190, "answer_id": 29783561, "question_id": 29783113, "link": "https://stackoverflow.com/questions/29783113/how-to-return-a-function-calling-another-function-based-on-the-input/29783561#29783561", "title": "How to return a function calling another function based on the input?", "body": "<p>First let's make this somewhat readable...</p>\n\n<pre><code>switchFirstEgg ec\n     = if ec 1 == 0\n        then sc where sc pos = if pos == 1\n                                then 2\n                                else ec pos\n        else if ec 1 == 1\n              then sc where sc pos = if pos == 1\n                                      then 0\n                                      else ec pos\n              else if ec 1 == 2\n                    then sc where sc pos = if position == 1\n                                            then 1\n                                            else ec pos\n                    else sc where sc pos = ec pos\n</code></pre>\n\n<p>Now. <code>where</code> can only be used once per <em>definition</em>, i.e. after you wrote <code>switchFirstEgg _ = ...</code> you can follow a <code>where</code> which is valid for everything after that <code>=</code>. Or, you could more locally use a where after one of those definitions of <code>sc</code>. But you can't stick it anywhere in the middle of your code, like in an <code>if</code> branch.</p>\n\n<p>The very similar <code>let</code> construct does allow this, so the easiest translation of what you attempted would be</p>\n\n<pre><code>switchFirstEgg ec\n     = if ec 1 == 0\n        then let sc pos = if pos == 1 then 2\n                                      else ec pos\n             in sc\n        else if ec 1 == 1\n              then let sc pos = if pos == 1 then 0\n                                            else ec pos\n                   in sc\n              else if ec 1 == 2\n                    then let sc pos = if pos == 1 then 1\n                                                  else ec pos\n                         in sc\n                    else let sc pos = ec pos\n                         in sc\n</code></pre>\n\n<p>but that's clunky. You don't really need to define <code>sc</code> with a name if it's used only once, immediately after the definition. That's a clear application for lambdas:</p>\n\n<pre><code>switchFirstEgg ec\n     = if ec 1 == 0\n        then \\pos -&gt; if pos == 1 then 2\n                                 else ec pos\n        else if ec 1 == 1\n              then \\pos -&gt; if pos == 1 then 0\n                                       else ec pos\n              else if ec 1 == 2\n                    then \\pos -&gt; if pos == 1 then 1\n                                             else ec pos\n                    else \\pos -&gt; ec pos\n</code></pre>\n\n<p>Better, but this chain of <code>if</code> is obviously better expressed as a single collection of <code>case</code> clauses.</p>\n\n<pre><code>switchFirstEgg ec = case ec 1 of\n     0 -&gt; \\pos -&gt; if pos == 1 then 2\n                              else ec pos\n     1 -&gt; \\pos -&gt; if pos == 1 then 0\n                              else ec pos\n     2 -&gt; \\pos -&gt; if pos == 1 then 1\n                              else ec pos\n     _ -&gt; \\pos -&gt; ec pos\n</code></pre>\n\n<p>At this point it becomes clear that the <code>pos</code> bindings are pretty uniform, so we can just move them all one level up:</p>\n\n<pre><code>switchFirstEgg ec pos = case ec 1 of\n     0 -&gt; if pos == 1 then 2\n                      else ec pos\n     1 -&gt; if pos == 1 then 0\n                      else ec pos\n     2 -&gt; if pos == 1 then 1\n                      else ec pos\n     _ -&gt; ec pos\n</code></pre>\n\n<p>There we have <code>if</code>s immediately following pattern matches. This is now a perfect fit for <em>guards</em>:</p>\n\n<pre><code>switchFirstEgg ec pos = case ec 1 of\n     0 | pos == 1  -&gt; 2\n     1 | pos == 1  -&gt; 0\n     2 | pos == 1  -&gt; 1\n     _ -&gt; ec pos\n</code></pre>\n\n<p>Alternatively, you can just match immediately on <code>pos</code>, before even considering <code>ec 1</code>:</p>\n\n<pre><code>switchFirstEgg ec 1 = case ec 1 of\n     0   -&gt; 2\n     1   -&gt; 0\n     2   -&gt; 1\n     n   -&gt; n\nswitchFirstEgg ec pos = ec pos\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 4288004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c71a13ea10117773c01ac54bd2ca2a57?s=128&d=identicon&r=PG&f=1", "display_name": "xuiqzy", "link": "https://stackoverflow.com/users/4288004/xuiqzy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 29783561, "answer_count": 2, "score": 1, "last_activity_date": 1429656662, "creation_date": 1429650359, "question_id": 29783113, "link": "https://stackoverflow.com/questions/29783113/how-to-return-a-function-calling-another-function-based-on-the-input", "title": "How to return a function calling another function based on the input?", "body": "<p>I'm really quite new to Haskell and I need to return a function that \"has modified\" the inputted function.</p>\n\n<p>I guess you cant copy and modify the original function (based on some condition) so you have to implement own behaviour directly and then call the original function?</p>\n\n<p>This is my approach:</p>\n\n<pre><code>switchFirstEgg eggCarton = if eggCarton 1 == 0\n                                then switchedCarton where switchedCarton position = if position == 1 then 2 else eggCarton position\n                                else if eggCarton 1 == 1\n                                        then switchedCarton where switchedCarton position = if position == 1 then 0 else eggCarton position\n                                        else if eggCarton 1 == 2\n                                                then switchedCarton where switchedCarton position = if position == 1 then 1 else eggCarton position\n                                                else switchedCarton where switchedCarton position = eggCarton position\n</code></pre>\n\n<p>The error I get from the GHCI is </p>\n\n<blockquote>\n  <p>haskell/eggcartons.hs:42:54: parse error on input \u2018where\u2019</p>\n</blockquote>\n\n<p>which points to the first word after the first <code>where</code>.</p>\n\n<p>(For reference: I also tried to set more brackets here <a href=\"http://pastebin.com/2wTqAqpm\" rel=\"nofollow\">http://pastebin.com/2wTqAqpm</a> and I tried doing it with guards <a href=\"http://pastebin.com/RVm28Y7n\" rel=\"nofollow\">http://pastebin.com/RVm28Y7n</a>, but that's only making it worse without thouroughly understanding that? At least guards worked for me here <a href=\"http://pastebin.com/uQeFwLU5\" rel=\"nofollow\">http://pastebin.com/uQeFwLU5</a>)</p>\n\n<p>I searched for returning functions in Haskell but I only got a few random info that I used with the <code>where</code> things I have done.</p>\n\n<p>Is my concept right? Is it only a minor mistake?</p>\n\n<p>Any help on further reading regarding the syntax of returning functions is also much appreciated!</p>\n"}, {"tags": ["haskell", "shake-build-system"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 1, "last_activity_date": 1429676057, "creation_date": 1429676057, "answer_id": 29787649, "question_id": 29782060, "link": "https://stackoverflow.com/questions/29782060/is-shake-suitable-for-building-a-semi-automated-tool-for-human-users/29787649#29787649", "title": "Is Shake suitable for building a semi-automated tool for human users?", "body": "<p>Since your action doesn't produce a file, it needs to be marked as a <a href=\"https://hackage.haskell.org/package/shake-0.15/docs/Development-Shake.html#v:phony\" rel=\"nofollow\"><code>phony</code></a> rule:</p>\n\n<pre><code>import Development.Shake\nimport Control.Monad (unless)\n\nmain = shakeArgs shakeOptions $ do\n    want [\".finished\"]\n    phony \".finished\" $ do\n        ok &lt;- fmap (== \"yes\") $ liftIO $ putStrLn \"You sure?\" &gt;&gt; getLine\n        unless ok $ fail \"Your commitment to the Great War is lacking!\"\n        liftIO $ putStrLn \"Missiles fired!\"\n</code></pre>\n\n<p>Example sessions:</p>\n\n<pre><code>$ runhaskell shake-phony.hs\nYou sure?\nyes\nMissiles fired!\nBuild completed in 0:29m\n\n$ runhaskell shake-phony.hs\nYou sure?\nno\nError when running Shake build system:\n* .finished\nYour commitment to the Great War is lacking!\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1429685296, "post_id": 29789727, "comment_id": 47708556, "body": "Just make sure you don&#39;t start executing the &quot;repopulate the Earth&quot; action in advance as well. That could turn... awkward."}], "tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": false, "score": 1, "last_activity_date": 1429685100, "creation_date": 1429685100, "answer_id": 29789727, "question_id": 29782060, "link": "https://stackoverflow.com/questions/29782060/is-shake-suitable-for-building-a-semi-automated-tool-for-human-users/29789727#29789727", "title": "Is Shake suitable for building a semi-automated tool for human users?", "body": "<p>The smallest fix to your code is to use <code>phony</code> like @Cactus suggests. An alternative is to use <a href=\"https://hackage.haskell.org/package/shake-0.15/docs/Development-Shake.html#v:action\" rel=\"nofollow\"><code>action</code></a> directly:</p>\n\n<pre><code>import Development.Shake\nimport Control.Monad (unless)\n\nmain = shakeArgs shakeOptions $ do\n    action $ do\n        ok &lt;- fmap (== \"yes\") $ liftIO $ putStrLn \"You sure?\" &gt;&gt; getLine\n        unless ok $ fail \"Your commitment to the Great War is lacking!\"\n        liftIO $ putStrLn \"Missiles fired!\"\n</code></pre>\n\n<p>If instead of running the fire missiles at any point during the build, you actually want to run it at the end (after you have built the missiles and stocked up on tin cans), you can write:</p>\n\n<pre><code>main = do\n    shakeArgs shakeOptions $ do\n        ...normal build rules go here...\n    ok &lt;- fmap (== \"yes\") $ putStrLn \"You sure?\" &gt;&gt; getLine\n    unless ok $ fail \"Your commitment to the Great War is lacking!\"\n    putStrLn \"Missiles fired!\"\n</code></pre>\n\n<p>Here you are using normal Haskell to fire the missiles, after running the Shake build.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1429685100, "creation_date": 1429646701, "last_edit_date": 1429675763, "question_id": 29782060, "link": "https://stackoverflow.com/questions/29782060/is-shake-suitable-for-building-a-semi-automated-tool-for-human-users", "title": "Is Shake suitable for building a semi-automated tool for human users?", "body": "<p>How can I make script that fill perform an \"external\" action once every build?</p>\n\n<pre><code>import Development.Shake\n\nmain = shakeArgs shakeOptions $ do\n    want [\".finished\"]\n    \".finished\" %&gt; \\out -&gt; do\n      liftIO $ putStrLn \"You sure?\" &gt;&gt; getLine &gt;&gt; putStrLn \"Missiles fired!\"\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ runhaskell Main.hs\nYou sure?\nno\nMissiles fired!\nError when running Shake build system:\n* .finished\nError, rule \".finished\" failed to build file:\n  .finished\n</code></pre>\n"}, {"tags": ["haskell", "inline", "number-crunching"], "comments": [{"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1429645979, "post_id": 29781618, "comment_id": 47693718, "body": "Style side-question: In the <code>integralPart = </code> line, would it not be more readable if he wrote <code>(integrator err) fun 0 1</code>? (With brackets)?"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1429646595, "post_id": 29781618, "comment_id": 47694060, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/9709823/is-there-any-reason-not-to-use-the-inlinable-pragma-for-a-function\">Is there any reason not to use the INLINABLE pragma for a function?</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1429646721, "post_id": 29781618, "comment_id": 47694137, "body": "I&#39;m not an expert on this, but I&#39;d follow this recipe. 1) Profile to be really sure this is a performance bottleneck. 2) Check GHC Core (-O2) to see if this is already inlined. 3) Experiment with inlining/LLVM/etc and see what happens (criterion might help here)."}, {"owner": {"reputation": 1064, "user_id": 12153248, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-f7ubefVLzQg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdOhhV81djlo9daQq8Jy-mYdaQz5A/photo.jpg?sz=128", "display_name": "Ari Fordsham", "link": "https://stackoverflow.com/users/12153248/ari-fordsham"}, "edited": false, "score": 0, "creation_date": 1603734449, "post_id": 29781618, "comment_id": 114124199, "body": "You might also want to experiment with <a href=\"https://ghc.gitlab.haskell.org/ghc/doc/users_guide/exts/strict.html\" rel=\"nofollow noreferrer\">strictness bang patterns</a>"}], "owner": {"reputation": 1144, "user_id": 4245823, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-czWZC6KwKYU/AAAAAAAAAAI/AAAAAAAAAYI/yBtPVyZjU4M/photo.jpg?sz=128", "display_name": "felipez", "link": "https://stackoverflow.com/users/4245823/felipez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 877, "favorite_count": 2, "answer_count": 0, "score": 11, "last_activity_date": 1429661765, "creation_date": 1429645177, "last_edit_date": 1495542852, "question_id": 29781618, "link": "https://stackoverflow.com/questions/29781618/inline-or-not-to-inline-in-haskell", "title": "Inline or not to inline in Haskell", "body": "<p>I have several number-crunching operations that account for a good portion of the CPU time. One example of such operations is this function:</p>\n\n<pre><code>import Data.Number.Erf\nimport Math.Gamma\nimport Math.GaussianQuadratureIntegration as GQI\n\n-- Kummer's' \"1F1\" a.k.a M(a,b,z) Confluent Hypergeometric function\n-- Approximation by the Gaussian Quadrature method from 128 up to 1024 points of resolution\nkummer :: Double -&gt; Double -&gt; Double -&gt; Double -&gt; Double\nkummer a b z err = gammaFactor * integralPart\n    where\n        gammaFactor       = (gamma b) / (gamma a * gamma (b-a))\n        integralPart      = (integrator err) fun 0 1\n        fun               = (\\t -&gt; (e ** (z * t)) * (1-t) ** (b-a-1) * t ** (a-1))\n        e                 = exp 1\n        integrator err\n                | err &gt; 0.1   =  GQI.nIntegrate128\n                | err &gt; 0.01  =  GQI.nIntegrate256\n                | err &gt; 0.001 =  GQI.nIntegrate512\n                | otherwise   = GQI.nIntegrate1024\n</code></pre>\n\n<p>SO, I was wondering if there are some rules to follow about when a function should be INLINE to improve performance. REPA Authors suggest to:</p>\n\n<blockquote>\n  <p>Add INLINE pragmas to all leaf-functions in your code, especially ones\n  that compute numeric results. Non-inlined lazy function calls can cost\n  upwards of 50 cycles each, while each numeric operator only costs one\n  (or less). Inlining leaf functions also ensures they are specialized\n  at the appropriate numeric types.</p>\n</blockquote>\n\n<p>Are these indications also applicable to the rest of the numerical calculations or only to array computations? or is there a more general guide to decide when a function should be inline?</p>\n\n<p>Notice that this post: <a href=\"https://stackoverflow.com/questions/9709823/is-there-any-reason-not-to-use-the-inlinable-pragma-for-a-function\">Is there any reason not to use the INLINABLE pragma for a function?</a> does not address directly the question about if the hints provided by the programmer truly help the compiler to optimize the code.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1429646665, "post_id": 29781439, "comment_id": 47694107, "body": "what is <code>=~</code>? I mean I would google for it if that were possible...."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1429647075, "post_id": 29781439, "comment_id": 47694306, "body": "Does this answer the question, even if it&#39;s not specific to regexp? <a href=\"http://stackoverflow.com/a/28529498/3234959\">stackoverflow.com/a/28529498/3234959</a>"}, {"owner": {"reputation": 1485, "user_id": 2895784, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24a63ac1e68375fbed6619cdce8c119a?s=128&d=identicon&r=PG", "display_name": "kazagistar", "link": "https://stackoverflow.com/users/2895784/kazagistar"}, "reply_to_user": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 1, "creation_date": 1429647897, "post_id": 29781439, "comment_id": 47694719, "body": "@user2225104 It is the entry point for basically the entire regular expression API. It is generic on return type and is <a href=\"http://haddocks.fpcomplete.com/fp/7.8/20140916-162/regex-base/Text-Regex-Base-RegexLike.html#t:RegexContext\" rel=\"nofollow noreferrer\">somewhat complex</a>. Usually the best way to find out is to use <a href=\"https://www.fpcomplete.com/hoogle?q=%3D~&amp;env=ghc-7.8-stable-14.09\" rel=\"nofollow noreferrer\">hoogle</a>, and then deciding from the imports or package which one is relevant."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1429647978, "post_id": 29781439, "comment_id": 47694770, "body": "More concretely, you can write a list of individual matchers, returning <code>Just something</code> on success and <code>Nothing</code> on failure. Once you have a <code>[Maybe whatever]</code> use <code>msum</code> to get the first <code>Just</code> (or <code>Nothing</code> if all failed)."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1429648462, "post_id": 29781439, "comment_id": 47695032, "body": "@chi  (about the SO link) That work indeed to just check if regexp are matched, but the problem is to do pattern matching to be able to use the captures (groups) in my example."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1429649820, "post_id": 29781439, "comment_id": 47695877, "body": "@chi <code>msum</code> solution. That&#39;s the way I&#39;m going but I would prefer something <i>nicer</i> visually."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1429654585, "post_id": 29781439, "comment_id": 47698129, "body": "You can use groups and pattern matching, roughly as <code>msum [ do let (...,groups) = string =~ regexp ; guard (not . null $ groups) ; return (f groups) , otherbranch, ... ]</code>. I agree that this is not terribly nice visually. Visually the Alternative in your post is nicer to me."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1429689613, "post_id": 29781439, "comment_id": 47711261, "body": "@chi could you make answer from your msum example and I&#39;ll accept it."}], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1429689826, "post_id": 29784598, "comment_id": 47711395, "body": "Note that my question is not about just checking if any of the regexp matches but (they are nicer way to do so) but allow a different response according to which regexp succeed (and also uses capture)."}], "tags": [], "owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "is_accepted": false, "score": 0, "last_activity_date": 1429713202, "last_edit_date": 1429713202, "creation_date": 1429656753, "answer_id": 29784598, "question_id": 29781439, "link": "https://stackoverflow.com/questions/29781439/how-to-to-do-regexp-switch-in-haskell/29784598#29784598", "title": "How to to do regexp switch in haskell", "body": "<p>While for those used to Ruby, the reference syntax you give might appear convenient, it might not be as clear to people who read the code and never saw Ruby before.</p>\n\n<p>So, without sacrificing conciseness and adding expressiveness, I would suggest you write yourself a function - assuming you use this in more than one spot of your program, it will pay off. And the name of the function improves readability.</p>\n\n<p>You might want to tweak the code below so you get not <code>String</code> but another type, useful to your subsequent processing. (Groups etc.). I did not bother, never having used Haskel regular expressions before to find out what exactly you need for your use case.</p>\n\n<pre><code>import Data.Maybe\nimport Text.Regex.Base\nimport Text.Regex.Posix\n\nfirstMatch :: [(String, (String -&gt; String))] -&gt; String -&gt; Maybe String\nfirstMatch [] text = Nothing\nfirstMatch (x:xs) text =\n    let (ex,a) = x in\n    let r = text =~ ex :: String in\n    if \"\" == r then firstMatch xs text else Just (a r)\n\nregex1 = \"Hello|hello\"\nregex2 = \"world|World\"\nregex3 = \"\\\\w*[\\\\s]*\\\\w*\"\n\nmain :: IO ()\nmain = print (firstMatch [(regex1,hello),(regex2,world),(regex3,twoWords)] \"Hello World\")\n    where \n        -- hello, world, twoWords are the regexN specific actions...\n        hello ms = ms\n        world ms = ms\n        twoWords ms = ms\n</code></pre>\n\n<p>Result:</p>\n\n<blockquote>\n  <p>Just \"Hello\"</p>\n</blockquote>\n\n<p>EDIT: Added continuation style specific handling depending on which regex matched.</p>\n"}, {"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1429703999, "post_id": 29791635, "comment_id": 47721797, "body": "Note you can use <code>=~~</code> instead of <code>=~</code> which return a Monadic answer, and so remove the need of <code>guard</code>. I accept the answer anyway as It&#39;s a good example of what <code>guard</code> is for ;-)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1429704596, "last_edit_date": 1429704596, "creation_date": 1429690867, "answer_id": 29791635, "question_id": 29781439, "link": "https://stackoverflow.com/questions/29781439/how-to-to-do-regexp-switch-in-haskell/29791635#29791635", "title": "How to to do regexp switch in haskell", "body": "<p>Here's an attempt:</p>\n\n<pre><code>fromJust $ msum \n     [ guard (str =~ regexp1) &gt;&gt;\n         return (result 1)\n     , let (_,_,_,groups) = str =~ regexp2 in\n       guard (not $ null groups) &gt;&gt;\n         return (result2 groups)\n     , ... ]\n</code></pre>\n\n<p>You might have to add a few type annotations here and there, to tell GHC how to disambiguate the heavily overloaded <code>(=~)</code>.</p>\n\n<p>The code above assumes there is a last \"catch-all\" case (the final <code>else</code>), otherwise <code>fromJust</code> will crash. As a more safe alternative, move the catch-all at the beginning and use <code>fromMaybe catchAll</code> instead.</p>\n\n<p>Further alternatives to consider: you can use <code>do</code>; you can use <code>&lt;|&gt;</code> instead of <code>msum</code>ming a list; you can use <code>=~~</code> to return a monadic result and avoid <code>guard</code> (as @mb14 points out below).</p>\n"}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 29791635, "answer_count": 2, "score": 2, "last_activity_date": 1429713202, "creation_date": 1429644564, "last_edit_date": 1592644375, "question_id": 29781439, "link": "https://stackoverflow.com/questions/29781439/how-to-to-do-regexp-switch-in-haskell", "title": "How to to do regexp switch in haskell", "body": "<p>I need to compare a string to different regexps, which each give a different result.</p>\n<p>In ruby I would do something like</p>\n<pre><code>case str\nwhen regexp1 then result1\nwhen regexp2 then result2\nwhen regexp3 then result3 \n... \n</code></pre>\n<p>My first attempt in Haskell is</p>\n<pre><code>if str =~ regexp1 \n   then result 1\n   else\n      let (_,_,_,groups) = str =~ regexp2 \n      in if (length groups &gt; 0) \n         then result2 groups\n         else ...\n</code></pre>\n<p>I'm sure there is a much nicer way to do so in Haskell using Alternative or Monad etc ...</p>\n<h2>Update</h2>\n<p>My second solution (using alternavite)</p>\n<pre><code>fun str = \n   regexp1 ?~ (\\_ -&gt; &quot;result1&quot;)\n   &lt;|&gt; regexp2 ?~ (\\[capture] -&gt; &quot;capture&quot;\n   &lt;|&gt; regexp3 ?~ (\\[c1,c2\\ ] -&gt; c1 ++ &quot;:&quot; c2\n   where r ?~ f = do\n         match &lt;- r =~~ str\n         (_,_,_,groups) = match :: (String, String, String, [String])\n         Just (f groups)\n            (\n</code></pre>\n"}, {"tags": ["xml", "haskell", "hxt"], "comments": [{"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1429639979, "post_id": 29779888, "comment_id": 47690128, "body": "@AJFarmar, I guess it should be possible to do without lens."}], "answers": [{"comments": [{"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1429679545, "post_id": 29782019, "comment_id": 47705840, "body": "It works! However I can&#39;t believe that users of HXT <i>have to invent new primitives</i> in order to work through such simple cases. I&#39;ll wait, maybe someone can propose idiomatic (for HXT) solution. Thank you."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1429681730, "post_id": 29782019, "comment_id": 47706689, "body": "On the other hand, it&#39;s really good that <code>processChildren</code> is not recursive (like <code>deep</code>), so maybe this is really way to go. I think I&#39;m gonna accept the answer. (This is the question that entire <code>#haskell</code> channel couldn&#39;t answer (or was not willing to...))."}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1429691596, "post_id": 29782019, "comment_id": 47712506, "body": "@Mark This kind of question that requires time and/or specialised knowledge and doesn&#39;t benefit too much from casual discussion is much better suited for the StackOverflow format than IRC, so read too much into that. :)"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1429707745, "post_id": 29782019, "comment_id": 47724947, "body": "@Mark there was the <code>processTopDown</code> function which would have allowed this to be implemented as <code>processTopDown (changeText excl `when` isText)</code>, but it would have affected every text node in the tree.  The nesting is needed because you&#39;re pretty much having to recreate each layer of the tree (I think?) as you go.  There is almost certainly a better way to do it, I just don&#39;t have the domain specific knowledge to know what that solution is."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 2, "last_activity_date": 1429646599, "creation_date": 1429646599, "answer_id": 29782019, "question_id": 29779888, "link": "https://stackoverflow.com/questions/29779888/how-to-edit-specific-elements-in-xml-file-using-hxt/29782019#29782019", "title": "How to edit specific elements in XML file using HXT?", "body": "<p>I don't pretend to be good at HXT, I haven't used it much, but I've gotten what you want to do to work through some experimentation.  If someone has more experience with HXT feel free to offer a better solution.</p>\n\n<p>I found through skimming over the <a href=\"https://wiki.haskell.org/HXT#Decorating_external_references_of_an_HTML_document\" rel=\"nofollow\">HXT wiki</a> the <code>process*</code> functions, like <code>processTopDown</code> and <code>processChildren</code>, along with several others.  These seem to be what actually allows change to happen.  Now, I'm assuming that your actual use case is more complex, you may only want to select elements at a certain level.  The pattern I stumbled upon was to use <code>processChildren</code> along with the HXT version of <code>when</code>, not the <code>Control.Monad</code> one since they are not the same.  Basically, my first implementation was</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>applic\n    = processChildren\n    $ flip when (isElem &gt;&gt;&gt; hasName \"foo\")\n        $ processChildren\n        $ flip when (isElem &gt;&gt;&gt; hasName \"bar\")\n            $ processChildren\n            $ flip when (isElem &gt;&gt;&gt; hasName \"baz\")\n                $ processChildren\n                $ flip when (isElem &gt;&gt;&gt; hasName \"a\")\n                    $ processChildren\n                $ flip when isText\n                    $ changeText excl\n</code></pre>\n\n<p>And this is really quite ugly to me, there's just way too much repetition.  So I abstracted this out to something that is much more readable:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- Fixity is important here, must be right-associative.\ninfixr 5 /&gt;/\n(/&gt;/) :: ArrowXml a =&gt; String -&gt; a XmlTree XmlTree -&gt; a XmlTree XmlTree\nname /&gt;/ action\n    = processChildren\n    $ action `when` (isElem &gt;&gt;&gt; hasName name)\n\napplic = \"foo\" /&gt;/ \"bar\" /&gt;/ \"baz\" /&gt;/ \"a\" /&gt;/\n    processChildren (\n        changeText excl `when` isText\n    )\n</code></pre>\n\n<p>All these calls to <code>processChildren</code> might be redundant, particularly if you're just drilling down into the structure, but it definitely works and it won't modify other <code>a</code> elements in different parts of the file.  </p>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 1, "accepted_answer_id": 29782019, "answer_count": 1, "score": 4, "last_activity_date": 1429646599, "creation_date": 1429639485, "question_id": 29779888, "link": "https://stackoverflow.com/questions/29779888/how-to-edit-specific-elements-in-xml-file-using-hxt", "title": "How to edit specific elements in XML file using HXT?", "body": "<p>In short, here is what I want to accomplish:</p>\n\n<p><code>\"foo.xml\"</code>:\n</p>\n\n<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;foo&gt;\n  &lt;bar&gt;\n    &lt;baz&gt;\n      &lt;a&gt;foo&lt;/a&gt;\n      &lt;a&gt;bar&lt;/a&gt;\n      &lt;a&gt;baz&lt;/a&gt;\n    &lt;/baz&gt;\n  &lt;/bar&gt;\n&lt;/foo&gt;\n</code></pre>\n\n<p>expected result (contents of <code>\"bar.xml\"</code>):</p>\n\n<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;foo&gt;\n  &lt;bar&gt;\n    &lt;baz&gt;\n      &lt;a&gt;foo!&lt;/a&gt;\n      &lt;a&gt;bar!&lt;/a&gt;\n      &lt;a&gt;baz!&lt;/a&gt;\n    &lt;/baz&gt;\n  &lt;/bar&gt;\n&lt;/foo&gt;\n</code></pre>\n\n<p>...my attempt to approach the problem:\n</p>\n\n<pre><code>module Main (main) where\n\nimport Control.Monad\n\nimport Control.Arrow.ArrowTree\nimport Text.XML.HXT.Core\n\nmain :: IO ()\nmain = void . runX $ readDocument [] \"foo.xml\" &gt;&gt;&gt;\n       applic &gt;&gt;&gt; writeDocument [withIndent yes] \"bar.xml\"\n\napplic :: IOSArrow XmlTree XmlTree\napplic = getChildren &gt;&gt;&gt; hasName \"foo\"\n--       ^^ because of extra root node (?)\n         /&gt; hasName \"bar\" /&gt; hasName \"baz\" /&gt; hasName \"a\" &gt;&gt;&gt; changeText excl\n\nexcl :: String -&gt; String\nexcl = (++ \"!\")\n</code></pre>\n\n<p><strong>Question:</strong> How to directly edit just selected elements without changing/removing their root elements? Also note that this program doesn't create <code>\"bar.xml\"</code> file, so something is definitely wrong. Tracing shows that after applying <code>applic</code> arrow, the document consists of three <code>a</code> elements (<code>\"foo\"</code>, <code>\"bar\"</code>, and <code>\"baz\"</code>; without exclamation points).</p>\n"}, {"tags": ["parsing", "haskell"], "comments": [{"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 7, "creation_date": 1429635906, "post_id": 29778508, "comment_id": 47687569, "body": "Are you aware of parser combinators such as <a href=\"https://hackage.haskell.org/package/parsec\" rel=\"nofollow noreferrer\">parsec</a> and <a href=\"https://hackage.haskell.org/package/attoparsec\" rel=\"nofollow noreferrer\">attoparsec</a>? These really help to ease writing parsers! I do realize you might want to do something entirely on your own for something this size, though."}, {"owner": {"reputation": 11202, "user_id": 886669, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c56f1eac6c5b31b32bdffa4f741f3aed?s=128&d=identicon&r=PG", "display_name": "yasar", "link": "https://stackoverflow.com/users/886669/yasar"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1429636468, "post_id": 29778508, "comment_id": 47687929, "body": "I have just heard them but I don&#39;t know how to use them, or what exactly they do"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429636670, "post_id": 29778508, "comment_id": 47688049, "body": "There is a nice <a href=\"http://research.microsoft.com/en-us/um/people/daan/download/parsec/parsec.pdf\" rel=\"nofollow noreferrer\">pdf</a> and you can always look <a href=\"https://wiki.haskell.org/Parsec\" rel=\"nofollow noreferrer\">at the haskellWiki</a> (bot some links there are broken by now)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1429639313, "post_id": 29778508, "comment_id": 47689705, "body": "Representing elements strings is a bit strange. An atom is described by its atomic number and mass number. An ion is described by its atomic number, mass number, and charge. The <i>name</i> of an atom is something for parsing and displaying, not for the internal representation. <code>data Element = Element {atomicNumber::Int, massNumber::Int}</code> and <code>data Ion = Ion {getElement::Element, getCharge::Int}</code> should get the basic idea across; it would be better to indicate positivity in the types when appropriate, but Haskell isn&#39;t so good for that."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1429639787, "post_id": 29778508, "comment_id": 47690035, "body": "Er ... actually, I guess you&#39;d need <code>Element</code> with just atomic number and <code>Isotope</code> with element and mass number. Substances are essentially <code>Map</code>s from elements to numbers; there&#39;s no immediate need to distinguish monatomic from molecular substances."}, {"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "edited": false, "score": 0, "creation_date": 1429643415, "post_id": 29778508, "comment_id": 47692188, "body": "Something different: <code>Compound</code> surely isn&#39;t a functor. That instance shouldn&#39;t even compile, IMO -- the type has the wrong shape (aka <a href=\"https://wiki.haskell.org/Kind\" rel=\"nofollow noreferrer\">kind</a>)."}, {"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "edited": false, "score": 0, "creation_date": 1429652217, "post_id": 29778508, "comment_id": 47697040, "body": "Depending on how deep into this you want to get, I strongly recommend this book (PDF) on Grammars and Parsing: <a href=\"http://www.cs.uu.nl/docs/vakken/gont/diktaat.pdf\" rel=\"nofollow noreferrer\">cs.uu.nl/docs/vakken/gont/diktaat.pdf</a> it&#39;s fairly lengthy, full of theory and a lot of exercises/problems with solutions as well."}], "answers": [{"tags": [], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "is_accepted": true, "score": 5, "last_activity_date": 1429796017, "last_edit_date": 1429796017, "creation_date": 1429699847, "answer_id": 29795229, "question_id": 29778508, "link": "https://stackoverflow.com/questions/29778508/parsing-chemical-compounds-in-haskell/29795229#29795229", "title": "Parsing chemical compounds in Haskell", "body": "<p>I have created the parser you are looking for with <a href=\"https://hackage.haskell.org/package/parsec\" rel=\"nofollow\">Parsec</a> to give you a sense of what Parsec parsers look like, since you stated you had little experience with it.</p>\n\n<p>Even with little Haskell experience, it should be fairly readable. I have provided some comments on the parts where there's something in particular to look out for.</p>\n\n<pre><code>import Text.Read (readMaybe)\nimport Data.Maybe (fromMaybe)\nimport Text.Parsec (parse, many, many1, digit, char, string, (&lt;|&gt;), choice, try)\nimport Text.Parsec.String (Parser)\n\n\ndata Compound\n  = Monoatomic String Int\n  | Poliatomic [Compound] Int\n  deriving Show\n\n\n-- Run the substance parser on \"Ca(OH)2\" and print the result which is\n-- Right (Poliatomic [Monoatomic \"Ca\" 1,Poliatomic [Monoatomic \"O\" 1,Monoatomic \"H\" 1] 2] 1)\nmain = print (parse substance \"\" \"Ca(OH)2\")\n\n\n-- parse the many parts which make out the top-level polyatomic compound\n--\n-- \"many1\" means \"at least one\"\nsubstance :: Parser Compound\nsubstance = do\n  topLevel &lt;- many1 part\n  return (Poliatomic topLevel 1)\n\n\n-- a single part in a substance is either a poliatomic compound or a monoatomic compound\npart :: Parser Compound\npart = poliatomic &lt;|&gt; monoatomic\n\n\n-- a poliatomic compound starts with a '(', then has many parts inside, then\n-- ends with ')' and has a number after it which indicates how many of it there\n-- are.\npoliatomic :: Parser Compound\npoliatomic = do\n  char '('\n  inner &lt;- many1 part\n  char ')'\n  amount &lt;- many1 digit\n  return (Poliatomic inner (read amount))\n\n\n-- a monoatomic compound is one of the many element names, followed by an\n-- optional digit. if omitted, the amount defaults to 1.\n--\n-- \"try\" is a little special, and required in this case. it means \"if a parser\n-- fails, try the next one from where you started, not from where the last one\n-- failed.\"\n--\n-- \"choice\" means \"try all parsers in this list, stop when one matches\"\n--\n-- \"many\" means \"zero or more\"\nmonoatomic :: Parser Compound\nmonoatomic = do\n  name &lt;- choice [try nameParser | nameParser &lt;- atomstrings]\n  amount &lt;- many digit\n  return (Monoatomic name (fromMaybe 1 (readMaybe amount)))\n\n\n-- a list of parser for atom names. it is IMPORTANT that the longest names\n-- come first. the reason for that is that it makes the parser much simpler to\n-- write, and it can execute much faster. it's common when designing parsers to\n-- consider things like that when creating them.\natomstrings :: [Parser String]\natomstrings = map string (words \"He Li Be Ne Na Mg Al Ca H B C N O F\")\n</code></pre>\n\n<p>I've tried to write this code in a way that should be at least reasonably accessible to a beginner, but it's probably not crystal clear so I'm happy to answer any questions about this.</p>\n\n<hr>\n\n<p>The parser above is the one you wanted. However, it's not the one I would write if I had free reins. If I got to do however I wanted, I would exploit the fact that</p>\n\n<pre><code>Ca(OH)2\n</code></pre>\n\n<p>can be represented as</p>\n\n<pre><code>(Ca)1((O)1(H)1)2\n</code></pre>\n\n<p>which is a much more uniform representation, and in turns results in a simpler data structure and a parser with less boilerplate. The code I'd prefer to write would look like&nbsp;</p>\n\n<pre><code>import Text.Read (readMaybe)\nimport Data.Maybe (fromMaybe)\nimport Control.Applicative ((&lt;$&gt;), (&lt;*&gt;), pure)\nimport Text.Parsec (parse, many, many1, digit, char, string, (&lt;|&gt;), choice, try, between)\nimport Text.Parsec.String (Parser)\n\n\ndata Substance\n  = Part [Substance] Int\n  | Atom String\n  deriving Show\n\n\nmain = print (parse substance \"\" \"Ca(OH)2\")\n-- Right (Part [Part [Atom \"Ca\"] 1,Part [Part [Atom \"O\"] 1,Part [Atom \"H\"] 1] 2] 1)\n\nsubstance :: Parser Substance\nsubstance = Part &lt;$&gt; many1 part &lt;*&gt; pure 1\n\npart :: Parser Substance\npart = do\n  inner &lt;- polyatomic &lt;|&gt; monoatomic\n  amount &lt;- fromMaybe 1 . readMaybe &lt;$&gt; many digit\n  return (Part inner amount)\n\npolyatomic :: Parser [Substance]\npolyatomic = between (char '(') (char ')') (many1 part)\n\nmonoatomic :: Parser [Substance]\nmonoatomic = (:[]) . Atom &lt;$&gt; choice (map (try . string) atomstrings)\n\natomstrings :: [String]\natomstrings = words \"He Li Be Ne Na Mg Al Ca H B C N O F\"\n</code></pre>\n\n<p>This uses a few \"advanced\" tricks in Haskell (such as the <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> operators) so might not be of interest to you, OP, but I'm putting it in for other people who might be more advanced Haskell users and learning about Parsec.</p>\n\n<p>This parser takes only about half a page, as you see, and that's the power of libraries like Parsec \u2013 they make it both easy and <em>fun</em> to write parsers!</p>\n"}], "owner": {"reputation": 11202, "user_id": 886669, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c56f1eac6c5b31b32bdffa4f741f3aed?s=128&d=identicon&r=PG", "display_name": "yasar", "link": "https://stackoverflow.com/users/886669/yasar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 436, "favorite_count": 1, "accepted_answer_id": 29795229, "answer_count": 1, "score": 3, "last_activity_date": 1429796017, "creation_date": 1429635057, "last_edit_date": 1429674613, "question_id": 29778508, "link": "https://stackoverflow.com/questions/29778508/parsing-chemical-compounds-in-haskell", "title": "Parsing chemical compounds in Haskell", "body": "<p>I was trying to make a chemical compound parser as an exercise for myself but I got stuck.</p>\n\n<p>Here is the data type I am trying to use:</p>\n\n<pre><code>data Compound = Monoatomic String Int | Poliatomic [Compound] Int\n</code></pre>\n\n<p>Given a string like \"Ca(OH)2\", I want to get something like;</p>\n\n<pre><code>Poliatomic [Monoatomic \"Ca\" 1, Poliatomic [Monoatomic \"O\" 1, Monoatomic \"H\" 1] 2 ] 1\n</code></pre>\n\n<p>Monoatomic type constructor for single atoms, and Poliatomic constructor for multiple atoms. In this example (OH)2 represents and inner Poliatomic structure and it is represented as <code>Poliatomic [(Monoatomic O 1), (Monoatomic H 1 )] 2</code>. The number <code>2</code> represents that we have two of those poliatomic structures.</p>\n\n<p>I did this much;</p>\n\n<pre><code>import Data.Char (isUpper)\ndata Compound = Monoatomic String Int | Poliatomic [Compound] Int\n\ninstance Functor Compound where\n        fmap f (Monoatomic s i) = Monoatomic (f s) i\n        fmap f (Poliatomic xs i) = Poliatomic (fmap f xs) i\n\n-- Change number of a compound\nchangeNumber :: Compound -&gt; Int -&gt; Compound\nchangeNumber (Monoatomic xs _) n = Monoatomic xs n\nchangeNumber (Poliatomic xs _) n = Poliatomic xs n\n\n-- Take a partial compound and next chracter return partial compound\nparseCompound :: Compound -&gt; Char -&gt; Compound\nparseCompound (Poliatomic x:xs n) c\n        | isUpper c = Poliatomic ((Monoatomic [c] 1):x:xs) n -- add new atom to compound\n        | isLower c = Poliatomic \n\n-- I want to do foldl parseCompound (Poliatomic [] 1) inputstring\n</code></pre>\n\n<p>but then it got too complicated for me to continue.</p>\n\n<p>It looks like it should be a fairly simple problem, but I am very new to Haskell and can't figure out how to complete this function.</p>\n\n<p>I have this questions:</p>\n\n<ul>\n<li>Is my approach correct so far?</li>\n<li>How can I make this work?</li>\n</ul>\n"}, {"tags": ["http", "haskell", "https", "http-conduit", "network-conduit"], "comments": [{"owner": {"reputation": 1359, "user_id": 3346496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1230f0444613f0e8d74e5a71439d1e?s=128&d=identicon&r=PG&f=1", "display_name": "monocell", "link": "https://stackoverflow.com/users/3346496/monocell"}, "edited": false, "score": 0, "creation_date": 1429646443, "post_id": 29778484, "comment_id": 47693993, "body": "Have you investigated any non language related reasons why this might be? Like difference in user agent or accept encoding for example? Creating a http request is significantly faster in any language then the &gt;1 sec the request takes. As a data point I can mention that when I run your haskell code the result is about the same as your ruby code. When i run the same thing with curl I get twice that."}, {"owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "reply_to_user": {"reputation": 1359, "user_id": 3346496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1230f0444613f0e8d74e5a71439d1e?s=128&d=identicon&r=PG&f=1", "display_name": "monocell", "link": "https://stackoverflow.com/users/3346496/monocell"}, "edited": false, "score": 0, "creation_date": 1429650366, "post_id": 29778484, "comment_id": 47696150, "body": "I haven&#39;t investigated the non language reasons .The Go and the Ruby version take similar amount of time and I expected the Haskell version to also perform similarly but the difference is rather pretty large and I suspect it to be a library issue."}, {"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "edited": false, "score": 0, "creation_date": 1429651510, "post_id": 29778484, "comment_id": 47696740, "body": "It does sound like a library issue. Are you running this in a cabal sandbox?"}, {"owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "reply_to_user": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "edited": false, "score": 0, "creation_date": 1429653014, "post_id": 29778484, "comment_id": 47697422, "body": "@TheCriticalImperitive No"}], "answers": [{"comments": [{"owner": {"reputation": 976, "user_id": 1274282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nBRxs.png?s=128&g=1", "display_name": "Taylor Fausak", "link": "https://stackoverflow.com/users/1274282/taylor-fausak"}, "edited": false, "score": 0, "creation_date": 1429644089, "post_id": 29781238, "comment_id": 47692587, "body": "Of course, running the loop in your shell will still create new managers. You can run the loop in Haskell with <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#v:mapM_\" rel=\"nofollow noreferrer\"><code>mapM_</code></a>. Like this: <code>mapM_ (httpLbs request manager) [1 .. 100]</code>."}, {"owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "edited": false, "score": 0, "creation_date": 1429648975, "post_id": 29781238, "comment_id": 47695340, "body": "I repeated the requests to find a better average of the response time for the request. In production I wish to have only one api call and not multiple."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1429703319, "post_id": 29781238, "comment_id": 47721220, "body": "I think this is the right answer. Just for completeness, I answered this question on Github as well: <a href=\"https://github.com/snoyberg/http-client/issues/118\" rel=\"nofollow noreferrer\">github.com/snoyberg/http-client/issues/118</a>"}], "tags": [], "owner": {"reputation": 976, "user_id": 1274282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nBRxs.png?s=128&g=1", "display_name": "Taylor Fausak", "link": "https://stackoverflow.com/users/1274282/taylor-fausak"}, "is_accepted": true, "score": 1, "last_activity_date": 1429643950, "creation_date": 1429643950, "answer_id": 29781238, "question_id": 29778484, "link": "https://stackoverflow.com/questions/29778484/haskell-simplehttp-of-network-http-conduit-performing-slowly-for-get-requests/29781238#29781238", "title": "Haskell simpleHTTP of Network.HTTP.Conduit performing slowly for get requests", "body": "<p><a href=\"http://hackage.haskell.org/package/http-conduit-2.1.5/docs/Network-HTTP-Conduit.html#v:simpleHttp\" rel=\"nofollow\">The documentation for <code>simpleHttp</code></a> says:</p>\n\n<blockquote>\n  <p>Note: This function creates a new Manager. It should be avoided in production code.</p>\n</blockquote>\n\n<p>Your code creates a new manager for each request. If you change it to reuse a single manager, it could be a lot faster. You can use <a href=\"http://hackage.haskell.org/package/http-conduit-2.1.5/docs/Network-HTTP-Conduit.html#v:newManager\" rel=\"nofollow\"><code>newManager</code></a> to create a manager. For example:</p>\n\n<pre><code>import Network.HTTP.Conduit\nmain = do\n    request &lt;- parseUrl \"https://github.com/trending?l=ruby\"\n    manager &lt;- newManager conduitManagerSettings\n    _response &lt;- httpLbs request manager\n    return ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 1, "last_activity_date": 1429652854, "creation_date": 1429652854, "answer_id": 29783740, "question_id": 29778484, "link": "https://stackoverflow.com/questions/29778484/haskell-simplehttp-of-network-http-conduit-performing-slowly-for-get-requests/29783740#29783740", "title": "Haskell simpleHTTP of Network.HTTP.Conduit performing slowly for get requests", "body": "<p>My guess would be that the Haskell library you are using is doing something like an IPv6 DNS request that times out before falling back to IPv4, and Go and Ruby are doing IPv4 requests directly. A few seconds per request is a likely DNS timeout duration and doesn't have any other possible explanation that I can see.</p>\n"}], "owner": {"reputation": 721, "user_id": 2512324, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f9d51819edf28a5befe8b255e51d95d7?s=128&d=identicon&r=PG", "display_name": "user2512324", "link": "https://stackoverflow.com/users/2512324/user2512324"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 654, "favorite_count": 0, "accepted_answer_id": 29781238, "answer_count": 2, "score": 1, "last_activity_date": 1429652854, "creation_date": 1429634993, "question_id": 29778484, "link": "https://stackoverflow.com/questions/29778484/haskell-simplehttp-of-network-http-conduit-performing-slowly-for-get-requests", "title": "Haskell simpleHTTP of Network.HTTP.Conduit performing slowly for get requests", "body": "<p>In my haskell code I've imported <code>Network.HTTP.Conduit</code> as</p>\n\n<pre><code>import Network.HTTP.Conduit\n</code></pre>\n\n<p>In my main function I make a simple <code>GET</code> request using <code>simpleHTTP</code></p>\n\n<pre><code>main = do\n     response &lt;- simpleHttp \"https://github.com/trending?l=ruby\"\n     return ()\n</code></pre>\n\n<p>It took 6 minutes 42 secs to complete 100 api requests</p>\n\n<pre><code>time for NUM in `seq 1 1 100`; do ./Testhttp; done\nreal    6m42.839s\nuser    0m12.115s\nsys 0m2.652s\n</code></pre>\n\n<p>whereas the <code>ruby</code> alternative just takes 153 secs for 100 api calls using <code>Net::HTTP.get(URI.parse(\"https://github.com/trending?l=ruby\"))</code></p>\n\n<p>Am I doing something wrong in my haskell code? What are the performant and efficient alternatives to <code>simpleHTTP</code>?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1429635682, "post_id": 29778382, "comment_id": 47687422, "body": "Post your project&#39;s <code>cabal</code> config file ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1429640852, "post_id": 29778382, "comment_id": 47690642, "body": "I&#39;ve added the config file &amp; dir structure"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1429644076, "post_id": 29778382, "comment_id": 47692581, "body": "Not sure but if you use <code>Core&#47;Main.hs</code> is it possible that your module is indeed <code>Core.Main</code> if so you still need to make a top-level <code>Main.hs</code> with <code>module Main</code> without anything else!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "edited": false, "score": 0, "creation_date": 1429644584, "post_id": 29778382, "comment_id": 47692867, "body": "You got it. The issue was that my main module was <code>Core.Main</code> and not simply <code>Main</code>. I moved <code>src&#47;Core&#47;Main.hs</code> to <code>src&#47;Main.hs</code> and changed my <code>main-is:</code> entry to <code>Main.hs</code>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "edited": false, "score": 0, "creation_date": 1429636170, "post_id": 29778768, "comment_id": 47687729, "body": "It does! That&#39;s what&#39;s weird about it. I&#39;ll post my .cabal when I&#39;m back in ~1hr"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429636280, "post_id": 29778768, "comment_id": 47687812, "body": "Oh - sorry this does not help - I&#39;ll let my answer stick for now if you don&#39;t mind. Can you post something about your file structure and your the beginning of the file containing your <code>Main</code> module too please?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "edited": false, "score": 0, "creation_date": 1429640898, "post_id": 29778768, "comment_id": 47690672, "body": "No worries. I have added my directory structure and my <code>.cabal</code> file to the question. I&#39;ll also add the <code>main</code> definition."}, {"owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 0, "creation_date": 1429642530, "post_id": 29778768, "comment_id": 47691622, "body": "your main definition only gives the main function, but you don&#39;t show the module name. Does your source file start with module Main where as Carsten said?"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 2, "last_activity_date": 1429646850, "last_edit_date": 1429646850, "creation_date": 1429635904, "answer_id": 29778768, "question_id": 29778382, "link": "https://stackoverflow.com/questions/29778382/cabal-doesnt-build-executable/29778768#29778768", "title": "Cabal Doesn&#39;t Build Executable", "body": "<p>it's all there in the message:</p>\n\n<p>you need a <em>source</em> file defining the <em>Main</em> module</p>\n\n<pre><code>module Main where ...\n</code></pre>\n\n<p>and exporting a <code>main</code>function:</p>\n\n<pre><code>main :: IO ()\nmain = ...\n</code></pre>\n\n<p>and your <code>main-is</code> field in your <em>.cabal</em> file should point to this.</p>\n\n<p>If you have all this you should be able to compile it into an executable.</p>\n\n<p>Here is a nice intro: <a href=\"https://wiki.haskell.org/How_to_write_a_Haskell_program\" rel=\"nofollow\">How to write a Haskell programm</a></p>\n\n<h2>update</h2>\n\n<p>as it turn out the module was named <code>Core.Main</code> - make sure you have one <code>module Main</code> too - you can always add a top level <code>main.hs</code> and reexport just the <code>main</code> from <code>Core.Main</code> too</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 938, "favorite_count": 0, "accepted_answer_id": 29778768, "answer_count": 1, "score": 1, "last_activity_date": 1429646850, "creation_date": 1429634699, "last_edit_date": 1429640833, "question_id": 29778382, "link": "https://stackoverflow.com/questions/29778382/cabal-doesnt-build-executable", "title": "Cabal Doesn&#39;t Build Executable", "body": "<p>For some reason, cabal isn't creating an executable for my program. When I run <code>cabal build</code>, I get this output:</p>\n\n<pre><code>Building server-0.1.0.0...\nPreprocessing executable 'server' for server-0.1.0.0...\nWarning: output was redirected with -o, but no output will be generated\nbecause there is no Main module.\n</code></pre>\n\n<p>A subsequent <code>cabal run</code> gives me this error:</p>\n\n<pre><code>Preprocessing executable 'server' for server-0.1.0.0...\nWarning: output was redirected with -o, but no output will be generated\nbecause there is no Main module.\ncabal: dist/build/server/server: does not exist\n</code></pre>\n\n<p>Sure enough, there is no <code>server</code> binary in <code>dist/build/server/server</code>. The temp files are, however, in <code>dist/build/server/server-temp/</code>. </p>\n\n<p>My <code>.cabal</code> file:</p>\n\n<pre><code>name:                server\nversion:             0.1.0.0\nsynopsis:            An example haskell web service.\nlicense:             Apache-2.0\nlicense-file:        LICENSE\nauthor:              Some Body\nmaintainer:          somebody@gmail.com\ncategory:            Web\nbuild-type:          Simple\ncabal-version:       &gt;=1.10\nexecutable server\n  main-is:             Core/Main.hs\n  build-depends:       base,\n                       containers,\n                       bytestring,\n                       bytestring-conversion,\n                       aeson,\n                       http-types,\n                       acid-state,\n                       mtl,\n                       safecopy,\n                       warp,\n                       wai,\n                       wai-extra,\n                       wai-middleware-static\n  hs-source-dirs:      src\n  default-language:    Haskell2010\n</code></pre>\n\n<p>My directory structure (including <code>dist</code> from <code>cabal build</code>):</p>\n\n<pre><code>.\n\u251c\u2500\u2500 cabal.sandbox.config\n\u251c\u2500\u2500 dist\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 build\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 autogen\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 cabal_macros.h\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 Paths_server.hs\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 server\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 server-tmp\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 Core\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u251c\u2500\u2500 Main.dyn_hi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u251c\u2500\u2500 Main.dyn_o\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u251c\u2500\u2500 Main.hi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2514\u2500\u2500 Main.o\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 Model\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u251c\u2500\u2500 DB.dyn_hi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u251c\u2500\u2500 DB.dyn_o\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u251c\u2500\u2500 DB.hi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2514\u2500\u2500 DB.o\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 Util\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u251c\u2500\u2500 HTTP.dyn_hi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u251c\u2500\u2500 HTTP.dyn_o\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u251c\u2500\u2500 HTTP.hi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 HTTP.o\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 package.conf.inplace\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 package.cache\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 setup-config\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 server.cabal\n\u251c\u2500\u2500 Setup.hs\n\u2514\u2500\u2500 src\n    \u251c\u2500\u2500 Core\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 Main.hs\n    \u251c\u2500\u2500 Model\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 DB.hs\n    \u251c\u2500\u2500 Service\n    \u2514\u2500\u2500 Util\n        \u2514\u2500\u2500 HTTP.hs\n</code></pre>\n\n<p>The <code>main</code> definition:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  db &lt;- openLocalStateFrom \"~/.acid-state\" (UserDatabase Map.empty)\n  putStrLn $ \"http://localhost:8080/\"\n  run 8080 $ logStdout $ staticPolicy (noDots &gt;-&gt; addBase \"../client/\") $ app db\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1429631611, "post_id": 29777127, "comment_id": 47684639, "body": "Where are the multiple functions in your example? I see only <code>myFunction</code> (well, I also see <code>putStrLn</code>, but I assume that&#39;s not what you meant)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1429631998, "post_id": 29777127, "comment_id": 47684928, "body": "You don&#39;t <i>execute</i> functions in Haskell. What&#39;s that even <a href=\"https://en.wikipedia.org/wiki/Execution_of_Louis_XVI\" rel=\"nofollow noreferrer\">supposed to mean</a>? What you do instead is, you <i>request &amp; evaluate results</i>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 4, "creation_date": 1429632034, "post_id": 29777127, "comment_id": 47684958, "body": "I think it&#39;s fair to assume that you are a beginner. If so then maybe you might find it useful to get used to Haskell using ghci, where you rarely need <code>putStrLn</code> to experiment"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1429641306, "post_id": 29777127, "comment_id": 47690927, "body": "If you are satisfied with the answer, please click the check box to accept it instead of editing your question to remark on it."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 5, "last_activity_date": 1429631898, "creation_date": 1429631898, "answer_id": 29777377, "question_id": 29777127, "link": "https://stackoverflow.com/questions/29777127/how-to-call-multiple-functions-within-the-code-in-haskell/29777377#29777377", "title": "How to call multiple functions within the code in haskell", "body": "<blockquote>\n  <p>Escpecially because myFunction returns an Integer and not a char.</p>\n</blockquote>\n\n<p>You can use <code>print</code> to print things other than strings. <code>print</code> is equivalent to <code>putStrLn . show</code>, so it can print any type that's showable, which <code>Integer</code> is.</p>\n"}], "owner": {"reputation": 21, "user_id": 4274927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faf2f8ff139351dbae4e3637f2c83b7a?s=128&d=identicon&r=PG&f=1", "display_name": "Meter Paffay", "link": "https://stackoverflow.com/users/4274927/meter-paffay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 695, "favorite_count": 0, "accepted_answer_id": 29777377, "answer_count": 1, "score": -1, "last_activity_date": 1429632378, "creation_date": 1429631358, "last_edit_date": 1429632378, "question_id": 29777127, "link": "https://stackoverflow.com/questions/29777127/how-to-call-multiple-functions-within-the-code-in-haskell", "title": "How to call multiple functions within the code in haskell", "body": "<p>I would like to call multiple functions from within the code, meaning that by executing the .hs file, all functions named will be executed.</p>\n\n<p>I tried using main with putStrLn, but this is rather complicated and doesn't seem to work.</p>\n\n<pre><code>main = do\n putStrLn (myFunction para1 para2)\n putStrLn (anotherFunction para1 para2)\n</code></pre>\n\n<p>This shows the idea, but it obviosly doesn't work. Escpecially because myFunction returns an Integer and not a char.</p>\n\n<p>I hope someone can help. Thank you in advance.</p>\n\n<p>using \"print\" solved this problem. Thank you.</p>\n"}, {"tags": ["function", "haskell", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 2196, "user_id": 3433232, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0170269937c80a352c776b4ed5e3c1f7?s=128&d=identicon&r=PG&f=1", "display_name": "basti12354", "link": "https://stackoverflow.com/users/3433232/basti12354"}, "edited": false, "score": 0, "creation_date": 1429623155, "post_id": 29773594, "comment_id": 47677692, "body": "Yeah with your brackets the result is very clear and with leftaroundabout explanation everything is clear!"}], "tags": [], "owner": {"reputation": 2133, "user_id": 2494576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69dcf21a7cf379c1f25476d80a73338f?s=128&d=identicon&r=PG", "display_name": "felix-eku", "link": "https://stackoverflow.com/users/2494576/felix-eku"}, "is_accepted": false, "score": 4, "last_activity_date": 1429622881, "creation_date": 1429622881, "answer_id": 29773594, "question_id": 29773352, "link": "https://stackoverflow.com/questions/29773352/how-is-this-function-working-const-const-negate-1-negate-2-3/29773594#29773594", "title": "How is this function working: const const (negate 1) (negate 2) 3", "body": "<p>The brackets need to be set like this:</p>\n\n<pre><code>(((const const) (negate 1)) (negate 2)) 3\n</code></pre>\n\n<p>Now <code>(const const)</code> is of type <code>a -&gt; b -&gt; c -&gt; b</code> and it should be clear why the result is <code>-2</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 12, "last_activity_date": 1429623041, "creation_date": 1429623041, "answer_id": 29773655, "question_id": 29773352, "link": "https://stackoverflow.com/questions/29773352/how-is-this-function-working-const-const-negate-1-negate-2-3/29773655#29773655", "title": "How is this function working: const const (negate 1) (negate 2) 3", "body": "<p>Haskell parsing rules are very simple. If we ignore infix operators (<code>+</code>, <code>&amp;&amp;</code> etc.), there is only one rule:</p>\n\n<blockquote>\n  <p><code>a b c d e</code> is parsed as <code>(((a b) c) d) e</code>.</p>\n</blockquote>\n\n<p><em>Never</em>, like you assumed, as <code>a (b c d) e</code>. (Very seldom, this may give the same result by coincidence, but normally it won't even make sense to the type checker.)</p>\n\n<p>So in your example, you have to read it as</p>\n\n<pre><code>( ( (const const) (negate 1) ) (negate 2) ) 3\n</code></pre>\n\n<p>where <code>const const</code> simply ignores the <code>(negate 1)</code>, and yields <code>const</code> instead. That it turn picks <code>(negate 2)</code> as its const value, and goes on to ignore <code>3</code>.</p>\n"}], "owner": {"reputation": 2196, "user_id": 3433232, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0170269937c80a352c776b4ed5e3c1f7?s=128&d=identicon&r=PG&f=1", "display_name": "basti12354", "link": "https://stackoverflow.com/users/3433232/basti12354"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 1, "accepted_answer_id": 29773655, "answer_count": 2, "score": 4, "last_activity_date": 1429623041, "creation_date": 1429622299, "question_id": 29773352, "link": "https://stackoverflow.com/questions/29773352/how-is-this-function-working-const-const-negate-1-negate-2-3", "title": "How is this function working: const const (negate 1) (negate 2) 3", "body": "<p>I am learning Haskell atm, now I found this function</p>\n\n<pre><code>const const (negate 1) (negate 2) 3\n</code></pre>\n\n<p>The result of this function is <strong>-2</strong>. I don't understand why the result is not -2.</p>\n\n<pre><code>const :: a -&gt; b -&gt; a\nnegate :: Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>So I thought that I can also set the brackets like this: \nconst (const (negate 1) (negate 2)) 3\nBut now I get -1 as result.</p>\n\n<p>Where is my fault? I do not understand, how this works.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "edited": false, "score": 0, "creation_date": 1429606428, "post_id": 29764863, "comment_id": 47665588, "body": "Thank you for a simple explanation for something that I knew how to do via trial and error, yet never really understood why :)"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1429610211, "post_id": 29764863, "comment_id": 47668317, "body": "The difference matters more if you&#39;re passing them to higher order functions"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1429621153, "post_id": 29764863, "comment_id": 47676199, "body": "You can also do <code>print . concat $ [&quot;abc&quot;, &quot;bde&quot;]</code>"}], "tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": true, "score": 7, "last_activity_date": 1429598921, "creation_date": 1429598921, "answer_id": 29764863, "question_id": 29764819, "link": "https://stackoverflow.com/questions/29764819/dot-versus-dollar-symbol/29764863#29764863", "title": "Dot Versus Dollar symbol", "body": "<p>Just precedence, really; this will work fine:</p>\n\n<pre><code>(print . concat) [\"abc\", \"bde\"]\n</code></pre>\n\n<p><code>.</code> composes two functions to create a new function, whereas <code>$</code> is just a way of avoiding parentheses in this context.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 288, "favorite_count": 1, "accepted_answer_id": 29764863, "answer_count": 1, "score": 2, "last_activity_date": 1429598921, "creation_date": 1429598775, "question_id": 29764819, "link": "https://stackoverflow.com/questions/29764819/dot-versus-dollar-symbol", "title": "Dot Versus Dollar symbol", "body": "<pre><code>print $ concat [\"abc\", \"bde\"]\n</code></pre>\n\n<p>prints</p>\n\n<pre><code>abcbde\n</code></pre>\n\n<p>whereas,</p>\n\n<pre><code>print . concat [\"abc\", \"bde\"]\n</code></pre>\n\n<p>The error thrown in second case is,</p>\n\n<pre><code>Couldn't match expected type \u2018a -&gt; b0\u2019 with actual type \u2018[Char]\u2019\nRelevant bindings include\n  it :: a -&gt; IO () (bound at &lt;interactive&gt;:3:1)\nPossible cause: \u2018concat\u2019 is applied to too many arguments\n</code></pre>\n\n<p><code>.</code> (function-composition operator) is used because i thought it will take the output of <code>concat</code> function and pass it to the preceding function <code>print</code>? What is wrong in the code?</p>\n"}, {"tags": ["haskell", "module"], "comments": [{"owner": {"reputation": 558, "user_id": 4751430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f424b8d7abc1bd4adaf69ca95412f3a?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Huschenbett", "link": "https://stackoverflow.com/users/4751430/martin-huschenbett"}, "edited": false, "score": 1, "creation_date": 1429602662, "post_id": 29764667, "comment_id": 47663292, "body": "The latter is possible with <code>cabal get &lt;package&gt;</code>. But honestly, that&#39;s pretty obvious from the documentation of <code>cabal-install</code>."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 4, "last_activity_date": 1429609166, "creation_date": 1429609166, "answer_id": 29768396, "question_id": 29764667, "link": "https://stackoverflow.com/questions/29764667/module-filepath-from-loaded-module-object/29768396#29768396", "title": "Module filepath from loaded module object", "body": "<p>This doesn't exactly answer your question, but this is how I would find the location of the module in Haskell. Say I have a module named <code>Data.Text</code> and I want to find it's location. Then I initially find out it's package name:</p>\n\n<pre><code>$ ghc-pkg find-module Data.Text\n/nix/store/cq4qqjii3s9ghr6p59kkrdf44wnyhpp4-ghc-7.8.4/lib/ghc-7.8.4/package.conf.d\n/home/sibi/.ghc/x86_64-linux-7.8.4/package.conf.d\n   text-1.2.0.4\n</code></pre>\n\n<p>Now I know that the package name is <code>text-1.2.0.4</code>. So, now all I do is use this command to find the module location:</p>\n\n<pre><code>$ ghc-pkg describe text-1.2.0.4   # (Just text should also work)\n</code></pre>\n\n<p>And this will give you a big output. The interested fields for you are <code>import-dirs</code> and <code>library-dirs</code>. </p>\n\n<p>To find out the source of the installed package, you can use <code>cabal get &lt;package_name&gt;</code> as mentioned by @Martin.</p>\n"}, {"tags": [], "owner": {"reputation": 558, "user_id": 4751430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f424b8d7abc1bd4adaf69ca95412f3a?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Huschenbett", "link": "https://stackoverflow.com/users/4751430/martin-huschenbett"}, "is_accepted": false, "score": 1, "last_activity_date": 1429609174, "creation_date": 1429609174, "answer_id": 29768398, "question_id": 29764667, "link": "https://stackoverflow.com/questions/29764667/module-filepath-from-loaded-module-object/29768398#29768398", "title": "Module filepath from loaded module object", "body": "<p>I'm pretty sure you cannot do the first thing in Haskell. However, if you just want to find out this path for yourself, you can use the command</p>\n\n<pre><code>ghc-pkg describe &lt;package&gt;\n</code></pre>\n\n<p>where <code>&lt;package&gt;</code> is the name of the package the module belongs to.</p>\n\n<p>For downloading the source code of a package, just use</p>\n\n<pre><code>cabal get &lt;package&gt;\n</code></pre>\n\n<p>It will download the sources without any dependencies into a directory <code>&lt;package&gt;-&lt;version&gt;</code> within your current directory.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 29768396, "answer_count": 2, "score": 1, "last_activity_date": 1429609174, "creation_date": 1429598218, "question_id": 29764667, "link": "https://stackoverflow.com/questions/29764667/module-filepath-from-loaded-module-object", "title": "Module filepath from loaded module object", "body": "<p>In python, it is</p>\n\n<pre><code>import argparser\nprint argparser.__file__\n</code></pre>\n\n<p>My questions are:</p>\n\n<ul>\n<li>How can i do the same in haskell i.e. to get the file location of a module from using loaded module object in haskell?</li>\n<li>In haskell, the library file is in non-readable <code>.hi</code> format. Is there a way with <code>cabal install</code>, that i can download source files into <code>~/.cabal</code> and compile it locally? </li>\n</ul>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 2, "creation_date": 1429603025, "post_id": 29763655, "comment_id": 47663493, "body": "You&#39;re right, it may be the same bug. It&#39;s probably worth testing if it&#39;s now fixed in HEAD / the 7.10.2 branch. The problem seems to be that the added instance provides GHC with two ways to reduce the <code>T t (F r)</code> constraint arising from the use of <code>fromScalar&#39;</code>, and for some reason, GHC chooses to apply the instance rather than the dictionary provided to <code>convert</code>."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1429623778, "post_id": 29763655, "comment_id": 47678202, "body": "If that&#39;s true, my luck is terrible...I managed to find the same bug again in a completely different setting!"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1429752735, "post_id": 29763655, "comment_id": 47751873, "body": "It turns out this bug is different from <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10195\" rel=\"nofollow noreferrer\">#10195</a>. You can read more <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10338\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1458366752, "post_id": 29763655, "comment_id": 59840481, "body": "@Eric you should post that it was a bug as an answer so this question can move off &quot;unasnwered&quot; :-)"}], "answers": [{"tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 0, "last_activity_date": 1458394461, "creation_date": 1458394461, "answer_id": 36102413, "question_id": 29763655, "link": "https://stackoverflow.com/questions/29763655/monomorphism-restriction-triggered-when-generic-instance-defined/36102413#36102413", "title": "Monomorphism restriction triggered when generic instance defined", "body": "<p>This is GHC bug <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10338\" rel=\"nofollow\">#10338</a>. Unfortunately it doesn't look like it's going to get resolved anytime soon.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 1, "accepted_answer_id": 36102413, "answer_count": 1, "score": 5, "last_activity_date": 1458394461, "creation_date": 1429594063, "last_edit_date": 1495535287, "question_id": 29763655, "link": "https://stackoverflow.com/questions/29763655/monomorphism-restriction-triggered-when-generic-instance-defined", "title": "Monomorphism restriction triggered when generic instance defined", "body": "<p>Consider the following:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleContexts, GADTs, MultiParamTypeClasses #-}\n\ntype family F r\n\nclass (Functor t) =&gt; T t r where\n  fromScalar :: r -&gt; t r\n\ndata Foo t r where\n  Foo :: t (F r) -&gt; Foo t r\n  Scalar :: r -&gt; Foo t r\n\ntoF :: r -&gt; F r\ntoF = undefined\n\nconvert :: (T t (F r))\n  =&gt; Foo t r -&gt; Foo t r\nconvert (Scalar c) = \n  let fromScalar' = fromScalar\n  in Foo $ fromScalar' $ toF c\n</code></pre>\n\n<p>This code compiles with GHC 7.8.4.</p>\n\n<p>When I add a generic instance for <code>T</code> (which requires <code>FlexibleInstances</code>):</p>\n\n<pre><code>instance (Functor t, Num r) =&gt; T t r\n</code></pre>\n\n<p>GHC complains:</p>\n\n<pre><code>Could not deduce (Num (F r)) arising from a use of \u2018fromScalar\u2019\n    from the context (T t (F r))\n      bound by the type signature for\n                 convert :: (T t (F r)) =&gt; Foo t r -&gt; Foo t r\n      at Main.hs:(17,12)-(18,23)\n    In the expression: fromScalar\n    In an equation for \u2018fromScalar'\u2019: fromScalar' = fromScalar\n    In the expression:\n      let fromScalar' = fromScalar in Foo $ fromScalar' $ toF c\n</code></pre>\n\n<p>I remembered <a href=\"https://stackoverflow.com/questions/26829524/type-inference-in-patterns\">this question</a>, but there seem to be some key differences. First and most important, GHC didn't complain pre-instance. Second, I don't have <code>RankNTypes</code>, which seemed to be at the core of the problem with that question. Finally, adding <code>NoMonoLocalBinds</code> doesn't help. Strangely, adding <code>NoMonomorphismRestriction</code> <em>does</em> change the error message from complaining about <code>fromScalar</code> to the same message about <code>fromScalar'</code>.</p>\n\n<p>Of course the problem can be fixed by adding a type signature to <code>fromScalar</code> and adding <code>ScopedTypeVariables</code>:</p>\n\n<pre><code>convert :: forall t r . (T t (F r))\n  =&gt; Foo t r -&gt; Foo t r\nconvert (Scalar c) = \n  let fromScalar' = fromScalar :: F r -&gt; t (F r)\n  in Foo $ fromScalar' $ toF c\n</code></pre>\n\n<p>I'm willing to concede something screwy with monomorphic types is at work here, even though removing the restrictions didn't help. My question is: why is the restriction triggered by the addition of a generic instance? More importantly, why does GHC try to match the generic instance instead of using the <code>T (F r)</code> constraint? That seems plain wrong, and smells of <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10195\" rel=\"nofollow noreferrer\">this bug</a>.</p>\n"}, {"tags": ["haskell", "llvm"], "comments": [{"owner": {"reputation": 304, "user_id": 2106446, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f491e7a9639e216e8310904f7d4869d?s=128&d=identicon&r=PG", "display_name": "Arbus", "link": "https://stackoverflow.com/users/2106446/arbus"}, "edited": false, "score": 0, "creation_date": 1429593378, "post_id": 29762077, "comment_id": 47658543, "body": "This guy seems to have them pre-built <a href=\"https://github.com/CRogers/LLVM-Windows-Binaries\" rel=\"nofollow noreferrer\">github.com/CRogers/LLVM-Windows-Binaries</a> but I would build from source just to be on the safe side"}, {"owner": {"reputation": 17943, "user_id": 396383, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/9WwJr.jpg?s=128&g=1", "display_name": "Thomson", "link": "https://stackoverflow.com/users/396383/thomson"}, "reply_to_user": {"reputation": 304, "user_id": 2106446, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f491e7a9639e216e8310904f7d4869d?s=128&d=identicon&r=PG", "display_name": "Arbus", "link": "https://stackoverflow.com/users/2106446/arbus"}, "edited": false, "score": 0, "creation_date": 1429683764, "post_id": 29762077, "comment_id": 47707664, "body": "@Arbus the pre-built Windows binaries are based on LLVM 3.4, so build it locally would be a better option."}], "owner": {"reputation": 2250, "user_id": 1615960, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7db140c411af77bcb74106adb1a61630?s=128&d=identicon&r=PG", "display_name": "MFlamer", "link": "https://stackoverflow.com/users/1615960/mflamer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 885, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1429584990, "creation_date": 1429584990, "question_id": 29762077, "link": "https://stackoverflow.com/questions/29762077/where-can-i-get-llvm-config-for-windows", "title": "where can I get llvm-config for windows?", "body": "<p>I need llvm-config because I'm trying to use the Haskell module llvm-general. I just installed llvm 3.6 using the windows installer and it does not contain this .exe. Is there somewhere else I can aquire it? Thanks.</p>\n"}, {"tags": ["file", "haskell", "filter"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1429637075, "post_id": 29760061, "comment_id": 47688306, "body": "FWIW, <code>(lines contents)</code> is a list of lines, not words."}], "answers": [{"comments": [{"owner": {"reputation": 528, "user_id": 4669619, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4786954ed80039c912a8967576e07ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Ali", "link": "https://stackoverflow.com/users/4669619/ali"}, "edited": false, "score": 0, "creation_date": 1429573048, "post_id": 29760278, "comment_id": 47652675, "body": "Before &quot;filteredWords &lt;-&quot; happens, I want to first read the file, and then filter it with given length so when &quot;&lt;-&quot; happens, filteredWords will have only words of that specific length."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1429572747, "creation_date": 1429572747, "answer_id": 29760278, "question_id": 29760061, "link": "https://stackoverflow.com/questions/29760061/filter-file-by-length-before-saving-haskell/29760278#29760278", "title": "Filter file by length BEFORE saving haskell", "body": "<p>I am not sure I completely understand this question. It centers around the notion of \"before saving it as a list of words\", which seems to be misleading in a lazy language. In Haskell, doing </p>\n\n<pre><code>let list1 = someLongList\n    list2 = filter p list1 \nin use list2              -- (but do not use list1)\n</code></pre>\n\n<p>will not cause <code>list1</code> to be stored in memory completely: rather, elements not satisfying <code>p</code> will be discarded immediately.\nHence, the notion of filtering a list before \"saving\" it is not meaningful: this is a standard optimization that the compiler will do for you.</p>\n\n<p>Rather, separating input/output and filtering is the preferred way. The alternative, namely mixing I/O and pure computation in the code is generally regarded as a worse approach. Haskell types also encourage the first, simpler, approach.</p>\n"}, {"comments": [{"owner": {"reputation": 528, "user_id": 4669619, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4786954ed80039c912a8967576e07ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Ali", "link": "https://stackoverflow.com/users/4669619/ali"}, "edited": false, "score": 0, "creation_date": 1429579111, "post_id": 29760978, "comment_id": 47654449, "body": "This one is short and sweet and worked perfectly with the getWords I already have. I&#39;ll wait for a few more answers if any can be done without using getWords (still one liner), if not, I&#39;ll accept this as the answer."}], "tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": true, "score": 6, "last_activity_date": 1429609529, "last_edit_date": 1429609529, "creation_date": 1429577475, "answer_id": 29760978, "question_id": 29760061, "link": "https://stackoverflow.com/questions/29760061/filter-file-by-length-before-saving-haskell/29760978#29760978", "title": "Filter file by length BEFORE saving haskell", "body": "<p>Use the fact that <code>IO</code> is also an instance of <code>Functor</code></p>\n\n<pre><code>filteredWords &lt;- fmap (filter (\\x -&gt; length x == 3)) $ getWords path\n</code></pre>\n\n<p>Since you asked about how to do it without using <code>getWords</code>: you can use the function composition operator <code>.</code>.</p>\n\n<pre><code>filteredWords &lt;- fmap (filter (\\x -&gt; length x == 3) . lines) $ readFile path\n</code></pre>\n\n<p>I think <code>readFile</code> is in <code>Prelude</code>, if it's not then it will be in <code>System.IO</code></p>\n"}, {"tags": [], "owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "is_accepted": false, "score": 4, "last_activity_date": 1429577638, "creation_date": 1429577638, "answer_id": 29761001, "question_id": 29760061, "link": "https://stackoverflow.com/questions/29760061/filter-file-by-length-before-saving-haskell/29761001#29761001", "title": "Filter file by length BEFORE saving haskell", "body": "<p>Yes.  Here is an example using <code>pipes</code> that avoids materializing the full list of words.  Only the words of the specified length will be retained in memory:</p>\n\n<pre><code>import Pipes\nimport qualified Pipes.Prelude as Pipes\nimport qualified System.IO as IO\n\nfilteredWords :: FilePath -&gt; IO [String]\nfilteredWords path =\n    IO.withFile path IO.ReadMode (\\handle -&gt; Pipes.toListM (\n        Pipes.fromHandle handle &gt;-&gt; Pipes.filter (\\x -&gt; length x == 3) ))\n</code></pre>\n\n<p>So, for example, if your file had 1,000,000 words, but only 4 of them had length 3, then this program would only generate a list of length 4.  All the other elements would be discarded immediately after they were read and not stored in memory in some intermediate list.</p>\n"}], "owner": {"reputation": 528, "user_id": 4669619, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4786954ed80039c912a8967576e07ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Ali", "link": "https://stackoverflow.com/users/4669619/ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 29760978, "answer_count": 3, "score": 1, "last_activity_date": 1429609529, "creation_date": 1429571608, "last_edit_date": 1495541194, "question_id": 29760061, "link": "https://stackoverflow.com/questions/29760061/filter-file-by-length-before-saving-haskell", "title": "Filter file by length BEFORE saving haskell", "body": "<p>A similar question has been asked, but with a list in hand:\n<a href=\"https://stackoverflow.com/questions/21410293\">Filter list items by length in Haskell</a></p>\n\n<p>I already know how to get a word list from a file</p>\n\n<pre><code>getWords path = do contents &lt;- readFile path\n                   return (lines contents)\n</code></pre>\n\n<p>And then I can filter it to get words of specific length, but...</p>\n\n<p>What I am wondering is if there is a way (preferably not in point-free style - unless necessary) to filter the file by length <strong>before</strong> saving it as a list of words.</p>\n\n<p>For example, words.txt is file of words with 1 word per line.</p>\n\n<pre><code>filteredWords &lt;- filter (\\x -&gt; length x == 3) *Read words.txt in place*\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1429573449, "post_id": 29759727, "comment_id": 47652827, "body": "I&#39;d try to use a restricted functor for this, similarly to restricted monads work. See e.g. <a href=\"http://okmij.org/ftp/Haskell/types.html#restricted-datatypes\" rel=\"nofollow noreferrer\">okmij.org/ftp/Haskell/types.html#restricted-datatypes</a> . Returning an error seems bad (typed programs should not go wrong -- not so easily, at least). The &quot;composite&quot; option may require sophisticated and fragile hackery like OverlappingInstances -- which I personally find too tricky to recommend."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1429631530, "post_id": 29759727, "comment_id": 47684587, "body": "If this is numeric code, you should consider whether <b>Hask</b> is even conceptually the right category. For linear algebra purposes, the <code>Functor</code> instance of <code>Array</code> doesn&#39;t really make <i>sense</i>, because it depends on a choice of what basis you use to describe your vector space. (Those mighty category-theory tools can still be handy to you, but perhaps better in <a href=\"https://github.com/leftaroundabout/manifolds/blob/master/manifolds/Data/LinearMap/Category.hs\" rel=\"nofollow noreferrer\">a completely different way</a>.) \u2014 If all you want is a <code>map</code> function... then you really don&#39;t need a <code>Functor</code> instance!"}, {"owner": {"reputation": 452, "user_id": 2006135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef3ac5dd2108e05f505ff9ed04740196?s=128&d=identicon&r=PG", "display_name": "Erik Schnetter", "link": "https://stackoverflow.com/users/2006135/erik-schnetter"}, "edited": false, "score": 0, "creation_date": 1429668145, "post_id": 29759727, "comment_id": 47702551, "body": "Using chi&#39;s pointer, I implemented my own versions of Foldable and Functor that are independent of the Prelude&#39;s. This is working fine. And maybe this is indeed the way to go; as leftaroundabout says, I can use amap and azipWith. And yes, in the end I will want to define the notion of a vector space (and likely vector space transformers)."}], "answers": [{"tags": [], "owner": {"reputation": 452, "user_id": 2006135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef3ac5dd2108e05f505ff9ed04740196?s=128&d=identicon&r=PG", "display_name": "Erik Schnetter", "link": "https://stackoverflow.com/users/2006135/erik-schnetter"}, "is_accepted": false, "score": 1, "last_activity_date": 1429892140, "creation_date": 1429892140, "answer_id": 29852529, "question_id": 29759727, "link": "https://stackoverflow.com/questions/29759727/make-uarray-a-functor/29852529#29852529", "title": "Make UArray a Functor", "body": "<p><a href=\"https://hackage.haskell.org/package/vector-0.9.1/docs/Data-Vector-Unboxed.html\" rel=\"nofollow\"><code>Data.Vector.Unboxed</code></a> provides an implementation of what I am looking for. It is already an instance of <code>Functor</code>, and automatically chooses an efficient representation if possible.</p>\n"}], "owner": {"reputation": 452, "user_id": 2006135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef3ac5dd2108e05f505ff9ed04740196?s=128&d=identicon&r=PG", "display_name": "Erik Schnetter", "link": "https://stackoverflow.com/users/2006135/erik-schnetter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1429892140, "creation_date": 1429569698, "question_id": 29759727, "link": "https://stackoverflow.com/questions/29759727/make-uarray-a-functor", "title": "Make UArray a Functor", "body": "<p>I want to treat <code>UArray</code> as instance of <code>Functor</code>. I want to write a numeric code, and I need to use something more efficient than <code>Array</code> to represent the state (says the profiler). I understand that I could write my code without using functors, but I think functors are a very valuable abstraction that I'd like to have.</p>\n\n<p>As-is this doesn't work, because <code>UArray</code> is only an instance of <code>IArray</code> for certain basic types such as <code>Int</code> or <code>Double</code>. I am contemplating two approaches to make it work nonetheless:</p>\n\n<ul>\n<li>Return an error (either implicitly or explicitly) if the result of <code>fmap</code> is not an instance of <code>IArray</code></li>\n<li>Define a \"composite\" type that is either based on <code>UArray</code> (if possible) or on <code>Array</code> (if not), akin to a C++ template specialization</li>\n</ul>\n\n<p>I've tried various approaches based on various GHC extensions (existential types, functional dependencies, generalized algebraic data types, multi-parameter type classes, undecidable instances), but I just can't make things work. I always arrive at a point where I need to promise the compiler that \"yes, the result will be representable via <code>UArray</code>\", but there's just no syntax for it.</p>\n\n<p>I've read various papers, tutorials, and documentation for the GHC extensions above in the hope to find an example that tells me how to do that. The closest I could find is <a href=\"https://wiki.haskell.org/GADTs_for_dummies\" rel=\"nofollow\">https://wiki.haskell.org/GADTs_for_dummies</a>, which defines a class <code>IsSimple</code> that is very close to what I probably need.</p>\n\n<p>Can you give me a pointer for how to get started?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1429565008, "post_id": 29758493, "comment_id": 47649558, "body": "is it only me or is your <i>signature</i> off - either <code>op :: t -&gt; t -&gt; t</code> or you even <code>fT :: (t1 -&gt; t2 -&gt; t) -&gt; (t3 -&gt; t1) -&gt; (t3 -&gt; t2) -&gt; t3 -&gt; t</code> (says ghci) ;)"}, {"owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "edited": false, "score": 0, "creation_date": 1429565096, "post_id": 29758493, "comment_id": 47649599, "body": "Is <code>on</code> from <code>Data.Function</code> what you&#39;re looking for?"}, {"owner": {"reputation": 682, "user_id": 3421913, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b267474c6f0ce7338d7bcd3ca14d9648?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastien", "link": "https://stackoverflow.com/users/3421913/sebastien"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429565581, "post_id": 29758493, "comment_id": 47649881, "body": "@CarstenK&#246;nig indeed... I&#39;ve edited my post. @Mokosha not exactly, with <code>on</code>, there is only one <code>f</code>, in my case there is <code>f1</code> and <code>f2</code>."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429565628, "post_id": 29758493, "comment_id": 47649904, "body": "but now your signature is even more off (<code>&gt;= 0)</code> surely is not of type <code>bool -&gt; bool</code> - let me help you out ;)"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1429565789, "post_id": 29758493, "comment_id": 47649982, "body": "I think what you really want is <code>liftA2</code> or <code>liftM2</code> on <code>&amp;&amp;</code>, so <code>(&lt;&amp;&amp;&gt;) = liftM2 (&amp;&amp;)</code> then you can use it as <code>(&gt;=0) &lt;&amp;&amp;&gt; (&lt;= 100)</code>, etc.  This has the added benefit of working on any applicative or monad, not just the function applicative or monad (which is what we take advantage of here).  It&#39;d probably be best to define it using <code>liftA2</code> because this is less restrictive than <code>liftM2</code>, but you probably won&#39;t come across any problems from using <code>liftM2</code> often."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1429565880, "post_id": 29758493, "comment_id": 47650022, "body": "@bheklilr you should make this into an answer"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1429566175, "post_id": 29758493, "comment_id": 47650178, "body": "Thinking about it here the idea in Yesod is probably to just use <code>(.)</code> and multiple <code>checkBool</code> (or other Validation) or just use an point-full lambda (I would do) - most of this fancier point-free stuff is just a bit to hard to read/remember for my taste - although @bheklilr solution seem reasonable nice ;)"}], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 6, "last_activity_date": 1429566390, "creation_date": 1429566390, "answer_id": 29759008, "question_id": 29758493, "link": "https://stackoverflow.com/questions/29758493/transform-operator-on-type-t-to-operator-on-type-a-t/29759008#29759008", "title": "Transform operator on type `t` to operator on type `a-&gt;t`", "body": "<p>What you're really looking for is the <code>liftA2</code> or <code>liftM2</code> combinators (from <code>Control.Applicative</code> or <code>Control.Monad</code> respectively).  <code>liftM2</code> is going to work the same as <code>liftA2</code> since all monads are applicatives, but it's up to you if you want to be more or less restrictive.  Using the monadic implementation will also force order of evaluation of the arguments, which can't be guaranteed by <code>liftA2</code>.</p>\n\n<p>You can use it as</p>\n\n<pre><code>(&lt;&amp;&amp;&gt;) :: Applicative f =&gt; f Bool -&gt; f Bool -&gt; f Bool\n(&lt;&amp;&amp;&gt;) = liftA2 (&amp;&amp;)\n</code></pre>\n\n<p>For functions like <code>(&gt;= 0)</code> or <code>(&lt;= 100)</code>, The <code>Applicative f =&gt; f</code> gets specialized to <code>(Ord a, Num a) =&gt; (-&gt;) a</code>, so the type signature would be</p>\n\n<pre><code>(&lt;&amp;&amp;&gt;) :: (Ord a, Num a) =&gt; (a -&gt; Bool) -&gt; (a -&gt; Bool) -&gt; (a -&gt; Bool)\n</code></pre>\n\n<p>So you could write something like</p>\n\n<pre><code>between :: Int -&gt; Int -&gt; Int -&gt; Bool\nbetween lower upper = (lower &lt;=) &lt;&amp;&amp;&gt; (&lt;= upper)\n</code></pre>\n\n<p>If you defined <code>&lt;||&gt; = liftM2 (||)</code> then you could even do something more complicated like</p>\n\n<pre><code>between 0 100 &lt;||&gt; between 200 400 &lt;||&gt; (&gt;= 1000) :: Int -&gt; Bool\n</code></pre>\n\n<p>Which would check if the number is an element of <code>[0, 100] U [200, 400] U [1000, inf)</code> if we were writing this in set notation (<code>U</code> is set union).</p>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 2, "last_activity_date": 1429574538, "last_edit_date": 1429574538, "creation_date": 1429572478, "answer_id": 29760228, "question_id": 29758493, "link": "https://stackoverflow.com/questions/29758493/transform-operator-on-type-t-to-operator-on-type-a-t/29760228#29760228", "title": "Transform operator on type `t` to operator on type `a-&gt;t`", "body": "<p>This code is in the <code>Control.Applicative</code> module:</p>\n\n<pre><code>instance Applicative ((-&gt;) r) where\n    pure a = \\_ -&gt; a\n    ff &lt;*&gt; fa = \\r -&gt; ff r (fa r)\n\nliftA2 :: Applicative f =&gt; f (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\nliftA2 f fa fb = pure f &lt;*&gt; fa &lt;*&gt; fb\n</code></pre>\n\n<p>Your <code>fT</code> function is just what we get when we take <code>liftA2</code> and use <code>(-&gt;) a</code> for <code>f</code>, and <code>t</code> for <code>a</code>, <code>b</code> and <code>c</code>.  We can rewrite your function just like this: </p>\n\n<pre><code>fT :: (t -&gt; t -&gt; t) -&gt; (a -&gt; t) -&gt; (a -&gt; t) -&gt; (a -&gt; t)\nfT = liftA2\n</code></pre>\n\n<p>By substitution, we can prove it's the same as yours:</p>\n\n<pre><code>liftA2 op f1 f2\n    = (pure op &lt;*&gt; f1) &lt;*&gt; f2\n    = \\a -&gt; (pure op &lt;*&gt; f1) a (f2 a)\n    = \\a -&gt; (\\a -&gt; pure op a (fa 1)) a (f2 a)\n    = \\a -&gt; (\\a -&gt; (\\_ -&gt; op) a (f1 a)) a (f2 a)\n    = \\a -&gt; (\\a -&gt; op (f1 a)) a (f2 a)\n    = \\a -&gt; op (f1 a) (f2 a)\n    = \\a -&gt; (f1 a) `op` (f2 a)\n</code></pre>\n"}], "owner": {"reputation": 682, "user_id": 3421913, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b267474c6f0ce7338d7bcd3ca14d9648?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastien", "link": "https://stackoverflow.com/users/3421913/sebastien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 29759008, "answer_count": 2, "score": 3, "last_activity_date": 1429574538, "creation_date": 1429564321, "last_edit_date": 1429565650, "question_id": 29758493, "link": "https://stackoverflow.com/questions/29758493/transform-operator-on-type-t-to-operator-on-type-a-t", "title": "Transform operator on type `t` to operator on type `a-&gt;t`", "body": "<p>Is this a standard way to transform operator on type <code>t</code> to operator on type <code>a-&gt;t</code>? I.e., is this a lib implementing this function (<code>fT</code> like <code>functionTransformer</code>):</p>\n\n<pre><code>fT :: (t -&gt; t -&gt; t) -&gt; (a -&gt; t) -&gt; (a -&gt; t) -&gt; (a -&gt; t)\nfT op f1 f2 = \\x -&gt; (f1 x) `op` (f2 x)\n</code></pre>\n\n<p>(we could generalize to <code>fT :: (t1 -&gt; t2 -&gt; t) -&gt; (t3 -&gt; t1) -&gt; (t3 -&gt; t2) -&gt; t3 -&gt; t</code>)</p>\n\n<p>I was asking this question when learning Yesod: in this framework, we can add a validation condition for a field thanks to <code>checkBool</code>. For instance, I can create a field which only accepts value greater thant 100 with:</p>\n\n<pre><code>smallIntField = checkBool (&lt;= 100) \"error: this entry has to be smaller than 100\" intField\n</code></pre>\n\n<p>Thanks to my \"function transformer\", I can easily manage bounded value with:</p>\n\n<pre><code>($&amp;&amp;) = fT (&amp;&amp;)\nboundedIntField = checkBool ((&gt;= 0) $&amp;&amp; (&lt;= 100)) \"error: this entry has to be between 0 and 100\" intField\n</code></pre>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 13, "creation_date": 1429564171, "post_id": 29758412, "comment_id": 47649122, "body": "This sounds an awful lot like homework and it&#39;s not Haskell related in the least. What have you tried? Why didn&#39;t it work? Have you looked up <a href=\"http://en.wikipedia.org/wiki/De_Morgan%27s_laws\" rel=\"nofollow noreferrer\">de Morgan&#39;s law</a>?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1429565374, "post_id": 29758412, "comment_id": 47649777, "body": "maybe we should implement a DSL where you can only <b>and</b> and <b>or</b> and then use this ;) ... btw: you are learning Java and Haskell at the same time as a total beginner? <i>Wow</i>"}], "answers": [{"tags": [], "owner": {"reputation": 3124, "user_id": 631004, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d8c9b1e28e202f4aea71129683fa681?s=128&d=identicon&r=PG", "display_name": "Tilo", "link": "https://stackoverflow.com/users/631004/tilo"}, "is_accepted": false, "score": 2, "last_activity_date": 1429564331, "creation_date": 1429564331, "answer_id": 29758499, "question_id": 29758412, "link": "https://stackoverflow.com/questions/29758412/how-do-i-define-a-or-function-in-haskell/29758499#29758499", "title": "How do I define a &quot;or&quot; function in Haskell?", "body": "<p>Use <a href=\"http://en.wikipedia.org/wiki/De_Morgan%27s_laws\" rel=\"nofollow\">De Morgan's law</a> to convert between <code>or</code> and <code>and</code>. </p>\n"}], "owner": {"reputation": 1, "user_id": 4605883, "user_type": "registered", "profile_image": "https://graph.facebook.com/455288024628349/picture?type=large", "display_name": "Jibos", "link": "https://stackoverflow.com/users/4605883/jibos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "closed_date": 1429570285, "answer_count": 1, "score": -3, "last_activity_date": 1429565401, "creation_date": 1429564023, "last_edit_date": 1429565401, "question_id": 29758412, "link": "https://stackoverflow.com/questions/29758412/how-do-i-define-a-or-function-in-haskell", "closed_reason": "Needs details or clarity", "title": "How do I define a &quot;or&quot; function in Haskell?", "body": "<p>How do I define an \"or\" function in Haskell, in which I only can use &amp;&amp; and not?\nMy task is to write a function thereof. However, I do not know how to do that.\nCan you help me?</p>\n"}, {"tags": ["haskell", "exception", "exit"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1429559157, "post_id": 29756913, "comment_id": 47646234, "body": "It shouldn&#39;t print that, what exactly are you doing?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1429559267, "post_id": 29756913, "comment_id": 47646308, "body": "Are you executing that code in ghci? When I <i>compile</i> the code it doesn&#39;t print that, but using ghci it does show the error.  I believe it&#39;s because ghci adds a custom exception handler (in fact it doesn&#39;t exit at all!)"}, {"owner": {"reputation": 528, "user_id": 4669619, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4786954ed80039c912a8967576e07ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Ali", "link": "https://stackoverflow.com/users/4669619/ali"}, "edited": false, "score": 0, "creation_date": 1429559492, "post_id": 29756913, "comment_id": 47646457, "body": "I am using Haskell Platform, which I believe executes in ghci. Here is a snippet of my code: if opt == 3 then do exitWith ExitSuccess else ..."}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 1, "creation_date": 1429561227, "post_id": 29756913, "comment_id": 47647486, "body": "@Ali The Haskell Platform is a platform that contains GHC (which includes GHCi) and Cabal and many other useful libraries. So that information doesn&#39;t really tell us wether you are using GHC or GHCi."}, {"owner": {"reputation": 528, "user_id": 4669619, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4786954ed80039c912a8967576e07ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Ali", "link": "https://stackoverflow.com/users/4669619/ali"}, "edited": false, "score": 0, "creation_date": 1429563007, "post_id": 29756913, "comment_id": 47648466, "body": "I run the program in ghci"}], "answers": [{"comments": [{"owner": {"reputation": 528, "user_id": 4669619, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4786954ed80039c912a8967576e07ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Ali", "link": "https://stackoverflow.com/users/4669619/ali"}, "edited": false, "score": 0, "creation_date": 1429563096, "post_id": 29757762, "comment_id": 47648521, "body": "So should I just ignore the the &quot;*** Exception: ExitSuccess&quot; output that ghci produces and continue with the code?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 528, "user_id": 4669619, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4786954ed80039c912a8967576e07ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Ali", "link": "https://stackoverflow.com/users/4669619/ali"}, "edited": false, "score": 0, "creation_date": 1429563305, "post_id": 29757762, "comment_id": 47648660, "body": "@Ali Yes, you can ignore it in <code>ghci</code>. It doesn&#39;t matter anyway. All you have to worry is the exit status of the process. And that is <code>0</code> as expected."}, {"owner": {"reputation": 528, "user_id": 4669619, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4786954ed80039c912a8967576e07ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Ali", "link": "https://stackoverflow.com/users/4669619/ali"}, "edited": false, "score": 0, "creation_date": 1429563474, "post_id": 29757762, "comment_id": 47648746, "body": "Thank you. I have accepted your answer, which is an addition of the three comments before."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 9, "last_activity_date": 1429561663, "creation_date": 1429561663, "answer_id": 29757762, "question_id": 29756913, "link": "https://stackoverflow.com/questions/29756913/exit-quietly-without-exception-haskell/29757762#29757762", "title": "Exit quietly (without exception) haskell", "body": "<p>Expanding the above comments here (Credits to Reid, Bakuriu and Jeffrey). It's highly likely that you are executing the following program in <code>ghci</code>:</p>\n\n<pre><code>import System.Exit\n\nmain :: IO ()\nmain = exitWith ExitSuccess\n</code></pre>\n\n<p>Now in terminal:</p>\n\n<pre><code>$ ghci\n\u03bb&gt; :load crash.hs -- crash.hs is the filename\n\u03bb&gt; main\n*** Exception: ExitSuccess\n</code></pre>\n\n<p>Note that <code>ghci</code> and <code>ghc</code> are different. <code>ghci</code> is used as a REPL for Haskell. The above code when compiled and executed like the following won't produce any message:</p>\n\n<pre><code>$ ghc -o crash crash.hs \n$ ./crash\n</code></pre>\n\n<p>Note that the REPL is invoked through the program named <code>ghci</code>. For compiling and producing an executable, you have to use a executable named <code>ghc</code>.</p>\n"}], "owner": {"reputation": 528, "user_id": 4669619, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4786954ed80039c912a8967576e07ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Ali", "link": "https://stackoverflow.com/users/4669619/ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1997, "favorite_count": 0, "accepted_answer_id": 29757762, "answer_count": 1, "score": 12, "last_activity_date": 1429561663, "creation_date": 1429558910, "question_id": 29756913, "link": "https://stackoverflow.com/questions/29756913/exit-quietly-without-exception-haskell", "title": "Exit quietly (without exception) haskell", "body": "<p>I know that</p>\n\n<pre><code>exitWith ExitSuccess\n</code></pre>\n\n<p>exits the program, but it outputs</p>\n\n<pre><code>*** Exception: ExitSuccess\n</code></pre>\n\n<p>I am wanting to know if there is way to exit <strong>without</strong> outputting anything onto the screen?</p>\n"}, {"tags": ["json", "haskell", "yaml", "ghc"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1429556136, "post_id": 29755883, "comment_id": 47644386, "body": "<code>&lt;$&gt;</code> <i>is</i> <code>fmap</code>, it isn&#39;t just similar to.  And <code>MyProfile</code> in an expression is a constructor, which has the type <code>String -&gt; Int -&gt; MyProfile</code>.  When you see <code>MyProfile</code> in a type signature it&#39;s indicating the name of the data type.  Constructors are essentially just functions."}, {"owner": {"reputation": 1682, "user_id": 1137470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/UdtsO.jpg?s=128&g=1", "display_name": "shar", "link": "https://stackoverflow.com/users/1137470/shar"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1429556279, "post_id": 29755883, "comment_id": 47644494, "body": "@bheklilr: Yeah that clears some part of my doubts. So in this case, <code>m .: &quot;name&quot;</code> returns a Parser ( FromJSON) and MyProfile is a FromJSON? So the function MyProfile is being applied over throughout the applicative functors? Is my understanding correct?"}], "owner": {"reputation": 1682, "user_id": 1137470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/UdtsO.jpg?s=128&g=1", "display_name": "shar", "link": "https://stackoverflow.com/users/1137470/shar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1429555305, "creation_date": 1429555305, "question_id": 29755883, "link": "https://stackoverflow.com/questions/29755883/understanding-the-data-aeson-fromjson-typeclass", "title": "Understanding the Data.Aeson FromJSON typeclass", "body": "<p>I recently started using Data.Aeson for one of my projects. And I am recently new to Haskell as well. So I am trying to figure out how the implementation of <code>parseJSON</code> function in <code>FromJSON</code> typeclass works.</p>\n\n<p>So I have a code from my codebase.</p>\n\n<pre><code>data MyProfile = MyProfile { name :: String, age :: Int } deriving Show\n\ninstance FromJSON MyProfile where\nparseJSON (Object m) = MyProfile &lt;$&gt;\n                       m .: \"name\" &lt;*&gt;\n                       m .: \"age\"\nparseJSON x          = fail (\"not an object: \" ++ show x)       \n</code></pre>\n\n<p>And the YAML file I am trying to read is pretty simple as well.</p>\n\n<pre><code>profile:\n    name: \"Foo\"\n    age: 16\n</code></pre>\n\n<p>I am trying to understand the working of that applicative functor. I browsed through the Data.Aeson module and found that (.:) returns a Parser (FromJSON a). </p>\n\n<p>So the facts that I have understood is,</p>\n\n<ul>\n<li>Object m holds the <code>profile:</code> section of the yaml</li>\n<li><code>MyProfile</code> corresponds to <code>profile</code></li>\n<li><code>name</code> in <code>ParseJSON</code> is trying to get the value for the key in the JSON object m</li>\n<li>Similar with <code>age</code> as well</li>\n<li>And each <code>&lt;*&gt;</code> returns a <code>Parser (FromJSON)</code> which is then applied over to the next <code>&lt;*&gt;</code></li>\n</ul>\n\n<p>What I am not understanding is,</p>\n\n<ul>\n<li>How does <code>MyProfile</code> gets mapped to the <code>profile</code> section? What if I have a huge yaml file and multiple data defined in my program?</li>\n<li>In the code <code>MyProfile &lt;$&gt; m .: \"name\"</code>, shouldn't the first argument of <code>&lt;$&gt;</code> be a function? I perceive that <code>&lt;$&gt;</code> is similar to fmap and hence the first argument must be a function (which is applied to the second argument). But MyProfile is a data! Confusing!</li>\n<li>How is the yaml values, in this case, Foo and 16, added to the MyProfile data?</li>\n</ul>\n\n<p>Please correct me if any of my understandings is wrong.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 6, "creation_date": 1429551810, "post_id": 29754686, "comment_id": 47641648, "body": "Have a go at least.  What do you know about how inductive proofs work? Give it a try, even if you&#39;re totally unsure."}, {"owner": {"reputation": 55, "user_id": 4808160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1e736989c29002be5f920c48ec86a07?s=128&d=identicon&r=PG&f=1", "display_name": "Kamran", "link": "https://stackoverflow.com/users/4808160/kamran"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1429551936, "post_id": 29754686, "comment_id": 47641722, "body": "ok i will post my attempt in a couple of hours but thankyou anywayz"}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 4808160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1e736989c29002be5f920c48ec86a07?s=128&d=identicon&r=PG&f=1", "display_name": "Kamran", "link": "https://stackoverflow.com/users/4808160/kamran"}, "edited": false, "score": 0, "creation_date": 1429572626, "post_id": 29759519, "comment_id": 47652524, "body": "so here u have proved the base case using &#39;addtoall m (addtoall n xs) = addtoall (m + n) xs&#39; and also line a.0 from the function addtoall? so i am guessing you have done the right hand statement and left hand statement."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 55, "user_id": 4808160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1e736989c29002be5f920c48ec86a07?s=128&d=identicon&r=PG&f=1", "display_name": "Kamran", "link": "https://stackoverflow.com/users/4808160/kamran"}, "edited": false, "score": 0, "creation_date": 1430081224, "post_id": 29759519, "comment_id": 47890570, "body": "I finished the <i>proof</i> as I think it&#39; s ok now (after almost a week)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 3, "last_activity_date": 1430081151, "last_edit_date": 1430081151, "creation_date": 1429568751, "answer_id": 29759519, "question_id": 29754686, "link": "https://stackoverflow.com/questions/29754686/haskell-formulate-and-prove-a-base-case-and-inductive-step/29759519#29759519", "title": "haskell( Formulate and prove a base case and inductive step)", "body": "<p>as this is obvious some kind of homework I'll only show you the beginning.</p>\n\n<p>So you should use structural induction - the only structure you have here is the structure of the list (and the exercise even tells you to ;)) - so the base case will be <code>[]</code> - what is the inductive case?</p>\n\n<p>Now you have to prove it for both cases.</p>\n\n<h2>how to do it</h2>\n\n<p>To prove this using <em>structural induction</em> on <code>xs</code> you have to prove two cases:</p>\n\n<ul>\n<li>the <strong>base case</strong> with <code>xs := []</code></li>\n<li>the <strong>inductive case</strong> with <code>xs := y:ys</code></li>\n</ul>\n\n<p>In both cases the most simple thing to do is to work on the left and right hand side to see if both are finally equal (if you know how you can work on the left and change it into the right) - always using the function-definitions and the information you`ve got from the case at hand.</p>\n\n<p>For example in the <em>inductive case</em>  you not only have that <code>xs = y:ys</code> but you may also use that </p>\n\n<p><code>addtoall m (addtoall n ys) = addtoall (m+n) ys</code> <strong>(Ind)</strong></p>\n\n<h2>base case</h2>\n\n<p>so start by simply writing both sides down and massage them with the definitions::</p>\n\n<h3>left:</h3>\n\n<pre><code>addtoall m (addtoall n [])\n{ a.0 }\n= addtoall m []\n{ a.0 }\n= []\n</code></pre>\n\n<h3>right:</h3>\n\n<pre><code>addtoall (m+n) []\n{ a.0 }\n= []\n</code></pre>\n\n<p>obviously both sides are equal and you proved the first part.</p>\n\n<p>Not think about the <em>inductive</em> case (hint: you surely need <code>a.1</code> and have to use induction somehow) and try it ... it should not be hard - you basically only have to rewrite the stuff you already have and then play <em>evaluator</em></p>\n\n<h2>inductive case</h2>\n\n<p>Please try it with this template:</p>\n\n<h3>left:</h3>\n\n<pre><code>addtoall m (addtoall n (y:ys))\n{ a.1 - inner }\n= addtoall m ((y+n) : addtoall n ys)\n{ a.1 - outer }\n= ((y+n)+m) : addtoall m (addtoall n ys)\n{ Ind }\n= ((y+n)+m) : addtoall (m+n) ys\n{ arithm }\n= (y+(m+n)) : addtoall (m+n) ys\n</code></pre>\n\n<h3>right:</h3>\n\n<pre><code>addtoall (m+n) (y:ys)\n{ a.1 }\n(y+(m+n)) : addtoall (m+n) ys\n</code></pre>\n\n<p><strong>remember</strong> in the end you should see the same thing</p>\n\n<h2>remarks</h2>\n\n<ul>\n<li>I think you tried the right thing there but you should really add the needed steps (but your solution looks like the thing you want to see both left and right - so work towards it)</li>\n<li>usually you write <code>x:xs</code> in the inductive case but I wanted to make sure that you try the steps - also I was afraid that you might missinterpret <code>xs:=x:xs</code> ;)</li>\n</ul>\n\n<h2>external links</h2>\n\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Structural_induction\" rel=\"nofollow\">Structural induction - Wikipedia</a></li>\n</ul>\n"}], "owner": {"reputation": 55, "user_id": 4808160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1e736989c29002be5f920c48ec86a07?s=128&d=identicon&r=PG&f=1", "display_name": "Kamran", "link": "https://stackoverflow.com/users/4808160/kamran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 0, "closed_date": 1429598952, "accepted_answer_id": 29759519, "answer_count": 1, "score": -1, "last_activity_date": 1430081151, "creation_date": 1429551539, "last_edit_date": 1429653527, "question_id": 29754686, "link": "https://stackoverflow.com/questions/29754686/haskell-formulate-and-prove-a-base-case-and-inductive-step", "closed_reason": "Needs more focus", "title": "haskell( Formulate and prove a base case and inductive step)", "body": "<p><strong>I have some knowledge on haskell but need support to formulate and prove a base case and inductive step.</strong></p>\n\n<p>The user-defined Haskell function</p>\n\n<pre><code>addtoall :: Int -&gt; [Int] -&gt; [Int]\n</code></pre>\n\n<p>defined below, adds to each entry of an integer list a specified number (the first argument ofaddtoall).</p>\n\n<pre><code>addtoall :: Int -&gt; [Int] -&gt; [Int]\naddtoall n [] = [] -- a.0\naddtoall n (x:xs) = (x + n) : (addtoall n xs) -- a.1\n</code></pre>\n\n<p>The following exemplifies the behaviour of\naddtoall:</p>\n\n<pre><code>Exam&gt; addtoall 3 [7,2,9,12]\n[10,5,12,15]\n</code></pre>\n\n<p>Look at the interactive session shown here.</p>\n\n<pre><code>Exam&gt;\naddtoall 3 [7,2,9,12]\n[10,5,12,15]\n\nExam&gt;\naddtoall 2 [10,5,12,15]\n[12,7,14,17]\n\nExam&gt;\naddtoall 2 (addtoall 3 [7,2,9,12]\n[12,7,14,17]\n</code></pre>\n\n<p>Based on this, it is suspected that for all finite lists xs of type\n[Int] and all numbers m and n of type Int it is</p>\n\n<pre><code>addtoall m (addtoall n xs) = addtoall (m + n) xs\n</code></pre>\n\n<p>Prove this statement by Structural Induction on xs. It should be conducted in two steps</p>\n\n<p>a) formulate and prove the base case\nb) formulate and prove the inductive step</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5428, "user_id": 57246, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/65a1be62dd6dee67ab4391b410740ec9?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/57246/david"}, "edited": false, "score": 1, "creation_date": 1429553427, "post_id": 29753421, "comment_id": 47642644, "body": "All of these answers are great and helpful --- I don&#39;t really know how to choose one over the others as &quot;THE&quot; answer. Thanks to everyone."}], "answers": [{"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1429547904, "post_id": 29753458, "comment_id": 47639114, "body": "this does future-proof against completely changing the implementation of <code>DateDefinition</code> (to something like <code>data DateDefinition = DateDefinition { secondsSinceEpoch :: Integer }</code>), since your fields can always be ported to normal functions."}, {"owner": {"reputation": 5428, "user_id": 57246, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/65a1be62dd6dee67ab4391b410740ec9?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/57246/david"}, "edited": false, "score": 0, "creation_date": 1429553305, "post_id": 29753458, "comment_id": 47642561, "body": "I&quot;m not sure what to make of these alternatives  (RecordWildCard vs NamedFieldPuns). Surely they would both break if I got rid of a field (and indeed that&#39;s exactly what I&#39;m trying to detect at compile time."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1429553558, "post_id": 29753458, "comment_id": 47642724, "body": "If you&#39;re trying to future-proof against fields that might disappear, it would be best to use the first alternative.  It&#39;s Haskell98, easy to understand, but a bit more verbose.  If you were to change the internal representation of <code>DateDefinition</code> then you could just simply define these accessors as normal functions, and as long as you aren&#39;t using those fields to set values on the type it shouldn&#39;t break anything.  If you want a more robust system than that I would recommend looking at the lens library."}, {"owner": {"reputation": 5428, "user_id": 57246, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/65a1be62dd6dee67ab4391b410740ec9?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/57246/david"}, "edited": false, "score": 0, "creation_date": 1429553862, "post_id": 29753458, "comment_id": 47642920, "body": "I haven&#39;t gotten to lens yet --- it&#39;s on my list but I&#39;m still just revisiting everything to get up to speed."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 5428, "user_id": 57246, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/65a1be62dd6dee67ab4391b410740ec9?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/57246/david"}, "edited": false, "score": 2, "creation_date": 1429553981, "post_id": 29753458, "comment_id": 47642995, "body": "@David If you haven&#39;t gotten there yet then don&#39;t worry about it.  For something as simple as this you probably don&#39;t need them anyway.  Just stick with plain old field accessors, write separate functions to set different values as you need them, and don&#39;t pattern match on the constructor.  You might not end up writing the shortest code, but you can be guaranteed that it&#39;ll be readable and more future proof than the other solutions suggested here."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 5, "last_activity_date": 1429555251, "last_edit_date": 1495534207, "creation_date": 1429547687, "answer_id": 29753458, "question_id": 29753421, "link": "https://stackoverflow.com/questions/29753421/how-can-i-tie-a-pattern-to-specific-items-in-a-data-structure/29753458#29753458", "title": "How can I tie a pattern to specific items in a data structure?", "body": "<p>You can use the field accessors directly; this is the simplest way:</p>\n\n<pre><code>instance Show DateDefinition where\n    show dd = show (monthOfYear dd) ++ \" \" ++ show (dayOfMonth dd)\n</code></pre>\n\n<p>Alternatively, you can use the <code>RecordWildCards</code> extension:</p>\n\n<pre><code>instance Show DateDefinition where\n    show DateDefinition{..} = show monthOfYear ++ \" \" ++ show dayOfMonth\n</code></pre>\n\n<p>Which is nice if you never plan on getting rid of those fields.  If you want to change the internal structure without breaking anything then the first implementation (<a href=\"https://stackoverflow.com/a/29753482\">as pointed out by rampion</a>) is probably the safest.  You can always make those fields into normal functions without anyone ever knowing, so long as you don't export the constructor.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1429550030, "post_id": 29753482, "comment_id": 47640494, "body": "One can use <code>show (monthOfYear &amp;&amp;&amp; dayOfMonth -&gt; (m,d)) = ...</code>. I&#39;d still prefer the first alternative, though."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 3, "last_activity_date": 1429548129, "last_edit_date": 1429548129, "creation_date": 1429547746, "answer_id": 29753482, "question_id": 29753421, "link": "https://stackoverflow.com/questions/29753421/how-can-i-tie-a-pattern-to-specific-items-in-a-data-structure/29753482#29753482", "title": "How can I tie a pattern to specific items in a data structure?", "body": "<p>You can pattern match using the field names:</p>\n\n<pre><code>instance Show DateDefinition where\n   show (DateDefinition { monthOfYear = m, dayOfMonth = d }) \n     = show m ++  \" \" ++ show d\n</code></pre>\n\n<p><s>Alternately, if you're worried about future proofing against getting rid of those fields completely, you could use <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ViewPatterns\" rel=\"nofollow\"><code>ViewPatterns</code></a>:</p>\n\n<pre><code>instance Show DateDefinition where\n   show (monthOfYear -&gt; m)@(dayOfMonth -&gt; d) = show m ++  \" \" ++ show d\n</code></pre>\n\n<p></s></p>\n\n<p>(nope, can't do that with <code>@</code>).</p>\n"}, {"comments": [{"owner": {"reputation": 5428, "user_id": 57246, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/65a1be62dd6dee67ab4391b410740ec9?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/57246/david"}, "edited": false, "score": 0, "creation_date": 1429552385, "post_id": 29753764, "comment_id": 47642017, "body": "Thank you for the suggestions, much appreciated. I am however explicitly opposed to this notion that terseness is a good thing. My experience is that the desire to be terse is the biggest inhibitor to learning and understanding Haskell."}, {"owner": {"reputation": 5428, "user_id": 57246, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/65a1be62dd6dee67ab4391b410740ec9?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/57246/david"}, "edited": false, "score": 0, "creation_date": 1429552760, "post_id": 29753764, "comment_id": 47642242, "body": "By the way, other than your suggestion to change the name of my structure, I don&#39;t find your function extraction suggestion to be terse, and indeed it seems to be quite readable. I&#39;m wondering why non-pattern matching is considered &quot;dirtier&quot;"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 5428, "user_id": 57246, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/65a1be62dd6dee67ab4391b410740ec9?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/57246/david"}, "edited": false, "score": 0, "creation_date": 1429552996, "post_id": 29753764, "comment_id": 47642386, "body": "@David I find it &#39;dirtier&#39; because it&#39;s inherently unsafe; it feels like using <code>head</code> on a list, which could easily fail, instead of pattern-matching a list."}, {"owner": {"reputation": 5428, "user_id": 57246, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/65a1be62dd6dee67ab4391b410740ec9?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/57246/david"}, "edited": false, "score": 0, "creation_date": 1429553760, "post_id": 29753764, "comment_id": 47642861, "body": "Ah --- thank you --- that&#39;s a trade-off worth considering. Again, I appreciate your taking the time to respond."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 4, "last_activity_date": 1429548560, "creation_date": 1429548560, "answer_id": 29753764, "question_id": 29753421, "link": "https://stackoverflow.com/questions/29753421/how-can-i-tie-a-pattern-to-specific-items-in-a-data-structure/29753764#29753764", "title": "How can I tie a pattern to specific items in a data structure?", "body": "<p>One can use 'Record puns' for terse record matching with the <a href=\"https://downloads.haskell.org/~ghc/7.6.3/docs/html/users_guide/syntax-extns.html#record-puns\" rel=\"nofollow\"><code>NamedFieldPuns</code></a> extension:</p>\n\n<pre><code>instance Show DateDefinition where\n    show (DateDefinition {monthOfYear, dayOfMonth}) =\n        show monthOfYear ++ \" \" ++ show dayOfMonth\n</code></pre>\n\n<p>You can also pattern-match in a similar way without an extension:</p>\n\n<pre><code>instance Show DateDefinition where\n    show (DateDefinition {monthOfYear = month, dayOfMonth = day}) =\n        show month ++ \" \" ++ show day\n</code></pre>\n\n<p>If you really don't want to pattern-match, you could do it the dirtier way by using the functions that extract values:</p>\n\n<pre><code>instance Show DateDefinition where\n    show date =\n        show (monthOfYear date) ++ \" \" ++ show (dayOfMonth date)\n</code></pre>\n\n<p>Which is certainly terser than the others.</p>\n\n<hr>\n\n<p>It may also be worth renaming your datatype to <code>Date</code>, and changing the functions to keep your code terse, because the names you're currently using aren't so great:</p>\n\n<pre><code>data Date = Date \n           { month     :: Months\n           , day       :: Int\n           , hour      :: Int\n           , minute    :: Int\n           , second    :: Int\n           }\n</code></pre>\n"}], "owner": {"reputation": 5428, "user_id": 57246, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/65a1be62dd6dee67ab4391b410740ec9?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/57246/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 29753764, "answer_count": 3, "score": 3, "last_activity_date": 1429555251, "creation_date": 1429547573, "question_id": 29753421, "link": "https://stackoverflow.com/questions/29753421/how-can-i-tie-a-pattern-to-specific-items-in-a-data-structure", "title": "How can I tie a pattern to specific items in a data structure?", "body": "<p>Consider the simple data structure below (I'm learning how to use attoparsec). Rather than just deriving show automatically, I've created an instance for it. However, that instance will immediately break (return wrong answer) if the order of the items in the DateDefinition is changed (e.g, I put dayOfMonth before monthOfYear).\nThere must be a way to associate each entry in the pattern with each entry in the data structure so that it's immune to changes in the order of the items. But how? I tried using the actual names but unsurprisingly that didn't work and just resulted in a warning about shadowing the existing binding.</p>\n\n<pre><code>data DateDefinition = DateDefinition\n            {\n                 monthOfYear :: Months,\n                 dayOfMonth :: Int,\n                 hourOfDay :: Int,\n                 minuteOfHour :: Int,\n                 secondOfMinute :: Int\n            }\n\ninstance Show DateDefinition where\n   show (DateDefinition m d _ _ _) = show m  ++  \" \" ++ show d\n</code></pre>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1429546694, "post_id": 29753121, "comment_id": 47638363, "body": "Shouldn&#39;t that be <code>toStatus :: ToJSON a =&gt; a -&gt; Either (Int, String) a</code>?"}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1429546792, "post_id": 29753121, "comment_id": 47638427, "body": "I don&#39;t think so. I don&#39;t want to try to serialize <code>Maybe User</code> to json, I want to serialize the <code>User</code>. If I get a nothing I&#39;m always doing a <code>Left</code>."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1429546894, "post_id": 29753121, "comment_id": 47638489, "body": "So maybe <code>toStatus :: ToJSON a =&gt; a -&gt; Either (Int, String) JSON</code>?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1429547001, "post_id": 29753121, "comment_id": 47638560, "body": "How do you expect to convert <code>a</code> to any <code>ToJSON val =&gt; val</code>?  What your current typeclass is saying is that you want to be able to convert some <code>a</code> that implements <code>Servile</code> to any <code>ToJSON</code> type.  You could get around this by just having <code>toStatus :: a -&gt; Either (Int, String) Value</code>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1429547408, "post_id": 29753121, "comment_id": 47638811, "body": "Returning <code>Value</code>s directly means that you don&#39;t have to worry about being ambiguous.  Inside your <code>Servile</code> instances you have to worry about the conversion, but if what you&#39;re working with already implements <code>ToJSON</code> it&#39;s simple enough to do the conversion.  If what you&#39;re working with doesn&#39;t implement <code>ToJSON</code> then you have to handle it at the one place you care about that conversion.  Once that&#39;s done you can just call <code>toStatus</code> on everything without worrying about overlapping instances, incoherent instances, etc.  Keep it simple and just return a concrete type."}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1429547636, "post_id": 29753121, "comment_id": 47638952, "body": "I like that! but it doesn&#39;t work because <code>Servant</code> asks me to outline the actual type I return and it doesn&#39;t match. <code>&quot;sources&quot; :&gt; Capture &quot;id&quot; Text :&gt; Get Source</code> ... it says <code>Couldn&#39;t match type Value with Source</code>"}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1429547729, "post_id": 29753121, "comment_id": 47639012, "body": "So, I&#39;m still learning, and my typeclass-fu is weak. Why does my typeclass imply being able to convert any instance of <code>Servile</code> to ANY <code>ToJSON</code> type?  What I intended was to say: &quot;You already have a ToJSON value somewhere in you, type! Convert yourself to either an error code or give me that value!&quot;"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1429548847, "post_id": 29753121, "comment_id": 47639733, "body": "@SeanClarkHess You are wanting to extract a <code>ToJSON val =&gt; val</code> from the <code>a</code>, but there are no restrictions on <code>a</code> to say that.  The <code>val</code> type variable only appears in the signature of <code>toStatus</code>, it has to come from nowhere currently.  Can you edit your question to show more of what you&#39;re trying to do?"}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1429549246, "post_id": 29753121, "comment_id": 47640019, "body": "Thank you for all your help @bheklilr! I&#39;m sorry I didn&#39;t express the question very well. I shall upvote all your comments :)"}], "answers": [{"tags": [], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "is_accepted": false, "score": 3, "last_activity_date": 1429550129, "last_edit_date": 1429550129, "creation_date": 1429549216, "answer_id": 29753965, "question_id": 29753121, "link": "https://stackoverflow.com/questions/29753121/making-a-typeclass-cannot-deduce-from-context/29753965#29753965", "title": "Making a typeclass, cannot deduce from context", "body": "<p>I hopped on #haskell since I wasn't expressing the question very well. The issue is that it can't vary over any <code>a</code> to produce a <code>val</code> like that. It also turns out that <code>ToJSON</code> had nothing to do with this problem. </p>\n\n<p>This works: Note that I changed <code>toStatus</code> to be <code>a val</code> instead of <code>a</code>, and the instances to remove the type variable. </p>\n\n<pre><code>class ToStatus a where\n    toStatus :: a val -&gt; Either (Int, String) val\n\ninstance ToStatus Maybe where\n    toStatus Nothing  = Left (404, \"Not Found\")\n    toStatus (Just v) = Right v\n\ninstance Show a =&gt; ToStatus (Either a) where\n    toStatus (Left a) = Left (500, \"Server Error: \" &lt;&gt; show a)\n    toStatus (Right v) = Right v\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1429550733, "post_id": 29754237, "comment_id": 47640950, "body": "Wow cool! Is there an introduction to type families that you recommend?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 1, "creation_date": 1429551229, "post_id": 29754237, "comment_id": 47641271, "body": "@SeanClarkHess I like <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/assoc-types/fun-with-type-funs/typefun.pdf\" rel=\"nofollow noreferrer\">Fun with type functions</a> a lot - also there is <a href=\"https://www.fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-week/type-families-and-pokemon\" rel=\"nofollow noreferrer\">Type Families and Pokemon</a>"}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 4, "last_activity_date": 1429550159, "creation_date": 1429550159, "answer_id": 29754237, "question_id": 29753121, "link": "https://stackoverflow.com/questions/29753121/making-a-typeclass-cannot-deduce-from-context/29754237#29754237", "title": "Making a typeclass, cannot deduce from context", "body": "<p>Another solution, if you want to work with some non-parameterized types, is to use <code>TypeFamilies</code>:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE FlexibleInstances #-}\nmodule Temp where\nimport Data.Monoid\n\nclass ToStatus a where\n  type Val a\n  toStatus :: a -&gt; Either (Int, String) (Val a)\n\ninstance ToStatus (Maybe a) where\n  type Val (Maybe a) = a \n  toStatus Nothing  = Left (404, \"Not Found\")\n  toStatus (Just v) = Right v\n\ninstance Show a =&gt; ToStatus (Either a b) where\n  type Val (Either a b) = b \n  toStatus (Left e) = Left (500, \"Server Error: \" &lt;&gt; show e)\n  toStatus (Right v) = Right v\n\ninstance ToStatus String where\n  type Val String = ()\n  toStatus \"200 Success\" = Right ()\n  toStatus err = Left (500, err)\n</code></pre>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 29754237, "answer_count": 2, "score": 2, "last_activity_date": 1429550159, "creation_date": 1429546625, "question_id": 29753121, "link": "https://stackoverflow.com/questions/29753121/making-a-typeclass-cannot-deduce-from-context", "title": "Making a typeclass, cannot deduce from context", "body": "<p>I'm using the <a href=\"http://hackage.haskell.org/package/servant-server\" rel=\"nofollow\">Servant</a> libary, and I would like to automatically map results into error codes. Servant expects the type: <code>Either (Int, String) a</code>. </p>\n\n<p>For example, if I have a model function of type: <code>IO (Maybe User)</code>. I would like to turn that in to <code>(404, \"Not Found\")</code> on Nothing, and the <code>User</code> if it's there. </p>\n\n<p>To do this, I'm writing a typeclass! </p>\n\n<pre><code>class Servile a where\n    toStatus :: ToJSON val =&gt; a -&gt; Either (Int, String) val\n\ninstance ToJSON a =&gt; Servile (Maybe a) where\n    toStatus Nothing  = Left (404, \"Not Found\")\n    toStatus (Just a) = Right a\n</code></pre>\n\n<p>I have other instances I'd like to write, but this one gives me the error:</p>\n\n<pre><code>Could not deduce (a ~ val)\nfrom the context (ToJSON a)\n  bound by the instance declaration at Serials/Api.hs:90:10-38\nor from (ToJSON val)\n  bound by the type signature for\n             toStatus :: ToJSON val =&gt; Maybe a -&gt; Either (Int, String) val\n  at Serials/Api.hs:91:5-12\n  \u2018a\u2019 is a rigid type variable bound by\n      the instance declaration at Serials/Api.hs:90:10\n  \u2018val\u2019 is a rigid type variable bound by\n        the type signature for\n          toStatus :: ToJSON val =&gt; Maybe a -&gt; Either (Int, String) val\n        at Serials/Api.hs:91:5\nRelevant bindings include\n  a :: a (bound at Serials/Api.hs:92:20)\n  toStatus :: Maybe a -&gt; Either (Int, String) val\n    (bound at Serials/Api.hs:91:5)\nIn the first argument of \u2018Right\u2019, namely \u2018a\u2019\nIn the expression: Right a\n</code></pre>\n\n<p>What's the right way to do this?</p>\n"}, {"tags": ["haskell", "emacs", "read-eval-print-loop", "ghci"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429545273, "post_id": 29752557, "comment_id": 47637415, "body": "why not make it into a function/expression and load it? Or pack it up into a normal module and just load it into ghci?"}, {"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429545344, "post_id": 29752557, "comment_id": 47637467, "body": "because i want to use ghci to do interactive analysis/testing with variables within the function."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429545410, "post_id": 29752557, "comment_id": 47637515, "body": "can you give an example? I don&#39;t think I understand correctly - normally you can pack everything you use into a .hs file and just load it into ghci"}, {"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429545761, "post_id": 29752557, "comment_id": 47637774, "body": "that may work for pure code - I could have a &quot;pseudo-script&quot; where I strip off &quot;let&quot; statements from the equivalent code within a do block. How would  I deal with impure code which has bindings, for example with &quot;&lt;-&quot;?"}, {"owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "edited": false, "score": 2, "creation_date": 1429546341, "post_id": 29752557, "comment_id": 47638144, "body": "I&#39;m not sure I understand what you&#39;re trying to do. But anything that you can type into GHCi, you can also put into a file called <code>.ghci</code> in the current directory and it will run automatically anytime you launch GHCi. Does that help you?"}, {"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "edited": false, "score": 0, "creation_date": 1429546675, "post_id": 29752557, "comment_id": 47638347, "body": "conceptually, it would be useful to interact with variables as if I&#39;m within the do block of main. Loading .ghci files works. If that&#39;s the best approach, please add it as an answer and I&#39;ll accept it."}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 0, "creation_date": 1429546949, "post_id": 29752557, "comment_id": 47638518, "body": "I&#39;m thinking it might be possible to do something nice with Template Haskell here, to make it easier to dump local variables to a temporary file and then read that file in, but I don&#39;t know."}], "answers": [{"comments": [{"owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "edited": false, "score": 1, "creation_date": 1429551192, "post_id": 29754525, "comment_id": 47641250, "body": "reloading a file doesn&#39;t do the trick. I can&#39;t do bindings in the top level with &quot;&lt;-&quot; as far as I can tell. .ghci files work. one interesting thing I noticed with emacs is I can have any file with a .ghci extension (e.g. currWork.ghci), load it into the interpreter via C-c and C-l and it works like a script that&#39;s copy-pasted. This way I can have little interactive state-loaders on a per-task basis (rather than dumping everything into a single globally-used .ghci file)."}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 1, "creation_date": 1429753076, "post_id": 29754525, "comment_id": 47751980, "body": "<code>&lt;-</code> does work in interactive mode. For example: you can type <code>str &lt;- getLine</code> in ghci and it will run <code>getLine</code> and bind whatever you type to <code>str</code>"}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 0, "last_activity_date": 1429551973, "last_edit_date": 1429551973, "creation_date": 1429551059, "answer_id": 29754525, "question_id": 29752557, "link": "https://stackoverflow.com/questions/29752557/automatically-reloading-variable-state-into-ghci-when-re-loading-a-file/29754525#29754525", "title": "Automatically reloading variable state into GHCi when re-loading a file", "body": "<p>There are two main ways to do this:</p>\n\n<ul>\n<li>Use the <code>:l [filename]</code> GHCi command to reload a file without exiting GHCi.</li>\n<li>Write the variables in your <code>~/.ghci</code> file, which will be loaded when GHCi is opened.</li>\n</ul>\n\n<p>If you don't know what to put into <code>~/.ghci</code>, here's what I have in mine:</p>\n\n<pre><code>:set prompt \"\\955 \"\n:set prompt2 \"| \"\n\n:def hoogle \\x -&gt; return $ \":!hoogle --info \\\"\" ++ x ++ \"\\\"\"\n\nlet f `on` x = \\a b -&gt; (f a) `x` (f b)\nlet break (f,g) = \\a -&gt; (f a, f g)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1429559639, "post_id": 29755005, "comment_id": 47646564, "body": "Yes, I just use <code>unsafePerformIO</code> for this purpose. The disadvantage is that the variable has to be recomputed on every reload; if computing it is quite expensive then the foreign-store approach might be better."}, {"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1429559712, "post_id": 29755005, "comment_id": 47646607, "body": "@ReidBarton Yes, you can even combine unsafePerformIO with foreign-store: create a foreign store, perform the expensive operation, and use unsafePerformIO to do the lookupStore in the file."}], "tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": false, "score": 3, "last_activity_date": 1429552515, "creation_date": 1429552515, "answer_id": 29755005, "question_id": 29752557, "link": "https://stackoverflow.com/questions/29752557/automatically-reloading-variable-state-into-ghci-when-re-loading-a-file/29755005#29755005", "title": "Automatically reloading variable state into GHCi when re-loading a file", "body": "<p>I suggest you take a look at <a href=\"http://hackage.haskell.org/package/foreign-store-0.2/docs/Foreign-Store.html\" rel=\"nofollow\">foreign-store</a>. It allows you to refer to variables by numbers, which persists through reloads. Here is an example:</p>\n\n<pre><code>\u03bb: :set -XScopedTypeVariables \n\u03bb: import Foreign.Store\n\u03bb: st &lt;- newStore \"example\"\nLoading package foreign-store-0.2 ... linking ... done.\n\u03bb: readStore st\n\"example\"\n\u03bb: st\nStore 0\n\u03bb: :r\nOk, modules loaded: none.\n\u03bb: st\n&lt;interactive&gt;:8:1:\n    Not in scope: \u2018st\u2019\n    Perhaps you meant \u2018fst\u2019 (imported from Prelude)\n\u03bb: Just (st :: Store String) &lt;- lookupStore 0\n\u03bb: readStore st\n\"example\"\n</code></pre>\n\n<p>Alternatively, you can also put all your definitions in a single hs file and only reload that. You can use unsafePerformIO to get around the restriction that you cannot use <code>&lt;-</code> at the top-level. I think that is ok in this case, since your only using it for interactive anyway:</p>\n\n<pre><code>module Example where\n\nimport System.IO.Unsafe\n\nexample :: String \nexample = \"example\"\n\nfile :: String\nfile = unsafePerformIO $ readFile \"/tmp/example.hs\"\n</code></pre>\n"}], "owner": {"reputation": 6241, "user_id": 722869, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1c5c02f9165e188ab81a53efabc062e2?s=128&d=identicon&r=PG", "display_name": "daj", "link": "https://stackoverflow.com/users/722869/daj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 576, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1429552515, "creation_date": 1429545008, "last_edit_date": 1429551453, "question_id": 29752557, "link": "https://stackoverflow.com/questions/29752557/automatically-reloading-variable-state-into-ghci-when-re-loading-a-file", "title": "Automatically reloading variable state into GHCi when re-loading a file", "body": "<p>When I'm developing some data analyses pipelines in haskell, it often would be useful to preload variable state into GHCi upon loading.</p>\n\n<p>What I end up doing now is copy and pasting parts of a script line-by-line in emacs just to test and check the output of some intermediate processing. I can't even bulk copy-paste code because the line breaks don't get transferred (at least in emacs Interactive-Haskell mode)</p>\n\n<p>Is there a way to do this?</p>\n\n<p>EDIT: simply loading/reloading a .hs file doesn't do the trick because afaik there's no way to have \"&lt;-\" bindings at the top level.</p>\n"}, {"tags": ["string", "haskell", "replace", "char"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1429545060, "post_id": 29752526, "comment_id": 47637257, "body": "You won&#39;t be able to do this with just <code>map</code>, take a look at <code>concat</code> and consider <code>(\\c -&gt; if c == &#39;O&#39; then &quot;X&quot; else [c])</code>.  Notice that each character gets turned into a string instead."}, {"owner": {"reputation": 528, "user_id": 4669619, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4786954ed80039c912a8967576e07ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Ali", "link": "https://stackoverflow.com/users/4669619/ali"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1429546925, "post_id": 29752526, "comment_id": 47638510, "body": "That looks promising, but will it work for something like this: map (\\x -&gt; if x <code>elem</code> guesses then x else &#39;-&#39;) word"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1429547250, "post_id": 29752526, "comment_id": 47638736, "body": "What are you actually trying to do?  Your comment here needs more context to make enough sense.  If you&#39;re trying to replace certain characters with another character then you want <code>map</code>.  If you are trying to replace certain characters with a new string, then use <code>concatMap</code>."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1429546116, "post_id": 29752787, "comment_id": 47637994, "body": "AFAICS, this has quadratic complexity. Appending &quot;on the right&quot; is inefficient. I&#39;d switch to <code>foldr</code>, or use <code>concatMap</code> (as @Lee suggests) instead."}], "tags": [], "owner": {"reputation": 1144, "user_id": 4245823, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-czWZC6KwKYU/AAAAAAAAAAI/AAAAAAAAAYI/yBtPVyZjU4M/photo.jpg?sz=128", "display_name": "felipez", "link": "https://stackoverflow.com/users/4245823/felipez"}, "is_accepted": false, "score": 0, "last_activity_date": 1429546244, "last_edit_date": 1429546244, "creation_date": 1429545616, "answer_id": 29752787, "question_id": 29752526, "link": "https://stackoverflow.com/questions/29752526/haskell-replace-characters-in-string-with-string/29752787#29752787", "title": "Haskell Replace characters in string with string", "body": "<p>You kind formulate your problem in terms of traversing and accumulating based on a condition, something like this,</p>\n\n<pre><code>replace :: String -&gt; Char -&gt; String -&gt; String\nreplace xs c s = foldr go [] xs\n\n where go x acc = if x == c  then acc ++ s\n                             else acc ++ [x]\n</code></pre>\n\n<p>For you example:</p>\n\n<pre><code>&gt;replace \"HELLO WORLD\" 'O' \"XXX\" \n&gt; \"HELLXXX WXXXRLD\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1429547355, "post_id": 29752888, "comment_id": 47638790, "body": "The introduction to <a href=\"http://blog.sigfpe.com/2010/01/monads-are-trees-with-grafting.html?m=1\" rel=\"nofollow noreferrer\">Monads are Trees with Grafting</a> gives a good overview of the general concept of replacing elements with bigger pieces."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 3, "last_activity_date": 1429545930, "creation_date": 1429545930, "answer_id": 29752888, "question_id": 29752526, "link": "https://stackoverflow.com/questions/29752526/haskell-replace-characters-in-string-with-string/29752888#29752888", "title": "Haskell Replace characters in string with string", "body": "<p>You can use <code>concatMap</code>:</p>\n\n<pre><code>let replace0 = concatMap (\\c -&gt; if c=='O' then \"X\" else \"XX\")\n</code></pre>\n"}], "owner": {"reputation": 528, "user_id": 4669619, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4786954ed80039c912a8967576e07ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Ali", "link": "https://stackoverflow.com/users/4669619/ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2325, "favorite_count": 0, "accepted_answer_id": 29752888, "answer_count": 2, "score": 0, "last_activity_date": 1429546244, "creation_date": 1429544907, "last_edit_date": 1495540623, "question_id": 29752526, "link": "https://stackoverflow.com/questions/29752526/haskell-replace-characters-in-string-with-string", "title": "Haskell Replace characters in string with string", "body": "<p>This is an extension of this question: <a href=\"https://stackoverflow.com/questions/19545253/\">Haskell replace characters in string</a></p>\n\n<p>I would like to tweak the following expression to replace a char with a string</p>\n\n<pre><code>let replaceO = map (\\c -&gt; if c=='O' then 'X'; else c)\n</code></pre>\n\n<p>In the end, I would the following results (XX can be a string of any length):</p>\n\n<pre><code>replaceO \"HELLO WORLD\"\n\"HELLXX WXXRLD\"\n</code></pre>\n"}, {"tags": ["haskell", "vector", "ghc"], "comments": [{"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1429565493, "post_id": 29749506, "comment_id": 47649837, "body": "I&#39;ve never used it before, but I believe the purpose is just to provide operations that work on all combinations of vector types"}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 1, "creation_date": 1429575037, "post_id": 29749506, "comment_id": 47653332, "body": "I think I&#39;m starting to understand. With operations like <code>head</code>, <code>length</code>, and <code>indexM</code>, this doesn&#39;t really by you anything because they only take one vector as an argument (and there are already versions of these functions that work on all the other vector types). But for <code>zipWith</code>, it seems somewhat useful because there are two vector arguments. No, I still think I&#39;m missing something."}, {"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 2, "creation_date": 1429575545, "post_id": 29749506, "comment_id": 47653471, "body": "Yes, I think it&#39;s for things that take more than one vector as an argument.  I&#39;m guessing that the other operations are purely for completeness (so that you don&#39;t have to import other modules, too)"}], "answers": [{"tags": [], "owner": {"reputation": 57, "user_id": 3123801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b660a849be9871b965dc95812298b668?s=128&d=identicon&r=PG", "display_name": "dgomez1092", "link": "https://stackoverflow.com/users/3123801/dgomez1092"}, "is_accepted": false, "score": 1, "last_activity_date": 1429624201, "creation_date": 1429624201, "answer_id": 29774148, "question_id": 29749506, "link": "https://stackoverflow.com/questions/29749506/purpose-of-data-vector-mixed/29774148#29774148", "title": "Purpose of Data.Vector.Mixed", "body": "<p>It's w/in my understanding that the<code>Mixed</code> typesclass would enables uses of type-safety functions to be able to parse, merge and fold through a Vector rather than have a concurrent process where each vector is parsed simsimultaneously thus declare <code>M.Vector g v M.Vector h m</code> in order to find a singleton point within these vectors and then using the <code>for MVector do |Stream.length g v &amp;&amp; Stream h m</code> to find a singleton within each to fold with this key <code>key :: mergeStreamwith k d -&gt; Stream k i -&gt; Stream d i     instance Singleton key where  key = Vector.singleton[ v-&gt;(v-&gt; MVector v m) -&gt; MVector m] do transversewithkey g v =&gt;  key.foldlwithkey g h\n</code></p>\n"}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 592, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1429647277, "creation_date": 1429537053, "last_edit_date": 1429647277, "question_id": 29749506, "link": "https://stackoverflow.com/questions/29749506/purpose-of-data-vector-mixed", "title": "Purpose of Data.Vector.Mixed", "body": "<p>In Edward Kmett's <a href=\"https://hackage.haskell.org/package/hybrid-vectors-0.1.2.1\">hybrid-vectors</a> library, there are two main modules: <code>Data.Vector.Hybrid</code> and <code>Data.Vector.Mixed</code>. There's a <a href=\"https://www.fpcomplete.com/user/edwardk/revisiting-matrix-multiplication/part-3\">big article</a> written on the motivation behind the former. The latter is mentioned in passing but lacks any explanation. I'm trying to figure out what use case it is for. I've noticed two things so far:</p>\n\n<ol>\n<li>There is a <code>Mixed</code> typeclass with <code>Typeable</code> constraints. I don't understand the explanation in the haddocks, but it seems like the <code>Typeable</code> constraints must be needed to recover type information or safely cast at some point.</li>\n<li>The <code>Vector</code> data type is parameterized over only the underlying <code>MVector</code>. This is different from the <code>Hybrid</code> module where it was parameterized over two vector types plus a tuple.</li>\n</ol>\n\n<p>I would appreciate any helpful insights or (even better) small examples of use cases. Thanks.</p>\n"}, {"tags": ["haskell", "ubuntu", "ubuntu-14.04", "ghc"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1429560362, "post_id": 29749152, "comment_id": 47646992, "body": "I don\u2019t think that the bindist ships the manpages, or at least not in a common place. Such integration effort is the value added by your distribution when you take their packages."}, {"owner": {"reputation": 8480, "user_id": 1809377, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/1afcd52dc4eae87efbe408a1ec498fc4?s=128&d=identicon&r=PG", "display_name": "ajay", "link": "https://stackoverflow.com/users/1809377/ajay"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1429561146, "post_id": 29749152, "comment_id": 47647445, "body": "@JoachimBreitner I am wondering what reason could be there to not ship the man pages. It&#39;s a huge turnoff against using the latest stable version. Anyway, how can I check if the distribution comes with a man page, just in case?"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1429600301, "post_id": 29749152, "comment_id": 47661887, "body": "Manpages are usually named <code>ghc.1</code> or <code>ghc.1.gz</code>. Check if the tarball contains such a file somewhere."}], "owner": {"reputation": 8480, "user_id": 1809377, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/1afcd52dc4eae87efbe408a1ec498fc4?s=128&d=identicon&r=PG", "display_name": "ajay", "link": "https://stackoverflow.com/users/1809377/ajay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1429536187, "creation_date": 1429536187, "question_id": 29749152, "link": "https://stackoverflow.com/questions/29749152/missing-man-page-of-ghc", "title": "Missing man page of ghc", "body": "<p>I installed the latest stable version of GHC following instructions from  <a href=\"https://www.haskell.org/downloads/linux\" rel=\"nofollow\">here</a> on my <code>Ubuntu 14.04</code> <code>64-bit</code> machine. However, after installation finished, I find that man pages of command <code>ghc</code>, <code>ghci</code>, <code>runhaskell</code> etc are missing. It displays </p>\n\n<pre><code>ajay@ajay:~$ ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 7.8.4\najay@ajay:~$ man ghc\nNo manual entry for ghc\nSee 'man 7 undocumented' for help when manual pages are not available.\n</code></pre>\n\n<p>Also, the commands</p>\n\n<pre><code>cabal update\ncabal install alex happy\n</code></pre>\n\n<p>require <code>sudo</code> permission and when I prefix <code>sudo</code>, it says </p>\n\n<pre><code>sudo: cabal: command not found\n</code></pre>\n\n<p>I could access <code>man</code> pages when I'd installed <code>ghc</code> from Ubuntu <code>apt-get</code> repository. How do I install man pages now as I need them for reference. </p>\n"}, {"tags": ["haskell", "functional-programming", "instance", "typeclass", "functor"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 4, "creation_date": 1429532117, "post_id": 29747472, "comment_id": 47627453, "body": "You can include <code>{-# LANGUAGE NoImplicitPrelude #-}</code> on the top of your source file. This prevents the Prelude from being imported by default. You can write your own instances, then. If you still want something from Prelude, use an explicit import, like <code>import Prelude (x)</code>."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1429532172, "post_id": 29747472, "comment_id": 47627492, "body": "For completeness, you should quote the whole text from the exercise in your question."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1429535878, "post_id": 29747472, "comment_id": 47630231, "body": "@Andr&#225;sKov&#225;cs, the moment you import a single thing from <code>Prelude</code>, you will get all inherited instances, no?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1429550394, "post_id": 29747472, "comment_id": 47640729, "body": "@dfeuer if I don&#39;t explicitly import a class, I don&#39;t get the instances."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1429552554, "post_id": 29747472, "comment_id": 47642124, "body": "@Andr&#225;sKov&#225;cs, ah, I see. But can&#39;t you accomplish the same thing with much less pain using <code>import Prelude hiding (Functor, fmap)</code> or whatever, and defining your own <code>Functor</code> class (as your approach requires anyway)?"}], "answers": [{"comments": [{"owner": {"reputation": 881, "user_id": 646565, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/Cu0yq.jpg?s=128&g=1", "display_name": "freinn", "link": "https://stackoverflow.com/users/646565/freinn"}, "edited": false, "score": 0, "creation_date": 1429533648, "post_id": 29747913, "comment_id": 47628596, "body": "I have this code now working: newtype Function a b = Function { getFunction :: a -&gt; b }  instance Functor (Function a) where   fmap g (Function h) = Function (g . h), but, how to use it to do something? I&#39;m lost in your notation of getFunction"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 881, "user_id": 646565, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/Cu0yq.jpg?s=128&g=1", "display_name": "freinn", "link": "https://stackoverflow.com/users/646565/freinn"}, "edited": false, "score": 3, "creation_date": 1429536616, "post_id": 29747913, "comment_id": 47630852, "body": "@freinn You could have <code>let f1 = Function length :: Function [a] Int</code>, then have <code>fmap show f1 :: Function [a] String</code>, for example.  To run it you would have to use <code>getFunction</code>: <code>let f1 = Function length; getFunction (fmap show f1) [1, 2, 3]</code> to get <code>&quot;3&quot;</code> as the result."}], "tags": [], "owner": {"reputation": 897, "user_id": 1755520, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mqzKa.jpg?s=128&g=1", "display_name": "bartavelle", "link": "https://stackoverflow.com/users/1755520/bartavelle"}, "is_accepted": true, "score": 11, "last_activity_date": 1429532962, "creation_date": 1429532962, "answer_id": 29747913, "question_id": 29747472, "link": "https://stackoverflow.com/questions/29747472/how-to-make-the-function-type-constructor-instance-of-functor-duplicated-instan/29747913#29747913", "title": "How to make the function type constructor instance of functor? Duplicated instance", "body": "<p>The canonical way to write a new instance for something that already has one is to wrap it in a <code>newtype</code>:</p>\n\n<pre><code>newtype Function a b = Function { getFunction :: a -&gt; b }\n\ninstance Functor (Function a) where\n  ...\n</code></pre>\n"}], "owner": {"reputation": 881, "user_id": 646565, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/Cu0yq.jpg?s=128&g=1", "display_name": "freinn", "link": "https://stackoverflow.com/users/646565/freinn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 905, "favorite_count": 0, "accepted_answer_id": 29747913, "answer_count": 1, "score": 3, "last_activity_date": 1429532962, "creation_date": 1429531689, "last_edit_date": 1429532751, "question_id": 29747472, "link": "https://stackoverflow.com/questions/29747472/how-to-make-the-function-type-constructor-instance-of-functor-duplicated-instan", "title": "How to make the function type constructor instance of functor? Duplicated instance", "body": "<p>I'm trying to do the exercises in the <a href=\"https://wiki.haskell.org/Typeclassopedia\" rel=\"nofollow\">typeclassopedia</a>, but I don't have sufficient knowledge to make a data type that behaves like a function.</p>\n\n<p>The first exercise says: \"Implement Functor instances for Either e and ((->) e).\"</p>\n\n<p>I think I understand the type constructors, but I don't understand this concrete case.</p>\n\n<p>I don't know where to find information, I've searched in Google but failed.</p>\n\n<p>This is my try, but the <code>(-&gt;) r a</code> type is already defined in GHC-base.</p>\n\n<p>How can I create a <code>data X y w = ...</code> that behaves like a function??</p>\n\n<p>Here is my not compiling code:</p>\n\n<pre><code>instance Functor ((-&gt;) r) where\n  fmap f g = (.)\n</code></pre>\n"}, {"tags": ["string", "algorithm", "haskell"], "comments": [{"owner": {"reputation": 19084, "user_id": 2854908, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/snzI5.jpg?s=128&g=1", "display_name": "libik", "link": "https://stackoverflow.com/users/2854908/libik"}, "edited": false, "score": 1, "creation_date": 1429520579, "post_id": 29743348, "comment_id": 47619615, "body": "Asymptoticall complexity does not consider any constants, which may be more imporant in real-life scenarious than complexity itself. This may be the case - they have very small constants, you have big ones."}, {"owner": {"reputation": 141, "user_id": 2903066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZFERr.jpg?s=128&g=1", "display_name": "m00nlight", "link": "https://stackoverflow.com/users/2903066/m00nlight"}, "reply_to_user": {"reputation": 19084, "user_id": 2854908, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/snzI5.jpg?s=128&g=1", "display_name": "libik", "link": "https://stackoverflow.com/users/2854908/libik"}, "edited": false, "score": 0, "creation_date": 1429520851, "post_id": 29743348, "comment_id": 47619786, "body": "But in fact, use <code>isInfixOf</code> from Data.List will will not beat the KMP algorithm. So it seems that only change from String to ByteString will get huge increase in efficiency.  Why is that?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1429520879, "post_id": 29743348, "comment_id": 47619812, "body": "For example, notice that most <code>isPrefixOf</code>s will fail in the first few characters on non-degenerate data, so you will see approximately linear performance.  You could craft something that would cause quadratic performance but it would be quite special and not the usual case."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1429520926, "post_id": 29743348, "comment_id": 47619846, "body": "Oh, <code>String</code>s are linked lists, they are terribly inefficient as far as string representations go.  <code>ByteString</code> holding one byte per character in contiguous memory has a huge practical advantage."}, {"owner": {"reputation": 19084, "user_id": 2854908, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/snzI5.jpg?s=128&g=1", "display_name": "libik", "link": "https://stackoverflow.com/users/2854908/libik"}, "edited": false, "score": 0, "creation_date": 1429520941, "post_id": 29743348, "comment_id": 47619862, "body": "I actually does not know the alghorithms, I just say, that in small numbers, the alghoritm with bigger complexity can be faster, due to big constants of other with smaller complexity."}, {"owner": {"reputation": 141, "user_id": 2903066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZFERr.jpg?s=128&g=1", "display_name": "m00nlight", "link": "https://stackoverflow.com/users/2903066/m00nlight"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1429521076, "post_id": 29743348, "comment_id": 47619971, "body": "@luqui: Yes. I know that. But in fact, use <code>isInfixOf</code> from Data.List will not get accept of the problem in time limit, but the KMP algorithm in haskell will get accept. So I believe there are some cases which will cause quadratic performance. But using <code>isInfixOf</code> from <code>Data.ByteString.Char8</code> can even run faster than KMP of String."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1429521148, "post_id": 29743348, "comment_id": 47620019, "body": "The complexity is not O(n^2), it&#39;s O(m*n) where m is the length of the needle and n is the length of the haystack.  If m is small then the brute force search will beat KMP, BM, and other clever algorithms. (To be pedantic, the complexity is also O(n^2) or O(n^3) or O(n^8), since O gives an upper bound.)"}, {"owner": {"reputation": 141, "user_id": 2903066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZFERr.jpg?s=128&g=1", "display_name": "m00nlight", "link": "https://stackoverflow.com/users/2903066/m00nlight"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1429521361, "post_id": 29743348, "comment_id": 47620155, "body": "@augustss Sorry for the mistake in the statement. I actually want to mean O(m*n). The actually case is that there is at least one case which will cause the <code>isInfixOf</code> from Data.List to run exceed the time limit, while the KMP algorithm can finish within the limit. But the <code>isInfixOf</code> from <code>Data.ByteString.Char8</code> can run even faster than KMP.  I just want to know how can that be true, since it is still an O(m * n) algorithm. Does haskell do some low level efficiency tuning for Data.ByteString.Char?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1429521469, "post_id": 29743348, "comment_id": 47620243, "body": "I suspect you&#39;re just seeing the effects of much the much better data structure used for ByteString.  Much less memory traffic and better locality."}, {"owner": {"reputation": 141, "user_id": 2903066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZFERr.jpg?s=128&g=1", "display_name": "m00nlight", "link": "https://stackoverflow.com/users/2903066/m00nlight"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1429522149, "post_id": 29743348, "comment_id": 47620680, "body": "@augustss: Yes, very surprised to find out that only change from <code>[Char]</code> to <code>Data.ByteString</code> will get more than 60 times efficiency of the program."}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 2903066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZFERr.jpg?s=128&g=1", "display_name": "m00nlight", "link": "https://stackoverflow.com/users/2903066/m00nlight"}, "edited": false, "score": 1, "creation_date": 1429521547, "post_id": 29743669, "comment_id": 47620300, "body": "There is at least one case which will cause quadratic time complexity, because the <code>isInfixOf</code> from Data.List can not finish in 5 seconds, while the KMP can finish in 0.26 seconds. But the <code>isInfixOf</code> from <code>Data.ByteString.Char8</code> can finish in 0.08 seconds. So there is at least 60 times difference in the efficiency of the two same algorithm, only the represent structures are different. Since the <code>isInfixOf</code> in Data.List is also very simple, I believe its algorithm complexity constant is also small, means change from <code>[Char]</code> to <code>ByteString</code> will get more than 60 times efficiency gain."}], "tags": [], "owner": {"reputation": 19084, "user_id": 2854908, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/snzI5.jpg?s=128&g=1", "display_name": "libik", "link": "https://stackoverflow.com/users/2854908/libik"}, "is_accepted": false, "score": 1, "last_activity_date": 1429521188, "creation_date": 1429521188, "answer_id": 29743669, "question_id": 29743348, "link": "https://stackoverflow.com/questions/29743348/is-the-time-complexity-of-isinfixof-in-data-bytestring-char8-om-n/29743669#29743669", "title": "Is the time complexity of `isInfixOf` in Data.ByteString.Char8 O(m * n)?", "body": "<p>Asymptoticall complexity does not consider any constants, which may be more imporant in real-life scenarious than complexity itself. This may be the case - they have very small constants, you have big ones.</p>\n\n<p>By the definition, the bigger complexity is, when one function has in one point to infinity bigger value, even if you multiply other function by constant of any size.</p>\n\n<p>However that \"one point\" may be huge.</p>\n\n<p>For example if you have two alghoritms with this run-time : <code>1000000*n*sqrt(n)</code> and <code>n^2</code>, the complexity is bigger for <code>n^2</code>, but to achieve higher speed for first one, <code>n</code> must be higher than <code>1 000 000 000 000</code>. For smaller numbers <code>n^2</code> alghoritms is faster.</p>\n\n<hr>\n\n<p>Therefore consider complexity by <code>But in fact, it runs much faster than KMP code by myself?</code> is not good approach.</p>\n"}], "owner": {"reputation": 141, "user_id": 2903066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZFERr.jpg?s=128&g=1", "display_name": "m00nlight", "link": "https://stackoverflow.com/users/2903066/m00nlight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1429521385, "creation_date": 1429520318, "last_edit_date": 1429521385, "question_id": 29743348, "link": "https://stackoverflow.com/questions/29743348/is-the-time-complexity-of-isinfixof-in-data-bytestring-char8-om-n", "title": "Is the time complexity of `isInfixOf` in Data.ByteString.Char8 O(m * n)?", "body": "<p>From reading the relative source code, </p>\n\n<p><a href=\"https://hackage.haskell.org/package/bytestring-0.9.2.1/docs/src/Data-ByteString.html#isInfixOf\" rel=\"nofollow\">https://hackage.haskell.org/package/bytestring-0.9.2.1/docs/src/Data-ByteString.html#isInfixOf</a> , </p>\n\n<p>it seems that the <code>isInfix</code> algorithm is actually <code>O(m * n)</code>. But in fact, it runs much faster than <code>KMP</code> code by myself? </p>\n\n<p>So is this algorithm actually <code>O(m * n)</code>, and how does <code>haskell</code> make this functional extremely efficient?</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1429735461, "post_id": 29742635, "comment_id": 47744949, "body": "Just wanted to state I&#39;m still digesting your answer and going through a lot of material, that&#39;s why I didn&#39;t comment yet, but I&#39;m very grateful for it and it is helping me a lot. Thank you!"}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1429777649, "post_id": 29742635, "comment_id": 47762365, "body": "@Viclib Taking some time is to be expected. This is stuff it took me months to learn when being at it on and off. :)"}], "tags": [], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "is_accepted": true, "score": 34, "last_activity_date": 1461661480, "last_edit_date": 1461661480, "creation_date": 1429518164, "answer_id": 29742635, "question_id": 29742634, "link": "https://stackoverflow.com/questions/29742634/could-someone-explain-the-diagram-about-the-lens-library/29742635#29742635", "title": "Could someone explain the diagram about the `lens` library?", "body": "<p>The Haddocks are the best in-depth resource. They contain everything, but they might be a bit hard to navigate at first. Just browse around the different modules and make mental notes on what's where, and you'll start to find your way around soon. The diagram you link to is also a very good map of the modules.</p>\n\n<p>However, since you say you don't understand the graphic, I'm going to assume that you don't want an advanced or complete reference. The diagram is actually a very basic, high-level overview of the parts of the <code>lens</code> package. If you don't understand the diagram, you should probably wait a bit with the advanced stuff.</p>\n\n<p>When reading this, keep in mind that although the <code>lens</code> package started out as a package of, well, lenses, there are now many kinds of <em>optics</em> in the package, which obey different laws and are used for different things. \"Optic\" is the general name for the lens-like things you use to poke at data structures.</p>\n\n<p>Anyway, here's how I read the diagram.</p>\n\n<h3>The Boxes' Arrangement</h3>\n\n<p>For now, just look at the top of the boxes where the name of the optic is written.</p>\n\n<ol>\n<li><p>The top level, the <code>Fold</code> and the <code>Setter</code>, are the basic optics of <code>lens</code>. As you can imagine, a <code>Setter</code> is an optic that sets the value of some field. I'm going to elide a bunch of examples here since you say you know most of the basics, but essentially, when you do</p>\n\n<pre><code>\u03bb&gt; ellen &amp; age .~ 35\nPerson { _name = \"Ellen\", _age = 35 }\n</code></pre>\n\n<p>then you've used <code>age</code> as a <code>Setter</code>.</p></li>\n<li><p>A <code>Getter</code> is a special kind of <code>Fold</code> that allows you to get values out of data structures. (A <code>Fold</code> itself only allows you to somehow combine values to a new value, not get them out as they are.) That a <code>Getter</code> is a special kind of <code>Fold</code> is marked in the graphic by the arrow pointing from <code>Getter</code> to <code>Fold</code>.</p></li>\n<li><p>If you combine a <code>Fold</code> and a <code>Setter</code> (i.e. you combine a way to loop over a bunch of values and a way to set single values) you get a <code>Traversal</code>. A <code>Traversal</code> is an optic that targets multiple elements and lets you set or modify all of them.</p></li>\n<li><p>Further down the chart, if you combine a <code>Getter</code> with a <code>Traversal</code> you get a <code>Lens</code>. This should be familiar to you, as lenses are often talked about as \"a combination of a getter and a setter\", and you can think of a <code>Traversal</code> as a more powerful <code>Setter</code>.</p></li>\n<li><p>I'm not going to pretend I know a whole lot about the relations between <code>Review</code>, <code>Prism</code>, <code>Iso</code> and <code>Equality</code>. The way I understand it,</p>\n\n<ul>\n<li>A <code>Review</code> is a basic wrapper around a function <code>b -&gt; t</code> where <code>b</code> is supposed to be a field inside the <code>t</code> structure. So a <code>Review</code> takes a single field value and then constructs a whole structure around it. This might seem silly, but it's actually the reverse of a <code>Getter</code>, and useful to build prisms.</li>\n<li>A <code>Prism</code> allows you to get and set values within branching types. It's to <code>Either</code> what a <code>Lens</code> is to tuples. You can't get a value inside an <code>Either</code> with just a lens, because it will explode if it hits the <code>Left</code> branch.</li>\n<li>An <code>Iso</code> is a very powerful combination of <code>Lens</code> and <code>Prism</code>, which allows you to freely look \"both ways\" through optics. While a <code>Lens</code> lets you look from a high level onto a pinpoint part of a data structure, an <code>Iso</code> lets you also look from that pinpoint part of the data structure up to the high level.</li>\n<li>An <code>Equality</code> is ... I have no idea, sorry.</li>\n</ul></li>\n</ol>\n\n<h3>Interlude: Type Signatures</h3>\n\n<p>A type signature like <code>Lens s t a b</code> might be scary at first, so I'll try to quickly cover what it means. If you look at <code>Getter</code>, you'll see its type signature is</p>\n\n<pre><code>Getter s a\n</code></pre>\n\n<p>If we think about what a getter conceptually is, this might seem familiar. What is a getter? It's a function from a data structure <code>s</code> to a single value <code>a</code> which is inside that structure. For example, a function <code>Person -&gt; Age</code> is a getter that gets the age from a <code>Person</code> object. The corresponding <code>Getter</code> simply has the signature</p>\n\n<pre><code>Getter Person Age\n</code></pre>\n\n<p>It's really that simple. A <code>Getter s a</code> is an optic that can get the <code>a</code> from inside the <code>s</code>.</p>\n\n<p>The simplified <code>Lens'</code> signature should be less scary now. If you had to guess, what is a</p>\n\n<pre><code>Lens' Person Age\n</code></pre>\n\n<p>? Easy! It's a <code>Lens</code> that can <em>get and set</em> (remember how lenses are combinations of getters and setters?) the <code>Age</code> field inside a <code>Person</code> value. So the same logic you applied to <code>Getter s a</code> you can apply to <code>Lens' s a</code>.</p>\n\n<p>But what about the <code>s t a b</code> part? Well, think about this type:</p>\n\n<pre><code>data Person a = { _idField :: a, address :: String }\n</code></pre>\n\n<p>a person is identifiable by some identification value and has an age. Let's say you are identified by a name</p>\n\n<pre><code>carolyn :: Person String\ncarolyn = Person \"Carolyn\" \"North Street 12\"\n</code></pre>\n\n<p>What if you have a function <code>toIdNumber :: String -&gt; Int</code> which makes an ID number from a string? You might want to do this:</p>\n\n<pre><code>\u03bb&gt; carolyn &amp; idField %~ toIdNumber\nPerson 57123 \"North Street 12\"\n</code></pre>\n\n<p>but you can't if <code>idField :: Lens' (Person String) String</code> because that lens can only deal with <code>String</code>s. It doesn't know what it means to turn a string into an integer and stick that into the same spot. That's why we have <code>Lens s t a b</code>.</p>\n\n<p>The way I read that signature is \"if you give me a function <code>a -&gt; b</code>, I will give you a function <code>s -&gt; t</code>\", where <code>a</code> and <code>b</code> both refer to the target of the lens, and <code>s</code> and <code>t</code> refer to the containing data structures. Concrete example: if we had</p>\n\n<pre><code>idField :: Lens (Person String) (Person Int) String Int\n</code></pre>\n\n<p>we could do the transformation above. That lens knows how to take a <code>Person</code> with a string id field and turn it into a person with an <code>Int</code> id field.</p>\n\n<p>So, essentially, a <code>Lens s t a b</code> can be read as a \"function\" <code>(a -&gt; b) -&gt; (s -&gt; t)</code>. \"Give me a transformation <code>(a -&gt; b)</code> to do on my target, and a data structure <code>s</code> that contains that target, and I will return to you a data structure <code>t</code> where that transformation has been applied.\"</p>\n\n<p>Of course, it's not actually that function \u2013 it's more powerful than that \u2013 but you can turn it into that function by giving it to <code>over</code> which is part of <code>Setter</code>.</p>\n\n<h3>The Boxes' Contents</h3>\n\n<p>The contents of the boxes are simply the most common and/or core operations of each kind of optic. Their types say a lot about what they do, and I'm going to pick a few examples to show what I mean.</p>\n\n<p>Generally, the topmost items are how you construct that kind of optic. For example, the topmost item in the <code>Getter</code> box is the <code>to</code> function, which constructs a <code>Getter</code> from any function <code>s -&gt; a</code>. You get a <code>Traversal</code> for free from a <code>Traversable</code> if you use the <code>traverse</code> function.</p>\n\n<p>Then below that are the common operations. You'll for example find <code>view</code> under <code>Getter</code>, which is how you use a <code>Getter</code> to get something out of a data structure. In <code>Setter</code>, you find <code>over</code> and <code>set</code> high up.</p>\n\n<p>(Interesting observation: most boxes seem to contain two dual functions: one way to create the optic, and one way to use them. What's interesting is that those often have almost the same type signature, but flipped compared to each other. Example:</p>\n\n<ul>\n<li><code>to :: (s -&gt; a) -&gt; Getter s a</code></li>\n<li><code>view :: Getter s a -&gt; (s -&gt; a)</code></li>\n</ul>\n\n<p>and</p>\n\n<ul>\n<li><code>unto :: (b -&gt; t) -&gt; Review s t a b</code></li>\n<li><code>review :: Review s t a b -&gt; (b -&gt; t)</code></li>\n</ul>\n\n<p>Just something funny I noticed now.)</p>\n\n<h3>How I Use the Graphic</h3>\n\n<p>I don't normally study the graphic as closely as I have writing this. Mostly, I just peek at <code>Setter</code>, <code>Getter</code>, <code>Traversal</code>, <code>Lens</code> and <code>Prism</code> and where they are in relation to each other, because those are the optics I use most.</p>\n\n<p>When I know I need to do something, I usually take a quick peek at the graphic to see which boxes contain operations similar to the ones I want to do. (For example, if I have <code>data Gendered a = Masculine a | Feminine a</code>, then <code>_Right</code> is similar to the hypothetical <code>_Feminine</code>.) When I've determined that, I dive into the Haddocks for those modules (in this example, <code>Prism</code>), searching for the operations I need.</p>\n\n<h3>How I Learn About Optics</h3>\n\n<p>I learn about optics and how to use them the same way I learn everything. I find a real problem where optics are a good solution, and I try to solve it. I try it and I fail and I try again and I ask for help and I try and I try and I try. Eventually I will succeed. Then I try something slightly different.</p>\n\n<p>By actually using things the way they were meant to be used I collect a lot of useful experience on how they work and such.</p>\n\n<h3>Bonus: A Personal Misconception</h3>\n\n<p>Before I started writing this, I thought you needed <code>Prism</code>s to deal with <code>Maybe</code> values, because the <code>Maybe</code> type is branching, no? Not quite! At least not any more than the <code>List</code> type, which you don't need <code>Prism</code>s to deal with.</p>\n\n<p>Because the <code>Maybe</code> type is a container of zero or one elements, you actually only need a <code>Traversal</code> to deal with it. It's when you have two branches which can contain different values that you start needing the full power of the <code>Prism</code>. (To <em>construct</em> a <code>Maybe</code> value you still need the <code>Review</code> though.)</p>\n\n<p>I figured this out only when I started to read the diagram very carefully and exploring the modules to figure out the actual, formal differences between the optics. This is the drawback of using my method to learn things. As long as it works, I just wing it. Sometimes that leads to roundabout ways of doing things.</p>\n"}, {"tags": [], "owner": {"reputation": 6300, "user_id": 370902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e44a2a4b5dc35fe1415552e02ee9def?s=128&d=identicon&r=PG", "display_name": "John Wiegley", "link": "https://stackoverflow.com/users/370902/john-wiegley"}, "is_accepted": false, "score": 1, "last_activity_date": 1453413111, "creation_date": 1453413111, "answer_id": 34935024, "question_id": 29742634, "link": "https://stackoverflow.com/questions/29742634/could-someone-explain-the-diagram-about-the-lens-library/34935024#34935024", "title": "Could someone explain the diagram about the `lens` library?", "body": "<p>The graphic is a flow from what you can do with a weak relationship between two types, to what you can do with a strong relationship.</p>\n\n<p>At the weakest, you can fold over \"elements\" of type <code>a</code> within a type <code>s</code>, or you can set the <code>a</code> to a <code>b</code> within an <code>s</code>, changing it to a <code>t</code> (where of course, <code>a</code> and <code>b</code> could be the same, as with <code>s</code> and <code>t</code>).  At the very bottom, you have equality; one step up, you have isomorphism; then lenses and prisms, etc.</p>\n\n<p>Viewed another way, it flows from most applicable down to least applicable, due to the requirements of the relationship: There are many types that can be folded in terms of some <code>a</code> conceptually \"within\" them; whereas far fewer things will be equal or isomorphic to <code>a</code>.</p>\n"}], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1300, "favorite_count": 13, "accepted_answer_id": 29742635, "answer_count": 2, "score": 18, "last_activity_date": 1461661480, "creation_date": 1429518164, "question_id": 29742634, "link": "https://stackoverflow.com/questions/29742634/could-someone-explain-the-diagram-about-the-lens-library", "title": "Could someone explain the diagram about the `lens` library?", "body": "<p>If you browse through Lens entry on hackage, Lens Github's repo, or even google about Lens, you will find a lot of partial references such as introductory tutorials/videos, examples, overviews and so on. Since I already know most of the basics, I am looking for a more complete reference that would help me to get more knowledge about the advanced features. In other words, I still have no idea what <a href=\"https://raw.githubusercontent.com/wiki/ekmett/lens/images/Hierarchy.png\">this</a> means and couldn't find a resource complete enough to explain this graphic as a whole. Ideas?</p>\n"}, {"tags": ["haskell", "cloud", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "edited": false, "score": 0, "creation_date": 1429555954, "post_id": 29743251, "comment_id": 47644257, "body": "I&#39;ve seen and tried this kind of tools, and I know that&#39;s another tedious way to list up in the question. I believe we wouldn&#39;t like to perform the command every time we switch the device."}], "tags": [], "owner": {"reputation": 309, "user_id": 3320256, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/NZCl4.png?s=128&g=1", "display_name": "daniel.kahlenberg", "link": "https://stackoverflow.com/users/3320256/daniel-kahlenberg"}, "is_accepted": false, "score": 1, "last_activity_date": 1429520139, "creation_date": 1429520139, "answer_id": 29743251, "question_id": 29741198, "link": "https://stackoverflow.com/questions/29741198/cabal-sandbox-on-a-cloud-service/29743251#29743251", "title": "Cabal sandbox on a cloud service", "body": "<p>Have you tried <a href=\"https://github.com/philopon/sandbox-move\" rel=\"nofollow\">sandbox-move</a> yet?</p>\n"}], "owner": {"reputation": 1764, "user_id": 2478883, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ys9QL.png?s=128&g=1", "display_name": "Ryoichiro Oka", "link": "https://stackoverflow.com/users/2478883/ryoichiro-oka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1429555227, "creation_date": 1429513290, "last_edit_date": 1429555227, "question_id": 29741198, "link": "https://stackoverflow.com/questions/29741198/cabal-sandbox-on-a-cloud-service", "title": "Cabal sandbox on a cloud service", "body": "<p>I'd like to place a cabal sandbox under my Dropbox directory to work there in multiple devices. But cabal stores all package information as absolute paths, which causes link errors when the sandbox's location is different in those devices. Of course it's easy to solve if we try; for example, placing it in the exactly same location in those devices, placing it in an external portable drive, rewriting paths to relative by hand, etc. But, are there any more convenient and intuitive methods? If not, I think there should be one to manage packages on a cloud service that everyone is using nowadays. </p>\n"}, {"tags": ["regex", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 6, "last_activity_date": 1429516357, "last_edit_date": 1429516357, "creation_date": 1429515100, "answer_id": 29741715, "question_id": 29741183, "link": "https://stackoverflow.com/questions/29741183/function-arguments-in-reverse-order/29741715#29741715", "title": "=~ function arguments in reverse order", "body": "<p>This is just how operator sections work. </p>\n\n<pre><code>(=~)    = \\x y -&gt; x =~ y\n(x =~)  = \\y -&gt; x =~ y\n(=~ y)  = \\x -&gt; x =~ y\n</code></pre>\n\n<p>Mnemonic: when you have <code>(x =~ y)</code> and you take out the <code>x</code>, you are left with <code>(  =~ y)</code>.</p>\n\n<p>If you wanted the read a regex and match it against a constant string, you would use the other section:</p>\n\n<pre><code>untilM (\"foo\" =~) (putStr \"Enter regex: \" &gt;&gt; getLine)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 29741715, "answer_count": 1, "score": 2, "last_activity_date": 1429597982, "creation_date": 1429513231, "last_edit_date": 1429597982, "question_id": 29741183, "link": "https://stackoverflow.com/questions/29741183/function-arguments-in-reverse-order", "title": "=~ function arguments in reverse order", "body": "<p><code>Bool &gt; \"my left foot\" =~ \"foo\" :: Bool</code></p>\n\n<p><code>=~</code> is an infix operator from <code>Text.Regex.Posix</code> package and here, the target string is on the left and the pattern string is on the right. Here, <code>=~</code> makes sense to me.</p>\n\n<p>But here,</p>\n\n<pre><code>readIp = untilM (=~ \"[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\")\n    (putStr \"Enter IP address: \" &gt;&gt; getLine)\n</code></pre>\n\n<p><code>=~</code> is curried with its right argument only and given to <code>untilM</code>. <code>target string</code> is given as the last parameter. How does <code>untilM</code> ensure that <code>=~</code> is passed the target string on its left and the pattern string on its right?</p>\n"}, {"tags": ["haskell", "happstack"], "comments": [{"owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 0, "creation_date": 1429492568, "post_id": 29737586, "comment_id": 47608844, "body": "Are you sure the HTML is escaped? Looking at the <a href=\"http://happstack.com/docs/happstack-server-7.0.2/doc/html/happstack-server/src/Happstack-Server-Response.html#ToMessage\" rel=\"nofollow noreferrer\">ToMessage String instance</a>, it looks like the response type is the only thing that&#39;s wrong. In that case you have a number of options: You can newtype String and create a separate instance, but with a different content type, or you can use different combinators."}, {"owner": {"reputation": 787, "user_id": 3307736, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e9015090707d0e02ee256b8c4687951f?s=128&d=identicon&r=PG&f=1", "display_name": "Larry", "link": "https://stackoverflow.com/users/3307736/larry"}, "reply_to_user": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 0, "creation_date": 1429494880, "post_id": 29737586, "comment_id": 47609415, "body": "Thanks for the reply. I successfully compiled and ran the above code. I don&#39;t think there&#39;s a type error. The tag is escaped, for example, in route <code>http:&#47;&#47;localhost:8000&#47;no-such-route</code>"}, {"owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 1, "creation_date": 1429495017, "post_id": 29737586, "comment_id": 47609454, "body": "I didn&#39;t claim that there is. Only that you&#39;ll need to alter the response type, because the <code>ToMessage String</code> instance sets it to text/plain rather than text/html."}, {"owner": {"reputation": 787, "user_id": 3307736, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e9015090707d0e02ee256b8c4687951f?s=128&d=identicon&r=PG&f=1", "display_name": "Larry", "link": "https://stackoverflow.com/users/3307736/larry"}, "reply_to_user": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 0, "creation_date": 1429496098, "post_id": 29737586, "comment_id": 47609735, "body": "Can I accept you as the answer? ; )"}], "answers": [{"tags": [], "owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "is_accepted": true, "score": 2, "last_activity_date": 1429525802, "creation_date": 1429525802, "answer_id": 29745377, "question_id": 29737586, "link": "https://stackoverflow.com/questions/29737586/haskell-happstack-can-i-use-a-string-with-html-tags-as-response/29745377#29745377", "title": "Haskell Happstack, can I use a string with html tags as response?", "body": "<p>The <a href=\"http://happstack.com/docs/happstack-server-7.0.2/doc/html/happstack-server/src/Happstack-Server-Response.html#line-111\" rel=\"nofollow\"><code>ToMessage String</code></a> instance sets the response type to text/plain rather than text/html.</p>\n\n<p>You can either write your own instance for a newtyped <code>String</code> that is essentially a copy of the original instance, but with the response type set to text/html, or use different facilities in the library to alter the response type.</p>\n\n<p>Also, you should probably note that sending a 200 HTTP response on a 404 error is confusing.</p>\n"}], "owner": {"reputation": 787, "user_id": 3307736, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e9015090707d0e02ee256b8c4687951f?s=128&d=identicon&r=PG&f=1", "display_name": "Larry", "link": "https://stackoverflow.com/users/3307736/larry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 29745377, "answer_count": 1, "score": 0, "last_activity_date": 1429525802, "creation_date": 1429490073, "last_edit_date": 1429494998, "question_id": 29737586, "link": "https://stackoverflow.com/questions/29737586/haskell-happstack-can-i-use-a-string-with-html-tags-as-response", "title": "Haskell Happstack, can I use a string with html tags as response?", "body": "<pre><code>    module Main where\n\n    import Happstack.Lite\n    import Text.Html\n\n    main :: IO ()\n    main = serve Nothing $ msum [\n              nullDir &gt;&gt; ok homePage\n            , notFound page404  \n        ]\n\n    homePage :: Response\n    homePage = toResponse $ do\n        p (toHtml \"hello\") +++ \n            strong (toHtml \"BOLD\")\n\n    page404 :: Response\n    page404 = toResponse \"&lt;strong&gt;How do I parse the tag STRONG?&lt;/strong&gt;\"\n</code></pre>\n\n<p>Hi, I'm new to happstack. I'm wondering if there's a way I can just display a string with html tags as response instead of using a html template library?</p>\n\n<p>In the above code, the <code>&lt;strong&gt;</code> tag in page404 is escaped, so I got \"<code>&lt;strong&gt;How do I pase the tag BOLD?&lt;/strong&gt;</code>\" as response, while the one homePage is rendered as \"<strong>How do I parse the tag BOLD</strong>\".</p>\n\n<p>Do I have to parse the string first? But wouldn't that be too slow if the html string is large?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["list", "haskell", "replace"], "answers": [{"tags": [], "owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "is_accepted": false, "score": 5, "last_activity_date": 1429485085, "creation_date": 1429485085, "answer_id": 29736980, "question_id": 29736950, "link": "https://stackoverflow.com/questions/29736950/replacing-empty-lists-with-a-value/29736980#29736980", "title": "Replacing empty lists with a value", "body": "<p>Consider that if you have a function <code>foo</code> that can transform <code>[]</code> to <code>[0]</code> and return every other list untouched, <code>map foo</code> is the final function that you want.</p>\n"}, {"comments": [{"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 0, "creation_date": 1429525205, "post_id": 29737040, "comment_id": 47622689, "body": "Did you try to compile that last function in the comments? You should get a scope error. ;)"}, {"owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "reply_to_user": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 0, "creation_date": 1429525585, "post_id": 29737040, "comment_id": 47622953, "body": "Oh right, I write it while on the train and didn&#39;t check it."}], "tags": [], "owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "is_accepted": false, "score": 2, "last_activity_date": 1429485477, "creation_date": 1429485477, "answer_id": 29737040, "question_id": 29736950, "link": "https://stackoverflow.com/questions/29736950/replacing-empty-lists-with-a-value/29737040#29737040", "title": "Replacing empty lists with a value", "body": "<p>Change your function with</p>\n\n<pre><code>knightPlace n = map (\\x -&gt; if null x then [0] else x) $ makeboard n\n</code></pre>\n\n<p>Also consider using pointfree style</p>\n\n<pre><code>knightPlace = map (\\x -&gt; if null x then [0] else x) . makeboard\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18463, "user_id": 3189923, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/5d3122866199817cdf56b96a788d406f?s=128&d=identicon&r=PG&f=1", "display_name": "elm", "link": "https://stackoverflow.com/users/3189923/elm"}, "is_accepted": true, "score": 2, "last_activity_date": 1429513175, "last_edit_date": 1429513175, "creation_date": 1429504146, "answer_id": 29739351, "question_id": 29736950, "link": "https://stackoverflow.com/questions/29736950/replacing-empty-lists-with-a-value/29739351#29739351", "title": "Replacing empty lists with a value", "body": "<p>Replace <code>xs</code> with <code>ys</code> in <code>l</code>,</p>\n\n<pre><code>replaceWith :: [a] -&gt; [a] -&gt; [[a]]\nreplaceWith xs ys l = map (\\x -&gt; if x == xs then ys else x) l\n</code></pre>\n\n<p>In the case here,</p>\n\n<pre><code>replaceWith [] [0] [[1, 2, 3],[],[5],[5,6],[]]\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 4585790, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ac4356ffab4061d7e8f4a644057faa6d?s=128&d=identicon&r=PG&f=1", "display_name": "REALLYANGRYSTUDENT", "link": "https://stackoverflow.com/users/4585790/reallyangrystudent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 29739351, "answer_count": 3, "score": 0, "last_activity_date": 1429513175, "creation_date": 1429484901, "last_edit_date": 1429486180, "question_id": 29736950, "link": "https://stackoverflow.com/questions/29736950/replacing-empty-lists-with-a-value", "title": "Replacing empty lists with a value", "body": "<p>I have a function that returns a list like this: </p>\n\n<pre><code>[ [1, 2, 3], [], [5], [5,6], []]\n</code></pre>\n\n<p>But I want to replace the empty lists with 0, so that it looks like this</p>\n\n<pre><code>[ [1, 2, 3], [0], [5], [5,6], [0]]\n</code></pre>\n\n<p>So far I have tried <code>filter</code> and <code>map</code> with little success. Can someone please point me in the right direction?</p>\n\n<p>Here is the code in question:</p>\n\n<pre><code>knightPlace:: [Int] -&gt; [[Int]]\nknightPlace n = makeboard n\n\n    where\n    makeboard n =  [x | i&lt;-[0..(length n -1 )], x &lt;- [checkPos i]]\n    -- checkPos add zero\n    checkPos i = [j+1 | j&lt;-[0..(length n -1 )], queenFilter n i j]\n    -- filters all rows, cols and diags, also knights\n    queenFilter n i j = and [n!!(i) == 0 &amp;&amp; n!!(k) /=(j+1) &amp;&amp; (n!!(k)==0 || (abs(n!!(k)-(j+1))/=abs(i-k))) &amp;&amp; (n!!(k)==0 ||not( ((abs(i-k)==2)&amp;&amp; (abs(n!!(k)-(j+1))==1)) ||((abs(i-k)==1)&amp;&amp; (abs(n!!(k)-(j+1))==2))))       | k&lt;-[0..(length n - 1)] ]\n</code></pre>\n\n<p>Called like </p>\n\n<pre><code> knightPlace [0, 0, 6, 0, 0, 4, 0, 0]\n</code></pre>\n"}, {"tags": ["haskell", "binding", "ffi"], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 7, "last_activity_date": 1429468374, "creation_date": 1429468374, "answer_id": 29734081, "question_id": 29733762, "link": "https://stackoverflow.com/questions/29733762/how-do-i-create-a-storable-instance-for-this-type/29734081#29734081", "title": "How do I create a Storable instance for this type?", "body": "<p><code>Ready</code> (the C type) is not a struct or a union, it's a pointer to a <code>struct _Ready</code>. You should use <code>struct _Ready</code> instead, like</p>\n\n<pre><code>peek p = Ready &lt;$&gt; (#peek struct _Ready, ready) p\npoke p (Ready r) = (#poke struct _Ready, ready) p r\n</code></pre>\n\n<p>Also, your <code>sizeOf</code> method is wrong and needs the same change. You need the size of the struct, but you currently have the size of a pointer to the struct, and they are usually not the same on a 64-bit system.</p>\n"}, {"tags": [], "owner": {"reputation": 558, "user_id": 4751430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f424b8d7abc1bd4adaf69ca95412f3a?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Huschenbett", "link": "https://stackoverflow.com/users/4751430/martin-huschenbett"}, "is_accepted": false, "score": 1, "last_activity_date": 1429468480, "creation_date": 1429468480, "answer_id": 29734104, "question_id": 29733762, "link": "https://stackoverflow.com/questions/29733762/how-do-i-create-a-storable-instance-for-this-type/29734104#29734104", "title": "How do I create a Storable instance for this type?", "body": "<p>I can't exactly tell what you're doing wrong because I've never stumbled upon all the hash signs you are using. But the following should do the trick:</p>\n\n<pre><code>instance Storable Ready where\n    alignment _ = alignment (undefined :: CInt)\n    sizeOf _ = sizeOf (undefined :: CInt)\n    peek p = Ready &lt;$&gt; peekByteOff p 0\n    poke p (Ready r) = pokeByteOff p 0 r\n</code></pre>\n\n<p>The <code>0</code> parameter to <code>peekByteOff</code> and <code>pokeByteOff</code> just reflects that the <code>ready</code> component of the <code>_Ready</code> type (in C) is the first field of the record. I'm not very sure about defining <code>alignment</code> and <code>sizeOf</code>, but I wanted you to show an alternative possibility nevertheless.</p>\n"}], "owner": {"reputation": 839, "user_id": 2869868, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cb128aa77ed5962d3918e85e1380179f?s=128&d=identicon&r=PG&f=1", "display_name": "liszt", "link": "https://stackoverflow.com/users/2869868/liszt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 29734081, "answer_count": 2, "score": 2, "last_activity_date": 1429468480, "creation_date": 1429466797, "question_id": 29733762, "link": "https://stackoverflow.com/questions/29733762/how-do-i-create-a-storable-instance-for-this-type", "title": "How do I create a Storable instance for this type?", "body": "<p>Suppose I have the following C structure:</p>\n\n<pre><code>typedef struct _Ready {\n    int ready;\n} *Ready;\n</code></pre>\n\n<p>I represent it in Haskell using this type:</p>\n\n<pre><code>data Ready = Ready { ready :: CInt }\n</code></pre>\n\n<p>Now I want a <code>Storable</code> instance. The following works fine:</p>\n\n<pre><code>instance Storable Ready where\n    alignment = sizeOf\n    sizeOf _  = (#size Ready)\n</code></pre>\n\n<p>However, adding any of these definitions of <code>peek</code> and <code>poke</code> fails:</p>\n\n<pre><code>    peek p = Ready &lt;$&gt; (#peek Ready, ready) p   -- FAILS\n    poke p (Ready r) = (#poke Ready, ready) p r -- FAILS\n</code></pre>\n\n<p>The error boils down to <code>ready</code> not being part of a structure or union:</p>\n\n<pre><code>/usr/lib/ghc-7.10.1/template-hsc.h:72:24:\n  error: request for member \u2018ready\u2019 in something not a structure or union\n</code></pre>\n\n<p>What am I doing wrong?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 304, "user_id": 2106446, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f491e7a9639e216e8310904f7d4869d?s=128&d=identicon&r=PG", "display_name": "Arbus", "link": "https://stackoverflow.com/users/2106446/arbus"}, "edited": false, "score": 0, "creation_date": 1429463286, "post_id": 29732566, "comment_id": 47599262, "body": "Thanks for the detailed explanation! I ran across this issue when trying to translate a very mutation dependent implementation of Smith-Waterman in Java. What would be the best way to translate such code into a language like Haskell?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1429468462, "post_id": 29732566, "comment_id": 47601266, "body": "You mean &quot;evaluate&quot; everywhere you wrote &quot;execute&quot; (as does the OP)."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 304, "user_id": 2106446, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f491e7a9639e216e8310904f7d4869d?s=128&d=identicon&r=PG", "display_name": "Arbus", "link": "https://stackoverflow.com/users/2106446/arbus"}, "edited": false, "score": 1, "creation_date": 1429473424, "post_id": 29732566, "comment_id": 47603265, "body": "@Arbus You can use the <code>ST</code>monad to do mutation"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "reply_to_user": {"reputation": 304, "user_id": 2106446, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f491e7a9639e216e8310904f7d4869d?s=128&d=identicon&r=PG", "display_name": "Arbus", "link": "https://stackoverflow.com/users/2106446/arbus"}, "edited": false, "score": 0, "creation_date": 1429495599, "post_id": 29732566, "comment_id": 47609611, "body": "@Arbus Generally you can use the <code>ST</code> monad to do mutation, but in the specific case of Smith-Waterman I have to wonder why you&#39;re translating it from Java in the first place."}, {"owner": {"reputation": 304, "user_id": 2106446, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f491e7a9639e216e8310904f7d4869d?s=128&d=identicon&r=PG", "display_name": "Arbus", "link": "https://stackoverflow.com/users/2106446/arbus"}, "edited": false, "score": 0, "creation_date": 1429506986, "post_id": 29732566, "comment_id": 47612595, "body": "Thanks for the heads up on the <code>ST</code>, I am working on it now. I am doing it so that I can do a comparison between a functional implementation and comparing it to an implementation in X10 for a class which is probably why the question itself is a bit convoluted in the first place!"}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1429519006, "post_id": 29732566, "comment_id": 47618676, "body": "@ReidBarton I was debating writing &quot;evaluate&quot; instead of &quot;execute&quot; but decided to go with the same word as OP for pedagogical reasons. Accurate observation, nonetheless. :)"}], "tags": [], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "is_accepted": true, "score": 21, "last_activity_date": 1429460915, "creation_date": 1429460915, "answer_id": 29732566, "question_id": 29732450, "link": "https://stackoverflow.com/questions/29732450/order-of-execution-within-monads/29732566#29732566", "title": "Order of execution within monads", "body": "<p>Haskell is <em>lazy</em>, which means things are not executed immediately. Things are executed whenever their result is needed \u2013 but no sooner. Sometimes code isn't executed at all if its result isn't needed.</p>\n\n<p>If you stick a bunch of <code>trace</code> calls in a pure function, you will see this laziness happening. The first thing that is needed will be executed first, so that's the <code>trace</code> call you see first.</p>\n\n<p>When something says \"the computation is run from left to right\" what it means is that the result will be the same as if the computation was run from left to right. What actually happens under the hood might be very different.</p>\n\n<p>This is in fact <em>why</em> it's a bad idea to do I/O inside pure functions. As you have discovered, you get \"weird\" results because the execution order can be pretty much anything that produces the correct result.</p>\n\n<p>Why is this a good idea? When the language doesn't enforce a specific execution order (such as the traditional \"top to bottom\" order seen in imperative languages) the compiler is free to do a tonne of optimisations, such as for example not executing some code at all because its result isn't needed.</p>\n\n<p>I would recommend you to <em>not</em> think too much about execution order in Haskell. There should be no reason to. Leave that up to the compiler. Think instead about which values you want. Does the function give the correct value? Then it works, regardless of which order it executes things in.</p>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 7, "last_activity_date": 1478212219, "last_edit_date": 1478212219, "creation_date": 1429551493, "answer_id": 29754668, "question_id": 29732450, "link": "https://stackoverflow.com/questions/29732450/order-of-execution-within-monads/29754668#29754668", "title": "Order of execution within monads", "body": "<blockquote>\n  <p>I thought that maybe this is a quirk of <code>forM</code> and tried it with <code>sequence</code> which specifically states that it runs its computation sequentially from left to right like so: [...]</p>\n</blockquote>\n\n<p>You need to learn to make the following, tricky distinction:</p>\n\n<ol>\n<li>The order of <strong>evaluation</strong></li>\n<li>The order of <strong>effects</strong> (a.k.a. \"actions\")</li>\n</ol>\n\n<p>What <code>forM</code>, <code>sequence</code> and similar functions promise is that the <strong>effects</strong> will be ordered from left to right.  So for example, the following is guaranteed to print characters in the same order that they occur in the string:</p>\n\n<pre><code>putStrLn :: String -&gt; IO ()\nputStrLn str = forM_ str putChar &gt;&gt; putChar '\\n'\n</code></pre>\n\n<p>But that doesn't mean that expressions are evaluated in this left-to-right order.  The program has to evaluate enough of the expressions to figure out what the next action is, but that often does not require evaluating everything in every expression involved in earlier actions.</p>\n\n<p>Your example uses the <code>State</code> monad, which bottoms out to pure code, so that accentuates the order issues.  The only thing that a traversal functions such as <code>forM</code> promises in this case is that <code>get</code>s inside the actions mapped to the list elements will see the effect of <code>put</code>s for elements to their left in the list.</p>\n"}], "owner": {"reputation": 304, "user_id": 2106446, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f491e7a9639e216e8310904f7d4869d?s=128&d=identicon&r=PG", "display_name": "Arbus", "link": "https://stackoverflow.com/users/2106446/arbus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 611, "favorite_count": 0, "accepted_answer_id": 29732566, "answer_count": 2, "score": 10, "last_activity_date": 1478212219, "creation_date": 1429460390, "question_id": 29732450, "link": "https://stackoverflow.com/questions/29732450/order-of-execution-within-monads", "title": "Order of execution within monads", "body": "<p>I was learning how to use the State monad and I noticed some odd behavior in terms of the order of execution. Removing the distracting bits that involve using the actual state, say I have the following code:</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.State\nimport Debug.Trace\n\nmainAction :: State Int ()\nmainAction = do\n    traceM \"Starting the main action\"\n    forM [0..2] (\\i -&gt; do\n        traceM $ \"i is \" ++ show i\n        forM [0..2] (\\j -&gt; do\n            traceM $ \"j is \" ++ show j\n            someSubaction i j\n        )\n    )\n</code></pre>\n\n<p>Running <code>runState mainAction 1</code> in ghci produces the following output:</p>\n\n<pre><code>j is 2          \nj is 1          \nj is 0          \ni is 2          \nj is 2          \nj is 1          \nj is 0          \ni is 1         \nj is 2          \nj is 1          \nj is 0          \ni is 0          \nOutside for loop\n</code></pre>\n\n<p>which seems like the reverse order of execution of what might be expected. I thought that maybe this is a quirk of <code>forM</code> and tried it with <code>sequence</code> which specifically states that it runs its computation sequentially from left to right like so:</p>\n\n<pre><code>mainAction :: State Int ()\nmainAction = do\n    traceM \"Outside for loop\"\n    sequence $ map handleI [0..2]\n    return ()\n    where\n    handleI i = do\n        traceM $ \"i is \" ++ show i\n        sequence $ map (handleJ i) [0..2]\n    handleJ i j = do\n        traceM $ \"j is \" ++ show j\n        someSubaction i j\n</code></pre>\n\n<p>However, the <code>sequence</code> version produces the same output. What is the actual logic in terms of the order of execution that is happening here?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1429478384, "post_id": 29731320, "comment_id": 47605155, "body": "Your update is simpley wrong.  Compiling that code should/does result in <code>so: MyException &quot;Msg&quot;</code>.  Are you sure you recompiled?  If so then open a new question and fill in all the details including a copy-paste of code, compilation, execution, uname -a, and ghc --version."}, {"owner": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1429508910, "post_id": 29731320, "comment_id": 47613283, "body": "@ThomasM.DuBuisson My update is correct. The handler <code>\\e -&gt; putStrLn ...</code> does not work."}], "answers": [{"comments": [{"owner": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "edited": false, "score": 0, "creation_date": 1429458173, "post_id": 29731440, "comment_id": 47597211, "body": "Can you please answer my second question (see Update)?"}], "tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": true, "score": 9, "last_activity_date": 1429454993, "creation_date": 1429454993, "answer_id": 29731440, "question_id": 29731320, "link": "https://stackoverflow.com/questions/29731320/why-doesnt-my-code-catch-exception/29731440#29731440", "title": "Why doesn&#39;t my code catch Exception?", "body": "<p>Because Haskell is lazy, and you never use the result of <code>t</code>, so it is never evaluated and thus the exception isn't thrown.</p>\n"}, {"comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1429466400, "post_id": 29732719, "comment_id": 47600517, "body": "... or use <code>throwIO</code> instead of <code>return . throw</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1429461719, "creation_date": 1429461719, "answer_id": 29732719, "question_id": 29731320, "link": "https://stackoverflow.com/questions/29731320/why-doesnt-my-code-catch-exception/29732719#29732719", "title": "Why doesn&#39;t my code catch Exception?", "body": "<p>About \"why the code below does not print the exception?\":</p>\n\n<pre><code>io :: IO ()\nio = catch (return t) (\\e -&gt; putStrLn $ myExToString e)\n\nmain = io &gt;&gt;= print\n</code></pre>\n\n<p>Here, <code>print</code> is causing the exception to be thrown when it forces <code>t</code> to be evaluated, but at that time there's no <code>catch</code> around. Try instead:</p>\n\n<pre><code>io :: IO ()\nio = catch (return t &gt;&gt;= print) (\\e -&gt; putStrLn $ myExToString e)\n    -- or simply:  catch (print t) (\\e -&gt; ....)\nmain = io\n</code></pre>\n"}], "owner": {"reputation": 28584, "user_id": 706317, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1mafF.jpg?s=128&g=1", "display_name": "ZhekaKozlov", "link": "https://stackoverflow.com/users/706317/zhekakozlov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 29731440, "answer_count": 2, "score": 4, "last_activity_date": 1429461719, "creation_date": 1429454430, "last_edit_date": 1429458142, "question_id": 29731320, "link": "https://stackoverflow.com/questions/29731320/why-doesnt-my-code-catch-exception", "title": "Why doesn&#39;t my code catch Exception?", "body": "<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n\nimport Control.Exception\nimport Data.Typeable\n\ndata MyException = MyException String deriving (Show, Typeable)\n\ninstance Exception MyException\n\nmyExToString :: MyException -&gt; String\nmyExToString (MyException msg) = msg\n\nt :: ()\nt = throw $ MyException \"Msg\"\n\nmain = catch (return t) (\\e -&gt; putStrLn $ myExToString e)\n</code></pre>\n\n<p>Why doesn't my program print <code>\"Msg\"</code>?</p>\n\n<p><strong>Update:</strong></p>\n\n<p>I changed the code:</p>\n\n<pre><code>io :: IO ()\nio = catch (return t) (\\e -&gt; putStrLn $ myExToString e)\n\nmain = io &gt;&gt;= print\n</code></pre>\n\n<p>But still my code doesn't catch <code>MyException</code>? Why?</p>\n"}, {"tags": ["haskell", "recursion", "combinations", "list-comprehension"], "comments": [{"owner": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 0, "creation_date": 1429452235, "post_id": 29730065, "comment_id": 47595064, "body": "Thanks for clarifying, I&#39;ve added an answer that focuses more on why the tails is there (for picking the first element for our combination)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1429461520, "post_id": 29730065, "comment_id": 47598513, "body": "You may want to experiment with this: <code>[ y:ys | y&lt;-[1] , ys&lt;-[[2],[3],[4]] ]</code>. Here there is only one possible value for <code>y</code>, but this comprehension will produce three lists (of lists), not just one."}, {"owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1429556086, "post_id": 29730065, "comment_id": 47644340, "body": "@chi Great point. That&#39;s what I was missing (well, not only that, but it was my main concern)."}], "answers": [{"comments": [{"owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "edited": false, "score": 0, "creation_date": 1429555930, "post_id": 29730250, "comment_id": 47644238, "body": "This is a great and detailed answer. Thank you"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 3, "last_activity_date": 1429480118, "last_edit_date": 1429480118, "creation_date": 1429448830, "answer_id": 29730250, "question_id": 29730065, "link": "https://stackoverflow.com/questions/29730065/26-of-99-haskell-problems-why-the-result-contains-multiple-lists-with-the-same/29730250#29730250", "title": "26 of 99 Haskell problems - why the result contains multiple lists with the same head?", "body": "<p>List comprehensions define <em>nested loops</em>, in a way. Thus, in the definition</p>\n\n<pre><code>combinations n xs =\n</code></pre>\n\n<p>we can read the code</p>\n\n<pre><code>        [ y:ys | y:t &lt;- tails xs, ys &lt;- combinations (n-1) t]\n</code></pre>\n\n<p>as</p>\n\n<pre><code>        for each (y:t) in (tails xs)\n            for each ys in (combinations (n-1) t) \n                produce (y:ys) as a new element of the resulting list\n</code></pre>\n\n<p>In other words, to pick <code>n</code> elements from a list means to pick some element, and <code>n-1</code> elements after it in the list. </p>\n\n<p>The non-deterministic nature of this definition is represented by producing a list of <em>all</em> the possible solutions, as the result. We pick the <code>n-1</code> elements only <em>to the right</em> of the element, to only produce solutions that are <em>unique</em> under permutation.</p>\n\n<hr>\n\n<p>Let's take <code>xs = [1,2,3]</code> as an example. What does <code>tails [1,2,3]</code> produce? </p>\n\n<p>It's <code>[[1,2,3], [2,3], [3], []]</code>, of course. Now, that's equivalent to</p>\n\n<pre><code>[ r | r &lt;- [[1,2,3], [2,3], [3], []] ]\n</code></pre>\n\n<p>That means, <code>r</code> drawn from that list, takes on the values of its elements, consecutively. <code>r</code> is an <em>irrefutable</em> pattern there; <code>(y:t)</code> is a refutable pattern, i.e. it will fail to match the <code>[]</code> element:</p>\n\n<pre><code>[ (y,t) | (y:t) &lt;- tails [1,2,3]]\n  =&gt;  [(1,[2,3]), (2,[3]), (3,[])]\n</code></pre>\n\n<p>So you see, <code>t</code> is not <em>\"not known yet\"</em>. It <em>is</em> known, it's just the tail of a given list. And when <code>y</code> matches with 3, <code>t</code> is matched with <code>[]</code>.</p>\n\n<p>Moreover,</p>\n\n<pre><code>[ (y,q) | (y:t) &lt;- tails [1,2,3], q &lt;- [10,20]]\n =&gt;  [(1,10), (1,20), (2,10), (2,20), (3,10), (3,20)]\n</code></pre>\n\n<p>This is illustrative enough, hopefully, to clear your first question: for each matching <code>(y:t)</code> pattern, <code>q</code> is drawn from <code>[10,20]</code>, i.e. it also takes on the values in the list (here, <code>[10,20]</code>) consecutively, for each <code>y</code>, as if in a <em>nested loop</em>.</p>\n\n<hr>\n\n<p>For your example of <code>combinations 2 [1,2,3]</code> we have</p>\n\n<pre><code>  combinations 2 [1,2,3]\n=\n  for each (y,t) in [ (1,[2,3]), (2,[3]), (3,[]) ]\n      for each ys in (combinations 1 t)\n          produce (y:ys)\n=\n  for y = 1, t = [2,3]\n      for each ys in (combinations 1 [2,3]) produce (1:ys) , and then\n  for y = 2, t = [3]\n      for each ys in (combinations 1 [3])   produce (2:ys) , and then\n  for y = 3, t = []\n      for each ys in (combinations 1 [])    produce (3:ys)\n</code></pre>\n\n<p><code>combinations 1 []</code> is <code>[]</code>, because <code>tails []</code> is <code>[[]]</code> and pattern matching <code>(y:t)</code> with <code>[]</code> as part of generator  <code>(y:t) &lt;- [[]]</code> will fail; so no solutions will be produced by the third <em><code>for</code></em> line <sub>(that would have <code>3</code> in the solution's head - because there are no more elements to its right to pick the second element from, as we need to pick 2 elements overall; 3 does indeed participate in tails of other solutions, as it well should).</sub></p>\n\n<p>The second <em><code>for</code></em> line obviously produces just one solution, <code>[2,3]</code>. What does the first <em><code>for</code></em> line produce?</p>\n\n<pre><code>      for each ys in (combinations 1 [2,3]) produce (1:ys)\n</code></pre>\n\n<p><code>combinations 1</code> takes just one element, so it produces <code>[2]</code> and <code>[3]</code>; so the first <code>for</code> line produces two solutions, <code>[1,2]</code> and <code>[1,3]</code>. Or in more detail,</p>\n\n<pre><code>      combinations 1 [2,3] \n    =\n      for y = 2, t = [3]\n          for each ys in (combinations 0 [3]) produce (2:ys) , and then\n      for y = 3, t = []\n          for each ys in (combinations 0 [])  produce (3:ys)\n</code></pre>\n\n<p>and <code>combinations 0</code> always produces a single solution that is an empty list (a singleton list with an empty list as its only element, <code>[ [] ]</code>, representing a solution of picking 0 elements from a list).</p>\n\n<p>So overall, the list of three solutions is returned, <code>[[1,2], [1,3], [2,3]]</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "is_accepted": false, "score": 2, "last_activity_date": 1429452194, "creation_date": 1429452194, "answer_id": 29730888, "question_id": 29730065, "link": "https://stackoverflow.com/questions/29730065/26-of-99-haskell-problems-why-the-result-contains-multiple-lists-with-the-same/29730888#29730888", "title": "26 of 99 Haskell problems - why the result contains multiple lists with the same head?", "body": "<p>The core thing to notice here is the <em>recursive nature of the problem</em>. </p>\n\n<p>How can we pick <code>i</code> items from a list?</p>\n\n<ul>\n<li>If the list is empty, then there are no combinations. So that's not an interesting case.</li>\n<li>If the list isn't empty - we can either pick the first item for our combination or not\n<ul>\n<li>If we pick it, we still have to pick <code>i-1</code> items from the rest of the list</li>\n<li>If we do not pick it, we still have to pick <code>i</code> items from the rest of the list</li>\n</ul></li>\n</ul>\n\n<p>Doing:</p>\n\n<pre><code>[ y:ys | y:xs' &lt;- tails xs, ys &lt;- combination (i-1) xs']\n</code></pre>\n\n<ul>\n<li>Look at all the tails of <code>xs</code>, that is, <strong>look at all the possibilities for picking the <em>first</em> element for our <code>i</code> combination</strong>.</li>\n<li>Pick that first element, as explained above we now have <code>i-1</code> items, thus, we need to concat that element to the combinations of <code>i-1</code> items with the remaining items. </li>\n</ul>\n"}], "owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 29730250, "answer_count": 2, "score": 3, "last_activity_date": 1443823752, "creation_date": 1429447708, "last_edit_date": 1443823752, "question_id": 29730065, "link": "https://stackoverflow.com/questions/29730065/26-of-99-haskell-problems-why-the-result-contains-multiple-lists-with-the-same", "title": "26 of 99 Haskell problems - why the result contains multiple lists with the same head?", "body": "<p>I am trying to figure out how one of the solutions to problem 26 of <a href=\"https://wiki.haskell.org/H-99:_Ninety-Nine_Haskell_Problems\" rel=\"nofollow\">99 Haskell problems</a> works. The solution is as follows:</p>\n\n<pre><code>combination :: Int -&gt; [a] -&gt; [[a]]\ncombination 0 _ = [ [] ]\ncombination i xs = [ y:ys | y:xs' &lt;- tails xs, ys &lt;- combination (i-1) xs']\n</code></pre>\n\n<p>I can't understand how it is possible that there will be more than one list with the same head. To me the <code>y</code> part in <code>y:ys</code> that will be produced from using <code>tails xs</code> can be used only to compose one list.</p>\n\n<p>Example:</p>\n\n<pre><code>combination 2 [1,2,3]\n</code></pre>\n\n<p>First we take the <code>y</code> part from <code>tails xs</code>, which gives us three lists: <code>[1,(not known yet)]</code>, <code>[2,(not known yet)]</code>, <code>[3,(not known yet)]</code>. So how come at the end we get multiple results with 1 as the head?</p>\n\n<p>I also can't grasp why the list <code>[3]</code> won't be in the result? It certainly will appear as a head in one of the lists produced by <code>tails xs</code>. I didn't want to raise this concern in a separate question - I hope that's fine.</p>\n"}, {"tags": ["haskell", "emacs", "cabal", "flycheck"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 2, "creation_date": 1429450218, "post_id": 29729412, "comment_id": 47594414, "body": "I&#39;ve been told that some of these tricks work <a href=\"http://www.yesodweb.com/blog/2014/06/evil-conditional-compile\" rel=\"nofollow noreferrer\">yesodweb.com/blog/2014/06/evil-conditional-compile</a>"}, {"owner": {"reputation": 356, "user_id": 697026, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/984013ed37f21f0ea7b0f1bab3e4830b?s=128&d=identicon&r=PG", "display_name": "mdorman", "link": "https://stackoverflow.com/users/697026/mdorman"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1429464354, "post_id": 29729412, "comment_id": 47599724, "body": "Thanks for the pointer.Unfortunately, I have come to believe the fact that they introduced a new data type (CompilerInfo) makes this infeasible."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1429475908, "post_id": 29729412, "comment_id": 47604165, "body": "It would be really ugly, but you should always be able to use the Template Haskell approach by constructing the Names that you need with <code>mkName</code>. Whether the other approaches mentioned in that blog post would work probably depends on exactly what the two versions of the code you need to write are; maybe include them in your question?"}], "owner": {"reputation": 356, "user_id": 697026, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/984013ed37f21f0ea7b0f1bab3e4830b?s=128&d=identicon&r=PG", "display_name": "mdorman", "link": "https://stackoverflow.com/users/697026/mdorman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1429565401, "creation_date": 1429443851, "last_edit_date": 1429565401, "question_id": 29729412, "link": "https://stackoverflow.com/questions/29729412/how-best-to-adapt-to-type-changes-in-cabal-library-without-cpp", "title": "How best to adapt to type changes in Cabal library without CPP?", "body": "<p>I want to enhance <a href=\"https://github/flycheck/flycheck-haskell\" rel=\"nofollow\">flycheck-haskell</a>'s support for auto-configuring flycheck from your .cabal file.</p>\n\n<p>To do this autoconfiguration, flycheck uses <a href=\"https://raw.githubusercontent.com/flycheck/flycheck-haskell/master/get-cabal-configuration.hs\" rel=\"nofollow\">a helper file</a> whose original strategy was to read the .cabal file and use <code>flattenPackageDescription</code>.  This was simple, but does not respect conditional expressions, which can cause problems with, e.g. not needing <code>bytestring-builder</code> when using newer version of the <code>bytestring</code> package.</p>\n\n<p>The appropriate interface to use would seem to be <code>finalizePackageDescription</code>.  This does work...but its type signature changed between 1.20 and 1.22---now, instead of taking a <code>CompilerId</code>, it now takes a <code>CompilerInfo</code>.  Yet I would like to provide consistent support across this API change.</p>\n\n<p>While the solution for this is generally to use <code>CPP</code> macros, those macros are provided by <code>Cabal</code> itself, and <code>flycheck</code> is simply invoking the helper file with <code>runhaskell</code>, so we don't have access to them.</p>\n\n<p>The only option I can think of would be to create <em>another</em> helper to first get the <code>Cabal</code> version information, and then construct appropriate <code>CPP</code> settings for our <code>runhaskell</code> invocation so we can do things that way.  That should work, but seems like a hack.</p>\n\n<p>So I'm here looking for other options that would allow me to support both versions of the interface, without having to resort to <code>CPP</code>.</p>\n\n<p>The code in question is a call to <code>Distribution.PackageDescription.Configuration.finalizePackageDescription</code>, like so:</p>\n\n<pre><code>case finalizePackageDescription [] (const True) buildPlatform buildCompilerId [] genericDesc' of\n  Left e -&gt; putStrLn $ \"Issue with package configuration\\n\" ++ show e\n  Right (pkgDesc, _) -&gt; print (dumpPackageDescription pkgDesc cabalFile)\n</code></pre>\n\n<p>The problem is that the fourth parameter, <code>buildCompilerId</code> changed type from <code>CompilerId</code> to <code>CompilerInfo</code>.</p>\n\n<p>What I have implemented---though I would be happy to consider a more self-contained option---is a helper that spits out <code>-DuseCompilerInfo</code> (as an s-expr, since we're dealing with Emacs) if it's a sufficiently recent version of Cabal:</p>\n\n<pre><code>import Data.Version (Version (Version))\nimport Distribution.Simple.Utils (cabalVersion)\n\nmain :: IO ()\nmain =\n  putStrLn $ if cabalVersion &gt;= Version [1,22] []\n             then \"(\\\"-DuseCompilerInfo\\\")\"\n             else \"()\"\n</code></pre>\n\n<p>The original helper is then run with the flag, and conditionally imports the new structures, as well as having the following conditional code just before the case statement above:</p>\n\n<pre><code>#ifdef useCompilerInfo\n      buildCompilerId = unknownCompilerInfo (CompilerId buildCompilerFlavor compilerVersion) NoAbiTag\n#else\n      buildCompilerId = CompilerId buildCompilerFlavor compilerVersion\n#endif\n</code></pre>\n\n<p>It's not beautiful, but it works.</p>\n"}, {"tags": ["haskell", "exception", "ffi"], "comments": [{"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "edited": false, "score": 1, "creation_date": 1429432942, "post_id": 29727644, "comment_id": 47589125, "body": "I&#39;m asking a semi-related question at the moment here: <a href=\"http://stackoverflow.com/questions/29725324/catching-exceptions-in-eithert-and-preserving-underlying-monad-transformers\" title=\"catching exceptions in eithert and preserving underlying monad transformers\">stackoverflow.com/questions/29725324/&hellip;</a> - this won&#39;t work for me, but I think it might work for you... look at the <code>enclosed-exceptions</code> package and see if that brings you any luck: <a href=\"https://hackage.haskell.org/package/enclosed-exceptions\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/enclosed-exceptions</a>"}, {"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "edited": false, "score": 1, "creation_date": 1429433056, "post_id": 29727644, "comment_id": 47589154, "body": "This blog post is where I read about it, might provide some more useful information: <a href=\"https://www.fpcomplete.com/user/snoyberg/general-haskell/exceptions/catching-all-exceptions\" rel=\"nofollow noreferrer\">fpcomplete.com/user/snoyberg/general-haskell/exceptions/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 4, "last_activity_date": 1429453197, "creation_date": 1429453197, "answer_id": 29731081, "question_id": 29727644, "link": "https://stackoverflow.com/questions/29727644/how-to-catch-a-haskell-exception-that-is-thrown-in-a-haskell-callback-function-c/29731081#29731081", "title": "How to catch a Haskell exception that is thrown in a Haskell callback function called by a C function?", "body": "<p>You have to do this manually, which would look like this:</p>\n\n<ul>\n<li><p>Wrap your callback function in Haskell code that calls <code>try</code>, and then serializes the resulting <code>Either SomeException ()</code> to a format you can process from C (you can use a <code>StablePtr</code> for the <code>SomeException</code>, but the point is that you need to handle the <code>Either</code> somehow).</p></li>\n<li><p>Where your C code calls the callback, check whether the result was a <code>Left exn</code> and if so, propagate the error to the top level of your C code, freeing resources as appropriate along the way. This step is non-mechanical, since C does not have exceptions.</p></li>\n<li><p>At the top level of your C code, re-serialize the exception or result and read it in a Haskell function that wraps your call to the C code, raising an exception or returning the result as appropriate.</p></li>\n</ul>\n\n<p>I'm not aware of any example of a program that does this.</p>\n"}], "owner": {"reputation": 123, "user_id": 4806409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d7218f9ed851c20cdf6db3c0c0e299b?s=128&d=identicon&r=PG&f=1", "display_name": "tmizmd", "link": "https://stackoverflow.com/users/4806409/tmizmd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 381, "favorite_count": 1, "accepted_answer_id": 29731081, "answer_count": 1, "score": 12, "last_activity_date": 1429453197, "creation_date": 1429432500, "last_edit_date": 1429438495, "question_id": 29727644, "link": "https://stackoverflow.com/questions/29727644/how-to-catch-a-haskell-exception-that-is-thrown-in-a-haskell-callback-function-c", "title": "How to catch a Haskell exception that is thrown in a Haskell callback function called by a C function?", "body": "<p>Is there any good way to catch a haskell exception, which is thrown in a haskell callback function called by a c function?</p>\n\n<p>For example, let me have a simple c function which just calls a given callback,</p>\n\n<pre><code>void callmeback ( void (*callback) () ) {\n  callback ();\n}\n</code></pre>\n\n<p>and a haskell code which uses this function via ffi.</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n{-# LANGUAGE ForeignFunctionInterface #-}\nmodule Main (main) where\n\nimport Foreign\nimport Control.Exception\nimport Data.Typeable\n\nforeign import ccall safe \"wrapper\"\n        mkCallback :: IO () -&gt; IO (FunPtr (IO ()))\n\nforeign import ccall safe \"callmeback\"\n        callmeback :: FunPtr (IO ()) -&gt; IO ()\n\ndata AnError = AnError String deriving (Show, Eq, Typeable)\ninstance Exception AnError             \n\ncallback :: IO ()\ncallback = throwIO $ AnError \"Catch me.\"\n\ncallMeBack :: IO () -&gt; IO ()\ncallMeBack f = do fp &lt;- mkCallback f\n                  callmeback fp\nmain = do callMeBack callback `catch`\n             (\\ e -&gt; do putStrLn $ show (e :: AnError)\n                        putStrLn \"I caught you.\" )\n          putStrLn \"-- Happy end.\"\n</code></pre>\n\n<p>The exection result (compiling with GHC 7.8.2) is as follows:</p>\n\n<pre><code>% ./Catch\nCatch: AnError \"Catch me.\"\n</code></pre>\n\n<p>So it seems like the exception thrown in <code>callback</code> can not be caught in <code>main</code>.\nHow can I make this kind code work well?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1429427787, "post_id": 29726720, "comment_id": 47587756, "body": "The <code>:6</code> after the filename means the error is on line 6"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1429427806, "post_id": 29726720, "comment_id": 47587762, "body": "You can not use <code>&amp;</code> in the middle of an identifier. Replace it with some other character."}], "answers": [{"tags": [], "owner": {"reputation": 965, "user_id": 229255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/588fe10267b620e1c0d0d188a8db2621?s=128&d=identicon&r=PG", "display_name": "Ian Ross", "link": "https://stackoverflow.com/users/229255/ian-ross"}, "is_accepted": false, "score": 3, "last_activity_date": 1429431337, "last_edit_date": 1429431337, "creation_date": 1429428307, "answer_id": 29727017, "question_id": 29726720, "link": "https://stackoverflow.com/questions/29726720/why-give-me-error/29727017#29727017", "title": "Why give me error?", "body": "<p>The cause for the error you're getting here is the use of the name <code>count&amp;remove</code>: identifiers in Haskell have to be either alphanumeric (e.g. <code>count_and_remove</code>) <em>or</em> symbolic (e.g. <code>==</code>, <code>++</code>, etc.).  Identifiers can't contain both alphanumeric characters and symbols.</p>\n\n<p>But that's just one problem.  You also have a reference to <code>y</code> on line 9 that doesn't refer to anything.  And you seem not to quite understand yet how pattern matching works in function definitions.  For example, your <code>first</code> function could be defined just as:</p>\n\n<pre><code>first (x:xs) = x\n</code></pre>\n\n<p>This isn't great in itself, both because there's a standard Prelude function called <code>head</code> that does this, and because it's what's called a <em>partial function</em> (<a href=\"https://wiki.haskell.org/Partial_functions\" rel=\"nofollow\">https://wiki.haskell.org/Partial_functions</a>).</p>\n\n<p>The same sort of comment applies to your <code>count&amp;remove</code> function, which you could write as:</p>\n\n<pre><code>count_and_remove xs = length xs - length (remove1 xs)\n</code></pre>\n\n<p>(No need to pattern match with <code>(x:xs)</code> here.)</p>\n\n<p>If you are looking for more learning resources, a popular tutorial is <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow\">Learn You A Haskell</a>.  You can also ask for help on the <a href=\"https://mail.haskell.org/mailman/listinfo/beginners\" rel=\"nofollow\">haskell-beginners mailing list</a> or have a conversation in the <code>#haskell</code> channel on <a href=\"https://webchat.freenode.net/\" rel=\"nofollow\">irc.freenode.net</a>.</p>\n"}], "owner": {"reputation": 1, "user_id": 4806241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5420d733a020404a25906480c4f0821?s=128&d=identicon&r=PG&f=1", "display_name": "ahmed reda", "link": "https://stackoverflow.com/users/4806241/ahmed-reda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "closed_date": 1429764860, "answer_count": 1, "score": -6, "last_activity_date": 1429431337, "creation_date": 1429426153, "last_edit_date": 1429427476, "question_id": 29726720, "link": "https://stackoverflow.com/questions/29726720/why-give-me-error", "closed_reason": "Not suitable for this site", "title": "Why give me error?", "body": "<p>Error:</p>\n\n<p><code>ERROR file:.\\2.hs:6 - Syntax error in declaration (unexpected `(')</code></p>\n\n<p>Code:</p>\n\n<pre><code>frist (y:ys)= (y:ys) !! 0\n\nremove1 (y:[]) = []\nremove1  (y:y2:ys) = if  y==y2 then remove1 (y:ys) else [y2] ++ remove1 (y:ys)\n\ncount&amp;remove (x:xs) = length (x:xs) - length (remove1 (x:xs))\n\nmakepairlist [] = []\nmakepairlist l = [(count&amp;remove l , y)] ++ makepairlist l\n</code></pre>\n"}, {"tags": ["algorithm", "haskell", "tree", "breadth-first-search", "tree-traversal"], "comments": [{"owner": {"reputation": 88499, "user_id": 650405, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5cdee2abea51e91756076032f0053081?s=128&d=identicon&r=PG", "display_name": "Karoly Horvath", "link": "https://stackoverflow.com/users/650405/karoly-horvath"}, "edited": false, "score": 3, "creation_date": 1429424489, "post_id": 29726454, "comment_id": 47586925, "body": "only <i>one</i> question at a time"}, {"owner": {"reputation": 187800, "user_id": 320615, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65c80e12b6a33913538653f6d4ef1277?s=128&d=identicon&r=PG", "display_name": "Dogbert", "link": "https://stackoverflow.com/users/320615/dogbert"}, "edited": false, "score": 1, "creation_date": 1429426259, "post_id": 29726454, "comment_id": 47587346, "body": "(Most of the code in that paper (including the snippet you posted) is in SML.)"}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "reply_to_user": {"reputation": 88499, "user_id": 650405, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5cdee2abea51e91756076032f0053081?s=128&d=identicon&r=PG", "display_name": "Karoly Horvath", "link": "https://stackoverflow.com/users/650405/karoly-horvath"}, "edited": false, "score": 0, "creation_date": 1429428895, "post_id": 29726454, "comment_id": 47588081, "body": "@KarolyHorvath edited the question"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1429505764, "post_id": 29726454, "comment_id": 47612230, "body": "There&#39;s a Haskell implementation of that algorithm for <a href=\"http://hackage.haskell.org/package/containers-0.2.0.1/docs/src/Data-Tree.html#unfoldTreeM_BF\" rel=\"nofollow noreferrer\"><code>unfoldForestM_BF</code> in <code>Data.Tree</code></a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1429555871, "post_id": 29726454, "comment_id": 47644200, "body": "By the way, you should also look into the approach Okasaki contrasts his with\u2014what I think he called the level-oriented solution. It&#39;s quite nice as well, and I suspect faster."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1429582983, "post_id": 29726454, "comment_id": 47655493, "body": "@Cirdec, you may find some things in my answer oddly familiar :-)"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1429558690, "post_id": 29755950, "comment_id": 47645968, "body": "These days, wouldn&#39;t one want to write a traversal function for arbitrary applicatives?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1429558800, "post_id": 29755950, "comment_id": 47646038, "body": "@dfeuer One would, but the problem is we need to traverse level by level, yet get the sub-nodes from the level below (<code>l&#39;</code> and <code>r&#39;</code>). So I&#39;m not sure if it&#39;s possible for a general aplicative."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1429582887, "post_id": 29755950, "comment_id": 47655469, "body": "See my answer. I&#39;m pretty sure I got it. I defined a <code>Traversable</code> instance based on the <code>unfoldForestBF</code> concept."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1429626350, "post_id": 29755950, "comment_id": 47680439, "body": "@PetrPudl&#225;k thanks, it&#39;s amazing;  I am trying to wrap my head around it. still looks like magic. can you explain how the <code>ms</code> is defined in the line <code>tagBfs f t = let (ms, r) = thread (mempty : ms) t</code>? it looks infinite recursion."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1429630199, "post_id": 29755950, "comment_id": 47683592, "body": "@mntk123 It&#39;s very similar to defining the Fibonacci sequence as an infinite list <a href=\"https://wiki.haskell.org/The_Fibonacci_sequence#Canonical_zipWith_implementation\" rel=\"nofollow noreferrer\"><code>fibs = 0 : 1 : zipWith (+) fibs (tail fibs)</code></a>. Since <code>thread</code> processes the list one by one (level by level), it only needs the head <code>mempty</code> to process the first level. For computing the second level, it uses the result computed in the first one etc. The list is potentially infinite, but this is fine, as we only need as many elements of the list as to which depth we inspect the tree."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1429686521, "post_id": 29755950, "comment_id": 47709250, "body": "@PetrPudl&#225;k okay, got it; but then will it work with any finite list in place of <code>ms</code>, (assuming  the list is at least of length equal to the number of elements in the tree)? in other words, is lazy evaluation needed here?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1429775518, "post_id": 29755950, "comment_id": 47761036, "body": "@mntk123 It&#39;s not about &#39;any&#39; list, the list is defined by the equation. Yes, lazy evaluation is needed here - the list referenced while being computed. You could also use finite lists (assuming the depth of the tree is finite), perhaps by having it as a list of <code>Maybe</code>s where <code>Nothing</code> means no nodes traversed on a particular level, and end the list then. But in Haskell you don&#39;t need it and it&#39;d only make the code more complex with no real gain."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1429781639, "post_id": 29755950, "comment_id": 47765298, "body": "@dfeuer IIUC, the difference is that your solution splits levels into separate temporary data structures, traverses them and merges back, right? I wonder if it&#39;s be possible to merge the approaches together somehow."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1429818372, "post_id": 29755950, "comment_id": 47792512, "body": "@PetrPudl&#225;k, It does that, yes, and I don&#39;t <i>think</i> it&#39;s possible to avoid that without significant damage. Cirdec did a lot of good and interesting work on such things in the various rose tree monadic unfold attempts, and may therefore have a deeper understanding."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 3, "last_activity_date": 1429555514, "creation_date": 1429555514, "answer_id": 29755950, "question_id": 29726454, "link": "https://stackoverflow.com/questions/29726454/explain-the-haskell-breadth-first-numbering-code-to-traverse-trees/29755950#29755950", "title": "explain the Haskell breadth first numbering code to traverse trees", "body": "<p>Breadth first traversal means traversing levels of a tree one by one. So let's assume we already know what are the numbers at the beginning of each level - the number of traversed elements so far before each level. For the simple example in the paper</p>\n\n<pre><code>import Data.Monoid\n\ndata Tree a = Tree (Tree a) a (Tree a)\n            | Empty\n  deriving (Show)\n\nexample :: Tree Char\nexample = Tree (Tree Empty 'b' (Tree Empty 'c' Empty)) 'a' (Tree Empty 'd' Empty)\n</code></pre>\n\n<p>the sizes would be 0, 1, 3, 4. Knowing this, we can thread such a list of sizes through a give tree (sub-tree) left-to-right: We advance the first element of the list by one for the node, and thread the tail of the list first through the left and then through the right subtree (see <code>thread</code> below).</p>\n\n<p>After doing so, we'll get again the same list of sizes, only shifted by one - now we have the total number of elements <em>after</em> each level. So the trick is: Assume we have such a list, use it for the computation, and then feed the output as the input - <a href=\"https://wiki.haskell.org/Tying_the_Knot\" rel=\"nofollow\">tie the knot</a>.</p>\n\n<p>A sample implementation:</p>\n\n<pre><code>tagBfs :: (Monoid m) =&gt; (a -&gt; m) -&gt; Tree a -&gt; Tree m\ntagBfs f t = let (ms, r) = thread (mempty : ms) t\n              in r\n  where\n    thread ms Empty = (ms, Empty)\n    thread (m : ms) (Tree l x r) =\n        let (ms1, l') = thread ms l\n            (ms2, r') = thread ms1 r\n         in ((m &lt;&gt; f x) : ms2, Tree l' m r')\n</code></pre>\n\n<p>generalized to <code>Monoid</code> (for numbering you'd give <code>const $ Sum 1</code> as the function).</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1429589460, "last_edit_date": 1495541399, "creation_date": 1429582862, "answer_id": 29761761, "question_id": 29726454, "link": "https://stackoverflow.com/questions/29726454/explain-the-haskell-breadth-first-numbering-code-to-traverse-trees/29761761#29761761", "title": "explain the Haskell breadth first numbering code to traverse trees", "body": "<p>One way to view tree numbering is in terms of a traversal. Specifically, we want to traverse the tree in breadth-first order using <code>State</code> to count up. The necessary <code>Traversable</code> instance looks something like this. Note that you'd probably actually want to define this instance for a <code>newtype</code> like <code>BFTree</code>, but I'm just using the raw <code>Tree</code> type for simplicity. This code is strongly inspired by ideas in <a href=\"https://stackoverflow.com/a/27752984/1477667\">Cirdec's monadic rose tree unfolding code</a>, but the situation here <em>seems</em> to be substantially simpler. Hopefully I haven't missed something horrible.</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor,\n             GeneralizedNewtypeDeriving,\n             LambdaCase #-}\n{-# OPTIONS_GHC -Wall #-}\n\nmodule BFT where\n\nimport Control.Applicative\nimport Data.Foldable\nimport Data.Traversable\nimport Prelude hiding (foldr)\n\ndata Tree a = Tree (Tree a) a (Tree a)\n            | Empty\n  deriving (Show, Functor)\n\nnewtype Forest a = Forest {getForest :: [Tree a]}\n   deriving (Functor)\n\ninstance Foldable Forest where\n  foldMap = foldMapDefault\n\n-- Given a forest, produce the forest consisting\n-- of the children of the root nodes of non-empty\n-- trees.\nchildren :: Forest a -&gt; Forest a\nchildren (Forest xs) = Forest $ foldr go [] xs\n  where\n    go Empty c = c\n    go (Tree l _a r) c = l : r : c\n\n-- Given a forest, produce a list of the root nodes\n-- of the elements, with `Nothing` values in place of\n-- empty trees.\nparents :: Forest a -&gt; [Maybe a]\nparents (Forest xs) = foldr go [] xs\n  where\n    go Empty c = Nothing : c\n    go (Tree _l a _r) c = Just a : c\n\n-- Given a list of values (mixed with blanks) and\n-- a list of trees, attach the values to pairs of\n-- trees to build trees; turn the blanks into `Empty`\n-- trees.\nzipForest :: [Maybe a] -&gt; Forest a -&gt; [Tree a]\nzipForest [] _ts = []\nzipForest (Nothing : ps) ts = Empty : zipForest ps ts\nzipForest (Just p : ps) (Forest ~(t1 : ~(t2 : ts'))) =\n   Tree t1 p t2 : zipForest ps (Forest ts')\n\ninstance Traversable Forest where\n  -- Traversing an empty container always gets you\n  -- an empty one.\n  traverse _f (Forest []) = pure (Forest [])\n\n  -- First, traverse the parents. The `traverse.traverse`\n  -- gets us into the `Maybe`s. Then traverse the\n  -- children. Finally, zip them together, and turn the\n  -- result into a `Forest`. If the `Applicative` in play\n  -- is lazy enough, like lazy `State`, I believe \n  -- we avoid the double traversal Okasaki mentions as\n  -- a problem for strict implementations.\n  traverse f xs = (Forest .) . zipForest &lt;$&gt;\n          (traverse.traverse) f (parents xs) &lt;*&gt;\n          traverse f (children xs)\n\ninstance Foldable Tree where\n  foldMap = foldMapDefault\n\ninstance Traversable Tree where\n  traverse f t =\n       (\\case {(Forest [r]) -&gt; r;\n               _ -&gt; error \"Whoops!\"}) &lt;$&gt;\n       traverse f (Forest [t])\n</code></pre>\n\n<p>Now we can write code to pair up each element of the tree with its breadth-first number like this:</p>\n\n<pre><code>import Control.Monad.Trans.State.Lazy\n\nnumberTree :: Tree a -&gt; Tree (Int, a)\nnumberTree tr = flip evalState 1 $ for tr $ \\x -&gt;\n      do\n        v &lt;- get\n        put $! (v+1)\n        return (v,x)\n</code></pre>\n"}], "owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1015, "favorite_count": 3, "accepted_answer_id": 29755950, "answer_count": 2, "score": 6, "last_activity_date": 1429589460, "creation_date": 1429423813, "last_edit_date": 1429431198, "question_id": 29726454, "link": "https://stackoverflow.com/questions/29726454/explain-the-haskell-breadth-first-numbering-code-to-traverse-trees", "title": "explain the Haskell breadth first numbering code to traverse trees", "body": "<p>I am reading <a href=\"http://www.cs.tufts.edu/~nr/cs257/archive/chris-okasaki/breadth-first.pdf\" rel=\"noreferrer\">this paper by Chris Okasaki</a>; titled \"Breadth-First Numbering: Lessons from a Small Exercise in Algorithm Design\".</p>\n\n<p>A question is - how is the magic happening in the algorithm? There are some figures (e.g. figure 7 titled \"threading the output of one level into the input of next level\")\nUnfortunately, maybe it's only me, but that figure has completely baffled me. I don't understand how the threading happens at all? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1429515460, "post_id": 29725324, "comment_id": 47616782, "body": "I&#39;m not sure <code>throwM</code> and <code>EitherT</code> together does what you need here, since e.g. evaluating <code>runEitherT (throwM ReadLineException :: EitherT ReadLineException ())</code> results in an error instead of a <code>Left ReadLineException</code> value... The documentation for the <code>MonadThrow</code> instance of <code>EitherT</code> explicitly mentions that it &quot;[t]hrows exceptions into the base monad.&quot;"}], "owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 247, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1429412660, "creation_date": 1429412660, "question_id": 29725324, "link": "https://stackoverflow.com/questions/29725324/catching-exceptions-in-eithert-and-preserving-underlying-monad-transformers", "title": "Catching exceptions in EitherT and preserving underlying monad transformers", "body": "<p>Basically I want to understand how to do exception handling. I'm using the <code>exceptions</code> package with <code>MonadThrow</code>/<code>MonadCatch</code> and this isn't making a lot of sense to me. I broke it down into the smallest example that I could. I appreciate this is pretty contrived.</p>\n\n<p>First I define an arbitrary <code>Exception</code>:</p>\n\n<pre><code>data ReadLineException = ReadLineException deriving (Show,Typeable)\ninstance Exception ReadLineException\n</code></pre>\n\n<p>Then there is a function which asks the user for a number, and keeps track of what happened using a MonadWriter. If a number isn't entered it throws an exception using <code>throwM</code> from <code>Control.Monad.Catch</code>.</p>\n\n<pre><code>ioTell :: (MonadWriter [String] m, MonadIO m, MonadThrow m) =&gt; m Int\nioTell = do\n    tell [\"Some opening string\"]\n    liftIO $ print \"Enter a number: \"\n    x &lt;- liftIO $ getLine\n    let mx = maybeRead x :: Maybe Int\n    case mx of Nothing -&gt; do\n                    tell [\"Invalid entry was chosen: \" ++ show x]\n                    throwM ReadLineException\n               (Just a) -&gt; do\n                    tell [\"Number chosen was \" ++ show a]\n                    return a\n</code></pre>\n\n<p>Next, I define some way to arbitrarily catch any exception (supposing that the rest of the computation can continue regardless of any exception):</p>\n\n<pre><code>eitherCatch :: (Monad m, MonadIO m, MonadThrow m, MonadCatch m) =&gt; EitherT SomeException m a -&gt; EitherT SomeException m a\neitherCatch et = catchAll et (\\e -&gt; left e)\n</code></pre>\n\n<p>With the general types out of the way, I define a Transformer stack with an escape function:</p>\n\n<pre><code>type MyExcept a = EitherT SomeException (WriterT [String] IO) a\n\nrunMyExcept :: MyExcept a -&gt; IO (Either SomeException a,[String])\nrunMyExcept me = runWriterT $ runEitherT me\n</code></pre>\n\n<p>Finally I run <code>ioTell</code> twice in a row, collecting the outputs from both writers and merging them (in my actual usecase this is complicated further because I use <code>async</code> and <code>wait</code>).</p>\n\n<pre><code>testM :: MyExcept Int\ntestM = eitherCatch $ do\n    (ex,w1) &lt;- liftIO $ runMyExcept ioTell\n    let x = case ex of (Left _) -&gt; 10\n                       (Right a) -&gt; a\n    (ey,w2) &lt;- liftIO $ runMyExcept ioTell\n    let y = case ey of (Left _) -&gt; 10\n                       (Right a) -&gt; a  \n    tell $ w1 ++ w2 ++  [\"Combined value is \" ++ show (x + y)]\n    return (x + y)\n</code></pre>\n\n<p>This didn't catch the exception. Console output:</p>\n\n<pre><code>\"Enter a number: \"\n2\n\"Enter a number: \"\nx\n(Left ReadLineException,[])\n</code></pre>\n\n<p>With some trial and error, I worked out that I can get the error handled by running <code>eitherCatch</code> before I run <code>runMyExcept</code>. This way the exception is thrown into a <code>Left</code> constructor before trying to pattern match on it (seems so obvious now, though there was no way to infer that the program would escape purely from thetypes):</p>\n\n<pre><code>testM :: MyExcept Int\ntestM = do\n    (ex,w1) &lt;- liftIO . runMyExcept $ eitherCatch ioTell\n    let x = case ex of (Left _) -&gt; 10\n                       (Right a) -&gt; a\n    (ey,w2) &lt;- liftIO . runMyExcept $ eitherCatch ioTell\n    let y = case ey of (Left _) -&gt; 10\n                       (Right a) -&gt; a  \n    tell $ w1 ++ w2 ++  [\"Combined value is \" ++ show (x + y)]\n    return (x + y)\n</code></pre>\n\n<p><strong>First problem</strong>: this loses the state built up by the <code>Writer</code> by the function that throws the exception:</p>\n\n<pre><code>\"Enter a number: \"\n1\n\"Enter a number: \"\nx\n(Right 11,[\"Some opening string\",\"Number chosen was 1\",\"Combined value is 11\"])\n</code></pre>\n\n<p><strong>Second problem</strong>: this also seems to force where the exception is handled. Suppose I wanted the entire computation to fail, the moment one computation failed. I hoped that the exception would proliferate up through the call stack, and could be caught anywhere along the chain.</p>\n\n<p>Assuming I can find some resolution to the first problem, I think my only choice is then to <code>tell</code> as soon as the values come in and use <code>hoistEither</code> to prevent the rest of the computation for continuing:</p>\n\n<pre><code>testM :: MyExcept Int\ntestM = do\n    (ex,w1) &lt;- liftIO . runMyExcept $ eitherCatch ioTell\n    (ey,w2) &lt;- liftIO . runMyExcept $ eitherCatch ioTell\n    tell $ w1 ++ w2\n    x &lt;- hoistEither ex\n    y &lt;- hoistEither ey\n    tell [\"Combined value is \" ++ show (x + y)]\n    return (x + y)\n</code></pre>\n\n<p>Then <code>hoistEither ex</code> could be moved above the subsequent call to <code>ioTell</code> preventing it from executing, or moved further down to allow both to happen.</p>\n\n<p>Finall, if I specialise <code>ioTell</code> to <code>ioTell :: MyExcept Int</code> and use <code>left</code> instead of <code>throwM</code> then all of this works fine. I don't have to worry about an unchecked exception and the <code>WriterT</code> gets preserved. Which is fine for this toy example where the exception was manually generated. But what about in general?</p>\n"}, {"tags": ["json", "haskell", "aeson"], "comments": [{"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "edited": false, "score": 0, "creation_date": 1429413205, "post_id": 29725253, "comment_id": 47584952, "body": "I asked a very similar question and the answer is, no you don&#39;t need to make a type for every level of your return value. See the excellent answer I got here: <a href=\"http://stackoverflow.com/questions/28923006/isolate-a-single-value-from-a-nested-json-response-in-aeson/28927083\" title=\"isolate a single value from a nested json response in aeson\">stackoverflow.com/questions/28923006/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1429418000, "post_id": 29725725, "comment_id": 47585741, "body": "hi zudov, in the last code snippet of yours - FromJSON - what does <code>&gt;&gt;=</code> do? i know .: is to construct a key-value pair. but why do you use another operator <code>&gt;&gt;=</code> before <code>.:</code> operator?"}, {"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 1, "creation_date": 1429431241, "post_id": 29725725, "comment_id": 47588667, "body": "<code>.:</code> doesn&#39;t construct key-value pair. It actually takes an object (key-value map) and a key, returning a <code>Parser a</code> where <code>a</code> is a type of whatever value is under the key. <code>&gt;&gt;=</code> is a monadic bind, and in this case it allows us to &#39;bind&#39; multiple parsers in a chain, where each consequent parser is applied to result of the previous one. So that <code>(o .: &quot;a&quot;) &gt;&gt;= (.: &quot;b&quot;)</code> would extract a value under a key &quot;a&quot; (this value turns out to be an object) and would pass that value to <code>(.: &quot;b&quot;)</code> (which would extract a value under the key &quot;b&quot;. And so on."}], "tags": [], "owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "is_accepted": true, "score": 6, "last_activity_date": 1429417093, "creation_date": 1429417093, "answer_id": 29725725, "question_id": 29725253, "link": "https://stackoverflow.com/questions/29725253/pythons-json-dumps-or-loads-in-haskell-aeson/29725725#29725725", "title": "Python&#39;s json.dumps (or) loads in haskell-aeson?", "body": "<blockquote>\n  <p>Why does the author create <code>ToJSON</code>/<code>FromJSON</code> instances with just one method? Can't <code>toJSON</code>/<code>parseJSON</code> be written as a function on its own?</p>\n</blockquote>\n\n<p>You misunderstand a lot of things, so let me clear this up a little. <code>ToJSON</code> and <code>FromJSON</code> aren't functions. These are <em>typeclasses</em>. Typeclasses are a way to write polymorphic code in Haskell.</p>\n\n<p>Here I would explain a very simplified and incomplete definition of json serialization. First of all we declare a typeclass:</p>\n\n<pre><code>class ToJSON a where\n    toJSON :: a -&gt; String\n</code></pre>\n\n<p>This statement basically says: \"If <code>a</code> is an instance of typeclass <code>ToJSON</code>, then we can use function <code>toJSON</code> to serialize <code>a</code> into a JSON string\".</p>\n\n<p>When a typeclass is defined, one can implement <em>instances</em> of it for a variety of simple types:</p>\n\n<pre><code>instance ToJSON String where\n    toJSON s = s\n\ninstance ToJSON Int where\n    toJSON n = show n\n\ninstance ToJSON Double where\n    toJSON n = show n\n</code></pre>\n\n<p>After you defined these simple implementation, you can apply <code>toJSON</code> to values of either <code>String</code>, <code>Int</code> or <code>Double</code> and it would get dispatched to a right implementation:</p>\n\n<pre><code>toJSON \"hello\"         -----&gt; \"hello\"\ntoJSON (5 :: Int)      -----&gt; \"5\"\ntoJSON (5.5 :: Double) -----&gt; \"5.5\"\n</code></pre>\n\n<p>To go further we need a way to encode JSON collections. Let's start with lists. We want to express that if there is a value <code>a</code> that can be serialized into JSON, then a list of such values can also be serialized into JSON.</p>\n\n<pre><code>--        ,-- value 'a' can be serialized into JSON    \n--       ,--------,    \ninstance (ToJSON a) =&gt; ToJSON [a] where\n--                     ``````````-- A list of such values can also be serialized    \n    -- | Here is how serialization can be performed\n    toJSON as = \"[\" ++ (intercalate \", \" $ map toJSON as) ++ \"]\"\n</code></pre>\n\n<p>We serialize each value in the list, separate them with \", \" and enclose in brackets. Note that recursive call to <code>toJSON</code> gets dispatched to the correct implementation.</p>\n\n<p>Now we can use <code>toJSON</code> on lists:</p>\n\n<pre><code>toJSON [1,2,3,4] -----&gt; \"[1, 2, 3, 4]\"\n</code></pre>\n\n<p>You can go further and try to implement the whole JSON syntax. Your next step here might be maps. I'll leave it as an exercise.</p>\n\n<p>My point was to explain that when you write <code>instance ToJSON Coord ...</code> you simply provide a way to serialize <code>Coord</code> into JSON. And this gives you an ability to serialize lists of <code>Coords</code>, maps with <code>Coords</code> and many other things. This wouldn't be possible without typeclasses.</p>\n\n<hr>\n\n<blockquote>\n  <p>In Python, one just does json.loads/json.dumps to handle any kind of object/json-string. Why does the haskell user need to write all these extra code for every object that he seralizes?</p>\n</blockquote>\n\n<p>An important point is that Python's <code>json.loads</code> wouldn't deserialize json into your object. It would deserialize it into a built in structure that might be equivalent to your object. You can do the same thing in Haskell by using template haskell which would declare <code>ToJSON</code>/<code>FromJSON</code> instances for you. Alternatively you can just dump the JSON into a key value Map and operate on it.</p>\n\n<p>However, writing that extra code (or automatically generating it) gives you a lot of benefits which can be summarized with words \"type safety\".</p>\n\n<hr>\n\n<blockquote>\n  <p>For composite objects with multiple hierarchies like ..., do we need to create multiple data and instance at each level?</p>\n</blockquote>\n\n<p>No you don't. In case of a structure that you linked the instances that would transform a number into such a structure or vice-versa would look approximately like this:</p>\n\n<pre><code>-- | Just a wrapper for the number which must be stored in a nested structure\nnewtype NestedStructure = NestedStructure Int\n\ninstance ToJSON NestedStructure where\n    toJSON (NestedStructure n) =\n        object [\"a\" .= object [\"b\" .= object [\"c\" .= n]]]\n\ninstance FromJSON NestedStructure where\n    fromJSON (Object o) = NestedStructure &lt;$&gt; ((o .: \"a\") &gt;&gt;= (.: \"b\")\n                                                          &gt;&gt;= (.: \"c\"))\n    fromJSON _ = mzero\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 0, "last_activity_date": 1429445855, "last_edit_date": 1429445855, "creation_date": 1429435458, "answer_id": 29728044, "question_id": 29725253, "link": "https://stackoverflow.com/questions/29725253/pythons-json-dumps-or-loads-in-haskell-aeson/29728044#29728044", "title": "Python&#39;s json.dumps (or) loads in haskell-aeson?", "body": "<blockquote>\n  <p>In Python, one just does json.loads/json.dumps to handle any kind of\n  object/json-string. Why does the haskell user need to write all these\n  extra code for every object that he seralizes?</p>\n</blockquote>\n\n<p>One way to avoid this is to use the <a href=\"https://ocharles.org.uk/blog/guest-posts/2014-12-15-deriving.html\" rel=\"nofollow\">deriving</a> mechanism in combination with <a href=\"https://ocharles.org.uk/blog/guest-posts/2014-12-15-deriving.html\" rel=\"nofollow\">GHC.Generics</a>.</p>\n\n<p>The \"deriving\" mechanism automatically generates typeclass instances for you, avoiding boilerplate. For example:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n\nimport GHC.Generics\n\ndata VDPServer = VDPServer \n    { vdpHost :: String\n    , vdpPort :: Int\n    , vdpLogin :: String\n    , vdpPassword :: String\n    , vdpDatabase :: String \n    }\n    deriving Generic\n\ninstance FromJSON VDPServer\n\ninstance ToJSON VDPServer\n</code></pre>\n\n<p>This is descrived in the <a href=\"http://hackage.haskell.org/package/aeson-0.8.0.2/docs/Data-Aeson.html#g:11\" rel=\"nofollow\">Type Conversion</a> section of the documentation.</p>\n\n<p>You can customize how the instances are generated using the <a href=\"http://hackage.haskell.org/package/aeson-0.8.0.2/docs/Data-Aeson-Types.html#t:Options\" rel=\"nofollow\">Options</a> type:</p>\n\n<pre><code>aesonOptions :: Options\naesonOptions = defaultOptions \n    { sumEncoding = ObjectWithSingleField \n    , fieldLabelModifier = tail\n    , omitNothingFields = True\n    }\n\ninstance FromJSON VDPServer where\n    parseJSON = genericParseJSON aesonOptions\n\ninstance ToJSON VDPServer where\n    toJSON = genericToJSON aesonOptions\n</code></pre>\n\n<p>Sometimes, when dealing with complex preexisting JSON schemas, this approach doesn't work so well and one has to fall back to manually defining the parser. But for simpler cases it avoids you a lot of boilerplate.</p>\n\n<blockquote>\n  <p>do we need to create multiple data and instance at each level?</p>\n</blockquote>\n\n<p>All of the record fields must have their own <code>FromJSON</code>/<code>ToJSON</code> instances. Many common types (tuples, lists, maps, strings...) already have such instances, see the instance list for <a href=\"http://hackage.haskell.org/package/aeson-0.8.0.2/docs/Data-Aeson.html#t:FromJSON\" rel=\"nofollow\">FromJSON</a> in the documentation. But if not, you'll have to define them (maybe using the <code>Generic</code> trick again).</p>\n\n<blockquote>\n  <p>In Python, one just does json.loads/json.dumps to handle any kind of\n  object/json-string. Why does the haskell user need to write all these\n  extra code for every object that he seralizes?</p>\n</blockquote>\n\n<p>The Haskell equivalent of deserializing a JSON file into a composite of maps, lists, and privitive types is to read a <a href=\"http://hackage.haskell.org/package/aeson-0.8.0.2/docs/Data-Aeson.html#t:Value\" rel=\"nofollow\">Value</a> object. This way one doesn't have to define a new record.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 1, "accepted_answer_id": 29725725, "answer_count": 2, "score": 1, "last_activity_date": 1429445855, "creation_date": 1429411904, "last_edit_date": 1429413141, "question_id": 29725253, "link": "https://stackoverflow.com/questions/29725253/pythons-json-dumps-or-loads-in-haskell-aeson", "title": "Python&#39;s json.dumps (or) loads in haskell-aeson?", "body": "<p>In <a href=\"https://github.com/bos/aeson/blob/master/examples/Simplest.hs#L7\" rel=\"nofollow\">Aeson library</a> meant for object serializing/deserializing, I see the functions, <code>FromJSON</code> &amp; <code>ToJSON</code> declared as instances. The code is,</p>\n\n<pre><code>data Coord = Coord { x :: Double, y :: Double }\n         deriving (Show)\ninstance ToJSON Coord where\ntoJSON (Coord xV yV) = object [ \"x\" .= xV,\n                              \"y\" .= yV ]\n</code></pre>\n\n<p>My questions are,</p>\n\n<ul>\n<li>Why does the author create <code>ToJSON/FromJSON</code>  instances with just one method? Can't <code>toJSON</code>/<code>parseJSON</code> be written as a function on its own?</li>\n<li>In Python, one just does <code>json.loads/json.dumps</code> to handle any kind of object/json-string. Why does the haskell user need to write all these extra code for every object that he seralizes?</li>\n<li>For composite objects with multiple hierarchies like </li>\n</ul>\n\n<p><code>{\"a\":\n    {\"b\":\n        {\n          \"c\":1\n         }\n    }\n}</code>\n, do we need to create multiple <code>data</code> and <code>instance</code> at each level?</p>\n"}, {"tags": ["haskell", "logging", "io", "monads"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1429409300, "post_id": 29724500, "comment_id": 47584249, "body": "That example uses <code>unsafePerformIO</code> to create some global <code>IORef</code>s.  I cannot tell by looking why they are needed.  Do you even need global state? If not there shouldn&#39;t be a problem..."}, {"owner": {"reputation": 668, "user_id": 2155544, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/caae6ef08bc308aaa3c34324286bad6d?s=128&d=identicon&r=PG", "display_name": "Michael restore Monica Cellio", "link": "https://stackoverflow.com/users/2155544/michael-restore-monica-cellio"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1429410442, "post_id": 29724500, "comment_id": 47584447, "body": "No;  I don&#39;t need global state (I think).  I just want (1) to send an email and (2) log the fact that an email was sent."}], "owner": {"reputation": 668, "user_id": 2155544, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/caae6ef08bc308aaa3c34324286bad6d?s=128&d=identicon&r=PG", "display_name": "Michael restore Monica Cellio", "link": "https://stackoverflow.com/users/2155544/michael-restore-monica-cellio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 204, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1429409200, "creation_date": 1429403829, "question_id": 29724500, "link": "https://stackoverflow.com/questions/29724500/haskell-io-inside-a-monadlogger-context", "title": "Haskell: IO() inside a MonadLogger context", "body": "<p>I want to implement actual email verification inside a Yesod application.  I'm horrified that the only example I can find -- <a href=\"http://hdiff.luite.com/cgit/yesod-auth-account/tree/tests/Foundation.hs?id=1.2.0\" rel=\"nofollow\">http://hdiff.luite.com/cgit/yesod-auth-account/tree/tests/Foundation.hs?id=1.2.0</a> -- uses unsafePerformIO.  Surely not ?  Here's my (uncompilable) code.  Is there a polite way to correct it?</p>\n\n<pre><code>module EmailVerification() where\n\n\nimport qualified Yesod.Core as YC\nimport qualified Yesod.Auth as YA\nimport qualified Yesod.Auth.Account as YAA\nimport qualified Foundation\nimport qualified Network.Mail.SMTP as SMTP\nimport qualified Network.Mail.Mime as Mime\nimport qualified Logging\nimport qualified Control.Monad.Logger as CML\n\n\ninstance YAA.AccountSendEmail Foundation.JRState where\n    sendVerifyEmail uname email url = YC.getYesod &gt;&gt;= newAccountEmail uname email url\n    sendNewPasswordEmail uname email url = YC.getYesod &gt;&gt;= resetAccountEmail uname email url\n\n\nnewAccountEmail, resetAccountEmail :: YC.MonadLogger m =&gt; Foundation.TextItem -&gt; Foundation.TextItem -&gt; Foundation.TextItem -&gt; Foundation.JRState -&gt; m ()\nnewAccountEmail uname email url state = do\n    SMTP.sendMail \"localhost\" (makeEmail uname email url) -- barf\n    logAccountEmail uname email url \"Verification\"\n\n\nresetAccountEmail uname email url state = do\n    SMTP.sendMail \"localhost\" (makeEmail uname email url)  -- also barf\n    logAccountEmail uname email url \"Reset password\"\n\n\nlogAccountEmail :: YC.MonadLogger m =&gt; Foundation.TextItem -&gt; Foundation.TextItem -&gt; Foundation.TextItem -&gt; String -&gt; m ()\nlogAccountEmail uname email url action =\n    Logging.logInfo $ Foundation.concat [ Foundation.pack action, Foundation.pack \" email for \", uname, Foundation.pack \" (\", email, Foundation.pack \"): \", url ]\n\n\nmakeEmail uname email url =\n    Mime.Mail\n        Mime.Address Nothing Foundation.nullText\n        [ Mime.Address (Just uname) email ]\n        [ ]\n        [ ]\n        [ ( Foundation.pack \"Subject\", Foundation.pack \"JackRose Account\" ) ]\n        [ [ Foundation.concat [ Foundation.pack \"Your URL is \", url ] ] ]\n</code></pre>\n"}, {"tags": ["haskell", "web-applications", "haskell-wai"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1429399841, "post_id": 29723813, "comment_id": 47582371, "body": "<code>Application</code> is just <code>Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived</code>. Which means in <code>app request respond = ..</code> you can perform the IO action which produces a bytestring, then pass that bytestring to pure functions in the rest of your code. Change <code>respond $ myData (getUserInfo (requestBody request))</code> to something like <code>do {x &lt;- requestBody request; respond $ myData (getUserInfo x)}</code>; and change the type of <code>myData</code> to <code>Map.Map String String -&gt; Response</code>"}], "answers": [{"comments": [{"owner": {"reputation": 2885, "user_id": 1360368, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7997d33ca6f47d0e48080d6f58a72443?s=128&d=identicon&r=PG", "display_name": "Ashesh", "link": "https://stackoverflow.com/users/1360368/ashesh"}, "edited": false, "score": 0, "creation_date": 1593528787, "post_id": 29728771, "comment_id": 110810043, "body": "<code>requestBody</code> has since been deprecated in favour of a more accurate name: <code>getRequestBodyChunk</code>; since this is what <code>requestBody</code> has been doing all along: return a <i>chunk</i> of the request body, not the whole thing. As such, I don&#39;t think the solution you&#39;ve posted here will work."}], "tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": true, "score": 2, "last_activity_date": 1429440346, "creation_date": 1429440346, "answer_id": 29728771, "question_id": 29723813, "link": "https://stackoverflow.com/questions/29723813/using-request-parameters-in-wai-without-io-causing-problems/29728771#29728771", "title": "Using Request Parameters in WAI Without &quot;IO&quot; Causing Problems", "body": "<p>Since <code>requestBody</code> has the following type:</p>\n\n<pre><code>requestBody :: Request -&gt; IO ByteString\n</code></pre>\n\n<p>the resulting expression can't be directly passed to <code>getUserInfo</code>, which accepts a <code>ByteString</code>. </p>\n\n<p>What you can do is, given that <code>Application</code> is simply <code>Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived</code> and in <code>app</code> you are in the <code>IO</code> monad, extract the <code>ByteString</code> with the <code>do</code> notation like this:</p>\n\n<pre><code>str &lt;- requestBody request \n</code></pre>\n\n<p>and then pass <code>str</code> to <code>getUserInfo</code>, like this:</p>\n\n<pre><code>app :: Application\napp request respond = do\n  str &lt;- requestBody request\n  case rawPathInfo request of\n    \"/\"            -&gt; respond index\n    \"/api/my-data\" -&gt; respond $ myData (getUserInfo str)\n    _              -&gt; respond notFound\n</code></pre>\n\n<p>at this point <code>myData</code> can simply accept a <code>Map</code>:</p>\n\n<pre><code>myData :: Map.Map String String -&gt; Response\n</code></pre>\n\n<p>You should definitely read more about monads and IO in general before going any deeper with WAI though.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3594595"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "accepted_answer_id": 29728771, "answer_count": 1, "score": 3, "last_activity_date": 1429440346, "creation_date": 1429397577, "last_edit_date": 1429438901, "question_id": 29723813, "link": "https://stackoverflow.com/questions/29723813/using-request-parameters-in-wai-without-io-causing-problems", "title": "Using Request Parameters in WAI Without &quot;IO&quot; Causing Problems", "body": "<p>I'm struggling with the basics of getting an API up and running using WAI. The main issue is dealing with <code>IO</code> infecting everything. I believe that my problems will dissolve once I better understand Monads, but hopefully an answer to this question will be a good starting point.</p>\n\n<p>The following is a short example that serves a static html page on the root url, and accepts a request with a username to <code>/api/my-data</code> that should return the corresponding user's data. I can't figure out how to use the <code>IO Bytestring</code> that is the request's <code>body</code> to do a map lookup, retrieve the data, and send the result back encoded in json.</p>\n\n<p>I've tried using <code>fmap</code> to extract the <code>Bytestring</code> and then <code>unpack</code> to turn it into a string for lookup, but whatever I do, I end up chasing type errors related to the damn <code>IO</code> monad. </p>\n\n<p>Anyway, here is the relevant code: </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport qualified Data.ByteString as B\nimport qualified Data.ByteString.Char8 as B8\nimport qualified Data.Map as Map\nimport Data.Aeson\nimport Network.Wai\nimport Network.Wai.Parse\nimport Network.Wai.Middleware.Static\nimport Network.HTTP.Types\nimport Network.Wai.Handler.Warp (run)\n\nuserInfo :: Map.Map String (Map.Map String String)\nuserInfo = Map.fromList [(\"jsmith\", Map.fromList [(\"firstName\", \"John\"),\n                                                  (\"lastName\", \"Smith\"),\n                                                  (\"email\", \"jsmith@gmail.com\"),\n                                                  (\"password\", \"Testing012\")]),\n                         (\"jeff.walker\", Map.fromList [(\"firstName\", \"Jeff\"),\n                                                       (\"lastName\", \"Walker\"),\n                                                       (\"email\", \"jeff.walker@gmail.com\"),\n                                                       (\"password\", \"Testing012\")])]\n\ngetUserInfo :: B.ByteString -&gt; Map.Map String String\ngetUserInfo body =\n  case Map.lookup (B8.unpack body) userInfo of\n    (Just x) -&gt; x\n    Nothing  -&gt; Map.empty\n\napp :: Application\napp request respond = do\n  case rawPathInfo request of\n    \"/\"            -&gt; respond index\n    \"/api/my-data\" -&gt; respond $ myData (getUserInfo (requestBody request))\n    _              -&gt; respond notFound\n\nindex :: Response\nindex = responseFile\n  status200\n  [(\"Content-Type\", \"text/html\")]\n  \"../client/index.html\"\n  Nothing\n\nmyData :: IO (Map.Map String String) -&gt; Response\nmyData user = responseLBS\n  status200\n  [(\"Content-Type\", \"application/json\")]\n  (encode user)\n\n\nnotFound :: Response\nnotFound = responseLBS\n  status404\n  [(\"Content-Type\", \"text/plain\")]\n  \"404 - Not Found\"\n\nmain :: IO ()\nmain = do\n  putStrLn $ \"http://localhost:8080/\"\n  run 8080 $ staticPolicy (addBase \"../client/\") $ app\n</code></pre>\n\n<p>This results in this error:</p>\n\n<pre><code>src/Core/Main.hs:32:54:\n    Couldn't match expected type \u2018B8.ByteString\u2019\n                with actual type \u2018IO B8.ByteString\u2019\n    In the first argument of \u2018getUserInfo\u2019, namely\n      \u2018(requestBody request)\u2019\n    In the first argument of \u2018myData\u2019, namely\n      \u2018(getUserInfo (requestBody request))\u2019\n</code></pre>\n\n<p>I can easily change the type of <code>getUserInfo</code> and <code>myData</code> to <code>IO Bytestring -&gt; IO (Map.Map String String)</code> and <code>IO (Map.Map String String) -&gt; Response</code> but then I end up with more type errors. Types are making my head spin.</p>\n"}, {"tags": ["haskell", "language-extension"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1429380558, "post_id": 29720851, "comment_id": 47576430, "body": "Which GHC version? Maybe you have a very old one? Also beware of using a <code>#</code> as the very first character of a line when CPP is enabled (in such cases, add a space before that)."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1429380559, "post_id": 29720851, "comment_id": 47576431, "body": "Long shot, but what version of GHC are you running?  (Run <code>ghc --version</code> in your shell to find out.)"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1429380837, "post_id": 29720851, "comment_id": 47576547, "body": "Curious. Can you show an entire file that gives this error?"}, {"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 0, "creation_date": 1429380839, "post_id": 29720851, "comment_id": 47576548, "body": "Make sure that this line is a very first line of a file"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 2, "creation_date": 1429381180, "post_id": 29720851, "comment_id": 47576672, "body": "<code>LANGUAGE</code> pragmas have worked since 6.8.1. I really think we need a whole file to see what&#39;s wrong."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1429381322, "post_id": 29720851, "comment_id": 47576720, "body": "Notice 7.8.3 is not &quot;100% up-to-date&quot;.  There&#39;s 7.8.4 and 7.10.1.  Not that any of these versions has issues with LANGUAGE pragma - it sounds like you have a typo in the pragma or other issues."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1429381353, "post_id": 29720851, "comment_id": 47576728, "body": "@&#216;rjanJohansen I searched around my project directory, but I can&#39;t seem to find the file in which I first discovered the problem, but now that zudov mentions it, I think I may have declared it <i>after</i> the module name."}, {"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 1, "creation_date": 1429381652, "post_id": 29720851, "comment_id": 47576849, "body": "@AJFarmar Hmm. That might not be it. If you put the pragma <i>after</i> <code>module</code> declaration there would be no error, but GHC would simply consider it as a comment (7.8.4)."}], "answers": [{"comments": [{"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 0, "creation_date": 1429381318, "post_id": 29720992, "comment_id": 47576719, "body": "If anyone have more guesses why the pragma might be not recognised, please add them to the list (for future generations)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 7, "creation_date": 1429381652, "post_id": 29720992, "comment_id": 47576850, "body": "The reason <code>LANGUAGE</code> extensions are often per-file is to ensure that anyone reading the file knows what extensions are in play. It&#39;s very good to know whether <code>GeneralizedNewtypeDeriving</code>, <code>OverlappingInstances</code>, <code>IncoherentInstances</code>, <code>MonoLocalBinds</code>, <code>ScopedTypeVariables</code>, <code>DataKinds</code>, and/or <code>PolyKinds</code> are in play, and these (at least) may not be entirely obvious from the rest of the source."}], "tags": [], "owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "is_accepted": true, "score": 12, "last_activity_date": 1429381694, "last_edit_date": 1429381694, "creation_date": 1429380728, "answer_id": 29720992, "question_id": 29720851, "link": "https://stackoverflow.com/questions/29720851/haskell-pragmas-options-ghc-vs-language/29720992#29720992", "title": "Haskell pragmas: OPTIONS_GHC vs LANGUAGE", "body": "<p>Using the <code>LANGUAGE</code> pragma is nicer. Instead of giving a list of arbitrary options it is specific only to language extensions.  It's also designed to be portable between implementations, as mentioned in the GHC docs; <code>LANGUAGE</code></p>\n\n<blockquote>\n  <p>\u2026allows language extensions to be enabled in a portable way. It is the intention that all Haskell compilers support the <code>LANGUAGE</code> pragma with the same syntax, although not all extensions are supported by all compilers, of course. <em>The <code>LANGUAGE</code> pragma should be used instead of <code>OPTIONS_GHC</code>, if possible.</em> [Emphasis added]</p>\n</blockquote>\n\n<p>This same language shows up in the docs all the way from <a href=\"https://downloads.haskell.org/~ghc/6.6/docs/html/users_guide/pragmas.html#language-pragma\" rel=\"noreferrer\">GHC 6.6 (\u00a77.10.4)</a>, when <code>LANGUAGE</code> was introduced, up through <a href=\"https://downloads.haskell.org/~ghc/7.10.1/docs/html/users_guide/pragmas.html#language-pragma\" rel=\"noreferrer\">GHC 7.10.1 (\u00a77.22.1)</a>, the current (at time of writing) release.</p>\n\n<p>A third way of specifying language extensions would be to declare them in the cabal file.</p>\n\n<p>I also find that it's common to use <code>LANGUAGE</code> pragma to declare used extensions for a single file, but using <code>OPTIONS_GHC</code> (on a level of single file) is usually used as a workaround (e.g. to disable some warnings). People prefer to declare GHC options project-wide (with cabal) not on individual files, whereas for some reason language extensions are often used on per-file basis.</p>\n\n<p>Here are a few wild guesses why the <code>LANGUAGE</code> pragma might not be recognised:</p>\n\n<ul>\n<li>You have an ancient GHC version (&lt; 6.6)</li>\n<li>You do not declare it as a <em>file-header</em> pragma.\nA file-header pragma must precede the <code>module</code> keyword in the file. In other words, it should be at the very top of the file (though it might be preceded by other file-header pragmas)</li>\n</ul>\n"}], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1293, "favorite_count": 2, "accepted_answer_id": 29720992, "answer_count": 1, "score": 7, "last_activity_date": 1429381694, "creation_date": 1429379957, "last_edit_date": 1429381399, "question_id": 29720851, "link": "https://stackoverflow.com/questions/29720851/haskell-pragmas-options-ghc-vs-language", "title": "Haskell pragmas: OPTIONS_GHC vs LANGUAGE", "body": "<p>I find myself using this sort of pragma a lot in my cabal projects to force GHC to build with specific options:</p>\n\n<pre><code>{-# OPTIONS_GHC -XFlexibleInstances -XRankNTypes ... #-}\n</code></pre>\n\n<p>But when I see other people using extentions, they always declare it in this way:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, RankNTypes, ... #-}\n</code></pre>\n\n<p>However, when I load files in GHCi which use the latter method, GHC always complains that I'm using an <code>unrecognised pragma</code> and promptly fails.</p>\n\n<p>Why does GHC not accept the <code>LANGUAGE</code> pragma, and which of the two is better practice?</p>\n\n<hr>\n\n<p><em>Note: my GHC version is up-to-date: 7.8.3, but was 7.6.* when this occurred.</em></p>\n"}, {"tags": ["haskell", "types", "int"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1429379451, "post_id": 29720672, "comment_id": 47575995, "body": "In order to use <code>div</code> as an infix function you must enclose it in backticks: <code>(j - n!!(k)) `div` (i - k)</code>"}, {"owner": {"reputation": 23, "user_id": 4585790, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ac4356ffab4061d7e8f4a644057faa6d?s=128&d=identicon&r=PG&f=1", "display_name": "REALLYANGRYSTUDENT", "link": "https://stackoverflow.com/users/4585790/reallyangrystudent"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1429379785, "post_id": 29720672, "comment_id": 47576114, "body": "Wow okay I fixed that, but now its saying Im dividing by zero, I will change the question accordingly"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1429396305, "post_id": 29720672, "comment_id": 47581515, "body": "You should make a new question instead of changing this one, so you don&#39;t invalidate the answer."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 4585790, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ac4356ffab4061d7e8f4a644057faa6d?s=128&d=identicon&r=PG&f=1", "display_name": "REALLYANGRYSTUDENT", "link": "https://stackoverflow.com/users/4585790/reallyangrystudent"}, "edited": false, "score": 0, "creation_date": 1429380284, "post_id": 29720827, "comment_id": 47576305, "body": "adding your type annotations makes every function fail, Im not sure why but I think most of them are because : Couldn&#39;t match expected type <code>[Int]&#39; with actual type </code>Int&#39; Couldn&#39;t match expected type <code>[a0]&#39; with actual type </code>Int&#39;  what is type [a0]"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 23, "user_id": 4585790, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ac4356ffab4061d7e8f4a644057faa6d?s=128&d=identicon&r=PG&f=1", "display_name": "REALLYANGRYSTUDENT", "link": "https://stackoverflow.com/users/4585790/reallyangrystudent"}, "edited": false, "score": 0, "creation_date": 1429380411, "post_id": 29720827, "comment_id": 47576365, "body": "@REALLYANGRYSTUDENT I changed the annotations to what I guess are the correct ones. Feel free to experiment with them and use whatever matches your intuition: if you know a parameter is a list of ints, use <code>[Int]</code> for that, and so on."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1429380328, "last_edit_date": 1429380328, "creation_date": 1429379804, "answer_id": 29720827, "question_id": 29720672, "link": "https://stackoverflow.com/questions/29720672/errordividing-by-zero-haskell/29720827#29720827", "title": "Error:Dividing by Zero (Haskell)", "body": "<p>(This answers the original question posted by the OP, before the edits.)</p>\n\n<p>This looks wrong:</p>\n\n<pre><code>(j - n!!(k)) div (i - k)  == -1 || (j - n!!(k)) div (i - k)  == 1\n</code></pre>\n\n<p>Try adding a few backticks:</p>\n\n<pre><code>(j - n!!(k)) `div` (i - k)  == -1 || (j - n!!(k)) `div` (i - k)  == 1\n</code></pre>\n\n<p>Off topic: the above can also be rewritten as</p>\n\n<pre><code>((j - n!!k) `div` (i - k)) `elem` [-1,1]\n</code></pre>\n\n<p>Back on topic: to improve the GHC error messages, try adding a few type annotations for your functions. E.g.</p>\n\n<pre><code>knightPlace :: Int -&gt; [(Int,Int)]\nknightPlace n = makeboard n \n    where \n    makeboard n = [(i + 1,j + 1) | i&lt;-[0..(length n -1 )], j&lt;-[0..(length n - 1)], colrowcheck n i j]\n\n    colrowcheck :: [Int] -&gt; Int -&gt; Int -&gt; Bool\n    colrowcheck n i j = and [(n!!(i) == 0) &amp;&amp; n!!(k) /=(j+1)| k&lt;-[0..(length n -1 )], diagcheck n i j k ] \n\n    -- diagcheck\n    diagcheck :: [Int] -&gt; Int -&gt; Int -&gt; Int -&gt; Bool\n    diagcheck n i j k = (j - n!!(k)) `div` (i - k)  == -1 || (j - n!!(k)) `div` (i - k)  == 1\n</code></pre>\n\n<p>Adding these type annotations allows GHC to detect type errors early. In your original code, the snippet</p>\n\n<pre><code>(j - n!!(k)) div (i-j) == -1\n</code></pre>\n\n<p>computes <code>j - n!!k</code> and then treats it as a function accepting two arguments, namely <code>div</code> and <code>i-j</code>. GHC infers a function type for <code>j - n!!k</code> and moves on. There are no type errors in <code>diagcheck</code>, but they will pop out as soon as you try to call <code>diagcheck</code> with lists of integers instead of a list of functions.</p>\n"}], "owner": {"reputation": 23, "user_id": 4585790, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ac4356ffab4061d7e8f4a644057faa6d?s=128&d=identicon&r=PG&f=1", "display_name": "REALLYANGRYSTUDENT", "link": "https://stackoverflow.com/users/4585790/reallyangrystudent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1429380328, "creation_date": 1429378980, "last_edit_date": 1429379933, "question_id": 29720672, "link": "https://stackoverflow.com/questions/29720672/errordividing-by-zero-haskell", "title": "Error:Dividing by Zero (Haskell)", "body": "<p>I am trying to make a program to ascertain what positions of a 8x8 chess board is safe to put a knight on if 2 queens are placed on the board.</p>\n\n<p>The input of the function is <code>[0, 0, 6, 0, 0, 4, 0, 0]</code>, so it is called like <code>knightPlace [0, 0, 6, 0, 0, 4, 0, 0]</code>. All nonzeros are queens.</p>\n\n<p>As you can see, the 3rd and 6th element of the list is 6 and 4, which results in queens being at the 3rd column and 6th row and 6th column and 4th row (assuming you start at 0,0 at the bottom left corner of the chess board).</p>\n\n<p>My col and row check were filtering fine but my diagCheck brought a new error msg: </p>\n\n<pre><code>knightPlace[0, 0, 6, 0, 0, 4, 0, 0]\n*** Exception: divide by zero\n</code></pre>\n\n<p>Can someone please help me out? It should never be 0 because the diagCheck solves for the slope of a queen and another coord, making it false and therefore not added if the slope is == 1 or -1</p>\n\n<p>Here is the code I use:</p>\n\n<pre><code>knightPlace n = makeboard n \n    where \n    makeboard n = [(i + 1,j + 1) | i&lt;-[0..(length n -1 )], j&lt;-[0..(length n - 1)], colrowcheck n i j]\n    -- col and row check, if the condition ==FALSE it doesnt get added \n    colrowcheck n i j = and [(n!!(i) == 0) &amp;&amp; n!!(k) /=(j+1)| k&lt;-[0..(length n -1 )], not(diagcheck n i j k) ] \n\n    -- diagcheck\n    diagcheck n i j k = ((j+1) - n!!(k)) `div` ((i+ 1) - k)  == -1 || ((j+1) - n!!(k)) `div` ((i+1) - k)  == 1\n</code></pre>\n"}, {"tags": ["performance", "haskell"], "comments": [{"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1429370786, "post_id": 29719142, "comment_id": 47572960, "body": "Some time ago I&#39;ve seen an example where using prim-ops on <code>Int#</code> instead of <code>Int</code> was used to eliminate a bottleneck. Otherwise, I don&#39;t think you should care, especially with <code>UNPACK</code>/<code>-funbox-strict-fields</code>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1429370891, "post_id": 29719142, "comment_id": 47573004, "body": "If you need to use primops it&#39;s probably from having to heavily optimize a routine to an excessive point.  The vast majority of people never run into these issues in any language, Haskell included."}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1429370076, "creation_date": 1429370076, "question_id": 29719142, "link": "https://stackoverflow.com/questions/29719142/do-i-need-to-worry-about-packed-primops-in-ghc", "title": "Do I need to worry about packed primops in GHC?", "body": "<p>There is an additional (internal) layer in GHC which just wraps the primitive known to meet the <code>Int</code> abstraction requirements.</p>\n\n<pre><code>data {-# CTYPE \"HsInt\" #-} Int = I# Int#\n</code></pre>\n\n<p>As a GHC user, am I ever expected to make use of it other than understanding that STG will generate code like <code>-# 1#</code>?</p>\n\n<p>Are there any known cases where GHC generates code doing the wrapping? If so, why?</p>\n"}, {"tags": ["debugging", "haskell"], "comments": [{"owner": {"reputation": 976, "user_id": 1274282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nBRxs.png?s=128&g=1", "display_name": "Taylor Fausak", "link": "https://stackoverflow.com/users/1274282/taylor-fausak"}, "edited": false, "score": 1, "creation_date": 1429372445, "post_id": 29718990, "comment_id": 47573596, "body": "The wiki page on debugging might have an answer for you: <a href=\"https://wiki.haskell.org/Debugging\" rel=\"nofollow noreferrer\">wiki.haskell.org/Debugging</a>"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1429378228, "post_id": 29718990, "comment_id": 47575545, "body": "Haskell errors usually tell all tales. I&#39;ve never ever found a Haskell error that can&#39;t be solved using only the error message. The actual error is saying that a value of <code>Left something</code> was given, so it must fail. I&#39;ve posted my response on github."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1429462366, "post_id": 29732764, "comment_id": 47598879, "body": "Arbus, How did you run this? i did <code>runhaskell file.hs</code> and it printed <code>Prelude.head: empty list st.hs: error on main at head </code>... did you use ghc or runhaskell?"}, {"owner": {"reputation": 304, "user_id": 2106446, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f491e7a9639e216e8310904f7d4869d?s=128&d=identicon&r=PG", "display_name": "Arbus", "link": "https://stackoverflow.com/users/2106446/arbus"}, "edited": false, "score": 0, "creation_date": 1429463029, "post_id": 29732764, "comment_id": 47599169, "body": "ah sorry, forgot to mention that you have to compile this like so: <code>ghc -prof -fprof-auto StackTrace.hs</code>, edited the answer now"}], "tags": [], "owner": {"reputation": 304, "user_id": 2106446, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f491e7a9639e216e8310904f7d4869d?s=128&d=identicon&r=PG", "display_name": "Arbus", "link": "https://stackoverflow.com/users/2106446/arbus"}, "is_accepted": true, "score": 3, "last_activity_date": 1429463079, "last_edit_date": 1429463079, "creation_date": 1429461942, "answer_id": 29732764, "question_id": 29718990, "link": "https://stackoverflow.com/questions/29718990/javas-e-printstacktrace-equivalent-in-haskell/29732764#29732764", "title": "java&#39;s e.printStackTrace equivalent in haskell", "body": "<p>You can get stack traces in Haskell but it is not as convenient as just <code>e.printStackTrace()</code>. Here is a minimal example:</p>\n\n<pre><code>import Control.Exception\nimport Debug.Trace\n\ngetStack :: String -&gt; SomeException -&gt; IO a\ngetStack msg e = traceStack (show e) $ error msg\n\nmain :: IO ()\nmain = do\n    (head []) `catch` (getStack \"error on main at head\")\n</code></pre>\n\n<p>Finally, compile it with <code>ghc -prof -fprof-auto StackTrace.hs</code> and it will produce</p>\n\n<pre><code>Prelude.head: empty list              \nStack trace:                          \n  Main.getStack (StackTrace.hs:5:9-56)     \n  Main.main (StackTrace.hs:(8,9)-(9,74))   \n  GHC.List.CAF (&lt;entire-module&gt;)      \nStackTrace.exe: error on main at head\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 29732764, "answer_count": 1, "score": 3, "last_activity_date": 1429463079, "creation_date": 1429369240, "last_edit_date": 1429371486, "question_id": 29718990, "link": "https://stackoverflow.com/questions/29718990/javas-e-printstacktrace-equivalent-in-haskell", "title": "java&#39;s e.printStackTrace equivalent in haskell", "body": "<p>I am trying out haskell's kafka library from git and got this <a href=\"https://github.com/tcrayford/hafka/issues/2\" rel=\"nofollow\">error</a>. \nTo debug this error, i like to print stacktrace at the error line.</p>\n\n<p>In python world, it is just,</p>\n\n<pre><code>import traceback; print traceback.print_exc()\n</code></pre>\n\n<p>(or) in java, it is </p>\n\n<pre><code>e.printStackTrace()\n</code></pre>\n\n<p>So, how to do the same in haskell world?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1429364710, "post_id": 29718123, "comment_id": 47570741, "body": "When do you see <code>runhaskell</code> creating entries under <code>&#47;opt&#47;ghc&#47;7.8.4&#47;lib</code> ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1429364730, "post_id": 29718123, "comment_id": 47570746, "body": "sorry folks, i saw in this link <a href=\"http://bob.ippoli.to/archives/2013/01/11/getting-started-with-haskell/\" rel=\"nofollow noreferrer\">bob.ippoli.to/archives/2013/01/11/getting-started-with-haske&zwnj;&#8203;ll</a>, two commands being used... runhaskell Setup.hs configure &amp;&amp; runhaskell Setup.hs build... that put me in a soup..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1429364798, "post_id": 29718123, "comment_id": 47570769, "body": "i see entries in /opt/ghc/7.8.4 when i gave the wrong cmd - <code>runhaskell Setup.hs install</code>... now i am clear, i can&#39;t use install with <code>runhaskell</code>"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1429365149, "post_id": 29718123, "comment_id": 47570913, "body": "It&#39;s highly likely that it&#39;s command line arguments being passed. See the source here: <a href=\"https://downloads.haskell.org/~ghc/7.0.2/docs/html/libraries/Cabal-1.10.1.0/src/Distribution-Simple.html#defaultMain\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/7.0.2/docs/html/libraries/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 6, "last_activity_date": 1429382643, "last_edit_date": 1429382643, "creation_date": 1429364453, "answer_id": 29718157, "question_id": 29718123, "link": "https://stackoverflow.com/questions/29718123/cabal-vs-runhaskell-when-to-use/29718157#29718157", "title": "Cabal Vs runhaskell, when to use?", "body": "<p><code>cabal</code> and <code>runhaskell</code> serve entirely different purpose.\n        <code>runhaskell</code> is used for executing Haskell programs without\n        having the need to compile them. You can place this on the top of an Haskell file: <code>#!/usr/bin/env runhaskell</code> and give it the scripting ability. The <code>cabal</code> is a package manager and a build system\n        for Haskell.</p>\n\n<p>Also <code>cabal</code> and <code>runhaskell</code> don't share their sub-commands like\n     <code>configure</code>, <code>build</code>, <code>install</code> etc.</p>\n\n<hr>\n\n<blockquote>\n  <p>i saw in this link bob.ippoli.to/archives/2013/01/11/getting-started-with-haskell, two commands being used... runhaskell Setup.hs configure &amp;&amp; runhaskell Setup.hs build</p>\n</blockquote>\n\n<p>Usually <code>Setup.hs</code> has the following code when generated from <code>cabal init</code>:</p>\n\n<pre><code>import Distribution.Simple\nmain = defaultMain\n</code></pre>\n\n<p>Now if you see the implementation of <a href=\"https://downloads.haskell.org/~ghc/7.0.2/docs/html/libraries/Cabal-1.10.1.0/src/Distribution-Simple.html#defaultMain\" rel=\"nofollow\">defaultMain</a>:</p>\n\n<pre><code>defaultMain :: IO ()\ndefaultMain = getArgs &gt;&gt;= defaultMainHelper simpleUserHooks\n</code></pre>\n\n<p>So what you are passing is actually command line arguments which can be anything. In fact you can test that yourself:</p>\n\n<pre><code>$ runhaskell Setup.hs invalid_argument\nunrecognised command: invalid_argument (try --help)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12035, "user_id": 603094, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/325af9a946cb4337c6640f0e95044be1?s=128&d=identicon&r=PG", "display_name": "kirelagin", "link": "https://stackoverflow.com/users/603094/kirelagin"}, "is_accepted": false, "score": 2, "last_activity_date": 1429364479, "creation_date": 1429364479, "answer_id": 29718161, "question_id": 29718123, "link": "https://stackoverflow.com/questions/29718123/cabal-vs-runhaskell-when-to-use/29718161#29718161", "title": "Cabal Vs runhaskell, when to use?", "body": "<p><code>runhaskell</code> doesn\u2019t have any subcommands:</p>\n\n<blockquote>\n  <p>$ runhaskell --help<br>\n  Usage: runghc [runghc flags] [GHC flags] module [program args]</p>\n</blockquote>\n\n<p>It takes a path to a Haskell source file and executes it right away. So you should use it when all you want is to run some Haskell code you have. Of course, you can use <code>runhaskell</code> without superuser access; I doubt it creates anything in <code>/opt</code>.</p>\n\n<p>Cabal is a build-system for Haskell projects, its purpose is transforming Haskell sources into binaries.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1086, "favorite_count": 1, "accepted_answer_id": 29718157, "answer_count": 2, "score": 4, "last_activity_date": 1513698106, "creation_date": 1429364199, "last_edit_date": 1429368464, "question_id": 29718123, "link": "https://stackoverflow.com/questions/29718123/cabal-vs-runhaskell-when-to-use", "title": "Cabal Vs runhaskell, when to use?", "body": "<p>In haskell build system, <code>Cabal</code> as well as <code>runhaskell</code> has got almost same set of sub-commands, <code>configure</code>, <code>build</code>. For runhaskell, it is:</p>\n\n<pre><code>runhaskell Setup.hs configure\nrunhaskell Setup.hs build\n</code></pre>\n\n<p>...whereas for cabal it is:</p>\n\n<pre><code>cabal build\ncabal configure\n</code></pre>\n\n<p>So, when should I use which command? Do both the commands have same functionality?</p>\n\n<p>Can I run <code>runhaskell</code> without sudo access, because I see <code>runhaskell</code> makes entries inside <code>/opt/ghc/7.8.4/lib</code> whereas cabal works in sudo/non-sudo mode?</p>\n"}, {"tags": ["haskell", "ffi"], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1429367403, "post_id": 29718599, "comment_id": 47571721, "body": "And 7.10.1 gives a better error message: &quot;Unacceptable argument type in foreign declaration:       \u2018CSize\u2019 cannot be marshalled in a foreign call         because its data construtor is not in scope         Possible fix: import the data constructor to bring it into scope&quot;"}], "tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 8, "last_activity_date": 1429367104, "creation_date": 1429367104, "answer_id": 29718599, "question_id": 29717579, "link": "https://stackoverflow.com/questions/29717579/ffi-how-to-declare-size-t/29718599#29718599", "title": "FFI: How to declare `size_t`", "body": "<p>The problem is that you imported <code>CSize</code> as an abstract type. The FFI allows newtype-wrapped versions of types such as <code>Word64</code>, but only if it can actually see the contained types.</p>\n\n<p>In your case, changing the appropriate import line to</p>\n\n<pre><code>import Foreign.C.Types (CSize(..))\n</code></pre>\n\n<p>should do the trick.</p>\n"}], "owner": {"reputation": 263, "user_id": 361709, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/aea0c5d16015d9d6d91ebc5b5abe9bc3?s=128&d=identicon&r=PG", "display_name": "esato1981", "link": "https://stackoverflow.com/users/361709/esato1981"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 397, "favorite_count": 0, "accepted_answer_id": 29718599, "answer_count": 1, "score": 7, "last_activity_date": 1429367104, "creation_date": 1429361405, "last_edit_date": 1429362208, "question_id": 29717579, "link": "https://stackoverflow.com/questions/29717579/ffi-how-to-declare-size-t", "title": "FFI: How to declare `size_t`", "body": "<p>I am trying to compile an example from Real World Haskell (chapter 26):</p>\n\n<p>There is a <code>C</code> function I want to call using <code>FFI</code>:</p>\n\n<pre><code>#include &lt;stdint.h&gt;\n#include &lt;sys/types.h&gt;\n\n/* only accepts uint32_t aligned arrays of uint32_t */\nvoid hashword2(const uint32_t *key,  /* array of uint32_t */\n           size_t length,        /* number of uint32_t values */\n           uint32_t *pc,         /* in: seed1, out: hash1 */\n           uint32_t *pb);        /* in: seed2, out: hash2 */\n</code></pre>\n\n<p>Here's the haskell code that tries to import it:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns, ForeignFunctionInterface #-}\nimport Data.Word (Word32, Word64)\nimport Foreign.C.Types (CSize)\nimport Foreign.Marshal.Utils (with)\nimport Foreign.Ptr (Ptr, castPtr, plusPtr)\nimport Foreign.Storable (Storable, peek, sizeOf)\n\nforeign import ccall unsafe \"lookup3.h hashword2\" hashWord2\n    :: Ptr Word32 -&gt; CSize -&gt; Ptr Word32 -&gt; Ptr Word32 -&gt; IO ()\n</code></pre>\n\n<p>When I try to compile it <code>ghc</code> gives the following error message:</p>\n\n<pre><code>Unacceptable argument type in foreign declaration: CSize\nWhen checking declaration:\n  foreign import ccall unsafe \"static lookup3.h hashword2\" hashWord2\n    :: Ptr Word32 -&gt; CSize -&gt; Ptr Word32 -&gt; Ptr Word32 -&gt; IO ()\n</code></pre>\n\n<p>What type should I use to marshal a <code>size_t</code>? If I replace <code>CSize</code> and use <code>Word64</code> instead it will compile, but <code>Word64</code> is not portable, right?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1429360091, "post_id": 29717327, "comment_id": 47569111, "body": "<code>If</code> you want to find out the type, <code>then</code> load your code into GHCi!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1429360253, "post_id": 29717327, "comment_id": 47569165, "body": "what worked during compilation using ghc, didn&#39;t work with GHCi.. the code i am discussing is @ <a href=\"http://porg.es/blog/simple-socket-programming-with-haskell\" rel=\"nofollow noreferrer\">porg.es/blog/simple-socket-programming-with-haskell</a>"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1429360371, "post_id": 29717327, "comment_id": 47569204, "body": "<code>ifM</code> loaded fine: <code>ifM :: Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1429361326, "post_id": 29717327, "comment_id": 47569541, "body": "i see it, AJFarmar.. i tried to load the entire module as :l socket.hs.. that didn&#39;t work."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 6, "last_activity_date": 1429362588, "last_edit_date": 1429362588, "creation_date": 1429361629, "answer_id": 29717627, "question_id": 29717327, "link": "https://stackoverflow.com/questions/29717327/monadic-if-how-it-works/29717627#29717627", "title": "Monadic if - how it works?", "body": "<p>It's <a href=\"http://hackage.haskell.org/package/extra-1.1/docs/Control-Monad-Extra.html#v:ifM\" rel=\"noreferrer\">type</a> is:</p>\n\n<pre><code>ifM :: Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a \n</code></pre>\n\n<p>To see how it works, you can just test it in <code>ghci</code> and find out it's\n   behaviour:</p>\n\n<pre><code>\u03bb&gt; ifM (return True) (print \"true\") (print \"false\")\n\"true\"\n\u03bb&gt; ifM (return False) (print \"true\") (print \"false\")\n\"false\"\n</code></pre>\n\n<p>So based on the result of the first monadic boolean parameter, either one of the monadic expression is executed. It is different from the normal <code>if</code> in the way that it takes monadic values.</p>\n\n<p>while2 has this type signature:</p>\n\n<pre><code>while2 :: Monad m =&gt; m Bool -&gt; m Bool -&gt; m ()\n</code></pre>\n\n<p>You can get an idea of how it works by seeing this example:</p>\n\n<pre><code>\u03bb&gt; while2 (print \"hello\" &gt;&gt; return True) (return True)\n\"hello\"\n\u03bb&gt; while2 (print \"hello\" &gt;&gt; return True) (print \"bye\" &gt;&gt; return True)\n\"hello\"\n\u03bb&gt; while2 (print \"hello\" &gt;&gt; return False) (print \"bye\" &gt;&gt; return True)\n\"hello\"\n\"bye\"\n</code></pre>\n\n<p>So in <code>while2</code> function, the first monadic value is executed. If it\n   Sevaluates to <code>True</code>, then <code>return ()</code> is executed. If it's false,\n   then <code>ifM y (return ()) $ while2 x y</code> is executed with the same\n   rules of <code>ifM</code>. Now if <code>y</code> evaluates to <code>False</code>, then the <code>while2</code>\n   is evaluated again in an recursive manner leading to infinite loop:</p>\n\n<pre><code>\u03bb&gt; while2 (print \"hello\" &gt;&gt; return False) (print \"bye\" &gt;&gt; return False)\n\"hello\"\n\"bye\"\n\"hello\"\n\"bye\"\n\"hello\"\n\"bye\"\n\"hello\"\n\"bye\"\nC-c\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1514, "favorite_count": 0, "accepted_answer_id": 29717627, "answer_count": 1, "score": 2, "last_activity_date": 1429362588, "creation_date": 1429359973, "last_edit_date": 1429361681, "question_id": 29717327, "link": "https://stackoverflow.com/questions/29717327/monadic-if-how-it-works", "title": "Monadic if - how it works?", "body": "<p><code>ifM</code> is implemented as:</p>\n\n<pre><code>ifM p t f  = p &gt;&gt;= (\\p' -&gt; if p' then t else f)\n</code></pre>\n\n<p>And another function <code>while2</code> uses <code>ifM</code> like this,</p>\n\n<pre><code>while2 x y = ifM x (return ()) $ ifM y (return ()) $ while2 x y \n</code></pre>\n\n<p>My questions are:</p>\n\n<ul>\n<li><p>ifM takes three arguments. What are their types? (i understood it as, p - predicate function, t - true function block, f - false function block)</p></li>\n<li><p>In the usage of <code>ifM</code> inside <code>while2</code>, when does the argument \nevaluation happen? Does the arguments coming after <code>$</code> get evaluated first and their values passed as arguments to <code>while2</code></p></li>\n<li><p>What does <code>ifM</code> do that <code>if</code> cannot do?</p></li>\n</ul>\n"}, {"tags": ["haskell", "functional-programming", "sml", "fold"], "comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 1, "creation_date": 1429353088, "post_id": 29715959, "comment_id": 47566817, "body": "The <code>fun</code> keyword in ocaml is used to create an anonymous function. Did you mean <code>let rec foldl f e l = ...</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1429361366, "post_id": 29715959, "comment_id": 47569556, "body": "This is a classic exercise, sometimes jokingly referred to as &quot;buscar el levante por el poniente&quot; ;-)"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1429362214, "post_id": 29715959, "comment_id": 47569875, "body": "@chi I missed the joke. Mind explaining?"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1429362254, "post_id": 29715959, "comment_id": 47569889, "body": "Just realized that the OP&#39;s OCaml code is actually SML code."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 1, "creation_date": 1429364319, "post_id": 29715959, "comment_id": 47570617, "body": "@AaditMShah You fold <i>right</i> to obtain a fold <i>left</i>, similarly to going west to reach the east."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1429369014, "post_id": 29715959, "comment_id": 47572319, "body": "@chi According to <a href=\"https://translate.google.com/#auto/en/buscar%20el%20levante%20por%20el%20poniente\" rel=\"nofollow noreferrer\">Google Translate</a> &quot;buscar el levante por el poniente&quot; means &quot;seek the release by the setting&quot; in Spanish."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 1, "creation_date": 1429370266, "post_id": 29715959, "comment_id": 47572764, "body": "@AaditMShah That is the motto attributed to Columbus: it roughly means &quot;to seek the East by way of the West&quot; -- he expected to reach India (the East) by circumnavigating the globe going westwards."}], "answers": [{"tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 7, "last_activity_date": 1429361668, "creation_date": 1429361668, "answer_id": 29717640, "question_id": 29715959, "link": "https://stackoverflow.com/questions/29715959/defining-foldl-in-terms-of-foldr-in-standard-ml/29717640#29717640", "title": "Defining foldl in terms of foldr in Standard ML", "body": "<p>Let's dissect the Haskell implementation of <code>myFoldl</code> and then take a look at the <strike>ocaml</strike> SML code. First, we'll look at some type signatures:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foldr :: (a -&gt; b -&gt; b) -- the step function\n      -&gt; b             -- the initial value of the accumulator\n      -&gt; [a]           -- the list to fold\n      -&gt; b             -- the result\n</code></pre>\n\n<p>It should be noted that although the <code>foldr</code> function accepts only three arguments we are applying it two four arguments:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foldr step id xs z\n</code></pre>\n\n<p>However, as you can see the second argument to <code>foldr</code> (i.e. the inital value of the accumulator) is <code>id</code> which is a function of the type <code>x -&gt; x</code>. Therefore, the result is also of the type <code>x -&gt; x</code>. Hence, it accepts four arguments.</p>\n\n<p>Similarly, the step function is now of the type <code>a -&gt; (x -&gt; x) -&gt; x -&gt; x</code>. Hence, it accepts three arguments instead of two. The accumulator is an <a href=\"https://en.wikipedia.org/wiki/Endomorphism#Endofunctions\" rel=\"noreferrer\">endofunction</a> (i.e. a function whose domain and codomain is the same).</p>\n\n<p>Endofunctions have a special property, they are composed from left to right instead of from right to left. For example, let's compose a bunch of <code>Int -&gt; Int</code> functions:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>inc :: Int -&gt; Int\ninc n = n + 1\n\ndbl :: Int -&gt; Int\ndbl n = n * 2\n</code></pre>\n\n<p>The normal way to compose these functions is to use the function composition operator as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>incDbl :: Int -&gt; Int\nincDbl = inc . dbl\n</code></pre>\n\n<p>The <code>incDbl</code> function first doubles a number and then increments it. Note that this reads from right to left.</p>\n\n<p>Another way to compose them is to use continuations (denoted by <code>k</code>):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>inc' :: (Int -&gt; Int) -&gt; Int -&gt; Int\ninc' k n = k (n + 1)\n\ndbl' :: (Int -&gt; Int) -&gt; Int -&gt; Int\ndbl' k n = k (n * 2)\n</code></pre>\n\n<p>Notice that the first argument is a continuation. If we want to recover the original functions then we can do:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>inc :: Int -&gt; Int\ninc = inc' id\n\ndbl :: Int -&gt; Int\ndbl = dbl' id\n</code></pre>\n\n<p>However, if we want to compose them then we do it as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>incDbl' :: (Int -&gt; Int) -&gt; Int -&gt; Int\nincDbl' = dbl' . inc'\n\nincDbl :: Int -&gt; Int\nincDbl = incDbl' id\n</code></pre>\n\n<p>Notice that although we are still using the dot operator to compose the functions, it now reads from left to right.</p>\n\n<p>This is the key behind making <code>foldr</code> behave as <code>foldl</code>. We fold the list from right to left but instead of folding it into a value, we fold it into an endofunction which when applied to an initial accumulator value actually folds the list from left to right.</p>\n\n<p>Consider our <code>incDbl</code> function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>incDbl = incDbl' id\n       = (dbl' . inc') id\n       =  dbl' (inc' id)\n</code></pre>\n\n<p>Now consider the definition of <code>foldr</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldr _   acc []     = acc\nfoldr fun acc (y:ys) = fun y (foldr fun acc ys)\n</code></pre>\n\n<p>In the basis case we simply return the accumulated value. However, in the inductive case we return <code>fun y (foldr fun acc ys)</code>. Our <code>step</code> function is defined as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>step :: a -&gt; (x -&gt; x) -&gt; x -&gt; x\nstep x g a = g (f a x)\n</code></pre>\n\n<p>Here <code>f</code> is the reducer function of <code>foldl</code> and is of the type <code>x -&gt; a -&gt; x</code>. Notice that <code>step x</code> is an endofunction of the type <code>(x -&gt; x) -&gt; x -&gt; x</code> which we know can be composed left to right.</p>\n\n<p>Hence the folding operation (i.e. <code>foldr step id</code>) on a list <code>[y1,y2..yn]</code> looks like:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>step y1 (step y2 (... (step yn id)))\n\n-- or\n\n(step y1 . step y2 . {dots} . step yn) id\n</code></pre>\n\n<p>Each <code>step yx</code> is an endofunction. Hence, this is equivalent to composing the endofunctions from left to right.</p>\n\n<p>When this result is applied to an initial accumulator value then the list folds from left to right. Hence, <code>myFoldl f z xs = foldr step id xs z</code>.</p>\n\n<hr>\n\n<p>Now consider the <code>foldl</code> function (which is written in Standard ML and not OCaml). It is defined as:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>fun foldl f e l = let fun g (x, f'') = fn y =&gt; f'' (f (x, y))\n                  in  foldr g (fn x =&gt; x) l e end\n</code></pre>\n\n<p>The biggest difference between the <code>foldr</code> functions of Haskell and SML are:</p>\n\n<ol>\n<li>In Haskell the reducer function has the type <code>a -&gt; b -&gt; b</code>.</li>\n<li>In SML the reducer function has the type <code>(a, b) -&gt; b</code>.</li>\n</ol>\n\n<p>Both are correct. It's only a matter of preference. In SML instead of passing two separate arguments, you pass one single tuple which contains both arguments.</p>\n\n<p>Now, the similarities:</p>\n\n<ol>\n<li>The <code>id</code> function in Haskell is the anonymous <code>fn x =&gt; x</code> function in SML.</li>\n<li>The <code>step</code> function in Haskell is the function <code>g</code> in SML which takes a tuple containing the first two arguments.</li>\n<li>The <code>step</code> function is Haskell <code>step x g a</code> has been split into two functions in SML <code>g (x, f'') = fn y =&gt; f'' (f (x, y))</code> for more clarity.</li>\n</ol>\n\n<p>If we rewrite the SML function to use the same names as in Haskell then we have:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>fun myFoldl f z xs = let step (x, g) = fn a =&gt; g (f (a, x))\n                     in foldr step (fn x =&gt; x) xs z end\n</code></pre>\n\n<p>Hence, they are exactly the same function. The expression <code>g (x, f'')</code> simply applies the function <code>g</code> to the tuple <code>(x, f'')</code>. Here <code>f''</code> is a valid identifier.</p>\n"}, {"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 4, "last_activity_date": 1429439597, "last_edit_date": 1429439597, "creation_date": 1429396159, "answer_id": 29723643, "question_id": 29715959, "link": "https://stackoverflow.com/questions/29715959/defining-foldl-in-terms-of-foldr-in-standard-ml/29723643#29723643", "title": "Defining foldl in terms of foldr in Standard ML", "body": "<h1>Intuition</h1>\n\n<p>The foldl function traverses the list head to tail while operating elements with an accumulator: </p>\n\n<p>(...(a\u2297x<sub>1</sub>)\u2297...\u2297x<sub>n-1</sub>)\u2297x<sub>n</sub></p>\n\n<p>And you want to define it via a foldr:</p>\n\n<p>x<sub>1</sub>\u2295(x<sub>2</sub>\u2295...\u2295(x<sub>n</sub>\u2295e)...)</p>\n\n<p>Rather unintuitive. The trick is that your foldr will not produce a value, but rather a function. The list traversal will operate the elements as to produce a function that, when applied to the accumulator, performs the computation you desire. </p>\n\n<p>Lets see a simple example to illustrate how this works. Consider <code>sum foldl (+) 0 [1,2,3] = ((0+1)+2)+3</code>. We may calculate it via foldr as follows.</p>\n\n<pre><code>   foldr \u2295 [1,2,3] id \n-&gt; 1\u2295(2\u2295(3\u2295id))\n-&gt; 1\u2295(2\u2295(id.(+3))\n-&gt; 1\u2295(id.(+3).(+2))\n-&gt; (id.(+3).(+2).(+1))\n</code></pre>\n\n<p>So when we apply this function to 0 we get </p>\n\n<pre><code>   (id.(+3).(+2).(+1)) 0\n=  ((0+1)+2)+3\n</code></pre>\n\n<p>We began with the identity function and successively changed it as we traversed the list, using \u2295 where, </p>\n\n<pre><code>n \u2295 g = g . (+n)   \n</code></pre>\n\n<p>Using this intuition, it isn't hard to define a sum with an accumulator via foldr. We built the computation for a given list via <code>foldr \u2295 id xs</code>. Then to calculate the sum we applied it to 0, <code>foldr \u2295 id xs 0</code>. So we have,</p>\n\n<pre><code>foldl (+) 0 xs = foldr \u2295 id xs 0 \n               where n \u2295 g = g . (+n)   \n</code></pre>\n\n<p>or equivalently, denoting <code>n \u2295 g</code> in prefix form by <code>(\u2295) n g</code> and noting that <code>(\u2295) n g a = (g . (+n)) a = g (a+n)</code>,      </p>\n\n<pre><code>foldl (+) 0 xs = foldr \u2295 id xs 0\n               where (\u2295) n g a = g (a+n)   \n</code></pre>\n\n<p>Note that the \u2295 is your step function, and that you can obtain the generic result you're looking for by substituting a function f for +, and accumulator a for 0.</p>\n\n<p>Next let us show that the above really is correct.</p>\n\n<h1>Formal derivation</h1>\n\n<p>Moving on to a more formal approach. It is useful, for simplicity, to be aware of the following universal property of foldr.</p>\n\n<pre><code>h []     = e\nh (x:xs) = f x (h xs)\n\n      iff \n\nh = foldr f e\n</code></pre>\n\n<p>This means that rather than defining foldr directly, we may instead and more simply define a function h in the form above. </p>\n\n<p>We want to define such an h so that, </p>\n\n<pre><code>h xs a = foldl f a xs\n</code></pre>\n\n<p>or equivalently,</p>\n\n<pre><code>h xs = \\a -&gt; foldl f a xs\n</code></pre>\n\n<p>So lets determine h. The empty case is simple:</p>\n\n<pre><code>h [] = \\a -&gt; foldl f a []\n     = \\a -&gt; a\n     = id\n</code></pre>\n\n<p>The non-empty case results in: </p>\n\n<pre><code>h (x:xs) = \\a -&gt; foldl f a (x:xs)\n         = \\a -&gt; foldl f (f a x) xs\n         = \\a -&gt; h xs (f a x)\n         = step x (h xs)   where step x g = \\a -&gt; g (f a x) \n         = step x (h xs)   where step x g a = g (f a x) \n</code></pre>\n\n<p>So we conclude that,  </p>\n\n<pre><code>h []     = id\nh (x:xs) = step x (h xs) where step x g a = g (f a x) \n</code></pre>\n\n<p>satisfies <code>h xs a = foldl f a xs\n</code></p>\n\n<p>And by the universal property above (noting that the f in the universal property formula corresponds to step here, and e to id) we know that <code>h = foldr step id</code>. Therefore,     </p>\n\n<pre><code>h      = foldr step id\nh xs a = foldl f a xs\n-----------------------\nfoldl f a xs = foldr step id xs a  \n             where step x g a = g (f a x) \n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 4495367, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-1dhhLMxWKXw/AAAAAAAAAAI/AAAAAAAAeZQ/wp0E4S0UEag/photo.jpg?sz=128", "display_name": "\u9ad8\u4eae\u8282", "link": "https://stackoverflow.com/users/4495367/%e9%ab%98%e4%ba%ae%e8%8a%82"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 897, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1429439597, "creation_date": 1429352574, "last_edit_date": 1429378940, "question_id": 29715959, "link": "https://stackoverflow.com/questions/29715959/defining-foldl-in-terms-of-foldr-in-standard-ml", "title": "Defining foldl in terms of foldr in Standard ML", "body": "<p>The defined code is </p>\n\n<pre><code>fun foldl f e l = let\n    fun g(x, f'') = fn y =&gt; f''(f(x, y)) \n    in foldr g (fn x =&gt; x) l e end\n</code></pre>\n\n<p>I don't understand how this works; \nwhat is the purpose of <code>g(x, f'')</code>?</p>\n\n<p>I also find a similar example in Haskell,\nthe definition is quite short</p>\n\n<pre><code>myFoldl f z xs = foldr step id xs z\n    where\n        step x g a = g (f a x)\n</code></pre>\n"}, {"tags": ["javascript", "html", "haskell", "ghcjs"], "answers": [{"comments": [{"owner": {"reputation": 142, "user_id": 4718903, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bSjBU.jpg?s=128&g=1", "display_name": "Yiyue Wang", "link": "https://stackoverflow.com/users/4718903/yiyue-wang"}, "edited": false, "score": 0, "creation_date": 1429348370, "post_id": 29715071, "comment_id": 47565394, "body": "I understand now.. Thanks!!"}], "tags": [], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "is_accepted": true, "score": 6, "last_activity_date": 1429347322, "creation_date": 1429347322, "answer_id": 29715071, "question_id": 29714884, "link": "https://stackoverflow.com/questions/29714884/am-i-using-ghcjs-correctly/29715071#29715071", "title": "Am I using ghcjs correctly?", "body": "<p><code>putStrLn</code> outputs text to the Javascript console, which you can usually reach through the \"developer tools\" in your browser of choice. It does not generate any HTML.</p>\n"}], "owner": {"reputation": 142, "user_id": 4718903, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bSjBU.jpg?s=128&g=1", "display_name": "Yiyue Wang", "link": "https://stackoverflow.com/users/4718903/yiyue-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "accepted_answer_id": 29715071, "answer_count": 1, "score": 5, "last_activity_date": 1429385779, "creation_date": 1429346199, "last_edit_date": 1429385779, "question_id": 29714884, "link": "https://stackoverflow.com/questions/29714884/am-i-using-ghcjs-correctly", "title": "Am I using ghcjs correctly?", "body": "<p>I'm quite new to Haskell and ghcjs. I'm starting with the very first \"Hello, world!\" program to learn.</p>\n\n<p>Here is my Haskell program, copied from GHCJS wiki:</p>\n\n<pre><code>module Main where\nmain = putStrLn \"Hello world!\"\n</code></pre>\n\n<p>I use the command <code>ghcjs -o hello hello.hs</code> to compile it to javascript, and I tried to run it on my Terminal with the command <code>node hello.jsexe/all.js</code>, but when I tried to open the generated file \"index.html\":</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n  &lt;html&gt;\n    &lt;head&gt;\n      &lt;script language=\"javascript\" src=\"rts.js\"&gt;&lt;/script&gt;\n      &lt;script language=\"javascript\" src=\"lib.js\"&gt;&lt;/script&gt;\n      &lt;script language=\"javascript\" src=\"out.js\"&gt;&lt;/script&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n    &lt;/body&gt;\n    &lt;script language=\"javascript\" src=\"runmain.js\" defer&gt;&lt;/script&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>But when I open this in Chrome the page is blank. Does anyone know what's wrong here?</p>\n"}, {"tags": ["haskell", "pointfree"], "answers": [{"tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 30, "last_activity_date": 1429336690, "creation_date": 1429336690, "answer_id": 29713525, "question_id": 29713442, "link": "https://stackoverflow.com/questions/29713442/what-is-the-derivation-that-shows-haskells-x-x-x-equivalent-to-join/29713525#29713525", "title": "What is the derivation that shows Haskell&#39;s \\x -&gt; (x, x) equivalent to join (,)?", "body": "<p>Look at the type signatures:</p>\n\n<pre><code>\\x -&gt; (x, x) :: a -&gt; (a, a)\n\n(,)          :: a -&gt; b -&gt; (a, b)\n\njoin         :: Monad m =&gt; m (m a) -&gt; m a\n</code></pre>\n\n<p>It should be noted that <code>((-&gt;) r)</code> is an instance of the <code>Monad</code> typeclass. Hence, on specializing:</p>\n\n<pre><code>join         :: (r -&gt; r -&gt; a) -&gt; (r -&gt; a)\n</code></pre>\n\n<p>What <code>join</code> does for functions is apply the given function twice to the same argument:</p>\n\n<pre><code>join f x = f x x\n\n-- or\n\njoin f = \\x -&gt; f x x\n</code></pre>\n\n<p>From this, we can see trivially:</p>\n\n<pre><code>join (,) = \\x -&gt; (,) x x\n\n-- or\n\njoin (,) = \\x -&gt; (x, x)\n</code></pre>\n\n<p>Qed.</p>\n"}, {"comments": [{"owner": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 4, "creation_date": 1429384873, "post_id": 29715031, "comment_id": 47578037, "body": "This is beautiful for beginners. Writing this sort of answers is immensely useful for newcomers."}], "tags": [], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "is_accepted": false, "score": 24, "last_activity_date": 1429347151, "creation_date": 1429347151, "answer_id": 29715031, "question_id": 29713442, "link": "https://stackoverflow.com/questions/29713442/what-is-the-derivation-that-shows-haskells-x-x-x-equivalent-to-join/29715031#29715031", "title": "What is the derivation that shows Haskell&#39;s \\x -&gt; (x, x) equivalent to join (,)?", "body": "<p>I like Aadits intuitive answer. Here's how I'd figure it out by reading the source code.</p>\n\n<ol>\n<li>I go to <a href=\"https://www.haskell.org/hoogle/\">Hoogle</a></li>\n<li>I search for <a href=\"https://www.haskell.org/hoogle/?hoogle=join\"><code>join</code></a></li>\n<li>I <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Monad.html#v:join\">click on <code>join</code></a></li>\n<li>I click the \"source\" button to get to <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/src/GHC-Base.html#join\">the source code for <code>join</code></a></li>\n<li>I see that <code>join x = x &gt;&gt;= id</code></li>\n<li>So I know that <code>join (,) = (,) &gt;&gt;= id</code></li>\n<li>I <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#v:-62--62--61-\">search for <code>&gt;&gt;=</code> on Hoogle and click the link</a></li>\n<li>I see that it's part of the monad typeclass, and I know I'm dealing with <code>(,)</code> which is a function, so I <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/src/GHC-Base.html#line-621\">click \"source\" on the <code>Monad ((-&gt;) r)</code> instance</a></li>\n<li>I see that <code>f &gt;&gt;= k = \\r -&gt; k (f r) r</code></li>\n<li>Since we have <code>f = (,)</code> and <code>k = id</code>, we get <code>\\r -&gt; id ((,) r) r</code></li>\n<li>Sooo... new function! <code>id</code>! I search for that on Hoogle, and <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/src/GHC-Base.html#id\">click through to its source code</a></li>\n<li>Turns out <code>id x = x</code></li>\n<li>So instead of <code>join (,)</code> we now have <code>\\r -&gt; ((,) r) r</code></li>\n<li>Which is the same thing as <code>\\r -&gt; (,) r r</code></li>\n<li>Which is the same thing as <code>\\r -&gt; (r,r)</code></li>\n</ol>\n\n<p>Never forget that the Haddocks link through to the source code of the library. That's immensely useful when trying to figure out how things work together.</p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 1, "accepted_answer_id": 29713525, "answer_count": 2, "score": 21, "last_activity_date": 1434451602, "creation_date": 1429335956, "last_edit_date": 1434451602, "question_id": 29713442, "link": "https://stackoverflow.com/questions/29713442/what-is-the-derivation-that-shows-haskells-x-x-x-equivalent-to-join", "title": "What is the derivation that shows Haskell&#39;s \\x -&gt; (x, x) equivalent to join (,)?", "body": "<p>According to <code>pointfree</code>:</p>\n\n<pre><code>\\x -&gt; (x, x)\n</code></pre>\n\n<p>is equivalent to:</p>\n\n<pre><code>join (,)\n</code></pre>\n\n<p>What is the derivation that shows this?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1429330458, "post_id": 29712710, "comment_id": 47560971, "body": "Impredicative types aren&#39;t really supported, I think. So it&#39;s not too surprising that something related to them has changed. But: try annotating the type of <code>flip</code>, and I bet it will work."}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 10, "last_activity_date": 1429331032, "creation_date": 1429331032, "answer_id": 29712847, "question_id": 29712710, "link": "https://stackoverflow.com/questions/29712710/polymorphic-flip-fails-in-7-10/29712847#29712847", "title": "Polymorphic &quot;flip&quot; fails in 7.10", "body": "<p>The type of <code>flip</code> is</p>\n\n<pre><code>flip :: (x -&gt; y -&gt; z) -&gt; (y -&gt; x -&gt; z)\n</code></pre>\n\n<p>To type check <code>liftPoly</code>, we have to instantiate the variable <code>y</code> at the polymorphic type <code>forall a. k a -&gt; b</code>. This is an instance of impredicative polymorphism.</p>\n\n<p>As the page at <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ImpredicativePolymorphism\">https://ghc.haskell.org/trac/ghc/wiki/ImpredicativePolymorphism</a> says,</p>\n\n<blockquote>\n  <p>We've made various attempts to support impredicativity, so there is a flag <code>-XImpredicativeTypes</code>. But it doesn't work, and is absolutely unsupported. If you use it, you are on your own; I make no promises about what will happen. </p>\n</blockquote>\n\n<p>So, don't be too surprised when the behavior of <code>ImpredicativeTypes</code> changes between versions of GHC.</p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 29712847, "answer_count": 1, "score": 4, "last_activity_date": 1429331032, "creation_date": 1429329486, "question_id": 29712710, "link": "https://stackoverflow.com/questions/29712710/polymorphic-flip-fails-in-7-10", "title": "Polymorphic &quot;flip&quot; fails in 7.10", "body": "<p>The <a href=\"https://hackage.haskell.org/package/monomorphic\" rel=\"nofollow\">monomorphic</a> library contains the following snippet (which should hopefully compile in 7.8):</p>\n\n<pre><code>{-# LANGUAGE DataKinds, ExistentialQuantification, FlexibleContexts, GADTs #-}\n{-# LANGUAGE ImpredicativeTypes, PolyKinds, RankNTypes, TypeFamilies       #-}\n{-# LANGUAGE TypeOperators, UndecidableInstances                           #-}\n\nclass Monomorphicable k where\n  type MonomorphicRep k :: *\n\nwithPolymorphic :: Monomorphicable k\n               =&gt; MonomorphicRep k -&gt; (forall a. k a -&gt; b) -&gt; b\nwithPolymorphic k trans = undefined\n\n-- | Flipped version of 'withPolymorphic'.\nliftPoly :: Monomorphicable k\n         =&gt; (forall a. k a -&gt; b) -&gt; MonomorphicRep k -&gt; b\nliftPoly = flip withPolymorphic\n</code></pre>\n\n<p>However in 7.10, GHC complains:</p>\n\n<pre><code>Couldn't match type \u2018k2 a0 -&gt; b\u2019 with \u2018forall (a :: k0). k1 a -&gt; b\u2019\n    Expected type: MonomorphicRep k2 -&gt; (k2 a0 -&gt; b) -&gt; b\n      Actual type: MonomorphicRep k1\n                   -&gt; (forall (a :: k0). k1 a -&gt; b) -&gt; b\n    Relevant bindings include\n      liftPoly :: (forall (a :: k). k2 a -&gt; b) -&gt; MonomorphicRep k2 -&gt; b\n        (bound at Data/Type/Monomorphic.hs:45:1)\n    In the first argument of \u2018flip\u2019, namely \u2018withPolymorphic\u2019\n    In the expression: flip withPolymorphic\n</code></pre>\n\n<p>Of course if I changed the definition of <code>liftPoly</code> to</p>\n\n<pre><code>liftPoly a b = withPolymorphic b a\n</code></pre>\n\n<p>then 7.10 is happy. What's going on here? Is 7.10 supposed to be stricter when dealing with polymorphic functions somehow? It doesn't appear to be the monomorphism restriction since everything has a signature.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "edited": false, "score": 0, "creation_date": 1429331181, "post_id": 29712745, "comment_id": 47561071, "body": "Hayoo usually has better search results than Hoogle."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1429349605, "post_id": 29712745, "comment_id": 47565742, "body": "<a href=\"https://www.fpcomplete.com/hoogle\" rel=\"nofollow noreferrer\">FP Complete&#39;s Hoogle</a> is the best of both worlds :-)"}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1429362915, "post_id": 29712745, "comment_id": 47570133, "body": "@luqui But their Haddocks don&#39;t have source links in type class instance declarations. :("}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 3, "last_activity_date": 1429330052, "creation_date": 1429330052, "answer_id": 29712745, "question_id": 29712695, "link": "https://stackoverflow.com/questions/29712695/where-is-haskells-if-function/29712745#29712745", "title": "Where is Haskell&#39;s if&#39; function?", "body": "<p>According to <a href=\"http://hayoo.fh-wedel.de/?query=if%27\" rel=\"nofollow\">Hayoo</a>, it is defined in the following three packages:</p>\n\n<pre><code>if' :: Bool -&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<ol>\n<li><p><a href=\"http://hackage.haskell.org/package/utility-ht\" rel=\"nofollow\">utility-ht</a> - <a href=\"http://hackage.haskell.org/package/utility-ht/docs/Data-Bool-HT.html\" rel=\"nofollow\">Data.Bool.HT</a></p>\n\n<p><code>if-then-else</code> as function.</p>\n\n<p>Example:</p>\n\n<pre><code>if' (even n) \"even\" $\nif' (isPrime n) \"prime\" $\n\"boring\"\n</code></pre></li>\n<li><p><a href=\"http://hackage.haskell.org/package/plailude\" rel=\"nofollow\">plailude</a> - <a href=\"http://hackage.haskell.org/package/plailude/docs/Plailude.html\" rel=\"nofollow\">Plailude</a></p>\n\n<p>If <code>True</code> then the first value, else the second.</p></li>\n<li><p><a href=\"http://hackage.haskell.org/package/CLASE\" rel=\"nofollow\">CLASE</a> - <a href=\"http://hackage.haskell.org/package/CLASE/docs/Data-Cursor-CLASE-Util.html\" rel=\"nofollow\">Data.Cursor.CLASE.Util</a></p></li>\n</ol>\n\n<p>The two main search engines for Haskell that I know of are <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow\">Hoogle</a> and <a href=\"http://hayoo.fh-wedel.de/\" rel=\"nofollow\">Hayoo</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1429361072, "post_id": 29715131, "comment_id": 47569465, "body": "Note that this takes the &quot;else&quot; branch before the &quot;then&quot; one. This is so that this is consistent with other catamorphism-builders like <code>maybe</code> and <code>either</code>, which take their arguments in the order of constructor declaration."}], "tags": [], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "is_accepted": false, "score": 8, "last_activity_date": 1429347709, "creation_date": 1429347709, "answer_id": 29715131, "question_id": 29712695, "link": "https://stackoverflow.com/questions/29712695/where-is-haskells-if-function/29715131#29715131", "title": "Where is Haskell&#39;s if&#39; function?", "body": "<p>It's worth mentioning that the <code>if'</code> function exists in <code>base</code> since version 4.7, but it's called <code>bool</code> (in style with <code>either</code> and <code>maybe</code>).</p>\n\n<pre><code>bool :: a -&gt; a -&gt; Bool -&gt; a\nbool f _ False = f\nbool _ t True  = t\n</code></pre>\n\n<p>is defined in <a href=\"http://haddocks.fpcomplete.com/fp/7.8/20140916-162/base/Data-Bool.html#v:bool\"><code>Data.Bool</code></a>.</p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "accepted_answer_id": 29712745, "answer_count": 2, "score": 6, "last_activity_date": 1429347709, "creation_date": 1429329325, "question_id": 29712695, "link": "https://stackoverflow.com/questions/29712695/where-is-haskells-if-function", "title": "Where is Haskell&#39;s if&#39; function?", "body": "<p>If you use <code>pointfree</code> on the code <a href=\"http://blunt.herokuapp.com/#input=%5Cb%20t%20f%20-%3E%20if%20b%20then%20t%20else%20f\" rel=\"noreferrer\"><code>\\b t f -&gt; if b then t else f</code></a>, the answer you get is <code>if'</code>. </p>\n\n<p>Where is <code>if'</code> defined?</p>\n"}, {"tags": ["email", "haskell", "authentication", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 668, "user_id": 2155544, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/caae6ef08bc308aaa3c34324286bad6d?s=128&d=identicon&r=PG", "display_name": "Michael restore Monica Cellio", "link": "https://stackoverflow.com/users/2155544/michael-restore-monica-cellio"}, "is_accepted": false, "score": 1, "last_activity_date": 1429331470, "creation_date": 1429331470, "answer_id": 29712907, "question_id": 29712459, "link": "https://stackoverflow.com/questions/29712459/yesod-auth-account-not-actually-emailing/29712907#29712907", "title": "Yesod.Auth.Account not actually emailing", "body": "<p>The answer is that one must override some of the default behaviour of the <strong>AccountSendEmail</strong> instance.  The default behaviour is just to log a message.</p>\n"}], "owner": {"reputation": 668, "user_id": 2155544, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/caae6ef08bc308aaa3c34324286bad6d?s=128&d=identicon&r=PG", "display_name": "Michael restore Monica Cellio", "link": "https://stackoverflow.com/users/2155544/michael-restore-monica-cellio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1429331470, "creation_date": 1429326706, "question_id": 29712459, "link": "https://stackoverflow.com/questions/29712459/yesod-auth-account-not-actually-emailing", "title": "Yesod.Auth.Account not actually emailing", "body": "<p>I'm trying to write a Yesod-base application and frankly am somewhat out of my depth.  The current blocker is setting up new accounts via email authentication.</p>\n\n<p>I've got it to the stage where the Yesod-provided page comes up requiring username, email, password and repeated-password.  I fill-in the details and click [Register].  The page now shows <em>A confirmation email has been sent to you@yours.com</em>.  However, the email doesn't arrive.  I pretty well just copied the example from <a href=\"https://hackage.haskell.org/package/yesod-auth-1.4.4/docs/Yesod-Auth-Email.html\" rel=\"nofollow\">Yesod.Auth.Account</a>.</p>\n\n<p>On that machine (CentOS 7), I <em>can</em> use the <em>mailx</em> command to send myself an email so I reckon postfix is configured correctly.  So what does Yesod.Auth need, actually to be able to send the email ?</p>\n\n<p><a href=\"http://pastebin.com/RfUd2Utb\" rel=\"nofollow\">Here is my source</a> but <strong>I would appreciate it if this question was not polluted with comments on style etc</strong>. as it is very much a work in progress and a learning exercise for me.  If you absolutely cannot help yourself (and there are those on stackoverflow who cannot) then please wait until the question has actually been answered.  Thank you.</p>\n"}, {"tags": ["list", "haskell", "list-comprehension", "monads"], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1429319047, "post_id": 29711470, "comment_id": 47558934, "body": "It probably isn&#39;t an improvement, but you could use <code>mapM (flip map [True, False] . (,))</code> as well."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 4, "last_activity_date": 1583328720, "last_edit_date": 1583328720, "creation_date": 1429316732, "answer_id": 29711470, "question_id": 29711260, "link": "https://stackoverflow.com/questions/29711260/generating-all-the-combinations-of-a-set-of-boolean-variables-in-haskell/29711470#29711470", "title": "Generating all the combinations of a set of boolean variables in Haskell", "body": "<p>What you need is <code>sequence :: Monad m =&gt; [m a] -&gt; m [a]</code>.</p>\n\n<p>In particular, for the <code>[]</code> monad, <code>sequence</code> takes a list of <code>n</code> lists, and produces all <code>n</code>-length lists drawing one element from each list at a time.</p>\n\n<pre><code>sequence [ [1,2,3], [4,5], [6] ] = \n   [ [1,4,6], [1,5,6], [2,4,6], [2,5,6], [3,4,6], [3,5,6] ]\n</code></pre>\n\n<p>This helps in your particular case because if you have a list of <code>n</code> strings, you can produce the possibilities for each string easily:</p>\n\n<pre><code>map (\\s -&gt; [(s,True), (s,False)] [\"a\", \"b\", \"c\"] = \n   [ [(\"a\", True), (\"a\", False) ]\n   , [(\"b\", True), (\"b\", False) ]\n   , [(\"c\", True), (\"c\", False) ]\n   ]\n</code></pre>\n\n<p>now you just need to pick one from each list to get your propositions holding a truth value for each variable:</p>\n\n<pre><code>sequence (map (\\s -&gt; [(s,True), (s,False)] [\"a\", \"b\", \"c\"]) = \n   [ [(\"a\", True), (\"b\", True), (\"c\", True)]\n   , [(\"a\", True), (\"b\", True), (\"c\", False)]\n   , [(\"a\", True), (\"b\", False), (\"c\", True)]\n   , [(\"a\", True), (\"b\", False), (\"c\", False)]\n   , [(\"a\", False), (\"b\", True), (\"c\", True)]\n   , [(\"a\", False), (\"b\", True), (\"c\", False)]\n   , [(\"a\", False), (\"b\", False), (\"c\", True)]\n   , [(\"a\", False), (\"b\", False), (\"c\", False)]\n   ]\n</code></pre>\n\n<p><code>sequence (map f xs)</code> comes up often enough that there's a name for it:</p>\n\n<pre><code>mapM f xs = sequence (map f xs)\n-- or, point-free style\nmapM f = sequence . map f\n</code></pre>\n\n<p>So your desired function is just</p>\n\n<pre><code>allPropositions vs = mapM (\\v -&gt; [(v,True),(v,False)]) vs\n-- or, equivalently\nallPropositions = mapM (\\v -&gt; [(v,True),(v,False)])\n-- or, equivalently\nallPropositions = mapM $ \\v -&gt; [(v,True),(v,False)]\n-- or, equivalently, with -XTupleSections\nallPropositions = mapM $ \\v -&gt; map (v,) [True, False]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 1, "last_activity_date": 1429335390, "creation_date": 1429335390, "answer_id": 29713381, "question_id": 29711260, "link": "https://stackoverflow.com/questions/29711260/generating-all-the-combinations-of-a-set-of-boolean-variables-in-haskell/29713381#29713381", "title": "Generating all the combinations of a set of boolean variables in Haskell", "body": "<p>This is how I would do it:</p>\n\n<pre><code>allPropositions :: [a] -&gt; [[(a, Bool)]]\nallPropositions = foldr (\\x xs -&gt; (:) &lt;$&gt; [(x,True),(x,False)] &lt;*&gt; xs) [[]]\n</code></pre>\n\n<p>You don't need the full power of monads at all. All you need are <a href=\"https://wiki.haskell.org/Applicative_functor\" rel=\"nofollow\">applicative functors</a>.</p>\n\n<p>Here's whats happening:</p>\n\n<ol>\n<li>For the basis case the result is <code>[[]]</code> (i.e. <code>allPropositions [] = [[]]</code>).</li>\n<li>For the inductive case the result is <code>\u27e6(:) [(x,True),(x,False)] xs\u27e7</code>. Note that the double square brackets (i.e. <code>\u27e6\u27e7</code>) denote the context of an applicative functor (in this case, <code>[]</code>).</li>\n</ol>\n\n<p>Although rampion's answer is correct, it makes use of <code>sequence</code> and <code>mapM</code> which are monadic functions. However, as I stated before you don't need the full power of monads in this case.</p>\n"}, {"tags": [], "owner": {"reputation": 456, "user_id": 5122135, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FiFoN.jpg?s=128&g=1", "display_name": "Milad", "link": "https://stackoverflow.com/users/5122135/milad"}, "is_accepted": false, "score": 1, "last_activity_date": 1583322310, "creation_date": 1583322310, "answer_id": 60525316, "question_id": 29711260, "link": "https://stackoverflow.com/questions/29711260/generating-all-the-combinations-of-a-set-of-boolean-variables-in-haskell/60525316#60525316", "title": "Generating all the combinations of a set of boolean variables in Haskell", "body": "<p>If you don't want the full power of monads, you can still use <code>sequenceA</code>.</p>\n"}], "owner": {"reputation": 449, "user_id": 174147, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b113497a7ade2a288e43f792650fe82c?s=128&d=identicon&r=PG", "display_name": "Gael", "link": "https://stackoverflow.com/users/174147/gael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1790, "favorite_count": 0, "accepted_answer_id": 29711470, "answer_count": 3, "score": 9, "last_activity_date": 1583328720, "creation_date": 1429314867, "question_id": 29711260, "link": "https://stackoverflow.com/questions/29711260/generating-all-the-combinations-of-a-set-of-boolean-variables-in-haskell", "title": "Generating all the combinations of a set of boolean variables in Haskell", "body": "<p>I am trying to bend my head around list monads in haskell. I was trying to generate a list of all possible propositions given a list of strings designating boolean variables.</p>\n\n<p>For instance calling :</p>\n\n<pre><code>mapM_ print $ allPropositions [\"a\",\"b\"]\n</code></pre>\n\n<p>would yield the following result :</p>\n\n<pre><code>[(\"a\",True),(\"b\",True)]\n[(\"a\",True),(\"b\",False)]\n[(\"a\",False),(\"b\",True)]\n[(\"a\",False),(\"b\",False)]\n</code></pre>\n\n<p>I have managed to do it using list comprehensions and recursion with the following code</p>\n\n<pre><code>allPropositions :: [String] -&gt; [[(String,Bool)]]\nallPropositions [] = [[]]\nallPropositions (x:xs) = [(x,True):r | r &lt;- allPropositions xs] ++ [(x,False):r | r &lt;- allPropositions xs]\n</code></pre>\n\n<p>I was looking for a way to do it using the do notation similar to the following snippet but with a variable number of inputs. Is there a way to do it (nested monads,...) ?</p>\n\n<pre><code>allPropositions' = do\n    a &lt;- [True, False]\n    b &lt;- [True, False]\n    return([(\"a\",a),(\"b\",b)])\n</code></pre>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 3, "creation_date": 1429305696, "post_id": 29709461, "comment_id": 47554753, "body": "This looks like an exercise.  What have you attempted first?  Where are you stuck?"}, {"owner": {"reputation": 21, "user_id": 4274927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faf2f8ff139351dbae4e3637f2c83b7a?s=128&d=identicon&r=PG&f=1", "display_name": "Meter Paffay", "link": "https://stackoverflow.com/users/4274927/meter-paffay"}, "edited": false, "score": 0, "creation_date": 1429305853, "post_id": 29709461, "comment_id": 47554826, "body": "I do not know how to change a value. returning it as a function is not a problem though. I tried returning another function that is identical to the first function, but it differs in that one given position."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1429312086, "post_id": 29709461, "comment_id": 47557273, "body": "<code>|</code>s need to line up."}, {"owner": {"reputation": 21, "user_id": 4274927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faf2f8ff139351dbae4e3637f2c83b7a?s=128&d=identicon&r=PG&f=1", "display_name": "Meter Paffay", "link": "https://stackoverflow.com/users/4274927/meter-paffay"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1429312160, "post_id": 29709461, "comment_id": 47557310, "body": "@Cubic I don&#39;t think this is the problem."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1429320465, "post_id": 29709461, "comment_id": 47559230, "body": "@Cubic They actually don&#39;t. <code>|</code>s aren&#39;t given any indentation block. (<i>Except</i> with the <code>MultiWayIf</code> syntax extension, where they had to add one for sanity when nesting them.)"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 4274927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faf2f8ff139351dbae4e3637f2c83b7a?s=128&d=identicon&r=PG&f=1", "display_name": "Meter Paffay", "link": "https://stackoverflow.com/users/4274927/meter-paffay"}, "edited": false, "score": 0, "creation_date": 1429309187, "post_id": 29710216, "comment_id": 47556299, "body": "This helped me alot and its almost working. The key was to use the &quot;where&quot; function. However, i cannot use the &quot;|&quot; operator in combination with where somehow. The fist line seems to work out, but every following line produces this error: &quot;parse error on input &#39;|&#39;"}, {"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "reply_to_user": {"reputation": 21, "user_id": 4274927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faf2f8ff139351dbae4e3637f2c83b7a?s=128&d=identicon&r=PG&f=1", "display_name": "Meter Paffay", "link": "https://stackoverflow.com/users/4274927/meter-paffay"}, "edited": false, "score": 0, "creation_date": 1429312282, "post_id": 29710216, "comment_id": 47557349, "body": "@MeterPaffay <code>where</code> clause should go <b>after</b> all the guards."}, {"owner": {"reputation": 21, "user_id": 4274927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faf2f8ff139351dbae4e3637f2c83b7a?s=128&d=identicon&r=PG&f=1", "display_name": "Meter Paffay", "link": "https://stackoverflow.com/users/4274927/meter-paffay"}, "reply_to_user": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 0, "creation_date": 1429312463, "post_id": 29710216, "comment_id": 47557404, "body": "@zudov i thought i could use &#39;where&#39; to evaluate the return value. It seems this is not possible. How can I manage to do this. To make it clear: i try to return a function that differs in only one given position."}, {"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "reply_to_user": {"reputation": 21, "user_id": 4274927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faf2f8ff139351dbae4e3637f2c83b7a?s=128&d=identicon&r=PG&f=1", "display_name": "Meter Paffay", "link": "https://stackoverflow.com/users/4274927/meter-paffay"}, "edited": false, "score": 2, "creation_date": 1429315837, "post_id": 29710216, "comment_id": 47558277, "body": "@MeterPaffay I am not sure what you mean by &quot;evaluate the return value&quot;, but the purpose of <code>where</code> is to create additional definitions which would be available only in scope of the definition in which <code>where</code> is used.  Multiple guards constitute single definition, so there can be only one <code>where</code> for a chain of guards."}, {"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 0, "creation_date": 1429315914, "post_id": 29710216, "comment_id": 47558300, "body": "I&#39;ll be glad to provide an answer with an explanation of these issues if you&#39;ll change the question to address specific problems."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user41871"}, "is_accepted": false, "score": 2, "last_activity_date": 1429376608, "last_edit_date": 1495539816, "creation_date": 1429308401, "answer_id": 29710216, "question_id": 29709461, "link": "https://stackoverflow.com/questions/29709461/how-to-change-values-of-a-function-in-haskell-and-return-this-function/29710216#29710216", "title": "How to change values of a function in Haskell and return this function?", "body": "<p>When defining <code>changeMyFunc x</code>, the first step would be to just return the original <code>myFunc x</code> itself. That gets you almost the whole way there.</p>\n\n<p>Then divide that into two cases: one case where <code>x == y</code> and the other case where <code>x /= y</code>, where <code>y</code> is your special input. What should <code>changeMyFunc x</code> return in each case?</p>\n\n<h2>Updated hint</h2>\n\n<p>Currently you are accepting args <code>x</code>, <code>y</code>, <code>z</code>. Try something with this instead:</p>\n\n<pre><code>changeMyFunc f y z x\n    | fill this part in yourself\n</code></pre>\n\n<p><code>f</code> is the original function.\n<code>y</code> is the special input and <code>z</code> is the special output.\n<code>x</code> is the argument for the new <code>changeMyFunc</code> function that you're defining.</p>\n\n<blockquote>\n  <p>See <a href=\"https://stackoverflow.com/questions/19598675/how-do-you-use-a-function-inside-arguments-in-haskell?rq=1\">How do you use a function inside arguments in haskell?</a> for more information on higher-order functions.</p>\n</blockquote>\n\n<p>Think about which args you should be comparing, and what the output should be in each case. (Hint: I already gave part of the answer above.)</p>\n\n<p>Then you can test it with this:</p>\n\n<pre><code>*Main&gt; let successor = (+) 1\n*Main&gt; let successor' = changeMyFunc successor 1 1000\n*Main&gt; successor' 100\n101\n*Main&gt; successor' 101\n102\n*Main&gt; successor' 500\n501\n*Main&gt; successor' 1\n1000\n</code></pre>\n\n<h2>Solution</h2>\n\n<blockquote class=\"spoiler\">\n  <p> <code>changeMyFunc :: (Integer -> Integer) -> Integer -> Integer -> (Integer -> Integer)</code><br>\n <code>changeMyFunc f y z x</code><br>\n <code>  | x == y = z</code><br>\n <code>  | otherwise = f x</code><br></p>\n</blockquote>\n"}], "owner": {"reputation": 21, "user_id": 4274927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faf2f8ff139351dbae4e3637f2c83b7a?s=128&d=identicon&r=PG&f=1", "display_name": "Meter Paffay", "link": "https://stackoverflow.com/users/4274927/meter-paffay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1191, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1429376608, "creation_date": 1429305307, "last_edit_date": 1429311995, "question_id": 29709461, "link": "https://stackoverflow.com/questions/29709461/how-to-change-values-of-a-function-in-haskell-and-return-this-function", "title": "How to change values of a function in Haskell and return this function?", "body": "<p>I would like to do the following in Haskell:</p>\n\n<pre><code>myFunc 1 = 0\nmyFunc 2 = 1\n\nchangeMyFunc:: (Integer -&gt; Integer) -&gt; Integer -&gt; Integer -&gt; (Integer -&gt; Integer)\nchangeMyFunc x y z = undefined\n\n-- change value of function x at position y to value z and return this function\n-- this would make: (changeMyFunc myFunc 1 5) 1 == 5\n</code></pre>\n\n<p>This is how far i got it:</p>\n\n<pre><code>changeMyFunc2:: (Integer -&gt; Integer) -&gt; Integer -&gt; Integer -&gt; (Integer -&gt; Integer)\nchangeMyFunc2 x y z | y == z = myFunc\n                | y /= z = myFunc where myFunc y = 12\n                | otherwise myFunc\n</code></pre>\n\n<p>the last line causes: parse error on input '|'\nHow can i check multiple cases using where?</p>\n"}, {"tags": ["haskell", "monads", "fibonacci", "state-monad"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1429303779, "post_id": 29708972, "comment_id": 47553769, "body": "Well, <i>what</i> is the error? What test fails and in which way?"}, {"owner": {"reputation": 3366, "user_id": 1756750, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/db2912f03e4de7e109367b40f874fea6?s=128&d=identicon&r=PG", "display_name": "Denis", "link": "https://stackoverflow.com/users/1756750/denis"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1429303897, "post_id": 29708972, "comment_id": 47553845, "body": "@leftaroundabout, this judging system does not give me test, which is failed. My code calculate wrong fib number for some <code>n</code>. I brute many <code>n</code>, but I can not find error."}, {"owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "edited": false, "score": 1, "creation_date": 1429303937, "post_id": 29708972, "comment_id": 47553870, "body": "With this implementation, <code>fib 1 = 1</code>. If you need <code>fib 1 = 0</code> then you need to <code>replicateM (n-1) fibStep</code>. Otherwise this code looks fine."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1429304131, "post_id": 29708972, "comment_id": 47553962, "body": "Can you link to the description of the problem you are solving, please? (Or include the problem statement from the judge word-for-word here.)"}, {"owner": {"reputation": 3366, "user_id": 1756750, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/db2912f03e4de7e109367b40f874fea6?s=128&d=identicon&r=PG", "display_name": "Denis", "link": "https://stackoverflow.com/users/1756750/denis"}, "reply_to_user": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "edited": false, "score": 0, "creation_date": 1429304139, "post_id": 29708972, "comment_id": 47553969, "body": "@Mokosha, <code>fib 1 = 1</code> according to definition of fib numbers of this system."}, {"owner": {"reputation": 3366, "user_id": 1756750, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/db2912f03e4de7e109367b40f874fea6?s=128&d=identicon&r=PG", "display_name": "Denis", "link": "https://stackoverflow.com/users/1756750/denis"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1429304253, "post_id": 29708972, "comment_id": 47554031, "body": "@DanielWagner, this is a private system (you do not have access to it). The full task is: &quot;Write a function that computes Fibonacci numbers using State monad.&quot;. Also, first 3 lines of my code given from system. Also, there is one test: <code>fib 7 = 13</code>."}, {"owner": {"reputation": 555, "user_id": 4108393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1616347e88a4828ad7b5eaf6dff2337?s=128&d=identicon&r=PG&f=1", "display_name": "G Philip", "link": "https://stackoverflow.com/users/4108393/g-philip"}, "edited": false, "score": 0, "creation_date": 1429304717, "post_id": 29708972, "comment_id": 47554282, "body": "What does the system expect when <code>fib</code> is given a negative number as input?"}, {"owner": {"reputation": 3366, "user_id": 1756750, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/db2912f03e4de7e109367b40f874fea6?s=128&d=identicon&r=PG", "display_name": "Denis", "link": "https://stackoverflow.com/users/1756750/denis"}, "reply_to_user": {"reputation": 555, "user_id": 4108393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1616347e88a4828ad7b5eaf6dff2337?s=128&d=identicon&r=PG&f=1", "display_name": "G Philip", "link": "https://stackoverflow.com/users/4108393/g-philip"}, "edited": false, "score": 0, "creation_date": 1429304811, "post_id": 29708972, "comment_id": 47554330, "body": "@GPhilip, the system expect <code>0</code> in this case."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1429304843, "post_id": 29708972, "comment_id": 47554346, "body": "@Denis Perhaps you should correspond with whoever is in charge of the judge. There is not much room to hide a problem in such short code!"}, {"owner": {"reputation": 3366, "user_id": 1756750, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/db2912f03e4de7e109367b40f874fea6?s=128&d=identicon&r=PG", "display_name": "Denis", "link": "https://stackoverflow.com/users/1756750/denis"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1429304940, "post_id": 29708972, "comment_id": 47554405, "body": "@DanielWagner, I thought about this step. Therefore I created this topic as last chance before contacting with support."}, {"owner": {"reputation": 373, "user_id": 2487254, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0287a6e43f477fca396ef20389bd316c?s=128&d=identicon&r=PG", "display_name": "Jxek", "link": "https://stackoverflow.com/users/2487254/jxek"}, "edited": false, "score": 0, "creation_date": 1429360374, "post_id": 29708972, "comment_id": 47569206, "body": "The do syntax isn&#39;t necessary if you only have one monadic statement :)"}], "answers": [{"tags": [], "owner": {"reputation": 294, "user_id": 4196578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc38fbfa2d450c0ac40bd9399f7a3d2e?s=128&d=identicon&r=PG&f=1", "display_name": "thor", "link": "https://stackoverflow.com/users/4196578/thor"}, "is_accepted": true, "score": 4, "last_activity_date": 1429305023, "creation_date": 1429305023, "answer_id": 29709395, "question_id": 29708972, "link": "https://stackoverflow.com/questions/29708972/there-is-bug-in-calculating-fibonacci-numbers-haskell/29709395#29709395", "title": "There is bug in calculating Fibonacci numbers - Haskell", "body": "<p>I think your code IS correct, tested using a naive implementation <code>fib0</code> from <a href=\"https://wiki.haskell.org/The_Fibonacci_sequence\" rel=\"nofollow\">here</a></p>\n\n<pre><code>import Control.Monad.State\n\nfib :: Int -&gt; Integer\nfib n = fst $ execState (replicateM n fibStep) (0,1)\n\nfibStep :: State (Integer,Integer) ()\nfibStep = do modify (\\(a, b) -&gt; (b, a + b))\n\nfib0 0 = 0\nfib0 1 = 1\nfib0 n = fib0 (n-1) + fib0 (n-2)\n</code></pre>\n\n<p>I tried:</p>\n\n<pre><code>*Main&gt; map (\\x -&gt; fib x - fib0 x) [1..25]\n</code></pre>\n\n<p>and got</p>\n\n<pre><code>[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]\n</code></pre>\n\n<p>Your function seems to give identical results as expected ones.</p>\n"}], "owner": {"reputation": 3366, "user_id": 1756750, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/db2912f03e4de7e109367b40f874fea6?s=128&d=identicon&r=PG", "display_name": "Denis", "link": "https://stackoverflow.com/users/1756750/denis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "closed_date": 1430150911, "accepted_answer_id": 29709395, "answer_count": 1, "score": 1, "last_activity_date": 1429305725, "creation_date": 1429303331, "question_id": 29708972, "link": "https://stackoverflow.com/questions/29708972/there-is-bug-in-calculating-fibonacci-numbers-haskell", "closed_reason": "Not suitable for this site", "title": "There is bug in calculating Fibonacci numbers - Haskell", "body": "<p>I solve different problems in some judging systems. Today I want to calculate Fibonacci numbers with <code>State Monad</code>. My code works well and it pass all my tests. But there is some error (one test is failed), which I can not determine. </p>\n\n<p>My code is:</p>\n\n<pre><code>fib :: Int -&gt; Integer\nfib n = fst $ execState (replicateM n fibStep) (0,1)\n\nfibStep :: State (Integer,Integer) ()\nfibStep = do modify (\\(a, b) -&gt; (b, a + b))\n</code></pre>\n\n<p>Can you help me to find the error? I don't know, where error is.</p>\n"}, {"tags": ["haskell", "syntax", "operator-keyword", "dollar-sign"], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 3, "last_activity_date": 1429294740, "creation_date": 1429294740, "answer_id": 29706663, "question_id": 29706448, "link": "https://stackoverflow.com/questions/29706448/dollar-sign-inside-closed-parens/29706663#29706663", "title": "Dollar sign inside closed parens", "body": "<p><code>($ fst client)</code> is an operator section (just like <code>(+ 1)</code> or <code>(* 2)</code>) - it partially applies the operator to its right operand. A more verbose way to write it would be <code>(\\f -&gt; f $ fst client)</code>.</p>\n\n<p>So you're applying <code>any</code> to a function that takes another function and applies that function to the argument <code>fst client</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 4, "creation_date": 1429306950, "post_id": 29706669, "comment_id": 47555311, "body": "It might be worth noting that these kinds of partial applications are called sections."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 13, "last_activity_date": 1429294764, "creation_date": 1429294764, "answer_id": 29706669, "question_id": 29706448, "link": "https://stackoverflow.com/questions/29706448/dollar-sign-inside-closed-parens/29706669#29706669", "title": "Dollar sign inside closed parens", "body": "<p>In Haskell, operators are just normal functions that have names made up of symbols and used infix by default. You can use them just like a normal identifier by wrapping them in parentheses:</p>\n\n<pre><code>\u03bb&gt; :t (+)\n(+) :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p><code>$</code> is just an operator like this itself. It represents function application and is defined as follows:</p>\n\n<pre><code>f $ x = f x\n</code></pre>\n\n<p>You can get its type just like <code>(+)</code>:</p>\n\n<pre><code>\u03bb&gt; :t ($)\n($) :: (a -&gt; b) -&gt; a -&gt; b\n</code></pre>\n\n<p>Haskell operators can also be partially applied like normal functions, by wrapping them in parentheses with arguments to one side. For example, <code>(+ 1)</code> is the same as <code>\\ x -&gt; x + 1</code> and <code>(1 +)</code> is the same as <code>\\x -&gt; 1 + x</code>.</p>\n\n<p>This applies to <code>$</code> too, so <code>($ fst client)</code> is the same as <code>\\ f -&gt; f $ fst client</code> or just <code>\\ f -&gt; f (fst client)</code>. The code snippet you have checks if <em>any</em> of a list of functions returns true given <code>fst client</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 339, "favorite_count": 0, "closed_date": 1469276642, "accepted_answer_id": 29706669, "answer_count": 2, "score": 5, "last_activity_date": 1469276660, "creation_date": 1429293888, "last_edit_date": 1469276660, "question_id": 29706448, "link": "https://stackoverflow.com/questions/29706448/dollar-sign-inside-closed-parens", "closed_reason": "Duplicate", "title": "Dollar sign inside closed parens", "body": "<p><a href=\"https://github.com/jaspervdj/websockets/blob/master/example/server.lhs#L108\">Websocket snippet</a> has a statement that has dollar sign inside closed parens like this,</p>\n\n<pre><code>any ($ fst client)\n</code></pre>\n\n<p>Since haskellers use <code>$</code> sign instead of parens, why do we need parens here?</p>\n\n<p>Why is there a <code>$</code> symbol between parens?</p>\n\n<p>I tried to see if <code>$</code> is a function by doing</p>\n\n<pre><code>Prelude&gt;:t $\n</code></pre>\n\n<p>But it threw the error, <code>parse error on input $</code></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1429289127, "post_id": 29704879, "comment_id": 47545462, "body": "You may find it helpful to look at the source code for <code>mapAccumL</code> in <code>Data.Traversable</code>. There should be some common patterns."}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 5, "last_activity_date": 1429290300, "last_edit_date": 1429290300, "creation_date": 1429289663, "answer_id": 29705174, "question_id": 29704879, "link": "https://stackoverflow.com/questions/29704879/how-to-log-operations-inside-foldl-function-haskell/29705174#29705174", "title": "How to log operations inside foldl function Haskell?", "body": "<p><strong><code>scanl</code></strong> might be a useful function.</p>\n\n<p>From Hoogle:</p>\n\n<blockquote>\n  <p>scanl is similar to foldl, but returns a list of successive reduced values from the left.</p>\n</blockquote>\n\n<p>So, you can see the progressive results as so:</p>\n\n<pre><code>\u03bb&gt; scanl (+) 0 [1,2,3]\n[0,1,3,6]\n\u03bb&gt; scanl (flip (:)) [] [1,2,3,4,5]\n[[],[1],[2,1],[3,2,1],[4,3,2,1],[5,4,3,2,1]]\n</code></pre>\n\n<hr>\n\n<p>If you're wanting writer-like results, it's simple. You don't even need to use <code>Writer</code>, and avoiding use of over-complex features is always good.</p>\n\n<pre><code>logSum = foldl (\\(n,s) x -&gt; (n+x, \"(\" ++ s ++ \"+\" ++ show x ++ \")\")) (0,\"0\")\n\n\u03bb&gt; logSum [1..2]\n(3, \"((0+1)+2)\")\n</code></pre>\n\n<p>I might add that <code>foldl</code> should describe <em>left associative operations</em>, but the brackets imply <em>right associativity</em> in the way that you're writing them.</p>\n\n<p>If you want it to be right-associative (like the <code>(:)</code> operator), it's easy; use <code>foldr</code>:</p>\n\n<pre><code> logSumR = foldr (\\x (n,s) -&gt; (x:n, show x ++ \" : \" ++ s)) ([],\"[]\")\n</code></pre>\n\n<p>So that:</p>\n\n<pre><code>\u03bb logSumR [1,2,3,4,5]\n([1,2,3,4,5], \"1 : 2 : 3 : 4 : 5 : []\")\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 634, "user_id": 4697270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7884aed17ee40cfaae6b53e6966b29ea?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4697270/david"}, "edited": false, "score": 0, "creation_date": 1429290171, "post_id": 29705257, "comment_id": 47546128, "body": "I am sorry, but what <code>&lt;*</code> means?"}, {"owner": {"reputation": 558, "user_id": 4751430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f424b8d7abc1bd4adaf69ca95412f3a?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Huschenbett", "link": "https://stackoverflow.com/users/4751430/martin-huschenbett"}, "reply_to_user": {"reputation": 634, "user_id": 4697270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7884aed17ee40cfaae6b53e6966b29ea?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4697270/david"}, "edited": false, "score": 0, "creation_date": 1429290653, "post_id": 29705257, "comment_id": 47546477, "body": "If you have two monadic computations <code>act1</code> and <code>act2</code>, then <code>act1 &lt;* act2</code> first executes <code>act1</code>, then <code>act2</code> and finally returns the result of <code>act1</code>. So, <code>act1 &lt;* act2 = act1 &gt;&gt;= \\r -&gt; act2 &gt;&gt; return r</code>. You can find <code>&lt;*</code> in <code>Control.Applicative</code>."}], "tags": [], "owner": {"reputation": 558, "user_id": 4751430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f424b8d7abc1bd4adaf69ca95412f3a?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Huschenbett", "link": "https://stackoverflow.com/users/4751430/martin-huschenbett"}, "is_accepted": false, "score": 2, "last_activity_date": 1429289896, "creation_date": 1429289896, "answer_id": 29705257, "question_id": 29704879, "link": "https://stackoverflow.com/questions/29704879/how-to-log-operations-inside-foldl-function-haskell/29705257#29705257", "title": "How to log operations inside foldl function Haskell?", "body": "<p>If you don't care too much about the parentheses, the following could be a good starting point:</p>\n\n<pre><code>sumWithLogging :: (Show a, Num a) =&gt; a -&gt; [a] -&gt; Writer String a\nsumWithLogging start list = foldlM step start list &lt;* tell (show list)\n    where step acc item = tell (show item ++ \"+\") &gt;&gt; return (item+acc)\n</code></pre>\n"}], "owner": {"reputation": 634, "user_id": 4697270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7884aed17ee40cfaae6b53e6966b29ea?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4697270/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 1, "accepted_answer_id": 29705174, "answer_count": 2, "score": 2, "last_activity_date": 1429290300, "creation_date": 1429288669, "question_id": 29704879, "link": "https://stackoverflow.com/questions/29704879/how-to-log-operations-inside-foldl-function-haskell", "title": "How to log operations inside foldl function Haskell?", "body": "<p>For example, I want to develop <code>sum</code> function, which will show the interim results. </p>\n\n<p>My basic function is:</p>\n\n<pre><code>ownPlus start list = foldr (+) start list\n</code></pre>\n\n<p>I want to add <code>Writer Monad</code> inside foldl. So prototype of my function is:</p>\n\n<pre><code>sumWithLogging :: (Show a, Num a) =&gt; a -&gt; [a] -&gt; Writer String a\nsumWithLogging start list = foldr ((+) do tell [\"msg\"]) start list\n</code></pre>\n\n<p>I have a problem with writing this function. But I want my result looks like this:</p>\n\n<pre><code>*Main&gt; runWriter $ sumWithLogging 0 [1..2]\n(3,\"(1+(2+0))\")\n</code></pre>\n"}, {"tags": ["haskell", "persistent"], "answers": [{"comments": [{"owner": {"reputation": 483, "user_id": 187393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1dda6a11add1af75fe216b993960241b?s=128&d=identicon&r=PG", "display_name": "Gautham Ganapathy", "link": "https://stackoverflow.com/users/187393/gautham-ganapathy"}, "edited": false, "score": 0, "creation_date": 1429281454, "post_id": 29700842, "comment_id": 47540234, "body": "Thanks! I&#39;d seen other code samples without those pragmas and assumed they were just comments. It&#39;s not compiling yet, but it&#39;s moved forward from the parse error. I&#39;ll try experimenting with selectively enabling these once I get it compiling."}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "reply_to_user": {"reputation": 483, "user_id": 187393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1dda6a11add1af75fe216b993960241b?s=128&d=identicon&r=PG", "display_name": "Gautham Ganapathy", "link": "https://stackoverflow.com/users/187393/gautham-ganapathy"}, "edited": false, "score": 0, "creation_date": 1431728682, "post_id": 29700842, "comment_id": 48638963, "body": "@GauthamGanapathy They use the same format as comments, but they are indeed special directives that tell GHC to enable the corresponding extension. You don&#39;t need to have them in your source file, but then you have to tell GHC which extensions to use through command-line flags."}, {"owner": {"reputation": 1455, "user_id": 706882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b8e621d3734b19dbb87061e1b9157e0?s=128&d=identicon&r=PG", "display_name": "sbditto85", "link": "https://stackoverflow.com/users/706882/sbditto85"}, "edited": false, "score": 1, "creation_date": 1506112772, "post_id": 29700842, "comment_id": 79705359, "body": "Just wanted to note that <code>{-# LANGUAGE QuasiQuotes                #-}</code> was what i was missing."}], "tags": [], "owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "is_accepted": true, "score": 2, "last_activity_date": 1429277898, "creation_date": 1429277898, "answer_id": 29700842, "question_id": 29700383, "link": "https://stackoverflow.com/questions/29700383/haskell-parse-error-when-using-database-persist-possibly-related-to-use-of-quas/29700842#29700842", "title": "Haskell parse error when using DataBase.Persist (possibly related to use of quasi quotes)", "body": "<p>Are you using the language pragmas suggested in the tutorial as well? In other words, does your source file begin with</p>\n\n<pre><code>{-# LANGUAGE EmptyDataDecls             #-}\n{-# LANGUAGE FlexibleContexts           #-}\n{-# LANGUAGE GADTs                      #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n{-# LANGUAGE OverloadedStrings          #-}\n{-# LANGUAGE QuasiQuotes                #-}\n{-# LANGUAGE TemplateHaskell            #-}\n{-# LANGUAGE TypeFamilies               #-}\n</code></pre>\n\n<p>All of them might not be needed, but you can figure out which ones are unneeded by removing one at a time until you have a minimal set that still compiles.</p>\n"}, {"comments": [{"owner": {"reputation": 483, "user_id": 187393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1dda6a11add1af75fe216b993960241b?s=128&d=identicon&r=PG", "display_name": "Gautham Ganapathy", "link": "https://stackoverflow.com/users/187393/gautham-ganapathy"}, "edited": false, "score": 0, "creation_date": 1429281521, "post_id": 29701077, "comment_id": 47540290, "body": "Thanks! I&#39;ll try out these pragmas. I did try indenting the [persistLowerCase|...|] section, but it didn&#39;t work at the time, maybe from the missing pragmas."}], "tags": [], "owner": {"reputation": 558, "user_id": 4751430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f424b8d7abc1bd4adaf69ca95412f3a?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Huschenbett", "link": "https://stackoverflow.com/users/4751430/martin-huschenbett"}, "is_accepted": false, "score": 2, "last_activity_date": 1429278433, "creation_date": 1429278433, "answer_id": 29701077, "question_id": 29700383, "link": "https://stackoverflow.com/questions/29700383/haskell-parse-error-when-using-database-persist-possibly-related-to-use-of-quas/29701077#29701077", "title": "Haskell parse error when using DataBase.Persist (possibly related to use of quasi quotes)", "body": "<p>You need to enable a lot of language extensions:</p>\n\n<pre><code>{-# LANGUAGE GADTs                      #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n{-# LANGUAGE QuasiQuotes                #-}\n{-# LANGUAGE TemplateHaskell            #-}\n{-# LANGUAGE TypeFamilies               #-}\n</code></pre>\n\n<p>In addition, the <code>[persistLowerCase| ... |]</code> must either begin on the same line as the <code>share</code> or be a bit indented since it is the second parameter to <code>share</code>. So, you might get:</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"]\n    [persistLowerCase|\n    Person\n        name String\n        age Int Maybe\n        deriving Show\n    BlogPost\n        title String\n        authorId PersonId\n        deriving Show\n    |]\n</code></pre>\n"}], "owner": {"reputation": 483, "user_id": 187393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1dda6a11add1af75fe216b993960241b?s=128&d=identicon&r=PG", "display_name": "Gautham Ganapathy", "link": "https://stackoverflow.com/users/187393/gautham-ganapathy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 29700842, "answer_count": 2, "score": 0, "last_activity_date": 1429278433, "creation_date": 1429276771, "question_id": 29700383, "link": "https://stackoverflow.com/questions/29700383/haskell-parse-error-when-using-database-persist-possibly-related-to-use-of-quas", "title": "Haskell parse error when using DataBase.Persist (possibly related to use of quasi quotes)", "body": "<p>I've taken part of the code from <a href=\"http://www.yesodweb.com/book/persistent\" rel=\"nofollow\">http://www.yesodweb.com/book/persistent</a> (Synopsis section) and am trying to load it into ghci (v7.6.3, running on Ubuntu 14.04).</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import           Database.Persist\nimport           Database.Persist.Sqlite\nimport           Database.Persist.TH\n\nshare [mkPersist sqlSettings, mkMigrate \"migrateAll\"] \n[persistLowerCase|\nPerson\n    name String\n    age Int Maybe\n    deriving Show\nBlogPost\n    title String\n    authorId PersonId\n    deriving Show\n|]\n</code></pre>\n\n<p>When loading this into ghci, I get the following error:</p>\n\n<pre><code>Prelude&gt; :load \"/home/gautham/tmp/Test.hs\"\n[1 of 1] Compiling Main             ( /home/gautham/tmp/Test.hs, interpreted )\n\n/home/gautham/tmp/Test.hs:7:1:\n    parse error (possibly incorrect indentation or mismatched brackets)\nFailed, modules loaded: none.\nPrelude&gt;\n</code></pre>\n\n<p>which is the line starting with 'Person'. Any idea what might be causing this? I've looked at several examples on the web and have tried several variations of indentations, but haven't been able to get this to compile. I assume it has something to do with incorrectly using the quasi quotes, but I'm not sure what?</p>\n\n<p>Cheers\nGautham</p>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1429271817, "post_id": 29697962, "comment_id": 47532923, "body": "I&#39;ve also wanted this, but this is unfortunaly not possible as far as I know. You only need 1 class though using singletons I think."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1429273781, "post_id": 29697962, "comment_id": 47534290, "body": "Why not just <code>parseF :: forall lt. (Read (Synonym lt), Show (Synonym lt)) =&gt; SLiftedType lt -&gt; String -&gt; String</code>? It&#39;s adequate for your purposes, as I understand it."}, {"owner": {"reputation": 929, "user_id": 427785, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/651918248d103d4459c5ecafe6e40864?s=128&d=identicon&r=PG", "display_name": "dbeacham", "link": "https://stackoverflow.com/users/427785/dbeacham"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1429275405, "post_id": 29697962, "comment_id": 47535518, "body": "@Andr&#225;sKov&#225;cs I&#39;ve added some further context to my motivating example. The value of <code>SLiftedType lt</code> isn&#39;t know up front - I&#39;m trying to parse <code>(String, String)</code> to <code>(LiftedType, String)</code> and then to <code>(SLiftedType lt, Synonym lt)</code>, but hiding the dependently typed part in the <code>SomeSing</code> case statement."}, {"owner": {"reputation": 929, "user_id": 427785, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/651918248d103d4459c5ecafe6e40864?s=128&d=identicon&r=PG", "display_name": "dbeacham", "link": "https://stackoverflow.com/users/427785/dbeacham"}, "reply_to_user": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1429275511, "post_id": 29697962, "comment_id": 47535594, "body": "@bennofs - what do you mean by only requiring one class?"}, {"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1429275613, "post_id": 29697962, "comment_id": 47535667, "body": "@dbeacham Right now, you need both Show and Read, I think you can reduce this to only requiring on class in the constraint."}, {"owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "edited": false, "score": 0, "creation_date": 1429275681, "post_id": 29697962, "comment_id": 47535713, "body": "Ah no, ignore me. I was confusing closed type families with closed kinds."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1429275918, "post_id": 29697962, "comment_id": 47535883, "body": "@dbeacham I don&#39;t think that rules out what I proposed. Just pattern match on <code>slt</code> in <code>SomeSing slt</code>, and you can deal with the non-showable/non-readable cases there."}, {"owner": {"reputation": 929, "user_id": 427785, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/651918248d103d4459c5ecafe6e40864?s=128&d=identicon&r=PG", "display_name": "dbeacham", "link": "https://stackoverflow.com/users/427785/dbeacham"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1429282769, "post_id": 29697962, "comment_id": 47541242, "body": "@Andr&#225;sKov&#225;cs Thanks, that works! It&#39;s pretty obvious now you mention it. However, it is a bit verbose given that 1. I actually have dozens of <code>LiftedType</code> constructors and 2. Every <code>Synonym lt</code> is an instance of Read/Show. Is there anything I can do to shorten it? It&#39;s not a massive problem if I can&#39;t as GHC will warn me if I&#39;ve missed any cases."}], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1429349664, "post_id": 29707149, "comment_id": 47565764, "body": "I assumed close familiarity with <code>singletons</code> in the answer. Please ask if something is unclear."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1429339231, "last_edit_date": 1429339231, "creation_date": 1429296368, "answer_id": 29707149, "question_id": 29697962, "link": "https://stackoverflow.com/questions/29697962/constrained-closed-type-family/29707149#29707149", "title": "Constrained closed type family", "body": "<p>The problem is that we can't put <code>Synonym</code> in an instance head because it's a type family, and we can't write a \"universally quantified\" constraint like <code>(forall x. Show (Synonym x)) =&gt; ...</code> because there's no such thing in Haskell. </p>\n\n<p>However, we can use two things:</p>\n\n<ul>\n<li><code>forall x. f x -&gt; a</code> is equivalent to <code>(exists x. f x) -&gt; a</code></li>\n<li><code>singletons</code>'s defunctionalization lets us put type families into instance heads anyway. </li>\n</ul>\n\n<p>So, we define an existential wrapper that works on <code>singletons</code>-style type functions:</p>\n\n<pre><code>data Some :: (TyFun k * -&gt; *) -&gt; * where\n  Some :: Sing x -&gt; f @@ x -&gt; Some f\n</code></pre>\n\n<p>And we also include the defunctionalization symbol for <code>LiftedType</code>:</p>\n\n<pre><code>import Data.Singletons.TH\nimport Text.Read\nimport Control.Applicative\n\n$(singletons [d| data LiftedType = V1 | V2 | V3 deriving (Eq, Show) |])\n\ntype family Synonym t where\n  Synonym V1 = Int\n  Synonym V2 = ()\n  Synonym V3 = Char\n\ndata SynonymS :: TyFun LiftedType * -&gt; * -- the symbol for Synonym\ntype instance Apply SynonymS t = Synonym t\n</code></pre>\n\n<p>Now, we can use <code>Some SynonymS -&gt; a</code> instead of <code>forall x. Synonym x -&gt; a</code>, and this form can be also used in instances.</p>\n\n<pre><code>instance Show (Some SynonymS) where\n  show (Some SV1 x) = show x\n  show (Some SV2 x) = show x\n  show (Some SV3 x) = show x\n\ninstance Read (Some SynonymS) where\n  readPrec = undefined -- I don't bother with this now...\n\nparseLTandSynonym :: LiftedType -&gt; String -&gt; String\nparseLTandSynonym lt x =\n  case (toSing lt) of\n    SomeSing (slt :: SLiftedType lt') -&gt; parseSynonym slt x\n\nparseSynonym :: forall lt. SLiftedType lt -&gt; String -&gt; String\nparseSynonym slt flv =\n      case (readEither flv :: Either String (Some SynonymS)) of\n        Left err -&gt; \"Can't parse synonym: \" ++ err\n        Right x  -&gt; \"Synonym value: \" ++ show x \n</code></pre>\n\n<p>This doesn't directly provide us <code>Read (Synonym t)</code> for any specific choice of <code>t</code>, although we can still read <code>Some SynonymS</code> and then pattern match on the existential tag to check if we got the right type (and fail if it's not right). This pretty much covers all the use cases of <code>read</code>.</p>\n\n<p>If that's not good enough, we can use another wrapper, and lift <code>Some f</code> instances to \"universally quantified\" instances. </p>\n\n<pre><code>data At :: (TyFun k * -&gt; *) -&gt; k -&gt; * where\n  At :: Sing x -&gt; f @@ x -&gt; At f x\n</code></pre>\n\n<p><code>At f x</code> is equivalent to <code>f @@ x</code>, but we can write instances for it. In particular, we can write a sensible universal <code>Read</code> instance here.</p>\n\n<pre><code>instance (Read (Some f), SDecide (KindOf x), SingKind (KindOf x), SingI x) =&gt;\n  Read (At f x) where\n    readPrec = do\n      Some tag x &lt;- readPrec :: ReadPrec (Some f)\n      case tag %~ (sing :: Sing x) of\n        Proved Refl -&gt; pure (At tag x)\n        Disproved _ -&gt; empty\n</code></pre>\n\n<p>We first parse a <code>Some f</code>, then check whether the parsed type index is equal to the index we'd like to parse. It's an abstraction of the pattern I mentioned above for parsing types with specific indices. It's more convenient because we only have a single case in the pattern match on <code>At</code>, no matter how many indices we have. Notice though the <code>SDecide</code> constraint. It provides the <code>%~</code> method, and <code>singletons</code> derives it for us if we include <code>deriving Eq</code> in the singleton data definitions. Putting this to use:</p>\n\n<pre><code>parseSynonym :: forall lt. SLiftedType lt -&gt; String -&gt; String\nparseSynonym slt flv = withSingI slt $ \n      case (readEither flv :: Either String (At SynonymS lt)) of\n        Left err -&gt; \"Can't parse synonym: \" ++ err\n        Right (At tag x)  -&gt; \"Synonym value: \" ++ show (Some tag x :: Some SynonymS)\n</code></pre>\n\n<p>We can also make the conversion between <code>At</code> and <code>Some</code> a bit easier:</p>\n\n<pre><code>curry' :: (forall x. At f x -&gt; a) -&gt; Some f -&gt; a\ncurry' f (Some tag x) = f (At tag x)\n\nuncurry' :: (Some f -&gt; a) -&gt; At f x -&gt; a\nuncurry' f (At tag x) = f (Some tag x)\n\nparseSynonym :: forall lt. SLiftedType lt -&gt; String -&gt; String\nparseSynonym slt flv = withSingI slt $ \n      case (readEither flv :: Either String (At SynonymS lt)) of\n        Left err -&gt; \"Can't parse synonym: \" ++ err\n        Right atx  -&gt; \"Synonym value: \" ++ uncurry' show atx\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 0, "last_activity_date": 1429332171, "creation_date": 1429332171, "answer_id": 29712980, "question_id": 29697962, "link": "https://stackoverflow.com/questions/29697962/constrained-closed-type-family/29712980#29712980", "title": "Constrained closed type family", "body": "<p>If I understand correctly what you want to do, this is not possible. If it were, you could easily construct a non-constant function of type <code>Proxy t -&gt; Bool</code>, along the lines of</p>\n\n<pre><code>data YesNo = Yes | No\nclass Foo (yn :: YesNo) where foo :: Proxy yn -&gt; Bool\ntype family (Foo (T t) =&gt; T t) where\n    T X = Yes\n    T y = No\n\nf :: forall t. Proxy t -&gt; Bool\nf _ = foo (Proxy (T t))\n</code></pre>\n\n<p>But you cannot construct such a function, even when all the kinds involved are closed (which is of course either a feature or a limitation of GHC, depending on your point of view).</p>\n"}], "owner": {"reputation": 929, "user_id": 427785, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/651918248d103d4459c5ecafe6e40864?s=128&d=identicon&r=PG", "display_name": "dbeacham", "link": "https://stackoverflow.com/users/427785/dbeacham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "accepted_answer_id": 29707149, "answer_count": 2, "score": 10, "last_activity_date": 1429339231, "creation_date": 1429270166, "last_edit_date": 1429291043, "question_id": 29697962, "link": "https://stackoverflow.com/questions/29697962/constrained-closed-type-family", "title": "Constrained closed type family", "body": "<p>Can I convince the compiler that a constraint is always satisfied by the type synonyms in a closed type family? The family is indexed by a finite set of promoted values.</p>\n\n<p>Something along the lines of</p>\n\n<pre><code>data NoShow = NoShow\ndata LiftedType = V1 | V2 | V3\n\ntype family (Show (Synonym (a :: LiftedType)) =&gt; Synonym (a :: LiftedType)) where\n  Synonym V1 = Int\n  Synonym V2 = NoShow -- no Show instance =&gt; compilation error\n  Synonym V3 = ()\n</code></pre>\n\n<p>I can enforce a constraint on open type families:</p>\n\n<pre><code>class (Show (Synonym a)) =&gt; SynonymClass (a :: LiftedType) where\n  type Synonym a\n  type Synonym a = ()\n\ninstance SynonymClass Int where\n  type Synonym V1 = Int\n\n-- the compiler complains here\ninstance SynonymClass V2 where\n  type Synonym V2 = NoShow\n\ninstance SynonymClass V3\n</code></pre>\n\n<p>but the compiler would then have to be able to reason about the fact that there exists an instance of <code>SynonymClass a</code> for each of <code>V1</code>, <code>V2</code> and <code>V3</code>? But in any case, I'd prefer not to use an open type family.</p>\n\n<p>My motivation for requiring this is that I want to convince the compiler that all instances of a closed type family in my code have Show/Read instances. A simplified example is:</p>\n\n<pre><code>parseLTandSynonym :: LiftedType -&gt; String -&gt; String\nparseLTandSynonym lt x =\n  case (toSing lt) of\n    SomeSing (slt :: SLiftedType lt') -&gt; parseSynonym slt x\n\nparseSynonym :: forall lt. SLiftedType lt -&gt; String -&gt; String\nparseSynonym slt flv =\n      case (readEither flv :: Either String (Synonym lt)) of\n        Left err -&gt; \"Can't parse synonym: \" ++ err\n        Right x  -&gt; \"Synonym value: \" ++ show x \n</code></pre>\n\n<p>[Someone mentioned in the comments that it's not possible - is this because it's technically impossible (and if so, why) or just a limitation of the GHC implementation?]</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install", "ghcjs"], "comments": [{"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 0, "creation_date": 1429264321, "post_id": 29695048, "comment_id": 47527848, "body": "You need to install <code>autoreconf</code>, I can&#39;t help with OS X installation, but I am pretty sure you would be able to find the instructions in the internet."}, {"owner": {"reputation": 142, "user_id": 4718903, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bSjBU.jpg?s=128&g=1", "display_name": "Yiyue Wang", "link": "https://stackoverflow.com/users/4718903/yiyue-wang"}, "reply_to_user": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 0, "creation_date": 1429283086, "post_id": 29695048, "comment_id": 47541484, "body": "@zudov Oh I solved it :) Thanks a lot!"}], "answers": [{"comments": [{"owner": {"reputation": 142, "user_id": 4718903, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bSjBU.jpg?s=128&g=1", "display_name": "Yiyue Wang", "link": "https://stackoverflow.com/users/4718903/yiyue-wang"}, "edited": false, "score": 0, "creation_date": 1429283026, "post_id": 29696003, "comment_id": 47541436, "body": "Thank you very much! Solved :)"}], "tags": [], "owner": {"reputation": 558, "user_id": 4751430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f424b8d7abc1bd4adaf69ca95412f3a?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Huschenbett", "link": "https://stackoverflow.com/users/4751430/martin-huschenbett"}, "is_accepted": true, "score": 2, "last_activity_date": 1429264540, "last_edit_date": 1495535334, "creation_date": 1429264540, "answer_id": 29696003, "question_id": 29695048, "link": "https://stackoverflow.com/questions/29695048/fatal-program-autoreconf-is-required-but-was-not-found/29696003#29696003", "title": "fatal: program autoreconf is required but was not found", "body": "<p>Your system is lacking the <code>auto(re)conf</code> tool which is (unfortunately) not installed with XCode any more. There is an old post explaining how to install <code>auto(re)conf</code> on OS X manually:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/9575989/install-autoreconf-on-osx-lion\">Install autoreconf on OSX lion?</a></p>\n"}, {"tags": [], "owner": {"reputation": 1909, "user_id": 379286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d79bbad3d9b2d3128f0ae2bb8e6d6459?s=128&d=identicon&r=PG", "display_name": "Bhoom Suktitipat", "link": "https://stackoverflow.com/users/379286/bhoom-suktitipat"}, "is_accepted": false, "score": 3, "last_activity_date": 1456475647, "creation_date": 1456475647, "answer_id": 35646951, "question_id": 29695048, "link": "https://stackoverflow.com/questions/29695048/fatal-program-autoreconf-is-required-but-was-not-found/35646951#35646951", "title": "fatal: program autoreconf is required but was not found", "body": "<p>Just to make life a bit easier for subsequent users who landed here. </p>\n\n<p>If you have already installed homebrew, </p>\n\n<p><code>brew install automake</code> will install the autoreconf for you. </p>\n"}], "owner": {"reputation": 142, "user_id": 4718903, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bSjBU.jpg?s=128&g=1", "display_name": "Yiyue Wang", "link": "https://stackoverflow.com/users/4718903/yiyue-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2014, "favorite_count": 0, "accepted_answer_id": 29696003, "answer_count": 2, "score": 1, "last_activity_date": 1456475647, "creation_date": 1429262048, "question_id": 29695048, "link": "https://stackoverflow.com/questions/29695048/fatal-program-autoreconf-is-required-but-was-not-found", "title": "fatal: program autoreconf is required but was not found", "body": "<p>I followed the installation of GHCJS and when I came to the step \"Build the libraries\" and I typed the command <code>ghcjs-boot --dev</code>\nBut I get the following lines in my Terminal</p>\n\n<pre><code>(lines omitted)...\ngenerating configure script for ./boot/base\nMyDir/.ghcjs/x86_64-darwin-0.1.0-7.8.3/ghcjs/ghcjs-boot/boot/base$ [autoreconf]: &lt;not found&gt; \nfatal: program autoreconf is required but was not found\nname searched for (from boot.yaml or command line): autoreconf\nsearched in PATH:\nMyDir/Haskell/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/opt/X11/bin:MyDir/Haskell/bin\n</code></pre>\n\n<p>Does anyone know what's wrong here?</p>\n"}, {"tags": ["haskell", "ghc", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1429456947, "post_id": 29698100, "comment_id": 47596739, "body": "I wonder to what extend functions can be used on the type level. I am under the impression that you can use normal list functions there, but a quick experiment didn&#39;t confirm it."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 6, "last_activity_date": 1429298336, "last_edit_date": 1429298336, "creation_date": 1429270702, "answer_id": 29698100, "question_id": 29694714, "link": "https://stackoverflow.com/questions/29694714/how-to-generalize-dependently-sized-arrays-to-n-dimensions/29698100#29698100", "title": "How to generalize dependently sized arrays to n dimensions?", "body": "<p>This can be indeed done with type classes. Some preliminaries:</p>\n\n<pre><code>{-# LANGUAGE\n  UndecidableInstances, MultiParamTypeClasses, TypeFamilies,\n  ScopedTypeVariables, FunctionalDependencies, TypeOperators,\n  DataKinds, FlexibleInstances #-}\n\nimport qualified Data.Vector as V\n\nimport GHC.TypeLits\nimport Data.Proxy\n\nnewtype NVec (shape :: [Nat]) a = NVec {_data :: V.Vector a}\n</code></pre>\n\n<p>Before anything else, we should be able to tell the overall flat size of an n-dimensional vector. We'll use this to compute strides for indexing. We use a class to recurse on the type-level list.</p>\n\n<pre><code>class FlatSize (sh :: [Nat]) where\n  flatSize :: Proxy sh -&gt; Int\n\ninstance FlatSize '[] where\n  flatSize _ = 1\n\ninstance (KnownNat s, FlatSize ss) =&gt; FlatSize (s ': ss) where\n  flatSize _ = fromIntegral (natVal (Proxy :: Proxy s)) * flatSize (Proxy :: Proxy ss)       \n</code></pre>\n\n<p>We use a type class for indexing too. We provide different instances for the one-dimensional case (where we simply index into the underlying vector) and the higher-dimensional case (where we return a new <code>NVec</code> with reduced dimension). We use the same class for both cases, though.</p>\n\n<pre><code>infixl 5 !                                            \nclass Index (sh :: [Nat]) (a :: *) (b :: *) | sh a -&gt; b where\n  (!) :: NVec sh a -&gt; Int -&gt; b\n\ninstance Index '[s] a a where\n  (NVec v) ! i = v V.! i         \n\ninstance (Index (s2 ': ss) a b, FlatSize (s2 ': ss), res ~ NVec (s2 ': ss) a) \n  =&gt; Index (s1 ': s2 ': ss) a res where\n  (NVec v) ! i = NVec (V.slice (i * stride) stride v)\n    where stride = flatSize (Proxy :: Proxy (s2 ': ss))\n</code></pre>\n\n<p>Indexing into a higher-dimensional vector is just taking a slice with the flat size of the resulting vector and the appropriate offset. </p>\n\n<p>Some testing:</p>\n\n<pre><code>fromList :: forall a sh. FlatSize sh =&gt; [a] -&gt; NVec sh a\nfromList as | length as == flatSize (Proxy :: Proxy sh) = NVec (V.fromList as)\nfromList _ = error \"fromList: initializer list has wrong size\"\n\nv3 :: NVec [2, 2, 2] Int\nv3 = fromList [\n  2, 4,\n  5, 6,\n\n  10, 20,\n  30, 0 ]\n\nv2 :: NVec [2, 2] Int\nv2 = v3 ! 0\n\nvElem :: Int\nvElem = v3 ! 0 ! 1 ! 1 -- 6 \n</code></pre>\n\n<hr>\n\n<p>As an extra, let me present a <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow\"><code>singletons</code></a> solution too, because it's considerably more convenient. It lets us reuse more code (less custom typeclasses for a single function) and write in a more direct, functional style. </p>\n\n<pre><code>{-# LANGUAGE\n  UndecidableInstances, MultiParamTypeClasses, TypeFamilies,\n  ScopedTypeVariables, FunctionalDependencies, TypeOperators,\n  DataKinds, FlexibleInstances, StandaloneDeriving, DeriveFoldable,\n  GADTs, FlexibleContexts #-}\n\nimport qualified Data.Vector as V\nimport qualified Data.Foldable as F\nimport GHC.TypeLits\nimport Data.Singletons.Preludeimport \nimport Data.Singletons.TypeLits\n\nnewtype NVec (shape :: [Nat]) a = NVec {_data :: V.Vector a}\n</code></pre>\n\n<p><code>flatSize</code> becomes much simpler: we just lower the <code>sh</code> to the value level, and operate on it as usual:</p>\n\n<pre><code>flatSize :: Sing (sh :: [Nat]) -&gt; Int\nflatSize = fromIntegral . product . fromSing\n</code></pre>\n\n<p>We use a type family and a function for indexing. In the previous solution we used instances to dispatch on the dimensions; here we do the same with pattern matching:</p>\n\n<pre><code>type family Index (shape :: [Nat]) (a :: *) where\n  Index (s  ': '[])       a = a\n  Index (s1 ':  s2 ': ss) a = NVec (s2 ': ss) a\n\ninfixl 5 !\n(!) :: forall a sh. SingI sh =&gt; NVec sh a -&gt; Int -&gt; Index sh a\n(!) (NVec v) i = case (sing :: Sing sh) of\n  SCons _ SNil       -&gt; v V.! i\n  SCons _ ss@SCons{} -&gt; NVec (V.slice (i * stride) stride v) where\n    stride = flatSize ss\n</code></pre>\n\n<p>We can also use the <code>Nat</code> singletons for safe indexing and initialization (i. e. with statically checked bounds and sizes). For initialization we define a list type with static size (<code>Vec</code>). </p>\n\n<pre><code>safeIx ::\n  forall a s sh i. (SingI (s ': sh), (i + 1) &lt;= s) =&gt;\n  NVec (s ': sh) a -&gt; Sing i -&gt; Index (s ': sh) a\nsafeIx v si = v ! (fromIntegral $ fromSing si)                    \n\ndata Vec n a where\n  VNil :: Vec 0 a\n  (:&gt;) :: a -&gt; Vec (n - 1) a -&gt; Vec n a\ninfixr 5 :&gt;\nderiving instance F.Foldable (Vec n)\n\nfromVec :: forall a sh. SingI sh =&gt; Vec (Foldr (:*$) 1 sh) a -&gt; NVec sh a\nfromVec = fromList . F.toList\n</code></pre>\n\n<p>Some examples for the safe functions:</p>\n\n<pre><code>-- Other than 8 elements in the Vec would be a type error\nv3 :: NVec [2, 2, 2] Int\nv3 = fromVec\n     (2 :&gt; 4  :&gt;\n      5 :&gt; 6  :&gt;\n\n      10 :&gt; 20 :&gt;\n      30 :&gt; 0  :&gt; VNil)\n\nvElem :: Int\nvElem = v3\n  `safeIx` (sing :: Sing 0)\n  `safeIx` (sing :: Sing 1)\n  `safeIx` (sing :: Sing 1) -- 6\n</code></pre>\n"}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 2, "accepted_answer_id": 29698100, "answer_count": 1, "score": 7, "last_activity_date": 1429298336, "creation_date": 1429261176, "question_id": 29694714, "link": "https://stackoverflow.com/questions/29694714/how-to-generalize-dependently-sized-arrays-to-n-dimensions", "title": "How to generalize dependently sized arrays to n dimensions?", "body": "<p>I have been toying with this for some time now but I haven't been able to convince GHC to make this work.</p>\n\n<p>Basically it is quite easy to create dependently sized arrays in current versions of Haskell/GHC:</p>\n\n<pre><code>newtype Arr1 (w :: Nat) a = Arr1 (Int -&gt; a)\nnewtype Arr2 (w :: Nat) (h :: Nat) a = Arr2 (Int -&gt; a)\n\nix2 :: forall w h a. (KnownNat w) =&gt; Arr2 w h a -&gt; Int -&gt; Int -&gt; a\nix2 (Arr2 f) x y = f ( y * w + x )\n    where w = fromInteger $ natVal (Proxy :: Proxy w)\n\nsub2 :: forall w h a. (KnownNat w) =&gt; Arr2 w h a -&gt; Int -&gt; Arr1 w a\nsub2 (Arr2 f) y = Arr1 $ \\x -&gt; f (y * w + x)\n    where w = fromInteger $ natVal (Proxy :: Proxy w)\n\nmkArr2V :: forall w h a. (V.Unbox a, KnownNat w, KnownNat h) =&gt; V.Vector a -&gt; Arr2 w h a\nmkArr2V v = Arr2 $ (v V.!)\n\n-- and so on ... errorchecking neglected\n</code></pre>\n\n<p>But current GHC versions give us much more expressibility. Basically it should be possible to create a single type for this:</p>\n\n<pre><code>newtype Mat (s :: [Nat]) a = Mat (Int -&gt; a)\n\n-- create array backed by vector\nmkMatV :: forall s a. V.Vector a -&gt; Mat s a\nmkMatV v = Mat $ (v V.!)\n</code></pre>\n\n<p>This works in GHCi:</p>\n\n<pre><code>&gt;&gt;&gt; let m = mkMatV (V.fromList [1,2,3,4]) :: Mat [2,2] Double\n&gt;&gt;&gt; :t m\nm :: Mat '[2, 2] Double\n</code></pre>\n\n<p>But up to this point I am unsure on how to accomplish indexing into the arrays. A simple solution would be to use two different functions for nd and 1d indexing. Note this does not typecheck.</p>\n\n<pre><code>-- slice from nd array\n(!) :: forall s ss a. (KnownNat s) =&gt; Mat (s ': ss) a -&gt; Int -&gt; Mat ss a\n(!) (Mat f) o = Mat $ \\i -&gt; f (o*s+i)\n    where s = fromInteger $ natVal (Proxy :: Proxy (sum ss))\n\n-- index into 1d array\n(#) :: forall s ss a. (KnownNat s) =&gt; Mat (s ': '[]) a -&gt; Int -&gt; a\n(#) (Mat f) o = Mat $ \\i -&gt; f o\n</code></pre>\n\n<p>Probably usable like this:</p>\n\n<pre><code>&gt;&gt;&gt; :t m ! 0\nMat [2] Double\n&gt;&gt;&gt; m ! 0 # 0\n1\n</code></pre>\n\n<p>Not that it is necessary to give indices in z,y,x order. My prefered solution would provide a single indexing function that changes it's return type based on the dimensionality of the array. To my knowledge this can somehow be achieved by using type classes, but I haven't figured that out yet. Bonus points if indices can be given in \"natural\" x,y,z order.</p>\n\n<p><strong>tl;dr</strong>: I am asking for a function that indexes n-dimensional arrays as defined above.</p>\n"}, {"tags": ["haskell", "intellij-idea"], "owner": {"reputation": 479, "user_id": 3158988, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c78bf99ebe9c08f45fbae84e42985657?s=128&d=identicon&r=PG&f=1", "display_name": "user4758246", "link": "https://stackoverflow.com/users/3158988/user4758246"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 498, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1487862397, "creation_date": 1429259510, "last_edit_date": 1487862397, "question_id": 29694133, "link": "https://stackoverflow.com/questions/29694133/using-haskell-repl-in-intellij", "title": "Using Haskell REPL in IntelliJ", "body": "<p>I installed the Haskell Plugin in IntelliJ. Opening the Haskell REPL produces the following Errors</p>\n\n<p>Opening the first time:</p>\n\n<pre><code>10:10:05 NoClassDefFoundError:      com/intellij/execution/console/LanguageConsoleViewImpl\n</code></pre>\n\n<p>If it try to open it again</p>\n\n<pre><code>10:20:40 NoClassDefFoundError: com/intellij/execution/process/ConsoleHistoryModel\n</code></pre>\n\n<p>Here are table summarizing the versions of my tools.</p>\n\n<pre><code>+================+==========+\n|      Tool      | Version  |\n+================+==========+\n| GHC            |    7.8.3 |\n+----------------+----------+\n| Cabal          | 1.18.0.5 |\n+----------------+----------+\n| Intellij       |   14.1.1 |\n+----------------+----------+\n| Haskell Plugin |    0.5.0 |\n+----------------+----------+\n</code></pre>\n\n<p>The REPL Console works in Eclipse with the EclipseFP Plugin. Compiling and starting a Haskell program (in Intellij) works fine. </p>\n\n<p>Does anyone know how to fix this, so I use Haskell REPL in Intellij?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "edited": false, "score": 1, "creation_date": 1429251636, "post_id": 29691669, "comment_id": 47519966, "body": "I think, you missed the <b>`</b> symbol around <i>div</i> inside <i>map (numerator div)</i>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "reply_to_user": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "edited": false, "score": 1, "creation_date": 1429251779, "post_id": 29691669, "comment_id": 47520033, "body": "yes, it is the stack.overflow effect.. lemme correct it..."}], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 4, "last_activity_date": 1429352524, "last_edit_date": 1592644375, "creation_date": 1429251848, "answer_id": 29691810, "question_id": 29691669, "link": "https://stackoverflow.com/questions/29691669/map-function-takes-non-function-as-first-argument/29691810#29691810", "title": "Map function takes non-function as first argument", "body": "<h2>on eta-conversions and signatures</h2>\n<p>First I think you missed some <code>`</code>: in <code>numerator `div` </code> (yep I think SO ate them - you have to input this as <code>`` numerator `div` ``</code> to work!)</p>\n<p>This:</p>\n<pre><code>divBy :: Integral a =&gt; a -&gt; [a] -&gt; [a]\ndivBy numerator = map (numerator `div`)\n</code></pre>\n<p>is another way of writing</p>\n<pre><code>divBy :: Integral a =&gt; a -&gt; [a] -&gt; [a]\ndivBy = \\ numerator -&gt; map (numerator `div`)\n</code></pre>\n<p>which can be expanded to</p>\n<pre><code>divBy :: Integral a =&gt; a -&gt; [a] -&gt; [a]\ndivBy = \\ numerator ns -&gt; map (numerator `div`) ns\n</code></pre>\n<p>if you want to can then put the arguments back to the left:</p>\n<pre><code>divBy :: Integral a =&gt; a -&gt; [a] -&gt; [a]\ndivBy numerator ns -&gt; map (numerator `div`) ns\n</code></pre>\n<p>and here it might be more clear that <code>numerator</code> is the first argument (of type <code>a</code>) and <code>ns</code> is the second (of type <code>[a]</code>) while <code>divBy</code> is of course the name of the function.</p>\n<p>This works because there is something named <a href=\"https://wiki.haskell.org/Eta_conversion\" rel=\"nofollow noreferrer\">eta conversion</a> that basically says that you can shorten <code>\\x -&gt; f x</code> to just <code>f</code> - but watch out sometimes you <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow noreferrer\">run into trouble</a> with this but it's often used to write <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow noreferrer\"><em>point-free-style</em></a> Haskell code.</p>\n<h2>your questions</h2>\n<blockquote>\n<p>What confuses me is</p>\n<p>why there are two variables on LHS divBy and numerator in the expression:</p>\n</blockquote>\n<pre><code>divBy numerator = map (numerator `div`)\n</code></pre>\n<p><strong>Answer</strong>: those are not <em>variables</em> - the first is the name of the function you are declaring in this line and the second is a name for it's first argument.</p>\n<p>You might wonder where the second went (see above) - the short answer is: <code>divBy</code> is really a function that takes an <code>a</code> and returns yet another function <code>[a] -&gt; [a]</code> and so there is really only one argument you have to give as long as you return a function (and you do).</p>\n<blockquote>\n<p>What values, the variables divBy and numerator are assigned at the end?</p>\n</blockquote>\n<p><strong>Answer</strong>: As I said <code>divBy</code> is the name for your function - <code>numerator</code> will get the first argument so in</p>\n<pre><code> \u03bb&gt; divBy 5 [1..10]\n [5,2,1,1,1,0,0,0,0,0]\n</code></pre>\n<p><code>numerator</code> is the <code>5</code></p>\n<blockquote>\n<p>map function type is <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code> In the above expression, the argument <code>numerator</code> is not a function type, and <code>div</code> is not of array type. But the code is working!!</p>\n<p>What am i missing here?</p>\n</blockquote>\n<p>Basically you are missing the parentheses - <code>(numerator `div`)</code> is a so called <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"nofollow noreferrer\"><em>section</em></a> - it is really the function <code>\\n -&gt; numerator `div` n</code> - think of it as having a <em>hole</em> at the second argument of the <em>infix</em> <code>`div`</code>: (disclaimer: pseudocode) <code>(numerator `div` _)</code>.</p>\n<p>So <code>(numerator `div`)</code> is really a function <code>Integral a =&gt; a -&gt; a</code> and so it fits the first argument of <code>map</code>.</p>\n<p>Now where is the second? Well again that is the same story as above: <code>map (numerator `div`)</code> is a function <code>Integral a =&gt; [a] -&gt; [a]</code> and that is what was missing for the right side of your declaration <code>divBy numerator</code>.</p>\n<p>I hope you can figure it out with what I gave you in the first part of this answer.</p>\n<p>If you have question leave a comment - I'll try to add explanations where needed.</p>\n"}, {"tags": [], "owner": {"reputation": 555, "user_id": 4108393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1616347e88a4828ad7b5eaf6dff2337?s=128&d=identicon&r=PG&f=1", "display_name": "G Philip", "link": "https://stackoverflow.com/users/4108393/g-philip"}, "is_accepted": false, "score": 1, "last_activity_date": 1429254574, "creation_date": 1429254574, "answer_id": 29692534, "question_id": 29691669, "link": "https://stackoverflow.com/questions/29691669/map-function-takes-non-function-as-first-argument/29692534#29692534", "title": "Map function takes non-function as first argument", "body": "<p>I would read this code like this:</p>\n\n<p>The type of <code>divBy</code> says that it takes two arguments [1], an <code>a</code> and an <code>[a]</code>, but the LHS of its declaration shows only one argument, namely <code>numerator</code>. So let me add the second argument myself, to complete the picture:</p>\n\n<p><code>divBy numerator xs = map (numerator `div`) xs</code></p>\n\n<p>Note that I used the name <code>xs</code> (read as x-es as in \"more than one x\") because the second argument is a list. I could have used, say <code>x</code> instead, but using <code>xs</code> is a visual reminder that the thing is a list, and it helps a lot in avoiding confusion later.</p>\n\n<p>Now things look a bit clearer: </p>\n\n<ol>\n<li>Saying <code>divBy numerator xs</code> is exactly the same as saying <code>map (numerator `div`) xs</code> : Wherever I see the former expression, I can replace it with the latter expression.</li>\n<li><code>map (numerator `div`) xs</code> looks reasonably fine to me: the second argument to <code>map</code>, <code>xs</code>, is definitely a list, as it should be. The first argument to <code>map</code>, <code>(numerator `div`)</code>, needs to be a function of type <code>a -&gt; a</code> where <code>a</code> is a type which is an instance of <code>Integral</code>. That is, <code>(numerator `div`) :: Integral a =&gt; a -&gt; a</code> must hold. So now I only need to concern myself with why this would be the case.</li>\n<li>I try to figure out why <code>(numerator `div`)</code> has type <code>Integral a =&gt; a -&gt; a</code>. The other answers have explained why this is the case, and I am happy!</li>\n</ol>\n\n<p>[1] To be pedantic, <code>divBy</code> only takes one argument etc., but I am now being pedagogic instead. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "accepted_answer_id": 29691810, "answer_count": 2, "score": 3, "last_activity_date": 1429352524, "creation_date": 1429251211, "last_edit_date": 1429288882, "question_id": 29691669, "link": "https://stackoverflow.com/questions/29691669/map-function-takes-non-function-as-first-argument", "title": "Map function takes non-function as first argument", "body": "<pre><code>-- file: ch19/divby1.hs\ndivBy :: Integral a =&gt; a -&gt; [a] -&gt; [a]\ndivBy numerator = map (numerator `div`)\n</code></pre>\n\n<p>This is the code excerpt from O'reilly - Haskell book.</p>\n\n<p>sample run as,</p>\n\n<pre><code>ghci&gt; divBy 50 [1,2,5,8,10]\n[50,25,10,6,5]\n</code></pre>\n\n<p>What confuses me is</p>\n\n<ol>\n<li><p>why there are two variables on LHS <code>divBy</code> and <code>numerator</code> in the expression:</p>\n\n<pre><code>divBy numerator = map (numerator `div`)\n</code></pre></li>\n</ol>\n\n<p>What values are the variables <code>divBy</code> and <code>numerator</code> assigned at the end?</p>\n\n<ol start=\"2\">\n<li><code>map</code> function type is\n<code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code>.\nIn the above expression, the argument <code>numerator</code> is not a function type, and \n<code>div</code> is not of array type. But the code is working!!</li>\n</ol>\n\n<p>What am I missing here?</p>\n"}, {"tags": ["haskell", "cabal", "ghcjs"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1429248621, "post_id": 29690766, "comment_id": 47518624, "body": "Do you have ~/.cabal/bin in your PATH?"}, {"owner": {"reputation": 142, "user_id": 4718903, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bSjBU.jpg?s=128&g=1", "display_name": "Yiyue Wang", "link": "https://stackoverflow.com/users/4718903/yiyue-wang"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1429248776, "post_id": 29690766, "comment_id": 47518689, "body": "@MichaelSnoyman Mmm... Sorry but how to check whether it&#39;s in my path?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1429249616, "post_id": 29690766, "comment_id": 47519031, "body": "@YiyueWang <code>echo $PATH</code> in your terminal (it will print the content of your <code>PATH</code> variable - look if you can find the path to your <code>home-directory&#47;.cabal&#47;bin</code> in there)"}, {"owner": {"reputation": 142, "user_id": 4718903, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bSjBU.jpg?s=128&g=1", "display_name": "Yiyue Wang", "link": "https://stackoverflow.com/users/4718903/yiyue-wang"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429249983, "post_id": 29690766, "comment_id": 47519188, "body": "@CarstenK&#246;nig Thank you very much! I&#39;ve solved the problem now :) And do you know how I can close this question?"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1429250194, "post_id": 29690766, "comment_id": 47519275, "body": "as you found the answer yourself you might write your own answer here - then you have to wait a bit (no clue how long sorry) and then you can mark your own answer - or you can ask @MichaelSnoyman to write a short answer you can then accept instead if you want to give him some cudos"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429250244, "post_id": 29690766, "comment_id": 47519295, "body": "if you want I can flag it to close too but then 4 others have to do as well"}, {"owner": {"reputation": 142, "user_id": 4718903, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bSjBU.jpg?s=128&g=1", "display_name": "Yiyue Wang", "link": "https://stackoverflow.com/users/4718903/yiyue-wang"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1429284035, "post_id": 29690766, "comment_id": 47542170, "body": "@MichaelSnoyman Do you mind changing your comment to an answer so that I can mark it :)"}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 2, "last_activity_date": 1429381283, "creation_date": 1429381283, "answer_id": 29721106, "question_id": 29690766, "link": "https://stackoverflow.com/questions/29690766/why-do-i-get-ghcjs-boot-command-not-found/29721106#29721106", "title": "Why do I get &quot;ghcjs-boot: command not found&quot;?", "body": "<p>Rewriting my comment as an answer by request:</p>\n\n<p>Do you have ~/.cabal/bin in your PATH?</p>\n"}], "owner": {"reputation": 142, "user_id": 4718903, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bSjBU.jpg?s=128&g=1", "display_name": "Yiyue Wang", "link": "https://stackoverflow.com/users/4718903/yiyue-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "accepted_answer_id": 29721106, "answer_count": 1, "score": 2, "last_activity_date": 1429381283, "creation_date": 1429247152, "question_id": 29690766, "link": "https://stackoverflow.com/questions/29690766/why-do-i-get-ghcjs-boot-command-not-found", "title": "Why do I get &quot;ghcjs-boot: command not found&quot;?", "body": "<p>I've installed ghcjs by the command</p>\n\n<pre><code>cabal install ./ghcjs ./ghcjs-prim\n</code></pre>\n\n<p>And I get something like </p>\n\n<pre><code>Updating documentation MyDir/Haskell/share/doc/x86_64-osx-ghc-7.8.3/index.html\n</code></pre>\n\n<p>for my last line.</p>\n\n<p>But when I tried this command</p>\n\n<pre><code>ghcjs-boot --dev\n</code></pre>\n\n<p>I got <code>-bash: ghcjs-boot: command not found</code>\nWhat's the problem?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1429248244, "post_id": 29690576, "comment_id": 47518463, "body": "you updated your GHC right? (because AFAIK there is not Haskell Platform with GHC 7.10 yet) - if so how did you do it? You might want to nuke your installation and restart with just the new GHC/Cabal and add just the packages you really need - but possibly there will be someone who can say you exactly what went wrong."}, {"owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 1, "creation_date": 1429274634, "post_id": 29690576, "comment_id": 47534930, "body": "You don&#39;t have a proxy that your browser would know about but not Cabal?"}, {"owner": {"reputation": 1003, "user_id": 314336, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/8a8cecff04050c24b2d6315b8efa758a?s=128&d=identicon&r=PG", "display_name": "xyzt", "link": "https://stackoverflow.com/users/314336/xyzt"}, "reply_to_user": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "edited": false, "score": 0, "creation_date": 1429430216, "post_id": 29690576, "comment_id": 47588416, "body": "@JPMoresmau thanks, a vpn client installed in my PC  is the reason. i closed it and cabal updated successfuly."}], "owner": {"reputation": 1003, "user_id": 314336, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/8a8cecff04050c24b2d6315b8efa758a?s=128&d=identicon&r=PG", "display_name": "xyzt", "link": "https://stackoverflow.com/users/314336/xyzt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 586, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1429246202, "creation_date": 1429246202, "question_id": 29690576, "link": "https://stackoverflow.com/questions/29690576/cabal-update-fails-to-download-the-archive-file", "title": "cabal update fails to download the archive file", "body": "<p>I upgraded my Haskell platform to and copied the new cabal binary to my ~/.cabal/bin folder in my MacOS. </p>\n\n<pre><code>$ ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 7.10.1\n\n$ cabal --version\ncabal-install version 1.22.2.0\nusing version 1.22.2.0 of the Cabal library\n</code></pre>\n\n<p>Now, when I try to update the package list, I get the following error:  </p>\n\n<pre><code>$ cabal update\nDownloading the latest package list from hackage.haskell.org\ncabal: Failed to download\nhttp://hackage.haskell.org/packages/archive/00-index.tar.gz : ErrorMisc \"Error\nHTTP code: 400\"\n</code></pre>\n\n<p>I can download the 00-index.tar.gz file using my browser, but cabal fails to download it. What can be the problem?</p>\n"}, {"tags": ["eclipse", "haskell", "eclipse-plugin"], "comments": [{"owner": {"reputation": 102407, "user_id": 2670892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4iPV5.png?s=128&g=1", "display_name": "greg-449", "link": "https://stackoverflow.com/users/2670892/greg-449"}, "edited": false, "score": 2, "creation_date": 1429254461, "post_id": 29689551, "comment_id": 47521515, "body": "<a href=\"https://github.com/JPMoresmau/eclipsefp/issues/269\" rel=\"nofollow noreferrer\">This</a> says you must install Cabal"}, {"owner": {"reputation": 4009, "user_id": 1549476, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/dxQHN.png?s=128&g=1", "display_name": "k_g", "link": "https://stackoverflow.com/users/1549476/k-g"}, "reply_to_user": {"reputation": 102407, "user_id": 2670892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4iPV5.png?s=128&g=1", "display_name": "greg-449", "link": "https://stackoverflow.com/users/2670892/greg-449"}, "edited": false, "score": 1, "creation_date": 1429316205, "post_id": 29689551, "comment_id": 47558362, "body": "@greg-449 If you turn that into an answer, I will give you the accept. Your answer did get me past the &quot;not working at all&quot; problem but it would be nice if you also included the fact that running as administrator (on Windows) seems to get it completely functional."}, {"owner": {"reputation": 102407, "user_id": 2670892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4iPV5.png?s=128&g=1", "display_name": "greg-449", "link": "https://stackoverflow.com/users/2670892/greg-449"}, "edited": false, "score": 0, "creation_date": 1429339556, "post_id": 29689551, "comment_id": 47562930, "body": "It sounds like it would be better if you wrote a self answer. I don&#39;t actually know much about this!"}, {"owner": {"reputation": 426, "user_id": 506624, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/eef361d616082b83f1f1a1e74dc572d8?s=128&d=identicon&r=PG", "display_name": "Kaveh", "link": "https://stackoverflow.com/users/506624/kaveh"}, "edited": false, "score": 1, "creation_date": 1467833227, "post_id": 29689551, "comment_id": 63886030, "body": "<a href=\"http://jpmoresmau.blogspot.ca/2015/05/eclipsefp-end-of-life-from-me-at-least.html\" rel=\"nofollow noreferrer\"><b>It is not maintained anymore</b></a> and doesn&#39;t seem to work with recent versions."}, {"owner": {"reputation": 4009, "user_id": 1549476, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/dxQHN.png?s=128&g=1", "display_name": "k_g", "link": "https://stackoverflow.com/users/1549476/k-g"}, "reply_to_user": {"reputation": 426, "user_id": 506624, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/eef361d616082b83f1f1a1e74dc572d8?s=128&d=identicon&r=PG", "display_name": "Kaveh", "link": "https://stackoverflow.com/users/506624/kaveh"}, "edited": false, "score": 0, "creation_date": 1467854161, "post_id": 29689551, "comment_id": 63893943, "body": "@Kaveh thanks, I&#39;ve switched to ide Haskell for atom"}], "answers": [{"comments": [{"owner": {"reputation": 713, "user_id": 2572505, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/PiTlM.jpg?s=128&g=1", "display_name": "Daniel Dut", "link": "https://stackoverflow.com/users/2572505/daniel-dut"}, "edited": false, "score": 2, "creation_date": 1456019644, "post_id": 35489761, "comment_id": 58752242, "body": "When <code>EclipseFP</code> is installed before the settings to run <code>Eclipse</code> as an administrator, the plugin gets disabled and options for creating a new <code>Haskell</code> project disappear. Reinstall <code>EclipseFP</code> if you run into that..."}, {"owner": {"reputation": 304, "user_id": 37639, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7a1498672f085fb04114f3d9d3782e6?s=128&d=identicon&r=PG", "display_name": "corwin.amber", "link": "https://stackoverflow.com/users/37639/corwin-amber"}, "edited": false, "score": 0, "creation_date": 1464805061, "post_id": 35489761, "comment_id": 62639147, "body": "In case you are using MacPorts: EclipseFP cannot find <code>cabal</code> because it is installed in <code>&#47;opt&#47;local&#47;bin</code>. My solution was to run Eclipse from the shell rather than the UI launcher, e.g. <code>&#39;&#47;Applications&#47;Eclipse Mars.app&#47;Contents&#47;MacOS&#47;eclipse&#39;</code>. Remember that when you launch an application from Finder your <code>.bashrc</code> etc. don&#39;t get executed."}, {"owner": {"reputation": 7435, "user_id": 3233398, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/c2ab25926e68d6897da205117b1fe9fd?s=128&d=identicon&r=PG", "display_name": "EliuX", "link": "https://stackoverflow.com/users/3233398/eliux"}, "edited": false, "score": 0, "creation_date": 1464820642, "post_id": 35489761, "comment_id": 62646679, "body": "Sure, you can detach it from the console, and will be basically the same experience."}], "tags": [], "owner": {"reputation": 7435, "user_id": 3233398, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/c2ab25926e68d6897da205117b1fe9fd?s=128&d=identicon&r=PG", "display_name": "EliuX", "link": "https://stackoverflow.com/users/3233398/eliux"}, "is_accepted": false, "score": 1, "last_activity_date": 1455820732, "creation_date": 1455820732, "answer_id": 35489761, "question_id": 29689551, "link": "https://stackoverflow.com/questions/29689551/eclipsefp-not-working-at-all/35489761#35489761", "title": "EclipseFP not working at all", "body": "<p>Open a shell and write <code>cabal --help</code> and see if it shows you some commands. Else download the <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow\">Haskell Platform</a>. If you are in Windows make sure you open always your eclipse as administrator:</p>\n\n<ol>\n<li>Right click the link to Eclipse</li>\n<li>Go to the <strong>Compatibility</strong> tab and mark something like <strong>Run always as administrator</strong></li>\n<li>Open Eclipse and goto <code>New/Other/Haskel/</code> and pick your wanted kind of project.</li>\n</ol>\n"}], "owner": {"reputation": 4009, "user_id": 1549476, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/dxQHN.png?s=128&g=1", "display_name": "k_g", "link": "https://stackoverflow.com/users/1549476/k-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2899, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1455820732, "creation_date": 1429240094, "question_id": 29689551, "link": "https://stackoverflow.com/questions/29689551/eclipsefp-not-working-at-all", "title": "EclipseFP not working at all", "body": "<p>I recently installed Haskell and EclipseFP on my computer, using the instructions <a href=\"http://eclipsefp.github.io/install.html\">here</a>. I got as far as installing the plugin.</p>\n\n<p>Unfortunately, the plugin appears to have an internal problem and is outputting the following error when I start Eclipse (as seen in \"Error Log\").</p>\n\n<pre><code>eclipse.buildId=4.4.0.I20140606-1215\njava.version=1.8.0_20\njava.vendor=Oracle Corporation\nBootLoader constants: OS=win32, ARCH=x86_64, WS=win32, NL=en_US\nFramework arguments:  -product org.eclipse.epp.package.standard.product -product org.eclipse.epp.package.standard.product\nCommand-line arguments:  -os win32 -ws win32 -arch x86_64 -product org.eclipse.epp.package.standard.product -data &lt;PATH TO WORKSPACE&gt; -product org.eclipse.epp.package.standard.product\n\norg.eclipse.equinox.registry\nError\nThu Apr 16 19:37:20 PDT 2015\nPlug-in net.sf.eclipsefp.haskell.ui was unable to load class net.sf.eclipsefp.haskell.ui.decorators.ProblemsLabelDecorator.\n\njava.lang.ClassNotFoundException: An error occurred while automatically activating bundle net.sf.eclipsefp.haskell.ui (339).\n    at org.eclipse.osgi.internal.hooks.EclipseLazyStarter.postFindLocalClass(EclipseLazyStarter.java:116)\n    at org.eclipse.osgi.internal.loader.classpath.ClasspathManager.findLocalClass(ClasspathManager.java:531)\n    at org.eclipse.osgi.internal.loader.ModuleClassLoader.findLocalClass(ModuleClassLoader.java:324)\n    at org.eclipse.osgi.internal.loader.BundleLoader.findLocalClass(BundleLoader.java:311)\n    at org.eclipse.osgi.internal.loader.BundleLoader.findClassInternal(BundleLoader.java:386)\n    at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:336)\n    at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:328)\n    at org.eclipse.osgi.internal.loader.ModuleClassLoader.loadClass(ModuleClassLoader.java:160)\n    at java.lang.ClassLoader.loadClass(Unknown Source)\n    at org.eclipse.osgi.internal.framework.EquinoxBundle.loadClass(EquinoxBundle.java:568)\n    at org.eclipse.core.internal.registry.osgi.RegistryStrategyOSGI.createExecutableExtension(RegistryStrategyOSGI.java:174)\n    at org.eclipse.core.internal.registry.ExtensionRegistry.createExecutableExtension(ExtensionRegistry.java:905)\n    at org.eclipse.core.internal.registry.ConfigurationElement.createExecutableExtension(ConfigurationElement.java:243)\n    at org.eclipse.core.internal.registry.ConfigurationElementHandle.createExecutableExtension(ConfigurationElementHandle.java:55)\n    at org.eclipse.ui.internal.WorkbenchPlugin$1.run(WorkbenchPlugin.java:294)\n    at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:52)\n    at org.eclipse.ui.internal.WorkbenchPlugin.createExtension(WorkbenchPlugin.java:289)\n    at org.eclipse.ui.internal.decorators.LightweightDecoratorDefinition$1.run(LightweightDecoratorDefinition.java:125)\n    at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:42)\n    at org.eclipse.core.runtime.Platform.run(Platform.java:867)\n    at org.eclipse.ui.internal.decorators.LightweightDecoratorDefinition.internalGetDecorator(LightweightDecoratorDefinition.java:120)\n    at org.eclipse.ui.internal.decorators.LightweightDecoratorDefinition.decorate(LightweightDecoratorDefinition.java:255)\n    at org.eclipse.ui.internal.decorators.LightweightDecoratorManager$LightweightRunnable.run(LightweightDecoratorManager.java:83)\n    at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:42)\n    at org.eclipse.ui.internal.decorators.LightweightDecoratorManager.decorate(LightweightDecoratorManager.java:367)\n    at org.eclipse.ui.internal.decorators.LightweightDecoratorManager.getDecorations(LightweightDecoratorManager.java:349)\n    at org.eclipse.ui.internal.decorators.DecorationScheduler$1.ensureResultCached(DecorationScheduler.java:372)\n    at org.eclipse.ui.internal.decorators.DecorationScheduler$1.run(DecorationScheduler.java:332)\n    at org.eclipse.core.internal.jobs.Worker.run(Worker.java:54)\nCaused by: org.osgi.framework.BundleException: Exception in net.sf.eclipsefp.haskell.ui.HaskellUIPlugin.start() of bundle net.sf.eclipsefp.haskell.ui.\n    at org.eclipse.osgi.internal.framework.BundleContextImpl.startActivator(BundleContextImpl.java:792)\n    at org.eclipse.osgi.internal.framework.BundleContextImpl.start(BundleContextImpl.java:721)\n    at org.eclipse.osgi.internal.framework.EquinoxBundle.startWorker0(EquinoxBundle.java:936)\n    at org.eclipse.osgi.internal.framework.EquinoxBundle$EquinoxModule.startWorker(EquinoxBundle.java:319)\n    at org.eclipse.osgi.container.Module.doStart(Module.java:571)\n    at org.eclipse.osgi.container.Module.start(Module.java:439)\n    at org.eclipse.osgi.framework.util.SecureAction.start(SecureAction.java:454)\n    at org.eclipse.osgi.internal.hooks.EclipseLazyStarter.postFindLocalClass(EclipseLazyStarter.java:107)\n    ... 28 more\nCaused by: java.lang.NullPointerException\n    at net.sf.eclipsefp.haskell.ui.internal.backend.BackendManager.getToolSandbox(BackendManager.java:1108)\n    at net.sf.eclipsefp.haskell.ui.internal.backend.BackendManager.getToolSandboxBin(BackendManager.java:1124)\n    at net.sf.eclipsefp.haskell.ui.internal.backend.BackendManager.getExecutablePath(BackendManager.java:128)\n    at net.sf.eclipsefp.haskell.ui.internal.backend.BackendManager.start(BackendManager.java:175)\n    at net.sf.eclipsefp.haskell.ui.HaskellUIPlugin.start(HaskellUIPlugin.java:106)\n    at org.eclipse.osgi.internal.framework.BundleContextImpl$3.run(BundleContextImpl.java:771)\n    at org.eclipse.osgi.internal.framework.BundleContextImpl$3.run(BundleContextImpl.java:1)\n    at java.security.AccessController.doPrivileged(Native Method)\n    at org.eclipse.osgi.internal.framework.BundleContextImpl.startActivator(BundleContextImpl.java:764)\n    ... 35 more\n</code></pre>\n\n<p>Is there anything I should do to fix this problem? Or is it just a compatibility issue.</p>\n"}, {"tags": ["http", "haskell", "network-programming"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1429238974, "last_edit_date": 1592644375, "creation_date": 1429238974, "answer_id": 29689392, "question_id": 29689065, "link": "https://stackoverflow.com/questions/29689065/why-cant-i-use-hputstr-after-printing-the-result-of-hgetcontents/29689392#29689392", "title": "Why can&#39;t I use hPutStr after printing the result of hGetContents?", "body": "<p>When you initiate a lazy read on a handle, you give up the right to do anything much else with the handle until the contents string is fully forced, or you close the handle manually (at which point attempting to force any more of the contents string will lead to bad behavior or an error).</p>\n<h3>TL;DR</h3>\n<p>This is not a situation where lazy I/O is appropriate. The situations where a lazy read on a socket is appropriate can probably be counted on zero fingers. You can use regular strict I/O if you like, or <code>conduit</code>, or <code>pipes</code>, or some Haskell web framework like Yesod or Scotty or various other competitors.</p>\n"}, {"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1429242968, "post_id": 29689536, "comment_id": 47516701, "body": "This explanation (especially starting at &quot;Now let&#39;s say that client...&quot;) is correct. Each direction of a TCP connection can be shut down independently, and a web browser will not shut down the client-&gt;server direction until it receives at least the HTTP response headers, in case the server supports HTTP keep-alive. So you end up in a classic deadlock situation: your server cannot send the response until either it has received either 10 lines of request or its receiving channel is shut down, and the browser won&#39;t shut it down until it receives the response from the server. (continued)"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1429243307, "post_id": 29689536, "comment_id": 47516810, "body": "However, this doesn&#39;t have terribly much to do with lazy IO. You would get the same behavior from a C program like <code>int h = accept(socket, ...); for (int i = 0; i &lt; 10; i++) { if (fgets(buf, size, h)) { printf(&quot;%s&quot;, buf); } } fprintf(h, &quot;...&quot;);</code> If you&#39;re careful with how much of the request you force, you could implement your server with <code>hGetContents</code>. However, since HTTP is a simple line-based protocol, it&#39;s probably easier to use <code>hGetLine</code> and an explicit loop."}, {"owner": {"reputation": 23, "user_id": 4798260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2643162c11f1a4f4169f0b6afca4da2a?s=128&d=identicon&r=PG&f=1", "display_name": "UserError", "link": "https://stackoverflow.com/users/4798260/usererror"}, "edited": false, "score": 0, "creation_date": 1429277631, "post_id": 29689536, "comment_id": 47537148, "body": "So, does <code>hPutStrLn c</code> alone not work for similar reasons, meaning <code>hGetContents</code> never signals an end?"}], "tags": [], "owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "is_accepted": true, "score": 5, "last_activity_date": 1429240567, "last_edit_date": 1429240567, "creation_date": 1429240012, "answer_id": 29689536, "question_id": 29689065, "link": "https://stackoverflow.com/questions/29689065/why-cant-i-use-hputstr-after-printing-the-result-of-hgetcontents/29689536#29689536", "title": "Why can&#39;t I use hPutStr after printing the result of hGetContents?", "body": "<p>I tried to reproduce your problem. For that I executed your code and send it a request using nc:</p>\n\n<pre><code>printf \"1\\n2\\n3\\n4\\n5\\n6\\n7\\n8\\n9\\n10\\n11\" | nc localhost 5002\n</code></pre>\n\n<p>As expected the server (code from your question) printed out first 10 lines and exited without any error. The client (nc) printed:</p>\n\n<pre><code>HTTP/1.0 200 OK\nContent-Length: 5\nHello!\n</code></pre>\n\n<p>and also exited without an error.</p>\n\n<p>So, at first I couldn't understand what's your problem, but then I tried to send a smaller request:</p>\n\n<pre><code>printf \"1\\n2\\n3\\n4\\n5\\n6\\n\" | nc localhost 5002\n</code></pre>\n\n<p>The server printed first 6 lines and didn't exit. The client also didn't exit, so I interrupted it with Ctrl-C and after that the server exited with \"resource vanished\" error.</p>\n\n<p>I took some thinking and it started making sense to me. I don't understand lazy IO too good, so if my explanation isn't clear or correct it would be helpful if someone with better understanding would improve it.</p>\n\n<p>Let's follow your code. First:</p>\n\n<pre><code>(h, _, _) &lt;- accept socket\nc &lt;- hGetContents h\n</code></pre>\n\n<p>You open a handle and read it's content. Note that the handle is lazy and the content that you get is also lazy. When we say that something is lazy we mean that it can be passed around without being <em>evaluated</em> (it's often referred as 'call by name' vs 'call by value').</p>\n\n<p>Now:</p>\n\n<pre><code>putStrLn $ unlines $ take 10 $ lines c\n</code></pre>\n\n<p>Here it is, you pass your lazy, unevaluated content to another function <code>take 10</code>. <code>take 10</code> will try to <em>evaluate</em> first 10 elements of a list and return them, if there are less than 10 elements in the list it would simply return all of them. After <code>take 10</code> we have <code>putStrLn</code> and <code>unlines</code> which both perfectly compatible with laziness.</p>\n\n<p>Now let's say that client sends an input that is only 6 lines long and then starts waiting for the respond. Our server lazily receives the content and tries to print first 10 lines. First, <code>take 10</code> function happily consumes the first 6 lines and passes them over to <code>putStrLn . unlines</code>, what happens then? <code>take 10</code> can't just finish it's output because there is absolutely no indication that it is the end. The handle is still open, bytes still can be floating from client to server, so it just waits for more input.</p>\n\n<p>This behaviour can be observed by running:</p>\n\n<pre><code>nc localhost 5002\n</code></pre>\n\n<p>and manually typing there 10 lines. The input would appear on server line-by-line as you type. After you will type the 10th line the server will respond with \"Hello\" message.</p>\n\n<p>P.S: I guess that the behaviour that you described happens because you web browser sends 6 to 9 lines of something with the request.</p>\n\n<p>To test, debug and analyze this kind of low level servers you should use simple tools like <code>nc</code> and <code>curl</code> instead of your web browser :) </p>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 0, "last_activity_date": 1429258466, "creation_date": 1429258466, "answer_id": 29693817, "question_id": 29689065, "link": "https://stackoverflow.com/questions/29689065/why-cant-i-use-hputstr-after-printing-the-result-of-hgetcontents/29693817#29693817", "title": "Why can&#39;t I use hPutStr after printing the result of hGetContents?", "body": "<p>Calling <code>hGetContents</code> puts the handle into a \"semi-closed\" state. You should not perform <em>any</em> operations on the handle after that point. You should only use the string returned from <code>hGetContents</code>.</p>\n\n<p>Put simply, don't use lazy I/O here. You need to manually read and write individual strings one at a time, since the timing matters.</p>\n\n<p>In general, lazy I/O is kind of neat, but it doesn't work well for anything much beyond toy examples.</p>\n"}], "owner": {"reputation": 23, "user_id": 4798260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2643162c11f1a4f4169f0b6afca4da2a?s=128&d=identicon&r=PG&f=1", "display_name": "UserError", "link": "https://stackoverflow.com/users/4798260/usererror"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 29689536, "answer_count": 3, "score": 2, "last_activity_date": 1429258466, "creation_date": 1429236813, "question_id": 29689065, "link": "https://stackoverflow.com/questions/29689065/why-cant-i-use-hputstr-after-printing-the-result-of-hgetcontents", "title": "Why can&#39;t I use hPutStr after printing the result of hGetContents?", "body": "<p>I'm new to stackoverflow so forgive me if I do something wrong.  I trying to understand how a simple server would work in Haskell.  I think I'm missing something very simple or fundamental about how hGetContents works.  </p>\n\n<pre><code>import Network \nimport System.IO\n\nmain = withSocketsDo $ do\n     socket &lt;- listenOn $ PortNumber 5002\n     (h, _, _) &lt;- accept socket\n     c &lt;- hGetContents h\n--   putStrLn c  -- doesn't work\n--   putStrLn $ head $ lines c -- works!\n--   putStrLn $ unlines $ take 2 $ lines c -- works!\n--   putStrLn $ unlines $ take 3 $ lines c -- works!\n--   putStrLn $ unlines $ take 6 $ lines c -- works!\n     putStrLn $ unlines $ take 10 $ lines c -- doesn't work\n     hPutStr h $ \"HTTP/1.0 200 OK\\r\\nContent-Length: 5\\r\\n\\r\\nHello!\\r\\n\"\n     hClose h\n</code></pre>\n\n<p>After running the program, I navigate via web browser to <a href=\"http://localhost:5002\" rel=\"nofollow\">http://localhost:5002</a>. The problem seems to be that, depending on how much I've parsed the handle contents, I eventually am unable to send a response.  I'd like to be able to parse the request before I send a response.  I've commented in the code the cases that work and the cases that don't.  Hoogle says that for hGetContents (lazy) the handle is \"semi-closed\" as it is being read.  Am I misunderstanding the laziness or should I consider the handle closed once I begin parsing its contents?  </p>\n\n<p>The error I get is \"hPutChar: resource vanished (Broken pipe).\"  Thanks for any help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "edited": false, "score": 9, "creation_date": 1429227261, "post_id": 29686977, "comment_id": 47512485, "body": "In the prelude, it defines <code>otherwise = True</code>. Using it in a pattern match just shadows that definition, introducing a new, more local variable which also happens to be called <code>otherwise</code>. A similar example is <code>case &quot;shadowing can be confusing&quot; of (==) -&gt; &quot;Y&#39;know, &quot; ++ (==)</code>, which returns <code>&quot;Y&#39;know, shadowing can be confusing&quot;</code>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 7, "creation_date": 1429228627, "post_id": 29686977, "comment_id": 47512900, "body": "Just since nobody has said it yet, <code>otherwise</code> is supposed to be used as a guard expression, not a pattern. <code>case ... of pat | ... -&gt; ... | otherwise -&gt; ...</code> Now its definition as <code>True</code> is important."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "edited": false, "score": 0, "creation_date": 1429247297, "post_id": 29686977, "comment_id": 47518091, "body": "@AndrewC, great example!"}], "answers": [{"comments": [{"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 5, "creation_date": 1429223071, "post_id": 29687022, "comment_id": 47511097, "body": "<code>case [] of otherwise -&gt; (otherwise, &quot;!?&quot;)</code> is <code>([], &quot;!?&quot;)</code> is an example showing how the binding works in this case."}, {"owner": {"reputation": 2834, "user_id": 349384, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/V6gwQ.png?s=128&g=1", "display_name": "YellPika", "link": "https://stackoverflow.com/users/349384/yellpika"}, "edited": false, "score": 0, "creation_date": 1429223757, "post_id": 29687022, "comment_id": 47511323, "body": "Thanks!  So it&#39;s just another variable. I should have known... * gently bangs head on wall repeatedly *."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1429224927, "post_id": 29687022, "comment_id": 47511718, "body": "Just remember <code>otherwise = True</code>.  Some people even use <code>True</code> instead of <code>otherwise</code> in their code which sometimes reads oddly but also avoids unintended binding."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 16, "last_activity_date": 1429222899, "creation_date": 1429222899, "answer_id": 29687022, "question_id": 29686977, "link": "https://stackoverflow.com/questions/29686977/haskells-otherwise-is-a-synonym-for/29687022#29687022", "title": "Haskell&#39;s `otherwise` is a synonym for `_`?", "body": "<p>It's not equivalent to <code>_</code>, it's equivalent to any other identifier. That is if an identifier is used as a pattern in Haskell, the pattern always matches and the matched value is bound to that identifier (unlike <code>_</code> where it also always matches, but the matched value is discarded).</p>\n\n<p>Just to be clear: the identifier <code>otherwise</code> is not special here. The code could just as well have been <code>x -&gt; \"!?\"</code>. Also, since the binding is never actually used, it would make more sense to use <code>_</code> to avoid an \"unused identifier\" warning and to make it obvious to the reader that the value does not matter.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 9, "last_activity_date": 1429235378, "last_edit_date": 1429235378, "creation_date": 1429235031, "answer_id": 29688810, "question_id": 29686977, "link": "https://stackoverflow.com/questions/29686977/haskells-otherwise-is-a-synonym-for/29688810#29688810", "title": "Haskell&#39;s `otherwise` is a synonym for `_`?", "body": "<blockquote>\n  <p>Just since nobody has said it yet, otherwise is supposed to be used as a guard expression, not a pattern. case ... of pat | ... -> ... | otherwise -> ... Now its definition as True is important. \u2013  Reid Barton</p>\n</blockquote>\n\n<p>An example:</p>\n\n<pre><code>fact n acc\n  | n == 0 = acc\n  | otherwise = fact (n-1) $! (acc * n)\n</code></pre>\n\n<p>Since <code>otherwise</code> is <code>True</code>, that second guard will always succeed.</p>\n\n<p>Note that using <code>otherwise</code> in a pattern (as opposed to a guard) is likely to confuse people. It will also trip a name shadowing warning if GHC is run with the appropriate warnings enabled.</p>\n"}], "owner": {"reputation": 2834, "user_id": 349384, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/V6gwQ.png?s=128&g=1", "display_name": "YellPika", "link": "https://stackoverflow.com/users/349384/yellpika"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 678, "favorite_count": 0, "accepted_answer_id": 29687022, "answer_count": 2, "score": 8, "last_activity_date": 1429235378, "creation_date": 1429222693, "question_id": 29686977, "link": "https://stackoverflow.com/questions/29686977/haskells-otherwise-is-a-synonym-for", "title": "Haskell&#39;s `otherwise` is a synonym for `_`?", "body": "<p>I ran across a piece of code recently that used Haskell's <code>otherwise</code> to pattern match on a list. This struck me as odd, since:</p>\n\n<pre><code>ghci&gt; :t otherwise\notherwise :: Bool\n</code></pre>\n\n<p>So, I tried the following:</p>\n\n<pre><code>ghci&gt; case [] of otherwise -&gt; \"!?\"\n\"!?\"\n</code></pre>\n\n<p>I also tried it with various other patterns of different types and with <code>-XNoImplicitPrelude</code> turned on (to remove <code>otherwise</code> from scope), and it still works. Is this supposed to happen? Where is this documented?</p>\n"}]