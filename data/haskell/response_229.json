[{"tags": ["haskell", "types", "instance"], "comments": [{"owner": {"reputation": 2088, "user_id": 4281998, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/q8Jvt.png?s=128&g=1", "display_name": "Brady Dean", "link": "https://stackoverflow.com/users/4281998/brady-dean"}, "edited": false, "score": 2, "creation_date": 1559172659, "post_id": 56369726, "comment_id": 99342065, "body": "x is bounded to Integrals but not all Integrals are Integers. I think that&#39;s the problem."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1559173931, "post_id": 56369726, "comment_id": 99342323, "body": "You said that you want to use <code>ListConverter</code> to &quot;create an instance of it&quot;, where by &quot;it&quot; I believe you mean your <code>Nodes</code> type. If this means that you expect <code>toList</code> to give you a value of type <code>Nodes a</code> (for some <code>a</code>) then you will be disappointed, because it would <i>take</i> a value of type <code>Nodes a</code> and <i>give</i> a <code>[Integer]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "is_accepted": true, "score": 4, "last_activity_date": 1559172937, "creation_date": 1559172937, "answer_id": 56369821, "question_id": 56369726, "link": "https://stackoverflow.com/questions/56369726/create-custom-list-data-structure-with-tolist-function/56369821#56369821", "title": "Create custom list data structure with &quot;toList&quot; function", "body": "<p>Your instance of ListConverter is expected to accept any value of class Integral for \"a\", but Integer is a specific type, not a class; you'd have to do this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance ListConverter (Nodes Integer) where\n</code></pre>\n\n<p>That or, conversely, make your ListConverter class capable of producing a list of whatever type your Nodes value contains:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class ListConverter f where\n    toList :: f a -&gt; [a]\n\ninstance ListConverter Nodes where\n    toList Empty = []\n    toList (Node x y) = x : toList y\n</code></pre>\n\n<p>(The second equation for toList - (Node x Empty) - is unnecessary)</p>\n"}, {"tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 1, "last_activity_date": 1559173195, "creation_date": 1559173195, "answer_id": 56369854, "question_id": 56369726, "link": "https://stackoverflow.com/questions/56369726/create-custom-list-data-structure-with-tolist-function/56369854#56369854", "title": "Create custom list data structure with &quot;toList&quot; function", "body": "<p>The problem with this instance is very simply stated. You have given the signature:</p>\n\n<pre><code>toList :: a -&gt; [Integer]\n</code></pre>\n\n<p>But your attempted instance actually has type <code>Nodes a -&gt; [a]</code>. This doesn't work unless <code>a</code> is the <code>Integer</code> type - yet you've claimed it works for all <code>Integral a</code>. This includes other types such as <code>Int</code>.</p>\n\n<p>One solution is just to restrict your instance:</p>\n\n<pre><code>instance ListConverter (Nodes Integer) where...\n</code></pre>\n\n<p>This will work - but doesn't in my opinion really respect the spirit of what you probably intended the class for.</p>\n\n<p>The best solution I think is to recognise that both lists and your <code>Nodes</code> type are paramaterised by another type, and define the class in such a way as to do the conversion over a common base class. That sounds more complicated than it is, I just mean:</p>\n\n<pre><code>class ListConverter l where\n    toList :: l a -&gt; [a]\n</code></pre>\n\n<p>Then you can write an <code>instance ListConverter Nodes where...</code>, and just copy your existing <code>toList</code> definition. (Whose middle line, I will point out in passing, is redundant.)</p>\n"}], "owner": {"reputation": 526, "user_id": 10935599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qqFKy.jpg?s=128&g=1", "display_name": "Kluddizz", "link": "https://stackoverflow.com/users/10935599/kluddizz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 56369821, "answer_count": 2, "score": 1, "last_activity_date": 1559176793, "creation_date": 1559172199, "last_edit_date": 1559176793, "question_id": 56369726, "link": "https://stackoverflow.com/questions/56369726/create-custom-list-data-structure-with-tolist-function", "title": "Create custom list data structure with &quot;toList&quot; function", "body": "<p>I want to create my own list data structure called Nodes. Then I will use my ListConverter class, which contains the 'toList' function, and create an instance of it.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Nodes a = Empty\n             | Node a (Nodes a)\n\nclass ListConverter a where\n    toList :: a -&gt; [Integer]\n\ninstance (Integral a) =&gt; ListConverter (Nodes a) where\n    toList Empty = []\n    toList (Node x Empty) = [x]\n    toList (Node x y) = x : toList y\n</code></pre>\n\n<p>GHCi tells me, that the expected type is 'Integer' but is currently 'a'. Im very confused, because in the instance I give a type for a (Integral). Here's the error message:</p>\n\n<pre><code>error:\n    * Couldn't match expected type `Integer' with actual type `a'\n      `a' is a rigid type variable bound by\n        the instance declaration\n        at main.hs:7:10-48\n    * In the expression: x\n      In the expression: [x]\n      In an equation for `toList': toList (Node x Empty) = [x]\n    * Relevant bindings include\n        x :: a (bound at main.hs:9:18)\n        toList :: Nodes a -&gt; [Integer] (bound at main.hs:8:5)\n  |\n9 |     toList (Node x Empty) = [x]\n  |                              ^\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "list-comprehension"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 2, "creation_date": 1559171502, "post_id": 56369537, "comment_id": 99341810, "body": "<code>[expr | p &lt;- s]</code> is the same as <code>map (\\p -&gt; expr) s</code>. Not putting this as an answer though since I&#39;m not entirely sure it&#39;s what you&#39;re looking for."}, {"owner": {"reputation": 81, "user_id": 10264322, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-DtMZ1vg7RJI/AAAAAAAAAAI/AAAAAAAAABQ/22dkNVGjvW8/photo.jpg?sz=128", "display_name": "Ketho", "link": "https://stackoverflow.com/users/10264322/ketho"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1559171714, "post_id": 56369537, "comment_id": 99341854, "body": "Again, this is only true when <code>p</code> actually succeeds on all elements of <code>s</code> in pattern matching."}, {"owner": {"reputation": 81, "user_id": 10264322, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-DtMZ1vg7RJI/AAAAAAAAAAI/AAAAAAAAABQ/22dkNVGjvW8/photo.jpg?sz=128", "display_name": "Ketho", "link": "https://stackoverflow.com/users/10264322/ketho"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1559171791, "post_id": 56369537, "comment_id": 99341869, "body": "For example: <code>[2*x | (x,2) &lt;- [(1,2), (3,4)]]</code> would fail."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1559172395, "post_id": 56369537, "comment_id": 99342004, "body": "I didn&#39;t know it would do that - I thought it would fail with an exception! Then again, I don&#39;t use comprehensions very often, so I&#39;m not surprised I got this wrong."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1559172520, "post_id": 56369537, "comment_id": 99342035, "body": "Thinking about this some more, you could use <a href=\"https://www.stackage.org/haddock/lts-13.23/base-4.12.0.0/Data-Maybe.html#v:mapMaybe\" rel=\"nofollow noreferrer\"><code>mapMaybe</code></a> from <code>Data.Maybe</code> to combine filtering and mapping in one step. e.g. your example is `mapMaybe (\\val -&gt; case val of { (x, 2) -&gt; Just (2*x) ; _ -&gt; Nothing) [(1,2), (3,4)]"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 3, "creation_date": 1559172521, "post_id": 56369537, "comment_id": 99342036, "body": "@bradrn strictly speaking they are not the same, since the list comprehension silently ignores a pattern match failure. The Report gives <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-420003.11\" rel=\"nofollow noreferrer\">desugaring rules for list comprehensions</a>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1559172606, "post_id": 56369537, "comment_id": 99342053, "body": "I believe it is equivalent to <code>let { ok p = [expr]; ok _ = [] } in concatMap ok s</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1559172983, "post_id": 56369537, "comment_id": 99342124, "body": "To answer the question, you can&#39;t show this because it is not true: <code>\\xs -&gt; [f x | x &lt;- xs, p x] =&#47;= map f . filter p</code>. See the above discussion about pattern matching failures. However, I think you can show something weaker: in all cases where <code>map f . filter p</code> returns a value, it is the same as the value returned by the list comprehension."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1559173112, "post_id": 56369537, "comment_id": 99342148, "body": "Just realised I forgot a closing backtick and braces in my code above - it should be <code>mapMaybe (\\val -&gt; case val of { (x, 2) -&gt; Just (2*x) ; _ -&gt; Nothing } ) [(1,2), (3,4)]</code>"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1559173386, "post_id": 56369537, "comment_id": 99342204, "body": "Alternatively, if the pattern is <i>irrefutable</i> then the behavior is equivalent, since the pattern cannot fail to match."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 10264322, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-DtMZ1vg7RJI/AAAAAAAAAAI/AAAAAAAAABQ/22dkNVGjvW8/photo.jpg?sz=128", "display_name": "Ketho", "link": "https://stackoverflow.com/users/10264322/ketho"}, "edited": false, "score": 0, "creation_date": 1559172970, "post_id": 56369755, "comment_id": 99342119, "body": "I&#39;m interested in having a &quot;general approach&quot; for <code>[expr | p &lt;- s]</code>. Is there a way to express the <code>filter</code> more generally? More precise, could you have it in this form: <code>map (\\p -&gt; expr) $ filter (???) s</code>"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 81, "user_id": 10264322, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-DtMZ1vg7RJI/AAAAAAAAAAI/AAAAAAAAABQ/22dkNVGjvW8/photo.jpg?sz=128", "display_name": "Ketho", "link": "https://stackoverflow.com/users/10264322/ketho"}, "edited": false, "score": 0, "creation_date": 1559173222, "post_id": 56369755, "comment_id": 99342171, "body": "@Ketho I don&#39;t believe you can do this - see <a href=\"https://stackoverflow.com/questions/56369537/how-do-i-implement-a-list-comprehension-using-map-and-filter?noredirect=1#comment99342124_56369537\">ReinHenrichs&#39;s comment</a> on your question"}, {"owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "edited": false, "score": 0, "creation_date": 1559173483, "post_id": 56369755, "comment_id": 99342226, "body": "If you mean, &quot;what if I don&#39;t want to filter, I want to map all the elements in the list&quot;, you can either omit the filter and just do map, or filter by a function that always returns True: <code>map (\\p -&gt; expr) $ filter (\\p -&gt; True) s</code>"}], "tags": [], "owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "is_accepted": false, "score": 3, "last_activity_date": 1559172375, "creation_date": 1559172375, "answer_id": 56369755, "question_id": 56369537, "link": "https://stackoverflow.com/questions/56369537/how-do-i-implement-a-list-comprehension-using-map-and-filter/56369755#56369755", "title": "How do I implement a list comprehension using map and filter?", "body": "<p>Yes, you cannot do pattern matching on a lambda without either using \\x -> case x of... (or LambdaCase to shorten it); your example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>[2*x | (x,2) &lt;- [(1,2), (3,4)]]\n</code></pre>\n\n<p>would have to be implemented as:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>map (\\(x,_) -&gt; 2*x) $ filter (\\(_,y) -&gt; y == 2) [(1,2), (3,4)]\n</code></pre>\n\n<p>Or, using LambdaCase:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>map (\\(x,_) -&gt; 2*x) $ filter (\\case (_,2) -&gt; True; _ -&gt; False) [(1,2), (3,4)]\n</code></pre>\n\n<p>Also, for a point-free version:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>map ((2*) . fst) $ filter ((==2) . snd) [(1,2), (3,4)]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1559173459, "post_id": 56369878, "comment_id": 99342223, "body": "Perhaps we could helpfully restrict the problem to list comprehensions whose patterns are irrefutable, as SPJ and Wadler do in <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2007/09/list-comp.pdf\" rel=\"nofollow noreferrer\"><i>Comprehensive Comprehensions</i></a>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1559173808, "post_id": 56369878, "comment_id": 99342300, "body": "@ReinHenrichs Perhaps, though as far as the OP&#39;s goal is concerned we would also have to exclude comprehensions with multiple generators."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 9, "last_activity_date": 1559174006, "last_edit_date": 1559174006, "creation_date": 1559173372, "answer_id": 56369878, "question_id": 56369537, "link": "https://stackoverflow.com/questions/56369537/how-do-i-implement-a-list-comprehension-using-map-and-filter/56369878#56369878", "title": "How do I implement a list comprehension using map and filter?", "body": "<blockquote>\n  <p>But this works only when pattern matching with <code>p</code> succeeds on all elements of <code>s</code>.</p>\n</blockquote>\n\n<p>Indeed: the pattern matching behaviour you describe cannot, in general, be achieved with <code>map</code> and <code>filter</code> alone. Expressing comprehensions in such terms only works well in the simpler case of comprehensions with a single generator and patterns that won't fail. Rather, list comprehensions <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-420003.11\" rel=\"noreferrer\">are specified in the Haskell Report</a> in terms of <code>concatMap</code>. In particular, the clause about generators covers the possibility of pattern match failure:</p>\n\n<pre><code>--This is pseudo-Haskell; see the Report for the fine print.\n[  <em>e</em> | <em>p</em> &lt;- <em>l</em>,  <em>Q</em> ] = let ok <em>p</em> = [  <em>e</em> | <em>Q</em> ]\n                          ok _ = []\n                          in concatMap ok <em>l</em>\n</code></pre>\n\n<p>The handling of match failures corresponds to what <code>fail</code> does in the desugaring of list monad do-blocks.</p>\n"}], "owner": {"reputation": 81, "user_id": 10264322, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-DtMZ1vg7RJI/AAAAAAAAAAI/AAAAAAAAABQ/22dkNVGjvW8/photo.jpg?sz=128", "display_name": "Ketho", "link": "https://stackoverflow.com/users/10264322/ketho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 3, "accepted_answer_id": 56369878, "answer_count": 2, "score": 5, "last_activity_date": 1559174137, "creation_date": 1559170542, "last_edit_date": 1559174137, "question_id": 56369537, "link": "https://stackoverflow.com/questions/56369537/how-do-i-implement-a-list-comprehension-using-map-and-filter", "title": "How do I implement a list comprehension using map and filter?", "body": "<p>Both <code>map</code> and <code>filter</code> can be implemented using list comprehension:</p>\n\n<pre><code>map f xs    = [f x | x &lt;- xs]\nfilter p xs = [x | x &lt;- xs, p x] \n</code></pre>\n\n<p>I'd like to show that the converse holds as well using the following example:</p>\n\n<pre><code>[expr | p &lt;- s]\n</code></pre>\n\n<p>I've got so far:</p>\n\n<pre><code>map (\\p -&gt; expr) s\n</code></pre>\n\n<p>But this works only when pattern matching with <code>p</code> succeeds on all elements of <code>s</code>. In a way, I first want to filter <code>s</code> using a pattern matching on <code>p</code>. Naturally, I tried looking into this question but I haven't been able to find a solution which didn't use list comprehension or LambdaCase.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1559163862, "post_id": 56368459, "comment_id": 99339783, "body": "On log/error formatting, I suggest just using a normal code block -- it is the most readable option."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1559164188, "post_id": 56368459, "comment_id": 99339890, "body": "<a href=\"https://github.com/commercialhaskell/stack/issues/3248\" rel=\"nofollow noreferrer\">Stack issue #3248</a> seems relevant. I suggest trying the <code>stack exec ghc-pkg unregister</code> workaround mentioned in the first post there."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1559166155, "post_id": 56368760, "comment_id": 99340454, "body": "I have edited the answer to directly mention the workaround. Please edit it if what I have added doesn&#39;t match what you have actually done."}], "tags": [], "owner": {"reputation": 164, "user_id": 9292947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3f189bbc2467c0e40500d75e29ed064?s=128&d=identicon&r=PG&f=1", "display_name": "DeadUnicorn", "link": "https://stackoverflow.com/users/9292947/deadunicorn"}, "is_accepted": true, "score": 3, "last_activity_date": 1559166106, "last_edit_date": 1559166106, "creation_date": 1559165224, "answer_id": 56368760, "question_id": 56368459, "link": "https://stackoverflow.com/questions/56368459/how-to-fix-bad-interface-file-during-installation-of-package-with-stack/56368760#56368760", "title": "How to fix &quot;Bad interface file&quot; during installation of package with stack?", "body": "<p>As <a href=\"https://stackoverflow.com/users/2751851/duplode\">duplode</a> has pointed out, this is likely a case of <a href=\"https://github.com/commercialhaskell/stack/issues/3248\" rel=\"nofollow noreferrer\">Stack issue #3248</a>. A workaround is <code>stack exec ghc-pkg unregister ansi-wl-pprint-0.6.8.2</code> followed by <code>stack build</code>, which will trigger a reinstall of the affected package.</p>\n"}], "owner": {"reputation": 164, "user_id": 9292947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3f189bbc2467c0e40500d75e29ed064?s=128&d=identicon&r=PG&f=1", "display_name": "DeadUnicorn", "link": "https://stackoverflow.com/users/9292947/deadunicorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 56368760, "answer_count": 1, "score": 0, "last_activity_date": 1559166106, "creation_date": 1559163712, "last_edit_date": 1559164224, "question_id": 56368459, "link": "https://stackoverflow.com/questions/56368459/how-to-fix-bad-interface-file-during-installation-of-package-with-stack", "title": "How to fix &quot;Bad interface file&quot; during installation of package with stack?", "body": "<p>I'm trying to install stylish-haskell package with</p>\n\n<pre><code>stack install stylish-haskell\n</code></pre>\n\n<p>but I get \"Bad interface file\" error.</p>\n\n<p>Here's log of installation:</p>\n\n<pre><code>ptparse-applicative-0.14.3.0.log\nConfiguring optparse-applicative-0.14.3.0...\nPreprocessing library for optparse-applicative-0.14.3.0..\nBuilding library for optparse-applicative-0.14.3.0..\n[ 1 of 16] Compiling Options.Applicative.Help.Levenshtein ( Options/Applicative/Help/Levenshtein.hs, .stack-work/dist/x86_64-linux-tinfo6/Cabal-2.4.0.1/build/Options/Applicative/Help/Levenshtein.o )\n[ 2 of 16] Compiling Options.Applicative.Help.Pretty ( Options/Applicative/Help/Pretty.hs, .stack-work/dist/x86_64-linux-tinfo6/Cabal-2.4.0.1/build/Options/Applicative/Help/Pretty.o )\nOptions/Applicative/Help/Pretty.hs:6:1: error:\n    Bad interface file: /home/george/.stack/snapshots/x86_64-linux-tinfo6/lts-13.21/8.6.5/lib/x86_64-linux-ghc-8.6.5/ansi-wl-pprint-0.6.8.2-FavuR50rvZs3UXCXkBzL8N/Text/PrettyPrint/ANSI/Leijen.hi\n        Data.Binary.getPrim: end of file\n  |\n6 | import Text.PrettyPrint.ANSI.Leijen hiding ((&lt;$&gt;), (&lt;&gt;), columns)\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "functional-programming", "list-comprehension"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1559160722, "post_id": 56367793, "comment_id": 99338675, "body": "Even without that extension, you can write <code>[x | (x,_) &lt;- zip a [1..n]]</code>."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1559160855, "post_id": 56367793, "comment_id": 99338715, "body": "@chepner: But then you\u2019re using <code>zip</code>, which I think kind of defeats the point. (Maybe it doesn\u2019t.)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1559160951, "post_id": 56367793, "comment_id": 99338747, "body": "Why? The OP just asked for a list comprehension; they didn&#39;t put any restrictions on what could be used inside."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1559161896, "post_id": 56367793, "comment_id": 99339105, "body": "@Ry- From my point of view, <code>zip</code> and parallel comprehensions are roughly the same. If the object of the game is to use comprehension syntax, then parallel comprehension looks closer to the spirit. I guess that the OP aimed for plain comprehensions and no library functions, but that is impossible."}], "tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": true, "score": 6, "last_activity_date": 1559160518, "creation_date": 1559160518, "answer_id": 56367793, "question_id": 56367724, "link": "https://stackoverflow.com/questions/56367724/how-to-recreate-the-take-function-by-list-comprehension-in-haskell/56367793#56367793", "title": "How to recreate the &#39;take&#39; function by list comprehension in Haskell?", "body": "<p>With the ParallelListComp extension, a list comprehension can zip:</p>\n\n<pre><code>{-# LANGUAGE ParallelListComp #-}\n\ntake' n a = [x | x &lt;- a | _ &lt;- [1..n]]\n</code></pre>\n"}], "owner": {"reputation": 2191, "user_id": 476142, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/505b6fb6594290ce9544255c4f021491?s=128&d=identicon&r=PG", "display_name": "Tofiq", "link": "https://stackoverflow.com/users/476142/tofiq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 1, "accepted_answer_id": 56367793, "answer_count": 1, "score": 0, "last_activity_date": 1559160518, "creation_date": 1559160152, "question_id": 56367724, "link": "https://stackoverflow.com/questions/56367724/how-to-recreate-the-take-function-by-list-comprehension-in-haskell", "title": "How to recreate the &#39;take&#39; function by list comprehension in Haskell?", "body": "<p>The below code recreate the 'take' function in Haskell by recursion:</p>\n\n<pre><code>take' :: Int-&gt;[a]-&gt;[a]\ntake' 0 _=[]\ntake' _ []= []\ntake' n (x:xs)=x : take' (n-1) xs\n</code></pre>\n\n<p>I want to create 'take' function using list comprehension:</p>\n\n<pre><code>take' n a=[x|x&lt;-a]\n</code></pre>\n"}, {"tags": ["haskell", "frp"], "comments": [{"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1559158293, "post_id": 56367038, "comment_id": 99337693, "body": "How do your Reactive &amp; Future correspond to Event &amp; Behavior as Conal defines them?"}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1559158317, "post_id": 56367038, "comment_id": 99337700, "body": "@bergey I am using Conal&#39;s definitions of Reactive, Event, and Future"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1559167188, "post_id": 56367038, "comment_id": 99340757, "body": "Contrary to the close vote, this question is very much not &quot;primarily opinion-based&quot;. In any case, for extra clarity I suggest linking to the paper by Conal you are using. (It looks like <a href=\"http://conal.net/papers/push-pull-frp/\" rel=\"nofollow noreferrer\"><i>Push-pull functional reactive programming</i></a>, but I&#39;m only guessing.)"}, {"owner": {"reputation": 18156, "user_id": 127335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765a0d6880973a0e95e2700e11786c3a?s=128&d=identicon&r=PG", "display_name": "Conal", "link": "https://stackoverflow.com/users/127335/conal"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1559609537, "post_id": 56367038, "comment_id": 99466311, "body": "@duplode: Thank you for pointing out that this question is not a matter of opinion, since there is a precise specification."}], "answers": [{"comments": [{"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1559339693, "post_id": 56396736, "comment_id": 99402609, "body": "Do you know the reasoning behind that choice (switch using &lt; rather than &lt;=)?"}, {"owner": {"reputation": 18156, "user_id": 127335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765a0d6880973a0e95e2700e11786c3a?s=128&d=identicon&r=PG", "display_name": "Conal", "link": "https://stackoverflow.com/users/127335/conal"}, "reply_to_user": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 2, "creation_date": 1559604490, "post_id": 56396736, "comment_id": 99465547, "body": "@2426021684 The choice of <code>&lt;</code> rather than <code>&lt;=</code> is crucial for self-reactive behaviors and systems of mutually reactive behaviors to have values other than bottom (no information / nontermination) when sampled exactly at event occurrences."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 18156, "user_id": 127335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765a0d6880973a0e95e2700e11786c3a?s=128&d=identicon&r=PG", "display_name": "Conal", "link": "https://stackoverflow.com/users/127335/conal"}, "edited": false, "score": 0, "creation_date": 1559614579, "post_id": 56396736, "comment_id": 99467113, "body": "@Conal how would one construct a self-reactive reactive or behavior?"}, {"owner": {"reputation": 18156, "user_id": 127335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765a0d6880973a0e95e2700e11786c3a?s=128&d=identicon&r=PG", "display_name": "Conal", "link": "https://stackoverflow.com/users/127335/conal"}, "reply_to_user": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1560445007, "post_id": 56396736, "comment_id": 99748530, "body": "@2426021684 With a predicate event, i.e., one that fires whenever a time-varying boolean becomes true. A behavior can thus react to a condition involving itself (directly or indirectly), causing the condition to become false."}, {"owner": {"reputation": 18156, "user_id": 127335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765a0d6880973a0e95e2700e11786c3a?s=128&d=identicon&r=PG", "display_name": "Conal", "link": "https://stackoverflow.com/users/127335/conal"}, "edited": false, "score": 0, "creation_date": 1560445116, "post_id": 56396736, "comment_id": 99748581, "body": "The same situation occurs in a <i>purely</i> continuous setting (no events) in the form of ordinary differential equations (ODEs)."}], "tags": [], "owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "is_accepted": true, "score": 3, "last_activity_date": 1559312010, "creation_date": 1559312010, "answer_id": 56396736, "question_id": 56367038, "link": "https://stackoverflow.com/questions/56367038/multiple-occurrences-of-an-event-at-the-same-time/56396736#56396736", "title": "Multiple Occurrences of an Event at the same Time", "body": "<p>In the paper <a href=\"http://conal.net/papers/push-pull-frp/\" rel=\"nofollow noreferrer\">Push-pull functional reactive programming</a> (if duplode is correct), the fundamental sampling combinator <code>switcher</code> is described as:</p>\n\n<blockquote>\n  <p>The semantics of <em>b\u2080 `switcher` e</em> chooses and samples either <em>b\u2080</em>\n  or the last behavior from <em>e</em> before a given sample time <em>t</em></p>\n</blockquote>\n\n<p><code>sample</code> should behave the same way to be compatible with the combinators in that paper. Since a <code>Reactive</code> is an <code>Event</code> with an initial value, and a <code>Future</code> is a time-value pair, <code>sample r (MkFuture t ())</code> should return a <code>MkFuture t v</code> where <code>v</code> is the last value in <code>r</code> from strictly before <code>t</code>, or the initial value of <code>r</code> if there is no such value. There's no issue with multiple values at the same time: any values at time <code>t</code> are ignored since they're not strictly before <code>t</code>, and of the values before <code>t</code>, \"take the last one\" is unambiguous.</p>\n"}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 56396736, "answer_count": 1, "score": 2, "last_activity_date": 1559312010, "creation_date": 1559156945, "last_edit_date": 1559159358, "question_id": 56367038, "link": "https://stackoverflow.com/questions/56367038/multiple-occurrences-of-an-event-at-the-same-time", "title": "Multiple Occurrences of an Event at the same Time", "body": "<p>Conal Elliott's paper defines Event as</p>\n\n<pre><code>type Event a = [(T , a)] -- for non-decreasing times\n</code></pre>\n\n<p>This would allow more than one occurrence at a time.\nIn my FRP library I would like to implement the function:</p>\n\n<pre><code>sample :: Reactive a -&gt; Future () -&gt; Future a\n</code></pre>\n\n<p>This would sample the reactive when the future fires. Since the reactive can have more than one value at the time the future fires how should I implement it? Always use the last, the first, or a nonempty list?</p>\n\n<p>This is how the sample function should behave:</p>\n\n<pre><code>sample\n    (MkReactive \"a\"\n        (MkEvent\n            (MkFuture 2\n                (MkReactive \"b\" ...)\n            )\n        )\n    (MkFuture 1 ())\n= MkFuture 1 \"a\"\n</code></pre>\n"}, {"tags": ["haskell", "request", "ip", "http-conduit"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 2, "creation_date": 1559144230, "post_id": 56363889, "comment_id": 99331435, "body": "What&#39;s wrong with <code>&quot;http:&#47;&#47;xxx.xxx.xxx.xxx&quot;</code>?"}, {"owner": {"reputation": 115, "user_id": 3680029, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2f9062247d1bcf616e8a6cf493c00fc?s=128&d=identicon&r=PG&f=1", "display_name": "user3680029", "link": "https://stackoverflow.com/users/3680029/user3680029"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1559145072, "post_id": 56363889, "comment_id": 99331877, "body": "Nthg. It just a placeholder"}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 4, "creation_date": 1559145517, "post_id": 56363889, "comment_id": 99332138, "body": "No, what&#39;s wrong with just passing your IP address into <code>parseRequest</code> instead of <code>localhost</code>, like <code>&quot;http:&#47;&#47;xx.xxx.xxx.xxx&quot;</code>? The <code>http:&#47;&#47;</code> should make it a valid URL."}, {"owner": {"reputation": 115, "user_id": 3680029, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2f9062247d1bcf616e8a6cf493c00fc?s=128&d=identicon&r=PG&f=1", "display_name": "user3680029", "link": "https://stackoverflow.com/users/3680029/user3680029"}, "edited": false, "score": 0, "creation_date": 1559191533, "post_id": 56363889, "comment_id": 99345607, "body": "You&#39;re right parsing with &quot;http:// xx.xxx.xxx.xx&quot; do the job, I was sure that I checked this without success but now it&#39;s working (strange, I messed surely something else at the time..)"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1559175664, "creation_date": 1559175664, "answer_id": 56370120, "question_id": 56363889, "link": "https://stackoverflow.com/questions/56363889/build-request-with-ip-address/56370120#56370120", "title": "Build request with IP address", "body": "<p>This is more or less what you're supposed to do when you create a <code>Request</code> from scratch, except there's a predefined <code>defaultRequest</code> equivalent to <code>http://localhost</code>.  So, use:</p>\n\n<pre><code>request = setRequestMethod \"POST\"\n        $ setRequestHost (S8.pack \"xx.xxx.xxx.xxx\")\n        $ ... \n        $ defaultRequest\n</code></pre>\n\n<p>and I think you're doing it right.</p>\n"}], "owner": {"reputation": 115, "user_id": 3680029, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2f9062247d1bcf616e8a6cf493c00fc?s=128&d=identicon&r=PG&f=1", "display_name": "user3680029", "link": "https://stackoverflow.com/users/3680029/user3680029"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1559175664, "creation_date": 1559143308, "last_edit_date": 1559151362, "question_id": 56363889, "link": "https://stackoverflow.com/questions/56363889/build-request-with-ip-address", "title": "Build request with IP address", "body": "<p>I would like to know how to build a request with server's IP address (not URL).</p>\n\n<p>Actually I start with a given URL and then with the help of lenses rebuild the request:</p>\n\n<pre><code>   connect = do\n        request' &lt;- parseRequest \"http://localhost\"\n        let request = setRequestMethod \"POST\"\n                    $ setRequestHost (S8.pack (\"xx.xxx.xxx.xxx\"))\n                    $ ... \n</code></pre>\n\n<p>It works fine but it's inelegant, clumsy code.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1559143626, "last_edit_date": 1559143626, "creation_date": 1559142947, "answer_id": 56363776, "question_id": 56363625, "link": "https://stackoverflow.com/questions/56363625/using-either-in-data-validation/56363776#56363776", "title": "Using &quot;Either&quot; in data validation", "body": "<p>A basic way would be to define a custom helper function which collects the errors in a list:</p>\n\n<pre><code>collectError :: Error e a -&gt; [e]\ncollectError (Left e) = [e]\ncollectError _        = []   -- no errors\n</code></pre>\n\n<p>Then, we can exploit the helper as follows:</p>\n\n<pre><code>mkStudent :: String -&gt; String -&gt; String -&gt; Either [String] Student\nmkStudent fn ln a = case (validate fn, validate ln, validate a) of\n   (Right xfn, Right xln, Right xa) -&gt; Right (Student xfn xln xa)\n   (efn      , eln      , ea      ) -&gt;\n      Left (collectError efn ++ collectError eln ++ collectError ea)\n</code></pre>\n\n<p>This is probably not the most elegant way, but it is simple.</p>\n\n<hr>\n\n<p>If this pattern is frequently used in a program, I'd be tempted to craft a custom <code>Applicative</code> which logs all the errors. Something like</p>\n\n<pre><code>data Result e a = Error e | OK a \n  deriving Functor\n\ninstance Semigroup e =&gt; Applicative (Result e) where\n   pure = OK\n   (OK f) &lt;*&gt; (OK x) = OK $ f x\n   (Error e1) &lt;*&gt; (Error e2) = Error (e1 &lt;&gt; e2)\n   (Error e1) &lt;*&gt; _          = Error e1\n   _          &lt;*&gt; (Error e2) = Error e2\n</code></pre>\n\n<p>(This should already exist in the libraries under some name.)</p>\n\n<p>Then,</p>\n\n<pre><code>mkStudent :: String -&gt; String -&gt; String -&gt; Result [String] Student\nmkStudent fn ln a = \n   Student &lt;$&gt; validate fn\n           &lt;*&gt; validate ln\n           &lt;*&gt; validate a\n</code></pre>\n\n<p>should just work, provided the validation function return <code>Error [\"message\"]</code> on failure, with return type <code>Result [String] T</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "is_accepted": false, "score": 0, "last_activity_date": 1559143106, "creation_date": 1559143106, "answer_id": 56363817, "question_id": 56363625, "link": "https://stackoverflow.com/questions/56363625/using-either-in-data-validation/56363817#56363817", "title": "Using &quot;Either&quot; in data validation", "body": "<p>An easy fix would be to change the left <code>Either</code> to a custom data type. What I mean is that, instead of having <code>Either String Age</code>, you could have <code>Either ErrorType Age</code>, and then define</p>\n\n<pre><code>data ErrorType = LowAge | WrongName\n</code></pre>\n\n<p>In my opinion this would also be better programming practice because you'd be separating the error throwing and its handler. Especially in Haskell and functional programming, I wouldn't carry around string representations to handle errors. Then you can for example combine the errors into a list, i.e: </p>\n\n<pre><code>mkStudent :: String -&gt; String -&gt; String -&gt; Either [ErrorType] Student\n</code></pre>\n\n<p>Then just have another function to handle the list and print it to the user, or log it, or anything you'd want to do with it.</p>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 9, "last_activity_date": 1559170989, "last_edit_date": 1559170989, "creation_date": 1559143766, "answer_id": 56364011, "question_id": 56363625, "link": "https://stackoverflow.com/questions/56363625/using-either-in-data-validation/56364011#56364011", "title": "Using &quot;Either&quot; in data validation", "body": "<p>Either's Monad and Applicative instances <em>can't</em> accumulate errors: by law, they must stop at the first Left value. So if you want to use Either to accumulate errors, you have to do it by hand, not through the Applicative or Monad instances. </p>\n\n<p>What you're looking for instead is <a href=\"http://hackage.haskell.org/package/either-5.0.1.1/docs/Data-Either-Validation.html\" rel=\"nofollow noreferrer\">Validation</a>. With that, you could write:</p>\n\n<pre><code>causes :: Applicative f =&gt; Bool -&gt; a -&gt; Validation (f a) ()\nTrue `causes` err = Failure $ pure err\nFalse `causes` err = Success ()\n\nvalidateA :: String -&gt; Validation [String] Age\nvalidateA a = (Success . Age $ age)\n           &lt;* (age &lt;= 18) `causes` \"Student has to be at least 18\"\n           &lt;* (age &gt; 100) `causes` \"Student has more than 100 years. Probably it is an error.\"\n  where age = read a\n</code></pre>\n\n<p>and similarly for your other validators. <code>mkStudent</code> remains as you have written it: applicative combinators are the right way to combine Validation values.</p>\n"}], "owner": {"reputation": 39, "user_id": 11441910, "user_type": "registered", "profile_image": "https://graph.facebook.com/2280162792027047/picture?type=large", "display_name": "Adrian Kozie\u0144", "link": "https://stackoverflow.com/users/11441910/adrian-kozie%c5%84"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1611320791, "creation_date": 1559142418, "last_edit_date": 1611320791, "question_id": 56363625, "link": "https://stackoverflow.com/questions/56363625/using-either-in-data-validation", "title": "Using &quot;Either&quot; in data validation", "body": "<p>I have a program which is dedicated to create \"Student\" (First Name, Last Name, Age) and validate input data. My problem is that: when I insert student which e.g either name hasn't 2 letters or age is lower than 18 - the program only show one error. How to use \"Either function\" to create for example a string which contains all errors ? </p>\n\n<pre><code>module Student where\n\ndata Student = Student {firstName::FirstName, lastName::LastName, age::Age}\n  deriving Show\n\nnewtype FirstName = FirstName String\n  deriving Show\n\nnewtype LastName = LastName String\n  deriving Show\n\nnewtype Age = Age Int\n  deriving Show\n\nmkStudent :: String -&gt; String -&gt; String -&gt; Either String Student\nmkStudent fn ln a = \n   Student &lt;$&gt; validate fn\n           &lt;*&gt; validate ln\n           &lt;*&gt; validate a\n\naceptableLetters = ['a'..'z']++['A'..'Z']\n\nvalidateFn :: String -&gt; Either String FirstName\nvalidateFn fn \n   | length fn &lt; 2 = Left \"First name has to at least 2 letters\"\n   | length fn &gt; 100 = Left \"First name is limited to 100 characters\"\n   | not . null $ filter (\\c -&gt; not . elem c $ aceptableLetters) fn = Left \"First name contains unacceptable chars\"\n   | otherwise = Right . FirstName $ fn\n\nvalidateLn :: String -&gt; Either String LastName\nvalidateLn lastName \n   | length lastName &lt; 2 = Left \"Last name has to at least 2 letters\"\n   | length lastName &gt; 100 = Left \"Last name is limited to 100 characters\"\n   | not . null $ filter (\\c -&gt; not . elem c $ aceptableLetters) lastName = Left \"Last name contains unacceptable chars\"\n   | otherwise = Right . LastName $ lastName\n\nvalidateA :: String -&gt; Either String Age\nvalidateA a\n   | age &lt;= 18 = Left \"Student has to be at least 18\"\n   | age &gt; 100 = Left \"Student has more than 100 years. Probably it is an error.\"\n   | otherwise = Right . Age $ age\n   where\n    age = read a\n\nclass Validate v where\n    validate :: String -&gt; Either String v\n\ninstance Validate FirstName where\n    validate=validateFn\n\ninstance Validate LastName where\n    validate=validateLn\n\ninstance Validate Age where\n    validate=validateA\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 6, "last_activity_date": 1559143168, "last_edit_date": 1559143168, "creation_date": 1559140579, "answer_id": 56363086, "question_id": 56362834, "link": "https://stackoverflow.com/questions/56362834/haskell-function-iter-result/56363086#56363086", "title": "Haskell function iter result", "body": "<p><code>myList</code> does, indeed, represent the infinite list <code>[1,3,..]</code>. However, the list is generated lazily; the recursive call to <code>iter</code> is only made when required. Consider taking the head of <code>myList</code>:</p>\n\n<pre><code>head :: [a] -&gt; a\nhead (x:_) = x\n\nhead myList == head (iter (\\x -&gt; x + 2) 1)  -- definition of myList\n            == head (1 : iter (\\x -&gt; x + 2) ((\\x -&gt; x + 2) 1)) -- definition of iter\n            == 1 -- definition of head\n</code></pre>\n\n<p>The recursive call to <code>iter</code> specified by the definition of <code>iter</code> is never made, because <code>head</code> never tries to consume the tail of <code>myList</code>.</p>\n\n<hr>\n\n<p>I'll note here that <code>iter</code> is really an example of a <em>corecursive</em> function, not a recursive function. Haskell's non-strict evaluation blurs the distinction between the two. See <a href=\"https://softwareengineering.stackexchange.com/q/144274/206609\">https://softwareengineering.stackexchange.com/q/144274/206609</a>.</p>\n"}], "owner": {"reputation": 165, "user_id": 10605156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba993c69b70982a3134493528fa4bb80?s=128&d=identicon&r=PG&f=1", "display_name": "JameshGong", "link": "https://stackoverflow.com/users/10605156/jameshgong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 395, "favorite_count": 0, "accepted_answer_id": 56363086, "answer_count": 1, "score": 2, "last_activity_date": 1559143168, "creation_date": 1559139808, "question_id": 56362834, "link": "https://stackoverflow.com/questions/56362834/haskell-function-iter-result", "title": "Haskell function iter result", "body": "<p>I am new to Haskell and I am working on a problem for this function:</p>\n\n<pre><code>iter :: (t -&gt; t) -&gt; t -&gt; [t]\niter f a = a : iter f (f a)\nmyList = iter (\\x -&gt; x + 2) 1\n</code></pre>\n\n<p>My understanding of this is that:</p>\n\n<p>iter takes two arguments (t->t) and t and returns a list of [t].</p>\n\n<p>I am confused on the next part:</p>\n\n<pre><code>iter f a = a : iter f (f a)\n</code></pre>\n\n<p>is myList [1,3] or am I thinking about it in the wrong way?</p>\n\n<p>Or would it be [1,3,5,7..]?</p>\n"}, {"tags": ["haskell", "liquid-haskell"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1559137925, "creation_date": 1559137925, "answer_id": 56362220, "question_id": 56361702, "link": "https://stackoverflow.com/questions/56361702/are-these-examples-correct-or-the-tutorial-has-an-error/56362220#56362220", "title": "Are these examples correct or the tutorial has an error?", "body": "<p>I suspect in the example, they have made <code>(==&gt;)</code> right associative, while in your tests you left it at the default, which is left associative. Compare:</p>\n\n<pre><code>&gt; infixl 9 ==&gt;; False ==&gt; x = True; True ==&gt; x = x\n&gt; False ==&gt; (False ==&gt; False) ==&gt; False\nFalse\n&gt; infixr 9 ==&gt;; False ==&gt; x = True; True ==&gt; x = x\n&gt; False ==&gt; (False ==&gt; False) ==&gt; False\nTrue\n</code></pre>\n\n<p>The <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-820004.4.2\" rel=\"nofollow noreferrer\">Report</a> has further details.</p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 56362220, "answer_count": 1, "score": -1, "last_activity_date": 1559137925, "creation_date": 1559136244, "question_id": 56361702, "link": "https://stackoverflow.com/questions/56361702/are-these-examples-correct-or-the-tutorial-has-an-error", "title": "Are these examples correct or the tutorial has an error?", "body": "<p>I am reading <a href=\"https://ucsd-progsys.github.io/liquidhaskell-tutorial/02-logic.html\" rel=\"nofollow noreferrer\">this tutorial</a> and I am not sure that I understand correctly the text (or that it is correct at whole). There is an example:</p>\n\n<blockquote>\n  <p>The following predicates are valid because they encode modus ponens:\n  if you know that a implies b and you know that a is true, then it must\n  be the case that b is also true:</p>\n</blockquote>\n\n<pre><code>{-@ ex6 :: Bool -&gt; Bool -&gt; TRUE @-}\nex6 a b = (a &amp;&amp; (a ==&gt; b)) ==&gt; b\n\n{-@ ex7 :: Bool -&gt; Bool -&gt; TRUE @-}\nex7 a b = a ==&gt; (a ==&gt; b) ==&gt; b\n</code></pre>\n\n<p>and ex6 is fine, but ex7 is not, it fails for <code>a = false</code> and <code>b = false</code>. And LH repot it as:</p>\n\n<pre><code>Error: Liquid Type Mismatch\n\n 88 | ex7 a b = a ==&gt; (a ==&gt; b) ==&gt; b\n      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n   Inferred type\n     VV : {v : GHC.Types.Bool | v &lt;=&gt; ((a =&gt; (a =&gt; b)) =&gt; b)}\n\n   not a subtype of Required type\n     VV : {VV : GHC.Types.Bool | VV}\n\n   In Context\n     a : GHC.Types.Bool\n\n     b : GHC.Types.Bool\n</code></pre>\n\n<p>Also I don't understand their definition of the implication: \"You should read p ==> q as if p is true then q must also be true\". It does not sound correctly, because it asserts only one case: <code>T -&gt; T = T</code>. What do I miss here? May be tutorial has error in \"ex7\"?</p>\n"}, {"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1559132414, "post_id": 56360486, "comment_id": 99324244, "body": "What is not working with your attempt?"}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1559132580, "post_id": 56360486, "comment_id": 99324354, "body": "Sorry. It is not clear for me what your problem is..."}, {"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "edited": false, "score": 0, "creation_date": 1559132676, "post_id": 56360486, "comment_id": 99324435, "body": "I thought to start with something like map (_ -&gt; modify(+1)) xs, but then... After fold how can back to list?"}], "answers": [{"comments": [{"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "edited": false, "score": 0, "creation_date": 1559133882, "post_id": 56360713, "comment_id": 99325195, "body": "Does <code>&gt;&gt;</code> operator in <code>modify (1+) &gt;&gt; get</code> ignore the previous state?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "edited": false, "score": 2, "creation_date": 1559133942, "post_id": 56360713, "comment_id": 99325229, "body": "@mkUltra: no, <code>&gt;&gt;</code> omits the outcome of the previous <code>State s a</code> (so an <code>a</code>), but since <code>modify (1+)</code> is a <code>State Int ()</code>, there is no outcome anyway."}, {"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "edited": false, "score": 0, "creation_date": 1559287621, "post_id": 56360713, "comment_id": 99380094, "body": "I am wondering, is it possible to do the same using only MonadWriter?"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1559143602, "last_edit_date": 1559143602, "creation_date": 1559133095, "answer_id": 56360713, "question_id": 56360486, "link": "https://stackoverflow.com/questions/56360486/how-can-i-numerate-list-items-using-state-monad-in-haskell/56360713#56360713", "title": "How can I numerate list items using State monad in Haskell?", "body": "<p>We can implement a <code>State</code> object that will increment the state and return it, like:</p>\n\n<pre><code>incState :: State Int Int\nincState = modify (1+) &gt;&gt; get\n</code></pre>\n\n<p>Then we can run this <code>State Int Int</code> over the list, like:</p>\n\n<pre><code>numerate :: (Traversable t) =&gt; t a -&gt; t Int\nnumerate = flip evalState 0 . traverse (const incState)\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude Control.Monad.State&gt; numerate Nothing\nNothing\nPrelude Control.Monad.State&gt; numerate (Just 'a')\nJust 1\nPrelude Control.Monad.State&gt; numerate (Just 0)\nJust 1\nPrelude Control.Monad.State&gt; numerate [1,4,2,5]\n[1,2,3,4]\nPrelude Control.Monad.State&gt; numerate [(), (), ()]\n[1,2,3]\n</code></pre>\n\n<p>We can also work with other traversable structures, like a <a href=\"https://hackage.haskell.org/package/containers-0.6.0.1/docs/Data-Graph.html#t:Tree\" rel=\"nofollow noreferrer\"><strong><code>Tree</code></strong></a> for example:</p>\n\n<pre><code>Prelude Control.Monad.State Data.Tree&gt; numerate (Node 'a' [Node 'b' [], Node 'c' []])\nNode {rootLabel = 1, subForest = [Node {rootLabel = 2, subForest = []},Node {rootLabel = 3, subForest = []}]}\n</code></pre>\n"}], "owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 1, "accepted_answer_id": 56360713, "answer_count": 1, "score": 2, "last_activity_date": 1559143717, "creation_date": 1559132369, "last_edit_date": 1559143717, "question_id": 56360486, "link": "https://stackoverflow.com/questions/56360486/how-can-i-numerate-list-items-using-state-monad-in-haskell", "title": "How can I numerate list items using State monad in Haskell?", "body": "<p><strong>Problem:</strong></p>\n\n<p>I am trying to understand <a href=\"/questions/tagged/state-monad\" class=\"post-tag\" title=\"show questions tagged &#39;state-monad&#39;\" rel=\"tag\">state-monad</a>.</p>\n\n<p>A bit stuck to understand how can I use it, and I am looking for some example.</p>\n\n<p>Let's say I want to implement a function <code>[()] -&gt; [Int]</code>:</p>\n\n<pre><code>numerate :: [()] -&gt; [Int]\n</code></pre>\n\n<p>Should I map each element of the list to state and then fold it?</p>\n\n<p>How can I do it using <code>State</code>?</p>\n\n<p><strong>Expected behavior:</strong></p>\n\n<pre><code>numerate [(), (), (), (), ()]\n-- [1, 2, 3, 4, 5] \n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "clojure", "code-translation"], "comments": [{"owner": {"reputation": 46737, "user_id": 31615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1127d0098e693682f382758abd9f6c76?s=128&d=identicon&r=PG", "display_name": "Svante", "link": "https://stackoverflow.com/users/31615/svante"}, "edited": false, "score": 6, "creation_date": 1559116770, "post_id": 56354251, "comment_id": 99315511, "body": "-1 is a strange value to return here.  In Haskell, shoudn&#39;t this function be a <code>[[Char]] -&gt; Maybe Int</code>?  In Clojure, you&#39;d return <code>nil</code>."}], "answers": [{"tags": [], "owner": {"reputation": 15406, "user_id": 5400548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6117d9f5800bbdab47706d66d3c8d70b?s=128&d=identicon&r=PG&f=1", "display_name": "leetwinski", "link": "https://stackoverflow.com/users/5400548/leetwinski"}, "is_accepted": true, "score": 10, "last_activity_date": 1559130238, "last_edit_date": 1559130238, "creation_date": 1559112060, "answer_id": 56354494, "question_id": 56354251, "link": "https://stackoverflow.com/questions/56354251/haskell-function-to-clojure-function-conversion/56354494#56354494", "title": "Haskell Function to Clojure function conversion", "body": "<p>as far as i can see, this function returns length of an element, if all elements have the equal length. In this case it could look like this:</p>\n\n<pre><code>(defn map-len [[x &amp; [y :as xs]]]\n  (cond (empty? xs) (count x)\n        (not= (count x) (count y)) -1\n        :else (recur xs)))\n</code></pre>\n\n<p>which is almost the exact rewrite of haskell variant (replacing straight recursive call with <code>recur</code>)</p>\n\n<pre><code>(map-len [[1 2] [3 4] [5 6]])\n;;=&gt; 2\n\n(map-len [[1 2] [3 4 5] [5 6]])\n;;=&gt; -1\n</code></pre>\n\n<p>bot since clojure is about operations on sequences, you can do it in a more idiomatic way (as for me, it is):</p>\n\n<pre><code>(defn map-len2 [data]\n  (cond (empty? data) 0\n        (apply = (map count data)) (count (first data))\n        :else -1))\n\n(defn map-len3 [[x &amp; xs]]\n  (let [c (count x)]\n    (if (every? #(= c (count %)) xs)\n      c\n      -1)))\n</code></pre>\n"}], "owner": {"reputation": 462, "user_id": 6167383, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-B2CvmUD10Ls/AAAAAAAAAAI/AAAAAAAAJxk/QO9-b7j7-bY/photo.jpg?sz=128", "display_name": "Aravind", "link": "https://stackoverflow.com/users/6167383/aravind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 56354494, "answer_count": 1, "score": 1, "last_activity_date": 1559132259, "creation_date": 1559110863, "last_edit_date": 1559132259, "question_id": 56354251, "link": "https://stackoverflow.com/questions/56354251/haskell-function-to-clojure-function-conversion", "title": "Haskell Function to Clojure function conversion", "body": "<p>Trying to convert Haskell function to Clojure. But facing difficulties. Not sure what's happening.</p>\n\n<p>Here's recursive Haskell function.</p>\n\n<pre><code>  mapWidth :: [[Char]] -&gt; Int\n  mapWidth [] = 0\n  mapWidth (x:xs)\n  | length xs == 0 = length x\n  | length x /= length (xs!!0) = -1\n  | otherwise = mapWidth(xs)\n</code></pre>\n\n<p>Here's what I've tried so far : </p>\n\n<pre><code>(defn mapWidth [data_list]\n    (def data 0)\n    ([[x &amp; xs](seq data_list)](if (= (count x) 0) \n    (data 0)\n    (data -1))))\n    ([[x &amp; xs](seq data_list)](if not(= (count xs) length (xs!!0))\n    (data 0)\n    (data -1)\n    mapWidth(xs)))\n</code></pre>\n\n<p>Any help is appreciated. I'm pretty new to both the languages.</p>\n"}, {"tags": ["haskell", "exception", "directory"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 2, "creation_date": 1559112387, "post_id": 56354220, "comment_id": 99313335, "body": "What is <code>getDirContent</code>? I can&#39;t find it anywhere. I&#39;m guessing it&#39;s a function you wrote yourself; in that case, could you include its implementation in your code sample? (I need it to get a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>)"}], "answers": [{"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 2, "creation_date": 1559125807, "post_id": 56357504, "comment_id": 99320568, "body": "I think it&#39;s worth noting that this is equivalent to <code>unless (null a) $ doesDirectoryExist a &gt;&gt;= \\case</code> (using <code>unless</code> from <code>Control.Monad</code>), which is simpler while doing the same thing. Even as someone who really likes applicatives, I did have trouble parsing your statement."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1559136348, "post_id": 56357504, "comment_id": 99326748, "body": "typedfern&#39;s solution is not exactly the same (I know what applicatives are, but not so experienced to know what to use when). It returns the error-message, while your solution (bradm) terminates the call without a message. Both your solutions learned me a lot. Thanks for that (even without the missing code). Alhough bradm&#39;s code is more terse, typedfern provided the info I was looking for."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1559142767, "post_id": 56357504, "comment_id": 99330571, "body": "<code>((not (null a) &amp;&amp;) &lt;$&gt; doesDirectoryExist a) &gt;&gt;= \\case</code> is exactly equivalent to what&#39;s in this answer, but way less complicated. Also, note that this way has the flaw that the <code>&amp;&amp;</code> can&#39;t short-circuit the IO bit, whereas bradrn&#39;s <code>unless</code> way doesn&#39;t have that flaw."}, {"owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "edited": false, "score": 0, "creation_date": 1559167233, "post_id": 56357504, "comment_id": 99340773, "body": "Joseph is right, doing (&amp;&amp;) &lt;$&gt; ioOp1 &lt;*&gt; ioOp2 executes ioOp2 even when unneeded - doesn&#39;t harm in this particular case, but best avoided; fixed."}], "tags": [], "owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "is_accepted": true, "score": -2, "last_activity_date": 1559166007, "last_edit_date": 1559166007, "creation_date": 1559122765, "answer_id": 56357504, "question_id": 56354220, "link": "https://stackoverflow.com/questions/56354220/haskell-caught-directory-not-exist-but-not-empty-value/56357504#56357504", "title": "Haskell caught directory not exist but not empty value", "body": "<p>You can replace the line:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>doesDirectoryExist a &gt;&gt;= \\case\n</code></pre>\n\n<p>with:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>((&amp;&amp;) &lt;$&gt; (pure $ not $ null a) &lt;*&gt; doesDirectoryExist a) &gt;&gt;= \\case\n</code></pre>\n\n<p>This is called \"applicative style\" (in case you didn't know it ;-)); I am combining two IO operations that return a boolean using the AND (&amp;&amp;) operator.</p>\n\n<p>The (pure $ not $ null a) expression checks that the string isn't empty, and uses \"pure\" to lift a pure operation into an IO (so we can combine it with doesDirectoryExist into an expression that checks for both conditions).</p>\n\n<p>EDIT:</p>\n\n<p>As Joseph noted, the above executes doesDirectoryExist whether it is needed or not; you usually want to avoid that (unless you somehow rely on its side effects); you can avoid it with bradrn's suggestion; you can also do this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(if null a then pure False else doesDirectoryExist a) &gt;&gt;= \\case\n</code></pre>\n\n<p>Alternatively, since you dislike if-then-else notation (as do I):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(case null a of True -&gt; pure False; False -&gt; doesDirectoryExist a) &gt;&gt;= \\case\n</code></pre>\n\n<p>Not really cleaner, though; you can import Data.Bool and do this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- import Data.Bool\n(bool (doesDirectoryExist a) (pure False) $ null a) &gt;&gt;= \\case\n</code></pre>\n\n<p>(\"bool\" is just a more functional-like notation for the good old if-then-else)</p>\n"}, {"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1559141534, "post_id": 56360504, "comment_id": 99329929, "body": "Joseph Sible: added getDirContent. I am not to keen on if..then..else. Like <code>case</code> and guards more, seems a little clearer, hence the reason I did not choose that construct."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1559142506, "post_id": 56360504, "comment_id": 99330441, "body": "@Madderote if you understand how to do it with if-then-else, rewriting it to use <code>case</code> and guards is trivial."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1559142828, "post_id": 56360504, "comment_id": 99330618, "body": "you&#39;re right. Excuse my comment. It is just that I like to clean looks of case and guards better."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 0, "last_activity_date": 1559132403, "creation_date": 1559132403, "answer_id": 56360504, "question_id": 56354220, "link": "https://stackoverflow.com/questions/56354220/haskell-caught-directory-not-exist-but-not-empty-value/56360504#56360504", "title": "Haskell caught directory not exist but not empty value", "body": "<p>The problem is that <code>doesDirectoryExist \"\"</code> returns <code>True</code>, but whatever is in your <code>getDirContent</code> function (which you'll need to post if you want a more detailed answer) doesn't work when passed <code>\"\"</code>.</p>\n\n<p>There's no need for <code>Maybe</code> or <code>Either</code> to fix it. Just wrap the block in an <code>if</code> construct, and put something like <code>putStrLn \"You must enter a directory name\"</code> in the <code>else</code>.</p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 56357504, "answer_count": 2, "score": 0, "last_activity_date": 1559166007, "creation_date": 1559110726, "last_edit_date": 1559137518, "question_id": 56354220, "link": "https://stackoverflow.com/questions/56354220/haskell-caught-directory-not-exist-but-not-empty-value", "title": "Haskell caught directory not exist but not empty value", "body": "<p>With the <code>LambdaCase</code> I am able to filter out if a dir does not exist. However: if a user is prompted and hits enter (empty) I still get an exception. \nI think <code>Maybe</code> or <code>Either</code> can help me here, but I have a hard time figuring out how to set this up. </p>\n\n<pre><code>    {-# LANGUAGE LambdaCase #-}\n\n\n    import System.Directory \n    import System.IO\n\n    dirExist = do \n      a &lt;- prompt \"Directory:&gt; \"\n      doesDirectoryExist a &gt;&gt;= \\case \n        True -&gt; getDirContent a\n        _ -&gt; putStrLn \"Directory does not exist or invalid value specified.\" \n\ngetDirContent :: FilePath -&gt; IO () \ngetDirContent dir = do  \n  result &lt;- getDirectoryContents dir \n  mapM_ putStrLn $ result \n\n\n    prompt :: String -&gt; IO String \n    prompt x = do \n      putStr x \n      a &lt;- getLine \n      return a\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1559139851, "post_id": 56353258, "comment_id": 99328933, "body": "Check this out. <a href=\"http://hackage.haskell.org/package/bcrypt\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/bcrypt</a>"}], "owner": {"reputation": 17, "user_id": 11270452, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rh2mOaSvJ8E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re89iRgdyu8Jwr2suAMVwDDNK4a6w/mo/photo.jpg?sz=128", "display_name": "Manuel", "link": "https://stackoverflow.com/users/11270452/manuel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 28, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1559105179, "creation_date": 1559105179, "question_id": 56353258, "link": "https://stackoverflow.com/questions/56353258/creating-a-user-with-salted-password-to-use-authemail-instead-of-auth-dummy", "title": "Creating a user with salted password to use AuthEmail instead of Auth.Dummy", "body": "<p>I'm trying to replace Auth.Dummy with Auth.Email in the test suite of a yesod scaffolded site (postgres), however I can't manage to salt the password when creating the user. </p>\n\n<p>I have set Auth.Email on Foundation.hs and it works fine. I also set the authenticateAs function to authenticate through Auth.Email login. But when running the test, the authentication fail. I believe it is because the saved password is not salted. How can I salt the password?</p>\n\n<p>TestImport.hs</p>\n\n<pre><code>authenticateAs :: Entity User -&gt; YesodExample App ()\nauthenticateAs (Entity _ u) = do\n    request $ do\n        setMethod \"POST\"\n        addPostParam \"email\" $ userEmail u\n        addPostParam \"password\" \"secret\"\n        setUrl $ AuthR $ PluginR \"email\" [\"login\"]\n\ncreateUser :: Text -&gt; YesodExample App (Entity User)\ncreateUser ident = runDB $ do\n    user &lt;- insertEntity User\n        { userEmail = ident\n        , userPassword = Just \"secret\"\n        , userVerkey = Nothing\n        , userVerified = True\n        }\n    return user\n</code></pre>\n\n<p>in test/Handler/Profile.hs</p>\n\n<pre><code>    it \"asserts access to my-account for authenticated users\" $ do\n            userEntity &lt;- createUser \"foo\"\n            authenticateAs userEntity\n\n            get ProfileR\n            statusIs 200\n</code></pre>\n\n<p>How can I create the user with a salted password?</p>\n\n<p>This is the error message I'm getting\u00c7:</p>\n\n<pre><code>asserts access to my-account for authenticated users FAILED [1]\n2.0.0.0 - - [29/May/2019:13:39:35 +0900] \"POST /auth/page/email/login HTTP/1.1\" 303 0 \"\" \"\"\n2.0.0.0 - - [29/May/2019:13:39:35 +0900] \"GET /profile HTTP/1.1\" 403 3105 \"\" \"\"\n\nFailures:\n\n  test/Handler/ProfileSpec.hs:20:13: \n  1) Handler.Profile, Profile page, asserts access to my-account for authenticated users\n       Expected status was 200 but received status was 403\n</code></pre>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 1, "creation_date": 1559101630, "post_id": 56352773, "comment_id": 99310129, "body": "Can you show the type definition of <code>Command</code> please?"}, {"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 0, "creation_date": 1559101884, "post_id": 56352773, "comment_id": 99310185, "body": "Thanks I see the type definition. <code>Command</code> is a function. My next question is where does <code>forward 15</code> come from?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1559101894, "post_id": 56352773, "comment_id": 99310188, "body": "See also <a href=\"https://stackoverflow.com/q/17045941/791604\">How to compare two functions for equivalence?</a>. In short: come up with a plan that doesn&#39;t require comparing two <code>Command</code>s for equality, cause it ain&#39;t gonna happen sanely."}, {"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 0, "creation_date": 1559101931, "post_id": 56352773, "comment_id": 99310196, "body": "I&#39;m thinking the most natural approach to what you want to do is to make command a data type."}, {"owner": {"reputation": 122, "user_id": 9500680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59cb43298b64ce18abc6d4b6954918e2?s=128&d=identicon&r=PG&f=1", "display_name": "Bhushan Oza", "link": "https://stackoverflow.com/users/9500680/bhushan-oza"}, "edited": false, "score": 0, "creation_date": 1559101991, "post_id": 56352773, "comment_id": 99310212, "body": "I have edited again"}, {"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 0, "creation_date": 1559102788, "post_id": 56352773, "comment_id": 99310382, "body": "Ah, now it makes sense. See Daniel&#39;s answer."}], "answers": [{"comments": [{"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "reply_to_user": {"reputation": 122, "user_id": 9500680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59cb43298b64ce18abc6d4b6954918e2?s=128&d=identicon&r=PG&f=1", "display_name": "Bhushan Oza", "link": "https://stackoverflow.com/users/9500680/bhushan-oza"}, "edited": false, "score": 0, "creation_date": 1559101662, "post_id": 56352807, "comment_id": 99310136, "body": "I just saw your question edit, sorry. Can you show the type definition, please?"}, {"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "reply_to_user": {"reputation": 122, "user_id": 9500680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59cb43298b64ce18abc6d4b6954918e2?s=128&d=identicon&r=PG&f=1", "display_name": "Bhushan Oza", "link": "https://stackoverflow.com/users/9500680/bhushan-oza"}, "edited": false, "score": 0, "creation_date": 1559102727, "post_id": 56352807, "comment_id": 99310368, "body": "Thanks, deferring to Daniel Wagner&#39;s answer."}], "tags": [], "owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "is_accepted": false, "score": 0, "last_activity_date": 1559101588, "last_edit_date": 1559101588, "creation_date": 1559101380, "answer_id": 56352807, "question_id": 56352773, "link": "https://stackoverflow.com/questions/56352773/compare-functions-in-haskell/56352807#56352807", "title": "Compare functions in haskell", "body": "<p>You might be missing a <code>deriving</code> clause in your <code>data</code> definition.</p>\n\n<pre><code>Prelude&gt; data Command = Forward Int | Left Int | Right Int deriving (Eq, Show)\nPrelude&gt; Forward 15 == Forward 15\nTrue\n</code></pre>\n\n<p>If you do not have the deriving clause you will see</p>\n\n<blockquote>\n  <p>No instance for (Eq Command) arising from a use of \u2018==\u2019</p>\n</blockquote>\n\n<p>By the way, while it is true that <code>Forward</code> happens to be a (constructor) function, you want to make sure you are doing <code>==</code> comparisons not on functions themselves (you can't do this in Haskell) but rather on the result of applying the function. So you can never compare</p>\n\n<pre><code>Forward == Forward\n</code></pre>\n\n<p>because the type of <code>Forward</code> is <code>Int-&gt;Command</code> (a function) but you <em>can</em> compare</p>\n\n<pre><code>Forward 15 == Forward 15\n</code></pre>\n\n<p>as long as you associate the type <code>Command</code> with the <code>Eq</code> typeclass.</p>\n"}, {"comments": [{"owner": {"reputation": 122, "user_id": 9500680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59cb43298b64ce18abc6d4b6954918e2?s=128&d=identicon&r=PG&f=1", "display_name": "Bhushan Oza", "link": "https://stackoverflow.com/users/9500680/bhushan-oza"}, "edited": false, "score": 0, "creation_date": 1559102888, "post_id": 56352888, "comment_id": 99310398, "body": "I added <code>DForward Float</code> to <code>Reified Command</code> and <code>interpret (DForward x) = forward (2*x)</code> to <code>interpret</code>. Then I used <code>replace [Forward] [DForward] x</code>. But it gave me error <code>No instance for (Eq (Float -&gt; ReifiedCommand))         arising from a use of \u2018replace\u2019 </code>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1559105750, "post_id": 56352888, "comment_id": 99310973, "body": "That sounds like a new question - none of those elements were presented in the above.  Daniel just gave you a solution which is basically &quot;Don&#39;t compare functions, compare the inputs&quot; and you just went right back to trying to compare functions. EDIT: stated another waay, you can&#39;t compare <code>DForward</code> but you can compare the fully-applied form such as <code>DForward 2</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 122, "user_id": 9500680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59cb43298b64ce18abc6d4b6954918e2?s=128&d=identicon&r=PG&f=1", "display_name": "Bhushan Oza", "link": "https://stackoverflow.com/users/9500680/bhushan-oza"}, "edited": false, "score": 0, "creation_date": 1559225210, "post_id": 56352888, "comment_id": 99360064, "body": "@BhushanOza Don&#39;t do that. Instead, replace <code>Forward foo</code> with <code>Forward (foo*2)</code>. (You may not be able to reuse the exact <code>replace</code> function you have.)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1559102085, "creation_date": 1559102085, "answer_id": 56352888, "question_id": 56352773, "link": "https://stackoverflow.com/questions/56352773/compare-functions-in-haskell/56352888#56352888", "title": "Compare functions in haskell", "body": "<p>I recommend making a new data type for commands, and an interpreter into the <code>Command</code> semantic domain. For example:</p>\n\n<pre><code>data ReifiedCommand\n    = Forward Float\n    | Backward Float\n    | Left Float\n    | Right Float\n    deriving (Eq, Ord, Read, Show)\n\ninterpret :: ReifiedCommand -&gt; Command\ninterpret (Forward x) = forward x\ninterpret (Backward x) = backward x\ninterpret (Left x) = left x\ninterpret (Right x) = right x\n</code></pre>\n\n<p>Now you may compare <code>ReifiedCommand</code>s for equality and do whatever inspection you need to do to build a suitable <code>[ReifiedCommand]</code>, and then all at once at the end you may <code>interpret</code> these into a <code>[Command]</code> (or, more likely I think, even a single <code>Command</code>).</p>\n"}], "owner": {"reputation": 122, "user_id": 9500680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59cb43298b64ce18abc6d4b6954918e2?s=128&d=identicon&r=PG&f=1", "display_name": "Bhushan Oza", "link": "https://stackoverflow.com/users/9500680/bhushan-oza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 56352888, "answer_count": 2, "score": 0, "last_activity_date": 1559134988, "creation_date": 1559101091, "last_edit_date": 1559134988, "question_id": 56352773, "link": "https://stackoverflow.com/questions/56352773/compare-functions-in-haskell", "title": "Compare functions in haskell", "body": "<p>I have a list of commands (<code>[Command]</code>) which looks like <code>[forward 15, left 20, right 10]</code>. \nI want to add <code>forward 15</code> to <code>[Command]</code> whenever I see a <code>forward 15</code> command. I used <code>elem</code> and <code>==</code> to compare whether the element is <code>forward 15</code> or not but it gives me <code>No instance for (Eq Command) arising</code> error.\nAlso, in another function, I want to add <code>[left 15, forward 15, forward 15, right 15, right 15, forward 15, forward 15, left 15]</code> to <code>[Command]</code> whenever I see 4 consecutive <code>forward 15</code> commands.\nThus my question is how to compare functions, because <code>forward</code> is a function and I can't compare it using <code>elem</code> or <code>==</code>.</p>\n\n<p><code>Command</code> is defined as a <code>type</code>, not as a <code>data</code>, hence I can't use <code>deriving Eq</code>.</p>\n\n<pre><code>type Command = Funcs -&gt; (Picture, Funcs)\n\ndata Funcs = Funcs {pen :: Bool, angle :: Float, point :: Point, penColor :: Color} deriving (Eq, Show)\n\nforward :: Float -&gt; Command\nforward x = ....\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "clash"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 2, "last_activity_date": 1560742765, "creation_date": 1560742765, "answer_id": 56624443, "question_id": 56352379, "link": "https://stackoverflow.com/questions/56352379/why-does-the-inliner-choke-on-this-construct/56624443#56624443", "title": "Why does the inliner choke on this construct?", "body": "<p>It turned out the real culprit was not <code>FetchM</code>, but other parts of my code that required inlining of a lot of functions (one per each monadic bind in my main <code>CPU</code> monad!), and <code>FetchM</code> just increased the number of binds.</p>\n\n<p>The real problem was that my <a href=\"https://github.com/gergoerdi/clash-utils/blob/cdc38b8e50e36474e7725775b456336474024515/src-clash/Cactus/Clash/CPU.hs#L12\" rel=\"nofollow noreferrer\"><code>CPU</code> monad was, among other things, a <code>Writer (Endo CPUOut)</code></a>, and all those <code>CPUOut -&gt; CPUOut</code> functions needed to be fully inlined since CLaSH can't represent functions as signals.</p>\n\n<p>All of this is explained in more detail in <a href=\"https://github.com/clash-lang/clash-compiler/issues/613\" rel=\"nofollow noreferrer\">the related CLaSH bug ticket</a>.</p>\n"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 56624443, "answer_count": 1, "score": 3, "last_activity_date": 1560742765, "creation_date": 1559097720, "question_id": 56352379, "link": "https://stackoverflow.com/questions/56352379/why-does-the-inliner-choke-on-this-construct", "title": "Why does the inliner choke on this construct?", "body": "<p>I am trying to share as much code as possible between emulators and a CLaSH implementations for CPUs. As part of this, I am writing instruction fetching &amp; decoding as something along the lines of</p>\n\n<pre><code>fetchInstr :: (Monad m) =&gt; m Word8 -&gt; m Instr\n</code></pre>\n\n<p>This is trivial to run in the emulator using a monad that has a program counter in its state and direct access to memory. For the hardware version, I make a fixed-size buffer (since the instruction byte-length is bounded) and in every cycle, short-circuit the fetching if there is not enough data in the buffer yet. </p>\n\n<pre><code>data Failure\n    = Underrun\n    | Overrun\n    deriving Show\n\ndata Buffer n dat = Buffer\n    { bufferContents :: Vec n dat\n    , bufferNext :: Index (1 + n)\n    }\n    deriving (Show, Generic, Undefined)\n\ninstance (KnownNat n, Default dat) =&gt; Default (Buffer n dat) where\n    def = Buffer (pure def) 0\n\nremember :: (KnownNat n) =&gt; Buffer n dat -&gt; dat -&gt; Buffer n dat\nremember Buffer{..} x = Buffer\n    { bufferContents = replace bufferNext x bufferContents\n    , bufferNext = bufferNext + 1\n    }\n\nnewtype FetchM n dat m a = FetchM{ unFetchM :: ReaderT (Buffer n dat) (StateT (Index (1 + n)) (ExceptT Failure m)) a }\n    deriving newtype (Functor, Applicative, Monad)\n\nrunFetchM :: (Monad m, KnownNat n) =&gt; Buffer n dat -&gt; FetchM n dat m a -&gt; m (Either Failure a)\nrunFetchM buf act = runExceptT $ evalStateT (runReaderT (unFetchM act) buf) 0\n\nfetch :: (Monad m, KnownNat n) =&gt; FetchM n dat m dat\nfetch = do\n    Buffer{..} &lt;- FetchM ask\n    idx &lt;- FetchM get\n    when (idx == maxBound) overrun\n    when (idx &gt;= bufferNext) underrun\n    FetchM $ modify (+ 1)\n    return $ bufferContents !! idx\n  where\n    overrun = FetchM . lift . lift . throwE $ Overrun\n    underrun = FetchM . lift . lift . throwE $ Underrun\n</code></pre>\n\n<p>The idea is that this would be used by storing a <code>Buffer n dat</code> in the CPU's state during instruction fetching, and <code>remember</code>ing values coming in from memory while there is a buffer underrun:</p>\n\n<pre><code>case cpuState of\n Fetching buf -&gt; do\n            buf' &lt;- remember buf &lt;$&gt; do\n                modify $ \\s -&gt; s{ pc = succ pc }\n                return cpuInMem\n            instr_ &lt;- runFetchM buf' $ fetchInstr fetch\n            instr &lt;- case instr_ of\n                Left Underrun -&gt; goto (Fetching buf') &gt;&gt; abort\n                Left Overrun -&gt; errorX \"Overrun\"\n                Right instr -&gt; return instr\n            goto $ Fetching def\n            exec instr\n</code></pre>\n\n<p>This works just fine in the CLaSH simulator. </p>\n\n<p>The problem is, if I start using it this way, it needs a lot bigger inlining limit for CLaSH to be able to synthesize it. For example, on a CHIP-8 implementation, <a href=\"https://github.com/gergoerdi/chip8-clash/commit/9ca30e40e2b7798f294b8507402f85eb46ad7228\" rel=\"nofollow noreferrer\">this commit</a> starts using the above-described <code>FetchM</code>. Before this change, an inlining depth of just 100 is enough to get through the CLaSH synthesizer; after this change, 300 is not enough and 1000 causes CLaSH to just churn until it runs out of memory.</p>\n\n<p>What is so evil about <code>FetchM</code> that the inliner chokes on it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 2, "creation_date": 1559075761, "post_id": 56349611, "comment_id": 99304289, "body": "You can use <code>Generic</code> at type level. You don&#39;t have to create a value of <code>Rep</code>, you can inspect its type."}, {"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1559076296, "post_id": 56349611, "comment_id": 99304523, "body": "I&#39;m not sure I follow. How would you implement <code>forall a . Generic a =&gt; Int</code>?"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 1, "creation_date": 1559077292, "post_id": 56349611, "comment_id": 99304947, "body": "If you&#39;re just trying to avoid passing a concrete value for <code>a</code>, you can use a <code>Proxy</code> value or the <code>TypeApplications</code> extension. If you want these calculations to happen during compile-time instead of runtime, I wouldn&#39;t be surprised if GHC does that regardless during optimization, but I don&#39;t know for sure."}, {"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 0, "creation_date": 1559077478, "post_id": 56349611, "comment_id": 99305036, "body": "The problem is not at the call-site. The problem is implementing a function with that signature altogether. If I use <code>from</code> to implement that function it absolutely <i>must</i> inspect the value. Take for instance <code>from @(T ()) undefined</code> which is bottom."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1559077494, "post_id": 56349611, "comment_id": 99305046, "body": "Finding the arity of the constructor is quite straightforward.. e.g. calling it as <code>arity T</code> (<code>T</code> on the value level)"}, {"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1559077596, "post_id": 56349611, "comment_id": 99305092, "body": "@luqui how do you implement <code>arity</code>? Or if you&#39;re referring to a library function, can you provide a link?"}], "answers": [{"comments": [{"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 0, "creation_date": 1559080106, "post_id": 56350316, "comment_id": 99305888, "body": "This is not quite what I was going for. I can understand if it&#39;s not super clear what I&#39;m aiming for. For one thing I should&#39;ve named the value- and type-constructor in my example differently. Your implementation of <code>arity</code> still needs a value passed into it. I was hoping that e.g. <code>Typeable</code> would let me answer the question assuming that some type <code>T</code> belongs to the class described above, how many fields does it have. The context in which I want to use this I only have my type appearing in a positive position. So I can not pass it into another function. Only use the type-level information."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 0, "creation_date": 1559080281, "post_id": 56350316, "comment_id": 99305944, "body": "@fredefox yes i was answering your question to me in the comments.  You can get what you are looking for using <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Generics.html\" rel=\"nofollow noreferrer\"><code>GHC.Generics</code></a>."}, {"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 0, "creation_date": 1559080356, "post_id": 56350316, "comment_id": 99305966, "body": "Ah yes, you did indeed say the arity of the <i>constructor</i>."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 2, "creation_date": 1559091091, "post_id": 56350316, "comment_id": 99308293, "body": "A type might have many constructors, each of different arity. GHC doesn&#39;t know your type has only one constructor, unless you use <code>Generics</code> - see Li-yao Xia&#39;s answer. So if you want the arity of the constructor, you must supply a constructor, that is: a value, not just the datatype."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 5, "last_activity_date": 1559080490, "last_edit_date": 1559080490, "creation_date": 1559079242, "answer_id": 56350316, "question_id": 56349611, "link": "https://stackoverflow.com/questions/56349611/generically-determining-arity-of-data-types/56350316#56350316", "title": "Generically determining arity of data types", "body": "<p>To answer your question to me in the comments, here's an example of how you can find the arity of a function.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables, FlexibleInstances #-}\n\nimport Data.Proxy\n\nclass Arity a where\n    arityP :: Proxy a -&gt; Int\n\ninstance {-# OVERLAPPABLE #-} Arity a where\n    arityP _ = 0\n\ninstance {-# OVERLAPPING #-} Arity b =&gt; Arity (a -&gt; b) where\n    arityP f = 1 + arityP (Proxy :: Proxy b)\n\narity :: forall a. Arity a =&gt; a -&gt; Int\narity _ = arityP (Proxy :: Proxy a)\n</code></pre>\n\n<p>I feel like this is fairly self-explanatory if you are comfortable with the idioms involved.  This will work well for the use case you asked about, where you are trying to find the arity of a data type/constructor.</p>\n\n<pre><code>ghci&gt; arity T\n4\n</code></pre>\n\n<p>Where it doesn't work is if you try to use it on a polymorphic function.</p>\n\n<pre><code>ghci&gt; arity id\n&lt;interactive&gt;:2:1: error:\n\u2022 Overlapping instances for Arity a0 arising from a use of \u2018arity\u2019\n  Matching instances:\n    instance [overlappable] [safe] Arity a -- Defined at arity.hs:10:31\n    instance [overlapping] [safe] Arity b =&gt; Arity (a -&gt; b)\n      -- Defined at arity.hs:13:30\n</code></pre>\n\n<p>This makes sense because <code>id</code> potentially has multiple arities, depending on where it is instantiated</p>\n\n<pre><code>id :: Int -&gt; Int\nid :: (Int -&gt; Int) -&gt; Int -&gt; Int\n</code></pre>\n\n<p>Which actually increases my confidence in this approach.  Let me know how it works out.</p>\n"}, {"comments": [{"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 0, "creation_date": 1559114528, "post_id": 56351505, "comment_id": 99314308, "body": "Wow! This required a lot more machinery than I was thinking. I did think the answer would be in <code>Rep</code> as pointed out by @Fyodor Soikin in the comments, but since it was itself a type I couldn&#39;t figure out how to write a function like this. I suppose I should look into &quot;Thinking with Types&quot;. I wonder if <code>-XDependentTypes</code> would make the solution more elegant somehow... Great answer!"}, {"owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 0, "creation_date": 1559142027, "post_id": 56351505, "comment_id": 99330189, "body": "I hope you don&#39;t mind that I used it here: <a href=\"https://github.com/fredefox/mysql-simple/blob/fredefox/generic-quasi/Database/MySQL/Simple/Arity.hs\" rel=\"nofollow noreferrer\">github.com/fredefox/mysql-simple/blob/fredefox/generic-quasi&zwnj;&#8203;/&hellip;</a> for this PR: <a href=\"https://github.com/paul-rouse/mysql-simple/pull/50\" rel=\"nofollow noreferrer\">github.com/paul-rouse/mysql-simple/pull/50</a>"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "edited": false, "score": 0, "creation_date": 1559153720, "post_id": 56351505, "comment_id": 99335860, "body": "Sure, that&#39;s totally free!"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 7, "last_activity_date": 1559091181, "last_edit_date": 1559091181, "creation_date": 1559088533, "answer_id": 56351505, "question_id": 56349611, "link": "https://stackoverflow.com/questions/56349611/generically-determining-arity-of-data-types/56351505#56351505", "title": "Generically determining arity of data types", "body": "<p>We can use generics. Quite a few extensions are used throughout this answer, common for this variety of metaprogramming. I'll mention the first time they are used but for more details refer to other resources such as the GHC user guide (<a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html\" rel=\"noreferrer\">list of extensions</a>)\n or the Haskell wiki.</p>\n\n<pre><code>data T = T Int Bool String deriving Generic\n\n-- Used extension: DeriveGeneric\n</code></pre>\n\n<p>The derived instance includes a type family instance for <code>Rep</code>, which constructs a <em>generic representation</em> of the type <code>T</code>. <code>Rep T</code> uses a fixed set of types found in <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Generics.html\" rel=\"noreferrer\">the <code>GHC.Generics</code> module</a>:</p>\n\n<pre><code>type Rep T = M1 D _ ((M1 C _ (K1 _ Int) :*: M1 C _ (K1 _ Bool)) :*: M1 C _ (K1 _ String))\n--\n-- Irrelevant details hidden in underscores.\n-- There's actually a few more M1's as well\n--\n-- You can see the full and real details in a ghci session with this command\n--   :kind! Rep T\n</code></pre>\n\n<h1>The Arity function</h1>\n\n<p>We will define a type-level function to inspect that structure and compute the number of fields. This is its signature:</p>\n\n<pre><code>type family Arity (f :: Type -&gt; Type) :: Nat\n-- If T is a type with one constructor (C x1 ... xn),\n-- Arity (Rep T) is the arity n of that constructor\n\n-- Used extensions: TypeFamilies, DataKinds\n</code></pre>\n\n<p>When it comes to generic representation, we can pretend that <code>TT = (Type-&gt;Type)</code> is like an ADT with the following constructors:</p>\n\n<pre><code>-- We can pretend that there is this data type TT\n-- such that Arity is a function (TT -&gt; Nat)\ndata TT\n  = M1 Type Meta TT\n  | (:+:) TT TT\n  | V1\n  | (:*:) TT TT\n  | U1\n  | K1 Type Type\n</code></pre>\n\n<p>Very (too?) brief overview. <code>M1</code> contains information such as type names (including the module and package), constructor names, whether the constructor uses record notation, strictness of fields... <code>V1</code> and <code>(:+:)</code> are used for types with zero or many constructors, so they are not relevant to us. <code>U1</code> represents nullary constructors, while <code>(:*:)</code> splits n-ary constructors, with a representation of half of the fields on either side. <code>K1</code> marks one constructor field.</p>\n\n<p>We define the function <code>Arity</code> by giving it type family instances. But really, for a first understanding, ignore the <code>type instance</code> keywords and pretend <code>Arity</code> is a function defined by pattern-matching as usual.</p>\n\n<p>Looking at the representation <code>Rep T</code> above, we first encounter an <code>M1</code> node, which we ignore and recursively call <code>Arity</code> on its contents.</p>\n\n<pre><code>type instance Arity (M1 i c f) = Arity f\n</code></pre>\n\n<p>Then we see <code>(:*:)</code> which splits a set of fields in two parts; we calculate their arities recursively and add them up.</p>\n\n<pre><code>type instance Arity (f :*: g) = Arity f + Arity g\n\n-- Used extensions: TypeOperators, UndecidableInstances\n</code></pre>\n\n<p><code>U1</code> represents nullary constructors,</p>\n\n<pre><code>type instance Arity U1 = 0\n</code></pre>\n\n<p>and <code>K1</code> is a single field.</p>\n\n<pre><code>type instance (K1 i a) = 1\n</code></pre>\n\n<p>Now, given a generic type <code>T</code> (i.e., with an instance of <code>Generic</code>), <code>Arity (Rep T)</code> is its arity, as a type-level <code>Nat</code>. In ghci, we can test it with</p>\n\n<pre><code>:kind! Arity (Rep T)\n</code></pre>\n\n<p>Use <code>GHC.TypeNats.natVal</code> to convert it to a <code>Natural</code> value (like <code>Integer</code>, but nonnegative).</p>\n\n<pre><code>-- Calculate the arity of the constructor of a generic type `a`.\n-- `a` must have a single constructor.\narity :: forall a. (Generic a, KnownNat (Arity (Rep a))) =&gt; Natural\narity = natVal (Proxy @(Arity (Rep a)))\n\n-- Used extensions:\n--   ScopedTypeVariables,\n--   AllowAmbiguousTypes, TypeApplications,\n--   FlexibleContexts\n</code></pre>\n\n<p>We get the arity of any generic type <code>T</code> as a value <code>arity @T</code>, which can be converted using <code>fromIntegral :: Natural -&gt; Integer</code> for example.</p>\n\n<pre><code>main = print (arity @T)\n</code></pre>\n\n<p>Full gist: <a href=\"https://gist.github.com/Lysxia/10f1da354f051b2d2eb24f6aace1bf9c\" rel=\"noreferrer\">https://gist.github.com/Lysxia/10f1da354f051b2d2eb24f6aace1bf9c</a></p>\n"}], "owner": {"reputation": 661, "user_id": 1021134, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8724cd9cfab6d6818d3cf8c7f10400e5?s=128&d=identicon&r=PG", "display_name": "fredefox", "link": "https://stackoverflow.com/users/1021134/fredefox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 56351505, "answer_count": 2, "score": 1, "last_activity_date": 1559091181, "creation_date": 1559075162, "last_edit_date": 1559077833, "question_id": 56349611, "link": "https://stackoverflow.com/questions/56349611/generically-determining-arity-of-data-types", "title": "Generically determining arity of data types", "body": "<p>I want to calculate the \"arity\" of a certain class of <em>data types</em>. Namely data-types with a single constructor and some number of fields. E.g. <code>data T a = T Int () String a</code>. The \"arity\" will then be the number of fields. For <code>T a</code> this will be <code>4</code>. I envisage a function with a signature something like this:</p>\n\n<pre><code>forall a . C a =&gt; Int\n</code></pre>\n\n<p>for some appropriate choice of <code>C</code>. I know that if I have <code>Generic a</code> for some type <code>a</code> I get <code>from :: a -&gt; Rep a x</code>, but note that this will require a concrete value for <code>a</code> and I'm interested in calculating it statically. Is this possible somehow? I've also thought about <code>Typeable</code>, but I don't really understand the API.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1559062163, "post_id": 56346697, "comment_id": 99298584, "body": "While learning Haskell, you can also use GHCi, which is a REPL, and load your <code>.hs</code> file, avoiding <code>main</code>. In GHCi you can evaluate any expression and observe their result. If you edit the <code>.hs</code> file, you can use <code>:r</code> to reload the new definitions."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1559062562, "post_id": 56346697, "comment_id": 99298774, "body": "Next time, use <a href=\"https://hoogle.haskell.org/?hoogle=getLine\" rel=\"nofollow noreferrer\">hoogle</a> to search for library functions."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 1, "creation_date": 1559063905, "post_id": 56346697, "comment_id": 99299357, "body": "There is no Haskell 8.6.5. If you mean ghc 8.6.5, say so."}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1559260662, "post_id": 56346777, "comment_id": 99373977, "body": "Side note: this relies on a small quirk of <code>main</code>, that its type is allowed to be <code>IO x</code> for any type <code>x</code>, and the result is simply ignored. To discard the result of <code>getLine</code> explicitly, you can write <code>main :: IO (); do { putStrLn &quot;...&quot;; _ &lt;- getLine; pure () }</code> or <code>void getLine</code> using <code>void</code> from <code>Control.Monad</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1559061887, "creation_date": 1559061887, "answer_id": 56346777, "question_id": 56346697, "link": "https://stackoverflow.com/questions/56346697/screen-doesnt-show-console-readline-in-haskell/56346777#56346777", "title": "screen doesn&#39;t show, Console.ReadLine() in Haskell?", "body": "<p><code>getLine</code> reads a whole line (returning that as a string, but you don't need that). </p>\n\n<pre><code>main = do\n   putStrLn \"Hello, World!\"\n   getLine\n</code></pre>\n\n<p>In this way, you'll need to press enter to exit the program.</p>\n"}], "owner": {"reputation": 11, "user_id": 11568651, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rzR3eHGBVlQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfW_q3WuktmwteZWL9BL7LGi3l4rw/mo/photo.jpg?sz=128", "display_name": "L&#225;szl&#243; Zal&#225;n", "link": "https://stackoverflow.com/users/11568651/l%c3%a1szl%c3%b3-zal%c3%a1n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1559136178, "creation_date": 1559061530, "last_edit_date": 1559136178, "question_id": 56346697, "link": "https://stackoverflow.com/questions/56346697/screen-doesnt-show-console-readline-in-haskell", "title": "screen doesn&#39;t show, Console.ReadLine() in Haskell?", "body": "<p>I'm using GHC 8.6.5 in Windows 10.</p>\n\n<p>I'm a beginner in Haskell, but have some C# experience. When I try\n<code>main = putStrLn \"Hello, World!\"</code> and I compile, the program shows the screen only for a moment. I want something like <code>Console.ReadLine()</code> in C# so that the screen will remain until I press enter. What should I do?</p>\n\n<p>I have searched the net for 2 hours in vain.</p>\n\n<pre><code>main = putStrLn \"Hello, World!\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 1, "creation_date": 1559031176, "post_id": 56335636, "comment_id": 99281203, "body": "The first paragraph of <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow noreferrer\">Monomorphism restriction</a> sounds very similar to your description."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1559035938, "post_id": 56335636, "comment_id": 99283676, "body": "It is the monomorphism restriction. Your definition is subject to it, as per the conditions explained in the &quot;When does it happen?&quot; section of the answer to the target question. The constraint means GHC won&#39;t generalise <code>s</code> and <code>m</code> (see the &quot;First Rule&quot; section), which in the end leads to the ambiguous type variables error (see &quot;Second Rule&quot;)."}], "owner": {"reputation": 1169, "user_id": 7731046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4421d9cc740a327082631cf828105f85?s=128&d=identicon&r=PG&f=1", "display_name": "fghzxm", "link": "https://stackoverflow.com/users/7731046/fghzxm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "closed_date": 1559035529, "answer_count": 0, "score": 4, "last_activity_date": 1559022343, "creation_date": 1559021973, "last_edit_date": 1559022343, "question_id": 56335636, "link": "https://stackoverflow.com/questions/56335636/haskell-tries-to-solve-type-variables-when-it-shouldnt", "closed_reason": "Duplicate", "title": "Haskell tries to solve type variables when it shouldn&#39;t", "body": "<p>Compiler is GHC 8.6.5.  Parsec is 3.1.13.0.</p>\n\n<p>The relevant code is</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE FlexibleContexts #-}\n\nimport Text.Parsec\n\n-- redundant :: Stream s m Char =&gt; ParsecT s u m Char\nredundant = upper\n</code></pre>\n\n<p>ghcmod reports:</p>\n\n<pre><code>\u2022 Ambiguous type variables \u2018s0\u2019, \u2018m0\u2019 arising from a use of \u2018upper\u2019\n  prevents the constraint \u2018(Stream s0 m0 Char)\u2019 from being solved.\n  Relevant bindings include\n    redundant :: ParsecT s0 u m0 Char\n      (bound at T:\\empdir\\ghc-mod7761\\ParD8EE.hs:11:1)\n  Probable fix: use a type annotation to specify what \u2018s0\u2019,\n                                                      \u2018m0\u2019 should be.\n  These potential instances exist:\n    instance [safe] Monad m =&gt; Stream [tok] m tok\n      -- Defined in \u2018Text.Parsec.Prim\u2019\n    ...plus four instances involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n\u2022 In the expression: upper\n  In an equation for \u2018redundant\u2019: redundant = upper\n</code></pre>\n\n<p>If I uncomment the type annotation for <code>redundant</code>, however, the code now type checks even despite the fact that the type annotation does not by any means narrow the type of <code>redundant</code>.</p>\n\n<p>It appears to me that the compiler is attempting to substitute some concrete types for <code>s</code> and <code>m</code> when it in fact shouldn't, and is only prevented from doing so when I specify explicitly that <code>s</code> and <code>m</code> are meant to be type variables.</p>\n\n<p>Why would the compiler do so?</p>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"tags": [], "owner": {"reputation": 1290, "user_id": 5499871, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206799318615183/picture?type=large", "display_name": "Izaak Weiss", "link": "https://stackoverflow.com/users/5499871/izaak-weiss"}, "is_accepted": false, "score": 6, "last_activity_date": 1559018244, "creation_date": 1559018244, "answer_id": 56335071, "question_id": 56334681, "link": "https://stackoverflow.com/questions/56334681/how-foldr-works-on-this-data-tree/56335071#56335071", "title": "how foldr works on this data tree?", "body": "<p>The definition of <code>foldr</code> for <code>Node</code> calls <code>foldr</code> on the list of <code>RoseTree</code>s. Then, inside of that <code>foldr</code>, it calls <code>foldr</code> on each subtree, using the current accumulator as the initial parameter.</p>\n\n<p>Basically, even though it looks like the function calls <code>foldr</code> twice, it is calling it for different types each time, and so only one is recursive. The other is the <code>foldr</code> defined for <code>[a]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1559038938, "creation_date": 1559038938, "answer_id": 56340065, "question_id": 56334681, "link": "https://stackoverflow.com/questions/56334681/how-foldr-works-on-this-data-tree/56340065#56340065", "title": "how foldr works on this data tree?", "body": "<p>We can discuss the implementation with your given sample data:</p>\n\n<pre><code>foldr (+) 0 (Node [Leaf 1, Leaf 2, Node [Leaf 1, Leaf 3]])\n</code></pre>\n\n<p>We here thus have a <code>Node</code>, so we take the second clause so we replace this with:</p>\n\n<pre><code>foldr (\\x z' -&gt; foldr (+) z' x) 0 [Leaf 1, Leaf 2, Node [Leaf 1, Leaf 3]]\n</code></pre>\n\n<p>The outer <code>foldr</code> thus works on the list, which means that, by the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-List.html#v:foldr\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<blockquote>\n<pre><code>foldr f z [x1, x2, ..., xn] == x1 `f` (x2 `f` ... (xn `f` z)...)\n</code></pre>\n</blockquote>\n\n<p>So that means that the above <code>foldr</code> is replaced with:</p>\n\n<pre><code>foldr (+) (foldr (+) (foldr (+) 0 (Node [Leaf 1, Leaf 3])) (Leaf 2)) (Leaf 1)\n</code></pre>\n\n<p>So the outer function is now <code>foldr (+) (...) (Leaf 1)</code>, this is the first clause of our <code>foldr</code> definition, so that is equal to:</p>\n\n<pre><code>(+) 1 (foldr (+) (foldr (+) 0 (Node [Leaf 1, Leaf 3])) (Leaf 2))\n</code></pre>\n\n<p>We then can evalate the <code>foldr (+) (...) (Leaf 2)</code> expression, which is handled in the same way:</p>\n\n<pre><code>(+) 1 ((+) 2 (foldr (+) 0 (Node [Leaf 1, Leaf 3])))\n</code></pre>\n\n<p>or less verbose:</p>\n\n<pre><code>1 + 2 + foldr (+) 0 (Node [Leaf 1, Leaf 3])\n</code></pre>\n\n<p>Then finally we again have a <code>foldr (+) 0</code> that works on a <code>Node</code>, this thus again results in an evaluation as discussed above:</p>\n\n<pre><code>1 + 2 + foldr (+) (foldr (+) 0 (Leaf 3)) (Leaf 1)\n</code></pre>\n\n<p>We thus can again evaluate the outer <code>foldr (+)</code> to:</p>\n\n<pre><code>1 + 2 + (+) 1 (foldr (+) 0 (Leaf 3))\n</code></pre>\n\n<p>and the inner <code>foldr (+)</code> to:</p>\n\n<pre><code>1 + 2 + (+) 1 ((+) 3 0)\n</code></pre>\n\n<p>or less verbose:</p>\n\n<pre><code>1 + 2 + 1 + 3 + 0\n</code></pre>\n\n<p>which is equivalent to:</p>\n\n<pre><code>7\n</code></pre>\n\n<p>which is the sum of the nodes in the <code>Leaf</code>s.</p>\n\n<p>It is important to note that the outer <em><code>foldr</code></em> (here denoted in <em>italics</em>), is not the same <code>foldr</code> function as the inner <strong><code>foldr</code></strong> (here denoted in <strong>boldface</strong>) in the implementation: the outer one works with a list as functor, whereas the inner one is the one we define in the <code>instance Foldable RoseTree</code>:</p>\n\n<pre><code>instance Foldable RoseTree where \n    <b>foldr</b> f z (Leaf x) = f x z\n    <b>foldr</b> f z (Node ns) = <i>foldr</i> (\\x z' -> <b>foldr</b> f z' x) z ns</code></pre>\n\n<p>In case we thus perform a <code>foldr</code> on a <code>Tree</code> with a function <code>f</code> and an initial value <code>z</code>, we will replace all leaves with <code>f x z</code>, (so for <code>foldr (+) 0</code> that is <code>(+) x 0</code>, or <code>x + 0</code>).</p>\n\n<p>The <code>Node</code>s will result in <em>folding</em> the values together where the result of the fold of the tailing elements is used as initial value of the fold with the head element.</p>\n"}], "owner": {"reputation": 61, "user_id": 10908519, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73a0794210258059268b0cca1cbffc69?s=128&d=identicon&r=PG&f=1", "display_name": "Y.Gao", "link": "https://stackoverflow.com/users/10908519/y-gao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 56340065, "answer_count": 2, "score": 3, "last_activity_date": 1559038938, "creation_date": 1559014670, "question_id": 56334681, "link": "https://stackoverflow.com/questions/56334681/how-foldr-works-on-this-data-tree", "title": "how foldr works on this data tree?", "body": "<p>I know how foldr works on Leaf, but I don't know how foldr work on Node. What is the parameter \\x z' if we already have f and z as parameter. assume we have </p>\n\n<pre><code>tree = Node [Leaf 1, Leaf 2, Node [Leaf 1, Leaf 3]]\n</code></pre>\n\n<p>how this code works</p>\n\n<pre><code>foldr (+) 0 tree\n</code></pre>\n\n<pre><code>data RoseTree a =  Leaf a | Node [RoseTree a] \ninstance Foldable RoseTree where \n    foldr f z (Leaf x) = f x z\n    foldr f z (Node ns) = \n        foldr (\\x z' -&gt; foldr f z' x) z ns \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1558998418, "post_id": 56333253, "comment_id": 99272922, "body": "What happens if you do <code>(finiteBitSize fac1000) :: Int</code>? That&#39;s what GHC is actually suggesting, your version is casting the huge number to an <code>Int</code> so it&#39;s not surprising it becomes much smaller than you expect."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1558999380, "post_id": 56333253, "comment_id": 99273096, "body": "Correction: I just looked up the function. I misunderstood, it always returns an <code>Int</code>, and the ambiguity is in its argument. But when you coerce it to an <code>Int</code> then you&#39;ll certainly get something too small. And <code>Integer</code> doesn&#39;t seem to be an instance of <code>FiniteBits</code>, for obvious reasons."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1559000367, "post_id": 56333253, "comment_id": 99273270, "body": "From the docs: &quot;Return the number of bits in the type of the argument. The actual value of the argument is ignored.&quot; Hence, <code>finiteBitSize</code> does not care about the value of the argument, but only about its type. That&#39;s not what you want."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1559014447, "post_id": 56333518, "comment_id": 99275536, "body": "What is the unit here?  <code>finiteBitSize</code> gives a size in bits and at least one haddock-doc source says <code>sizeofByteArray</code> gives a size in bytes."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1559019300, "post_id": 56333518, "comment_id": 99276431, "body": "@ThomasM.DuBuisson Thanks, fixed!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1559054604, "post_id": 56333518, "comment_id": 99294372, "body": "@ThomasM.DuBuisson And thanks a second time! Yikes."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1559095209, "post_id": 56333518, "comment_id": 99308981, "body": "One thing to point out -- in <code>sizeOfBigNat</code>, there isn&#39;t actually an extra constructor, as the <code>data BigNat = BN# ByteArray#</code> is unpacked into the <code>data Integer</code>.  However, there is a word for the length of the <code>ByteArray#</code> in <code>BigNat</code> that isn&#39;t otherwise accounted for, so I think the code still gives the right answer."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1559097024, "post_id": 56333518, "comment_id": 99309323, "body": "Thank you, this is helpful.  Any chance you have a link explaining the <code>#</code> syntax?  I have never encountered this before. This is magichash and the reason is to unbox the types?  I&#39;m going off this: <a href=\"https://www.fpcomplete.com/blog/2015/02/primitive-haskell\" rel=\"nofollow noreferrer\">fpcomplete.com/blog/2015/02/primitive-haskell</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1559098365, "post_id": 56333518, "comment_id": 99309570, "body": "@Mittenchops The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=magichash#extension-MagicHash\" rel=\"nofollow noreferrer\">manual</a> is the definitive source for its meaning."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1559098823, "post_id": 56333518, "comment_id": 99309642, "body": "Thanks, @DanielWagner.  I have read this section, and while I see statements like <code>The hash sign does not change semantics at all. We tend to use variable names ending in \u201c#\u201d for unboxed values or types (e.g. Int#), but there is no requirement to do so; they are just plain ordinary variables.</code> that suggest to me this changes nothing and is just a naming convention, it /looks/ like this is actually providing some kind of pointer semantics.  Is the latter true?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 1, "creation_date": 1559099061, "post_id": 56333518, "comment_id": 99309689, "body": "@Mittenchops The statement &quot;this changes nothing and is just a naming convention&quot; is correct. I don&#39;t know what &quot;this is actually providing some kind of pointer semantics&quot; means to you, so I can&#39;t comment on whether that is correct, but I suspect it is not."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1559100019, "post_id": 56333518, "comment_id": 99309854, "body": "Thanks, @DanielWagner.  I guess my question is: am I to understand that this code works identically if MagicHash is not used and I replace instances of <code>Jp#</code> with <code>Jp</code> and <code>I#</code> with <code>I</code>, etc?  This is just a naming convention you chose that has no semantic impact on the code?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 2, "creation_date": 1559101671, "post_id": 56333518, "comment_id": 99310139, "body": "@Mittenchops I didn&#39;t choose it. And you would have to turn off MagicHash in the module that defines <code>Integer</code> and make those replacements there, too. But yes, if you replaced all occurrences of <code>Jp#</code> with <code>Jp</code>, etc., it would work exactly the same way."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1559190426, "post_id": 56333518, "comment_id": 99345379, "body": "It seems kind of inconvenient they named the variable such that the magichash pragma is required to use functions defined in the library, but this makes sense."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 13, "last_activity_date": 1559053447, "last_edit_date": 1559053447, "creation_date": 1559000906, "answer_id": 56333518, "question_id": 56333253, "link": "https://stackoverflow.com/questions/56333253/haskell-getsizeof-big-integer/56333518#56333518", "title": "Haskell getsizeof big integer", "body": "<p>You may approximate the number of bytes by asking for its log base 256 using the <a href=\"http://hackage.haskell.org/package/integer-logarithms-1.0.3/docs/Math-NumberTheory-Logarithms.html#v:integerLogBase\" rel=\"noreferrer\">integer-logarithms</a> package:</p>\n\n<pre><code>Math.NumberTheory.Logarithms&gt; integerLogBase 256 (product [1..1000])\n1066\n</code></pre>\n\n<p>This is only an approximation because it accounts only for the bytes being used to store the number; typically arbitrary-precision integers also have some overhead for storing information about the length of the number and probably a bit of over-allocation, and neither of these will be accounted for by taking the logarithm.</p>\n\n<p>If you don't mind getting the approximate size reported in bits instead of bytes, <code>integerLog2</code> will be faster.</p>\n\n<pre><code>Math.NumberTheory.Logarithms&gt; integerLog2 (product [1..1000])\n8529\n</code></pre>\n\n<p>If you want the true answer, you'll have to touch some really low-level APIs and depend on the exact <a href=\"https://hackage.haskell.org/package/integer-gmp-1.0.2.0/docs/GHC-Integer-GMP-Internals.html#t:Integer\" rel=\"noreferrer\">definition of <code>Integer</code></a>:</p>\n\n<pre><code>{-# LANGUAGE MagicHash #-}\nimport Data.Bits\nimport GHC.Exts\nimport GHC.Integer.GMP.Internals\nimport GHC.Prim\n\nsizeOfInteger :: Integer -&gt; Int\nsizeOfInteger n = constructorSize + case n of\n    S# i -&gt; finiteBitSize (I# i) `div` 8\n    Jp# bn -&gt; sizeOfBigNat bn\n    Jn# bn -&gt; sizeOfBigNat bn\n    where\n    constructorSize = finiteBitSize (0 :: Word) `div` 8\n    sizeOfBigNat (BN# arr) = constructorSize + I# (sizeofByteArray# arr)\n</code></pre>\n\n<p>Try it out in ghci:</p>\n\n<pre><code>&gt; sizeOfInteger (product [1..1000])\n1088\n</code></pre>\n\n<p>Beware! I don't know all the promises of these internal APIs. It's possible that computing equal <code>Integer</code>s in different ways may produce values that are represented differently. When touching these internal APIs you sometimes lose the guarantees of the abstract external API; in this case, you may not have that <code>x == y</code> implies <code>sizeOfInteger x == sizeOfInteger y</code>. Read the docs carefully if you plan to take this route!</p>\n"}, {"tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": false, "score": 3, "last_activity_date": 1559061267, "creation_date": 1559061267, "answer_id": 56346615, "question_id": 56333253, "link": "https://stackoverflow.com/questions/56333253/haskell-getsizeof-big-integer/56346615#56346615", "title": "Haskell getsizeof big integer", "body": "<p>You've misunderstood what <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Bits.html#v:finiteBitSize\" rel=\"nofollow noreferrer\"><code>finiteBitSize</code></a> does.  From the docs, emphasis mine:</p>\n\n<blockquote>\n  <p>Return the number of bits in the type of the argument. <em>The actual value of the argument is ignored.</em></p>\n</blockquote>\n\n<p>The <code>finiteBitSize :: FiniteBits b =&gt; b -&gt; Int</code> function tells you a property of the <em>type</em> <code>b</code>, and it uses the argument to pick out which type.  Any <code>Int</code> would give you the same answer:</p>\n\n<pre><code>ghci&gt; finiteBitSize (0 :: Int)\n64\nghci&gt; finiteBitSize (maxBound :: Int)\n64\nghci&gt; finiteBitSize (undefined :: Int)\n64\n</code></pre>\n\n<p>This is because <code>Int</code> is the type of lazy <em>machine</em> integers, which fit in one word.  Indeed:</p>\n\n<pre><code>ghci&gt; product [1..1000] :: Int\n0\n</code></pre>\n\n<p>A bit smaller than you may have been expecting :-)</p>\n\n<p>If you want to measure the size of <code>product [1..1000]</code> as an unbounded <code>Integer</code>, you'll need a different technique.  <a href=\"https://stackoverflow.com/a/56333518/237428\">Daniel Wagner's answer</a> provides two good approaches, both mathematical (how to compute log<sub>2</sub> 100!) and GHC-internal.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 56333518, "answer_count": 2, "score": 5, "last_activity_date": 1559061267, "creation_date": 1558998100, "question_id": 56333253, "link": "https://stackoverflow.com/questions/56333253/haskell-getsizeof-big-integer", "title": "Haskell getsizeof big integer", "body": "<p>I'm trying to get the size in bytes of a big integer, given that there's arbitrary precision math under the hood, and I'd like to know how much space the result is actually using.</p>\n\n<p>Here's a sample:</p>\n\n<pre><code>Prelude&gt; import Data.Bits\nPrelude&gt; let fac1000 = product [1..1000] # big!\nPrelude Data.Bits&gt; finiteBitSize fac1000\n\n&lt;interactive&gt;:37:1: error:\n    \u2022 Ambiguous type variable \u2018b0\u2019 arising from a use of \u2018finiteBitSize\u2019\n      prevents the constraint \u2018(FiniteBits b0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018b0\u2019 should be.\n      These potential instances exist:\n        instance FiniteBits Bool -- Defined in \u2018Data.Bits\u2019\n        instance FiniteBits Int -- Defined in \u2018Data.Bits\u2019\n        instance FiniteBits Word -- Defined in \u2018Data.Bits\u2019\n    \u2022 In the expression: finiteBitSize fac1000\n      In an equation for \u2018it\u2019: it = finiteBitSize fac1000\n\n&lt;interactive&gt;:37:15: error:\n    \u2022 Ambiguous type variable \u2018b0\u2019 arising from a use of \u2018fac1000\u2019\n      prevents the constraint \u2018(Num b0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018b0\u2019 should be.\n      These potential instances exist:\n        instance Num Integer -- Defined in \u2018GHC.Num\u2019\n        instance Num Double -- Defined in \u2018GHC.Float\u2019\n        instance Num Float -- Defined in \u2018GHC.Float\u2019\n        ...plus two others\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the first argument of \u2018finiteBitSize\u2019, namely \u2018fac1000\u2019\n      In the expression: finiteBitSize fac1000\n      In an equation for \u2018it\u2019: it = finiteBitSize fac1000\n</code></pre>\n\n<p>The type annotations they are suggesting do not seem reasonable, when I coerce to an integer for example:</p>\n\n<pre><code>Prelude Data.Bits&gt; finiteBitSize (fac1000 :: Int)\n64\n</code></pre>\n\n<p>Well, that's a big number and I don't believe it.  In python, I get:</p>\n\n<pre><code>&gt;&gt;&gt; import sys, math\n&gt;&gt;&gt; sys.getsizeof(math.factorial(1000))\n1164\n</code></pre>\n\n<p>which looks a lot more credible to me for the astronomically large 4.02e2568.</p>\n"}, {"tags": ["algorithm", "haskell", "parallel-processing"], "answers": [{"comments": [{"owner": {"reputation": 349, "user_id": 11388249, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Zhe1qISXmzY/AAAAAAAAAAI/AAAAAAAAAC0/Opx3Le0xlkE/photo.jpg?sz=128", "display_name": "Vasiliy", "link": "https://stackoverflow.com/users/11388249/vasiliy"}, "edited": false, "score": 2, "creation_date": 1559027257, "post_id": 56332838, "comment_id": 99279194, "body": "Thank you for help! But your solution on any number of cores, ie on -N1 and on -N2 has the same execution time. And I would like to get the benefit of de-coupling in the form of reducing computation time."}], "tags": [], "owner": {"reputation": 1492, "user_id": 1091396, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/YtJY5.gif?s=128&g=1", "display_name": "ymg", "link": "https://stackoverflow.com/users/1091396/ymg"}, "is_accepted": false, "score": 3, "last_activity_date": 1559001628, "last_edit_date": 1559001628, "creation_date": 1558994233, "answer_id": 56332838, "question_id": 56332713, "link": "https://stackoverflow.com/questions/56332713/how-do-i-add-parallel-computation-to-this-example/56332838#56332838", "title": "How do I add parallel computation to this example?", "body": "<p>my default go-to for any <code>map</code> composition would be by using <code>parmap</code> from <code>Strategies</code> API <a href=\"http://hackage.haskell.org/package/parallel-3.2.2.0/docs/Control-Parallel-Strategies.html#g:7\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/parallel-3.2.2.0/docs/Control-Parallel-Strategies.html#g:7</a> , I'll add an example once I'm around my PC.</p>\n\n<p><strong>Edit</strong>:</p>\n\n<p>You'd use parMap in the following way,</p>\n\n<pre><code>module Main where\n\n\nimport Control.Parallel.Strategies\n\n\nmain = putStrLn $ show $ integrate f 1.1 1.2\n\n\nf :: Double -&gt; Double\nf x = x\n\nintegrate :: (Double -&gt; Double) -&gt; Double -&gt; Double -&gt; Double\nintegrate f a b =\n  let\n    step     = (b - a) / 1000\n    segments = [a + x * step | x &lt;- [0..999]]\n    area x   = step * (f x + f (x + step)) / 2\n  in sum $ parMap rpar area segments\n</code></pre>\n\n<p>Then compile with:</p>\n\n<p><code>ghc -O2 -threaded -rtsopts Main.hs</code> and run using the RTS + N flag to control the parallelism <code>./Main +RTS -N -RTS</code> -N can be specified e.g. -N6 to run on 6 threads or can be left empty to use all possible threads.</p>\n"}, {"comments": [{"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 1, "creation_date": 1559072272, "post_id": 56345415, "comment_id": 99302934, "body": "After I posted a solution I realized  that I lied a bit. In case of a single region integration, computation will not be automatically parallelized, so please see the fixed answer."}, {"owner": {"reputation": 349, "user_id": 11388249, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Zhe1qISXmzY/AAAAAAAAAAI/AAAAAAAAAC0/Opx3Le0xlkE/photo.jpg?sz=128", "display_name": "Vasiliy", "link": "https://stackoverflow.com/users/11388249/vasiliy"}, "edited": false, "score": 0, "creation_date": 1559072703, "post_id": 56345415, "comment_id": 99303092, "body": "Thank you very much for your response! But I couldn\u2019t run and compile any of the examples you presented. Could you give more information what modules need to be delivered or how you ran these solutions?"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 349, "user_id": 11388249, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Zhe1qISXmzY/AAAAAAAAAAI/AAAAAAAAAC0/Opx3Le0xlkE/photo.jpg?sz=128", "display_name": "Vasiliy", "link": "https://stackoverflow.com/users/11388249/vasiliy"}, "edited": false, "score": 1, "creation_date": 1559073150, "post_id": 56345415, "comment_id": 99303284, "body": "Silly me. Of course. You need to add <code>massiv &gt;= 0.3</code> to you dependency list in the project cabal file and also add these <code>import Data.Massiv.Array as A</code> and <code>import Data.Massiv.Array.Numeric.Integral</code> to the header of the module. You can find more info on how to get started with the library in the repository readme."}, {"owner": {"reputation": 349, "user_id": 11388249, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Zhe1qISXmzY/AAAAAAAAAAI/AAAAAAAAAC0/Opx3Le0xlkE/photo.jpg?sz=128", "display_name": "Vasiliy", "link": "https://stackoverflow.com/users/11388249/vasiliy"}, "edited": false, "score": 0, "creation_date": 1559075639, "post_id": 56345415, "comment_id": 99304248, "body": "What are you, absolutely not! If this library is your hands! That you perfectly understand Haskell and in algorithms! I&#39;m trying to correctly run the integrateA function: integrateA 1000 x * x 0.0005 10? With such a start, it gives an error."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 349, "user_id": 11388249, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Zhe1qISXmzY/AAAAAAAAAAI/AAAAAAAAAC0/Opx3Le0xlkE/photo.jpg?sz=128", "display_name": "Vasiliy", "link": "https://stackoverflow.com/users/11388249/vasiliy"}, "edited": false, "score": 1, "creation_date": 1559075855, "post_id": 56345415, "comment_id": 99304332, "body": "You are missing a lambda: <code>integrateA 1000 (\\x -&gt; x * x) 0.0005 10</code>"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 349, "user_id": 11388249, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Zhe1qISXmzY/AAAAAAAAAAI/AAAAAAAAAC0/Opx3Le0xlkE/photo.jpg?sz=128", "display_name": "Vasiliy", "link": "https://stackoverflow.com/users/11388249/vasiliy"}, "edited": false, "score": 1, "creation_date": 1559076803, "post_id": 56345415, "comment_id": 99304728, "body": "@Vasiliy if you have more questions about massiv, feel free to shoot them here <a href=\"https://gitter.im/haskell-massiv/Lobby\" rel=\"nofollow noreferrer\">gitter.im/haskell-massiv/Lobby</a>"}, {"owner": {"reputation": 349, "user_id": 11388249, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Zhe1qISXmzY/AAAAAAAAAAI/AAAAAAAAAC0/Opx3Le0xlkE/photo.jpg?sz=128", "display_name": "Vasiliy", "link": "https://stackoverflow.com/users/11388249/vasiliy"}, "edited": false, "score": 0, "creation_date": 1559079161, "post_id": 56345415, "comment_id": 99305613, "body": "Everything works fine. A little later I will give you a report on how it works on a different number of threads. How can I add precision to the integrateA function as an input parameter?"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 349, "user_id": 11388249, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Zhe1qISXmzY/AAAAAAAAAAI/AAAAAAAAAC0/Opx3Le0xlkE/photo.jpg?sz=128", "display_name": "Vasiliy", "link": "https://stackoverflow.com/users/11388249/vasiliy"}, "edited": false, "score": 1, "creation_date": 1559081896, "post_id": 56345415, "comment_id": 99306367, "body": "Not quite sure what you mean by precision. On a different note, I added couple of alternative solutions to the answer, which are much more involved, but are faster and are pretty cool for education purposes."}, {"owner": {"reputation": 349, "user_id": 11388249, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Zhe1qISXmzY/AAAAAAAAAAI/AAAAAAAAAC0/Opx3Le0xlkE/photo.jpg?sz=128", "display_name": "Vasiliy", "link": "https://stackoverflow.com/users/11388249/vasiliy"}, "edited": false, "score": 0, "creation_date": 1559167968, "post_id": 56345415, "comment_id": 99340961, "body": "In the example you are calculating a definite integral by the trapezoid method, to calculate the integral with a given accuracy, there is a rule for estimating the error (Runge rule). When I talked about accuracy, I had in mind the use of this rule"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 349, "user_id": 11388249, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Zhe1qISXmzY/AAAAAAAAAAI/AAAAAAAAAC0/Opx3Le0xlkE/photo.jpg?sz=128", "display_name": "Vasiliy", "link": "https://stackoverflow.com/users/11388249/vasiliy"}, "edited": false, "score": 0, "creation_date": 1559169153, "post_id": 56345415, "comment_id": 99341264, "body": "@Vasiliy I see what you mean. I think that question deserves it&#39;s own SO question. If you can write an implementation for your solution using lists, I could try giving you a hand with adopting it for the <code>massiv</code> examples"}, {"owner": {"reputation": 349, "user_id": 11388249, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Zhe1qISXmzY/AAAAAAAAAAI/AAAAAAAAAC0/Opx3Le0xlkE/photo.jpg?sz=128", "display_name": "Vasiliy", "link": "https://stackoverflow.com/users/11388249/vasiliy"}, "reply_to_user": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1559200547, "post_id": 56345415, "comment_id": 99348666, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/194152/discussion-between-vasiliy-and-lehins\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 5, "last_activity_date": 1559081706, "last_edit_date": 1559081706, "creation_date": 1559056872, "answer_id": 56345415, "question_id": 56332713, "link": "https://stackoverflow.com/questions/56332713/how-do-i-add-parallel-computation-to-this-example/56345415#56345415", "title": "How do I add parallel computation to this example?", "body": "<p>From the looks of it you are trying to approximate an integral of a function <code>f</code> on the region from <code>b</code> to <code>a</code> using trapezoidal rule. You are right in trying to parallelize the code, but there are a couple of issues with the attempt:</p>\n\n<ul>\n<li>First of all, you need a work stealing scheduler in order to get any benefit, since <code>par</code> is unlikely to give you a speedup</li>\n<li>Secondly, the way it is implemented each intermediate point <code>f(x)</code> is computed twice, except for the border points <code>f(a)</code> and <code>f(b)</code></li>\n</ul>\n\n<p>Few moths ago I needed this functionality, so I added it the the <code>massiv</code> library: <a href=\"https://www.stackage.org/haddock/nightly-2019-05-28/massiv-0.3.2.0/Data-Massiv-Array-Numeric-Integral.html#v:trapezoidRule\" rel=\"nofollow noreferrer\"><code>trapezoidRule</code></a>, which conveninetly solves both of the above problems and avoids usage of lists. </p>\n\n<p>Here is an out of the box solution, but it will not automatically parallelize the computation, since there is only one element of the array is being computed (it was designed to estimate integrals over many regions)</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>integrate' :: (Double -&gt; Double) -&gt; Double -&gt; Double -&gt; Double\nintegrate' f a b = trapezoidRule Seq P (\\scale x -&gt; f (scale x)) a d (Sz1 1) n ! 0\n  where\n    n = 1000\n    d = b - a\n</code></pre>\n\n<p>As a sanity check:</p>\n\n<pre><code>\u03bb&gt; integrate (\\x -&gt; x * x) 10 20 -- implementation from the question\n2333.3335\n\u03bb&gt; integrate' (\\x -&gt; x * x) 10 20\n2333.3335\n</code></pre>\n\n<p>Here is a solution that will do the automatic parallelization and will avoid redundant evaluation:</p>\n\n<pre><code>integrateA :: Int -&gt; (Double -&gt; Double) -&gt; Double -&gt; Double -&gt; Double\nintegrateA n f a b =\n  let step = (b - a) / fromIntegral n\n      sz = size segments - 1\n      segments = computeAs P $ A.map f (enumFromStepN Par a step (Sz (n + 1)))\n      area y0 y1 = step * (y0 + y1) / 2\n      areas = A.zipWith area (extract' 0 sz segments) (extract' 1 sz segments)\n   in A.sum areas\n</code></pre>\n\n<p>Because of list fusion, in case of your solution using lists, there will be no allocation, as such, for simple cases it will be very fast. In the above solution there is gonna be an array of size <code>n+1</code> allocated in order to promote sharing and avoid double function evaluation. There will also be extra cost encountered due to scheduling, since forking off threads does not come for free. But in the end for really expensive functions and very large <code>n</code> it is possible to get factor of ~x3 speed up on a quad core processor. </p>\n\n<p>Below are some benchmarks of integrating gaussian function with <code>n = 100000</code>:</p>\n\n<pre><code>benchmarking Gaussian1D/list\ntime                 3.657 ms   (3.623 ms .. 3.687 ms)\n                     0.999 R\u00b2   (0.998 R\u00b2 .. 1.000 R\u00b2)\nmean                 3.627 ms   (3.604 ms .. 3.658 ms)\nstd dev              80.50 \u03bcs   (63.62 \u03bcs .. 115.4 \u03bcs)\n\nbenchmarking Gaussian1D/array Seq\ntime                 3.408 ms   (3.304 ms .. 3.523 ms)\n                     0.987 R\u00b2   (0.979 R\u00b2 .. 0.994 R\u00b2)\nmean                 3.670 ms   (3.578 ms .. 3.839 ms)\nstd dev              408.0 \u03bcs   (293.8 \u03bcs .. 627.6 \u03bcs)\nvariance introduced by outliers: 69% (severely inflated)\n\nbenchmarking Gaussian1D/array Par\ntime                 1.340 ms   (1.286 ms .. 1.393 ms)\n                     0.980 R\u00b2   (0.967 R\u00b2 .. 0.989 R\u00b2)\nmean                 1.393 ms   (1.328 ms .. 1.485 ms)\nstd dev              263.3 \u03bcs   (160.1 \u03bcs .. 385.6 \u03bcs)\nvariance introduced by outliers: 90% (severely inflated)\n</code></pre>\n\n<p>Side note suggestion. Switching to Simpson's rule will give you a better approximation. Implementation is available in <a href=\"https://github.com/lehins/massiv\" rel=\"nofollow noreferrer\"><code>massiv</code></a> ;)</p>\n\n<p><strong>Edit</strong></p>\n\n<p>This is such a fun problem, that I decided to see what would it take to implement it without any array allocations. Here is what I came up with:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>integrateS :: Int -&gt; (Double -&gt; Double) -&gt; Double -&gt; Double -&gt; Double\nintegrateS n f a b =\n  let step = (b - a) / fromIntegral n\n      segments = A.map f (enumFromStepN Seq (a + step) step (Sz n))\n      area y0 y1 = step * (y0 + y1) / 2\n      sumWith (acc, y0) y1 =\n        let acc' = acc + area y0 y1\n         in acc' `seq` (acc', y1)\n   in fst $ A.foldlS sumWith (0, f a) segments\n</code></pre>\n\n<p>Above approach runs in constant memory, since the few arrays that do get created aren't real arrays backed by memory, but instead are delayed arrays. With a bit of trickery around fold accumulator we can share the results, thus avoiding double function evaluation. This results in astonishing speed up:</p>\n\n<pre><code>benchmarking Gaussian1D/array Seq no-alloc\ntime                 1.788 ms   (1.777 ms .. 1.799 ms)\n                     1.000 R\u00b2   (0.999 R\u00b2 .. 1.000 R\u00b2)\nmean                 1.787 ms   (1.781 ms .. 1.795 ms)\nstd dev              23.85 \u03bcs   (17.19 \u03bcs .. 31.96 \u03bcs)\n</code></pre>\n\n<p>The downside to the above approach is that it is not easily parallelizable, but not impossible. Embrace yourself, here is a monstrosity that can run on 8 capabilities (hardcoded and in my case 4 cores with hyperthreading):</p>\n\n<pre><code>-- | Will not produce correct results if `n` is not divisible by 8\nintegrateN8 :: Int -&gt; (Double -&gt; Double) -&gt; Double -&gt; Double -&gt; Double\nintegrateN8 n f a b =\n  let k = 8\n      n' = n `div` k\n      step = (b - a) / fromIntegral n\n      segments =\n        makeArrayR D (ParN (fromIntegral k)) (Sz1 k) $ \\i -&gt;\n          let start = a + step * fromIntegral n' * fromIntegral i + step\n           in (f start, A.map f (enumFromStepN Seq (start + step) step (Sz (n' - 1))))\n      area y0 y1 = step * (y0 + y1) / 2\n      sumWith (acc, y0) y1 =\n        let acc' = acc + area y0 y1\n         in acc' `seq` (acc', y1)\n      partialResults =\n        computeAs U $ A.map (\\(y0, arr) -&gt; (y0, A.foldlS sumWith (0, y0) arr)) segments\n      combine (acc, y0) (y1, (acci, yn)) =\n        let acc' = acc + acci + area y0 y1\n         in acc' `seq` (acc', yn)\n   in fst $ foldlS combine (0, f a) partialResults\n</code></pre>\n\n<p>The only real array allocated is for keeping <code>partialResults</code> which has a total of 16 <code>Double</code> elements. Speed improvement is not as drastic, but nevertheless it is there:</p>\n\n<pre><code>benchmarking Gaussian1D/array Par no-alloc\ntime                 960.1 \u03bcs   (914.3 \u03bcs .. 1.020 ms)\n                     0.968 R\u00b2   (0.944 R\u00b2 .. 0.990 R\u00b2)\nmean                 931.8 \u03bcs   (900.8 \u03bcs .. 976.3 \u03bcs)\nstd dev              129.2 \u03bcs   (84.20 \u03bcs .. 198.8 \u03bcs)\nvariance introduced by outliers: 84% (severely inflated)\n</code></pre>\n"}], "owner": {"reputation": 349, "user_id": 11388249, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Zhe1qISXmzY/AAAAAAAAAAI/AAAAAAAAAC0/Opx3Le0xlkE/photo.jpg?sz=128", "display_name": "Vasiliy", "link": "https://stackoverflow.com/users/11388249/vasiliy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 1, "accepted_answer_id": 56345415, "answer_count": 2, "score": 8, "last_activity_date": 1559081706, "creation_date": 1558993456, "last_edit_date": 1559039508, "question_id": 56332713, "link": "https://stackoverflow.com/questions/56332713/how-do-i-add-parallel-computation-to-this-example", "title": "How do I add parallel computation to this example?", "body": "<p>I have an algorithm for synchronous calculation of a certain integral on a given segment. I want to use the Control.Parallel library, or rather <code>par :: a -&gt; b -&gt; b</code> to add parallel computing to this algorithm.\nHow can I do this?</p>\n\n<pre><code>integrate :: (Double -&gt; Double) -&gt; Double -&gt; Double -&gt; Double\nintegrate f a b =\n  let\n    step     = (b - a) / 1000\n    segments = [a + x * step | x &lt;- [0..999]]\n    area x   = step * (f x + f (x + step)) / 2\n  in sum $ map area segments\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558988824, "post_id": 56332075, "comment_id": 99270864, "body": "If you want to change the value of an array it might be better to consider an <code>MArray</code> (mutable array), instead of an <code>Array</code>, since the <code>Array</code> will result in a <i>copy</i>."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 11559674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c27d51eab87ad7ed97d951e480f63658?s=128&d=identicon&r=PG&f=1", "display_name": "DevG", "link": "https://stackoverflow.com/users/11559674/devg"}, "edited": false, "score": 0, "creation_date": 1558990257, "post_id": 56332169, "comment_id": 99271249, "body": "Thanks Jo, would it be incredibly more efficient to be using MArray like Will said?"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 95, "user_id": 11559674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c27d51eab87ad7ed97d951e480f63658?s=128&d=identicon&r=PG&f=1", "display_name": "DevG", "link": "https://stackoverflow.com/users/11559674/devg"}, "edited": false, "score": 0, "creation_date": 1558991223, "post_id": 56332169, "comment_id": 99271484, "body": "@DevG It depends on a lot of details of your program, but even if so, what you&#39;re doing seems to be small-scale enough that it wouldn&#39;t be a big difference, and it will add a lot of complexity, especially for a novice."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 4, "last_activity_date": 1558989161, "creation_date": 1558989161, "answer_id": 56332169, "question_id": 56332075, "link": "https://stackoverflow.com/questions/56332075/haskell-modifying-value-at-specific-index-of-array/56332169#56332169", "title": "Haskell: Modifying value at specific index of array", "body": "<p>You don't actually need to modify the array. Just make your function create a new array that has the change you want, like this:</p>\n\n<pre><code>modifyArray :: Array Int Char -&gt; Int -&gt; Array Int Char\nmodifyArray arr i =\n    if i &gt; 0 then\n        if i `mod` 102 == 1 then\n            arr // [(i, ' ')]\n        else modifyArray arr (i-1)\n    else arr   \n</code></pre>\n\n<p><code>Data.Array</code> includes the <code>//</code> operator, which means \"take the array on the left, apply the changes on the right, and return the result\". Also, since this function doesn't do any IO, there's no need to use \"do\" or have IO in the type signature.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1559027437, "last_edit_date": 1559027437, "creation_date": 1558991162, "answer_id": 56332452, "question_id": 56332075, "link": "https://stackoverflow.com/questions/56332075/haskell-modifying-value-at-specific-index-of-array/56332452#56332452", "title": "Haskell: Modifying value at specific index of array", "body": "<p>If you plan to update your array only a few times, you can use the <a href=\"http://hackage.haskell.org/package/array-0.5.3.0/docs/Data-Array.html#v:-47--47-\" rel=\"nofollow noreferrer\"><strong><code>(//) :: Ix i =&gt; Array i e -&gt; [(i, e)] -&gt; Array i e</code></strong> operator</a>, like <a href=\"https://stackoverflow.com/a/56332169/67579\">@JosephSible</a> says.</p>\n\n<p>As is however discussed in <a href=\"https://stackoverflow.com/a/7289331/67579\">the question \"<em>How fast is <code>Data.Array</code>?</em>\"</a>, this is not very effective if you want to update your array <em>frequently</em>:</p>\n\n<blockquote>\n  <p>Note that <code>//</code> is probably <em>O(n)</em> though because it has to traverse the list (just like an imperative program would). If you <strong>need a lot of mutation you can use <code>MArray</code></strong> or <code>MVector</code>.</p>\n</blockquote>\n\n<p>This thus means that for large arrays, updating the array might take some time, since each update results in making a <em>copy</em> of the original array, and modifying that specific value.</p>\n\n<p>The <a href=\"http://hackage.haskell.org/package/array-0.5.3.0/docs/Data-Array-IO.html#t:IOArray\" rel=\"nofollow noreferrer\"><strong><code>IOArray</code></strong></a> is a specific type of such <a href=\"http://hackage.haskell.org/package/array-0.5.3.0/docs/Data-Array-MArray.html#t:MArray\" rel=\"nofollow noreferrer\"><strong><code>MArray</code></strong></a>. We can thus define the <code>modifyArray</code> with <a href=\"http://hackage.haskell.org/package/array-0.5.3.0/docs/Data-Array-MArray.html#v:writeArray\" rel=\"nofollow noreferrer\"><strong><code>writeArray :: (MArray a e m, Ix i) =&gt; a i e -&gt; i -&gt; e -&gt; m ()</code></strong></a>:</p>\n\n<pre><code>modifyArray :: <b>IOArray</b> Int Char -&gt; Int -&gt; IO (<b>IOArray</b> Int Char)\nmodifyArray arr idx | i &lt; 0 = return arr\n                    | mod i 102 == 1 = <b>writeArray arr idx ' '</b> &gt;&gt; return arr\n                    | otherwise = modifyarr arr idx</code></pre>\n\n<p>Note that here returning the array is not necessary, in essence the <code>IOArray</code> can be seen as a reference to a mutable array, so after the <code>writeArray</code> operation, <code>arr</code> refers to the modified array. If you use this in a larger <code>IO</code> operation, then after the <code>modifyArray</code>, that array is modified.</p>\n\n<p>You here use a loop to obtain the largest index <code>i</code> that has <code>div i 102 == 1</code> and is less than or equal to the initial index. You can however improve that, by subtracting the result of the modulo:</p>\n\n<pre><code>modifyArray :: IOArray Int Char -&gt; Int -&gt; IO (IOArray Int Char)\nmodifyArray arr idx | i &lt; 0 = return arr\n                    | otherwise = writeArray arr <b>(idx - mod (idx-1) 102)</b> ' ' &gt;&gt; return arr</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 11559674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c27d51eab87ad7ed97d951e480f63658?s=128&d=identicon&r=PG&f=1", "display_name": "DevG", "link": "https://stackoverflow.com/users/11559674/devg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "accepted_answer_id": 56332169, "answer_count": 2, "score": 3, "last_activity_date": 1559027437, "creation_date": 1558988607, "question_id": 56332075, "link": "https://stackoverflow.com/questions/56332075/haskell-modifying-value-at-specific-index-of-array", "title": "Haskell: Modifying value at specific index of array", "body": "<p>New to Haskell. I have created an char array and I am trying to figure out the best way to modify data in that array given a specific index.</p>\n\n<p>I already have an array created that I am passing into the below method in my main. That part is working fine. I just cant figure out how to manipulate the data at each index. In this particular case I am trying to override the value if the below condition is met with a space. And I want to return this to my main so i can print out the updated board.</p>\n\n<pre><code>import System.Random\nimport Control.Monad\nimport Data.Array\nimport Data.List\n\nmodifyArray :: Array Int Char -&gt; Int -&gt; IO (Array Int Char)\nmodifyArray arr i =\n    if i &gt; 0 then\n        if i `mod` 102 == 1 then do\n            (MODIFY ARRAY AT INDEX:i to equal ' ')\n        else modifyArray arr (i-1)\n    else arr   \n</code></pre>\n"}, {"tags": ["haskell", "liquid-haskell"], "comments": [{"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1558961978, "post_id": 56326273, "comment_id": 99260751, "body": "I tried to add <code>{-@ measure len @-}</code> and <code>{-@ data List [len] @-}</code> but it did not help."}], "answers": [{"comments": [{"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 2, "creation_date": 1558964082, "post_id": 56327061, "comment_id": 99261865, "body": "I added contracts for <code>Nil</code> and <code>Cons</code> from your answer and it works now. But without this tail: ` / [ len xs ]`. What does it mean? Is it mandatory?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 1, "creation_date": 1558979257, "post_id": 56327061, "comment_id": 99267982, "body": "@Paul-AG That tail suggests the induction metric for that goal. &quot;Prove this type is correct by induction on the length of <code>xs</code>&quot;. Perhaps it is not needed, after all."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1560893461, "post_id": 56327061, "comment_id": 99884513, "body": "Simple measures can often be inferred correctly.  You likely would need an explicit measure for non-trivial structures."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1558963726, "creation_date": 1558963726, "answer_id": 56327061, "question_id": 56326273, "link": "https://stackoverflow.com/questions/56326273/what-is-the-correct-contract-of-the-function-map-in-liquid-haskell/56327061#56327061", "title": "What is the correct contract of the function &quot;map&quot; in Liquid Haskell?", "body": "<p>I had to explicitly annotate the constructors.\nAfter that, it compiles with LiquidHaskell.</p>\n\n<pre><code>data List a = Nil | Cons a (List a) deriving (Show)                                                                                  \ninfixr 5 `Cons`\n\n{-@ len :: List a -&gt; Nat @-}\nlen :: List a -&gt; Int\nlen Nil           = 0\nlen (x `Cons` xs) = 1 + len xs\n\n{-@ Nil   ::  { ys : List a | len ys == 0 } @-}\n{-@ Cons  ::  a -&gt; xs : List a -&gt; { ys : List a | len ys == 1 + len xs } @-}\n\n{-@ mymap :: (a -&gt; b) -&gt; xs : List a -&gt; { ys : List b | len xs == len ys } / [ len xs ] @-}\nmymap :: (a -&gt; b) -&gt; List a -&gt; List b\nmymap _ Nil           = Nil\nmymap f (x `Cons` xs) = f x `Cons` mymap f xs\n</code></pre>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 56327061, "answer_count": 1, "score": 9, "last_activity_date": 1558963726, "creation_date": 1558960718, "question_id": 56326273, "link": "https://stackoverflow.com/questions/56326273/what-is-the-correct-contract-of-the-function-map-in-liquid-haskell", "title": "What is the correct contract of the function &quot;map&quot; in Liquid Haskell?", "body": "<p>I am trying to solve some exercise from LiquidHaskell <a href=\"https://liquid.kosmikus.org/02-lists.html\" rel=\"noreferrer\">tutorial</a>. So, I wrote this:</p>\n\n<pre><code>data List a = Nil | Cons a (List a) deriving (Show)                                                                                  \ninfixr 5 `Cons`\n\n{-@ len :: List a -&gt; Nat @-}\nlen :: List a -&gt; Int\nlen Nil           = 0\nlen (x `Cons` xs) = 1 + len xs\n\n{-@ mymap :: (a -&gt; b) -&gt; xs : List a -&gt; { ys : List b | len xs == len ys } @-}\nmymap :: (a -&gt; b) -&gt; List a -&gt; List b\nmymap _ Nil           = Nil\nmymap f (x `Cons` xs) = f x `Cons` mymap f xs\n</code></pre>\n\n<p>But I'm getting an error (excuse, pls, this formatting, it's the original LH error format):</p>\n\n<pre><code>53 | mymap f (x `Cons` xs) = f x `Cons` mymap f xs                                                                                  \n                              ^^^^^^^^^^^^^^^^^^^^^\n\n   Inferred type\n     VV : {v : (Main.List a) | Main.Cons##lqdc##$select v == ?a\n                               &amp;&amp; Main.Cons##lqdc##$select v == ds_d35c x\n                               &amp;&amp; v == Main.Cons (ds_d35c x) ?a}\n\n   not a subtype of Required type\n     VV : {VV : (Main.List a) | len ?b == len VV}\n\n   In Context\n     xs : (Main.List a)\n\n     ?b : (Main.List a)\n\n     x : a\n\n     ?a : {?a : (Main.List a) | len xs == len ?a}\n</code></pre>\n\n<p>What is the right \"contract\" of <code>mymap</code>? How to fix this error? And how should be read/treated messages like <code>Main.Cons##lqdc##$select v == ds_d35c x</code>?</p>\n"}, {"tags": ["haskell", "types", "polymorphism"], "comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1558967623, "post_id": 56326016, "comment_id": 99263548, "body": "I&#39;m voting to close this question as off-topic because it&#39;s asking for a Big List of things, rather than something where a single answer could be valid, or a concrete problem to solve."}, {"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1558968699, "post_id": 56326016, "comment_id": 99264110, "body": "@JosephSible I respect your vote. But you didn&#39;t convince me about how big the list of things to explain."}, {"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1558969454, "post_id": 56326016, "comment_id": 99264431, "body": "The reasons why I am asking are two: To learn Haskell deeply. Also, I expect a similar question on tech interview."}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 4, "creation_date": 1558975365, "post_id": 56326016, "comment_id": 99266718, "body": "I upvoted because there&#39;s probably a fairly short, definite answer to this question, at least for a specific version of GHC. Polymorphism in general is a pretty abstract concept, but there must be a finite list of language features implemented in GHC that enable some form of polymorphism, and that&#39;s a concrete question of fact."}], "answers": [{"comments": [{"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "edited": false, "score": 0, "creation_date": 1559024623, "post_id": 56330630, "comment_id": 99278065, "body": "Thank you for your answer. Can I say that the higher-rank polymorphism a special case of parametric polymorphism?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1559025811, "post_id": 56330630, "comment_id": 99278547, "body": "One might argue that subtyping is another kind of polymorphism. Subtyping is in fact sort of supported in Haskell with existential types, but should be used with extreme caution indeed."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "edited": false, "score": 1, "creation_date": 1559071775, "post_id": 56330630, "comment_id": 99302725, "body": "@mkUltra higher-rank polymorphism allows the use of parametric/ad-hoc polymorphism inside functions passed as arguments to higher-order-functions, something that is not enabled by default <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-RankNTypes\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a> <a href=\"https://kseo.github.io/posts/2016-12-27-higher-rank-polymorphism.html\" rel=\"nofollow noreferrer\">kseo.github.io/posts/2016-12-27-higher-rank-polymorphism.htm&zwnj;&#8203;l</a> it also enables higher-rank-kinds  <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#higher-rank-kinds\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 14, "last_activity_date": 1559024362, "last_edit_date": 1559024362, "creation_date": 1558980263, "answer_id": 56330630, "question_id": 56326016, "link": "https://stackoverflow.com/questions/56326016/which-polymorphism-types-are-supported-in-haskell/56330630#56330630", "title": "Which polymorphism types are supported in Haskell?", "body": "<p>There are at least four things that can count as polymorphism in current Haskell:</p>\n\n<ul>\n<li>Parametric polymorphism. (Also <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#kind-polymorphism\" rel=\"noreferrer\">kind polymorphism</a>, polymorphism in the kinds instead of the types. Which I guess is parametric polymorphism one level above, so I'm not counting it as a separate entry.)</li>\n<li>Ad-hoc polymorphism, the one enabled by typeclasses. Introduced in the <a href=\"https://www.cse.iitk.ac.in/users/karkare/courses/2010/cs653/Papers/ad-hoc-polymorphism.pdf\" rel=\"noreferrer\">How to make ad-hoc polymorphism less ad hoc</a> paper.</li>\n<li><a href=\"https://www.andres-loeh.de/Koke2005.pdf\" rel=\"noreferrer\">Structural polymorphism</a>. This is the one enabled by <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Generics.html\" rel=\"noreferrer\">generics</a>. A function can work over multiple data types that have different number of fields and constructors. For example, a generic equality function for records.</li>\n<li><a href=\"https://www.youtube.com/watch?v=lSJwXZ7vWBw\" rel=\"noreferrer\">Levity polymorphism</a>. Polymorphism over calling conventions / runtime representations of types. Described in the <a href=\"https://cs.brynmawr.edu/~rae/papers/2017/levity/levity-extended.pdf\" rel=\"noreferrer\">Levity Polymorphism</a> paper.</li>\n</ul>\n\n<p>There are two more types of polymorphism that <em>might</em> be introduced in future versions of Haskell:</p>\n\n<ul>\n<li><p>Matchability polymorphism. Would allow higher-order type families to work with both type constructors and type families as arguments. Described in the paper <a href=\"https://www.microsoft.com/en-us/research/uploads/prod/2019/03/ho-haskell.pdf\" rel=\"noreferrer\">Higher-order Type-level Programming in Haskell</a>.</p></li>\n<li><p>Multiplicity polymorphism. Would allow higher-order functions to work with both normal functions and linear functions as arguments. Described in the paper <a href=\"https://arxiv.org/pdf/1710.09756.pdf\" rel=\"noreferrer\">Linear Haskell Practical Linearity in a Higher-Order Polymorphic Language</a>.</p></li>\n</ul>\n\n<p>One might ask, why this whole panoply of polymorphisms? There seems to exist an overall design principle in Haskell that, whenever some challenge could be solved with either subtyping <em>or</em> polymorphism, <em>polymorphism should be preferred</em>.</p>\n\n<p>For example, from the levity polymorphism paper:</p>\n\n<blockquote>\n  <p>We can now present the main idea of the paper: replace sub-kinding\n  with kind polymorphism.</p>\n</blockquote>\n\n<p>From the paper introducing matchability polymorphism:</p>\n\n<blockquote>\n  <p>At first you might think that we need subtyping, but instead we turn to polymorphism</p>\n</blockquote>\n\n<p>From the linear Haskell paper:</p>\n\n<blockquote>\n  <p>The lack of subtyping is a deliberate choice in our design</p>\n</blockquote>\n\n<p>Simon Peyton Jones himself makes the point at <a href=\"https://www.youtube.com/watch?v=t0mhvd3-60Y&amp;feature=youtu.be&amp;t=2820\" rel=\"noreferrer\">47:00</a> in <a href=\"https://www.youtube.com/watch?v=t0mhvd3-60Y\" rel=\"noreferrer\">this talk</a>.</p>\n\n<blockquote>\n  <p>Whenever you want to use subtyping, use polymorphism instead.</p>\n</blockquote>\n"}], "owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 483, "favorite_count": 4, "accepted_answer_id": 56330630, "answer_count": 1, "score": 5, "last_activity_date": 1559024362, "creation_date": 1558959812, "last_edit_date": 1558960077, "question_id": 56326016, "link": "https://stackoverflow.com/questions/56326016/which-polymorphism-types-are-supported-in-haskell", "title": "Which polymorphism types are supported in Haskell?", "body": "<p>Reading the Wikipedia definition of <a href=\"https://en.wikipedia.org/wiki/Polymorphism_(computer_science)\" rel=\"noreferrer\">polymorphism</a>, I come with a question:</p>\n\n<p>Which polymorphism types are supported in Haskell and which are not?</p>\n\n<p>Looks like Wikipedia do not contain a description for some polymorphism types like <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/11/levity-1.pdf\" rel=\"noreferrer\">Levity Polymorphism</a> which is new for me and supported in Haskell.</p>\n\n<p>I wondering to have an extended list of <a href=\"https://wiki.haskell.org/Polymorphism\" rel=\"noreferrer\">Haskell Polymorphism</a> followed with examples to explore deeply.</p>\n\n<p>Looks like the main two are:</p>\n\n<ul>\n<li>Parametric polymorphism</li>\n<li>Ad-hoc polymorphism</li>\n</ul>\n"}, {"tags": ["haskell", "llvm", "bitcode"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1558949095, "post_id": 56322704, "comment_id": 99254366, "body": "I think the LLVM code generated in this way assumes that the GHC runtime system (RTS) was properly initialized, providing the GC data structures, threads, and many primitive operations. Further, GHC LLVM function use a custom call convention <code>cc 10</code>, which differs from the standard C one. To actually run that LLVM code you have to provide the RTS, probably linking it in (I don&#39;t know how, exactly), and make a suitable call to your Haskell code."}], "owner": {"reputation": 10089, "user_id": 1850340, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/bdef220f4272ab4796c6ae65621481cf?s=128&d=identicon&r=PG", "display_name": "adius", "link": "https://stackoverflow.com/users/1850340/adius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 249, "favorite_count": 0, "closed_date": 1558978596, "answer_count": 0, "score": 2, "last_activity_date": 1558978931, "creation_date": 1558947258, "question_id": 56322704, "link": "https://stackoverflow.com/questions/56322704/how-to-run-llvm-bitcode-generated-from-haskell-source-code", "closed_reason": "Duplicate", "title": "How to run LLVM bitcode generated from Haskell source code", "body": "<p>I'm trying to run LLVM bitcode generated from Haskell source code instead of compiling the code to a native binary on macOS.</p>\n\n<p>I have following file:</p>\n\n<pre><code>$ cat hello_world.hs\nmain =\n  putStrLn \"Hello world!\"\n</code></pre>\n\n<p>And I'm using following steps to create the <code>.bc</code> file:</p>\n\n<pre><code>$ brew install stack\n$ brew install llvm@6\n\n$ stack ghc -- -keep-llvm-files hello_world.hs\n$ clang -c -emit-llvm hello_world.ll -o hello_world.bc\n</code></pre>\n\n<p>When I now try to run it, I get following error:</p>\n\n<pre><code>$ lli hello_world.bc\n'main' function not found in module.\n</code></pre>\n\n<p>When I set <code>-fllvm</code> to compile to a native binary via LLVM it all works, so it doesn't seem to be a problem with my LLVM setup.\nHow can this be fixed?</p>\n"}, {"tags": ["haskell", "haskell-persistent"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1558973712, "post_id": 56322519, "comment_id": 99266143, "body": "Have you looked at <a href=\"http://hackage.haskell.org/package/persistent\" rel=\"nofollow noreferrer\">the documentation for persistent</a>?"}, {"owner": {"reputation": 321, "user_id": 6746453, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1e1cf14f1e5a48fa1d079b3cb81fe437?s=128&d=identicon&r=PG&f=1", "display_name": "Jacky Wong", "link": "https://stackoverflow.com/users/6746453/jacky-wong"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1559008653, "post_id": 56322519, "comment_id": 99274581, "body": "I&#39;ve click all the links on the page, none of them can tell the way..please"}], "answers": [{"tags": [], "owner": {"reputation": 321, "user_id": 6746453, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1e1cf14f1e5a48fa1d079b3cb81fe437?s=128&d=identicon&r=PG&f=1", "display_name": "Jacky Wong", "link": "https://stackoverflow.com/users/6746453/jacky-wong"}, "is_accepted": false, "score": 0, "last_activity_date": 1559008527, "creation_date": 1559008527, "answer_id": 56334135, "question_id": 56322519, "link": "https://stackoverflow.com/questions/56322519/how-to-set-column-mapping-relation-when-generating-entities-in-haskell/56334135#56334135", "title": "How to set column mapping relation when generating entities in Haskell?", "body": "<p>I've found it on this page <a href=\"https://github.com/yesodweb/persistent/blob/master/docs/Persistent-entity-syntax.md\" rel=\"nofollow noreferrer\">https://github.com/yesodweb/persistent/blob/master/docs/Persistent-entity-syntax.md</a></p>\n\n<p>I can do some customization follow these syntax.</p>\n"}], "owner": {"reputation": 321, "user_id": 6746453, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1e1cf14f1e5a48fa1d079b3cb81fe437?s=128&d=identicon&r=PG&f=1", "display_name": "Jacky Wong", "link": "https://stackoverflow.com/users/6746453/jacky-wong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1559008527, "creation_date": 1558946503, "last_edit_date": 1558973676, "question_id": 56322519, "link": "https://stackoverflow.com/questions/56322519/how-to-set-column-mapping-relation-when-generating-entities-in-haskell", "title": "How to set column mapping relation when generating entities in Haskell?", "body": "<p>I am trying to use Persistent to access my database. I know that Persistent can generate the code of entity, but there is something I can't generate so easily.\nLike I got a table which looks like:</p>\n\n<pre><code>CREATE TABLE `user` (\n  `user_id` bigint(11) NOT NULL,\n  `user_name` varchar(255) DEFAULT NULL,\n  `user_password` varchar(255) DEFAULT NULL,\n  PRIMARY KEY (`user_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n</code></pre>\n\n<p>then my haskell code like :</p>\n\n<pre><code>mkPersist sqlSettings [persistLowerCase|\nUser\n  name String\n  password String\n  deriving Show\n|]\n</code></pre>\n\n<p>These fields are different include the primary key, I want to set their mapping relation. The official page (<a href=\"https://www.yesodweb.com/book/persistent\" rel=\"nofollow noreferrer\">https://www.yesodweb.com/book/persistent</a>) doesn't say how to do it.</p>\n\n<p>Need I write the code to define it instead of generating it?</p>\n"}, {"tags": ["performance", "haskell", "typeclass"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1558944693, "post_id": 56322038, "comment_id": 99252231, "body": "First guess would be inlining. There&#39;s the <code>{-# INLINE test #-}</code> pragma you can try, but first \u2013 do you actually compile with optimisations?"}], "answers": [{"tags": [], "owner": {"reputation": 2009, "user_id": 107341, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2263e59b3b4f65895d0d3dd592f00662?s=128&d=identicon&r=PG", "display_name": "oshyshko", "link": "https://stackoverflow.com/users/107341/oshyshko"}, "is_accepted": false, "score": 5, "last_activity_date": 1558945263, "creation_date": 1558945263, "answer_id": 56322220, "question_id": 56322038, "link": "https://stackoverflow.com/questions/56322038/why-does-performance-drop-when-a-function-is-moved-to-another-module/56322220#56322220", "title": "Why does performance drop when a function is moved to another module?", "body": "<p>As <code>leftaroundabout</code> suggested in a comment, adding <code>INLINE</code> pragma solved the problem:</p>\n\n<pre><code>test :: MArray a t m =&gt; (t -&gt; t) -&gt; a Int t -&gt; m ()\n{-# INLINE test #-}\ntest f a =\n    ...\n</code></pre>\n\n<p><a href=\"https://github.com/oshyshko/polymodperf/blob/master/src/SomeModule.hs#L10\" rel=\"noreferrer\">https://github.com/oshyshko/polymodperf/blob/master/src/SomeModule.hs#L10</a></p>\n"}], "owner": {"reputation": 2009, "user_id": 107341, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2263e59b3b4f65895d0d3dd592f00662?s=128&d=identicon&r=PG", "display_name": "oshyshko", "link": "https://stackoverflow.com/users/107341/oshyshko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1558945263, "creation_date": 1558944423, "question_id": 56322038, "link": "https://stackoverflow.com/questions/56322038/why-does-performance-drop-when-a-function-is-moved-to-another-module", "title": "Why does performance drop when a function is moved to another module?", "body": "<p>I am observing that the same fn gives different performance, depending on whether it's placed in the same module where it's used or in a module next to it. Any ideas what could be causing it?</p>\n\n<p>Here's the function:\n<a href=\"https://github.com/oshyshko/polymodperf/blob/master/src/Main.hs#L41-L55\" rel=\"noreferrer\">https://github.com/oshyshko/polymodperf/blob/master/src/Main.hs#L41-L55</a></p>\n\n<pre><code>test :: MArray a t m =&gt; (t -&gt; t) -&gt; a Int t -&gt; m ()\ntest f a =\n    mapM_ (\\ xy -&gt; do\n              v &lt;- get a xy\n              set a xy (f v))\n\n          [ (x,y) | y &lt;- [0..1000 - 1],\n                    x &lt;- [0..1000 - 1],\n                    n &lt;- [0..10]]\n  where\n    get :: MArray a e m =&gt; a Int e -&gt; (Int, Int) -&gt; m e\n    get a (x,y) = readArray a (x + y * 1000)\n\n    set :: MArray a e m =&gt; a Int e -&gt; (Int, Int) -&gt; e -&gt; m ()\n    set a (x,y) = writeArray a (x + y * 1000)\n</code></pre>\n\n<p>In my test pass I use <code>Data.Array.IO.newArray</code> to create an array, then pass it to <code>test</code>.</p>\n\n<p>Here's how to observe the difference in performance (second value, ms):</p>\n\n<pre><code>$ ./scripts/build-exec.sh\n...\nMain.test\n(11000000,2010)\n(11000000,239)\n(11000000,240)\n(11000000,242)\n(11000000,237)\n\nSomeModule.test\n(11000000,6376)\n(11000000,4851)\n(11000000,5455)\n(11000000,5096)\n(11000000,5206)\n</code></pre>\n\n<ul>\n<li><code>Main.test</code>: both <code>newArray</code> and <code>test</code> both live in <code>Main</code> => okay performance (the first 2010ms run is probably bad due to warmup, but the rest look good)</li>\n<li><code>SomeModule.test</code>: <code>newArray</code> lives in <code>Main</code>, but <code>test</code> is imported from <code>SomeModule.test</code> => much worse performance</li>\n</ul>\n\n<p>The code of <code>test</code> is identical in both modules:\n<a href=\"https://github.com/oshyshko/polymodperf/blob/master/src/Main.hs#L41-L55\" rel=\"noreferrer\">https://github.com/oshyshko/polymodperf/blob/master/src/Main.hs#L41-L55</a>\n<a href=\"https://github.com/oshyshko/polymodperf/blob/master/src/SomeModule.hs#L9-L17\" rel=\"noreferrer\">https://github.com/oshyshko/polymodperf/blob/master/src/SomeModule.hs#L9-L17</a></p>\n\n<p>The used <code>MArray</code> typeclass and fns <code>readArray</code>, <code>writeArray</code> imported from the same module in both cases:</p>\n\n<pre><code>import           Data.Array.MArray (MArray, readArray, writeArray)\n</code></pre>\n\n<p>Any ideas what could be causing the difference in performance?</p>\n"}, {"tags": ["haskell", "memory-leaks", "tail-recursion"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1558922894, "post_id": 56318851, "comment_id": 99246343, "body": "What do you think <code>force x</code> does that <code>x</code> does not do?"}, {"owner": {"reputation": 23, "user_id": 6096499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e215efa0ae0dd91b37e72993d276d648?s=128&d=identicon&r=PG&f=1", "display_name": "Ivan Volosyuk", "link": "https://stackoverflow.com/users/6096499/ivan-volosyuk"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1558923204, "post_id": 56318851, "comment_id": 99246392, "body": "Well, I want to force strict creation of the new list. I have a suspicion that force doesn&#39;t do anything here actually. My text editor also says that it&#39;s useless."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 6096499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e215efa0ae0dd91b37e72993d276d648?s=128&d=identicon&r=PG&f=1", "display_name": "Ivan Volosyuk", "link": "https://stackoverflow.com/users/6096499/ivan-volosyuk"}, "edited": false, "score": 0, "creation_date": 1558923628, "post_id": 56318908, "comment_id": 99246462, "body": "Thanks a lot! Deepseq works. I was looking for something like that."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 6, "last_activity_date": 1558923530, "last_edit_date": 1558923530, "creation_date": 1558923197, "answer_id": 56318908, "question_id": 56318851, "link": "https://stackoverflow.com/questions/56318851/unable-to-force-strictness-in-tail-recursion/56318908#56318908", "title": "Unable to force strictness in tail recursion", "body": "<pre><code>force x = x `seq` x\n</code></pre>\n\n<p>That's useless. <code>seq</code> doesn't mean \"evaluate this thing now\"; it means \"evaluate the left thing before returning the result of evaluating the right thing\". When they're the same, it does nothing, and your <code>force</code> is equivalent to just <code>id</code>. Try this instead:</p>\n\n<pre><code>import Control.DeepSeq\nimport Control.Monad\n\nloop :: [Int] -&gt; IO ()\nloop x = do\n  when (head x `mod` 10000000 == 0) $ print x\n  let x' = map (+1) x\n  loop $!! x'\n\nmain = loop $ replicate 200 1\n</code></pre>\n\n<p>That evaluates <code>x'</code> and everything in it before <code>loop x'</code>, which is useful.</p>\n\n<p>Alternatively, Control.DeepSeq has a <code>force</code> function that is useful. Its semantics in this case are \"evaluate all of the elements of your list before returning the result of evaluating any of it\". If you used its <code>force</code> function in place of your own, your original code would otherwise work, since the first line of <code>loop</code> does evaluate the beginning of the list.</p>\n"}], "owner": {"reputation": 23, "user_id": 6096499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e215efa0ae0dd91b37e72993d276d648?s=128&d=identicon&r=PG&f=1", "display_name": "Ivan Volosyuk", "link": "https://stackoverflow.com/users/6096499/ivan-volosyuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 56318908, "answer_count": 1, "score": 2, "last_activity_date": 1558923530, "creation_date": 1558922599, "question_id": 56318851, "link": "https://stackoverflow.com/questions/56318851/unable-to-force-strictness-in-tail-recursion", "title": "Unable to force strictness in tail recursion", "body": "<p>I am dealing with memory leaks in my Haskell program and I was able to isolate it to very basic laziness problem in dealing with arrays. I understand what's happening there. First element of the array is computed while the rest produce the delayed computations which consumes the heap. Unfortunately, I was unable to force strictness for the entire array computation.</p>\n\n<p>I tried various combinations of seq, BangPatterns, ($!) without much success.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Monad\n\nforce x = x `seq` x\n\nloop :: [Int] -&gt; IO ()\nloop x = do\n  when (head x `mod` 10000000 == 0) $ print x\n  let x' = force $ map (+1) x\n  loop x'\n\nmain = loop $ replicate 200 1\n</code></pre>\n\n<p>The profile with standard profiling options didn't give me any more information than I already know:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>ghc -prof -fprof-auto-calls -rtsopts test.hs\n./test +RTS -M300M -p -hc\n</code></pre>\n\n<p>This runs out of memory in the matter of a few seconds.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1558922093, "post_id": 56318633, "comment_id": 99246235, "body": "It looks like you&#39;re the same person as <a href=\"https://stackoverflow.com/users/9319699/anon\">Anon.</a> from <a href=\"https://stackoverflow.com/q/56318231/7509065\">this question</a>. You may want to <a href=\"https://stackoverflow.com/help/merging-accounts\">merge your accounts</a>."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 11559674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c27d51eab87ad7ed97d951e480f63658?s=128&d=identicon&r=PG&f=1", "display_name": "DevG", "link": "https://stackoverflow.com/users/11559674/devg"}, "edited": false, "score": 0, "creation_date": 1558921665, "post_id": 56318688, "comment_id": 99246168, "body": "Wow thanks! This is starting to make sense. Thanks for the advice on the efficiency as well. It works perfectly :)"}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 4, "last_activity_date": 1558921227, "last_edit_date": 1558921227, "creation_date": 1558920840, "answer_id": 56318688, "question_id": 56318633, "link": "https://stackoverflow.com/questions/56318633/function-that-takes-an-array-of-chars-and-returns-a-concatenated-string-haskell/56318688#56318688", "title": "Function that takes an array of chars and returns a concatenated string. Haskell", "body": "<p>A few problems:</p>\n\n<ol>\n<li>It's not possible to write a function that takes an <code>IO</code> of something and uses it to return something that isn't in <code>IO</code>. Change <code>showBoard</code> to take an <code>Array Int Char</code> without the <code>IO</code> wrapper, and remove <code>do</code> and <code>return</code> from it.</li>\n<li>Since your array is zero-based, change <code>arr ! i</code> to <code>arr ! (i - 1)</code>.</li>\n<li><code>arr</code> contains <code>Char</code>s, not <code>String</code>s, so use <code>[]</code> instead of <code>()</code> around the indexing of it to make it into a <code>String</code>.</li>\n<li>Since we made <code>showBoard</code> take a value without <code>IO</code>, use <code>&lt;-</code> in <code>main</code> to get at the inner value we need.</li>\n</ol>\n\n<p>Here's the result of all of those changes:</p>\n\n<pre><code>import System.Random\nimport Control.Monad\nimport Data.Array\nimport Data.List\n\nrandomBoard = do\n    f1 &lt;- randomIO :: IO Int\n    if(f1 `mod` 2) == 0\n        then return  '*'\n        else return  ' '\n\nboardArray :: IO (Array Int Char)\nboardArray = listArray (0, 99) &lt;$&gt; replicateM 100 randomBoard\n\n\nshowBoard :: Array Int Char -&gt; Int -&gt; String -&gt; String\nshowBoard arr i str =\n    if i &gt; 0\n       then showBoard arr (i-1) (str ++ [arr ! (i - 1)])\n       else str\n\nmain :: IO ()\nmain = do\n    randomArray &lt;- boardArray\n    let board = showBoard randomArray 100 \"\"\n    putStr board\n</code></pre>\n\n<p>As an aside, the way <code>showBoard</code> is implemented, although it works, is particularly inefficient. You should avoid doing things that look like <code>x ++ [y]</code> recursively, as it's quadratically slow. Also, it looks like your function prints the elements starting at the end and going down to 0, rather than starting at 0 and going up to the end. Here's a new version of it that fixes both of those things at once:</p>\n\n<pre><code>showBoard :: Array Int Char -&gt; Int -&gt; String -&gt; String\nshowBoard arr i str =\n    if i &gt; 0\n       then showBoard arr (i-1) ((arr ! (i - 1)) : str)\n       else str\n</code></pre>\n\n<p>Using <code>:</code> where possible is much more efficient than always using <code>++</code>.</p>\n\n<p>You can simplify even further by not having <code>showBoard</code> at all, and using <a href=\"https://hackage.haskell.org/package/array-0.5.3.0/docs/Data-Array.html#v:elems\" rel=\"nofollow noreferrer\"><code>elems</code></a> (from <code>Data.Array</code>) instead:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    randomArray &lt;- boardArray\n    let board = elems randomArray\n    putStr board\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 11559674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c27d51eab87ad7ed97d951e480f63658?s=128&d=identicon&r=PG&f=1", "display_name": "DevG", "link": "https://stackoverflow.com/users/11559674/devg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 0, "accepted_answer_id": 56318688, "answer_count": 1, "score": 4, "last_activity_date": 1558921227, "creation_date": 1558920161, "question_id": 56318633, "link": "https://stackoverflow.com/questions/56318633/function-that-takes-an-array-of-chars-and-returns-a-concatenated-string-haskell", "title": "Function that takes an array of chars and returns a concatenated string. Haskell", "body": "<p>Ugh... Struggling with haskell. Trying to implement Conway's GOL and create a random game board. Here is where I am at. </p>\n\n<p>I have a function to randomize each square in an array, and a function to create an array of characters using the randomization function to represent my game board.</p>\n\n<p>I am trying to now create a function: showBoard, which iterates through the array and concatenates each char to a string which I can print out in my main. </p>\n\n<pre><code>import System.Random\nimport Control.Monad\nimport Data.Array\nimport Data.List\n\nrandomBoard = do\n    f1 &lt;- randomIO :: IO Int\n    if(f1 `mod` 2) == 0\n        then return  '*'\n        else return  ' '\n\nboardArray :: IO (Array Int Char)\nboardArray = listArray (0, 99) &lt;$&gt; replicateM 100 randomBoard\n\n\nshowBoard :: IO (Array Int Char) -&gt; Int -&gt; String -&gt; String\nshowBoard arr i str = do\n    if i &gt; 0\n       then showBoard arr (i-1) (str ++ (arr ! i))\n       else return str\n\nmain :: IO ()\nmain = \nlet board = showBoard boardArray 100 \"\"\n    in\n        do\n            putStr board\n</code></pre>\n\n<p>I have spent an hour trying to tweak this out and keep getting type issues. I cant even get this board to print x.x please help.</p>\n"}, {"tags": ["arrays", "list", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 2, "creation_date": 1558915535, "post_id": 56318231, "comment_id": 99245332, "body": "I made Game of Life as one of my first projects in Haskell. I would advise you to forget about <code>Data.Array</code> and just use a nested <code>[[Bool]]</code> for the game board. <code>Data.Array</code> is much more efficient, but a nested list is much easier to use especially for beginners. Additionally it is easier to use a <code>Bool</code> as the state type rather than a <code>Char</code>, as a <code>Bool</code> naturally maps to the on/off nature of the cell state."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 9319699, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/159ce058d3fd5a0dccfe63e287932929?s=128&d=identicon&r=PG&f=1", "display_name": "Anon.", "link": "https://stackoverflow.com/users/9319699/anon"}, "edited": false, "score": 0, "creation_date": 1558916041, "post_id": 56318287, "comment_id": 99245389, "body": "This is awesome and makes a lot of sense. Thank you so much. Follow up question, what is the best way to print boardArray to screen? Previously i was using putStr."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 95, "user_id": 9319699, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/159ce058d3fd5a0dccfe63e287932929?s=128&d=identicon&r=PG&f=1", "display_name": "Anon.", "link": "https://stackoverflow.com/users/9319699/anon"}, "edited": false, "score": 0, "creation_date": 1558916210, "post_id": 56318287, "comment_id": 99245409, "body": "@Anon. For debugging, you could just <code>print</code> it and get something that looks like <code>array (0,99) [(0,&#39; &#39;),(1,&#39; &#39;),(2,&#39;*&#39;),...,(98,&#39;*&#39;),(99,&#39;*&#39;)]</code>. If you want something prettier, then a custom function with <code>putStr</code> probably is your best bet."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 95, "user_id": 9319699, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/159ce058d3fd5a0dccfe63e287932929?s=128&d=identicon&r=PG&f=1", "display_name": "Anon.", "link": "https://stackoverflow.com/users/9319699/anon"}, "edited": false, "score": 1, "creation_date": 1558916236, "post_id": 56318287, "comment_id": 99245415, "body": "@Anon. The <i>best</i> way is probably to define your own custom function <code>showBoard :: Array Int Char -&gt; String</code> which should iterate over the array and convert it to a <code>String</code>; this allows you to format it nicely as well. Then you can print that with <code>putStrLN</code>."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 7, "last_activity_date": 1558916670, "last_edit_date": 1558916670, "creation_date": 1558915643, "answer_id": 56318287, "question_id": 56318231, "link": "https://stackoverflow.com/questions/56318231/mapping-function-to-list-array-in-haskell/56318287#56318287", "title": "Mapping function to list/array in haskell?", "body": "<p>This should work for you:</p>\n\n<pre><code>import Control.Monad\nimport System.Random\nimport Data.Array\nimport Data.List\n\nrandomBoard :: IO Char\nrandomBoard =\n   do\n   f1 &lt;- randomIO :: IO Int\n   if(f1 `mod` 2) == 0\n     then return  '*'\n     else return  ' '\n\nboardArray :: IO (Array Int Char)\nboardArray = listArray (0, 99) &lt;$&gt; replicateM 100 randomBoard\n</code></pre>\n\n<p>Here's what I changed:</p>\n\n<ol>\n<li>I added the type signature <code>randomBoard :: IO Char</code> for clarity. (The code would still work without it, as Haskell correctly infers this type if you don't supply it.)</li>\n<li>I changed the type of <code>boardArray</code> to use <code>IO</code>. Anything that uses <code>IO</code>, no matter how indirectly, need to be in <code>IO</code> itself.</li>\n<li>I changed <code>listArray (0, 100)</code> to <code>listArray (0, 99)</code>, as the former would actually be 101 elements.</li>\n<li><code>map randomBoard $ 100 (0,100)</code> isn't right at all. To get a list of several of the same thing, you'd usually use <code>replicate</code>, but since the thing you care about here is in the <code>IO</code> monad, you use <code>replicateM</code> instead. <code>replicateM 100 randomBoard</code> gives an <code>IO [Char]</code> with 100 random elements of either <code>'*'</code> or <code>' '</code>.</li>\n<li>I added an import of <code>Control.Monad</code>, which is needed to use <code>replicateM</code>.</li>\n<li>I use <code>&lt;$&gt;</code> in <code>boardArray</code>. Since you want to call <code>listArray</code> with a <code>[Char]</code> and get an <code>Array Int Char</code>, but <code>replicateM 100 randomBoard</code> is an <code>IO [Char]</code>, you can't just apply the argument directly. Using <code>&lt;$&gt;</code> (which is also called <code>fmap</code>) applies it \"inside\" of <code>IO</code>, giving you back an <code>IO (Array Int Char)</code>.</li>\n</ol>\n"}], "owner": {"reputation": 95, "user_id": 9319699, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/159ce058d3fd5a0dccfe63e287932929?s=128&d=identicon&r=PG&f=1", "display_name": "Anon.", "link": "https://stackoverflow.com/users/9319699/anon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 645, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1558984381, "creation_date": 1558914692, "last_edit_date": 1558984381, "question_id": 56318231, "link": "https://stackoverflow.com/questions/56318231/mapping-function-to-list-array-in-haskell", "title": "Mapping function to list/array in haskell?", "body": "<p>I am trying to initiate a random array to begin the game. To do that I create a function randomBoard which returns '*' or ' ' to represent a space on the game board.</p>\n\n<p>I want to be able to create the game board array with this function. I havent been able to succesfully instantiate an array yet. I am hoping there is a way i can declare an array of say size 100 and use my random function to set each element.</p>\n\n<p>This obviously doesnt work or even compile. I am sure there are a couple things wrong with it, as I am not sure really how to even work with IO in haskell and produce this outcome. Any guidance is much appreciated...</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 1, "creation_date": 1558921603, "post_id": 56318061, "comment_id": 99246155, "body": "That&#39;s because <code>Foo1</code> doesn&#39;t include the leading <code>foo</code> static path fragment, so when you ask servant to produce a link for <code>Foo1</code> (within the <code>Foo</code> API), it doesn&#39;t find an endpoint that matches <code>Foo1</code> exactly and complains."}, {"owner": {"reputation": 1010, "user_id": 267916, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d630bf06a192014619dd8c9a75c7ade2?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/267916/jeremy"}, "reply_to_user": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1558921864, "post_id": 56318061, "comment_id": 99246200, "body": "I think that makes sense, though in that case I don&#39;t know how to specify this same sort of configuration -- do you know if it is possible?"}, {"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 1, "creation_date": 1559206197, "post_id": 56318061, "comment_id": 99350956, "body": "Maybe something like <a href=\"https://hackage.haskell.org/package/servant-flatten-0.2/docs/Servant-API-Flatten.html\" rel=\"nofollow noreferrer\"><code>servant-flatten</code></a> is appropriate here? Just like the client/server examples in those docs, you could pass a &quot;flattened&quot; version of your <code>Foo</code> API type as <code>safeLink</code>&#39;s second argument, and the first argument could perhaps use <code>Nth</code> on the said flattened API type to hit the endpoint you want?"}, {"owner": {"reputation": 1010, "user_id": 267916, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d630bf06a192014619dd8c9a75c7ade2?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/267916/jeremy"}, "reply_to_user": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1559622248, "post_id": 56318061, "comment_id": 99468384, "body": "Thank you; I hadn&#39;t known about servant-flatten. I&#39;m sure your suggestion makes good sense, but I haven&#39;t been able to figure out specifics of how to make it work. (If it involves defining a type instance Nth myself, I&#39;m lost.)"}, {"owner": {"reputation": 1010, "user_id": 267916, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d630bf06a192014619dd8c9a75c7ade2?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/267916/jeremy"}, "reply_to_user": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1559622551, "post_id": 56318061, "comment_id": 99468458, "body": "I should add that I have not been able to find any examples of anyone actually using servant-flatten in publicly-available code indexed by search engine, but I did look!"}, {"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 1, "creation_date": 1559740302, "post_id": 56318061, "comment_id": 99513883, "body": "Regarding uses of servant-flatten, surprisingly I&#39;m not the only user :-) See <a href=\"https://github.com/search?q=%22import+Servant.API.Flatten%22&amp;type=Code\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 1, "creation_date": 1559740554, "post_id": 56318061, "comment_id": 99514028, "body": "Regarding your actual question, the idea is that instead of passing <code>apiProxy :: Proxy YourAPI</code> to whatever function you&#39;re using (<code>serve</code>, <code>client</code>, <code>safeLink</code>, ...), you&#39;d pass <code>flatten apiProxy</code> which has type <code>Proxy (Flat YourAPI)</code>. You don&#39;t have to define an instance of <code>Nth</code>, you just have to use it to get a proxy to the right endpoint. <code>Nth &lt;some number&gt; &lt;some flattened API type&gt;</code> will give you an API type for the <code>&lt;some number&gt; + 1</code> th endpoint. <code>Nth 0</code> for the first, <code>Nth 1</code> for the second, etc. Email me if this is not clear enough, I&#39;m not a huge fan of SO for those matters."}, {"owner": {"reputation": 1010, "user_id": 267916, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d630bf06a192014619dd8c9a75c7ade2?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/267916/jeremy"}, "reply_to_user": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1559782501, "post_id": 56318061, "comment_id": 99530615, "body": "I got it now, thank you so much! I had been boneheadedly trying to use Nth as a constructor but finally realized why that wasn&#39;t working, and now I know what I need to do. Specifically, expressions of the form <code>safeLink (Proxy :: Proxy (Flat Foo)) (Proxy :: Proxy (Nth 1 (Flat Foo)))</code>"}, {"owner": {"reputation": 1010, "user_id": 267916, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d630bf06a192014619dd8c9a75c7ade2?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/267916/jeremy"}, "reply_to_user": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1559782654, "post_id": 56318061, "comment_id": 99530645, "body": "Also thanks for the pointer to the github search. I had been under the mistaken impression that it would have been indexed by the web-wide engine I&#39;d been using. I still couldn&#39;t find <a href=\"https://github.com/search?q=%22import+Servant.API.Flatten%22+Nth&amp;type=Code\" rel=\"nofollow noreferrer\">anyone using Nth</a> though!"}, {"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 1, "creation_date": 1559895674, "post_id": 56318061, "comment_id": 99570059, "body": "Indeed, <code>Nth</code> doesn&#39;t seem to be used in public repositories. I&#39;d be delighted to merge a patch that adds an example of using <code>Nth</code> to its haddocks. =)  Re: github search, I always look there first when I&#39;m looking for examples of using some library/function/..., I definitely recommend it."}], "answers": [{"tags": [], "owner": {"reputation": 1010, "user_id": 267916, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d630bf06a192014619dd8c9a75c7ade2?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/267916/jeremy"}, "is_accepted": true, "score": 0, "last_activity_date": 1560409849, "creation_date": 1560409849, "answer_id": 56575121, "question_id": 56318061, "link": "https://stackoverflow.com/questions/56318061/safelink-in-servant/56575121#56575121", "title": "safeLink in Servant", "body": "<p>The example doesn't work because <code>Foo1</code>, the type you've defined for the endpoint, does not itself contain the full path to itself relative to the top of the <code>Foo</code> API.</p>\n\n<p>One way for you to fix this situation is by using a \"flattened\" API instead:</p>\n\n<p><code>safeLink (Proxy :: Proxy (Flat Foo)) (Proxy :: Proxy (Nth 1 (Flat Foo)))</code></p>\n\n<p>(requiring <code>import Servant.API.Flatten</code> as well)</p>\n\n<p>The disadvantage is that you have to know the ordinal position of <code>Foo1</code> within <code>Foo</code>. There doesn't seem to be a way to get the answer you want by using the types as specified in your question. You could define the flattened API in the first place, at the cost of making the structure as clear (IMO).</p>\n\n<p>Thanks to <a href=\"https://stackoverflow.com/users/193424/alp-mestanogullari\">Alp Mestanogullari</a> for explaining this to me above, in the comments to the question. He should really get credit for the answer!</p>\n"}], "owner": {"reputation": 1010, "user_id": 267916, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d630bf06a192014619dd8c9a75c7ade2?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/267916/jeremy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 56575121, "answer_count": 1, "score": 4, "last_activity_date": 1560409849, "creation_date": 1558912282, "question_id": 56318061, "link": "https://stackoverflow.com/questions/56318061/safelink-in-servant", "title": "safeLink in Servant", "body": "<p>Servant uses <code>Servant.API.safeLink</code> to generate relative URLs, but I'm running into a problem that makes me think I am misunderstanding something basic either about how to use it or about how to define Servant APIs.</p>\n\n<p>The minimal example I've constructed contains two endpoints. One is intended to be a \"front door\" endpoint at (relative URL) <code>/foo</code>, and the other at <code>/foo/1</code>:</p>\n\n<pre><code>{-# LANGUAGE DataKinds     #-}\n{-# LANGUAGE TypeOperators #-}\nimport Servant\n\ndata HTML\ntype Foo = \"foo\" :&gt; (Foo0 :&lt;|&gt; Foo1)\ntype Foo0 = Get '[HTML] String\ntype Foo1 = \"1\" :&gt; Get '[HTML] String\n\nslFoo :: Link\nslFoo = safeLink (Proxy :: Proxy Foo) (Proxy :: Proxy Foo1)\n</code></pre>\n\n<p>The definition of <code>slFoo</code> above gives me the error</p>\n\n<p><code>Could not deduce: IsElem' (\"1\" :&gt; Get '[HTML] String) (\"foo\" :&gt; (Foo0 :&lt;|&gt; Foo1))</code></p>\n\n<p>...which is exactly the kind of error I get when safeLink is asked to produce a link which is not in the API defined by its first parameter. The error is similar when the second parameter to <code>safeLink</code> is <code>Proxy :: Foo0</code> instead.</p>\n\n<p>I've tried many, many permutations of this and can't seem to figure it out by myself with the use of the documentation I've found. I'd appreciate some pointers that let me figure out where my misunderstanding(s) lie.</p>\n"}, {"tags": ["haskell", "generic-programming", "monomorphism-restriction"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1558904871, "last_edit_date": 1558904871, "creation_date": 1558892029, "answer_id": 56315897, "question_id": 56315140, "link": "https://stackoverflow.com/questions/56315140/inferred-generic-function-typechecks-as-a-return-type-but-not-an-argument-type/56315897#56315897", "title": "Inferred generic function typechecks as a return type but not an argument type", "body": "<p>In your second snippet, <code>op</code> is actually not polymorphic.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>shallowest p = let { op = (empty `mkQ` p) } in op\n</code></pre>\n\n<p>It is a subtle difference: <code>op</code> is in fact monomorphic, but in an open context. With the usual notation for typing judgements, the typing of <code>op</code> to the right of <code>in</code> looks as follows:</p>\n\n<pre><code> types         values\n \u2193             \u2193\n x, a, f, ...; op :: x -&gt; f a, ... |- op :: x -&gt; f a\n                                            \u2191\n                                            monotype (no \"forall\")\n\n In English: \"op has type (x -&gt; f a) in the context consisting of type variables (x, a, f, ...) and values (op :: x -&gt; f a, ...)\"\n</code></pre>\n\n<p><code>shallowest</code> is made polymorphic by a <em>generalization</em> step that happens at the toplevel. If, in a context with type variables <code>x, a, f, ...</code>, the body of <code>shallowest</code> has type <code>x -&gt; f a</code>, then we can \"close the context\" and move the type variables into the type of <code>shallowest :: forall x a f. x -&gt; f a</code>. The type derivation looks like this:</p>\n\n<pre><code>     x, a, f |- (let op = ... in op) :: x -&gt; f a\n \u2e3b\u2e3b\u2e3b\u2e3b\u2e3b\u2e3b\u2e3b\u2e3b\u2e3b\u2e3b\u2e3b\u2e3b\u2e3b (generalization)\n   |- (let op = .... in op) :: forall x a f. x -&gt; f a\n</code></pre>\n\n<p>(Things are complicated further by type classes and unification algorithms, but that's beside the point of this answer.)</p>\n\n<p>The main problem for typechecking with polymorphism is to decide when generalization should happen. There is no general solution, by lack of principal types and by undecidability. So a typechecker implementation has to make some choices.</p>\n\n<p>In Haskell, generalization happens at the following locations (the list might not be exhaustive), which are fairly natural choices:</p>\n\n<ul>\n<li><p>function definitions, i.e., <code>let</code> and toplevel bindings with at least one explicit argument (here is the monomorphism restriction);</p></li>\n<li><p>polymorphic arguments of higher-rank functions: if you have a function <code>f :: (forall a. w a) -&gt; r</code>, then <code>f x</code> is going to generalize <code>a</code> when typechecking <code>x</code>;</p></li>\n<li><p>and of course, when instructed by an explicit annotation <code>_ :: forall a. t a</code>.</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 0, "last_activity_date": 1558926387, "last_edit_date": 1558926387, "creation_date": 1558925744, "answer_id": 56319149, "question_id": 56315140, "link": "https://stackoverflow.com/questions/56315140/inferred-generic-function-typechecks-as-a-return-type-but-not-an-argument-type/56319149#56319149", "title": "Inferred generic function typechecks as a return type but not an argument type", "body": "<p>Preliminary notes: Given the evidence presented here, I will assume you are using:</p>\n\n<ul>\n<li><code>type GenericQ r = forall a . Data a =&gt; a -&gt; r</code> <a href=\"https://hackage.haskell.org/package/syb-0.7/docs/Data-Generics-Aliases.html#t:GenericQ\" rel=\"nofollow noreferrer\">from <em>syb</em></a>, and</li>\n<li><code>gmapQ :: Data a =&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; a -&gt; [u]</code> <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Data.html#v:gmapQ\" rel=\"nofollow noreferrer\">from <code>Data.Data</code></a>.</li>\n</ul>\n\n<p>Please let me know me if I'm mistaken about that. Also, any <code>forall</code>s in what follows will be written explicitly.</p>\n\n<hr>\n\n<p>There is more than meets the eye here. <a href=\"https://stackoverflow.com/a/56315897/2751851\">As Li-yao Xia suggests</a>, it is a matter of generalisation involving the type of <code>op</code>. There are three relevant facts about your first definition of <code>shallowest</code>:</p>\n\n<ol>\n<li><p><em>Before generalisation</em>, the inferred type of <code>op</code> is <code>Data d =&gt; d -&gt; f a</code>. Given the <code>Data d</code> constraint, Rule 1 of the monomorphism restriction (see <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-930004.5.5\" rel=\"nofollow noreferrer\">subsection 4.5.5 of the Report</a>) means <code>d</code> in this type cannot be generalised.</p></li>\n<li><p>In the body of <code>shallowest</code>, <code>op</code> shows up in two places. The first one is <code>op z</code>, with <code>z :: a1</code> being bound and constrained at top level by the signature of <code>shallowest</code>. The upshot is that this occurrence of <code>op</code> does <em>not</em> require generalisation of the argument type: as far as it is concerned, the type of <code>op</code> could be <code>forall f a. a1 -&gt; f a</code>, monomorphic in the type variable <code>a1</code> (I took this terminology from <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-920004.5.4\" rel=\"nofollow noreferrer\">subsection 4.5.4 of the Report</a>).</p></li>\n<li><p>The other occurrence, though, is <code>gmapQ op z</code>. <code>gmapQ</code> has a rank-2 type, requiring a polymorphic argument. That being so, this occurrence requires generalisation of the argument type of <code>op</code>, as noted at the end of Li-yao Xia's answer.</p></li>\n</ol>\n\n<p>#1 and #3 are contradictory requirements, and so you get a type error, which can be avoided either by disabling the monomorphism restriction or by demanding <code>op</code> to be polymorphic on the argument type with a signature. Thanks to the other occurrence of <code>op</code> described in #2, the situation is reported as a mismatch involving the two occurrences.</p>\n\n<hr>\n\n<p>Here follows a more minimal extended example, which might help to see what is going on. (If you are going to plop the following snippets into GHCi, besides <code>-XRankNTypes</code> you should also set <code>-XMonomorphismRestriction</code> and <code>-XNoExtendedDefaultRules</code> in order to see the same results.)</p>\n\n<p>This is a function with a rank-2 type, which will play the role of <code>gmapQ</code>:</p>\n\n<pre><code>glub :: (forall x. Show x =&gt; x -&gt; String) -&gt; String\nglub f = f 7\n</code></pre>\n\n<p>Now let's try a scenario similar to that involving <code>shallowest</code>...</p>\n\n<pre><code>foo1 :: forall a. Show a =&gt; a -&gt; String\nfoo1 x = bar x ++ glub bar\n  where\n  bar = show\n</code></pre>\n\n<p>... and there is your error:</p>\n\n<pre><code>&lt;interactive&gt;:506:23: error:\n    \u2022 Couldn't match type \u2018x\u2019 with \u2018a\u2019\n      \u2018x\u2019 is a rigid type variable bound by\n        a type expected by the context:\n          forall x. Show x =&gt; x -&gt; String\n        at &lt;interactive&gt;:506:18-25\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          foo1 :: forall a. Show a =&gt; a -&gt; String\n        at &lt;interactive&gt;:505:1-38\n      Expected type: x -&gt; String\n        Actual type: a -&gt; String\n    \u2022 In the first argument of \u2018glub\u2019, namely \u2018bar\u2019\n      In the second argument of \u2018(++)\u2019, namely \u2018glub bar\u2019\n      In the expression: bar x ++ glub bar\n    \u2022 Relevant bindings include\n        bar :: a -&gt; String (bound at &lt;interactive&gt;:508:3)\n        x :: a (bound at &lt;interactive&gt;:506:5)\n        foo1 :: a -&gt; String (bound at &lt;interactive&gt;:506:1)\n</code></pre>\n\n<p>Adding a wildcard where the signature of <code>bar</code> should go gives an additional error which is slightly more suggestive:</p>\n\n<pre><code>foo2 :: forall a. Show a =&gt; a -&gt; String\nfoo2 x = bar x ++ glub bar\n  where\n  bar :: _\n  bar = show\n</code></pre>\n\n\n\n<pre><code>\u2022 Found type wildcard \u2018_\u2019 standing for \u2018a -&gt; String\u2019\n  Where: \u2018a\u2019 is a rigid type variable bound by\n           the type signature for:\n             foo2 :: forall a. Show a =&gt; a -&gt; String\n           at &lt;interactive&gt;:511:1-38\n  To use the inferred type, enable PartialTypeSignatures\n\u2022 In the type signature: bar :: _\n  In an equation for \u2018foo2\u2019:\n      foo2 x\n        = bar x ++ glub bar\n        where\n            bar :: _\n            bar = show\n\u2022 Relevant bindings include\n    x :: a (bound at &lt;interactive&gt;:512:5)\n    foo2 :: a -&gt; String (bound at &lt;interactive&gt;:512:1)\n</code></pre>\n\n<p>Note how the wildcard \"standing for <code>a -&gt; String</code>\" is stated as a separate fact from <code>a</code> being bound by the type signature of <code>foo2</code>. I believe that corresponds to the distinction bewteen monomorphic in a type variable and polymorphic that I alluded to in point #2 above.</p>\n\n<p>Giving <code>bar</code> a polymorphic type signature makes it work:</p>\n\n<pre><code>foo3 :: forall a. Show a =&gt; a -&gt; String\nfoo3 x = bar x ++ glub bar\n  where\n  bar :: forall b. Show b =&gt; b -&gt; String\n  bar = show\n</code></pre>\n\n<p>And so does making the definition of bar pointful, which evades the monomorphism restriction by making it <a href=\"https://stackoverflow.com/q/11003535/2751851\">a \"function binding\" rather than a \"simple pattern binding\"</a>:</p>\n\n<pre><code>foo4 :: forall a. Show a =&gt; a -&gt; String\nfoo4 x = bar x ++ glub bar\n  where\n  bar x = show x\n</code></pre>\n\n<p>For the sake of completeness, it is worth noting that no constraint on the type means no monomorphism restriction:</p>\n\n<pre><code>foo5 :: forall a. Show a =&gt; a -&gt; String\nfoo5 x = bar x ++ glub bar\n  where\n  bar = const \"bar\"\n</code></pre>\n\n<p>A related situation involves using <code>bar</code> twice, but without a rank-2 function:</p>\n\n<pre><code>foo6 x y = bar x ++ bar y\n  where\n  bar = show\n</code></pre>\n\n<p>Which type will GHC infer for <code>foo6</code>?</p>\n\n<pre><code>GHCi&gt; :t foo6\nfoo6 :: Show a =&gt; a -&gt; a -&gt; [Char]\n</code></pre>\n\n<p>The arguments get the same type, as doing otherwise would require generalisation of <code>bar</code>, which requires a type signature (or pointfullness, etc.):</p>\n\n<pre><code>foo7 x y = bar x ++ bar y\n  where\n  bar :: forall a. Show a =&gt; a -&gt; String\n  bar = show\n</code></pre>\n\n\n\n<pre><code>GHCi&gt; :t foo7\nfoo7 :: (Show a1, Show a2) =&gt; a1 -&gt; a2 -&gt; [Char]\n</code></pre>\n\n<p>Since I didn't mention it yet, here is an analogue to your second <code>shallowest</code>:</p>\n\n<pre><code>foo8 :: forall a. Show a =&gt; a -&gt; String \nfoo8 x = bar x\n  where\n  bar = show\n</code></pre>\n\n<p>It is worth emphasising that <code>bar</code> is not actually being generalised here: it is monomorphic in the type variable <code>a</code>. We can still break this example, by messing with <code>foo7</code> rather than with <code>bar</code>:</p>\n\n<pre><code>foo9 = bar\n  where\n  bar :: _\n  bar = show\n</code></pre>\n\n<p>In this case, <code>bar</code> is not generalised, and neither is <code>foo</code> (now pointfree and without a signature). That means the monomorphic type variable is never resolved. In terms of Rule 2 of the monomorphism restriction, it becomes an ambiguous type variable:  </p>\n\n<pre><code>    &lt;interactive&gt;:718:14: error:\n        \u2022 Found type wildcard \u2018_\u2019 standing for \u2018a0 -&gt; String\u2019\n          Where: \u2018a0\u2019 is an ambiguous type variable\n          To use the inferred type, enable PartialTypeSignatures\n        \u2022 In the type signature: bar :: _\n          In an equation for \u2018foo9\u2019:\n              foo9\n                = bar\n                where\n                    bar :: _\n                    bar = show\n        \u2022 Relevant bindings include\n            foo9 :: a0 -&gt; String (bound at &lt;interactive&gt;:716:5)\n\n&lt;interactive&gt;:719:13: error:\n    \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018show\u2019\n      prevents the constraint \u2018(Show a0)\u2019 from being solved.\n      Relevant bindings include\n        bar :: a0 -&gt; String (bound at &lt;interactive&gt;:719:7)\n        foo9 :: a0 -&gt; String (bound at &lt;interactive&gt;:716:5)\n      Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n      These potential instances exist:\n        instance Show a =&gt; Show (ZipList a)\n          -- Defined in \u2018Control.Applicative\u2019\n        instance Show Constr -- Defined in \u2018Data.Data\u2019\n        instance Show ConstrRep -- Defined in \u2018Data.Data\u2019\n        ...plus 64 others\n        ...plus 250 instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the expression: show\n      In an equation for \u2018bar\u2019: bar = show\n      In an equation for \u2018foo9\u2019:\n          foo9\n            = bar\n            where\n                bar :: _\n                bar = show\n</code></pre>\n\n<p>Adding a type signature to <code>bar</code> in the definition of <code>foo9</code> won't help -- it just changes the point from which the error is reported. Changing <code>bar</code> to something without a constraint does eliminate the error, as it makes it possible to generalise both <code>bar</code> and <code>foo</code>.</p>\n"}], "owner": {"reputation": 2773, "user_id": 3925507, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/bXVeK.png?s=128&g=1", "display_name": "concat", "link": "https://stackoverflow.com/users/3925507/concat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1558926387, "creation_date": 1558886415, "question_id": 56315140, "link": "https://stackoverflow.com/questions/56315140/inferred-generic-function-typechecks-as-a-return-type-but-not-an-argument-type", "title": "Inferred generic function typechecks as a return type but not an argument type", "body": "<p>I'm learning about SYB and rank n types, and came across a confusing case of what seems like the monomorphism restriction.</p>\n\n<p>I wrote a function to find the shallowest entry that matches a predicate. Instead of a reducing function, I wanted to accept a more predicate-like function using <code>Alternative</code>, and transform it into a generic function myself. I decided to omit the type annotation in the <code>let</code> block to see how the monomorphism reduction would affect the type in this implementation:</p>\n\n<pre><code>shallowest :: (Alternative f, Typeable b) =&gt; (b -&gt; f a) -&gt; GenericQ (f a)\nshallowest p z =\n  let op = (empty `mkQ` p) in\n    op z &lt;|&gt; foldl (&lt;|&gt;) empty (gmapQ op z)\n</code></pre>\n\n<p>This produces an error that suggests that the ambiguity in the <code>let</code> binding prevents the typechecker from solving the constraint <code>Data a1</code>.</p>\n\n<pre><code>Error: \u2022 Couldn't match type \u2018d\u2019 with \u2018a1\u2019\n  \u2018d\u2019 is a rigid type variable bound by\n    a type expected by the context:\n      forall d. Data d =&gt; d -&gt; m a\n  \u2018a1\u2019 is a rigid type variable bound by\n    the type signature for:\n      shallowest :: (b -&gt; m a) -&gt; GenericQ (m a)\n</code></pre>\n\n<p>(Other bodies like <code>head (gmapQ op z)</code> cause an explicit error about ambiguity for the <code>let</code> binding along the lines of \"Could not deduce (Typeable a0) arising from a use of \u2018mkQ\u2019\"; I also haven't figured out why the above form doesn't).</p>\n\n<p>The type error goes away when we add an annotation in the <code>let</code> block for <code>op :: GenericQ (f a)</code> (requiring ScopedTypeVariables).</p>\n\n<p>However, I'm confused that it seems the <code>Data</code> constraint on <code>op</code> <em>can</em> be inferred: the follow typechecks when it's the return type:</p>\n\n<pre><code>shallowest p = let { op = (empty `mkQ` p) } in op\n</code></pre>\n\n<p>What's the difference? Both cases require <code>op</code> to be <code>forall d. Data d =&gt; d -&gt; f a</code>; the only difference I see is that the first is in an argument position and the second is in a return position. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1558885312, "post_id": 56314960, "comment_id": 99239035, "body": "It&#39;s a function which takes a list (whose items are the same type as <code>x</code>) and outputs the same list with <code>x</code> added at the start."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1558893913, "post_id": 56314960, "comment_id": 99241281, "body": "it&#39;s <code>(x :)</code>. Parens are essential, whitespace is optional."}], "answers": [{"tags": [], "owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "is_accepted": true, "score": 3, "last_activity_date": 1558885820, "last_edit_date": 1558885820, "creation_date": 1558885330, "answer_id": 56314986, "question_id": 56314960, "link": "https://stackoverflow.com/questions/56314960/what-does-x-mean-in-haskell/56314986#56314986", "title": "What does (x:) mean in haskell", "body": "<p>It's a function of a single argument that <code>cons</code>es <code>x</code> to some list:</p>\n\n<pre><code>(x:) [] =&gt; [x]\n(x:) [1, 2] =&gt; [x, 1, 2]\n</code></pre>\n\n<p>Here \"<code>cons</code>es\" means \"prepends a value to some list\". <code>cons</code> is the \"canonical\" name of a function that does this. So, the <code>:</code> function is the <code>cons</code> function.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1558907550, "last_edit_date": 1558907550, "creation_date": 1558885816, "answer_id": 56315057, "question_id": 56314960, "link": "https://stackoverflow.com/questions/56314960/what-does-x-mean-in-haskell/56315057#56315057", "title": "What does (x:) mean in haskell", "body": "<p>This is an effect of the <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"nofollow noreferrer\"><em>infix operator sectioning</em> [Haskell-wiki]</a>:</p>\n\n<blockquote>\n  <p><code>(2^)</code> (left section) is equivalent to <code>(^) 2</code>, or more verbosely <code>\\x -&gt; 2 ^ x</code></p>\n</blockquote>\n\n<p>So <code>(x:)</code> is short for <code>(:) x</code>, or <code>\\y -&gt; x : y</code>. The \"<em>cons</em>\" <code>(:) :: a -&gt; [a] -&gt; [a]</code> is a function that takes an element (type <code>a</code>) and a list (type <code>[a]</code>) and constructs a list with the element followed by the elements in the list.</p>\n\n<p><code>(x:) :: [a] -&gt; [a]</code> is thus a function that takes a list and prepends that list with <code>x</code>.</p>\n\n<p>We can make the fold function \"<em>point free</em>\" with:</p>\n\n<pre><code>foldr (((:) [] .) . map . (:)) [[]]\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11558305, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6YnvbDq8fNw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reKsusKnbuet6q_ITngTNEiQwyRJQ/mo/photo.jpg?sz=128", "display_name": "Jan33030", "link": "https://stackoverflow.com/users/11558305/jan33030"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 275, "favorite_count": 0, "accepted_answer_id": 56314986, "answer_count": 2, "score": 0, "last_activity_date": 1558907550, "creation_date": 1558885135, "question_id": 56314960, "link": "https://stackoverflow.com/questions/56314960/what-does-x-mean-in-haskell", "title": "What does (x:) mean in haskell", "body": "<p>What does the x: mean in this Code </p>\n\n<p><a href=\"https://stackoverflow.com/questions/24118741/implementation-of-inits-using-foldr?newreg=1c5df991e235404b9bad42fd3bd2d12f\">Implementation of inits using foldr</a></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>inits :: [a] -&gt; [[a]]\ninits = foldr ( \\ x y -&gt; [] : (map (x:) y) ) [[]]\n</code></pre>\n"}, {"tags": ["haskell", "recursion-schemes", "unfold"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558874144, "post_id": 56313431, "comment_id": 99236395, "body": "You can install the package with <code>cabal install recursion-schemes</code>."}], "answers": [{"comments": [{"owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "edited": false, "score": 0, "creation_date": 1558876134, "post_id": 56313687, "comment_id": 99236849, "body": "What is the meaning of <code>s@(_:xs)</code>?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "edited": false, "score": 1, "creation_date": 1558876199, "post_id": 56313687, "comment_id": 99236861, "body": "it is called &quot;as-pattern&quot;. <code>s</code> refers to the whole, and is simultaneously matched up with <code>(_:xs)</code>."}, {"owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "edited": false, "score": 0, "creation_date": 1558877448, "post_id": 56313687, "comment_id": 99237117, "body": "Both answers are very helpful and I wish I could accept both in a kind of shared mode. Acceptance shouldn&#39;t be binary on SO in some cases."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1570626701, "last_edit_date": 1570626701, "creation_date": 1558875223, "answer_id": 56313687, "question_id": 56313431, "link": "https://stackoverflow.com/questions/56313431/what-is-the-type-of-apomorphism-specific-to-list-and-how-is-it-implemented/56313687#56313687", "title": "What is the type of apomorphism specific to list and how is it implemented?", "body": "<p><a href=\"https://hackage.haskell.org/package/recursion-schemes-5.1.3/docs/Data-Functor-Foldable.html#v:apo\" rel=\"nofollow noreferrer\">The type is</a></p>\n\n<pre><code>apo :: (a -&gt;           Base t   (Either t  a  ))      -- g :: a -&gt; Base t r\n    -&gt;  a -&gt; t \n\napo  g  a =  rec a  where                             -- rec = apo g :: a -&gt; t\n             rec = embed . fmap (either id rec) . g  \n{-\ntype family                           Base t :: * -&gt; * \nembed                ::               Base t    t -&gt; t\nfmap (either id rec) :: Base t   r -&gt; Base t    t\n      either id rec  ::          r -&gt;           t            r ~ Either t a\n          g :: a -&gt;     Base t   r                           r ~ Either t a\nrec = apo g :: a -&gt;                                  t\n-}\n</code></pre>\n\n<p>Here <code>a</code> is the seed. For <code>t ~ [b]</code> <a href=\"https://hackage.haskell.org/package/recursion-schemes-5.1.3/docs/src/Data.Functor.Foldable.html#line-325\" rel=\"nofollow noreferrer\">we'll have</a> </p>\n\n<pre><code>type instance Base [b] = ListF b\ndata                     ListF b r = Nil | Cons b r\n\nBase t (Either t a) ~    ListF b (Either [b] a) \n                    ~                Maybe     (b, Either [b] a)\n</code></pre>\n\n<p>so overall it'll be</p>\n\n<pre><code>apoList :: (a -&gt; Maybe (b, Either [b] a)) -&gt; a -&gt; [b] \napoList coalg a = case coalg a of\n   Nothing           -&gt; []  -- (embed  Nil       )                       -- either\n   Just (b, Left bs) -&gt; b : bs   -- no more seed, no more steps to do!   --   id    $ bs\n   Just (b, Right a) -&gt; b : apoList coalg a  -- new seed, go on!         --   apo g $ a\n                     -- ^^^^^  (embed (Cons b bs))\n</code></pre>\n\n<p>so</p>\n\n<pre><code>apoTails :: [a] -&gt; [[a]]      -- [[a]] ~ [b], b ~ [a]\napoTails = apoList tailsCoalg\n  where\n  -- tailsCoalg :: [a] -&gt; Maybe ([a], Either [[a]] [a])\n  tailsCoalg []       = Just ([], Left [])\n  tailsCoalg s@(_:xs) = Just (s, Right xs)\n</code></pre>\n\n<hr>\n\n<p><em>edit:</em> a simpler <code>apoList</code> with a simpler typed coalgebra,</p>\n\n<pre><code>apoListE :: (a -&gt; Either [b] (b, a)) -&gt; a -&gt; [b] \napoListE coalg a = case coalg a of\n   Left bs      -&gt; bs             -- final tail, whether empty or non-empty \n   Right (b, a) -&gt; b : apoListE coalg a     -- new element and seed, go on!\n</code></pre>\n\n<p>seems to be easier to use:</p>\n\n<pre><code>apoTailsE :: [a] -&gt; [[a]]\napoTailsE = apoListE tailsCoalgE\n  where\n  -- tailsCoalgE :: [a] -&gt; Either [[a]] ([a], [a])\n  tailsCoalgE []       = Left [[]]\n  tailsCoalgE s@(_:xs) = Right (s, xs)\n</code></pre>\n\n<p>Looks like the two types are equivalent:</p>\n\n<pre><code>type instance Base [b] = ListF b\ndata                     ListF b r = Nil | Cons b r\n\nBase t (Either t a) ~    ListF b (Either [b] a) \n                    ~                Maybe     (b, Either [b] a)\n                    ~                              Either [b] (b, a)\n--------------------------------------------------------------------\nMaybe (b, Either [b] a)  ~  Either [b] (b, a) \n\n{ Nothing,               ~  { Left [], \n  Just (b, Left bs),          Left (b:bs), \n  Just (b, Right a)           Right (b, a)\n}                           }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "edited": false, "score": 0, "creation_date": 1558876056, "post_id": 56313690, "comment_id": 99236828, "body": "Very revealing, thank you. I was hoping to get an answer from you, since you are the author of my first code snippet. Actually, I ran across the type definition <code>(a -&gt; Base t (Either t a)) -&gt; a -&gt; t </code> but couldn&#39;t get anything out of it because of the <code>Base</code> part."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1558875241, "creation_date": 1558875241, "answer_id": 56313690, "question_id": 56313431, "link": "https://stackoverflow.com/questions/56313431/what-is-the-type-of-apomorphism-specific-to-list-and-how-is-it-implemented/56313690#56313690", "title": "What is the type of apomorphism specific to list and how is it implemented?", "body": "<p><code>Data.Functor.Foldable</code> is provided by the <em>recursion-schemes</em> package. The type of <a href=\"http://hackage.haskell.org/package/recursion-schemes-5.1.3/docs/Data-Functor-Foldable.html#v:apo\" rel=\"nofollow noreferrer\"><code>apo</code></a> there is:</p>\n\n<pre><code>apo :: Corecursive t =&gt; (a -&gt; Base t (Either t a)) -&gt; a -&gt; t \n</code></pre>\n\n<p>Here, <code>t</code> is the structure being generated by the unfold, and <code>Base t</code> is its base functor. Broadly speaking, the base functor represents one level of the recursive structure, the idea being that if we indefinitely nest it within itself we get a type equivalent to that of the whole structure -- in fact, that is precisely what <code>Fix</code> from <code>Data.Functor.Foldable</code> does. (On a meta note, there doesn't seem to be a Q&amp;A here specifically about <code>Base</code> in <em>recursion-schemes</em>; it could be useful to have one.)</p>\n\n<p><code>Base</code> for lists is:</p>\n\n<pre><code>data ListF a b = Nil | Cons a b\n</code></pre>\n\n<p>So <code>apo</code> specialises to:</p>\n\n<pre><code>apo @[_] :: (b -&gt; ListF a (Either [a] b)) -&gt; b -&gt; [a]\n</code></pre>\n\n<p>If we want to write it without using the <em>recursion-scheme</em> infrastructure, we can use the fact that <code>ListF a b</code> is isomorphic to <code>Maybe (a, b)</code>:</p>\n\n<pre><code>Nil     | Cons  a  b\nNothing | Just (a, b)\n</code></pre>\n\n<p>In terms of <code>Maybe (a, b)</code>, the signature would then become:</p>\n\n<pre><code>apoList :: (b -&gt; Maybe (a, Either [a] b)) -&gt; b -&gt; [a]\n</code></pre>\n\n<p>In the coalgebra (that is, the function argument to <code>apo</code>), <code>Nothing</code> (or <code>Nil</code>, in the <em>recursion-schemes</em> version) signal the generation of the list should be stopped by capping it with an empty tail. That is why you still need <code>Maybe</code>, even if you are also using <code>Either</code> to short-circuit the unfold in other ways.</p>\n\n<p>The implementation of this <code>apoList</code> is pretty much like the one in your question, except that this signature doesn't restrict the seed (of <code>b</code> type) to a list, and flips the roles of <code>Left</code> and <code>Right</code> (so that <code>Left</code> signals short-circuiting):</p>\n\n<pre><code>apoList :: (b -&gt; Maybe (a, Either [a] b)) -&gt; b -&gt; [a]\napoList f b = case f b of\n    Nothing -&gt; []\n    Just (x, Left e) -&gt; x : e\n    Just (x, Right c) -&gt; x : apoList f c\n</code></pre>\n"}], "owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "accepted_answer_id": 56313690, "answer_count": 2, "score": 3, "last_activity_date": 1570626701, "creation_date": 1558873065, "last_edit_date": 1558885040, "question_id": 56313431, "link": "https://stackoverflow.com/questions/56313431/what-is-the-type-of-apomorphism-specific-to-list-and-how-is-it-implemented", "title": "What is the type of apomorphism specific to list and how is it implemented?", "body": "<p>I am learning recursion schemes and it has proven very helpful to me to implement them specific to the list type. However, I got stuck on apomorphisms.</p>\n\n<p>Here is an implementation of <code>tails</code> in terms of apo I recently found:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Functor.Foldable\n\ntailsApo :: [a] -&gt; [[a]]\ntailsApo = apo coalgTails\n    where\n    coalgTails = \\case\n        [] -&gt; Cons [] (Left [])\n        li@(_:xs) -&gt; Cons li (Right xs)\n</code></pre>\n\n<p>Unfortunately, I couldn't import <code>Data.Functor.Foldable</code> with GHCi, because I get a package not found error. Another search revealed this implemenation of apo specific to lists:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>apoList :: ([b] -&gt; Maybe (a, Either [b] [a])) -&gt; [b] -&gt; [a]\napoList f b = case f b of\n    Nothing -&gt; []\n    Just (x, Left c)  -&gt; x : apoL f c\n    Just (x, Right e) -&gt; x : e\n</code></pre>\n\n<p>Obviously, <code>apoList</code>'s first argument doesn't match with <code>tailsApo</code>. I'd expext the type to be something like <code>apoList :: ([b] -&gt; Either (a, b) [a])) -&gt; [b] -&gt; [a]</code>.</p>\n\n<p>There seems to be no more beginner friendly information on this subject. I appreciate any help.</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"tags": [], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "is_accepted": false, "score": 0, "last_activity_date": 1558912196, "last_edit_date": 1558912196, "creation_date": 1558870783, "answer_id": 56313155, "question_id": 56312665, "link": "https://stackoverflow.com/questions/56312665/how-can-i-solve-this-datatype-problem-with-only-one-function-best-with-pattern-m/56313155#56313155", "title": "How can I solve this datatype problem with only one function,best with pattern matching", "body": "<p>Here's a simple solution, perhaps not efficient though. The general idea is to keep track of which tokens we've already parsed, which chars are to be added to the next <code>Text</code> token and what is left.</p>\n\n<p>First we'll call a helper function named <code>tokenize'</code> (note the single quote at the end) which takes an additional param named <code>partial</code> that is a list of accumulated chars, which are partial <code>Text</code>-type <code>Token</code>.</p>\n\n<p>When we encounter a '{' we scan the rest of the string to split on the first '}', create a <code>Placeholder</code> token and continue to process the rest of the string recursively. If we encounter any other char, we simply append it to <code>partial</code>. </p>\n\n<p>Since it's a homework assignment, I've left the implementation of <code>splitPlaceholder</code> as an exercise.</p>\n\n<pre><code>tokenize :: String -&gt; [Token]\ntokenize str = tokenize' str  []\n\npartialToText :: String -&gt; [Token]\npartialToText [] = []\npartialToText xs = [Text xs] \n\ntokenize' :: String -&gt; String -&gt; [Token]\ntokenize' [] partial  = partialToText partial\ntokenize' ('{':xs) partial  = \n      let splitted = splitPlaceholder xs\n          placeholderText = Placeholder (head splitted)\n          rest = head $ tail splitted\n          nextToken = partialToText partial\n      in nextToken ++ (placeholderText : tokenize' rest [])\ntokenize' (x:xs) partial = tokenize' xs (partial ++ [x])\n\n\n    -- split input to two parts, first is everything till the first '}' (not including)\n    -- and the second is the rest of the input string\n    splitPlaceholder :: String -&gt; [String]\n    -- implementation left as an exercise\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1558909075, "post_id": 56313320, "comment_id": 99244486, "body": "You don&#39;t need to use <code>text ++ [x]</code> <i>or</i> <code>reverse</code> - it is quite possible to build the string in order as you consume it. You mainly need to switch away from accumulator style by removing the <code>name</code> parameter."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1558942921, "post_id": 56313320, "comment_id": 99251550, "body": "@amolloy &quot;by removing the name parameter. &quot; you mean as in your solution? Certainly that&#39;s what you&#39;d do if this wasn&#39;t a small self-contained homework example. But then you would also just use parsec..."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1558953037, "post_id": 56313320, "comment_id": 99256222, "body": "Yes. Doing it efficiently isn&#39;t any more difficult, or complicated, than the inefficient solution."}], "tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": true, "score": 0, "last_activity_date": 1558873671, "last_edit_date": 1558873671, "creation_date": 1558872214, "answer_id": 56313320, "question_id": 56312665, "link": "https://stackoverflow.com/questions/56312665/how-can-i-solve-this-datatype-problem-with-only-one-function-best-with-pattern-m/56313320#56313320", "title": "How can I solve this datatype problem with only one function,best with pattern matching", "body": "<p>In the real-world, you'd probably want to use a library like Parsec. But for a homework, something like the following is probably enough:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Token = Text String\n           | Placeholder String\n             deriving (Eq, Show)\n\ntokenize :: String -&gt; [Token]\ntokenize xs = parseText \"\" xs\n\nparseText :: String -&gt; String -&gt; [Token]\nparseText text ('{':xs) = Text text : parsePlaceholder \"\" xs\nparseText text (x:xs)   = parseText (text ++ [x]) xs\nparseText text \"\"       = [Text text]\n\nparsePlaceholder :: String -&gt; String -&gt; [Token]\nparsePlaceholder name ('}':xs) = Placeholder name : parseText \"\" xs\nparsePlaceholder name (x:xs)   = parsePlaceholder (name ++ [x]) xs\nparsePlaceholder name \"\"       = [Text name]\n\nmain :: IO ()\nmain = print (tokenize \"Hallo {name}, {xyz}.\")\n</code></pre>\n\n<p>Instead of studying the code closely right away, you may want to try to copy only the type signatures of <code>parseText</code> and <code>parsePlaceholder</code> to see whether you can implement them yourself.</p>\n\n<p>A few points of critique:</p>\n\n<ul>\n<li><p>Appending to the end of a linked list (as I do with <code>text ++ [x]</code> and <code>name ++ [x]</code>) is not very efficient. A possible approach would be to prepend (with <code>(:)</code>) and then in the end do once a <code>reverse</code>.</p></li>\n<li><p><code>tokenize \"{foo}\"</code> returns <code>[Text \"\",Placeholder \"foo\",Text \"\"]</code>, which is not so nice, you may want to incorporate the following helper function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>createText \"\"   = []\ncreateText text = [Text text]\n</code></pre></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 0, "last_activity_date": 1558911008, "creation_date": 1558911008, "answer_id": 56317948, "question_id": 56312665, "link": "https://stackoverflow.com/questions/56312665/how-can-i-solve-this-datatype-problem-with-only-one-function-best-with-pattern-m/56317948#56317948", "title": "How can I solve this datatype problem with only one function,best with pattern matching", "body": "<p>Since we are writing a parser, we can benefit a great deal from using traditional parser techniques. The key point is that you want a <code>parse</code> function to parse only a part of the string at once, and so it is most convenient for it to return two things: the tokens parsed so far, and the <em>remainder</em> of the string: what's left to be parsed after handling those tokens.</p>\n\n<p>So, our main recursive function will be</p>\n\n<pre><code>parse :: String -&gt; (String, [Token])\n</code></pre>\n\n<p>This signature does not match the required signature of <code>tokenize</code>, but it is easy to write <code>tokenize</code> to delegate to it:</p>\n\n<pre><code>tokenize :: String -&gt; [Token]\ntokenize s = case parse s of\n  (\"\", r) -&gt; r\n  (s, r) -&gt; error (\"unexpected text \" ++ s)\n</code></pre>\n\n<p>Makes sense, right? If we parsed the stream and there's somehow text left, something went wrong; otherwise, the remainder is empty, so what's been parsed so far must be all of it.</p>\n\n<p><code>parse</code> itself is responsible for deciding, based on the first character it sees, whether to produce a Text or a Placeholder. In either case, it consumes the corresponding token, using <code>break</code> to identify the closing <code>}</code> (in the case of Placeholder), or the next opening <code>{</code> (in the case of Text). It conses the generated token onto the result of the recursive call to <code>parse</code>:</p>\n\n<pre><code>parse :: String -&gt; (String, [Token])\nparse \"\" = (\"\", [])\nparse ('{':s) = let (name, ('}':s')) = break (== '}') s\n                in (Placeholder name :) &lt;$&gt; parse s'\nparse s = let (text, s') = break (== '{') s\n          in (Text text :) &lt;$&gt; parse s'\n</code></pre>\n\n<p>Note that there is a hidden failure mode here, not exposed in the type signature: if the input contains a <code>{</code> character with no matching <code>}</code>, we will have a runtime error. But the signature of <code>tokenize</code> gives us little other choice: we have no way to indicate an invalid parse in the result type, so we can either lie by claiming there was a valid parse, or terminate the program abnormally; I prefer the latter.</p>\n"}], "owner": {"reputation": 257, "user_id": 11484713, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jf7y-3MrxDE/AAAAAAAAAAI/AAAAAAAAAc8/ETJ5Qy_LNVg/photo.jpg?sz=128", "display_name": "Morgen Yang", "link": "https://stackoverflow.com/users/11484713/morgen-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 56313320, "answer_count": 3, "score": 3, "last_activity_date": 1558912196, "creation_date": 1558866243, "last_edit_date": 1558871091, "question_id": 56312665, "link": "https://stackoverflow.com/questions/56312665/how-can-i-solve-this-datatype-problem-with-only-one-function-best-with-pattern-m", "title": "How can I solve this datatype problem with only one function,best with pattern matching", "body": "<p>I'm doing my Haskell Datentyp homework, and have try to solve this problem for a whole day.</p>\n\n<p>The question is like this .</p>\n\n<p>Use this Datentyp and only one function <code>tokenize</code>, other functions in the library are not permitted.</p>\n\n<pre><code>data Token = Text String\n           | Placeholder String\n             deriving (Eq, Show)\n\ntokenize :: String -&gt; [Token]\n</code></pre>\n\n<p>The brace is the sign of Placeholder</p>\n\n<p>The result should like this:\nwhen we give input<code>\"Hallo {name}, {xyz}.\"</code></p>\n\n<p>should give <code>[Text \"Hallo \", Placeholder \"name\", Text \", \", Placeholder \"xyz\", Text \".\"]</code> out</p>\n\n<hr>\n\n<p>I have tried for a whole day, only Text output or Placehold is OK, but I have several problems:</p>\n\n<ol>\n<li><p>How to handle curly brackets {}</p></li>\n<li><p>How to use pattern match to match \"{longtext...}\"</p></li>\n<li><p>Because of Datentype <code>[token]</code>,  <code>tokenize (x: xs) = x :[ Text (xs:[])]</code> do not works , so how to deal with it</p></li>\n<li><p>how to combine the comma and all of them together, with only type <code>[token]</code> result function,I have tried ++ and : , but they all report error.</p></li>\n<li><p>According to 4, there is a common question besides this homework: when using Datentype, and type of result doesn't fits type of input,  how to use recursion.</p></li>\n</ol>\n\n<hr>\n\n<p>This is the last edition of my answer, it is still far away</p>\n\n<pre><code>data Token = Text String\n           | Placeholder String\n             deriving (Eq, Show)\n\ntokenize :: String -&gt; [Token]\ntokenize [] = []\ntokenize ('{':x:xs) = [ Placeholder (x:xs)]\ntokenize (x: xs) = [ Text (x:xs)]\notherwise = error \"TODO: Implementierung vervollstaendigen\"\n\n</code></pre>\n\n<p>The result should like this:\nwhen we give input<code>\"Hallo {name}, {xyz}.\"</code></p>\n\n<p>should give <code>[Text \"Hallo \", Placeholder \"name\", Text \", \", Placeholder \"xyz\", Text \".\"]</code> out</p>\n\n<hr>\n\n<p><strong>Suppose all the input without internal bracket and are correctly denoted by curly brackets{}</strong></p>\n"}, {"tags": ["haskell", "types", "undefined", "forall", "type-signature"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 8, "creation_date": 1558855790, "post_id": 56311510, "comment_id": 99232781, "body": "First off, <code>undefined</code> is not a function. But if you&#39;re still a beginner, I&#39;d just pretend the type is <code>undefined :: a</code>. The rest is advanced magic."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1558857811, "post_id": 56311510, "comment_id": 99233144, "body": "Related: <a href=\"https://stackoverflow.com/questions/49986342/why-is-the-undefined-function-levity-polymorphic-when-using-it-with-unboxed-type\" title=\"why is the undefined function levity polymorphic when using it with unboxed type\">stackoverflow.com/questions/49986342/&hellip;</a> <a href=\"https://stackoverflow.com/questions/35318562/what-is-levity-polymorphism\" title=\"what is levity polymorphism\">stackoverflow.com/questions/35318562/&hellip;</a>"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1558863834, "post_id": 56311510, "comment_id": 99234330, "body": "I see I need to revise my comment: <code>undefined</code> is not a function at the language (user) level. However, due to the class constraint <code>HasCallStack =&gt;</code> it is implemented as a function internally."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1558863858, "post_id": 56311510, "comment_id": 99234333, "body": "If you were looking for something like JavaScript&#39;s <code>undefined</code> or Java&#39;s <code>null</code>, you probably want to use <code>Data.Maybe</code>. A good introduction is <a href=\"http://learnyouahaskell.com/modules\" rel=\"nofollow noreferrer\">learnyouahaskell.com/modules</a>"}], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1558900535, "post_id": 56314395, "comment_id": 99242887, "body": "I would be really interested in a thorough answer to the question, if only to see how long it would have to be. This is really a pretty embarrassing situation..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1558892137, "last_edit_date": 1558892137, "creation_date": 1558880967, "answer_id": 56314395, "question_id": 56311510, "link": "https://stackoverflow.com/questions/56311510/what-does-type-signature-for-undefined-mean-in-haskell/56314395#56314395", "title": "What does type signature for `undefined` mean in Haskell?", "body": "<p>For all regards a beginner needs to know, the signature is simply</p>\n\n<pre><code>undefined :: a\n</code></pre>\n\n<p>which means, as always with type variables (i.e. any lowercase letters) that <code>a</code> is <a href=\"https://en.wikipedia.org/wiki/Universal_quantification\" rel=\"nofollow noreferrer\">universally quantified</a>, which can also be made explicit:</p>\n\n<pre><code>{-# LANGUAGE ExplicitForall #-}\nundefined :: forall a. a\n</code></pre>\n\n<p>...or, as I prefer to write it</p>\n\n<pre><code>{-# LANGUAGE ExplicitForall, UnicodeSyntax #-}\nundefined :: \u2200 a. a\n</code></pre>\n\n<p>The quantification is infered to be over <em>all types</em>, i.e. all things with kind <code>*</code> (read: \u201ctype\u201d, more accurate <em>the kind of lifted types</em> \u2013 lifted meaning it can be lazy thunk). Therefore, you can use <code>undefined</code> in any expression, no matter what type is required.</p>\n\n<p>Now, <code>undefined</code> is of course a \u201cpartial function\u201d like thing, basically a function which zero arguments which is defined nowhere. (FTR, it's <em>not</em> a function, as a function by definition <em>has</em> argument[s].)\n<br>You'd like to get a <em>useful</em> error message when it is actually evaluated, but GHC doesn't by default produce a call stack for everything (for performance reasons), so it used to be the case that the error message was almost completely useless. That's where the <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Stack.html#t:HasCallStack\" rel=\"nofollow noreferrer\"><code>HasCallStack</code></a> comes in: that's a constraint which essentially tells the context in which some code might incur <code>undefined</code> that it should note the place where it happens, in order for the error message to actually show it up. So,</p>\n\n<pre><code>undefined :: \u2200 a. HasCallStack =&gt; a\n</code></pre>\n\n<p>It's a bit confusing that the <code>HasCallStack</code> appears after the <code>\u2200 a</code> \u2013 this doesn't really have anything to do with <code>a</code> but with the context in which <code>undefined</code> will be used. Just, the form of signatures is always</p>\n\n<pre><i>Identifier</i> :: <i>Quantifiers</i>. <i>Constraints</i> => <i>Type</i></pre>\n\n<p>and <code>HasCallStack</code> is a constraint, that's why it appears in the middle. (More often, constraints actually apply to one of the type variables you've quantified over.)</p>\n\n<p>Finally, this <code>RunTimeRep</code> stuff is about <em>levity polymorphism</em>. I don't really understand that myself, but it's discussed in <a href=\"https://stackoverflow.com/questions/49986342/why-is-the-undefined-function-levity-polymorphic-when-using-it-with-unboxed-type\">Why is the undefined function levity-polymorphic when using it with unboxed types?</a></p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1558958594, "post_id": 56317845, "comment_id": 99258975, "body": "what does <code>Int</code> in <code>IntRep</code> stand for, is it &quot;int&quot; or &quot;internal&quot; (or something else)? i.e. what is the kind of <code>Double#</code>, is it <code>TYPE &#39;DoubleRep</code>? is <code>TYPE &#39;LiftedRep</code> in <code>(Int :: TYPE &#39;LiftedRep)</code> the <i>kind</i> of <code>Int</code>? if not, what is it? thanks."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1558981522, "post_id": 56317845, "comment_id": 99268700, "body": "@WillNess The <code>Int</code> in <code>IntRep</code> indeed stands for &quot;integer&quot;. The kind of <code>Double#</code> is  <code>TYPE &#39;DoubleRep</code>, yes, and the kind of <code>Int</code> (and of <code>Bool</code> and of <code>Char</code>...) is <code>TYPE &#39;LiftedRep</code>. The <code>TYPE &#39;LiftedRep</code> kind usually appears in type signatures as <code>Type</code> (or <code>*</code>). The GHC User Guide has more information: <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#levity-polymorphism\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 5, "last_activity_date": 1558943799, "last_edit_date": 1558943799, "creation_date": 1558909800, "answer_id": 56317845, "question_id": 56311510, "link": "https://stackoverflow.com/questions/56311510/what-does-type-signature-for-undefined-mean-in-haskell/56317845#56317845", "title": "What does type signature for `undefined` mean in Haskell?", "body": "<p>This is a continuation of @leftaroundabout's answer.</p>\n\n<p>In Haskell, values have types. But types <em>themselves</em> also have types. When a type is acting as the type of another type, we call it a \"kind\".</p>\n\n<p>The most important and common kind in Haskell is <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Kind.html#t:Type\" rel=\"nofollow noreferrer\"><code>Type</code></a>, often denoted in signatures as <code>*</code>. It is the kind of types that are \"lifted\", that is, whose values can be thunks that, when evaluated, can diverge, throw an error, etc... For example the type <code>Int</code> has kind <code>Type</code>.</p>\n\n<p>There are also other types like <a href=\"http://hackage.haskell.org/package/ghc-prim-0.5.3/docs/GHC-Prim.html#g:3\" rel=\"nofollow noreferrer\"><code>Int#</code></a> that are <em>not</em> lifted. A value of type <code>Int#</code> is <em>never</em> a thunk, it's always an actual value in memory.</p>\n\n<p>In short, the in-memory representation of values is <em>controlled</em> by their type's kind.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/ghc-prim-0.5.3/docs/GHC-Types.html#t:RuntimeRep\" rel=\"nofollow noreferrer\"><code>RuntimeRep</code></a> is another kind. It is the kind of types like <code>LiftedRep</code> and <code>IntRep</code>. These types don't have any values, they exist merely to <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html?highlight=datakinds#extension-DataKinds\" rel=\"nofollow noreferrer\">express things at the type level</a>, as we shall see.</p>\n\n<p>There is a super-magical type-level entity called <a href=\"http://hackage.haskell.org/package/ghc-prim-0.5.3/docs/GHC-Types.html#t:TYPE\" rel=\"nofollow noreferrer\"><code>TYPE</code></a> that, when parameterized with a type of kind <code>RuntimeRep</code> (that is with a type that describes an in-memory representation) returns the kind of types whose values have that representation. For example, <code>Type</code> is <code>TYPE LiftedRep</code>, while the kind of <code>Int#</code> is <code>TYPE IntRep</code>.</p>\n\n<pre><code>ghci&gt; :set -XMagicHash\nghci&gt; import GHC.Prim \nghci&gt; import GHC.Types\nghci&gt; import Data.Kind\nghci&gt; :kind (Int :: TYPE 'LiftedRep)\n(Int :: TYPE 'LiftedRep) :: *\nghci&gt; :kind Int#\nInt# :: TYPE 'IntRep\n</code></pre>\n\n<p>Now we can get back to why <code>undefined</code> has such a weird signature. The thing is, we want to be able to use <code>undefined</code> in <em>all</em> functions, be it functions that return types of kind <code>Type</code>, but also functions that return types of kind <code>TYPE IntRep</code> (in other words: the <code>Int#</code> type) or functions that return another unlifted type. Otherwise, we would need multiple different versions of <code>undefined</code>, which would be annoying.</p>\n\n<p>The solution is to make <code>undefined</code> <em>levity-polymorphic</em>. The signature says: for any possible in-memory representation (<code>RuntimeRep</code>) and for any possible <em>type</em> whose values have that representation, <code>undefined</code> counts a member of that type.</p>\n"}], "owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 0, "accepted_answer_id": 56314395, "answer_count": 2, "score": 7, "last_activity_date": 1558943799, "creation_date": 1558855442, "last_edit_date": 1558866211, "question_id": 56311510, "link": "https://stackoverflow.com/questions/56311510/what-does-type-signature-for-undefined-mean-in-haskell", "title": "What does type signature for `undefined` mean in Haskell?", "body": "<p>I am a beginner in Haskell and I am taken aback by the <code>undefined</code> function's type signature.</p>\n\n<p>I expected something more simple, but I found this on Hackage:</p>\n\n<pre><code>undefined :: forall (r :: RuntimeRep). forall (a :: TYPE r). HasCallStack =&gt; a\n</code></pre>\n\n<blockquote>\n  <p>A special case of error. It is expected that compilers will recognize this and insert error messages which are more appropriate to the context in which <code>undefined</code> appears.</p>\n</blockquote>\n\n<p>Could you please explain what does this signature mean?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "state-monad"], "comments": [{"owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "edited": false, "score": 0, "creation_date": 1558824723, "post_id": 56309032, "comment_id": 99228805, "body": "Did you read any tutorials such as <a href=\"https://wiki.haskell.org/State_Monad\" rel=\"nofollow noreferrer\">this one</a> or <a href=\"https://mmhaskell.com/monads-5\" rel=\"nofollow noreferrer\">this one</a>? What point did you get stuck at? Did you look at the <a href=\"https://www.stackage.org/haddock/lts-13.23/transformers-0.5.6.2/Control-Monad-Trans-State-Strict.html\" rel=\"nofollow noreferrer\">haddock</a> documentation? Related: <a href=\"https://stackoverflow.com/q/14516835/2682729\">Stuck in the State Monad</a>"}, {"owner": {"reputation": 392, "user_id": 1893075, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82c678be91d3694aefb5e9a2dd69aa80?s=128&d=identicon&r=PG&f=1", "display_name": "Bilentor", "link": "https://stackoverflow.com/users/1893075/bilentor"}, "reply_to_user": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "edited": false, "score": 0, "creation_date": 1558825328, "post_id": 56309032, "comment_id": 99228894, "body": "I did read some tutorials and various references. I think I understand how to implement a simple counter but not sure how to use it in my function. (edited the post with a little more clarification)"}], "answers": [{"tags": [], "owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "is_accepted": true, "score": 4, "last_activity_date": 1558828747, "last_edit_date": 1558828747, "creation_date": 1558826223, "answer_id": 56309452, "question_id": 56309032, "link": "https://stackoverflow.com/questions/56309032/unique-id-counter-in-haskell/56309452#56309452", "title": "Unique id/counter in Haskell", "body": "<p>So the return type needs to have a <code>State Int</code> in it, it can't be <code>String</code>. The key thing is that you need to thread the State through. Here, I've used <code>do</code> notation as you seem comfortable with it.</p>\n\n<pre><code>counter :: State Int Int\ncounter = do\n    n &lt;- get\n    put (n + 1)\n    pure n\n\ngenerateASM :: AST.Expr -&gt; State Int String\ngenerateASM (AST.BinOpExpr AST.Or e1 e2) = do\n    e1ASM &lt;- generateASM e1\n    n &lt;- counter\n    e2ASM &lt;- generateASM e2\n    pure $\n        e1ASM ++\n        \"    cmpl    $0, %eax\\n\" ++\n        \"    je      _or_clause\" ++ show n ++ \"\\n\" ++\n        \"    movl    $1, %eax\\n\" ++\n        \"    jmp     _or_end\" ++ show n ++ \"\\n\" ++\n        \"_or_clause\" ++ show n ++ \":\\n\" ++ show n ++\n        e2ASM ++\n        \"    cmpl    $0, %eax\\n\" ++\n        \"    movl    $0, %eax\\n\" ++\n        \"    setne   %al\\n\" ++\n        \"_or_end\" ++ show n ++ \":\\n\"\ngenerateASM (..) = .. -- other branches defined similarly...\n\ngenerateASMFull :: AST.Expr -&gt; String\ngenerateASMFull e = evalState (generateASM e) 0\n</code></pre>\n\n<p>P.S. I haven't checked if your assembly logic is correct.</p>\n"}], "owner": {"reputation": 392, "user_id": 1893075, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82c678be91d3694aefb5e9a2dd69aa80?s=128&d=identicon&r=PG&f=1", "display_name": "Bilentor", "link": "https://stackoverflow.com/users/1893075/bilentor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 56309452, "answer_count": 1, "score": -1, "last_activity_date": 1558828747, "creation_date": 1558821313, "last_edit_date": 1558825617, "question_id": 56309032, "link": "https://stackoverflow.com/questions/56309032/unique-id-counter-in-haskell", "title": "Unique id/counter in Haskell", "body": "<p>I am trying to generate some assembly instructions in Haskell and need to generate some unique ids to label sections for <code>jmp</code> instructions. I believe I could do this using a state monad but I am still new to Haskell and not super comfortable with State monad and need some help using it in this context.</p>\n\n<p>Here is one of the examples where I'd need a unique id</p>\n\n<pre><code>generateExpression :: AST.Expr -&gt; String\ngenerateExpression (AST.BinOpExpr AST.Or e1 e2) =\n            (generateExpression e1) ++\n            \"    cmpl    $0, %eax\\n\" ++\n            \"    je      _or_clause2\\n\" ++\n            \"    movl    $1, %eax\\n\" ++\n            \"    jmp     _or_end\\n\" ++\n            \"_or_clause2:\\n\" ++           -- need to use a unique id here instead of clause 2\n            (generateExpression e2) ++\n            \"    cmpl    $0, %eax\\n\" ++\n            \"    movl    $0, %eax\\n\" ++\n            \"    setne   %al\\n\" ++\n            \"_or_end:\\n\"                  -- need to use a unique id here to label the end\n</code></pre>\n\n<p>Edit: I have read some tutorials on State Monad and can implement a simple counter such as</p>\n\n<pre><code>import Control.Monad.State\n\ncounter :: State Int Int\ncounter = do\n    x &lt;- get\n    put (x+1)\n    return x\n\nrunState counter 1 -- outputs (1,2) where the state has been incremented\n</code></pre>\n\n<p>which would keep track of a counter as the state. But I am not sure how to use this in my function where I need to keep a state around in recursive calls.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1558794373, "post_id": 56305698, "comment_id": 99221978, "body": "It means that the <code>(1, ...)</code> elements are from the first operand, and the <code>(2, ...)</code> from the second operand."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1558794419, "post_id": 56305698, "comment_id": 99221990, "body": "In an <code>Either a b</code>, with <code>a</code> and <code>b</code> the sets, <code>(1, ...)</code> is <code>Left</code>, and <code>(2, ...)</code> is <code>Right</code>. It shows that although the <i>heart</i> occurs in both sets, we make a distinction between the left and right, so <code>Left Heart</code> is not the same as <code>Right Heart</code>."}], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 6, "last_activity_date": 1558806499, "creation_date": 1558806499, "answer_id": 56307312, "question_id": 56305698, "link": "https://stackoverflow.com/questions/56305698/why-are-here-1-and-2-in-this-disjoint-union/56307312#56307312", "title": "Why are here 1 and 2 in this disjoint union", "body": "<p>A disjoint union must have some way to keep the elements from the two sets distinct. This is accomplished here by <em><a href=\"https://en.m.wikipedia.org/wiki/Tagged_union\" rel=\"noreferrer\">tagging</a></em> each element with a number that represents the set it came from. So, in the disjoint union of <code>{ a, b }</code> with <code>{ a, c, d }</code>, which you can write as <code>{(1, a), (1, b), (2, a), (2, c), (2, d)}</code>, <code>(1, a)</code> represents the <code>a</code> from the first set and <code>(2, a)</code> represents the <code>a</code> from the second set.</p>\n\n<p>In Haskell, we use <em>data constructors</em> to construct (values of) <em>sum types</em> to represent tagged unions, and <code>Either A B</code> is the disjoint union of the types <code>A</code> and <code>B</code>.</p>\n"}], "owner": {"reputation": 257, "user_id": 11484713, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jf7y-3MrxDE/AAAAAAAAAAI/AAAAAAAAAc8/ETJ5Qy_LNVg/photo.jpg?sz=128", "display_name": "Morgen Yang", "link": "https://stackoverflow.com/users/11484713/morgen-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 56307312, "answer_count": 1, "score": 2, "last_activity_date": 1558806499, "creation_date": 1558794303, "last_edit_date": 1558794443, "question_id": 56305698, "link": "https://stackoverflow.com/questions/56305698/why-are-here-1-and-2-in-this-disjoint-union", "title": "Why are here 1 and 2 in this disjoint union", "body": "<p>I study the usage of Either in haskell,</p>\n\n<p>It's a example in our course, but I don't understand why 1 and 2 instead of each element in each set.</p>\n\n<p><img src=\"https://i.stack.imgur.com/gsXmJ.png\" alt=\"the image of problem\"></p>\n\n<p>Thank you</p>\n"}, {"tags": ["macos", "haskell", "ghc", "ffi"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1558800439, "post_id": 56305512, "comment_id": 99223543, "body": "The symbol is not exported with GHC 8.0.2, either. GHC exports <code>_my_square</code> from <code>Main.o</code>, always. When the <code>Main</code> executable is linked, that symbol gets added to it. Newer GHC passes <code>-dead-strip</code> to the linker, which cleans the non-exported <code>_my_square</code> symbol out. Older GHC doesn&#39;t, so it leaves the symbol there, even though it isn&#39;t correctly exported. GHC appears to be hardcoded to export no symbols from an executable. Perhaps file a bug to change that? Any answer to this question will probably be uglier than having GHC do it for you."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 1, "last_activity_date": 1558922562, "creation_date": 1558922562, "answer_id": 56318844, "question_id": 56305512, "link": "https://stackoverflow.com/questions/56305512/how-do-i-compile-a-haskell-mach-o-executable-that-exports-a-symbol/56318844#56318844", "title": "How do I compile a Haskell Mach-O executable that exports a symbol?", "body": "\n\n<p>Going off what I said in my comment, neither version of GHC you tested actually exports <code>_my_square</code> from <code>Main</code>. Instead, they export <code>_my_square</code> from <code>Main.o</code> (this is why you can use <code>ghc</code> to compile and link a <code>.c</code> file that uses <code>my_square</code>). When <code>Main.o</code> is linked into the final <code>Main</code> executable, neither GHC tells the linker to export <code>_my_square</code>. GHC 8.6.4 (and, I think, since 8.2) tells the linker to strip unused, unexported symbols, so  <code>_my_square</code> evaporates. GHC 8.0.2 does not, leaving <code>_my_sqaure</code> in the <code>Main</code> executable purely by accident.</p>\n\n<p>You can tell GHC to tell the linker to keep the symbol. The linker option for this is <code>-exported_symbol &lt;symbol&gt;</code>. My GHC actually invokes the linker through <code>gcc</code>, so I have to wrap those two arguments with <code>-Wl</code>. For whatever reason, passing that option to the GHC actually compiling <code>Main.hs</code> causes an error; you have to make <code>Main.o</code> with one bare GHC invocation and then call GHC again to link it into <code>Main</code>, this time with the linker options. Maybe this is peculiar to my system\u2014you may experiment to find a better way.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ ghc -c Main.hs\n# Makes Main.hi Main.o Main_stub.h\n$ ghc -optl-Wl,-exported_symbol -optl-Wl,_my_square Main.o -o Main\n# Makes Main\n$ objdump -t Main | grep _my_square\n0000000100000dc0 g     F __TEXT,__text  _my_square\n</code></pre>\n\n<p>I would still recommend filing a GHC issue to make this easier.</p>\n"}], "owner": {"reputation": 43, "user_id": 2562860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/338de63a1eb63a52ae1a2a334f4ac7c7?s=128&d=identicon&r=PG", "display_name": "timds", "link": "https://stackoverflow.com/users/2562860/timds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 56318844, "answer_count": 1, "score": 4, "last_activity_date": 1558922562, "creation_date": 1558792746, "last_edit_date": 1558793047, "question_id": 56305512, "link": "https://stackoverflow.com/questions/56305512/how-do-i-compile-a-haskell-mach-o-executable-that-exports-a-symbol", "title": "How do I compile a Haskell Mach-O executable that exports a symbol?", "body": "<p>How do I compile a Haskell <em>executable</em> (not a library) using GHC >=8.2.1 (preferably on 8.6.*) on macOS 10.14.5 that successfully <code>foreign export</code>s a function (i.e. exposes it as a public symbol in the binary)? This works in GHC 8.0.2 but not in later versions.</p>\n\n<p>I've tried this on ghc 8.0.2 (via stack), 8.2.2 (via both nix and stack), 8.4.4 (via both nix and stack), and 8.6.4 (via both nix and stack). Only 8.0.2 works. I know that 8.2 introduced this change: <code>GHC will now use ld.gold or ld.lld instead of the system\u2019s default</code>ld<code>, if available.</code> But I am unclear whether 8.0.2 would use a different 'system default' ld in the first place (darwin's ld as opposed to llvm's lld?). I know of ghc's <code>-pgml [ld-program-here]</code> option to set the linker but I haven't been able to manually set it to anything that has successfully compiled and linked anything to test further.</p>\n\n<p>I have this file <code>Main.hs</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Main where\n\nimport Foreign.C\n\nforeign export ccall \"my_square\" my_square :: CInt -&gt; CInt\n\nmy_square :: CInt -&gt; CInt\nmy_square x = x * x\n\nmain :: IO ()\nmain = putStrLn \"FFI Test\"\n</code></pre>\n\n<p>With ghc 8.0.2: </p>\n\n<pre><code>&gt; rm Main.hi Main.o &amp;&amp; ghc-8.0.2 Main.hs &amp;&amp; nm -g Main | grep my_square\n[1 of 1] Compiling Main             ( Main.hs, Main.o )\n[some apparently unrelated clang warnings]\nLinking Main ...\n[further clang warnings]\n2544:0000000100001260 T _my_square\n</code></pre>\n\n<p>With ghc 8.6.4, the symbol doesn't seem to be exported, so future attempts to link another program with this symbol fail.</p>\n\n<pre><code>&gt; rm Main.hi Main.o &amp;&amp; ghc-8.6.4 Main.hs &amp;&amp; nm -g Main | grep my_square\n[1 of 1] Compiling Main             ( Main.hs, Main.o )\nLinking Main ...\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching", "non-exhaustive-patterns", "guard-clause"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1558766940, "post_id": 56301307, "comment_id": 99216234, "body": "Side note: you can replace the main body of <code>converter</code> with <code>if ((0&lt;=x) &amp;&amp; (x&lt;10)) then show x else z</code>. <code>show</code> is a useful function from the main library which can convert most non-string values into strings."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1558785681, "post_id": 56301307, "comment_id": 99219921, "body": "Remember to turn on warnings, so to discover these issues at compile time. If you have a list of guards <code>| condition = something | condition2 = something | ...</code> the last one should be <code>... | otherwise = something</code> to be sure of catching all the remaining cases."}], "answers": [{"comments": [{"owner": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "edited": false, "score": 0, "creation_date": 1558752987, "post_id": 56301327, "comment_id": 99214443, "body": "Works. Just to clarify, when I do <code>&quot;-&quot; ++ (converter x)</code>, what exactly is it passing to <code>converter</code> then to make my code fail? I thought putting it in brackets <code>(converter x)</code> would just pass <code>x</code> to converter, and then add the <code>-</code>? Yup. Just to learn and get used to Haskell programming."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "edited": false, "score": 2, "creation_date": 1558753211, "post_id": 56301327, "comment_id": 99214458, "body": "@user2719875 It does just pass <code>x</code> to converter. The problem is that <code>x</code> is negative in that case, and <code>converter</code> doesn&#39;t work on negative numbers."}, {"owner": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "edited": false, "score": 0, "creation_date": 1558753360, "post_id": 56301327, "comment_id": 99214475, "body": "Ohhhhh. Got it. So what exactly does <code>x &lt; 0 = &#39;-&#39; : converter (-x)</code> do? I haven&#39;t learned syntax of <code>:</code> yet. I&#39;m guessing it remove the <code>-</code> temporarily? Thanks in advance."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "edited": false, "score": 1, "creation_date": 1558753470, "post_id": 56301327, "comment_id": 99214486, "body": "@user2719875 <code>&#39;-&#39; :</code> does the exact same thing as <code>&quot;-&quot; ++</code>. <code>:</code> just lets you add one element at a time more efficiently than <code>++</code>."}, {"owner": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "edited": false, "score": 1, "creation_date": 1558753632, "post_id": 56301327, "comment_id": 99214500, "body": "Ok, so <code>converter (-x)</code> is basically what solves the problem, right? The line <code>x &lt; 0 = &#39;-&#39; : converter (-x)</code> says, if <code>x &lt; 0</code> i.e. a negative integer, then pass it as an argument to <code>converter</code> After negating it (<code>converter (-x)</code>), to make it positive when passing it to <code>converter</code>. Is my understanding right?"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "edited": false, "score": 0, "creation_date": 1558753653, "post_id": 56301327, "comment_id": 99214503, "body": "@user2719875 Yes."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "edited": false, "score": 1, "creation_date": 1558806948, "post_id": 56301327, "comment_id": 99225202, "body": "@user2719875  If you look at the definition of <code>(++)</code>, you&#39;ll find the relevant case to be <code>(x:xs) ++ ys = x : xs ++ ys</code>, and <code>&quot;-&quot;</code> is the same thing as <code>&#39;-&#39;:[]</code>, so <code>&quot;-&quot; ++ converter x</code> is equivalent to <code>&#39;-&#39; : converter x</code>, which prepends a <code>&#39;-&#39;</code> to the result of <code>converter x</code>."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 6, "last_activity_date": 1558752721, "creation_date": 1558752721, "answer_id": 56301327, "question_id": 56301307, "link": "https://stackoverflow.com/questions/56301307/non-exhaustive-patterns-in-function-error-when-appending-value-before-function/56301327#56301327", "title": "&quot;Non-exhaustive patterns in function&quot; error when appending value before function call", "body": "<p>The problem is that <code>converter</code> is only defined for nonnegative numbers. You prepend a <code>\"-\"</code> when it's negative, but you forgot to invert the actual number you pass to it. Try this instead:</p>\n\n<pre><code>negOrPosConverter :: NegOrPosInteger -&gt; String\nnegOrPosConverter (ActualInt x)\n    | x &gt;= 0 = converter x\n    | x &lt; 0 = '-' : converter (-x)\n</code></pre>\n\n<p>Note <code>converter (-x)</code> instead of <code>converter x</code>.</p>\n\n<hr>\n\n<p>Also, if this isn't just for practice, note that the <code>show</code> function already exists in Prelude to convert numbers (and lots of other things too) into strings.</p>\n"}], "owner": {"reputation": 14927, "user_id": 2719875, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ae764a4524119ce0d93e7d8f0ee2356c?s=128&d=identicon&r=PG&f=1", "display_name": "user2719875", "link": "https://stackoverflow.com/users/2719875/user2719875"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 56301327, "answer_count": 1, "score": 1, "last_activity_date": 1558793212, "creation_date": 1558752334, "last_edit_date": 1558793212, "question_id": 56301307, "link": "https://stackoverflow.com/questions/56301307/non-exhaustive-patterns-in-function-error-when-appending-value-before-function", "title": "&quot;Non-exhaustive patterns in function&quot; error when appending value before function call", "body": "<p>I'm not sure what I'm not handling. Suppose I have a function, that converts an integer to a string. Call it <code>converter</code>.</p>\n\n<p>Now, to convert position integer to string, I just call <code>converter</code>. To convert a negative integer to string, I append <code>-</code> to the <code>converter</code> call.</p>\n\n<p>This is my code:</p>\n\n<pre><code>converter :: Integer -&gt; String\nconverter x\n    | x == 0 = \"0\"\n    | x == 1 = \"1\"\n    | x == 2 = \"2\"\n    | x == 3 = \"3\"\n    | x == 4 = \"4\"\n    | x == 5 = \"5\"\n    | x == 6 = \"6\"\n    | x == 7 = \"7\"\n    | x == 8 = \"8\"\n    | x == 9 = \"9\"\n    | x &gt; 9 = z\n    where\n    (a, b) = divMod x 10\n    z = (converter a) ++ (converter b)\n\nnegOrPosConverter :: NegOrPosInteger -&gt; String\nnegOrPosConverter (ActualInt x)\n    | x &gt;= 0 = converter x\n    | x &lt; 0 = \"-\" ++ (converter x)\n</code></pre>\n\n<p>When I run the code and try <code>negOrPosConverter (ActualInt (-200))</code> I get this error:</p>\n\n<pre><code>\"-*** Exception: theConverter.hs:(19,1)-(27,32): Non-exhaustive patterns in function converter\n</code></pre>\n\n<p>Any idea why?</p>\n"}, {"tags": ["haskell", "runtime-error", "ghc"], "comments": [{"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 3, "creation_date": 1558733624, "post_id": 56299642, "comment_id": 99211694, "body": "Do you see a difference between <code>runhaskell Fail2</code> and <code>runhaskell Fail2.hs</code>? Once you&#39;ve built a <code>Fail2</code> executable, <code>runhaskell</code> might be trying to interpret it as a Haskell source file."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1558746653, "post_id": 56299642, "comment_id": 99213823, "body": "Do you have any better luck with GHC 8.6.5?"}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "reply_to_user": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1558776378, "post_id": 56299642, "comment_id": 99218064, "body": "Trying the one with access violation on a Linux machine gives me <code>Fail2:1:1: error: lexical error at character &#39;\\DEL&#39;</code> followed by some binary garbage. I think @user11228628 &#39;s guess is pretty accurate."}], "answers": [{"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1558953047, "post_id": 56307029, "comment_id": 99256225, "body": "I see there&#39;s a new release of Haskell Platform available. Installing this fixes the issue. Thanks for the tip!"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 1, "creation_date": 1559085928, "post_id": 56307029, "comment_id": 99307399, "body": "Is the particular issue on the GHC bug tracker?"}, {"owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "reply_to_user": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 1, "creation_date": 1559138856, "post_id": 56307029, "comment_id": 99328368, "body": "@JeremyList: I have no idea. And I don&#39;t know how to check it, other than manually searching through hundreds of issues."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1559143562, "post_id": 56307029, "comment_id": 99331036, "body": "I did take a look at the release notes, and didn&#39;t see anything about such a bug having been fixed..."}], "tags": [], "owner": {"reputation": 6159, "user_id": 754705, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/942fe51aac5dc523f0305439fa9a6e3d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/754705/michael"}, "is_accepted": true, "score": 4, "last_activity_date": 1558804328, "creation_date": 1558804328, "answer_id": 56307029, "question_id": 56299642, "link": "https://stackoverflow.com/questions/56299642/haskell-program-hangs-when-mixing-compiled-and-interpreted-code/56307029#56307029", "title": "Haskell program hangs when mixing compiled and interpreted code", "body": "<p><strong>This is a bug in GHC and it has been fixed in GHC 8.6.4.</strong></p>\n\n<p>I have tested it with GHC 8.6.3, GHC 8.6.4 and GHC 8.6.5 and the latter two versions work as expected.</p>\n\n<p>I used the x64 Windows <a href=\"https://www.stackage.org/\" rel=\"nofollow noreferrer\">haskell stack</a>, and I'm running Windows 10 with all updates installed (as of 2019-05-25.)</p>\n\n<p>(For all GHC versions: wether I write <code>runhaskell Fail2</code> or <code>runhaskell Fail2.hs</code> doesn't make any difference.)</p>\n\n<h2>GHC 8.6.3</h2>\n\n<p>this works:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>stack --resolver lts-13.11 runhaskell Fail2\n</code></pre>\n\n<p>then I compile Fail1:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>stack --resolver lts-13.11 ghc -- -O2 --make Fail1\n</code></pre>\n\n<p>then the original runhaskell command hangs when running Fail2.</p>\n\n<p>then I compile Fail2:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>stack --resolver lts-13.11 ghc -- -O2 --make Fail2\n</code></pre>\n\n<p>then the original runhaskell command crashes, just like the question describes it.</p>\n\n<h2>GHC 8.6.4</h2>\n\n<p>With <code>--resolver lts-13.19</code> (which uses GHC 8.6.4), the commands all work as expected.</p>\n\n<h2>GHC 8.6.5</h2>\n\n<p>The same for <code>--resolver lts-13.23</code> (which uses GHC 8.6.5).</p>\n\n<h1>Solution</h1>\n\n<p>Just update to the newest GHC version, or at least update to ghc 8.6.4 .</p>\n"}], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 56307029, "answer_count": 1, "score": 12, "last_activity_date": 1558804328, "creation_date": 1558732740, "last_edit_date": 1558768950, "question_id": 56299642, "link": "https://stackoverflow.com/questions/56299642/haskell-program-hangs-when-mixing-compiled-and-interpreted-code", "title": "Haskell program hangs when mixing compiled and interpreted code", "body": "<p>Consider the following trivial modules:</p>\n\n<pre><code>module Fail1 where\nidentity x = x\n\nmodule Main where\nimport Fail1\nmain = print (identity 7)\n</code></pre>\n\n<p>I save these as <code>Fail1.hs</code> and <code>Fail2.hs</code>. If I try to run this program, all is well:</p>\n\n<pre><code>&gt; runhaskell Fail2\n7\n</code></pre>\n\n<p>But take a look at this:</p>\n\n<pre><code>&gt; ghc -O2 --make Fail1\n[1 of 1] Compiling Fail1     ( Fail1.hs, Fail1.o )\n\n&gt; runhaskell Fail2\n_\n</code></pre>\n\n<p>The program now hangs forever, with <code>ghc.exe</code> consuming 100% of one CPU core. What the heck?</p>\n\n<p>It gets better though:</p>\n\n<pre><code>&gt; ghc -O2 --make Fail2\n[2 of 2] Compiling Main     ( Fail2.hs, Fail2.o )\n\n&gt; runhaskell Fail2\n\nAccess violation in generated code when reading 0xffffffffffffffff\n\n Attempting to reconstruct a stack trace...\n\n   Frame        Code address\n * 0x71fdd90    0x3d7ce28 C:\\Program Files\\Haskell Platform\\8.6.3\\bin\\ghc.exe+0x397ce28\n</code></pre>\n\n<p>Er... wat?</p>\n\n<p>Ironically, if I just run <code>Fail2.exe</code> itself, it works perfectly:</p>\n\n<pre><code>&gt; Fail2\n7\n</code></pre>\n\n<p>What in the heck is going on? Am I going mad? This really, really looks like some kind of GHC bug. Can anyone else reproduce this, or is it just my system?</p>\n\n<pre><code>&gt; ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 8.6.3\n</code></pre>\n\n<p>(Wow, OK. That really doesn't display much info. I'm running Windows 7 Pro 64-bit, and I <em>believe</em> I've installed the 64-bit build of GHC.)</p>\n"}, {"tags": ["haskell", "category-abstractions"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1558720167, "post_id": 56297136, "comment_id": 99207093, "body": "<code>RT r1 &#176; RT r2 = RT $ nub [(a, b) | (t, b) &lt;- r1, (a, t&#39;) &lt;- r2, t == t&#39;]</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1558720262, "post_id": 56297136, "comment_id": 99207122, "body": "BTW, if you&#39;ll want to make this at all useful you&#39;ll have to require also <code>Ord</code> (or <code>Hashable</code>), to avoid the horrible quadratic performance of <code>nub</code>."}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1558720576, "post_id": 56297136, "comment_id": 99207249, "body": "@leftaroundabout You are right, but I&#39;m trying also to avoid the Ord constraint. In my previous post I tried Map a (Set b). Sure I&#39;ll try a Hashable version."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1558720695, "post_id": 56297136, "comment_id": 99207291, "body": "@AlbertoCapitani There&#39;s nothing especially different about requiring <code>Eq</code> or <code>Hashable</code> instead of <code>Ord</code> -- you have to solve all the same problems. So you might as well use <code>Map a (Set b)</code> and use the same solution you&#39;ve seen here for <code>Eq</code>, substituting in <code>Ord</code> instead (or <code>Hashable</code>, as you prefer)."}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1558720924, "post_id": 56297136, "comment_id": 99207376, "body": "@DanielWagner in my previous post, I&#39;d a problem with Map a (Set b) defining a special functor over Set, because Set is not a Functor and is the type in Set are limited to Ord types. Instead, with Map a [b] it was possible to implement that special fmap on [b]."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1558726636, "post_id": 56297136, "comment_id": 99209548, "body": "@AlbertoCapitani Yes, I&#39;m well aware. And you are not going to fix that by requiring <code>Eq</code> or <code>Hashable</code> instead of <code>Ord</code>. You are going to fix it, as in the answer here, by using a different constrained <code>Functor</code> class. (And you don&#39;t want to drop the <code>Eq</code> constraint, or you run the risk of having duplicates in your <code>Map a [b]</code>.)"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1558720440, "post_id": 56297342, "comment_id": 99207200, "body": "Depending on your goals, it may also be interesting to consider <code>newtype Relation a b = Relation [(a,b)]; type Object Relation o = (Eq o, Universe o); id = Relation [(x,x) | x &lt;- universe]</code>. Given that <code>Universe</code> is only needed for <code>id</code> and <code>Eq</code> is only needed for <code>(.)</code>, perhaps this is some motivation for <code>Category</code> to have a second <code>Constraint</code>-kinded associated family (perhaps with a default implementation equal to the first). Something like <code>type Object k o :: Constraint; type Composes k a b c :: Constraint; type Composes k a b c = (Object k a, Object k b, Object k c)</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1558720142, "last_edit_date": 1558720142, "creation_date": 1558719820, "answer_id": 56297342, "question_id": 56297136, "link": "https://stackoverflow.com/questions/56297136/error-trying-to-define-type-relation-a-b-as-an-instance-of-category-class/56297342#56297342", "title": "Error trying to define type Relation [(a,b)] as an instance of Category class", "body": "<p>If you're storing the <code>Eq</code> constraints in a GADT, there's no need to require that from the signature: by pattern-matching on the relation-values, the constraint will already be in scope. So, just change the signature to</p>\n\n<pre><code>(\u00b0) :: RelationT t b -&gt; RelationT a t -&gt; RelationT a b\n</code></pre>\n\n<p>The <code>(Eq a, Eq b, Eq c)</code> information will <em>still</em> be available within the function body, because you've pattern-matched <code>RT r1</code> and <code>RT r2</code> there, which if successful witness that all the types have an <code>Eq</code> instance.</p>\n\n<p>That said: in my experience, this trick of storing a constraint in a GADT leads quickly into trouble when you want to do more involved stuff with your category. The problem is, the standard <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Category.html\" rel=\"nofollow noreferrer\"><code>Category</code></a> class is not really suitable for a relation type like this, because it only supports categories which have exactly the same objects as <strong>Hask</strong> \u2013 i.e., all Haskell types. But your relation category really has only equality-comparable types as objects; with the extra <code>Id</code> constructor you're forcibly extending it to also include relations between non-eq types, but there <em>only</em> the identity relation is available... that's quite a fragile hack.</p>\n\n<p>The proper way out is to use a typeclass which allows the categories to have a more restricted notion of objects to begin with. The simplest means to do that are <em>constraint kinds</em>. From my <a href=\"http://hackage.haskell.org/package/constrained-categories-0.3.1.1/docs/Control-Category-Constrained.html\" rel=\"nofollow noreferrer\"><code>constrained-categories</code> package</a>:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, ConstraintKinds #-}\nimport GHC.Exts (Constraint)\n\nclass Category k where\n  type Object k o :: Constraint\n  id :: Object k a =&gt; k a a\n  (.) :: (Object k a, Object k b, Object k c)\n         =&gt; k b c -&gt; k a b -&gt; k a c\n</code></pre>\n\n<p>Then you can make the instance</p>\n\n<pre><code>data RelationT a b where\n  Id :: RelationT a a\n  RT :: [(a,b)] -&gt; RelationT a b\n\ninstance Category RelationT where\n  type Object RelationT o = Eq o\n  id = Id\n  (.) = (\u00b0)\n</code></pre>\n"}], "owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 56297342, "answer_count": 1, "score": 3, "last_activity_date": 1559483316, "creation_date": 1558718715, "last_edit_date": 1559483316, "question_id": 56297136, "link": "https://stackoverflow.com/questions/56297136/error-trying-to-define-type-relation-a-b-as-an-instance-of-category-class", "title": "Error trying to define type Relation [(a,b)] as an instance of Category class", "body": "<p>I'm exploring some possible implementations of R subset of AxB, each with its limits and possibilities. I would also like, when possible, to define them as instances of the Category class or Semigroupoid class.</p>\n\n<p>I have chosen the list of pairs since, with regard to the operation of composing lists, it only places types of the elements of the pair the constraint of being instances of the Eq class.</p>\n\n<p>Now I'm stuck on this compiler error message: \"No instance for (Eq a) arising from a use of \u2018\u00b0\u2019\"</p>\n\n<p>What's wrong?</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nmodule RelationT where\n\nimport Data.List\nimport Control.Category as Cat\n\ndata RelationT a b where\n  Id :: RelationT a a\n  RT :: (Eq a, Eq b) =&gt; [(a,b)] -&gt; RelationT a b\n\ninstance Category RelationT where\n  id = Id\n  Id . r = r\n  r . Id = r\n  r1 . r2 = r1 \u00b0 r2 -- error:  No instance for (Eq a) arising from a use of \u2018\u00b0\u2019\n\n(\u00b0) :: (Eq a, Eq b, Eq t) =&gt; RelationT t b -&gt; RelationT a t -&gt; RelationT a b\nRT r1 \u00b0 RT r2 = RT $ nub $ go r1 r2\n    where\n    go [] r =  []\n    go r [] =  []\n    go xys2 ( ((x1,y1): xys1)) =  go2 x1 y1 xys2 [] ++ go xys2  xys1\n        where\n        go2 x y [] acc = acc\n        go2 x y ((w,z):wzs) acc\n          | y == w = go2 x y wzs ((x,z):acc)\n          | otherwise = go2 x y wzs acc\n\n-- ex. RT [(1,'a'),(4,'b'),(5,'c'),(10,'d')] \u00b0 RT [(3,10),(1,5),(1,1)]\n-- &gt; RT [(3,'d'),(1,'c'),(1,'a')]\n</code></pre>\n"}, {"tags": ["haskell", "typeclass", "ghci"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1558730469, "post_id": 56296056, "comment_id": 99210828, "body": ":info seems to just accept a list, parses each word and displays. I agree what you want would be a nice feature."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 2, "creation_date": 1558745469, "post_id": 56296056, "comment_id": 99213693, "body": "Instances that match <code>Maybe Int</code> would include any instance for <code>Maybe a</code>, <code>t Int</code>, <code>t a</code>, and plain <code>a</code>. And instances for any MultiParam class of which one type unifies with <code>Maybe Int</code>. I doubt that&#39;s going to be useful. Or do you mean to exclude instance more general than <code>Maybe Int</code>? That won&#39;t help you understand why some type at <code>Maybe Int</code> gets matched to some instance."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1558777619, "post_id": 56296056, "comment_id": 99218329, "body": "AntC is right, this feature would be highly nontrivial to implement in an actually useful way."}], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 0, "score": 10, "last_activity_date": 1558713646, "creation_date": 1558713646, "question_id": 56296056, "link": "https://stackoverflow.com/questions/56296056/find-instances-for-arbitrary-type-expression", "title": "Find instances for arbitrary type expression", "body": "<p>Is there a way to persuade GHCi to tell me what typeclass instances some arbitrary type expression implements?</p>\n\n<p>Obviously, you can use the <code>:info</code> command to find all the instances for a <em>type constructor</em>. But what about some complex <em>type expression</em>?</p>\n\n<p>For example, if I wanted to know what instances <code>Maybe Int</code> has (not <code>Maybe</code>, but <code>Maybe Int</code>), how can I do that?</p>\n\n<p>I tried</p>\n\n<pre><code> :info Maybe Int\n</code></pre>\n\n<p>but that just gives me information for <code>Maybe</code>, followed by information for <code>Int</code>. It's treating it as two separate type constructors, rather than a type expression.</p>\n\n<p>Particularly when you have complicated monad transformer stacks, it's not always obvious exactly which instances a specific stack might have.</p>\n"}, {"tags": ["parsing", "haskell", "operator-precedence", "parsec", "associativity"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1558714168, "post_id": 56295777, "comment_id": 99204760, "body": "For number 1, you have to decide what result you want. Should <code>a = b = c</code> produce <code>(= (= a b) c)</code>, <code>(= a (= b c))</code>, or <code>(= a b c)</code>? For number 2, you just need separate grammar rules for <code>+</code> and <code>=</code>, so that <code>(= (+ a b) (b + a))</code> is the only legal parsing of <code>a + b = b + a</code>."}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1558805079, "post_id": 56295777, "comment_id": 99224721, "body": "If you just want to get it done without understanding how it works, use <a href=\"http://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec-Expr.html\" rel=\"nofollow noreferrer\"><code>Parsec.Expr.buildExpressionParser</code></a>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1558807087, "post_id": 56295777, "comment_id": 99225239, "body": "And if do you want to understand how it works, you could work through the definition of <code>buildExpressionParser</code> for your working parser."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 5, "last_activity_date": 1559421252, "creation_date": 1559421252, "answer_id": 56410230, "question_id": 56295777, "link": "https://stackoverflow.com/questions/56295777/right-way-to-parse-chain-of-various-binary-functions-with-parsec/56410230#56410230", "title": "Right way to parse chain of various binary functions with `Parsec`?", "body": "<p>Okay, here's a long answer that might help. First, these are the imports I'm using, if you want to follow along:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# OPTIONS_GHC -Wall #-}\nimport Control.Applicative (some)\nimport Text.Parsec\nimport Text.Parsec.Expr\nimport Text.Parsec.String\n</code></pre>\n\n<h2>Why <code>a -&gt; a -&gt; a</code> isn't so bad...</h2>\n\n<p>The operator type signature <code>a -&gt; a -&gt; a</code> is less restrictive and makes more sense than you might at first think.  One key point is that <em>usually</em> when we're parsing expressions, we don't write a parser to evaluate them directly but rather parse them into some intermediate abstract syntax tree (AST) that is later evaluated.  For example, consider a simple untyped AST with addition, subtraction, equality, and boolean connectives:</p>\n\n<pre><code>data Expr\n  = IntE Int        -- integer literals\n  | FalseE | TrueE  -- boolean literals (F, T)\n  | AddE Expr Expr  -- x + y\n  | SubE Expr Expr  -- x - y\n  | EqE  Expr Expr  -- x = y\n  | OrE  Expr Expr  -- x | y\n  | AndE Expr Expr  -- x &amp; y\n  deriving (Show)\n</code></pre>\n\n<p>If we want to write a parser to treat all these operators as left associative at the same precedence level, we can write a <code>chainl</code>-based parser like so.  (For simplicity, this parser doesn't permit whitespace.)</p>\n\n<pre><code>expr :: Parser Expr\nexpr = chainl1 term op\n  where op = AddE &lt;$ char '+'\n         &lt;|&gt; SubE &lt;$ char '-'\n         &lt;|&gt; EqE  &lt;$ char '='\n         &lt;|&gt; OrE  &lt;$ char '|'\n         &lt;|&gt; AndE &lt;$ char '&amp;'\nterm :: Parser Expr\nterm = IntE . read &lt;$&gt; some digit\n   &lt;|&gt; FalseE &lt;$ char 'F' &lt;|&gt; TrueE &lt;$ char 'T'\n   &lt;|&gt; parens expr\nparens :: Parser a -&gt; Parser a\nparens = between (char '(') (char ')')\n</code></pre>\n\n<p>and we get:</p>\n\n<pre><code>&gt; parseTest expr \"1+2+3\"\nAddE (AddE (IntE 1) (IntE 2)) (IntE 3)\n&gt; parseTest expr \"1=2=F\"\nEqE (EqE (IntE 1) (IntE 2)) FalseE\n&gt;\n</code></pre>\n\n<p>We'd then leave it up to the interpreter to deal with the types (i.e., to type check the program):</p>\n\n<pre><code>data Value = BoolV Bool | IntV Int deriving (Eq, Show)\neval :: Expr -&gt; Value\neval (IntE x) = IntV x\neval FalseE = BoolV False\neval TrueE = BoolV True\neval (AddE e1 e2)\n  = let IntV v1 = eval e1  -- pattern match ensures right type\n        IntV v2 = eval e2\n    in  IntV (v1 + v2)\neval (SubE e1 e2)\n  = let IntV v1 = eval e1\n        IntV v2 = eval e2\n    in  IntV (v1 - v2)\neval (EqE e1 e2) = BoolV (eval e1 == eval e2)  -- equal if same type and value\neval (OrE e1 e2)\n  = let BoolV v1 = eval e1\n        BoolV v2 = eval e2\n    in  BoolV (v1 || v2)\neval (AndE e1 e2)\n  = let BoolV v1 = eval e1\n        BoolV v2 = eval e2\n    in  BoolV (v1 &amp;&amp; v2)\n\nevalExpr :: String -&gt; Value\nevalExpr str = let Right e = parse expr \"&lt;evalExpr&gt;\" str in eval e\n</code></pre>\n\n<p>giving:</p>\n\n<pre><code>&gt; evalExpr \"1+2+3\"\nIntV 6\n&gt; evalExpr \"1=2=F\"\nBoolV True\n&gt;\n</code></pre>\n\n<p>Note that even though the type of the \"<code>=</code>\" operator is something like <code>Eq a =&gt; a -&gt; a -&gt; Bool</code> (or actually <code>a -&gt; b -&gt; Bool</code>, as we allow comparison of unequal types), it's represented in the AST as the constructor <code>EqE</code> of type <code>Expr -&gt; Expr -&gt; Expr</code>, so the <code>a -&gt; a -&gt; a</code> type makes sense.</p>\n\n<p>Even if we were to combine the parser and evaluator above into a single function, we'd probably find it easiest to use a dynamic <code>Value</code> type, so all operators would be of type <code>Value -&gt; Value -&gt; Value</code> which fits into the <code>a -&gt; a -&gt; a</code> pattern:</p>\n\n<pre><code>expr' :: Parser Value\nexpr' = chainl1 term' op\n  where op = add &lt;$ char '+'\n         &lt;|&gt; sub &lt;$ char '-'\n         &lt;|&gt; eq  &lt;$ char '='\n         &lt;|&gt; or  &lt;$ char '|'\n         &lt;|&gt; and &lt;$ char '&amp;'\n        add (IntV x) (IntV y) = IntV $ x + y\n        sub (IntV x) (IntV y) = IntV $ x - y\n        eq  v1 v2 = BoolV $ v1 == v2\n        or  (BoolV x) (BoolV y) = BoolV $ x || y\n        and (BoolV x) (BoolV y) = BoolV $ x &amp;&amp; y\nterm' :: Parser Value\nterm' = IntV . read &lt;$&gt; some digit\n   &lt;|&gt; BoolV False &lt;$ char 'F' &lt;|&gt; BoolV True &lt;$ char 'T'\n   &lt;|&gt; parens expr'\n</code></pre>\n\n<p>This works too, with the parser directly evaluating the expression</p>\n\n<pre><code>&gt; parseTest expr' \"1+2+3\"\nIntV 6\n&gt; parseTest expr' \"1=2=F\"\nBoolV True\n&gt;\n</code></pre>\n\n<p>You may find this use of dynamic typing during parsing and evaluation a little unsatifactory, but see below.</p>\n\n<h2>Operator Precedence</h2>\n\n<p>The standard way of adding operator precedence is to define multiple expression \"levels\" that work with a subset of the operators.  If we want a precedence ordering from highest to lowest of addition/subtraction, then equality, then boolean \"and\", then boolean \"or\", we could replace <code>expr'</code> with the following.  Note that each <code>chainl1</code> call uses as \"terms\" the next (higher-precedence) expression level:</p>\n\n<pre><code>expr0 :: Parser Value\nexpr0 = chainl1 expr1 op\n  where op = or  &lt;$ char '|'\n        or  (BoolV x) (BoolV y) = BoolV $ x || y\nexpr1 :: Parser Value\nexpr1 = chainl1 expr2 op\n  where op = and &lt;$ char '&amp;'\n        and (BoolV x) (BoolV y) = BoolV $ x &amp;&amp; y\nexpr2 :: Parser Value\nexpr2 = chainl1 expr3 op\n  where op = eq  &lt;$ char '='\n        eq  v1 v2 = BoolV $ v1 == v2\nexpr3 :: Parser Value\nexpr3 = chainl1 term'' op\n  where op = add &lt;$ char '+'  -- two operators at same precedence\n         &lt;|&gt; sub &lt;$ char '-'\n        add (IntV x) (IntV y) = IntV $ x + y\n        sub (IntV x) (IntV y) = IntV $ x - y\nterm'' :: Parser Value\nterm'' = IntV . read &lt;$&gt; some digit\n     &lt;|&gt; BoolV False &lt;$ char 'F' &lt;|&gt; BoolV True &lt;$ char 'T'\n     &lt;|&gt; parens expr0\n</code></pre>\n\n<p>After which:</p>\n\n<pre><code>&gt; parseTest expr0 \"(1+5-6=2-3+1&amp;2+2=4)=(T|F)\"\nBoolV True\n&gt;\n</code></pre>\n\n<p>As this can be tedious, Parsec provides a <code>Text.Parsec.Expr</code> that makes this easier.  The following replaces <code>expr0</code> through <code>expr3</code> above:</p>\n\n<pre><code>expr0' :: Parser Value\nexpr0' = buildExpressionParser table term''\n  where table = [ [binary '+' add, binary '-' sub]\n                , [binary '=' eq]\n                , [binary '&amp;' and]\n                , [binary '|' or]\n                ]\n        binary c op = Infix (op &lt;$ char c) AssocLeft\n        add (IntV x) (IntV y) = IntV $ x + y\n        sub (IntV x) (IntV y) = IntV $ x - y\n        eq  v1 v2 = BoolV $ v1 == v2\n        and (BoolV x) (BoolV y) = BoolV $ x &amp;&amp; y\n        or  (BoolV x) (BoolV y) = BoolV $ x || y\n</code></pre>\n\n<h2>Typed Parsing</h2>\n\n<p>You may find it strange above that we use an untyped AST (i.e., everything's an <code>Expr</code>) and dynamically typed <code>Value</code> instead of using Haskell's type system in the parsing.  It is possible to design a parser where the operators actually have expected Haskell types.  In the language above, equality causes a bit of an issue, but if we permit integer equality only, it's possible to write a typed parser/evaluator as follows.  Here <code>bexpr</code> and <code>iexpr</code> are for boolean-valued and integer-values expressions respectively.</p>\n\n<pre><code>bexpr0 :: Parser Bool\nbexpr0 = chainl1 bexpr1 op\n  where op = (||) &lt;$ char '|'\nbexpr1 :: Parser Bool\nbexpr1 = chainl1 bexpr2 op\n  where op = (&amp;&amp;) &lt;$ char '&amp;'\nbexpr2 :: Parser Bool\nbexpr2 = False &lt;$ char 'F' &lt;|&gt; True &lt;$ char 'T'\n     &lt;|&gt; try eqexpr\n     &lt;|&gt; parens bexpr0\n     where eqexpr = (==) &lt;$&gt; iexpr3 &lt;* char '=' &lt;*&gt; iexpr3  -- this can't chain now\niexpr3 :: Parser Int\niexpr3 = chainl1 iterm op\n  where op = (+) &lt;$ char '+'\n         &lt;|&gt; (-) &lt;$ char '-'\niterm :: Parser Int\niterm = read &lt;$&gt; some digit\n     &lt;|&gt; parens iexpr3\n</code></pre>\n\n<p>Note that we're still able to use <code>chainl1</code>, but there's a boundary between the integer and boolean types enforced by precedence, so we only ever chain <code>Int -&gt; Int -&gt; Int</code> or <code>Bool -&gt; Bool -&gt; Bool</code> operators, and we don't let the <code>Int -&gt; Int -&gt; Bool</code> integer equality operator chain.</p>\n\n<p>This also means we need to use a different parser to parse a boolean versus an integer expression:</p>\n\n<pre><code>&gt; parseTest bexpr0 \"1+2=3\"\nTrue\n&gt; parseTest iexpr3 \"1+2-3\"  -- iexpr3 is top-most integer expression parser\n0\n&gt;\n</code></pre>\n\n<p>Note here that if you wanted integer equality to chain as a set of equalities so that <code>1+1=2=3-1</code> would check that all three terms are equal, you could do this with <code>chainl1</code> using some trickery with lists and singleton values, but it's easier to use <code>sepBy1</code> and replace <code>eqexpr</code> above with the definition:</p>\n\n<pre><code>eqexpr' = do\n  x:xs &lt;- sepBy1 iexpr3 (char '=')\n  return $ all (==x) xs\n</code></pre>\n\n<p>giving:</p>\n\n<pre><code>&gt; parseTest bexpr0 \"1+1=2=3-1\"\nTrue\n\n</code></pre>\n\n<h2>The whole program</h2>\n\n<p>To summarize, here's all the code:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n{-# OPTIONS_GHC -Wall #-}\n\nimport Control.Applicative (some)\nimport Text.Parsec\nimport Text.Parsec.Expr\nimport Text.Parsec.String\n\n-- * Untyped parser to AST\n\ndata Expr\n  = IntE Int        -- integer literals\n  | FalseE | TrueE  -- boolean literals (F, T)\n  | AddE Expr Expr  -- x + y\n  | SubE Expr Expr  -- x - y\n  | EqE  Expr Expr  -- x = y\n  | OrE  Expr Expr  -- x | y\n  | AndE Expr Expr  -- x &amp; y\n  deriving (Show)\n\nexpr :: Parser Expr\nexpr = chainl1 term op\n  where op = AddE &lt;$ char '+'\n         &lt;|&gt; SubE &lt;$ char '-'\n         &lt;|&gt; EqE  &lt;$ char '='\n         &lt;|&gt; OrE  &lt;$ char '|'\n         &lt;|&gt; AndE &lt;$ char '&amp;'\n\nterm :: Parser Expr\nterm = IntE . read &lt;$&gt; some digit\n   &lt;|&gt; FalseE &lt;$ char 'F' &lt;|&gt; TrueE &lt;$ char 'T'\n   &lt;|&gt; parens expr\n\nparens :: Parser a -&gt; Parser a\nparens = between (char '(') (char ')')\n\n-- * Interpreter\n\ndata Value = BoolV Bool | IntV Int deriving (Eq, Show)\n\neval :: Expr -&gt; Value\neval (IntE x) = IntV x\neval FalseE = BoolV False\neval TrueE = BoolV True\neval (AddE e1 e2)\n  = let IntV v1 = eval e1  -- pattern match ensures right type\n        IntV v2 = eval e2\n    in  IntV (v1 + v2)\neval (SubE e1 e2)\n  = let IntV v1 = eval e1\n        IntV v2 = eval e2\n    in  IntV (v1 - v2)\neval (EqE e1 e2) = BoolV (eval e1 == eval e2)  -- equal if same type and value\neval (OrE e1 e2)\n  = let BoolV v1 = eval e1\n        BoolV v2 = eval e2\n    in  BoolV (v1 || v2)\neval (AndE e1 e2)\n  = let BoolV v1 = eval e1\n        BoolV v2 = eval e2\n    in  BoolV (v1 &amp;&amp; v2)\n\n-- * Combined parser/interpreter with no intermediate AST\n\nexpr' :: Parser Value\nexpr' = chainl1 term' op\n  where op = add &lt;$ char '+'\n         &lt;|&gt; sub &lt;$ char '-'\n         &lt;|&gt; eq  &lt;$ char '='\n         &lt;|&gt; or  &lt;$ char '|'\n         &lt;|&gt; and &lt;$ char '&amp;'\n        add (IntV x) (IntV y) = IntV $ x + y\n        sub (IntV x) (IntV y) = IntV $ x - y\n        eq  v1 v2 = BoolV $ v1 == v2\n        or  (BoolV x) (BoolV y) = BoolV $ x || y\n        and (BoolV x) (BoolV y) = BoolV $ x &amp;&amp; y\nterm' :: Parser Value\nterm' = IntV . read &lt;$&gt; some digit\n   &lt;|&gt; BoolV False &lt;$ char 'F' &lt;|&gt; BoolV True &lt;$ char 'T'\n   &lt;|&gt; parens expr'\n\n-- * Parser/interpreter with operator precendence\n\nexpr0 :: Parser Value\nexpr0 = chainl1 expr1 op\n  where op = or  &lt;$ char '|'\n        or  (BoolV x) (BoolV y) = BoolV $ x || y\nexpr1 :: Parser Value\nexpr1 = chainl1 expr2 op\n  where op = and &lt;$ char '&amp;'\n        and (BoolV x) (BoolV y) = BoolV $ x &amp;&amp; y\nexpr2 :: Parser Value\nexpr2 = chainl1 expr3 op\n  where op = eq  &lt;$ char '='\n        eq  v1 v2 = BoolV $ v1 == v2\nexpr3 :: Parser Value\nexpr3 = chainl1 term'' op\n  where op = add &lt;$ char '+'  -- two operators at same precedence\n         &lt;|&gt; sub &lt;$ char '-'\n        add (IntV x) (IntV y) = IntV $ x + y\n        sub (IntV x) (IntV y) = IntV $ x - y\nterm'' :: Parser Value\nterm'' = IntV . read &lt;$&gt; some digit\n     &lt;|&gt; BoolV False &lt;$ char 'F' &lt;|&gt; BoolV True &lt;$ char 'T'\n     &lt;|&gt; parens expr0\n\n-- * Alternate implementation using buildExpressionParser\n\nexpr0' :: Parser Value\nexpr0' = buildExpressionParser table term''\n  where table = [ [binary '+' add, binary '-' sub]\n                , [binary '=' eq]\n                , [binary '&amp;' and]\n                , [binary '|' or]\n                ]\n        binary c op = Infix (op &lt;$ char c) AssocLeft\n        add (IntV x) (IntV y) = IntV $ x + y\n        sub (IntV x) (IntV y) = IntV $ x - y\n        eq  v1 v2 = BoolV $ v1 == v2\n        and (BoolV x) (BoolV y) = BoolV $ x &amp;&amp; y\n        or  (BoolV x) (BoolV y) = BoolV $ x || y\n\n-- * Typed parser/interpreter with separate boolean and integer expressions\n\nbexpr0 :: Parser Bool\nbexpr0 = chainl1 bexpr1 op\n  where op = (||) &lt;$ char '|'\nbexpr1 :: Parser Bool\nbexpr1 = chainl1 bexpr2 op\n  where op = (&amp;&amp;) &lt;$ char '&amp;'\nbexpr2 :: Parser Bool\nbexpr2 = False &lt;$ char 'F' &lt;|&gt; True &lt;$ char 'T'\n     &lt;|&gt; try eqexpr\n     &lt;|&gt; parens bexpr0\n     where eqexpr = (==) &lt;$&gt; iexpr3 &lt;* char '=' &lt;*&gt; iexpr3  -- this can't chain now\niexpr3 :: Parser Int\niexpr3 = chainl1 iterm op\n  where op = (+) &lt;$ char '+'\n         &lt;|&gt; (-) &lt;$ char '-'\niterm :: Parser Int\niterm = read &lt;$&gt; some digit\n     &lt;|&gt; parens iexpr3\n\n-- * Alternate definition of eqexpr to allow 4=2+2=1+3\n\neqexpr' = do\n  x:xs &lt;- sepBy1 iexpr3 (char '=')\n  return $ all (==x) xs\n</code></pre>\n"}], "owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 862, "favorite_count": 0, "accepted_answer_id": 56410230, "answer_count": 1, "score": 3, "last_activity_date": 1560150854, "creation_date": 1558712474, "last_edit_date": 1560150854, "question_id": 56295777, "link": "https://stackoverflow.com/questions/56295777/right-way-to-parse-chain-of-various-binary-functions-with-parsec", "title": "Right way to parse chain of various binary functions with `Parsec`?", "body": "<p>It is true that <code>Parsec</code> has <code>chainl</code> and <code>chainr</code> to parse chains of either left-associative or right-associative <strong>operations</strong> (i.e. <code>a -&gt; a -&gt; a</code>). So I could quite easily parse something like <code>x + y + z</code> in a <code>((a + y) + z)</code> or <code>(a + (y + z))</code> manner.</p>\n\n<p>However, </p>\n\n<ol>\n<li>there is no standard way to parse <code>a -&gt; b -&gt; c</code> <strong>functions</strong> and specific case when <code>a = b</code>: <code>a -&gt; a -&gt; c</code>, for example <code>a = b = c</code> thought as a comparison function (<code>a -&gt; a -&gt; Bool</code>);</li>\n<li>there is no standard way to implement \"importance\" of an operation: for example <code>a + b = b + a</code> should be parsed as <code>((a + b) = (b + a))</code> and not <code>(((a + b) = b) + a))</code>.</li>\n</ol>\n\n<p>I am kind of new to parsing problems, so it would be great to get answers for both questions.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1558710228, "post_id": 56295219, "comment_id": 99202880, "body": "You can use pattern matching."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1558712467, "post_id": 56295219, "comment_id": 99203996, "body": "Variable names muse start with a lower case.  Unless <code>BT</code> is a constructor (and it appears not) you should name it something like <code>bt</code> instead.  Also please post the full error message in the future."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1558717230, "last_edit_date": 1558717230, "creation_date": 1558710909, "answer_id": 56295388, "question_id": 56295219, "link": "https://stackoverflow.com/questions/56295219/how-can-i-adjust-tail-to-avoid-incorrect-indentation-in-haskell/56295388#56295388", "title": "How can I adjust &quot;tail&quot; to avoid incorrect indentation in Haskell", "body": "<p>It is usually better to use pattern matching. By using pattern matching, the compiler can warn you if you did not cover all possible patterns, and hence it is less likely that your program will error.</p>\n\n<p>That being said, your current attempt has a lot of problems, and not only with indentation.</p>\n\n<p>Your <code>grandchildrenIncreased</code> does not seem to make much sense if we look at the types. For example you write <code>grandchildrenIncreased Empty = Empty</code>, but the result type is a <code>Bool</code>, so it should be <code>True</code> or <code>False</code>.</p>\n\n<p>You also mix type constructors (like <code>BTree</code>) with data constructors. For example your second line <code>grandchildrenIncreased BTree = func BTree level</code> makes not much sense either, since <code>BTree</code> is a type, it is not a specific pattern for tree <em>values</em>.</p>\n\n<p>You also seem to use <code>level</code> in your <code>grandchildrenIncreased</code> to refer both to the <code>level :: BTree -&gt; Int -&gt; [a]</code> function, as well as to some non-existing <code>Int</code> value.</p>\n\n<p>Finally by first converting the tree to lists of levels, you lose the structure of which node is connected to which grandparent, making it hard to check that.</p>\n\n<pre><code>grandchildrenIncreased :: BTree -&gt; Bool\ngrandchildrenIncreased Empty = True\ngrandchildrenIncreased n@(Node v l r) =\n    all (v &lt;) (level n 3) && grandchildrenIncreased l && grandchildrenIncreased r</code></pre>\n\n<p>We thus check in the case of a <code>Node v l r</code>, if all the values of the level underneath the subtrees <code>l</code> and <code>r</code> are all larger than <code>v</code>, and that the condition also holds for the <code>l</code> and <code>r</code> subtree.</p>\n\n<p>Note that since you constructed a tree of <code>Int</code>s, the most generic type signature for <code>level</code> is:</p>\n\n<pre><code>level :: BTree -&gt; Int -&gt; <b>[Int]</b>\nlevel Empty _ = []\nlevel (Node n lt rt) 1 = [n]\nlevel (Node _ lt rt) k = (level lt (k-1)) ++ (level rt (k-1))</code></pre>\n\n<p>Here it might however be more useful to define a <code>children</code> function:</p>\n\n<pre><code>children :: BTree -&gt; [BTree]\nchildren Empty = []\nchildren (Node _ lt rt) = [lt, rt]</code></pre>\n\n<p>and a way to extract the value of a <code>Node</code>:</p>\n\n<pre><code>treeVal :: BTree -&gt; Maybe Int\ntreeVal Empty = Nothing\ntreeVal (Node v _ _) = Just v</code></pre>\n\n<p>then we can derive the values with:</p>\n\n<pre><code>import Data.Maybe(catMaybes)\n\ngrandchildrenIncreased :: BTree -&gt; Bool\ngrandchildrenIncreased Empty = True\ngrandchildrenIncreased n@(Node v l r) =\n    all (v &lt;) (catMaybes (treeVal &lt;$&gt; (children n &gt;&gt;= children))) &&\n    grandchildrenIncreased l && grandchildrenIncreased r</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 11461094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9bfb11cd4f0864677ca94b284a5e1c2?s=128&d=identicon&r=PG&f=1", "display_name": "headfxll", "link": "https://stackoverflow.com/users/11461094/headfxll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 56295388, "answer_count": 1, "score": -2, "last_activity_date": 1558717230, "creation_date": 1558710201, "question_id": 56295219, "link": "https://stackoverflow.com/questions/56295219/how-can-i-adjust-tail-to-avoid-incorrect-indentation-in-haskell", "title": "How can I adjust &quot;tail&quot; to avoid incorrect indentation in Haskell", "body": "<p>is there any way to solve this problem with incorrect indentation ? I want to check if every node on a given tree is bigger than it's grandfather (if it has one).\nI've written a function that gives all nodes on every level and the idea in the main function is to compare the nodes if they are smaller than their grandchildren. </p>\n\n<pre><code>data BTree = Empty | Node Int BTree Btree\n\ngrandchildrenIncreased :: BTree -&gt; Bool\ngrandchildrenIncreased Empty = Empty\ngrandchildrenIncreased BTree = func BTree level\n where f BT n\n  | head (level BT n) &lt; head (level BT n+2) = tail (level BT 1)\n     (level BT n+2) grandchildrenIncreased f BT (n+1)\n  | length (level BT n) == 0 = True\n  | otherwise = False\n\nlevel :: BTree -&gt; Int -&gt; [a]\nlevel Empty _ = []\nlevel (Node n lt rt) 1 = [n]\nlevel (Node _ lt rt) k\n = (level lt (k-1)) ++ (level rt (k-1))\n</code></pre>\n\n<p>It gives error on the whole line where \"tail\" is.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558709720, "post_id": 56295092, "comment_id": 99202649, "body": "As the compiler says, you here basically say that you can convert <i>any</i> list <code>[a]</code> to <i>any</i> <code>Vector n a</code>, so with all possible values for <code>n</code>."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1558715883, "post_id": 56295232, "comment_id": 99205486, "body": "+1, though I think you&#39;re actually missing the point of the OP&#39;s idea. It seem this was supposed to be a <i>partial function</i>, working only on lists that actually have the correct length as the (caller-chosen) result type demands."}, {"owner": {"reputation": 6426, "user_id": 3946931, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a45b621c0a6b96ea0996dfd51867c541?s=128&d=identicon&r=PG&f=1", "display_name": "therewillbecode", "link": "https://stackoverflow.com/users/3946931/therewillbecode"}, "edited": false, "score": 0, "creation_date": 1558720882, "post_id": 56295232, "comment_id": 99207363, "body": "As an example what would be a sensible argument to provide the <code>cont</code> parameter with then applying the first function you wrote?"}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "reply_to_user": {"reputation": 6426, "user_id": 3946931, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a45b621c0a6b96ea0996dfd51867c541?s=128&d=identicon&r=PG&f=1", "display_name": "therewillbecode", "link": "https://stackoverflow.com/users/3946931/therewillbecode"}, "edited": false, "score": 0, "creation_date": 1558721268, "post_id": 56295232, "comment_id": 99207528, "body": "@therewillbecode Depends on what you want to do. If you&#39;re in a REPL, you might provide <code>show</code>. If you&#39;re passing the <code>Vec</code> on to another function that depends on <code>n</code>, provide that function. The only requirement on <code>cont</code> is that it converts the value to some type that doesn&#39;t depend on <code>n</code> anymore; if you don&#39;t do that, GHC will complain that the <code>n</code> variable has escaped the scope created by <code>fromList</code>."}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1558721432, "post_id": 56295232, "comment_id": 99207588, "body": "However, to leftaroundabout&#39;s point, this won&#39;t work for you if you&#39;re trying to pass the result of <code>fromList</code> into something that demands a specific size like <code>Vec 3</code>. Is that what you need? If so, you need a different technique. (It&#39;d help if you had an example of how you&#39;d like to use <code>fromList</code> in your question.)"}, {"owner": {"reputation": 6426, "user_id": 3946931, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a45b621c0a6b96ea0996dfd51867c541?s=128&d=identicon&r=PG&f=1", "display_name": "therewillbecode", "link": "https://stackoverflow.com/users/3946931/therewillbecode"}, "edited": false, "score": 0, "creation_date": 1558721827, "post_id": 56295232, "comment_id": 99207737, "body": "No that isn&#39;t what I needed so don&#39;t worry. The size of the computed vector should be determined at runtime based on the length of the list (as you have done)."}, {"owner": {"reputation": 6426, "user_id": 3946931, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a45b621c0a6b96ea0996dfd51867c541?s=128&d=identicon&r=PG&f=1", "display_name": "therewillbecode", "link": "https://stackoverflow.com/users/3946931/therewillbecode"}, "edited": false, "score": 0, "creation_date": 1558722012, "post_id": 56295232, "comment_id": 99207802, "body": "I now realise that <code>r</code> cannot depend on <code>n</code> and that means that you need to return SomeVec instead of a <code>Vec n a</code> since there is no way of determining <code>n</code> until run time. Is that right?"}, {"owner": {"reputation": 6426, "user_id": 3946931, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a45b621c0a6b96ea0996dfd51867c541?s=128&d=identicon&r=PG&f=1", "display_name": "therewillbecode", "link": "https://stackoverflow.com/users/3946931/therewillbecode"}, "edited": false, "score": 0, "creation_date": 1558722271, "post_id": 56295232, "comment_id": 99207908, "body": "I would be interested to know what the other technique you mentioned is @user11228628"}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1558722417, "post_id": 56295232, "comment_id": 99207972, "body": "Yes, <code>SomeVec</code> is a way to &quot;hide&quot; the <code>n</code> from the rest of your program. But the CPS version lets you provide other ways to hide <code>n</code>, like <code>show</code>. Both versions are equally valid and powerful; it&#39;s just a question of which kind of contortions you&#39;d prefer to jump through: implementing instances for <code>SomeVec</code> and unwrapping it everywhere, or possibly rewriting parts of your program to pass continuations."}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1558722788, "post_id": 56295232, "comment_id": 99208133, "body": "(If you had a fixed natural you needed to match against, I don&#39;t know if that&#39;s possible with GHC&#39;s built-in type-level naturals. In that case, I&#39;d recommend other packages like <code>fin</code> that would give you enough power to do it, but then I don&#39;t think you&#39;d be able to use literal numbers in your types, at least without surrounding them with <code>fin</code> cruft.)"}, {"owner": {"reputation": 6426, "user_id": 3946931, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a45b621c0a6b96ea0996dfd51867c541?s=128&d=identicon&r=PG&f=1", "display_name": "therewillbecode", "link": "https://stackoverflow.com/users/3946931/therewillbecode"}, "edited": false, "score": 0, "creation_date": 1558723757, "post_id": 56295232, "comment_id": 99208534, "body": "I am using the singleton-nats package and my own hand-rolled fin type at the moment so I will give that a shot."}], "tags": [], "owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "is_accepted": true, "score": 4, "last_activity_date": 1558711657, "last_edit_date": 1558711657, "creation_date": 1558710256, "answer_id": 56295232, "question_id": 56295092, "link": "https://stackoverflow.com/questions/56295092/cannot-construct-fixed-length-vector-from-list/56295232#56295232", "title": "Cannot Construct Fixed Length Vector from List", "body": "<p>You need to write <code>fromList</code> so that it can provide a <code>Vec n a</code> of some unknown (at compile time) <code>n</code> instead of for any given <code>n</code>. One way to do this is to rewrite it in continuation-passing style:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nfromList :: [a] -&gt; (forall n. Vec n a -&gt; r) -&gt; r\nfromList (x:xs) cont = fromList xs (\\v -&gt; cont (x :+ v))\nfromList [] cont = cont VNil\n</code></pre>\n\n<hr>\n\n<p>In your example, the compiler is complaining because <code>n</code> is a \"rigid type variable\"\u2014in other words, <code>fromList</code> has an implicit <code>forall n</code> at the beginning of its type, so callers of <code>fromList</code> can <em>provide</em> <code>fromList</code> with an arbitrary <code>n</code> and expect it to work. That's not what you want, because you want <code>fromList</code> to compute the <code>n</code> from the length of the list, not receive the <code>n</code> from its caller.</p>\n\n<p>So the solution is to have <code>fromList</code> provide the <code>n</code>, by calling a continuation which itself takes <code>n</code> as a <code>forall</code> type variable.</p>\n\n<p>In mathematical terms, you want <code>n</code> to be <em>existentially quantified</em>\u2014that there <em>exists</em> some <code>n</code> for which <code>fromList</code> produces a <code>Vec n a</code> from a given input\u2014not <em>universally quantified</em>\u2014that for <em>all</em> <code>n</code>, <code>fromList</code> will produce a <code>Vec n a</code> from a given input.</p>\n\n<p>There are other ways than continuation passing to encode existential quantification in Haskell. Here's an alternative:</p>\n\n<pre><code>data SomeVec a = forall n. SomeVec (Vec n a)\n\nfromList' :: [a] -&gt; SomeVec a\nfromList' (x:xs) = case (fromList' xs) of (SomeVec v) -&gt; SomeVec (x :+ v)\nfromList' [] = SomeVec VNil\n</code></pre>\n\n<p>This approach may be cleaner in some cases, but may require you to implement a bunch of instances for <code>SomeVec</code> that are already implemented for <code>Vec</code>.</p>\n\n<p>(You may also notice that this isn't really a fundamentally different approach; <code>fromList' xs = fromList xs SomeVec</code>.)</p>\n\n<p>For more information, a search for \"existential types in Haskell\" should turn up plenty of further leads.</p>\n"}], "owner": {"reputation": 6426, "user_id": 3946931, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a45b621c0a6b96ea0996dfd51867c541?s=128&d=identicon&r=PG&f=1", "display_name": "therewillbecode", "link": "https://stackoverflow.com/users/3946931/therewillbecode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 1, "accepted_answer_id": 56295232, "answer_count": 1, "score": 4, "last_activity_date": 1558711657, "creation_date": 1558709618, "question_id": 56295092, "link": "https://stackoverflow.com/questions/56295092/cannot-construct-fixed-length-vector-from-list", "title": "Cannot Construct Fixed Length Vector from List", "body": "<p>I am trying to construct a fixed length vector from a list and am not sure what kind of help to give the compiler to infer that each return of fromList increments one at the type level to the length.</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE ExistentialQuantification #-}\n\nimport Data.Typeable\nimport GHC.TypeLits \n\ndata Vec :: Nat -&gt; * -&gt; * where\n    VNil :: Vec 0 a\n    (:+) :: a -&gt; Vec n a -&gt; Vec (n + 1) a\n\ninfixr 5 :+\n\ninstance Show a =&gt; Show (Vec n a) where\n    show VNil = \" VNil\"\n    show (h :+ t) = show h ++ \" : \" ++ show t\n\nderiving instance (Typeable n, Typeable a) =&gt; Typeable (Vec n a)\n\nfromList :: [a] -&gt; Vec n a\nfromList xs = build xs\n  where \n    build (x:xs) = x :+ (build xs)\n    build ([]) = error \"fromList: list too short\"\n</code></pre>\n\n<pre><code>main.hs:27:15: error:\n    \u2022 Couldn't match expected type \u2018n\u2019 with actual type \u2018n + 1\u2019\n      \u2018n\u2019 is a rigid type variable bound by\n        the type signature for:\n          fromList :: forall a (n :: Nat). [a] -&gt; Vec n a\n        at main.hs:26:1-26\n    \u2022 In the expression: build xs\n      In an equation for \u2018fromList\u2019:\n          fromList xs\n            = build xs\n            where\n                build (x : xs) = x :+ (build xs)\n                build ([]) = error \"fromList: list too short\"\n    \u2022 Relevant bindings include\n        fromList :: [a] -&gt; Vec n a (bound at main.hs:27:1)\n   |\n27 | fromList xs = build xs\n   |              \n</code></pre>\n\n<p><a href=\"https://repl.it/repls/NotedFrozenCheckpoint\" rel=\"noreferrer\">Runnable code at repl.it</a></p>\n"}, {"tags": ["haskell", "type-conversion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1558707148, "post_id": 56294359, "comment_id": 99201243, "body": "That is because the <code>n</code> in your <code>teste</code> has one type, whereas in your <code>ghci</code>, the <code>5</code> in <code>sqrt</code> and <code>5</code> in <code>mod</code> have a different type."}, {"owner": {"reputation": 8720, "user_id": 3846213, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/5PGh1.jpg?s=128&g=1", "display_name": "Eli Korvigo", "link": "https://stackoverflow.com/users/3846213/eli-korvigo"}, "edited": false, "score": 1, "creation_date": 1558707389, "post_id": 56294359, "comment_id": 99201375, "body": "The error message gives you two correct hints &quot;add (RealFrac a) to the context of...&quot;  and &quot;add (Floating a) to the context of&quot;. If you write down the function in GHCI and let it infer the type, you&#39;ll have exactly that: <code>(Floating a, Integral a, RealFrac a) =&gt; a -&gt; a</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 8720, "user_id": 3846213, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/5PGh1.jpg?s=128&g=1", "display_name": "Eli Korvigo", "link": "https://stackoverflow.com/users/3846213/eli-korvigo"}, "edited": false, "score": 1, "creation_date": 1558707513, "post_id": 56294359, "comment_id": 99201437, "body": "@EliKorvigo: someting that is both <code>Floating</code> and <code>Integral</code> is strictly speaking possible in <i>Haskell</i>, but conceptually it does not make much sense."}, {"owner": {"reputation": 8720, "user_id": 3846213, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/5PGh1.jpg?s=128&g=1", "display_name": "Eli Korvigo", "link": "https://stackoverflow.com/users/3846213/eli-korvigo"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1558707646, "post_id": 56294359, "comment_id": 99201517, "body": "@WillemVanOnsem yes, I know. I was just pointing out, that the compiler gave two important hints as to why the function (as it is) does not compile with type signature <code>Integral a =&gt; a -&gt; a</code>"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1558707726, "last_edit_date": 1558707726, "creation_date": 1558707226, "answer_id": 56294429, "question_id": 56294359, "link": "https://stackoverflow.com/questions/56294359/how-to-make-type-conversion-in-haskell/56294429#56294429", "title": "How to make type conversion in Haskell?", "body": "<p>In your call <code>truncate (sqrt <b>5</b>) + mod <b>5</b> 2</code>, the <code>5</code>s have different types. Indeed the <code>5</code> in the <code>sqrt 5</code> should have as type <code>Floating a =&gt; a</code>, whereas the <code>5</code> in <code>mod 5 2</code> has type <code>Integral b =&gt; b</code>. Although it is, strictly speaking possible to construct a type in Haskell that is a member of both type families, conceptually it is <em>odd</em> that a type is both <code>Integral</code> and <code>Floating</code>, it would also only be applicable to such types, making it less useful. We thus could change the signature to:</p>\n\n<pre><code>teste :: (Integral a, <b>Floating a</b>, <b>RealFrac a</b>) =&gt; a -&gt; a\nteste n = truncate (sqrt n) + mod n 2</code></pre>\n\n<p>but as said before, this is not very <em>useful</em>.</p>\n\n<p>You can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:fromIntegral\" rel=\"noreferrer\"><strong><code>fromIntegral :: (Integral a, Num b) =&gt; a -&gt; b</code></strong></a> here to convert from an <code>Integral</code> type to any <code>Num</code> type, like:</p>\n\n<pre><code>teste :: Integral a =&gt; a -&gt; a\nteste n = truncate (sqrt (<b>fromIntegral</b> n)) + mod n 2</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; teste 5\n3\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 6169742, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-iFiftd6Wn0E/AAAAAAAAAAI/AAAAAAAAAeo/Px4SuVxMeBI/photo.jpg?sz=128", "display_name": "Alan Vin&#237;cius", "link": "https://stackoverflow.com/users/6169742/alan-vin%c3%adcius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1558707726, "creation_date": 1558706991, "question_id": 56294359, "link": "https://stackoverflow.com/questions/56294359/how-to-make-type-conversion-in-haskell", "title": "How to make type conversion in Haskell?", "body": "<p>I'm have the following code in the file main.hs:</p>\n\n<pre><code>teste :: Integral a =&gt; a -&gt; a\nteste n = truncate (sqrt n) + mod n 2\n</code></pre>\n\n<p>and i'm getting the following error from ghci when I try to load it:</p>\n\n<pre><code>Prelude&gt; :l main.hs \n[1 of 1] Compiling Main             ( main.hs, interpreted )\n\nmain.hs:12:11:\n    Could not deduce (RealFrac a) arising from a use of \u2018truncate\u2019\n    from the context (Integral a)\n      bound by the type signature for teste :: Integral a =&gt; a -&gt; a\n      at main.hs:11:10-29\n    Possible fix:\n      add (RealFrac a) to the context of\n        the type signature for teste :: Integral a =&gt; a -&gt; a\n    In the first argument of \u2018(+)\u2019, namely \u2018truncate (sqrt n)\u2019\n    In the expression: truncate (sqrt n) + mod n 2\n    In an equation for \u2018teste\u2019: teste n = truncate (sqrt n) + mod n 2\n\nmain.hs:12:21:\n    Could not deduce (Floating a) arising from a use of \u2018sqrt\u2019\n    from the context (Integral a)\n      bound by the type signature for teste :: Integral a =&gt; a -&gt; a\n      at main.hs:11:10-29\n    Possible fix:\n      add (Floating a) to the context of\n        the type signature for teste :: Integral a =&gt; a -&gt; a\n    In the first argument of \u2018truncate\u2019, namely \u2018(sqrt n)\u2019\n    In the first argument of \u2018(+)\u2019, namely \u2018truncate (sqrt n)\u2019\n    In the expression: truncate (sqrt n) + mod n 2\nFailed, modules loaded: none.\n</code></pre>\n\n<p>but when I run the same code in the interective mode, it works fine:</p>\n\n<pre><code>Prelude&gt; truncate (sqrt 5) + mod 5 2\n3\n</code></pre>\n"}, {"tags": ["haskell", "module", "ghc", "yesod", "template-haskell"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 5, "creation_date": 1558703645, "post_id": 56293278, "comment_id": 99199222, "body": "Could you give some more details on exactly which module, what&#39;s not being imported, etc.? The most helpful thing to supply would be an error message detailing exactly what is not in scope. It&#39;s very hard to answer this question without any of this information."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1558856180, "post_id": 56293278, "comment_id": 99232851, "body": "@bradrn I have added more information... Thx for the feedback.."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1558857894, "post_id": 56293278, "comment_id": 99233162, "body": "Thanks for adding more info - it makes more sense now."}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1558859431, "creation_date": 1558703036, "last_edit_date": 1558859431, "question_id": 56293278, "link": "https://stackoverflow.com/questions/56293278/see-implicit-exports-from-a-module", "title": "See implicit exports from a Module", "body": "<p>Quite surprisingly, I'm trying to fix a compilation warning <code>missing-export-lists</code> by adding explicitly the elements imported one by one for a specific module, but somehow there is something magical that this module is implicitly exporting that I can't find....</p>\n\n<p>is it possible to retrieve what is exported implicitly with ghc ?</p>\n\n<p>Here is an example of my issue, Yesod is generating some code with TH and quasiquotes : </p>\n\n<pre><code>{-# LANGUAGE EmptyDataDecls             #-}\n{-# LANGUAGE FlexibleContexts           #-}\n{-# LANGUAGE GADTs                      #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n{-# LANGUAGE OverloadedStrings          #-}\n{-# LANGUAGE QuasiQuotes                #-}\n{-# LANGUAGE TemplateHaskell            #-}\n{-# LANGUAGE TypeFamilies               #-}\nimport           Control.Monad.IO.Class  (liftIO)\nimport           Database.Persist\nimport           Database.Persist.Sqlite\nimport           Database.Persist.TH\n\nshare [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nPerson\n    name String\n    age Int Maybe\n    deriving Show\n|]\n</code></pre>\n\n<p>Then let's say we use that generated code that way : </p>\n\n<pre><code>people &lt;- selectList\n    (       [PersonAge &gt;. 25, PersonAge &lt;=. 30]\n        ||. [PersonName /&lt;-. [\"Adam\", \"Bonny\"]]\n        ||. ([PersonAge ==. 50] ||. [PersonAge ==. 60])\n    )\n    []\nliftIO $ print people\n</code></pre>\n\n<p>Now I want to put share in a specific module and control precisely what I'm exporting from that code generated.</p>\n\n<p>I don't know how it generates <code>PersonName</code> and <code>PersonAge</code> ! I don't how to specifically import these 2 types for example...</p>\n"}, {"tags": ["haskell", "function-composition"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1558699666, "post_id": 56292345, "comment_id": 99197026, "body": "With an operator <code>(x &amp;)</code>, this is equivalent to <code>(&amp;) x</code>, so you wrote <code>(.) last</code>, so it expects a function <code>f</code> as second parameter, and then creates a function <code>last . f</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1558699817, "creation_date": 1558699817, "answer_id": 56292447, "question_id": 56292345, "link": "https://stackoverflow.com/questions/56292345/how-does-this-usage-of-the-composition-operator-work-without-a-second-argument/56292447#56292447", "title": "How does this usage of the composition operator work without a second argument?", "body": "<p>This is an example of <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"noreferrer\"><em>infix operator sectioning</em> [Haskell-wiki]</a>:</p>\n\n<blockquote>\n  <p>(...)</p>\n  \n  <p><code>(2^)</code> (left section) is equivalent to <code>(^) 2</code>, or more verbosely <code>\\x -&gt; 2 ^ x</code>.</p>\n</blockquote>\n\n<p>So we here constructed a function that looks like:</p>\n\n<pre><code><b>\\f -&gt;</b> last . <b>f</b></code></pre>\n\n<p>or shorter:</p>\n\n<pre><code>(.) last</code></pre>\n\n<p>The <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:.\" rel=\"noreferrer\"><strong><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code></strong></a> function takes two functions <code>g</code> and <code>h</code>, and creates a function <code>\\x -&gt; g (h x)</code>. Here <code>g</code> is thus <code>last</code>.</p>\n\n<p>We thus created a function that takes as input a function <code>f :: b -&gt; [c]</code>, that then returns <code>last . f</code>.</p>\n"}], "owner": {"reputation": 63, "user_id": 4825512, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MyqzS.jpg?s=128&g=1", "display_name": "Maarten ten Velden", "link": "https://stackoverflow.com/users/4825512/maarten-ten-velden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 56292447, "answer_count": 1, "score": 4, "last_activity_date": 1558699817, "creation_date": 1558699477, "question_id": 56292345, "link": "https://stackoverflow.com/questions/56292345/how-does-this-usage-of-the-composition-operator-work-without-a-second-argument", "title": "How does this usage of the composition operator work without a second argument?", "body": "<p>I came across a usage of the . operator that I don't quite understand.</p>\n\n<p>I tried to reason about it myself, but the conclusion I reach is different from what GHCI produces.</p>\n\n<p>I'm using <code>:t</code> to inspect the type of the expression.</p>\n\n<p>The functions I'm using are the <code>last</code> and <code>(.)</code>, which have the following signatures:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>last :: [a] -&gt; a\n(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>The function I am confused about is this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(last .)\n</code></pre>\n\n<p>I am not sure what this construct is, but I assumed that it would be similar to function composition.\nUsing my reasoning, I would expect this to produce the following function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(last .) :: (b -&gt; [c]) -&gt; (a -&gt; b) -&gt; a -&gt; [c]\n</code></pre>\n\n<p>What <code>:t</code> actually gives me is this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(last .) :: (a -&gt; [c]) -&gt; a -&gt; c\n</code></pre>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 482, "user_id": 6931261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95c4e2b912aeec1888a96026c1fb4311?s=128&d=identicon&r=PG&f=1", "display_name": "ecthiender", "link": "https://stackoverflow.com/users/6931261/ecthiender"}, "edited": false, "score": 0, "creation_date": 1558648663, "post_id": 56283441, "comment_id": 99180806, "body": "I also couldn&#39;t phrase the title correctly. Which shows my lack of understanding of the concept/idea, I guess."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558648791, "post_id": 56283441, "comment_id": 99180846, "body": "Why do you use <code>Left</code> here, shouldn&#39;t you ure <code>logError = logResult</code>? In fact it makes more sense to write it like <code>logError MonadIO m :: Either MyError a -&gt; m()</code> that thus unpacks it, and in case of a <code>Left</code> logs the error, and otherwise does not do anything."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1558648841, "post_id": 56283441, "comment_id": 99180862, "body": "At first sight it looks like you defined <code>logError</code> in a <code>where</code> clause? In that case, it is likely a result of the <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow noreferrer\">monomorphic restriction</a>."}, {"owner": {"reputation": 482, "user_id": 6931261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95c4e2b912aeec1888a96026c1fb4311?s=128&d=identicon&r=PG&f=1", "display_name": "ecthiender", "link": "https://stackoverflow.com/users/6931261/ecthiender"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558648864, "post_id": 56283441, "comment_id": 99180872, "body": "No. I already have <code>logResult</code> for that. I need <code>logError</code> in case where I want to use <code>either logError return result</code>"}, {"owner": {"reputation": 482, "user_id": 6931261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95c4e2b912aeec1888a96026c1fb4311?s=128&d=identicon&r=PG&f=1", "display_name": "ecthiender", "link": "https://stackoverflow.com/users/6931261/ecthiender"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558648933, "post_id": 56283441, "comment_id": 99180890, "body": "@WillemVanOnsem <code>logError</code> is not defined in a where clause. Should I post more code details?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1558649049, "post_id": 56283441, "comment_id": 99180913, "body": "ah, I got it, by using <code>Left err</code>, you know that the type is <code>Either MyError a</code>, but what <code>a</code> is, is unclear. You could perhaps solve it, by forcing a type for which you know a <code>ToJSON</code> exists, like: <code>logError err = logResult (Left err :: Either MyError Int)</code>."}, {"owner": {"reputation": 482, "user_id": 6931261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95c4e2b912aeec1888a96026c1fb4311?s=128&d=identicon&r=PG&f=1", "display_name": "ecthiender", "link": "https://stackoverflow.com/users/6931261/ecthiender"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558649203, "post_id": 56283441, "comment_id": 99180958, "body": "@WillemVanOnsem Ah Thanks! That worked! It sure looks hacky though. Is there any extension that enables this sort of thing?"}, {"owner": {"reputation": 482, "user_id": 6931261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95c4e2b912aeec1888a96026c1fb4311?s=128&d=identicon&r=PG&f=1", "display_name": "ecthiender", "link": "https://stackoverflow.com/users/6931261/ecthiender"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558649274, "post_id": 56283441, "comment_id": 99180983, "body": "@WillemVanOnsem Also, how can I phrase my title better?"}], "answers": [{"comments": [{"owner": {"reputation": 482, "user_id": 6931261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95c4e2b912aeec1888a96026c1fb4311?s=128&d=identicon&r=PG&f=1", "display_name": "ecthiender", "link": "https://stackoverflow.com/users/6931261/ecthiender"}, "edited": false, "score": 0, "creation_date": 1558800107, "post_id": 56283973, "comment_id": 99223468, "body": "Thanks for the detailed answer. I understand it now. Splitting it into two functions make sense."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 11, "last_activity_date": 1558653028, "creation_date": 1558653028, "answer_id": 56283973, "question_id": 56283441, "link": "https://stackoverflow.com/questions/56283441/how-to-not-apply-instance-constraints-on-a-restricted-function-which-uses-a-more/56283973#56283973", "title": "How to not apply instance constraints on a restricted function which uses a more generic function?", "body": "<p>Why is this one function? If the behavior of this function splits so cleanly into two, then it should <em>be</em> two functions. That is, you've written one monolithic function and are trying to define a simpler function as a utility using it. Instead, write a simple function and write the monolithic function as a composition of it with another. The type is pretty much asking for it: <code>Either a b -&gt; c</code> is isomorphic to <code>(a -&gt; c, b -&gt; c)</code>.</p>\n\n<pre><code>-- you may need to factor out some common utility stuff, too\nlogError :: (MonadIO m) :: MyError -&gt; m ()\nlogResponse :: (MonadIO m, ToJSON a) =&gt; Response a -&gt; m ()\n\nlogResult :: (MonadIO m, ToJSON a) =&gt; Either MyError (Response a) -&gt; m ()\nlogResult = either logError logResponse\n</code></pre>\n\n<p><code>logResult</code> still has its uses; if you get an <code>Either MyError (Response a)</code> from some library, then <code>logResult</code> can deal with it without much fuss. But, otherwise, you shouldn't be writing <code>logResult (Left _)</code> or <code>logResult (Right _)</code> very often; that essentially treats <code>logResult . Left</code> and <code>logResult . Right</code> as their own functions, which leads you back to actually writing them as separate functions.</p>\n\n<blockquote>\n  <p>But in <code>logError</code> I am explicitly passing <code>Left MyError</code>. Shouldn't this disambiguate?</p>\n</blockquote>\n\n<p>No, it shouldn't. The end and beginning of the issue is that <code>logResult</code> looks like this:</p>\n\n<pre><code>logResult :: (MonadIO m, ToJSON a) =&gt; Either MyError (Response a) -&gt; m ()\n</code></pre>\n\n<p>When you call it, the implementation doesn't matter one lick. The type says you need <code>ToJSON a</code>\u2014you need to provide <code>ToJSON a</code>. That's it. If you know that you don't need <code>ToJSON a</code> for <code>Left</code> values, then you possess useful information that is not reflected in the type. You should add that information to the type, which, in this case, means splitting it into two. It would (IMO) actually be bad language design to allow what you were thinking of, because the halting problem should make it impossible to do correctly.</p>\n"}], "owner": {"reputation": 482, "user_id": 6931261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95c4e2b912aeec1888a96026c1fb4311?s=128&d=identicon&r=PG&f=1", "display_name": "ecthiender", "link": "https://stackoverflow.com/users/6931261/ecthiender"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 1, "accepted_answer_id": 56283973, "answer_count": 1, "score": 10, "last_activity_date": 1558653028, "creation_date": 1558648619, "question_id": 56283441, "link": "https://stackoverflow.com/questions/56283441/how-to-not-apply-instance-constraints-on-a-restricted-function-which-uses-a-more", "title": "How to not apply instance constraints on a restricted function which uses a more generic function?", "body": "<p>Let's say I have a function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>logResult :: (MonadIO m, ToJSON a) =&gt; Either MyError (Response a) -&gt; m ()\nlogResult = ...\n</code></pre>\n\n<p>In this function, if I get:</p>\n\n<ol>\n<li><code>Right (Response a)</code> - I call <code>toJSON</code> to log the result. </li>\n<li><code>Left MyError</code> - I log it as well. <code>MyError</code> already has a <code>ToJSON</code> instance defined.</li>\n</ol>\n\n<p>Now I want to write a helper function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>logError :: (MonadIO m) :: MyError -&gt; m ()\nlogError err = logResult (Left err)\n</code></pre>\n\n<p>But GHC complains something along the following lines:</p>\n\n<pre><code>    \u2022 Could not deduce (ToJSON a0) arising from a use of \u2018logResult\u2019                                                                    \n      from the context: MonadIO m                                                                                                       \n        bound by the type signature for:                                                                                                \n                   logError :: forall (m :: * -&gt; *).                                                                                    \n                               MonadIO m =&gt;                                                                                             \n                               L.Logger                                                                                                 \n                               -&gt; Wai.Request\n                               -&gt; MyError\n                               -&gt; m ()\n\n...\n...\nThe type variable \u2018a0\u2019 is ambiguous \n</code></pre>\n\n<p>I understand the error is because <code>logResult</code> needs to guarantee that the <code>a</code> in <code>Response a</code> must have a <code>ToJSON</code> instance defined. But in <code>logError</code> I am explicitly passing <code>Left MyError</code>. Shouldn't this disambiguate ?</p>\n\n<p>Is there any way I can write the <code>logError</code> helper function ?</p>\n\n<p>PS: I have simplified the type signatures in the example. The error message has the gory details.</p>\n"}, {"tags": ["haskell", "functor", "category-abstractions"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1558638833, "post_id": 56281416, "comment_id": 99177143, "body": "It is impossible because <code>Set</code> is not a <code>Functor</code>."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 11, "last_activity_date": 1558638236, "creation_date": 1558638236, "answer_id": 56281494, "question_id": 56281416, "link": "https://stackoverflow.com/questions/56281416/why-this-structure-preserving-fmap-cannot-be-acepted-in-this-functors-class-i/56281494#56281494", "title": "Why this structure-preserving &quot;fmap&quot; cannot be acepted in this Functor&#39;s class instance?", "body": "<p><code>mapRightR</code> is constrained, it will not work for <em>any</em> type <code>b</code> as <code>fmap</code> requires:</p>\n\n<pre><code>-- Specialized for f ~ Relation c\nfmap ::               (a -&gt; b) -&gt; Relation c a -&gt; Relation c b\n</code></pre>\n\n<p>but</p>\n\n<pre><code>mapRightR :: Ord b =&gt; (a -&gt; b) -&gt; Relation c a -&gt; Relation c b\n</code></pre>\n\n<hr>\n\n<p>In more categorical terms, <code>Relation c</code> is not an endofunctor that maps <strong>Hask</strong> to <strong>Hask</strong> (which is what the <code>Functor</code> typeclass represents), but rather a functor that maps a subcategory of <strong>Hask</strong> consisting only of types with <code>Ord</code> instances to <strong>Hask</strong>. (I think I characterized this correctly; corrections welcome.)</p>\n"}], "owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 56281494, "answer_count": 1, "score": 3, "last_activity_date": 1559485664, "creation_date": 1558637845, "last_edit_date": 1559485664, "question_id": 56281416, "link": "https://stackoverflow.com/questions/56281416/why-this-structure-preserving-fmap-cannot-be-acepted-in-this-functors-class-i", "title": "Why this structure-preserving &quot;fmap&quot; cannot be acepted in this Functor&#39;s class instance?", "body": "<p>The below defined function <strong>mapRightR</strong> change only the map's set contents, not the keys and produce a valid Relation type.</p>\n\n<p>Is it really impossible use this high-level function to define the Functor Relation instance, or is my implementation wrong.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nimport Data.Map as M\nimport Data.Set as S\n\ndata Relation a b where\n    R :: (Ord a, Ord b) =&gt; Map a (Set b) -&gt; Relation a b\n\ninstance Functor Relation where\n    fmap f r = mapRightR f r\n\nmapRightR :: Ord b1 =&gt; (b2 -&gt; b1) -&gt; Relation a b2 -&gt; Relation a b1\nmapRightR f (R r) = R $ M.map (S.map f) r\n</code></pre>\n\n<p>Thanks, <strong>chepner</strong>.</p>\n\n<p>I tried another definition of Relation, using <em>List</em> instead of Set and it work!</p>\n\n<pre><code>data Relation a b where\n    R :: (Ord a) =&gt; Map a [b] -&gt; Relation a b\n\ninstance Functor (Relation a) where\n    fmap f r = mapRightR f r\n\nmapRightR :: (b2 -&gt; b1) -&gt; Relation a b2 -&gt; Relation a b1\nmapRightR f (R r) = R $ M.map (L.map f) r\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1558630200, "post_id": 56279676, "comment_id": 99173544, "body": "You can use <code>safeGetRow :: Matrix a -&gt; Maybe (Vector a)</code>. Qustion is what you want to do in case the <code>n</code> is &quot;out of range&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 6741684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cf62a32d3748bb826d93f9b8891c32b?s=128&d=identicon&r=PG&f=1", "display_name": "lachrimae", "link": "https://stackoverflow.com/users/6741684/lachrimae"}, "edited": false, "score": 0, "creation_date": 1558631672, "post_id": 56279877, "comment_id": 99174161, "body": "Which option would you decide? What factors would you weigh in making this kind of decision in other contexts? I think I&#39;m in favour of the &quot;return an empty list&quot; idea here, but I&#39;m curious how this would be done in other contexts."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 69, "user_id": 6741684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cf62a32d3748bb826d93f9b8891c32b?s=128&d=identicon&r=PG&f=1", "display_name": "lachrimae", "link": "https://stackoverflow.com/users/6741684/lachrimae"}, "edited": false, "score": 1, "creation_date": 1558631954, "post_id": 56279877, "comment_id": 99174284, "body": "@lachrimae: personally I would use the one with a <code>Maybe</code>, since then the result has extra data: there is after all a difference between an &quot;index out of range&quot;, and a row without <code>True</code>s, but that of course is more &quot;personal taste&quot;."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 69, "user_id": 6741684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cf62a32d3748bb826d93f9b8891c32b?s=128&d=identicon&r=PG&f=1", "display_name": "lachrimae", "link": "https://stackoverflow.com/users/6741684/lachrimae"}, "edited": false, "score": 1, "creation_date": 1558718278, "post_id": 56279877, "comment_id": 99206361, "body": "This is a moment where <a href=\"https://ucsd-progsys.github.io/liquidhaskell-blog/\" rel=\"nofollow noreferrer\">liquid haskell</a> could be quite nice also, since if the program is correctly written you should never hit an out of range condition, so it&#39;s more like a compile time invariant. You would have to do some work to get Matrix into its brain though, I think. @lachrimae"}, {"owner": {"reputation": 69, "user_id": 6741684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cf62a32d3748bb826d93f9b8891c32b?s=128&d=identicon&r=PG&f=1", "display_name": "lachrimae", "link": "https://stackoverflow.com/users/6741684/lachrimae"}, "edited": false, "score": 0, "creation_date": 1558725895, "post_id": 56279877, "comment_id": 99209318, "body": "Have Haskellers adopted Liquid Haskell as a &quot;standard tool&quot;, or do they use it in specialized situations? It looks very cool, and I&#39;m wondering whether this is something that should become core to my practices or not."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1558631312, "last_edit_date": 1558631312, "creation_date": 1558630616, "answer_id": 56279877, "question_id": 56279676, "link": "https://stackoverflow.com/questions/56279676/is-there-a-way-to-rewrite-this-function-to-be-total/56279877#56279877", "title": "Is there a way to rewrite this function to be total?", "body": "<p>You can make use of <a href=\"https://hackage.haskell.org/package/matrix-0.3.6.1/docs/Data-Matrix.html#v:safeGetRow\" rel=\"noreferrer\"><strong><code>safeGetRow :: Matrix a -&gt; Maybe (Vector a)</code></strong></a> that will return a <code>Nothing</code> in case the index is out of range.</p>\n\n<p>The question is of course what we do in case the index is out of range. Two reasonable options are:</p>\n\n<ol>\n<li>use <code>Maybe [Int]</code> instead of <code>[Int]</code> as return type and return a <code>Nothing</code>; or</li>\n<li>return an empty list, since if the node is not in the adjacency matrix, it has no neignbors.</li>\n</ol>\n\n<p>We can for example implement this as:</p>\n\n<pre><code>import Data.Matrix(Matrix, safeGetRow)\nimport Data.Vector(toList)\n\nneighbours :: AdjacencyMatrix -&gt; Int -&gt; <b>Maybe</b> [Int]\nneighbours mat n = map fst . filter snd . zip [0..] . <b>toList</b> &lt;$&gt; safeGetRow n mat</code></pre>\n\n<p>We here make use of <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector.html#v:toList\" rel=\"noreferrer\"><strong><code>toList :: Vector a -&gt; [a]</code></strong></a> to prevent using <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector.html#v:-33-\" rel=\"noreferrer\"><strong><code>(!) :: Vector a -&gt; Int -&gt; a</code></strong></a> which <em>looks</em> unsafe: you used correc indices, but this requires some reasoning, whereas <code>toList</code> is a total function, and thus clearly will always produce a result.</p>\n\n<p>We can make this more compact by using <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector.html#v:findIndices\" rel=\"noreferrer\"><strong><code>findIndices :: (a -&gt; Bool) -&gt; Vector a -&gt; Vector Int</code></strong></a>:</p>\n\n<pre><code>import Data.Matrix(Matrix, safeGetRow)\nimport Data.Vector(<b>findIndices</b>, toList)\n\nneighbours :: AdjacencyMatrix -&gt; Int -&gt; Maybe [Int]\nneighbours mat n = toList . <b>findIndices id</b> &lt;$&gt; safeGetRow n mat</code></pre>\n\n<p>Or we can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:maybe\" rel=\"noreferrer\"><strong><code>maybe :: b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b</code></strong></a> to use an empty list instead:</p>\n\n<pre><code>import Data.Matrix(Matrix, safeGetRow)\nimport Data.Maybe(<b>maybe</b>)\nimport Data.Vector(findIndices, toList)\n\nneighbours :: AdjacencyMatrix -&gt; Int -&gt; <b>[Int]</b>\nneighbours mat n = <b>maybe</b> [] (toList . findIndices id) (safeGetRow n mat)</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 6741684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cf62a32d3748bb826d93f9b8891c32b?s=128&d=identicon&r=PG&f=1", "display_name": "lachrimae", "link": "https://stackoverflow.com/users/6741684/lachrimae"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 56279877, "answer_count": 1, "score": 4, "last_activity_date": 1558631312, "creation_date": 1558629723, "question_id": 56279676, "link": "https://stackoverflow.com/questions/56279676/is-there-a-way-to-rewrite-this-function-to-be-total", "title": "Is there a way to rewrite this function to be total?", "body": "<p>I have a function, shown below, which someone on Code Review suggested I rewrite to be total. They suggested that the calls to <code>getRow</code> and <code>(!)</code> could be replaced with calls to <code>zip</code> or <code>fold</code>.</p>\n\n<p>I've thought about this and I can't really see how to rewrite it that way, nor do I have a good sense of how I would teach myself how to rewrite it. </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Matrix (Matrix, getRow, ncols)\nimport Data.Vector ((!))\n\ntype AdjacencyMatrix = Matrix Bool\n\n-- Input: the graph's adjacency matrix and a vertex. \n-- Output: the list of neighbours of that vertex.\nneighbours :: AdjacencyMatrix -&gt; Int -&gt; [Int]\nneighbours mat n = filter (\\m -&gt; row ! m) [0..(ncols mat)-1]\n        where row = getRow n mat\n</code></pre>\n\n<p>This code snippet works within the context of my program, but if <code>n</code> is larger than <code>(ncols mat) - 1</code> then some of the <code>row ! m</code> calls will fail.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1558631190, "post_id": 56279471, "comment_id": 99173967, "body": "I bet they differ when stacking preprocessors."}, {"owner": {"reputation": 814, "user_id": 942396, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/btk1s.jpg?s=128&g=1", "display_name": "Gaith", "link": "https://stackoverflow.com/users/942396/gaith"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1558697386, "post_id": 56279471, "comment_id": 99195833, "body": "@Carl Could you provide an example for how preprocessors can be stacked?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1558704983, "post_id": 56279471, "comment_id": 99199998, "body": "Enable the <code>CPP</code> extension, for instance."}], "owner": {"reputation": 814, "user_id": 942396, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/btk1s.jpg?s=128&g=1", "display_name": "Gaith", "link": "https://stackoverflow.com/users/942396/gaith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1558628823, "creation_date": 1558628823, "question_id": 56279471, "link": "https://stackoverflow.com/questions/56279471/what-is-the-difference-between-the-first-two-arguments-given-to-a-haskell-custom", "title": "What is the difference between the first two arguments given to a Haskell custom pre-processor when invoked using -F -pgmF?", "body": "<p>From <a href=\"https://downloads.haskell.org/~ghc/8.6.5/docs/html/users_guide/phases.html#options-affecting-a-haskell-pre-processor\" rel=\"nofollow noreferrer\">GHC 8.6.5 User Guide $10.11.3</a>:</p>\n\n<blockquote>\n  <p>Use -pgmF cmd to select the program to use as the preprocessor. When\n  invoked, the cmd pre-processor is given at least three arguments on\n  its command-line: the first argument is the name of the original\n  source file, the second is the name of the file holding the input, and\n  the third is the name of the file where cmd should write its output\n  to.</p>\n</blockquote>\n\n<p>I have tried to write an example pre-processor to see what is the difference between the three arguments passed to the pre-processor.</p>\n\n<p>I have the following two files:</p>\n\n<p><strong>Main.hs</strong></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# OPTIONS_GHC -F -pgmF preprocess.sh #-}\n</code></pre>\n\n<p><strong>preprocess.sh</strong></p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>#!/bin/sh\n\necho $1 \" -- the original source file\"\necho $2 \" -- file holding the input\"\necho $3 \" -- the file where cmd should write its output to\"\n\necho \"{-# LINE 1 \\\"$2\\\" #-}\\nmain = return ()\" &gt; $3\n</code></pre>\n\n<p>When I compile the Haskell file using <code>ghc</code>, I get the following output:</p>\n\n<pre><code>Main.hs  -- the original source file\nMain.hs  -- file holding the input\n/tmp/ghc13496_0/ghc_1.hspp  -- the file where cmd should write its output to\n</code></pre>\n\n<p>Should the first two arguments be always identical? and in which cases can they have different values?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1558627479, "post_id": 56279054, "comment_id": 99172370, "body": "What do you believe are the types of <code>t1</code> and <code>t2</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1558627590, "post_id": 56279054, "comment_id": 99172416, "body": "Also, for your future reference: when reporting an error, it is best to report the <i>complete</i> error."}], "answers": [{"tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": true, "score": 4, "last_activity_date": 1558628902, "creation_date": 1558628902, "answer_id": 56279499, "question_id": 56279054, "link": "https://stackoverflow.com/questions/56279054/couldnt-match-expected-type-in-haskell-error/56279499#56279499", "title": "Couldn&#39;t match expected type in Haskell error", "body": "<p>The type of <code>foldl1</code> is <code>Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a</code>. Notice that the higher order function must have the same output type as its two input types. Therefore, you need to return <code>t1</code> or <code>t2</code>, not <code>date t1</code> or <code>date t2</code>.</p>\n\n<p>Also, since <code>t1</code> and <code>t2</code> have type <code>Measuring</code>, they can't be subtracted from <code>averageTemp lst</code>. You need to extract the <code>Float</code> value with <code>temp</code>.</p>\n\n<pre><code>closestToAverage :: [Measuring] -&gt; Int\nclosestToAverage lst = date $ foldl1 (\\t1 t2 -&gt;\n        if abs (averageTemp lst - temp t1) &lt;= abs (averageTemp lst - temp t2)\n            then t1\n            else t2\n    ) lst\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 11461094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9bfb11cd4f0864677ca94b284a5e1c2?s=128&d=identicon&r=PG&f=1", "display_name": "headfxll", "link": "https://stackoverflow.com/users/11461094/headfxll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 56279499, "answer_count": 1, "score": 2, "last_activity_date": 1558628902, "creation_date": 1558627218, "last_edit_date": 1558628083, "question_id": 56279054, "link": "https://stackoverflow.com/questions/56279054/couldnt-match-expected-type-in-haskell-error", "title": "Couldn&#39;t match expected type in Haskell error", "body": "<p>I am having a problem with my code in Haskell. For the task we have data that has type Int for date and type Float for temperature degree. I have to define a function that returns the date on which the temperature has been close to the monthly average. Here is my code:</p>\n\n<pre><code>data Measuring = Temp Int Float\n\ntemp :: Measuring -&gt; Float\ntemp (Temp _ tem) = tem\n\ndate :: Measuring -&gt; Int\ndate (Temp dat _) = dat\n\naverageTemp :: [Measuring] -&gt; Float\naverageTemp lst = (foldr1 (+) (map temp lst)) / fromIntegral (length lst)\n\nclosestToAverage :: [Measuring] -&gt; Int\nclosestToAverage lst = foldl1 (\\ t1 t2 -&gt; if abs(averageTemp lst - t1) &lt;= \nabs(averageTemp lst - t2)\nthen date t1 else date t2) lst\n</code></pre>\n\n<p>The error </p>\n\n<pre><code>\"* Couldn't match expected type `Int' with actual type `Float'\n    * In the expression:\n        foldl1\n          (\\ t1 t2\n             -&gt; if abs (averageTemp lst - t1) &lt;= abs (averageTemp lst - t2) then\n                    date t1\n                else\n                    date t2)\n          lst\n      In an equation for `closestToAverage':\n          closestToAverage lst\n            = foldl1\n                (\\ t1 t2\n                   -&gt; if abs (averageTemp lst - t1) &lt;= abs (averageTemp lst - t2) then\n                          date t1\n                      else\n                          date t2)\n                lst\n   |\n83 | closestToAverage lst = foldl1 (\\ t1 t2 -&gt; if abs(averageTemp lst - t1) &lt;= abs(averageTemp lst - t2)\n\n   |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\"\n</code></pre>\n"}, {"tags": ["haskell", "liquid-haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1558621063, "post_id": 56277234, "comment_id": 99168812, "body": "The documentation specifies that <code>[lq| type Nat = {v:Int | 0 &lt;= v} |]</code>, so it is a <i>subset</i>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1558621122, "post_id": 56277234, "comment_id": 99168850, "body": "Your annotation states that if you take the difference of two <code>Nat</code>s, the result is an <code>Int</code>, which looks correct. By contrast, <code>Nat -&gt; Nat -&gt; Nat</code> would fail. Hence, they are not the same."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1558621186, "post_id": 56277234, "comment_id": 99168880, "body": "hm, makes sense, so why this snippet passes verification? What will happen if I call <code>sub</code> somewhere with <code>-1</code> as arguments? LH should fail? May be LH does not require to match the signature totally?"}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1558621312, "post_id": 56277234, "comment_id": 99168964, "body": "@chi seems that <code>sub</code> in LH is &quot;subset&quot; of <code>sub</code> in Haskell (if we can say it)? And both functions signatures may be little bit different (I tried <code>Float</code> and LH detects error)."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558621495, "post_id": 56277234, "comment_id": 99169093, "body": "@Paul-AG: that is because the &quot;root type&quot; is <code>Int</code>, as is specified by <code>v:Int</code>."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558622705, "post_id": 56277234, "comment_id": 99169816, "body": "@WillemVanOnsem so it&#39;s not like <code>newtype</code> but like <code>type</code>? And another question: LH wants to match the type of result totally and fails if subrange of result does not match refinement type in contract. But it is satisfied just with <i>root type</i> when it matches types of arguments?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1558626771, "post_id": 56277234, "comment_id": 99171991, "body": "@Paul-AG It&#39;s not a totally different type (<code>newtype</code>) or a synonym for an existing type (<code>type</code>).  It&#39;s a refinement type.  That is, it&#39;s a value of the same type with a refinement - additional restrictions on the value. It type checks if Liquid Haskell can prove that all the refinements are valid."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1558625766, "creation_date": 1558625766, "answer_id": 56278679, "question_id": 56277234, "link": "https://stackoverflow.com/questions/56277234/why-is-nat-type-equal-to-int-in-liquid-haskell/56278679#56278679", "title": "Why is Nat type equal to Int in Liquid Haskell?", "body": "<p>Suppose you say to me, \"Hey, I'd like an apple!\". I reply: \"Sorry, I only have <em>red</em> apples.\". You're going to look at me pretty funny, huh? A red apple <em>is</em> an apple!</p>\n\n<p>If a function asks for an <code>Int</code> as an argument, it's no problem to hand it an <code>Int</code> that you know is not negative.</p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 56278679, "answer_count": 1, "score": 4, "last_activity_date": 1558625766, "creation_date": 1558620955, "last_edit_date": 1558624929, "question_id": 56277234, "link": "https://stackoverflow.com/questions/56277234/why-is-nat-type-equal-to-int-in-liquid-haskell", "title": "Why is Nat type equal to Int in Liquid Haskell?", "body": "<p>Why does this pass Liquid Haskell verification?</p>\n\n<pre><code>{-@ sub :: Nat -&gt; Nat -&gt; Int @-}                                                                                                         \nsub :: Int -&gt; Int -&gt; Int \nsub i j = i - j \n</code></pre>\n\n<p>Does it mean that <code>Nat</code> is the same as <code>Int</code> from LH's point of view?</p>\n"}, {"tags": ["haskell", "liquid-haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1558619847, "post_id": 56276815, "comment_id": 99168052, "body": "Those are not comments, but &quot;contracts&quot; that you put in between the <code>{-@ ... @-}</code>. Yes you can use <code>--</code> for <i>comments</i>."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558620312, "post_id": 56276815, "comment_id": 99168356, "body": "OK, correct terminology is &quot;contract&quot;. I tried to use <code>--</code> for contracts, but LH ignores them, so, is it possible to use it for <i>contracts</i>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558620499, "post_id": 56276815, "comment_id": 99168476, "body": "as far as I know, it is not, <code>--</code> will ignore what is put in the rest of that line."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1558623590, "creation_date": 1558623590, "answer_id": 56278047, "question_id": 56276815, "link": "https://stackoverflow.com/questions/56276815/is-it-possible-to-use-one-line-contracts-in-liquid-haskell/56278047#56278047", "title": "Is it possible to use one line contracts in Liquid Haskell?", "body": "<p>No.  Looking at the source code for Liquid Haskell (in the file <code>src/Language/Haskell/Liquid/GHC/Interface.hs</code>), extraction of specifications is performed by the function <code>extractSpecComment</code>.  This searches for comments of type <code>AnnBlockComment</code> (which are comments in the <code>{-...-}</code> style) for those with an initial <code>{-@</code> and terminating <code>@-}</code>.  No other comment style is supported.</p>\n"}, {"tags": [], "owner": {"reputation": 19, "user_id": 11545405, "user_type": "registered", "profile_image": "https://graph.facebook.com/10214195335342636/picture?type=large", "display_name": "\u0394\u03b7\u03bc\u03ae\u03c4\u03c1\u03b7\u03c2 \u039a\u03b1\u03c0\u03bf\u03c5\u03c1\u03ac\u03bd\u03b7\u03c2", "link": "https://stackoverflow.com/users/11545405/%ce%94%ce%b7%ce%bc%ce%ae%cf%84%cf%81%ce%b7%cf%82-%ce%9a%ce%b1%cf%80%ce%bf%cf%85%cf%81%ce%ac%ce%bd%ce%b7%cf%82"}, "is_accepted": false, "score": 1, "last_activity_date": 1558624052, "creation_date": 1558624052, "answer_id": 56278177, "question_id": 56276815, "link": "https://stackoverflow.com/questions/56276815/is-it-possible-to-use-one-line-contracts-in-liquid-haskell/56278177#56278177", "title": "Is it possible to use one line contracts in Liquid Haskell?", "body": "<p>No the only way to comment is putting yout comment :</p>\n\n<pre><code>{% comment %} Like this. {% endcomment %}\n</code></pre>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 56278047, "answer_count": 2, "score": 3, "last_activity_date": 1558710969, "creation_date": 1558619609, "last_edit_date": 1558710969, "question_id": 56276815, "link": "https://stackoverflow.com/questions/56276815/is-it-possible-to-use-one-line-contracts-in-liquid-haskell", "title": "Is it possible to use one line contracts in Liquid Haskell?", "body": "<p>Liquid Haskell uses comments like <code>{-@ ... @-}</code> for contracts block. Is it possible (with command line option, config file) to specify to use one line comments style like <code>-- ...</code> for contracts ?</p>\n"}, {"tags": ["haskell", "exception"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 6, "creation_date": 1558617155, "post_id": 56275990, "comment_id": 99166412, "body": "You don&#39;t that&#39;s why using exceptions is usually a bad practice. Usually <code>Either</code> and <code>Maybe</code>, or <code>ExceptT</code> are used for computations that might fail. Here the documentation mentions the <code>HttpException</code> and <code>JsonError</code> however: <a href=\"https://hackage.haskell.org/package/wreq-0.5.3.2/docs/Network-Wreq.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/wreq-0.5.3.2/docs/Network-Wreq.h&zwnj;&#8203;tml</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1558619726, "post_id": 56275990, "comment_id": 99167979, "body": "I reject the implicit assumption that &quot;read the documentation&quot; is an unreasonable expectation."}, {"owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "edited": false, "score": 1, "creation_date": 1558621409, "post_id": 56275990, "comment_id": 99169026, "body": "You may be able to trust that a given library&#39;s code is executing correctly by examining the documentation and perhaps the tests. How much trust do you have that a given library&#39;s author has documented all exceptions? And, will you be also checking every dependent library&#39;s documentation?"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1558728508, "creation_date": 1558728508, "answer_id": 56298959, "question_id": 56275990, "link": "https://stackoverflow.com/questions/56275990/how-to-discover-what-exceptions-can-be-thrown-in-haskell/56298959#56298959", "title": "How to discover what exceptions can be thrown in Haskell?", "body": "<p>There is no means in Haskell for determining which runtime exceptions a function might throw.</p>\n\n<p>If you're coming from Java with its \"checked\" and \"unchecked\" exceptions, then you should consider all Haskell runtime exceptions to be unchecked.  The Haskell equivalent of checked exceptions is usually to incorporate them into the result type using <code>Maybe</code>, <code>Either</code>, <code>ExceptT</code>, or something similar, as mentioned in the comments.</p>\n\n<p>There are different views on appropriate uses of unchecked, runtime exceptions versus these other mechanisms, and library authors will make different decisions about error handling, so you're kind of at their mercy.</p>\n\n<p>In this case, the documentation for <code>wreq</code> makes it very clear that <code>HttpException</code> and <code>JSONError</code> can be thrown, but there's no guarantee that the documentation for this or any other library is correct/complete or that dependent libraries won't throw other exceptions that aren't listed.  (Note: <code>JSONError</code> is actually defined in <code>wreq</code>.  The <code>aeson</code> package doesn't use exceptions to signal JSON decoding errors.)</p>\n\n<p>In production code, you'll want to make sure that you have an appropriate \"all exceptions\" handler in place.</p>\n"}], "owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1558728508, "creation_date": 1558616932, "question_id": 56275990, "link": "https://stackoverflow.com/questions/56275990/how-to-discover-what-exceptions-can-be-thrown-in-haskell", "title": "How to discover what exceptions can be thrown in Haskell?", "body": "<p>While using <a href=\"https://hackage.haskell.org/package/wreq\" rel=\"nofollow noreferrer\"><code>wreq</code></a> recently, I wrote code that compiled and worked for a while. Then, a <code>HttpException</code> was thrown. <code>HttpException</code> is not defined in <code>wreq</code>. I had to track it down to <code>http-client</code>. Then, a while later again, <code>JSONError</code> was thrown. This is also not defined in <code>wreq</code> but in <code>aeson</code>.</p>\n\n<p>How do I find out what possible exceptions can be thrown from a black box library other than to read through all available documentation for that library, and possibly all dependent libraries, hoping that the authors had mentioned it?</p>\n"}, {"tags": ["haskell", "state-monad"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1558603660, "post_id": 56272092, "comment_id": 99158980, "body": "<code>changeEnvName</code> should not have type <code>State Env-&gt;State Env</code>. As said before, a <code>State s</code> describes <i>changing</i> state (type <code>s</code>), not the state itself."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558603830, "post_id": 56272092, "comment_id": 99159085, "body": "I am not sure about the signatures of the mentioned methods.I thought that <code>Env</code>represents the <code>s</code> in the <code>State s a</code>"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1558603884, "post_id": 56272092, "comment_id": 99159120, "body": "The type for <code>getEnvFileLengths</code>  has one argument but your definition has two. It should have type <code>State Env a -&gt; State Env [Int]</code>. You will probably find this easier if you add <code>readState</code> and <code>modifyState</code> functions."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1558605020, "post_id": 56272092, "comment_id": 99159749, "body": "As a thumb rule, stick to functions of the form <code>foo :: type1 -&gt; ... -&gt; typen -&gt; State Env typek</code>. In most cases you can&#39;t write a function <code>State Env typek -&gt; typem</code>, like your <code>readEnv::State a Env-&gt;Env</code>. Make that <code>readEnv::State Env Env</code> instead, defined as <code>readEnv = get</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1558608282, "post_id": 56272092, "comment_id": 99161507, "body": "The <code>Env</code> is probably state, not the &quot;output&quot; value."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1558610167, "post_id": 56272092, "comment_id": 99162574, "body": "@Lee and @chi : I do not know how i should implement the <code>get</code> or <code>read</code> and <code>modify state</code> .I can&#39;t figure out what helpers i need in order to use  my implementation of the state monad.I am sorry if my question seems too broad but i have looked on tutorials and couldn&#39;t understand a basic implementation."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1558611445, "post_id": 56272092, "comment_id": 99163211, "body": "<code>changeEnvName</code> can simply have type <code>State Env a</code> - although I presume you want to be able to specify the new name, in which case it has type <code>String -&gt; State Env a</code>. To implement it you can just use the <code>put</code> method which is pre-defined - although it&#39;s not too hard to write your own implementation."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1558611512, "post_id": 56272092, "comment_id": 99163246, "body": "@Robin Zigmond : This is what i am trying to do , to understand how to implement the monad , and what other helper methods i need in order to use it having this use case.More specifically i do not understand how to extract ffrom a <code>s-&gt;(a,s)</code> the <code>s</code> from the tuple.All i can think of is : <code>get st@(State f)=snd . run st </code>"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1558612017, "post_id": 56272092, "comment_id": 99163511, "body": "Try having a read of <a href=\"https://en.m.wikibooks.org/wiki/Haskell/Understanding_monads/State\" rel=\"nofollow noreferrer\">this</a> - amongst many other good sources. It sounds like <code>execState</code> is what you&#39;re after here."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1558612098, "post_id": 56272092, "comment_id": 99163558, "body": "Note that in order to have a tuple to extract from, you always need an &quot;initial state&quot; in order to feed to the function wrapped by the State monad."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1558615906, "post_id": 56272092, "comment_id": 99165715, "body": "I have an initial state which is provided by the method <code>initEnv</code>.I want to start from that state and then either read from it or change it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1558617034, "post_id": 56272092, "comment_id": 99166348, "body": "@BercoviciAdrian <code>get</code> is provided by the library, you don&#39;t have to implement it. You should probably read some tutorial: looking at examples can make this easier."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1558619046, "post_id": 56272092, "comment_id": 99167583, "body": "I have looked at the tutorials but most of them started with complicated examples (for me ) ...i wanted to implement all of this methods  for my own example , to finally get it once and for all ,but i am still confused."}], "answers": [{"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1558620147, "post_id": 56276801, "comment_id": 99168243, "body": "So looking at the first method  i would need to just call my <code>initEnv</code>, but still get rid of the <code>IO</code> monad somehow and fill the initial state: <code>readEnv =State $ \\_ -&gt; initEnv&gt;&gt;=\\env -&gt;( env,env)</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 2, "creation_date": 1558620536, "post_id": 56276801, "comment_id": 99168503, "body": "@BercoviciAdrian At no point should the implementation of any of these values mention your <code>initEnv</code>. It is the caller&#39;s responsibility to provide you with an initial environment, and so the caller&#39;s responsibility to use <code>initEnv</code> somehow."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1558619915, "last_edit_date": 1558619915, "creation_date": 1558619541, "answer_id": 56276801, "question_id": 56272092, "link": "https://stackoverflow.com/questions/56272092/how-to-use-the-state-monad/56276801#56276801", "title": "How to use the State Monad", "body": "<p>It might be easier to make progress if you get the type signatures right:</p>\n\n<pre><code>readEnv::State Env Env\nchangeEnvName::String -&gt; State Env ()\ngetEnvFileLengths::State Env [Int]\n</code></pre>\n\n<p>If those look like strange choices of types to you, it might be worth trying to expand away the <code>newtype</code> and see if they appear more sensible after that:</p>\n\n<pre><code>-- give me an initial environment from your store, I'll give you the new environment\n-- to store and another copy of the environment as the result of the computation\nreadEnv :: Env -&gt; (Env, Env)\n\n-- give me a new name and the old environment, I'll give you a new environment and\n-- a trivial acknowledgement that I'm done\nchangeEnvName :: String -&gt; Env -&gt; ((), Env)\n\n-- give me an initial environment that you're storing, I'll give you the new\n-- environment to store (actually same as the old one) and the result of the\n-- length computations\ngetEnvFileLengths :: Env -&gt; ([Int], Env)\n</code></pre>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 56276801, "answer_count": 1, "score": 0, "last_activity_date": 1558619915, "creation_date": 1558603590, "last_edit_date": 1558604806, "question_id": 56272092, "link": "https://stackoverflow.com/questions/56272092/how-to-use-the-state-monad", "title": "How to use the State Monad", "body": "<p>I have already asked a question about understanding the state monad , but now i felt this one should be a different one.</p>\n\n<p>Given i implemented the state monad, i want my <code>state</code> to be a data structure that resembles the <code>Environment</code>:</p>\n\n<p><strong>Environment</strong> </p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Env=Env{\n    envName::String,\n    fileNames::[String]\n}\ninstance Show Env where \n    show Env{envName=x,fileNames=xs} = \"{ envName:\"++x++\n               \" , files: [\"++foldr (\\t y-&gt; t++\",\"++y) \"\" xs ++\"] }\"\n\ninitEnv::IO Env\ninitEnv=do\n    name&lt;- getLine\n    names&lt;- getCurrentDirectory&gt;&gt;=listDirectory\n    return Env{envName=name,fileNames=names}\n</code></pre>\n\n<p>I do not know how to integrate this data structure as the <code>State</code> in the State monad in order to be able to change the <code>name</code> of the environment , print it or use it . It might seem too broad but i cannot grasp it without a full example:</p>\n\n<p><strong>State monad implementation</strong></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype State s a = State {run::s-&gt;(a,s)} \n\ninstance Functor (State s) where\n    fmap=Control.Monad.liftM\ninstance Applicative (State s) where\n    pure=return\n    (&lt;*&gt;)=Control.Monad.ap\ninstance Monad (State s) where\n    return a= State $ \\k-&gt;(a,k) \n    (&gt;&gt;=) m f=State $ \\s -&gt; let (a,s')=run m s in\n        run (f a) s'\n</code></pre>\n\n<p><strong>What i want to implement</strong></p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>readEnv::State a Env-&gt;Env\nreadEnv m =\n\nchangeEnvName::State a Env-&gt;State a Env\nchangeEnvName m =  --given the environment packed in a state , \n                   -- i want to change the name \n\ngetEnvFileLengths::State a Env-&gt;[Int]\ngetEnvFileLengths s a= s&gt;&gt;= getLengths\n\ngetLengths::[String]-&gt;[Int]\ngetLengths xs=map length xs\n</code></pre>\n\n<p><strong>P.S</strong> I understand that i should use <code>Reader</code> or <code>Writer</code> monad but i wanted a <code>all in one</code> approach to be able to understand how all things fit together.</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["haskell", "monads", "type-inference", "ghci"], "comments": [{"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 3, "creation_date": 1558596136, "post_id": 56269805, "comment_id": 99154891, "body": "The default Monad is IO. There is no Show for IO, but when you return an IO, GHCi will not Show it, but run it, and Show the result (an Integer here, which does have Show)."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 9, "last_activity_date": 1558596622, "last_edit_date": 1558596622, "creation_date": 1558595758, "answer_id": 56269921, "question_id": 56269805, "link": "https://stackoverflow.com/questions/56269805/how-does-return-1-show-1-in-ghci/56269921#56269921", "title": "How does &quot;return 1&quot; show &quot;1&quot; in GHCi?", "body": "<p><code>Monad m =&gt; m</code> defaults to <code>IO</code>, that's how.</p>\n\n<p>Then the IO action is performed, does no I/O, and returns the value. </p>\n\n<p>Ghci has two output modes of operation: when the evaluated value has type <code>IO a</code> and when it doesn't. In the first case, the IO action is performed, and the value of type <code>a</code> produced by the action is shown. In the second case, the evaluated value is just shown.</p>\n\n<p>Since you're in Ghci, the type of <code>return 1 :: (Monad m, Num a) =&gt; m a</code> is actually <code>IO Integer</code>. <code>m</code> defaults to <code>IO</code>, and <code>a</code> defaults to <code>Integer</code>, so the <code>Integer</code> <code>1</code> is shown.</p>\n\n<p>Enable the GHCi showing you the types, with <code>ghci&gt; :set +t</code>, then try <code>return 1.0</code>. It returns <code>Double</code>, and <code>Double</code>s also have the <code>Show</code> instance.</p>\n\n<pre><code>&gt; return 1\n1\nit :: Integer\n\n&gt; return 1.0\n1.0\nit :: Double\n\n&gt; return \"3\"\n\"3\"\nit :: [Char]\n\n&gt; print \"3\"\n\"3\"\nit :: ()\n</code></pre>\n"}], "owner": {"reputation": 483, "user_id": 4799906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c58a6804706d39b381315aa97c9404af?s=128&d=identicon&r=PG&f=1", "display_name": "damhiya", "link": "https://stackoverflow.com/users/4799906/damhiya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "closed_date": 1558619012, "accepted_answer_id": 56269921, "answer_count": 1, "score": 6, "last_activity_date": 1558649687, "creation_date": 1558595313, "last_edit_date": 1558649687, "question_id": 56269805, "link": "https://stackoverflow.com/questions/56269805/how-does-return-1-show-1-in-ghci", "closed_reason": "Duplicate", "title": "How does &quot;return 1&quot; show &quot;1&quot; in GHCi?", "body": "<p>This is what I get when type <code>return 1</code> in GHCi. </p>\n\n<pre><code>&gt; return 1\n1\n</code></pre>\n\n<p>Since I didn't specify the type of <code>return</code>, type of <code>return 1</code> is <code>Monad m, Num a =&gt; m a</code></p>\n\n<p>How does GHCi show <code>1</code> even though there is no instance for <code>Show</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 5, "creation_date": 1558574190, "post_id": 56266852, "comment_id": 99149715, "body": "Sounds like you might have some C background. Try to reimagine the question: what you really need is to find the sum of all <i>pairs</i> of numbers from the list. If you can create that list of pairs, then it&#39;s easy to find the ones that sum to the target."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 4, "creation_date": 1558575375, "post_id": 56266852, "comment_id": 99149926, "body": "What have you tried so far?"}, {"owner": {"reputation": 861, "user_id": 2252692, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/5e66f8452f2a583e6901fbabaff5d2a6?s=128&d=identicon&r=PG", "display_name": "wshcdr", "link": "https://stackoverflow.com/users/2252692/wshcdr"}, "edited": false, "score": 1, "creation_date": 1558576295, "post_id": 56266852, "comment_id": 99150081, "body": "Sound like [(x,y) | x &lt;- [1..7], y &lt;- [1..7], x+y==7]"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558595097, "post_id": 56266852, "comment_id": 99154392, "body": "You can just use <code>[(x, 7-x) | x &lt;- [1..7]]</code> here."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1558595286, "post_id": 56266852, "comment_id": 99154476, "body": "@WillemVanOnsem I too interpreted it this way at first, but their example seems to suggest the Cartesian product, not the zippery pairing up of the elements."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1558595429, "post_id": 56266852, "comment_id": 99154529, "body": "What exactly have you tried?"}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 1, "creation_date": 1558618460, "post_id": 56266852, "comment_id": 99167231, "body": "The task you have before you is to remove the procedural paradigm from your thought process, so that the functional paradigm can replace it as you learn it. You&#39;ll be able to re-integrate both one day. But for now, thinking in procedural terms won&#39;t help you at all."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 2, "last_activity_date": 1558595193, "creation_date": 1558595193, "answer_id": 56269767, "question_id": 56266852, "link": "https://stackoverflow.com/questions/56266852/how-can-i-do-this-in-haskell/56269767#56269767", "title": "How can I do this in Haskell?", "body": "<p>It's easy to code with list comprehensions:</p>\n\n<pre><code>findIt :: (Num a, Eq a) =&gt; [a] -&gt; a -&gt; [(Int, Int)]\nfindIt xs it = [ (i,j) | (j,y) &lt;- reverse $ zip [0..] xs, \n                         (i,x) &lt;- zip [0..] xs, \n                         i&lt;=j, x+y == it ]\n\nGHCi&gt; findIt [1..10] 18\n[(7,9),(8,8)]\n</code></pre>\n\n<p>The above code is of course quadratic in the number of entries in the list.</p>\n\n<p>Coding this efficiently is an interesting algorithmic question.</p>\n"}], "owner": {"reputation": 13, "user_id": 11542267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xlHQhGFqN5M/AAAAAAAAAAI/AAAAAAAABTE/8ZMlUzIUI8E/photo.jpg?sz=128", "display_name": "Joseph Vargas", "link": "https://stackoverflow.com/users/11542267/joseph-vargas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "closed_date": 1558658489, "accepted_answer_id": 56269767, "answer_count": 1, "score": -4, "last_activity_date": 1558672237, "creation_date": 1558573949, "last_edit_date": 1558672237, "question_id": 56266852, "link": "https://stackoverflow.com/questions/56266852/how-can-i-do-this-in-haskell", "closed_reason": "Needs details or clarity", "title": "How can I do this in Haskell?", "body": "<p>I need a little of help on my homework, i have to make an array in haskell where through the pointers \"i\" and \"j\" i have to find two numbers where the result is the number that the user write.\nFor example: </p>\n\n<p>User writes the number 7, so the program has to go through every number comparing in two sides (pointers \"i\" and \"j\"; \"i\" goes from start to right and \"j\" goes from the end to the left) if the result of the sum is the same as the user input.\n[1,2,3,4,5,6,7].</p>\n\n<p>I don't know if i'm explaining myself, I hope you can help me guys.\nFor example \"i\" is on position 1 and \"j\" is on position 4.\ni = 2\nj = 5   so \"i\" + \"j\" = 7</p>\n\n<p>then I have to print the position where it found \"I\" and \"j\".</p>\n"}]