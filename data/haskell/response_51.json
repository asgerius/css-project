[{"tags": ["python", "swift", "haskell", "optional", "maybe"], "comments": [{"owner": {"reputation": 300, "user_id": 5712371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kLwV3.jpg?s=128&g=1", "display_name": "Snusmumrikken", "link": "https://stackoverflow.com/users/5712371/snusmumrikken"}, "edited": false, "score": 1, "creation_date": 1451520261, "post_id": 34539117, "comment_id": 56820537, "body": "Confusing title and tags."}, {"owner": {"reputation": 4955, "user_id": 5274205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3a281a1418dbceeda34cc93d3744554?s=128&d=identicon&r=PG", "display_name": "Chad S.", "link": "https://stackoverflow.com/users/5274205/chad-s"}, "edited": false, "score": 0, "creation_date": 1451520345, "post_id": 34539117, "comment_id": 56820560, "body": "You can use a conditional expression:  <code>var.prop if var else var</code> but in general in python you&#39;re expected to know when something is None and when it isn&#39;t and not ask over and over."}, {"owner": {"reputation": 4558, "user_id": 4293417, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/15V7E.png?s=128&g=1", "display_name": "Zizouz212", "link": "https://stackoverflow.com/users/4293417/zizouz212"}, "reply_to_user": {"reputation": 300, "user_id": 5712371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kLwV3.jpg?s=128&g=1", "display_name": "Snusmumrikken", "link": "https://stackoverflow.com/users/5712371/snusmumrikken"}, "edited": false, "score": 6, "creation_date": 1451520348, "post_id": 34539117, "comment_id": 56820562, "body": "@Snusmumrikken Not really, it&#39;s really clear, you just need to understand the concepts of Swift or Haskell to be able to understand it"}, {"owner": {"reputation": 98400, "user_id": 3001761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/feZwC.jpg?s=128&g=1", "display_name": "jonrsharpe", "link": "https://stackoverflow.com/users/3001761/jonrsharpe"}, "edited": false, "score": 0, "creation_date": 1451520810, "post_id": 34539117, "comment_id": 56820693, "body": "What are you actually trying to <i>achieve</i> with this? Could you give a less abstract example?"}, {"owner": {"reputation": 4955, "user_id": 5274205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3a281a1418dbceeda34cc93d3744554?s=128&d=identicon&r=PG", "display_name": "Chad S.", "link": "https://stackoverflow.com/users/5274205/chad-s"}, "edited": false, "score": 0, "creation_date": 1451520822, "post_id": 34539117, "comment_id": 56820700, "body": "Are you asking how to check for None, or how to check if a variable exists (won&#39;t raise a NameError)?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1451551508, "post_id": 34539117, "comment_id": 56828826, "body": "Just to be pedantic, what you describe is <code>fmap prop var</code>, not <code>var &gt;&gt;= prop</code>, though it seems <code>var &gt;&gt;= prop</code> more closely describes what you are looking for, since it could result in <code>None</code> even if <code>var</code> is not itself <code>None</code>."}], "answers": [{"comments": [{"owner": {"reputation": 321, "user_id": 2063220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1kwkW.png?s=128&g=1", "display_name": "Sergey Salnikov", "link": "https://stackoverflow.com/users/2063220/sergey-salnikov"}, "edited": false, "score": 1, "creation_date": 1451522138, "post_id": 34539197, "comment_id": 56821032, "body": "Well, not exactly. If <code>var</code> is sometimes an object with <code>prop</code> and sometimes <code>None</code>, then it&#39;s just the same as an implicit Optional. Python&#39;s <code>var.prop</code> in this view is similar to <code>var!.prop</code> in Swift: it would throw if <code>var</code> is <code>None</code>. Then, <code>var</code> could also be some other object without <code>prop</code>: Swift calls this &quot;not implementing the protocol&quot;, so a more exact translation is something like <code>(var! as! havingProp).prop</code>. And then the main difference is just that Swift makes each assumption of this kind explicit with an exclamation mark."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 7, "creation_date": 1451523233, "post_id": 34539197, "comment_id": 56821294, "body": "\u201cIn Python fynamic typing makes it trivial\u201d \u2013 since when is an inline conditional trivial compared to <code>.?</code>?"}, {"owner": {"reputation": 2173, "user_id": 1132101, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/a59cd6a2179d901a8aea077b0125c19a?s=128&d=identicon&r=PG", "display_name": "skagedal", "link": "https://stackoverflow.com/users/1132101/skagedal"}, "edited": false, "score": 1, "creation_date": 1451525180, "post_id": 34539197, "comment_id": 56821798, "body": "IMO, you should remove the opinion bit - this isn&#39;t the place to discuss which language constructs are &quot;weird&quot; and which ones are &quot;trivial&quot;. Otherwise, this is a fine answer - I like that you explore various options. (However, the really short answer is: &quot;No. There is no such syntax.&quot;)"}, {"owner": {"reputation": 8720, "user_id": 3846213, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/5PGh1.jpg?s=128&g=1", "display_name": "Eli Korvigo", "link": "https://stackoverflow.com/users/3846213/eli-korvigo"}, "reply_to_user": {"reputation": 2173, "user_id": 1132101, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/a59cd6a2179d901a8aea077b0125c19a?s=128&d=identicon&r=PG", "display_name": "skagedal", "link": "https://stackoverflow.com/users/1132101/skagedal"}, "edited": false, "score": 1, "creation_date": 1451539016, "post_id": 34539197, "comment_id": 56824791, "body": "@skagedal ok, I removed that"}, {"owner": {"reputation": 8720, "user_id": 3846213, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/5PGh1.jpg?s=128&g=1", "display_name": "Eli Korvigo", "link": "https://stackoverflow.com/users/3846213/eli-korvigo"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1451548700, "post_id": 34539197, "comment_id": 56827933, "body": "@RyanO&#39;Hara Yes, I agree that my statement was primarily opinion-based hance inappropriate for the answer."}], "tags": [], "owner": {"reputation": 8720, "user_id": 3846213, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/5PGh1.jpg?s=128&g=1", "display_name": "Eli Korvigo", "link": "https://stackoverflow.com/users/3846213/eli-korvigo"}, "is_accepted": false, "score": 2, "last_activity_date": 1451742897, "last_edit_date": 1451742897, "creation_date": 1451520421, "answer_id": 34539197, "question_id": 34539117, "link": "https://stackoverflow.com/questions/34539117/swift-optionals-or-haskells-maybe-in-python/34539197#34539197", "title": "Swift Optionals (or Haskell&#39;s Maybe) in Python?", "body": "<p>Long story short, there is no special syntax to handle optionals (since there are no optionals), though you can use conditional assignment (ternary operator) to mimic the functionality:</p>\n\n<pre><code>unpacked_var = var.prop if var is not None else None\n</code></pre>\n\n<p>Though in Python I would rather check whether <code>var</code> has the attribute you want to access.</p>\n\n<pre><code>unpacked_var = var.prop if hasattr(var, \"prop\") else None\n</code></pre>\n\n<p>You can write a function to make it shorter</p>\n\n<pre><code>def optional(var, attr):\n    return getattr(var, attr) if hasattr(var, attr) else None\n\nunpacked_var = optional(var, \"prop\")\n</code></pre>\n\n<p>There is a less universal way to do this (and less explicit, IMHO):</p>\n\n<pre><code>unpacked_var = hasattr(var, \"prop\") and var.prop or None\n</code></pre>\n\n<p>The problem here is that you'll get <code>None</code> if <code>bool(var.prop) == False</code>, so you'd better stick to the ternary operator above.  </p>\n"}, {"comments": [{"owner": {"reputation": 8720, "user_id": 3846213, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/5PGh1.jpg?s=128&g=1", "display_name": "Eli Korvigo", "link": "https://stackoverflow.com/users/3846213/eli-korvigo"}, "edited": false, "score": 0, "creation_date": 1451560159, "post_id": 34541692, "comment_id": 56832618, "body": "&quot;The other answers are on the right track in suggesting a conditional expression, but wrong about how to do it. You can do it this way&quot; - how is my anawer wrong if it is identical to yours?"}, {"owner": {"reputation": 209114, "user_id": 1427416, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/QWHKg.png?s=128&g=1", "display_name": "BrenBarn", "link": "https://stackoverflow.com/users/1427416/brenbarn"}, "reply_to_user": {"reputation": 8720, "user_id": 3846213, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/5PGh1.jpg?s=128&g=1", "display_name": "Eli Korvigo", "link": "https://stackoverflow.com/users/3846213/eli-korvigo"}, "edited": false, "score": 1, "creation_date": 1451588901, "post_id": 34541692, "comment_id": 56843634, "body": "@EliKorvigo: Your answer was wrong at the time I started writing this, but you then edited it."}, {"owner": {"reputation": 1754, "user_id": 1337499, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e1de83c70cce75118af8dc5a30cde90b?s=128&d=identicon&r=PG", "display_name": "Alex Alifimoff", "link": "https://stackoverflow.com/users/1337499/alex-alifimoff"}, "edited": false, "score": 0, "creation_date": 1549499989, "post_id": 34541692, "comment_id": 95928191, "body": "I believe this will be in Python 3.8 as of 2019."}], "tags": [], "owner": {"reputation": 209114, "user_id": 1427416, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/QWHKg.png?s=128&g=1", "display_name": "BrenBarn", "link": "https://stackoverflow.com/users/1427416/brenbarn"}, "is_accepted": true, "score": 6, "last_activity_date": 1451540747, "creation_date": 1451540747, "answer_id": 34541692, "question_id": 34539117, "link": "https://stackoverflow.com/questions/34539117/swift-optionals-or-haskells-maybe-in-python/34541692#34541692", "title": "Swift Optionals (or Haskell&#39;s Maybe) in Python?", "body": "<p>The other answers are on the right track in suggesting a conditional expression, but wrong about how to do it.  You can do it this way:</p>\n\n<pre><code>None if var is None else var.prop\n</code></pre>\n\n<p>or, equivalently</p>\n\n<pre><code>var.prop if var is not None else None\n</code></pre>\n\n<p>There is a <a href=\"https://www.python.org/dev/peps/pep-0505\" rel=\"noreferrer\">draft PEP</a> about adding such a feature to Python, and ther has been discussion of it on the Python-ideas mailing list.  It doesn't look like it will be added in the near future (if ever), but reading the PEP will give you an idea of some existing and proposed ways of handling this.</p>\n"}, {"tags": [], "owner": {"reputation": 1710, "user_id": 2654466, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/182900946/picture?type=large", "display_name": "Chad Befus", "link": "https://stackoverflow.com/users/2654466/chad-befus"}, "is_accepted": false, "score": 1, "last_activity_date": 1537998295, "creation_date": 1537998295, "answer_id": 52526426, "question_id": 34539117, "link": "https://stackoverflow.com/questions/34539117/swift-optionals-or-haskells-maybe-in-python/52526426#52526426", "title": "Swift Optionals (or Haskell&#39;s Maybe) in Python?", "body": "<p>Using <code>None</code> can be tricky for maintaining clean call site code.  It means that you need to have a lot of defensive conditionals.  As you can see from the other answers, there is a lot of support from smart people for this method.</p>\n\n<p>An alternative is to use an <strong>Optional type</strong>, which much like a collection type (list, set, dict, etc.) is explicitly either empty or not, but unlike other collection types, can only hold 1 element.  This means that all your returns from a function return an object with the same capabilities.  Just as with something returning a collection, when things go awry but not exceptionally so, you can return the empty version of that collection (ex. there are no users older than 100 in the db) you can use an optional type to do the same (ex. there is no user in the db with username foobar).  </p>\n\n<p>Since python does not come with a built in optional type, I created a small library that provides it: <a href=\"https://github.com/cbefus/optional.py\" rel=\"nofollow noreferrer\"><strong>optional.py</strong></a>.  You can try it out using 'pip install optional.py'.  I welcome comments, feature requests, and contributions.</p>\n"}], "owner": {"reputation": 11606, "user_id": 1002430, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/ufy7U.png?s=128&g=1", "display_name": "Ana", "link": "https://stackoverflow.com/users/1002430/ana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2562, "favorite_count": 2, "accepted_answer_id": 34541692, "answer_count": 3, "score": 11, "last_activity_date": 1537998295, "creation_date": 1451519962, "question_id": 34539117, "link": "https://stackoverflow.com/questions/34539117/swift-optionals-or-haskells-maybe-in-python", "title": "Swift Optionals (or Haskell&#39;s Maybe) in Python?", "body": "<p>In Swift I can do <code>var?.prop</code>. This results in <code>nil</code> if <code>var</code> is <code>nil</code>, else it results in the value of the <code>prop</code> property of <code>var</code>. </p>\n\n<p>Equivalently, I can do <code>var &gt;&gt;= prop</code> in Haskell, which gives me <code>None</code> is <code>var</code> is <code>None</code>, else it gives me the value of applying <code>prop</code> to the value inside <code>var</code> (wrapped in <code>Just</code>).</p>\n\n<p>Is there an equivalent in Python?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 842, "user_id": 90651, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/91ec8980f6d1db63e0c7bd3073cba264?s=128&d=identicon&r=PG&f=1", "display_name": "Umair", "link": "https://stackoverflow.com/users/90651/umair"}, "edited": false, "score": 0, "creation_date": 1451517539, "post_id": 34538754, "comment_id": 56819764, "body": "This question is related to <a href=\"http://stackoverflow.com/questions/33829415/applicative-laws-for-the-r-type\" title=\"applicative laws for the r type\">stackoverflow.com/questions/33829415/&hellip;</a>. However, I couldn&#39;t post the code in this question directly as a comment, so I decided to add a new follow-up question instead"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1451517939, "post_id": 34538754, "comment_id": 56819906, "body": "Substitute in the definition <code>(f . g) x = f (g x)</code> for the composition in the last line of the LHS... and you&#39;re done!"}, {"owner": {"reputation": 842, "user_id": 90651, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/91ec8980f6d1db63e0c7bd3073cba264?s=128&d=identicon&r=PG&f=1", "display_name": "Umair", "link": "https://stackoverflow.com/users/90651/umair"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1451518071, "post_id": 34538754, "comment_id": 56819955, "body": "Le sigh. Missed something really simple. Could you post your comment as an answer so that I can accept it?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1451528855, "post_id": 34538754, "comment_id": 56822531, "body": "For a friendlier presentation of the <code>Applicative</code> laws, see <a href=\"http://blog.ezyang.com/2012/08/applicative-functors/\" rel=\"nofollow noreferrer\">this blog post</a> by Edward Yang. Also, you might consider jumping ahead and proving the monad laws instead."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1451518132, "creation_date": 1451518132, "answer_id": 34538857, "question_id": 34538754, "link": "https://stackoverflow.com/questions/34538754/proving-composition-applicative-law-for-r-type/34538857#34538857", "title": "Proving Composition Applicative law for ((-&gt;) r) type", "body": "<p>You're almost there. You just need to use the definition of <code>(.)</code>, which is</p>\n\n<pre><code>(f . g) x = f (g x)\n</code></pre>\n\n<p>After substituting that definition in the last line of your LHS calculation, you should have two obviously equal lambdas.</p>\n"}], "owner": {"reputation": 842, "user_id": 90651, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/91ec8980f6d1db63e0c7bd3073cba264?s=128&d=identicon&r=PG&f=1", "display_name": "Umair", "link": "https://stackoverflow.com/users/90651/umair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 34538857, "answer_count": 1, "score": 0, "last_activity_date": 1451518132, "creation_date": 1451517508, "question_id": 34538754, "link": "https://stackoverflow.com/questions/34538754/proving-composition-applicative-law-for-r-type", "title": "Proving Composition Applicative law for ((-&gt;) r) type", "body": "<p>The Composition Applicative Law is as follows:</p>\n\n<pre><code>pure (.) &lt;*&gt; u &lt;*&gt; v &lt;*&gt; w = u &lt;*&gt; (v &lt;*&gt; w)\n</code></pre>\n\n<p>Here's my attempt at proving the Composition law for the <code>((-&gt;) r)</code> type:</p>\n\n<p>RHS:</p>\n\n<pre><code>u &lt;*&gt; (v &lt;*&gt; w)\nu &lt;*&gt; ( \\y -&gt; v y (w y) )\n\\x -&gt; u x ( (\\y -&gt; v y (w y)) x )\n\\x -&gt; u x ( v x (w x)) -- (A)\n</code></pre>\n\n<p>LHS: </p>\n\n<pre><code>pure (.) &lt;*&gt; u &lt;*&gt; v &lt;*&gt; w\nconst (.) &lt;*&gt; u &lt;*&gt; v &lt;*&gt; w\n(\\f -&gt; const (.) f (u f)) &lt;*&gt; v &lt;*&gt; w\n(\\f -&gt; (.) (u f)) &lt;*&gt; v &lt;*&gt; w\n(\\g -&gt; (\\f -&gt; (.) (u f)) g (v g)) &lt;*&gt; w\n\\x -&gt; (\\g -&gt; (\\f -&gt; (.) (u f)) g (v g)) x (w x)\n-- Expanding labmda by applying to x\n\\x -&gt; ((\\f -&gt; (.) (u f)) x (v x)) (w x)\n\\x -&gt; (( (.) (u x)) (v x)) (w x)\n\n\\x -&gt; ((u x) . (v x)) (w x) -- (B)\n</code></pre>\n\n<p>I don't think (A) &amp; (B) are equivalent, so where did I make a mistake? I would appreciate any help or suggestions. </p>\n"}, {"tags": ["list", "haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 429, "user_id": 796557, "user_type": "registered", "accept_rate": 5, "profile_image": "https://www.gravatar.com/avatar/2807764ba0f590416c540c55a960e9a9?s=128&d=identicon&r=PG&f=1", "display_name": "elliptic00", "link": "https://stackoverflow.com/users/796557/elliptic00"}, "edited": false, "score": 0, "creation_date": 1451509187, "post_id": 34537082, "comment_id": 56816256, "body": "Thanks for the detail explanations"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1451509243, "last_edit_date": 1451509243, "creation_date": 1451508809, "answer_id": 34537082, "question_id": 34536997, "link": "https://stackoverflow.com/questions/34536997/try-to-understand-some-weird-symbols-like-in-haskell/34537082#34537082", "title": "Try to understand some weird symbols like ([]:_) in Haskell", "body": "<p>This is not a symbol <code>([]:_)</code> is simply a short version of:</p>\n\n<pre><code>( [] : _ )\n^  ^   ^\n|  |   wildcard\n|  empty list\nlist construct\n</code></pre>\n\n<p>The list construction is something like <code>( h :t )</code> with <code>h</code> the head (an element) and <code>t</code> the tail (either the remainder of the list, or the empty list). See <a href=\"https://en.wikipedia.org/wiki/Cons\" rel=\"nofollow\">CONS</a> for more information.</p>\n\n<p>So it means: match a list with as head the empty list and as tail a <em>don't care</em>.</p>\n\n<p>This makes sense, since a transpose is only well defined on rectangular structures. What do you expect the transpose of <code>[[],[1]]</code> should be.</p>\n\n<p>The reason that this line is necessary, is because in the second (recursive) call, you use the <code>tail</code>s of all lists.</p>\n\n<p>If you thus calculate the transpose of <code>[[1,2,3],[4,5,6],[7,8,9]]</code>, you will first take the recursive case: as <code>head</code>, you emit all the heads of all the lists, so <code>[1,4,7]</code>, and the recursion is done with the <code>tail</code>s of all the lists, so you call it with <code>transpose [[2,3],[5,6],[8,9]]</code>.</p>\n\n<p>In the second round (recursive call), you emit again the <code>head</code>s of the lists, so <code>[2,5,8]</code> and do the recursive call on the <code>tail</code>s: <code>[[3],[6],[9]]</code>. Next you emit again the <code>head</code>s <code>[3,6,9]</code>, and now the recursive call on the <code>tail</code>s is <code>transpose [[],[],[]]</code>. So a list of all empty lists. If the matrix condition hold however, it means we have finished. The pattern <code>( [] : _)</code> matches <code>[[],[],[]]</code> so it will emit the empty list <code>[]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1451508892, "creation_date": 1451508892, "answer_id": 34537102, "question_id": 34536997, "link": "https://stackoverflow.com/questions/34536997/try-to-understand-some-weird-symbols-like-in-haskell/34537102#34537102", "title": "Try to understand some weird symbols like ([]:_) in Haskell", "body": "<p>It's not a matrix! Your first row is empty, therefore the first condition is satisfied and returns empty list as defined.</p>\n"}], "owner": {"reputation": 429, "user_id": 796557, "user_type": "registered", "accept_rate": 5, "profile_image": "https://www.gravatar.com/avatar/2807764ba0f590416c540c55a960e9a9?s=128&d=identicon&r=PG&f=1", "display_name": "elliptic00", "link": "https://stackoverflow.com/users/796557/elliptic00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1451578967, "creation_date": 1451508348, "last_edit_date": 1451578967, "question_id": 34536997, "link": "https://stackoverflow.com/questions/34536997/try-to-understand-some-weird-symbols-like-in-haskell", "title": "Try to understand some weird symbols like ([]:_) in Haskell", "body": "<p>I have difficulty to understand the following Haskell symbol <code>([]:_)</code>.</p>\n\n<p>I come cross a Haskell function called transpose </p>\n\n<pre><code>transpose::[[Int]]-&gt;[[Int]]\ntranspose ([]:_) = []\ntranspose  x = (map head x):transpose(map tail x)\n</code></pre>\n\n<p>And I walk through a simple example.</p>\n\n<pre><code>transpose [[1,2],[3,4]]\n=&gt;[1,3]:transpose[2,4]\n=&gt;[1,3]:[2,4]:transpose[[],[]]\n=&gt;[1,3]:[2,4]:[]\n=&gt;[[1,3],[2,4]]\n</code></pre>\n\n<p>It seems to be make sense.</p>\n\n<p>But If I pass <code>[[], [1]]</code> to the function, the output is still <code>[]</code></p>\n\n<pre><code>transpose [[], [1]]\n=&gt;[]\n</code></pre>\n\n<p>Can anyone explain why transpose return <code>[]</code> if I pass <code>[[], [1]]</code>?</p>\n"}, {"tags": ["haskell", "operator-overloading"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 4, "creation_date": 1451515015, "post_id": 34536959, "comment_id": 56818911, "body": "<code>Set</code> implements <code>Monoid</code>, so you already do have an operator for set union, which is <code>&lt;&gt;</code>. <code>Prelude Data.Set Data.Monoid&gt; fromList &quot;abc&quot; &lt;&gt; fromList &quot;bcd&quot; =&gt; fromList &quot;abcd&quot;</code>. There&#39;s also backslash-backslash for subtraction. The reason they aren&#39;t <code>+</code> and <code>-</code> have been detailed in the excellent answers below."}], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 6, "last_activity_date": 1451508985, "creation_date": 1451508985, "answer_id": 34537122, "question_id": 34536959, "link": "https://stackoverflow.com/questions/34536959/overload-for-sets-in-haskell/34537122#34537122", "title": "Overload +, - for sets in haskell", "body": "<p>Haskell places a few more restrictions on the overloading of numerical operators than Python does, there are rules and laws that must be followed in order to define them.  For example, you would also need to define <code>*</code> and <code>abs</code> to go with it.  Instead, use the operators already defined in <code>Data.Set</code>, namely <code>\\\\</code> for set difference, and there isn't one already define for union, but you could easy make your own alias, or you could use it as</p>\n\n<pre><code>set1 `union` set2\n</code></pre>\n\n<p>I recommend sticking with the already defined functions and operators, it'll make your code much more readable to anyone else that takes a look at it.  Feel free to introduce new operators that do more than just alias an existing function, although good practice says to do so sparingly still.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451526815, "post_id": 34537324, "comment_id": 56822119, "body": "This is why floating point representations shouldn&#39;t be <code>Num</code> instances."}], "tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 2, "last_activity_date": 1451509983, "last_edit_date": 1495541042, "creation_date": 1451509983, "answer_id": 34537324, "question_id": 34536959, "link": "https://stackoverflow.com/questions/34536959/overload-for-sets-in-haskell/34537324#34537324", "title": "Overload +, - for sets in haskell", "body": "<p>To define a Num instance for a type it would look like:</p>\n\n<pre><code>instance Num (Set a) where\n  (+) = -- definition\n  (-) = -- definition\n  -- etc\n</code></pre>\n\n<p>If you merely define, at the top level:</p>\n\n<pre><code>(-) = -- definition\n</code></pre>\n\n<p>Then you are simply shadowing the <code>(-)</code> that comes from Num.</p>\n\n<p>As <a href=\"https://stackoverflow.com/a/34537122/260584\">bheklilr says</a>, Set is not a valid instance for Num because it cannot satisfy the ring laws. Haskell will not forbid you from defining the instance but it is a poor idea. People work with type classes by using their laws, so violating them results in incorrect programs.</p>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 3, "last_activity_date": 1451524100, "creation_date": 1451524100, "answer_id": 34539675, "question_id": 34536959, "link": "https://stackoverflow.com/questions/34536959/overload-for-sets-in-haskell/34539675#34539675", "title": "Overload +, - for sets in haskell", "body": "<p>What you are proposing to do is, to put it a bit comically, very unhaskellic.  Haskellers generally adopt the following attitude:</p>\n\n<ul>\n<li>The same name or symbol should not be overloaded to mean two different things.</li>\n</ul>\n\n<p>This means that all overloadable names or symbols (i.e., class operations) must have a consistent core meaning that all of their overloaded instances must respect.</p>\n\n<p>In Haskell, the <code>(+)</code> and <code>(-)</code> operations are defined by <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#g:7\" rel=\"nofollow\">the <code>Num</code> class</a>.  The docs aren't explicit about it, but to implement a class you must implement all of its methods, which includes things like <code>fromInteger :: Num a =&gt; Integer -&gt; a</code> (the operation that converts any <code>Integer</code> into an instance of your class) and <code>abs :: Num a =&gt; a -&gt; a</code> (take the absolute value of a number).</p>\n\n<p>You can't implement the <code>Num</code> class for sets without profoundly abusing its meaning.  So don't do it.</p>\n\n<p>Note that there are other classes that may be more suitable to what you're trying to do.  For example, there is <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Monoid.html\" rel=\"nofollow\">the <code>Monoid</code> class</a> that provides generic operations that are suitable for sets.  In fact, <a href=\"http://hackage.haskell.org/package/containers-0.5.7.0/docs/Data-Set.html\" rel=\"nofollow\">the <code>Data.Set</code> module</a> implements <code>Monoid</code> as union, so you can use the <code>mappend</code> function or <code>(&lt;&gt;)</code> operator to take the union of two sets generically (or the append of two lists, or many other things).</p>\n\n<p>There is no obvious, popular class that the <code>Set.difference</code> operator would be an instance of, I'm afraid.  </p>\n"}], "owner": {"reputation": 3024, "user_id": 3154996, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2031da3bb3fc999ec22e677995debd7b?s=128&d=identicon&r=PG&f=1", "display_name": "Elliot Gorokhovsky", "link": "https://stackoverflow.com/users/3154996/elliot-gorokhovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1451524100, "creation_date": 1451508180, "question_id": 34536959, "link": "https://stackoverflow.com/questions/34536959/overload-for-sets-in-haskell", "title": "Overload +, - for sets in haskell", "body": "<p>In python, I can add (union) and subtract (difference) sets with <code>+</code> and <code>-</code>. How would I set this up in Haskell? Would <code>(-) = Data.Set.difference</code> work? I tried it, but then I think regular subtraction with numbers got messed up.</p>\n"}, {"tags": ["haskell", "pointfree", "maybe"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1451508750, "post_id": 34535374, "comment_id": 56816052, "body": "<code>Data.Bool</code> has <code>bool</code>."}, {"owner": {"reputation": 3883, "user_id": 1529734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c7d967945459535ac46463f40783caf2?s=128&d=identicon&r=PG", "display_name": "stites", "link": "https://stackoverflow.com/users/1529734/stites"}, "edited": false, "score": 1, "creation_date": 1451535235, "post_id": 34535374, "comment_id": 56823801, "body": "Very interesting! I think I like this answer the best as it has the most material to learn in a simple and concise manner. I&#39;m going to give this to @Peter since his answer is the most readable and I guess I did only asked for point-free wrt a."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 7, "last_activity_date": 1451501384, "creation_date": 1451501384, "answer_id": 34535374, "question_id": 34535067, "link": "https://stackoverflow.com/questions/34535067/is-there-a-point-free-way-to-convert-a-conditional-check-into-a-maybe-type-of-th/34535374#34535374", "title": "Is there a point-free way to convert a conditional check into a Maybe type of the input?", "body": "<p>The main thing getting in the way of making that pointfree is the <code>if</code>/<code>then</code>/<code>else</code>. You can define an <code>if'</code> combinator, or you can use this generalized version that I define and use often:</p>\n\n<pre><code>ensure p x = x &lt;$ guard (p x)\n</code></pre>\n\n<p>Standard tools give successive point-free versions as</p>\n\n<pre><code>ensure p = ap (&lt;$) (guard . p)\nensure = ap (&lt;$) . (guard .)\n</code></pre>\n\n<p>though I really don't think either are better than the pointful version.</p>\n"}, {"comments": [{"owner": {"reputation": 3883, "user_id": 1529734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c7d967945459535ac46463f40783caf2?s=128&d=identicon&r=PG", "display_name": "stites", "link": "https://stackoverflow.com/users/1529734/stites"}, "edited": false, "score": 0, "creation_date": 1451535490, "post_id": 34536499, "comment_id": 56823855, "body": "I can&#39;t see some of the characters! After &quot;Some intuitions...&quot; the code block subscripts(?) which are not <code>1</code> are boxed question marks."}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "reply_to_user": {"reputation": 3883, "user_id": 1529734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c7d967945459535ac46463f40783caf2?s=128&d=identicon&r=PG", "display_name": "stites", "link": "https://stackoverflow.com/users/1529734/stites"}, "edited": false, "score": 1, "creation_date": 1451581256, "post_id": 34536499, "comment_id": 56840896, "body": "@stites I have added a rendering which you should be able to see."}], "tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 3, "last_activity_date": 1451581179, "last_edit_date": 1451581179, "creation_date": 1451506031, "answer_id": 34536499, "question_id": 34535067, "link": "https://stackoverflow.com/questions/34535067/is-there-a-point-free-way-to-convert-a-conditional-check-into-a-maybe-type-of-th/34536499#34536499", "title": "Is there a point-free way to convert a conditional check into a Maybe type of the input?", "body": "<p>If we choose a Church-encoding for Booleans\u2026</p>\n\n<pre><code>truth :: Bool -&gt; a -&gt; a -&gt; a\ntruth True  t f = t\ntruth False t f = f\n</code></pre>\n\n<p>Then we can write a point-free <code>maybeIf</code> in Applicative-style.</p>\n\n<pre><code>maybeIf :: (a -&gt; Bool) -&gt; a -&gt; Maybe a\nmaybeIf = liftA3 truth &lt;*&gt; pure Just &lt;*&gt; pure (pure Nothing)\n</code></pre>\n\n<p>Some intuitions\u2026</p>\n\n<pre><code>f &lt;$&gt; m\u2081 &lt;*&gt; \u2026 &lt;*&gt; m\u2099 = \\x -&gt; f (m\u2081 x) \u2026 (m\u2099 x)\nliftA\u2099 f &lt;$&gt; m\u2081 &lt;*&gt; \u2026 &lt;*&gt; m\u2099 = \\x -&gt; f &lt;$&gt; m\u2081 x &lt;*&gt; \u2026 &lt;*&gt; m\u2099 x\n</code></pre>\n\n<p>Here is a rendering in PNG format of the above \"intuitions\", in case your installed fonts do not support the needed unicode characters.</p>\n\n<p><a href=\"https://i.stack.imgur.com/378nc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/378nc.png\" alt=\"enter image description here\"></a></p>\n\n<p>So therefore:</p>\n\n<pre><code>liftA3 truth &lt;*&gt; pure Just &lt;*&gt; pure (pure Nothing)\n= liftA3 truth &lt;$&gt; id &lt;*&gt; pure Just &lt;*&gt; pure (pure Nothing)\n= \\p -&gt; truth &lt;$&gt; id p &lt;*&gt; (pure Just) p &lt;*&gt; (pure (pure Nothing)) p\n= \\p -&gt; truth &lt;$&gt; p &lt;*&gt; Just &lt;*&gt; pure Nothing\n= \\p -&gt; \\a -&gt; truth (p a) (Just a) ((pure Nothing) a)\n= \\p -&gt; \\a -&gt; truth (p a) (Just a) Nothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": true, "score": 7, "last_activity_date": 1451527501, "last_edit_date": 1451527501, "creation_date": 1451517004, "answer_id": 34538678, "question_id": 34535067, "link": "https://stackoverflow.com/questions/34535067/is-there-a-point-free-way-to-convert-a-conditional-check-into-a-maybe-type-of-th/34538678#34538678", "title": "Is there a point-free way to convert a conditional check into a Maybe type of the input?", "body": "<p>You can import <code>find</code> from <code>Data.Foldable</code> and then it's quite simply:</p>\n\n<pre><code>import Data.Foldable(find)\n\nmaybeIf cond = find cond . Just\n</code></pre>\n\n<p>The function <code>find</code> is not complicated so you could quite easily define it yourself less generically, in terms of <code>Maybe</code>, but it isn't actually so different from your own implementation of <code>maybeIf</code> so you might not gain much, depending on why you wanted to do it.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1451529385, "post_id": 34540058, "comment_id": 56822632, "body": "@dfeuer I&#39;ve edited, thanks. The resulting expression is unremarkable, but at least it&#39;s pointfree now."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1451535680, "post_id": 34540058, "comment_id": 56823889, "body": "Hm.... I wonder if there&#39;s any sense to be found in the generalization <code>ensure p = join (bool (const empty) pure . p)</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451541951, "post_id": 34540058, "comment_id": 56825642, "body": "@dfeuer nice! it&#39;s much clearer that way... and with the new base this is the same as Daniel Wagner&#39;s excellent  <code>(&lt;$) &lt;*&gt; guard . p</code>, since now <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad.html#v:guard\" rel=\"nofollow noreferrer\"><code>guard :: Alternative f =&gt; Bool -&gt; f ()</code></a>! (i.e. not <code>MonadPlus</code>)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1451699579, "post_id": 34540058, "comment_id": 56867335, "body": "@dfeuer somehow I forgot about <code>=&lt;&lt;</code>; it&#39;s even simpler with it, <code>(bool (const empty) pure =&lt;&lt;)</code>."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1545900199, "last_edit_date": 1545900199, "creation_date": 1451527523, "answer_id": 34540058, "question_id": 34535067, "link": "https://stackoverflow.com/questions/34535067/is-there-a-point-free-way-to-convert-a-conditional-check-into-a-maybe-type-of-th/34540058#34540058", "title": "Is there a point-free way to convert a conditional check into a Maybe type of the input?", "body": "<p>Following <a href=\"https://stackoverflow.com/questions/34535067/is-there-a-point-free-way-to-convert-a-conditional-check-into-a-maybe-type-of-th/34540058#comment56816052_34535374\">dfeuer's lead</a> (and using Daniel Wagner's new name for this function),</p>\n\n<pre><code>import Data.Bool (bool)\n--         F    T    \n-- bool :: a -&gt; a -&gt; Bool -&gt; a\n\nensure :: (a -&gt; Bool) -&gt; a -&gt; Maybe a\nensure p x = bool (const Nothing) Just (p x) x\n\nensure p   = join (bool (const Nothing) Just . p)\n           = bool (const Nothing) Just =&lt;&lt; p  \n\nensure     = (bool (const Nothing) Just =&lt;&lt;)\n</code></pre>\n\n<p><code>join</code> is a monadic function, <code>join :: Monad m =&gt; m (m a) -&gt; m a</code>, but for functions it is simply </p>\n\n<pre><code>join   k  x = k x x\n(k =&lt;&lt; f) x = k (f x) x  \n</code></pre>\n\n<p><code>join</code> is accepted as a replacement for <a href=\"https://en.wikipedia.org/wiki/B,_C,_K,_W_system\" rel=\"nofollow noreferrer\">W combinator</a> in point-free code.</p>\n\n<p>You only wanted it point-free with respect to the value argument, but it's easy to transform the equation with <code>join</code> further (readability of the result is another issue altogether), as</p>\n\n<pre><code>          = join ((bool (const Nothing) Just .) p)\n          = (join . (bool (const Nothing) Just .)) p\n</code></pre>\n\n<p>Indeed,</p>\n\n<pre><code> #&gt; (join . (bool (const Nothing) Just .)) even 3\nNothing\n\n #&gt; (bool (const Nothing) Just =&lt;&lt;) even 4\nJust 4\n</code></pre>\n\n<p>But I'd much rather see <code>\\p x -&gt; listToMaybe [x | p x]</code> in an actual code. </p>\n\n<p>Or just <code>\\p x -&gt; [x | p x]</code>, with Monad Comprehensions. Which <em>is</em> the same as <a href=\"https://stackoverflow.com/a/34535374/849891\">Daniel Wagner's</a> <code>x &lt;$ guard (p x)</code>, only with different syntax.</p>\n"}, {"tags": [], "owner": {"reputation": 406, "user_id": 1611356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76c330d7f0f21c0b2519a3c675b870fe?s=128&d=identicon&r=PG", "display_name": "Paul Gardiner", "link": "https://stackoverflow.com/users/1611356/paul-gardiner"}, "is_accepted": false, "score": 1, "last_activity_date": 1545494939, "creation_date": 1545494939, "answer_id": 53897243, "question_id": 34535067, "link": "https://stackoverflow.com/questions/34535067/is-there-a-point-free-way-to-convert-a-conditional-check-into-a-maybe-type-of-th/53897243#53897243", "title": "Is there a point-free way to convert a conditional check into a Maybe type of the input?", "body": "<p>This function is defined in Control.Monad.Plus and is called <a href=\"http://hackage.haskell.org/package/monadplus-1.4.2/docs/Control-Monad-Plus.html\" rel=\"nofollow noreferrer\">partial</a></p>\n"}], "owner": {"reputation": 3883, "user_id": 1529734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c7d967945459535ac46463f40783caf2?s=128&d=identicon&r=PG", "display_name": "stites", "link": "https://stackoverflow.com/users/1529734/stites"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 720, "favorite_count": 1, "accepted_answer_id": 34538678, "answer_count": 5, "score": 6, "last_activity_date": 1545900199, "creation_date": 1451500119, "question_id": 34535067, "link": "https://stackoverflow.com/questions/34535067/is-there-a-point-free-way-to-convert-a-conditional-check-into-a-maybe-type-of-th", "title": "Is there a point-free way to convert a conditional check into a Maybe type of the input?", "body": "<p>I am just working through some simple exercises in haskell and was wondering if there was a point-free way of converting an if-then-else statement into a <code>Maybe</code> type: <code>Nothing</code> being returned if the condition is false, and <code>Just</code> the input if the condition is true.</p>\n\n<p>In short, given some:</p>\n\n<pre><code>maybeIf :: (a -&gt; Bool) -&gt; a -&gt; Maybe a\nmaybeIf cond a = if cond a then Just a else Nothing\n</code></pre>\n\n<p>Is there an implementation that is point-free with respect to <code>a</code>? I've also been looking at a more concrete version, <code>a -&gt; Maybe a</code>, and feel like there may be an answer somewhere in <code>Control.Arrow</code>. However, since <code>Maybe</code> is a data type and if-else statements control data flow, I'm unsure if there is a clean way of doing it.</p>\n"}, {"tags": ["haskell", "monads", "functor"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1451502666, "post_id": 34534956, "comment_id": 56813005, "body": "<code>fmap f = return . f</code> \u2013 this doesn&#39;t work. The type of <code>return . f</code> is <code>a -&gt; m b</code>, not <code>m a -&gt; m b</code>. Neither does <code>mapper</code> work: you can&#39;t pattern-match on <code>id</code> or <code>\u2218</code> unless you define them as <i>data constructors</i>. \u2014 Anyway... I don&#39;t quite see what you&#39;re trying to achieve here. A monad is, fundamentally, first of all a functor. Even if it&#39;s technically possible to omit that requirement, doesn&#39;t mean it makes sense to do that. Haskell98 did, and it was quickly realised that this wasn&#39;t a good idea."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1451820381, "post_id": 34534956, "comment_id": 56896669, "body": "<code>(g &lt;$&gt;) = (return . g =&lt;&lt;)</code>, i.e. <code>return</code> is not enough, you also need bind for this. <code>(k =&lt;&lt;) = join . (k &lt;$&gt;)</code>, so you must have <code>(&lt;$&gt;)</code> (i.e. <code>fmap</code>) with the <code>join</code>. cf. <a href=\"http://stackoverflow.com/questions/34545818/is-monad-bind-operator-closer-to-function-composition-chaining-or-functi/34561605#34561605\" title=\"is monad bind operator closer to function composition chaining or functi\">stackoverflow.com/questions/34545818/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1451511972, "post_id": 34535683, "comment_id": 56817548, "body": "<code>join . fmap f</code> <i>will</i> be slower than <code>(f =&lt;&lt;)</code> for many functors."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1451502710, "creation_date": 1451502710, "answer_id": 34535683, "question_id": 34534956, "link": "https://stackoverflow.com/questions/34534956/defining-monad-from-scratch-in-haskell/34535683#34535683", "title": "Defining monad from scratch in Haskell", "body": "<p>Some small corrections:</p>\n\n<blockquote>\n  <p>A monad may be defined by the bind operator <code>(&gt;&gt;=)</code> and the function <code>return</code>, but it also may be defined in terms of <code>return</code> and <code>join</code> since this last function it can be expressed in terms of the bind operator: <code>join m = m &gt;&gt;= id</code>.</p>\n</blockquote>\n\n<p>The conclusion (\"[a monad] also may be defined in terms of <code>return</code> and <code>join</code>\") is correct, but the premise (\"since [<code>join</code>] can be expressed in terms of the bind operator\") does not imply it. Instead you must show that the operator you are omitting -- the bind operator -- may be defined in terms of the things you have -- <code>return</code> and <code>join</code>. Once you try to do this, you see why it is so critical that a monad also be a functor:</p>\n\n<pre><code>m &gt;&gt;= f = join (fmap f m)\n</code></pre>\n\n<blockquote>\n  <p>The function <code>fmap</code> is required (and the base of existence of a <code>Functor</code> in Haskell), but also could be defined in terms of <code>return</code>, for it may be defined also (I think) as follows: <code>fmap f m = return . f</code></p>\n</blockquote>\n\n<p>That's not quite a correct definition of <code>fmap</code> -- and you should be suspicious indeed, since the right hand side doesn't mention <code>m</code>! A correct version would be:</p>\n\n<pre><code>fmap f m = m &gt;&gt;= return . f\n</code></pre>\n\n<p>But now this is a circular definition, since above we planned on defining <code>(&gt;&gt;=)</code> in terms of <code>fmap</code>. So if you want to make <code>return</code> and <code>join</code> the basic operations of <code>Monad</code>, you really do need to implement <code>fmap</code> separately.</p>\n\n<blockquote>\n  <p>I know this wouldn't be as efficient as using the predefined <code>Monad</code> typeclass</p>\n</blockquote>\n\n<p>I don't see any reason to believe this a priori. The reason <code>(&gt;&gt;=)</code> is chosen over <code>join</code> is not because it is more efficient, but because it is such a natural operation when using monads in programming. </p>\n\n<p>As for your actual code, I think it looks fine with two caveats:</p>\n\n<ol>\n<li><p>I strongly suspect your definition of <code>mapper</code> does not do what you think it does. In the line <code>mapper id = id</code>, the pattern <code>id</code> on the left hand side matches all incoming values, and the variable <code>id</code> on the right hand side returns them unchanged. The line <code>mapper (f \u2218 g) = mapper f \u2218 mapper g</code> is simply not valid Haskell. (Perhaps these two lines were intended to be documentation of the laws required of <code>mapper</code> rather than actual code?)</p></li>\n<li><p>It is strange to offer default implementations of <code>join</code> and <code>mapper</code> in terms of <code>(&gt;&gt;=)</code> -- both for the reasons above (all three are fundamental and must be defined) and because <code>(&gt;&gt;=)</code> is not a class operation, hence can't be defined by the user in a meaningful way.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 866, "user_id": 2415602, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pSmrA.jpg?s=128&g=1", "display_name": "J. A. Corbal", "link": "https://stackoverflow.com/users/2415602/j-a-corbal"}, "is_accepted": true, "score": 2, "last_activity_date": 1451550690, "creation_date": 1451550690, "answer_id": 34543474, "question_id": 34534956, "link": "https://stackoverflow.com/questions/34534956/defining-monad-from-scratch-in-haskell/34543474#34543474", "title": "Defining monad from scratch in Haskell", "body": "<p>Okay, it wasn't that difficult. I had the misconception that implementing a own monad type will be extremely complex, but it's just applying the definition.</p>\n\n<pre><code>-- My monad\nclass MyMonad m where\n    unit :: a -&gt; m a\n    join :: m (m a) -&gt; m a\n    mapf :: (a -&gt; b) -&gt; m a -&gt; m b\n\n\n--Testing MyMonad\ndata Tree a = Leaf a | Branch (Tree a) (Tree a) deriving (Show)\n\ninstance MyMonad Tree where\n    unit = Leaf\n    join (Leaf x) = x\n    join (Branch l r) = Branch (join l) (join r)\n    mapf f (Leaf x) = Leaf (f x)\n    mapf f (Branch l r) = Branch (mapf f l) (mapf f r)\n\nt = Branch (Branch (Leaf 1) (Leaf 3)) (Branch (Leaf 2) (Leaf 4))\n\n\n-- My bind (just for completeness, not that I need it for this example)\n(&gt;&gt;&gt;) :: MyMonad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\nxs &gt;&gt;&gt; f = join (mapf f xs)\n\n\n-- Testing my bind\nextr :: Integer -&gt; Tree Integer\nextr x = Branch (Leaf (x^2)) (Leaf (2^x))\n\nt &gt;&gt;&gt; extr\n--Branch (Branch (Branch (Leaf 1) (Leaf 2)) (Branch (Leaf 9) (Leaf 8))) \n--       (Branch (Branch (Leaf 4) (Leaf 4)) (Branch (Leaf 16) (Leaf 16)))\n</code></pre>\n"}], "owner": {"reputation": 866, "user_id": 2415602, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pSmrA.jpg?s=128&g=1", "display_name": "J. A. Corbal", "link": "https://stackoverflow.com/users/2415602/j-a-corbal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 1, "accepted_answer_id": 34543474, "answer_count": 2, "score": 0, "last_activity_date": 1452202059, "creation_date": 1451499634, "last_edit_date": 1452202059, "question_id": 34534956, "link": "https://stackoverflow.com/questions/34534956/defining-monad-from-scratch-in-haskell", "title": "Defining monad from scratch in Haskell", "body": "<p>After studying about monads in Haskell \u2014 a subject that is very compelling for everything that implies \u2014 I wonder if I could define a monad on my own without using the already defined typeclasses.</p>\n\n<p>Instead of making <code>Monad</code> an instance of <code>Functor</code>, I just want to define a monad per se, with it's own <code>fmap</code> function (Also I wanted to change some function names such as <code>return</code> and call it <code>unit</code>).</p>\n\n<p>A monad may be defined by the bind operator <code>(&gt;&gt;=)</code> and the function <code>return</code>, but it also may be defined in terms of <code>return</code> and <code>join</code> since this last function it can be expressed in terms of the bind operator: <code>join m = m &gt;&gt;= id</code>. So a monad could be (technically) defined in terms of <code>return</code> and <code>join</code> and nothing else. The function <code>fmap</code> is required (and the base of existence of a <code>Functor</code> in Haskell), but also could be defined in terms of <code>return</code>, for it may be defined also (I think) as follows: <code>fmap f m = m &gt;&gt;= return . f</code> <em>(before edit it was written, <code>fmap f m = return . f</code>; it was obviously a typo)</em>.</p>\n\n<p>Yet I know this wouldn't be as efficient as using the predefined <code>Monad</code> typeclass, it's just to understand better the Haskell language.</p>\n\n<p>How can I accomplish that? This is a depiction of this concept out of my head, right now, so it's not useful code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- Just a sketch\ninfixr 9 \u2218\n(\u2218) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n(\u2218) g f x = g (f x)\n--(f \u2218 g) x = f (g x)\n\n-- My own 'fmap'\n--mapper id  =  id\n--mapper (f \u2218 g) = mapper f \u2218 mapper g\n\n\n-- My monad\nclass MyMonadBase (m :: * -&gt; *) where\n    unit :: a -&gt; m a   --return\n\n    join :: m (m a) -&gt; m a\n    join = (&gt;&gt;= id)\n\n    mapper f m = m &gt;&gt;= unit \u2218 f\n\n\n--Testing:\ndata Tree a = Leaf a | Branch (Tree a) (Tree a)\n\ninstance MyMonadBase Tree where\n    unit = Leaf\n    join (Leaf x) = x\n    join (Branch l r)  = Branch (join l) (join r)\n</code></pre>\n\n<p>Am I in the right track (conceptually)?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 585, "user_id": 2844582, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc74eb3fe99c52ceaec1db7e8a720fe1?s=128&d=identicon&r=PG&f=1", "display_name": "Xandaros", "link": "https://stackoverflow.com/users/2844582/xandaros"}, "edited": false, "score": 1, "creation_date": 1451499291, "post_id": 34533516, "comment_id": 56811414, "body": "In the type signature of <code>intListProd</code>, you have <code>Int List</code>. I assume that is meant to be <code>IntList</code>?"}, {"owner": {"reputation": 212, "user_id": 936085, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8dc32848fa83f04f67d3c4adcc566cf5?s=128&d=identicon&r=PG", "display_name": "natecornell", "link": "https://stackoverflow.com/users/936085/natecornell"}, "reply_to_user": {"reputation": 585, "user_id": 2844582, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc74eb3fe99c52ceaec1db7e8a720fe1?s=128&d=identicon&r=PG&f=1", "display_name": "Xandaros", "link": "https://stackoverflow.com/users/2844582/xandaros"}, "edited": false, "score": 0, "creation_date": 1451513839, "post_id": 34533516, "comment_id": 56818396, "body": "Oh, yeah; that wasn&#39;t in my code, I typed this by hand. :)  Fixed it."}], "answers": [{"comments": [{"owner": {"reputation": 212, "user_id": 936085, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8dc32848fa83f04f67d3c4adcc566cf5?s=128&d=identicon&r=PG", "display_name": "natecornell", "link": "https://stackoverflow.com/users/936085/natecornell"}, "edited": false, "score": 0, "creation_date": 1451494806, "post_id": 34533606, "comment_id": 56809037, "body": "Thanks. It&#39;s interesting, though; I was able to use other data type definitions without exporting the constructor in this way. For example <code>data Person = Person String Int Thing deriving Show</code>. What makes the IntList constructor special?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 212, "user_id": 936085, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8dc32848fa83f04f67d3c4adcc566cf5?s=128&d=identicon&r=PG", "display_name": "natecornell", "link": "https://stackoverflow.com/users/936085/natecornell"}, "edited": false, "score": 0, "creation_date": 1451496960, "post_id": 34533606, "comment_id": 56810216, "body": "See @ReidBarton&#39;s answer. GHC didn&#39;t load all definitions."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1451494140, "creation_date": 1451494140, "answer_id": 34533606, "question_id": 34533516, "link": "https://stackoverflow.com/questions/34533516/not-in-scope-data-constructor-cons/34533606#34533606", "title": "Not in scope: data constructor \u2018Cons\u2019", "body": "<pre><code>module Lib\n    (intListProd) where\n</code></pre>\n\n<p>You're not exporting any constructor of <code>IntList</code>. Export them, so that they're available to other modules:</p>\n\n<pre><code>module Lib\n    (intListProd, IntList(..)) where\n           --     ^^^^^^^^^^^\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 1, "last_activity_date": 1451495143, "creation_date": 1451495143, "answer_id": 34533871, "question_id": 34533516, "link": "https://stackoverflow.com/questions/34533516/not-in-scope-data-constructor-cons/34533871#34533871", "title": "Not in scope: data constructor \u2018Cons\u2019", "body": "<p>The secret is here in the GHCi prompt:</p>\n\n<pre><code>*Main Lib&gt;\n</code></pre>\n\n<p>For modules marked with a <code>*</code> (usually there is exactly one of these) <em>all</em> definitions are in scope, not just ones that are exported from the module. Modules without a <code>*</code> obey the usual rule: only exported names are visible in GHCi.</p>\n"}], "owner": {"reputation": 212, "user_id": 936085, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8dc32848fa83f04f67d3c4adcc566cf5?s=128&d=identicon&r=PG", "display_name": "natecornell", "link": "https://stackoverflow.com/users/936085/natecornell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 682, "favorite_count": 0, "accepted_answer_id": 34533606, "answer_count": 2, "score": 0, "last_activity_date": 1451513860, "creation_date": 1451493808, "last_edit_date": 1451513860, "question_id": 34533516, "link": "https://stackoverflow.com/questions/34533516/not-in-scope-data-constructor-cons", "title": "Not in scope: data constructor \u2018Cons\u2019", "body": "<p>I'm having trouble with the following Data Type and Function:</p>\n\n<pre><code>module Lib\n    (intListProd) where\n\ndata IntList = Empty\n             | Cons Int IntList\n  deriving Show\n\nintListProd :: IntList -&gt; Int\nintListProd Empty = 1\nintListProd (Cons x xs) = x * intListProd xs\n</code></pre>\n\n<p>But if I try to use it within ghci, I get errors about 'Cons' and 'Empty' not being in the scope:</p>\n\n<pre><code>*Main Lib&gt; intListProd (Cons 3 (Cons 2 (Cons 4 Empty)))\n\n&lt;interactive&gt;:19:14: Not in scope: data constructor \u2018Cons\u2019\n\n&lt;interactive&gt;:19:22: Not in scope: data constructor \u2018Cons\u2019\n\n&lt;interactive&gt;:19:30: Not in scope: data constructor \u2018Cons\u2019\n\n&lt;interactive&gt;:19:37: Not in scope: data constructor \u2018Empty\u2019\n</code></pre>\n\n<p>I'm using stack, so I use 'stack ghci' to enter the shell.</p>\n\n<p>The code is not my own, I'm trying to follow the examples at the end of chapter 2 in the <a href=\"https://www.fpcomplete.com/school/starting-with-haskell/introduction-to-haskell\" rel=\"nofollow\">School of Haskell Introduction to Haskell</a> tutorial by Brent Yorgey.</p>\n\n<p>I've noticed the \"Learn you a Haskell\" also uses the 'Cons' constructor in the \"Recursive Data Types\" section. Is 'Cons' something that should be included in GHC that I don't have for some reason?? What about 'Empty'?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1451494777, "post_id": 34533699, "comment_id": 56809024, "body": "Can you elaborate? What is &quot;Structure&quot; in uppercase? And what is a sensible name for &quot;f&quot;? Is it some kind of permission?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1451495207, "post_id": 34533699, "comment_id": 56809267, "body": "@dsign, <code>Structure</code> in uppercase is the actual record type, which the function is free to inspect. <code>f</code> is the mutator. The lens passed to it is the permission/capability. If you want, you can limit the function still further by not letting it inspect the structure freely but rather giving it some <code>Getter</code>s. You can also wrap up the access lens(es) in one or more classes--see <code>Control.Lens.TH</code> for some &quot;classy&quot; tools and ideas."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 1, "last_activity_date": 1451495584, "last_edit_date": 1451495584, "creation_date": 1451494513, "answer_id": 34533699, "question_id": 34533354, "link": "https://stackoverflow.com/questions/34533354/compose-a-function-to-preserve-record-members/34533699#34533699", "title": "Compose a function to preserve record members", "body": "<p>This is not the best way to use the lens library to accomplish your purpose, in my opinion. It is potentially inefficient and can open up \"security holes\" if new \"sensitive\" fields are added to the structure without updating the <code>preserving</code> call(s). Instead of enumerating the things the mutator must <em>preserve</em>, you should enumerate the things it may <em>change</em>. So</p>\n\n<pre><code>mutateMemberWith :: (forall structure .\n                  Structure -- Input\n               -&gt; structure -- Copy of input\n               -&gt; Lens' structure Member\n               -&gt; structure)\n           -&gt; Structure\n           -&gt; Structure\nmutateMemberWith f s = f s s appropriateLens\n</code></pre>\n\n<p>The function passed in is not allowed to care what type it produces, so it can only produce it by modifying the input using the given lens.</p>\n"}], "owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "accepted_answer_id": 34533699, "answer_count": 1, "score": 2, "last_activity_date": 1451495584, "creation_date": 1451493208, "question_id": 34533354, "link": "https://stackoverflow.com/questions/34533354/compose-a-function-to-preserve-record-members", "title": "Compose a function to preserve record members", "body": "<p>I have a record, say <code>structure</code>, and a mutator function that transforms that record somehow (for example, by altering a member):</p>\n\n<pre><code> a_mutator :: structure -&gt; structure \n</code></pre>\n\n<p>(The <code>structure</code> could be the default configuration of my program. The mutator could be a function that changes that default configuration according to command-line options). </p>\n\n<p>(We can also write an alias: </p>\n\n<pre><code> type Mutator structure = structure -&gt; structure\n</code></pre>\n\n<p>)</p>\n\n<p>Now, I don't want the mutator to change certain members of the structure. For example, the user may not be allowed to change the working mode in the configuration.</p>\n\n<p>The way I will enforce that is by saving those members first, applying the mutator, and then putting back the preserved members:</p>\n\n<pre><code>preserving :: Lens' structure member -&gt; (structure -&gt; structure) -&gt; (structure -&gt; structure )\npreserving le mutator = \\ target -&gt; \n  let \n    previous_value = target ^. le \n    mutated = mutator target \n  in set le previous_value mutated \n</code></pre>\n\n<p>where <code>(^.)</code> and <code>set</code> are coming from the <a href=\"https://github.com/ekmett/lens/wiki/Overview\" rel=\"nofollow\">lens</a> library.</p>\n\n<p>Now, since the type of <code>preserving</code>  can be re-written as </p>\n\n<pre><code>preserving :: Lens' structure member -&gt; Mutator structure -&gt; Mutator structure \n</code></pre>\n\n<p>it is plausible to compose partial applications of the <code>preserving</code> function:</p>\n\n<pre><code>preserving lens1 . preserving lens2\n</code></pre>\n\n<p>with the intention of preserving both the member pointed to by lens1 and the member pointed to by lens2. The question is, does this work? That is, <code>preserving</code> applications \"compose\" this way? If so, how can I build some kind of proof of it? And if they don't compose, how can I fix it?</p>\n"}, {"tags": ["haskell", "list-comprehension"], "answers": [{"comments": [{"owner": {"reputation": 1306, "user_id": 1628919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fd5cdad968abf48f8911fac02719bce?s=128&d=identicon&r=PG", "display_name": "Untitled123", "link": "https://stackoverflow.com/users/1628919/untitled123"}, "edited": false, "score": 0, "creation_date": 1451495343, "post_id": 34533320, "comment_id": 56809342, "body": "I guess my question is that why is the promotion of ** executed prior to mod? Or does it try to reconcile all things first?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1306, "user_id": 1628919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fd5cdad968abf48f8911fac02719bce?s=128&d=identicon&r=PG", "display_name": "Untitled123", "link": "https://stackoverflow.com/users/1628919/untitled123"}, "edited": false, "score": 3, "creation_date": 1451495747, "post_id": 34533320, "comment_id": 56809578, "body": "@Untitled123: yes, it always tries to reconcile all things first. There is <i>no such thing</i> as type promotion in Haskell!"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 6, "last_activity_date": 1451493092, "creation_date": 1451493092, "answer_id": 34533320, "question_id": 34532972, "link": "https://stackoverflow.com/questions/34532972/execution-order-of-list-comprehension-filtering/34533320#34533320", "title": "Execution order of list comprehension filtering", "body": "<p>Let's have a look at the types of <code>mod</code> and <code>(**)</code>:</p>\n\n<pre><code>mod  :: Integral n =&gt; n -&gt; n -&gt; n\n(**) :: Floating a =&gt; a -&gt; a -&gt; a\n     -- hm......\n</code></pre>\n\n<p><code>mod</code> and <code>(**)</code> put other constraints on the used type. <code>mod</code> expects an integral type (<code>Int</code>, <code>Integer</code>), whereas <code>(**)</code> expects a floating type (<code>Float</code>, <code>Double</code>). Since there's no type that's both integral <em>and</em> a floating point number, GHC gives up.</p>\n\n<p>Instead, use <code>(^)</code>:</p>\n\n<pre><code>(^) :: (Integral n, Num a) =&gt; a -&gt; n -&gt; a\n</code></pre>\n\n<p>E.g.</p>\n\n<pre><code>[x ^ 2 | x &lt;- [1..10], x `mod` 3 == 2]\n</code></pre>\n\n<p>By the way, you can find errors like this easier if you try to give a type to the result:</p>\n\n<pre><code>ghci&gt; [x ** 2 | x &lt;- [1..10], x `mod` 3 == 2] :: [Int]\n&lt;interactive&gt;:1:4:\n    No instance for (Floating Int) arising from a use of `**'\n    In the expression: x ** 2\n    ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 886, "user_id": 825623, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vtnxn.jpg?s=128&g=1", "display_name": "tiredpixel", "link": "https://stackoverflow.com/users/825623/tiredpixel"}, "edited": false, "score": 0, "creation_date": 1451510474, "post_id": 34533386, "comment_id": 56816897, "body": "Do you mean <code>(^)</code> rather than <code>(^^)</code>?"}, {"owner": {"reputation": 4050, "user_id": 3926, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/70ae6f8633cafd248c868d5602084743?s=128&d=identicon&r=PG", "display_name": "nimish", "link": "https://stackoverflow.com/users/3926/nimish"}, "reply_to_user": {"reputation": 886, "user_id": 825623, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vtnxn.jpg?s=128&g=1", "display_name": "tiredpixel", "link": "https://stackoverflow.com/users/825623/tiredpixel"}, "edited": false, "score": 0, "creation_date": 1451564441, "post_id": 34533386, "comment_id": 56834348, "body": "<code>(^)</code> returns an integral type, so it really depends on what you want."}, {"owner": {"reputation": 886, "user_id": 825623, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vtnxn.jpg?s=128&g=1", "display_name": "tiredpixel", "link": "https://stackoverflow.com/users/825623/tiredpixel"}, "edited": false, "score": 0, "creation_date": 1451589580, "post_id": 34533386, "comment_id": 56843820, "body": "I see. It&#39;s just I get an error when trying the original code using <code>(^^)</code>\u2014because it&#39;s not a ratio, of course. But yes, <code>(^)</code> works fine."}], "tags": [], "owner": {"reputation": 4050, "user_id": 3926, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/70ae6f8633cafd248c868d5602084743?s=128&d=identicon&r=PG", "display_name": "nimish", "link": "https://stackoverflow.com/users/3926/nimish"}, "is_accepted": false, "score": 0, "last_activity_date": 1451493346, "creation_date": 1451493346, "answer_id": 34533386, "question_id": 34532972, "link": "https://stackoverflow.com/questions/34532972/execution-order-of-list-comprehension-filtering/34533386#34533386", "title": "Execution order of list comprehension filtering", "body": "<p>List comprehension in haskell desugars to a do-block using the list monad. In your example,  it would be something like:</p>\n\n<pre><code>x &lt;- [1..10]\nguard $ (x `mod` 3) == 2\nreturn $ x**2\n</code></pre>\n\n<p>In this case it attempts to unify the types of <code>(**) x 2</code> and <code>mod x 3</code> which fails because you <a href=\"https://wiki.haskell.org/Converting_numbers#Converting_between_different_floating-point_precisions\" rel=\"nofollow\">can't</a> unify a Floating type with an Integral type without explicitly converting between the two. </p>\n\n<p>You've got a few options: use  <code>(^^)</code> instead of <code>(**)</code> or do <code>((fromIntegral x) ** 2)</code> if you want <code>x</code> to be an integral type, or somehow round <code>x</code> to an integral type if you want it to be a floating type.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1451493772, "last_edit_date": 1451493772, "creation_date": 1451493387, "answer_id": 34533401, "question_id": 34532972, "link": "https://stackoverflow.com/questions/34532972/execution-order-of-list-comprehension-filtering/34533401#34533401", "title": "Execution order of list comprehension filtering", "body": "<p>The first example works because of defaulting. The expression is inferred as having type</p>\n\n<pre><code>Integral a =&gt; [a]\n</code></pre>\n\n<p>and then the <code>a</code> type variable is defaulted to <code>Integer</code> for convenience.</p>\n\n<p>In the second expression, the use of <code>**</code> forces <code>x</code> to be <code>Floating</code> and the <code>mod</code> forces it to be <code>Integral</code>. So GHC infers that the expression has type</p>\n\n<pre><code>(Integral a, Floating a) =&gt; [a]\n</code></pre>\n\n<p>There is no standard numeric type that is both <code>Integral</code> and <code>Floating</code>, let alone one that participates in defaulting.</p>\n\n<p>You mentioned the notion of numeric promotion in your question. C, C++, Java, and maybe some other languages have such a thing. Haskell does not, and those of us who use it tend to be grateful for that. All conversions from one numeric type to another have to be done using explicit conversion functions like <code>fromIntegral</code>, <code>fromRational</code>, <code>round</code>, <code>floor</code>, <code>%</code>, etc.</p>\n\n<p>You probably meant to use <code>^</code> instead of <code>**</code>, which would leave just the <code>Integral a</code> constraint. In a real program, you should generally <em>avoid</em> the defaulting mechanism by including a type signature. You can turn it off altogether using</p>\n\n<pre><code>default ()\n</code></pre>\n\n<p>somewhere in your module.</p>\n"}], "owner": {"reputation": 1306, "user_id": 1628919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fd5cdad968abf48f8911fac02719bce?s=128&d=identicon&r=PG", "display_name": "Untitled123", "link": "https://stackoverflow.com/users/1628919/untitled123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "accepted_answer_id": 34533320, "answer_count": 3, "score": 2, "last_activity_date": 1451493772, "creation_date": 1451491685, "last_edit_date": 1451492416, "question_id": 34532972, "link": "https://stackoverflow.com/questions/34532972/execution-order-of-list-comprehension-filtering", "title": "Execution order of list comprehension filtering", "body": "<p>Just started learning Haskell and came across this issue. \nIf I have a list comprehension with a condition such as </p>\n\n<pre><code>[x*2 | x&lt;- [1..10], x `mod` 3 ==2]\n</code></pre>\n\n<p>I get </p>\n\n<pre><code>[4,10,16]\n</code></pre>\n\n<p>as expected. However, if I have instead</p>\n\n<pre><code>[x**2 | x&lt;- [1..10], x `mod` 3 ==2]\n</code></pre>\n\n<p>It is has the type variable as ambiguous for the mod function. I presume this is because x<sup>2</sup> promotes an integer to a float, but why does this affect the conditional? Why is the type ambiguous in this case? Does it calculate x<sup>2</sup>, and then square root it? (This seems highly improbable) Does it somehow keep track of the x that generated each x<sup>2</sup> term? </p>\n\n<p>Perhaps it's the imperative mindset, but internally, I thought the execution would be along the lines of [in python]</p>\n\n<pre><code>lst=[]\nfor x in range(10):\n if x%3==2:\n  lst.append(x**2)\n</code></pre>\n\n<p>Could someone clarify/correct my understanding?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1451484642, "post_id": 34530971, "comment_id": 56803550, "body": "Please add type signatures and a clear specification of what you mean by \u201csum up the results\u201d."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1451484735, "post_id": 34530971, "comment_id": 56803599, "body": "<i>I only managed to write a program [...]</i> Edit your question and add a <a href=\"http://stackoverflow.com/help/mcve\">minimal, complete, and verifiable example</a>, not just a fragment."}], "answers": [{"tags": [], "owner": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "is_accepted": false, "score": 1, "last_activity_date": 1451499134, "last_edit_date": 1451499134, "creation_date": 1451485329, "answer_id": 34531344, "question_id": 34530971, "link": "https://stackoverflow.com/questions/34530971/summing-up-haskell-output-lines/34531344#34531344", "title": "Summing up Haskell output lines", "body": "<p>Assuming that your conversion functions work for multi-line inputs, you can probably get away with simply replacing <code>getLine</code> with <code>getContents</code> and removing the recursive call to <code>main</code>. Although if you actually want to read a file, using <code>readFile</code> is probably cleaner than using <code>getContents</code>, since the latter is typically used for reading from the command line.</p>\n"}, {"tags": [], "owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "is_accepted": false, "score": 0, "last_activity_date": 1451496398, "creation_date": 1451496398, "answer_id": 34534176, "question_id": 34530971, "link": "https://stackoverflow.com/questions/34530971/summing-up-haskell-output-lines/34534176#34534176", "title": "Summing up Haskell output lines", "body": "<p>To expand upon what Paul wrote, <code>getContents</code> is like <code>getLine</code>, but it gives you the entire file in a single string. You can then get a list of lines using <code>lines</code>. For example:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  contents &lt;- getContents\n  print (lines contents)\n</code></pre>\n\n<p>When given the file</p>\n\n<pre><code>Haskell\nis\nneat!\n</code></pre>\n\n<p>will print <code>[\"Haskell\",\"is\",\"neat!\"]</code>. From here, you can <code>map</code> your line-handling function over that list to get a list of integers, and finally <code>print (sum resultList)</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 5730866, "user_type": "registered", "profile_image": "https://graph.facebook.com/1131732253517914/picture?type=large", "display_name": "Juozas Pa\u017e\u0117ra", "link": "https://stackoverflow.com/users/5730866/juozas-pa%c5%be%c4%97ra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1451499134, "creation_date": 1451483839, "question_id": 34530971, "link": "https://stackoverflow.com/questions/34530971/summing-up-haskell-output-lines", "title": "Summing up Haskell output lines", "body": "<p>I want to write a programm which would print out only one integer after applying some functions to the lines in text file, so far I have : </p>\n\n<pre><code>main = do\n   c &lt;- getLine\n   let plot = plots (split ',' (change c))\n   print plot\n   main\n</code></pre>\n\n<p>where plots, split and change are the functions that convert input from string to int removing non-integer chars and then applying some calculations, the problem is that my input file has a lot of lines and I only managed to write a program which applies those functions to every line separately and prints out the result of every line,(I get as much output lines as there are input lines), but I want that this programm would sum up the results of every line and would print out only that number, where should I start or maybe somebody knows the solution? I am new in Haskell so please don't judge :/ </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1451471509, "post_id": 34527554, "comment_id": 56796620, "body": "You probably want to represent the buffer as a list of lines, using a <a href=\"https://en.wikipedia.org/wiki/Zipper_&#40;data_structure&#41;\" rel=\"nofollow noreferrer\">Zipper</a> to represent your current position. For a guided example in Agda (you can replicate quite a bit of the work in Haskell), you can have a look at <a href=\"https://github.com/pigworker/CS410-14/blob/master/Ex5/Edit.agda\" rel=\"nofollow noreferrer\">this exercise</a>"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451472684, "post_id": 34527554, "comment_id": 56797176, "body": "See also: <a href=\"https://stackoverflow.com/questions/4046246/how-are-text-editors-generally-implemented\" title=\"how are text editors generally implemented\">stackoverflow.com/questions/4046246/&hellip;</a>. There&#39;s a way to speed up <code>findIndex</code> to O(n), but you still use indexed position afterwards, so it doesn&#39;t really help you in the long run."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451839569, "post_id": 34527554, "comment_id": 56902679, "body": "If you need to jump around, you should switch from a <i>list</i> zipper to a <i>sequence</i> zipper, using <code>Data.Sequence</code>. <code>data Zipper a = Zipper (Seq a) a (Seq a)</code> or similar. Unlike list zippers, you can keep everything in order, since the end is as fast as the beginning. And you can move <code>n</code> steps in <code>O(log n)</code> time."}], "answers": [{"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 3, "last_activity_date": 1451487283, "creation_date": 1451487283, "answer_id": 34531797, "question_id": 34527554, "link": "https://stackoverflow.com/questions/34527554/haskell-string-movement-functions/34531797#34531797", "title": "Haskell &quot;string movement&quot; functions", "body": "<p>As gallais says in the comments, you want to use a zipper. The idea is that your \"cursor\" is actually a data structure like this:</p>\n\n<pre><code>type Line = T.Text\n\ndata TextZipper = TextZipper {\n   textBefore :: [Line],\n   currentLine :: Line,\n   textAfter :: [Line]\n}\n</code></pre>\n\n<p>The trick is that \"textBefore\" contains the lines above the cursor <em>in reverse order</em>. So to move down a line you put the \"currentLine\" at the head of \"textBefore\" and get the new \"currentLine\" out of \"textAfter\", like this:</p>\n\n<pre><code>moveDown :: TextZipper -&gt; Maybe TextZipper\nmoveDown tzip = case textAfter tzip of\n   [] -&gt; Nothing    -- Already at the bottom of the file.\n   t:ts -&gt; TextZipper {\n      textBefore = currentLine tzip : textBefore tzip,\n      currentLine = t,\n      textAfter = ts\n   }\n</code></pre>\n\n<p>moveUp will be very similar. You will also need a textZipperToList function to extract the contents of the zipper for saving, and a textZipperFromList function.</p>\n\n<p>I recall reading somewhere that Emacs uses a similar concept except that it does it by character rather than by line. The buffer is represented as two blocks of text, one the block before the cursor, and one the block after the cursor. Moving the cursor is accomplished by copying characters from one block to the other. Same concept here. Given this you might want to think about replacing each list of lines with a single Text value.</p>\n"}], "owner": {"reputation": 315, "user_id": 5367513, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7bc3967ca71ebcd3dbb20b5b7552a904?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Syn&#225;\u010dek", "link": "https://stackoverflow.com/users/5367513/jan-syn%c3%a1%c4%8dek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 34531797, "answer_count": 1, "score": 2, "last_activity_date": 1451835905, "creation_date": 1451470914, "last_edit_date": 1451835905, "question_id": 34527554, "link": "https://stackoverflow.com/questions/34527554/haskell-string-movement-functions", "title": "Haskell &quot;string movement&quot; functions", "body": "<p>I'm trying to build a simple text editor using Haskell, hscurses and Data.Text. I'm quite new to Haskell.</p>\n\n<p>Here is a snippet from my code:</p>\n\n<pre><code>data Cursor = Cursor {\n  position :: Int,\n  line     :: Int,\n  column   :: Int\n} deriving (Eq, Show)\n\nisNewline :: Char -&gt; Bool\nisNewline c = c == '\\n'\n\nonNewline :: T.Text -&gt; Int -&gt; Bool\nonNewline buf pos\n  | pos &gt;= T.length buf = False\n  | otherwise           = isNewline $ T.index buf pos\n\nfindIndex :: (Char -&gt; Bool) -&gt; T.Text -&gt; Int -&gt; Maybe Int\nfindIndex pred buf pos\n  | buf == T.empty = Just 0\n  | otherwise      = rightWhile pos\n  where rightWhile pos\n          | pos &gt; bufMax buf       = Nothing\n          | pred $ T.index buf pos = Just pos\n          | otherwise              = rightWhile (pos + 1)\n\nfindIndexLeft :: (Char -&gt; Bool) -&gt; T.Text -&gt; Int -&gt; Maybe Int\nfindIndexLeft pred buf pos = leftWhile pos\n  where leftWhile pos\n          | pos &lt; 0                = Nothing\n          | pred $ T.index buf pos = Just pos\n          | otherwise              = leftWhile (pos - 1)\n\nstartOfLine :: T.Text -&gt; Int -&gt; Int\nstartOfLine buf pos = case findIndexLeft isNewline buf (pos - 1) of\n  Nothing -&gt; 0\n  Just p  -&gt; p + 1\n\nendOfLine :: T.Text -&gt; Int -&gt; Int\nendOfLine buf pos = case findIndex isNewline buf pos of\n  Nothing -&gt; 1 + bufMax buf\n  Just p  -&gt; p\n\nlineOffset :: T.Text -&gt; Int -&gt; Int\nlineOffset buf pos = pos - startOfLine buf pos\n\nlineLength :: T.Text -&gt; Int -&gt; Int\nlineLength buf pos = endOfLine buf pos - startOfLine buf pos\n\nbufMax :: T.Text -&gt; Int\nbufMax buf = max 0 $ T.length buf - 1\n\nbufLines :: T.Text -&gt; Int\nbufLines = T.foldl (\\acc c -&gt; if isNewline c then (acc+1) else acc) 0\n\nmoveCursorRight :: T.Text -&gt; Cursor -&gt; Cursor\nmoveCursorRight buf c@(Cursor pos line col)\n  | buf == T.empty = c\n  | otherwise      = Cursor newPos newLine newCol\n  where end       = 1 + bufMax buf\n        onEnd     = pos == end\n        newPos    = clip (pos + 1) 0 end\n        newLine   = if onNewline buf pos &amp;&amp; not onEnd\n                    then line + 1\n                    else line\n        newCol    = lineOffset buf newPos\n\nmoveCursorLeft :: T.Text -&gt; Cursor -&gt; Cursor\nmoveCursorLeft buf (Cursor pos line col) =\n  Cursor newPos newLine newCol\n  where onStart   = pos == 0\n        newPos    = clipLow (pos - 1) 0\n        newLine   = if onNewline buf newPos &amp;&amp; not onStart\n                    then line - 1\n                    else line\n        newCol    = lineOffset buf newPos\n\n-- More movement functions follow...\n</code></pre>\n\n<p>The problem with this code is that for buffers that are thousands of lines long, it gets very slow. That's probably because of the use of index functions, that are O(n) and not constant time as they would be in C, for example.</p>\n\n<p>How would a seasoned Haskeller approach this? What would be a reasonably efficient way to implement \"movement\" in strings in Haskell? The movement should also be composable, that is, I would like to be able to implement \"Page down\" in terms of \"Move one line down\", etc.</p>\n\n<p><strong>Edit: Update</strong></p>\n\n<p>Should anyone ever need this, here is what I ended up with.</p>\n\n<pre><code>type Line = T.Text\n\ndata BufferContext = BufferContext {\n  before   :: [Line],\n  at       :: Line,\n  after    :: [Line]\n} deriving (Eq, Show)\n\nmoveCursorRight :: Cursor -&gt; Cursor\nmoveCursorRight c@(Cursor pos line col bc@(BufferContext before at after))\n  | col &gt;= T.length at = moveCursorDown c\n  | otherwise          = Cursor (pos+1) line (col+1) bc\n\nmoveCursorLeft :: Cursor -&gt; Cursor\nmoveCursorLeft c@(Cursor pos line col bc@(BufferContext before at after))\n  | col &lt;= 0  = upCursor { column = if null before then 0 else T.length $ head before }\n  | otherwise = Cursor (pos-1) line (col-1) bc\n  where upCursor = moveCursorUp c\n\nmoveCursorDown :: Cursor -&gt; Cursor\nmoveCursorDown c@(Cursor _ _ _ (BufferContext _ _ [])) = c\nmoveCursorDown c@(Cursor _ cLine _ (BufferContext before at (l:ls))) =\n  c { line    = cLine+1,\n      column  = 0,\n      context = BufferContext (at:before) l ls\n    }\n\nmoveCursorUp c@(Cursor _ _ _ (BufferContext [] _ _)) = c\nmoveCursorUp c@(Cursor _ cLine _ (BufferContext (l:ls) at after)) =\n  c { line = cLine-1,\n      column = 0,\n      context = BufferContext ls l (at:after)\n    }\n</code></pre>\n\n<p>This implementation is very usable on 1 million lines and that is good enough for me. There is still one problem with this approach, though. If I want to jump to a random line, I have to move one by one, which can be slow. But still, this is a great improvement over the original approach.</p>\n\n<p>I have also tried implementing the context as</p>\n\n<pre><code>data BufferContext = BufferContext {\n  before   :: T.Text,\n  at       :: Char,\n  after    :: T.Text\n} deriving (Eq, Show)\n</code></pre>\n\n<p>but that doesn't help too much, because \"at\" has to be consed with \"before\" and according to the documentation, <code>T.cons</code> is O(n)... Also, the line centric approach is better when the actual display is done.</p>\n\n<p>Thanks to all who have helped!</p>\n"}, {"tags": ["c#", ".net", "visual-studio", "haskell", "vs-extensibility"], "comments": [{"owner": {"reputation": 3942, "user_id": 3164614, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/U2Ity.png?s=128&g=1", "display_name": "Mihail Stancescu", "link": "https://stackoverflow.com/users/3164614/mihail-stancescu"}, "edited": false, "score": 0, "creation_date": 1451468264, "post_id": 34526716, "comment_id": 56794810, "body": "I would start looking at the <code>Target</code> nodes in my *.hsproj file, this is how Visual Studio knows how to build the projects and also by the use of the Import node that looks something like this: <code>&lt;Import Project=&quot;$(MSBuildExtensionsPath)\\$(MSBuildToolsVersion)\\Mic&zwnj;&#8203;rosoft.Common.props&quot; Condition=&quot;Exists(&#39;$(MSBuildExtensionsPath)\\$(MSBuildToolsVe&zwnj;&#8203;rsion)\\Microsoft.Com&zwnj;&#8203;mon.props&#39;)&quot; &#47;&gt;</code>."}, {"owner": {"reputation": 87176, "user_id": 736079, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/Z1hIP.png?s=128&g=1", "display_name": "jessehouwing", "link": "https://stackoverflow.com/users/736079/jessehouwing"}, "edited": false, "score": 0, "creation_date": 1451468671, "post_id": 34526716, "comment_id": 56795045, "body": "Plus, your Haskell window could subscribe to the <code>BuildEventClass</code> events through <code>EnvDte</code> and load the files into the interpreter window... <a href=\"https://msdn.microsoft.com/en-us/library/envdte._dispbuildevents_event.onbuildbegin.aspx\" rel=\"nofollow noreferrer\">msdn.microsoft.com/en-us/library/&hellip;</a> That way you won&#39;t need anything int he MsBuild files."}], "answers": [{"tags": [], "owner": {"reputation": 1712, "user_id": 3781728, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qta2K.png?s=128&g=1", "display_name": "Ed Dore", "link": "https://stackoverflow.com/users/3781728/ed-dore"}, "is_accepted": false, "score": 1, "last_activity_date": 1454731570, "creation_date": 1454731570, "answer_id": 35237207, "question_id": 34526716, "link": "https://stackoverflow.com/questions/34526716/custom-behavior-of-start-button-for-custom-project-type/35237207#35237207", "title": "Custom behavior of &quot;Start button&quot; for custom project type", "body": "<p>Launching a project via the F5 or Start menu, is done through your project system's I<a href=\"https://msdn.microsoft.com/en-us/library/microsoft.visualstudio.shell.interop.ivsdebuggableprojectcfg.aspx\" rel=\"nofollow\">VsDebuggableProjectCfg</a> implementation. </p>\n\n<p>I haven't dug into the new CPS project system, but if your project type is based off of CPS, the <a href=\"https://github.com/Microsoft/PTVS\" rel=\"nofollow\">Python Tools for VS repository</a>, might provide you with a good start. </p>\n"}], "owner": {"reputation": 21, "user_id": 5729802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dawg50LWmcg/AAAAAAAAAAI/AAAAAAAABB0/FhDFLNCgAEo/photo.jpg?sz=128", "display_name": "Brandy", "link": "https://stackoverflow.com/users/5729802/brandy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1454731570, "creation_date": 1451467988, "last_edit_date": 1451468035, "question_id": 34526716, "link": "https://stackoverflow.com/questions/34526716/custom-behavior-of-start-button-for-custom-project-type", "title": "Custom behavior of &quot;Start button&quot; for custom project type", "body": "<p>I write an visual studio 2015 extension to integrate the programming language Haskell.</p>\n\n<p>I've already implemented the language service, syntax highlighting and a new project type - so you can create a Haskell-project which contains a *.hsproj file and a Main.hs file.</p>\n\n<p>Now I need to override the behavior of the start button because I want to load all Haskell modules into the GHCi-Interpreter (the interpreter is also already integrated in visual studio as a new window).</p>\n\n<p>The problem is that at the moment visual studio runs the msbuild process - but all I wanna do is to send programatically a command to my integrated interpreter ( :l Main.hs ) when the developer clicks on \"start\" or presses F5 - but only for my project type named \"HaskellProject\"!</p>\n\n<p>If possible I want to replace the default build process for my project type - I do not need msbuild, I only want to load the files into ghci.</p>\n\n<p>Has anyone any idea what I can do ?</p>\n\n<p>Thank you and sorry for my english ;-)</p>\n"}, {"tags": ["haskell", "xmonad"], "answers": [{"comments": [{"owner": {"reputation": 503, "user_id": 3003873, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b8fb9507621ecdfd6c2db1a432294dfd?s=128&d=identicon&r=PG&f=1", "display_name": "user3003873", "link": "https://stackoverflow.com/users/3003873/user3003873"}, "edited": false, "score": 0, "creation_date": 1451507110, "post_id": 34529134, "comment_id": 56815161, "body": "If remove $ it compiles."}], "tags": [], "owner": {"reputation": 695, "user_id": 3550459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce58ce9306ba75b9d9ade1ce3e01221a?s=128&d=identicon&r=PG&f=1", "display_name": "deshtop", "link": "https://stackoverflow.com/users/3550459/deshtop"}, "is_accepted": true, "score": 2, "last_activity_date": 1451511399, "last_edit_date": 1451511399, "creation_date": 1451476622, "answer_id": 34529134, "question_id": 34525629, "link": "https://stackoverflow.com/questions/34525629/xmonad-add-fading-to-loghook/34529134#34529134", "title": "Xmonad add fading to logHook", "body": "<p>Not so obvious for a Haskell beginner. You must use</p>\n\n<pre><code>logHook = fadeInactiveLogHook 0.8 \n          &lt;+&gt; dynamicLogWithPP xmobarPP\n                  { ppOutput = hPutStrLn xmproc\n                  , ppTitle = xmobarColor \"green\" \"\" . shorten 50\n                  }\n</code></pre>\n\n<p>(has been corrected according to the comment)</p>\n"}], "owner": {"reputation": 503, "user_id": 3003873, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b8fb9507621ecdfd6c2db1a432294dfd?s=128&d=identicon&r=PG&f=1", "display_name": "user3003873", "link": "https://stackoverflow.com/users/3003873/user3003873"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 323, "favorite_count": 0, "accepted_answer_id": 34529134, "answer_count": 1, "score": 1, "last_activity_date": 1451511399, "creation_date": 1451463841, "last_edit_date": 1451477492, "question_id": 34525629, "link": "https://stackoverflow.com/questions/34525629/xmonad-add-fading-to-loghook", "title": "Xmonad add fading to logHook", "body": "<p>I am beginner in haskell and my question may be obvious. I would like to add fading in xmonad de. The code:</p>\n\n<pre><code>xmonad $ defaultConfig                                                  \n         { manageHook = manageDocks &lt;+&gt; manageHook defaultConfig\n         , layoutHook = smartSpacing 7 $ avoidStruts $ layoutHook defaultConfig\n         , borderWidth = 1\n         , logHook = dynamicLogWithPP $ xmobarPP\n                         { ppOutput = hPutStrLn xmproc\n                         , ppTitle = xmobarColor \"green\" \"\" . shorten 50\n                         }\n         , modMask = mod4Mask\n         ...\n</code></pre>\n\n<p>I need to append <code>fadeInactive</code> to <code>logHook</code>.</p>\n\n<pre><code>fadeInactiveLogHook fadeAmount\n     where fadeAmount = 0.8\n</code></pre>\n\n<p>I tried:</p>\n\n<pre><code>logHook = fadeInactiveLogHook 0.8 $ dynamicLogWithPP $ xmobarPP\n                            { ppOutput = hPutStrLn xmproc\n                            , ppTitle = xmobarColor \"green\" \"\" . shorten \n                            }\n</code></pre>\n\n<p>But its wrong.</p>\n"}, {"tags": ["haskell", "recursion", "matrix", "matrix-multiplication", "typeclass"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451476554, "post_id": 34524832, "comment_id": 56799151, "body": "The type error is sound - <code>kroneckerProduct</code> expects something of type <code>x -&gt; Matrix y -&gt; Matrix y</code> but the type of <code>kroneckerProduct scalarProduct</code> is <code>Matrix a -&gt; Matrix a -&gt; Matrix (Matrix a)</code> - y unifies with both <code>Matrix a</code> and <code>a</code> in this case, giving the infinite type error. I think the type of <code>kroneckerProduct</code> is wrong, it is a binary associative operator, so its type should reflect that. I think the function you want has type <code>Ring a =&gt; Matrix a -&gt; Matrix a -&gt; Matrix (Matrix a)</code> - since matrices form a <code>Ring</code> this gives you the &quot;infinite tower&quot; of products you want."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1452667948, "post_id": 34524832, "comment_id": 57265432, "body": "Is there an existing typeclass called Ring that I can use?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1452672033, "post_id": 34524832, "comment_id": 57267474, "body": "I&#39;m sure there are many as any search engine can reveal - but perhaps you are looking for a <a href=\"https://hackage.haskell.org/package/algebra-4.2/docs/Numeric-Ring-Class.html\" rel=\"nofollow noreferrer\">recommendation.</a>"}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1452675505, "post_id": 34524832, "comment_id": 57269576, "body": "The kroneckerProduct can use any kind of multiplication though. And the kind of multiplication sometimes has to be specified, not just through typeclass polymorphism. So I&#39;m not understanding how <code>kroneckerProduct :: Ring a =&gt; Matrix a -&gt; Matrix a -&gt; Matrix (Matrix a)</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1452801376, "post_id": 34524832, "comment_id": 57340206, "body": "When you say &quot;kroneckerProduct can use any kind of multiplication&quot; I assume you mean that it doesn&#39;t need the entire ring structure (perhaps just a group?) - then the type can be <code>kroneckerProduct :: Group a =&gt; Matrix a -&gt; Matrix a -&gt; Matrix (Matrix a)</code> and of course matrices are still a group. If you don&#39;t want the uniqueness property that typeclasses enforce, you can reify classes as records and have <code>kroneckerProduct :: Group a -&gt; Matrix a -&gt; Matrix a -&gt; Matrix (Matrix a)</code> - these concerns are entirely orthogonal, I think."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1452821484, "post_id": 34524832, "comment_id": 57348976, "body": "No I mean that a kroneckerProduct can be partially applied with any other matrix multiplication function as the first argument. It&#39;s possible for there to be <code>kroneckerProduct scalarProduct</code> or <code>kroneckerProduct (kroneckerProduct scalarProduct)</code> ... etc."}], "owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 256, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1451460120, "creation_date": 1451460120, "question_id": 34524832, "link": "https://stackoverflow.com/questions/34524832/haskell-recursive-matrix-kronecker-product-and-recursive-flattened-rendering-of", "title": "Haskell: Recursive Matrix Kronecker Product and Recursive Flattened Rendering of Multidimensional Block Matrices", "body": "<p>I was implementing a kronecker product function in Haskell for learning, and everything works well, \nexcept that I haven't figured out the correct implementation for a higher-order kroneckerProduct that \ncan take a sub-kroneckerProduct as a parameter, which also led me to think about how to render the \nblock matrix produced by the kroneckerProduct.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nimport Data.List (intercalate, transpose)\nimport Data.List.Split (chunksOf)\nimport Control.Applicative (Applicative, pure, (&lt;$&gt;), (&lt;*&gt;))\n\nnewtype Matrix a = Matrix { getMatrix :: [[a]] }\n\ninstance Functor Matrix where\n    fmap f = Matrix . (fmap (fmap f)) . getMatrix \n\ninstance Applicative Matrix where\n    pure x = Matrix [[x]]\n    (Matrix as) &lt;*&gt; (Matrix bs) = Matrix $ zipWith (zipWith id) as bs\n\ninstance (Show a) =&gt; Show (Matrix a) where \n    show = (intercalate \"\\n\") . fmap (unwords . fmap show) . getMatrix\n\nscalarProduct :: (Num a) =&gt; a -&gt; Matrix a -&gt; Matrix a\nscalarProduct scalar matrix = (* scalar) &lt;$&gt; matrix\n\nhadamardProduct :: (Num a) =&gt; Matrix a -&gt; Matrix a -&gt; Matrix a\nhadamardProduct matrix1 matrix2 = (*) &lt;$&gt; matrix1 &lt;*&gt; matrix2\n\n-- The kronecker product M1 \u2297 M2, results in a block matrix.\n-- It is a matrix that has elements that are also matrices, \n-- this makes it somewhat multidimensional tensor. \n-- The resulting block matrix has the same dimensions as M1. \n-- Every resulting element M1M2ij is equal to M1ij \u00d7 M2. \n-- Assuming M1 contains scalars, this would mean every element \n-- in the resulting matrix requires a further scalar multiplication. \n-- But it could also be some other multiplication method.\n-- This requires a RankNTypes\nkroneckerProduct :: (a -&gt; Matrix b -&gt; Matrix b) -&gt; Matrix a -&gt; Matrix b -&gt; Matrix (Matrix b)\nkroneckerProduct f m1 m2 = (`f` m2) &lt;$&gt; m1\n\n-- Flattening a block matrix produced by kroneckerProduct into a normal Matrix.\n-- This works by assuming a quad layer matrix: [[[[...]]]].\n-- We tranpose the middle 2,then concat the outside 2, and concat the inner 2.\n-- This ends up bringing out the inner block matrices into the outside.\n-- The resulting size of the new matrix is rowA*colA * rowB*colB, \n-- where A is the outer Matrix, and B is the inner Matrix.\nflattenBlock :: Matrix (Matrix a) -&gt; Matrix a\nflattenBlock blockMatrix = Matrix $ dilate $ getMatrix2 blockMatrix\n    where \n        dilate = (fmap concat) . concat . (fmap transpose)\n        getMatrix2 = getMatrix . fmap getMatrix\n\nincrementingMatrix :: Int -&gt; Int -&gt; Matrix Int\nincrementingMatrix rowSize colSize = Matrix $ chunksOf colSize [1..(rowSize * colSize)]\n</code></pre>\n\n<p>So this works:</p>\n\n<pre><code>&gt; let blockMatrix1 = kroneckerProduct scalarProduct (incrementingMatrix 2 2) (incrementingMatrix 2 2)\n&gt; putStrLn $ show $ flattenBlock blockMatrix1\n&gt; let blockMatrix2 = kroneckerProduct hadamardProduct blockMatrix1 (incrementingMatrix 2 2)\n&gt; putStrLn $ show $ flattenBlock blockMatrix2\n</code></pre>\n\n<p>However we cannot compile this (but mathematically it should be possible):</p>\n\n<pre><code>&gt; let recursiveKro = kroneckerProduct (kroneckerProduct scalarProduct)\n</code></pre>\n\n<p>I end up with an \"Occurs Check\":</p>\n\n<pre><code>Occurs check: cannot construct the infinite type: b ~ Matrix b\nExpected type: Matrix b -&gt; Matrix b -&gt; Matrix b\n  Actual type: Matrix b -&gt; Matrix b -&gt; Matrix (Matrix b)\nRelevant bindings include\n  recursiveKro :: Matrix (Matrix b) -&gt; Matrix b -&gt; Matrix (Matrix b)\n    (bound at &lt;interactive&gt;:240:5)\nIn the first argument of \u2018kroneckerProduct\u2019, namely\n  \u2018(kroneckerProduct scalarProduct)\u2019\nIn the expression:\n  kroneckerProduct (kroneckerProduct scalarProduct)\n</code></pre>\n\n<p>So what would I need to change, to make the above expression possible?</p>\n\n<p>Furthermore, if it becomes possible to create multilayered block matrices, we would need to extend the <code>flattenBlock</code> function to be recursive as well.</p>\n\n<p>I imagine it should look like:</p>\n\n<pre><code>flattenBlockRecursive m = fmap flattenBlockRecursive $ Matrix $ (concat . (fmap transpose) . (fmap concat)) (getMatrix $ fmap getMatrix $ m)\n</code></pre>\n\n<p>And would need to use some sort of typeclass recursion, but I attempted it with multi-parameter typeclasses but couldn't make sense of it.</p>\n\n<p>So to reiterate:</p>\n\n<ol>\n<li>How do I change the kroneckerProduct function to allow greater flexibility in accepting a sub-kroneckerProduct function?</li>\n<li>How would I then flatten the multi-layered block matrix and render it?</li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1451447924, "post_id": 34522082, "comment_id": 56786901, "body": "Wouldn&#39;t it be much nicer to just write <code>k^(n - size (phi !! i))</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 3024, "user_id": 3154996, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2031da3bb3fc999ec22e677995debd7b?s=128&d=identicon&r=PG&f=1", "display_name": "Elliot Gorokhovsky", "link": "https://stackoverflow.com/users/3154996/elliot-gorokhovsky"}, "edited": false, "score": 0, "creation_date": 1451442899, "post_id": 34522165, "comment_id": 56785878, "body": "So application binds higher than <code>.</code>, which binds higher than <code>$</code>?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 3024, "user_id": 3154996, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2031da3bb3fc999ec22e677995debd7b?s=128&d=identicon&r=PG&f=1", "display_name": "Elliot Gorokhovsky", "link": "https://stackoverflow.com/users/3154996/elliot-gorokhovsky"}, "edited": false, "score": 3, "creation_date": 1451444461, "post_id": 34522165, "comment_id": 56786215, "body": "Application binds more tightly than anything else, and <code>$</code> binds less tightly than anything else. So <code>.</code> falls in between them, as does any other operator at all."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 3024, "user_id": 3154996, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2031da3bb3fc999ec22e677995debd7b?s=128&d=identicon&r=PG&f=1", "display_name": "Elliot Gorokhovsky", "link": "https://stackoverflow.com/users/3154996/elliot-gorokhovsky"}, "edited": false, "score": 2, "creation_date": 1451449652, "post_id": 34522165, "comment_id": 56787319, "body": "@Ren&#233;G, to be picky, you <i>could</i> write your own operator that binds exactly as tightly as <code>$</code> if you wanted to, but you would certainly sow confusion if you did. There is no way short of macro processing to make anything bind more tightly than function application--that&#39;s fixed deep in the syntax."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1451456715, "post_id": 34522165, "comment_id": 56789712, "body": "To be especially picky, they all bind less tightly than <code>.</code> used as a module separator and <code>{}</code> used in record updates, both of which are syntax and not operators... but you did say &quot;anything else&quot; and I&#39;ve personally been confused about the precedence of record update syntax before."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 2, "last_activity_date": 1451442743, "creation_date": 1451442743, "answer_id": 34522165, "question_id": 34522082, "link": "https://stackoverflow.com/questions/34522082/haskell-chain-of-functions/34522165#34522165", "title": "Haskell chain of functions", "body": "<p>Rather than <code>f . g . h x</code>, you want <code>f . g . h $ x</code>: the former calls <code>h x</code> immediately and then composes that, <em>as a function</em>, with <code>f</code> and <code>g</code> The latter composes together <code>f</code>, <code>g</code>, and <code>h</code> into a new function and then calls that on <code>i</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1451443031, "creation_date": 1451443031, "answer_id": 34522194, "question_id": 34522082, "link": "https://stackoverflow.com/questions/34522082/haskell-chain-of-functions/34522194#34522194", "title": "Haskell chain of functions", "body": "<p>Note that you can use parenthesis to group function compositions, \n<code>((k^).(n-).size.(phi !!)) i</code> should work.</p>\n"}], "owner": {"reputation": 3024, "user_id": 3154996, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2031da3bb3fc999ec22e677995debd7b?s=128&d=identicon&r=PG&f=1", "display_name": "Elliot Gorokhovsky", "link": "https://stackoverflow.com/users/3154996/elliot-gorokhovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 391, "favorite_count": 0, "accepted_answer_id": 34522165, "answer_count": 2, "score": 0, "last_activity_date": 1451443031, "creation_date": 1451442085, "last_edit_date": 1451442460, "question_id": 34522082, "link": "https://stackoverflow.com/questions/34522082/haskell-chain-of-functions", "title": "Haskell chain of functions", "body": "<p>I have a composition of functions, many of them operators, to raise a constant to the power of a constant minus the size of the ith set in a list. Here's my code:</p>\n\n<pre><code>(k^).(n-).size.(phi !!) i\n</code></pre>\n\n<p>When I tried it on a test case I got </p>\n\n<pre><code>&lt;interactive&gt;:64:16-25:\n    Couldn't match expected type \u2018a -&gt; Set a0\u2019\n                with actual type \u2018Set a1\u2019\n    Relevant bindings include\n      it :: a -&gt; c (bound at &lt;interactive&gt;:64:1)\n    Possible cause: \u2018phi !!\u2019 is applied to too many arguments\n    In the second argument of \u2018(.)\u2019, namely \u2018(phi !!) 3\u2019\n    In the second argument of \u2018(.)\u2019, namely \u2018size . (phi !!) 3\u2019\n</code></pre>\n\n<p>However, </p>\n\n<pre><code>(k^)$(n-)$size$(phi !!)$i\n</code></pre>\n\n<p>works. What's wrong? Why does composition not work but application work? Also, is composing the operators in parentheses the most idiomatic way to do it? It feels weird.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451434638, "post_id": 34521160, "comment_id": 56783847, "body": "<code>\\xs -&gt; any (checkSum xs) [0 .. length xs - 1]</code>"}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 1, "creation_date": 1451448761, "post_id": 34521160, "comment_id": 56787107, "body": "Neither the textual specification of <code>sum(x_0, x_1...x_k) == sum(x_k+1,...,x_n)</code> or the diagram specification are clear to me. Based on reading the examples, I think the missing piece for the text specification is simply a quantifier, i.e. for some integer list <code>x</code> determine <code>\u2203k::Int. sum[x\u2080,\u2026,x\u2096] == sum[x\u2096,\u2026,x\u2099]</code>."}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 0, "creation_date": 1451495330, "post_id": 34521160, "comment_id": 56809336, "body": "FWIW, it was clear to me without a quantifier. Although I would recommend: <i>Check if a list can be split at some index into two halves with equal sums.</i>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1451454312, "post_id": 34521187, "comment_id": 56788789, "body": "From an efficiency standpoint, this sucks. karakfa&#39;s approach is fussier, but asymptotically more efficient."}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 0, "creation_date": 1451499272, "post_id": 34521187, "comment_id": 56811398, "body": "Though due to the simplicity of this solution it is more obviously correct, and correctness is more important. For an efficient implementation we do want to exploit, from a monoid homomorphism with length, that <code>length xs + length ys == length (xs ++ ys)</code>. <a href=\"http://stackoverflow.com/a/34534073/260584\">Mauris</a> has a good solution for this which uses <code>scanl</code>."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 3, "last_activity_date": 1451434665, "creation_date": 1451434665, "answer_id": 34521187, "question_id": 34521160, "link": "https://stackoverflow.com/questions/34521160/check-an-array-whether-sumx-0-x-1-x-k-sumx-k1-x-n-are-equal-in-hask/34521187#34521187", "title": "Check an array whether sum(x_0, x_1...x_k) == sum(x_k+1,..x_n) are equal in Haskell", "body": "<p>This function comes up a surprising amount:</p>\n\n<pre><code>import Data.List (inits, tails)\n\nsplits :: [a] -&gt; [([a],[a])]\nsplits xs = zip (inits xs) (tails xs)\n</code></pre>\n\n<p>Example usage:</p>\n\n<pre><code>ghci&gt; splits [1,2,3]\n[([],[1,2,3]),([1],[2,3]),([1,2],[3]),([1,2,3],[])]\n</code></pre>\n\n<p>You might also be interested in the <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:any\" rel=\"nofollow\"><code>any</code></a> function.</p>\n\n<p>I think you can take it from here.</p>\n"}, {"tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 3, "last_activity_date": 1451439968, "last_edit_date": 1451439968, "creation_date": 1451436275, "answer_id": 34521380, "question_id": 34521160, "link": "https://stackoverflow.com/questions/34521160/check-an-array-whether-sumx-0-x-1-x-k-sumx-k1-x-n-are-equal-in-hask/34521380#34521380", "title": "Check an array whether sum(x_0, x_1...x_k) == sum(x_k+1,..x_n) are equal in Haskell", "body": "<p>A more primitive approach</p>\n\n<pre><code>checkSum :: [Int] -&gt; Bool\ncheckSum a = go a 0 (sum a)\n       where go [] left right = left==right\n             go (x:xs) left right = left==right || go xs (left+x) (right-x)\n</code></pre>\n\n<p>at each step you're adding the element to the left value and subtracting from the right, where the initial values are 0 and sum. Terminates when equality reached at any step or when the array is exhausted.</p>\n"}, {"tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 0, "last_activity_date": 1451450466, "last_edit_date": 1495535397, "creation_date": 1451450466, "answer_id": 34522991, "question_id": 34521160, "link": "https://stackoverflow.com/questions/34521160/check-an-array-whether-sumx-0-x-1-x-k-sumx-k1-x-n-are-equal-in-hask/34522991#34522991", "title": "Check an array whether sum(x_0, x_1...x_k) == sum(x_k+1,..x_n) are equal in Haskell", "body": "<p>My interpretation of the question is: for some Int list <em>x</em>, determine <code>\u2203k::Integer. sum[x\u2080,\u2026,x\u2096] == sum[x\u2096,\u2026,x\u2099]</code>. Reasonably, <code>0 \u2264 k &lt; length x</code> (and <code>n = length x</code>) because otherwise <em>x\u2096</em> is \u22a5 and we are not interested in that case.</p>\n\n<p>So how would you prove that proposition? Are we interested in infinite lists? Probably not, so let us assume the list is finite. Then, if the list is finite there are also finite choices for <em>k</em> because <code>0 \u2264 k &lt; length x</code>. A proof then can be done by checking for every choice of <em>k</em>. If at least one choice of <em>k</em> satisfies the proposition then it is true, and otherwise it is false.</p>\n\n<p>When translating our method to Haskell we want to leverage existing definitions to their fullest. We can just focus on the splits of the list itself, leaving <em>k</em> out of the implementation. <a href=\"https://stackoverflow.com/a/34521187/260584\">luqui's answer</a> beautifully demonstrates this. Be aware that an abstract notation (mathematical, logical, a specification, etc) does not always indicate a good implementation.</p>\n\n<p>Once we know all the splits of the list, we can sum and compare for equality. If at least one comparison succeeds then yield True, otherwise yield False.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451492670, "post_id": 34527985, "comment_id": 56807843, "body": "Beautiful! Karakfa&#39;s efficient solution uses the fact that <code>(Int,+)</code> is a group; you manage it with just the monoid."}], "tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": false, "score": 2, "last_activity_date": 1451472513, "creation_date": 1451472513, "answer_id": 34527985, "question_id": 34521160, "link": "https://stackoverflow.com/questions/34521160/check-an-array-whether-sumx-0-x-1-x-k-sumx-k1-x-n-are-equal-in-hask/34527985#34527985", "title": "Check an array whether sum(x_0, x_1...x_k) == sum(x_k+1,..x_n) are equal in Haskell", "body": "<p>A solution using built-in functions.</p>\n\n<p>Use <code>scanl</code> and <code>scanr</code> to find all the sums from the left and right.</p>\n\n<p><code>scanl (+) 0 [1,2,3]</code> gives you [0, 0+1, 0+1+2, 0+1+2+3]</p>\n\n<pre><code>\u03bb&gt; scanl (+) 0 [1,2,3]\n[0,1,3,6]\n</code></pre>\n\n<p><code>scanr (+) 0 [1,2,3]</code> gives you [1+2+3+0, 2+3+0, 3+0, 0]</p>\n\n<pre><code>\u03bb&gt; scanr (+) 0 [1,2,3]\n[6,5,3,0]\n</code></pre>\n\n<p>Then <code>zipWith</code> to identify positions where the lists have equal elements.</p>\n\n<pre><code>\u03bb&gt; zipWith (==) [0,1,3,6] [6,5,3,0]\n[False,False,True,False]\n</code></pre>\n\n<p>Then <code>or</code> to check if this list contains True anywhere.</p>\n\n<pre><code>\u03bb&gt; or [False,False,True,False]\nTrue\n</code></pre>\n\n<p>The complete function:</p>\n\n<pre><code>checkSum :: [Int] -&gt; Bool\ncheckSum xs = or (zipWith (==) leftSums rightSums)\n  where\n    leftSums = scanl (+) 0 xs\n    rightSums = scanr (+) 0 xs\n</code></pre>\n\n<p>(This will return True on the empty list.  This seems reasonable to\nme, but if you want it to be False you could write a special case for\nit or just change <code>scanr</code> to <code>scanr1</code>.)</p>\n"}, {"comments": [{"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 1, "creation_date": 1451498735, "post_id": 34534073, "comment_id": 56811165, "body": "A clever idea indeed, though be wary about the upper bound of Int. By doubling the prefix sum we halve the range the algorithm works for. Another idea: if the double prefix sum list is ordered then we can exit early \u2013 ordering can be guaranteed if the integers are non-negative."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 2, "creation_date": 1451501119, "post_id": 34534073, "comment_id": 56812217, "body": "@erisco, these manipulations are valid mod n, so this transformation does not affect the range for which the algorithm works.  (Though it is a bit subtle...)"}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 1, "creation_date": 1451501754, "post_id": 34534073, "comment_id": 56812566, "body": "My assumption was that overflow is undefined, but the Haskell 2010 specification says arithmetic is modulo the number of bits to represent the integer (<a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch18.html#x26-22300018\" rel=\"nofollow noreferrer\">source</a>), so you are correct. Thanks for this clarification."}], "tags": [], "owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "is_accepted": false, "score": 3, "last_activity_date": 1451495932, "creation_date": 1451495932, "answer_id": 34534073, "question_id": 34521160, "link": "https://stackoverflow.com/questions/34521160/check-an-array-whether-sumx-0-x-1-x-k-sumx-k1-x-n-are-equal-in-hask/34534073#34534073", "title": "Check an array whether sum(x_0, x_1...x_k) == sum(x_k+1,..x_n) are equal in Haskell", "body": "<p>A clever way to think about this: if we need</p>\n\n<pre><code>                  x[1] + ... + x[k]  ==  x[k+1] + ... + x[n],\n</code></pre>\n\n<p>then we can add the left-hand side to both sides to get</p>\n\n<pre><code>            (x[1] + ... + x[k]) * 2  ==  sum(x).\n</code></pre>\n\n<p>Thus, we can generate all doubled prefix sums, then look for <code>sum(x)</code> in them.</p>\n\n<pre><code>checkSum :: [Int] -&gt; Bool\ncheckSum xs = sum xs `elem` doublePrefixSums\n    where doublePrefixSums = scanl (\\acc x -&gt; acc + 2*x) 0 xs\n</code></pre>\n"}], "owner": {"reputation": 429, "user_id": 796557, "user_type": "registered", "accept_rate": 5, "profile_image": "https://www.gravatar.com/avatar/2807764ba0f590416c540c55a960e9a9?s=128&d=identicon&r=PG&f=1", "display_name": "elliptic00", "link": "https://stackoverflow.com/users/796557/elliptic00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "answer_count": 5, "score": 3, "last_activity_date": 1451495932, "creation_date": 1451434406, "question_id": 34521160, "link": "https://stackoverflow.com/questions/34521160/check-an-array-whether-sumx-0-x-1-x-k-sumx-k1-x-n-are-equal-in-hask", "title": "Check an array whether sum(x_0, x_1...x_k) == sum(x_k+1,..x_n) are equal in Haskell", "body": "<p>I need to implement to an algorithm to solve following problem in Haskell:</p>\n\n<p>Given an array, check whether sum(x_0, x_1...x_k) == sum(x_k+1,...,x_n)</p>\n\n<p>If the array is have NO element, then the sum is zero\n<a href=\"https://i.stack.imgur.com/P99lU.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/P99lU.png\" alt=\"enter image description here\"></a></p>\n\n<p>1:</p>\n\n<pre><code>arr = [1]\nsum([]) = 0\nsum([1]) = 1\nsum([]) != sum([1])\nthere is no such k \nreturn False\n</code></pre>\n\n<p>2:</p>\n\n<pre><code>arr = [1,2,3]\nsum([1,2]) == sum([3])\nthere is such k\nreturn True\n</code></pre>\n\n<p>Here is my current implementation so far:</p>\n\n<pre><code>checkSum::[Int]-&gt;Int-&gt;Bool\ncheckSum []  _ = True\ncheckSum [x] _ = x    == 0\ncheckSum l inx | sum(take inx l) == sum(drop inx l) = True\n               | inx &lt;= length l = checkSum l (inx+1)\n               | otherwise       = False\n</code></pre>\n\n<p>It works, but I need to change function prototype as following:</p>\n\n<pre><code>checkSum::[Int]-&gt;Bool\n.....\n</code></pre>\n\n<p>Does anyone know how to implement the new function without passing index to the function?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 4, "last_activity_date": 1451434324, "last_edit_date": 1451434324, "creation_date": 1451433958, "answer_id": 34521090, "question_id": 34521010, "link": "https://stackoverflow.com/questions/34521010/no-instance-for-numint-arising-from-the-literal-3/34521090#34521090", "title": "No instance for (Num[Int]) arising from the literal `3&#39;", "body": "<p>Note: Screenshots of code or errors are bad.  Copy and paste the text instead.</p>\n\n<p>Short answer:  <code>exampleList</code> is already a list.  By putting it in <code>[]</code>, you make it a list of lists.  Don't do that.</p>\n\n<p>Long answer: GHC tries as hard as it can to make sense of what you wrote.  It needs <code>exampleList</code> and <code>3</code> to have the same type for the type of <code>mod</code> to work.  Since numeric constants are polymorphic in Haskell, it says:</p>\n\n<blockquote>\n  <p>Ah, this code works when there is a way to make a list out of a numeric\n  literal. I just need to find the instance of <code>Num</code> in use.  Wait,\n  there isn't one.  Error time!</p>\n</blockquote>\n"}], "owner": {"reputation": 193, "user_id": 3742016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bab35711fb7617331f54a43ace47828?s=128&d=identicon&r=PG&f=1", "display_name": "I want to make games", "link": "https://stackoverflow.com/users/3742016/i-want-to-make-games"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 723, "favorite_count": 0, "accepted_answer_id": 34521090, "answer_count": 1, "score": 1, "last_activity_date": 1451449656, "creation_date": 1451433414, "last_edit_date": 1451449656, "question_id": 34521010, "link": "https://stackoverflow.com/questions/34521010/no-instance-for-numint-arising-from-the-literal-3", "title": "No instance for (Num[Int]) arising from the literal `3&#39;", "body": "<p>I started learning Haskell today. I know some basics of C++, C#, but I'm a beginner programmer.</p>\n\n<p>I wrote the following in a file \"file.hs\":</p>\n\n<pre><code>exampleList = [1, 2, 3, 4]\nexRange2 = [2*x | x &lt;- [exampleList], (x `mod` 3) /= 1]\n</code></pre>\n\n<p>When I input</p>\n\n<pre><code>:l file\n</code></pre>\n\n<p>into my GHCi console, it gives me the error:</p>\n\n<pre><code>functions1.hs:20:47:\n    No instance for (Num [Int]) arising from the literal `3'\n    In the second argument of `mod', namely `3'\n    In the first argument of `(/=)', namely `(x `mod` 3)'\n    In the expression: (x `mod` 3) /= 1\nFailed, modules loaded: none\n</code></pre>\n\n<p>Note it looks like it interchangably uses gravises and apostrophes. I don't understand what's wrong. </p>\n\n<p>My quick excursion into Google convinced me it was an issue with types of both arguments of mod, but shouldn't the compiler know that all <code>x</code>s are going to be integers if it has the exampleList defined?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1451414500, "post_id": 34516579, "comment_id": 56775149, "body": "This is due to lazy IO - I would expect that if you run this program, input a bunch of text, then kill it with Ctrl+C, you would see nothing because it reads the contents lazily (and putStrLn consumes them lazily) and killing the program with Ctrl+C makes <i>no guarantees</i> about what happens with buffered data. The fact that the interpreter actually <i>does</i> write this data is irrelevant - it is undefined behavior. However, I cannot reproduce the same behaviour with Ctrl+Z: ending the program with Ctrl+Z correctly prints the entire input in either case in my tests."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1451417904, "post_id": 34516579, "comment_id": 56776859, "body": "@user2407038, this is <i>not</i> related to lazy <code>IO</code> at all. <code>putStrLn</code> will pull steadily from its argument to allow it to produce output and stop when it hits <code>&quot;&quot;</code>. <code>getContents</code> will yield characters (lazily) until it reaches the end of its input (achieved with <code>^Z</code>) and then produce that final <code>&quot;&quot;</code>. As Thomas M. DuBuisson&#39;s answer indicates, the problem here is that the OP is using the wrong buffering mode for their purpose--something that could easily be encountered in a strict language as well."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1451434439, "post_id": 34516579, "comment_id": 56783785, "body": "I&#39;m voting to close this question as off-topic because it was discovered that this is a problem with a specific computer, and not related to the title or tags"}, {"owner": {"reputation": 657, "user_id": 1440894, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5cd84e40bb321eb1d75a9b7aa94fec42?s=128&d=identicon&r=PG", "display_name": "MadMonty", "link": "https://stackoverflow.com/users/1440894/madmonty"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1451437057, "post_id": 34516579, "comment_id": 56784456, "body": "@luqui I can just delete the question - is that appropriate?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451443025, "post_id": 34516579, "comment_id": 56785906, "body": "You cannot delete a question with answers unilaterally unless you&#39;re a moderator. You&#39;re not a moderator. Also, the question may prove to be useful to someone else encountering a similar issue with the Windows terminal."}], "answers": [{"comments": [{"owner": {"reputation": 657, "user_id": 1440894, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5cd84e40bb321eb1d75a9b7aa94fec42?s=128&d=identicon&r=PG", "display_name": "MadMonty", "link": "https://stackoverflow.com/users/1440894/madmonty"}, "edited": false, "score": 2, "creation_date": 1451426820, "post_id": 34517237, "comment_id": 56781032, "body": "Thank you for the explanation, but I think the issue I&#39;m having is separate and unrelated (running the above example freezes as before). I have edited my question, as I have been unable to replicate the original problem on any other machine, and I feel my original problem must be something specific to my Windows installation. Thank you for your explanation anyway!"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 4, "last_activity_date": 1451415342, "creation_date": 1451415342, "answer_id": 34517237, "question_id": 34516579, "link": "https://stackoverflow.com/questions/34516579/trouble-with-getcontents/34517237#34517237", "title": "Trouble with &quot;getContents&quot;", "body": "<p>This question is sort of an FAQ - or the root cause is.</p>\n\n<p>stdin and stdout are line buffered so you won't see anything until that buffer is filled or a newline.  You can turn off buffering for behavior that might be more inline with your expectations using <code>hSetBuffering</code>:</p>\n\n<pre><code>import System.IO\nmain =\n do hSetBuffering stdin NoBuffering\n    hSetBuffering stdout NoBuffering\n    getContents &gt;&gt;= putStrLn\n</code></pre>\n\n<p>With an end behavior of:</p>\n\n<pre><code>hheellllooww  wwoorrlldd\n</code></pre>\n\n<p>(yes, I typed 'hello world')</p>\n"}], "owner": {"reputation": 657, "user_id": 1440894, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5cd84e40bb321eb1d75a9b7aa94fec42?s=128&d=identicon&r=PG", "display_name": "MadMonty", "link": "https://stackoverflow.com/users/1440894/madmonty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 579, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1451426670, "creation_date": 1451412696, "last_edit_date": 1451426670, "question_id": 34516579, "link": "https://stackoverflow.com/questions/34516579/trouble-with-getcontents", "title": "Trouble with &quot;getContents&quot;", "body": "<p>I'm struggling to understand if this is a problem or design feature with Prelude's getContents function. Suppose we have the following code, saved in a file named \"getContentsTest.hs\":</p>\n\n<pre><code>main = do\n    contents &lt;- getContents\n    putStrLn contents\n</code></pre>\n\n<p>If I now (on my Windows 10 system), compile this with </p>\n\n<pre><code>ghc getContentsTest.hs\n</code></pre>\n\n<p>and run the resulting executable, the command prompt refuses to acknowledge input. The text cursor still flashes, as if it WANTS to accept input, but typing on my (physical) keyboard produces nothing onscreen. Additionally, issuing CTRL-Z and CTRL-C commands do not stop the program, and I have to close the command prompt in order to stop the program.</p>\n\n<p>However, if I just run</p>\n\n<pre><code>runhaskell getContentsTest.hs\n</code></pre>\n\n<p>it works as expected (i.e. it prints your input to the terminal, and the program stops if it encounters an end-of-file signal, such as CTRL-D, or if someone interrupts the program with CTRL-C)</p>\n\n<p>Why does compiling this short program cause the getContents function to behave differently?</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>I haven't been able to replicate the above behaviour on any other machine, so I feel this must be something specific to the computer I first tried this on. Thus, this is now less of a Haskell specific question, and more of a \"Why isn't the Windows command prompt behaving as it should\" sort of question. </p>\n\n<p>The key (mis)behaviour of the machine I'm using is that when I run the above program, the command prompt essentially freezes, not accepting input. Thus, thank you for the insights into getContents, but I feel this problem is something specific to my PC that I need to resolve myself. </p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1451412459, "post_id": 34516312, "comment_id": 56774102, "body": "Take a look <a href=\"http://stackoverflow.com/questions/14755525/how-to-write-a-derivable-class\">here</a>"}, {"owner": {"reputation": 1648, "user_id": 2535207, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0db392082edc1a1fc6f6c927210c233?s=128&d=identicon&r=PG", "display_name": "Jeremy Cochoy", "link": "https://stackoverflow.com/users/2535207/jeremy-cochoy"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1451413664, "post_id": 34516312, "comment_id": 56774693, "body": "Yes, I had. It says that there is no general solution for deriving from any type, and that in the case of a newType you can use the GeneralizedNewtypeDeriving extension. But it doesn&#39;t says that there isn&#39;t an extension in GHC allowing automatic derivation for types of the form A|B|C."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451416389, "post_id": 34516312, "comment_id": 56776133, "body": "What is wrong with the newtype wrapper approach?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1451419200, "post_id": 34516312, "comment_id": 56777506, "body": "could <code>fromEnum :: Enum a =&gt; a -&gt; Int</code> serve as a solution for your Problem"}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1451428291, "post_id": 34518494, "comment_id": 56781675, "body": "To add to this, you can derive <code>Enum</code>."}, {"owner": {"reputation": 1648, "user_id": 2535207, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0db392082edc1a1fc6f6c927210c233?s=128&d=identicon&r=PG", "display_name": "Jeremy Cochoy", "link": "https://stackoverflow.com/users/2535207/jeremy-cochoy"}, "edited": false, "score": 0, "creation_date": 1451496669, "post_id": 34518494, "comment_id": 56810054, "body": "Thanks you, fromEnum :: a -&gt; Int and toEnum :: Int -&gt; a are exactly what I need :-)"}], "tags": [], "owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "is_accepted": true, "score": 6, "last_activity_date": 1451420602, "creation_date": 1451420602, "answer_id": 34518494, "question_id": 34516312, "link": "https://stackoverflow.com/questions/34516312/haskell-deriving-automatically-integral-from-an-enumation-of-type-constructors/34518494#34518494", "title": "Haskell - Deriving automatically Integral from an enumation of type constructors", "body": "<p>If all you want is a function such that <code>f A == 0</code>, <code>f B == 1</code>, etc., you can use <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:fromEnum\" rel=\"noreferrer\"><code>fromEnum :: Enum a =&gt; a -&gt; Int</code></a>.</p>\n\n<p>The <code>Integral</code> type class is for types you can actually add, subtract, divide... In your case, there isn't a very sensible implementation of these things. If you wanted to implement them as arithmetic modulo <code>1 + fromEnum maxBound</code>... well, I don't recommend doing that, if your <code>Enum</code> represents anything <em>but</em> those numbers, and if they do, the <a href=\"https://hackage.haskell.org/package/modular-arithmetic\" rel=\"noreferrer\"><code>modular-arithmetic</code></a> package already implements what you need.</p>\n"}], "owner": {"reputation": 1648, "user_id": 2535207, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0db392082edc1a1fc6f6c927210c233?s=128&d=identicon&r=PG", "display_name": "Jeremy Cochoy", "link": "https://stackoverflow.com/users/2535207/jeremy-cochoy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 1, "accepted_answer_id": 34518494, "answer_count": 1, "score": 1, "last_activity_date": 1451420602, "creation_date": 1451411568, "question_id": 34516312, "link": "https://stackoverflow.com/questions/34516312/haskell-deriving-automatically-integral-from-an-enumation-of-type-constructors", "title": "Haskell - Deriving automatically Integral from an enumation of type constructors", "body": "<p>I would like to know if there is a way to make GHC automatically derive the instance of integral from a data type of the form :</p>\n\n<pre><code>data = A | B | C | D\n</code></pre>\n\n<p>so that fromIntegral A = 0, fromIntegral B = 1, etc. ?</p>\n\n<p>Using</p>\n\n<pre><code>data MyType = A | B | C | D deriving (Show, Eq, Ord, Enum, Real, Integral)\n</code></pre>\n\n<p>produce the error</p>\n\n<blockquote>\n  <p>Can't make a derived instance of \u2018Integral MyType\u2019: \n   \u2018Integral\u2019 is not a derivable class</p>\n  \n  <p>In the data declaration for \u2018MyType\u2019</p>\n</blockquote>\n\n<p>(even with the extension GeneralizedNewtypeDeriving)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4664, "user_id": 213963, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/0ad16ba1a128e1bd76d48671d383c963?s=128&d=identicon&r=PG", "display_name": "Terry", "link": "https://stackoverflow.com/users/213963/terry"}, "edited": false, "score": 0, "creation_date": 1451411532, "post_id": 34516033, "comment_id": 56773684, "body": "Dear Wei Yan. Please refer to this information (<a href=\"http://stackoverflow.com/help/quality-standards-error\">stackoverflow.com/help/quality-standards-error</a>) and reform your question accordingly."}], "answers": [{"tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 1, "last_activity_date": 1451413589, "creation_date": 1451413589, "answer_id": 34516813, "question_id": 34516033, "link": "https://stackoverflow.com/questions/34516033/using-polymorphic-function-to-split-haskell/34516813#34516813", "title": "Using Polymorphic Function to Split (Haskell)", "body": "<p>The function you are looking for is <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:unzip\" rel=\"nofollow\"><code>unzip</code></a> from the <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html\" rel=\"nofollow\"><code>Prelude</code></a> module which is imported by default:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>unzip :: [(a,b)] -&gt; ([a],[b])\n\n  unzip [(1,'a'),(2,'b')]\n= ([1,2],\"ab\")\n</code></pre>\n\n<p><strong>Pro Tip:</strong> When you want to find a certain function in Haskell you can use the <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow\">Hoogle</a> search engine.</p>\n"}], "owner": {"reputation": 1, "user_id": 5727904, "user_type": "registered", "profile_image": "https://graph.facebook.com/1147600168586445/picture?type=large", "display_name": "Wei Yan", "link": "https://stackoverflow.com/users/5727904/wei-yan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "closed_date": 1451449985, "answer_count": 1, "score": -5, "last_activity_date": 1451413589, "creation_date": 1451410500, "last_edit_date": 1451410974, "question_id": 34516033, "link": "https://stackoverflow.com/questions/34516033/using-polymorphic-function-to-split-haskell", "closed_reason": "Duplicate", "title": "Using Polymorphic Function to Split (Haskell)", "body": "<p>How to do this using polymorphic function? I'm a new learner, Thanks!\nsplit :: [(a,b)] -> ([a,b]), example split [(1,'a') , (2, 'b')] = ([1,2], \"ab\")</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1451424007, "post_id": 34514511, "comment_id": 56779679, "body": "<a href=\"http://programmers.stackexchange.com/questions/304019/how-does-repeat-x-xrepeat-x-return-a-list-in-haskell/\">This thread in the Programmers Stack Exchange site</a> might be of help."}], "answers": [{"tags": [], "owner": {"reputation": 1858, "user_id": 1352240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5650ebc3479d59a5266767a26b0e6649?s=128&d=identicon&r=PG", "display_name": "YuriAlbuquerque", "link": "https://stackoverflow.com/users/1352240/yurialbuquerque"}, "is_accepted": false, "score": 0, "last_activity_date": 1451405412, "creation_date": 1451405412, "answer_id": 34514760, "question_id": 34514511, "link": "https://stackoverflow.com/questions/34514511/understanding-recursive-lazy-lists/34514760#34514760", "title": "Understanding recursive lazy lists", "body": "<p>The answer is, indeed, simply lazy evaluation. Haskell doesn't evaluate anything, not even the tail of a list, unless it's explicitly marked as strict, or if it is needed by an IO action (and even IO actions themselves may be lazy, which sometimes is confusing)</p>\n\n<p>So, if you evaluate something like</p>\n\n<pre><code>head (1 : undefined)\n</code></pre>\n\n<p>You'll get 1, even though there's an undefined in there, because the tail of the list is never evaluated.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451425660, "post_id": 34519445, "comment_id": 56780449, "body": "I like to think of lazy evaluation in terms of rewriting terms from the outside in. Do you know how to connect these perspectives concisely?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451428450, "post_id": 34519445, "comment_id": 56781737, "body": "@dfeuer You could say: Lazy evaluation provides the denotational semantics for evaluation of haskell expressions. The design of the GHC runtime system with thunks provides one possible interpretation (sometimes called a <i>sharpening</i>) of this denotational semantics as an operational semantics."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1451430257, "post_id": 34519445, "comment_id": 56782453, "body": "@ReinHenrichs, I guess it would probably be fair to say that term rewriting gives the denotational semantics (call by name), and graph rewriting gives the operational semantics (call by need). But it seems likely easy to get from one to the other by writing terms on paper, and replacing variable references with drawn arrows. I&#39;ve never actually looked at how this is formalized though."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451430312, "post_id": 34519445, "comment_id": 56782471, "body": "@dfeuer Yeah... <i>elaborate shrug</i>."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": true, "score": 2, "last_activity_date": 1451425438, "last_edit_date": 1451425438, "creation_date": 1451424895, "answer_id": 34519445, "question_id": 34514511, "link": "https://stackoverflow.com/questions/34514511/understanding-recursive-lazy-lists/34519445#34519445", "title": "Understanding recursive lazy lists", "body": "<p>Behind the scenes, Haskell systems usually represent values in memory by a kind of structure called a <strong>thunk</strong>.  Think of a thunk as an object that has two states:</p>\n\n<ol>\n<li>Uncomputed</li>\n<li>Computed</li>\n</ol>\n\n<p>An uncomputed thunk contains a pointer to the object code subroutine that computes its result, and a pointer to the thunks that supply the values needed to perform that computation.  (If you've come across the concept of <a href=\"https://en.wikipedia.org/wiki/Closure_(computer_programming)\" rel=\"nofollow\"><strong>closures</strong></a>, an uncomputed thunk is a closure.)</p>\n\n<p>A computed thunk just contains a raw result value.  The basic operation on thunks is called <em>forcing</em>.  When you force an uncomputed thunk, its subroutine is called with the captured arguments, the thunk is replaced with the computed result value (thereby switching its state to computed), and that value is returned.  When you force an already computed thunk, you just get the already computed value.</p>\n\n<p>Maybe this is easier if we write in pseudocode.  I'll do something Java-ish:</p>\n\n<pre><code>class Thunk&lt;A&gt; {\n    private final Supplier&lt;A&gt; computation;\n    private boolean computed = false;\n    private A result;\n\n    Thunk(Supplier&lt;A&gt; computation) {\n        this.computation = computation;\n    }\n\n    public A force() {\n        if (!computed) {\n            result = computation.get();\n            computed = true;\n        }\n        return result;\n    }\n}\n</code></pre>\n\n<p>That's not exactly like what what I described above, but it does behave like it.</p>\n\n<p>Now, let's look at a simpler example, a function that constructs a repeating list of one element:</p>\n\n<pre><code>repeat :: a -&gt; [a]\nrepeat a = a : repeat a\n</code></pre>\n\n<p>The <code>repeat</code> function gets compiled to an object code routine that, in pseudo-code, might look something like this:</p>\n\n<pre><code>Thunk&lt;List&lt;A&gt;&gt; repeat(Thunk&lt;A&gt; a) {\n    return new Thunk&lt;A&gt;(() -&gt; new Cons&lt;A&gt;(a, repeat(a)));\n}\n\nclass Cons&lt;A&gt; extends List&lt;A&gt; {\n    Thunk&lt;A&gt; head;\n    Thunk&lt;List&lt;A&gt;&gt; tail;\n    // ...\n}\n</code></pre>\n\n<p>If you're unfamiliar with Java 8, <code>() -&gt; new Cons&lt;A&gt;(a, repeat(a))</code> is a lambda.  This one is a function that takes zero arguments and, when called, constructs a pair.  The recursive call to <code>repeat</code> is <em>inside the lambda</em>, so calling <code>repeat</code> doesn't recurse\u2014it returns a <code>Thunk</code> that captures the lambda, without executing it right away.  When that thunk is <code>force</code>d, only <em>then</em> will the lambda be called, which will call <code>repeat</code>, which will return another similar thunk right away.</p>\n\n<p>Basically, in Haskell, code gets compiled to an optimized low-level version of this.</p>\n"}], "owner": {"reputation": 940, "user_id": 1388456, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/103b2c81eabb9394126eddd993df33ca?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/1388456/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 34519445, "answer_count": 2, "score": 0, "last_activity_date": 1451425438, "creation_date": 1451404541, "last_edit_date": 1451405195, "question_id": 34514511, "link": "https://stackoverflow.com/questions/34514511/understanding-recursive-lazy-lists", "title": "Understanding recursive lazy lists", "body": "<p>I'm trying to get comfortable with the following snippet from the <a href=\"https://wiki.haskell.org/Prime_numbers#Postponed\" rel=\"nofollow\">Haskell wiki</a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>primesPE = 2 : oddprimes\n  where \n    oddprimes = sieve [3,5..] 9 oddprimes\n    sieve (x:xs) q ps@ ~(p:t)\n      | x &lt; q     = x : sieve xs q ps\n      | otherwise =     sieve (xs `minus` [q, q+2*p..]) (head t^2) t\n\nminus (x:xs) (y:ys) = case (compare x y) of\n  LT -&gt; x : minus xs (y:ys)\n  EQ -&gt; minus xs ys\n  GT -&gt; minus (x:xs) ys\nminus xs _ = xs\n</code></pre>\n\n<p>I'm getting tripped up on the recursive definition of <code>oddprimes</code> and the usage of <code>minus</code> on infinite lists by a function that is doing so recursively. </p>\n\n<p>I think partly I'm confused because I do not understand how the Haskell compiler executes this code. How does it not run out of memory? I suspect the answer is <code>&lt;magic&gt; lazy evaluation &lt;/magic&gt;</code> but I think I need a firmer grasp on how this is evaluated in practice to feel comfortable.</p>\n"}, {"tags": ["haskell", "dependent-type"], "comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 3, "creation_date": 1451401937, "post_id": 34512682, "comment_id": 56768240, "body": "Are you familiar with the Dimensional (<a href=\"https://hackage.haskell.org/package/dimensional\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/dimensional</a>) and Units (<a href=\"https://hackage.haskell.org/package/units\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/units</a>) packages? There is also the Dimensional Type Families package (<a href=\"https://hackage.haskell.org/package/dimensional-tf\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/dimensional-tf</a>), but that is deprecated in favour of plain Dimensional."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1451402816, "post_id": 34512682, "comment_id": 56768728, "body": "No, I am not, thanks for the tip!"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1451406173, "post_id": 34512682, "comment_id": 56770683, "body": "See also <a href=\"https://hackage.haskell.org/package/uom-plugin-0.1.1.0/docs/Data-UnitsOfMeasure-Tutorial.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/uom-plugin-0.1.1.0/docs/&hellip;</a>"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1451468526, "post_id": 34512682, "comment_id": 56794966, "body": "@haoformayor : interesting, thanks !"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1451397847, "creation_date": 1451397847, "question_id": 34512682, "link": "https://stackoverflow.com/questions/34512682/phantom-types-used-for-tracking-units-time-distance-in-haskell-how-can-this", "title": "Phantom types used for tracking units (time, distance) in Haskell, how can this code be improved (made more readable, expressive, shorter) ?", "body": "<p>I am very new to phantom types and GADTs. I wonder if this code could could be improved using type families ? </p>\n\n<p>I suspect that it could because I have heard that dependent typing is often implemented using type families in Haskell and in some sense this code shows a very simple usage of dependent types in the <code>getSpeed</code> function. In that function the type of result depends on the type of the inputs (in a very trivial way).</p>\n\n<pre><code>{-# LANGUAGE GADTs,StandaloneDeriving #-}\nmain=do\n let t=Time 1 Hour\n let d=Distance 1 Meter\n putStrLn $ show $ getSpeed d t\n\nclass (Show u) =&gt;DistanceUnit u\n\ndata KiloMeter=KiloMeter deriving Show\ndata Meter= Meter deriving Show\n\ninstance DistanceUnit Meter\ninstance DistanceUnit KiloMeter\n\nclass (Show u) =&gt;TimeUnit u\n\ndata Second = Second deriving Show\ndata Hour = Hour deriving Show\n\ninstance TimeUnit Second\ninstance TimeUnit Hour\n\ndata Distance u where\n  Distance:: (DistanceUnit u) =&gt; Double -&gt; u-&gt;Distance u\n\ndata Time u where\n  Time:: (TimeUnit u) =&gt; Double -&gt; u-&gt; Time u\n\nderiving instance Show (Distance u)\nderiving instance Show (Time t)\n\ndata Speed du tu where\n  Speed::(DistanceUnit du, TimeUnit tu)=&gt; Double -&gt; du-&gt;tu-&gt;Speed du tu\n\nderiving instance Show (Speed du tu)\n\ngetSpeed:: Distance du-&gt; Time tu -&gt;Speed du tu\ngetSpeed (Distance  dv du) (Time tv tu)=Speed (dv/tv) du tu\n\ngetSpeedUnitAsString::Speed du tu -&gt;String\ngetSpeedUnitAsString (Speed v du tu)=show du++\"/\"++ show tu\n</code></pre>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 292363, "user_id": 37213, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/eeec80237213c91e5bab56b77ac5b8ca?s=128&d=identicon&r=PG", "display_name": "duffymo", "link": "https://stackoverflow.com/users/37213/duffymo"}, "edited": false, "score": 3, "creation_date": 1451395336, "post_id": 34511943, "comment_id": 56764682, "body": "Shouldn&#39;t be &quot;do nothing&quot;.  Should be return the root condition and let the stack unwind."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1451411852, "last_edit_date": 1451411852, "creation_date": 1451396583, "answer_id": 34512336, "question_id": 34511943, "link": "https://stackoverflow.com/questions/34511943/a-do-nothing-guard-for-a-recursive-function/34512336#34512336", "title": "A &quot;do nothing&quot; guard for a recursive function?", "body": "<p>First of all it is rather <em>un-Haskell</em> to say that Haskell does something, that's the whole point of declarative programming and lazy programming. You describe the output. How it is actually generated is up to the compiler.</p>\n\n<p>To answer your question, you could change your function a bit, such that it allows <code>Maybe</code>:</p>\n\n<pre><code>generateGameTree g p = \n    | identifyWinner g p == Nothing = Just $ Node (g,p) $ filter (isJust . snd) [ ((fst x),generateGameTree (snd x) (nextPlayer p))  | x &lt;- (findPossibleMoves p g) ]\n    | otherwise = Nothing\n</code></pre>\n\n<p>the <code>filter</code> will filter out <code>Nothing</code>s in the tree.</p>\n\n<p>Another (more or less equivalent) solution is generating a list of nodes, and the list is either empty, or a singleton:</p>\n\n<pre><code>generateGameTree g p = \n    | identifyWinner g p == Nothing = [Node (g,p) $ concat [ ((fst x),generateGameTree (snd x) (nextPlayer p))  | x &lt;- (findPossibleMoves p g) ] ]\n    | otherwise = []\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 1, "last_activity_date": 1451431826, "creation_date": 1451431826, "answer_id": 34520757, "question_id": 34511943, "link": "https://stackoverflow.com/questions/34511943/a-do-nothing-guard-for-a-recursive-function/34520757#34520757", "title": "A &quot;do nothing&quot; guard for a recursive function?", "body": "<p>If you have a function</p>\n\n<pre><code>nextPositions :: Game -&gt; [Game]\n</code></pre>\n\n<p>which gives all the positions that can result from taking every possible move at the given position then a game tree is a <code>Cofree [] Game</code> from <a href=\"https://hackage.haskell.org/package/free-4.12.1/docs/Control-Comonad-Cofree.html\" rel=\"nofollow\"><code>Control.Comonad.Cofree</code></a></p>\n\n<pre><code>type GameTree = Cofree [] Game\n</code></pre>\n\n<p>and it can be generated with</p>\n\n<pre><code>generateGameTree :: Game -&gt; GameTree\ngenerateGameTree = coiter nextPositions\n</code></pre>\n\n<p>If positions which are won have no next positions then the generation will automatically stop at won positions. You can then convert this to a more usual <code>Data.Tree</code> representation if you want.</p>\n"}, {"tags": [], "owner": {"reputation": 1281, "user_id": 5600363, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d820760191b1bb057846d5a06c2bf5b6?s=128&d=identicon&r=PG", "display_name": "hkBst", "link": "https://stackoverflow.com/users/5600363/hkbst"}, "is_accepted": false, "score": 0, "last_activity_date": 1457095466, "creation_date": 1457095466, "answer_id": 35796434, "question_id": 34511943, "link": "https://stackoverflow.com/questions/34511943/a-do-nothing-guard-for-a-recursive-function/35796434#35796434", "title": "A &quot;do nothing&quot; guard for a recursive function?", "body": "<p>If there is already a winner and this means the game has ended and there are no more moves, then that is what the result should be, the current state of the game together with a list of no children, so:</p>\n\n<pre><code>makeGameTree g p =\n  | identifyWinner g p == Nothing =\n    Node (g,p) [ (fst x, makeGameTree (snd x) (nextPlayer p))\n               | x &lt;- (findPossibleMoves p g) ]\n  | otherwise = Node (g,p) []\n</code></pre>\n"}], "owner": {"reputation": 397, "user_id": 2555560, "user_type": "registered", "accept_rate": 87, "profile_image": "https://graph.facebook.com/100000044259680/picture?type=large", "display_name": "Tilman Zuckmantel", "link": "https://stackoverflow.com/users/2555560/tilman-zuckmantel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1700, "favorite_count": 0, "accepted_answer_id": 34512336, "answer_count": 3, "score": 0, "last_activity_date": 1457095466, "creation_date": 1451395137, "question_id": 34511943, "link": "https://stackoverflow.com/questions/34511943/a-do-nothing-guard-for-a-recursive-function", "title": "A &quot;do nothing&quot; guard for a recursive function?", "body": "<p>we have the following function which builds up a tree.\nIt's a tree which has a Node and as many subtrees as you want.</p>\n\n<pre><code>generateGameTree g p = Node (g,p) [ ((fst x),generateGameTree (snd x) (nextPlayer p))  | x &lt;- (findPossibleMoves p g) ]\n</code></pre>\n\n<p>now the Problem is to find a recursive base case. \nWe have a function called identifyWinner which does pretty much what it says.</p>\n\n<p>The idea is, to use this function to determine if someone has won and to stop making subtrees whenever that happend. But that would look something like this:</p>\n\n<pre><code>generateGameTree g p = \n    | identifyWinner g p == Nothing = Node (g,p) [ ((fst x),generateGameTree (snd x) (nextPlayer p))  | x &lt;- (findPossibleMoves p g) ]\n    | otherwise = \"DO NOTHING\"\n</code></pre>\n\n<p>We cant figure out how to actually do nothing.\nIs there a way to make this happen in Haskell? </p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["haskell", "haskell-lens", "aeson", "lenses"], "answers": [{"comments": [{"owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "edited": false, "score": 0, "creation_date": 1451408777, "post_id": 34514073, "comment_id": 56772229, "body": "Thanks for pointing out the reasons why <code>key</code> doesn&#39;t work for my case. I really tried to look into the source code, but it makes even less sense :-) Guess it takes time to get head around this."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "edited": false, "score": 0, "creation_date": 1451418294, "post_id": 34514073, "comment_id": 56777055, "body": "@SkyWriter, if you&#39;re familiar with model/view terminology, you can think of <code>_Object</code> as providing a complete <code>Object</code> &quot;view&quot; of a <code>Text</code> model, but only if that <code>Text</code> successfully parses as an <code>Object</code>. Assuming the view succeeds, you can both inspect and modify the <code>Text</code> model through that view."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1451407605, "last_edit_date": 1451407605, "creation_date": 1451402941, "answer_id": 34514073, "question_id": 34511146, "link": "https://stackoverflow.com/questions/34511146/using-lens-to-add-key-and-value-to-a-nested-map/34514073#34514073", "title": "Using lens to add key and value to a nested Map", "body": "<p><code>key</code> is based on <code>ix</code>, whose documentation indicates it isn't powerful enough to do what you want and points to <code>Control.Lens.At.at</code>. I'm pretty sure that should do the trick for you. The basic idea is that you start with the <code>_Object</code> prism to turn the JSON text into an object, then use <code>at key</code> to get a lens into that field <em>as a <code>Maybe</code></em>. You can then change it to <code>Just</code> what you want.</p>\n\n<p>This will work very well as long as all the objects along the path you wish to take exist. If you want to (potentially) start from nothing and create a chain of single-field objects, you will likely find things more annoying. Fortunately, you probably don't need to do this.</p>\n"}, {"comments": [{"owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "edited": false, "score": 0, "creation_date": 1451408687, "post_id": 34515239, "comment_id": 56772183, "body": "Thank you for providing a working example for my case and additional explanation!"}, {"owner": {"reputation": 1064, "user_id": 12153248, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-f7ubefVLzQg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdOhhV81djlo9daQq8Jy-mYdaQz5A/photo.jpg?sz=128", "display_name": "Ari Fordsham", "link": "https://stackoverflow.com/users/12153248/ari-fordsham"}, "edited": false, "score": 0, "creation_date": 1616515502, "post_id": 34515239, "comment_id": 118023792, "body": "It would make sense for (a version of) <code>.~&#47;set</code> to return a <code>Maybe</code> for situations like this, where <code>set</code>s can be meaningless at runtime."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 18, "last_activity_date": 1451407224, "creation_date": 1451407224, "answer_id": 34515239, "question_id": 34511146, "link": "https://stackoverflow.com/questions/34511146/using-lens-to-add-key-and-value-to-a-nested-map/34515239#34515239", "title": "Using lens to add key and value to a nested Map", "body": "<p>As dfeuer noted, <code>at</code> can insert into maps, while <code>key</code> and <code>ix</code> merely traverse elements if they exist. We can do the following:</p>\n\n<pre><code>&gt; \"{ \\\"a\\\": { \\\"b\\\": 10 } }\" &amp; key \"a\" . _Object . at \"c\" ?~ String \"foo\"\n\"{\\\"a\\\":{\\\"b\\\":10,\\\"c\\\":\\\"foo\\\"}}\n</code></pre>\n\n<p><code>at</code> is a lens focusing on <code>Maybe element</code>-s, and we can insert by setting to <code>Just</code> some element, and remove by setting to <code>Nothing</code>. <code>at \"c\" ?~ String \"foo\"</code> is the same as <code>at \"c\" .~ Just (String \"foo\")</code>. </p>\n\n<p>If we want to do nested inserts, we can use <a href=\"https://hackage.haskell.org/package/lens-4.13/docs/Control-Lens-Iso.html\" rel=\"noreferrer\"><code>non</code></a> to define a default value to be inserted:</p>\n\n<pre><code>&gt; \"{ \\\"a\\\": { \\\"b\\\": 10 } }\" &amp; key \"a\" . _Object . at \"c\" . non (Object mempty) . _Object . at \"d\" ?~ String \"foo\"\n\"{\\\"a\\\":{\\\"b\\\":10,\\\"c\\\":{\\\"d\\\":\\\"foo\\\"}}}\"\n</code></pre>\n\n<p>This is a mouthful, so we can factor some parts out:</p>\n\n<pre><code>&gt; let atKey k = _Object . at k\n&gt; \"{ \\\"a\\\": { \\\"b\\\": 10 } }\" &amp; key \"a\" . atKey \"c\" . non (Object mempty) . atKey \"d\" ?~ String \"foo\"\n</code></pre>\n"}], "owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1428, "favorite_count": 1, "accepted_answer_id": 34515239, "answer_count": 2, "score": 12, "last_activity_date": 1451407605, "creation_date": 1451392383, "question_id": 34511146, "link": "https://stackoverflow.com/questions/34511146/using-lens-to-add-key-and-value-to-a-nested-map", "title": "Using lens to add key and value to a nested Map", "body": "<p>I am struggling to figure out an issue with manipulating JSON with Aeson lenses. My task is as simple as to add a key to a nested object in JSON. I was able to change the existing keyby means of:</p>\n\n<pre><code>&gt; :set -XOverloadedStrings\n&gt; import Control.Lens\n&gt; import Data.Aeson\n&gt; import Data.Aeson.Lens\n&gt; \"{ \\\"a\\\": { \\\"b\\\": 10 } }\" &amp; key \"a\" . key \"b\" .~ String \"jee\"\n\"{\\\"a\\\":{\\\"b\\\":\\\"jee\\\"}}\"\n</code></pre>\n\n<p>But when I try to make it deal with the new key, it just silently fails to add it:</p>\n\n<pre><code>&gt; \"{ \\\"a\\\": { \\\"b\\\": 10 } }\" &amp; key \"a\" . key \"c\" .~ String \"jee\"   \n\"{\\\"a\\\":{\\\"b\\\":10}}\"\n</code></pre>\n\n<p>Certainly it's me doing something wrong, but I figure I'm out of mana to understand what exactly.</p>\n\n<p>Would you kindly point me in the right direction?</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 155, "user_id": 5715425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80175d4896bc5afa19d54b0a059ed115?s=128&d=identicon&r=PG&f=1", "display_name": "denys.fridman", "link": "https://stackoverflow.com/users/5715425/denys-fridman"}, "edited": false, "score": 2, "creation_date": 1451392044, "post_id": 34510862, "comment_id": 56762816, "body": "replace fromInteger with fromIntegral"}], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1451397811, "post_id": 34511123, "comment_id": 56766029, "body": "It might be worth mentioning the alternative solution which consists in giving <code>fact</code> a more generic type."}], "tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": true, "score": 3, "last_activity_date": 1451392323, "creation_date": 1451392323, "answer_id": 34511123, "question_id": 34510862, "link": "https://stackoverflow.com/questions/34510862/how-to-resolve-couldnt-match-expected-type-in-haskell/34511123#34511123", "title": "how to resolve couldn&#39;t match expected type in haskell", "body": "<p>You can replace <code>fromInteger</code> with <code>fromIntegral</code>.</p>\n\n<pre><code>fromInteger :: Num a =&gt; Integer -&gt; a\nfromIntegral :: (Integral a, Num b) =&gt; a -&gt; b\n</code></pre>\n\n<p>It works because <code>Int</code> complies with the <code>Integral</code> class while <code>fromInteger</code> only accepts <code>Integer</code> as parameter.</p>\n"}], "owner": {"reputation": 7574, "user_id": 236106, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/46ea107d3eb130cdea38bece3f7d3c26?s=128&d=identicon&r=PG", "display_name": "Bunny Rabbit", "link": "https://stackoverflow.com/users/236106/bunny-rabbit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 0, "accepted_answer_id": 34511123, "answer_count": 1, "score": 1, "last_activity_date": 1451395007, "creation_date": 1451391289, "last_edit_date": 1451395007, "question_id": 34510862, "link": "https://stackoverflow.com/questions/34510862/how-to-resolve-couldnt-match-expected-type-in-haskell", "title": "how to resolve couldn&#39;t match expected type in haskell", "body": "<pre><code>fact :: Int -&gt; Int\nfact x = if x == 1 then x else x * fact(x - 1)\n\nnterm :: Double -&gt; Int -&gt; Double\nnterm x i =  x ^ i / fromInteger (fact i)\n\nsolve :: Double -&gt; Double\nsolve x = sum [nterm x i| i &lt;- [1..10]] + 1\n\nmain :: IO ()\nmain = getContents &gt;&gt;= mapM_ print. map solve. map (read::String-&gt;Double). tail. words\n</code></pre>\n\n<p>I am getting the follwing error while executing the above haskell code. What does this mean ? My understanding is that the type returned by fromInteger (<code>Integer</code>) is not same as the type returned by returned by (<code>Int</code>).\nHow can I fix this ? </p>\n\n<pre><code>solution.hs:5:35:\n    Couldn't match expected type `Integer' with actual type `Int'\n    In the first argument of `fromInteger', namely `(fact i)'\n    In the second argument of `(/)', namely `fromInteger (fact i)'\n</code></pre>\n"}, {"tags": ["c", "haskell", "ffi"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1451386389, "post_id": 34509263, "comment_id": 56760052, "body": "If you want, you can simplify it noting that<code>cs &lt;- blah ; return cs</code> is equivalent to <code>blah</code>."}, {"owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1451386515, "post_id": 34509263, "comment_id": 56760109, "body": "@ Chi. You are right, I did not sanitize completely before posting. I&#39;ll edit. Thanks."}], "tags": [], "owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "is_accepted": false, "score": 2, "last_activity_date": 1451386594, "last_edit_date": 1451386594, "creation_date": 1451385488, "answer_id": 34509263, "question_id": 34507373, "link": "https://stackoverflow.com/questions/34507373/haskell-ffi-issue-with-double-pointer-argument/34509263#34509263", "title": "Haskell FFI Issue With Double Pointer Argument", "body": "<p>Stupid mistake, I missed a dereferencing step. This code now works :</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nimport Foreign\nimport Foreign.C.Types (CInt(..), CUChar(..), CSize(..))\nimport Foreign.Ptr (Ptr)\nimport Foreign.Marshal.Array (peekArray)\n\nforeign import ccall unsafe \"myfunc\" c_myfunc :: CInt -&gt; Ptr (Ptr CUChar) -&gt; Ptr CSize -&gt; IO (CInt)\n\ngetBuffer :: Int -&gt; IO [CUChar]\ngetBuffer arg1 = do\n    alloca $ \\ ptrbuf -&gt; do\n        alloca $ \\buflen -&gt; do\n            res &lt;- c_myfunc (CInt arg1) ptrBuf buflen\n\n            buflen' &lt;- fromIntegral &lt;$&gt; peek buflen\n\n            buffer  &lt;- peek ptrBuf    -- I MISSED THIS ONE. Extra dereferencing needed.\n            peekArray buflen' buffer  -- return a [CUChar] of size buflen'\n</code></pre>\n"}], "owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1451386594, "creation_date": 1451378039, "last_edit_date": 1451378885, "question_id": 34507373, "link": "https://stackoverflow.com/questions/34507373/haskell-ffi-issue-with-double-pointer-argument", "title": "Haskell FFI Issue With Double Pointer Argument", "body": "<p>I am trying to bind to a C function from an external C library which returns a pointer to a memory buffer and the length of the buffer :</p>\n\n<pre><code>extern int myfunc(int arg1, unsigned char **buffer, size_t *buffer_len);\n</code></pre>\n\n<p>I tried the following code but got a segmentation fault as a result. </p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nimport Foreign\nimport Foreign.C.Types (CInt(..), CUChar(..), CSize(..))\nimport Foreign.Ptr (Ptr)\nimport Foreign.Marshal.Array (peekArray)\n\nforeign import ccall unsafe \"myfunc\" c_myfunc :: CInt -&gt; Ptr (Ptr CUChar) -&gt; Ptr CSize -&gt; IO (CInt)\n\ngetBuffer :: Int -&gt; IO [CUChar]\ngetBuffer arg1 = do\n    alloca $ \\buffer -&gt; do\n        alloca $ \\buflen -&gt; do\n            res &lt;- c_myfunc (CInt arg1) buffer buflen\n\n            buflen' &lt;- fromIntegral &lt;$&gt; peek buflen\n\n            cs  &lt;- peekArray buflen' buffer  -- return a [Ptr CUChar] of size buflen\n            cs' &lt;- mapM peek cs  -- return a [CUChar] of size buflen\n\n            return cs'\n</code></pre>\n\n<p>I assume that peekArray did allocate enough memory, so I am not sure where it did go wrong. Any help welcome. </p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 673, "user_id": 4687531, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/273ab5ac19e80c8e4ce3478c61b59fb4?s=128&d=identicon&r=PG&f=1", "display_name": "user4687531", "link": "https://stackoverflow.com/users/4687531/user4687531"}, "edited": false, "score": 0, "creation_date": 1451433535, "post_id": 34517547, "comment_id": 56783549, "body": "Thanks @jpvillaisaza! I used brew to install the stack so that future updates would be easier to manage. I did do <code>brew upgrade haskell-stack</code> but it doesn&#39;t seem to upgrade it to a more recent version. Any ideas on how to upgrade with brew? NOTE: when I run that <code>brew upgrade</code> command it mentions that <code>Error: haskell-stack 1.0.0 already installed</code> which means it should be the latest version. What is going on here in terms of the versions of stack being installed/ run?"}, {"owner": {"reputation": 445, "user_id": 2102854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PeSJn.png?s=128&g=1", "display_name": "jpvillaisaza", "link": "https://stackoverflow.com/users/2102854/jpvillaisaza"}, "reply_to_user": {"reputation": 673, "user_id": 4687531, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/273ab5ac19e80c8e4ce3478c61b59fb4?s=128&d=identicon&r=PG&f=1", "display_name": "user4687531", "link": "https://stackoverflow.com/users/4687531/user4687531"}, "edited": false, "score": 0, "creation_date": 1451483552, "post_id": 34517547, "comment_id": 56802923, "body": "@user4687531 What does <code>which stack</code> say? Your path might be getting an older version (I have an older one at <code>&#47;usr&#47;local&#47;bin</code> and the new one at <code>~&#47;.local&#47;bin</code>, for instance), so make sure the path for the one you want has priority. Does <code>stack upgrade</code> work for you?"}, {"owner": {"reputation": 673, "user_id": 4687531, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/273ab5ac19e80c8e4ce3478c61b59fb4?s=128&d=identicon&r=PG&f=1", "display_name": "user4687531", "link": "https://stackoverflow.com/users/4687531/user4687531"}, "edited": false, "score": 0, "creation_date": 1451495414, "post_id": 34517547, "comment_id": 56809380, "body": "Ah <code>which stack</code> gives <code>&#47;Applications&#47;ghc-7.10.2.app&#47;Contents&#47;bin&#47;stack</code> which is from <a href=\"http://ghcformacosx.github.io/\" rel=\"nofollow noreferrer\">ghc for mac osx</a>. I need to be using the <code>brew</code> installed one which is here: <code>&#47;usr&#47;local&#47;Cellar&#47;haskell-stack&#47;1.0.0</code>. I am guessing I just need to add the brew one to the front of my <code>$PATH</code> variable in zshrc?"}, {"owner": {"reputation": 445, "user_id": 2102854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PeSJn.png?s=128&g=1", "display_name": "jpvillaisaza", "link": "https://stackoverflow.com/users/2102854/jpvillaisaza"}, "reply_to_user": {"reputation": 673, "user_id": 4687531, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/273ab5ac19e80c8e4ce3478c61b59fb4?s=128&d=identicon&r=PG&f=1", "display_name": "user4687531", "link": "https://stackoverflow.com/users/4687531/user4687531"}, "edited": false, "score": 0, "creation_date": 1451500399, "post_id": 34517547, "comment_id": 56811895, "body": "@user4687531 Yes, make sure the one from brew comes first in the path."}], "tags": [], "owner": {"reputation": 445, "user_id": 2102854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PeSJn.png?s=128&g=1", "display_name": "jpvillaisaza", "link": "https://stackoverflow.com/users/2102854/jpvillaisaza"}, "is_accepted": true, "score": 1, "last_activity_date": 1451416482, "creation_date": 1451416482, "answer_id": 34517547, "question_id": 34506585, "link": "https://stackoverflow.com/questions/34506585/stack-new-not-functioning-as-intended/34517547#34517547", "title": "stack new not functioning as intended", "body": "<p>Stack 0.1.2.0 doesn't take a package name. If you want to create a project called <code>my-project</code> (actually, a package called <code>new-template</code>) using that version, you can do something like</p>\n\n<pre><code>$ mkdir my-project\n$ cd my-project/\n$ stack new\n</code></pre>\n\n<p>This will generate some files in the <code>my-project</code> directory.</p>\n\n<p>You can find more information with <code>stack new --help</code>.</p>\n\n<p>Newer versions of Stack, however, require a package name. If you run <code>stack new</code> with Stack 1.0.0, for instance, you get something like</p>\n\n<pre><code>Usage: stack new PACKAGE_NAME ...\n</code></pre>\n\n<p>Both versions of Stack should work, but I guess your best option is to <a href=\"http://docs.haskellstack.org/en/stable/install_and_upgrade.html#upgrade\" rel=\"nofollow\">upgrade Stack</a> (0.1.2.0 is from July 5, which is kind of old).</p>\n"}], "owner": {"reputation": 673, "user_id": 4687531, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/273ab5ac19e80c8e4ce3478c61b59fb4?s=128&d=identicon&r=PG&f=1", "display_name": "user4687531", "link": "https://stackoverflow.com/users/4687531/user4687531"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 34517547, "answer_count": 1, "score": 0, "last_activity_date": 1451416482, "creation_date": 1451374560, "last_edit_date": 1451405064, "question_id": 34506585, "link": "https://stackoverflow.com/questions/34506585/stack-new-not-functioning-as-intended", "title": "stack new not functioning as intended", "body": "<p>I am new to haskell and am having trouble using <code>stack new</code> to create a new project.</p>\n\n<p>I am using MACOSX (El Capitan) and after installing <a href=\"https://ghcformacosx.github.io/\" rel=\"nofollow\">GHC for Mac</a> and installing <a href=\"http://docs.haskellstack.org/en/stable/install_and_upgrade.html#using-homebrew\" rel=\"nofollow\">Stack using homebrew</a>, I tried the following in <code>~/PROJECTS</code></p>\n\n<pre><code>stack new my-project\n</code></pre>\n\n<p>This keeps giving me the following generic stack info</p>\n\n<pre><code>Usage: stack new ([--solver] | [--resolver RESOLVER] | [--prefer-lts] |\n             [--prefer-nightly]) [--force] [--ignore-subdirs]\n  Create a brand new project\n</code></pre>\n\n<p>I am using zsh - why is a the new <code>my-project</code> folder being created?</p>\n\n<p>Note: <code>stack --version</code> outputs:</p>\n\n<pre><code>Version 0.1.2.0, Git revision 65246552936b7da4b64b38372feac903d96a8911\n</code></pre>\n\n<p>Any help appreciated</p>\n"}, {"tags": ["haskell", "syntastic", "neovim", "ghc-mod"], "answers": [{"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 2, "creation_date": 1452019070, "post_id": 34513195, "comment_id": 56983228, "body": "For whoever it might be useful to: I had to additionally remove <code>~&#47;.cabal</code> \u2014 merely reinstalling <code>ghc-mod</code> did not resolve the error (possibly because HomeBrew introduced <code>ghc-7.10.3a</code> and <code>ghc-7.10.3b</code>, which are obviously not official GHC versions)."}], "tags": [], "owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "is_accepted": true, "score": 2, "last_activity_date": 1451919973, "last_edit_date": 1451919973, "creation_date": 1451399703, "answer_id": 34513195, "question_id": 34505786, "link": "https://stackoverflow.com/questions/34505786/ghc-mod-looking-for-settings-file-in-wrong-directory/34513195#34513195", "title": "GHC-mod looking for settings file in wrong directory", "body": "<p>I decided to reinstall <code>ghc-mod</code> using <code>cabal</code> this morning, and this seems to have solved the issue completely!</p>\n\n<p>Other steps taken included running <code>:PlugUpdate</code>, and totally removing and reinstalling the <code>ghcmod-vim</code> and <code>syntastic</code> plugins, although I don't know if these contributed to fixing the issue indirectly - the problem persisted until I ran <code>cabal update</code> and <code>cabal install ghc-mod</code> (which, alone, reinstalled it).</p>\n\n<p>As was kindly pointed out in a comment, the root cause of this issue was the fact that <code>ghc-mod</code> introduced breaking changes after version 5.4.0, which <a href=\"https://github.com/scrooloose/syntastic/issues/1576\" rel=\"nofollow\">forced the <code>syntastic</code> maintainers to drop support for it</a>.</p>\n"}], "owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "accepted_answer_id": 34513195, "answer_count": 1, "score": 5, "last_activity_date": 1451919973, "creation_date": 1451371143, "question_id": 34505786, "link": "https://stackoverflow.com/questions/34505786/ghc-mod-looking-for-settings-file-in-wrong-directory", "title": "GHC-mod looking for settings file in wrong directory", "body": "<p>I use a number of Haskell plugins in my editor (Neovim), one of which is <code>ghcmod-vim</code>, which works together with <code>syntastic</code> to provide syntax checking as I write Haskell code.</p>\n\n<p>At one point, I had installed <a href=\"https://ghcformacosx.github.io/\">GHC for Mac OS X</a> as a temporary workaround for a number of issues in my build system configuration. These issues have since been fixed, so I removed the <code>.app</code> bundle from my <code>/Applications</code> and removed the lines it appended to my <code>~/.zshrc</code>.</p>\n\n<p>For some reason, even now, when I write a Haskell file and save it to disk, I get an error in Neovim's message buffer:</p>\n\n<pre><code>\"myfile.hs\" 10L, 163C written\nsyntastic: error: checker output:\n/Applications/ghc-7.8.4.app/Contents/lib/ghc-7.8.4/settings: openFile: does not exist (No such file or directory)\nsyntastic: error: checker haskell/ghc_mod returned abnormal status 1\n</code></pre>\n\n<p>The <code>settings</code> file contains a list of key/value pairs with various build environment options which is usually stored alongside the <code>ghc</code> binary, and which exists alongside the <code>ghc</code> binary in my <code>/usr/local/bin</code>, installed using Homebrew.</p>\n\n<p>For some reason, either <code>syntastic</code> or the <code>ghc_mod</code> checker module is looking for the settings file in the wrong place. This is despite the fact that there are no references to this path in any of my Neovim or plugin config files, or in any environment variables.</p>\n\n<p>How can I get <code>ghc_mod</code> or <code>syntastic</code> to look for the GHC settings file in the right place?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 4, "creation_date": 1451368799, "post_id": 34505104, "comment_id": 56752394, "body": "<code>ZipList a</code> already has a <code>Show</code> instance if <code>a</code> is showable, including <code>Show a =&gt; ZipList (ZipList a))</code>. That will lead to problems (and ambiguity). I strongly suggest a <code>newtype MatrixZipList a = ZipList (ZipList a)</code>."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451370250, "post_id": 34505104, "comment_id": 56752891, "body": "Ah yes, there&#39;s already an instance. Perhaps I can override it just for 2 dimensional ziplists? Shouldn&#39;t that be a <code>type MatrixZipList</code> not <code>newtype</code>? Oh maybe you mean <code>newtype Matrix a = Matrix (ZipList (ZipList a))</code> and use the newtype as an instance."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451374734, "post_id": 34505104, "comment_id": 56754619, "body": "You cannot &quot;override&quot; instances. By the way, this is one of the reasons you don&#39;t want to have orphan instances (e.g. instances which are neither defined where the data type, or the class is defined), as it can get messy and ambiguous if you accidentally import two instances of the same class. And yes, I meant <code>newtype Matrix = Matrix ...</code>, see answer below."}], "answers": [{"comments": [{"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1451377612, "post_id": 34506494, "comment_id": 56755774, "body": "That&#39;s basically it. Thanks."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 3, "last_activity_date": 1451374221, "creation_date": 1451374221, "answer_id": 34506494, "question_id": 34505104, "link": "https://stackoverflow.com/questions/34505104/haskell-create-a-show-instance-for-2-dimensional-ziplists/34506494#34506494", "title": "Haskell: Create a show instance for 2 dimensional ZipLists", "body": "<p><sub>Note: This post is written in <a href=\"https://wiki.haskell.org/Literate_programming\" rel=\"nofollow\">literate Haskell</a>. You can save it as Matrix.lhs and try it in your GHCi.</sub></p>\n\n<hr>\n\n<p>The problem is that you're trying to define an instance <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/Control.Applicative.html#line-126\" rel=\"nofollow\">that already exists</a>:</p>\n\n<pre><code>instance Show a =&gt; Show (ZipList a) where\n  -- ...\n</code></pre>\n\n<p>Instead, define your own <code>Matrix</code> type:</p>\n\n<pre><code>newtype Matrix a = Matrix (ZipList (ZipList a))\n</code></pre>\n\n<p>However, since <code>ZipList a</code> is basically a wrapper around <code>[a]</code>, you can also simplify this to</p>\n\n<pre><code>&gt; newtype Matrix a = Matrix {getMatrix :: [[a]] }\n</code></pre>\n\n<p>I guess you were using <code>ZipList</code> due to its <code>Functor</code> and <code>Applicative</code> instances, so let's provide them for <code>Matrix</code>:</p>\n\n<pre><code>&gt; instance Functor Matrix where\n&gt;   fmap f = Matrix . fmap (fmap f) . getMatrix\n\n&gt; instance Applicative Matrix where\n&gt;   pure x                      = Matrix [[x]]\n&gt;   (Matrix as) &lt;*&gt; (Matrix bs) = Matrix $ zipWith (zipWith id) as bs\n</code></pre>\n\n<p>Now you can write your own <code>Show</code> instance, which won't overlap:</p>\n\n<pre><code>&gt; showMatrix :: (Show a) =&gt; Matrix a -&gt; String\n&gt; showMatrix = unlines . fmap (unwords . fmap show) . getMatrix\n\n&gt; instance Show a =&gt; Show (Matrix a) where\n&gt;   show = showMatrix\n</code></pre>\n\n<p>If you already wrote some functions for <code>ZipList (ZipList a)</code>, you can easily use them on <code>Matrix</code> too:</p>\n\n<pre><code>type ZipMatrix a = ZipList (ZipList a)\n\nsomeZipFunc :: ZipMatrix a -&gt; ZipMatrix a\nsomeZipFunc = -- ...\n\nsomeMatrixFunc :: Matrix a -&gt; Matrix a\nsomeMatrixFunc = coerce . someZipFunc . coerce\n</code></pre>\n\n<p>where <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Coerce.html#v:coerce\" rel=\"nofollow\"><code>coerce</code> is from <code>Data.Coerce</code></a> and converts between types of the same representation (both <code>ZipMatrix a</code> and <code>Matrix a</code> are essentially <code>[[a]</code>). That way you don't have to rewrite all your current functions from scratch.</p>\n"}], "owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 34506494, "answer_count": 1, "score": 2, "last_activity_date": 1451374221, "creation_date": 1451367656, "last_edit_date": 1451368320, "question_id": 34505104, "link": "https://stackoverflow.com/questions/34505104/haskell-create-a-show-instance-for-2-dimensional-ziplists", "title": "Haskell: Create a show instance for 2 dimensional ZipLists", "body": "<p>I wanted to create a show instance for 2 dimensional ziplists with a type of <code>ZipList (ZipList a)</code>. The below is my attempt.</p>\n\n<pre><code>import Control.Applicative\n\nshowMatrixZipList :: (Show a) =&gt; ZipList (ZipList a) -&gt; String\nshowMatrixZipList = unlines . getZipList .  fmap (unwords . getZipList . fmap show)\n\ninstance (Show a) =&gt; Show (ZipList (ZipList a)) where\n    show matrix = showMatrixZipList matrix\n</code></pre>\n\n<p>The code only compiles with <code>FlexibleInstances</code>, but can only execute <code>show $ ZipList [ZipList [1,2,3]]</code> with <code>OverlappingInstances</code>, but it then screws up the <code>show (ZipList [1,2,3])</code>, which can be fixed with <code>IncoherentInstances</code>.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, OverlappingInstances, IncoherentInstances #-}\n</code></pre>\n\n<p>Is there a better way to do the above?</p>\n"}, {"tags": ["haskell", "binary-tree"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1451369569, "post_id": 34504994, "comment_id": 56752623, "body": "When you write b-tree, do you actually mean <i>binary</i> tree? A B-tree is a very important data structure too, but a rather different one."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451369839, "post_id": 34504994, "comment_id": 56752735, "body": "@dfeuer I think it&#39;s quite clear from the examples that OP means binary tree. I&#39;m going to edit the question accordingly."}], "answers": [{"comments": [{"owner": {"reputation": 2445, "user_id": 4468969, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6b05d7f3493f7c284f67b1f2c1557f58?s=128&d=identicon&r=PG", "display_name": "Andi Pavllo", "link": "https://stackoverflow.com/users/4468969/andi-pavllo"}, "edited": false, "score": 0, "creation_date": 1451374642, "post_id": 34505346, "comment_id": 56754573, "body": "thank you for the hint! I tried your code and I get an error: <code>parse error on input \u2018=\u2019</code> in <code>levels (Node x l r) = [x] : combine (levels l) (levels r)</code>. Do you know why?"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 2, "last_activity_date": 1451369989, "last_edit_date": 1451369989, "creation_date": 1451368914, "answer_id": 34505346, "question_id": 34504994, "link": "https://stackoverflow.com/questions/34504994/determine-binary-tree-level-with-most-occurrences-of-an-element-in-haskell/34505346#34505346", "title": "Determine binary tree level with most occurrences of an element in Haskell", "body": "<p><strong>This answer is <a href=\"https://wiki.haskell.org/Literate_programming\" rel=\"nofollow\">literate Haskell</a>. You can save it with a <code>.lhs</code> extension and load it in GHCi.</strong></p>\n\n<pre><code>&gt; import Data.Ord (comparing)\n&gt; import Data.List (maximumBy)\n\n&gt; data Fruit = Peach | Apple\n&gt; data BTree a = Empty | Node a (BTree a) (BTree a)\n</code></pre>\n\n<p>Try breaking this up into smaller pieces. First, write a function that will produce a list of all the levels in a tree:</p>\n\n<pre><code>&gt; levels :: BTree a -&gt; [[a]]\n&gt; levels Empty = []\n&gt; levels (Node x l r) = [x] : combine (levels l) (levels r)\n&gt;   where combine [] ys = ys\n&gt;         combine xs [] = xs\n&gt;         combine (x:xs) (y:ys) = (x ++ y) : combine xs ys\n</code></pre>\n\n<p>(Note that the <code>combine</code> helper function here is just like <code>zipWith (++)</code>, but continues after the shortest input is exhausted).</p>\n\n<p>Once you have that, it's pretty easy find the instances of <code>Apple</code> in your list (and would be easier still if you added <code>deriving Eq</code> to your <code>Fruit</code> definition):</p>\n\n<pre><code>&gt; countEach :: (a -&gt; Bool) -&gt; [[a]] -&gt; [Int]\n&gt; countEach pred = map (length . filter pred)\n\n&gt; countApples :: [[Fruit]] -&gt; [Int]\n&gt; countApples = countEach isApple\n&gt;   where isApple Apple = True\n&gt;         isApple _ = False\n</code></pre>\n\n<p>Next you can simply label each item in the list with its index number, using <code>zip</code>, and then use <code>maximumBy</code> to select the one with the largest count:</p>\n\n<pre><code>&gt; levelWithMaxApples :: BTree Fruit -&gt; Int\n&gt; levelWithMaxApples t = let ls = levels t\n&gt;                            counts = countApples ls\n&gt;                            labeled = zip [0..] counts\n&gt;                        in fst . maximumBy (comparing snd) $ labeled\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2445, "user_id": 4468969, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6b05d7f3493f7c284f67b1f2c1557f58?s=128&d=identicon&r=PG", "display_name": "Andi Pavllo", "link": "https://stackoverflow.com/users/4468969/andi-pavllo"}, "edited": false, "score": 0, "creation_date": 1451633309, "post_id": 34508819, "comment_id": 56851500, "body": "it works perfectly, thanks! I&#39;ll try to make it a little bit more efficient :)"}, {"owner": {"reputation": 2445, "user_id": 4468969, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6b05d7f3493f7c284f67b1f2c1557f58?s=128&d=identicon&r=PG", "display_name": "Andi Pavllo", "link": "https://stackoverflow.com/users/4468969/andi-pavllo"}, "edited": false, "score": 0, "creation_date": 1452144184, "post_id": 34508819, "comment_id": 57041277, "body": "It looks great, I&#39;m going to try it immediately! :)"}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": true, "score": 1, "last_activity_date": 1452143797, "last_edit_date": 1495541721, "creation_date": 1451383891, "answer_id": 34508819, "question_id": 34504994, "link": "https://stackoverflow.com/questions/34504994/determine-binary-tree-level-with-most-occurrences-of-an-element-in-haskell/34508819#34508819", "title": "Determine binary tree level with most occurrences of an element in Haskell", "body": "<p>Here's another way.</p>\n\n<ol>\n<li><p>Start with a helper function. This will simply build the raw list of nodes and count of <code>Apple</code> at that node. However, this is separately done for each node in each subtree i.e. list will be something like [(Root,1),(L1,1),(L2,0),(R1,1)] </p>\n\n<pre><code>import qualified Data.Map as M (fromListWith,toList)\nimport qualified Data.List as L (sortBy)\n\ncountApples' :: BTree Fruit -&gt; Int -&gt; [(Int,Int)]\ncountApples' Empty _ = []\ncountApples' (Node Apple l r) n = (n,1) : (countApples' l (n+1)) ++ (countApples' r (n+1))\ncountApples' (Node Peach l r) n = (n,0) : (countApples' l (n+1)) ++ (countApples' r (n+1))\n</code></pre></li>\n<li><p>Next, we create a Map with the contents from above step. During this step, we we will aggregate the values at each level of the tree. Then we convert back to a list and sort by the value part of the tuple in descending order. The level with maximum instances of apple will then be the first element in the tuple at the head of the list.</p>\n\n<pre><code>levelWithMaxApples  :: BTree Fruit -&gt; Int\nlevelWithMaxApples  Empty = error \"Empty tree\"\nlevelWithMaxApples  x = fst $ head $ L.sortBy (\\(k1,v1) (k2,v2) -&gt; compare v2 v1) $ M.toList $ M.fromListWith (+) $ countApples' x 0\n</code></pre></li>\n</ol>\n\n<p><a href=\"http://rextester.com/SYQTA86601\" rel=\"nofollow noreferrer\">Demo</a></p>\n\n<p>However, you should note that this may not be a very efficient solution, due to the conversion to and from Map in addition to sorting.</p>\n\n<p>Note: The sorting part was largely based on <a href=\"https://stackoverflow.com/questions/19723523/sort-data-map-by-value-and-get-all-biggest-values\">this</a> answer.</p>\n\n<p><strong>UPDATE:</strong> Here's a way to do it entirely with Maps.</p>\n\n<pre><code>import qualified Data.Map as M\n\ncountApples :: BTree Fruit -&gt; Int -&gt; M.Map Int Int\ncountApples Empty _ = M.empty\ncountApples (Node Apple l r) n = M.unionsWith (+) [(M.singleton n 1 ),(countApples l (n+1)),(countApples r (n+1))] \ncountApples (Node Peach l r) n = M.unionsWith (+) [(M.singleton n 0 ),(countApples l (n+1)),(countApples r (n+1))]\n\nlevelWithMaxApples  :: BTree Fruit -&gt; Int\nlevelWithMaxApples t = fst $ M.foldWithKey (\\k v acc@(k',v') -&gt; if v &gt;= v' then (k,v) else acc) (-1,-1) $ countApples t 0\n</code></pre>\n\n<p><a href=\"http://rextester.com/AKZJ91076\" rel=\"nofollow noreferrer\">Demo</a></p>\n"}], "owner": {"reputation": 2445, "user_id": 4468969, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6b05d7f3493f7c284f67b1f2c1557f58?s=128&d=identicon&r=PG", "display_name": "Andi Pavllo", "link": "https://stackoverflow.com/users/4468969/andi-pavllo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 0, "accepted_answer_id": 34508819, "answer_count": 2, "score": 0, "last_activity_date": 1452143797, "creation_date": 1451367053, "last_edit_date": 1451891640, "question_id": 34504994, "link": "https://stackoverflow.com/questions/34504994/determine-binary-tree-level-with-most-occurrences-of-an-element-in-haskell", "title": "Determine binary tree level with most occurrences of an element in Haskell", "body": "<p>Given a binary tree, I'm trying to find the binary tree's level with the highest number of occurrences of an element, for example <code>Apple</code>.</p>\n\n<p>Here are the specs:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>data Fruit = Peach | Apple\ndata BTree a = Empty | Node a (BTree a) (BTree a)\nlevelWithMaxApples :: BTree Fruit -&gt; Int\n</code></pre>\n\n<p>I was able to make a function which, given a binary tree, it will count the occurrences of <code>Apple</code> in it. Nevertheless, I was cannot figure out how to find the level with most occurrences of <code>Apple</code>, any hint?</p>\n\n<p>Here are some tests:</p>\n\n<pre><code>tree1 = Node Peach Empty Empty\n\ntree2 = Node Peach \n          (Node Peach\n            (Node Apple\n              Empty\n              Empty)\n            (Node Peach\n              (Node Peach\n                Empty\n                Empty)\n              (Node Peach\n                Empty\n                Empty)))\n          (Node Apple\n            (Node Apple\n              Empty\n              (Node Peach\n                Empty\n                Empty))\n            Empty)\n\n&gt; levelWithMaxApples tree1\nNothing\n\n&gt; levelWithMaxApples tree2\n2\n</code></pre>\n\n<p>Here is my attempt (in this case the function's name should be <code>countApples</code>:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>levelWithMaxApples Empty = 0\nlevelWithMaxApples (Node Apple l r) = 1 + levelWithMaxApple l + levelWithMaxApple r\nlevelWithMaxApples (Node Peach l r) = levelWithMaxApple l +   levelWithMaxApple r\n</code></pre>\n\n<p>Thank you for your help!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451369216, "post_id": 34504803, "comment_id": 56752518, "body": "Side note: you can easily simplify to <code>[(x,y) | x &lt;- [2..n], y &lt;- [(x+1)..n], is_prime (abs (x^y - y^x))]</code>. See how it&#39;s never useful to say <code>== True</code>?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 2, "creation_date": 1451369221, "post_id": 34504803, "comment_id": 56752521, "body": "Note that <code>length [x | x &lt;- xs, p x] == 0</code> can be written much nicer, and lazily, as <code>all (not . p) xs</code>"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 2, "creation_date": 1451374615, "post_id": 34504803, "comment_id": 56754558, "body": "@Cactus: And that&#39;s much more efficient, as it will break on the first element, whereas <code>length xs</code> will have to wait for the whole computation (unless that&#39;s a custom <code>length :: Foldable t =&gt; t -&gt; Peano</code> or similar)."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1451374671, "post_id": 34504803, "comment_id": 56754590, "body": "Yes, which is what I meant by lazily. But you&#39;re right in stressing that it is short-circuiting."}, {"owner": {"reputation": 277, "user_id": 380252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f0999e58687b0d2153c594616ceafc5c?s=128&d=identicon&r=PG", "display_name": "blue scorpion", "link": "https://stackoverflow.com/users/380252/blue-scorpion"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451399876, "post_id": 34504803, "comment_id": 56767138, "body": "@dfeuer: yes, I tried that. The reason I made the expression so boringly explicit is because I wanted to make sure I have the semantic correct. But, in its initial form, it looked like you suggested. Thank you."}, {"owner": {"reputation": 277, "user_id": 380252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f0999e58687b0d2153c594616ceafc5c?s=128&d=identicon&r=PG", "display_name": "blue scorpion", "link": "https://stackoverflow.com/users/380252/blue-scorpion"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1451400110, "post_id": 34504803, "comment_id": 56767261, "body": "@Cactus: oh, that&#39;s cool. Thank you."}, {"owner": {"reputation": 277, "user_id": 380252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f0999e58687b0d2153c594616ceafc5c?s=128&d=identicon&r=PG", "display_name": "blue scorpion", "link": "https://stackoverflow.com/users/380252/blue-scorpion"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451400121, "post_id": 34504803, "comment_id": 56767264, "body": "@Zeta: thanks for the efficiency suggestion."}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 277, "user_id": 380252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f0999e58687b0d2153c594616ceafc5c?s=128&d=identicon&r=PG", "display_name": "blue scorpion", "link": "https://stackoverflow.com/users/380252/blue-scorpion"}, "edited": false, "score": 1, "creation_date": 1451399939, "post_id": 34505277, "comment_id": 56767183, "body": "<code>5</code> shouldn&#39;t hang if you used the techniques described above. But the other will take a <b><i>very</i></b> long time, since you&#39;re calculating the same lists over and over. And for <code>10</code>, you&#39;re needing the primes up to <code>2486784401 = 10^9 - 9^10</code>. That&#39;s going to take a while."}, {"owner": {"reputation": 277, "user_id": 380252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f0999e58687b0d2153c594616ceafc5c?s=128&d=identicon&r=PG", "display_name": "blue scorpion", "link": "https://stackoverflow.com/users/380252/blue-scorpion"}, "edited": false, "score": 0, "creation_date": 1451400735, "post_id": 34505277, "comment_id": 56767639, "body": "I realized now that n=4 hanging triggers anything above 5 hanging. Because the case 2^4-4^2 gets tested before k^m-m^k, for any k&gt;2 and m&gt;4. So, yes, you&#39;re right t=0 is the problem. Thank you."}, {"owner": {"reputation": 277, "user_id": 380252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f0999e58687b0d2153c594616ceafc5c?s=128&d=identicon&r=PG", "display_name": "blue scorpion", "link": "https://stackoverflow.com/users/380252/blue-scorpion"}, "edited": false, "score": 0, "creation_date": 1451400909, "post_id": 34505277, "comment_id": 56767731, "body": "About the calculation taking too long: yes I expected that. Also memory consumption was expected to become very large because (at least my understanding was that) Integral types can go to integers as large as memory can hold them. Which was one reason I picked Haskell for this problem."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 2, "creation_date": 1451410347, "post_id": 34505277, "comment_id": 56773084, "body": "<code>Integral</code> just means integer-like.  It&#39;s the specific type <code>Integer</code> that can grow arbitrarily large."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 8, "last_activity_date": 1451368592, "creation_date": 1451368592, "answer_id": 34505277, "question_id": 34504803, "link": "https://stackoverflow.com/questions/34504803/why-is-the-following-haskell-code-hanging/34505277#34505277", "title": "Why is the following Haskell code hanging?", "body": "<p>So, if it hangs for <code>n = 4</code>, what's so special about that case? Well, it's <code>t</code>. For <code>x = 2</code> and <code>y = 4</code>, you will get</p>\n\n<pre><code>t = abs (2 ^ 4 - 4 ^ 2)\n  = abs (16    - 16   )\n  = abs 0\n  = 0\n</code></pre>\n\n<p>Therefore, you use <code>0</code> in <code>is_prime</code>, and thereby also in <code>listprimesupto</code>. This leads to a never ending recursion:</p>\n\n<pre><code>listprimesupto 0 = let halflstprimes = (listprimesupto (0 `div` 2))\n                   in -- .....\n</code></pre>\n\n<p>So make sure that you handle non-positive inputs:</p>\n\n<pre><code>listprimesupto n | n &lt;= 0 = []\n\nis_prime n | n &lt;= 1 = False\n</code></pre>\n"}], "owner": {"reputation": 277, "user_id": 380252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f0999e58687b0d2153c594616ceafc5c?s=128&d=identicon&r=PG", "display_name": "blue scorpion", "link": "https://stackoverflow.com/users/380252/blue-scorpion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1451369130, "creation_date": 1451365983, "last_edit_date": 1451369130, "question_id": 34504803, "link": "https://stackoverflow.com/questions/34504803/why-is-the-following-haskell-code-hanging", "title": "Why is the following Haskell code hanging?", "body": "<p>I'm new to Haskell. I was trying to solve the diophantine equation <em>|x^y-y^x| is prime</em>, using Haskell, for a given upper bound <em>x, y &lt; n</em>.</p>\n\n<p>So, I wrote this Haskell code:</p>\n\n<pre><code>-- list of primes\nlistprimesupto :: Integral a =&gt; a -&gt; [a]\nlistprimesupto 1 = []\nlistprimesupto 2 = [2]\nlistprimesupto n = let halflstprimes = (listprimesupto (n `div` 2))\n                   in halflstprimes++[i|i&lt;-[((n `div` 2)+1)..n], (length [x|x&lt;-halflstprimes, (i `mod` x) == 0])==0 ]\n\n-- is prime?\nis_prime :: Integral a =&gt; a -&gt; Bool\nis_prime 1 = False\nis_prime n = let halflstprimes = (listprimesupto (n `div` 2))\n             in (length [x|x&lt;-halflstprimes, (n `mod` x) == 0])==0           \n\n-- solve |x^y - y^x| == prime\nxy_yx_p :: Integral t =&gt; t -&gt; [(t, t)]\n--xy_yx_p n = [(x,y)|x&lt;-[2..n], y&lt;-[2..n], x &lt; y, (abs (x^y-y^x)) `elem` (listprimesupto (n^3))] -- version 1, works but upper limit too small\nxy_yx_p n = [(x,y)|x&lt;-[2..n], y&lt;-[2..n], x &lt; y, (let t=abs (x^y-y^x) in is_prime t)==True] -- version 2, hangs for n&gt;3 ...\n</code></pre>\n\n<p><code>xy_yx_p n</code> (version 2, uncommented) hangs for <em>n</em> > 3, in GHCi. Ctrl-C doesn't even work. I have to kill <code>ghc</code> from Activity Monitor (I'm on Mac).</p>\n\n<p>Any idea what am I doing wrong in <code>xy_yx_p</code>? The other two functions seem to work fine.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell", "exception", "exception-handling"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1451369532, "post_id": 34504238, "comment_id": 56752612, "body": "Why <code>throwError . error</code>?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451375259, "post_id": 34504238, "comment_id": 56754845, "body": "To elaborate on the previous comment, <code>error</code> creates a &quot;bottom value&quot; which corresponds to an <code>Exception</code> which can only by caught by <code>Control.Exception.catch</code> and the like. You must use throwError by supplying the exception <i>directly</i>: <code>throwError $ ErrorCall &quot;...&quot;</code> (of course you should define your own exception type. The source of the exception is not <code>error</code> however, it is somewhere else (impossible to tell without full code) - you can still catch this with something like <code>ErrorT (try $ ...)</code>."}], "owner": {"reputation": 704, "user_id": 864306, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/cc979dfc088d7ca86c02fbfdb5f0fd93?s=128&d=identicon&r=PG", "display_name": "miguel", "link": "https://stackoverflow.com/users/864306/miguel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 228, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1451369447, "creation_date": 1451361779, "last_edit_date": 1451369447, "question_id": 34504238, "link": "https://stackoverflow.com/questions/34504238/handle-connection-reset-by-peer-error-in-haskells-wreq-library", "title": "Handle &quot;Connection reset by peer&quot; error in haskell&#39;s wreq library", "body": "<p>I'm making multiple GET requests using Haskell's <a href=\"https://hackage.haskell.org/package/wreq\" rel=\"nofollow\"><code>wreq</code></a> library. I want to handle connection errors retrying a limited number of times. I thought something like this would work:</p>\n\n<pre><code>getRetried url = retried 0\n    where maxRetries = 2\n          retried retries | retries &gt;= maxRetries = throwError $ error \"number of retries exceeded\" \n                          | otherwise             = catchError (get url) (\\_ -&gt; (putStrLn \"retrying\") &gt;&gt; (retried (retries + 1) ) )\n</code></pre>\n\n<p>but it fails from time to time with the following error:</p>\n\n<pre><code>*** Exception: InternalIOException recv: resource vanished (Connection reset by peer)\n</code></pre>\n\n<p>What am I missing? Isn't <code>catchError</code> the right way to handle errors?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1451341604, "post_id": 34501501, "comment_id": 56745166, "body": "I&#39;m afraid this is just not possible. In general, importing of instances and anything associated with them can&#39;t be controlled cleanly. The idea being: a class immedately brings with it <i>all</i> instances and associated types. But, prove me wrong \u2013 it certainly would make sense if this scenario were properly supported somehow."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1451346438, "post_id": 34501501, "comment_id": 56746811, "body": "@leftaroundabout, since Haskell modules are all about name control, being unable to import specific names is a serious mission failure."}, {"owner": {"reputation": 685, "user_id": 3222117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uEbIs.jpg?s=128&g=1", "display_name": "Alexandre Lucchesi", "link": "https://stackoverflow.com/users/3222117/alexandre-lucchesi"}, "edited": false, "score": 0, "creation_date": 1451370832, "post_id": 34501501, "comment_id": 56753089, "body": "I noticed that the data structures are being defined inside the instance declaration (the <code>data</code> keyword is right after the <code>where</code>)... Is there any particular reason for that? Could this be causing the errors?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451375246, "post_id": 34501501, "comment_id": 56754841, "body": "Can you just re-export <code>Route</code> in <code>Yesod.Crud</code>?"}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 685, "user_id": 3222117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uEbIs.jpg?s=128&g=1", "display_name": "Alexandre Lucchesi", "link": "https://stackoverflow.com/users/3222117/alexandre-lucchesi"}, "edited": false, "score": 1, "creation_date": 1451394482, "post_id": 34501501, "comment_id": 56764153, "body": "@alexandrelucchesi That&#39;s how associated data families work. Everything works fine except for the <code>import</code> statement."}, {"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 1, "creation_date": 1451971489, "post_id": 34501501, "comment_id": 56954935, "body": "You haven&#39;t shown us how you&#39;re exporting stuff from your <code>Yesod.Crud</code> module. If you just have something like <code>module Yesod.Crud (RenderRoute(..)) where ...</code> then you won&#39;t be exporting the data constructors you want. But something like <code>module Yesod.Crud (RenderRoute(..), Route (..) ) where ...</code> looks like it is supposed to work, according to section 4.3.2 of the <a href=\"https://wiki.haskell.org/GHC/Type_families#Import_and_export\" rel=\"nofollow noreferrer\">manual</a> on type families. I haven&#39;t tried this myself btw, just throwing out a possible suggestion."}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 256, "favorite_count": 1, "answer_count": 0, "score": 5, "last_activity_date": 1451340496, "creation_date": 1451340496, "question_id": 34501501, "link": "https://stackoverflow.com/questions/34501501/importing-the-data-constructor-of-an-associated-data-type", "title": "Importing the data constructor of an associated data type", "body": "<p>I'm using GHC 7.10.2. There is a typeclass named <code>RenderRoute</code> in <code>yesod</code> that looks like this:</p>\n\n<pre><code>class Eq (Route a) =&gt; RenderRoute a where\n  data Route a\n  renderRoute :: Route a -&gt; ([Text], [(Text, Text)])\n</code></pre>\n\n<p>I have written an instance in a module named <code>Yesod.Crud</code> that looks like this:</p>\n\n<pre><code>data Crud master p c = Crud { ... }\ninstance (PathPiece (Key c), Eq (Key c), PathPiece p, Eq p) =&gt; RenderRoute (Crud master p c) where\n  data Route (Crud master p c)\n    = EditR (Key c)\n    | DeleteR (Key c)\n    | IndexR p\n    | AddR p\n    | ViewR (Key c)\n</code></pre>\n\n<p>If, somewhere else, I import everything with like this</p>\n\n<pre><code>import Yesod.Crud\n</code></pre>\n\n<p>then the five data constructors belonging to my associated data type are in scope. I'm trying to figure out how to write the import statement in a more restrictive way. Let's say that I only want to bring <code>ViewR</code> into scope (and probably the data type <code>Crud</code> as well). If I try </p>\n\n<pre><code>import Yesod.Crud (ViewR)\n</code></pre>\n\n<p>Then GHC errors with the following:</p>\n\n<pre><code>src/Import/Base.hs:9:55:\n    In module \u2018Yesod.Crud\u2019:\n      \u2018ViewR\u2019 is a data constructor of \u2018Route\u2019\n    To import it use\n      \u2018import\u2019 Yesod.Crud( Route( ViewR ) )\n    or\n      \u2018import\u2019 Yesod.Crud( Route(..) )\n</code></pre>\n\n<p>If I try the first suggestion, it errors with</p>\n\n<pre><code>src/Import/Base.hs:10:46:\n    Module \u2018Yesod.Crud\u2019 does not export \u2018Route(ViewR)\u2019\n</code></pre>\n\n<p>The second one is also wrong. But, the minor bug in GHC's error message suggestions is not what I'm interested in. What I would like to know is what the right way to do this is. I've already consulted <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/type-families.html\" rel=\"noreferrer\">the manual</a>, and I cannot discern a solution from the explanation of imports it offers.</p>\n"}, {"tags": ["haskell", "recursion", "polymorphism"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1451328380, "post_id": 34498497, "comment_id": 56739455, "body": "The problem is, as far as I know, that for a fixed <code>a</code> you&#39;re trying to use <code>length :: Nested a -&gt; Int</code> (1st inferred) and <code>length :: Nested [a] -&gt; Int</code> (2nd inferred) in the same context. Due to the second inferred type, the type checker will then set length&#39;s overall type to <code>length :: Nested [a] -&gt; Int</code>, which again updates the inner type to <code>length :: Nested [[a]] -&gt; Int</code>; a change on the outer type gets reflected on the inner one. The type checker gives up, since the substitution <code>a ~ [a]</code> would never end."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1451340011, "post_id": 34498497, "comment_id": 56744527, "body": "Type inference does not generalize type variables until the recursion is completely handled. IOW, it searches for a <i>monotype</i> <code>t</code> such that, assuming all the recursive occurrences have type <code>t</code>, the whole function body has type <code>t</code>. After that, roughly, all the variables in <code>t</code> get <code>forall</code>-generalized. Inferring polytypes in the first phase is, IIRC, undecidable, so some compromise is needed to achieve something useful in practice."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1451350420, "post_id": 34498497, "comment_id": 56747832, "body": "The other comments explain why it would be difficult or impossible to implement this, but I also don&#39;t think it would be particularly desirable. Polymorphic recursion tends to be confusing even <i>with</i> type signatures. Without them ... I don&#39;t even want to think about it. I&#39;d be likely to write the signatures first and use typed holes to work out the terms."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 2, "creation_date": 1451368918, "post_id": 34498497, "comment_id": 56752434, "body": "<a href=\"https://en.wikipedia.org/wiki/Polymorphic_recursion\" rel=\"nofollow noreferrer\">Type inference for polymorphic recursion is equivalent to semi-unification and therefore undecidable and requires the use of a semi-algorithm or programmer supplied type annotations.</a>"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1451378085, "post_id": 34498497, "comment_id": 56755976, "body": "Is there any GHC extension(s) that would make this code typecheck? If they are, do they make typechecking a possibly non-terminating procedure?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1451431167, "post_id": 34498497, "comment_id": 56782789, "body": "@arrowd No extension necessary. Just put a type signature on it."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1451459015, "post_id": 34498497, "comment_id": 56790578, "body": "@Carl I meant, is there extension that would make typechecker infer the type even without explicit signature."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1451479302, "post_id": 34498497, "comment_id": 56800630, "body": "@arrowd No. Inferring polymorphic recursion is undecidable. Checking it is easy."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1451488560, "post_id": 34498497, "comment_id": 56805619, "body": "@Carl It is undecidable in general. Does that mean that types can&#39;t be inferred for any (and this particular) polymorphic recursive function?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1451511467, "post_id": 34498497, "comment_id": 56817327, "body": "@arrowd You could add some complex heuristics to cover some small portion of cases. Or you could just say &quot;put a type signature on it, and it all just works&quot;.  The latter seems like a much better use of everyone&#39;s time.  Do you really want to debug why the heuristics didn&#39;t let it infer in your case as a user of GHC?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1473404156, "post_id": 34498497, "comment_id": 66136315, "body": "@Carl, if someone wants to write such a heuristic, it could potentially be used to improve GHC&#39;s type errors in some cases."}], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 309, "favorite_count": 2, "answer_count": 0, "score": 4, "last_activity_date": 1473400105, "creation_date": 1451326062, "last_edit_date": 1473400105, "question_id": 34498497, "link": "https://stackoverflow.com/questions/34498497/type-inference-for-polymorphic-recursive-functions", "title": "Type inference for polymorphic recursive functions", "body": "<p>The <a href=\"https://en.wikipedia.org/wiki/Polymorphic_recursion#Nested_datatypes\" rel=\"nofollow\">Polymorphic recursion</a> page on Wikipedia gives following example where Haskell's type checker fails to infer type without explicit type annotation:</p>\n\n<pre><code>data Nested a = a :&lt;: (Nested [a]) | Epsilon\n\nlength Epsilon    = 0\nlength (_ :&lt;: xs) = 1 + length xs\n</code></pre>\n\n<p>When compiling this code, GHC says:</p>\n\n<pre><code>Occurs check: cannot construct the infinite type: t ~ [t]\nExpected type: Nested t\n  Actual type: Nested [t]\nRelevant bindings include\n  xs :: Nested [t]\n  length :: Nested t -&gt; a\n</code></pre>\n\n<p>I understand how <code>t</code> becomes <code>[t]</code>, but I don't see why it is a problem for a typechecker. If we let <code>length</code> be <code>Nested t -&gt; a</code> and then stumbled upon <code>length xs</code> and let it be <code>Nested [t] -&gt; b</code>, why can't we assume that <code>a ~ b</code> and successfully typecheck this? Or the problem is somewhere else?</p>\n"}, {"tags": ["haskell", "yaml"], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 4303358, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xe2hN32yExw/AAAAAAAAAAI/AAAAAAAAAuo/NBcl0wsGWzs/photo.jpg?sz=128", "display_name": "Anton K", "link": "https://stackoverflow.com/users/4303358/anton-k"}, "edited": false, "score": 0, "creation_date": 1455099113, "post_id": 34498446, "comment_id": 58333574, "body": "Thanks. I&#39;ve read this already, but hoped there&#39;s some solution for the problem. Guess not. Hope Michael would eventually work on YamlBuilder and YamlParser. JSON is just a subset of YAML spec, but unfortunately, yaml package is built on top of Aeson."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 61, "user_id": 4303358, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xe2hN32yExw/AAAAAAAAAAI/AAAAAAAAAuo/NBcl0wsGWzs/photo.jpg?sz=128", "display_name": "Anton K", "link": "https://stackoverflow.com/users/4303358/anton-k"}, "edited": false, "score": 0, "creation_date": 1455101610, "post_id": 34498446, "comment_id": 58335265, "body": "@AntonK: To be honest, I doubt that a future version of <code>yaml</code> won&#39;t depend on <code>aeson</code> and its <code>Value</code> type. You could <a href=\"https://github.com/snoyberg/yaml/issues\" rel=\"nofollow noreferrer\">add an issue</a> to ask for an enhancement, but since this will break most of the existing code, I don&#39;t think that this will be implemented. :/"}, {"owner": {"reputation": 61, "user_id": 4303358, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xe2hN32yExw/AAAAAAAAAAI/AAAAAAAAAuo/NBcl0wsGWzs/photo.jpg?sz=128", "display_name": "Anton K", "link": "https://stackoverflow.com/users/4303358/anton-k"}, "edited": false, "score": 0, "creation_date": 1455259020, "post_id": 34498446, "comment_id": 58419050, "body": "Of course it won&#39;t (and shouldn&#39;t, really). I&#39;m talking about improvements to YamlBuilder and Parser that would support full Yaml spec, not just JSON subset. Parser does support that, AFAIK, but not builder."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 1, "last_activity_date": 1451325816, "creation_date": 1451325816, "answer_id": 34498446, "question_id": 34497814, "link": "https://stackoverflow.com/questions/34497814/how-to-make-aliases-with-yaml-library-in-haskell/34498446#34498446", "title": "How to make aliases with yaml library in Haskell?", "body": "<p>Unfortunately, the current <code>yaml</code> version only understands aliases during parsing. It doesn't safe them in its <a href=\"https://hackage.haskell.org/package/yaml-0.8.15.2/docs/Data-Yaml.html#t:Value\" rel=\"nofollow\"><code>Value</code></a>, since it uses <code>Data.Aeson.Value</code> to store YAML values.</p>\n\n<p>Per <a href=\"https://hackage.haskell.org/package/yaml-0.8.15.2/docs/Data-Yaml.html\" rel=\"nofollow\"><code>yaml-0.8.15.2</code>'s description:</a></p>\n\n<blockquote>\n  <p>For the most part, YAML content translates directly into JSON, and therefore there is very little data loss. <strong><em>If you need to deal with YAML more directly (e.g., directly deal with aliases), you should use the <a href=\"https://hackage.haskell.org/package/yaml-0.8.15.2/docs/Text-Libyaml.html\" rel=\"nofollow\">Text.Libyaml</a> module instead.</em></strong> [emphasis mine]</p>\n</blockquote>\n\n<p>This means that you have to use the <code>Text.Libyaml.Event</code> interface and walk through the events yourself.</p>\n"}], "owner": {"reputation": 61, "user_id": 4303358, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xe2hN32yExw/AAAAAAAAAAI/AAAAAAAAAuo/NBcl0wsGWzs/photo.jpg?sz=128", "display_name": "Anton K", "link": "https://stackoverflow.com/users/4303358/anton-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 34498446, "answer_count": 1, "score": 1, "last_activity_date": 1451325816, "creation_date": 1451323125, "question_id": 34497814, "link": "https://stackoverflow.com/questions/34497814/how-to-make-aliases-with-yaml-library-in-haskell", "title": "How to make aliases with yaml library in Haskell?", "body": "<p>I'm using YAML for configuration files and already have all required ToJSON/FromJSON instances for my data types. All good, except there're a lot of repetitive fields, so I'd like to automatically make aliases for them (and replacing all further occurrences of them with aliases) during export.</p>\n\n<p>Instead of</p>\n\n<pre><code>- security:\n    security_level: authNoPriv\n    auth_password: ! 'mypassword'\n    username: myuser\n    auth_protocol: MD5\n    private_protocol: None\n    private_password: None\n- security:\n    security_level: authNoPriv\n    auth_password: ! 'mypassword'\n    username: myuser\n    auth_protocol: MD5\n    private_protocol: None\n    private_password: None\n  ...\n</code></pre>\n\n<p>I'd like to get</p>\n\n<pre><code>- security: &amp;securityAlias1\n    security_level: authNoPriv\n    auth_password: ! 'mypassword'\n    username: myuser\n    auth_protocol: MD5\n    private_protocol: None\n    private_password: None\n- security: *securityAlias1\n  ...\n</code></pre>\n\n<p>How to achieve this in Haskell?</p>\n"}, {"tags": ["haskell", "functional-programming", "frege", "bimap"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 5, "creation_date": 1451320514, "post_id": 34497028, "comment_id": 56735940, "body": "The linked code is just a wrapper around two maps. Why not make a wrapper around a map and a multimap?"}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1451323803, "post_id": 34497028, "comment_id": 56737502, "body": "And if you really only have O(100,000) entries and need speed on add/remove/lookup, you should probably use <code>data N1Bimap a b = N1Bimap !(HashMap a b) !(HashMap b (HashSet a))</code> for some added speed, if your fundamental types are <code>Hashable</code>. (You can automatically derive <code>Hashable</code> in GHC, too.)"}, {"owner": {"reputation": 1308, "user_id": 2746333, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a006d823040407817369ae675172ac39?s=128&d=identicon&r=PG", "display_name": "Dierk", "link": "https://stackoverflow.com/users/2746333/dierk"}, "edited": false, "score": 0, "creation_date": 1451331070, "post_id": 34497028, "comment_id": 56740595, "body": "Thanks for the comment. I&#39;m afraid this is not as efficient as I hoped for since every add/remove in the first map will not only cause a change in the reverse map but a rundown through its value list in O(m) where m is the size of the reverse lookup result size."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 2, "creation_date": 1451331660, "post_id": 34497028, "comment_id": 56740862, "body": "@Dierk: That is why you then use a set/hashset data structure for the reverse map, to get O(log n + log m) removals."}, {"owner": {"reputation": 1308, "user_id": 2746333, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a006d823040407817369ae675172ac39?s=128&d=identicon&r=PG", "display_name": "Dierk", "link": "https://stackoverflow.com/users/2746333/dierk"}, "edited": false, "score": 0, "creation_date": 1451331805, "post_id": 34497028, "comment_id": 56740929, "body": "Ok, yes, overlooked the HashSet. Thanks!"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1451382337, "post_id": 34497028, "comment_id": 56757967, "body": "Even if you cannot hash, you can use Map b (Set a) instead of multimap for faster deletions."}], "owner": {"reputation": 1308, "user_id": 2746333, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a006d823040407817369ae675172ac39?s=128&d=identicon&r=PG", "display_name": "Dierk", "link": "https://stackoverflow.com/users/2746333/dierk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 210, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1451371419, "creation_date": 1451319899, "last_edit_date": 1451371419, "question_id": 34497028, "link": "https://stackoverflow.com/questions/34497028/is-there-a-functional-n1-bimap", "title": "Is there a functional n:1 bimap?", "body": "<p>I have a map where multiple keys can map to the same value. I'd like to do reverse lookups, such that given a value, I get a list of all keys that map to this value. \nNote that unlike \n<a href=\"https://hackage.haskell.org/package/bimap\" rel=\"nofollow\"><code>Data.Bimap</code></a> my map is not 1:1 but <em>n</em> :1. </p>\n\n<p>Also, the reverse lookup should not take <em>O(n)</em> like running through all map entries would require but rather <em>O(log n)</em> or better like with a reverse index. The map will contain many ten-thousands of entries with a high load of add/remove/lookup operations. </p>\n\n<p>Is such a data structure available in functional form (Haskell or Frege preferred)?</p>\n"}, {"tags": ["list", "haskell", "recursion"], "answers": [{"tags": [], "owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "is_accepted": true, "score": 7, "last_activity_date": 1451330103, "last_edit_date": 1451330103, "creation_date": 1451315481, "answer_id": 34495992, "question_id": 34495851, "link": "https://stackoverflow.com/questions/34495851/haskell-algorithm-for-sequence-of-tuples-in-a-list-of-lists/34495992#34495992", "title": "Haskell algorithm for sequence of tuples in a list of lists", "body": "<p>This is simply the list monad, selecting an element from each list non-deterministically.</p>\n\n<p>The function you're looking for is <code>sequence :: Monad m =&gt; [m a] -&gt; m [a]</code> from <code>Control.Monad</code></p>\n\n<pre><code>\u03bb. let as = [(1,2),(3,4)]\n\u03bb. let bs = [(5,6)]\n\u03bb. let cs = [(7,8),(9,10)]\n\u03bb. let xss = [as, bs, cs]\n\u03bb. sequence xss\n  [[(1,2),(5,6),(7,8)]\n  ,[(1,2),(5,6),(9,10)]\n  ,[(3,4),(5,6),(7,8)]\n  ,[(3,4),(5,6),(9,10)]\n  ]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2666, "user_id": 1362167, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/6191685fdb9897c97830ef8bd2f040a1?s=128&d=identicon&r=PG", "display_name": "LeartS", "link": "https://stackoverflow.com/users/1362167/learts"}, "edited": false, "score": 0, "creation_date": 1451316151, "post_id": 34496100, "comment_id": 56733617, "body": "should be <code>ys &lt;- solution xs</code>"}], "tags": [], "owner": {"reputation": 155, "user_id": 5715425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80175d4896bc5afa19d54b0a059ed115?s=128&d=identicon&r=PG&f=1", "display_name": "denys.fridman", "link": "https://stackoverflow.com/users/5715425/denys-fridman"}, "is_accepted": false, "score": 3, "last_activity_date": 1451316181, "last_edit_date": 1451316181, "creation_date": 1451315931, "answer_id": 34496100, "question_id": 34495851, "link": "https://stackoverflow.com/questions/34495851/haskell-algorithm-for-sequence-of-tuples-in-a-list-of-lists/34496100#34496100", "title": "Haskell algorithm for sequence of tuples in a list of lists", "body": "<p>Here's a recursive solution</p>\n\n<pre><code>solution :: [[a]] -&gt; [[a]]\nsolution (x: xs) = [y: ys | y &lt;- x, ys &lt;- solution xs]\nsolution []      = [[]]\n</code></pre>\n\n<p>The idea behind the solution is the following: prepend each element of the head of list to every list you get from recursively computing the result for the tail of the input list.</p>\n"}], "owner": {"reputation": 1512, "user_id": 1153801, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JzItT.jpg?s=128&g=1", "display_name": "SND", "link": "https://stackoverflow.com/users/1153801/snd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 2, "accepted_answer_id": 34495992, "answer_count": 2, "score": 1, "last_activity_date": 1468866902, "creation_date": 1451314903, "last_edit_date": 1468866902, "question_id": 34495851, "link": "https://stackoverflow.com/questions/34495851/haskell-algorithm-for-sequence-of-tuples-in-a-list-of-lists", "title": "Haskell algorithm for sequence of tuples in a list of lists", "body": "<p>I was playing around a bit in Haskell to get familiar with it, but got stuck at the following problem:</p>\n\n<p>I want to define a function that, given a list containing some amount of other lists, each containing 0 or more tuples, creates a new list as following:</p>\n\n<pre><code>*Main&gt; foo \n    [\n      [ (1,2), (3,4)  ],\n      [ (5,6)         ],\n      [ (7,8), (9,10) ]\n    ]\n\n\n  = [\n      [ (1,2), (5,6), (7,8)  ],\n      [ (1,2), (5,6), (9,10) ],\n      [ (3,4), (5,6), (7,8)  ],\n      [ (3,4), (5,6), (9,10) ]\n    ]\n</code></pre>\n\n<p>So, in other words, the function should compose a list with every tuple from the first list combined with in each case one of the other tuples in the N remaining lists.</p>\n\n<p>I was trying to write a recursive algorithm for this, but can't wrap my head around dealing with the N amount of other lists to combine tuples with. For just two lists of tuples, I would write something like:</p>\n\n<pre><code>composeList [] _        = []\ncomposeList (x:xs) list = composeTuples x list ++ composeList xs list\n\ncomposeTuples _ []     = []\ncomposeTuples t (x:xs) = [t,x] : composeTuples t xs\n</code></pre>\n\n<p>This gives me:</p>\n\n<pre><code>*Main Data.List&gt; composeList [(1,2),(3,4)] [(5,6),(7,8)]\n\n    [\n      [ (1,2), (5,6) ],\n      [ (1,2), (7,8) ],\n      [ (3,4), (5,6) ],\n      [ (3,4), (7,8) ]\n    ]\n</code></pre>\n\n<p>Though I can't seem to put the pieces together and make it work for any number of lists, each with any (>=0) number of tuples.</p>\n\n<p>I'm both interested in solving this issue with some of Haskell's predefined functions (if possible), as well as with a somewhat similar approach as the one I was going for in the example above.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["haskell", "types", "monads", "states"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1451315465, "post_id": 34494893, "comment_id": 56733289, "body": "The type variable can be seen as some &quot;unique tag&quot; - imagine each new reference you create gets tagged with an arbitrary unique value (could be a natural number) indicating which state thread it was created in - then the mixing of references from different state threads would be prohibited by the typechecker seeing these types differ. The &quot;unique&quot; part is accomplished by the fact that in the type of <code>runST :: forall a . (forall s . ST s a) -&gt; a</code> the <code>s</code> cannot escape the scope the inner forall, so no two <code>s</code>s from two different <code>runST</code>s can unify."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1451317436, "post_id": 34494893, "comment_id": 56734309, "body": "<code>s</code> is a <i>phantom</i> variable. No term is ever given that type."}], "answers": [{"comments": [{"owner": {"reputation": 185, "user_id": 2292040, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9bc998bf2e47133277207c93ddf2746a?s=128&d=identicon&r=PG&f=1", "display_name": "user2292040", "link": "https://stackoverflow.com/users/2292040/user2292040"}, "edited": false, "score": 0, "creation_date": 1451464132, "post_id": 34495410, "comment_id": 56792659, "body": "Thank you, too four your answer. It nicely complements the explanations above."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 7, "last_activity_date": 1451314456, "last_edit_date": 1451314456, "creation_date": 1451313087, "answer_id": 34495410, "question_id": 34494893, "link": "https://stackoverflow.com/questions/34494893/how-to-understand-the-state-type-in-haskells-st-monad/34495410#34495410", "title": "How to understand the state type in Haskell&#39;s ST monad", "body": "<p>I would avoid interpreting <code>s</code> as anything concrete at all. It's basically just a &ldquo;unique identifier&rdquo; which ensures that the state in two different <code>ST</code> computations isn't mixed up. In particular, because the argument to <code>runST</code> is a (rank-2) polymorphic action, any state reference that you could somehow smuggle out of this monadic action would necessarily be a existential type, and there's basically nothing you can do with an unconstrained existential. So it's impossible to e.g. refer to a value in the state monad that doesn't actually exist anymore.</p>\n\n<p>If you want to see <code>s</code> as something concrete, consider it as the type of a <em>world</em> in which stateful values can be allocated, modified and deleted.</p>\n\n<p>Explanation of the types in that setting:</p>\n\n<ul>\n<li><code>newVar   :: \u2200 s a. a -&gt; ST s (MutVar s a)</code>: on any world <code>s</code>, I'm able to toss a value of type <code>a</code> to the ground, so it can then be mangled via the <code>MutVar</code> reference (of course, only within the same world &ndash; though the <em>state</em> of this world thereby changes, but it's type / identity doesn't).</li>\n<li><code>readVar  :: \u2200 s a. MutVar s a -&gt; ST s a</code>: if the mutable reference lives in the same world as I do, I'm able to look at the object and give you a copy as the monadic result.</li>\n<li><code>writeVar :: \u2200 s a. MutVar s a -&gt; a -&gt; ST s ()</code>: if the mutable reference lives in the same world as I do, I'm able to destroy the object sitting there and replace it with something else.</li>\n<li><code>runST    :: \u2200   a. (\u2200 s. ST s a) -&gt; a</code>: given an action that works on any world, I'm able to select some hidden planet nobody knows about. The action may then apply all kinds of mutating atrocities to the landscape and bring back only the result. Because nobody knew the planet, we still have a universe that, for all everybody can see, is unscathed and purely functional, but you do get the result of the destructive computation.</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1451328996, "post_id": 34497569, "comment_id": 56739728, "body": "I think it bears mentioning that the <code>s</code> itself is not the type of the hypothetical thread state, but (even in GHC&#39;s unfortunate model) only a phantom tag for that. Specifically, <code>newtype ST s a = ST (State# s -&gt; (# State# s, a #))</code>. The <code>State#</code> type is altogether pretend, but <code>s</code> is a phantom variable of it. In a hypothetical new implementation, <code>State#</code> wouldn&#39;t exist, and everything would probably be done with some sort of operational/codensity monad."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451352475, "post_id": 34497569, "comment_id": 56748355, "body": "@dfeuer I&#39;m going to call that point out more explicitly; it&#39;s in there but I could be more forceful about it."}, {"owner": {"reputation": 185, "user_id": 2292040, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9bc998bf2e47133277207c93ddf2746a?s=128&d=identicon&r=PG&f=1", "display_name": "user2292040", "link": "https://stackoverflow.com/users/2292040/user2292040"}, "edited": false, "score": 0, "creation_date": 1451463791, "post_id": 34497569, "comment_id": 56792493, "body": "Thank you for your detailed answer. I have read in several times and it helped me a lot. :-)"}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": true, "score": 10, "last_activity_date": 1451352629, "last_edit_date": 1451352629, "creation_date": 1451322099, "answer_id": 34497569, "question_id": 34494893, "link": "https://stackoverflow.com/questions/34494893/how-to-understand-the-state-type-in-haskells-st-monad/34497569#34497569", "title": "How to understand the state type in Haskell&#39;s ST monad", "body": "<blockquote>\n  <p>The explanation is fine, but I wonder how it maps to the final definition of the required type.</p>\n</blockquote>\n\n<p>Okay, so let's back <strong>way</strong> up to what we're trying to do, and how it differs from what we can already do.</p>\n\n<h1>Functional state threading</h1>\n\n<p>We can <em>already do</em> functional state. This is done with the <code>State s</code> monad, where <code>State s x :: *</code> is isomorphic to the function type <code>s -&gt; (x, s)</code>: functions which take <code>s</code> as an input and return a pair containing both some value of type <code>x</code> for the monad and also a new state of type <code>s</code>. With some weak typing we could even just use a <code>Data.Map.Strict(Map)</code> to handle these values. For example the basic JavaScript weakly typed system has historically been enough to enable most general computation and it looks something like (omitting functions, which turn out to also be objects and have things like lexical closures to model):</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>data JSVariable = Undefined | Number Double | Str String | Boolean Bool | Null | \n    Object (Map String JSVariable)\n</code></pre>\n\n<p>With these we might use the <code>State (Map String JSVariable)</code> monad to store a functional namespace by which we can refer to variables, initialize them to values, and manipulate them in a state thread. And then we have a function of type</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>runState :: State s x -&gt; s -&gt; (x, s)\n</code></pre>\n\n<p>which we can fill in and also truncate to get:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>fst . flip runState Map.empty :: State (Map a b) x -&gt; x\n</code></pre>\n\n<p>More generally we might immediately be able to generalize this to make the <code>Map</code> be a <code>Monoid</code> or something.</p>\n\n<h2>How is <code>ST</code> different?</h2>\n\n<p>First off, <code>ST</code> wants to <strong>mutate</strong> an underlying data structure -- the above did not <em>mutate</em> the Map, but created a <em>new</em> Map which got passed on to the next thread. So for example if we write the equivalent of the paper's <code>let v = runST (newVar True) in runST (readVar v)</code> we have no ambiguity above because no matter how you slice it, the data structure that you get from the equivalent of <code>newVar True</code> is only a frozen-in-time snapshot of the state, not the full mutable state itself! There is no mutable state in the <code>State s</code> monad.</p>\n\n<p>In order to maintain the facade of a distinct namespaced state (rather than some sort of global state) we keep the notion of an <code>ST s</code> monad, but now we <strong>do not give you direct access</strong> to that <code>s</code>. This means that <code>s</code> is something called a <strong>phantom type</strong>: it does not represent <em>anything</em> concrete that you can hold onto, the only value you will ever get of type <code>s</code> is <code>undefined :: s</code>, and even then, only if you consciously choose to make it.</p>\n\n<p>Since we never will give you a value of type <code>s</code> there is no point to you ever having functions which do anything with it; for you, it will <em>always</em> be a type variable to be filled in by the underlying plumbing. (Let's not get into what exactly the plumbing does.)</p>\n\n<p>Second, <code>ST</code> therefore allows a much greater range of type safety than the above weakly-typed system! We can now have each <code>newVar :: x -&gt; ST s (MutVar s x)</code> return an encapsulated reference of this type <code>MutVar s x</code>. This reference contains a pointer to the state that it lives in, so it will never make sense in any other context -- and it also has its own distinct type <code>x</code>, so it can already hold any type, and it can be rigorously type-checked.</p>\n\n<h1>Now there be dragons</h1>\n\n<p>So we've started with the <strong>general idea</strong> of what we want to achieve: we want to be able to define threads of type <code>ST s x</code>, where <code>s</code> is in general left as a type variable but <code>x</code> is a value that we are interested in computing, and then eventually we should be able to plug them into a function which looks like:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>runST' ::  \u2200 s a. (ST s a) -&gt; a\n</code></pre>\n\n<p>This idea \"smells right\" because it (a) is analogous to something similar in the <code>State s</code> monad, and (b) you should be able to take an <code>ST s a</code>, cook up a blank state for it, and then run the computation to return a purely functional <code>a</code>.</p>\n\n<p>But... there is a <em>problem</em>. The problem is that at this point in the paper we have several functions like <code>newVar :: x -&gt; ST s (MutVar s x)</code> which copy the internal threaded state type <code>s</code> into the \"output\" space of this monad. Even though we do not get a <em>value of type</em> <code>s</code> we still get the <em>type variable</em> <code>s</code>, which as you'll recall is some sort of general namespace for some chunk of mutable state. Other functions like <code>readVar :: MutVar s x -&gt; ST s x</code> will then let you create other state threads which depend on this specific mutable state. </p>\n\n<p>So that's the key word: <strong>specific</strong>. The type of <code>newVar :: x -&gt; ST s (MutVar s x)</code> contains a <em>nonspecific</em> or <em>general</em> <code>s</code>, it will work for any <code>s</code>. But if you <code>runST (newVar True)</code> you get a <code>MutVar s Bool</code> for some <em>specific</em> <code>s</code>, the one that was used in the computation. We want to make sure that <code>runST</code> only takes <em>general</em> <code>s</code>'s and not <em>specific</em> ones.</p>\n\n<p>Put another way, <code>newVar</code> has type <code>x -&gt; forall s. ST s (MutVar s x)</code> (see the <code>forall</code> that forces the variable to still be free?) while <code>readVar</code> has type <code>MutVar s x -&gt; ST s x</code> (no <code>forall</code> -- by itself, or with a specific <code>MutVar</code> from another computation, this has a specific <code>s</code> to it). The <code>s</code> only transitions from being specific to general if for every <code>readVar</code> we also include the <code>newVar</code> that generated the object passed to <code>readVar</code>, to get that <code>forall s</code> that keeps the term general!</p>\n\n<p>So the paper's essential problem is: <strong>how do we redefine <code>ST</code> to make sure that the state is not specific?</strong> It has to be the case that what comes out of <code>readVar</code> <strong>cannot</strong> be fed to <code>runST</code> but what comes out of <code>newVar True</code> and even what comes out of <code>newVar True &gt;&gt;= readVar</code> can both typecheck when fed to <code>runST</code>.</p>\n\n<p>And their answer is, we <em>add to the syntax of Haskell</em>, saying \"this type variable must still be a free type variable!\" This is done by writing <code>runST :: forall x. (forall s. ST s x) -&gt; x</code>. Notice that the <code>forall s.</code> is now contained <strong>within the function argument</strong> to say \"hey, this parameter has to be a general, free type parameter in this expression.\"</p>\n\n<p>This blocks the parallel-thread crap from type-checking and therefore makes the whole system correct.</p>\n"}], "owner": {"reputation": 185, "user_id": 2292040, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9bc998bf2e47133277207c93ddf2746a?s=128&d=identicon&r=PG&f=1", "display_name": "user2292040", "link": "https://stackoverflow.com/users/2292040/user2292040"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1629, "favorite_count": 3, "accepted_answer_id": 34497569, "answer_count": 2, "score": 5, "last_activity_date": 1451371156, "creation_date": 1451311034, "last_edit_date": 1451371156, "question_id": 34494893, "link": "https://stackoverflow.com/questions/34494893/how-to-understand-the-state-type-in-haskells-st-monad", "title": "How to understand the state type in Haskell&#39;s ST monad", "body": "<p>Jones and Launchbury described in their <a href=\"http://www.researchgate.net/profile/Simon_Peyton_Jones/publication/2295326_Lazy_Functional_State_Threads/links/0046351edd5bb96287000000.pdf\" rel=\"nofollow\">paper</a> \"Lazy Functional State Threads\" the ST monad. To\nensure that mutable variables can't be used outside the context (or \"thread\") they have been created\nin, they use special types, including one of higher rank. Here four important examples:</p>\n\n<pre><code>newVar   :: \u2200 s a. a -&gt; ST s (MutVar s a)\nreadVar  :: \u2200 s a. MutVar s a -&gt; ST s a\nwriteVar :: \u2200 s a. MutVar s a -&gt; a -&gt; ST s ()\nrunST    :: \u2200   a. (\u2200 s. ST s a) -&gt; a\n</code></pre>\n\n<p>In order to get the idea behind that construction I read the first two sections of the paper. The\nfollowing explanation seems to be central:</p>\n\n<blockquote>\n  <p>Now, what we really want to say is that <code>newST</code> should only be applied to a state transformer which uses <code>newVar</code> to create any references which are used in that thread. To put it another way, the argument of <code>runST</code> should not make any assumptions about what has already been allocated in the initial state. That is, <code>runST</code> should work regardless of what initial state it is given. So the type of <code>runST</code> should be: <code>runST :: \u2200 a. (\u2200 s. ST s a) -&gt; a</code></p>\n</blockquote>\n\n<p>The explanation is fine, but I wonder how it maps to the final definition of the required type. My\nproblem is that I don't know how to interpret the type variable <code>s</code>. As stated in Section 1, a state\nis essentially a mapping from variables to values. But what is a state type <code>s</code>? In what can a state\ntype <code>s</code> differ from another one <code>t</code>? For me there are two possibilities:</p>\n\n<p>(1) The type <code>s</code> can be seen as the concrete type for a mapping of variables such as lists, arrays\nand sequences can be seen as concrete types for sequential collections. (I intentionally avoid here\nthe words \"class\" and \"implementation\" as there is no class restriction on the type of <code>s</code>.)</p>\n\n<p>(2) The type <code>s</code> can be seen as a concrete value, i.e. a concrete state, i.e. a concrete mapping of\nvariables.</p>\n\n<p>Interpretation (2) maps nicely to Jones' and Launchbury's explanation of the type of <code>runST</code>. The\nall-quantification expresses the independence of the actual state (which is fully described by the\nstate type). The flaw in this interpretation is however the type of <code>writeVar</code>. As it clearly\nmodifies the state, it should be of type <code>\u2200 s a. MutVar s a -&gt; a -&gt; ST t ()</code>. So this\ninterpretation must be false.</p>\n\n<p>Interpretation (1) however is not really better because it doesn't map to Jones' and Launchbury's\nexplanation. The type <code>\u2200 s a. ST s a -&gt; a</code> for <code>runST</code> would be fine. The important thing is that\nthere mustn't be any assumption about the concrete value of the state (of type <code>s</code>) which is given\nto the function. Hence the all-quantification shouldn't be over the state type but (instead) over\nthe concrete value of the state. The type system must express that the result of the stateful\naction, which is given to <code>runST</code>, is independent of the state (but not independent of its type).</p>\n\n<p>Hence both of my interpretations are false. I really tried to understand everything of this type\nconstruction. Is there someone who can explain that to me?</p>\n\n<p>PS. I have already read the thread\n[<a href=\"https://stackoverflow.com/questions/12468622/how-does-the-st-monad-work]\">How does the ST monad work?</a> but it didn't help me. When\nI do the unification algorithm with my hand I see, that the mechanism works and how it works (by\nusing the limits of scopes) but I really want to understand it \u2013 not just see that it works.</p>\n"}, {"tags": ["haskell", "proxy", "haskell-wai"], "answers": [{"comments": [{"owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "edited": false, "score": 0, "creation_date": 1451313044, "post_id": 34494426, "comment_id": 56732078, "body": "I can see how <code>IO Application</code> can make sense. Imagine, it&#39;s an <code>Application</code> that is being returned as a result of an IO action, which looks quite like my case: <code>waiProxyTo</code> here is a sort of an app generator that depends on a <code>manager</code> which in turn is a result of an IO somehow. Can&#39;t it be that way?"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1451317460, "post_id": 34494426, "comment_id": 56734323, "body": "I think the real point is that <code>a -&gt; IO b</code> is isomorphic to <code>IO (a -&gt; IO b)</code>. Any value of one of those types can be converted to the other. If you have <code>wibble :: a -&gt; IO b</code> and <code>wobble :: IO (a -&gt; IO b)</code>, <code>return wibble</code> gets you going forward and <code>(wobble &gt;&gt;=) . flip id</code> gets you going backward. (And of the two, <code>a -&gt; IO b</code> is generally easier to work with, in e.g. situations like this one, although that&#39;s a subjective preference. The fewer monadic blankets you have to climb out of to peek your head out the better, I say.)"}, {"owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1451319037, "post_id": 34494426, "comment_id": 56735185, "body": "@haoformayor, does this mean that <code>proxyApp :: IO Application</code> should really be the same thing as <code>proxyApp :: Application</code>? Removing <code>IO</code> makes compiler upset at the line where I call <code>HC.newManager</code> and bind it with the following message <code>Couldn&#39;t match type \u2018IO b0\u2019 with \u2018Request                         -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived\u2019. Expected type: IO HC.Manager -&gt; (HC.Manager -&gt; IO b0) -&gt; Application. Actual type: IO HC.Manager -&gt; (HC.Manager -&gt; IO b0) -&gt; IO b0</code>... I wonder how long does it take to start making sense of these :-)"}, {"owner": {"reputation": 669, "user_id": 3714434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06a65866e8ef0ee97ab4cd4c4ffaadc6?s=128&d=identicon&r=PG&f=1", "display_name": "ibotty", "link": "https://stackoverflow.com/users/3714434/ibotty"}, "edited": false, "score": 0, "creation_date": 1451325440, "post_id": 34494426, "comment_id": 56738226, "body": "Maybe my answer is unclear. I&#39;ll try to clarify it in a moment."}], "tags": [], "owner": {"reputation": 669, "user_id": 3714434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06a65866e8ef0ee97ab4cd4c4ffaadc6?s=128&d=identicon&r=PG&f=1", "display_name": "ibotty", "link": "https://stackoverflow.com/users/3714434/ibotty"}, "is_accepted": false, "score": 1, "last_activity_date": 1451328149, "last_edit_date": 1451328149, "creation_date": 1451309216, "answer_id": 34494426, "question_id": 34493717, "link": "https://stackoverflow.com/questions/34493717/io-monad-issues-when-trying-to-implement-wai-http-server-fallback-proxy/34494426#34494426", "title": "IO monad issues when trying to implement WAI HTTP Server + Fallback Proxy", "body": "<p>The <code>IO</code> in <code>IO Application</code> is kind-of redundant. Note that</p>\n\n<pre><code>type Application = Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived\n</code></pre>\n\n<p>so, expanding <code>proxyApp</code>'s arguments (what you already do in <code>proxyStubApp</code>), you get</p>\n\n<pre><code>proxyApp :: Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived\nproxyApp req continuation = do\n     manager &lt;- HC.newManager HC.defaultManagerSettings\n     waiProxyTo (...) req respond\n</code></pre>\n\n<p>That works, because in either case</p>\n\n<pre><code>proxyApp :: IO Application\nproxyApp = do\n   manager &lt;- HC.newManager ...\n   ...        \n</code></pre>\n\n<p>and</p>\n\n<pre><code>proxyApp :: Request -&gt; (Response -&gt; IO ResponseReceived) -&gt; IO ResponseReceived\nproxyApp req continuation = do\n   manager &lt;- HC.newManager ...\n   ...\n</code></pre>\n\n<p>the IO action <code>HC.newManager ...</code> is \"run within <code>IO</code>\".</p>\n\n<p>You may find it conceptually clearer to construct an <code>Application</code> in <code>IO</code> and hand it to some other place, and I won't argue with you. I want to note though, that you choose the <code>Application</code> based on the <code>Request</code>, so in a way you are in the hypothetical HTTP monad when choosing, so <code>lookupServeFunction</code>'s signature <code>Request -&gt; Application</code> makes more sense to me.</p>\n\n<p>If you want to keep that type signature for <code>proxyApp</code>, \n<code>lookupServeFunction</code> and <code>app</code> will have to be in <code>IO</code> as well and <code>main</code> will have to change accordingly, e.g.</p>\n\n<pre><code>myApp &lt;- app\n...\n</code></pre>\n\n<p>As haoformayor said, It is generally easier to work without the outer <code>IO</code> layer.</p>\n\n<hr>\n\n<p>You might also like to simplify <code>main</code>.</p>\n\n<pre><code>fmap logStdoutDev (return app)\n</code></pre>\n\n<p>is the same as</p>\n\n<pre><code>return (logStdoutDev app)\n</code></pre>\n\n<p>and\n    run 3011 =&lt;&lt; return (logStdoutDev app)</p>\n\n<p>is the same as</p>\n\n<pre><code>run 3011 (logStdoutDev app)\n</code></pre>\n\n<p>You might want to install hlint, which will help you spot these.</p>\n"}], "owner": {"reputation": 1364, "user_id": 4883788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Z9NZQ.jpg?s=128&g=1", "display_name": "SkyWriter", "link": "https://stackoverflow.com/users/4883788/skywriter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1451328149, "creation_date": 1451306393, "last_edit_date": 1451307295, "question_id": 34493717, "link": "https://stackoverflow.com/questions/34493717/io-monad-issues-when-trying-to-implement-wai-http-server-fallback-proxy", "title": "IO monad issues when trying to implement WAI HTTP Server + Fallback Proxy", "body": "<p>What I'm trying to do is to create a somewhat smart reverse proxy server that should process some requests on its own and forward the others to the backend of choice. To make it challenging I'm trying hard to do it in Haskell, which I am a total newbie in.</p>\n\n<p>Here's the code I've come up so far:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Control.Applicative\nimport Data.ByteString\nimport Network.HTTP.ReverseProxy\nimport Network.HTTP.Types\nimport Network.Wai\nimport Network.Wai.Handler.Warp\nimport Network.Wai.Middleware.RequestLogger\nimport qualified Network.HTTP.Client as HC\n\nhelloApp :: Application\nhelloApp req respond =\n  respond $ responseLBS status200 [(\"Content-Type\", \"text/plain\")] \"Hello\"\n\nproxyStubApp :: Application\nproxyStubApp req respond =\n  respond $ responseLBS status200 [(\"Content-Type\", \"text/plain\")] \"You've hit the stub\"\n\nproxyApp :: IO Application\nproxyApp = do\n  manager &lt;- HC.newManager HC.defaultManagerSettings\n  return $ waiProxyTo (const $ return $ WPRProxyDest ProxyDest { pdHost = \"localhost\", pdPort = 9393 }) defaultOnExc manager\n\napp :: Application\napp req respond =\n  serve req respond\n    where serve = lookupServeFunction req\n\nlookupServeFunction :: Request -&gt; Application\nlookupServeFunction req\n  | isInfixOf \"sample_path\" (rawPathInfo req) = proxyStubApp\n  | otherwise                                 = helloApp\n\nmain = run 3011 =&lt;&lt; (logStdoutDev &lt;$&gt; return app)\n</code></pre>\n\n<p>It works fine, but when I exchange <code>proxyStubApp</code> for actual <code>proxyApp</code> I am forced to add <code>IO</code> all over the place. Particularly it gets added to <code>app</code>, consequently leaving me with the following compilation error message:</p>\n\n<pre><code>Couldn't match expected type \u2018Request -&gt; t5 -&gt; t4\u2019\n            with actual type \u2018IO Application\u2019\nThe equation(s) for \u2018app\u2019 have two arguments,\nbut its type \u2018IO Application\u2019 has none\n</code></pre>\n\n<p>I feel like I understand why it is happening, but I'm out of ideas of how to cope with it :( Or am I doing something totally wrong?</p>\n\n<p>Thank you!</p>\n\n<p>P.S. Here are the dependencies should you want to compile the thing on your own: <code>wai warp http-types text bytestring wai-extra time http-reverse-proxy http-client</code></p>\n"}, {"tags": ["haskell", "cabal", "haskell-lens"], "comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1451302558, "post_id": 34492664, "comment_id": 56727211, "body": "<code>Cabal</code> 1.23.0.0 is a development version, so your installation might be in very inconsistent state, there was development related ti package keys in particular. Is this happening inside a fresh sandbox?"}, {"owner": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1451302689, "post_id": 34492664, "comment_id": 56727274, "body": "@phadej it&#39;s not sandbox, do you think it&#39;s related recent cabal updates?"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1451303154, "post_id": 34492664, "comment_id": 56727483, "body": "It might be, could you try in the empty sandbox?"}, {"owner": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1451303313, "post_id": 34492664, "comment_id": 56727551, "body": "@phadej do you mean just older cabal.exe or for some reason completely new environment?"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1451304127, "post_id": 34492664, "comment_id": 56727929, "body": "well, both would help. But could you just create a new sandbox and try <code>cabal install trifecta</code> there?"}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1451316156, "post_id": 34492664, "comment_id": 56733619, "body": "Starting a new sandbox in a folder is something like <code>cabal sandbox init</code> if that helps."}], "owner": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 584, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1451302031, "creation_date": 1451302031, "question_id": 34492664, "link": "https://stackoverflow.com/questions/34492664/cabal-error-failed-to-load-interface-for-control-lens-type", "title": "Cabal error: Failed to load interface for `Control.Lens.Type&#39;", "body": "<p>Can't build trifecta-1.5.2</p>\n\n<p>ghc-pkg check shows no borken packages</p>\n\n<p>error:</p>\n\n<pre><code>[ 8 of 13] Compiling Text.Trifecta.Highlight ( src\\Text\\Trifecta\\Highlight.hs, dist\\build\\Text\\Trifecta\\Highlight.o )\n\nsrc\\Text\\Trifecta\\Highlight.hs:73:1:\n    Failed to load interface for `Control.Lens.Type'\n    no package key matching `lens-4.13-3NqKPNVtlmaitmhxgiGFMb' was found\n    In the type `lens-4.13-3NqKPNVtlmaitmhxgiGFMb:Control.Lens.Type.Lens' c_aJqo HighlightedRope'\n    In the class declaration for `HasHighlightedRope'\ncabal: Error: some packages failed to install:\n</code></pre>\n\n<p>Windows 10</p>\n\n<pre><code>F:\\&gt;ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 7.10.3\n\nF:\\&gt;cabal --version\ncabal-install version 1.23.0.0\ncompiled using version 1.23.0.0 of the Cabal library\n</code></pre>\n"}, {"tags": ["haskell", "io", "definition"], "comments": [{"owner": {"reputation": 2134, "user_id": 2623659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1bd33f70a971bf89c7719005d477e2b?s=128&d=identicon&r=PG", "display_name": "ach", "link": "https://stackoverflow.com/users/2623659/ach"}, "edited": false, "score": 5, "creation_date": 1451300443, "post_id": 34492110, "comment_id": 56726195, "body": "Function name&#39;s starting with <code>prim</code> means it&#39;s a built-in primitive. The definition of such a function cannot be given in terms of Haskell; it also will differ between target platforms. Sometimes it&#39;s a foreign function, sometimes it&#39;s a function name well known to the compiler (so that it can emit appropriate code directly where the function is called)."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 2134, "user_id": 2623659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1bd33f70a971bf89c7719005d477e2b?s=128&d=identicon&r=PG", "display_name": "ach", "link": "https://stackoverflow.com/users/2623659/ach"}, "edited": false, "score": 1, "creation_date": 1451301272, "post_id": 34492110, "comment_id": 56726623, "body": "@AndreyChernyakhovskiy put your answer as an answer, not comment."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1451301276, "post_id": 34492110, "comment_id": 56726626, "body": "You can see it in base package: <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/System.IO.html#putChar\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.8.1.0/docs/src/&hellip;</a> Thanks to the latest haddock, you can navigate it pretty easily!"}, {"owner": {"reputation": 2131, "user_id": 2633272, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/8ff6f41edeb1f36c439a825a4e8d39a9?s=128&d=identicon&r=PG", "display_name": "swahnee", "link": "https://stackoverflow.com/users/2633272/swahnee"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1451308308, "post_id": 34492110, "comment_id": 56729827, "body": "@Sibi thanks, that&#39;s really interesting! However, why on that place <code>putChar</code> is defined in terms of Haskell code, and in the onlinereport they imply it&#39;s a primitive function, as @AndreyChernyakhovskiy pointed out? Does the former get compiled once and then shipped inside libraries? EDIT @Zeta just beated me with the answer :)"}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 10, "last_activity_date": 1557820431, "last_edit_date": 1557820431, "creation_date": 1451307881, "answer_id": 34494072, "question_id": 34492110, "link": "https://stackoverflow.com/questions/34492110/haskell-primputchar-definition/34494072#34494072", "title": "Haskell primPutChar definition", "body": "<h2>What <code>prim*</code> means</h2>\n\n<p>Since you're asking this question in terms of the report, let's also answer this question in terms of the report:</p>\n\n<blockquote>\n  <p>Primitives that are not definable in Haskell , indicated by names starting with \"<code>prim</code>\", are defined in a system dependent manner in module <code>PreludeBuiltin</code> and are not shown here</p>\n</blockquote>\n\n<p>This is still the same in <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch9.html#x16-1710009\" rel=\"nofollow noreferrer\">Haskell2010 by the way</a>. </p>\n\n<h2>How it's implemented in GHC</h2>\n\n<p>However, you can <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/System.IO.html#putChar\" rel=\"nofollow noreferrer\">have a look at <code>base</code>'s source</a> to see how it's implemented in GHC:</p>\n\n<pre><code>putChar         :: Char -&gt; IO ()\nputChar c       =  hPutChar stdout c\n</code></pre>\n\n<p>From there you're going deep into the rabbit hole. How does <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.IO.Handle.Text.html#hPutChar\" rel=\"nofollow noreferrer\"><code>hPutChar</code></a> know how to print stuff? Well, it doesn't. It only \"buffers\" and checks that you can write:</p>\n\n<pre><code>hPutChar :: Handle -&gt; Char -&gt; IO ()\nhPutChar handle c = do\n    c `seq` return ()\n    wantWritableHandle \"hPutChar\" handle $ \\ handle_  -&gt; do\n     hPutcBuffered handle_ c\n</code></pre>\n\n<p>The writing is done in <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.IO.Handle.Internals.html#writeCharBuffer\" rel=\"nofollow noreferrer\"><code>writeCharBuffer</code></a> which fills an internal buffer until it's full (or a line has been reached&mdash;it actually depends on the buffer mode):</p>\n\n<pre><code>writeCharBuffer h_@Handle__{..} !cbuf = do\n  -- much code omitted, like buffering\n      bbuf'' &lt;- Buffered.flushWriteBuffer haDevice bbuf'\n  -- more code omitted, like buffering\n</code></pre>\n\n<p>So where is <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.IO.BufferedIO.html#flushWriteBuffer\" rel=\"nofollow noreferrer\"><code>flushWriteBuffer</code></a> defined? It's actually part of <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.IO.Handle.FD.html#stdout\" rel=\"nofollow noreferrer\"><code>stdout</code></a>:</p>\n\n<pre>\nstdout :: Handle\nstdout = unsafePerformIO $ do\n   setBinaryMode FD.stdout\n   enc &lt;- getLocaleEncoding\n   <b><i>mkHandle FD.stdout</i></b> \"&lt;stdout&gt;\" WriteHandle True (Just enc)\n                nativeNewlineMode{-translate newlines-}\n                (Just stdHandleFinalizer) Nothing\n</pre>\n\n<pre><code>stdout :: FD\nstdout = stdFD 1\n</code></pre>\n\n<p>And a file descriptor (<code>FD</code>) is an instance of <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.IO.FD.html#line-126\" rel=\"nofollow noreferrer\"><code>BufferedIO</code></a>:</p>\n\n<pre><code>instance BufferedIO FD where\n  -- some code omitted\n  flushWriteBuffer  fd buf = writeBuf' fd buf\n</code></pre>\n\n<p>and <code>writeBuf</code> uses <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.IO.FD.html#line-96\" rel=\"nofollow noreferrer\"><code>instance GHC.IO.Device.RawIO FD</code>'s <code>write</code></a>, and that ultimately <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.IO.FD.html#writeRawBufferPtr\" rel=\"nofollow noreferrer\">leads to</a>:</p>\n\n<pre>\nwriteRawBufferPtr loc !fd buf off len\n  | isNonBlocking fd = unsafe_write -- unsafe is ok, it can't block\n  | otherwise   = do r &lt;- unsafe_fdReady (fdFD fd) 1 0 0\n                     if r /= 0\n                        then write\n                        else do threadWaitWrite (fromIntegral (fdFD fd)); write\n  where\n    do_write call = fromIntegral `fmap`\n                      throwErrnoIfMinus1RetryMayBlock loc call\n                        (threadWaitWrite (fromIntegral (fdFD fd)))\n    write         = if threaded then safe_write else unsafe_write\n<b><i>    unsafe_write  = do_write (c_write (fdFD fd) (buf `plusPtr` off) len)\n    safe_write    = do_write (c_safe_write (fdFD fd) (buf `plusPtr` off) len)</i></b>\n</pre>\n\n<p>where we can see <code>c_safe_write</code> and <code>c_write</code>, which are usually bindings to C library functions:</p>\n\n<pre><code>foreign import capi unsafe \"HsBase.h write\"\n   c_write :: CInt -&gt; Ptr Word8 -&gt; CSize -&gt; IO CSsize\n</code></pre>\n\n<p>So, <code>putChar</code> uses <a href=\"http://linux.die.net/man/3/write\" rel=\"nofollow noreferrer\"><code>write</code></a>. At least in GHC's implementation. The report however doesn't require that implementation, so another compiler/runtime is allowed to use other functions.</p>\n\n<h2>TL;DR</h2>\n\n<p>GHC's implementation uses <a href=\"http://linux.die.net/man/3/write\" rel=\"nofollow noreferrer\"><code>write</code></a> with internal buffers to write things, including single characters.</p>\n"}], "owner": {"reputation": 2131, "user_id": 2633272, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/8ff6f41edeb1f36c439a825a4e8d39a9?s=128&d=identicon&r=PG", "display_name": "swahnee", "link": "https://stackoverflow.com/users/2633272/swahnee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 1, "accepted_answer_id": 34494072, "answer_count": 1, "score": 6, "last_activity_date": 1557820431, "creation_date": 1451299819, "question_id": 34492110, "link": "https://stackoverflow.com/questions/34492110/haskell-primputchar-definition", "title": "Haskell primPutChar definition", "body": "<p>I'm trying to figure out how the basic <code>IO</code> Haskell functions are defined, so I used <a href=\"https://www.haskell.org/onlinereport/standard-prelude.html\" rel=\"noreferrer\">this reference</a> and I got to the <code>putChar</code> function definition:</p>\n\n<pre><code>putChar    :: Char -&gt; IO ()\nputChar    =  primPutChar\n</code></pre>\n\n<p>Now, however, I cannot find more information about this <code>primPutChar</code> function anywhere. Maybe it might refer to a pre-compiled function, available as binary from a shared object? If that's the case, is it possible to see its source code?</p>\n"}, {"tags": ["java", "haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451316419, "post_id": 34492040, "comment_id": 56733766, "body": "Something is seriously broken here... most of these types don&#39;t make sense <code>wait&#39;&#39; :: ( this, JNIS.VoidResult void) =&gt; this -&gt; JNI.Java void</code> is not well kinded (<code>this :: Constraint</code> and <code>this :: *</code>). Then the function in question <code>getDrivers :: (JNIS.ObjectResult (object (&#39; v2))) =&gt; JNI.Java (object (&#39; v2))</code> shouldn&#39;t even parse - <code>&#39; v2</code> would be invalid. Perhaps try to delete the type signatures altogether and see if GHC can infer the types."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451316704, "post_id": 34492040, "comment_id": 56733935, "body": "Yes, that&#39;s what I tried, deleted all the type signatures by commenting them out in step 2 of my <i>edit</i>, and that lead me to step 3."}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1451303418, "creation_date": 1451299514, "last_edit_date": 1451303418, "question_id": 34492040, "link": "https://stackoverflow.com/questions/34492040/how-to-call-java-methods-instantiate-java-objects-from-haskell-easily", "title": "How to call Java methods &amp; instantiate Java objects from Haskell easily?", "body": "<p>I've found this library: <a href=\"https://hackage.haskell.org/package/java-bridge\" rel=\"nofollow\">https://hackage.haskell.org/package/java-bridge</a></p>\n\n<p>Which, according to the author, supports 3 levels of binding to Java from Haskell. The <a href=\"https://hackage.haskell.org/package/java-bridge-0.20130606.3/docs/Foreign-Java.html\" rel=\"nofollow\">mid level interface</a> works quite well, as advertised. As I am using it, though, it starts to get repetitive and boring to write the glue code as it is little more than matching up class, method, and type names in specific ways. <a href=\"https://hackage.haskell.org/package/java-bridge-0.20130606.3/src/examples/\" rel=\"nofollow\">Here are some examples of using the mid level interface</a>.</p>\n\n<p>As far as I understand, the <a href=\"https://hackage.haskell.org/package/java-bridge-0.20130606.3/docs/Foreign-Java-Bindings.html\" rel=\"nofollow\">high level interface</a> is supposed to work by automatically writing this glue code.\nSo I am trying to make that work without much success yet:</p>\n\n<pre><code>import Foreign.Java\nimport Foreign.Java.Bindings\nimport Data.Map as Map\n\nmain = runJava $ do\n  jClasses &lt;- reflectJavaClasses [\"java.sql.DriverManager\"]\n  let info = Map.fromList [(\"java.sql.DriverManager\", jClasses !! 0)]\n  io $ putStrLn $ printJavaClassModule (jClasses !! 0) \"DriverManager\" info\n  io $ putStrLn $ printJavaPackageModule \"DriverManager\" \"DriverManager\" info jClasses\n  io $ putStrLn $ printJavaClassBootfile (jClasses !! 0) \"DriverManager\" info\n</code></pre>\n\n<p>Which outputs the following:</p>\n\n<pre><code>Preprocessing executable 'exp-java' for exp-java-0.1.0.0...\n[1 of 1] Compiling Main             ( main.hs, dist/build/exp-java/exp-java-tmp/Main.o )\nLinking dist/build/exp-java/exp-java ...\n{-# LANGUAGE Haskell2010 #-}\n-- | Class @java.sql.DriverManager@\nmodule DriverManager (\n    -- * Methods\nderegisterDriver,    \nequals,    \ngetClass,    \ngetConnection,    \ngetConnection',    \ngetConnection'',    \ngetDriver,    \ngetDrivers,    \ngetLogStream,    \ngetLogWriter,    \ngetLoginTimeout,    \nhashCode,    \nnotify,    \nnotifyAll,    \nprintln,    \nregisterDriver,    \nsetLogStream,    \nsetLogWriter,    \nsetLoginTimeout,    \ntoString,    \nwait,    \nwait',    \nwait'',    \n    -- * Information about this class.\n    info'\n) where\nimport qualified Foreign.Java as JNI\nimport Foreign.Java ((--&gt;))\nimport qualified Prelude as Prelude\nimport Prelude ((.), ($), (&gt;&gt;=), (&gt;&gt;), return)\nimport qualified Foreign.Java.Bindings.Support as JNIS\nimport Data.Functor ((&lt;$&gt;))\n\n\nexp-java: classModImports in Foreign.Java.Bindings.Java2Haskell - class definition not found\n</code></pre>\n\n<h3>Questions</h3>\n\n<ol>\n<li><p><strike>Any ideas what might cause this to say <code>classModImports in Foreign.Java.Bindings.Java2Haskell - class definition not found</code>?</strike> See edit below. It seems using <code>findJavaClasses</code> was required to get past this error.</p></li>\n<li><p>Am I using this differently than it was intended?</p></li>\n<li><p>Are there any examples of the intended and working usage of the high level API that I can look at?</p></li>\n<li><p>Is there any other way (e.g. different library) with which I could (also/more easily) achieve an easy-to-use interfacing to Java from Haskell?</p></li>\n</ol>\n\n<h3>Edit (2015-12-28 11:42 UTC)</h3>\n\n<p>I managed to get a bit further, not fully working yet:</p>\n\n<pre><code>import Foreign.Java\nimport Foreign.Java.Bindings\nimport Data.Map as Map\n\nmain = runJava $ do\n  let target = \"java.sql.DriverManager\"\n  deps &lt;- findJavaClasses 21 [target]\n  jClasses &lt;- reflectJavaClasses deps\n  let jClassesMap = Map.fromList $ zip deps jClasses\n  let l = flip Map.lookup\n  let (Just targetJClass) = jClassesMap `l` target\n  io $ putStrLn $ printJavaClassModule targetJClass \"DriverManager\" jClassesMap\n</code></pre>\n\n<p>Which outputs:</p>\n\n<pre><code>{-# LANGUAGE Haskell2010 #-}\n-- | Class @java.sql.DriverManager@\nmodule DriverManager (\n    -- * Methods\nderegisterDriver,\nequals,\ngetClass,\ngetConnection,\ngetConnection',\ngetConnection'',\ngetDriver,\ngetDrivers,\ngetLogStream,\ngetLogWriter,\ngetLoginTimeout,\nhashCode,\nnotify,\nnotifyAll,\nprintln,\nregisterDriver,\nsetLogStream,\nsetLogWriter,\nsetLoginTimeout,\ntoString,\nwait,\nwait',\nwait'',\n    -- * Information about this class.\n    info'\n) where\nimport qualified Foreign.Java as JNI\nimport Foreign.Java ((--&gt;))\nimport qualified Prelude as Prelude\nimport Prelude ((.), ($), (&gt;&gt;=), (&gt;&gt;), return)\nimport qualified Foreign.Java.Bindings.Support as JNIS\nimport Data.Functor ((&lt;$&gt;))\n\n\nimport qualified\n\ninfo' = \"DriverManager\"\n\n-- | @static synchronized deregisterDriver(java.sql.Driver) -&gt; void@\nderegisterDriver :: ( v1, JNIS.VoidResult void) =&gt; v1 -&gt; JNI.Java void\nderegisterDriver a1 = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getStaticMethod` \"deregisterDriver\" JNI.::= JNI.object \"java.sql.Driver\" --&gt; JNI.void\n    a1' &lt;- Prelude.Just &lt;$&gt; JNI.asObject a1\n    result &lt;- JNI.callStaticMethodE method a1'\n    JNIS.toVoidResult result\n-- | @virtual equals(java.lang.Object) -&gt; boolean@\nequals :: (JNIS.BooleanResult boolean,  this,  v1) =&gt; this -&gt; v1 -&gt; JNI.Java boolean\nequals this a1 = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getMethod` \"equals\" JNI.::= JNI.object \"java.lang.Object\" --&gt; JNI.boolean\n    this' &lt;- JNI.asObject this\n    a1' &lt;- Prelude.Just &lt;$&gt; JNI.asObject a1\n    result &lt;- JNI.callMethodE method this' a1'\n    JNIS.toBooleanResult result\n-- | @virtual native final getClass() -&gt; java.lang.Class@\ngetClass :: ( this, JNIS.ObjectResult (object (' v2))) =&gt; this -&gt; JNI.Java (object (' v2))\ngetClass this = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getMethod` \"getClass\" JNI.::= JNI.object \"java.lang.Class\"\n    this' &lt;- JNI.asObject this\n    result &lt;- JNI.callMethodE method this'\n    JNIS.toObjectResult result\n-- | @static getConnection(java.lang.String, java.lang.String, java.lang.String) -&gt; java.sql.Connection@\ngetConnection :: ( v1,  v2,  v3, JNIS.ObjectResult (object ')) =&gt; v1 -&gt; v2 -&gt; v3 -&gt; JNI.Java (object ')\ngetConnection a1 a2 a3 = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getStaticMethod` \"getConnection\" JNI.::= JNI.object \"java.lang.String\" --&gt; JNI.object \"java.lang.String\" --&gt; JNI.object \"java.lang.String\" --&gt; JNI.object \"java.sql.Connection\"\n    a1' &lt;- Prelude.Just &lt;$&gt; JNI.asObject a1\n    a2' &lt;- Prelude.Just &lt;$&gt; JNI.asObject a2\n    a3' &lt;- Prelude.Just &lt;$&gt; JNI.asObject a3\n    result &lt;- JNI.callStaticMethodE method a1' a2' a3'\n    JNIS.toObjectResult result\n-- | @static getConnection(java.lang.String, java.util.Properties) -&gt; java.sql.Connection@\ngetConnection' :: ( v1,  v2, JNIS.ObjectResult (object ')) =&gt; v1 -&gt; v2 -&gt; JNI.Java (object ')\ngetConnection' a1 a2 = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getStaticMethod` \"getConnection\" JNI.::= JNI.object \"java.lang.String\" --&gt; JNI.object \"java.util.Properties\" --&gt; JNI.object \"java.sql.Connection\"\n    a1' &lt;- Prelude.Just &lt;$&gt; JNI.asObject a1\n    a2' &lt;- Prelude.Just &lt;$&gt; JNI.asObject a2\n    result &lt;- JNI.callStaticMethodE method a1' a2'\n    JNIS.toObjectResult result\n-- | @static getConnection(java.lang.String) -&gt; java.sql.Connection@\ngetConnection'' :: ( v1, JNIS.ObjectResult (object ')) =&gt; v1 -&gt; JNI.Java (object ')\ngetConnection'' a1 = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getStaticMethod` \"getConnection\" JNI.::= JNI.object \"java.lang.String\" --&gt; JNI.object \"java.sql.Connection\"\n    a1' &lt;- Prelude.Just &lt;$&gt; JNI.asObject a1\n    result &lt;- JNI.callStaticMethodE method a1'\n    JNIS.toObjectResult result\n-- | @static getDriver(java.lang.String) -&gt; java.sql.Driver@\ngetDriver :: ( v1, JNIS.ObjectResult (object ')) =&gt; v1 -&gt; JNI.Java (object ')\ngetDriver a1 = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getStaticMethod` \"getDriver\" JNI.::= JNI.object \"java.lang.String\" --&gt; JNI.object \"java.sql.Driver\"\n    a1' &lt;- Prelude.Just &lt;$&gt; JNI.asObject a1\n    result &lt;- JNI.callStaticMethodE method a1'\n    JNIS.toObjectResult result\n-- | @static getDrivers() -&gt; java.util.Enumeration@\ngetDrivers :: (JNIS.ObjectResult (object (' v2))) =&gt; JNI.Java (object (' v2))\ngetDrivers = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getStaticMethod` \"getDrivers\" JNI.::= JNI.object \"java.util.Enumeration\"\n    result &lt;- JNI.callStaticMethodE method\n    JNIS.toObjectResult result\n-- | @static getLogStream() -&gt; java.io.PrintStream@\ngetLogStream :: (JNIS.ObjectResult (object ')) =&gt; JNI.Java (object ')\ngetLogStream = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getStaticMethod` \"getLogStream\" JNI.::= JNI.object \"java.io.PrintStream\"\n    result &lt;- JNI.callStaticMethodE method\n    JNIS.toObjectResult result\n-- | @static getLogWriter() -&gt; java.io.PrintWriter@\ngetLogWriter :: (JNIS.ObjectResult (object ')) =&gt; JNI.Java (object ')\ngetLogWriter = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getStaticMethod` \"getLogWriter\" JNI.::= JNI.object \"java.io.PrintWriter\"\n    result &lt;- JNI.callStaticMethodE method\n    JNIS.toObjectResult result\n-- | @static getLoginTimeout() -&gt; int@\ngetLoginTimeout :: (JNIS.IntResult int) =&gt; JNI.Java int\ngetLoginTimeout = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getStaticMethod` \"getLoginTimeout\" JNI.::= JNI.int\n    result &lt;- JNI.callStaticMethodE method\n    JNIS.toIntResult result\n-- | @virtual native hashCode() -&gt; int@\nhashCode :: (JNIS.IntResult int,  this) =&gt; this -&gt; JNI.Java int\nhashCode this = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getMethod` \"hashCode\" JNI.::= JNI.int\n    this' &lt;- JNI.asObject this\n    result &lt;- JNI.callMethodE method this'\n    JNIS.toIntResult result\n-- | @virtual native final notify() -&gt; void@\nnotify :: ( this, JNIS.VoidResult void) =&gt; this -&gt; JNI.Java void\nnotify this = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getMethod` \"notify\" JNI.::= JNI.void\n    this' &lt;- JNI.asObject this\n    result &lt;- JNI.callMethodE method this'\n    JNIS.toVoidResult result\n-- | @virtual native final notifyAll() -&gt; void@\nnotifyAll :: ( this, JNIS.VoidResult void) =&gt; this -&gt; JNI.Java void\nnotifyAll this = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getMethod` \"notifyAll\" JNI.::= JNI.void\n    this' &lt;- JNI.asObject this\n    result &lt;- JNI.callMethodE method this'\n    JNIS.toVoidResult result\n-- | @static println(java.lang.String) -&gt; void@\nprintln :: ( v1, JNIS.VoidResult void) =&gt; v1 -&gt; JNI.Java void\nprintln a1 = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getStaticMethod` \"println\" JNI.::= JNI.object \"java.lang.String\" --&gt; JNI.void\n    a1' &lt;- Prelude.Just &lt;$&gt; JNI.asObject a1\n    result &lt;- JNI.callStaticMethodE method a1'\n    JNIS.toVoidResult result\n-- | @static synchronized registerDriver(java.sql.Driver) -&gt; void@\nregisterDriver :: ( v1, JNIS.VoidResult void) =&gt; v1 -&gt; JNI.Java void\nregisterDriver a1 = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getStaticMethod` \"registerDriver\" JNI.::= JNI.object \"java.sql.Driver\" --&gt; JNI.void\n    a1' &lt;- Prelude.Just &lt;$&gt; JNI.asObject a1\n    result &lt;- JNI.callStaticMethodE method a1'\n    JNIS.toVoidResult result\n-- | @static setLogStream(java.io.PrintStream) -&gt; void@\nsetLogStream :: ( v1, JNIS.VoidResult void) =&gt; v1 -&gt; JNI.Java void\nsetLogStream a1 = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getStaticMethod` \"setLogStream\" JNI.::= JNI.object \"java.io.PrintStream\" --&gt; JNI.void\n    a1' &lt;- Prelude.Just &lt;$&gt; JNI.asObject a1\n    result &lt;- JNI.callStaticMethodE method a1'\n    JNIS.toVoidResult result\n-- | @static setLogWriter(java.io.PrintWriter) -&gt; void@\nsetLogWriter :: ( v1, JNIS.VoidResult void) =&gt; v1 -&gt; JNI.Java void\nsetLogWriter a1 = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getStaticMethod` \"setLogWriter\" JNI.::= JNI.object \"java.io.PrintWriter\" --&gt; JNI.void\n    a1' &lt;- Prelude.Just &lt;$&gt; JNI.asObject a1\n    result &lt;- JNI.callStaticMethodE method a1'\n    JNIS.toVoidResult result\n-- | @static setLoginTimeout(int) -&gt; void@\nsetLoginTimeout :: (JNIS.JInt v1, JNIS.VoidResult void) =&gt; v1 -&gt; JNI.Java void\nsetLoginTimeout a1 = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getStaticMethod` \"setLoginTimeout\" JNI.::= JNI.int --&gt; JNI.void\n    a1' &lt;- JNIS.toInt a1\n    result &lt;- JNI.callStaticMethodE method a1'\n    JNIS.toVoidResult result\n-- | @virtual toString() -&gt; java.lang.String@\ntoString :: ( this, JNIS.ObjectResult (object ')) =&gt; this -&gt; JNI.Java (object ')\ntoString this = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getMethod` \"toString\" JNI.::= JNI.object \"java.lang.String\"\n    this' &lt;- JNI.asObject this\n    result &lt;- JNI.callMethodE method this'\n    JNIS.toObjectResult result\n-- | @virtual final wait(long, int) -&gt; void@\nwait :: ( this, JNIS.JLong v1, JNIS.JInt v2, JNIS.VoidResult void) =&gt; this -&gt; v1 -&gt; v2 -&gt; JNI.Java void\nwait this a1 a2 = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getMethod` \"wait\" JNI.::= JNI.long --&gt; JNI.int --&gt; JNI.void\n    this' &lt;- JNI.asObject this\n    a1' &lt;- JNIS.toLong a1\n    a2' &lt;- JNIS.toInt a2\n    result &lt;- JNI.callMethodE method this' a1' a2'\n    JNIS.toVoidResult result\n-- | @virtual native final wait(long) -&gt; void@\nwait' :: ( this, JNIS.JLong v1, JNIS.VoidResult void) =&gt; this -&gt; v1 -&gt; JNI.Java void\nwait' this a1 = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getMethod` \"wait\" JNI.::= JNI.long --&gt; JNI.void\n    this' &lt;- JNI.asObject this\n    a1' &lt;- JNIS.toLong a1\n    result &lt;- JNI.callMethodE method this' a1'\n    JNIS.toVoidResult result\n-- | @virtual final wait() -&gt; void@\nwait'' :: ( this, JNIS.VoidResult void) =&gt; this -&gt; JNI.Java void\nwait'' this = do\n    (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\"\n    (Prelude.Just method) &lt;- clazz `JNI.getMethod` \"wait\" JNI.::= JNI.void\n    this' &lt;- JNI.asObject this\n    result &lt;- JNI.callMethodE method this'\n    JNIS.toVoidResult result\n</code></pre>\n\n<p>This is rather close now, however this won't compile with my GHC 7.8.4, even if I try to patch up the output source by hand.</p>\n\n<ol>\n<li><p>There is an empty <code>import qualified</code> at the top, resulting in a syntax error. So I tried disabling that by commenting it out.</p></li>\n<li><p>Then there were quite a few error messages pointing to various bits of the type declarations, so I commented those out too, hoping GHC might infer something sensible in their place. At least until I am just trying to make it work.</p></li>\n<li><p>Then I get this error:</p>\n\n<pre><code>Preprocessing executable 'exp-java' for exp-java-0.1.0.0...\n[1 of 2] Compiling DriverManager    ( DriverManager.hs, dist/build/exp-java/exp-java-tmp/DriverManager.o )\n\nDriverManager.hs:109:5:\n    No instance for (JNIS.ObjectResult b3)\n      arising from a use of \u2018JNIS.toObjectResult\u2019\n    The type variable \u2018b3\u2019 is ambiguous\n    Relevant bindings include\n      getDrivers :: JNI.Java b3 (bound at DriverManager.hs:105:1)\n    Note: there are several potential instances:\n      instance JNIS.UnsafeCast a =&gt;\n               JNIS.ObjectResult (Prelude.Either JNI.JThrowable (Prelude.Maybe a))\n        -- Defined in \u2018Foreign.Java.Bindings.Support\u2019\n      instance JNIS.UnsafeCast a =&gt;\n               JNIS.ObjectResult (Prelude.Either (Prelude.Maybe JNI.JThrowable) a)\n        -- Defined in \u2018Foreign.Java.Bindings.Support\u2019\n      instance JNIS.UnsafeCast a =&gt; JNIS.ObjectResult (Prelude.Maybe a)\n        -- Defined in \u2018Foreign.Java.Bindings.Support\u2019\n      ...plus two others\n    In a stmt of a 'do' block: JNIS.toObjectResult result\n    In the expression:\n      do { (Prelude.Just clazz) &lt;- JNI.getClass \"java.sql.DriverManager\";\n           (Prelude.Just method) &lt;- clazz\n                                    `JNI.getStaticMethod`\n                                      \"getDrivers\" JNI.::= JNI.object \"java.util.Enumeration\";\n           result &lt;- JNI.callStaticMethodE method;\n           JNIS.toObjectResult result }\n    In an equation for \u2018getDrivers\u2019:\n        getDrivers\n          = do { (Prelude.Just clazz) &lt;- JNI.getClass\n                                           \"java.sql.DriverManager\";\n                 (Prelude.Just method) &lt;- clazz\n                                          `JNI.getStaticMethod`\n                                            \"getDrivers\" JNI.::= JNI.object \"java.util.Enumeration\";\n                 result &lt;- JNI.callStaticMethodE method;\n                 .... }\n</code></pre></li>\n</ol>\n\n<p>Which I am not yet sure how to resolve. Any ideas?</p>\n\n<p>My questions 2..4 at the end of my original question, just before this edit, still stand.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1451291641, "post_id": 34489678, "comment_id": 56722027, "body": "Use pattern matching rather than guards. As in <code>findFruit (Apple:xs) = ... ; findFruit (Peach:xs) = ...</code> Adding <code>deriving Eq</code> as the answers suggest will also work but pattern matching is idiomatic and preferable."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1451298143, "post_id": 34489678, "comment_id": 56725000, "body": "By the way - if you call your function <code>findFruit</code> I would expect a different type signature, if you&#39;re doing this as an exercise try to implement <code>countFruit :: Fruit -&gt; [Fruit] -&gt; Int</code>."}], "answers": [{"tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": true, "score": 2, "last_activity_date": 1451291715, "last_edit_date": 1451291715, "creation_date": 1451291624, "answer_id": 34490135, "question_id": 34489678, "link": "https://stackoverflow.com/questions/34489678/find-occurrences-in-a-list-using-recursion-in-haskell/34490135#34490135", "title": "Find occurrences in a List using recursion in Haskell", "body": "<p>You need to add <code>deriving Eq</code> to your type constructor. That way, the notion of equality for your type will be automatically implemented and the == operator will be valid for use.</p>\n\n<pre><code>data Fruit = Apple | Peach deriving Eq\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 0, "last_activity_date": 1451291632, "creation_date": 1451291632, "answer_id": 34490137, "question_id": 34489678, "link": "https://stackoverflow.com/questions/34489678/find-occurrences-in-a-list-using-recursion-in-haskell/34490137#34490137", "title": "Find occurrences in a List using recursion in Haskell", "body": "<p>Your code is ok, but he does not know how to compare elements, so, just derive from eq as the compiler is telling you:</p>\n\n<pre><code>data Fruit = Apple | Peach deriving (Eq)\n</code></pre>\n\n<p>This way the compiler will have information about this data can be compared.</p>\n"}, {"tags": [], "owner": {"reputation": 336, "user_id": 5657031, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQu61dwt0vc/AAAAAAAAAAI/AAAAAAAAAY0/ki0tUEoS0pU/photo.jpg?sz=128", "display_name": "Michael Szvetits", "link": "https://stackoverflow.com/users/5657031/michael-szvetits"}, "is_accepted": false, "score": 4, "last_activity_date": 1451291795, "creation_date": 1451291795, "answer_id": 34490170, "question_id": 34489678, "link": "https://stackoverflow.com/questions/34489678/find-occurrences-in-a-list-using-recursion-in-haskell/34490170#34490170", "title": "Find occurrences in a List using recursion in Haskell", "body": "<p>You can leave the data definition as it is and use pattern matching:</p>\n\n<pre><code>data Fruit = Apple | Peach\n\nfindFruit :: [Fruit] -&gt; Int\nfindFruit []         = 0\nfindFruit (Apple:ys) = 1 + findFruit ys\nfindFruit (Peach:ys) = findFruit ys\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1451300110, "post_id": 34490286, "comment_id": 56726010, "body": "If you want modularity and concept reuse, it&#39;s far easier to go for <code>length . filter (Apple ==)</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1451301801, "post_id": 34490286, "comment_id": 56726864, "body": "@gallais not without adding the <code>Eq</code> constraint. And not if you want to sum up prices, say, for all fruits, which my code easily and trivially allows for. i.e. <i>&quot;ease of extension and modification&quot;</i>. :)"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1451306802, "post_id": 34490286, "comment_id": 56729195, "body": "Why not <code>countFruit = sum . map (fruit 1 0)</code> then?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1451468329, "post_id": 34490286, "comment_id": 56794860, "body": "I just thought of <code>mconcat</code> first, and <code>Sum</code> was a later detail."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 0, "last_activity_date": 1451292386, "creation_date": 1451292386, "answer_id": 34490286, "question_id": 34489678, "link": "https://stackoverflow.com/questions/34489678/find-occurrences-in-a-list-using-recursion-in-haskell/34490286#34490286", "title": "Find occurrences in a List using recursion in Haskell", "body": "<p>You can try for modularity and concept reuse with</p>\n\n<pre><code>import Data.Monoid\n\nfruit a _ Apple = a    -- case analysis for Fruit \nfruit _ p Peach = p\n\ncountFruit = getSum . mconcat . map (fruit (Sum 1) (Sum 0))\n</code></pre>\n\n<p>(though it's not recursive).</p>\n"}], "owner": {"reputation": 2445, "user_id": 4468969, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6b05d7f3493f7c284f67b1f2c1557f58?s=128&d=identicon&r=PG", "display_name": "Andi Pavllo", "link": "https://stackoverflow.com/users/4468969/andi-pavllo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 422, "favorite_count": 0, "accepted_answer_id": 34490135, "answer_count": 4, "score": 3, "last_activity_date": 1451292386, "creation_date": 1451289340, "last_edit_date": 1451291496, "question_id": 34489678, "link": "https://stackoverflow.com/questions/34489678/find-occurrences-in-a-list-using-recursion-in-haskell", "title": "Find occurrences in a List using recursion in Haskell", "body": "<p>I have the an List which can contain just two kind of elements, <strong>Apple</strong> and <strong>Peach</strong>. I need to create a function which, given a list with those elements, returns the number of occurences of <strong>Apple</strong> in the list by using recursion.</p>\n\n<p>Here is my attempt:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>data Fruit = Apple | Peach\nfindFruit :: [Fruit] -&gt; Int\n\nfindFruit [] = 0\n\nfindFruit (y:ys)\n    | y==Apple = 1+(findFruit ys)\n    | otherwise = findFruit ys\n</code></pre>\n\n<p>But it's not working. I suspect the issue is in the last instructions but I cannot really understand where as I'm still a Haskell newbie.</p>\n\n<p>Here is the error log:</p>\n\n<pre><code>Main.hs:7:8:\n    No instance for (Eq Fruit) arising from a use of \u2018==\u2019\n    In the expression: y == Apple\n    In a stmt of a pattern guard for\n                   an equation for \u2018findFruit\u2019:\n      y == Apple\n    In an equation for \u2018findFruit\u2019:\n        findFruit (y : ys)\n          | y == Apple = 1 + (findFruit ys)\n          | otherwise = findFruit ys\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Thank you for your help!</p>\n"}, {"tags": ["haskell", "functional-programming", "scheme", "monads", "sicp"], "comments": [{"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 2, "creation_date": 1451311721, "post_id": 34488132, "comment_id": 56731452, "body": "Eugenio Moggi first described the general use of monads to structure programs in 1991. SICP was published in 1984."}, {"owner": {"reputation": 446, "user_id": 656592, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/796d9b48a5abf81fdb1fefe219391b47?s=128&d=identicon&r=PG&f=1", "display_name": "coder000001", "link": "https://stackoverflow.com/users/656592/coder000001"}, "reply_to_user": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1451312368, "post_id": 34488132, "comment_id": 56731750, "body": "Thanks, But I meant the second edition which came in 2005, I updated the question."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 2, "creation_date": 1451313212, "post_id": 34488132, "comment_id": 56732161, "body": "The second edition was published in July, 1996. Monadic I/O \u2013 the first &quot;widespread&quot; monads \u2013 appeared in Haskell in May, 1996. Monads didn&#39;t become widely known until well into the 21st century."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1600354874, "post_id": 34488132, "comment_id": 113067703, "body": "I don&#39;t understand now why I voted to close this question back then. to answer it, it is Chapter 4, &quot;Metalinguistic Abstraction&quot; IOW &quot;Interpreters&quot;. just because Monad <i>is</i> the <i>Interpreter Pattern,</i> where programs and means to compose them are first class objects (data and functions) of our language. the best intro to Monads is Wadler&#39;s &quot;How to Turn Failure into List of Successes&quot;, which does not mention the M word once (I think)."}], "answers": [{"comments": [{"owner": {"reputation": 446, "user_id": 656592, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/796d9b48a5abf81fdb1fefe219391b47?s=128&d=identicon&r=PG&f=1", "display_name": "coder000001", "link": "https://stackoverflow.com/users/656592/coder000001"}, "edited": false, "score": 0, "creation_date": 1451319892, "post_id": 34489120, "comment_id": 56735647, "body": "Is there any alternative book that covers the latest research including monads ? Can you update yur answer if there is one."}, {"owner": {"reputation": 13124, "user_id": 1419272, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dcbff46aa5cd0a98d13d76595b3375f0?s=128&d=identicon&r=PG", "display_name": "alinsoar", "link": "https://stackoverflow.com/users/1419272/alinsoar"}, "edited": false, "score": 0, "creation_date": 1600168097, "post_id": 34489120, "comment_id": 112996577, "body": "You are wrong.  <a href=\"https://person.dibris.unige.it/moggi-eugenio/\" rel=\"nofollow noreferrer\">person.dibris.unige.it/moggi-eugenio</a> Moggi already transported them from maths to computer science in 1991.  The 2nd edition of SICP dates from 1996.   SICP simply does not cope with, and more generally, they did not want to talk about types.  But it&#39;s true that mastering SICP you indirectly understand monads."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 6, "last_activity_date": 1451286546, "creation_date": 1451286546, "answer_id": 34489120, "question_id": 34488132, "link": "https://stackoverflow.com/questions/34488132/monad-and-structure-and-interpretation-of-computer-programs/34489120#34489120", "title": "Monad and Structure and interpretation of computer programs", "body": "<p>Nothing in SICP addresses monads explicitly: the book was written long before anyone had formalized the concept of a monad as it relates to computer programming (ignoring here the mathematical idea of a monad, which is a different thing). But, some stuff in the book is monadic anyway: lists, for example, are a monad whether you know it or not.</p>\n"}, {"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 4, "creation_date": 1451332581, "post_id": 34491360, "comment_id": 56741251, "body": "-1, while Haskell does use monads for I/O, the <code>IO</code> monad is the only &quot;magic&quot; monad, and plenty of monads are useful even in Scheme. The Maybe monad, for example, has made its way into Clojure in the form of <code>some-&gt;</code>. Your answer is not wrong (there are plenty of reasons Scheme does not use monads as an abstraction), but the first paragraph is a poor argument and is a little misleading."}, {"owner": {"reputation": 403, "user_id": 3187369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ld5fs.gif?s=128&g=1", "display_name": "Akaberto", "link": "https://stackoverflow.com/users/3187369/akaberto"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1451363834, "post_id": 34491360, "comment_id": 56750902, "body": "I thought I mentioned Scheme, not Clojure (which leans towards FP a lot; I don&#39;t know much about it though, aside from the wiki article).  That said, Scheme (well, Racket) does allow you to have multiple effects in a monad.  I tried mixing IO operations in the list monad which performs IO as well.  So, thereby, this isn&#39;t really a monad as how it is in Haskell (the type sigs don&#39;t match).  However, I do admit that this style of composition can be quite useful in Scheme as well (though I&#39;ve only seen the maybe put to action anywhere."}], "tags": [], "owner": {"reputation": 403, "user_id": 3187369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ld5fs.gif?s=128&g=1", "display_name": "Akaberto", "link": "https://stackoverflow.com/users/3187369/akaberto"}, "is_accepted": false, "score": 2, "last_activity_date": 1451638800, "last_edit_date": 1451638800, "creation_date": 1451296928, "answer_id": 34491360, "question_id": 34488132, "link": "https://stackoverflow.com/questions/34488132/monad-and-structure-and-interpretation-of-computer-programs/34491360#34491360", "title": "Monad and Structure and interpretation of computer programs", "body": "<p>SICP uses Scheme.  Scheme allows for arbitrary actions to be chained together.  Nothing stops you from doing so.  In other words, you are basically working in a do-anything monad.  Also, they tend not to be that useful or idomatic in a multi-paradigm language like Lisp (by that, I mean Scheme doesn't take sides; it kind of eschews mutation by making them taboo with the suffix, \"!\").</p>\n\n<p>In Haskell, you write programs where types limit the kind of action that can occur within said function.  Making an instance monadic lets you compose functions with some restrictions (on the type, as well as the monad laws that the programmer has to take care of).  And you can stack up effects using transformers.</p>\n\n<p>So, monads are not that useful in a language setting like Scheme.  Nor, as Amalloy rightly said, were they invented back then.</p>\n\n<p>EDIT 1: A clarification on the first paragraph.  You can have monads in Lisp (an impure language), just that you don't have the type system making sure you are not mixing effects.  I used <code>IO</code> in a <code>List</code> monad (Racket + functional/better-monads)   That said, the monad design pattern can be quite useful like how <code>Maybe</code> and <code>List</code> are used in Clojure/Racket, as Alexis King pointed out.  </p>\n\n<p>EDIT 2: For things like State and ST (which are probably what you see in most use cases as many (most?) algorithms take advantage of mutability), monads don't really make much sense.  Also, as I've already pointed it out, you do not get guarantees that you expect out of Haskell in most Lisps.</p>\n"}], "owner": {"reputation": 446, "user_id": 656592, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/796d9b48a5abf81fdb1fefe219391b47?s=128&d=identicon&r=PG&f=1", "display_name": "coder000001", "link": "https://stackoverflow.com/users/656592/coder000001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 798, "favorite_count": 2, "closed_date": 1451428777, "answer_count": 2, "score": 2, "last_activity_date": 1451638800, "creation_date": 1451280690, "last_edit_date": 1451585070, "question_id": 34488132, "link": "https://stackoverflow.com/questions/34488132/monad-and-structure-and-interpretation-of-computer-programs", "closed_reason": "Not suitable for this site", "title": "Monad and Structure and interpretation of computer programs", "body": "<p>I couldn't find the word \"<code>Monad</code>\" when I searched SICP 2nd Edition book. Which concept ( or chapters) of SICP relates to Monad ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 12, "creation_date": 1451274383, "post_id": 34487395, "comment_id": 56716774, "body": "There was an embarrassing time when not every <code>Monad</code> was an <code>Applicative</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 9, "creation_date": 1451276888, "post_id": 34487395, "comment_id": 56717281, "body": "You didn&#39;t ask about this, but you should <i>never</i> make a default class method that always produces an error. Just don&#39;t make a default in that case; GHC will warn if the method isn&#39;t defined in an instance. With a bogus default, users get no warning; things just blow up at runtime."}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 5, "last_activity_date": 1451296286, "creation_date": 1451296286, "answer_id": 34491194, "question_id": 34487395, "link": "https://stackoverflow.com/questions/34487395/traversablemapm-sequence-necessary/34491194#34491194", "title": "Traversable#mapM &amp; sequence - Necessary?", "body": "<p>As mentioned in the comments, there was a time when not every <code>Monad</code> was an <code>Applicative</code>.\nJust recently (in <code>base-4.8</code> which shipped with GHC 7.10) the <code>Applicative</code> was made a superclass of <code>Monad</code>. You might have seen <a href=\"https://wiki.haskell.org/Functor-Applicative-Monad_Proposal\" rel=\"noreferrer\">Applicative-Monad-Proposal, AMP</a>.</p>\n\n<p>Currently the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Proposal/MonadOfNoReturn\" rel=\"noreferrer\">Monad of no return, MRP</a> (<a href=\"https://mail.haskell.org/pipermail/libraries/2015-September/026121.html\" rel=\"noreferrer\">email-thread</a>) is worked on, which will make \n<code>Monad</code>'s <code>&gt;&gt;</code> and <code>Applicative</code>'s <code>*&gt;</code> the same. Which eventlually would make possible to say that <code>traverse = mapM</code> and <code>sequence = sequenceA</code>. But that is a long process, which will take time.</p>\n\n<p>So to answer your question: <em>for history reasons</em>.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1451296286, "creation_date": 1451273866, "last_edit_date": 1495535299, "question_id": 34487395, "link": "https://stackoverflow.com/questions/34487395/traversablemapm-sequence-necessary", "title": "Traversable#mapM &amp; sequence - Necessary?", "body": "<p><a href=\"https://wiki.haskell.org/Typeclassopedia#Traversable\" rel=\"nofollow noreferrer\">Typeclassopedia</a> presents Traversable:</p>\n\n<pre><code>class (Functor t, Foldable t) =&gt; Traversable t where\n  traverse  :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\n  sequenceA :: Applicative f =&gt; t (f a) -&gt; f (t a)\n  mapM      ::       Monad m =&gt; (a -&gt; m b) -&gt; t a -&gt; m (t b)\n  sequence  ::       Monad m =&gt; t (m a) -&gt; m (t a)\n</code></pre>\n\n<blockquote>\n  <p>A good exercise is to figure out what the default implementations should be: given either traverse or sequenceA, how would you define the other three methods?</p>\n</blockquote>\n\n<p>I came up with the following code that type-checks:</p>\n\n<pre><code>class (Functor t, Foldable t) =&gt; MyTraversable t where\n  traverse'  :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\n  traverse' = error \"...\"\n  sequenceA' :: Applicative f =&gt; t (f a) -&gt; f (t a)\n  sequenceA' f = traverse' id f\n  mapM      ::       Monad m =&gt; (a -&gt; m b) -&gt; t a -&gt; m (t b)\n  mapM = traverse'\n  sequence'  ::       Monad m =&gt; t (m a) -&gt; m (t a)\n  sequence' = sequenceA'\n</code></pre>\n\n<p>If my implementations of <code>mapM</code> and <code>sequence'</code> are correct, and, since every Monad is an Applicative:</p>\n\n<pre><code>\u03bb: :i Monad\nclass Applicative m =&gt; Monad (m :: * -&gt; *) where\n...\n</code></pre>\n\n<p>then it's not clear to me why <code>mapM</code> and <code>sequence'</code> are even necessary. Why are they?</p>\n\n<p>P.S. - Credit and my thanks to <a href=\"https://stackoverflow.com/users/3963/haoformayor\">haoformayor</a> for helping me out with <a href=\"https://stackoverflow.com/questions/34460160/implementing-traverse-and-sequencea\"><code>sequenceA</code></a>.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1451252361, "post_id": 34485072, "comment_id": 56712087, "body": "I believe it&#39;s generating a list of prime numbers by seeing if the number in the list comprehension is divisible by the currently found prime numbers."}], "answers": [{"comments": [{"owner": {"reputation": 2708, "user_id": 1757338, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/c5ddddc8fdccc5c2bd49dc74c02a60b7?s=128&d=identicon&r=PG", "display_name": "yeyo", "link": "https://stackoverflow.com/users/1757338/yeyo"}, "edited": false, "score": 1, "creation_date": 1451253252, "post_id": 34485135, "comment_id": 56712353, "body": "thanks I think I got it, uhmm ... so basically the function applies a filter to a list already filtered"}, {"owner": {"reputation": 500, "user_id": 4083857, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/9c8bd38ec7e110919657dfc4163e7862?s=128&d=identicon&r=PG&f=1", "display_name": "FZed", "link": "https://stackoverflow.com/users/4083857/fzed"}, "edited": false, "score": 0, "creation_date": 1451287229, "post_id": 34485135, "comment_id": 56720408, "body": "Very nice blog post from @Carsten on F# interfaces (prime number 23) for F# advent calendar. <a href=\"http://gettingsharper.de/\" rel=\"nofollow noreferrer\">gettingsharper.de</a> . It shows how to simulate rank-2 types in F# with interfaces and object expressions. Of course the syntax is not as clean and fun as Haskell&#39;s... but it&#39;s OK."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 500, "user_id": 4083857, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/9c8bd38ec7e110919657dfc4163e7862?s=128&d=identicon&r=PG&f=1", "display_name": "FZed", "link": "https://stackoverflow.com/users/4083857/fzed"}, "edited": false, "score": 0, "creation_date": 1451318602, "post_id": 34485135, "comment_id": 56734943, "body": "@FZed :D ... I love to get a bit nerdy - there where so much <i>good</i> / <b>real</b> articles I <b>had</b> to do it - but thank you - glad you liked it"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 4, "last_activity_date": 1451252637, "creation_date": 1451252637, "answer_id": 34485135, "question_id": 34485072, "link": "https://stackoverflow.com/questions/34485072/how-does-this-prime-function-actually-work/34485135#34485135", "title": "How does this prime function actually work?", "body": "<p>well the first one is directly form the pattern match <code>p:xs</code> from <code>[2..]</code> - so it's <code>p = 2</code> and <code>xs</code> some thunk</p>\n\n<p>The next needs to evaluate the <code>xs</code> and so it needs to evaluate</p>\n\n<pre><code>[ x | x &lt;- [3..], x `mod` 2 /= 0 ]\n</code></pre>\n\n<p>which will start with <code>x = 3</code> (that is ok with the filter) - so you now have <code>p:xs</code> (remember the recursive definition with <code>filterPrime</code>) with <code>p=3</code> too but this time the <code>xs</code> already are filtered for <code>`mod` 2 /= 0</code> and will now be filtered for <code>3</code> too - this will go on for each found prime - each time you will only look at a remainder of numbers that are not multiples of all the found primes so far.</p>\n\n<p>You see it's a bit like the <a href=\"https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes\" rel=\"nofollow\">sieve of eratosthenes</a> and I guess it's called that too (but there are <a href=\"https://www.cs.hmc.edu/~oneill/papers/Sieve-JFP.pdf\" rel=\"nofollow\">some objections</a> to it)</p>\n"}], "owner": {"reputation": 2708, "user_id": 1757338, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/c5ddddc8fdccc5c2bd49dc74c02a60b7?s=128&d=identicon&r=PG", "display_name": "yeyo", "link": "https://stackoverflow.com/users/1757338/yeyo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 387, "favorite_count": 0, "accepted_answer_id": 34485135, "answer_count": 1, "score": 4, "last_activity_date": 1579125530, "creation_date": 1451252178, "last_edit_date": 1579125530, "question_id": 34485072, "link": "https://stackoverflow.com/questions/34485072/how-does-this-prime-function-actually-work", "title": "How does this prime function actually work?", "body": "<p>Taken from Haskell's home page <a href=\"https://www.haskell.org/\" rel=\"nofollow noreferrer\">https://www.haskell.org/</a></p>\n\n<pre><code>primes = filterPrime [2..] \n  where filterPrime (p:xs) = \n          p : filterPrime [x | x &lt;- xs, x `mod` p /= 0]\n</code></pre>\n\n<p>After several minutes looking at this function, I realized I don't really understand what this function is actually doing, I would like to know what is happening.</p>\n\n<p>But first, this is what I believe is happening:</p>\n\n<p>Because of lazy evaluation, only one member from the list comprehension is taken in each iteration... like so:</p>\n\n<p>1st iteration</p>\n\n<pre><code>2 : filterPrime [x | x &lt;- [3..], x `mod` p /= 0]\n</code></pre>\n\n<p>2nd iteration</p>\n\n<pre><code>2 : 3 : filterPrime [x | x &lt;- [4..], x `mod` p /= 0]\n</code></pre>\n\n<p>3rd iteration</p>\n\n<pre><code>??? :(\n</code></pre>\n"}, {"tags": ["haskell", "pandoc"], "answers": [{"tags": [], "owner": {"reputation": 2306, "user_id": 318976, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/125d810d710271326abfa1a2e3d640e3?s=128&d=identicon&r=PG", "display_name": "stevejb", "link": "https://stackoverflow.com/users/318976/stevejb"}, "is_accepted": false, "score": 9, "last_activity_date": 1451252501, "last_edit_date": 1451252501, "creation_date": 1451252186, "answer_id": 34485073, "question_id": 34484570, "link": "https://stackoverflow.com/questions/34484570/using-pandoc-as-a-library-to-make-a-pdf/34485073#34485073", "title": "Using pandoc as a library to make a PDF", "body": "<p>With great help from #haskell IRC, I was able to get it working. The key was to add my own LaTeX template.  Thus, one can use the following:</p>\n\n<pre><code>export :: (MonadIO m) =&gt; String -&gt;  Pandoc -&gt; m (Either BL.ByteString BL.ByteString)\nexport tmpl pdoc = liftIO $ makePDF \"xelatex\" writeLaTeX (def { writerStandalone = True, writerTemplate = tmpl}) pdoc\n\ngetLetter  = do\n  json &lt;- BL.readFile \"cng_fuel_chicago.json\"\n  let letter = case decode json of\n                    Just stations -&gt; createLetter [s | s &lt;- stations,\n                                        \"Voyager\" `elem` cardsAccepted s]\n                    Nothing       -&gt; error \"Could not decode JSON\"\n  return $ letter\n\n\nmain :: IO ()\nmain = do\n  letter &lt;- getLetter\n  temp &lt;- readFile \"template.tex\"\n  let str_should_have_something = writeLaTeX (def {writerStandalone = True, writerTemplate = temp}) letter\n  print str_should_have_something\n  mybytes &lt;- export temp letter\n\n  case mybytes of Right b -&gt; BL.writeFile \"mypdf.pdf\" b\n                  Left  _ -&gt; putStrLn \"Export error\"\n</code></pre>\n\n<p>To get a template, you can use Pandoc in standalone mode from the shell:</p>\n\n<p><code>\npandoc -D latex &gt; template.tex\n</code></p>\n\n<p>Also, there may be an issue with Pandoc installed using stack, using cabal, and using the system package manger, in terms of finding the default templates. I am not sure exactly how all of this interacts.</p>\n\n<hr>\n\n<p>Fully contained gist <a href=\"https://gist.github.com/stephenjbarr/11c23e99febd19dccfbd\">here</a>. </p>\n"}], "owner": {"reputation": 2306, "user_id": 318976, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/125d810d710271326abfa1a2e3d640e3?s=128&d=identicon&r=PG", "display_name": "stevejb", "link": "https://stackoverflow.com/users/318976/stevejb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 504, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1451252501, "creation_date": 1451248540, "last_edit_date": 1451252144, "question_id": 34484570, "link": "https://stackoverflow.com/questions/34484570/using-pandoc-as-a-library-to-make-a-pdf", "title": "Using pandoc as a library to make a PDF", "body": "<p>Part of a project I am working on involves creating a PDF, using Pandoc. I have the part of the program which makes a PDF. To figure out how to do this, I am trying to modify <code>fuel.hs</code> from <a href=\"https://github.com/jgm/BayHac2014\" rel=\"nofollow\">JGM BayHack 2014</a>.</p>\n\n<p>However, I am having difficulty. I have the following function:</p>\n\n<pre><code>export :: (MonadIO m) =&gt; Pandoc -&gt; m (Either BL.ByteString BL.ByteString)\nexport = liftIO . makePDF \"xelatex\" writeLaTeX  def { writerStandalone = True } \n</code></pre>\n\n<p>In the body of my modified fuel.hs,</p>\n\n<pre><code>  pdfbytes &lt;- export letter\n  print pdfbytes\n</code></pre>\n\n<p>I get the following output:</p>\n\n<pre><code>$ stack runghc fuel.hs\nRun from outside a project, using implicit global project config\nUsing resolver: lts-3.7 from implicit global project's config file: /home/stevejb/.stack/global/stack.yaml\nLeft \"! Emergency stop.\\n&lt;*&gt; /tmp/tex2pdf.8283/input.tex\\n                               \\nNo pages of output.\\nTranscript written on /tmp/tex2pdf.8283/input.log.\\n\"\n\"Fail\"\n</code></pre>\n\n<p>However, the log file that is being referenced does not exist. I am not sure how to debug this. I have xelatex installed.</p>\n\n<hr>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451242342, "post_id": 34483491, "comment_id": 56709344, "body": "While Haskell lists support all the same operations as arrays, referring to them as such is still not quite right. You can get the values at certain indices with <code>map (list !!) [ index1, index2 ]</code> or the values in that range with <code>drop index1.take index2 $ list</code>. Keep in mind that indexing a list is O(n), unlike O(1) for an array."}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451242526, "post_id": 34483491, "comment_id": 56709405, "body": "I am getting error says *** Term           : number2 *** Type           : Maybe Int *** Does not match : Int"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1451242772, "post_id": 34483491, "comment_id": 56709478, "body": "This error is completely unrelated to the question, and doesn&#39;t have any context. If you really like you may post another question regarding this error, but questions that show little to no research effort (like &quot;i get this error - what do&quot;) are generally not well received."}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451242854, "post_id": 34483491, "comment_id": 56709500, "body": "You are right but the answer you gave me basically works for different types of data types rather that i posted in the question. This becomes the responsibility for you to solve that error :)"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451244520, "post_id": 34483491, "comment_id": 56709967, "body": "I think the problem is drop and take works with maybe int type but i am holding indexes as regular int. Can you give a more concrete and &quot;for int type&quot; solution if possible?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451247236, "post_id": 34483491, "comment_id": 56710592, "body": "You&#39;ve got it backwards - <code>take, drop :: Int -&gt; [a] -&gt; [a]</code> while <code>elemIndex :: Eq a =&gt; a -&gt; [a] -&gt; Maybe Int</code>. If you want to get an <code>Int</code> from a <code>Maybe Int</code>, you can use a case statement or <code>maybe :: a -&gt; (x -&gt; a) -&gt; Maybe x -&gt; a</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1451248121, "post_id": 34483491, "comment_id": 56710846, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/99070/discussion-between-user2407038-and-user3104760\">continue this discussion in chat</a>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1451258882, "post_id": 34483491, "comment_id": 56713902, "body": "@user3104760 No, it is no one else&#39;s responsibility but yours to solve your problems."}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1451242111, "post_id": 34483623, "comment_id": 56709280, "body": "Can i do that in one line and with using just one list?"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1451242363, "post_id": 34483623, "comment_id": 56709347, "body": "let new_array = takeWhile (/= &quot;IV THE MOST INTELLIGENT ANIMALS&quot;)    $ dropWhile (/= &quot;I THE LAY OF THE LAND&quot;) all_paragraphs print new_array  Gives an error with that code. What can be the problem?"}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "reply_to_user": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 1, "creation_date": 1451242594, "post_id": 34483623, "comment_id": 56709423, "body": "Haskell takes a slightly different mindset than more traditional programming languages ;) (stop calling lists arrays, they&#39;re really not the same thing!) I&#39;d recommend playing around with <code>ghci</code> first, before messing with IO, <code>puts</code> and <code>print</code>. A good place to start is <a href=\"http://learnyouahaskell.com\" rel=\"nofollow noreferrer\">learnyouahaskell.com</a>"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1451242717, "post_id": 34483623, "comment_id": 56709464, "body": "Sorry about that. I am looking for a shortcut way for the problem :)"}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "reply_to_user": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1451242894, "post_id": 34483623, "comment_id": 56709506, "body": "Do you want a quick solution or learn to program Haskell? :P I don&#39;t see the point in you having a program that works, if you don&#39;t understand why it works."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 1, "creation_date": 1451242922, "post_id": 34483623, "comment_id": 56709513, "body": "@user3104760 What does &quot;Gives an error with that code&quot; mean? What code?"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1451243003, "post_id": 34483623, "comment_id": 56709538, "body": "I want it to work the way i want it to and i want to make it in a single line in which i can declare the upper and lower bound. What do you mean by without understanding?"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "reply_to_user": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1451243039, "post_id": 34483623, "comment_id": 56709549, "body": "@CRDrost that error is gone it was a simple syntax error my mistake :)"}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "reply_to_user": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1451254999, "post_id": 34483623, "comment_id": 56712858, "body": "@user3104760 I meant that it doesn&#39;t help you much if I give you the correct code but you don&#39;t understand why it works. I expanded the answer a bit."}], "tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": true, "score": 2, "last_activity_date": 1451254788, "last_edit_date": 1451254788, "creation_date": 1451241775, "answer_id": 34483623, "question_id": 34483491, "link": "https://stackoverflow.com/questions/34483491/splitting-arrays-in-haskell/34483623#34483623", "title": "splitting arrays in haskell", "body": "<p>You're probably talking about lists, not arrays, since there are no arrays in Haskell's Prelude and <a href=\"http://hackage.haskell.org/package/base/docs/Prelude.html#v:lines\" rel=\"nofollow\">lines</a> returns <code>[String]</code>, i.e. a list of Strings.</p>\n\n<p>So you want to get the sublist from index <code>n</code> to index <code>m</code> of a list? You can do that with a combination of <a href=\"http://hackage.haskell.org/package/base/docs/Prelude.html#v:drop\" rel=\"nofollow\">drop</a> and <a href=\"http://hackage.haskell.org/package/base/docs/Prelude.html#v:take\" rel=\"nofollow\">take</a>.</p>\n\n<p>However, this is not idiomatic functional programming where explicitly dealing with indices is discouraged, since it's error prone (e.g. off-by-one errors) and there are better ways. So it seems you want to get all the lines between the line <code>I THE LAY OF THE LAND</code> and the line <code>IV THE MOST INTELLIGENT ANIMALS</code>. You'd do that in idiomatic Haskell with:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  content &lt;- readFile \"/tmp/foo.txt\"\n  let ls = excerpt $ lines content\n  -- the dollar just rearranges precedence, so this is the same as:\n  -- ... = excerpt (lines content)\n  print ls\n\n-- do as little as possible in monads (the thing with `do ... let &lt;- ...` etc)\n-- rather define pure functions like this one and use them above...\nexcerpt :: [String] -&gt; [String]\nexcerpt xs = takeWhile (/= \"IV THE MOST INTELLIGENT ANIMALS\")\n  $ dropWhile (/= \"I THE LAY OF THE LAND\") xs\n\n-- the excerpt function could alternatively also be written as\n-- the composition of `takeWhile x` and `dropWhile y`\nexcerpt :: [String] -&gt; [String]\nexcerpt = takeWhile (/= \"IV THE MOST INTELLIGENT ANIMALS\")\n  . dropWhile (/= \"I THE LAY OF THE LAND\")\n</code></pre>\n\n<p>But you really should read up on how Haskell (and functional programming in general) take a different approach to solving problems than imperative languages. Maybe <a href=\"https://tryhaskell.org\" rel=\"nofollow\">Try Haskell</a> is more to your liking, and if you wonder what a function does (or are looking for one), <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow\">Hoogle</a> is indispensable.</p>\n"}, {"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 0, "last_activity_date": 1451246614, "creation_date": 1451246614, "answer_id": 34484296, "question_id": 34483491, "link": "https://stackoverflow.com/questions/34483491/splitting-arrays-in-haskell/34484296#34484296", "title": "splitting arrays in haskell", "body": "<p>Like @mb21 indicates but does not state outright, what you are looking for is a simple sequence of <code>drop</code> and <code>take</code>. </p>\n\n<p>For example, defining in your program</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>slice list lo hi = drop lo (take hi list)\n</code></pre>\n\n<p>will let you do slices of the form that you're used to in JavaScript and Python, and you could also define it with an infix operator and a pair, if you wanted. Let's say we want to use <code>.!</code> for a slice operator, and handle negative arguments like in JS and Python; we then define at the top level:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>list .! (lo, hi) = drop l $ take h list\n  where\n    len = length list\n    handle_negative x | x &lt; 0 = x + len | otherwise = x\n    h = handle_negative hi\n    l = handle_negative lo\n</code></pre>\n\n<p>This should work on any finite list; negative indices will in general screw up potentially infinite lists: though this problem is removable for the second index it is essential for the first one. So for example to do the slice <code>[0..] .! (1, -2)</code> which should be equivalent to <code>[1..]</code> you would in general need to keep <code>list</code> and <code>drop (-last_index) list</code> which you travel down together, emitting elements of the first while the second is not <code>[]</code>.</p>\n"}], "owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 492, "favorite_count": 0, "accepted_answer_id": 34483623, "answer_count": 2, "score": -2, "last_activity_date": 1563081089, "creation_date": 1451240912, "last_edit_date": 1563081089, "question_id": 34483491, "link": "https://stackoverflow.com/questions/34483491/splitting-arrays-in-haskell", "title": "splitting arrays in haskell", "body": "<p>I am trying to do divide an array of strings into sub arrays. I am trying like the following;</p>\n\n<pre><code>content &lt;- readFile \"/tmp/foo.txt\"\nlet all_paragraphs = lines content\nlet number = elemIndex \"I THE LAY OF THE LAND\" all_paragraphs\nlet number2 = elemIndex \"IV THE MOST INTELLIGENT ANIMALS\" all_paragraphs\n</code></pre>\n\n<p>Is it possible to parse the content to an array like;\nlet new_array = all_paragraphs[number,number2] or let new_Array = all_paragraphs(number:number2) a code similar to that?  </p>\n"}, {"tags": ["user-interface", "haskell", "gtk2hs"], "comments": [{"owner": {"reputation": 1826, "user_id": 4389432, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RcLKe.png?s=128&g=1", "display_name": "Paulo Soares", "link": "https://stackoverflow.com/users/4389432/paulo-soares"}, "edited": false, "score": 0, "creation_date": 1451239180, "post_id": 34483176, "comment_id": 56708399, "body": "This looks more like asking for a tutorial than asking a concrete question."}, {"owner": {"reputation": 35, "user_id": 2801969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9542ee07378425326ecb553fba3b90c?s=128&d=identicon&r=PG&f=1", "display_name": "mani", "link": "https://stackoverflow.com/users/2801969/mani"}, "reply_to_user": {"reputation": 1826, "user_id": 4389432, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RcLKe.png?s=128&g=1", "display_name": "Paulo Soares", "link": "https://stackoverflow.com/users/4389432/paulo-soares"}, "edited": false, "score": 0, "creation_date": 1451240577, "post_id": 34483176, "comment_id": 56708805, "body": "Ok. How to change the content of a box, can you delete a widget from it? If yes, how? (Or if you know a good tutorial where I can find the answer, that would help a lot too...)"}], "answers": [{"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": true, "score": 1, "last_activity_date": 1451243594, "creation_date": 1451243594, "answer_id": 34483883, "question_id": 34483176, "link": "https://stackoverflow.com/questions/34483176/changing-window-layout-in-gtk2hs/34483883#34483883", "title": "Changing window layout in gtk2hs", "body": "<blockquote>\n  <p>How to change the content of a box, can you delete a widget from it? If yes, how?</p>\n</blockquote>\n\n<p>Use <code>widgetDestroy</code>. See for example <a href=\"http://projects.haskell.org/gtk2hs/docs/tutorial/glade/\" rel=\"nofollow\">this tutorial</a>.</p>\n"}], "owner": {"reputation": 35, "user_id": 2801969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9542ee07378425326ecb553fba3b90c?s=128&d=identicon&r=PG&f=1", "display_name": "mani", "link": "https://stackoverflow.com/users/2801969/mani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 34483883, "answer_count": 1, "score": 0, "last_activity_date": 1451243594, "creation_date": 1451238753, "question_id": 34483176, "link": "https://stackoverflow.com/questions/34483176/changing-window-layout-in-gtk2hs", "title": "Changing window layout in gtk2hs", "body": "<p>I am making an applocation to demonstrate some algorithms, and I am using gtk2hs. When the user selects an algorithm, I want the whole window to change (different layout, input, output interface...). How could I do that? For example, is it possible to change the widget in a container? I tried a table but could not changed the content of a cell, so that doesn't seem like a good idea.\nAlso I want to change the number of input fields according to another input field, and that seems like the same problem for me (removing widgets from a box) but it might be totally different in terms of solution.\nThanks</p>\n"}, {"tags": ["haskell", "selenium-webdriver", "webdriver"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 5720976, "user_type": "registered", "profile_image": "https://graph.facebook.com/993552074017023/picture?type=large", "display_name": "Pedro Sobreiro", "link": "https://stackoverflow.com/users/5720976/pedro-sobreiro"}, "edited": false, "score": 0, "creation_date": 1451299630, "post_id": 34483299, "comment_id": 56725772, "body": "Hi, considering that I have made findElement and passing the result to executeJS using pageitem       <code>executeJS [pageItem] &quot;arguments[0].style.visibility = &#39;visible&#39;;&quot;</code>   I am using GHCi, which throws me an error:       Couldn&#39;t match expected type JSArg&#39; with actual type `Element   The first parameter shouldn&#39;t convert the webdriver element to a DOM element and execute it sucessfully?   Thanks"}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 1, "user_id": 5720976, "user_type": "registered", "profile_image": "https://graph.facebook.com/993552074017023/picture?type=large", "display_name": "Pedro Sobreiro", "link": "https://stackoverflow.com/users/5720976/pedro-sobreiro"}, "edited": false, "score": 0, "creation_date": 1451315906, "post_id": 34483299, "comment_id": 56733495, "body": "@PedroSobreiro Sorry, I screwed that up. Try <code>[JSArg pageItem]</code> rather than just <code>pageItem</code> there."}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 0, "last_activity_date": 1451315923, "last_edit_date": 1451315923, "creation_date": 1451239655, "answer_id": 34483299, "question_id": 34482562, "link": "https://stackoverflow.com/questions/34482562/how-to-change-the-visibility-using-haskell-webdriver/34483299#34483299", "title": "How to change the visibility using Haskell webdriver", "body": "<p>I don't see any explicit change-CSS stuff in the <code>webdriver</code> package so you'll have to use the swiss-army-knife they provide: </p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- |An existential wrapper for any 'ToJSON' instance. This allows us to pass\n-- parameters of many different types to Javascript code.\ndata JSArg = forall a. ToJSON a =&gt; JSArg a\n\ninstance ToJSON JSArg where\n  toJSON (JSArg a) = toJSON a\n\n{- |Inject a snippet of Javascript into the page for execution in the\ncontext of the currently selected frame. The executed script is\nassumed to be synchronous and the result of evaluating the script is\nreturned and converted to an instance of FromJSON.\n\nThe first parameter defines a sequence of arguments to pass to the javascript\nfunction. Arguments of type Element will be converted to the\ncorresponding DOM element. Likewise, any elements in the script result\nwill be returned to the client as Elements.\n\nThe second parameter defines the script itself in the form of a\nfunction body. The value returned by that function will be returned to\nthe client. The function will be invoked with the provided argument\nlist and the values may be accessed via the arguments object in the\norder specified.\n-}\nexecuteJS :: (F.Foldable f, FromJSON a, WebDriver wd) =&gt; f JSArg -&gt; Text -&gt; wd a\nexecuteJS a s = fromJSON' =&lt;&lt; getResult\n  where\n    getResult = doSessCommand methodPost \"/execute\" . pair (\"args\", \"script\") $ (F.toList a,s)\n</code></pre>\n\n<p>According to this documentation, the correct command is something like:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>executeJS [JSArg pageItem] \"arguments[0].style.visibility = 'visible';\"\n</code></pre>\n\n<p>This will, of course, fail in a couple other circumstances: most notably, when an element is made invisible by <code>display: none</code> rather than <code>visibility: hidden</code>; for the former you may need to inspect what the web page actually does with these elements, since there is a style-difference between <code>display: block</code> and <code>display: inline</code> and you don't necessarily know which one causes the link to display correctly.</p>\n"}], "owner": {"reputation": 1, "user_id": 5720976, "user_type": "registered", "profile_image": "https://graph.facebook.com/993552074017023/picture?type=large", "display_name": "Pedro Sobreiro", "link": "https://stackoverflow.com/users/5720976/pedro-sobreiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1451315923, "creation_date": 1451234768, "last_edit_date": 1451238041, "question_id": 34482562, "link": "https://stackoverflow.com/questions/34482562/how-to-change-the-visibility-using-haskell-webdriver", "title": "How to change the visibility using Haskell webdriver", "body": "<p>I have started using Haskell and to improve the adaptation to the language I want to develop an application to automate the submission of the information to an web site. I need to simulate a click using selenium webdriver. Unfortunately I am stuck in an error caused by the element I want to click not being visible. How do I change following div visibility using an haskell webdriver command:</p>\n\n<pre><code>div id=\"DynObject129\" \n    style=\"left: 3px; top: 47px; z-index: 1000; cursor: auto; \n           background-color: rgb(241, 239, 226); border-radius: 5px;\n           visibility: hidden; border-width: 2px; border-style: solid;\n           border-color: rgb(32, 107, 164); overflow: hidden; \n           position: absolute; width: 310px; height: 313px;\"\n</code></pre>\n\n<p>The exception is throwed after the execution of the following command:</p>\n\n<pre><code>pageItem &lt;- findElem (ById \"DynObject129\") \nclick pageItem  \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1451234816, "post_id": 34482540, "comment_id": 56706935, "body": "Type families are not for dummies, unfortunately. Even Richard Eisenberg, a top GHC type system developer, finds some aspects a bit hard to pin down. However, I can try to show some basic things, I suppose."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1451250534, "post_id": 34482540, "comment_id": 56711557, "body": "@dfeuer: luckily there&#39;s a difference between grasping some simple examples of something, and properly pinning down all aspects of it."}], "answers": [{"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1451236585, "post_id": 34482630, "comment_id": 56707570, "body": "I don&#39;t quite understand the line : <code>Plus (&#39;S x) y = &#39;S (Plus x y)</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1451237147, "post_id": 34482630, "comment_id": 56707755, "body": "@jhegedus, <code>&#39;S</code> is the type constructor that <code>DataKinds</code> creates from the data constructor <code>S</code>. You can leave out the <code>&#39;</code>, but its use is encouraged. That line says, essentially, <code>(1 + x) + y = 1 + (x + y)</code>."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 1, "creation_date": 1451237588, "post_id": 34482630, "comment_id": 56707891, "body": "So with type families I can have pattern matching and recursion on the type level ? Lifting pattern matching and recursion to type level ? So a type family is basically a fully blown function at the type level ?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1451238336, "post_id": 34482630, "comment_id": 56708133, "body": "@jhegedus, Up to a point, yes. The pattern matching, however, is done by type unification, so it doesn&#39;t always work quite the way you might expect. You can, for example, use the same type variable twice in the left-hand side. More annoyingly, sometimes GHC can&#39;t reduce a type far enough to match a pattern, leading to somewhat confusing errors and more confusing work-arounds. For example, if is used <code>Plus (&#39;S m) n = Plus m (&#39;S n)</code>, I&#39;d have run into trouble defining <code>append</code>."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1451239009, "post_id": 34482630, "comment_id": 56708350, "body": "This was a pretty nice intro to type families in 5 min, thanks again !"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 1, "creation_date": 1451240367, "post_id": 34482630, "comment_id": 56708742, "body": "Ahh, so in the second Box example, the return type of <code>elem</code> depends on the actual instance ? In this sense we use type families again to define a type level function ? Now the domain of that function (Elem b) is {Char, Identity a} . I wonder if the type of <code>elem</code> should be <code>b-&gt; Elem b</code> ?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1451240440, "post_id": 34482630, "comment_id": 56708764, "body": "@jhegedus, that&#39;s what I meant."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 8, "last_activity_date": 1451245062, "last_edit_date": 1451245062, "creation_date": 1451235285, "answer_id": 34482630, "question_id": 34482540, "link": "https://stackoverflow.com/questions/34482540/type-families-for-dummies/34482630#34482630", "title": "Type families for dummies", "body": "<p>Here's an example:</p>\n\n<pre><code>{-# Language TypeFamilies, DataKinds, KindSignatures, GADTs, UndecidableInstances #-}\n\ndata Nat = Z | S Nat\n\ntype family Plus (x :: Nat) (y :: Nat) :: Nat where\n  Plus 'Z y = y\n  Plus ('S x) y = 'S (Plus x y)\n\ndata Vec :: Nat -&gt; * -&gt; * where\n  Nil :: Vec 'Z a\n  Cons :: a -&gt; Vec n a -&gt; Vec ('S n) a\n\nappend :: Vec m a -&gt; Vec n a -&gt; Vec (Plus m n) a\nappend Nil ys = ys\nappend (Cons x xs) ys = Cons x (append xs ys)\n</code></pre>\n\n<p>Note that many/most interesting applications of type families require <code>UndecidableInstances</code>. You should not be scared of this extension.</p>\n\n<hr>\n\n<p>Another useful sort of type family is one associated with a class. For a really contrived example,</p>\n\n<pre><code>class Box b where\n  type Elem b :: *\n  elem :: b -&gt; Elem b\n</code></pre>\n\n<p>An instance of <code>Box</code> is a type that something can be pulled out of. For instance,</p>\n\n<pre><code>instance Box (Identity x) where\n  type Elem (Identity x) = x\n  elem = runIdentity\n\ninstance Box Char where\n  type Elem Char = String\n  elem c = [c]\n</code></pre>\n\n<p>Now <code>elem (Identity 3) = 3</code> and <code>elem 'x' = \"x\"</code>.</p>\n\n<p>You can also use type families to make weird skolem variables. This is best done in the as-yet-unreleased GHC 8.0.1, where it will look like</p>\n\n<pre><code>type family Any :: k where {}\n</code></pre>\n\n<p><code>Any</code> is a peculiar type. It's uninhabited, it can't be (specifically) an instance of a class, and it's poly-kinded. This turns out to be really useful for certain purposes. This particular type is advertised as a safe target for <code>unsafeCoerce</code>, but <code>Data.Constraint.Forall</code> uses similar type families for more interesting purposes.</p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 1, "accepted_answer_id": 34482630, "answer_count": 1, "score": 4, "last_activity_date": 1451245062, "creation_date": 1451234658, "question_id": 34482540, "link": "https://stackoverflow.com/questions/34482540/type-families-for-dummies", "title": "Type families for dummies", "body": "<p>Could someone give a super simple (few line) example to get a basic understanding about what type families can be used for and what are they ?</p>\n\n<p>The 2+2 kind of example of type families ?</p>\n"}, {"tags": ["haskell", "monads", "reader-monad"], "comments": [{"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 1, "creation_date": 1451242607, "post_id": 34482124, "comment_id": 56709427, "body": "Why do you <b>want</b> <code>runReader testTwo &quot;mate&quot;</code> to be a valid syntax for producing anything, as distinct from, say, <code>id testTwo &quot;mate&quot;</code>? Note that <code>(-&gt;) r</code> is not an &quot;instance of the Reader monad&quot; but rather that it is a &quot;monad which does the exact same thing as the Reader monad.&quot; But we need to know in order to help you: are you interfacing with something which will take a <code>Reader r x</code> as an argument? Or do you need code which is polymorphic and will both accept a <code>Reader r x</code> and an <code>r -&gt; x</code> function? Or what?"}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "reply_to_user": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1451247562, "post_id": 34482124, "comment_id": 56710691, "body": "@CRDrost it was more of a &quot;in case I have something that uses both things&quot; kinda question, having one unified runner would be useful. But I guess since the entire question is guided by a misleading statement, I don&#39;t really need it?"}], "answers": [{"comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1451233619, "post_id": 34482214, "comment_id": 56706533, "body": "using it as a function defeats the purpose of what I&#39;m trying to accomplish though"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 2, "creation_date": 1451234162, "post_id": 34482214, "comment_id": 56706716, "body": "Probably whoever told you &quot;(-&gt;) r is an instance of the Reader monad&quot; meant that it is an instance of <code>MonadReader</code> (alternately, they could have meant it&#39;s isomorphic to the <code>Reader</code> type). So you can write <code>testAbstract :: MonadReader m =&gt; m String String</code> with the same definition. But there is no general way to &quot;run&quot; a <code>MonadReader</code>."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1451236410, "post_id": 34482214, "comment_id": 56707511, "body": "I&#39;ve expanded the answer to show how you could <i>create</i> such an abstraction."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451238885, "post_id": 34482214, "comment_id": 56708309, "body": "Will those <code>Output</code> instances really be accepted? Don&#39;t they take too many indices? Or am I confused?"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451241909, "post_id": 34482214, "comment_id": 56709201, "body": "@dfeuer Note the kind of <code>Output m</code>. You could also write is as <code>type Output m a :: *</code>. There is a similar example with <code>data GMap k</code> in the linked documentation."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451242048, "post_id": 34482214, "comment_id": 56709259, "body": "@dfeuer You are right about the edit, though; thanks!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451244377, "post_id": 34482214, "comment_id": 56709933, "body": "I haven&#39;t tried compiling it yet, but I&#39;m surprised. A free-standing type family <code>type family Foo a :: * -&gt; *</code> will, I believe, only accept instances that reduce to first-class types of that kind. So <code>type instance Foo Int = Either Bool</code>, but not <code>type instance Foo Int a = a</code>."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451247166, "post_id": 34482214, "comment_id": 56710574, "body": "@dfeuer I may be confused myself, but I can&#39;t test it today. If it doesn&#39;t work, I think <code>type Output m a :: *</code> should?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451357681, "post_id": 34482214, "comment_id": 56749540, "body": "I tried compiling it; no dice. A partially applied data family is &quot;first class&quot;. A partially applied type family, on he other hand, is second-class like a partially applied type synonym."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 2, "last_activity_date": 1451346777, "last_edit_date": 1451346777, "creation_date": 1451232543, "answer_id": 34482214, "question_id": 34482124, "link": "https://stackoverflow.com/questions/34482124/understanding-r-as-instance-of-reader/34482214#34482214", "title": "Understanding (-&gt;) r as instance of Reader", "body": "<p><code>runReader :: Reader r a -&gt; r -&gt; a</code> is specifically for <code>Reader</code> newtype, which you want to avoid. Since <code>testTwo</code> is just a function, you simply use <code>testTwo \"mate\"</code>.</p>\n\n<p>If you want a generic way to run <code>MonadReader</code>, you could define your own type class for this. Approximately like this (untested):</p>\n\n<pre><code>class MonadReader r m =&gt; RunReader r m | m -&gt; r where\n  type Output m a :: *\n  runReader' :: m a -&gt; r -&gt; Output m a\n\ninstance RunReader r ((-&gt;) r) where\n  type Output ((-&gt;) r) a = a\n  runReader' = ($)\n\ninstance Monad m =&gt; RunReader r (ReaderT r m) where\n  type Output (ReaderT r m) a = m a\n  runReader' = runReaderT\n\ninstance RunReader r m =&gt; RunReader r (MaybeT m) where\n  type Output (MaybeT m) a = Output m (Maybe a)\n  runReader' = runMaybeT . runReader'\n\n-- any other instances\n</code></pre>\n\n<p>and then <code>runReader' testOne</code> and <code>runReader' testTwo</code> will work. See <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/type-families.html\" rel=\"nofollow\">\"Associated data and type families\"</a> for an explanation of use of <code>type</code> here.</p>\n"}, {"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 3, "last_activity_date": 1451233498, "creation_date": 1451233498, "answer_id": 34482352, "question_id": 34482124, "link": "https://stackoverflow.com/questions/34482124/understanding-r-as-instance-of-reader/34482352#34482352", "title": "Understanding (-&gt;) r as instance of Reader", "body": "<p>The type of <code>runReader</code> is <code>runReader :: ReaderT r Identity -&gt; r -&gt; a</code>, if you expand out the <code>newtype Reader = ReaderT r Identity</code>. I think you want something very generic, along the lines of this:</p>\n\n<pre><code>foo :: (MonadReader r m) =&gt; m a -&gt; r -&gt; a\n</code></pre>\n\n<p>So that you could evaluate both <code>foo testOne \"there\"</code> and <code>foo testTwo \"mate\"</code>.</p>\n\n<p>Unfortunately, no such function exists. The <code>mtl</code> library's job is to abstract the choice of the underlying concrete type. Both <code>(-&gt;) String</code> and <code>Reader String = ReaderT String Identity</code> are concrete types that obey the <code>Monad</code> and <code>MonadReader</code> laws, but that only guarantees you an interface of <code>return</code>, <code>&gt;&gt;=</code>, <code>ask</code>, <code>reader</code>, and <code>local</code> (and <code>&lt;$&gt;</code>, <code>&lt;*&gt;</code>, <code>pure</code>).</p>\n\n<p>This is both limiting and useful!</p>\n\n<p>Limiting: In order to \"run\" the computation represented by either type, you need to use the appropriate type-specific API. For <code>(-&gt;) String</code>, that's simply calling the function (the invisible <code></code> function application operator); for <code>Reader String</code>, that's <code>runReader</code>.</p>\n\n<p>Useful: you can expose, with a library, values constrained by <code>MonadReader</code>, knowing that users will only be able to use them with the <code>MonadReader</code> interface. This is nice, as you can use this trick to make sure that users aren't doing anything untoward, like doing early runs of your values with their own environments (<code>r</code>'s).</p>\n"}], "owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "closed_date": 1451507728, "answer_count": 2, "score": 0, "last_activity_date": 1451346777, "creation_date": 1451231870, "question_id": 34482124, "link": "https://stackoverflow.com/questions/34482124/understanding-r-as-instance-of-reader", "closed_reason": "Duplicate", "title": "Understanding (-&gt;) r as instance of Reader", "body": "<p>So I'm told <code>(-&gt;) r</code> is an instance of the Reader monad, but I can't seem to find any concrete examples of how this is supposed to work. I want to use this without having to explicitly wrap some of my code in a Reader</p>\n\n<pre><code>import Control.Monad.Reader\n\ntestOne :: Reader String String\ntestOne = do\n  env &lt;- ask\n  return $ \"Hello, \" ++ env\n\ntestTwo :: String -&gt; String\ntestTwo = do\n  env &lt;- ask\n  return $ \"G'day, \" ++ env\n</code></pre>\n\n<p>Running <code>runReader testOne \"there\"</code> works fine, but running <code>runReader testTwo \"mate\"</code> fails spectacularly with the following message:</p>\n\n<pre><code>Couldn't match type \u2018String -&gt; String\u2019\n                   with \u2018ReaderT [Char] Data.Functor.Identity.Identity a\u2019\n    Expected type: Reader [Char] a\n      Actual type: String -&gt; String\n</code></pre>\n\n<p>So what am I missing here? </p>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 1727, "user_id": 770765, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f59a96986770cf3a804ed63526c13ae2?s=128&d=identicon&r=PG", "display_name": "Aky", "link": "https://stackoverflow.com/users/770765/aky"}, "edited": false, "score": 0, "creation_date": 1451228737, "post_id": 34481532, "comment_id": 56705040, "body": "It&#39;s been a while since I used Haskell, but something like <code>map (\\m -&gt; fight(player, m)) monsterList</code> ought to work. BTW, if you defined your <code>fight</code> to simply take two arguments instead of a tuple, (i.e. so it could be called as <code>fight fighter1 fighter2</code> ) then the answer would be neater (IMO): <code>map (fight player) monsterList</code>"}, {"owner": {"reputation": 123, "user_id": 4227771, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1132754165/picture?type=large", "display_name": "Hassan Ali", "link": "https://stackoverflow.com/users/4227771/hassan-ali"}, "reply_to_user": {"reputation": 1727, "user_id": 770765, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f59a96986770cf3a804ed63526c13ae2?s=128&d=identicon&r=PG", "display_name": "Aky", "link": "https://stackoverflow.com/users/770765/aky"}, "edited": false, "score": 0, "creation_date": 1451229925, "post_id": 34481532, "comment_id": 56705444, "body": "It&#39;s part of a college exercise so we were already given the fight function to take a tuple..thanks for the answer! I shall give it a shot! :)"}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": false, "score": 1, "last_activity_date": 1451232619, "last_edit_date": 1451232619, "creation_date": 1451231089, "answer_id": 34482007, "question_id": 34481532, "link": "https://stackoverflow.com/questions/34481532/need-help-figuring-out-a-function-in-haskell/34482007#34482007", "title": "Need help figuring out a function in Haskell", "body": "<p>You probably want a fold, a map, or \ud83c\udf1fboth\ud83c\udf1f. Given:</p>\n\n\n\n<pre><code>class Combatant a where\n  health  :: a -&gt; Int\n  attack  :: a -&gt; Int\n  defense :: a -&gt; Int\n  damage  :: a -&gt; Int -&gt; a\n\ndata Person = Person { personHP :: Int } deriving Show\ndata Monster = Monster { monsterHP :: Int } deriving Show\n\n-- We will assume for time that your HP determines your attack.\ninstance Combatant Person where\n  health = personHP\n  attack = personHP\n  defense _ = 0\n  damage (Person hp) dmg = Person (hp - dmg)\n\ninstance Combatant Monster where\n  health = monsterHP\n  attack = monsterHP\n  defense _ = 0\n  damage (Monster hp) dmg = Monster (hp - dmg)\n\nfight :: (Combatant a, Combatant b) =&gt; a -&gt; b -&gt; (a, b)\nfight fighter1 fighter2 =\n  let damageTo1 = attack fighter2 - defense fighter1\n      damageTo2 = attack fighter1 - defense fighter2\n  in (damage fighter1 damageTo1, damage fighter2 damageTo2)\n</code></pre>\n\n<p>To do this, it's best to split up <code>fight</code> so that it only returns the first combatant. As <code>fight</code> is symmetrical, we can figure out what happens to the second combatant by reversing the order of our arguments. That looks like this</p>\n\n<pre><code>fight :: (Combatant a, Combatant b) =&gt; a -&gt; b -&gt; a\nfight fighter1 fighter2 =\n  damage fighter1 (attack fighter2 - defense fighter1)\n</code></pre>\n\n<p>and this</p>\n\n<pre><code>\u03bb&gt; fight (Person 10) (Monster 5)\nPerson {personHP = 5}\n\u03bb&gt; (flip fight) (Person 10) (Monster 5)\nMonster {monsterHP = -5}\n\u03bb&gt; fight (Monster 5) (Person 10)\nMonster {monsterHP = -5}\n</code></pre>\n\n<p>Given a list of monsters and a single person:</p>\n\n<pre><code>\u03bb&gt; let person = Person 15\n\u03bb&gt; let monsters = map Monster [1..4]\n\u03bb&gt; monsters\n[Monster {monsterHP = 1},Monster {monsterHP = 2},Monster {monsterHP = 3},Monster {monsterHP = 4}]\n</code></pre>\n\n<p>We're probably interested in asking two questions:</p>\n\n<ul>\n<li>What happens to the player after her encounter with all the monsters?</li>\n<li>What happens to each monster after her encounter with the player?</li>\n</ul>\n\n<p>The second question is dispatched with a map, as @Aky mentioned.</p>\n\n<pre><code>\u03bb&gt; map (`fight` person) monsters\n[Monster {monsterHP = -14},Monster {monsterHP = -13},Monster {monsterHP = -12},Monster {monsterHP = -11}]\n</code></pre>\n\n<p>Ouch. Whereas the answer to the first question might look like this:</p>\n\n<pre><code>\u03bb&gt; fight (fight (fight person (monsters !! 0)) (monsters !! 1)) (monsters !! 2) -- ... ugh, how tiresome ...\n</code></pre>\n\n<p>But this is what functional programmers call a <em>fold left</em>, which in Haskell goes by the <code>foldl'</code> function (ignore the baroque apostrophe).</p>\n\n<pre><code>\u03bb&gt; foldl' _ person monsters    \n&lt;interactive&gt;:137:8:\n    Found hole \u2018_\u2019 with type: Person -&gt; Monster -&gt; Person\n\u03bb&gt; foldl' fight person monsters\nPerson {personHP = 5}\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 4227771, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1132754165/picture?type=large", "display_name": "Hassan Ali", "link": "https://stackoverflow.com/users/4227771/hassan-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1451232619, "creation_date": 1451227755, "question_id": 34481532, "link": "https://stackoverflow.com/questions/34481532/need-help-figuring-out-a-function-in-haskell", "title": "Need help figuring out a function in Haskell", "body": "<p>So I have a function fight,which takes two objects in the following manner:</p>\n\n<pre><code>fight :: (Combatant a, Combatant b) =&gt; (a, b) -&gt; (a, b)\nfight (fighter1, fighter2) =\nlet damageTo1 = ((attack fighter2) - (defense fighter1))\n  damageTo2 = ((attack fighter1) - (defense fighter2))\n in (damage fighter1 damageTo1, damage fighter2 damageTo2)\n</code></pre>\n\n<p>The combatant class is as follows:</p>\n\n<pre><code> class Combatant a where\n health  :: a -&gt; Int\n attack  :: a -&gt; Int\n defense :: a -&gt; Int\n level   :: a -&gt; Int\n damage  :: a -&gt; Int -&gt; a\n</code></pre>\n\n<p>I have two object types, Player, and Monster.\nThe player has to fight monsters around him,so the monsters are actually in a list like [Monster1,Monster2,Monster3,Monster4...etc]\nand the player has to fight each single one.. so the function calls would go something like  </p>\n\n<pre><code>  fight(player,Monster1)\n  fight(player,Monster2)....etc..\n</code></pre>\n\n<p>However,I am not exactly sure how to make that happen ..I thought a function like map would be useful here but I'm not sure.. Ideas would be appreciated :)</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 108986, "user_id": 511529, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YNRmY.jpg?s=128&g=1", "display_name": "GolezTrol", "link": "https://stackoverflow.com/users/511529/goleztrol"}, "edited": false, "score": 1, "creation_date": 1451210185, "post_id": 34479334, "comment_id": 56700347, "body": "Related: <a href=\"http://stackoverflow.com/questions/17719620/while-loop-in-haskell-with-a-condition\">While loop in Haskell with a condition</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1747, "user_id": 1971462, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qCUpC.jpg?s=128&g=1", "display_name": "Michael Rawson", "link": "https://stackoverflow.com/users/1971462/michael-rawson"}, "edited": false, "score": 0, "creation_date": 1451210645, "post_id": 34479379, "comment_id": 56700434, "body": "If I understand his pseudocode correctly, he wants to do this, but starting at index <code>x</code>: maybe add a <code>drop</code> in there or something?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1747, "user_id": 1971462, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qCUpC.jpg?s=128&g=1", "display_name": "Michael Rawson", "link": "https://stackoverflow.com/users/1971462/michael-rawson"}, "edited": false, "score": 1, "creation_date": 1451210907, "post_id": 34479379, "comment_id": 56700497, "body": "@MichaelRawson I added that, although I believe the string and index parameters could be added by the OP while attempting to make a loop -- it is possible that they don&#39;t really need those arguments."}, {"owner": {"reputation": 17, "user_id": 5695104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eec9bf2144c1361c321569b93aebaafa?s=128&d=identicon&r=PG&f=1", "display_name": "codelife", "link": "https://stackoverflow.com/users/5695104/codelife"}, "edited": false, "score": 0, "creation_date": 1451210940, "post_id": 34479379, "comment_id": 56700504, "body": "Yes that is one problem I have to handle"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 17, "user_id": 5695104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eec9bf2144c1361c321569b93aebaafa?s=128&d=identicon&r=PG&f=1", "display_name": "codelife", "link": "https://stackoverflow.com/users/5695104/codelife"}, "edited": false, "score": 2, "creation_date": 1451234711, "post_id": 34479379, "comment_id": 56706894, "body": "@coderbst, note that the first expression, <code>not . null</code>, should generally be preferred to <code>(&#47;= &quot;&quot;)</code> because it works for types other than strings."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1451210688, "last_edit_date": 1451210688, "creation_date": 1451210554, "answer_id": 34479379, "question_id": 34479334, "link": "https://stackoverflow.com/questions/34479334/while-loop-in-haskell/34479379#34479379", "title": "While loop in Haskell", "body": "<p>Forget array indexes: they are often not needed. All you have to do for your task is getting the longest prefix of your list containing only non-empty strings.</p>\n\n<pre><code>takeWhile (not . null) xs\n-- or\ntakeWhile (/= \"\") xs\n</code></pre>\n\n<p>Then you want to concatenate these strings.</p>\n\n<pre><code>concat $ takeWhile (/= \"\") xs\n</code></pre>\n\n<p>If you want to start after <code>n</code> strings for some reason, just drop the first <code>n</code> before beginning:</p>\n\n<pre><code>concat $ takeWhile (/= \"\") $ drop n xs\n</code></pre>\n\n<hr>\n\n<p>If you really want to do a custom \"loop\", use recursion:</p>\n\n<pre><code>g xs n = f $ drop n xs\nf []      = \"\"\nf (\"\":xs) = \"\"\nf (x:xs)  = x ++ f xs\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 5695104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eec9bf2144c1361c321569b93aebaafa?s=128&d=identicon&r=PG&f=1", "display_name": "codelife", "link": "https://stackoverflow.com/users/5695104/codelife"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 746, "favorite_count": 0, "accepted_answer_id": 34479379, "answer_count": 1, "score": 0, "last_activity_date": 1451210688, "creation_date": 1451210095, "last_edit_date": 1451210299, "question_id": 34479334, "link": "https://stackoverflow.com/questions/34479334/while-loop-in-haskell", "title": "While loop in Haskell", "body": "<p>I want to create a while loop to concatenate strings in the <code>xs</code> list \nuntil I find an empty string, but it seems neither we have a chance to \nincrement an Int nor create a while loop.</p>\n\n<p>So this looks like a pseudo code for Haskell, but how can I actually implement my solution? </p>\n\n<pre><code>prt :: String -&gt; [String] -&gt; Int -&gt; String\nprt str xs x = do\n         while((xs !! (x)) /= \"\")\n         str = str ++ (xs !! (x++))\n</code></pre>\n"}, {"tags": ["algorithm", "haskell", "tree"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1451194718, "post_id": 34477552, "comment_id": 56697389, "body": "So if the root is common but the branches are not, what happens?"}, {"owner": {"reputation": 911, "user_id": 867610, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/4478f1b6b8af5c91dd6d37b817c8d313?s=128&d=identicon&r=PG", "display_name": "knick", "link": "https://stackoverflow.com/users/867610/knick"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1451195703, "post_id": 34477552, "comment_id": 56697527, "body": "@n.m. Then the result would be a single tree with the common root, and all of the branches from both of the original trees. If you see <code>test1</code>, the left tree has a branch &#39;d&#39; which is not in the right tree. The result contains all branches from both trees, including branch &#39;d&#39;."}, {"owner": {"reputation": 911, "user_id": 867610, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/4478f1b6b8af5c91dd6d37b817c8d313?s=128&d=identicon&r=PG", "display_name": "knick", "link": "https://stackoverflow.com/users/867610/knick"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1451195771, "post_id": 34477552, "comment_id": 56697542, "body": "@DanielWagner I haven&#39;t yet got a solution which passes type checks"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1451195988, "post_id": 34477552, "comment_id": 56697577, "body": "Show what you&#39;ve got anyway."}], "answers": [{"tags": [], "owner": {"reputation": 911, "user_id": 867610, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/4478f1b6b8af5c91dd6d37b817c8d313?s=128&d=identicon&r=PG", "display_name": "knick", "link": "https://stackoverflow.com/users/867610/knick"}, "is_accepted": true, "score": 2, "last_activity_date": 1451197678, "creation_date": 1451197678, "answer_id": 34478147, "question_id": 34477552, "link": "https://stackoverflow.com/questions/34477552/tree-merge-algorithm-in-haskell/34478147#34478147", "title": "Tree merge algorithm in Haskell", "body": "<p>I think I've finally got it;</p>\n\n<pre><code>merge :: (Eq a) =&gt; Tree a -&gt; Tree a -&gt; Either (Tree a, Tree a) (Tree a)\nmerge l r = \n    if rootLabel l == rootLabel r\n        then Right $ merge' l r \n        else Left (l,r)\n\nmerge' :: (Eq a) =&gt; Tree a -&gt; Tree a -&gt; Tree a\nmerge' l r = l { subForest = foldl mergeNode (subForest l) (subForest r) }\n\nmergeNode :: Eq a =&gt; [Tree a] -&gt; Tree a -&gt; [Tree a]\nmergeNode [] y = [y]\nmergeNode (x:xs) y \n    | rootLabel x == rootLabel y = x `merge'` y : xs\n    | otherwise = x : xs `mergeNode` y\n</code></pre>\n"}], "owner": {"reputation": 911, "user_id": 867610, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/4478f1b6b8af5c91dd6d37b817c8d313?s=128&d=identicon&r=PG", "display_name": "knick", "link": "https://stackoverflow.com/users/867610/knick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 583, "favorite_count": 0, "accepted_answer_id": 34478147, "answer_count": 1, "score": 0, "last_activity_date": 1451197678, "creation_date": 1451190380, "question_id": 34477552, "link": "https://stackoverflow.com/questions/34477552/tree-merge-algorithm-in-haskell", "title": "Tree merge algorithm in Haskell", "body": "<p>I need a function which takes two trees, checks to see if there are any common branches coming off the trunk, and merges the trees into a single tree if possible. </p>\n\n<p>Nodes can be considered the same if their <code>rootLabels</code> are equal. Two trees with different roots cannot be merged. Two trees with the same root can be merged, and their branches can be recursively checked to see if they can be merged.</p>\n\n<p>Can anyone suggest an implementation for the function <code>merge</code>(below) which passes <code>test1</code> and <code>test2</code> (i.e. functions return <code>True</code>)? I'm sure there is a simple, elegant solution, but it is evading me at the moment. Alternatively, is there an existing library function I can use?</p>\n\n<pre><code>import Data.Tree\n\nmerge :: (Eq a) =&gt; Tree a -&gt; Tree a -&gt; Either (Tree a, Tree a) (Tree a)\nmerge = undefined\n\ntest1 :: Bool\ntest1 = \n    Node 'a' \n            [Node 'b' \n                [Node 'c' \n                    [], \n                Node 'g' \n                    []], \n            Node 'd' \n                []]\n    `merge`\n    Node 'a' \n            [Node 'b' \n                [Node 'c' \n                    [Node 'h'\n                        []]], \n            Node 'e' \n                [Node 'f' \n                    []]]\n    == \n    Right \n    (Node 'a' \n        [Node 'b' \n            [Node 'c' \n                [Node 'h'\n                    []], \n            Node 'g' \n                []], \n        Node 'd' \n            [],\n        Node 'e' \n            [Node 'f' \n                []]])\n\ntest2 :: Bool\ntest2 =  \n    let l = Node 'a' []\n        r = Node 'b' []\n    in  l `merge` r == Left (l,r)\n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "edited": false, "score": 0, "creation_date": 1451189813, "post_id": 34477514, "comment_id": 56696699, "body": "Thank you to one who gives minus to my questions (!)"}, {"owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "reply_to_user": {"reputation": 18468, "user_id": 5299236, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/KtXnq.jpg?s=128&g=1", "display_name": "Casimir Crystal", "link": "https://stackoverflow.com/users/5299236/casimir-crystal"}, "edited": false, "score": 0, "creation_date": 1451189857, "post_id": 34477514, "comment_id": 56696705, "body": "@Kevin Guan , Thanks!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2877212"}, "edited": false, "score": 0, "creation_date": 1451189901, "post_id": 34477514, "comment_id": 56696709, "body": "That is a screenshot."}, {"owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "edited": false, "score": 0, "creation_date": 1451189970, "post_id": 34477514, "comment_id": 56696722, "body": "The site did not accept it. So, I had to make a screen shot. Sorry."}, {"owner": {"reputation": 18468, "user_id": 5299236, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/KtXnq.jpg?s=128&g=1", "display_name": "Casimir Crystal", "link": "https://stackoverflow.com/users/5299236/casimir-crystal"}, "edited": false, "score": 0, "creation_date": 1451190036, "post_id": 34477514, "comment_id": 56696731, "body": "<i>How the site didn&#39;t accept it?</i> Because you can&#39;t keep the right format?"}, {"owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "edited": false, "score": 0, "creation_date": 1451190081, "post_id": 34477514, "comment_id": 56696737, "body": "Lol. Can we please keep focusing on the problem :) Thanks"}, {"owner": {"reputation": 18468, "user_id": 5299236, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/KtXnq.jpg?s=128&g=1", "display_name": "Casimir Crystal", "link": "https://stackoverflow.com/users/5299236/casimir-crystal"}, "edited": false, "score": 0, "creation_date": 1451190404, "post_id": 34477514, "comment_id": 56696789, "body": "Well, without the code we can&#39;t help you because we can&#39;t copy-paste your code and run or debug it. I think nobody&#39;d like type your code instead of just Ctrl+C. So please <b>post your code instead of just an image</b> next time. However this time you don&#39;t need do that, <i>see my powerful edit!</i>"}, {"owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "reply_to_user": {"reputation": 18468, "user_id": 5299236, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/KtXnq.jpg?s=128&g=1", "display_name": "Casimir Crystal", "link": "https://stackoverflow.com/users/5299236/casimir-crystal"}, "edited": false, "score": 0, "creation_date": 1451190484, "post_id": 34477514, "comment_id": 56696803, "body": "@Kevin Guan, Thanks, you are awesome Sir!!! :)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451198419, "post_id": 34477514, "comment_id": 56697992, "body": "It seems you want your indices to &quot;skip&quot; a line if that line is empty. If so, simply filter the lines before indexing: <code>let original = filter (not.null) . lines$ contents</code>"}], "answers": [{"tags": [], "owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "is_accepted": true, "score": 2, "last_activity_date": 1451200126, "creation_date": 1451200126, "answer_id": 34478360, "question_id": 34477514, "link": "https://stackoverflow.com/questions/34477514/getting-elements-from-a-list-by-an-index-list/34478360#34478360", "title": "Getting elements from a list by an index list", "body": "<h1>Filtering empty elements</h1>\n\n<blockquote>\n  <p>The thing I want to accomplish is to check whether the corresponding\n  index values (in index2) are empty or not in the original list, if\n  they are empty, I want to remove them in index2.</p>\n</blockquote>\n\n<p>The code already filters out empty elements! Look at the following line:</p>\n\n<pre><code>let onlyUpper = filter(/=\"\") (intersect original allUpper)\n</code></pre>\n\n<p>This line does two things:</p>\n\n<ul>\n<li>it keeps only elements which are constituted only with uppercase letters(<code>intersect original allUpper</code>),</li>\n<li>it filters out empty elements (<code>filter(/=\"\")</code>).</li>\n</ul>\n\n<p>If by empty elements you mean strings which contains only space characters or nothing, you can use instead:</p>\n\n<pre><code>filter (all isSpace)\n</code></pre>\n\n<h1>Iterating over lists</h1>\n\n<blockquote>\n  <p>I do not seem to understand how iteration over lists works.</p>\n</blockquote>\n\n<p>In Haskell, lists are single chained lists: each element contains a value and a reference to the next value.</p>\n\n<p>Therefore lists are not indexed: the <code>!!</code> operator have to go through each element to access a specific element making lists completely inefficient when dealing with direct access.</p>\n\n<p>When you\u2019re submitting a list to a function, you simply give it the first element.</p>\n\n<p>With these considerations, when you work on lists, you have to avoid accessing elements via their index.</p>\n\n<p>The idea is to create functions which do their job on simple values and mapping them to list of elements. Take a look at the <code>toUpper</code> function:</p>\n\n<pre><code>toUpper :: Char -&gt; Char\n</code></pre>\n\n<p>It takes a <code>Char</code> and returns its uppercased version (also a <code>Char</code>).</p>\n\n<p>Haskell does not have a <code>toUpper</code> function which works on <code>String</code>, you have to use something like <code>map</code> or <code>&lt;$&gt;</code> to apply <code>toUpper</code> to a list of char (a <code>String</code>):</p>\n\n<pre><code>map toUpper \"ab\" -- \"AB\"\ntoUpper &lt;$&gt; \"ab\" -- \"AB\"\n</code></pre>\n\n<p>The idea is to have functions which does only one specific thing. Upercasing and iterating over a list are two different things. Does the <code>toUpper</code> function need to know the index of the element it will uppercase? No!</p>\n\n<h1>Iterating over a list with index</h1>\n\n<p>You may ask: but what if my function REALLY need to consider the index of the elements? (ie: for filtering out even or odd elements).</p>\n\n<p>You have two way of considering it:</p>\n\n<ul>\n<li>a <code>List</code> is not the type you need to work with. Maybe Data.Map, Data.IntMap or Data.Vector are better suited for the task (see these modules for more information),</li>\n<li>you need to use an intermediate type which will hold the index.</li>\n</ul>\n\n<p>For example:</p>\n\n<pre><code>let string = \"abcde\"\nlet indexedString = zip [1..] string\n\nprint indexedString -- [(1, 'a'), (2, 'b), (3, 'c), (4, 'd), (5, 'e)]\n</code></pre>\n\n<p>Note that this also solves your need of an increment function since the index is started at whatever value you want.</p>\n\n<p>To go back to the original string, you write:</p>\n\n<pre><code>map snd indexedString -- \"abcde\"\n</code></pre>\n\n<p>You need to use the <code>fst</code> and <code>snd</code> functions to work with the intermediate type, or to use pattern matching:</p>\n\n<pre><code>filter (\\x -&gt; snd x == 'b') indexedString -- [(2, 'b')]\nmap (\\(i,s) -&gt; (i, toUpper s)) indexedString -- [(1,'A'),(2,'B'),(3,'C'),(4,'D'),(5,'E')]\n</code></pre>\n\n<p>Taking the index into account:</p>\n\n<pre><code>let string = \"abcde\"\n    indexedString = zip [1..] string\n\n    upperEven (i, c) | even i = (i, toUpper c)\n                     | otherwise = (i, c)\n\nprint $ map upperEven indexedString -- [(1,'a'),(2,'B'),(3,'c'),(4,'D'),(5,'e')]\nprint $ map snd $ map upperEven indexedString -- \"aBcDe\"\n</code></pre>\n\n<h1>Notes</h1>\n\n<p>The <code>increment</code> function already exists in Haskell, it\u2019s called <code>succ</code> (it is also a more generic function which works on every types supporting the <code>Enum</code> class like Int, Char\u2026)</p>\n"}, {"tags": [], "owner": {"reputation": 155, "user_id": 5715425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80175d4896bc5afa19d54b0a059ed115?s=128&d=identicon&r=PG&f=1", "display_name": "denys.fridman", "link": "https://stackoverflow.com/users/5715425/denys-fridman"}, "is_accepted": false, "score": 0, "last_activity_date": 1451202808, "creation_date": 1451202808, "answer_id": 34478605, "question_id": 34477514, "link": "https://stackoverflow.com/questions/34477514/getting-elements-from-a-list-by-an-index-list/34478605#34478605", "title": "Getting elements from a list by an index list", "body": "<p>Why not use <code>words :: String -&gt; [String]</code> on the contents you get from a file? Using <code>lines :: String -&gt; [String]</code> would be an alternative if you had one word per line.</p>\n\n<p>Then if i get your problem right, you could write the following to solve your problem:</p>\n\n<pre><code>import Data.List (findIndices)\nimport Data.Char (isUpper)\n\nallUpperOneBasedIndices :: String -&gt; [Int]\nallUpperOneBasedIndices = map succ . findIndices (all isUpper) . words\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1076, "favorite_count": 0, "accepted_answer_id": 34478360, "answer_count": 2, "score": -3, "last_activity_date": 1451202808, "creation_date": 1451189721, "last_edit_date": 1451190629, "question_id": 34477514, "link": "https://stackoverflow.com/questions/34477514/getting-elements-from-a-list-by-an-index-list", "title": "Getting elements from a list by an index list", "body": "<p>I have two lists in Haskell.</p>\n\n<p>Original list containing string values:</p>\n\n<pre><code>[\"Hello\", \"HELLO\", \"\", \"WORLD\", \"xxx\", \"world\"]\n</code></pre>\n\n<p>Index list containing integer values where the strings are all upper case in the original list:</p>\n\n<pre><code>[1,3]\n</code></pre>\n\n<p>I incremented all the values in the index list with a function I created and make <code>index2</code> list, overall it looks like this:</p>\n\n<p>My code:</p>\n\n<pre><code>import Data.List \nimport Data.Char \nimport Data.Maybe \n\nmain = do \n    contents &lt;- readFile \"h.txt\" \n    let original = lines (contents) \n    let allUpper = lines (map toUpper contents) \n    let onlyUpper = filter(/=\"\") (intersect original allUpper) \n    let upperIndex = findIndices ('elem' onlyUpper) original \n    let index2 = (map increment upperIndex) \n    print index2 \n\nincrement :: Int -&gt; Int \nincrement x = x+1 \n</code></pre>\n\n<p>I have managed to came this far with the help of yours. However, since I am a beginner I do not seem to understand how iteration over lists works.</p>\n\n<p>The thing I want to accomplish is to check whether the corresponding index values (in <code>index2</code>) are empty or not in the original list, if they are empty, I want to remove them in <code>index2</code>.</p>\n"}, {"tags": ["haskell", "state-monad"], "answers": [{"comments": [{"owner": {"reputation": 424, "user_id": 3889860, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/TfGyC.jpg?s=128&g=1", "display_name": "nobody", "link": "https://stackoverflow.com/users/3889860/nobody"}, "edited": false, "score": 0, "creation_date": 1451190373, "post_id": 34477496, "comment_id": 56696784, "body": "Thanks for your explanation, is your example use type synonym of monad?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 424, "user_id": 3889860, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/TfGyC.jpg?s=128&g=1", "display_name": "nobody", "link": "https://stackoverflow.com/users/3889860/nobody"}, "edited": false, "score": 0, "creation_date": 1451218999, "post_id": 34477496, "comment_id": 56702244, "body": "What do you mean with type synonym? <code>Monad</code> is not a <code>type</code>/<code>data</code>, it is a <code>class</code>."}, {"owner": {"reputation": 424, "user_id": 3889860, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/TfGyC.jpg?s=128&g=1", "display_name": "nobody", "link": "https://stackoverflow.com/users/3889860/nobody"}, "edited": false, "score": 0, "creation_date": 1451222647, "post_id": 34477496, "comment_id": 56703170, "body": "For example <code>m&gt;&gt;k where m, k :: State s a</code>"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1451189334, "creation_date": 1451189334, "answer_id": 34477496, "question_id": 34477350, "link": "https://stackoverflow.com/questions/34477350/state-monad-then/34477496#34477496", "title": "State Monad then (&gt;&gt;)", "body": "<p>I think <a href=\"https://en.wikipedia.org/wiki/Monad_%28functional_programming%29#State_monads\" rel=\"nofollow\">this Wikipedia page</a> gives a definition for <code>(&gt;&gt;=)</code> for the <code>State</code> monad:</p>\n\n<pre><code>m &gt;&gt;= f = \\r -&gt; let (x, s) = m r in (f x) s\n</code></pre>\n\n<p>Since <code>(&gt;&gt;)</code> is implemented in terms of <code>(&gt;&gt;=)</code> as follows:</p>\n\n<pre><code>m &gt;&gt; k = m &gt;&gt;= \\_ -&gt; k\n</code></pre>\n\n<p>one can derive the definition for <code>(&gt;&gt;)</code> for the state monad:</p>\n\n<pre><code>m &gt;&gt; k = \\r -&gt; let (x, s) = m r in ((\\_ -&gt; k) x) s\n</code></pre>\n\n<p>or when removing the noise:</p>\n\n<pre><code>m &gt;&gt; k = \\r -&gt; let (x, s) = m r in k s\n</code></pre>\n\n<p>Now since <code>x</code> does not play a part in the <code>in</code> clause, you can indeed use <code>snd</code> to get <code>s</code>, which can thus be rewritten to:</p>\n\n<pre><code>m &gt;&gt; k = \\r -&gt; k $ snd m r\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 424, "user_id": 3889860, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/TfGyC.jpg?s=128&g=1", "display_name": "nobody", "link": "https://stackoverflow.com/users/3889860/nobody"}, "edited": false, "score": 0, "creation_date": 1451189979, "post_id": 34477499, "comment_id": 56696724, "body": "Thank you very much for your explanation!"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 3, "creation_date": 1451192127, "post_id": 34477499, "comment_id": 56697023, "body": "I&#39;d +1 for that side note alone.  That explains why I always found the <code>s -&gt; (a, s)</code> definition backwards!"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 4, "last_activity_date": 1451194587, "last_edit_date": 1451194587, "creation_date": 1451189431, "answer_id": 34477499, "question_id": 34477350, "link": "https://stackoverflow.com/questions/34477350/state-monad-then/34477499#34477499", "title": "State Monad then (&gt;&gt;)", "body": "<p>You're pretty much right. <code>&gt;&gt;</code> is actually more general than you suggest, but you can certainly use it with the type signature you indicate. If you're using <code>State</code> from its usual home, <code>Control.Monad.Trans.State.Strict</code>, or its home away from home, <code>Control.Monad.State.Strict</code>, <code>State</code> is actually just a type synonym:</p>\n\n<pre><code>type State s = StateT s Identity\n</code></pre>\n\n<p>where <code>Identity</code> is from <code>Data.Functor.Identity</code> and defined</p>\n\n<pre><code>newtype Identity x = Identity x\n</code></pre>\n\n<p>and <code>StateT</code> is defined</p>\n\n<pre><code>newtype StateT s m a = StateT {runStateT :: s -&gt; m (a, s)}\n</code></pre>\n\n<p>So <code>State s a</code> is just a newtype wrapper around</p>\n\n<pre><code>s -&gt; Identity (a, s)\n</code></pre>\n\n<p>This is essentially the same as the definition you imagine, but it allows <code>State s</code> to be compatible with the <em>monad transformer</em> <code>StateT s</code>, which is used to add state to arbitrary <code>Monad</code>s.</p>\n\n<pre><code>instance Monad m =&gt; Monad (StateT s m) where\n  return a = StateT $ \\s -&gt; return (a, s)\n  StateT g &gt;&gt;= f = StateT $ \\s -&gt; g s &gt;&gt;= \\(r,s') -&gt; runStateT (f r) s'\n</code></pre>\n\n<p>So</p>\n\n<pre><code>  StateT g &gt;&gt; StateT h = StateT $ \\s -&gt; g s &gt;&gt;= \\(_,s') -&gt; h s'\n\n                       = StateT $ \\s -&gt; h $ snd $ runIdentity (g s)\n                       = StateT $ h . snd . runIdentity . g\n</code></pre>\n\n<hr>\n\n<h3>Irrelevant side note</h3>\n\n<p>The definition of <code>StateT</code> annoys me, because in my opinion it puts the elements of the pairs in the wrong order. Why wrong? Because mapping over <code>(a, s)</code> changes <code>s</code> while leaving <code>a</code> alone, and that is not what happens when mapping over a state transformer. End result: poor intuition.</p>\n"}], "owner": {"reputation": 424, "user_id": 3889860, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/TfGyC.jpg?s=128&g=1", "display_name": "nobody", "link": "https://stackoverflow.com/users/3889860/nobody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 34477499, "answer_count": 2, "score": 1, "last_activity_date": 1451196176, "creation_date": 1451187112, "last_edit_date": 1451196176, "question_id": 34477350, "link": "https://stackoverflow.com/questions/34477350/state-monad-then", "title": "State Monad then (&gt;&gt;)", "body": "<p>I would like to know the definition of <code>&gt;&gt;</code> for the Haskell state monad.</p>\n\n<p>By my guess it pass one state to another:</p>\n\n<pre><code>(&gt;&gt;) :: State s a -&gt; State s b -&gt; State s b\nState a &gt;&gt; State b = State $ \\x -&gt; b $ snd ( a x )\n</code></pre>\n\n<p>or</p>\n\n<pre><code>State a &gt;&gt; State b = State $ b . snd . a\n</code></pre>\n\n<p>Is this correct?</p>\n"}, {"tags": ["scala", "haskell"], "comments": [{"owner": {"reputation": 51405, "user_id": 2621536, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8a6a70cc2ec317f4ca77c05d0adec8ad?s=128&d=identicon&r=PG&f=1", "display_name": "kiritsuku", "link": "https://stackoverflow.com/users/2621536/kiritsuku"}, "edited": false, "score": 4, "creation_date": 1451213691, "post_id": 34477159, "comment_id": 56701126, "body": "The compile time error has nothing to do with type holes, it is a normal type mismatch."}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "reply_to_user": {"reputation": 51405, "user_id": 2621536, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8a6a70cc2ec317f4ca77c05d0adec8ad?s=128&d=identicon&r=PG&f=1", "display_name": "kiritsuku", "link": "https://stackoverflow.com/users/2621536/kiritsuku"}, "edited": false, "score": 0, "creation_date": 1451274201, "post_id": 34477159, "comment_id": 56716752, "body": "Could you please explain, @sschaef? I don&#39;t follow."}, {"owner": {"reputation": 51405, "user_id": 2621536, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8a6a70cc2ec317f4ca77c05d0adec8ad?s=128&d=identicon&r=PG&f=1", "display_name": "kiritsuku", "link": "https://stackoverflow.com/users/2621536/kiritsuku"}, "edited": false, "score": 0, "creation_date": 1451294039, "post_id": 34477159, "comment_id": 56722981, "body": "You have a function <code>g</code> that expects a <code>String</code>. With <code>g 55</code> you pass an <code>Int</code>, thus the type mismatch."}], "answers": [{"tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 3, "last_activity_date": 1451209368, "last_edit_date": 1451209368, "creation_date": 1451208915, "answer_id": 34479219, "question_id": 34477159, "link": "https://stackoverflow.com/questions/34477159/typed-holes-in-scala/34479219#34479219", "title": "Typed Holes in Scala?", "body": "<p>Scala's <code>???</code> is just a shorthand for throwing an exception, and is equivalent to Haskell's <code>undefined</code> or just <code>error \"not implemented\"</code> or similar. </p>\n\n<p>The Scala compiler does not however, to my best knowledge, have support for typed holes. You can however just use <code>???</code> and inspect the type of that in an IDE or Emacs+Ensime to see its inferred type. </p>\n\n<p>Also note that Scala's type inference is very minimal compared to the full type inference of the Hindley-Milner type system of Haskell, so having something like typed holes in the Scala compiler would not even be too meaningful to start with, until Martin Odersky and the maintainers decide Scala needs to level up on type inference, which I think is unlikely to happen anytime soon (but the Typelevel crowd might have something cooking). </p>\n"}, {"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1452267823, "post_id": 34674523, "comment_id": 57107109, "body": "Thanks for the thoughtful reply, Richard. I suppose another downside is that I have to <code>import ...</code> or define <code>object hole</code> wherever I want to use it."}], "tags": [], "owner": {"reputation": 3765, "user_id": 154248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff619670d30ebdeefd49cf10af8e3292?s=128&d=identicon&r=PG", "display_name": "Richard Dallaway", "link": "https://stackoverflow.com/users/154248/richard-dallaway"}, "is_accepted": false, "score": 3, "last_activity_date": 1452248235, "creation_date": 1452248235, "answer_id": 34674523, "question_id": 34477159, "link": "https://stackoverflow.com/questions/34477159/typed-holes-in-scala/34674523#34674523", "title": "Typed Holes in Scala?", "body": "<p>For me a hole in a program helps me progress the implementation. It does that by telling me what type I need next. You can get something a little like that by triggering a regular Scala type error.</p>\n\n<p>The trick is to define a type you know will be wrong, and then use it.  For example:</p>\n\n<pre><code>object hole\n</code></pre>\n\n<p>You can then use that in code and you'll get an appropriate type error:</p>\n\n<p><a href=\"https://i.stack.imgur.com/wS4bc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/wS4bc.png\" alt=\"screen shot of a compiler error when using a hole\"></a></p>\n\n<p>The error here is telling me the \"hole\" needs to be a <code>B</code>, suggesting I can progress by using <code>g</code> in some way.  And if I progress the code to <code>a =&gt; f(g(hole))</code> the compiler will tell me the <code>hole</code> needs to be an <code>A</code>.</p>\n\n<p>That's a kind of hole, but unlike other languages (Idris etc)...</p>\n\n<ul>\n<li>my program is just not compiling, rather than having a recognized hole as such;</li>\n<li>there's no help to tell me the types in scope (although IDE code completion my give some suggestions);</li>\n<li>I can't nicely name a hole;</li>\n<li>I can't automatically lift a hole to a function definition;</li>\n<li>I can't automatically solve the hole (as Idris can, sometimes); </li>\n<li>I <em>must</em> type the expected return value, otherwise Scala will infer that <code>hole</code> is an acceptable type!</li>\n<li>...and probably many other features.</li>\n</ul>\n\n<p>As you say <code>???</code> is a useful placeholder, but it has type <code>Nothing</code> -- which means the program compiles, but it doesn't help you fill in the implementation. \nAt least <code>object hole</code>, although kind of trivial, does give you some type information to progress.</p>\n"}, {"tags": [], "owner": {"reputation": 135642, "user_id": 1870803, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jYakG.jpg?s=128&g=1", "display_name": "Yuval Itzchakov", "link": "https://stackoverflow.com/users/1870803/yuval-itzchakov"}, "is_accepted": false, "score": 0, "last_activity_date": 1597442347, "creation_date": 1597442347, "answer_id": 63420500, "question_id": 34477159, "link": "https://stackoverflow.com/questions/34477159/typed-holes-in-scala/63420500#63420500", "title": "Typed Holes in Scala?", "body": "<p>There's a Scala compiler plugin by Chris Birchall called <a href=\"https://github.com/cb372/scala-typed-holes\" rel=\"nofollow noreferrer\"><code>scala-typed-holes</code></a> that implements typed holes:</p>\n<pre><code>package example\n\nobject Example {\n\n  def foo(x: Int, y: String): Boolean = {\n    if (y.length == x) {\n       ??? // TODO implement!\n    } else {\n     true\n   }\n} \n\ndef bar(x: Int): String = x match {\n    case 0 =&gt; &quot;zero&quot;\n    case 1 =&gt; &quot;one&quot;\n    case _ =&gt; ???\n  }\n}\n</code></pre>\n<p>Generates:</p>\n<pre><code>[warn] /Users/chris/code/scala-typed-holes/src/test/scala/example/Example.scala:7:7:\n[warn] Found hole with type: Boolean\n[warn] Relevant bindings include\n[warn]   x: Int (bound at Example.scala:5:11\n[warn]   y: String (bound at Example.scala:5:19)\n[warn]\n[warn]       ??? // TODO implement!\n[warn]       ^\n[warn] /Users/chris/code/scala-typed-holes/src/test/scala/example/Example.scala:16:15:\n[warn] Found hole with type: String\n[warn] Relevant bindings include\n[warn]   x: Int (bound at Example.scala:13:11)\n[warn]\n[warn]     case _ =&gt; ???\n[warn]               ^\n</code></pre>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1005, "favorite_count": 1, "answer_count": 3, "score": 6, "last_activity_date": 1597442347, "creation_date": 1451184450, "question_id": 34477159, "link": "https://stackoverflow.com/questions/34477159/typed-holes-in-scala", "title": "Typed Holes in Scala?", "body": "<p>Haskell offers <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Holes\" rel=\"noreferrer\">typed holes</a>. </p>\n\n<p>Example:</p>\n\n<pre><code>f :: Int -&gt; String -&gt; Bool\nf x y = if (x &gt; 10) then True else (g y)\n\ng :: String -&gt; Bool\ng s = _\n</code></pre>\n\n<p>Compilation:</p>\n\n<pre><code>Prelude&gt; :l HoleEx.hs\n[1 of 1] Compiling Main             ( HoleEx.hs, interpreted )\n\nHoleEx.hs:6:7:\n    Found hole `_' with type: Bool\n    Relevant bindings include\n      s :: String (bound at HoleEx.hs:6:3)\n      g :: String -&gt; Bool (bound at HoleEx.hs:6:1)\n    In the expression: _\n    In an equation for `g': g s = _\nFailed, modules loaded: none.\n</code></pre>\n\n<p>When programming in Scala, I typically use <code>???</code> as placeholders in my Scala code that I've not yet written.</p>\n\n<p>However, using typed holes appears to be more powerful to me. Note that I could replace the above <code>else (g y)</code> with <code>else (g 55)</code>, yet I'd get a compile-time error:</p>\n\n<pre><code>Prelude&gt; :l HoleEx.hs\n[1 of 1] Compiling Main             ( HoleEx.hs, interpreted )\n\nHoleEx.hs:3:39:\n    Couldn't match type `Int' with `[Char]'\n    Expected type: String\n      Actual type: Int\n    In the first argument of `g', namely `x'\n    In the expression: (g x)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Although I can use <code>???</code> in Scala to get placeholder implementations to compile, unlike holes, I'll get run-time errors with <code>???</code>.</p>\n\n<pre><code>scala&gt; def g(x: Int): Int = ???\ng: (x: Int)Int\n\nscala&gt; g(5)\nscala.NotImplementedError: an implementation is missing\n</code></pre>\n\n<p>Does Scala have typed holes? </p>\n"}, {"tags": ["list", "haskell", "comparison", "mask"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1451181135, "post_id": 34476690, "comment_id": 56695505, "body": "You are very close. Think about what kind of predicate you will want to give <code>findIndices</code> though. If we have <code>upperIndex = findIndices (\\x -&gt; _) original</code>, what kind of a condition should you replace <code>_</code> with? What should it mean if that condition is true?"}, {"owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1451181886, "post_id": 34476690, "comment_id": 56695619, "body": "I am a beginner and honestly do not know :("}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "edited": false, "score": 0, "creation_date": 1451179710, "post_id": 34476784, "comment_id": 56695323, "body": "Works flawless thank you :) I do not understand why people gave minus. Sorry about that :("}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 3, "creation_date": 1451180716, "post_id": 34476784, "comment_id": 56695431, "body": "This answer should have an explanation of why and how it works."}, {"owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "edited": false, "score": 0, "creation_date": 1451181024, "post_id": 34476784, "comment_id": 56695480, "body": "Oh, I see. But he put effort for me I appreciate it. Thank you again Sir."}], "tags": [], "owner": {"reputation": 783, "user_id": 5219101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa75288b5ab01bfd0e151c82fafde3c9?s=128&d=identicon&r=PG&f=1", "display_name": "Artem", "link": "https://stackoverflow.com/users/5219101/artem"}, "is_accepted": false, "score": -3, "last_activity_date": 1451178922, "creation_date": 1451178922, "answer_id": 34476784, "question_id": 34476690, "link": "https://stackoverflow.com/questions/34476690/comparison-of-two-lists-in-haskell/34476784#34476784", "title": "Comparison of two lists in Haskell", "body": "<pre><code>let upperIndex original onlyUpper = helper original 0 where helper [] _ = []; helper (x:xs) i = if elem x onlyUpper then i:(helper xs (i+1)) else helper xs (i+1)\n</code></pre>\n\n<p>Example of use:</p>\n\n<pre><code>Prelude&gt; upperIndex [\"hello\", \"HELLO\", \"world\", \"WORLD\"] [\"HELLO\", \"WORLD\"]\n[1,3]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "edited": false, "score": 0, "creation_date": 1451180618, "post_id": 34476797, "comment_id": 56695418, "body": "So, why do I get &quot;just 1&quot; , &quot;just 3&quot; instead of 1 and 3?"}, {"owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "edited": false, "score": 0, "creation_date": 1451181542, "post_id": 34476797, "comment_id": 56695573, "body": "I have found that it was another data type, so I converted it to Int using &quot;map fromJust xs&quot;. Thank you for the answer, it works perfectly too and a lot shorter!!!"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "edited": false, "score": 0, "creation_date": 1451182849, "post_id": 34476797, "comment_id": 56695743, "body": "@Orkun Don&#39;t do that. It will cause your program to crash if an element isn&#39;t found in the first list. You get <code>Just 1</code> and <code>Just 3</code> because there&#39;s no guarantee that elements in the second list will be found in an arbitrary list and <code>Maybe</code> handles that possible failure."}, {"owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "edited": false, "score": 0, "creation_date": 1451183033, "post_id": 34476797, "comment_id": 56695766, "body": "Because the second list is derived from the first one. To be specific, I get the upper case string elements from the original list. So there is no possiblity it will not found the the second list."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1451183180, "post_id": 34476797, "comment_id": 56695775, "body": "You can avoid the <code>Maybe</code> values in the first place by continuing to use <code>findIndices</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1451183399, "post_id": 34476797, "comment_id": 56695801, "body": "@DavidYoung But then you get <code>[Int]</code> instead of <code>Maybe Int</code>. The original specification wasn&#39;t clear, so I had to take some liberties when interpreting it. <code>[Maybe Int]</code> seemed like the closest thing to the desired <code>[Int]</code> that handled failures in a reasonable way."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "edited": false, "score": 0, "creation_date": 1451183511, "post_id": 34476797, "comment_id": 56695820, "body": "@Orkun If you have some guarantee that the indices will always exist then it is appropriate to use <code>fromJust</code>, but keep in mind that this imposes upon you the obligation to prove that there won&#39;t be any missing values. The compiler can no longer prevent you from making that mistake."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1451183549, "post_id": 34476797, "comment_id": 56695823, "body": "@ReinHenrichs The question gives a specific result of <code>[1,3]</code> for the sample input, which seems, to me at least, to lead in the direction of <code>findIndices</code>."}, {"owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "edited": false, "score": 0, "creation_date": 1451183590, "post_id": 34476797, "comment_id": 56695832, "body": "This works just fine but can you tell me how it can be done with findIndices? Because it was logical to use. However I do not understand how index increment happens in loop in this language, I cannot initialize an index and iterate over it..."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1451183592, "post_id": 34476797, "comment_id": 56695833, "body": "@DavidYoung mapping over <code>findIndices</code> would give <code>[[1],[3]]</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1451183775, "post_id": 34476797, "comment_id": 56695856, "body": "@DavidYoung Damn, you&#39;re right, I read <code>findIndices</code> wrong. That would be better."}, {"owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "edited": false, "score": 0, "creation_date": 1451184012, "post_id": 34476797, "comment_id": 56695880, "body": "No it works too and &quot;<a href=\"http://zvon.org/other/haskell/Outputprelude/elem_f.html\" rel=\"nofollow noreferrer\">elem</a>&quot; definition says : returns True if the list contains an item equal to the first argument. How can a boolean value can be used as an index?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "edited": false, "score": 0, "creation_date": 1451184081, "post_id": 34476797, "comment_id": 56695890, "body": "@Orkun <code>(`elem` ys)</code> is the predicate used by <code>findIndices</code> to determine whether an index is found. Make sure you read the docs for <code>findIndices</code>."}, {"owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "edited": false, "score": 0, "creation_date": 1451184774, "post_id": 34476797, "comment_id": 56695980, "body": "So far we found the indexes right. Let&#39;s say I want to print those indexes from original list. If i say <code>print (original !! (`elem` upperIndex))</code> this should work right?"}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 0, "last_activity_date": 1451184150, "last_edit_date": 1451184150, "creation_date": 1451179144, "answer_id": 34476797, "question_id": 34476690, "link": "https://stackoverflow.com/questions/34476690/comparison-of-two-lists-in-haskell/34476797#34476797", "title": "Comparison of two lists in Haskell", "body": "<p><strong>Edit</strong>: Another version suggested by David Young is</p>\n\n<pre><code>findIndicesIn xs ys = findIndices (`elem` ys) xs\n</code></pre>\n\n<p>which I prefer to my solution below.</p>\n\n<hr>\n\n<p>If I understand correctly, you have two lists. Call them <code>xs</code> and <code>ys</code>. You want to find the index in <code>xs</code> of each element in <code>ys</code>. You don't mention what you want to do if the element in <code>ys</code> is not contained in <code>xs</code>, so I am going to choose something reasonable for you. Here it is:</p>\n\n<pre><code>findIndicesIn :: Eq a =&gt; [a] -&gt; [a] -&gt; [Maybe Int]\nfindIndicesIn xs ys = map (`elemIndex` xs) ys\n</code></pre>\n\n<p><code>elemIndex :: Eq a =&gt; a -&gt; [a] -&gt; Maybe Int</code> finds the index of the given element in the list (comparing with <code>(==)</code>). If the element does not exist, <code>Nothing</code> is returned instead. To find all the indices, we map over each element in <code>ys</code> and try to find it in <code>xs</code> using <code>elemIndex</code>. Section syntax is used instead of <code>flip elemIndex xs</code> or <code>\\y -&gt; elemIndex y xs</code> for concision.</p>\n\n<p>The result is a list of <code>Maybe Int</code> representing the <em>possible</em> indices in <code>xs</code> of each element in <code>ys</code>. Note that if you do not keep track of missing elements, the positions of the indices in the resulting list will no longer correspond to the positions of the elements in <code>ys</code>.</p>\n\n<p>You can also write this using fewer points as</p>\n\n<pre><code>findIndicesIn :: Eq a =&gt; [a] -&gt; [a] -&gt; [Maybe Int]\nfindIndicesIn xs = map (`elemIndex` xs)\n</code></pre>\n\n<p>YMMV on which one is more clear. Both are equivalent. This version is pretty readable IMO. You can go one step further and write</p>\n\n<pre><code>findIndicesIn = map . flip elemIndex\n</code></pre>\n\n<p>but personally I find this less readable. YMMV again.</p>\n"}], "owner": {"reputation": 3, "user_id": 4581441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVUNj.jpg?s=128&g=1", "display_name": "Orkun", "link": "https://stackoverflow.com/users/4581441/orkun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 695, "favorite_count": 0, "accepted_answer_id": 34476797, "answer_count": 2, "score": -4, "last_activity_date": 1451184150, "creation_date": 1451177741, "question_id": 34476690, "link": "https://stackoverflow.com/questions/34476690/comparison-of-two-lists-in-haskell", "title": "Comparison of two lists in Haskell", "body": "<p>I have two lists in Haskell.</p>\n\n<p>Original List: <b>[\"hello\", \"HELLO\", \"world\", \"WORLD\"]</b></p>\n\n<p>Only Upper Case List: <b>[\"HELLO\", \"WORLD\"]</b></p>\n\n<p>Could you help me to create a function which should return a list conatining the indexes of intersection of two lists.</p>\n\n<p>I can get the first index by doing this:</p>\n\n<p><b>let upperIndex = findIndices(==(onlyUpper !! 0)) original</b></p>\n\n<p>However, this only works for one instance, in this case I can only get index of \"HELLO\" in the original list, but I want to get all of them.</p>\n\n<p>For this example, the answer should be: <b>[1,3]</b></p>\n"}, {"tags": ["haskell", "gtk", "preprocessor", "haskell-stack", "pango"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1451242179, "post_id": 34476466, "comment_id": 56709301, "body": "I don&#39;t have a Windows machine handy, so I can&#39;t verify, but I think you&#39;re running into this issue: <a href=\"https://github.com/gtk2hs/gtk2hs/issues/110\" rel=\"nofollow noreferrer\">github.com/gtk2hs/gtk2hs/issues/110</a>. Something with printf formatting C99 Windows upstream wibble wobble. Comments on that issue indicate that the Hackage package is broken on Windows, but fixed on the project&#39;s <code>master</code> branch. If that&#39;s the case, you should try adding <a href=\"https://github.com/gtk2hs/gtk2hs/\" rel=\"nofollow noreferrer\">github.com/gtk2hs/gtk2hs</a> to your stack.yaml, so as to build from the bleeding edge. See <a href=\"http://docs.haskellstack.org/en/stable/yaml_configuration.html#packages\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/&hellip;</a> for an example."}], "owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 204, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1483480246, "creation_date": 1451175201, "last_edit_date": 1483480246, "question_id": 34476466, "link": "https://stackoverflow.com/questions/34476466/compiling-pango-with-stack", "title": "Compiling Pango with Stack", "body": "<p>I've been trying to compile a Haskell project which depends on Pango (via Gtk3), so far without success. The issue <em>seems</em> to be with the preprocessor (based on odd mangled type names), but I have yet to find the exact cause.</p>\n\n<p>I'm using <code>stack</code> on a <strong>64-bit</strong> machine running <strong>Windows 10</strong> and <strong>GHC 7.10</strong>. I've compiled other projects using Gtk3 with <code>cabal</code> - on the same PC - so I'm fairly certain it's not a compatibility issue.</p>\n\n<p>I've included a small portion of the build log below.</p>\n\n<pre><code>[1 of 2] Compiling Gtk2HsSetup      ( Gtk2HsSetup.hs, dist\\setup-wrapper\\Gtk2HsSetup.o )\n[2 of 2] Compiling Main             ( SetupMain.hs, dist\\setup-wrapper\\Main.o )\nLinking dist/setup-wrapper\\setup.exe ...\nConfiguring pango-0.13.1.0...\nBuilding pango-0.13.1.0...\nPreprocessing library pango-0.13.1.0...\n[ 1 of 14] Compiling Graphics.Rendering.Pango.Types ( .stack-work\\dist\\i386-windows\\Cabal-1.22.4.0\\build\\Graphics\\Rendering\\Pango\\Types.hs, .stack-work\\dist\\i386-windows\\Cabal-1.22.4.0\\build\\Graphics\\Rendering\\Pango\\Types.o )\n[ 2 of 14] Compiling Graphics.Rendering.Pango.BasicTypes ( .stack-work\\dist\\i386-windows\\Cabal-1.22.4.0\\build\\Graphics\\Rendering\\Pango\\BasicTypes.hs, .stack-work\\dist\\i386-windows\\Cabal-1.22.4.0\\build\\Graphics\\Rendering\\Pango\\BasicTypes.o )\n[ 3 of 14] Compiling Graphics.Rendering.Pango.Structs ( .stack-work\\dist\\i386-windows\\Cabal-1.22.4.0\\build\\Graphics\\Rendering\\Pango\\Structs.hs, .stack-work\\dist\\i386-windows\\Cabal-1.22.4.0\\build\\Graphics\\Rendering\\Pango\\Structs.o )\n\nGraphicsRenderingPangoStructs.hsc:79:21:\n    Not in scope: type constructor or class \u00d4\u00c7\u00ffWord420906795024\u00d4\u00c7\u00d6\n\nGraphicsRenderingPangoStructs.hsc:79:40:\n    Not in scope: type constructor or class \u00d4\u00c7\u00ffWord420906795024\u00d4\u00c7\u00d6\n\nGraphicsRenderingPangoStructs.hsc:79:59:\n    Not in scope: type constructor or class \u00d4\u00c7\u00ffWord420906795024\u00d4\u00c7\u00d6\n</code></pre>\n\n<p>It continues with a whole slew of nearly identical errors.</p>\n\n<p><strong>EDIT</strong> (cf. haoformayor's comment)</p>\n\n<p>I encountered that error ticket before posting this question, but wasn't sure how to fix the <code>printf</code> issue 'cleanly'. I have tried following your advice, but I transitioned from cabal quite recently and am still not familiar with the basics of <code>stack</code>.</p>\n\n<p>Having edited my stack.yaml file (see below), I was met with the very same list of error messages.</p>\n\n<pre><code>packages:\n- location:\n  git: https://github.com/gtk2hs/gtk2hs.git\n  commit: dff5deae25a3f2c7d63ae583d1096b626bb6a9d2\n</code></pre>\n\n<p>I'll include additional information if necessary. Perhaps I've done something wrong?</p>\n\n<p><strong>EDIT</strong>\nI've amended the <code>git</code> URL and removed a duplicated <code>packages</code> key in my <code>stack.yaml</code> file. <code>Stack</code> is now able to find the latest version of <code>gtk2hs</code> on GitHub, but complains about a missing <code>.cabal</code> file. Presumably I have to run it through some alternative build system (eg. <code>gtk2hs-buildtools</code>).</p>\n"}, {"tags": ["haskell", "yaml", "pretty-print", "aeson"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1451161083, "post_id": 34474655, "comment_id": 56691365, "body": "you want your generated YAML to contain haskell lists?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 2, "creation_date": 1451161293, "post_id": 34474655, "comment_id": 56691420, "body": "@rampion: Possibly <i>flow sequence style</i> lists, instead of the current <i>block sequence style</i> ones."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 11, "last_activity_date": 1451294517, "last_edit_date": 1451294517, "creation_date": 1451161260, "answer_id": 34474926, "question_id": 34474655, "link": "https://stackoverflow.com/questions/34474655/how-to-write-inline-yaml-flow-style-in-haskell/34474926#34474926", "title": "How to write inline YAML (flow style) in Haskell?", "body": "<p>Unfortunately not. <code>yaml</code> uses <code>libyaml</code>. While you would like to use the <a href=\"https://github.com/snoyberg/yaml/blob/a440479185e0a689576a2c1f621ff11ff088e3cd/libyaml/emitter.c#L728-L771\" rel=\"nofollow\">flow sequence style</a>, the <a href=\"https://github.com/snoyberg/yaml/blob/a440479185e0a689576a2c1f621ff11ff088e3cd/libyaml/emitter.c#L1041-L1059\" rel=\"nofollow\">current implementation</a> uses <code>YAML_ANY_SEQUENCE_STYLE</code> (0) instead of <code>YAML_FLOW_SEQUENCE_STYLE</code> (2), and therefore <code>YAML_BLOCK_SEQUENCE_STYLE</code> (1, but the emitter only checks for equality with <code>YAML_FLOW_SEQUENCE_STYLE</code>).</p>\n\n<p>This is hardcoded into the <a href=\"https://hackage.haskell.org/package/yaml-0.8.15.2/docs/src/Text-Libyaml.html#toEventRaw\" rel=\"nofollow\"><code>toEventRaw</code></a> wrapper in Haskell. It should be possible to write <code>encodeWith</code>, that uses a special <code>toEventRawWith</code> and takes additional options, but that's currently not the case. <del>You could <a href=\"https://github.com/snoyberg/yaml/issues/new\" rel=\"nofollow\">open a feature request</a>,</del> There's a <a href=\"https://github.com/snoyberg/yaml/issues/77\" rel=\"nofollow\">feature request</a>, however.</p>\n\n<p><strong>Edit:</strong> Indeed, <code>Data.Yaml.encode</code> will return <code>\"[[1,2,3], [4,5]]\"</code> if one substitutes all occurrences of <code>0 -- YAML_ANY_SEQUENCE_STYLE</code> with <code>2 -- YAML_FLOW_SEQUENCE_STYLE</code> in <code>Text/Libyaml.hs</code>. So you either need to patch the library locally, or ask that feature request.</p>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 1, "accepted_answer_id": 34474926, "answer_count": 1, "score": 2, "last_activity_date": 1451294517, "creation_date": 1451159203, "last_edit_date": 1451206862, "question_id": 34474655, "link": "https://stackoverflow.com/questions/34474655/how-to-write-inline-yaml-flow-style-in-haskell", "title": "How to write inline YAML (flow style) in Haskell?", "body": "<p>I'm using <a href=\"https://hackage.haskell.org/package/yaml-0.8.15.2/docs/Data-Yaml.html\" rel=\"nofollow\"><code>Data.Yaml</code></a> to store some data in human readable format. However, some parts of the data are lists or matrices of numbers. The YAML output, <a href=\"http://yaml.org/spec/current.html#id2543032\" rel=\"nofollow\">block sequence style</a>, is quite verbose:</p>\n\n<pre><code>- - 1\n  - 2\n  - 3\n- - 4\n  - 5\n</code></pre>\n\n<p>Instead I'd like these parts to be encoded in <a href=\"http://yaml.org/spec/current.html#id2542413\" rel=\"nofollow\">flow sequence style</a>, just like</p>\n\n<pre><code>[[1,2,3],[4,5]]\n</code></pre>\n\n<p>Is there a way how to do that?</p>\n"}, {"tags": ["haskell", "vector", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 1057, "user_id": 2716377, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/0JbwB.png?s=128&g=1", "display_name": "Nicolas Mattia", "link": "https://stackoverflow.com/users/2716377/nicolas-mattia"}, "edited": false, "score": 0, "creation_date": 1451157669, "post_id": 34474449, "comment_id": 56690497, "body": "I didn&#39;t manage to go all the way down the rabbit hole of what <code>clear</code> does, and that particular solution didn&#39;t cross my mind. Seems absolutely sensible, thanks!"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 4, "last_activity_date": 1451157766, "last_edit_date": 1451157766, "creation_date": 1451157649, "answer_id": 34474449, "question_id": 34474329, "link": "https://stackoverflow.com/questions/34474329/mutable-vector-clear-reference-at-given-index/34474449#34474449", "title": "Mutable vector: clear reference at given index", "body": "<p>There's nothing like that in the package itself, but one can use the <a href=\"https://hackage.haskell.org/package/vector-0.11.0.0/docs/src/Data-Vector-Mutable.html#line-142\" rel=\"nofollow\">same implementation as <code>clear</code></a>: </p>\n\n<pre><code>clearAtIndex :: MVector (PrimState m) a -&gt; Int -&gt; m ()\nclearAtIndex v n = write v n uninitialised\n\nuninitialised :: a\nuninitialised = error \"clearAtIndex: uninitialised element\"\n</code></pre>\n\n<p><code>clear</code> basically works the same, but uses <code>set v uninitialised</code> in order to use possible optimizations.</p>\n"}], "owner": {"reputation": 1057, "user_id": 2716377, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/0JbwB.png?s=128&g=1", "display_name": "Nicolas Mattia", "link": "https://stackoverflow.com/users/2716377/nicolas-mattia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 34474449, "answer_count": 1, "score": 0, "last_activity_date": 1451157766, "creation_date": 1451156751, "question_id": 34474329, "link": "https://stackoverflow.com/questions/34474329/mutable-vector-clear-reference-at-given-index", "title": "Mutable vector: clear reference at given index", "body": "<p>I understand that the <a href=\"http://hackage.haskell.org/package/vector-0.10.12.1/\" rel=\"nofollow\">vector</a> provides a mutable interface which includes the <code>clear</code> function, clearing references to all the objects stored in the vector. I can't find a similar function that would clear the reference stored at index <code>n</code> in the vector. Is there any way to achieve such a thing, and if not, why?</p>\n\n<p>NB: The function would look something like this:</p>\n\n<pre><code>clearAtIndex :: MVector (PrimState m) a -&gt; Int -&gt; m ()\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 8, "last_activity_date": 1451144153, "creation_date": 1451144153, "answer_id": 34472731, "question_id": 34472715, "link": "https://stackoverflow.com/questions/34472715/haskell-difference-between-let-x-fnintstr-return-x-and-return-fninpstr/34472731#34472731", "title": "Haskell: difference between let x = fn(intStr); return x and return fn(inpStr)?", "body": "<p><code>return fn(inpStr)</code> is the same as <code>return fn insStr</code>. you probably want <code>return (fn insStr)</code>.</p>\n\n<p>In Haskell there aren't parentheses for function application, juxtaposition is enough. Parentheses are used to group things.</p>\n"}], "owner": {"reputation": 16894, "user_id": 1180720, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1881822323a2374c602ec8dafb18d46d?s=128&d=identicon&r=PG&f=1", "display_name": "gefei", "link": "https://stackoverflow.com/users/1180720/gefei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 34472731, "answer_count": 1, "score": 1, "last_activity_date": 1451144153, "creation_date": 1451143972, "question_id": 34472715, "link": "https://stackoverflow.com/questions/34472715/haskell-difference-between-let-x-fnintstr-return-x-and-return-fninpstr", "title": "Haskell: difference between let x = fn(intStr); return x and return fn(inpStr)?", "body": "<p>In Haskell, I have a function</p>\n\n<pre><code>fn :: String -&gt; Int\n</code></pre>\n\n<p>Then I try to use it in an IO monad</p>\n\n<pre><code>mn = do\n     inpStr &lt;- readFile \"input.txt\"\n     return fn(inpStr)\n</code></pre>\n\n<p><strong>EDIT</strong>: I am using GHCi, version 7.10.2</p>\n\n<p>I got the error message</p>\n\n<pre><code>Couldn't match type \u2018[Char] -&gt; Integer\u2019 with \u2018IO b\u2019\n    Expected type: String -&gt; IO b\n      Actual type: String -&gt; [Char] -&gt; Integer\n    Relevant bindings include mn :: IO b (bound at 01.hs:13:1)\n    The function \u2018return\u2019 is applied to two arguments,\n    but its type \u2018([Char] -&gt; Integer) -&gt; String -&gt; [Char] -&gt; Integer\u2019\n    has only three\n    In a stmt of a 'do' block: return fn (inpStr)\n    In the expression:\n      do { inpStr &lt;- readFile \"input.txt\";\n           return fn (inpStr) }\n</code></pre>\n\n<p>However, if I change my code to</p>\n\n<pre><code>mn = do\n     inpStr &lt;- readFile \"input.txt\"\n     let x = fn(inpStr)\n     return x\n</code></pre>\n\n<p>It works.</p>\n\n<p>What is the difference between <code>let x = fn(intStr); return x</code> and <code>return fn(inpStr)</code>?</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1451147739, "post_id": 34472711, "comment_id": 56687679, "body": "You can save a bit of boilerplate by using <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/type-class-extensions.html#class-default-signatures\" rel=\"nofollow noreferrer\">DefaultSignatures</a> and defining the default types as, e.g., <code>default vAdd :: (Num k, v ~ k) =&gt; k -&gt; k -&gt; k; vAdd = (+)</code>. Then you can simply write <code>instance Vec Int Int; instance Vec Float Float; instance Vec Integer Integer</code> etc, omitting the body of the instance."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451202018, "post_id": 34472711, "comment_id": 56698679, "body": "I wonder if it might pay to use a simple newtype mask. <code>newtype Self a = Self a</code> represents the vector field perspective of a numeric type, so then you can have <code>instance Num a =&gt; Vec (Self a) a where ...</code>."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 4, "last_activity_date": 1451148310, "last_edit_date": 1451148310, "creation_date": 1451143954, "answer_id": 34472711, "question_id": 34471950, "link": "https://stackoverflow.com/questions/34471950/confusion-with-type-inference-and-functional-dependencies/34472711#34472711", "title": "Confusion with type inference and functional dependencies", "body": "<p>You have defined very general instance: <code>Vec v ...</code>.\nWithout overlapping instances there cannot be other ones.</p>\n\n<p>E.g. adding</p>\n\n<pre><code>data V2 k = V2 k k\ninstance Num k =&gt; Vec (V2 k) k where\n</code></pre>\n\n<p>results into</p>\n\n<pre><code>Functional dependencies conflict between instance declarations:\n  instance Num k =&gt; Vec k k -- Defined at v.hs:15:10\n  instance Num k =&gt; Vec (V2 k) k -- Defined at v.hs:23:10\n</code></pre>\n\n<p>Actually overlapping instances doesn't help here either (this might be a GHC miss-feature?).</p>\n\n<p>If you try to encode this using <code>TypeFamilies</code> you get similar error:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE UndecidableInstances #-}\nmodule Vec where\n\nclass Vec v where  -- v is an element of a vector space over k\n    type Elem v\n    vZero :: v                 -- The zero vector in v\n    vAdd  :: v -&gt; v -&gt; v       -- Adds two vectors\n    vSub  :: v -&gt; v -&gt; v       -- Subtracts two vectors\n    vMul  :: v -&gt; Elem v -&gt; v  -- Multiplies a vector by a number from k\n\ninfixl 6 |+|   -- Shortcut operator for accessing vAdd\n(|+|) :: Vec v k =&gt; v -&gt; v -&gt; v\n(|+|) = vAdd\n\ndata V2 k = V2 k k\n\ninstance Num k =&gt; Vec (V2 k) where\n    type Elem (V2 k) = k\n    -- implementation omitted\n\ninstance Num k =&gt; Vec k where\n    type Elem k = k\n    vZero = 0\n    vAdd = (+)\n    vSub = (-)\n    vMul = (*)\n</code></pre>\n\n<p>errors with:</p>\n\n<pre><code>Conflicting family instance declarations:\n  Elem (V2 k) -- Defined at v.hs:20:10\n  Elem k -- Defined at v.hs:23:10\n</code></pre>\n\n<hr>\n\n<p>Solution would be to define helper functions and write instance definitions \"by hand\":</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, FunctionalDependencies #-}\nmodule Vec where\n\nclass Vec v k | v -&gt; k where  -- v is an element of a vector space over k\n    vZero :: v                -- The zero vector in v\n    vAdd  :: v -&gt; v -&gt; v      -- Adds two vectors\n    vSub  :: v -&gt; v -&gt; v      -- Subtracts two vectors\n    vMul  :: v -&gt; k -&gt; v      -- Multiplies a vector by a number from k\n\ninfixl 6 |+|   -- Shortcut operator for accessing vAdd\n(|+|) :: Vec v k =&gt; v -&gt; v -&gt; v\n(|+|) = vAdd\n\n-- The definitions are so short, that it's not worth even givin them names\nnumVZero :: Num k =&gt; k\nnumVZero = 0\n\ninstance Vec Int Int where\n    vZero = 0\n    vAdd = (+)\n    vSub = (-)\n    vMul = (*)\n\ndata V2 k = V2 k k\ninstance Num k =&gt; Vec (V2 k) k where\n    vZero = V2 0 0\n    vAdd (V2 a b) (V2 c d) = V2 (a + c) (b + d)\n    vSub (V2 a b) (V2 c d) = V2 (a - c) (b - d)\n    vMul (V2 a b) k        = V2 (a * k) (b * k)\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>\u03bb *Vec &gt; :t (|+|)\n(|+|) :: Vec v k =&gt; v -&gt; v -&gt; v\n</code></pre>\n\n<hr>\n\n<p>Or as <code>Num v =&gt; Vec v v</code> is probably going to be quite common you can use <code>DefaultSignatures</code>\nto reduce boilerplate of instance declaration:</p>\n\n<pre><code>{-# LANGUAGE GADTs, FlexibleInstances, FunctionalDependencies, DefaultSignatures #-}\nmodule Vec where\n\nclass Vec v k | v -&gt; k where  -- v is an element of a vector space over k\n    vZero :: v                -- The zero vector in v\n    default vZero :: (Num v, v ~ k) =&gt; v\n    vZero = 0\n\n    vAdd  :: v -&gt; v -&gt; v      -- Adds two vectors\n    default vAdd :: (Num v, v ~ k) =&gt; v -&gt; v -&gt; v\n    vAdd = (+)\n\n    vSub  :: v -&gt; v -&gt; v      -- Subtracts two vectors\n    default vSub :: (Num v, v ~ k) =&gt; v -&gt; v -&gt; v\n    vSub = (-)\n\n    vMul  :: v -&gt; k -&gt; v      -- Multiplies a vector by a number from k\n    default vMul :: (Num v, v ~ k) =&gt; v -&gt; k -&gt; v\n    vMul = (*)\n\ninfixl 6 |+|   -- Shortcut operator for accessing vAdd\n(|+|) :: Vec v k =&gt; v -&gt; v -&gt; v\n(|+|) = vAdd\n\ninstance Vec Int Int\ninstance Vec Integer Integer\ninstance Vec Float Float\ninstance Vec Double Double\n\ndata V2 k = V2 k k\ninstance Num k =&gt; Vec (V2 k) k where\n    vZero = V2 0 0\n    vAdd (V2 a b) (V2 c d) = V2 (a + c) (b + d)\n    vSub (V2 a b) (V2 c d) = V2 (a - c) (b - d)\n    vMul (V2 a b) k        = V2 (a * k) (b * k)\n</code></pre>\n"}], "owner": {"reputation": 489, "user_id": 2456771, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7B3j9.png?s=128&g=1", "display_name": "Prof. Legolasov", "link": "https://stackoverflow.com/users/2456771/prof-legolasov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "accepted_answer_id": 34472711, "answer_count": 1, "score": 3, "last_activity_date": 1451148310, "creation_date": 1451137841, "question_id": 34471950, "link": "https://stackoverflow.com/questions/34471950/confusion-with-type-inference-and-functional-dependencies", "title": "Confusion with type inference and functional dependencies", "body": "<p>I have the following multi-param typeclass with a functional dependency for types which are elements of vector spaces (vectors)</p>\n\n<pre><code>module Vec where\n\nclass Vec v k | v -&gt; k where  -- v is an element of a vector space over k\n    vZero :: v                -- The zero vector in v\n    vAdd  :: v -&gt; v -&gt; v      -- Adds two vectors\n    vSub  :: v -&gt; v -&gt; v      -- Subtracts two vectors\n    vMul  :: v -&gt; k -&gt; v      -- Multiplies a vector by a number from k\n\ninfixl 6 |+|   -- Shortcut operator for accessing vAdd\n(|+|) :: Vec v k =&gt; v -&gt; v -&gt; v\n(|+|) = vAdd\n</code></pre>\n\n<p>Now I load the piece of code above into the <code>ghci</code> interpreter and ask it to show me the type of operator <code>|+|</code>:</p>\n\n<pre><code>*Vec&gt; :t (|+|)\n(|+|) :: Vec v k =&gt; v -&gt; v -&gt; v\n</code></pre>\n\n<p>By now, everything seems normal. But now I want to specify that all numbers are elements of a special vector spaces over themselves:</p>\n\n<pre><code>instance Num k =&gt; Vec k k where\n    vZero = 0\n    vAdd = (+)\n    vSub = (-)\n    vMul = (*)\n</code></pre>\n\n<p>And now a strange thing happens: <code>ghci</code> no longer shows the correct type for <code>|+|</code> (despite it being explicitly specified by me in the code above):</p>\n\n<pre><code>*Vec&gt; :t (|+|)\n(|+|) :: Num v =&gt; v -&gt; v -&gt; v\n</code></pre>\n\n<p>I suspect this strange behaviour to be linked with the <code>FunctionalDependencies</code> language extension which I am using, but I don't understand why <code>ghc</code> behaves this way. I can see myself adding a different instance <code>Vec v k</code> where <code>v</code> is <strong>not</strong> an instance of <code>Num</code> and thus such instance will not overlap with the existing one, thus preserving the functional dependency.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "edited": false, "score": 1, "creation_date": 1451128692, "post_id": 34470767, "comment_id": 56683108, "body": "Your type signature is wrong, but you didn&#39;t include it in the question. The type of <code>test</code> should be <code>Int -&gt; Int -&gt; Int</code>"}, {"owner": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "edited": false, "score": 4, "creation_date": 1451128734, "post_id": 34470767, "comment_id": 56683116, "body": "Also, you need parentheses around <code>n-p</code>"}, {"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "reply_to_user": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "edited": false, "score": 0, "creation_date": 1451128943, "post_id": 34470767, "comment_id": 56683160, "body": "I did not write any type signature so far, but thanks, it was the missing parenthesis! Feel free to add it as an answer."}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1451133683, "creation_date": 1451133683, "answer_id": 34471423, "question_id": 34470767, "link": "https://stackoverflow.com/questions/34470767/what-am-i-doing-wrong-in-the-implementation-of-this-recursive-function/34471423#34471423", "title": "What am I doing wrong in the implementation of this recursive function?", "body": "<pre><code>test n p\n  |p &gt; n  = 0\n  |p == n = 1\n  |otherwise = sum [test (n-p) q|q&lt;-[1..p+1]]\n</code></pre>\n\n<p>I.e. parentheses around <code>(n-p)</code></p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1451151222, "last_edit_date": 1451151222, "creation_date": 1451147291, "answer_id": 34473135, "question_id": 34470767, "link": "https://stackoverflow.com/questions/34470767/what-am-i-doing-wrong-in-the-implementation-of-this-recursive-function/34473135#34473135", "title": "What am I doing wrong in the implementation of this recursive function?", "body": "<pre><code>sum [test n-p q|q&lt;-[1..p+1]]\n</code></pre>\n\n<p>Function application has a very high precedence in Haskell. The above is parsed as:</p>\n\n<pre><code>sum [ (test n) - (p q) |q&lt;-[1..p+1]]\n</code></pre>\n\n<p>Above <code>test</code> is used as a unary function returning a number, and <code>p</code> is also used as a unary function returning a number. This triggers a type error.</p>\n\n<p>Also, note that the <code>=&gt;</code> is wrong in the type signature:</p>\n\n<pre><code>test :: Int -&gt; Int =&gt; Int\n--                ^^^^\n</code></pre>\n\n<p>The above causes GHC to try parsing the left part <code>Int -&gt; Int</code> as if it were a class constraint, but it is a type (\"has kind <code>*</code>\", in technical terms) so an error is reported.</p>\n"}], "owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 34473135, "answer_count": 2, "score": 0, "last_activity_date": 1451151222, "creation_date": 1451128364, "last_edit_date": 1486653023, "question_id": 34470767, "link": "https://stackoverflow.com/questions/34470767/what-am-i-doing-wrong-in-the-implementation-of-this-recursive-function", "title": "What am I doing wrong in the implementation of this recursive function?", "body": "<p>This is my code so far:</p>\n\n<pre><code>test n p\n  |p &gt; n  = 0\n  |p == n = 1\n  |otherwise = sum [test n-p q|q&lt;-[1..p+1]]\n</code></pre>\n\n<p>This should implement a simple recursive function (accepting nonnegative integers)</p>\n\n<p><a href=\"https://latex.codecogs.com/gif.latex?T%28n%2Cp%29%20%3A%3D%20%5Cbegin%7Bcases%7D%200%20%26%20p%3En%20%5C%5C%201%20%26%20p%3Dn%20%5C%5C%20%5Csum%5Climits_%7Bq%3D1%7D%5E%7Bp&plus;1%7DT%28n-p%2Cq%29%20%26%20p%3Cn%20%5Cend%7Bcases%7D\" rel=\"nofollow noreferrer\"><img src=\"https://latex.codecogs.com/gif.latex?T%28n%2Cp%29%20%3A%3D%20%5Cbegin%7Bcases%7D%200%20%26%20p%3En%20%5C%5C%201%20%26%20p%3Dn%20%5C%5C%20%5Csum%5Climits_%7Bq%3D1%7D%5E%7Bp&plus;1%7DT%28n-p%2Cq%29%20%26%20p%3Cn%20%5Cend%7Bcases%7D\" alt=\"enter image description here\"></a></p>\n\n<p>However I do get an error message that I do not understand. (I was not able to copy it from the ghci console, so here I just typed it out) Can anyone tell me what is wrong here?</p>\n\n<pre><code>Expected a constraint, but 'Int' has kind '*'\nIn the type signature for 'test': test :: Int -&gt; Int =&gt; Int\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "edited": false, "score": 3, "creation_date": 1451177508, "post_id": 34469955, "comment_id": 56695023, "body": "This is covered in the <a href=\"http://docs.haskellstack.org/en/stable/faq.html#i-already-have-ghc-installed-can-i-still-use-stack\" rel=\"nofollow noreferrer\">stack FAQ</a>."}], "answers": [{"comments": [{"owner": {"reputation": 525, "user_id": 1651361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1b933ade78a3db95c560fdf309daf56?s=128&d=identicon&r=PG", "display_name": "GreenhouseVeg", "link": "https://stackoverflow.com/users/1651361/greenhouseveg"}, "edited": false, "score": 0, "creation_date": 1592127258, "post_id": 34471437, "comment_id": 110307833, "body": "I believe that by default <code>stack</code> WILL NOT use the global GHC installation, even if its version matches the project&#39;s <code>resolver</code> setting. But it is possible - <a href=\"https://stackoverflow.com/questions/34469955/haskell-stack-with-global-ghc#comment56695023_34469955\">Shaun the Sheep&#39;s comment</a> points to the documentation that explains the available options."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 4, "last_activity_date": 1451133849, "creation_date": 1451133849, "answer_id": 34471437, "question_id": 34469955, "link": "https://stackoverflow.com/questions/34469955/haskell-stack-with-global-ghc/34471437#34471437", "title": "Haskell stack with global ghc", "body": "<p>Yes. If the <code>ghc</code> in <code>PATH</code> is of right version for the selected snapshot, <code>stack</code> will happily use it.</p>\n\n<pre><code>% ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 7.8.4\n\n% stack --resolver=lts-2.22 install packdeps\nRun from outside a project, using implicit global project config\nUsing resolver: lts-2.22 specified on command line\npackdeps-0.4.1: unregistering\npackdeps-0.4.2: download\n...\n\n% stack --resolver=nightly-2015-12-25 install packdeps\nRun from outside a project, using implicit global project config\nUsing resolver: nightly-2015-12-25 specified on command line\nCompiler version mismatched, found ghc-7.8.4 (x86_64), but expected minor version match with ghc-7.10.3 (x86_64) (based on resolver setting in /Users/phadej/.stack/global/stack.yaml).\nTry running \"stack setup\" to install the correct GHC into /Users/phadej/.stack/programs/x86_64-osx/\n</code></pre>\n\n<p>You can also skip ghc check <code>--skip-ghc-check</code>:</p>\n\n<pre><code>% stack --resolver=nightly-2015-12-25 --skip-ghc-check install packdeps\nRun from outside a project, using implicit global project config\nUsing resolver: nightly-2015-12-25 specified on command line\nsplit-0.2.2: configure\n...\n</code></pre>\n\n<p>but that might be a <strong>bad</strong> idea</p>\n"}], "owner": {"reputation": 1424, "user_id": 756714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a0c58c5ad07c97f187f3a9241c4d2639?s=128&d=identicon&r=PG", "display_name": "vivian", "link": "https://stackoverflow.com/users/756714/vivian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3197, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1483475477, "creation_date": 1451121041, "last_edit_date": 1483475477, "question_id": 34469955, "link": "https://stackoverflow.com/questions/34469955/haskell-stack-with-global-ghc", "title": "Haskell stack with global ghc", "body": "<p>Is it possible to use <code>stack</code> with an already installed <code>ghc</code> without <code>stack</code> installing a local copy of <code>ghc</code> or <code>cabal</code>?</p>\n"}, {"tags": ["haskell", "locale"], "answers": [{"comments": [{"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 0, "creation_date": 1451126813, "post_id": 34470012, "comment_id": 56682678, "body": "well that&#39;s disappointing :-( It does seem to be a black hole in OS locale settings. also in C: <a href=\"http://stackoverflow.com/a/11353103/516188\">stackoverflow.com/a/11353103/516188</a> and also in javascript, it seems it&#39;s handled manually by moment.js instead of raw JS. I&#39;ll leave the question open a bit longer in case someone comes up with some hackage library doing that, and if noone provides a nicer solution, I&#39;ll award you the answer."}], "tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": true, "score": 2, "last_activity_date": 1451121666, "last_edit_date": 1495542334, "creation_date": 1451121666, "answer_id": 34470012, "question_id": 34469869, "link": "https://stackoverflow.com/questions/34469869/how-do-i-find-out-which-is-the-first-day-of-the-week-in-the-current-locale/34470012#34470012", "title": "how do I find out which is the first day of the week in the current locale?", "body": "<p>I guess you'll have to write that function yourself. From <a href=\"https://stackoverflow.com/questions/727471/how-do-i-get-the-first-day-of-the-week-for-the-current-locale-php-l8n\">this answer</a>:</p>\n\n<blockquote>\n  <p>From CLDR's <a href=\"http://unicode.org/cldr/data/common/supplemental/supplementalData.xml\" rel=\"nofollow noreferrer\">supplemental data</a>:</p>\n\n<pre>\n&lt;firstDay day=\"mon\" territories=\"001 AD AI AL AM AN AT AX AZ BA BE BG BM BN BY CH CL CM CR CY CZ DE DK EC EE ES FI FJ FO FR GB GE GF GP GR HR HU IS IT KG KZ LB LI LK LT LU LV MC MD ME MK MN MQ MY NL NO PL PT RE RO RS RU SE SI SK SM TJ TM TR UA UY UZ VA VN XK\" /&gt;\n&lt;firstDay day=\"fri\" territories=\"BD MV\" /&gt;\n&lt;firstDay day=\"sat\" territories=\"AE AF BH DJ DZ EG IQ IR JO KW LY MA OM QA SD SY\" /&gt;\n&lt;firstDay day=\"sun\" territories=\"AG AR AS AU BR BS BT BW BZ CA CN CO DM DO ET GT GU HK HN ID IE IL IN JM JP KE KH KR LA MH MM MO MT MX MZ NI NP NZ PA PE PH PK PR PY SA SG SV TH TN TT TW UM US VE VI WS YE ZA ZW\" /&gt;\n&lt;firstDay day=\"sun\" territories=\"GB\" alt=\"variant\" references=\"Shorter Oxford Dictionary (5th edition, 2002)\" /&gt;\n</pre>\n  \n  <p>(Territory 001 is \"World\")</p>\n</blockquote>\n"}], "owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 34470012, "answer_count": 1, "score": 0, "last_activity_date": 1451121666, "creation_date": 1451120144, "question_id": 34469869, "link": "https://stackoverflow.com/questions/34469869/how-do-i-find-out-which-is-the-first-day-of-the-week-in-the-current-locale", "title": "how do I find out which is the first day of the week in the current locale?", "body": "<p>How do I get the first day of the week (sunday or monday) for the current locale in <code>haskell</code>?</p>\n\n<p><a href=\"https://hackage.haskell.org/package/old-locale-1.0.0.7/docs/System-Locale.html\" rel=\"nofollow\">old-locale</a> gives me the days of the week, but in string form. I also don't find anything in the <code>time</code> library.</p>\n\n<p>I would prefer if it was a function already included in base, that I would not need to install a new external library.</p>\n"}, {"tags": ["function", "haskell", "functional-programming", "dot-operator"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 7, "creation_date": 1451084410, "post_id": 34466997, "comment_id": 56676285, "body": "The elegant way was posted below. Still, I want to remind that using <code>isJust&#47;fromJust</code> is arguably the least elegant way. Indeed, if one forgets the <code>isJust</code> check, <code>fromJust</code> can crash your program. A better way would be to use pattern matching instead, e.g. <code>case f x of Nothing -&gt; Nothing ; Just y -&gt; Just $ g y</code>. Also see <a href=\"https://existentialtype.wordpress.com/2011/03/15/boolean-blindness/\" rel=\"nofollow noreferrer\">boolean blindness</a> for more info."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1451088133, "post_id": 34466997, "comment_id": 56676906, "body": "That isn&#39;t type correct.  <code>g (fromJust (f x)) : a</code>.  I think you ment <code>Just (g (fromJust (f x))</code>."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 4, "last_activity_date": 1451122453, "last_edit_date": 1451122453, "creation_date": 1451083874, "answer_id": 34467100, "question_id": 34466997, "link": "https://stackoverflow.com/questions/34466997/combining-a-maybe-a-and-a-a-functions/34467100#34467100", "title": "Combining (a -&gt; Maybe a) and (a -&gt; a) functions", "body": "<p>Why not simply this:</p>\n\n<pre><code>h :: a -&gt; Maybe a\nh x = fmap g (f x)\n</code></pre>\n\n<p>Or the operator version:</p>\n\n<pre><code>h :: a -&gt; Maybe a\nh x = g &lt;$&gt; f x\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451090583, "post_id": 34467138, "comment_id": 56677227, "body": "I think this is the most idiomatic way, and expresses the idea the most clearly of all options."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 12, "last_activity_date": 1451116223, "last_edit_date": 1451116223, "creation_date": 1451084201, "answer_id": 34467138, "question_id": 34466997, "link": "https://stackoverflow.com/questions/34466997/combining-a-maybe-a-and-a-a-functions/34467138#34467138", "title": "Combining (a -&gt; Maybe a) and (a -&gt; a) functions", "body": "<p>Since you've tagged this question with <a href=\"/questions/tagged/dot-operator\" class=\"post-tag\" title=\"show questions tagged &#39;dot-operator&#39;\" rel=\"tag\">dot-operator</a>:</p>\n\n<pre><code>h :: a -&gt; Maybe a\nh = fmap g . f\n</code></pre>\n\n<p>For an explanation:</p>\n\n<pre><code>f            ::                          a -&gt; Maybe a\ng            ::        a -&gt;       a\nfmap g       ::  Maybe a -&gt; Maybe a\n(.)          :: (Maybe a -&gt; Maybe a) -&gt; (a -&gt; Maybe a) -&gt; (a -&gt; Maybe a)\n(.) (fmap g) ::                         (a -&gt; Maybe a) -&gt; (a -&gt; Maybe a)\nfmap g . f   ::                                           (a -&gt; Maybe a)\nh            ::                                            a -&gt; Maybe a\n</code></pre>\n\n<p>Note that <code>(.)</code>'s and <code>fmap g</code>'s types are actually more general:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)\n-- b in this case is Maybe a\n-- c in this case is Maybe a\n\nfmap g :: Functor f =&gt; f a -&gt; f a\n-- f in this case is Maybe\n</code></pre>\n\n<p>However, you could also pattern match on the result of <code>f</code>:</p>\n\n<pre><code>h x = \n  case f x of\n    Just k -&gt; Just (g k)\n    _      -&gt; Nothing\n</code></pre>\n\n<p>Note that your original example wouldn't even compile, since <code>g</code>'s return type isn't correct.</p>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451150826, "post_id": 34467172, "comment_id": 56688524, "body": "Given that the user is (probably) new to Haskell, would you add some explanation? Not everyone is familiar with <code>Functor ((-&gt;) r)</code>. Using <code>b ~ a</code>, <code>f a ~ Maybe a</code> and <code>g c ~ a -&gt; c</code> would make this a lot clearer for them."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451152254, "post_id": 34467172, "comment_id": 56688900, "body": "@Zeta, I wanted to make it look like a puzzle."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1451342953, "post_id": 34467172, "comment_id": 56745646, "body": "so, in <code>fmap . fmap</code> the left <code>fmap</code> is in <code>(a -&gt;)</code>, because <code>fmap g</code> is always a function, whatever the functor. the  right <code>fmap</code> here happens to be in <code>Maybe</code>. (and in owl combinator, it&#39;s in (r -&gt;) too. nice.)"}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 5, "last_activity_date": 1451152296, "last_edit_date": 1495539892, "creation_date": 1451084509, "answer_id": 34467172, "question_id": 34466997, "link": "https://stackoverflow.com/questions/34466997/combining-a-maybe-a-and-a-a-functions/34467172#34467172", "title": "Combining (a -&gt; Maybe a) and (a -&gt; a) functions", "body": "<p>Having</p>\n\n<pre><code>fmap2 :: (Functor g, Functor f) =&gt; (a -&gt; b) -&gt; g (f a) -&gt; g (f b)\nfmap2 = fmap . fmap\n</code></pre>\n\n<p>here is a funny way:</p>\n\n<pre><code>h :: a -&gt; Maybe a\nh = fmap2 g f\n</code></pre>\n\n<p><code>fmap2 g f ~&gt; fmap (fmap g) f ~&gt; fmap g . f ~&gt; \\x -&gt; fmap g (f x)</code></p>\n\n<p>The <a href=\"https://stackoverflow.com/a/5316690/3237465\"><code>Functor ((-&gt;) r)</code></a> instance is used here: <code>fmap</code> can be used instead of <code>(.)</code>.</p>\n"}], "owner": {"reputation": 648, "user_id": 3746344, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/535099e26619eeb7031527c47b1ab665?s=128&d=identicon&r=PG&f=1", "display_name": "Savenkov Alexey", "link": "https://stackoverflow.com/users/3746344/savenkov-alexey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 34467138, "answer_count": 3, "score": 3, "last_activity_date": 1451152296, "creation_date": 1451082853, "last_edit_date": 1451122697, "question_id": 34466997, "link": "https://stackoverflow.com/questions/34466997/combining-a-maybe-a-and-a-a-functions", "title": "Combining (a -&gt; Maybe a) and (a -&gt; a) functions", "body": "<p>I have two functions:</p>\n\n<pre><code>f :: a -&gt; Maybe a\ng :: a -&gt; a\n</code></pre>\n\n<p>I want to create such function:</p>\n\n<pre><code>h :: a -&gt; Maybe a\n\nh x\n| isJust(f x) = Just (g $ fromJust(f x))\n| otherwise   = Nothing\n</code></pre>\n\n<p>How can I do it in more elegant way?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451078346, "post_id": 34466329, "comment_id": 56675003, "body": "Is this actually a question, or only a suggestion? Also, any kind of pattern matching that tries to evaluate a diverging term to WHNF will show that behaviour. If you pattern match subpatterns, how do you know WHICH of the values will match, and which will diverge? Unfortunately, <a href=\"https://en.wikipedia.org/wiki/Halting_problem\" rel=\"nofollow noreferrer\">you don&#39;t</a>, and Haskell <a href=\"https://en.wikipedia.org/wiki/Total_functional_programming\" rel=\"nofollow noreferrer\">isn&#39;t total</a>. By the way, you might be interested in this paper: <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/pattern-matching/gadtpm.pdf\" rel=\"nofollow noreferrer\">research.microsoft.com/en-us/um/people/simonpj/papers/&hellip;</a>."}, {"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451078503, "post_id": 34466329, "comment_id": 56675043, "body": "It&#39;s a question - I&#39;m sure there&#39;s a very good reason for the current rules, I just can&#39;t imagine what it is."}, {"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451078595, "post_id": 34466329, "comment_id": 56675069, "body": "And sorry, you&#39;re going to have to go through the thing about the Halting problem more slowly.  Can&#39;t Haskell already decide whether something fails or diverges?"}, {"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451078803, "post_id": 34466329, "comment_id": 56675105, "body": "Oh, I see.  So matching the value x :: Int defined by x = x on the pattern 3 will never terminate and hence will cause a super-pattern to diverge as well.  But what about undefined, which the compiler can tell does diverge?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1451079088, "post_id": 34466329, "comment_id": 56675166, "body": "IIRC, <code>undefined = error &quot;Prelude.undefined&quot;</code>, and <code>error</code> is basically raising an exception: <code>error s = throw (errorCallException s)</code>. So it&#39;s an exception, hidden in the darks, getting thrown when you try to look into the value. And when you use <code>foo undefined &quot;Goodbye&quot;</code>, you&#39;re actually using <code>foo (undefined :: Int) &quot;Goodbye&quot;</code>, so the compiler still generates code that checks the value of <code>undefined</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451079311, "post_id": 34466329, "comment_id": 56675205, "body": "There&#39;s not much &quot;magic&quot; going on there, although a compiler could probably recognize the <code>undefined</code>. However, <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-230003.1\" rel=\"nofollow noreferrer\">sec 3</a> states that the program <b>must</b> terminate if it encounters <code>_|_</code>, which is <code>undefined</code>."}, {"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451079496, "post_id": 34466329, "comment_id": 56675247, "body": "Why though?  There&#39;s no problem with a never terminating calculation if it the result is irrelevant anyway, as above."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451108671, "post_id": 34466329, "comment_id": 56679584, "body": "@Zeta, many programs fail to terminate when they encounter <code>_|_</code>! Ideally, they shouldn&#39;t terminate with wrong answers in that case, but compiler writers are likely to see that as a suggestion."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451115851, "post_id": 34466329, "comment_id": 56680596, "body": "@dfeuer, yeah, bad phrasing on my side, sorry. <i>&quot;The actual program behavior when an error occurs is up to the implementation&quot;</i> However, after some sleep, I think my previous comment is completely off: if a program encounters <code>_|_</code>, how does it know it actually encountered <code>_|_</code> (apart from <code>undefined</code>, <code>error</code>, <code>&lt;&lt;loop&gt;&gt;</code> and some other checkable bottoms)? Either way, I think Rein&#39;s answer ties all the other answers together in a single post (although I&#39;m considering to write an ELI5 style answer later)."}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1451080460, "post_id": 34466549, "comment_id": 56675452, "body": "Meh, I&#39;ve deleted my comment, but it still stands, you just moved the paragraph. It&#39;s not due to WHNF -&gt; NF. After all <code>(Foo _ _)</code> is still not NF. And the second example fails due to left-to-right evaluation order in pattern matching."}], "tags": [], "owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "is_accepted": false, "score": 1, "last_activity_date": 1451080218, "last_edit_date": 1451080218, "creation_date": 1451078670, "answer_id": 34466549, "question_id": 34466329, "link": "https://stackoverflow.com/questions/34466329/haskell-pattern-matching-on-undefined-values/34466549#34466549", "title": "Haskell: pattern matching on undefined values", "body": "<p>You might want to take a look at <a href=\"https://www.haskell.org/definition/haskell2010.pdf\" rel=\"nofollow\">The 2010 Haskell Language Report</a>, specifically, section 3.1 on Errors.</p>\n\n<p><strong>Short answer:</strong> Your example fails because of WHNF -> NF evaluation, which has to do with Haskell's laziness, which makes it possible that some values will never be used or \"looked at\"; if Haskell's laziness rules allow <code>undefined</code> to be skipped over, you won't get a crash and error code. Otherwise, you will. In that case, you did. Changing that behavior wouldn't involve changing <code>undefined</code> so much as it would involve changing Haskell's evaluation strategies.</p>\n\n<p><strong>Observations:</strong></p>\n\n<p>[] is just syntactic sugar for repeated application of (:) + a Nil, so it's not true that \"it can be constructed with either\", or it is true, but misleading, because they are actually the same thing.</p>\n\n<p>The way you've phrased <code>undefined</code> make it seem as if it's a sensible value for cases where types (or pattern matches) aren't fully determinable, however, as far as I understand it, this is not the purpose of <code>undefined</code>. Rather, given that it has a type of <code>undefined :: t</code>, it allows you to place it inside of a function and have that function typecheck in most scenarios.</p>\n\n<p>Let me phrase that another way: <code>undefined</code> <em>ought</em> to be used to leave a function in some real sense of the word, undefined, while allowing you to compile because <code>undefined</code>'s type will make it typecheck (otherwise you'd have to remove that function from scope). <code>undefined</code>, I do not believe, has any other purpose (and ideally, you should use <code>error</code> for this instead). If you call a function with <code>undefined</code> in it, <em>and</em> Haskell ever evaluates <code>undefined</code> (I think this would be taking it from a WHNF representation to NF), then you'll get a crash + error message.</p>\n\n<p>The fact that people use <code>undefined</code> for other reasons like examining laziness properties of Haskell does not to me mean that <code>undefined</code> itself is supposed to have any behavior or properties other than throwing an error every time the compiler sees it. The fact that it does that is why it's a useful function for looking at those properties of Haskell. The key observation is that this shows how Haskell evaluates anything, not just <code>undefined</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "edited": false, "score": 0, "creation_date": 1451079879, "post_id": 34466623, "comment_id": 56675338, "body": "Sorry, I don&#39;t get your first comment.  Your absolutely right about a non-terminating calculation, I hadn&#39;t thought of that.  I guess what I&#39;m asking is that if <code>undefined</code> is supposed to represent a non-terminating calculation, but the compiler can tell that it never terminates, then why not have behaviour like I suggested?  If the result of a non-terminating calculation is irrelevant, then why make the pattern diverge anyway?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "edited": false, "score": 1, "creation_date": 1451080182, "post_id": 34466623, "comment_id": 56675388, "body": "@RhubarbAndC: About the first comment: <code>null (undefined :: [a])</code> should not evaluate to <code>True</code>, since <code>undefined</code> isn&#39;t equal to the empty list. But it should also not evaluate to <code>False</code>, since <code>undefined</code> isn&#39;t equal to &quot;any value being consed onto another list&quot;. There&#39;s only one way to get out of there: <code>null (undefined)</code> is\u2026 undefined. It&#39;s bottom (<code>_|_</code>). And if that&#39;s hidden somewhere in another evaluation, it&#39;s bottom all the way down."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1451080611, "post_id": 34466623, "comment_id": 56675488, "body": "For the first comment: again, think of a non-terminating calculation. Say, one that returns an empty list if it ever finds a solution to Fermat&#39;s theorem, so you can be pretty sure the compiler won&#39;t be able to tell if it terminates. Then calling <code>null</code> on it won&#39;t terminate either, so it&#39;s also undefined."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451080942, "post_id": 34466623, "comment_id": 56675570, "body": "@AlexeyRomanov: Don&#39;t tell that <a href=\"https://www.youtube.com/watch?v=rNNnPrMHsAA&amp;feature=youtu.be&amp;t=480\" rel=\"nofollow noreferrer\">the C++ programmers</a> :)."}, {"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "edited": false, "score": 0, "creation_date": 1451081848, "post_id": 34466623, "comment_id": 56675782, "body": "Sorry I was unclear, I knew that <code>null undefined</code> is undefined."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 5, "last_activity_date": 1451081159, "last_edit_date": 1451081159, "creation_date": 1451079335, "answer_id": 34466623, "question_id": 34466329, "link": "https://stackoverflow.com/questions/34466329/haskell-pattern-matching-on-undefined-values/34466623#34466623", "title": "Haskell: pattern matching on undefined values", "body": "<blockquote>\n  <p>(By the way - if you disagree with my suggestion that undefined is built with a constructor, then surely null (undefined :: [a]) should evaluate to False? After all undefined isn't equivalent to []!)</p>\n</blockquote>\n\n<p>This means it shouldn't evaluate to <code>True</code>, and it doesn't.</p>\n\n<blockquote>\n  <p>What I am suggesting is that if any of the sub-patterns fail then the whole pattern should fail; if none fail but some diverge then the whole pattern should diverge; and if all succeed then the whole pattern should succeed.</p>\n</blockquote>\n\n<p>How could this be implemented? To find whether the first sub-pattern fails, you need to evaluate that argument; and if it diverges, the evaluation won't finish and the entire pattern match diverges by definition. You could try to evaluate all the patterns \"in parallel\", but this would greatly complicate the language: the current definition converts multiple equations into one which does <code>case</code> on the first argument, then on the second one, etc., so it doesn't introduce any new concepts; yours would have to.</p>\n\n<p>I wouldn't quite say \"<code>undefined</code> is supposed to represent a non-terminating calculation\", but you aren't supposed to be able to distinguish them:</p>\n\n<blockquote>\n  <p><a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch1.html#x6-120001.3\" rel=\"nofollow\">Errors in Haskell are semantically equivalent to \u22a5 (\u201cbottom\u201d). Technically, they are indistinguishable from nontermination, so the language includes no mechanism for detecting or acting upon errors. However, implementations will probably try to provide useful information about errors. See Section 3.1. </a> </p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1451081075, "post_id": 34466765, "comment_id": 56675595, "body": "<i>&quot;I expect <code>silly loop</code> to loop but not <code>silly (Foo loop loop)</code>.&quot;</i> I really need to write this down."}, {"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "edited": false, "score": 0, "creation_date": 1451081607, "post_id": 34466765, "comment_id": 56675740, "body": "Sorry, I was unclear, I know that <code>null undefined</code> is <code>undefined</code> not <code>False</code>. So essentially, read <code>undefined</code> as &quot;This would cause your program to run forever&quot; not &quot;This is not well defined&quot;, and read <code>Exception: Prelude.undefined</code> as &quot;Watch out! Your program would have never terminated if undefined was loop&quot; rather than &quot;I don&#39;t know what to do because I don&#39;t know what value undefined is&quot;.  Perhaps undefined should really be called loop, or even neverTerminates?"}, {"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "edited": false, "score": 0, "creation_date": 1451082018, "post_id": 34466765, "comment_id": 56675811, "body": "Is that right?  If it is then I&#39;ll accept this answer and be very satisfied."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1451083647, "post_id": 34466765, "comment_id": 56676135, "body": "<code>undefined</code> is definetly not <code>I don&#39;t know what value it is</code>, there is <code>Nothing</code> for that. <code>undefined</code>means <code>it diverges</code> which is you can&#39;t expect GHC to reduce  <code>undefined :: Foo</code> to <code>Foo undefined undefined</code> or even pattern match on <code>undefined</code>. You can see more <a href=\"https://wiki.haskell.org/Bottom\" rel=\"nofollow noreferrer\">there</a>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "edited": false, "score": 3, "creation_date": 1451084785, "post_id": 34466765, "comment_id": 56676361, "body": "@RhubarbAndC That&#39;s a possible reasonable interpretation of <code>undefined</code>. Another could be &quot;this should never have happened! abort the program&quot; or even &quot;this was not implemented -- aborting&quot;."}, {"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1451119485, "post_id": 34466765, "comment_id": 56681176, "body": "@chi But... why is something not being implemented a problem <i>if the answer is irrelevant anyway.</i>  Surely, the only reason why lack of implementation is important is if the compiler can not determine how the program should proceed."}, {"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "edited": false, "score": 0, "creation_date": 1451120317, "post_id": 34466765, "comment_id": 56681342, "body": "@mb14 I think Nothing is &quot;not a value&quot; in a completely different sense.  I am convinced on the diverging calculation front: if undefined represents and infinite loop, then the current rules make perfect sense.  However, I thought it could also mean &quot;this person did not give a definition for this value&quot; - so I don&#39;t know what it is.  In this case the current rules seem strange in the cases I showed above.  I&#39;m beginning to suspect that this is not what undefined means at all - it&#39;s just a bad choice of name.  Does this sound reasonable?"}, {"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "edited": false, "score": 0, "creation_date": 1451120704, "post_id": 34466765, "comment_id": 56681432, "body": "&quot;I don&#39;t know what it is&quot; means &quot;the compiler doesn&#39;t know what it is&quot; above."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1451145005, "post_id": 34466765, "comment_id": 56686864, "body": "@RhubardAndC Loop on this own is not really usefull and its own. People don&#39;t really need to insert looping value in their code, unless when they need <i>A</i> value that need to implement later (which is the use case of <i>undefined</i>) Loop is only value which can fit this role."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "edited": false, "score": 0, "creation_date": 1451146405, "post_id": 34466765, "comment_id": 56687289, "body": "@RhubarbAndC Indeed, it works as you describe. If the answer is irrelevant, you will never try to evaluate <code>undefined</code>, so no error occurs. If one instead does evaluate it, then that means the result is relevant, and unexpectedly so -- hence the runtime error."}], "tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": true, "score": 8, "last_activity_date": 1451106547, "last_edit_date": 1451106547, "creation_date": 1451080514, "answer_id": 34466765, "question_id": 34466329, "link": "https://stackoverflow.com/questions/34466329/haskell-pattern-matching-on-undefined-values/34466765#34466765", "title": "Haskell: pattern matching on undefined values", "body": "<p>Basically, you are saying that <code>undefined :: Foo</code> and <code>Foo undefined undefined</code> should be the same because (as you said <code>But whatever the value is, it must be constructed with Foo.)</code>.</p>\n\n<p>This assumption is not correct. Foo <em>must</em> be constructed with <code>Foo</code> only if it <em>can</em> be constructed. What if I have <code>foo = if x then (Foo 1 \"a\")  else (Foo 2 \"b\")</code>. If <code>x</code> is undefined then trying to evaluate <code>f</code> diverges. At that point, there is no notion of constructor or not. It just diverges. </p>\n\n<p>It is the same with your example <code>null (undefined :: [a])</code> should be <code>undefined</code> (diverge) as well because you need to try to evaluate the parameter of <code>null</code> to know if it's a <code>[]</code> or a <code>:</code>. </p>\n\n<p>Undefined in Haskell is not magic, it's just a loop. You could define your own <code>loop = let x = x in x</code>. This will loop each time you try to evaluate it.\ncalling <code>null loop</code> or <code>sill loop</code> will loop and therefore is equal to <code>loop</code>, isn't it ?. Do you still consider that <code>loop :: Foo</code> and <code>Foo loop loop</code> are the same ? I don't. I expect <code>silly loop</code> to loop but not <code>silly (Foo loop loop)</code>.</p>\n\n<p>The only difference between this <code>loop</code> and <code>undefined</code> is just that ghc can detect <code>undefined</code> is a loop and so break the look and display an error message instead of looping forever. It's just there for convenience and if it wasn't there, people would define <code>undefined = loop</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "edited": false, "score": 0, "creation_date": 1451120591, "post_id": 34468321, "comment_id": 56681403, "body": "So undefined doesn&#39;t mean &quot;the programmer gave no definition&quot; - it always represents an infinite loop.  The fact that it is used to plug gaps in incomplete definitions is just for convenience, and it really symbolises an infinite loop.  Surely this makes it a pretty bad choice of name?  Shouldn&#39;t it be called something a bit clearer, like neverEnd?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "edited": false, "score": 0, "creation_date": 1451122758, "post_id": 34468321, "comment_id": 56681830, "body": "It turns out that a value which is an inhabitant of all types is useful for things besides being an infinite loop, especially one which terminates when scrutinized with a user-defined error message. <code>undefined</code> represents bottom, and it can be used for other things as well. The point is that if it did not have the semantics of bottom, it wouldn&#39;t be sensible."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "edited": false, "score": 0, "creation_date": 1451123391, "post_id": 34468321, "comment_id": 56681962, "body": "Put another way, an infinite loop that magically terminated on scrutinization with an error message would be a very handy way of representing &quot;the programmer gave no definition&quot; in Haskell, since it can be used as a stand-in for a value of any type. That is exactly what <code>undefined</code> is, and hopefully explains why it is used in that way."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451154165, "post_id": 34468321, "comment_id": 56689499, "body": "The <i>denotational</i> semantics here are less specific than the <i>operational</i> semantics based on imprecise exceptions. I suspect a denotational semantics for those would be too complicated to be useful."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451157468, "post_id": 34468321, "comment_id": 56690441, "body": "@dfeuer Good point! I suppose I meant &quot;semantics&quot; in whatever way the report uses the term when it says that their semantics must be the same. ;)"}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 4, "last_activity_date": 1451124342, "last_edit_date": 1451124342, "creation_date": 1451101778, "answer_id": 34468321, "question_id": 34466329, "link": "https://stackoverflow.com/questions/34466329/haskell-pattern-matching-on-undefined-values/34468321#34468321", "title": "Haskell: pattern matching on undefined values", "body": "<p>You are starting from a false premise.</p>\n\n<blockquote>\n  <p>For instance: <code>undefined :: [Int]</code> is a list, so it must be constructed with either <code>[]</code> or <code>(:)</code>, but it doesn't know which one! </p>\n</blockquote>\n\n<p>No, it is constructed with neither. <code>undefined :: [Int]</code> is a list in the sense of being a value of type <code>[a]</code> for some <code>a</code>. It is not a list in the sense of being constructed with either <code>[]</code> or <code>(:)</code>. This would be circular reasoning: \"It is a list because it is constructed with <code>[]</code> or <code>(:)</code>. It is constructed with <code>[]</code> or <code>(:)</code> because it is a list.\"</p>\n\n<blockquote>\n  <p>(By the way - if you disagree with my suggestion that <code>undefined</code> is built with a constructor, then surely <code>null (undefined :: [a])</code> should evaluate to <code>False</code>? After all undefined isn't equivalent to <code>[]</code>!)</p>\n</blockquote>\n\n<p>By your logic, <code>let loop = loop in null loop</code> must also give <code>False</code> because <code>loop</code> isn't equivalent to <code>[]</code>, as must all other forms of non-termination. This would make <code>null</code> a solution to the Halting Problem*!</p>\n\n<p>The mistake you have made is that <code>null</code> does not actually ask if the value is constructed with <code>[]</code> <em>or not</em>. It asks whether the value is constructed with <code>[]</code>, constructed with <code>(:)</code>, <em>or none of the above</em>. Since <code>undefined</code> is constructed with neither <code>[]</code> nor <code>(:)</code>, <code>null undefined</code> is neither <code>True</code> nor <code>False</code>. This is because Haskell's boolean logic is, in fact, a three-value system: <code>Bool</code> is inhabited by <code>True</code>, <code>False</code>, and bottom. It is entirely possible for a predicate to have an answer which is neither <code>True</code> nor <code>False</code>. Indeed, because Haskell is not a total language, it <em>must</em> be possible.</p>\n\n<p>Here's another counterexample:</p>\n\n<pre><code>data Void\n</code></pre>\n\n<p>is a type with no constructors. If <code>undefined</code> must be constructed then it could not inhabit <code>Void</code> because <code>Void</code> has no constructors. But it <em>does</em> inhabit <code>Void</code>. GHC will happily accept <code>undefined :: Void</code>. </p>\n\n<p>Since it is not true that <code>undefined</code> must be constructed, I won't address the rest of the arguments based on this premise.</p>\n\n<p>Now, let's talk about why the given definition of <code>undefined</code> might be so. I will argue that <code>undefined</code> is a user-friendly alternative to nontermination for representing bottom.</p>\n\n<p>Since Haskell is a non-total language with general recursion, one can always define:</p>\n\n<pre><code>undefined :: a\nundefined = undefined\n</code></pre>\n\n<p>This <code>undefined</code> is a bottom value, an inhabitant of every type. However, it is not a particularly user-friendly bottom value because any scrutinization will cause a program to hang indefinitely. The <code>undefined</code> in the Prelude is a user-friendly alternative: scrutinization does not cause a program to hang but rather terminates the program immediately. However, in all other respects, <code>Prelude.undefined</code> must act like a bottom value if it is to be of use.</p>\n\n<p>Consider the alternative, where <code>Prelude.undefined</code> was somehow observably different under evaluation from a \"true\" bottom value. This would mean that we have <em>two</em> extra inhabitants of every type: the \"true\" bottom value and an extra non-bottom value with subtly different semantics. This would not be useful, for what I hope are obvious reasons.</p>\n\n<p>Thus, in order for <code>Prelude.undefined</code> to be useful, it must have equivalent behavior under evaluation to <code>undefined = undefined</code>. The fact that the behavior is not <em>identical</em> is a matter of convenience, but we can and should treat the result of its evaluation as <em>equivalent</em>. Consider the error that it throws to mean \"GHC managed to detect this nonterminating program for you. You are welcome, but you might not be so lucky next time.\" In fact, by this logic you should also consider any values built using <code>error</code> to be similarly equivalent bottom values. It is the only useful, consistent interpretation.</p>\n\n<hr>\n\n<p>* Or rather, <code>null</code> and a <code>notNull</code> that similarly checks for <code>(:)</code> and gives <code>False</code> for bottoms would form a solution to the halting problem: <code>halts x = null x || notNull x</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 4369, "user_id": 3102935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/22985d9fffff3b76a11b1f2bccbf2f42?s=128&d=identicon&r=PG&f=1", "display_name": "WorldSEnder", "link": "https://stackoverflow.com/users/3102935/worldsender"}, "is_accepted": false, "score": 1, "last_activity_date": 1564690642, "creation_date": 1564690642, "answer_id": 57316434, "question_id": 34466329, "link": "https://stackoverflow.com/questions/34466329/haskell-pattern-matching-on-undefined-values/57316434#57316434", "title": "Haskell: pattern matching on undefined values", "body": "<p>Complementary to all the other answers, there is a way to catch an exception. The downside is that you will have to perform your operation in the IO monad. I will explain. The things to look at are <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Exception.html#v:evaluate\" rel=\"nofollow noreferrer\"><code>evaluate</code></a>, <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Exception.html#v:try\" rel=\"nofollow noreferrer\"><code>try</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Exception.html#t:ErrorCall\" rel=\"nofollow noreferrer\"><code>ErrorCall</code></a>. It works like this:</p>\n\n<pre><code>import Control.Exception\n\ntest :: a -&gt; IO (Either ErrorCall a)\ntest val = try (evaluate val)\n\nmain = do\n    result &lt;- test (undefined :: String)\n    print result\n</code></pre>\n\n<p>This will print</p>\n\n<pre><code>Left Prelude.undefined\nCallStack (from HasCallStack):\n error, called at libraries/base/GHC/Err.hs:79:14 in base:GHC.Err\n undefined, called at main.hs:7:21 in main:Main\n</code></pre>\n\n<p>While using anything other than <code>undefined</code> will the string, e.g.</p>\n\n<pre><code>Right \"foo\"\n</code></pre>\n"}], "owner": {"reputation": 484, "user_id": 3539877, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52926a415d282244cd022fcc313ef42b?s=128&d=identicon&r=PG&f=1", "display_name": "RhubarbAndC", "link": "https://stackoverflow.com/users/3539877/rhubarbandc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1150, "favorite_count": 1, "accepted_answer_id": 34466765, "answer_count": 5, "score": 4, "last_activity_date": 1564690642, "creation_date": 1451076943, "last_edit_date": 1451083114, "question_id": 34466329, "link": "https://stackoverflow.com/questions/34466329/haskell-pattern-matching-on-undefined-values", "title": "Haskell: pattern matching on undefined values", "body": "<p>As I understand it, Haskell's <code>undefined</code> value - of a particular type - is a value that can't be determined, for whatever reason (maybe there is no sensible definition, or the calculation diverges).  For instance: <code>undefined :: [Int]</code> is a list, so it must be constructed with either [] or (:), but it doesn't know which one!  Hence it makes sense that case splitting on undefined makes the whole expression undefined: I don't know whether <code>null (undefined :: [a])</code> is True or False, because I don't know whether <code>undefined :: [a]</code> is empty or not.</p>\n\n<p>(By the way - if you disagree with my suggestion that <code>undefined</code> <em>is</em> built with a constructor, then surely <code>null (undefined :: [a])</code> should evaluate to False?  After all <code>undefined</code> isn't equivalent to []!)</p>\n\n<p>However, Haskell pattern matching doesn't follow this way of thinking.</p>\n\n<pre><code>data Foo = Foo Int String  -- Only one data constructor\n\nsilly :: Foo -&gt; Bool\nsilly (Foo _ _) = True\n\nghci&gt; silly (undefined :: Foo)\n*** Exception: Prelude.undefined    -- But whatever the value is, it must \n                                    -- be constructed with Foo.\n                                    -- So why fail to match?\n</code></pre>\n\n<p>(I know that newtype behaves differently here.)</p>\n\n<p>Also:</p>\n\n<pre><code>foo :: Int -&gt; String -&gt; Bool\nfoo 8 \"Hello\" = True\nfoo _ _       = False\n\nghci&gt; foo undefined undefined\n*** Exception: Prelude.undefined     -- GOOD - can't tell which case to choose.\n\nghci&gt; foo undefined \"Hello\"\n*** Exception: Prelude.undefined     -- GOOD - still can't tell.\n\nghci&gt; foo undefined \"Goodbye\"\n*** Exception: Prelude.undefined     -- BAD  - should return false!\n                                     -- Pattern match on first line should fail,\n                                     -- because whatever the int is, the\n                                     -- string can't match the given pattern.\n</code></pre>\n\n<p>I think the rules on pattern matching currently say that if a sub-pattern fails then the pattern should immediately fail; if it diverges, then the whole pattern should also diverge; and if it succeeds, then the next sub-pattern should be tried.  If all sub-patterns succeed, then the whole pattern succeeds.</p>\n\n<p>What I am suggesting is that if any of the sub-patterns fail then the whole pattern should fail; if none fail but some diverge then the whole pattern should diverge; and if all succeed then the whole pattern should succeed.</p>\n\n<p>Why is this not how Haskell does things?</p>\n\n<hr>\n\n<p>EDIT:</p>\n\n<p>So to summarise my interpretation of the responses I've read:</p>\n\n<p><code>undefined</code> should be read as \"This would cause your program to run forever\" not \"This is not well defined\", and <code>Exception: Prelude.undefined</code> should be read as \"Watch out! Your program would have never terminated if undefined was an infinite loop\" rather than \"I don't know what to do because I don't know what value undefined is\".</p>\n\n<p>Could somebody please verify that this is correct?  If so then I will probably accept mb14's answer.</p>\n\n<p>Thanks everyone. Sorry for being so slow on the uptake!</p>\n"}, {"tags": ["haskell", "web", "utf-8", "bytestring", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1451061052, "post_id": 34464409, "comment_id": 56670896, "body": "Please paste in the error you get from GHC."}, {"owner": {"reputation": 171, "user_id": 3038478, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/DZCnu.gif?s=128&g=1", "display_name": "jeshaitan", "link": "https://stackoverflow.com/users/3038478/jeshaitan"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1451064012, "post_id": 34464409, "comment_id": 56671597, "body": "@HaoLian I think that the error messages are basically just summed up as &quot;<code>[Char]</code> doesn&#39;t match expected <code>ByteString</code>&quot;"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1451064625, "post_id": 34464409, "comment_id": 56671749, "body": "If you write <code>{-# LANGUAGE OverloadedStrings #-}</code> at the top of the file, the string literals can be read as bytestrings, and it looks like most of these errors will go away. As it is, the compiler can only understand them as <code>[Char]</code>."}, {"owner": {"reputation": 171, "user_id": 3038478, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/DZCnu.gif?s=128&g=1", "display_name": "jeshaitan", "link": "https://stackoverflow.com/users/3038478/jeshaitan"}, "edited": false, "score": 0, "creation_date": 1451065083, "post_id": 34464409, "comment_id": 56671875, "body": "Thanks! I just figured that out and was about to close the question, but thanks still!"}], "answers": [{"tags": [], "owner": {"reputation": 171, "user_id": 3038478, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/DZCnu.gif?s=128&g=1", "display_name": "jeshaitan", "link": "https://stackoverflow.com/users/3038478/jeshaitan"}, "is_accepted": false, "score": 4, "last_activity_date": 1451065145, "creation_date": 1451065145, "answer_id": 34465015, "question_id": 34464409, "link": "https://stackoverflow.com/questions/34464409/why-does-the-snap-example-use-bytestring/34465015#34465015", "title": "Why does the Snap example use Bytestring?", "body": "<p>I needed to add <code>{-# LANGUAGE OverloadedStrings #-}</code> to the top of the file, so that string literals can be read as ByteStrings.</p>\n"}], "owner": {"reputation": 171, "user_id": 3038478, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/DZCnu.gif?s=128&g=1", "display_name": "jeshaitan", "link": "https://stackoverflow.com/users/3038478/jeshaitan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1451065145, "creation_date": 1451060166, "last_edit_date": 1451063526, "question_id": 34464409, "link": "https://stackoverflow.com/questions/34464409/why-does-the-snap-example-use-bytestring", "title": "Why does the Snap example use Bytestring?", "body": "<p>I'm following the Snap example project, but when I copied the example code, Stack gave me errors complaining about the use of <code>writeBS</code> and how it expects a <code>ByteString</code> but is given a <code>[Char]</code>. So I imported a ByteString library and tried to convert all of the strings to ByteStrings using the 'fromString' method, but Stack is giving me the same error, claiming that the Srings are still <code>[Char]</code>. Here's the doctored example code:</p>\n\n<pre><code>module Main where\n\nimport           Snap\nimport           Snap.Types\nimport           Snap.Util.FileServe\nimport           Control.Applicative\nimport           Heist\nimport qualified Data.ByteString.UTF8 as BU\n\nmain :: IO ()\nmain = quickHttpServe site\n\nsite :: Snap ()\nsite =\n    ifTop (writeBS $ BU.fromString \"hello world\") &lt;|&gt;\n    route [ (\"foo\", writeBS $ BU.fromString \"bar\")\n          , (\"echo/:echoparam\", echoHandler)\n          ] &lt;|&gt;\n    dir \"static\" (serveDirectory \".\")\n\nechoHandler :: Snap ()\nechoHandler = do\n    param &lt;- getParam \"echoparam\"\n    maybe (writeBS $ BU.fromString \"must specify echo/param in URL\")\n          writeBS $ BU.fromString param\n</code></pre>\n\n<p>Error Message after trying to fix with <code>fromString</code>:</p>\n\n<pre><code>/home/jeshaitan/Personal/yapp/src/Main.hs:16:14:\n    Couldn't match expected type \u2018BU.ByteString\u2019\n                with actual type \u2018[Char]\u2019\n    In the expression: \"foo\"\n    In the expression: (\"foo\", writeBS $ BU.fromString \"bar\")\n    In the first argument of \u2018route\u2019, namely\n      \u2018[(\"foo\", writeBS $ BU.fromString \"bar\"),\n        (\"echo/:echoparam\", echoHandler)]\u2019\n\n/home/jeshaitan/Personal/yapp/src/Main.hs:17:14:\n    Couldn't match expected type \u2018BU.ByteString\u2019\n                with actual type \u2018[Char]\u2019\n    In the expression: \"echo/:echoparam\"\n    In the expression: (\"echo/:echoparam\", echoHandler)\n    In the first argument of \u2018route\u2019, namely\n      \u2018[(\"foo\", writeBS $ BU.fromString \"bar\"),\n        (\"echo/:echoparam\", echoHandler)]\u2019\n\n/home/jeshaitan/Personal/yapp/src/Main.hs:19:9:\n    Couldn't match expected type \u2018BU.ByteString\u2019\n                with actual type \u2018[Char]\u2019\n    In the first argument of \u2018dir\u2019, namely \u2018\"static\"\u2019\n    In the second argument of \u2018(&lt;|&gt;)\u2019, namely\n      \u2018dir \"static\" (serveDirectory \".\")\u2019\n    In the expression:\n      ifTop (writeBS $ BU.fromString \"hello world\")\n      &lt;|&gt;\n        route\n          [(\"foo\", writeBS $ BU.fromString \"bar\"),\n           (\"echo/:echoparam\", echoHandler)]\n      &lt;|&gt; dir \"static\" (serveDirectory \".\")\n\n/home/jeshaitan/Personal/yapp/src/Main.hs:23:23:\n    Couldn't match expected type \u2018BU.ByteString\u2019\n                with actual type \u2018[Char]\u2019\n    In the first argument of \u2018getParam\u2019, namely \u2018\"echoparam\"\u2019\n    In a stmt of a 'do' block: param &lt;- getParam \"echoparam\"\n    In the expression:\n      do { param &lt;- getParam \"echoparam\";\n           maybe\n             (writeBS $ BU.fromString \"must specify echo/param in URL\") writeBS\n           $ BU.fromString param }\n\n/home/jeshaitan/Personal/yapp/src/Main.hs:25:21:\n    Couldn't match expected type \u2018Maybe BU.ByteString\u2019\n                with actual type \u2018BU.ByteString\u2019\n    In the second argument of \u2018($)\u2019, namely \u2018BU.fromString param\u2019\n    In a stmt of a 'do' block:\n      maybe\n        (writeBS $ BU.fromString \"must specify echo/param in URL\") writeBS\n      $ BU.fromString param\n\n/home/jeshaitan/Personal/yapp/src/Main.hs:25:35:\n    Couldn't match type \u2018Maybe BU.ByteString\u2019 with \u2018[Char]\u2019\n    Expected type: String\n      Actual type: Maybe BU.ByteString\n    In the first argument of \u2018BU.fromString\u2019, namely \u2018param\u2019\n    In the second argument of \u2018($)\u2019, namely \u2018BU.fromString param\u2019\n\n--  While building package yapp-0.1.0.0 using:\n      /home/jeshaitan/.stack/setup-exe-cache/x86_64-linux/setup-Simple-Cabal-1.22.4.0-ghc-7.10.2 --builddir=.stack-work/dist/x86_64-linux/Cabal-1.22.4.0 build exe:yapp --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n"}, {"tags": ["haskell", "build", "dependencies"], "answers": [{"comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1451059103, "post_id": 34464071, "comment_id": 56670399, "body": "Probably he can try editing the cabal file and see if things work with the new GHC. :)"}, {"owner": {"reputation": 615, "user_id": 4176597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4f118d3068ac55ffc44752d308d50ee7?s=128&d=identicon&r=PG&f=1", "display_name": "ethanabrooks", "link": "https://stackoverflow.com/users/4176597/ethanabrooks"}, "edited": false, "score": 0, "creation_date": 1451191510, "post_id": 34464071, "comment_id": 56696943, "body": "I see. I didn&#39;t know about the GHC &gt;= 7.8 constraint for stack. I did try editing the cabal file by commenting out the requirements for <code>base &gt;=4.6 &amp;&amp; &lt;4.7</code>, and ran into the following: <code>Could not find module \u2018Data.List\u2019 It is a member of the hidden package \u2018base-4.8.1.0\u2019.</code> and same for \u2018Prelude.\u2019 Perhaps it is best to work on this one without Stack, which I guess means downloading the older version of GHC?"}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 2, "last_activity_date": 1451204618, "last_edit_date": 1451204618, "creation_date": 1451057302, "answer_id": 34464071, "question_id": 34463990, "link": "https://stackoverflow.com/questions/34463990/stack-doesnt-install-correct-version-of-haskell-base-library/34464071#34464071", "title": "Stack doesn&#39;t install correct version of Haskell base library", "body": "<p><code>base</code> is a library bundled with GHC (the compiler). For each GHC version, there is one <code>base</code> version.</p>\n\n<p>To install <a href=\"http://hackage.haskell.org/package/deeplearning-hs\" rel=\"nofollow\"><code>deeplearning-hs</code></a>, seems you need to satisfy <code>base == 4.6.*</code> constraint, i.e. have GHC version 7.6. Unfortunately you cannot install GHC older then 7.8 with stack AFAIK.</p>\n\n<p>You can play with it locally if you change <code>base &gt;=4.6 &amp;&amp; &lt;4.7</code> bounds to <code>base &gt;= 4.6 &amp;&amp; &lt;4.8</code>, i.e. allow <code>base</code> coming with GHC 7.8 for example. Note, you shouldn't <em>remove</em> dependencies, you should try to <em>relax</em> the constraints (i.e. version bounds). I tried locally, and the package seems to compile with GHC 7.8. It doesn't compile with GHC 7.10 as <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Prelude710/FTP\" rel=\"nofollow\">Foldable-Traversal-Proposal</a> affects this package.</p>\n\n<p>IMHO best way is to contact the maintainer and ask for upgrade, or even better submit a pull request, as source seems to be on GitHub (<a href=\"http://matrix.hackage.haskell.org/package/deeplearning-hs\" rel=\"nofollow\">which I did</a>).</p>\n\n<p>P.S. <a href=\"http://matrix.hackage.haskell.org/package/deeplearning-hs\" rel=\"nofollow\">I relaxed the bounds on Hackage</a>, so you can install it with GHC 7.8 without worries now.</p>\n"}], "owner": {"reputation": 615, "user_id": 4176597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4f118d3068ac55ffc44752d308d50ee7?s=128&d=identicon&r=PG&f=1", "display_name": "ethanabrooks", "link": "https://stackoverflow.com/users/4176597/ethanabrooks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 684, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1451204618, "creation_date": 1451056612, "question_id": 34463990, "link": "https://stackoverflow.com/questions/34463990/stack-doesnt-install-correct-version-of-haskell-base-library", "title": "Stack doesn&#39;t install correct version of Haskell base library", "body": "<p>I am fairly new to Haskell. I am trying to build a project downloaded from GitHub using stack. When I try to run <code>stack solver</code>, I get this output:</p>\n\n<pre><code>cabal: Could not resolve dependencies:\ntrying: deeplearning-hs-0.1.0.2 (user goal)\nnext goal: base (dependency of deeplearning-hs-0.1.0.2)\nrejecting: base-4.8.1.0/installed-075... (conflict: deeplearning-hs =&gt;\nbase&gt;=4.6 &amp;&amp; &lt;4.7)\nrejecting: base-4.8.1.0 (global constraint requires installed instance)\nrejecting: base-4.8.0.0, 4.7.0.2, 4.7.0.1, 4.7.0.0, 4.6.0.1, 4.6.0.0, 4.5.1.0,\n4.5.0.0, 4.4.1.0, 4.4.0.0, 4.3.1.0, 4.3.0.0, 4.2.0.2, 4.2.0.1, 4.2.0.0,\n4.1.0.0, 4.0.0.0, 3.0.3.2, 3.0.3.1 (global constraint requires ==4.8.1.0)\nDependency tree exhaustively searched.\n</code></pre>\n\n<p>The issue seems to be this \"global constraint\" but I'm not sure where that's coming from. I have looked through my global .cabal files and they are pretty generic--they don't seem to specify the versions of anything.</p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 5716818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43f6bf3da641bad6b62f89f9c241d4b1?s=128&d=identicon&r=PG&f=1", "display_name": "danpomaro", "link": "https://stackoverflow.com/users/5716818/danpomaro"}, "edited": false, "score": 0, "creation_date": 1451055303, "post_id": 34463711, "comment_id": 56669486, "body": "So if I understand what you&#39;re saying, if <code>a</code> and <code>b</code> are lenses then so is <code>a . b</code>. But <code>traverse . a</code> is no longer a lens but a traversal. Is there any other way traversals are produced by composition? If <code>c</code> and <code>d</code> are traversals, is <code>c . d</code> also a traversal?"}, {"owner": {"reputation": 2332, "user_id": 615030, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Yd1uW.png?s=128&g=1", "display_name": "Artyom", "link": "https://stackoverflow.com/users/615030/artyom"}, "reply_to_user": {"reputation": 33, "user_id": 5716818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43f6bf3da641bad6b62f89f9c241d4b1?s=128&d=identicon&r=PG&f=1", "display_name": "danpomaro", "link": "https://stackoverflow.com/users/5716818/danpomaro"}, "edited": false, "score": 2, "creation_date": 1451060615, "post_id": 34463711, "comment_id": 56670781, "body": "@danpomaro Yep. <code>lens + lens</code> = lens; <code>lens + traversal</code> = <code>traversal + lens</code> = <code>traversal + traversal</code> = traversal."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 33, "user_id": 5716818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43f6bf3da641bad6b62f89f9c241d4b1?s=128&d=identicon&r=PG&f=1", "display_name": "danpomaro", "link": "https://stackoverflow.com/users/5716818/danpomaro"}, "edited": false, "score": 0, "creation_date": 1451150537, "post_id": 34463711, "comment_id": 56688436, "body": "@danpomaro The <a href=\"http://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lens documentation</a> includes a diagram with details; compose things from two blue boxes, and what you get is something from any blue box that they both have a path to."}], "tags": [], "owner": {"reputation": 2332, "user_id": 615030, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Yd1uW.png?s=128&g=1", "display_name": "Artyom", "link": "https://stackoverflow.com/users/615030/artyom"}, "is_accepted": true, "score": 5, "last_activity_date": 1451053960, "creation_date": 1451053960, "answer_id": 34463711, "question_id": 34463638, "link": "https://stackoverflow.com/questions/34463638/simple-haskell-lens-from-tutorial-violates-lens-law/34463711#34463711", "title": "Simple haskell lens from tutorial violates lens law", "body": "<p>This is a lens law, and <code>tp</code> is a traversal, so it doesn't have to abide by this law.</p>\n\n<p>Strictly speaking, <code>view</code> shouldn't work with traversals at all (it works anyway, but it does so by combining the gathered results monoidally).</p>\n"}], "owner": {"reputation": 33, "user_id": 5716818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43f6bf3da641bad6b62f89f9c241d4b1?s=128&d=identicon&r=PG&f=1", "display_name": "danpomaro", "link": "https://stackoverflow.com/users/5716818/danpomaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 1, "accepted_answer_id": 34463711, "answer_count": 1, "score": 3, "last_activity_date": 1451053960, "creation_date": 1451053327, "question_id": 34463638, "link": "https://stackoverflow.com/questions/34463638/simple-haskell-lens-from-tutorial-violates-lens-law", "title": "Simple haskell lens from tutorial violates lens law", "body": "<p>I'm reading this tutorial:</p>\n\n<p><a href=\"http://blog.jakubarnold.cz/2014/08/06/lens-tutorial-stab-traversal-part-2.html\" rel=\"nofollow\">http://blog.jakubarnold.cz/2014/08/06/lens-tutorial-stab-traversal-part-2.html</a></p>\n\n<p>and my code looks like this:</p>\n\n<pre><code>import Control.Applicative\nimport Data.Traversable\nimport Control.Lens\n\ndata User = User String [Post] deriving Show\ndata Post = Post String deriving Show\n\nposts :: Lens' User [Post]\nposts f (User n p) = fmap (User n) (f p)\n\nusers :: [User]\nusers = [User \"john\" [Post \"hello\", Post \"world\"], User \"bob\" [Post \"foobar\"]]\n\ntp :: (Traversable t, Applicative f) =&gt; ([Post] -&gt; f [Post]) -&gt; t User -&gt; f (t User)\ntp = traverse . posts\n</code></pre>\n\n<p>Now following the blog post, here are some common lens computations:</p>\n\n<pre><code>*Main&gt; view tp users\n[Post \"hello\",Post \"world\",Post \"foobar\"]\n\n*Main&gt; set tp [Post \"x\",Post \"y\"] users\n[User \"john\" [Post \"x\",Post \"y\"],User \"bob\" [Post \"x\",Post \"y\"]]\n\n*Main&gt; view tp (set tp [Post \"x\",Post \"y\"] users)\n[Post \"x\",Post \"y\",Post \"x\",Post \"y\"]\n</code></pre>\n\n<p>The last evaluation has left me confused. Isn't the following lens law supposed to hold?</p>\n\n<pre><code>view l (set l v s) = v\n</code></pre>\n\n<p>(The law is taken from <a href=\"http://artyom.me/lens-over-tea-2\" rel=\"nofollow\">http://artyom.me/lens-over-tea-2</a>.)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1451056643, "post_id": 34462047, "comment_id": 56669797, "body": "Concerning the list, try <code>[1,2] &gt;&gt; [3,4]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 193, "user_id": 5463444, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lPzwisp-ft0/AAAAAAAAAAI/AAAAAAAAABQ/ta_crd5F46g/photo.jpg?sz=128", "display_name": "Wung Hugh", "link": "https://stackoverflow.com/users/5463444/wung-hugh"}, "edited": false, "score": 0, "creation_date": 1451043302, "post_id": 34462099, "comment_id": 56666637, "body": "Yeah, that makes great sense!"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 193, "user_id": 5463444, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lPzwisp-ft0/AAAAAAAAAAI/AAAAAAAAABQ/ta_crd5F46g/photo.jpg?sz=128", "display_name": "Wung Hugh", "link": "https://stackoverflow.com/users/5463444/wung-hugh"}, "edited": false, "score": 1, "creation_date": 1451044679, "post_id": 34462099, "comment_id": 56666913, "body": "@WungHugh: Don&#39;t add additional questions into an existing question. <b><i>Especially</i></b> if you already accepted an answer. Otherwise remove the &quot;accepted&quot; mark, and clear up the title, since the question is now about <code>(&gt;&gt;)</code> and monads in general, not <code>putStrLn</code> and <code>getLine</code> only."}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": false, "score": 4, "last_activity_date": 1451039937, "creation_date": 1451039937, "answer_id": 34462099, "question_id": 34462047, "link": "https://stackoverflow.com/questions/34462047/why-is-this-getline-and-putstrln-behave-different/34462099#34462099", "title": "why is this: getLine and putStrLn behave different?", "body": "<p><code>getLine</code> has signature <code>IO String</code>, while <code>putStrLn</code> has signature <code>String -&gt; IO ()</code>. As a result, when you use <code>&gt;&gt;</code> with <code>getLine</code>, the <code>String</code> part of the result gets discarded, and you only see the result from the second <code>getLine</code>. On the other hand, with <code>putStrLn</code>, the result is actually <code>()</code>, so you don't see the difference when that gets discarded, since the value has already been printed to the output.</p>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1451045078, "post_id": 34462621, "comment_id": 56667011, "body": "Feel free to add the following TL;DR: <i>&quot;<code>(&gt;&gt;)</code> ignores the returned values, but not the side effects, and its side effects are dictated by the <code>Monad</code> instance.&quot;</i>"}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 2, "last_activity_date": 1451046838, "last_edit_date": 1451046838, "creation_date": 1451044607, "answer_id": 34462621, "question_id": 34462047, "link": "https://stackoverflow.com/questions/34462047/why-is-this-getline-and-putstrln-behave-different/34462621#34462621", "title": "why is this: getLine and putStrLn behave different?", "body": "<blockquote>\n  <p>I just want to get what (>>) have in common for all instances. If it just abandon the previous result, I think every type can have this method easily.</p>\n</blockquote>\n\n<p>If you look at the signature: <code>(&gt;&gt;) :: m a -&gt; m b -&gt; m b</code>, you could think it's implemented as <code>_ &gt;&gt; x = x</code>. But you already see it must work differently from your list example. In fact, it's implemented as <code>x &gt;&gt; y = x &gt;&gt;= \\_ -&gt; y</code>. So:</p>\n\n<ol>\n<li><p>it \"runs\" the monadic action <code>x</code> (of type <code>m a</code>), and ignores the actual values of type <code>a</code> in the result, but <code>&gt;&gt;=</code> can use its \"shape\" or side-effects (in <code>List</code> case, it's the number of elements; in <code>Maybe</code> case, it's whether you have a <code>Just</code> or <code>Nothing</code>; for <code>IO</code>, it's the side effects; etc);</p></li>\n<li><p>every type which has <code>&gt;&gt;=</code> does have <code>&gt;&gt;</code> easily; it's only a method of <code>Monad</code> instead of a separate function because for some types you can implement it more efficiently than the default version, but it must always give the same result.</p></li>\n</ol>\n"}], "owner": {"reputation": 193, "user_id": 5463444, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lPzwisp-ft0/AAAAAAAAAAI/AAAAAAAAABQ/ta_crd5F46g/photo.jpg?sz=128", "display_name": "Wung Hugh", "link": "https://stackoverflow.com/users/5463444/wung-hugh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 34462621, "answer_count": 2, "score": 0, "last_activity_date": 1451046838, "creation_date": 1451039532, "last_edit_date": 1451043633, "question_id": 34462047, "link": "https://stackoverflow.com/questions/34462047/why-is-this-getline-and-putstrln-behave-different", "title": "why is this: getLine and putStrLn behave different?", "body": "<pre><code>*Main&gt; getLine &gt;&gt; getLine\nfoo\nbar\n\"bar\"\n*Main&gt; putStrLn \"foo\" &gt;&gt; putStrLn \"bar\"\nfoo\nbar\n</code></pre>\n\n<p>Does (>>) have a consistent meaning for all instances?</p>\n\n<p>But how about this:</p>\n\n<pre><code>*Main&gt; [1,2] &gt;&gt; [1,2]\n[1,2,1,2]\n</code></pre>\n\n<p>I just want to get what (>>) have in common for all instances. If it just abandon the previous result, I think every type can have this method easily.</p>\n"}, {"tags": ["string", "algorithm", "haskell"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1451038804, "post_id": 34461777, "comment_id": 56665796, "body": "<code>there will be 2 title string in the text</code> In this particular text, title strings in the text itself always come right after newlines. In the index they are preceded by spaces."}, {"owner": {"reputation": 88499, "user_id": 650405, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5cdee2abea51e91756076032f0053081?s=128&d=identicon&r=PG", "display_name": "Karoly Horvath", "link": "https://stackoverflow.com/users/650405/karoly-horvath"}, "edited": false, "score": 0, "creation_date": 1451040529, "post_id": 34461777, "comment_id": 56666120, "body": "What&#39;s a section? Looks like a key part of the question, and probably the first thing to split by, yet you hardly even mention it in your question."}, {"owner": {"reputation": 2974, "user_id": 5387592, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/158566e536e93ce6484396f33f5361c0?s=128&d=identicon&r=PG&f=1", "display_name": "guillaume girod-vitouchkina", "link": "https://stackoverflow.com/users/5387592/guillaume-girod-vitouchkina"}, "edited": false, "score": 0, "creation_date": 1451040790, "post_id": 34461777, "comment_id": 56666170, "body": "it would be more clear if you put some little examples among your algorithm, especially paragraphs, titles, sections."}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1451054240, "post_id": 34461777, "comment_id": 56669228, "body": "I added the updates to the question. Thanks for warning"}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1451138738, "post_id": 34464332, "comment_id": 56685314, "body": "I don&#39;t think this is the right solution for my problem :/"}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1451141385, "post_id": 34464332, "comment_id": 56685955, "body": "Please do elaborate on why!"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1451142211, "post_id": 34464332, "comment_id": 56686180, "body": "First of all, i don&#39;t think this does not solve the problem for not having any empty lines between the title and the paragraph, and your test case is an array of integers and i couldn&#39;t solve how to test with my file. And the code is so complicated and advance for me which i don&#39;t want it to be because i am very new to haskell and looking for a more basic and understandable solution."}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1453503908, "post_id": 34464332, "comment_id": 57646462, "body": "@user3104760: were you able to use any of the above?"}, {"owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "edited": false, "score": 0, "creation_date": 1453627956, "post_id": 34464332, "comment_id": 57677878, "body": "Yep sorry for misunderstanding of mine i was just learning brand new. Thanks for helping :)"}], "tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": true, "score": 0, "last_activity_date": 1451099121, "last_edit_date": 1451099121, "creation_date": 1451059610, "answer_id": 34464332, "question_id": 34461777, "link": "https://stackoverflow.com/questions/34461777/how-can-i-get-the-first-and-last-paragraph-of-each-section-of-a-document/34464332#34464332", "title": "How can I get the first and last paragraph of each section of a document?", "body": "<p>Here is a sketch for how I would approach this problem.</p>\n\n<p>I assume you have some function <code>isTitle :: String -&gt; Bool</code> that can\ndetermine if a certain string is a title and that you have your text\nsplit into a list of paragraphs and titles (i.e. of type <code>[String]</code>).</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\nmodule FindParagraphs where\n\nimport Data.Maybe\n</code></pre>\n\n<p>I start with a datatype with a cursor of two elements into a list,\nsuch a datatype is often called a Zipper.</p>\n\n<pre><code>data TwoZip a =\n  TwoZip { front :: [a]\n         , first :: a\n         , second :: a\n         , back :: [a]\n         }\n  deriving (Eq, Show)\n\n-- make a zipper from a list\nmkZip :: [a] -&gt; Maybe (TwoZip a)\nmkZip (first:second:back) = Just (TwoZip [] first second back)\nmkZip _ = Nothing\n\n-- advance the zipper\nadvance :: TwoZip a -&gt; Maybe (TwoZip a)\nadvance TwoZip{..}\n  | (x:xs) &lt;- back = Just (TwoZip (first:front) second x xs)\nadvance _ = Nothing\n\n-- and rewind our zipper (not needed in this case but nice for\n-- completeness sake)\nrewind :: TwoZip a -&gt; Maybe (TwoZip a)\nrewind TwoZip{..}\n  | (x:xs) &lt;- front = Just (TwoZip xs x first (second:back))\nrewind _ = Nothing\n</code></pre>\n\n<p>To find all first paragraphs we iterate over the paragraphs and look\nat the first element in our zipper, if it is a title we know that the\nnext element in the zipper is a first paragraph, then we advance!</p>\n\n<pre><code>findFirsts\n  :: (String -&gt; Bool) -- ^ is collection of words a title\n  -&gt; [String] -- ^ Titles and paragraphs\n  -&gt; [String] -- ^ last and first paragraphs\nfindFirsts isTitle paragraphs = reverse (go (fromJust (mkZip paragraphs)) [])\n  where\n    go\n      :: TwoZip String\n      -&gt; [String]\n      -&gt; [String]\n    go z@TwoZip{..} firsts =\n      let\n        firsts' =\n          if isTitle first\n          then second:firsts\n          else firsts\n      in case advance z of\n        Nothing -&gt; firsts'\n        Just z' -&gt; go z' firsts'\n</code></pre>\n\n<p>And then some (simplified) test data:</p>\n\n<pre><code>testData = map show [1,2,3,1,3,4,1,4,3]\nisTitle = (== \"1\")\n\nfirst_paragraphs = findFirsts isTitle testData\n</code></pre>\n\n<p>And as we would want:</p>\n\n<pre><code>\u03bb&gt; first_paragraphs\n[\"2\",\"3\",\"4\"]\n</code></pre>\n\n<p>You can probably figure out how to extend this to also finding the\nlast paragraph and how to do them in one iteration.</p>\n"}], "owner": {"reputation": 131, "user_id": 3104760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006220746001/picture?type=large", "display_name": "user3104760", "link": "https://stackoverflow.com/users/3104760/user3104760"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 34464332, "answer_count": 1, "score": 0, "last_activity_date": 1451099121, "creation_date": 1451036667, "last_edit_date": 1451044310, "question_id": 34461777, "link": "https://stackoverflow.com/questions/34461777/how-can-i-get-the-first-and-last-paragraph-of-each-section-of-a-document", "title": "How can I get the first and last paragraph of each section of a document?", "body": "<p>I am having trouble in constructing the algorithm for the following problem: given a textbook (<a href=\"http://www.gutenberg.org/ebooks/6052?msg=welcome_stranger\" rel=\"nofollow\">this one</a>), find every first and last paragraph of every section. </p>\n\n<p>Getting every paragraph is easy in Haskell using <code>split</code>, <code>groupify</code> or <code>filter</code> by passing the newline parameter and that works fine. However, the rest is complicated for me (I'm only familiar with OOP). If we take the titles as the base case, there will be two title strings in the text: one in the index part, and one in the text itself. How can the program distinguish between them? Furthermore, how can the code know whether there are two empty lines between two paragraphs?</p>\n\n<p>This is my attempt to solve the problem;</p>\n\n<ol>\n<li><p>Get every paragraph into an array by splitting the text into elements of paragraph</p></li>\n<li><p>Search the index of the titles in the array and find the second occurence of each title and name that index </p></li>\n<li><p>Get paragraph_array[index+1] as the first element </p></li>\n<li><p>Get paragraph_array[index-1] as the last element of previous section. </p></li>\n</ol>\n\n<p>I am very confused. Any help would be very appreciated.</p>\n\n<p>UPDATE: A section is something like a part of every title. For example a calculus book may contain 12 chapter and each chapter may have 8 sections. We need to think for that book it has only one chapter and it has 4-5 sections. \nA title can be INTEGRAL, LIMIT, etc. </p>\n"}, {"tags": ["haskell", "yesod", "hamlet"], "answers": [{"comments": [{"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 1, "creation_date": 1610751660, "post_id": 34462339, "comment_id": 116240581, "body": "This is the best framework! Congrats to all people that developed Yesod!"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 4, "last_activity_date": 1451041851, "creation_date": 1451041851, "answer_id": 34462339, "question_id": 34460877, "link": "https://stackoverflow.com/questions/34460877/how-to-avoid-whitespace-after-a-tag-link-in-hamlet-templates/34462339#34462339", "title": "How to avoid whitespace after a tag (link) in Hamlet templates?", "body": "<p>Some options:</p>\n\n<ol>\n<li>Add <code>$newline never</code> to the top of your file, to change the default of adding newlines after tags.</li>\n<li>Add a <code>#</code> immediately following the word <code>here</code> to disable the automatic newline for just that tag.</li>\n<li>Use the explicit end tag like you tried to. But to make this work, you need to start the line with a backslash to tell Hamlet not to autoclose the tag for you: <code>\\&lt;a href=#&gt;here&lt;/a&gt;.</code></li>\n</ol>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 34462339, "answer_count": 1, "score": 4, "last_activity_date": 1451041851, "creation_date": 1451028231, "question_id": 34460877, "link": "https://stackoverflow.com/questions/34460877/how-to-avoid-whitespace-after-a-tag-link-in-hamlet-templates", "title": "How to avoid whitespace after a tag (link) in Hamlet templates?", "body": "<p>I cannot find a way to render a link and then comma or full stop right after\nit, without whitespace between the link and punctuation. Here is my initial\nattempt:</p>\n\n<pre><code>&lt;p&gt;\n  You can find more information #\n  &lt;a href=\"@{SomeRouteR}\"&gt;here\n  \\.\n</code></pre>\n\n<p>or</p>\n\n<pre><code>&lt;p&gt;\n  You can find more information #\n  &lt;a href=\"@{SomeRouteR}\"&gt;here\n  .\n</code></pre>\n\n<p>This inserts space between the word \u201chere\u201d and \u201c.\u201d.</p>\n\n<p>Another option is:</p>\n\n<pre><code>&lt;p&gt;\n  You can find more information #\n  &lt;a href=\"@{SomeRouteR}\"&gt;here&lt;/a&gt;.\n</code></pre>\n\n<p>This looks like a win, but HTML is malformed:</p>\n\n<pre><code>&lt;p&gt;You can find more information &lt;a href=\"\u2026\"&gt;here&lt;/a&gt;.&lt;/a&gt;&lt;/p&gt;\n</code></pre>\n\n<p>Is there a way to avoid whitespace between the link and punctuation/other\nelement?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 402, "user_id": 4674225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66f4e8f49f5ccc43297b4b185cd3866b?s=128&d=identicon&r=PG&f=1", "display_name": "No_signal", "link": "https://stackoverflow.com/users/4674225/no-signal"}, "edited": false, "score": 3, "creation_date": 1451025778, "post_id": 34460160, "comment_id": 56663274, "body": "You can&#39;t implement sequenceA without traverse and you can&#39;t implement traverse without sequenceA."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 4, "creation_date": 1451029892, "post_id": 34460160, "comment_id": 56664063, "body": "<code>Traversable</code> is a stronger claim than just <code>Functor</code> and <code>Foldable</code>.  You <i>cannot</i> define <code>traverse</code> or <code>sequenceA</code> in terms of <code>Functor</code> and <code>Foldable</code> functions alone, though you can define them in terms of each other."}], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 9, "last_activity_date": 1451026966, "creation_date": 1451026966, "answer_id": 34460760, "question_id": 34460160, "link": "https://stackoverflow.com/questions/34460160/implementing-traverse-and-sequencea/34460760#34460760", "title": "Implementing `traverse` and `sequenceA`", "body": "\n\n<p>Given:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>traverse' :: (Functor t, Foldable t, Applicative f) =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\ntraverse' a2fb ta = sequenceA' (fmap a2fb ta)\n\nsequenceA' :: (Functor t, Foldable t, Applicative f) =&gt; t (f a) -&gt; f (t a)\nsequenceA' tfa = _\n</code></pre>\n\n<p>An ideal use of holes! We give a name to all our parameters (no need to go pointfree and make our lives difficult just quite yet) and stick a hole where a definition should be. This yields:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>src/Main.hs:8:14: Found hole \u2018_\u2019 with type: f (t a) \u2026\n</code></pre>\n\n<p>We now cast around for a function that returns something like <code>f (t a)</code>. As luck would have it, <code>traverse'</code> does and now we can refine our hole to:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>sequenceA' :: (Functor t, Foldable t, Applicative f) =&gt; t (f a) -&gt; f (t a)\nsequenceA' tfa = traverse _ _\n\nsrc/Main.hs:8:27: Found hole \u2018_\u2019 with type: a0 -&gt; f a \u2026\nsrc/Main.hs:8:29: Found hole \u2018_\u2019 with type: t a0 \u2026\n</code></pre>\n\n<p>That first one looks messy, but we know something that fits the <code>t a0</code> for the second one, which is our <code>tfa</code>. Plug and chug:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>sequenceA' :: (Functor t, Foldable t, Applicative f) =&gt; t (f a) -&gt; f (t a)\nsequenceA' tfa = traverse _ tfa\n\nsrc/Main.hs:8:27: Found hole \u2018_\u2019 with type: f a -&gt; f a \u2026\n</code></pre>\n\n<p>Well, we know of a function with that signature, and that's <code>id</code>. So our final answer is:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>traverse' :: (Functor t, Foldable t, Applicative f) =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\ntraverse' a2fb ta = sequenceA' (fmap a2fb ta)\n\nsequenceA' :: (Functor t, Foldable t, Applicative f) =&gt; t (f a) -&gt; f (t a)\nsequenceA' tfa = traverse id tfa\n</code></pre>\n\n<p>We can now go young, wild, and pointfree(-ish):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>traverse' :: (Functor t, Foldable t, Applicative f) =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\ntraverse' a2fb = sequenceA' . fmap a2fb\n\nsequenceA' :: (Functor t, Foldable t, Applicative f) =&gt; t (f a) -&gt; f (t a)\nsequenceA' = traverse id\n</code></pre>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/Data.Traversable.html#Traversable\">Which matches the definitions in Prelude.</a> ~holes~</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "accepted_answer_id": 34460760, "answer_count": 1, "score": 3, "last_activity_date": 1451026966, "creation_date": 1451019891, "last_edit_date": 1451022765, "question_id": 34460160, "link": "https://stackoverflow.com/questions/34460160/implementing-traverse-and-sequencea", "title": "Implementing `traverse` and `sequenceA`", "body": "<p>I'm trying to implement <code>traverse</code> and <code>sequenceA</code> on my own:</p>\n\n<p>Here's my implementation of <code>traverse'</code> in terms of <code>sequenceA</code>:</p>\n\n<pre><code>traverse' :: (Functor t, Foldable t, Applicative f) =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\ntraverse' f x = sequenceA' $ fmap f x \n</code></pre>\n\n<p>However, I'm stuck on implementing <code>sequenceA</code>.</p>\n\n<pre><code>sequenceA' :: (Functor t, Foldable t, Applicative f) =&gt; t (f a) -&gt; f (t a)\nsequenceA' x = foldr (\\a _ -&gt; fmap helper a) (error \"...\") x\n</code></pre>\n\n<p>I used a placeholder for <code>b</code> (<code>error \"...\"</code>) - I'm not sure how to create a <code>b</code> given these types. </p>\n\n<pre><code>helper :: (Functor t, Foldable t) =&gt; a -&gt; t a\nhelper x = error \"TODO\"\n</code></pre>\n\n<p>Also, I used the <code>helper</code> function to get this code to type-check. But, again, that's simply an <code>error</code> call.\nPlease give me a hint on how to generically implement <code>sequenceA</code>.</p>\n"}, {"tags": ["haskell", "types", "ghc", "typeclass", "curry-howard"], "comments": [{"owner": {"reputation": 4517, "user_id": 125421, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4b385fddccf1b5305dbf5c7f6f4d0ecc?s=128&d=identicon&r=PG", "display_name": "Nathan Howell", "link": "https://stackoverflow.com/users/125421/nathan-howell"}, "edited": false, "score": 1, "creation_date": 1451005838, "post_id": 34458851, "comment_id": 56660612, "body": "Have you tried splitting the instances up into more (non-overlapping) modules?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1451032074, "post_id": 34458851, "comment_id": 56664479, "body": "GHC can not simply choose any arbitrary instance, since their contexts might be not satisfied. To pick one, GHC would need to do backtracking, but it is designed not to do that."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1451148134, "post_id": 34458851, "comment_id": 56687796, "body": "All of those overlapping instances fulfill one purpose - construct some default value for some type. You do not use the mappend of Monoid or the succ of Enum, for example, so using those constraints here is certainly wrong (semantically). Fortunately there is a <a href=\"https://hackage.haskell.org/package/data-default-0.5.3/docs/Data-Default.html\" rel=\"nofollow noreferrer\">library</a> which captures the &quot;default value&quot; relation in a typeclass called <code>Default</code>, allowing you to write one instance: <code>instance Default a =&gt; Constructive a where lem = Right default</code>."}], "answers": [{"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 2, "last_activity_date": 1451814596, "creation_date": 1451814596, "answer_id": 34575209, "question_id": 34458851, "link": "https://stackoverflow.com/questions/34458851/can-i-tell-ghc-to-arbitrarily-select-which-instance-to-use-because-i-dont-care/34575209#34575209", "title": "Can I tell GHC to arbitrarily select which instance to use, because I don&#39;t care?", "body": "<p>This is not really an answer to your question, more like an extended comment suggesting another route how to tackle the problem.</p>\n\n<p>In Haskell the canonical solution would be to create a <code>newtype</code> for each of your instances, which is probably not what you want. However, I'd like to suggest you an alternative approach.</p>\n\n<p>In Haskell we basically have 3 possibilities how to construct a data type:</p>\n\n<ol>\n<li>Algebraic data types using products and <a href=\"https://en.wikipedia.org/wiki/Coproduct\" rel=\"nofollow\">coproducts</a> (disjoint unions).</li>\n<li>Function types.</li>\n<li>Primitive types.</li>\n</ol>\n\n<p>For the first part, we could use <a href=\"https://wiki.haskell.org/Scrap_your_boilerplate\" rel=\"nofollow\">SYB</a> or <a href=\"https://wiki.haskell.org/GHC.Generics\" rel=\"nofollow\">GHC Generics</a>. If a product is empty, or has an empty factor, it maps to <code>a -&gt; Void</code>. And a coproduct maps to <code>a -&gt; Void</code> iff all its summands do.</p>\n\n<p>A function type <code>a -&gt; b</code> is constructive if both <code>a</code> and <code>b</code> are:</p>\n\n<pre><code>instance (Constructive a, Constructive b) =&gt; Constructive (a -&gt; b) where\n  ...\n</code></pre>\n\n<p>If <code>x :: b</code> is nonempty, <code>a -&gt; b</code> is inhabited by <code>const x</code>. If <code>a</code> is empty then <code>a -&gt; b</code> is inhabited by <code>absurd</code>. And if <code>a</code> is non-empty and <code>b</code> is empty, <code>a -&gt; b</code> maps to <code>Void</code>.</p>\n\n<p>All Haskell primitive types are non-empty, so they're trivially constructive.</p>\n\n<p>Unfortunately it seems there is no way to tell GHC that all data types are one of these three. My suggestion would be to implement the instance for <code>-&gt;</code> and then either</p>\n\n<ul>\n<li>Try to use SYB to implement an instance for everything that implements <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Data.html#t:Data\" rel=\"nofollow\"><code>Data</code></a>. There would still be the problem how to deal with overlapping instances. Or:</li>\n<li>Try to use GHC Generics to provide default instances for ADTs and implement instances manually for primitive types. This would mean that for every data type you'd have to still provide an empty <code>instance</code> implementation, with the default provided by Generics.</li>\n</ul>\n\n<p>After writing this, I discovered <a href=\"https://wiki.haskell.org/index.php?title=GHC/AdvancedOverlap&amp;oldid=59207\" rel=\"nofollow\">AdvancedOverlap</a>. Perhaps combining it with one of the previous approaches could lead to a nice solution.</p>\n"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1451814596, "creation_date": 1451000524, "question_id": 34458851, "link": "https://stackoverflow.com/questions/34458851/can-i-tell-ghc-to-arbitrarily-select-which-instance-to-use-because-i-dont-care", "title": "Can I tell GHC to arbitrarily select which instance to use, because I don&#39;t care?", "body": "<p>I have some code like this:</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall #-}\n{-# LANUAGE VariousLanguageExtensionsNoneOfWhichWorked #-}\n\nimport Control.Applicative\nimport Data.Either\nimport Data.Void\n\nclass Constructive a where\n    lem :: Either (a -&gt; Void) a\n\ninstance Constructive Void where\n    lem = Left id\n\ninstance Num a =&gt; Constructive a where\n    lem = Right 0\n\ninstance Enum a =&gt; Constructive a where\n    lem = Right $ toEnum 0\n\ninstance Bounded a =&gt; Constructive a where\n    lem = Right minBound\n\ninstance Monoid a =&gt; Constructive a where\n    lem = Right mempty\n\ninstance Alternative f =&gt; Constructive (f a) where\n    lem = Right empty\n</code></pre>\n\n<p>The problem is, GHC complains with</p>\n\n<pre><code>pad.hs:49:10:\n    Duplicate instance declarations:\n      instance [overlap ok] Bounded a =&gt; Constructive a\n        -- Defined at pad.hs:49:10\n      instance [overlap ok] Monoid a =&gt; Constructive a\n        -- Defined at pad.hs:52:10\n</code></pre>\n\n<p>Along with a bunch of similar errors.</p>\n\n<p>Is there a way to tell GHC to pick one at random, since I don't care which it uses? (I don't even care if it picks a different one each time I use <code>lem</code>, since it does not matter.)</p>\n"}, {"tags": ["haskell", "subclass"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1450997552, "post_id": 34458526, "comment_id": 56659157, "body": "<code>(==)</code> is a method of the <code>Eq</code> typeclass. It cannot simultaneously be in scope as a method of the <code>Foo</code> typeclass. This is conceptually the same as having <code>foo = 1</code> and <code>foo = 2</code> in the same scope."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450997855, "post_id": 34458526, "comment_id": 56659223, "body": "It seems like you just want <code>instance Foo a =&gt; Eq a where a == b = size a == size b</code>, but this is effectively useless because of problems with overlapping instances."}, {"owner": {"reputation": 53, "user_id": 5715354, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4oMVD-hcTyI/AAAAAAAAAAI/AAAAAAAABEA/6vd4xyyJDeU/photo.jpg?sz=128", "display_name": "gihan", "link": "https://stackoverflow.com/users/5715354/gihan"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1450999253, "post_id": 34458526, "comment_id": 56659483, "body": "Thanks for your response!  It seems that I can do something like what I want for classes that I define (as I mention at the bottom of my question), but there are issues where the superclass is defined elsewhere.  Maybe I&#39;m asking for something impossible."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1451019979, "post_id": 34458526, "comment_id": 56662437, "body": "The standard trick is to offer <code>eqDefault :: Foo a =&gt; a -&gt; a -&gt; Bool</code> and let people write <code>instance Eq Whatever where (==) = eqDefault</code>. I describe this in <a href=\"http://stackoverflow.com/a/34098924/791604\">this answer</a>. I&#39;m tempted to mark this as a duplicate of that question -- any objections?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1451044367, "post_id": 34458526, "comment_id": 56666849, "body": "@DanielWagner: One. Add <code>fmapDefault</code> and <code>foldMapDefault</code> as <code>base</code> examples."}, {"owner": {"reputation": 53, "user_id": 5715354, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4oMVD-hcTyI/AAAAAAAAAAI/AAAAAAAABEA/6vd4xyyJDeU/photo.jpg?sz=128", "display_name": "gihan", "link": "https://stackoverflow.com/users/5715354/gihan"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1451082175, "post_id": 34458526, "comment_id": 56675850, "body": "Thanks @DanielWagner for your suggestion.  I&#39;d hoped to avoid having explicitly to make each instance of Foo also an instance of Eq, but I take it that this is unavoidable!  Please mark as duplicate if you wish."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1451057761, "post_id": 34464115, "comment_id": 56670069, "body": "You should probably mention that <code>DefaultSignatures</code> isn&#39;t necessary here, though it does no harm."}, {"owner": {"reputation": 53, "user_id": 5715354, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4oMVD-hcTyI/AAAAAAAAAAI/AAAAAAAABEA/6vd4xyyJDeU/photo.jpg?sz=128", "display_name": "gihan", "link": "https://stackoverflow.com/users/5715354/gihan"}, "edited": false, "score": 0, "creation_date": 1451082764, "post_id": 34464115, "comment_id": 56675953, "body": "Thanks (and Merry Christmas)!  I really wanted to have the <i>same</i> <code>(==)</code> as in the Prelude, but I didn&#39;t make that clear in my question.  A previous commenter (DanielWagner) made a suggestion that works, but only by explicitly declaring each instance of <code>Foo</code> to be an instance of <code>Eq</code>.  I imagine that this is a barrier I cannot work around."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 1, "last_activity_date": 1451057623, "creation_date": 1451057623, "answer_id": 34464115, "question_id": 34458526, "link": "https://stackoverflow.com/questions/34458526/default-definition-in-subclass-of-eq-in-haskell/34464115#34464115", "title": "Default definition in subclass of Eq in Haskell", "body": "<p>You can define functions (and operators) with the same name, as long as they are in different modules.\nSo there is <code>Prelude.==</code> (default one), and yours (say, <code>My.==</code>). In the default definition of <code>My.==</code>,\ncompiler doesn't know which to use. Fix is trivial yet ugly:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\nmodule My where\n\nclass (Eq a) =&gt; Foo a where\n  size :: a -&gt; Int\n  (==) :: a -&gt; a -&gt; Bool\n  (==) s t = (size s) Prelude.== (size t)\n\ninstance Eq a =&gt; Foo [a] where\n  size = length\n\nmain :: IO ()\nmain = do\n    print $ a Prelude.== b\n    print $ a My.== b\n  where\n    a = [1, 2, 3]\n    b = [3, 4, 5]\n</code></pre>\n\n<p>When run:</p>\n\n<pre><code>&gt; main\nFalse\nTrue\n</code></pre>\n\n<p>Yet, i'd prefer to use some other operator name, for example <code>~=</code>. </p>\n"}], "owner": {"reputation": 53, "user_id": 5715354, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4oMVD-hcTyI/AAAAAAAAAAI/AAAAAAAABEA/6vd4xyyJDeU/photo.jpg?sz=128", "display_name": "gihan", "link": "https://stackoverflow.com/users/5715354/gihan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "closed_date": 1451097260, "accepted_answer_id": 34464115, "answer_count": 1, "score": 3, "last_activity_date": 1451057623, "creation_date": 1450997070, "last_edit_date": 1495542348, "question_id": 34458526, "link": "https://stackoverflow.com/questions/34458526/default-definition-in-subclass-of-eq-in-haskell", "closed_reason": "Duplicate", "title": "Default definition in subclass of Eq in Haskell", "body": "<p>I have a question similar to a <a href=\"https://stackoverflow.com/questions/31600470/how-to-define-default-implementation-in-subclass-definition-in-haskell\">previous one</a>, but where the superclass is <code>Eq</code>.  For example, suppose, I have the following:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\nclass (Eq a) =&gt; Foo a where\n  size :: a -&gt; Int\n  (==) :: a -&gt; a -&gt; Bool\n  (==) s t = (size s) == (size t)\n</code></pre>\n\n<p>(Note, that I've included the language extension as suggested in the solution to the aforementioned question)</p>\n\n<p>I receive the following ghci error message:</p>\n\n<blockquote>\n<pre><code>Ambiguous occurrence \u2018==\u2019\nIt could refer to either \u2018Main.==\u2019,\n                         defined at permutations.lhs:162:3\n                      or \u2018Prelude.==\u2019,\n                         imported from \u2018Prelude\u2019 at permutations.lhs:1:1\n                         (and originally defined in \u2018GHC.Classes\u2019)\n</code></pre>\n</blockquote>\n\n<p>Am I trying to do something impossible in Haskell?  I know that I could instead do something like</p>\n\n<pre><code>class (Eq a) =&gt; Foo a where\n  size :: a -&gt; Int\n\ndata Bar = Qux [Int]    \n\ninstance Foo Bar where\n  size (Qux xs) = length xs\n\ninstance Eq Bar where\n    (==) f g = (size f) == (size g)\n</code></pre>\n\n<p>but I'd then have to copy the definition of <code>(==)</code> for every instance of <code>Foo</code>, rather than making it a default definition.</p>\n\n<p>I also realise that had I used by own superclass instead of <code>Eq</code>, I could have written</p>\n\n<pre><code>class Bam a where\n  eqs :: a -&gt; a -&gt; Bool\n  default eqs :: Roo a =&gt; a -&gt; a -&gt; Bool\n  eqs f g = (size f) == (size g)\n\nclass (Bam a) =&gt; Roo a where\n  size :: a -&gt; Int\n</code></pre>\n\n<p>The issue I have is that the superclass is <code>Eq</code>, and that I don't want to repeat the same definition in each instance.</p>\n"}, {"tags": ["performance", "haskell", "prolog", "alias"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1450996753, "post_id": 34458299, "comment_id": 56658992, "body": "In prolog you can avoid the alias. Just use <code>tails(L, [L|TA]) :- L=[_|T], ...</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1450997126, "post_id": 34458299, "comment_id": 56659073, "body": "I agree, but it would be nice if this was possible in the head. (I know I&#39;m being annoying :S)"}], "answers": [{"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1451015892, "post_id": 34459866, "comment_id": 56661871, "body": "I wonder if putting such thing in the head cannot lead to additional optimizations. For the <code>tails</code>, it is not really useful, but now you postpone checks that <i>could</i> have been done before calling that predicate. Nevertheless, impressive answer +1."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1451016329, "post_id": 34459866, "comment_id": 56661933, "body": "Furthermore I&#39;m wondering whether the compiler could not be improved to spot that <code>[E|Es]</code> is used twice and thus construct an &quot;implicit&quot; alias itself."}, {"owner": {"reputation": 19369, "user_id": 4609915, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/4fcZU.png?s=128&g=1", "display_name": "repeat", "link": "https://stackoverflow.com/users/4609915/repeat"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1451028970, "post_id": 34459866, "comment_id": 56663880, "body": "@WillemVanOnsem. Yes, in principle, Prolog compilers <i>could</i> do that. OTOH in a pure functional language with lazy evaluation (like Haskell) this is even more straight-forward. Prolog compilation is tricky, if you want to ensure that compiled and the analog interpreted code never <b>ever</b> behave any differently. Lots of subtleties/details need to be taken care of right. SICStus JIT is relatively new... and very impressive!"}, {"owner": {"reputation": 19369, "user_id": 4609915, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/4fcZU.png?s=128&g=1", "display_name": "repeat", "link": "https://stackoverflow.com/users/4609915/repeat"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1451029445, "post_id": 34459866, "comment_id": 56663977, "body": "@WillemVanOnsem. Oh, and btw: optimization can be fun and a nice learning experience, but it should not be <i>the</i> main focus! Consider: <a href=\"http://www.prolog-heritage.org/en/ph4.html\" rel=\"nofollow noreferrer\">prolog-heritage.org/en/ph4.html</a> ."}], "tags": [], "owner": {"reputation": 19369, "user_id": 4609915, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/4fcZU.png?s=128&g=1", "display_name": "repeat", "link": "https://stackoverflow.com/users/4609915/repeat"}, "is_accepted": true, "score": 10, "last_activity_date": 1451020574, "last_edit_date": 1495542336, "creation_date": 1451015250, "answer_id": 34459866, "question_id": 34458299, "link": "https://stackoverflow.com/questions/34458299/does-prolog-have-an-alias-operator-like-haskell/34459866#34459866", "title": "Does Prolog have an alias &quot;operator&quot; like Haskell?", "body": "<p><strong>TL;DR:</strong> Good idea<sup>1</sup>! The speedup appears to be limited to ~20% (for most list sizes).</p>\n\n<p>In this answer, we compare three different predicates that differ regarding <code>@</code>-like data reuse:</p>\n\n<pre>\nlist_tails([], [[]]).                % (1) like `tails/2` given by the OP ...\nlist_tails([E|Es], [[E|Es]|Ess]) :-  %     ....... but with a better name :-)\n   list_tails(Es, Ess).\n\nlist_sfxs1(Es, [Es|Ess]) :-          % (2) \"re-use, mutual recursion\"\n   aux_list_sfxs1(Es, Ess).          %     \"sfxs\" is short for \"suffixes\"\n\naux_list_sfxs1([], []).\naux_list_sfxs1([_|Es], Ess) :-\n   list_sfxs1(Es, Ess).\n\nlist_sfxs2([], [[]]).                % (3) \"re-use, direct recursion\"\nlist_sfxs2(Es0, [Es0|Ess]) :-\n   Es0 = [_|Es],\n   list_sfxs2(Es, Ess).\n</pre>\n\n<p>To measure runtime, we use the following code:</p>\n\n<pre>\n:-( <a href=\"https://sicstus.sics.se/sicstus/docs/latest4/html/sicstus.html/mpg_002dref_002ddif.html\" rel=\"nofollow noreferrer\">dif</a>(D,<a href=\"https://sicstus.sics.se/\" rel=\"nofollow noreferrer\">sicstus</a>), <a href=\"https://sicstus.sics.se/sicstus/docs/latest4/html/sicstus.html/mpg_002dref_002dcurrent_005fprolog_005fflag.html\" rel=\"nofollow noreferrer\">current_prolog_flag</a>(<a href=\"https://sicstus.sics.se/sicstus/docs/latest4/html/sicstus.html/ref_002dlps_002dflg.html\" rel=\"nofollow noreferrer\">dialect</a>,D)\n  ; <a href=\"https://sicstus.sics.se/sicstus/docs/latest4/html/sicstus.html/mpg_002dref_002duse_005fmodule.html\" rel=\"nofollow noreferrer\">use_module</a>(<a href=\"https://sicstus.sics.se/sicstus/docs/latest4/html/sicstus.html/lib_002dbetween.html\" rel=\"nofollow noreferrer\">library(between)</a>)\n  ).\n\nrun_benchs(P_2s, P_2, L, N, T_ms) :-\n   <a href=\"https://www.complang.tuwien.ac.at/ulrich/iso-prolog/prologue#between\" rel=\"nofollow noreferrer\">between</a>(1, 6, I),\n   L<a href=\"https://sicstus.sics.se/sicstus/docs/latest4/html/sicstus.html/mpg_002dref_002dis.html\" rel=\"nofollow noreferrer\"> is </a>10<a href=\"https://sicstus.sics.se/sicstus/docs/latest4/html/sicstus.html/ref_002dari_002daex.html\" rel=\"nofollow noreferrer\">^</a>I,\n   N is 10^(8-I),\n   <a href=\"https://www.complang.tuwien.ac.at/ulrich/iso-prolog/prologue#length\" rel=\"nofollow noreferrer\">length</a>(Xs, L),\n   <a href=\"https://www.complang.tuwien.ac.at/ulrich/iso-prolog/prologue#member\" rel=\"nofollow noreferrer\">member</a>(P_2, P_2s),\n   <a href=\"https://sicstus.sics.se/sicstus/docs/latest4/html/sicstus.html/mpg_002dref_002dgarbage_005fcollect.html\" rel=\"nofollow noreferrer\">garbage_collect</a>,\n   call_walltime(run_bench_core(P_2,Xs,N), <a href=\"https://en.wikipedia.org/wiki/Millisecond\" rel=\"nofollow noreferrer\">T_ms</a>).\n\nrun_bench_core(P_2, Xs, N) :-\n   between(1, N, _),\n   <a href=\"https://www.complang.tuwien.ac.at/ulrich/iso-prolog/dtc2#call\" rel=\"nofollow noreferrer\">call</a>(P_2, Xs, _),\n   <a href=\"https://www.complang.tuwien.ac.at/ulrich/iso-prolog/dtc2#false\" rel=\"nofollow noreferrer\">false</a>.\nrun_bench_core(_, _, _).\n</pre>\n\n<p>To measure <a href=\"/questions/tagged/wall-time\" class=\"post-tag\" title=\"show questions tagged &#39;wall-time&#39;\" rel=\"tag\">wall-time</a><sup>2</sup>, we utilize <code>call_<a href=\"https://en.wikipedia.org/wiki/Wall-clock_time\" rel=\"nofollow noreferrer\">walltime</a>/2</code>\u2014a variation of <a href=\"https://stackoverflow.com/a/27823841/4609915\"><code>call_time/2</code></a>:</p>\n\n<pre>\ncall_walltime(G, T_ms) :-\n   <a href=\"https://sicstus.sics.se/sicstus/docs/latest4/html/sicstus.html/mpg_002dref_002dstatistics.html\" rel=\"nofollow noreferrer\">statistics</a>(<a href=\"https://sicstus.sics.se/sicstus/docs/latest4/html/sicstus.html/ref_002dmgc_002dove_002dsta.html\" rel=\"nofollow noreferrer\">walltime</a>, [T0|_]),\n   G,\n   statistics(walltime, [T1|_]),\n   T_ms is T1 - T0.\n</pre>\n\n<p>Let's put above code variations to the test...</p>\n\n<ul>\n<li>...using different list lengths <code>L</code>...</li>\n<li>...and running each test a number of times <code>N</code> (for better accuracy).</li>\n</ul>\n\n<p>First, we use <a href=\"/questions/tagged/swi-prolog\" class=\"post-tag\" title=\"show questions tagged &#39;swi-prolog&#39;\" rel=\"tag\">swi-prolog</a> version 7.3.14 (64-bit):</p>\n\n<pre>\n?- run_benchs([list_sfxs1,list_sfxs2,list_tails], P_2, L, N, T_ms).\n   P_2 = list_sfxs1, L*N = 10*10000000, T_ms =  7925\n;  P_2 = list_sfxs2, L*N = 10*10000000, T_ms =  7524\n;  P_2 = list_tails, L*N = 10*10000000, T_ms =  6936\n;\n   P_2 = list_sfxs1, L*N = 100*1000000, T_ms =  6502\n;  P_2 = list_sfxs2, L*N = 100*1000000, T_ms =  5861\n;  P_2 = list_tails, L*N = 100*1000000, T_ms =  5618\n;\n   P_2 = list_sfxs1, L*N = 1000*100000, T_ms =  6434\n;  P_2 = list_sfxs2, L*N = 1000*100000, T_ms =  5817\n;  P_2 = list_tails, L*N = 1000*100000, T_ms =  9916\n;\n   P_2 = list_sfxs1, L*N = 10000*10000, T_ms =  6328\n;  P_2 = list_sfxs2, L*N = 10000*10000, T_ms =  5688\n;  P_2 = list_tails, L*N = 10000*10000, T_ms =  9442\n;\n   P_2 = list_sfxs1, L*N = 100000*1000, T_ms = 10255\n;  P_2 = list_sfxs2, L*N = 100000*1000, T_ms = 10296\n;  P_2 = list_tails, L*N = 100000*1000, T_ms = 14592\n;\n   P_2 = list_sfxs1, L*N = 1000000*100, T_ms =  6955\n;  P_2 = list_sfxs2, L*N = 1000000*100, T_ms =  6534\n;  P_2 = list_tails, L*N = 1000000*100, T_ms =  9738.\n</pre>\n\n<p>Then, we repeat the previous query<sup>3</sup> using <a href=\"/questions/tagged/sicstus-prolog\" class=\"post-tag\" title=\"show questions tagged &#39;sicstus-prolog&#39;\" rel=\"tag\">sicstus-prolog</a> version 4.3.2 (64-bit):</p>\n\n<pre>\n?- run_benchs([list_sfxs1,list_sfxs2,list_tails], P_2, L, N, T_ms).\n   P_2 = list_sfxs1, L*N = 10*10000000, T_ms =  1580\n;  P_2 = list_sfxs2, L*N = 10*10000000, T_ms =  1610\n;  P_2 = list_tails, L*N = 10*10000000, T_ms =  1580\n;\n   P_2 = list_sfxs1, L*N = 100*1000000, T_ms =   710\n;  P_2 = list_sfxs2, L*N = 100*1000000, T_ms =   750\n;  P_2 = list_tails, L*N = 100*1000000, T_ms =   840\n;\n   P_2 = list_sfxs1, L*N = 1000*100000, T_ms =   650 \n;  P_2 = list_sfxs2, L*N = 1000*100000, T_ms =   660\n;  P_2 = list_tails, L*N = 1000*100000, T_ms =   740\n;  \n   P_2 = list_sfxs1, L*N = 10000*10000, T_ms =   620\n;  P_2 = list_sfxs2, L*N = 10000*10000, T_ms =   650\n;  P_2 = list_tails, L*N = 10000*10000, T_ms =   740\n;\n   P_2 = list_sfxs1, L*N = 100000*1000, T_ms =   670\n;  P_2 = list_sfxs2, L*N = 100000*1000, T_ms =   650\n;  P_2 = list_tails, L*N = 100000*1000, T_ms =   750\n;\n   P_2 = list_sfxs1, L*N = 1000000*100, T_ms = 12610\n;  P_2 = list_sfxs2, L*N = 1000000*100, T_ms = 12560\n;  P_2 = list_tails, L*N = 1000000*100, T_ms = 33460.\n</pre>\n\n<p><strong>Summary:</strong> </p>\n\n<ul>\n<li>The <em>alias-thingy</em> can and <em>does improve performance</em> significantly.</li>\n<li>In above tests, the SICStus Prolog <a href=\"/questions/tagged/jit\" class=\"post-tag\" title=\"show questions tagged &#39;jit&#39;\" rel=\"tag\">jit</a><sup>4</sup> gives <strong>10X speedup</strong>, compared to SWI-Prolog!</li>\n</ul>\n\n<hr>\n\n<p><sup><b>Footnote 1:</b> Why do the stunt of putting <code>(@)/2</code> in the rule head? \nTo end up with non-<a href=\"https://en.wikipedia.org/wiki/Programming_idiom%0A\" rel=\"nofollow noreferrer\">idiomatic</a> Prolog code?<br/>\n<b>Footnote 2:</b> We are interested in the total runtime. Why? Because garbage-collection costs show with larger data sizes!<br/>\n<b>Footnote 3:</b> The answer sequence has been post-processed for the sake of readability.<br/>\n<b>Footnote 4:</b> Available since <a href=\"https://sicstus.sics.se/sicstus/docs/4.3.0/html/relnotes/4_002e3_002e0-New-Features.html\" rel=\"nofollow noreferrer\">release 4.3.0</a>. Current target architectures include <a href=\"https://en.wikipedia.org/wiki/IA-32\" rel=\"nofollow noreferrer\">IA-32</a> and <a href=\"https://en.wikipedia.org/wiki/X86-64\" rel=\"nofollow noreferrer\">AMD64</a>.</sup></p>\n"}], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 700, "favorite_count": 0, "accepted_answer_id": 34459866, "answer_count": 1, "score": 10, "last_activity_date": 1451020574, "creation_date": 1450994920, "last_edit_date": 1495542740, "question_id": 34458299, "link": "https://stackoverflow.com/questions/34458299/does-prolog-have-an-alias-operator-like-haskell", "title": "Does Prolog have an alias &quot;operator&quot; like Haskell?", "body": "<p>In Haskell, there is a language feature called \"as\"-operator (sometimes known as alias). The idea is the following: given you have a function that for instance takes as input a list and wants to return all tails, you can implement this as:</p>\n\n<pre><code>tails a@(_:xs) = a : tails xs\ntails [] = [[]]\n</code></pre>\n\n<p>The <code>@</code> ensures that you have a reference to both the entire argument as well as a reference to some parts of the structure of the parameter. This is intelligent performance-wise (it is more a performance hack, because reconstructing an array <code>(x:xs)</code>) in the body of the first line, will - if not optimized by the compiler - result in allocating a new object, modifying fields, etc. See <a href=\"https://stackoverflow.com/q/1153465/67579\">here</a> for more information.</p>\n\n<p>I was wondering if Prolog has something equivalent: for instance if you want to implement tails in Prolog, it can be done the following way:</p>\n\n<pre><code>tails([H|T],[[H|T]|TA]) :-\n    tails(T,TA).\ntails([],[[]]).\n</code></pre>\n\n<p>But it could be more efficient if there was an \"as\"-operator like:</p>\n\n<pre><code>tails(L@[_|T],[L|TA]) :-  %This does not compile\n    tails(T,TA).\ntails([],[[]]).\n</code></pre>\n\n<p>Is there any such construct, or a language extension?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2678, "user_id": 5699206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b779af6a871be4c7cd891113f722f62?s=128&d=identicon&r=PG&f=1", "display_name": "Joseph Young", "link": "https://stackoverflow.com/users/5699206/joseph-young"}, "edited": false, "score": 0, "creation_date": 1450990112, "post_id": 34457719, "comment_id": 56657491, "body": "Wouldn&#39;t it be better to define a behaviour for non-same size lists and let higher up code check sizes if they need to?"}], "answers": [{"tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": false, "score": 2, "last_activity_date": 1450991390, "last_edit_date": 1450991390, "creation_date": 1450990343, "answer_id": 34457800, "question_id": 34457719, "link": "https://stackoverflow.com/questions/34457719/merge-two-lists-with-alternative-elements-in-haskell/34457800#34457800", "title": "Merge two lists with alternative elements in Haskell", "body": "<p>The easiest way would probably just to do a check beforehand, then route the main work to an auxiliary function:</p>\n\n<pre><code>mergeList::[String]-&gt;[String]-&gt;[String]\nmergeList xs ys\n    | length xs /= length ys = error \"Lists must be the same length\" \n    | otherwise go xs ys\n    where\n        go [] [] = []\n        go  _ [] = []\n        go [] _  = []\n        go (x:xs) (y:ys) = x:y:go xs ys\n</code></pre>\n\n<p>The check is done in the main function, and if the list's are the same size, they're handed to an internal function that does the main processing. Note how <code>go</code> is just your original function; it's just been internalized within a wrapper function. You could use a more descriptive name than <code>go</code>; I was trying to keep it brief.</p>\n\n<p>It's been awhile since I've written Haskell, so I apologize for any syntax issues. </p>\n\n<p>You could also generalize the function by changing the signature to:</p>\n\n<pre><code>mergeList::[a]-&gt;[a]-&gt;[a]\n</code></pre>\n\n<p>Since you're not doing anything specific to Strings in the function. </p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451052696, "post_id": 34457923, "comment_id": 56668857, "body": "On the other hand, using <code>Maybe</code> in this sort of situation loses laziness. An alternative is to (effectively) compose <code>Maybe</code> with the base functor of <code>[]</code> before taking the fixed point: <code>data MList a = Nil | Cons a (MList a) | Error</code>. This lets the <i>caller</i> choose the error handling mechanism."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1451102508, "post_id": 34457923, "comment_id": 56678669, "body": "Yeah, it&#39;s nice, though it&#39;s no longer a standard list.  Another way is to use <code>Writer Error [a]</code> for some error monoid, so you get laziness up until the point when you need to know whether there was an error.  But OP is clearly a beginner so I wanted to show them what I consider the most obvious Haskellish solution to their problem, even if it does have some subtle drawbacks."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 8, "last_activity_date": 1450991373, "creation_date": 1450991373, "answer_id": 34457923, "question_id": 34457719, "link": "https://stackoverflow.com/questions/34457719/merge-two-lists-with-alternative-elements-in-haskell/34457923#34457923", "title": "Merge two lists with alternative elements in Haskell", "body": "<p>Using <code>error</code> is discouraged.  In Haskell we like to define our functions for all possible inputs, so that the type system can guide us to write correct programs.  If your function is invalid for lists of different lengths, one way would be to use <code>Maybe</code>.</p>\n\n<pre><code>mergeList :: [a] -&gt; [a] -&gt; Maybe [a]\nmergeList [] [] = Just []\nmergeList (x:xs) (y:ys) =\n    case mergeList xs ys of\n        Just merged -&gt; Just (x:y:merged)\n        Nothing     -&gt; Nothing\nmergeList _ _ = Nothing\n</code></pre>\n\n<p>There are more succinct ways to write this, but I'm staying near the ground floor.</p>\n\n<p>Now users of <code>mergeList</code> are required to define what to do in the case that they passed lists of two different lengths.</p>\n"}, {"tags": [], "owner": {"reputation": 155, "user_id": 5715425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80175d4896bc5afa19d54b0a059ed115?s=128&d=identicon&r=PG&f=1", "display_name": "denys.fridman", "link": "https://stackoverflow.com/users/5715425/denys-fridman"}, "is_accepted": false, "score": 2, "last_activity_date": 1451053963, "last_edit_date": 1451053963, "creation_date": 1450991564, "answer_id": 34457943, "question_id": 34457719, "link": "https://stackoverflow.com/questions/34457719/merge-two-lists-with-alternative-elements-in-haskell/34457943#34457943", "title": "Merge two lists with alternative elements in Haskell", "body": "<p>In your pattern matching raise an error if EXACTLY one of the lists is empty.\nSo you would have</p>\n\n<pre><code>mergeList (x: xs) (y: ys) = x: y: mergeList xs ys\nmergeList []      []      = []\nmergeList _       _       = error \"your error\"  -- falling through to this pattern means that exactly one of the lists is empty\n</code></pre>\n\n<p>It is somewhat redundant to check whether lengths of 2 lists are equal, since 'length' has O(n) complexity, meaning that you would go over lists twice (in a case of equal lengths).</p>\n\n<p>As luqui correctly pointed out, there are more elegant ways to solve the problem using Maybe type. When you learn about functors (and Maybe is an instance of class Functor), you could write:</p>\n\n<pre><code>mergeList :: [a] -&gt; [a] -&gt; Maybe [a]\nmergeList (x: xs) (y: ys) = fmap (\\rest -&gt; x: y: rest) $ mergeList xs ys\nmergeList []      []      = Just []\nmergeList _       _       = Nothing\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 429, "user_id": 796557, "user_type": "registered", "accept_rate": 5, "profile_image": "https://www.gravatar.com/avatar/2807764ba0f590416c540c55a960e9a9?s=128&d=identicon&r=PG&f=1", "display_name": "elliptic00", "link": "https://stackoverflow.com/users/796557/elliptic00"}, "edited": false, "score": 0, "creation_date": 1451031183, "post_id": 34458178, "comment_id": 56664288, "body": "beautiful solution:)   i chagne it a little bit:  foldr (&#40;x, y) a -&gt; x:y:a) [] (x <code>zip</code> y) without  reverse"}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "reply_to_user": {"reputation": 429, "user_id": 796557, "user_type": "registered", "accept_rate": 5, "profile_image": "https://www.gravatar.com/avatar/2807764ba0f590416c540c55a960e9a9?s=128&d=identicon&r=PG&f=1", "display_name": "elliptic00", "link": "https://stackoverflow.com/users/796557/elliptic00"}, "edited": false, "score": 0, "creation_date": 1451042322, "post_id": 34458178, "comment_id": 56666469, "body": "yes I thought to use <code>foldr</code> soon, but I usually start with <code>foldl</code> then refactor :)"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 429, "user_id": 796557, "user_type": "registered", "accept_rate": 5, "profile_image": "https://www.gravatar.com/avatar/2807764ba0f590416c540c55a960e9a9?s=128&d=identicon&r=PG&f=1", "display_name": "elliptic00", "link": "https://stackoverflow.com/users/796557/elliptic00"}, "edited": false, "score": 0, "creation_date": 1451068990, "post_id": 34458178, "comment_id": 56672857, "body": "@elliptic00 You can escape backticks in comments as follows: <code>\\`</code>. This allows you to write <code>foldr (\\(x, y) a -&gt; x : y : a) [] (x `zip` y)</code>."}], "tags": [], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "is_accepted": false, "score": 1, "last_activity_date": 1451068880, "last_edit_date": 1451068880, "creation_date": 1450993596, "answer_id": 34458178, "question_id": 34457719, "link": "https://stackoverflow.com/questions/34457719/merge-two-lists-with-alternative-elements-in-haskell/34458178#34458178", "title": "Merge two lists with alternative elements in Haskell", "body": "<p>Your otherwise function it might be something like this:</p>\n\n<pre><code>otherwise = reverse $ foldl (\\a (x,y) -&gt; x:y:a) [] (x `zip` y)\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>Prelude&gt; let y = [\"a\", \"b\", \"c\"]\nPrelude&gt; let x = [\"1\", \"2\", \"3\"]\nPrelude&gt; reverse $ foldl (\\a (x,y) -&gt; x:y:a) [] (x `zip` y)\n[\"a\",\"1\",\"b\",\"2\",\"c\",\"3\"]\n</code></pre>\n\n<p>or the elliptic00 solution with foldr that avoids the usage of the <code>reverse</code>:</p>\n\n<pre><code> otherwise = foldr ((x, y) a -&gt; x:y:a) [] (x `zip` y) \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1451054382, "creation_date": 1451054382, "answer_id": 34463756, "question_id": 34457719, "link": "https://stackoverflow.com/questions/34457719/merge-two-lists-with-alternative-elements-in-haskell/34463756#34463756", "title": "Merge two lists with alternative elements in Haskell", "body": "<p>luqui points out that we like to be safe in Haskell, avoiding <code>error</code>. But waiting till we get to the end of at least one list before yielding anything throws away any hope of laziness. One option is to toss error handling to the caller. We can fake up lists like this:</p>\n\n<pre><code>import Data.Bifunctor\nimport Data.Bifunctor.Fix\nimport Data.Bifunctor.Tannen\n\ndata ListF l a = NilF | ConsF a l\n\ninstance Bifunctor ListF where\n  bimap _ _ NilF = NilF\n  bimap f g (ConsF a l) = ConsF (f a) (g l)\n\n{-instance Bifoldable ListF where ...\n\ninstance Bitraversable ListF where ... -}\n\ntype List = Fix ListF\n</code></pre>\n\n<p>But we can add in error handling:</p>\n\n<pre><code>type EList e = Fix (Tannen (Either e) ListF)\n</code></pre>\n\n<p>An <code>EList e a</code> is either an error of type <code>e</code>, a <code>NilF</code> or a <code>ConsF</code> holding an <code>a</code> and another <code>EList e a</code>.</p>\n\n<p>This composition approach, however, ends up being very verbose, confusing, and somewhat inefficient. A better approach in practice is to use a totally custom list type:</p>\n\n<pre><code>data EList' e a = Error e | Nil | Cons a (EList' e a)\n</code></pre>\n"}], "owner": {"reputation": 429, "user_id": 796557, "user_type": "registered", "accept_rate": 5, "profile_image": "https://www.gravatar.com/avatar/2807764ba0f590416c540c55a960e9a9?s=128&d=identicon&r=PG&f=1", "display_name": "elliptic00", "link": "https://stackoverflow.com/users/796557/elliptic00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1659, "favorite_count": 1, "answer_count": 5, "score": 0, "last_activity_date": 1451068880, "creation_date": 1450989556, "question_id": 34457719, "link": "https://stackoverflow.com/questions/34457719/merge-two-lists-with-alternative-elements-in-haskell", "title": "Merge two lists with alternative elements in Haskell", "body": "<p>I'm new Haskell and try to practice my Haskell skill.</p>\n\n<p>I want to implement a function to merge two lists so that the items are alternative from each list.</p>\n\n<pre><code>[\"a\", \"b\", \"c\"]\n[\"1\", \"2\", \"3\"]\n</code></pre>\n\n<p>After the merger.</p>\n\n<pre><code>[\"a\", \"1\", \"b\", \"2\", \"c\", \"3\"]\n</code></pre>\n\n<p>Here is my Haskell code</p>\n\n<pre><code>mergeList::[String]-&gt;[String]-&gt;[String]\nmergeList [] [] = []\nmergeList  _ [] = []\nmergeList [] _  = []\nmergeList (x:xs) (y:ys) = x:y:mergeList xs ys\n</code></pre>\n\n<p>The code works as long as the lengths of two lists are the same.</p>\n\n<p>But I want to have some error checking on the lengths of the two lists.</p>\n\n<p>If the length of two lists are different, then I want to report an error.</p>\n\n<pre><code>mergeList::[String]-&gt;[String]-&gt;[String]\nmergeList l r | length l /= length r = error \"report an error\"\n              | otherwise = \n</code></pre>\n\n<p>How can I finish the otherwise section?</p>\n"}, {"tags": ["haskell", "cabal", "nixos", "nix"], "comments": [{"owner": {"reputation": 1484, "user_id": 2541778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/930c28082137d9918a90608c665c5af2?s=128&d=identicon&r=PG", "display_name": "Peter Simons", "link": "https://stackoverflow.com/users/2541778/peter-simons"}, "edited": false, "score": 0, "creation_date": 1451989888, "post_id": 34457141, "comment_id": 56964039, "body": "What is <code>ta-lib</code>? I cannot find it in Nixpkgs."}, {"owner": {"reputation": 273, "user_id": 2152666, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/eaba144e276b51f8a8b96b3fef0be45a?s=128&d=identicon&r=PG", "display_name": "Charles Cooper", "link": "https://stackoverflow.com/users/2152666/charles-cooper"}, "reply_to_user": {"reputation": 1484, "user_id": 2541778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/930c28082137d9918a90608c665c5af2?s=128&d=identicon&r=PG", "display_name": "Peter Simons", "link": "https://stackoverflow.com/users/2541778/peter-simons"}, "edited": false, "score": 0, "creation_date": 1452007118, "post_id": 34457141, "comment_id": 56975516, "body": "you&#39;re right, it&#39;s not in nixpkgs. here&#39;s my ta_lib.nix file: <a href=\"https://gist.github.com/charles-cooper/0bd4398f223e64ba52f6\" rel=\"nofollow noreferrer\">gist.github.com/charles-cooper/0bd4398f223e64ba52f6</a>"}], "answers": [{"comments": [{"owner": {"reputation": 273, "user_id": 2152666, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/eaba144e276b51f8a8b96b3fef0be45a?s=128&d=identicon&r=PG", "display_name": "Charles Cooper", "link": "https://stackoverflow.com/users/2152666/charles-cooper"}, "edited": false, "score": 0, "creation_date": 1452141468, "post_id": 34643897, "comment_id": 57040456, "body": "Worked like a charm. Thank you!"}, {"owner": {"reputation": 206, "user_id": 3943027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b609c6568ccf94f887297f33ebc9f62?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre R", "link": "https://stackoverflow.com/users/3943027/pierre-r"}, "edited": false, "score": 0, "creation_date": 1526665700, "post_id": 34643897, "comment_id": 87849124, "body": "I have got the same issue with <code>python, python2 or pepper</code>. Adding them to extra-libraries won&#39;t work while <code>tar, jq</code> do. Is this the same issue ? If so what is the workarond ? I have been trying the suggestion but without success."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1554616929, "post_id": 34643897, "comment_id": 97813075, "body": "I have the same issue but with pretty standard libraries like <code>libmnl</code> which is part of Nixpkgs. I run the same command <code>gcc test.c -lmnl</code> and it works, but Cabal can still not find the program."}], "tags": [], "owner": {"reputation": 1484, "user_id": 2541778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/930c28082137d9918a90608c665c5af2?s=128&d=identicon&r=PG", "display_name": "Peter Simons", "link": "https://stackoverflow.com/users/2541778/peter-simons"}, "is_accepted": true, "score": 4, "last_activity_date": 1452118647, "creation_date": 1452118647, "answer_id": 34643897, "question_id": 34457141, "link": "https://stackoverflow.com/questions/34457141/cabal-cant-find-foreign-library-when-building-on-nixos/34643897#34643897", "title": "Cabal can&#39;t find foreign library when building on NixOS", "body": "<p>The problem is that <code>ta_lib</code> depends on the system math library <code>m</code>, but that library isn't linked by default. You can check that by creating a stub C program</p>\n\n<pre><code>echo \"int main() { return 0; }\" &gt;test.c\n</code></pre>\n\n<p>and trying to link that with <code>ta_lib</code>:</p>\n\n<pre><code>$ nix-shell -p ta_lib --run \"gcc test.c -lta_lib\"\n/nix/store/ghinzmxfm2s41nz8y873jlywwmcbw38l-ta-lib-0.4.0/lib/libta_lib.so: undefined reference to `sinh'\n/nix/store/ghinzmxfm2s41nz8y873jlywwmcbw38l-ta-lib-0.4.0/lib/libta_lib.so: undefined reference to `sincos'\n[...]\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>Now, when Cabal tries to determine whether the library is available, it will attempt to link it to a stub test program, but that attempt will fail because of all those undefined symbol. Hence, Cabal complains that the library cannot be linked (even though its paths are configured and set-up correctly).</p>\n\n<p>To remedy that issue, add the <code>m</code> library to the <code>extra-libraries</code> attribute in your project's Cabal file, like so:</p>\n\n<pre><code>extra-libraries: ta_lib, m\n</code></pre>\n\n<p>That should make the Cabal configure phase succeed.</p>\n"}], "owner": {"reputation": 273, "user_id": 2152666, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/eaba144e276b51f8a8b96b3fef0be45a?s=128&d=identicon&r=PG", "display_name": "Charles Cooper", "link": "https://stackoverflow.com/users/2152666/charles-cooper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1189, "favorite_count": 0, "accepted_answer_id": 34643897, "answer_count": 1, "score": 3, "last_activity_date": 1452118647, "creation_date": 1450985237, "last_edit_date": 1495542197, "question_id": 34457141, "link": "https://stackoverflow.com/questions/34457141/cabal-cant-find-foreign-library-when-building-on-nixos", "title": "Cabal can&#39;t find foreign library when building on NixOS", "body": "<p>I am trying to build an internal Haskell project on NixOS using cabal2nix. It wraps (and thus depends on) a foreign library which on Ubuntu one would build by <code>wget</code>ting the source, then running <code>make &amp;&amp; make install &amp;&amp; ldconfig</code>. Thus when cabal goes to build the program, it is apparently able to find the appropriate header files (which are in <code>/usr/local/include/ta-lib</code> or <code>/usr/include/ta-lib</code>).</p>\n\n<p>On Nix, the process as I understand is to setup a .nix file to specify how to get and build the source, and then Nix sets up the isolated build environments. When I do this, the foreign library is fetched and built appropriately.</p>\n\n<p>When Nix runs the configure step, it looks alright:</p>\n\n<pre><code>configureFlags: --verbose --prefix=/nix/store/fwpw03bd0c2m5yb7v2wc7g6f0qj912ra-talib-0.1.0.0 --libdir=$prefix/lib/$compiler --libsubdir=$pkgid --with-gcc=gcc --package-db=/tmp/nix-build-talib-0.1.0.0.drv-0/package.conf.d --ghc-option=-optl=-Wl,-rpath=/nix/store/fwpw03bd0c2m5yb7v2wc7g6f0qj912ra-talib-0.1.0.0/lib/ghc-7.10.2/talib-0.1.0.0 --enable-split-objs --disable-library-profiling --disable-executable-profiling --enable-shared --enable-library-vanilla --enable-executable-dynamic --enable-tests --extra-include-dirs=/nix/store/gvglncjgd5yif9bc03qalmp2mrjp524n-ta-lib-0.4.0/include --extra-lib-dirs=/nix/store/gvglncjgd5yif9bc03qalmp2mrjp524n-ta-lib-0.4.0/lib\n</code></pre>\n\n<p>With <code>--extra-include-dirs</code> and <code>--extra-lib-dirs</code> set to the correct paths in the Nix store. However, when it goes to build it complains with,</p>\n\n<pre><code>Setup: Missing dependency on a foreign library:\n* Missing C library: ta_lib\n</code></pre>\n\n<p>Unfortunately I don't understand how cabal is determining whether the foreign library is present. I read here (<a href=\"https://stackoverflow.com/questions/32303708/haskell-how-to-resolve-cabal-error-missing-dependencies-on-foreign-libraries\">Haskell how to resolve cabal error: Missing dependencies on foreign libraries?</a>) that cabal will try to build and link a C program that consists of  for each header it finds. So, somehow it is not finding the correct library.</p>\n\n<p>What is wrong? Does this have to do with the step in Ubuntu of running ldconfig?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 0, "creation_date": 1450985374, "post_id": 34457098, "comment_id": 56656159, "body": "how would these profiles compare if you use <i>strict</i> ST monad <code>Control.Monad.ST.Strict</code>?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 0, "creation_date": 1450985668, "post_id": 34457098, "comment_id": 56656255, "body": "@behzad.nouri Thanks for the idea. Unfortunately it made exactly no difference in the heap or GC usage. Do you think there is something else that could be too lazy? I think there&#39;s something related to either what the keys are or how many there are, or it only becomes visible with certain counts or file sizes. I used to have a space leak on all files, but adding <code>$!</code> fixed that, now it&#39;s just this file and only really noticeable for large numbers of keys."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451757035, "post_id": 34457098, "comment_id": 56881934, "body": "All the update sections make this confusing to read. Could you try to put this question together as one cohesive unit? Also, please include <i>all</i> relevant code (including the actual CSV parsing code if you wrote it or a link to it otherwise) and a link to the test file. We need to be able to actually <i>run</i> your code, test it, fiddle with it, etc., if we&#39;re to have much hope of solving the problem. Without full information, I will vote to close."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451760048, "post_id": 34457098, "comment_id": 56883078, "body": "@dfeuer I removed the original. I believe the block of code is complete and runnable."}], "answers": [{"tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 0, "last_activity_date": 1482191546, "creation_date": 1482191546, "answer_id": 41232836, "question_id": 34457098, "link": "https://stackoverflow.com/questions/34457098/profiling-improving-memory-usage-and-or-gc-time/41232836#41232836", "title": "Profiling/Improving memory usage and/or GC time", "body": "<p>This turned out to be the <code>V.!</code> calls not being strict enough. Replacing them with <code>indexM</code> hugely reduced the memory consumption.</p>\n"}], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 1, "accepted_answer_id": 41232836, "answer_count": 1, "score": 5, "last_activity_date": 1482191546, "creation_date": 1450984976, "last_edit_date": 1451768921, "question_id": 34457098, "link": "https://stackoverflow.com/questions/34457098/profiling-improving-memory-usage-and-or-gc-time", "title": "Profiling/Improving memory usage and/or GC time", "body": "<p><strong>Original</strong></p>\n\n<p>I'm trying to aggregate a CSV file and experiencing [what I consider to be] excessive memory usage and/or GC effort. The issue seems to arise when the number of groups increases. There is no problem when the keys are in the hundreds or thousands, but quickly starts spending a majority of time in the GC when the keys reach tens of thousands.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Moving from <code>Data.ByteString.Lazy.ByteString</code> to <code>Data.ByteString.Short.ShortByteString</code> significantly reduced the memory consumption (to a level I think is reasonable). However, the amount of time spent in the GC still seems far higher than I would expect to be necessary. I moved from <code>Data.HashMap.Strict.HashMap</code> to <code>Data.HashTable.ST.Basic.HashTable</code> to see if the mutation in <code>ST</code> would help but it did not appear to. The following is the current full test code, including <code>generateFile</code> to create a test sample:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport System.IO (withFile, IOMode(WriteMode))\nimport qualified System.Random as Random\n\nimport qualified Data.ByteString.Short as BSS\nimport qualified Data.ByteString.Lazy.Char8 as BL\nimport qualified Data.Vector as V\nimport qualified Data.Vector.Mutable as MV\nimport qualified Control.Monad.ST as ST\n\nimport qualified Data.HashTable.ST.Basic as HT\nimport qualified Data.HashTable.Class as HT (toList)\nimport Data.Hashable (Hashable, hashWithSalt)\n\nimport Data.List (unfoldr)\n\nimport qualified Data.Traversable as T\nimport Control.Monad (forM_)\n\ninstance Hashable a =&gt; Hashable (V.Vector a) where\n  hashWithSalt s = hashWithSalt s . V.toList\n\ndata CSVFormat = CSVFormat {\n  csvSeparator :: Char,\n  csvWrapper :: Char\n}\n\nreadCSV :: CSVFormat -&gt; Int -&gt; FilePath -&gt; IO [V.Vector BSS.ShortByteString]\nreadCSV format skip filepath = BL.readFile filepath &gt;&gt;= return . parseCSV format skip\n\nparseCSV :: CSVFormat -&gt; Int -&gt; BL.ByteString -&gt; [V.Vector BSS.ShortByteString]\nparseCSV (CSVFormat sep wrp) skp = drop skp . unfoldr (\\bs -&gt; if BL.null bs then Nothing else Just (apfst V.fromList (parseLine bs)))\n  where\n    {-# INLINE apfst #-}\n    apfst f (x,y) = (f x,y)\n\n    {-# INLINE isCr #-}\n    isCr c = c == '\\r'\n\n    {-# INLINE isLf #-}\n    isLf c = c == '\\n'\n\n    {-# INLINE isSep #-}\n    isSep c = c == sep || isLf c || isCr c\n\n    {-# INLINE isWrp #-}\n    isWrp c = c == wrp\n\n    {-# INLINE parseLine #-}\n    parseLine :: BL.ByteString -&gt; ([BSS.ShortByteString], BL.ByteString)\n    parseLine bs =\n      let (field,bs') = parseField bs in\n      case BL.uncons bs' of\n        Just (c,bs1)\n          | isLf c -&gt; (field : [],bs1)\n          | isCr c -&gt;\n              case BL.uncons bs1 of\n                Just (c,bs2) | isLf c -&gt; (field : [],bs2)\n                _ -&gt; (field : [],bs1)\n          | otherwise -&gt; apfst (field :) (parseLine bs1)\n        Nothing -&gt; (field : [],BL.empty)\n\n    {-# INLINE parseField #-}\n    parseField :: BL.ByteString -&gt; (BSS.ShortByteString, BL.ByteString)\n    parseField bs =\n      case BL.uncons bs of\n        Just (c,bs')\n          | isWrp c -&gt; apfst (BSS.toShort . BL.toStrict . BL.concat) (parseEscaped bs')\n          | otherwise -&gt; apfst (BSS.toShort . BL.toStrict) (BL.break isSep bs)\n        Nothing -&gt; (BSS.empty,BL.empty)\n\n    {-# INLINE parseEscaped #-}\n    parseEscaped :: BL.ByteString -&gt; ([BL.ByteString], BL.ByteString)\n    parseEscaped bs =\n      let (chunk,bs') = BL.break isWrp bs in\n      case BL.uncons bs' of\n        Just (_,bs1) -&gt;\n          case BL.uncons bs1 of\n            Just (c,bs2)\n              | isWrp c -&gt; apfst (\\xs -&gt; chunk : BL.singleton wrp : xs) (parseEscaped bs2)\n              | otherwise -&gt; (chunk : [],bs1)\n            Nothing -&gt; (chunk : [],BL.empty)\n        Nothing -&gt; error \"EOF within quoted string\"\n\naggregate :: [Int]\n          -&gt; Int\n          -&gt; [V.Vector BSS.ShortByteString]\n          -&gt; [V.Vector BSS.ShortByteString]\naggregate groups size records =\n  let indices = [0..size - 1] in\n\n  ST.runST $ do\n    state &lt;- HT.new\n\n    forM_ records (\\record -&gt; do\n        let key = V.fromList (map (\\g -&gt; record V.! g) groups)\n\n        existing &lt;- HT.lookup state key\n        case existing of\n          Just x -&gt;\n            forM_ indices (\\i -&gt; do\n                current &lt;- MV.read x i\n                MV.write x i $! const current (record V.! i)\n              )\n          Nothing -&gt; do\n            x &lt;- MV.new size\n            forM_ indices (\\i -&gt; MV.write x i $! record V.! i)\n            HT.insert state key x\n      )\n\n    HT.toList state &gt;&gt;= T.traverse V.unsafeFreeze . map snd\n\nfiledata :: IO ([Int],Int,[V.Vector BSS.ShortByteString])\nfiledata = do\n  records &lt;- readCSV (CSVFormat ',' '\"') 1 \"file.csv\"\n  return ([0,1,2],18,records)\n\nmain :: IO ()\nmain = do\n  (key,len,records) &lt;- filedata\n  print (length (aggregate key len records))\n\ngenerateFile :: IO ()\ngenerateFile = do\n  withFile \"file.csv\" WriteMode $ \\handle -&gt; do\n    forM_ [0..650000] $ \\_ -&gt; do\n      x &lt;- BL.pack . show . truncate . (* 15 ) &lt;$&gt; (Random.randomIO :: IO Double)\n      y &lt;- BL.pack . show . truncate . (* 50 ) &lt;$&gt; (Random.randomIO :: IO Double)\n      z &lt;- BL.pack . show . truncate . (* 200) &lt;$&gt; (Random.randomIO :: IO Double)\n      BL.hPut handle (BL.intercalate \",\" (x:y:z:replicate 15 (BL.replicate 20 ' ')))\n      BL.hPut handle \"\\n\"\n</code></pre>\n\n<p>I receive the following profiling result:</p>\n\n<pre><code>17,525,392,208 bytes allocated in the heap\n27,394,021,360 bytes copied during GC\n   285,382,192 bytes maximum residency (129 sample(s))\n     3,714,296 bytes maximum slop\n           831 MB total memory in use (0 MB lost due to fragmentation)\n\n                                   Tot time (elapsed)  Avg pause  Max pause\nGen  0       577 colls,     0 par    1.576s   1.500s     0.0026s    0.0179s\nGen  1       129 colls,     0 par   25.335s  25.663s     0.1989s    0.2889s\n\nTASKS: 3 (1 bound, 2 peak workers (2 total), using -N1)\n\nSPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\nINIT    time    0.000s  (  0.002s elapsed)\nMUT     time   11.965s  ( 23.939s elapsed)\nGC      time   15.148s  ( 15.400s elapsed)\nRP      time    0.000s  (  0.000s elapsed)\nPROF    time   11.762s  ( 11.763s elapsed)\nEXIT    time    0.000s  (  0.088s elapsed)\nTotal   time   38.922s  ( 39.429s elapsed)\n\nAlloc rate    1,464,687,582 bytes per MUT second\n\nProductivity  30.9% of total user, 30.5% of total elapsed\n\ngc_alloc_block_sync: 0\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n</code></pre>\n\n<p>And the following heap visualization:\n<a href=\"https://i.stack.imgur.com/tfF3w.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/tfF3w.png\" alt=\"Heap visualization\"></a></p>\n"}, {"tags": ["haskell", "caching", "lazy-evaluation", "call-by-need"], "comments": [{"owner": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "edited": false, "score": 3, "creation_date": 1450980086, "post_id": 34456286, "comment_id": 56654567, "body": "I&#39;ve found <a href=\"http://www.cs.cmu.edu/~hdeyoung/15740/report.pdf\" rel=\"nofollow noreferrer\">cs.cmu.edu/~hdeyoung/15740/report.pdf</a> ... will study this... please let me know if there are any other tools that come to your mind ... thanks"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1450998108, "post_id": 34456286, "comment_id": 56659267, "body": "Lazy evaluation may change <i>when</i> something is evaluated, but not <i>how</i> it is evaluated or how it is stored once evaluated. I think your questions about cache efficiency would be better directed at, e.g., how allocation and garbage collection interact with caches, heap vs. stack utilization, which structures have good locality, etc."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 5, "creation_date": 1451332448, "post_id": 34456286, "comment_id": 56741189, "body": "@ReinHenrichs Laziness might be more relevant than that. Temporal locality is important as well. Even though a Haskell array or vector would have good space locality, I could see laziness causing cache misses due to poor temporal locality in some situations if expressions get evaluated in a cache-inefficient order. I can&#39;t think of a very concrete example off the top of my head unfortunately but I&#39;m picturing a scenario where, due to laziness, a vector is accessed in small pieces spread between other operations, where it would be more efficient to do those vector operations all at once."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1451335190, "post_id": 34456286, "comment_id": 56742369, "body": "@DavidYoung Good points!"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1498820860, "post_id": 34456286, "comment_id": 76670063, "body": "I&#39;ve found another interesting article on this topic: <a href=\"https://www.cs.cmu.edu/~rwh/papers/iolambda-cacm/cacm.pdf\" rel=\"nofollow noreferrer\">cs.cmu.edu/~rwh/papers/iolambda-cacm/cacm.pdf</a>"}], "owner": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 674, "favorite_count": 4, "answer_count": 0, "score": 21, "last_activity_date": 1498820834, "creation_date": 1450979504, "last_edit_date": 1498820834, "question_id": 34456286, "link": "https://stackoverflow.com/questions/34456286/haskell-how-cache-friendly-is-lazy-eval-call-by-need", "title": "Haskell: How &quot;cache&quot; friendly is Lazy Eval / call by need", "body": "<p>I have been studying Haskell in my spare time for a couple of months now. I'm wondering how Haskell performs on the current stock hardware, in regards to the memory sub-system (L1, L2, L3 cache). Can someone please point me to any report/study on how cache friendly is Haskell because of its Lazy evaluation/call-by-need? Is there a way for us to get the info as to how many data cache misses and instruction cache misses happened and see if this is due to the lazy evaluation nature of the language?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450984936, "post_id": 34455828, "comment_id": 56656046, "body": "That syntax correponds exactly to that type, i.e. <code>&#39;[X, Y]</code> is exactly the same as <code>X &#39;: Y &#39;: &#39;[]</code>. The former is simply syntactic sugar. The way the list is printed depends not on template haskell, but on the pretty printer used by GHC (or in this case, Haddock). Old versions of GHC will print type operators as prefix functions, and will include the <i>kind</i> arguments to the type function. I don&#39;t know what version of Haddock you are using, but I imagine this to be a bug - it was fixed in GHC a while back."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450985584, "post_id": 34455828, "comment_id": 56656227, "body": "@user2407038 the GHC prints types as programmer (in this case template-haskell) has written them. I.e. I&#39;d like to type <code>&#39;[X, Y]</code>, but cannot with template-haskell  Thus GHC sees <code>X &#39;: Y &#39;: []</code> only. The infix version in haddocks without kinds is already an improvement, so if someone can confirm that it will be so, say in GHC 8.0, I&#39;d be happy."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450986742, "post_id": 34455828, "comment_id": 56656596, "body": "&quot;GHC prints types as programmer has written them&quot; While this is generally true, it isn&#39;t the case for type level lists. Define <code>type X = &#39;[ Int, Bool, Char ]</code> and <code>type Y = Int &#39;: Bool &#39;: Char &#39;: &#39;[]</code> and ask for their kind or info (<code>:kind!</code> or <code>:i</code>) and it will print them both with the special list syntax. In fact you can write <code>:kind! forall x . (x &#39;: x &#39;: x &#39;: &#39;[])</code> and ghc 7.8 and 7.10 give me <code>forall (k :: BOX) (x :: k). &#39;[x, x, x]</code>."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1450987985, "post_id": 34455828, "comment_id": 56656955, "body": "@user2407038 I don&#39;t care that much about ghci, but about haddock documentation. See edit in the question."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1450998134, "post_id": 34455828, "comment_id": 56659277, "body": "It seems to be a haddock issue, opened issue in haddock tracker: <a href=\"https://github.com/haskell/haddock/issues/466\" rel=\"nofollow noreferrer\">github.com/haskell/haddock/issues/466</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1450996480, "post_id": 34457936, "comment_id": 56658924, "body": "If I modify your version to ` [t| $promotedConsT $x $xs |]) promotedNil` I&#39;ll get <code>Ex1</code> and <code>Ex2</code> to print the same. Now I wonder why it doesn;t work with <code>generics-sop</code>"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1450997445, "post_id": 34457936, "comment_id": 56659129, "body": "<a href=\"https://gist.github.com/phadej/f92e84a1f03ffb414ab4\" rel=\"nofollow noreferrer\">gist.github.com/phadej/f92e84a1f03ffb414ab4</a> is the smallest example where I can reproduce it. Something weird happens with <code>tySynInstD</code>, which doesn&#39;t happen with <code>tySynD</code>."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 2, "last_activity_date": 1450991481, "creation_date": 1450991481, "answer_id": 34457936, "question_id": 34455828, "link": "https://stackoverflow.com/questions/34455828/template-haskell-type-list/34457936#34457936", "title": "Template haskell type list", "body": "<p>It turns out that TH will splice in the lifted type list <em>incorrectly</em> when you write the function <code>promotedTypeList</code> the way you have it written. In other words, the function generates a different representation of the list than creating and splicing a type level list directly. Here is a simple test to see this.</p>\n\n<p>First define the TH functions:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes, TemplateHaskell, TypeOperators #-} \n\nmodule TH where \nimport Language.Haskell.TH \n\ntypeList0, typeList1 :: [Q Type] -&gt; Q Type\ntypeList0 = foldr (\\x xs -&gt; appT (appT promotedConsT x) xs) promotedNilT \ntypeList1 = foldl (\\xs x -&gt; [t| $x ': $xs |]) promotedNilT T \n</code></pre>\n\n<p>There are two variants - one does what you want and the other doesn't. To see precisely why, you can look at the splices:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes, TemplateHaskell, DataKinds, TypeOperators #-} \n{-# OPTIONS -ddump-splices #-} \n\nmodule Test where \n\nimport Language.Haskell.TH (stringE, Type(..))\nimport TH (typeList0, typeList1)\n\nex1 = $(typeList0 (map (return.ConT) [ ''Int, ''Bool, ''Char ]) &gt;&gt;= stringE . show) \nex2 = $(typeList1 (map (return.ConT) [ ''Int, ''Bool, ''Char ]) &gt;&gt;= stringE . show) \n\ntype Ex1 = $(typeList0 (map (return.ConT) [ ''Int, ''Bool, ''Char ]))\ntype Ex2 = $(typeList1 (map (return.ConT) [ ''Int, ''Bool, ''Char ]))\n</code></pre>\n\n<p>With <code>haddock -h Test.hs TH.hs</code> you get (the interesting bits)</p>\n\n<pre><code>Test.hs:12:9-82: Splicing expression\n    typeList0 (map (return . ConT) [''Int, ''Bool, ''Char])\n    &gt;&gt;= stringE . show\n  ======&gt;\n    \"AppT (AppT PromotedConsT (ConT GHC.Types.Int)) (AppT (AppT PromotedConsT (ConT GHC.Types.Bool)) (AppT (AppT PromotedConsT (ConT GHC.Types.Char)) PromotedNilT))\"\n\nTest.hs:13:9-82: Splicing expression\n    typeList1 (map (return . ConT) [''Int, ''Bool, ''Char])\n    &gt;&gt;= stringE . show\n  ======&gt;\n    \"AppT (AppT (PromotedT GHC.Types.:) (ConT GHC.Types.Char)) (AppT (AppT (PromotedT GHC.Types.:) (ConT GHC.Types.Bool)) (AppT (AppT (PromotedT GHC.Types.:) (ConT GHC.Types.Int)) PromotedNilT))\"\n</code></pre>\n\n<p>As you can plainly see, the two simply have <em>different representations</em>. The latter representation encodes the lifted list constructors as the application of a <code>PromotedT</code> constructor to the normal list constructors. I guess Haddock simply can't deal with this. </p>\n\n<p>Here is the result</p>\n\n<p><a href=\"https://i.stack.imgur.com/HcML3.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/HcML3.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1450997487, "creation_date": 1450976444, "last_edit_date": 1450997487, "question_id": 34455828, "link": "https://stackoverflow.com/questions/34455828/template-haskell-type-list", "title": "Template haskell type list", "body": "<p>Is there a way to construct type level lists using <code>'[Foo, Bar, Maybe Quux]</code> syntax?</p>\n\n<p>It's possible to do:</p>\n\n<pre><code>promotedTypeList :: [Q Type] -&gt; Q Type\npromotedTypeList []     = promotedNilT\npromotedTypeList (t:ts) = [t| $promotedConsT $t $(promotedTypeList ts) |]\n</code></pre>\n\n<p>But that will result into very ugly haddocks:</p>\n\n<pre><code>type Example = (:) [*] ((:) * Foo ((:) * Bar ((:) * (Maybe Quux) ([] *)))) ([] [*])\n</code></pre>\n\n<hr>\n\n<p><em>EDIT:</em></p>\n\n<p>Haddock / GHC is smart enough to print types (almost) how user typed them:</p>\n\n<pre><code>{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE DataKinds #-}\nmodule T (Foo, Bar) where\n\ntype Foo = Int ': Bool ': Char ': '[]\ntype Bar = '[ Int, Bool, Char ]\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/O2l3C.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/O2l3C.png\" alt=\"GHC 7.8\"></a>\n<a href=\"https://i.stack.imgur.com/FmDzv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/FmDzv.png\" alt=\"GHC 7.10\"></a></p>\n\n<hr>\n\n<p>Smallest example where issue is shown is at <a href=\"https://gist.github.com/phadej/f92e84a1f03ffb414ab4\" rel=\"nofollow noreferrer\">https://gist.github.com/phadej/f92e84a1f03ffb414ab4</a></p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 178, "user_id": 5180224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ccce31bdd8dd57072e3707347db3758?s=128&d=identicon&r=PG", "display_name": "fumieval", "link": "https://stackoverflow.com/users/5180224/fumieval"}, "is_accepted": true, "score": 1, "last_activity_date": 1451009330, "creation_date": 1451009330, "answer_id": 34459446, "question_id": 34455428, "link": "https://stackoverflow.com/questions/34455428/extract-nth-child-with-xml-lens/34459446#34459446", "title": "Extract nth-child with xml-lens", "body": "<p>This is correct behavior.</p>\n\n<p><code>indexing</code> assigns indices to targets of a traversal; <code>el</code> has at most one target so only 0 will be given.</p>\n\n<p>You may want to use <code>el \"foo\" . indexing (plate . el \"bar\") . index 0</code> or <code>el \"foo\" . elementOf (plate . el \"bar\") 0</code> instead. These handle multiple occurrences of <code>\"bar\"</code>.</p>\n"}], "owner": {"reputation": 1069, "user_id": 4299824, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LKWkrlvV9UE/AAAAAAAAAAI/AAAAAAAABYQ/OWKjHFpdGGs/photo.jpg?sz=128", "display_name": "YAMAMOTO Yuji", "link": "https://stackoverflow.com/users/4299824/yamamoto-yuji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 34459446, "answer_count": 1, "score": 1, "last_activity_date": 1451009330, "creation_date": 1450974167, "question_id": 34455428, "link": "https://stackoverflow.com/questions/34455428/extract-nth-child-with-xml-lens", "title": "Extract nth-child with xml-lens", "body": "<p>I'm trying to get the first <code>&lt;bar&gt;</code>'s text node with <a href=\"https://hackage.haskell.org/package/xml-lens-0.1.6.3/docs/Text-XML-Lens.html\" rel=\"nofollow\">xml-lens</a> from an XML like this:</p>\n\n<pre><code>&lt;foo&gt;\n  &lt;bar&gt;\n    I want ONLY this!\n  &lt;/bar&gt;\n  &lt;bar&gt;\n    I DON'T want this!\n  &lt;/bar&gt;\n&lt;/foo&gt;\n</code></pre>\n\n<p>In other words, I want to write a lens expression equivalent with XPath <code>/foo/bar[1]/text()</code></p>\n\n<p>First, I wrote a haskell script like below:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport           Control.Lens\nimport           Text.XML.Lens\nimport           Text.HTML.DOM\nimport qualified Data.Text.Lazy as T\nimport qualified Data.Text.Lazy.IO as TIO\n\nmain :: IO ()\nmain = do\n  input &lt;- TIO.getContents\n  parseLT input &amp; toListOf (root . el \"foo\" ./ indexing (el \"bar\") . index 0 . text) &amp; map T.fromStrict &amp; T.unlines &amp; TIO.putStr\n</code></pre>\n\n<p>But Actually got <strong>both first and second</strong> <code>&lt;bar&gt;</code>'s texts:</p>\n\n<pre><code>&gt; stack runghc sample.hs  &lt; input.xml\n\n    I want ONLY this!\n\n\n    I DON'T want this!\n</code></pre>\n\n<p>Isn't this possible with current xml-lens implementation?\nShould I submit an issue to xml-lens or some other project?</p>\n"}, {"tags": ["api", "haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1450974873, "post_id": 34455383, "comment_id": 56652827, "body": "You can answer this question yourself by running a search with the desired type signature on <a href=\"https://www.haskell.org/hoogle/\" rel=\"nofollow noreferrer\">Hoogle</a> or <a href=\"http://hayoo.fh-wedel.de\" rel=\"nofollow noreferrer\">Hayoo</a>."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1451002095, "post_id": 34455383, "comment_id": 56660023, "body": "@Jubobs - Yes... Actually I tried it without success before, this was the reason I posted this question looking for a similar implementation."}], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1450976496, "post_id": 34455677, "comment_id": 56653471, "body": "In OP&#39;s question, <code>f</code> is not mapped to all <code>x</code> such that <code>p x</code> but only the <i>first one</i>."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1450977141, "post_id": 34455677, "comment_id": 56653704, "body": "@gallais: originally I thought you were wrong but I can see now that you&#39;re totally right! Thanks!"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "edited": false, "score": 0, "creation_date": 1451001981, "post_id": 34455677, "comment_id": 56660004, "body": "Anyway, don&#39;t you think this function should be in <code>Data.List</code>?"}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": true, "score": 6, "last_activity_date": 1450977118, "last_edit_date": 1450977118, "creation_date": 1450975440, "answer_id": 34455677, "question_id": 34455383, "link": "https://stackoverflow.com/questions/34455383/finding-and-replacing/34455677#34455677", "title": "Finding and replacing", "body": "<p><strong>Edit</strong>: @gallais points out below that you end up only changing the first instance; I thought you were changing every instance.</p>\n\n<p>This is done with <code>break :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])</code> which gives you the longest prefix which does not satisfy the predicate, followed by the rest of the list.</p>\n\n<pre><code>findr p f list = case break p list of\n             (xs, y : ys) -&gt; Just (xs ++ f y : ys)\n             (_, [])      -&gt; Nothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "is_accepted": false, "score": 1, "last_activity_date": 1450980109, "creation_date": 1450980109, "answer_id": 34456363, "question_id": 34455383, "link": "https://stackoverflow.com/questions/34455383/finding-and-replacing/34456363#34456363", "title": "Finding and replacing", "body": "<p>This function is, of course, <code>map</code>, as long as you can combine your predicate function and replacement function the right way.</p>\n\n<pre><code>findr check_f replace_f xs = map (replace_if_needed check_f replace_f) xs\n\nreplace_if_needed :: (a -&gt; Bool) -&gt; (a -&gt; a) -&gt; (a -&gt; a)\nreplace_if_needed check_f replace_f = \\x -&gt; if check_f x then replace_f x else x\n</code></pre>\n\n<p>Now you can do things like <code>findr isAplha toUpper \"a123-bc\"</code>.</p>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 34455677, "answer_count": 2, "score": 1, "last_activity_date": 1450980109, "creation_date": 1450973858, "question_id": 34455383, "link": "https://stackoverflow.com/questions/34455383/finding-and-replacing", "title": "Finding and replacing", "body": "<p>There are times that we want to find an element in a list with a function <code>a -&gt; Bool</code> and replace it using a function <code>a -&gt; a</code>, this may result in a new list:</p>\n\n<pre><code>findr :: (a -&gt; Bool) -&gt; (a -&gt; a) -&gt; [a] -&gt; Maybe [a]\nfindr _ _ [] = Nothing\nfindr p f (x:xs) \n  | p x = Just (f x : xs)\n  | otherwise = case findr p f xs of Just xs -&gt; Just (x:xs)\n                                     _ -&gt; Nothing\n</code></pre>\n\n<p>Is there any function in the main modules which is similar to this?</p>\n"}, {"tags": ["haskell", "memory-leaks", "profiling"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1450967268, "post_id": 34452955, "comment_id": 56649962, "body": "<code>import Control.Monad.Trans.State.Strict</code> instead, since you can&#39;t use the weird extra laziness here. That seems the most likely problem. You may or may not actually benefit by that fancy <code>sumTree</code>, depending on how it leans (I think)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450967464, "post_id": 34452955, "comment_id": 56650071, "body": "Er... I guess you <i>can</i> benefit from the extra laziness, but only with very great care in summing. I wouldn&#39;t generally recommend that approach--too fragile."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450968384, "post_id": 34452955, "comment_id": 56650413, "body": "@dfeuer, that was the first thing I tried. It&#39;s slightly better, but there is still a leak. The <a href=\"http://lpaste.net/147785\" rel=\"nofollow noreferrer\">best version</a> I wrote uses both strict and lazy state (but without explicit <code>State</code>). Twice as fast, 27 MB total memory in use, but still half of the time spent on GC."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1450968899, "post_id": 34452955, "comment_id": 56650615, "body": "I think the best you can do is probably to use some math to figure out how to build the tree in a purely top-down fashion, without passing state, so the right subtree does not depend on any results produced building the left subtree. This will make the tree-building process as usefully lazy as possible, after which you can focus on how your sum function consumes the tree."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1450969442, "post_id": 34452955, "comment_id": 56650837, "body": "Your <code>sumTree</code> forces the left subtree (at least) because of <code>(a + n)</code> in the strict accumulator (<code>n</code> is output by the <code>State</code> computation that computes the left tree). If you write a <code>sumTree</code> without accumulator and switch to <code>Int</code>-s, it runs in 2 MB memory. I&#39;m not sure though why <code>Integer</code> leaks space even in this case; I might look at it and write up an answer later coz&#39; I&#39;m busy now."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450970021, "post_id": 34452955, "comment_id": 56651062, "body": "@Andr&#225;s Kov&#225;cs, thanks. Alternatively, <code>deriving (Foldable)</code> and <code>foldl&#39; (+) 0</code> results in 2 MB too (and with <code>Integer</code>s too)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1450970050, "post_id": 34452955, "comment_id": 56651075, "body": "@Andr&#225;sKov&#225;cs, that&#39;s why I consider the lazy state approach fragile."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1450974097, "post_id": 34452955, "comment_id": 56652568, "body": "Turns out <code>Integer</code> leaks space because it builds up the whole <code>(+)</code> thunk tree (the &quot;classic&quot; leak), while <code>Int</code> gets unboxed and made strict. A <code>seq</code> or bang pattern on the left sum repairs it. I agree it&#39;s rather fragile."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1450997260, "creation_date": 1450997260, "answer_id": 34458542, "question_id": 34452955, "link": "https://stackoverflow.com/questions/34452955/generating-a-tree-of-distinct-integers-results-in-a-space-leak/34458542#34458542", "title": "Generating a tree of distinct integers results in a space leak", "body": "<p>Any time you build a tree, you should try to find a way to work exclusively from the top down. This is generally good for laziness, concurrency, cache utilization, GC effectiveness, etc. The tree you build is just a complete binary tree numbered in order. I suggest you consider using the following signature and doing some bit shifting:</p>\n\n<pre><code>tree :: Bits b =&gt; Int -&gt; Tree b\n</code></pre>\n\n<p>You can break out a helper function that takes the starting point.</p>\n"}], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1450997260, "creation_date": 1450960714, "last_edit_date": 1450970894, "question_id": 34452955, "link": "https://stackoverflow.com/questions/34452955/generating-a-tree-of-distinct-integers-results-in-a-space-leak", "title": "Generating a tree of distinct integers results in a space leak", "body": "<p>I want to generate a tree that contains distinct integers and find their sum. Here is the code:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nimport Control.Applicative\nimport Control.Monad.Trans.State\n\ndata Tree a = Leaf a | Branch (Tree a) a (Tree a)\n\nnew = get &lt;* modify' (+ 1)\n\ntree :: Integer -&gt; Tree Integer\ntree n = evalState (go n) 0 where\n    go 0 = Leaf &lt;$&gt; new\n    go n = Branch &lt;$&gt; go (n - 1) &lt;*&gt; new &lt;*&gt; go (n - 1)\n\nsumTree = go 0 where\n    go !a (Leaf n)       = a + n\n    go !a (Branch l n r) = go (go (a + n) l) r\n\nmain = print $ sumTree (tree 20)\n</code></pre>\n\n<p>Compiled with <code>-O2</code> it results in</p>\n\n<pre><code>     348,785,728 bytes allocated in the heap\n     147,227,228 bytes copied during GC\n      34,656,860 bytes maximum residency (13 sample(s))\n          35,468 bytes maximum slop\n              72 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0       565 colls,     0 par    0.764s   1.024s     0.0018s    0.0071s\n  Gen  1        13 colls,     0 par    0.936s   1.014s     0.0780s    0.3214s\n\n  INIT    time    0.000s  (  0.001s elapsed)\n  MUT     time    0.936s  (  0.764s elapsed)\n  GC      time    1.700s  (  2.038s elapsed)\n  EXIT    time    0.000s  (  0.002s elapsed)\n  Total   time    2.636s  (  2.805s elapsed)\n\n  %GC     time      64.5%  (72.7% elapsed)\n\n  Alloc rate    372,631,936 bytes per MUT second\n\n  Productivity  35.5% of total user, 33.4% of total elapsed\n</code></pre>\n\n<p>Why am I getting this space leak? How to remove it?</p>\n"}, {"tags": ["java", "haskell", "bind", "monads", "nested-if"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1450951197, "post_id": 34450149, "comment_id": 56643220, "body": "This nice talk about &quot;refactoring ruby with monads&quot; covers the &quot;removing duplication from error checking&quot; case: <a href=\"https://www.youtube.com/watch?v=J1jYlPtkrqQ\" rel=\"nofollow noreferrer\">youtube.com/watch?v=J1jYlPtkrqQ</a>"}], "answers": [{"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 1, "last_activity_date": 1450955363, "last_edit_date": 1450955363, "creation_date": 1450952990, "answer_id": 34451340, "question_id": 34450149, "link": "https://stackoverflow.com/questions/34450149/how-could-this-apache-tomcat-code-be-simplified-with-a-monadic-bind/34451340#34451340", "title": "How could this Apache Tomcat code be simplified with a Monadic Bind?", "body": "<p>Well, here you have side effects (<code>request.set...</code>), and bind is more useful when you don't. Using <code>ifPresent</code> is sufficient:</p>\n\n<pre><code>Optional.ofNullable(principal).ifPresent(principal -&gt;\n  Optional.ofNullable(request.getSessionInternal(false)).ifPresent(session -&gt;\n    Optional.ofNullable(session.getPrincipal).ifPresent(principal -&gt; {\n      if (log.isDebugEnabled())\n        log.debug(...);\n      request.setAuthType(session.getAuthType());\n      request.setUserPrincipal(principal);\n    })));\n</code></pre>\n\n<p>This may not look like a win; repeating but <code>Optional.ofNullable(...)</code> wouldn't be necessary if <code>request.getSessionInternal</code> and <code>session.getPrincipal</code> already returned <code>Optional</code>. </p>\n\n<p>And you can write a method which works like <code>Optional.ofNullable(...).ifPresent</code>:</p>\n\n<pre><code>public static &lt;T&gt; void ifNotNull(T value, Consumer&lt;? super T&gt; consumer) {\n  if (value != null) { consumer.accept(value); }\n}\n\nifNotNull(principal, principal -&gt;\n  ifNotNull(request.getSessionInternal(false), session -&gt;\n    ifNotNull(session.getPrincipal, principal -&gt; {\n      if (log.isDebugEnabled())\n        log.debug(...);\n      request.setAuthType(session.getAuthType());\n      request.setUserPrincipal(principal);\n    })));\n</code></pre>\n\n<p>(Note: not sure I remember Java syntax exactly, I haven't used it for some time.)</p>\n"}, {"comments": [{"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 0, "creation_date": 1451134216, "post_id": 34471278, "comment_id": 56684251, "body": "Haven&#39;t you failed to handle a null value in your second line?"}, {"owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "reply_to_user": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 0, "creation_date": 1451172382, "post_id": 34471278, "comment_id": 56694174, "body": "No, for we assume that a function that returns <code>Optional&lt;T&gt;</code> <i>never</i> returns <code>null</code>.  The failure/absense case is handled in the <code>Optional</code> value.  I will clarify in my answer."}], "tags": [], "owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "is_accepted": true, "score": 0, "last_activity_date": 1451184904, "last_edit_date": 1451184904, "creation_date": 1451132405, "answer_id": 34471278, "question_id": 34450149, "link": "https://stackoverflow.com/questions/34450149/how-could-this-apache-tomcat-code-be-simplified-with-a-monadic-bind/34471278#34471278", "title": "How could this Apache Tomcat code be simplified with a Monadic Bind?", "body": "<p>I am the author of the Twitter comment.  In this example the \"low-hanging fruit\" for\nsimplification, assuming the existence of a monadic <em>option type</em>, is the several layers of nested code predeciated on <em>\"<code>foo</code> is not <code>null</code>\"</em>.</p>\n\n<p>Let us focus on the following snippet:</p>\n\n<pre><code>Principal principal = request.getUserPrincipal();\nif (principal == null) {\n    Session session = request.getSessionInternal(false);\n    if (session != null) {\n        principal = session.getPrincipal();\n        if (principal != null) {\n            if (log.isDebugEnabled())\n                log.debug(\"We have cached auth type \" +\n                    session.getAuthType() +\n                    \" for principal \" +\n                    session.getPrincipal());\n            request.setAuthType(session.getAuthType());\n            request.setUserPrincipal(principal);\n        }\n    }\n}\n</code></pre>\n\n<p>Since we are talking about general constructions rather Java specifically, or any particular language, let's introduce some new assumptions (which may or may not be easily embodied in Java code), and we will refactor the code to exploit them.</p>\n\n<p><strong>Assumption 1</strong>: all methods that could return <code>null</code> return an <a href=\"http://docs.oracle.com/javase/8/docs/api/java/util/Optional.html\" rel=\"nofollow\"><code>Optional&lt;T&gt;</code></a> instead, and <strong>never return <code>null</code></strong> because the absense/failure case is handled in the <code>Optional</code> value itself.  In other languages <code>Optional</code> is variously called <code>Option</code>, <code>Maybe</code> and possibly other names.</p>\n\n<p><strong>Assumption 2</strong>: <code>Optional</code> has a <em>monadic bind</em> method.  Java 8's <code>Optional</code> calls this function <code>flatMap</code>, so we will call it that as well.  In Haskell, it is called <code>&gt;&gt;=</code>, but the name does not matter - what matters is the type:</p>\n\n<pre><code>&lt;U&gt; Optional&lt;U&gt; flatMap(Function&lt;? super T,Optional&lt;U&gt;&gt; mapper)\n</code></pre>\n\n<p>For comparison, in Haskell <code>&gt;&gt;=</code> is defined for all types that have an instance of the <code>Monad</code> type class; the type signature being:</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>When specialised to <code>Maybe</code> and using different type variable names, the correspondence to Java's <code>Optional</code> becomes clearer.</p>\n\n<pre><code>(&gt;&gt;=) :: Maybe t -&gt; (t -&gt; Maybe u) -&gt; Maybe u\n</code></pre>\n\n<p><strong>Assumption 3</strong>: the language has first-class lambdas.  I know that Java 8 has lambdas but I do not know the syntax of the top of my head, so I'm just going to make it up :)</p>\n\n<p>Applying these assumptions, the <strong>simplified code</strong> looks something like:</p>\n\n<pre><code>Optional&lt;Principal&gt; principal = request.getUserPrincipal();\nif (!principal.isPresent()) {\n    Optional&lt;Session&gt; session = request.getSessionInternal(false);\n    principal = session.flatMap((sess) { sess.getPrincipal() });\n    principal.flatMap((principal) {\n        if (log.isDebugEnabled()) ... // as before\n        request.setAuthType(session.getAuthType());\n        request.setUserPrincipal(principal);\n    })\n}\n</code></pre>\n\n<p>Notice that each successive call to <code>flatMap</code> removes an <code>if</code> level from the program.  The calls to <code>flatMap</code> can also be chained to avoid intermediate assignments.</p>\n\n<p>The benefits to using a monadic bind pattern in Java are apparent, but they are unfortunately limited.  Because <code>flatMap</code> is definined concretely for <code>Optional</code> (perhaps a similar method is also defined concretely for other types), rather than abstractly over a type class or interface, the programmer does not have access to the many derived operations for free.  Such derived operations must be manually written for each instance.</p>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 34471278, "answer_count": 2, "score": 1, "last_activity_date": 1451184904, "creation_date": 1450948194, "question_id": 34450149, "link": "https://stackoverflow.com/questions/34450149/how-could-this-apache-tomcat-code-be-simplified-with-a-monadic-bind", "title": "How could this Apache Tomcat code be simplified with a Monadic Bind?", "body": "<p>The <a href=\"https://twitter.com/hackuador/status/679286796996374528\" rel=\"nofollow\">commentator writes</a>:</p>\n\n<blockquote>\n  <p>Some nice \"greater-than sign\" code in Tomcat.  Needs a healthy dose of (>>=). </p>\n</blockquote>\n\n<p>When looking at <a href=\"https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk/java/org/apache/catalina/authenticator/AuthenticatorBase.java\" rel=\"nofollow\">the AuthenticatorBase.java class from Apache Tomcat</a>:</p>\n\n<pre><code>/**\n * Enforce the security restrictions in the web application deployment\n * descriptor of our associated Context.\n *\n * @param request Request to be processed\n * @param response Response to be processed\n *\n * @exception IOException if an input/output error occurs\n * @exception ServletException if thrown by a processing element\n */\n@Override\npublic void invoke(Request request, Response response)\n    throws IOException, ServletException {\n\n    if (log.isDebugEnabled())\n        log.debug(\"Security checking request \" +\n            request.getMethod() + \" \" + request.getRequestURI());\n    LoginConfig config = this.context.getLoginConfig();\n\n    // Have we got a cached authenticated Principal to record?\n    if (cache) {\n        Principal principal = request.getUserPrincipal();\n        if (principal == null) {\n            Session session = request.getSessionInternal(false);\n            if (session != null) {\n                principal = session.getPrincipal();\n                if (principal != null) {\n                    if (log.isDebugEnabled())\n                        log.debug(\"We have cached auth type \" +\n                            session.getAuthType() +\n                            \" for principal \" +\n                            session.getPrincipal());\n                    request.setAuthType(session.getAuthType());\n                    request.setUserPrincipal(principal);\n                }\n            }\n        }\n    }\n</code></pre>\n\n<p>I have to admit, I'm missing how this could be applied. I get that there is potentially a way to refactor an if-tree to a monadic bind, but I don't see how to do it. </p>\n\n<p><strong>Assumptions:</strong></p>\n\n<ul>\n<li>This is not about language, but about the logic construct. You could represent this if-tree in Haskell or Scala or Clojure and it would still be representing the same if-logic. </li>\n</ul>\n\n<p>My question is: <strong>How could this Apache Tomcat code be simplified with a Monadic Bind?</strong></p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"tags": [], "owner": {"reputation": 5054, "user_id": 548515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55624bebc921a03713d00a91c9e58a36?s=128&d=identicon&r=PG", "display_name": "Hans Lub", "link": "https://stackoverflow.com/users/548515/hans-lub"}, "is_accepted": true, "score": 1, "last_activity_date": 1451156755, "last_edit_date": 1451156755, "creation_date": 1450963463, "answer_id": 34453505, "question_id": 34450038, "link": "https://stackoverflow.com/questions/34450038/how-to-do-i-e-derive-multiplication-using-of-a-rational-and-a-new-type/34453505#34453505", "title": "How to do (i.e. derive) multiplication (using *) of a Rational and a new type", "body": "<blockquote>\n  <p>I can do something like <code>s * 1</code>, <code>s * 2.3</code>, <code>3.4 * s^2</code> ...</p>\n</blockquote>\n\n<p>Yes, because (citing from the Prelude documentation):</p>\n\n<blockquote>\n  <p>A floating literal stands for an application of <code>fromRational</code> to a value of type <code>Rational</code>, so such literals have type <code>(Fractional a) =&gt; a</code>.</p>\n</blockquote>\n\n<p>.. which means that you can use such a literal everywhere you can use a <code>Poly</code> (being a subclass of <code>Fractional</code>)</p>\n\n<p>The same doesn't hold for e.g. <code>3%2</code>, which is not a literal, but an expression with type <code>Integral a =&gt; Ratio a</code>, which only means I can use such an expression everywhere I can use a <code>Ratio a</code> (provided <code>a</code> is <code>Integral</code>). This is far less flexible.</p>\n\n<p>What you need, then, is an operator <code>%</code> such that <code>3%2</code> will get a type <code>(Fractional a) =&gt; a</code>, just like the literal <code>3.14</code></p>\n\n<p>This can be done by redefining it as in the following example </p>\n\n<pre><code>import qualified Data.Ratio as R\n\n(%) :: Fractional a =&gt; Integer -&gt; Integer -&gt; a\nx % y = fromRational ((R.%) x y)\n\n-- the rest as in your example\n</code></pre>\n\n<p>Now you can do </p>\n\n<pre><code>*YourExample&gt; :t 3%2 * s -- ask ghci whether this makes sense ...\n3%2 * s :: Poly          -- yes, it does!\n</code></pre>\n"}], "owner": {"reputation": 171, "user_id": 4533142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-UHBT7UZiono/AAAAAAAAAAI/AAAAAAAAAD4/CPCEzXGieb4/photo.jpg?sz=128", "display_name": "Xiangyu Zhu", "link": "https://stackoverflow.com/users/4533142/xiangyu-zhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 292, "favorite_count": 1, "accepted_answer_id": 34453505, "answer_count": 1, "score": 1, "last_activity_date": 1451156755, "creation_date": 1450947727, "last_edit_date": 1450970718, "question_id": 34450038, "link": "https://stackoverflow.com/questions/34450038/how-to-do-i-e-derive-multiplication-using-of-a-rational-and-a-new-type", "title": "How to do (i.e. derive) multiplication (using *) of a Rational and a new type", "body": "<p>I'm implementing a small program to handle polynomial operations, inspired by one assignment of upenn's <a href=\"https://www.seas.upenn.edu/~cis194/\" rel=\"nofollow\">cis194</a>. The code is below (I omitted some irrelevant code):</p>\n\n<pre><code>newtype Poly = Poly [Rational]\n    deriving Eq\ns :: Poly\ns = Poly [1, 0]\n\ninstance Num Poly where\n    (Poly a) + (Poly b) = ...\n    (Poly a) * (Poly b) = ...\n    negate (Poly xs) = ...\n    fromInteger i = Poly [fromInteger i]\n\ninstance Fractional Poly where\n    fromRational f = Poly [fromRational f]\n\ninstance Show Poly where\n    show (Poly a) = ...\n\npdiv :: Poly -&gt; Poly -&gt; (Poly, Poly)\npdiv (Poly a) (Poly b) = ...\n\ncauer1 :: Poly -&gt; Poly -&gt; String\ncauer1 a b =\n    let (q, r) = pdiv a b\n    in if r == 0 then (show q) else\n        (show q) ++ \" + 1/(\" ++ (cauer1 b r) ++ \")\"\n</code></pre>\n\n<p>This code works. For instance I can get the long division of polynomials' result in order to make a Cauer 1 form circuit using the <code>cauer1</code> function. (Circuit Analysis)</p>\n\n<pre><code>ghci &gt; let a = Poly [1, 23%6, 10%3, 0] -- represents: s^3 + 23/6 s^2 + 10/3 s\nghci &gt; let b = Poly [1, 3, 2]\nghci &gt; cauer1 a b\n\"s + 1/(6%5 + 1/(25%42s + 1/(49%5 + 1/(1%14s))))\"\n</code></pre>\n\n<p>What I want now is to do something like this:</p>\n\n<pre><code>ghci &gt; cauer1 (s^3 + 23%6*s^2 + 10%3*s) (s^2 + 3*s + 2)\n</code></pre>\n\n<p>and get the same result.</p>\n\n<p>At first my <code>Poly</code> type is defined as <code>Poly [Double]</code>, after making <code>Poly</code> instance of <code>Num</code> and <code>Fractional</code> and implementing <code>fromInteger</code> and <code>fromRational</code>, I can do something like <code>s * 1</code>, <code>s * 2.3</code>, <code>3.4 * s^2</code>, then the powerful typeclass will compute them as <code>Poly</code> without any problem. But in this way the result are all fractional numbers and lose precision, that's why I switched to <code>Poly [Rational]</code>. But Now I cannot do <code>3%2 * s</code>, they simply type mismatch according to ghc:</p>\n\n<pre><code>&lt;interactive&gt;:1:9:\nCouldn't match expected type \u2018Ratio a\u2019 with actual type \u2018Poly\u2019\nIn the second argument of \u2018(*)\u2019, namely \u2018s\u2019\nIn the expression: (3 % 2) * s\n</code></pre>\n\n<p>I found that <code>Rational</code> is <code>Ratio Integer</code> and <code>Ratio</code> is an instance of both <code>Num</code> and <code>Fractional</code>, why would this not work and how can I fix it?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "is_accepted": true, "score": 7, "last_activity_date": 1450927480, "creation_date": 1450927480, "answer_id": 34446850, "question_id": 34446789, "link": "https://stackoverflow.com/questions/34446789/type-error-when-using-length-inside-filter/34446850#34446850", "title": "Type error when using length inside filter", "body": "<p>You just need to compose <code>length</code> and <code>filter (==4)</code> with <code>.</code>, not <code>$</code>, because both <code>length</code> and <code>filter (==4)</code> are functions, not a function and a value, which you use <code>$</code> for. </p>\n\n<p>So you have:</p>\n\n<pre><code>map (length . filter (==4)) [[1,4],[4,3],[1,4,4,3]]\n</code></pre>\n\n<p>Alternatively, this would work also:</p>\n\n<pre><code>map (\\x -&gt; length $ filter (==4) x) [[1,4],[4,3],[1,4,4,3]]\n</code></pre>\n\n<p>but notice in this case you're applying <code>filter (==4) x</code> to <code>length</code> and <code>filter (==4) x</code> is a value itself, not a function, so <code>$</code> is the correct composition operator. </p>\n\n<p>But I'd argue the former is better Haskell style.</p>\n"}], "owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 34446850, "answer_count": 1, "score": 0, "last_activity_date": 1450927480, "creation_date": 1450926934, "question_id": 34446789, "link": "https://stackoverflow.com/questions/34446789/type-error-when-using-length-inside-filter", "title": "Type error when using length inside filter", "body": "<p>Given a list of lists, I'd like to find the maximum number of times a particular element occurs in one of the sub-lists.</p>\n\n<p>So given <code>[[1,4],[4,3],[1,4,4,3]]</code> I expect output to be <code>2</code> because the number <code>4</code> occurs twice in one of the sub-lists (and no more than twice).</p>\n\n<p>My approach was to eliminate all the numbers which are not <code>4</code> from the sublists, and then get the maximum length of all the sub-lists. The first step was OK:</p>\n\n<pre><code>map (filter (==4)) [[1,4],[4,3],[1,4,4,3]]\n</code></pre>\n\n<p>But adding <code>length</code> gives me an error:</p>\n\n<pre><code>map (length $ filter (==4)) [[1,4],[4,3],[1,4,4,3]]\n</code></pre>\n\n<blockquote>\n<pre><code>Couldn't match expected type \u2018[Integer] -&gt; b\u2019\n            with actual type \u2018Int\u2019\nRelevant bindings include it :: [b] (bound at &lt;interactive&gt;:11:1)\nIn the first argument of \u2018map\u2019, namely \u2018(length $ filter (== 4))\u2019\nIn the expression:\n  map (length $ filter (== 4)) [[1, 4], [4, 3], [1, 4, 4, ....]]\nIn an equation for \u2018it\u2019:\n    it = map (length $ filter (== 4)) [[1, 4], [4, 3], [1, 4, ....]]\n</code></pre>\n</blockquote>\n\n<p>Why doesn't this work? - Haskell noob if you did't notice :)</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 7613, "user_id": 1364007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d106de3dec9586b56ed7f110497689e?s=128&d=identicon&r=PG", "display_name": "Wai Ha Lee", "link": "https://stackoverflow.com/users/1364007/wai-ha-lee"}, "edited": false, "score": 1, "creation_date": 1452111289, "post_id": 34641862, "comment_id": 57029736, "body": "For posterity, could you include the relevant parts of the link which you found useful in your answer? That way, if the link goes down, changes, etc., your answer won&#39;t be rendered useless. Many thanks."}, {"owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "edited": false, "score": 0, "creation_date": 1539223792, "post_id": 34641862, "comment_id": 92426544, "body": "It works! My situation is similar. C (C++?) error <code>unknown type name &#39;instancetype</code> occured when building <code>hfsevents</code> package which is depended by <code>stack install hakyll</code> on macOS. There were <code>&#47;usr&#47;bin&#47;gcc</code> (Apple LLVM version 10.0.0 (clang-1000.11.45.2)) and <code>&#47;usr&#47;local&#47;bin&#47;gcc</code> (installed by Homebrew), so I <code>brew uninstall gcc</code>, then <code>stack install hakyll</code> succeeded."}], "tags": [], "owner": {"reputation": 352, "user_id": 4966649, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/529ce500a0fa87c9a7660f9837fdb651?s=128&d=identicon&r=PG", "display_name": "brandonchinn178", "link": "https://stackoverflow.com/users/4966649/brandonchinn178"}, "is_accepted": false, "score": 3, "last_activity_date": 1452211110, "last_edit_date": 1452211110, "creation_date": 1452111053, "answer_id": 34641862, "question_id": 34446732, "link": "https://stackoverflow.com/questions/34446732/objective-c-not-recognized-building-hfsevents-with-stack/34641862#34641862", "title": "Objective-C not recognized building hfsevents with stack", "body": "<p>Eventually got this working. The steps that led me to the solution are documented here: <a href=\"https://github.com/commercialhaskell/stack/issues/1563\" rel=\"nofollow\">https://github.com/commercialhaskell/stack/issues/1563</a></p>\n\n<p>Basically, I had two different <code>gcc</code>'s installed, one in <code>/usr/bin/</code> installed by Xcode and one in <code>/usr/local/bin/</code> from somewhere I don't remember. <code>/usr/bin/gcc</code> was the one being used by <code>cabal</code>, so <code>cabal install hfsevents</code> worked, while <code>/usr/local/bin/gcc</code>, which was the one apparently being used by <code>stack</code>, had this issue. What I did to resolve this was delete <code>/usr/local/bin/gcc</code> and only keep <code>/usr/bin/gcc</code>.</p>\n"}], "owner": {"reputation": 352, "user_id": 4966649, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/529ce500a0fa87c9a7660f9837fdb651?s=128&d=identicon&r=PG", "display_name": "brandonchinn178", "link": "https://stackoverflow.com/users/4966649/brandonchinn178"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1452211110, "creation_date": 1450926352, "last_edit_date": 1495540360, "question_id": 34446732, "link": "https://stackoverflow.com/questions/34446732/objective-c-not-recognized-building-hfsevents-with-stack", "title": "Objective-C not recognized building hfsevents with stack", "body": "<p>If I start up a new project, add <code>hfsevents</code> to the list of dependencies in the <code>.cabal</code> file, and run <code>stack build</code>, I get an error (on Mac OSX Yosemite):</p>\n\n<pre><code>--  While building package hfsevents-0.1.6 using:\n/Users/Me/.stack/setup-exe-cache/setup-Simple-Cabal-1.22.4.0-x86_64-osx-ghc-7.10.2 --builddir=.stack-work/dist/x86_64-osx/Cabal-1.22.4.0/ build --ghc-options -hpcdir .stack-work/dist/x86_64-osx/Cabal-1.22.4.0/hpc/.hpc/ -ddump-hi -ddump-to-file\nProcess exited with code: ExitFailure 1\nLogs have been written to: /Users/Me/Desktop/code/haskell/test/.stack-work/logs/hfsevents-0.1.6.log\n\nConfiguring hfsevents-0.1.6...\nBuilding hfsevents-0.1.6...\nPreprocessing library hfsevents-0.1.6...\n[1 of 1] Compiling System.OSX.FSEvents ( System/OSX/FSEvents.hs, .stack-work/dist/x86_64-osx/Cabal-1.22.4.0/build/System/OSX/FSEvents.o )\ngcc: error: language objective-c not recognized\ngcc: error: language objective-c not recognized\n</code></pre>\n\n<p>I already followed the advice of calling <a href=\"https://stackoverflow.com/questions/19758766/problems-installing-yesod-for-haskell\"><code>brew install gcc48 --with-all-languages</code></a> and I uninstalled all Haskell versions, only using the <code>ghc</code> within <code>stack</code>. Xcode is on version 7.1.1. What else can I try to fix this problem?</p>\n"}]