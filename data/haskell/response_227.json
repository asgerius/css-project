[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557955092, "post_id": 56157700, "comment_id": 98944487, "body": "It does not <i>per se</i> builds a large thunk of long lists, that depends on the <code>Num</code> implementation. For example one could implement <code>(+)</code> in such a way that it sometimes only has to look to the first element, and due too lazyness, it could thus terminate the before evaluating the entire list."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 15, "last_activity_date": 1557955849, "creation_date": 1557955849, "answer_id": 56157894, "question_id": 56157700, "link": "https://stackoverflow.com/questions/56157700/why-is-data-list-genericlength-implemented-as-a-right-fold/56157894#56157894", "title": "Why is Data.List.genericLength implemented as a right fold?", "body": "<p><code>genericLength</code> is implemented with things like Peano numbers in mind:</p>\n\n<pre><code>data Peano = Zero | Succ Peano\n</code></pre>\n\n<p>Numbers using this representation can be non-strict, so an operation like <code>genericLength [1..] &gt; 5</code> returns True instead of failing to terminate.</p>\n\n<p>For most other reasonable implementations of Num, the foldr in <code>genericLength</code> does indeed cause the problems you mention.</p>\n"}], "owner": {"reputation": 778, "user_id": 3661967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZWGB0.png?s=128&g=1", "display_name": "Ziyang Liu", "link": "https://stackoverflow.com/users/3661967/ziyang-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 2, "accepted_answer_id": 56157894, "answer_count": 1, "score": 14, "last_activity_date": 1557955849, "creation_date": 1557954793, "question_id": 56157700, "link": "https://stackoverflow.com/questions/56157700/why-is-data-list-genericlength-implemented-as-a-right-fold", "title": "Why is Data.List.genericLength implemented as a right fold?", "body": "<p><code>genericLength</code> is implemented, as of base 4.12, as:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>genericLength           :: (Num i) =&gt; [a] -&gt; i\n{-# NOINLINE [1] genericLength #-}\ngenericLength []        =  0\ngenericLength (_:l)     =  1 + genericLength l\n\n{-# RULES\n  \"genericLengthInt\"     genericLength = (strictGenericLength :: [a] -&gt; Int);\n  \"genericLengthInteger\" genericLength = (strictGenericLength :: [a] -&gt; Integer);\n #-}\n\nstrictGenericLength     :: (Num i) =&gt; [b] -&gt; i\nstrictGenericLength l   =  gl l 0\n                        where\n                           gl [] a     = a\n                           gl (_:xs) a = let a' = a + 1 in a' `seq` gl xs a'\n</code></pre>\n\n<p>which is basically a <code>foldr</code>, except that for <code>Int</code> and <code>Integer</code> it performs a <code>foldl'</code> instead.</p>\n\n<p>Why does it not use <code>foldl'</code> in all cases? Doesn't <code>foldr</code> build up large thunks for long lists?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1557944956, "post_id": 56154611, "comment_id": 98940312, "body": "One question at a time."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1557948221, "post_id": 56154611, "comment_id": 98941754, "body": "There are entire bookswritten with the purpose of answering this question (<a href=\"http://www.cis.upenn.edu/~bcpierce/tapl/\" rel=\"nofollow noreferrer\">TAPL</a> is an especially approachable choice). Expecting a StackOverflow-sized post to cover all the relevant material is unreasonable."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 5, "last_activity_date": 1557941267, "creation_date": 1557941267, "answer_id": 56154733, "question_id": 56154611, "link": "https://stackoverflow.com/questions/56154611/most-general-types-in-haskell-and-defining-them/56154733#56154733", "title": "Most general types in Haskell and defining them", "body": "<p>Start with explicit parentheses:</p>\n\n<pre><code>f 7 (g 'a') == (f 7) (g 'a')\n</code></pre>\n\n<p>Knowing that <code>7 :: Num a =&gt; a</code> and <code>'a' :: Char</code>, it's immediately clear that</p>\n\n<pre><code>f :: Num a =&gt; a -&gt; b\ng :: Char -&gt; c\n</code></pre>\n\n<p>for some unconstrained types <code>b</code> and <code>c</code>. However, we also know that <code>b</code> is a function type, because the return value of <code>f</code> is applied to the return value of <code>g</code>. Further, we know the return value of <code>g</code> has type <code>c</code>. So we can refine our guess for what <code>b</code> must be:</p>\n\n<pre><code>f :: Num a =&gt; a -&gt; (c -&gt; d)  -- parentheses are redundant\ng :: Char -&gt; c\n</code></pre>\n\n<p>There's not much else you can do at this point, other than make the following observations:</p>\n\n<pre><code>f 7 :: c -&gt; d\ng 'a' :: c\nf 7 (g 'a') :: d\n</code></pre>\n"}], "owner": {"reputation": 305, "user_id": 9301734, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2de7afc05983df872e451ae19df7ef2?s=128&d=identicon&r=PG&f=1", "display_name": "jake-ferguson", "link": "https://stackoverflow.com/users/9301734/jake-ferguson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 56154733, "answer_count": 1, "score": 0, "last_activity_date": 1557941267, "creation_date": 1557940761, "question_id": 56154611, "link": "https://stackoverflow.com/questions/56154611/most-general-types-in-haskell-and-defining-them", "title": "Most general types in Haskell and defining them", "body": "<p>Hello I have a problem with some of my uni Haskell exercises concerning types.  I can define types for functions like (*), map etc. but the problem appears when I must define the type of:</p>\n\n<pre><code>f 7 (g 'a')\n</code></pre>\n\n<p>How I start with this? I know we should use some most general unifier but I didn't find anything about it on the Internet?</p>\n\n<p>Further more there is another task to find <strong>most general type</strong> taking into account possible classes of types.</p>\n\n<blockquote>\n  <ul>\n  <li>foldl (++)</li>\n  <li>square (f x)</li>\n  <li>g for function:  \n  \n  <ul>\n  <li>g [ ] = Nothing</li>\n  <li>g [x] = Just x</li>\n  <li>g (x:y:l) = if x &lt; y then Just x else Just y</li>\n  </ul></li>\n  </ul>\n</blockquote>\n\n<p>What is most general type here? What does it mean in Haskell and what should be done here?\nI would be grateful for any explanations. This is not any homework just preparation for exam, any help would be more than welcome.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1557945053, "post_id": 56154469, "comment_id": 98940349, "body": "Remove the irrelevant code please. Your java code will not help anyone examine your haskell code."}, {"owner": {"reputation": 1290, "user_id": 5499871, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206799318615183/picture?type=large", "display_name": "Izaak Weiss", "link": "https://stackoverflow.com/users/5499871/izaak-weiss"}, "edited": false, "score": 0, "creation_date": 1557949383, "post_id": 56154469, "comment_id": 98942232, "body": "How are you using Control.Concurrent.Async? You should indicate what changes you made when using that library. Simply adding the import won&#39;t add multi threading, and we need to know what changes you did make."}, {"owner": {"reputation": 754, "user_id": 2140910, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CtvpI.jpg?s=128&g=1", "display_name": "Bjartur Thorlacius", "link": "https://stackoverflow.com/users/2140910/bjartur-thorlacius"}, "edited": false, "score": 0, "creation_date": 1557963007, "post_id": 56154469, "comment_id": 98946367, "body": "This task sounds like it should be memory bandwidth constrained, not CPU constrained. Out of curiousity, how much did parallelization speed up the Java implementation (keeping caching constant)?"}, {"owner": {"reputation": 297, "user_id": 9596377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a8cf9de78ea1b11df3681d8524522b7?s=128&d=identicon&r=PG&f=1", "display_name": "slemoine", "link": "https://stackoverflow.com/users/9596377/slemoine"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1557992031, "post_id": 56154469, "comment_id": 98953678, "body": "@MichaelLitchard done"}, {"owner": {"reputation": 297, "user_id": 9596377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a8cf9de78ea1b11df3681d8524522b7?s=128&d=identicon&r=PG&f=1", "display_name": "slemoine", "link": "https://stackoverflow.com/users/9596377/slemoine"}, "reply_to_user": {"reputation": 754, "user_id": 2140910, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CtvpI.jpg?s=128&g=1", "display_name": "Bjartur Thorlacius", "link": "https://stackoverflow.com/users/2140910/bjartur-thorlacius"}, "edited": false, "score": 0, "creation_date": 1557992345, "post_id": 56154469, "comment_id": 98953862, "body": "@BjarturThorlacius In java without parallelization : 292s VS 64s with so a 4,5 factor."}, {"owner": {"reputation": 297, "user_id": 9596377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a8cf9de78ea1b11df3681d8524522b7?s=128&d=identicon&r=PG&f=1", "display_name": "slemoine", "link": "https://stackoverflow.com/users/9596377/slemoine"}, "reply_to_user": {"reputation": 1290, "user_id": 5499871, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206799318615183/picture?type=large", "display_name": "Izaak Weiss", "link": "https://stackoverflow.com/users/5499871/izaak-weiss"}, "edited": false, "score": 0, "creation_date": 1557995907, "post_id": 56154469, "comment_id": 98955769, "body": "@IzaakWeiss Sorry I have edited my question"}], "answers": [{"comments": [{"owner": {"reputation": 297, "user_id": 9596377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a8cf9de78ea1b11df3681d8524522b7?s=128&d=identicon&r=PG&f=1", "display_name": "slemoine", "link": "https://stackoverflow.com/users/9596377/slemoine"}, "edited": false, "score": 0, "creation_date": 1559035271, "post_id": 56179380, "comment_id": 99283292, "body": "thanks, I edit my question thanks to the hints you gave me."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 297, "user_id": 9596377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a8cf9de78ea1b11df3681d8524522b7?s=128&d=identicon&r=PG&f=1", "display_name": "slemoine", "link": "https://stackoverflow.com/users/9596377/slemoine"}, "edited": false, "score": 0, "creation_date": 1559035811, "post_id": 56179380, "comment_id": 99283598, "body": "You shouldn&#39;t edit question in this case. If you want to post your solution, just post it as separate answer."}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": true, "score": 0, "last_activity_date": 1558065990, "last_edit_date": 1558065990, "creation_date": 1558065356, "answer_id": 56179380, "question_id": 56154469, "link": "https://stackoverflow.com/questions/56154469/simple-csv-import-using-concurrency/56179380#56179380", "title": "Simple csv import using concurrency", "body": "<p>Problem with your code that it start db transaction for each line.</p>\n\n<p>I suggest you to split your data into chunk and process whole chunk in one transaction.</p>\n\n<p>Also it will help if you will insert multiple records in one <code>insert</code> statement.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Another problem (biggest one) you use only one connection which make make your code effectively sequential, not paralel.</p>\n\n<p>Also you read all your data to memory before processing it. You can improve performance here too.</p>\n"}, {"tags": [], "owner": {"reputation": 297, "user_id": 9596377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a8cf9de78ea1b11df3681d8524522b7?s=128&d=identicon&r=PG&f=1", "display_name": "slemoine", "link": "https://stackoverflow.com/users/9596377/slemoine"}, "is_accepted": false, "score": 2, "last_activity_date": 1559036818, "creation_date": 1559036818, "answer_id": 56339397, "question_id": 56154469, "link": "https://stackoverflow.com/questions/56154469/simple-csv-import-using-concurrency/56339397#56339397", "title": "Simple csv import using concurrency", "body": "<p>I put here a solution, probably not the best one but it easily achieve better performance than the java one with far less lines of code and without using specific multithreading mechanisms.<br>\nI use resource pool and chunk of 10000 lines for insertions.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Text\nimport qualified Data.Text.IO as TIO \nimport Text.Parsec\nimport Text.Parsec.Text (Parser)\nimport Database.PostgreSQL.Simple\nimport Data.Int\nimport Control.Concurrent.Async\nimport Data.Pool\nimport qualified Data.List.Split as Split\nimport System.CPUTime\n\nline :: Parser (Text,Text)\nline = do\n  title  &lt;- many $ noneOf \",\"\n  oneOf \",\"\n  price &lt;- many $ digit\n  return (pack title,pack price)\n\nfile :: Parser [(Text,Text)]\nfile = line `endBy` newline\n\nparseCsv :: SourceName -&gt; Text -&gt; Either ParseError [(Text,Text)]\nparseCsv = parse file\n\nparseCsvF :: FilePath -&gt; IO (Either ParseError [(Text,Text)])\nparseCsvF path = fmap (parseCsv path) $ TIO.readFile path \n\nconnectionInfo :: ConnectInfo\nconnectionInfo = ConnectInfo {\n  connectHost=\"localhost\",\n  connectPort=5432,\n  connectUser=\"parser\",\n  connectPassword=\"parser\",\n  connectDatabase=\"parser\"}\n\nmyPool :: IO (Pool Connection)\nmyPool = createPool (connect connectionInfo) close 1 10 10\n\ninsertComic :: Pool Connection -&gt; [(Text , Text)] -&gt; IO Int64\ninsertComic pool comic = withResource pool (\\conn -&gt; insertComic' conn comic)\n\ninsertComic' :: Connection -&gt; [(Text,Text)] -&gt; IO Int64 \ninsertComic' conn comics = executeMany conn \"INSERT INTO comics (title, price) VALUES (?,?)\" comics  \n\nmain = do\n  start &lt;- getCPUTime\n  pool &lt;- myPool\n  input &lt;- parseCsvF \"data.csv\"\n  let (Right allComics) = input\n      chunks =  Split.chunksOf 10000 allComics\n      inserts = [ insertComic pool chunk  | chunk &lt;- chunks]\n  sequence inserts\n  end &lt;- getCPUTime\n  putStrLn $ show $ fromIntegral (end-start) / 10^12\n\n</code></pre>\n\n<pre><code>ghc -threaded injector.hs -o injector\n./injector +RTS -N8\n</code></pre>\n"}], "owner": {"reputation": 297, "user_id": 9596377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a8cf9de78ea1b11df3681d8524522b7?s=128&d=identicon&r=PG&f=1", "display_name": "slemoine", "link": "https://stackoverflow.com/users/9596377/slemoine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "accepted_answer_id": 56179380, "answer_count": 2, "score": -1, "last_activity_date": 1559036818, "creation_date": 1557940231, "last_edit_date": 1559036726, "question_id": 56154469, "link": "https://stackoverflow.com/questions/56154469/simple-csv-import-using-concurrency", "title": "Simple csv import using concurrency", "body": "<p>I try to solve this academic use case: parse a csv file and insert data in database with multithreading.</p>\n\n<p>In Java, I wrote a solution which uses the main thread to read the data into a collection and then run 8 tasks concurrently to insert the data in database. With my 8 core machine, it does the job in almost 60s for a 1 million lines csv file (2 columns: title and price).</p>\n\n<p>Then I try to write equivalent in haskell (with my beginner skills):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Text\nimport qualified Data.Text.IO as TIO \nimport Text.Parsec\nimport Text.Parsec.Text (Parser)\nimport Database.PostgreSQL.Simple\nimport Data.Int\nimport Control.Concurrent.Async\n\nline :: Parser (Text,Text)\nline = do\n  title  &lt;- many $ noneOf \",\"\n  oneOf \",\"\n  price &lt;- many $ digit\n  return (pack title,pack price)\n\nfile :: Parser [(Text,Text)]\nfile = line `endBy` newline\n\nparseCsv :: SourceName -&gt; Text -&gt; Either ParseError [(Text,Text)]\nparseCsv = parse file\n\nparseCsvF :: FilePath -&gt; IO (Either ParseError [(Text,Text)])\nparseCsvF path = fmap (parseCsv path) $ TIO.readFile path \n\nconnectDB :: IO Connection\nconnectDB = connect (ConnectInfo { connectHost=\"localhost\", connectPort=5432, connectUser=\"parser\", connectPassword=\"parser\", connectDatabase=\"parser\"}) \n\ninsertComic :: Connection -&gt; (Text,Text) -&gt; IO Int64 \ninsertComic conn (title,price) = execute conn \"INSERT INTO comics (title, price) VALUES (?,?)\" [unpack title , unpack price]  \n\nmain = do\n  conn &lt;- connectDB\n  input &lt;- parseCsvF \"data.csv\"\n  let (Right x) = input\n      inserts = Prelude.map (insertComic conn) x\n      asyncs = Prelude.map async inserts\n      waiters = Prelude.map waitForIt asyncs\n  sequence waiters\n\n\nwaitForIt :: IO (Async Int64) -&gt; IO Int64\nwaitForIt x =  x &gt;&gt;= \\v -&gt; wait v\n\n</code></pre>\n\n<pre><code>ghc -threaded injector.hs -o injector\n./injector +RTS -N8\n</code></pre>\n\n<p>unfortunately it is very slow (several minutes...)</p>\n\n<p>I guess I didn't use Async correctly. Could someone give me an example of solution to make this program using multithreading efficiently ? </p>\n"}, {"tags": ["haskell", "set"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1557938102, "post_id": 56153286, "comment_id": 98937245, "body": "<code>head :: (Foldable f) =&gt; f a -&gt; Maybe a</code> is the clear idiomatic choice."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1557938644, "post_id": 56153286, "comment_id": 98937527, "body": "What do you find unidiomatic about <code>lookupMin</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1557938787, "post_id": 56153286, "comment_id": 98937604, "body": "Both <code>lookupMin</code> and <code>lookupMax</code> look fine to me, under your hypotheses. You can&#39;t pattern match on a <code>Set</code> (it&#39;s an opaque type), so using some function is in order."}, {"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557938924, "post_id": 56153286, "comment_id": 98937673, "body": "@Daniel Wagner I am just looking for the right way to do it, both functions are legitimate in this case."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1557946010, "post_id": 56153286, "comment_id": 98940796, "body": "What lets you assume the set has at most one element? Maybe <code>Set a</code> is the wrong type to be using in the first place."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1557951279, "post_id": 56153286, "comment_id": 98943006, "body": "There has been talk of adding <code>NonEmptySet</code> to the &quot;containers&quot; library. For that type, <code>lookupMin</code> and <code>lookupMax</code> would be total <a href=\"https://mail.haskell.org/pipermail/libraries/2019-April/029537.html\" rel=\"nofollow noreferrer\">mail.haskell.org/pipermail/libraries/2019-April/029537.html</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "is_accepted": true, "score": 4, "last_activity_date": 1557945455, "creation_date": 1557945455, "answer_id": 56155735, "question_id": 56153286, "link": "https://stackoverflow.com/questions/56153286/how-can-i-extract-element-from-set-with-zero-or-one-element-in-haskell/56155735#56155735", "title": "How can I extract element from Set with zero or one element in Haskell?", "body": "<p>To move some of the comments into an answer and add my own 2\u00a2:</p>\n\n<p>I find both <code>lookupMin</code> and <code>lookupMax</code> unidiomatic, because they say to me as a reader \"get me the min/max element (if any) from the set\", whereas our intention is more \"get me an arbitrary element (if any) from the set\". This intention-reading is fundamentally complicated by the fact that a <code>Set</code> isn't really the right type of 0-or-1-<code>a</code>s, indeed that's a <code>Maybe</code>.</p>\n\n<p>AJFarmer suggests <code>head :: (Foldable f) =&gt; f a -&gt; Maybe a</code> which I agree is a good name &amp; type, but it's from an alternative prelude (protolude). You can easily implement it yourself, <code>listToMaybe . toList</code> is all from base libraries, though then you'll have to find a name for it. </p>\n\n<p>Lenses provide another solution, <code>(^? _Wrapped . _head)</code>.</p>\n\n<p>If our intention reads better as \"check if it's a singleton, and if so, extract the element\" then we can maybe do better, though.</p>\n\n<pre><code>fromSingleton :: Set a -&gt; Maybe a\nfromSingleton s = case toList s of\n    [a] -&gt; Just a\n    _ -&gt; Nothing\n</code></pre>\n\n<p>Or perhaps,</p>\n\n<pre><code>fromSingleton :: Set a -&gt; Maybe a\nfromSingleton (toList -&gt; [x]) = Just x\nfromSingleton _ = Nothing\n</code></pre>\n\n<p>As chi says, you can't pattern-match on <code>Set</code>, but if you wanted to you could set up pattern synonyms to do so eg.</p>\n\n<pre><code>pattern Empty &lt;- (Set.toList -&gt; [])\npattern Singleton x &lt;- (Set.toList -&gt; [x])\npattern Many xs &lt;- (Set.toList -&gt; xs@(_:_:_))\n\nfromSingleton :: Set a -&gt; Maybe a\nfromSingleton (Singleton x) = Just x\nfromSingleton _ = Nothing\n</code></pre>\n\n<p>This is probably overkill if all you need is the one function though.</p>\n"}], "owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 1, "accepted_answer_id": 56155735, "answer_count": 1, "score": 0, "last_activity_date": 1557945455, "creation_date": 1557935436, "question_id": 56153286, "link": "https://stackoverflow.com/questions/56153286/how-can-i-extract-element-from-set-with-zero-or-one-element-in-haskell", "title": "How can I extract element from Set with zero or one element in Haskell?", "body": "<p><strong>Problem:</strong></p>\n\n<p>Let's say we have a <code>Set</code>  of <code>a</code> with zero or one element.\nAnd we need to get this element if it exists.</p>\n\n<p>I have searched for function <code>Set a -&gt; Maybe a</code> on hoogle and I found the following functions:</p>\n\n<p><code>lookupMin :: Set a -&gt; Maybe a</code></p>\n\n<p>and</p>\n\n<p><code>lookupMax :: Set a -&gt; Maybe a</code></p>\n\n<p><strong>Question:</strong></p>\n\n<p>What is the idiomatic way to get <code>a</code> in this case?</p>\n\n<p>Should I use pattern matching or one of these functions?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557933343, "post_id": 56152612, "comment_id": 98934704, "body": "For the latter you need to append with a <i>list</i>, not a (scalar) number."}, {"owner": {"reputation": 118, "user_id": 10069637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IAJWx.png?s=128&g=1", "display_name": "A beginner", "link": "https://stackoverflow.com/users/10069637/a-beginner"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557933432, "post_id": 56152612, "comment_id": 98934759, "body": "like array ++ [5] ?"}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 1, "creation_date": 1557933823, "post_id": 56152612, "comment_id": 98934999, "body": "yes, like <code>++ [5]</code>"}, {"owner": {"reputation": 118, "user_id": 10069637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IAJWx.png?s=128&g=1", "display_name": "A beginner", "link": "https://stackoverflow.com/users/10069637/a-beginner"}, "edited": false, "score": 0, "creation_date": 1557933879, "post_id": 56152612, "comment_id": 98935044, "body": "look edit ... that works with ghci but i don&#39;t now how to implement that in code"}, {"owner": {"reputation": 118, "user_id": 10069637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IAJWx.png?s=128&g=1", "display_name": "A beginner", "link": "https://stackoverflow.com/users/10069637/a-beginner"}, "edited": false, "score": 0, "creation_date": 1557934167, "post_id": 56152612, "comment_id": 98935221, "body": "ok for the ones who will need help I found (but don&#39;t know if that&#39;s the most optimize)  For array[2] = 4      in Haskell ----&gt;      let array !! 2 = 4"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 5, "creation_date": 1557934367, "post_id": 56152612, "comment_id": 98935332, "body": "<b>immutable</b> is the concept you need to internalize"}, {"owner": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "edited": false, "score": 0, "creation_date": 1557934377, "post_id": 56152612, "comment_id": 98935337, "body": "That <code>let</code> thing overwrites the (!!) operator."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557935815, "post_id": 56152612, "comment_id": 98936174, "body": "Looking at your program, it seems you are trying to change the value of <code>redPoint</code>. Haskell was designed to prevent the mutation of values. If you let <code>x = 3</code>, then any <code>print x</code> in the program will mean <code>print 3</code>, since there is no way to change the value bound to <code>x</code>. Similarly, if <code>redPoint</code> is defined as a given list, <code>print redPoint</code> will always print that list -- there is no way to change that value. In Haskell, you can only create <i>new</i> values out of old ones, but you can not overwrite old values."}, {"owner": {"reputation": 118, "user_id": 10069637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IAJWx.png?s=128&g=1", "display_name": "A beginner", "link": "https://stackoverflow.com/users/10069637/a-beginner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1557937425, "post_id": 56152612, "comment_id": 98936954, "body": "So there is no way to change a value of a list @chi ? I have to create an other one ?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1557937757, "post_id": 56152612, "comment_id": 98937103, "body": "Exactly. The function <code>replaceAt</code> below won&#39;t change the existing list, but will create and return a new list, equal to the previous one, with a different element. Luckily, in Haskell we don&#39;t need arrays as much as we do in imperative languages, so this is not a real issue. In those cases where we really need arrays, we have libraries for those (<code>Array</code>, <code>Vector</code>, ...) and ways to recover performance and simulate mutation (e.g. <code>IO</code> and <code>STs</code> monads), but these should be considered advanced topics -- if you are a beginner, learn the basics of the language first, using a tutorial like LYAH."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 1, "creation_date": 1557942302, "post_id": 56152612, "comment_id": 98939159, "body": "I count two questions. Ask one at a time."}], "answers": [{"comments": [{"owner": {"reputation": 118, "user_id": 10069637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IAJWx.png?s=128&g=1", "display_name": "A beginner", "link": "https://stackoverflow.com/users/10069637/a-beginner"}, "edited": false, "score": 0, "creation_date": 1557934926, "post_id": 56153050, "comment_id": 98935648, "body": "I have this error : Couldn&#39;t match type \u2018[]\u2019 with \u2018IO\u2019       Expected type: IO Integer         Actual type: [Integer]  I really don&#39;t understand why that&#39;s not working (sorry i am a beginner)"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "reply_to_user": {"reputation": 118, "user_id": 10069637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IAJWx.png?s=128&g=1", "display_name": "A beginner", "link": "https://stackoverflow.com/users/10069637/a-beginner"}, "edited": false, "score": 0, "creation_date": 1557935035, "post_id": 56153050, "comment_id": 98935722, "body": "copy/pasted to Prelude and got this error?  Not sure where the <code>IO</code> is coming from?"}, {"owner": {"reputation": 118, "user_id": 10069637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IAJWx.png?s=128&g=1", "display_name": "A beginner", "link": "https://stackoverflow.com/users/10069637/a-beginner"}, "edited": false, "score": 0, "creation_date": 1557935096, "post_id": 56153050, "comment_id": 98935755, "body": "i have only this line : import System.IO with IO   I can show you the code (it&#39;s short and simple)"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "reply_to_user": {"reputation": 118, "user_id": 10069637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IAJWx.png?s=128&g=1", "display_name": "A beginner", "link": "https://stackoverflow.com/users/10069637/a-beginner"}, "edited": false, "score": 1, "creation_date": 1557935183, "post_id": 56153050, "comment_id": 98935807, "body": "No explicit import is needed to run this code in Prelude.  IO will complicate things for you at this stage."}, {"owner": {"reputation": 118, "user_id": 10069637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IAJWx.png?s=128&g=1", "display_name": "A beginner", "link": "https://stackoverflow.com/users/10069637/a-beginner"}, "edited": false, "score": 0, "creation_date": 1557935431, "post_id": 56153050, "comment_id": 98935939, "body": "I edit the post with all the code (all is working : the code is reading a file (that&#39;s working) and it modify a global list)"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "reply_to_user": {"reputation": 118, "user_id": 10069637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IAJWx.png?s=128&g=1", "display_name": "A beginner", "link": "https://stackoverflow.com/users/10069637/a-beginner"}, "edited": false, "score": 3, "creation_date": 1557935928, "post_id": 56153050, "comment_id": 98936234, "body": "<i>&quot;it modifies a global list&quot;</i> is the <b>big</b> misconception.  There is no list modification, the function will return you another list.  I think you&#39;re trying to jump before you can walk.  Take your time to internalize fundamentals before writing full programs."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 4, "last_activity_date": 1557934552, "creation_date": 1557934552, "answer_id": 56153050, "question_id": 56152612, "link": "https://stackoverflow.com/questions/56152612/replace-element-in-list/56153050#56153050", "title": "Replace element in list", "body": "<p>you don't do mutation on the list but create a new list from the given list.</p>\n\n<p>an example, without any error handling...</p>\n\n<pre><code>&gt; replaceAt x y = map (\\(i,v) -&gt; if (i==x) then y else v) . zip [1..]\n&gt; replaceAt 3 10 [1..5]\n\n[1,2,10,4,5]\n</code></pre>\n\n<p>create an indexed list by zipping with the counting numbers, write a map function to change the value at the desired index.</p>\n"}, {"tags": [], "owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "is_accepted": false, "score": 1, "last_activity_date": 1557935588, "creation_date": 1557935588, "answer_id": 56153321, "question_id": 56152612, "link": "https://stackoverflow.com/questions/56152612/replace-element-in-list/56153321#56153321", "title": "Replace element in list", "body": "<p>Lens! (Maybe it is overhead but anyway)</p>\n\n<pre><code>_drop 0 = id\n_drop n = _tail . _drop (n - 1)\n</code></pre>\n\n<p>And use case</p>\n\n<pre><code>[1..5] &amp; _drop 1 %~ (5:) -- [1,5,2,3,4]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 356, "user_id": 536342, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f354d52ac79638d5bc6b967981ef9945?s=128&d=identicon&r=PG", "display_name": "pikapika", "link": "https://stackoverflow.com/users/536342/pikapika"}, "is_accepted": false, "score": 0, "last_activity_date": 1557998823, "creation_date": 1557998823, "answer_id": 56165231, "question_id": 56152612, "link": "https://stackoverflow.com/questions/56152612/replace-element-in-list/56165231#56165231", "title": "Replace element in list", "body": "<p>Using lens</p>\n\n<pre><code>&gt; import Control.Lens\n\nControl.Lens&gt; [1..5] &amp; (ix 1) .~ 5\n[1,5,3,4,5]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1058, "user_id": 514723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cda2cf2c56094de269a607dd0b3e1662?s=128&d=identicon&r=PG", "display_name": "Zouppen", "link": "https://stackoverflow.com/users/514723/zouppen"}, "is_accepted": false, "score": 0, "last_activity_date": 1558003454, "creation_date": 1558003454, "answer_id": 56166717, "question_id": 56152612, "link": "https://stackoverflow.com/questions/56152612/replace-element-in-list/56166717#56166717", "title": "Replace element in list", "body": "<p>First of all, please ask only one question in a single post.</p>\n\n<p>Here is an implementation which doesn't use Lens and more suitable for a beginner. The <code>replaceAt</code> function error handling needs some brain work. Without error handling it could be fitted in a single line.</p>\n\n<p>These functions work on infinite lists, too. Execution time of <code>replaceAt</code> depends of <em>i</em>. Replacing element in the end of the list is slower than in the beginning because of the recursive nature of Haskell's lists.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>module ListOperations where\n\nreplaceAt :: Int -&gt; a -&gt; [a] -&gt; [a]\nreplaceAt i x xs = case (i&lt;0, splitAt i xs) of\n  (False,(start,(_:end))) -&gt; start ++ (x:end)\n  _                       -&gt; error \"Index out of bounds\"\n\nappend :: a -&gt; [a] -&gt; [a]\nappend x xs = xs ++ [x]\n</code></pre>\n"}], "owner": {"reputation": 118, "user_id": 10069637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IAJWx.png?s=128&g=1", "display_name": "A beginner", "link": "https://stackoverflow.com/users/10069637/a-beginner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "answer_count": 4, "score": -2, "last_activity_date": 1558003454, "creation_date": 1557933143, "last_edit_date": 1557935384, "question_id": 56152612, "link": "https://stackoverflow.com/questions/56152612/replace-element-in-list", "title": "Replace element in list", "body": "<p>I have a simple question about list in haskell. (I am a beginner in haskell)</p>\n\n<p>I would know how can i replace an element in an array but as simple as possible.</p>\n\n<pre><code>[1, 2, 4, 4, 5]\n</code></pre>\n\n<p>to</p>\n\n<pre><code>[1, 2, 3, 4, 5]\n</code></pre>\n\n<p>And also how can i happend a number to a list</p>\n\n<pre><code>[1, 2, 3, 4]\n</code></pre>\n\n<p>to</p>\n\n<pre><code>[1, 2, 3, 4, 5]\n</code></pre>\n\n<p>I have already read that tutorial : <a href=\"http://learnyouahaskell.com/starting-out\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/starting-out</a></p>\n\n<p>I was thinking about this for the first problem :</p>\n\n<pre><code>array = [1, 2, 4, 4, 5]\narray[2] = 2\n</code></pre>\n\n<p>and that for the second :</p>\n\n<pre><code>array = [1, 2, 3, 4]\narray ++ [5]\n</code></pre>\n\n<p>Ps : the <code>array ++ [5]</code> works with ghci but when i do like that in code :</p>\n\n<pre><code>array = [1, 2, 3, 4]\n\nmodifyarray = do\nprint $ array !! 2\narray ++ [5]\nprint $ array !! 4\n</code></pre>\n\n<p>that doesn't work ...</p>\n\n<p>EDIT : </p>\n\n<pre><code>module Main where\n\nimport Lib\nimport System.Environment\nimport System.Exit\n\nredPoint = [3,4,2]\n\nfillArray file x = do\n    let line = lines file\n    print $ line\n\nreplaceAt x y = map (\\(i,v) -&gt; if (i==x) then y else v) . zip [1..]\n\nreplaceArray = do\n    print $ redPoint !! 2\n    replaceAt 2 9 redPoint\n    print $ redPoint !! 2\n\nopenfile a n path = do\n    file &lt;- readFile path\n    fillArray file 0\n    replaceArray\n\nexit = exitWith ExitSuccess\nerror_exit = exitWith (ExitFailure 84)\n\nparse [a, n, path] = openfile a n path &gt;&gt; exit\nparse [] = error_exit\n\nmain = do\n    getArgs &gt;&gt;= parse\n</code></pre>\n\n<p>This error : </p>\n\n<blockquote>\n  <p>Couldn't match type \u2018[]\u2019 with \u2018IO\u2019\n        Expected type: IO Integer\n          Actual type: [Integer]\n      \u2022 In a stmt of a 'do' block: replaceAt 2 9 redPoint\n        In the expression:\n          do print $ redPoint !! 2\n             replaceAt 2 9 redPoint\n             print $ redPoint !! 2\n        In an equation for \u2018replaceArray\u2019:\n            replaceArray\n              = do print $ redPoint !! 2\n                   replaceAt 2 9 redPoint\n                   print $ redPoint !! 2</p>\n</blockquote>\n"}, {"tags": ["haskell", "typeclass", "type-parameter"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557903933, "post_id": 56143399, "comment_id": 98916918, "body": "The type signature of <code>fmap</code> (in <code>Functor</code> is <code>fmap :: (a -&gt; b) -&gt; f a -&gt; f b</code>, so here we apply <code>a</code> to the type constructor <code>A</code>, given that we would make <code>A Int</code> a functor, how should we hande <code>f a</code> (so <code>A Int a</code>)?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1557904051, "post_id": 56143399, "comment_id": 98916966, "body": "The type parameter is thus not &quot;neglected&quot;, Here <code>f</code> is basically a function that takes a type and constructs a new type."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557904502, "post_id": 56143399, "comment_id": 98917176, "body": "When using <code>instance Functor A where</code> its like we partially apply <code>A</code> ? and we supply the type when we call <code>fmap</code> ? (Not sure if i understood)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557904633, "post_id": 56143399, "comment_id": 98917240, "body": "@BercoviciAdrain: exactly, <code>f</code> is a &quot;function&quot; that transforms a type (like <code>Int</code>) into a type <code>A Int</code>."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557904982, "post_id": 56143399, "comment_id": 98917393, "body": "But then it means that if we specify in the instance <code>A [something]</code> and we call <code>fmap A [something_else]</code> it crashes . Does it mean that in the instance implementation we can <code>fill</code> any <code>type</code> parameter or let it free: Ex:  <code>instance T a b c where</code> , <code>instance T Int b c </code> ,<code>instance T Int b Int </code>..etc?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557905197, "post_id": 56143399, "comment_id": 98917512, "body": "we just pass a function that constructs a type. The type class itself can then &quot;construct types&quot;. For example it could have done something like <code>otherfmap :: (Int -&gt; String) -&gt; f Int -&gt; f String</code>, so the parameter is not per se free, but for <code>Functor</code>, yes it is free."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557905243, "post_id": 56143399, "comment_id": 98917547, "body": "By function you mean the type constructor ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1557905292, "post_id": 56143399, "comment_id": 98917574, "body": "yes, but well a type constructor is a function on the &quot;type level&quot;, just like a data constructor is a function on the &quot;instance level&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 7, "last_activity_date": 1557905312, "creation_date": 1557905312, "answer_id": 56143786, "question_id": 56143399, "link": "https://stackoverflow.com/questions/56143399/why-does-parametrized-type-instance-works-without-specifying-type-parameter/56143786#56143786", "title": "Why does parametrized type instance works without specifying type parameter", "body": "<blockquote>\n  <p>When should you neglect the type parameter?</p>\n</blockquote>\n\n<p>The type parameter is not \"<em>neglected</em>\". Let us first take a look at the <code>Functor</code> type class:</p>\n\n<pre><code>class Functor f where\n    fmap :: (a -&gt; b) -&gt; <b>f a</b> -&gt; <b>f b</b></code></pre>\n\n<p>Notice the <code>f a</code> and <code>f b</code> in the type signature. We thus here \"construct types\" for the type signature of <code>fmap</code>.</p>\n\n<p>Here <code>f</code> is thus basically a function that takes a type and transforms it into a type.  For example if <code>f ~ A</code> if <code>a ~ Int</code>, then <code>f a</code> generates the <code>A Int</code> type.</p>\n\n<p><a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids#the-newtype-keyword\" rel=\"noreferrer\"><em>Learn You a Haskell for the Greater Good!</em></a> actually explains this in its chapter about <em>Functors, Applicatives and Monoids</em>:</p>\n\n<blockquote>\n  <p>Many times, we want to make our types instances of certain type\n  classes, but the type parameters just don't match up for what we want\n  to do. It's easy to <strong>make <code>Maybe</code> an instance of <code>Functor</code></strong>, because\n  the <code>Functor</code> type class is defined like this:</p>\n\n<pre><code>class Functor f where  \n    fmap :: (a -&gt; b) -&gt; f a -&gt; f b \n</code></pre>\n  \n  <p>So we just start out with:</p>\n\n<pre><code>  instance Functor Maybe where\n</code></pre>\n  \n  <p>And then implement <code>fmap</code>. All the type parameters add up because the <code>Maybe</code> takes the place of <code>f</code> in\n  the definition of the <code>Functor</code> type class and so if we look at <code>fmap</code>\n  like it only worked on <code>Maybe</code>, it ends up behaving like:</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\n</code></pre>\n  \n  <p>(...)</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 11, "last_activity_date": 1557926621, "last_edit_date": 1557926621, "creation_date": 1557910079, "answer_id": 56145130, "question_id": 56143399, "link": "https://stackoverflow.com/questions/56143399/why-does-parametrized-type-instance-works-without-specifying-type-parameter/56145130#56145130", "title": "Why does parametrized type instance works without specifying type parameter", "body": "<blockquote>\n  <p><code>instance Functor A where</code> instead of <code>instance Functor (A a) where</code>.\n  Why does it work ?</p>\n</blockquote>\n\n<p>I find this easier to understand using GHC's kinding system. Let's start from a simple case, and experiment in GHCi:</p>\n\n<pre><code>&gt; :k Eq Int\nEq Int :: Constraint\n</code></pre>\n\n<p>This tells us that <code>Eq Int</code> is a constraint, some property that might be verified during type checking. Indeed, if we type check <code>(12 :: Int) == (42 :: Int)</code>, the compiler will verify that integers can be compared, resolving the constraint <code>Eq Int</code>.</p>\n\n<p>What is <code>Eq</code> alone, the name of the class without the <code>Int</code> parameter?</p>\n\n<pre><code>&gt; :k Eq\nEq :: * -&gt; Constraint\n</code></pre>\n\n<p>This tells us that <code>Eq</code> can be thought of a function from types (<code>*</code> is the kind of types) to constraint.</p>\n\n<p>Indeed, in <code>Eq Int</code>, <code>Int</code> is a type, so we have <code>Int :: *</code> making <code>Int</code> a well-kinded argument to pass to <code>Eq</code>.</p>\n\n<p>Enough of type classes, what about type constructors?</p>\n\n<pre><code>&gt; :k Maybe Int\nMaybe Int :: *\n</code></pre>\n\n<p>No surprise, <code>Maybe Int</code> is a type</p>\n\n<pre><code>&gt; :k Maybe\nMaybe :: * -&gt; *\n</code></pre>\n\n<p><code>Maybe</code> instead, is a function from types to types (<code>*-&gt;*</code>). This is indeed what the <code>Maybe</code> type constructor does: mapping a type (<code>Int</code>) to a type (<code>Maybe Int</code>).</p>\n\n<p>Back to the original question. Why can't we write <code>instance Functor (A a)</code> but we can instead write <code>instance Functor A</code>? Well, we have that</p>\n\n<pre><code>&gt; :k A Int\nA Int :: *\n&gt; :k A\nA :: * -&gt; *\n</code></pre>\n\n<p>and, most importantly,</p>\n\n<pre><code>&gt; :k Functor\nFunctor :: (* -&gt; *) -&gt; Constraint\n</code></pre>\n\n<p>This tells us the the kind of the <code>Functor</code> type class is not the same kind of the <code>Eq</code> type class. <code>Eq</code> expects a type as an argument, while <code>Functor</code> expects something of kind <code>(* -&gt; *)</code> as an argument. <code>A</code> fits that kind, while <code>A Int</code> does not.</p>\n\n<p>This happens when, in the definition of the class, the argument is applied to some other type. E.g.</p>\n\n<pre><code>class C1 a where\n   foo :: a -&gt; Bool\n</code></pre>\n\n<p>results in <code>C1 :: * -&gt; Constraint</code>. Instead,</p>\n\n<pre><code>class C2 f where\n   bar :: f Int -&gt; Bool\n</code></pre>\n\n<p>results in <code>C2 :: (* -&gt; *) -&gt; Constraint</code>, since <code>f</code> is not itself used as a type, <code>f Int</code> is, so <code>f</code> must be a parameterized type of kind <code>* -&gt; *</code>.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 1, "accepted_answer_id": 56145130, "answer_count": 2, "score": 9, "last_activity_date": 1557926621, "creation_date": 1557903685, "question_id": 56143399, "link": "https://stackoverflow.com/questions/56143399/why-does-parametrized-type-instance-works-without-specifying-type-parameter", "title": "Why does parametrized type instance works without specifying type parameter", "body": "<p>When having a parametrized type:\n<code>data A a=X a| Y</code></p>\n\n<p>I have tried (successfully) implementing <code>Functor</code> and <code>Applicative</code> without specifiying the type parameter:</p>\n\n<p><code>instance Functor A where</code> instead of <code>instance Functor (A a) where</code>.<br>Why does it work ? <br><br>Looking in <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"noreferrer\">LYAH</a> it seems all examples specify the type parameter in all their <code>typeclass instances</code>.\nWhen should you neglect the type parameter ?</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1557871680, "post_id": 56137144, "comment_id": 98909186, "body": "I think the root is <code>&#47;</code>, but it it named using the type <code>HomeR</code>, which is a resource. Or possibly the resource is the handler, which corresponds to a type-safe URL. I&#39;m not too sure though since T haven&#39;t found the distinction to be too important."}], "answers": [{"tags": [], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "is_accepted": true, "score": 1, "last_activity_date": 1558039601, "creation_date": 1558039601, "answer_id": 56176374, "question_id": 56137144, "link": "https://stackoverflow.com/questions/56137144/route-vs-resource/56176374#56176374", "title": "Route vs. Resource", "body": "<p>My understanding is based off <a href=\"https://www.yesodweb.com/book/routing-and-handlers\" rel=\"nofollow noreferrer\">this Yesod documentation page</a>.</p>\n\n<p>The route <code>/ HomeR GET</code> is made up of</p>\n\n<ol>\n<li>the resource pattern <code>/</code></li>\n<li>the resource name <code>HomeR</code></li>\n<li>the <code>GET</code> handler</li>\n</ol>\n\n<p>As far as I can tell, the resource name is unique to each route, so the documentation takes the shortcut of referring to \"the route with resource name <code>X</code>\" as \"the route <code>X</code>\".</p>\n\n<p>So the answer is: <code>HomeR</code> is a resource, and <code>HomeR</code> is the route with resource name <code>HomeR</code>. (Both, in other words).</p>\n"}], "owner": {"reputation": 719, "user_id": 540718, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/64bb401eff530b423eae58217f2b1362?s=128&d=identicon&r=PG", "display_name": "nemron", "link": "https://stackoverflow.com/users/540718/nemron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 56176374, "answer_count": 1, "score": 5, "last_activity_date": 1558039601, "creation_date": 1557861336, "question_id": 56137144, "link": "https://stackoverflow.com/questions/56137144/route-vs-resource", "title": "Route vs. Resource", "body": "<p>In the Yesod book it is state at Part I. Basics, Chapter 3. Basics, Section Routing (Second Edition):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>mkYesod \"HelloWorld\" [parseRoutes|\n/ HomeR GET\n|]\n</code></pre>\n\n<blockquote>\n  <p>In other words, the preceding code simply creates a route [...] called <code>HomeR</code>. [...]. We call <code>HomeR</code> a resource, which is where the R suffix comes from.</p>\n</blockquote>\n\n<p>This is just about wording, I know, but I would like to understand if <code>HomeR</code> is a <em>route</em> or a <em>resource</em>.\n(please don't say \"both\"). </p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557862802, "post_id": 56136947, "comment_id": 98906003, "body": "With the <code>approot</code> you specify exactly that, where your app is located, and thus what the root of an URL is. Typically one uses tooling like <code>nginx</code> to redirect correctly to the correct server."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1557922247, "post_id": 56136947, "comment_id": 98927373, "body": "One question at a time please."}, {"owner": {"reputation": 719, "user_id": 540718, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/64bb401eff530b423eae58217f2b1362?s=128&d=identicon&r=PG", "display_name": "nemron", "link": "https://stackoverflow.com/users/540718/nemron"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1559158753, "post_id": 56136947, "comment_id": 99337875, "body": "@WillemVanOnsem Just trying to get a Yesod &quot;Hello world&quot; (no scaffolding) running via nginx. Via nginx, I want <code>http:&#47;&#47;localhost</code> to give the &quot;Welcome to nginx&quot; site. Now <code>http:&#47;&#47;localhost&#47;foo</code> shall serve some other application (just static HTML pages) and <code>http:&#47;&#47;localhost&#47;bar</code> shall serve the Yesod &quot;Hello world&quot;. What value do I have to set for <code>approot</code>? Just <code>approot = ApprootStatic &quot;http:&#47;&#47;localhost:9000&quot;</code>? And what shall be the configuration for nginx?"}, {"owner": {"reputation": 719, "user_id": 540718, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/64bb401eff530b423eae58217f2b1362?s=128&d=identicon&r=PG", "display_name": "nemron", "link": "https://stackoverflow.com/users/540718/nemron"}, "edited": false, "score": 0, "creation_date": 1559291233, "post_id": 56136947, "comment_id": 99381692, "body": "Fyi, <a href=\"https://stackoverflow.com/questions/56391194/how-to-locally-run-a-yesod-web-app-via-nginx\" title=\"how to locally run a yesod web app via nginx\">stackoverflow.com/questions/56391194/&hellip;</a>"}], "owner": {"reputation": 719, "user_id": 540718, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/64bb401eff530b423eae58217f2b1362?s=128&d=identicon&r=PG", "display_name": "nemron", "link": "https://stackoverflow.com/users/540718/nemron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 164, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1557860511, "creation_date": 1557860511, "question_id": 56136947, "link": "https://stackoverflow.com/questions/56136947/use-of-approot", "title": "Use of &#39;approot&#39;", "body": "<p>If I set the <code>approot</code> like the following</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\nmodule Main where\n\nimport Yesod.Core\n\ndata Yello = Yello\n\nmkYesod \"Yello\" [parseRoutes|\n/home1 Home1R GET\n/home2 Home2R GET\n|]\n\ninstance Yesod Yello where\n    approot = ApprootStatic \"http://localhost:3000/v1\"\n\ngetHome1R :: Handler Html\ngetHome1R = defaultLayout [whamlet|Homepage 01|]\n\ngetHome2R :: Handler Html\ngetHome2R = defaultLayout [whamlet|&lt;a href=@{Home1R}&gt;Homepage 02|]\n\nmain :: IO ()\nmain = warp 3000 Yello\n</code></pre>\n\n<p>then <code>@{Home1R}</code> get's rendered to <code>http://localhost:3000/v1/home1</code> <strong>but</strong> this little yesod-based web application is only reachable at <code>http://localhost:3000</code> (w/o the <code>/v1</code>).</p>\n\n<ol>\n<li>What's the purpose of <code>approot</code>?</li>\n<li>Where to set/ add <code>/v1</code>?</li>\n</ol>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1557852233, "post_id": 56134904, "comment_id": 98901077, "body": "One question at a time please."}, {"owner": {"reputation": 117, "user_id": 11127765, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71568a4586fd4c86cc3a92caf421a91d?s=128&d=identicon&r=PG&f=1", "display_name": "mennetorelli", "link": "https://stackoverflow.com/users/11127765/mennetorelli"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1557852500, "post_id": 56134904, "comment_id": 98901185, "body": "Ok sorry, I&#39;ll delete the first one"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1557856865, "post_id": 56134904, "comment_id": 98903244, "body": "Minor point: <code>word &lt;- takeWhileCE isAlphaNum</code> makes <code>word</code> to be <code>()</code>. The taken word is pushed downstream, not returned. This should not be an issue, anyway."}], "answers": [{"tags": [], "owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "is_accepted": true, "score": 2, "last_activity_date": 1557928762, "last_edit_date": 1557928762, "creation_date": 1557908774, "answer_id": 56144749, "question_id": 56134904, "link": "https://stackoverflow.com/questions/56134904/conduit-pipeline-skips-some-elements-of-a-stream/56144749#56144749", "title": "Conduit pipeline skips some elements of a stream", "body": "\n\n<p>chi correctly <a href=\"https://stackoverflow.com/questions/56134904/conduit-pipeline-skips-some-elements-of-a-stream#comment98903244_56134904\">commented</a> that <a href=\"http://hackage.haskell.org/package/conduit-1.3.1.1/docs/Conduit.html#v:takeWhileCE\" rel=\"nofollow noreferrer\"><code>takeWhileCE</code></a> returns <code>()</code> and sends the result downstream instead of returning it.  They\u2019re wrong about one thing, though: this <em>is</em>, in fact, the issue.</p>\n\n<p>Your conduit operates on a stream of chunks, and one of the reasons why <code>takeWhileCE</code> sends the result downstream is so it can leave the input split on the original chunk boundaries.  That way it doesn\u2019t force you to consume unbounded memory just because you might receive a long sequence of matching values.</p>\n\n<p>But if you want to combine the potentially multiple chunks that make up each word, you need to do a bit more work.  Sending them through <a href=\"http://hackage.haskell.org/package/conduit-1.3.1.1/docs/Conduit.html#v:foldC\" rel=\"nofollow noreferrer\"><code>foldC</code></a> is one way to do so.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>        .| peekForeverE (do\n            word &lt;- takeWhileCE isAlphaNum .| foldC\n            dropCE 1\n            yield word)\n</code></pre>\n\n<p>In your case, it\u2019s easier to use the <a href=\"http://hackage.haskell.org/package/conduit-1.3.1.1/docs/Data-Conduit-Combinators.html#v:splitOnUnboundedE\" rel=\"nofollow noreferrer\"><code>splitOnUnboundedE</code></a> combinator which does that all for you.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>        .| splitOnUnboundedE (not . isAlphaNum)\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 11127765, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71568a4586fd4c86cc3a92caf421a91d?s=128&d=identicon&r=PG&f=1", "display_name": "mennetorelli", "link": "https://stackoverflow.com/users/11127765/mennetorelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 56144749, "answer_count": 1, "score": 3, "last_activity_date": 1557928762, "creation_date": 1557851617, "last_edit_date": 1557870555, "question_id": 56134904, "link": "https://stackoverflow.com/questions/56134904/conduit-pipeline-skips-some-elements-of-a-stream", "title": "Conduit pipeline skips some elements of a stream", "body": "<p>I tried to implement a simple wordcount with Haskell's Conduit library:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>wordcountCv2 :: IO ()\nwordcountCv2 = do \n    hashMap &lt;- runConduitRes $ sourceFile \"input.txt\"\n        .| decodeUtf8C\n        .| omapCE Data.Char.toLower\n        .| peekForeverE (do\n            word &lt;- takeWhileCE isAlphaNum\n            dropCE 1\n            return word)\n        .| foldMC insertInHashMap empty\n    print (toList hashMap)\n\ninsertInHashMap x v = do\n    return (insertWith (+) v 1 x)\n</code></pre>\n\n<p>The problem is that this function works fine with small/medium input files, but as the file size grows, it tends to break some of the words. For instance, if I use a small file containing 100 times the word \"hello\", the result is: [(\"hello\",100)], instead if the hellos are for instance 100000 the result is: [(\"hello\",99988),(\"he\",6),(\"hell\",6),(\"o\",6),(\"llo\",6)]. The more the file grows, the more there are broken words. Is there something wrong in my implementation?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1557844365, "post_id": 56132696, "comment_id": 98896704, "body": "An oddity: on my machine, this program takes only 2Gb (2.7Gb without optimizations). I wonder why! (It is definitely a 64-bit machine; I can confirm that <code>Int</code> can indeed store 2^63-1 faithfully.)"}, {"owner": {"reputation": 182, "user_id": 6451746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20ee45c8d2bcbd00b52a8063711d0888?s=128&d=identicon&r=PG&f=1", "display_name": "mentoc3000", "link": "https://stackoverflow.com/users/6451746/mentoc3000"}, "edited": false, "score": 1, "creation_date": 1557845453, "post_id": 56132696, "comment_id": 98897442, "body": "But shouldn&#39;t the lazy evaluation only require the value of the element of collatzLength to be computed when it&#39;s value is needed? The highest number may be 27114424, but 27114423 should never be constructed."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 182, "user_id": 6451746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20ee45c8d2bcbd00b52a8063711d0888?s=128&d=identicon&r=PG&f=1", "display_name": "mentoc3000", "link": "https://stackoverflow.com/users/6451746/mentoc3000"}, "edited": false, "score": 5, "creation_date": 1557847818, "post_id": 56132696, "comment_id": 98898874, "body": "@mentoc3000 Certainly. But you still need to build the spine of the list -- and although you may not need to store both the <code>I#</code> and the contained number for elements you don&#39;t demand, you&#39;ll have to store a thunk saying how to compute that number if it&#39;s demanded later, and I doubt that thunk will take less space than the <code>Int</code> itself would."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 182, "user_id": 6451746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20ee45c8d2bcbd00b52a8063711d0888?s=128&d=identicon&r=PG&f=1", "display_name": "mentoc3000", "link": "https://stackoverflow.com/users/6451746/mentoc3000"}, "edited": false, "score": 4, "creation_date": 1557886325, "post_id": 56132696, "comment_id": 98912052, "body": "@mentoc3000 If you use a <a href=\"http://hackage.haskell.org/package/data-inttrie\" rel=\"nofollow noreferrer\">trie</a> instead of a list as your memoization structure, you should see a vast improvement."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1557905494, "post_id": 56132696, "comment_id": 98917686, "body": "@DanielWagner about your &quot;space oddity&quot;.. I don&#39;t know much about ghc internals but when an int thunk is evaluated can&#39;t the result fit where the thunk used to be?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1557923977, "post_id": 56132696, "comment_id": 98928481, "body": "@luqui Sure. But the space it uses on my machine is <i>less</i> than what it would take to store all the <code>Int</code>s and no (presumably larger) thunks!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 9, "last_activity_date": 1557844249, "last_edit_date": 1557844249, "creation_date": 1557843772, "answer_id": 56132696, "question_id": 56132019, "link": "https://stackoverflow.com/questions/56132019/why-does-memoized-function-consume-so-much-memory-in-haskell/56132696#56132696", "title": "Why does memoized function consume so much memory in Haskell?", "body": "<p>One of the things that makes the Collatz sequence so fun is that there are some small starting seeds that take you way, way out into the atmosphere on their way to 1. In particular, 9663 makes it all the way out to 27114424 before it collapses -- and that's a long memoization list to build!</p>\n\n<p>And, for what it's worth, I expect your memoization list to use three machine words per element: one for the <code>I#</code> constructor on the <code>Int</code>, one for the contained number, and one for the <code>(:)</code> constructor. Let's ask how much space it would take to store 27114424 elements, then:</p>\n\n<pre><code>&gt; 27114424 * (64*3) / 1024 {-Kb-} / 1024 {-Mb-} / 1024 {-Gb-}\n4.8484368324279785\n</code></pre>\n\n<p>So 4.5Gb sounds about right, perhaps even a little low.</p>\n"}], "owner": {"reputation": 182, "user_id": 6451746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20ee45c8d2bcbd00b52a8063711d0888?s=128&d=identicon&r=PG&f=1", "display_name": "mentoc3000", "link": "https://stackoverflow.com/users/6451746/mentoc3000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 56132696, "answer_count": 1, "score": 8, "last_activity_date": 1557844249, "creation_date": 1557841616, "question_id": 56132019, "link": "https://stackoverflow.com/questions/56132019/why-does-memoized-function-consume-so-much-memory-in-haskell", "title": "Why does memoized function consume so much memory in Haskell?", "body": "<p>I wrote a piece of Haskell code to calculate the length of a <a href=\"https://en.wikipedia.org/wiki/Collatz_conjecture\" rel=\"noreferrer\">Collatz chain</a>. Given a number n, the next number in the sequence is n/2 if n is even or 3*n+1 if n is odd. The sequence ends when it has converged to 1. I wanted to find the length of the longest chain when starting from any number below some input number.</p>\n\n<p>I tried implementing the length calculation with a memoized function since I expected to need the length of chains starting from some numbers. Thus, the length of the chain starting from 726 would be just 1 + the length of the chain starting from 363, which would already have been calculated. My code is shown below.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>collatz :: Int -&gt; Int\ncollatz n\n    | even n = n `div` 2\n    | otherwise = 3 * n + 1\n\ncollatzLength :: Int -&gt; Int\ncollatzLength = (fmap len [0 ..] !!)\n    where len 0 = 0\n          len 1 = 1\n          len n = 1 + (collatzLength . collatz $ n)\n\nmaxLengthBelow :: Int -&gt; Int\nmaxLengthBelow = foldl1 max . fmap collatzLength . enumFromTo 1\n\nmain :: IO()\nmain = print $ maxLengthBelow 10000\n</code></pre>\n\n<p>This code works, but takes a huge amount of memory. When profiling it, running <code>main</code> with the input of 10000, <code>len</code> is only called 21664 times, as expected, but the program takes 16 seconds and 4.5Gb of memory! What is taking up all that memory? I would have expected the memoized function to produce a fast, low-memory solution.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557844351, "post_id": 56131874, "comment_id": 98896692, "body": "Have you tried streaming it? Ie. does the Python version copy them over one by one or (like your Haskell version) read them all into memory first? (I think)"}, {"owner": {"reputation": 608, "user_id": 4417894, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/b167616728ad1b28658665b14863fc99?s=128&d=identicon&r=PG&f=1", "display_name": "emg184", "link": "https://stackoverflow.com/users/4417894/emg184"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557844743, "post_id": 56131874, "comment_id": 98896961, "body": "I havent tried streaming it yet i will test that approach out. The python version takes the same approach i return an array of tuples and the insert the tuples using the same sql statement as i do above."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1557854683, "post_id": 56131874, "comment_id": 98902231, "body": "FYI, your <code>extractPumpsFromDatabase</code> and <code>addPumpsToDatabase</code> functions seem pretty suspect; Why not just take a connection as a parameter instead of opening and closing the same database connection multiple times?"}, {"owner": {"reputation": 608, "user_id": 4417894, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/b167616728ad1b28658665b14863fc99?s=128&d=identicon&r=PG&f=1", "display_name": "emg184", "link": "https://stackoverflow.com/users/4417894/emg184"}, "edited": false, "score": 0, "creation_date": 1557863265, "post_id": 56131874, "comment_id": 98906219, "body": "I am only opening the connection in <code>extractPumpsFromDatabase</code> one time during the execution of the program i see though that for <code>addPumpsToDatabase</code> i should just pass the Connection from the original open function."}], "answers": [{"comments": [{"owner": {"reputation": 608, "user_id": 4417894, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/b167616728ad1b28658665b14863fc99?s=128&d=identicon&r=PG&f=1", "display_name": "emg184", "link": "https://stackoverflow.com/users/4417894/emg184"}, "edited": false, "score": 0, "creation_date": 1557846628, "post_id": 56133444, "comment_id": 98898192, "body": "Well that solved the issue. Thanks for the help i didn&#39;t realize that was how sqlite3 handled it with python."}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 4, "last_activity_date": 1557856886, "last_edit_date": 1557856886, "creation_date": 1557846079, "answer_id": 56133444, "question_id": 56131874, "link": "https://stackoverflow.com/questions/56131874/efficient-way-to-bulk-transfer-data-from-one-sqlite-database-to-another-with-has/56133444#56133444", "title": "Efficient way to bulk transfer data from one sqlite database to another with haskell", "body": "<p>At a glance: You're not using a transaction. The python sqlite library does (to my annoyance) automatic transaction management, but in your case it's probably what's causing the main part of the speed difference. Try this instead:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  conn &lt;- open \"databaseA.db\"\n  execute_ conn \"CREATE TABLE IF NOT EXISTS micropumps (id INTEGER PRIMARY KEY, micropump_id INTEGER, test_id INTEGER, data TEXT, cycle INTEGER, dispense TEXT, timestamp TIMESTAMP)\"\n  close conn\n  newPumps &lt;- extractPumpsFromDatabase \"databaseB\"\n  withTransaction conn $ \n    addPumpsToDatabase\n      \"databaseA\"\n      \"INSERT INTO micropumps (id, micropump_id, test_id, data, cycle, dispense, timestamp) VALUES (?,?,?,?,?,?,?)\"\n      newPumps\n</code></pre>\n\n<p><em>Edit</em>: Note that in the above case I'm using <code>conn</code> which you've already closed. You really shouldn't be doing that, just keep the connection open and pass it to <code>addPumpsToDatabase</code> as a parameter.</p>\n"}], "owner": {"reputation": 608, "user_id": 4417894, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/b167616728ad1b28658665b14863fc99?s=128&d=identicon&r=PG&f=1", "display_name": "emg184", "link": "https://stackoverflow.com/users/4417894/emg184"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 56133444, "answer_count": 1, "score": 1, "last_activity_date": 1557856886, "creation_date": 1557841144, "question_id": 56131874, "link": "https://stackoverflow.com/questions/56131874/efficient-way-to-bulk-transfer-data-from-one-sqlite-database-to-another-with-has", "title": "Efficient way to bulk transfer data from one sqlite database to another with haskell", "body": "<p>I want to move data from one database a to another database b using haskell. I was wondering what the most efficient method of doing this might be for bulk inserts. I have the following code which works but is incredibly slow in comparison to the python code that i write using the same query. Below is the code that i am currently using:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DeriveGeneric #-}\n\nimport           Control.Applicative\nimport qualified Data.Text as T\nimport           Database.SQLite.Simple\nimport           Database.SQLite.Simple.FromRow\nimport qualified Data.Time.Clock as CLK\nimport           Control.Monad.IO.Class (liftIO)\n\ntype DatabaseName = String\n\ndata Pump = Pump \n  { rId :: Int\n  , micropump_id :: Int\n  , test_id :: Int \n  , signature :: T.Text\n  , cycle :: Int\n  , dispense :: T.Text\n  , timestamp :: CLK.UTCTime\n  } deriving (Eq, Show)\n\ninstance ToRow Pump where\n  toRow (Pump a b c d e f g) = toRow (a,b,c,d,e,f,g) \n\ninstance FromRow Pump where\n  fromRow = Pump &lt;$&gt; field &lt;*&gt; field &lt;*&gt; field &lt;*&gt; field &lt;*&gt; field &lt;*&gt; field &lt;*&gt; field\n\n\nextractPumpsFromDatabase :: DatabaseName -&gt; Query -&gt; IO [Pump]\nextractPumpsFromDatabase n q = do\n  conn &lt;- open n\n  r &lt;- query_ conn (q) :: IO [Pump]\n  close conn\n  return r\n\naddPumpsToDatabase :: (ToRow r) =&gt; DatabaseName -&gt; Query -&gt; [r] -&gt; IO ()\naddPumpsToDatabase n q r = do\n  conn &lt;- open n\n  executeMany conn q r\n  putStrLn (\"Done: \" ++ n) \n\nmain :: IO ()\nmain = do\n  conn &lt;- open \"databaseA.db\"\n  execute_ conn \"CREATE TABLE IF NOT EXISTS micropumps (id INTEGER PRIMARY KEY, micropump_id INTEGER, test_id INTEGER, data TEXT, cycle INTEGER, dispense TEXT, timestamp TIMESTAMP)\"\n  close conn\n  newPumps &lt;- extractPumpsFromDatabase \"databaseB\"\n  addPumpsToDatabase \"databaseA\" \"INSERT INTO micropumps (id, micropump_id, test_id, data, cycle, dispense, timestamp) VALUES (?,?,?,?,?,?,?)\" newPumps\n</code></pre>\n\n<p>is it the conversion to and from the Pump type that is taking so long?</p>\n"}, {"tags": ["haskell", "typeclass", "functor", "contravariant"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1557834060, "post_id": 56129585, "comment_id": 98890314, "body": "Note that most (i.e. all &#39;nontrivial&#39;) functors are not contravariant."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1557834134, "post_id": 56129585, "comment_id": 98890359, "body": "@AJFarmar Yeah, it&#39;s not that difficult to come up with the example of a data type which is not a <code>Contravariant</code>, but this also not the most interesting part of the question :)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557834905, "post_id": 56129585, "comment_id": 98890799, "body": "<code>newtype C a = C (a -&gt; Int)</code> is contravariant."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 1, "creation_date": 1557836012, "post_id": 56129585, "comment_id": 98891405, "body": "Decidable is actually the dual of Alternative, so perhaps in the spirit of the original question then Comonad should be included in our inquisition of hierarchy?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1557850276, "post_id": 56129585, "comment_id": 98900186, "body": "I really wish <code>Divisible</code> had a superclass with <code>divide</code> but not <code>conquer</code>, dual to <code>Apply</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1558587059, "post_id": 56129585, "comment_id": 99151891, "body": "This question <a href=\"https://meta.stackoverflow.com/q/385338/2751851\">is being discussed on Meta</a>."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1558590342, "post_id": 56129585, "comment_id": 99152680, "body": "@duplode Interesting. My question received 4 downvotes today... English is not my native language, so if something can be improved in terms of wording to make the statement or question clear, I&#39;m happy to accept any useful suggestions! But I don&#39;t think that the question should be closed."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1558608030, "post_id": 56129585, "comment_id": 99161365, "body": "Potential close voters: this question should not be closed, for the reasons discussed <a href=\"https://meta.stackoverflow.com/a/385341/2751851\">in my Meta answer</a>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1558608223, "post_id": 56129585, "comment_id": 99161469, "body": "@Shersh &quot;But I don&#39;t think that the question should be closed&quot; -- Nor do I. Those votes, I believe, are mostly an artefact of the SO review system, which sometimes tricks people into developing strong opinions about questions they probably should refrain from passing judgement on."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1558654285, "post_id": 56129585, "comment_id": 99182059, "body": "@moonGoose The issue with including <code>Comonad</code> here is that it is not a subclass of <code>Divisible</code>. Its relationship with <code>Monad</code> is not the same as the one between <code>Divisible</code> and <code>Alternative</code>. (In a cursory way: (1a) A <code>Monad</code> is a monad in <b>Hask</b>; (1b) A <code>Comonad</code> is a monad in the dual category <b>Hask^op</b>, which we encode within <b>Hask</b> by flipping some arrows; (2a) An <code>Applicative</code> is a monoidal endofunctor in <b>Hask</b>; (2b) A <code>Divisible</code> is a monoidal functor from <b>Hask^op</b> to <b>Hask</b>, which we encode within <b>Hask</b> by flipping some arrows, but not quite in the same way.)"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1557842428, "post_id": 56129941, "comment_id": 98895429, "body": "What <i>are</i> the laws for <code>Divisible</code>? The documentation only mentions that <code>lose</code> should be an identity for <code>choose</code> (what does this mean, exactly, given the extra function arguments?); should there also be some analog of associativity?"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557844644, "post_id": 56129941, "comment_id": 98896893, "body": "@DanielWagner <a href=\"http://hackage.haskell.org/package/contravariant-1.5.1/docs/Data-Functor-Contravariant-Divisible.html#g:4\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/contravariant-1.5.1/docs/&hellip;</a> has some more laws"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1557849648, "post_id": 56129941, "comment_id": 98899875, "body": "I don&#39;t think <code>Identity</code> can be an instance of <code>Contravariant</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1557849968, "post_id": 56129941, "comment_id": 98900030, "body": "@Carl I don&#39;t know what I was thinking. Thanks."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1558072392, "post_id": 56129941, "comment_id": 98986406, "body": "I like your examples! @user11228628 has detailed explanation on why <code>Const</code> cannot be <code>Decidable</code>. I think the documentation for the <code>contravariant</code> package can benefit a lot from these examples :)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 7, "last_activity_date": 1557849935, "last_edit_date": 1557849935, "creation_date": 1557835157, "answer_id": 56129941, "question_id": 56129585, "link": "https://stackoverflow.com/questions/56129585/good-examples-of-not-a-contravariant-contravariant-divisible-decidable/56129941#56129941", "title": "Good examples of not a Contravariant/Contravariant/Divisible/Decidable?", "body": "<p>(partial answer)</p>\n\n<h1>Not contravariant</h1>\n\n<pre><code>newtype F a = K (Bool -&gt; a)\n</code></pre>\n\n<p>is not contravariant (it is, however, a covariant functor).</p>\n\n<h1>Contravariant, but not divisible</h1>\n\n<pre><code>newtype F a = F { runF :: a -&gt; Void }\n</code></pre>\n\n<p>is contravariant but it can not be <code>Divisible</code> since otherwise</p>\n\n<pre><code>runF (conquer :: F ()) () :: Void\n</code></pre>\n\n<h1>A note on \"divisible but non decidable\"</h1>\n\n<p>I don't have a reasonable example for a divisible which is not decidable. We can observe that such a counterexample must be such because it violates the laws, and not just the type signature. Indeed, if <code>Divisible F</code> holds,</p>\n\n<pre><code>instance Decidable F where\n    lose _ = conquer\n    choose _ _ _ = conquer\n</code></pre>\n\n<p>satisfies the type signatures of the methods.</p>\n\n<p>In libraries we find <code>Const m</code> as a divisible, when <code>m</code> is a monoid.</p>\n\n<pre><code>instance Monoid m =&gt; Divisible (Const m) where\n  divide _ (Const a) (Const b) = Const (mappend a b)\n  conquer = Const mempty\n</code></pre>\n\n<p>Perhaps this can not be a lawful <code>Decidable</code>? (I'm unsure, it seems to satisfy the <code>Decidable</code> laws, but there's no <code>Decidable (Const m)</code> instance in the libraries.)</p>\n\n<h1>Decidable</h1>\n\n<p>Taken from the libraries:</p>\n\n<pre><code>newtype Predicate a = Predicate (a -&gt; Bool)\n\ninstance Divisible Predicate where\n  divide f (Predicate g) (Predicate h) = Predicate $ \\a -&gt; case f a of\n    (b, c) -&gt; g b &amp;&amp; h c\n  conquer = Predicate $ const True\n\ninstance Decidable Predicate where\n  lose f = Predicate $ \\a -&gt; absurd (f a)\n  choose f (Predicate g) (Predicate h) = Predicate $ either g h . f\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1558072293, "post_id": 56135719, "comment_id": 98986368, "body": "Thanks for the detailed explanation! Now it really makes sense why <code>Const</code> cannot be Decidable."}, {"owner": {"reputation": 11510, "user_id": 5852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba340386ad2afc76d4a9602410b4e449?s=128&d=identicon&r=PG", "display_name": "Sjoerd Visscher", "link": "https://stackoverflow.com/users/5852/sjoerd-visscher"}, "edited": false, "score": 1, "creation_date": 1558172426, "post_id": 56135719, "comment_id": 99018982, "body": "Const can be Decidable, just not for any monoid, but only for those that satisfy that law, ie left distributive monoids."}], "tags": [], "owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "is_accepted": false, "score": 6, "last_activity_date": 1558582542, "last_edit_date": 1558582542, "creation_date": 1557855157, "answer_id": 56135719, "question_id": 56129585, "link": "https://stackoverflow.com/questions/56129585/good-examples-of-not-a-contravariant-contravariant-divisible-decidable/56135719#56135719", "title": "Good examples of not a Contravariant/Contravariant/Divisible/Decidable?", "body": "<p><em>(partial derivative answer?)</em></p>\n\n<p>I belive @chi is correct <a href=\"https://stackoverflow.com/a/56129941/2751851\">when they hypothesize</a> that <code>Const m</code> can't be a lawful <code>Decidable</code> for all <code>Monoid</code>s <code>m</code>, but I'm basing that off of some speculation about the <code>Decidable</code> laws.</p>\n\n<p>In <a href=\"http://hackage.haskell.org/package/contravariant-1.5.1/docs/Data-Functor-Contravariant-Divisible.html#g:4\" rel=\"nofollow noreferrer\">the docs</a>, we get this tantalizing hint at a <code>Decidable</code> law:</p>\n\n<blockquote>\n  <p>In addition, we expect the same kind of distributive law as is satisfied by the usual covariant Alternative, w.r.t Applicative, which should be fully formulated and added here at some point!</p>\n</blockquote>\n\n<p>What sort of distributive relationship should <code>Decidable</code> and <code>Divisible</code> have with each other? Well, <code>Divisible</code> has <code>chosen</code>, which builds a product-accepting thing out of element-accepting things, and <code>Decidable</code> has <code>divided</code>, which builds a sum-accepting thing out of element-accepting things. Since products distribute over sums, perhaps the law we're seeking relates <code>f (a, Either b c)</code> to <code>f (Either (a, b) (a, c))</code>, values of which can be constructed via <code>a `divided` (b `chosen` c)</code> and <code>(a `divided` b) `chosen` (a `divided` c)</code>, respectively.</p>\n\n<p>So I'll hypothesize that the missing <code>Decidable</code> law is something along the lines of</p>\n\n<pre><code>a `divided` (b `chosen` c) = contramap f ((a `divided` b) `chosen` (a `divided` c))\n  where f (x, y) = bimap ((,) x) ((,) x) y\n</code></pre>\n\n<p>which is indeed satisfied for <code>Predicate</code>, <code>Equivalence</code>, and <code>Op</code> (the three <code>Decidable</code> instances I've taken the time to check, so far).</p>\n\n<p>Now I believe the only instance you can have for <code>instance Monoid m =&gt; Decidable (Const m)</code> uses <code>mempty</code> for <code>lose</code> and <code>mappend</code> for <code>choose</code>; any other choices and then <code>lose</code> is no longer an identity for <code>choose</code>. This means that the above distributive law simplifies to</p>\n\n<pre><code>a `mappend` (b `mappend` c) = (a `mappend` b) `mappend` (a `mappend` c)\n</code></pre>\n\n<p>which is <strike>clearly bogus</strike> not true in an arbitrary <code>Monoid</code> (though, as Sjoerd Visscher observes, is true in some <code>Monoid</code>s\u2014so <code>Const m</code> could still be a lawful <code>Decidable</code> if <code>m</code> is a distributive monoid).</p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 656, "favorite_count": 4, "answer_count": 2, "score": 10, "last_activity_date": 1558651243, "creation_date": 1557833967, "last_edit_date": 1558651243, "question_id": 56129585, "link": "https://stackoverflow.com/questions/56129585/good-examples-of-not-a-contravariant-contravariant-divisible-decidable", "title": "Good examples of not a Contravariant/Contravariant/Divisible/Decidable?", "body": "<p><a href=\"http://hackage.haskell.org/package/contravariant-1.5.1/docs/Data-Functor-Contravariant-Divisible.html\" rel=\"nofollow noreferrer\">The <code>Contravariant</code> family of typeclasses</a> represents standard and fundamental abstractions in the Haskell ecosystem:</p>\n\n<pre><code>class Contravariant f where\n    contramap :: (a -&gt; b) -&gt; f b -&gt; f a\n\nclass Contravariant f =&gt; Divisible f where\n    conquer :: f a\n    divide  :: (a -&gt; (b, c)) -&gt; f b -&gt; f c -&gt; f a\n\nclass Divisible f =&gt; Decidable f where\n    lose   :: (a -&gt; Void) -&gt; f a\n    choose :: (a -&gt; Either b c) -&gt; f b -&gt; f c -&gt; f a\n</code></pre>\n\n<p>However, it's not that easy to understand the concepts behind these typeclasses. I think it would help to understand these typeclasses better if you could see some counterexamples for them. So, in the spirit of <a href=\"https://stackoverflow.com/questions/7220436/good-examples-of-not-a-functor-functor-applicative-monad\"><em>Good examples of Not a Functor/Functor/Applicative/Monad?</em></a>, I'm looking for contrasting examples of data types which satisfy the following requirements:</p>\n\n<ul>\n<li>A type constructor which is not a <code>Contravariant</code>?</li>\n<li>A type constructor which is a <code>Contravariant</code>, but not <code>Divisible</code>?</li>\n<li>A type constructor which is a <code>Divisible</code>, but is not a <code>Decidable</code>?</li>\n<li>A type constructor which is a <code>Decidable</code>?</li>\n</ul>\n"}, {"tags": ["haskell", "haskell-streaming"], "comments": [{"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1557829127, "post_id": 56126401, "comment_id": 98887585, "body": "Your problem that in <code>len :&gt; bs2 &lt;- BSSC.length bs</code> <code>bs2</code> is not content (not even <code>ByteString</code>), but just <code>()</code>. If you want to operate with <code>ByteString</code> it is looks like you can&#39;t extract value out of it, use <code>if</code> and continue to use <code>ByteString</code>."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1557829281, "post_id": 56126401, "comment_id": 98887676, "body": "If you want to recursive process your string you have to use <code>uncons</code> to get head and tail, and do recursive call with tail."}], "answers": [{"tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 0, "last_activity_date": 1557830945, "last_edit_date": 1557830945, "creation_date": 1557830429, "answer_id": 56128576, "question_id": 56126401, "link": "https://stackoverflow.com/questions/56126401/missing-type-of-result-in-function-length-monad-m-bytestring-m-r-m-of/56128576#56128576", "title": "Missing type of result? In function length :: Monad m =&gt; ByteString m r -&gt; m (Of Int r)", "body": "<p>You can hotfix type mismatch with using <code>bs</code> as second parameter to <code>splitAt</code></p>\n\n<pre><code>import qualified Data.ByteString.Streaming.Char8 as BSSC\n\nmain :: IO ()\nmain = runResourceT $ dump $ BSSC.readFile \"filename\"\n\ndump :: (MonadIO m) =&gt; BSSC.ByteString m r -&gt; m ()                                                                                                                                                \ndump bs = do\n    len :&gt; bs2 &lt;- BSSC.length bs\n    if len &lt;= 1 then return ()\n    else dump $ BSSC.putStr $ BSSC.splitAt 1 bs\n</code></pre>\n\n<p>but it won't work as you expect. I guess it will read file as many times as many letter in it.</p>\n\n<p>If you want recursion you should go with </p>\n\n<pre><code>import qualified Data.ByteString.Streaming.Char8 as BSSC\n\nmain :: IO ()\nmain = runResourceT $ dump $ BSSC.readFile \"filename\"\n\ndump :: (MonadIO m) =&gt; BSSC.ByteString m r -&gt; m ()                                                                                                                                                \ndump bs = do\n    split &lt;- BSSC.uncons bs\n    case split of\n       Left _        -&gt; return ()\n       Right (x, xs) -&gt; putStr (show x) &gt;&gt; dump xs\n</code></pre>\n\n<p>I don't have compiler with me, so it is possibly there are compilation prblems in my snippets.</p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 1, "last_activity_date": 1557857692, "last_edit_date": 1557857692, "creation_date": 1557857381, "answer_id": 56136215, "question_id": 56126401, "link": "https://stackoverflow.com/questions/56126401/missing-type-of-result-in-function-length-monad-m-bytestring-m-r-m-of/56136215#56136215", "title": "Missing type of result? In function length :: Monad m =&gt; ByteString m r -&gt; m (Of Int r)", "body": "<p>The <code>ByteString</code> type from streaming-bytestring has two type parameters. The first is the base monad <code>m</code> in which the values are produced (typically <code>IO</code>).</p>\n\n<p>The second is a special ending value <code>r</code> that is  returned once the <code>ByteString</code> is exhausted. Usually it will be an uninformative <code>()</code>. However, it becomes very useful for defining functions like <code>splitAt :: Monad m =&gt; Int64 -&gt; ByteString m r -&gt; ByteString m (ByteString m r)</code>. The type means: \"give me a limit position and a effectful stream of bytes that returns with an <code>r</code>, I will give you another stream that is no longer than the limit and returns with a effectful stream of bytes that returns with an <code>r</code>.\" This ending stream nested within the outer one can only be reached after the outer one is exhausted.</p>\n\n<p><code>length</code> has type <code>Monad m =&gt; ByteString m r -&gt; m (Of Int r)</code>. It consumes the stream of values it receives as argument and returns an action in the base monad. The <code>ByteString</code> exists no more. The <code>bs2</code> that you pass to <code>splitAt</code> is not a <code>ByteString</code> but the ending value of the original <code>ByteString</code>, which has type <code>r</code>. And this causes a type error.</p>\n"}], "owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 56136215, "answer_count": 2, "score": 2, "last_activity_date": 1557857692, "creation_date": 1557823871, "last_edit_date": 1557857528, "question_id": 56126401, "link": "https://stackoverflow.com/questions/56126401/missing-type-of-result-in-function-length-monad-m-bytestring-m-r-m-of", "title": "Missing type of result? In function length :: Monad m =&gt; ByteString m r -&gt; m (Of Int r)", "body": "<p>I have a simple function that reads a binary file one byte at a time. It get a compile time error, below. The problem seems to be that <code>bs2</code>, the resulting ByteString of <a href=\"http://hackage.haskell.org/package/streaming-bytestring-0.1.6/docs/Data-ByteString-Streaming-Char8.html#v:length\" rel=\"nofollow noreferrer\"><code>BSSC.length</code></a>, has an unknown type. Am I missing a type constraint on <code>r</code>?</p>\n\n<pre><code>import qualified Data.ByteString.Streaming.Char8 as BSSC\n\nmain :: IO ()\nmain = runResourceT $ dump $ BSSC.readFile \"filename\"\n\ndump :: (MonadIO m) =&gt; BSSC.ByteString m r -&gt; m ()                                                                                                                                                \ndump bs = do\n    len :&gt; bs2 &lt;- BSSC.length bs          -- Data.Functor.Of (:&gt;)\n    if len &lt;= 1 then return ()\n    else dump $ BSSC.putStr $ BSSC.splitAt 1 bs2\n</code></pre>\n\n<p>Compile-time error:</p>\n\n<pre><code>Main.hs:166:46: error:\n  \u2022 Couldn't match expected type \u2018BSSC.ByteString\n                                    (BSSC.ByteString m) r0\u2019\n                with actual type \u2018r\u2019\n    \u2018r\u2019 is a rigid type variable bound by\n      the type signature for:\n        dump :: forall (m :: * -&gt; *) r.\n                MonadIO m =&gt;\n                BSSC.ByteString m r -&gt; m ()\n      at Main.hs:162:9\n  \u2022 In the second argument of \u2018BSSC.splitAt\u2019, namely \u2018bs2\u2019\n    In the second argument of \u2018($)\u2019, namely \u2018BSSC.splitAt 1 bs2\u2019\n    In the second argument of \u2018($)\u2019, namely\n      \u2018BSSC.putStr $ BSSC.splitAt 1 bs2\u2019\n  \u2022 Relevant bindings include\n      bs2 :: r (bound at Main.hs:164:12)\n      bs :: BSSC.ByteString m r (bound at Main.hs:163:6)\n      dump :: BSSC.ByteString m r -&gt; m () (bound at Main.hs:163:1)\n</code></pre>\n"}, {"tags": ["list", "haskell", "list-comprehension", "primes", "goldbach-conjecture"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1557819868, "post_id": 56125181, "comment_id": 98882640, "body": "Post the error you get please. You don&#39;t even mention x, strange that it would say it&#39;s not known"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 542, "user_id": 4440871, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/8gHuC.jpg?s=128&g=1", "display_name": "Fabian Schneider", "link": "https://stackoverflow.com/users/4440871/fabian-schneider"}, "edited": false, "score": 0, "creation_date": 1557819971, "post_id": 56125181, "comment_id": 98882692, "body": "@FabianSchneider that would require <code>a + b</code> to be a list.  <code>let n = a+b</code> there probably matches the intention."}, {"owner": {"reputation": 542, "user_id": 4440871, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/8gHuC.jpg?s=128&g=1", "display_name": "Fabian Schneider", "link": "https://stackoverflow.com/users/4440871/fabian-schneider"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1557820023, "post_id": 56125181, "comment_id": 98882709, "body": "@luqui true; I think that this is actually what he meant: <code>goldbach n = [(a, b) | a &lt;- takeWhile (&lt;n) primes, b &lt;- takeWhile (&lt;n) primes, n == a + b]</code> ensuring that n is actually a + b in the tuple..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1557820054, "post_id": 56125181, "comment_id": 98882725, "body": "You can&#39;t use <code>a</code> before it&#39;s defined by <code>a &lt;- ...</code>. Ditto for <code>b</code>. Move <code>n == a+b</code> at the end."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1557840823, "post_id": 56125181, "comment_id": 98894452, "body": "<code>goldbach n = (n, [(a, b) | a &lt;- da [2..n], b &lt;- da [2..n], a+b==n] )</code>."}, {"owner": {"reputation": 542, "user_id": 4440871, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/8gHuC.jpg?s=128&g=1", "display_name": "Fabian Schneider", "link": "https://stackoverflow.com/users/4440871/fabian-schneider"}, "edited": false, "score": 0, "creation_date": 1558207277, "post_id": 56125181, "comment_id": 99026936, "body": "@mushishi : did the answer solve your problem? if so please accept it; if not, please provide some more details ;)"}], "answers": [{"comments": [{"owner": {"reputation": 139, "user_id": 11372625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c26f5fb2bbbe8f1060006686c1d94fe5?s=128&d=identicon&r=PG&f=1", "display_name": "mushishi", "link": "https://stackoverflow.com/users/11372625/mushishi"}, "edited": false, "score": 0, "creation_date": 1557822881, "post_id": 56125431, "comment_id": 98884132, "body": "*Foo&gt; goldbach 23  []"}, {"owner": {"reputation": 542, "user_id": 4440871, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/8gHuC.jpg?s=128&g=1", "display_name": "Fabian Schneider", "link": "https://stackoverflow.com/users/4440871/fabian-schneider"}, "reply_to_user": {"reputation": 139, "user_id": 11372625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c26f5fb2bbbe8f1060006686c1d94fe5?s=128&d=identicon&r=PG&f=1", "display_name": "mushishi", "link": "https://stackoverflow.com/users/11372625/mushishi"}, "edited": false, "score": 1, "creation_date": 1557823535, "post_id": 56125431, "comment_id": 98884458, "body": "According to wikipedia the goldbach conjecture states <code>Every even integer greater than 2 can be expressed as the sum of two primes.</code> which implies that it is only defined for even numbers; which implies that it does not hold for 23"}, {"owner": {"reputation": 139, "user_id": 11372625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c26f5fb2bbbe8f1060006686c1d94fe5?s=128&d=identicon&r=PG&f=1", "display_name": "mushishi", "link": "https://stackoverflow.com/users/11372625/mushishi"}, "edited": false, "score": 0, "creation_date": 1557824692, "post_id": 56125431, "comment_id": 98885053, "body": "Still <code>goldbach 25</code> yields <code>[(2,23),(23,2)]</code> even though it should be [] for any positive odd integer. And thanks for pointing out the importance of the order of conditions in the comprehension!"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 139, "user_id": 11372625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c26f5fb2bbbe8f1060006686c1d94fe5?s=128&d=identicon&r=PG&f=1", "display_name": "mushishi", "link": "https://stackoverflow.com/users/11372625/mushishi"}, "edited": false, "score": 3, "creation_date": 1557830893, "post_id": 56125431, "comment_id": 98888554, "body": "@mushishi: no, this works as an implication, not as an equivalence. Any even integer greater than 2 can be expressed as a sum of two primes, that does not say anything about the odd numbers. It can happen that it is impossible, as well as it can happen that it is possible."}], "tags": [], "owner": {"reputation": 542, "user_id": 4440871, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/8gHuC.jpg?s=128&g=1", "display_name": "Fabian Schneider", "link": "https://stackoverflow.com/users/4440871/fabian-schneider"}, "is_accepted": true, "score": 3, "last_activity_date": 1557838105, "last_edit_date": 1557838105, "creation_date": 1557820266, "answer_id": 56125431, "question_id": 56125181, "link": "https://stackoverflow.com/questions/56125181/implementing-goldbachs-conjecture-in-haskell-lots-of-restrictions/56125431#56125431", "title": "Implementing Goldbach&#39;s conjecture in Haskell, lots of restrictions", "body": "<p>Disregarding the weird error you are talking about, I think that the problem you actually have is the following:</p>\n\n<p>As mentioned by @chi and me, you can't use a and b in your final comprehension before you define a and b.\nso you have to move it to the and.</p>\n\n<p>Also: equality of integers is checked with <code>(==)</code> not <code>(=)</code> in haskell.\nSo you also need to change that.</p>\n\n<p>This would be the complete code for your final approach:</p>\n\n<p><code>goldbach n = [(a, b) | a &lt;- takeWhile (&lt;n) primes, b &lt;- takeWhile (&lt;n) primes, n == a + b]</code> </p>\n\n<p>A small test yields:</p>\n\n<pre><code>*Main&gt; goldbach 5\n[(2,3),(3,2)]\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>If you want to achieve what you wrote in your comment, you can just add another condition to your comprehension</p>\n\n<pre><code>n `mod` 2 == 0\n</code></pre>\n\n<p>or even better: Define your funtion with a guard like this:</p>\n\n<pre><code>goldbach n\n  | n `mod` 2 == 0 = [(a, b) | a &lt;- takeWhile (&lt;n) primes, b &lt;- takeWhile (&lt;n) primes, n == a + b]\n  | otherwise = []\n</code></pre>\n\n<p>However, if I am not mistaken this has nothing to do with the actual Godbach conjecture.</p>\n"}], "owner": {"reputation": 139, "user_id": 11372625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c26f5fb2bbbe8f1060006686c1d94fe5?s=128&d=identicon&r=PG&f=1", "display_name": "mushishi", "link": "https://stackoverflow.com/users/11372625/mushishi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "accepted_answer_id": 56125431, "answer_count": 1, "score": 0, "last_activity_date": 1558239301, "creation_date": 1557819367, "last_edit_date": 1558239301, "question_id": 56125181, "link": "https://stackoverflow.com/questions/56125181/implementing-goldbachs-conjecture-in-haskell-lots-of-restrictions", "title": "Implementing Goldbach&#39;s conjecture in Haskell, lots of restrictions", "body": "<p>The point of this assignment is to understand list comprehensions. </p>\n\n<p>Implementing Goldbach's conjecture for some natural number (otherwise the behavior does not matter) using several pre-defined functions and under the following restrictions: </p>\n\n<ul>\n<li>no auxiliary functions</li>\n<li>no use of <em>where</em> or <em>let</em></li>\n<li>only one defining equation on the left-hand side and the right-hand side <em>must</em> be a list comprehension</li>\n<li>the order of the pairs in the resulting list is irrelevant</li>\n<li>using functions from Prelude is allowed</li>\n</ul>\n\n<pre><code>-- This part is the \"library\" \n\ndm :: Int -&gt; [ Int ] -&gt; [ Int ]\ndm x xs = [ y | y &lt;- xs , y `mod ` x /= 0]\n\nda :: [ Int ] -&gt; [ Int ]\nda ( x : xs ) = x : da ( dm x xs )\n\nprimes :: [ Int ]\nprimes = da [2 ..]\n\n-- Here is my code\ngoldbach :: Int -&gt; [(Int,Int)]\n\n-- This is my attempt 1\ngoldbach n = [(a, b) | n = a + b, a &lt;- primes, b &lt;- primes, a &lt; n, b &lt; n]\n\n-- This is my attempt 2\ngoldbach n = [(a, b) | n = a + b, a &lt;- takeWhile (&lt;n) primes, b &lt;- takeWhile (&lt;n) primes]\n</code></pre>\n\n<p>Expected result: a list of all pairs summing up to the specified integer. But GHC complains that in the comprehension, n is not known. My gut tells me I need some Prelude function(s) to achieve what I need, but which one?</p>\n\n<hr>\n\n<p><strong>Update</strong></p>\n\n<pre><code>parse error on input \u2018=\u2019\n    Perhaps you need a 'let' in a 'do' block?\n    e.g. 'let n = 5' instead of 'n = 5'\n</code></pre>\n"}, {"tags": ["haskell", "haskell-streaming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1557817919, "post_id": 56124811, "comment_id": 98881688, "body": "Can you provide a minimal working example (a small code fragment with the given error, such that we can see what is going on)?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1557823921, "post_id": 56124811, "comment_id": 98884624, "body": "You can find out how to construct <code>Of</code> by writing <code>:info Of</code> in GHCi, or using <a href=\"https://hoogle.haskell.org/?hoogle=Of\" rel=\"nofollow noreferrer\">Hoogle</a>."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 6, "last_activity_date": 1557818368, "creation_date": 1557818368, "answer_id": 56124949, "question_id": 56124811, "link": "https://stackoverflow.com/questions/56124811/how-to-access-data-functor-of/56124949#56124949", "title": "How to access Data.Functor.Of?", "body": "<p><a href=\"http://hackage.haskell.org/package/streaming-0.2.1.0/docs/Data-Functor-Of.html#t:Of\" rel=\"noreferrer\">The constructor of <code>Of</code> is called <code>(:&gt;)</code></a>:</p>\n\n<pre><code>-- | A left-strict pair; the base functor for streams of individual elements.\ndata Of a b = !a :&gt; b\n    deriving (Data, Eq, Foldable, Ord,\n              Read, Show, Traversable, Typeable, Generic, Generic1)\ninfixr 5 :&gt;\n</code></pre>\n\n<p>so you should be able to do something like </p>\n\n<pre><code>n :&gt; _ &lt;- length bs\n</code></pre>\n"}], "owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 56124949, "answer_count": 1, "score": 2, "last_activity_date": 1557857574, "creation_date": 1557817814, "last_edit_date": 1557857574, "question_id": 56124811, "link": "https://stackoverflow.com/questions/56124811/how-to-access-data-functor-of", "title": "How to access Data.Functor.Of?", "body": "<p>I am trying to use the <a href=\"http://hackage.haskell.org/package/streaming-bytestring-0.1.6/docs/Data-ByteString-Streaming-Char8.html#v:length\" rel=\"nofollow noreferrer\">length</a> function of the <code>streaming-bytestring</code> <code>Data.ByteString.Streaming.Char8</code> library. </p>\n\n<p>I see that the return value has type <code>Of</code>, but I am not clear on how to examine it. I tried using <code>case</code>, but the compiler says <code>Not in scope: data constructor \u2018O.Of\u2019</code>, even if I do a qualified import of <code>Data.Functor.Of</code>.</p>\n\n<p>How do I examine the value?  </p>\n\n<p>Code sample:</p>\n\n<pre><code>ghci&gt; let bs = BSSC.string \"tiger\"            \nghci&gt; bs                                                   \nChunk \"tiger\" (Empty (()))                                            \nghci&gt; BSSC.length bs                 \n6 :&gt; ()                                  \nghci&gt; let len = BSSC.length bs\nghci&gt; :t len\nlen :: Monad m =&gt; m (OO.Of Int ())\n</code></pre>\n"}, {"tags": ["haskell", "fold", "continuations", "continuation-passing"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1557810595, "post_id": 56122022, "comment_id": 98878693, "body": "By the way: those versions of <code>zipRev</code> fail if the second list is shorter than the first. I believe the laziest possible version that works regardless of relative lengths is <a href=\"https://gist.github.com/treeowl/3e149df5a03c3ae2e51c51277919e189\" rel=\"nofollow noreferrer\">this one</a> I just put together."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1557810512, "post_id": 56123228, "comment_id": 98878676, "body": "A footnote: for an immediate proof that <code>obfuscate</code> respects function composition, we just have to notice it is <code>fmap</code> for the double continuation type."}], "tags": [], "owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "is_accepted": true, "score": 18, "last_activity_date": 1557874334, "last_edit_date": 1557874334, "creation_date": 1557809664, "answer_id": 56123228, "question_id": 56122022, "link": "https://stackoverflow.com/questions/56122022/how-can-two-continuations-cancel-each-other-out/56123228#56123228", "title": "How can two continuations cancel each other out?", "body": "<p>A function <code>f :: a -&gt; b</code> can be \"disguised\" inside double continuations as a function <code>f' :: ((a -&gt; r1) -&gt; r2) -&gt; ((b -&gt; r1) -&gt; r2)</code>.</p>\n\n<pre><code>obfuscate :: (a -&gt; b) -&gt; ((a -&gt; r1) -&gt; r2) -&gt; (b -&gt; r1) -&gt; r2\nobfuscate f k2 k1 = k2 (k1 . f)\n</code></pre>\n\n<p><code>obfuscate</code> has the nice property that it preserves function composition and identity: you can prove that <code>obfuscate f . obfuscate g === obfuscate (f . g)</code> and that <code>obfuscate id === id</code> in a few steps. That means that you can frequently use this transformation to untangle double-continuation computations that compose <code>obfuscate</code>d functions together by factoring the <code>obfuscate</code> out of the composition. This question is an example of such an untangling.</p>\n\n<p>The <code>f</code> in the top code block is the <code>obfuscate</code>d version of the <code>f</code> in the bottom block (more precisely, top <code>f x</code> is the <code>obfuscate</code>d version of bottom <code>f x</code>). You can see this by noticing how top <code>f</code> applies the outer continuation to a function that transforms its input and then applies the whole thing to the inner continuation, just like in the body of <code>obfuscate</code>.</p>\n\n<p>So we can start to untangle <code>zipRev</code>:</p>\n\n<pre><code>zipRev xs ys = foldr f id xs snd (ys,[])\n  where\n    f x = obfuscate (\\(y:ys,r) -&gt; (ys,(x,y):r))\n</code></pre>\n\n<p>Since the action of <code>foldr</code> here is to compose a bunch of <code>obfuscate</code>d functions with each other (and apply it all to <code>id</code>, which we can leave on the right), we can factor the <code>obfuscate</code> to the outside of the whole fold:</p>\n\n<pre><code>zipRev xs ys = obfuscate (\\accum -&gt; foldr f accum xs) id snd (ys,[])\n  where\n    f x (y:ys,r) = (ys,(x,y):r)\n</code></pre>\n\n<p>Now apply the definition of <code>obfuscate</code> and simplify:</p>\n\n<pre><code>zipRev xs ys = obfuscate (\\accum -&gt; foldr f accum xs) id snd (ys,[]) \nzipRev xs ys = id (snd . (\\accum -&gt; foldr f accum xs)) (ys,[])\nzipRev xs ys = snd (foldr f (ys,[]) xs)\n</code></pre>\n\n<p>QED!</p>\n"}, {"tags": [], "owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "is_accepted": false, "score": 12, "last_activity_date": 1557812066, "last_edit_date": 1557812066, "creation_date": 1557810597, "answer_id": 56123371, "question_id": 56122022, "link": "https://stackoverflow.com/questions/56122022/how-can-two-continuations-cancel-each-other-out/56123371#56123371", "title": "How can two continuations cancel each other out?", "body": "\n\n<p>Given a function</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>g :: a\u2081 -&gt; a\u2082\n</code></pre>\n\n<p>we can lift it to a function on continuations, switching the order:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>lift g = (\\c a\u2081 -&gt; c (g a\u2081))\n    :: (a\u2082 -&gt; t) -&gt; a\u2081 -&gt; t\n</code></pre>\n\n<p>This transformation is a contravariant functor, which is to say that it interacts with function composition by switching its order:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>g\u2081 :: a\u2081 -&gt; a\u2082\ng\u2082 :: a\u2082 -&gt; a\u2083\n\nlift g\u2081 . lift g\u2082\n== (\\c\u2081 a\u2081 -&gt; c\u2081 (g\u2081 a\u2081)) . (\\c\u2082 a\u2082 -&gt; c\u2082 (g\u2082 a\u2082))\n== \\c\u2082 a\u2081 -&gt; (\\a\u2082 -&gt; c\u2082 (g\u2082 a\u2082)) (g\u2081 a\u2081)\n== \\c\u2082 a\u2081 -&gt; c\u2082 (g\u2082 (g\u2081 a\u2081)) \n== lift (g\u2082 . g\u2081)\n    :: (a\u2083 -&gt; t) -&gt; a\u2081 -&gt; t\n\nlift id\n== (\\c a\u2081 -&gt; c a\u2081)\n== id\n    :: (a\u2081 -&gt; t) -&gt; a\u2081 -&gt; t\n</code></pre>\n\n<p>We can lift the lifted function again in the same way to a function on stacked continuations, with the order switched back:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>lift (lift g)\n== (\\k c -&gt; k ((\\c a\u2081 -&gt; c (g a\u2081)) c))\n== (\\k c -&gt; k (\\a\u2081 -&gt; c (g a\u2081)))\n    :: ((a\u2081 -&gt; t) -&gt; u) -&gt; (a\u2082 -&gt; t) -&gt; u\n</code></pre>\n\n<p>Stacking two contravariant functors gives us a (covariant) functor:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>lift (lift g\u2081) . lift (lift g\u2082)\n== lift (lift g\u2082 . lift g\u2081)\n== lift (lift (g\u2081 . g\u2082))\n    :: ((a\u2081 -&gt; t) -&gt; u) -&gt; (a\u2083 -&gt; t) -&gt; u\n\nlift (lift id)\n== lift id\n== id\n    :: ((a\u2081 -&gt; t) -&gt; u) -&gt; (a\u2081 -&gt; t) -&gt; u\n</code></pre>\n\n<p>This is exactly the transformation being reversed in your example, with <code>g = \\(y:ys, r) -&gt; (ys, (x, y):r)</code>.  This <code>g</code> is an endomorphism (<code>a\u2081 = a\u2082</code>), and the <code>foldr</code> is composing together a bunch of copies of it with various <code>x</code>.  What we\u2019re doing is replacing the composition of double-lifted functions with the double-lift of the composition of the functions, which is just an inductive application of the functor laws:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>f :: x -&gt; a\u2081 -&gt; a\u2081\nc :: (a\u2081 -&gt; t) -&gt; u\nxs :: [x]\n\nfoldr (\\x -&gt; lift (lift (f x))) c xs\n== lift (lift (\\a\u2081 -&gt; foldr f a\u2081 xs)) c\n    :: (a\u2081 -&gt; t) -&gt; u\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1557838688, "post_id": 56130000, "comment_id": 98893103, "body": "btw I used similar technique in one of my recent answers: <code>rltake</code> <a href=\"https://stackoverflow.com/a/55523947/849891\">here</a> builds a chain of compositions first (just in a different direction), then applies it further; very much like <code>zipRev</code> here does."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557841045, "post_id": 56130000, "comment_id": 98894595, "body": "See my comment on the question."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557843228, "post_id": 56130000, "comment_id": 98895942, "body": "what does <code>fr</code> stand for?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557844418, "post_id": 56130000, "comment_id": 98896745, "body": "It stands for &quot;final result&quot;."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557846731, "post_id": 56130000, "comment_id": 98898256, "body": "to me, <code>z</code> is more informative, invokes &quot;zip&quot;, so adds something. &quot;fr&quot; adds nothing, just restates the given, and leaves me searching for the answer, futilely, because I search for the added meaning, and there&#39;s none. So that&#39;s why I was stumped. :) Names are important. :)"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1558158758, "last_edit_date": 1558158758, "creation_date": 1557835377, "answer_id": 56130000, "question_id": 56122022, "link": "https://stackoverflow.com/questions/56122022/how-can-two-continuations-cancel-each-other-out/56130000#56130000", "title": "How can two continuations cancel each other out?", "body": "<p>Let's try to understand this code from an elementary point of view. What does it even do, one wonders?</p>\n\n<pre><code>zipRev xs ys = foldr f id xs snd (ys,[])\n  where\n     -- f x k c = k (\\(y:ys, r) -&gt; c (ys, (x,y):r))\n        f x k c = k (g x c) \n     --         = (k . g x) c   -- so,\n     -- f x k   =  k . g x\n\n        g x   c       (y:ys, r) =  c (ys, (x,y):r)\n</code></pre>\n\n<p>Here we used <a href=\"https://en.wikipedia.org/wiki/Lambda_lifting\" rel=\"nofollow noreferrer\">lambda lifting</a> to recover the <code>g</code> <a href=\"https://en.wikipedia.org/wiki/Combinatory_logic\" rel=\"nofollow noreferrer\">combinator</a>. </p>\n\n<p>So then because <code>f x k = k . g x</code> were <code>k</code> goes <em>to the left</em> of <code>x</code>, the input list is translated into a reversed chain of compositions,</p>\n\n<pre><code>foldr f id [x1, x2, x3, ..., xn]   where  f x k = k . g x\n  ===&gt;&gt; \n   (((...(id . g xn) .  ...  . g x3) . g x2) . g x1)\n</code></pre>\n\n<p>and thus, it just does what a left fold would do, </p>\n\n<pre><code>zipRev [] ys = []\nzipRev [x1, x2, x3, ..., xn] ys \n      = (id . g xn  .  ...  . g x3 . g x2 . g x1)  snd         (ys, [])\n      = g xn (g xn1 (  ...  ( g x3 ( g x2 ( g x1   snd)))...)) (ys, [])\n   where     ----c--------------------------------------------\n        g x  c     (y:ys, r) = c (ys, (x,y):r)\n</code></pre>\n\n<p>So we went to the deep end of the <code>xs</code> list, and then we come back consuming the <code>ys</code> list left-to-right (i.e. top-down) on our way back right-to-left on the <code>xs</code> list (i.e. bottom-up). This is straightforwardly coded as a right fold with strict reducer, so the flow is indeed right-to-left on the <code>xs</code>. The bottom-most action (<code>snd</code>) in the chain is done last, so in the new code it becomes the topmost (still done last):</p>\n\n<pre><code>zipRev xs ys = snd (foldr h (ys,[]) xs)\n  where\n        h x        (y:ys, r) =   (ys, (x,y):r)\n</code></pre>\n\n<p><code>g x c</code> was used as a continuation in the original code, with <code>c</code> as a second-tier continuation; but it's actually all just been a regular fold from the right, all along. </p>\n\n<hr>\n\n<p>So indeed it zips the reversed first list with the second. It's also unsafe; it misses a clause:</p>\n\n<pre><code>        g x  c     ([],   r) = c ([], r)        -- or just `r`\n        g x  c     (y:ys, r) = c (ys, (x,y):r)\n</code></pre>\n\n<hr>\n\n<p><em>(update:)</em> The answers by duplode (and Joseph Sible) do the lambda lifting a bit differently, in a way which is better suited to the task. It goes like this:</p>\n\n<pre><code>zipRev xs ys = foldr f id xs  snd (ys,[])\n  where\n     f x k c = k      (\\((y:ys), r) -&gt; c (ys, (x,y):r)) \n             = k (c . (\\((y:ys), r) -&gt;   (ys, (x,y):r)) )\n             = k (c . g x)\n     g x     =        (\\((y:ys), r) -&gt;   (ys, (x,y):r))\n  {- f x k c = k ((. g x) c) = (k . (. g x)) c = (. (. g x)) k c\n     f x     =                                   (. (. g x))     -}\n</code></pre>\n\n<p>so then</p>\n\n<pre><code>foldr f id  [ x1,            x2,    ... ,         xn      ]  snd  (ys,[]) =\n  = ( (. (. g x1)) $ (. (. g x2)) $ ... $ (. (. g xn)) id )  snd  (ys,[])  -- 1,2...n\n  = ( id . (. g xn) .  ...  . (. g x2)  .    (. g x1)     )  snd  (ys,[])  -- n...2,1\n  =      ( snd . g x1 .    g x2   . ... .       g xn            ) (ys,[])  -- 1,2...n!\n  =        snd $ g x1 $    g x2   $ ... $       g xn              (ys,[])\n  =        snd $  foldr g (ys,[])  [x1, x2, ...,  xn      ]\n</code></pre>\n\n<p>Simple. :) Flipping twice is no flipping at all.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1558159072, "last_edit_date": 1558159072, "creation_date": 1557869546, "answer_id": 56138914, "question_id": 56122022, "link": "https://stackoverflow.com/questions/56122022/how-can-two-continuations-cancel-each-other-out/56138914#56138914", "title": "How can two continuations cancel each other out?", "body": "<p>Let's begin with a few cosmetic adjustments:</p>\n\n<pre><code>-- Note that `g x` is an endomorphism.\ng :: a -&gt; ([b], [(a,b)]) -&gt; ([b], [(a,b)])\ng x ((y:ys),r) = (ys,(x,y):r)\n\nzipRev xs ys = foldr f id xs snd (ys,[])\n  where\n    f x k = \\c -&gt; k (c . g x)\n</code></pre>\n\n<p><code>f</code> feeds a continuation (<code>c . g x</code>) to another function (<code>k</code>, a \"double continuation\", <a href=\"https://stackoverflow.com/a/56123228/2751851\">as user11228628 puts it</a>).</p>\n\n<p>While we might reasonably expect that repeated usage of <code>f</code> as the fold proceeds will somehow compose the <code>g x</code> endomorphisms made out of the elements of the list, the order in which the endomorphisms are composed might not be immediately obvious, so we'd better walk through a few fold steps to be sure:</p>\n\n<pre><code>-- x0 is the first element, x1 the second, etc.\nf x0 k0 \n\\c -&gt; k0 (c . g x0)\n\\c -&gt; (f x1 k1) (c . g x0) -- k0 is the result of a fold step.\n\\c -&gt; (\\d -&gt; k1 (d . g x1)) (c . g x0) -- Renaming a variable for clarity.\n\\c -&gt; k1 (c . g x0 . g x1)\n-- etc .\n-- xa is the *last* element, xb the next-to-last, etc.\n-- ka is the initial value passed to foldr.\n\\c -&gt; (f xa ka) (c . g x0 . g x1 . . . g xb)\n\\c -&gt; (\\d -&gt; ka (d . g xa)) (c . g x0 . g x1 . . . g xb)\n\\c -&gt; ka (c . g x0 . g x1 . . . g xb . g xa)\n</code></pre>\n\n<p><code>ka</code>, the initial value passed to foldr, is <code>id</code>, which makes things quite a bit simpler:</p>\n\n<pre><code>foldr f id xs = \\c -&gt; c . g x0 . g x1 . . . g xa\n</code></pre>\n\n<p>Since all we do with the <code>c</code> argument passed to <code>foldr f id xs</code> is post-composing it with the endomorphisms, we might as well factor it out of the fold:</p>\n\n<pre><code>zipRev xs ys = (snd . foldr h id xs) (ys,[])\n  where\n    h x e = g x . e\n</code></pre>\n\n<p>Note how we have gone from <code>c . g x</code> to <code>g x . e</code>. That can arguably be described as a collateral effect of the CPS trickery in the original implementation.</p>\n\n<p>The final step is noticing how <code>h x e = g x . e</code> corresponds exactly to what we would do to <a href=\"https://stackoverflow.com/a/23319967/2751851\">implement <code>foldr</code> in terms of <code>foldMap</code> for the <code>Endo</code> monoid</a>. Or, to put it more explicitly:</p>\n\n<pre><code>foldEndo g i xs = foldr g i xs  -- The goal is obtaining an Endo-like definition.\n\nfoldEndo _ i [] = i\nfoldEndo g i (x : xs) = g x (foldEndo g i xs)\n\nfoldEndo g i xs = go xs i\n    where\n    go [] = \\j -&gt; j\n    go (x : xs) = \\j -&gt; g x (foldEndo g j xs)\n\nfoldEndo g i xs = go xs i\n    where\n    go [] = \\j -&gt; j\n    go (x : xs) = \\j -&gt; g x (go xs j)\n\nfoldEndo g i xs = go xs i\n    where\n    go [] = id\n    go (x : xs) = g x . go xs\n\nfoldEndo g i xs = go xs i\n    where\n    h x e = g x . e\n    go [] = id\n    go (x : xs) = h x (go xs)\n\nfoldEndo g i xs = go xs i\n    where\n    h x e = g x . e\n    go xs = foldr h id xs\n\nfoldEndo g i xs = foldr h id xs i\n    where\n    h x e = g x . e\n</code></pre>\n\n<p>That finally leads us to what we were looking for:</p>\n\n<pre><code>zipRev xs ys = snd (foldr g (ys,[]) xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 2, "last_activity_date": 1559336199, "last_edit_date": 1559336199, "creation_date": 1557874654, "answer_id": 56139673, "question_id": 56122022, "link": "https://stackoverflow.com/questions/56122022/how-can-two-continuations-cancel-each-other-out/56139673#56139673", "title": "How can two continuations cancel each other out?", "body": "<p><a href=\"https://stackoverflow.com/a/56123228/7509065\">user11228628's answer</a> led me to understanding. Here's a few insights I had while reading it, and some step-by-step transformations.</p>\n\n<hr>\n\n<h1>Insights</h1>\n\n<ul>\n<li>The continuations don't directly cancel out. They can only eventually be canceled (by beta-reducing) because it's possible to factor them out.</li>\n<li>The pattern you're looking for to do this transformation is <code>\\k c -&gt; k (c . f)</code> (or if you love unreadable pointfree, <code>(. (. f))</code>) for any <code>f</code> (note that the <code>f</code> isn't a parameter to the lambda).</li>\n<li>As <a href=\"https://stackoverflow.com/questions/56122022/how-can-two-continuations-cancel-each-other-out/56138914#comment98878676_56123228\">duplode points out in a comment</a>, continuation-passing style functions can be considered a functor, and <code>obfuscate</code> is their definition of <code>fmap</code>.</li>\n<li>The trick of pulling a function like this out of <code>foldr</code> works for any function that could be a valid <code>fmap</code>.</li>\n</ul>\n\n<hr>\n\n<h1>Full transformation from the first code block to the second</h1>\n\n<pre><code>zipRev xs ys = foldr f id xs snd (ys,[])\n  where\n    f x k c = k (\\((y:ys),r) -&gt; c (ys,(x,y):r))\n</code></pre>\n\n<p>Pull <code>c</code> out of the lambda</p>\n\n<pre><code>zipRev xs ys = foldr f id xs snd (ys,[])\n  where\n    f x k c = k (c . \\((y:ys),r) -&gt; (ys,(x,y):r))\n</code></pre>\n\n<p>Substitute <code>obfuscate</code> for its definition</p>\n\n<pre><code>zipRev xs ys = foldr f id xs snd (ys,[])\n  where\n    f x = obfuscate (\\((y:ys),r) -&gt; (ys,(x,y):r))\n</code></pre>\n\n<p>Pull <code>obfuscate</code> out of the lambda</p>\n\n<pre><code>zipRev xs ys = foldr f id xs snd (ys,[])\n  where\n    f = obfuscate . \\x ((y:ys),r) -&gt; (ys,(x,y):r)\n</code></pre>\n\n<p>Pull <code>obfuscate</code> out of <code>f</code></p>\n\n<pre><code>zipRev xs ys = foldr (obfuscate . f) id xs snd (ys,[])\n  where\n    f x ((y:ys),r) = (ys,(x,y):r)\n</code></pre>\n\n<p>Since <code>obfuscate</code> follows the Functor laws, we can pull it out of <code>foldr</code></p>\n\n<pre><code>zipRev xs ys = obfuscate (flip (foldr f) xs) id snd (ys,[])\n  where\n    f x ((y:ys),r) = (ys,(x,y):r)\n</code></pre>\n\n<p>Inline <code>obfuscate</code></p>\n\n<pre><code>zipRev xs ys = (\\k c -&gt; k (c . flip (foldr f) xs)) id snd (ys,[])\n  where\n    f x ((y:ys),r) = (ys,(x,y):r)\n</code></pre>\n\n<p>Beta-reduce</p>\n\n<pre><code>zipRev xs ys = (id (snd . flip (foldr f) xs)) (ys,[])\n  where\n    f x ((y:ys),r) = (ys,(x,y):r)\n</code></pre>\n\n<p>Simplify</p>\n\n<pre><code>zipRev xs ys = snd (foldr f (ys,[]) xs)\n  where\n    f x (y:ys,r) = (ys,(x,y):r)\n</code></pre>\n\n<hr>\n\n<h1>Justification for pulling functions that are valid <code>fmap</code>s out of <code>foldr</code></h1>\n\n<pre><code>foldr (fmap . f) z [x1,x2,...,xn]\n</code></pre>\n\n<p>Expand the <code>foldr</code></p>\n\n<pre><code>(fmap . f) x1 . (fmap . f) x2 . ... . (fmap . f) xn $ z\n</code></pre>\n\n<p>Inline the inner <code>.</code>s</p>\n\n<pre><code>fmap (f x1) . fmap (f x2) . ... . fmap (f xn) $ z\n</code></pre>\n\n<p>Apply the Functor laws</p>\n\n<pre><code>fmap (f x1 . f x2 . ... . f xn) $ z\n</code></pre>\n\n<p>Eta-expand the section in parentheses</p>\n\n<pre><code>fmap (\\z2 -&gt; f x1 . f x2 . ... . f xn $ z2) z\n</code></pre>\n\n<p>Write the lambda body in terms of <code>foldr</code></p>\n\n<pre><code>fmap (\\z2 -&gt; foldr f z2 [x1,x2,...,xn]) z\n</code></pre>\n\n<p>Write the lambda body in terms of <code>flip</code></p>\n\n<pre><code>fmap (flip (foldr f) [x1,x2,...,xn]) z\n</code></pre>\n\n<hr>\n\n<h1>Bonus: Justification for pulling functions that are valid <code>contramap</code>s out of <code>foldr</code></h1>\n\n<pre><code>foldr (contramap . f) z [x1,x2,...,xn]\n</code></pre>\n\n<p>Expand the <code>foldr</code></p>\n\n<pre><code>(contramap . f) x1 . (contramap . f) x2 . ... . (contramap . f) xn $ z\n</code></pre>\n\n<p>Inline the inner <code>.</code>s</p>\n\n<pre><code>contramap (f x1) . contramap (f x2) . ... . contramap (f xn) $ z\n</code></pre>\n\n<p>Apply the Contravariant laws</p>\n\n<pre><code>contramap (f xn . ... . f x2 . f x1) $ z\n</code></pre>\n\n<p>Eta-expand the section in parentheses</p>\n\n<pre><code>contramap (\\z2 -&gt; f xn . ... . f x2 . f x1 $ z2) z\n</code></pre>\n\n<p>Write the lambda body in terms of <code>foldr</code></p>\n\n<pre><code>contramap (\\z2 -&gt; foldr f z2 [xn,...,x2,x1]) z\n</code></pre>\n\n<p>Write the lambda body in terms of <code>flip</code></p>\n\n<pre><code>contramap (flip (foldr f) [xn,...,x2,x1]) z\n</code></pre>\n\n<p>Apply <code>foldr f z (reverse xs)</code> = <code>foldl (flip f) z xs</code></p>\n\n<pre><code>contramap (flip (foldl (flip f)) [x1,x2,...,xn]) z\n</code></pre>\n"}], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1547, "favorite_count": 4, "accepted_answer_id": 56123228, "answer_count": 5, "score": 31, "last_activity_date": 1559336199, "creation_date": 1557799183, "last_edit_date": 1557835894, "question_id": 56122022, "link": "https://stackoverflow.com/questions/56122022/how-can-two-continuations-cancel-each-other-out", "title": "How can two continuations cancel each other out?", "body": "<p>I'm reading through <a href=\"https://doisinkidney.com/posts/2019-05-08-list-manipulation-tricks.html\" rel=\"noreferrer\">Some Tricks for List Manipulation</a>, and it contains the following:</p>\n\n<blockquote>\n<pre><code>zipRev xs ys = foldr f id xs snd (ys,[])\n  where\n    f x k c = k (\\((y:ys),r) -&gt; c (ys,(x,y):r)) \n</code></pre>\n  \n  <p>What we can see here is that we have two continuations stacked on top\n  of each other. When this happens, they can often \u201ccancel out\u201d, like\n  so:</p>\n\n<pre><code>zipRev xs ys = snd (foldr f (ys,[]) xs)\n  where\n    f x (y:ys,r) = (ys,(x,y):r)\n</code></pre>\n</blockquote>\n\n<p>I don't understand how you \"cancel out\" stacked continuations to get from the top code block to the bottom one. What pattern do you look for to make this transformation, and why does it work?</p>\n"}, {"tags": ["list", "haskell", "int"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1557797888, "post_id": 56121866, "comment_id": 98876188, "body": "Can you show your attempt at solving this problem and the error or where you got stuck?"}], "answers": [{"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 6, "last_activity_date": 1557797920, "creation_date": 1557797920, "answer_id": 56121895, "question_id": 56121866, "link": "https://stackoverflow.com/questions/56121866/remove-item-from-list-of-list-in-haskell/56121895#56121895", "title": "Remove item from list of list in Haskell", "body": "<p>So you can't have <code>removeItem</code> both be <code>Int -&gt; [Int] -&gt; [Int]</code> and <code>Int -&gt; [[Int]] -&gt; [[Int]]</code>. Instead, I'll call the latter <code>removeItem'</code>. You already know how to remove an item from just a regular list, so just use <code>map</code> to do it on a list of those lists. Implementation is then simple:</p>\n\n<pre><code>removeItem' :: Int -&gt; [[Int]] -&gt; [[Int]]\nremoveItem' x = map (removeItem x)\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 11493867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03b70e3500af8bde8fc6b7b7d862e08b?s=128&d=identicon&r=PG&f=1", "display_name": "alekq", "link": "https://stackoverflow.com/users/11493867/alekq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 1, "answer_count": 1, "score": -3, "last_activity_date": 1557797920, "creation_date": 1557797576, "last_edit_date": 1592644375, "question_id": 56121866, "link": "https://stackoverflow.com/questions/56121866/remove-item-from-list-of-list-in-haskell", "title": "Remove item from list of list in Haskell", "body": "<p>I have a problem with haskell fuction. I want to remove specific elements from list o list [[Int]]</p>\n<p>There're many easy way to remove element in list [Int]</p>\n<p>for example</p>\n<pre><code>removeItem :: Int -&gt; [Int] -&gt; [Int]\nremoveItem _ []                 = []\nremoveItem x (y:ys) | x == y    = removeItem x ys\n                    | otherwise = y : removeItem x ys\n</code></pre>\n<p>but I can't write</p>\n<pre><code>removeItem :: Int -&gt; [[Int]] -&gt; [[Int]]\n</code></pre>\n<p>it should give a result:</p>\n<blockquote>\n<p>removeItem 1 [[1],[2,2],[3],[1]]</p>\n<pre><code>  [[],[2,2],[3],[]]\n</code></pre>\n</blockquote>\n<p>Can anybody help me</p>\n"}, {"tags": ["haskell", "instance", "typeclass", "overlap", "bifunctor"], "comments": [{"owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "reply_to_user": {"reputation": 4614, "user_id": 1378868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84a42920594ee2a0cc33012c407fd9d5?s=128&d=identicon&r=PG", "display_name": "snak", "link": "https://stackoverflow.com/users/1378868/snak"}, "edited": false, "score": 0, "creation_date": 1557798379, "post_id": 56121803, "comment_id": 98876264, "body": "It is. Thank you very much, I had looked for a while but found anything. It took me a while to understand what the problem is.  Can I just ask, if you know, why does Haskell not check the constraints to decide potential instances? Is it because the constraints are rather passed back to the resulting type of the expression? Something like: &quot;An absence of an instance Bifunctor Provenance is not a proof that Provenance would never be an instance of Bifunctor, and so there could be overlapping instances&quot;? Because type checking is intuitionistic logic and etc.?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1557799481, "post_id": 56121803, "comment_id": 98876464, "body": "(1) That is pretty much it: absence of proof is not proof of absence. In particular, someone else using your code might give <code>Provenance</code> a <code>Bifunctor</code> instance without you ever knowing about it. Haskell classes work under <a href=\"https://stackoverflow.com/q/8728596/2751851\">the &quot;open world assumption&quot;</a>. (2) See also <a href=\"https://stackoverflow.com/a/3216937/2751851\">this very nice answer</a>, which I didn&#39;t add to the list of targets because there is too much going on elsewhere in that Q&amp;A."}], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 2, "last_activity_date": 1557798319, "creation_date": 1557798319, "answer_id": 56121938, "question_id": 56121803, "link": "https://stackoverflow.com/questions/56121803/haskell-independently-deciding-to-infer-bifunctor-for-my-datatype/56121938#56121938", "title": "Haskell independently deciding to infer Bifunctor for my datatype?", "body": "<p>When looking for a matching typeclass instance, GHC only looks at the <em>head</em>, not the conditions. It matches the conditions as a secondary step. So when GHC is looking for a <code>Functor</code> instance, all it sees is</p>\n\n<pre><code>instance (Don't care) =&gt; Functor (f t) where\ninstance (Don't care) =&gt; Functor (Provenance p) where\n</code></pre>\n\n<p>And both of those instances match just fine. The <code>(Don't care)</code> bit doesn't even come into play until later. So you have some overlapping instances, and that's a problem.</p>\n\n<p>You can see a bit more about this in <a href=\"https://stackoverflow.com/questions/16776118/overlapping-instances-in-haskell\">this question</a>. The \"solution\" is to toy with the GHC extension <code>OverlappingInstances</code>, which is a bit of a rabbit hole in and of itself.</p>\n"}], "owner": {"reputation": 131, "user_id": 11495698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QiCvXwvrCX4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcidM3XyCEbUFLzuvblXTmzSwrv1Q/mo/photo.jpg?sz=128", "display_name": "Juan Casanova Jaquete", "link": "https://stackoverflow.com/users/11495698/juan-casanova-jaquete"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "closed_date": 1557798880, "accepted_answer_id": 56121938, "answer_count": 1, "score": 3, "last_activity_date": 1557798907, "creation_date": 1557796961, "question_id": 56121803, "link": "https://stackoverflow.com/questions/56121803/haskell-independently-deciding-to-infer-bifunctor-for-my-datatype", "closed_reason": "Duplicate", "title": "Haskell independently deciding to infer Bifunctor for my datatype?", "body": "<p>For some reason, GHC seems to be deciding that my datatype (with two type parameters) instantiates Bifunctor for no reason at all. </p>\n\n<p>The funniest thing is that this is only used to tell me that there are overlapping instances of Functor for this datatype because I gave an instantiation of Functor for any Bifunctor (and a particular one for the datatype). But, if I try to do bimap on it, it tells me that there is no instance of Bifunctor.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nmodule BifunctorError where\n\nimport Data.Bifunctor\n\ninstance Bifunctor f =&gt; Functor (f t) where\n    fmap = bimap id\n\ndata Provenance p t = Provenance p t\n\n-- Uncomment and try to compile: Overlapping instances ???\n--instance Functor (Provenance p) where\n--  fmap f (Provenance p x) = Provenance p (f x)\n</code></pre>\n\n<p>I would expect that, because I have not provided anything to indicate that Provenance instantiates Bifunctor, it would not, and so the instance of Functor derived from Bifunctor should be irrelevant. Is this a bug with FlexibleInstances?</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "recursion-schemes", "catamorphism"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557796068, "post_id": 56121207, "comment_id": 98875887, "body": "Is that the histomorphism? Pretty sure this is one of the foo-morphisms; <a href=\"https://stackoverflow.com/questions/36851766/histomorphisms-zygomorphisms-and-futumorphisms-specialised-to-lists\" title=\"histomorphisms zygomorphisms and futumorphisms specialised to lists\">stackoverflow.com/questions/36851766/&hellip;</a> might help."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557796490, "post_id": 56121207, "comment_id": 98875975, "body": "@chepner It doesn&#39;t look like a histomorphism. In particular, it looks like a histomorphism only has access to &quot;previous&quot; intermediate results."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557798701, "post_id": 56121207, "comment_id": 98876323, "body": "Isn&#39;t it a futumorphism?"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 1, "creation_date": 1557798742, "post_id": 56121207, "comment_id": 98876328, "body": "@moonGoose A futumorphism seems to be a variation of an anamorphism that lets you set the future. This is a variation of a catamorphism that lets you look at it."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557798983, "post_id": 56121207, "comment_id": 98876370, "body": "@JosephSible that&#39;s not the explanation given eg. <a href=\"https://jtobin.io/time-traveling-recursion\" rel=\"nofollow noreferrer\">jtobin.io/time-traveling-recursion</a> , which describes it as a way to look at future values?"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 1, "creation_date": 1557799113, "post_id": 56121207, "comment_id": 98876392, "body": "@moonGoose The prose might be ambiguous, but I just read it again, and a futumorphism takes a coalgebra, which makes it for sure a variant of an anamorphism."}], "answers": [{"comments": [{"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557935468, "post_id": 56121763, "comment_id": 98935962, "body": "My intuition is that you can&#39;t get constant memory use + single pass; roughly, constant memory use =&gt; you can emit the list element-by-element =&gt; you already know the total =&gt; you must have already looked at all the later elements. Is the aim of your answer to demonstrate how to do this without laziness? If so, why not just foldr/cata into an <code>(listF,total) :: (a -&gt; [a],a)</code> pair and <code>uncurry ($)</code> it?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557957957, "post_id": 56121763, "comment_id": 98945327, "body": "@moonGoose (1) I feel your intuition is right, indeed. (2) I might be wrong about this, but I think this implementation relies on laziness in a similar way to the OP&#39;s: the hylomorphism is done in a single pass, and the percentages emitted by <code>percAlg</code> depend on the cap of the (virtual) intermediate list."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557960175, "post_id": 56121763, "comment_id": 98945842, "body": "(2) (In the nicest possible way) So what is the advantage of your implementation over a straightforward <code>foldr</code> to catamorphism translation? I suppose it does let you split up the <code>sum</code> from the <code>map</code>. It&#39;s worth observing that this only works because one of the catamorphisms (essentially <code>map (&#47;total)</code>) you have reexpressed as an anamorphism, which is possible in the example given but not in general."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557962590, "post_id": 56121763, "comment_id": 98946289, "body": "@moonGoose Arguable advantages include splitting up sum and map, as well as not having to functionalize the algebra. On the anamorphism, while I see your point, if something is expressible through multiple recursion schemes I feel it is fair game to take advantage of that. (Also, the anamorphic part of the hylomorphism here is the sum one, rather than the map one.)"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 1, "creation_date": 1557964296, "post_id": 56121763, "comment_id": 98946630, "body": "Ah good points. I see now that the <code>CapF</code> trick has essentially let you express a cata as an ana which just puts the cata result at the bottom of the structure, thus the other cata has access to it from the start. Now I&#39;m wondering about generalizing Capped over other structures such that you could use this trick for any cata pair."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557966324, "post_id": 56121763, "comment_id": 98946977, "body": "@moonGoose That&#39;s a neat summary; I&#39;m borrowing it for the answer :) The trick is especially nice when, unlike here, you can avoid roping that result up from the depths (a nice simple example is <code>span</code>)."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1557966320, "last_edit_date": 1557966320, "creation_date": 1557796485, "answer_id": 56121763, "question_id": 56121207, "link": "https://stackoverflow.com/questions/56121207/catamorphism-that-allows-looking-at-part-of-the-final-result/56121763#56121763", "title": "Catamorphism that allows looking at part of the final result", "body": "<p>Though this is not necessarily what you were looking for, we can encode the laziness trick with a hylomorphism:</p>\n\n<pre><code>{-# LANGUAGE LambdaCase #-}\n{-# LANGUAGE TupleSections #-}\n{-# LANGUAGE DeriveFunctor #-}\n{-# LANGUAGE DeriveFoldable #-}\n{-# LANGUAGE DeriveTraversable #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport Data.Functor.Foldable\nimport Data.Functor.Foldable.TH\n\ndata CappedList c a = Cap c | CCons a (CappedList c a)\n    deriving (Eq, Show, Ord, Functor, Foldable, Traversable)\nmakeBaseFunctor ''CappedList\n\n-- The seq here has no counterpart in the implementation in the question.\n-- It improves performance quite noticeably. Other seqs might be added for\n-- some of the other \"s\", as well as for the percentage; the returns, however,\n-- are diminishing.\ntoPercents :: Floating a =&gt; [a] -&gt; [a]\ntoPercents = snd . hylo percAlg sumCal . (0,)\n    where\n    sumCal = \\case\n        (s, []) -&gt; CapF s\n        (s, a : as) -&gt; s `seq` CConsF a (s + a, as)\n    percAlg = \\case\n        CapF s -&gt; (s, [])\n        CConsF a (s, as) -&gt; (s, (a * 100 / s) : as)\n</code></pre>\n\n<p>This corresponds to the laziness trick because, thanks to hylo fusion, the intermediate <code>CappedList</code> never actually gets built, and <code>toPercents</code> consumes the input list in a single pass. The point of using <code>CappedList</code> is, <a href=\"https://stackoverflow.com/questions/56121207/catamorphism-that-allows-looking-at-part-of-the-final-result/56121763?noredirect=1#comment98946630_56121763\">as moonGoose puts it</a>, placing the sum at the bottom of the (virtual) intermediate structure, so that the list rebuilding being done with <code>percAlg</code> can have access to it from the start.</p>\n\n<p>(It is perhaps worth noting that, even though it is done in a single pass, it seems difficult to get nice-and-constant memory usage from this trick, be it with my version or with yours. Suggestions on this front are welcome.) </p>\n"}, {"tags": [], "owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "is_accepted": false, "score": 0, "last_activity_date": 1557820961, "creation_date": 1557820961, "answer_id": 56125641, "question_id": 56121207, "link": "https://stackoverflow.com/questions/56121207/catamorphism-that-allows-looking-at-part-of-the-final-result/56125641#56125641", "title": "Catamorphism that allows looking at part of the final result", "body": "<p>Just crazy experiment. I think we can fuse smth.</p>\n\n<p>Also <code>fix = hylo (\\(Cons f a) -&gt; f a) (join Cons)</code> and we can replace on <code>fix</code></p>\n\n<pre><code>toPercents :: Floating a =&gt; [a] -&gt; [a]\ntoPercents xs = result\n  where\n    (_, result) = hylo (\\(Cons f a) -&gt; f a) (join Cons) $ \\(~(total, _)) -&gt; \n      let\n        alg Nil = (0, [])\n        alg (Cons x (a, as)) = (x + a, 100 * x / total: as)\n      in\n        cata alg xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "is_accepted": false, "score": 2, "last_activity_date": 1615399466, "last_edit_date": 1615399466, "creation_date": 1557942846, "answer_id": 56155117, "question_id": 56121207, "link": "https://stackoverflow.com/questions/56121207/catamorphism-that-allows-looking-at-part-of-the-final-result/56155117#56155117", "title": "Catamorphism that allows looking at part of the final result", "body": "<p>I don't think there's explicitly a scheme for allowing function 1 to peek at each step at the end result of function 2. It seems like a somewhat odd one to want though. I think that in the end, it's going to boil down to either 1) running function 2, then running function 1 with the known result of function 2 (ie. two passes, which I think is the only way to get constant memory in your example) or 2) running them side-by-side, creating a function thunk (or relying on laziness) to combine them at the end.</p>\n<p>The lazy <code>foldr</code> version you gave of course translates naturally into a catamorphism. Here's the functionalized catamorphism version,</p>\n<pre><code>{-# LANGUAGE LambdaCase #-}\n\nimport Data.Functor.Foldable    \n\ntoPercents :: Floating a =&gt; [a] -&gt; [a]\ntoPercents = uncurry ($) . cata alg\n  where\n    alg = \\case\n        Nil -&gt; (const [], 0)\n        Cons x (f,s) -&gt;  (\\t -&gt; 100*x / t : f t, s + x)\n</code></pre>\n<p>It doesn't seem nice stylistically to have to hand-parallelize the two catamorphisms though, particularly as then it doesn't encode the fact that neither stepwise-relies on the other. Hoogle finds <a href=\"https://hackage.haskell.org/package/hs-functors-0.1.4.0/docs/Data-Bicotraversable.html#v:bicotraverse\" rel=\"nofollow noreferrer\">bicotraverse</a>, but it's unnecessarily general, so let's write our algebra-parallelization operator <code>(&amp;&amp;&amp;&amp;)</code>,</p>\n<pre><code>import Control.Arrow\n\n(&amp;&amp;&amp;&amp;) :: Functor f =&gt; (f a -&gt; c) -&gt; (f b -&gt; d) -&gt; f (a,b) -&gt; (c,d)\nf1 &amp;&amp;&amp;&amp; f2 = (f1 . fmap fst &amp;&amp;&amp; f2 . fmap snd)\n\ntoPercents' :: Floating a =&gt; [a] -&gt; [a]\ntoPercents' = uncurry ($) . cata (algList &amp;&amp;&amp;&amp; algSum)\n\nalgSum :: (Num a) =&gt; ListF a a -&gt; a\nalgSum = \\case\n    Nil -&gt; fromInteger 0\n    Cons x !s -&gt; s + x\n\nalgList :: (Fractional a) =&gt; ListF a (a -&gt; [a]) -&gt; (a -&gt; [a])   \nalgList = \\case\n    Nil -&gt; const []\n    Cons x s -&gt; (\\t -&gt; 100*x / t : s t) \n</code></pre>\n"}], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 2, "answer_count": 3, "score": 6, "last_activity_date": 1615399466, "creation_date": 1557791266, "last_edit_date": 1557792213, "question_id": 56121207, "link": "https://stackoverflow.com/questions/56121207/catamorphism-that-allows-looking-at-part-of-the-final-result", "title": "Catamorphism that allows looking at part of the final result", "body": "<p>Is there a name for a recursion scheme that's like a catamorphism, but that allows peeking at the final result while it's still running? Here's a slighly contrived example:</p>\n\n<pre><code>toPercents :: Floating a =&gt; [a] -&gt; [a]\ntoPercents xs = result\n  where\n  (total, result) = foldr go (0, []) xs\n  go x ~(t, r) = (x + t, 100*x/total:r)\n\n{-\n&gt;&gt;&gt; toPercents [1,2,3]\n[16.666666666666668,33.333333333333336,50.0]\n-}\n</code></pre>\n\n<p>This example uses <code>total</code> at each step of the fold, even though its value isn't known until the end. (Obviously, this relies on laziness to work.)</p>\n"}, {"tags": ["haskell", "primes", "lazy-evaluation"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1557778223, "post_id": 56119201, "comment_id": 98871615, "body": "you&#39;re trying to filter a list to keep only those elements that are not divisible by any element of <code>init prime</code>. In order to check that for every element of <code>init prime</code>, Haskell needs to figure out all the elements (except the &quot;last one&quot;) of <code>prime</code>. Now can you see the problem? Lazy evaluation doesn&#39;t help you when you need the full data structure to compute an intermediate result."}, {"owner": {"reputation": 35704, "user_id": 4958, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ca82d17e7496d3c20b9c8038f87ae49?s=128&d=identicon&r=PG", "display_name": "ShreevatsaR", "link": "https://stackoverflow.com/users/4958/shreevatsar"}, "edited": false, "score": 3, "creation_date": 1557778482, "post_id": 56119201, "comment_id": 98871705, "body": "You can rescue your idea by replacing <code>(init prime)</code> with <code>(takeWhile (\\z -&gt; z * z &lt;= x) prime)</code> as every non-prime number has a prime factor not greater than its square root."}, {"owner": {"reputation": 2843, "user_id": 113644, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LWJVp.png?s=128&g=1", "display_name": "G B", "link": "https://stackoverflow.com/users/113644/g-b"}, "edited": false, "score": 0, "creation_date": 1557778574, "post_id": 56119201, "comment_id": 98871732, "body": "I see, but then: is there another way to use the partial result to calculate the next element of the infinite list? I find it confusing that it&#39;s not an error, because it&#39;s obviously wrong."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1557778664, "post_id": 56119201, "comment_id": 98871768, "body": "Your call to <code>init primes</code> suggest you think each iteration will only see the list as constructed up to this point.  If that is your belief then it is wrong, the <code>primes</code> list simply isn&#39;t fully computed.  Avoid using the portion of the list you&#39;re generating such as is done in ShreevatsaR&#39;s comment."}, {"owner": {"reputation": 2843, "user_id": 113644, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LWJVp.png?s=128&g=1", "display_name": "G B", "link": "https://stackoverflow.com/users/113644/g-b"}, "edited": false, "score": 1, "creation_date": 1557778809, "post_id": 56119201, "comment_id": 98871815, "body": "Yes, that works of course, thanks, I just wanted to understand if it&#39;s possible to extend an infinite list recursively by using a part of the list itself for calculating the next elements."}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "reply_to_user": {"reputation": 35704, "user_id": 4958, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ca82d17e7496d3c20b9c8038f87ae49?s=128&d=identicon&r=PG", "display_name": "ShreevatsaR", "link": "https://stackoverflow.com/users/4958/shreevatsar"}, "edited": false, "score": 3, "creation_date": 1557778885, "post_id": 56119201, "comment_id": 98871839, "body": "It absolutely is; that&#39;s what @ShreevatsaR&#39;s comment recommends. The only reason yours doesn&#39;t work is that the part of the infinite list used (<code>init</code>) overlaps with the part of the list that is being produced. If you prevent that overlap by using an appropriate <code>takeWhile</code>, no problems."}, {"owner": {"reputation": 2843, "user_id": 113644, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LWJVp.png?s=128&g=1", "display_name": "G B", "link": "https://stackoverflow.com/users/113644/g-b"}, "edited": false, "score": 0, "creation_date": 1558091124, "post_id": 56119201, "comment_id": 98995463, "body": "I don&#39;t get it, sorry. I tried, but inits is just as undefined as init in this case."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557780356, "post_id": 56119444, "comment_id": 98872407, "body": "Two objections: <code>init</code> isn&#39;t applied ever to <code>[5..]</code>, so the explanation of what <code>init [5..]</code> does seems irrelevant; and we absolutely have <i>not</i> already established that <code>prime</code> is an infinite list (indeed, it <i>isn&#39;t</i> an infinite list, so we certainly can&#39;t establish that it is)."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557780456, "post_id": 56119444, "comment_id": 98872451, "body": "@DanielWagner Argh, right on both counts. I&#39;ve managed to out do myself with this one, I don&#39;t think I can salvage this answer"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557780510, "post_id": 56119444, "comment_id": 98872476, "body": "@Cubic I believe in you!"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1557781791, "post_id": 56119444, "comment_id": 98872913, "body": "@Cubic Without the removal of <code>init</code>, your argument essentially stills works, but becomes a bit more complicated. <code>let prime_rest = filter f [5..]</code> (with appropriate <code>f</code>); then you can apply your reasoning to deduce that <code>prime_rest = case f 5 of { True -&gt; 5 : prime_rest1; False -&gt; prime_rest1 } where prime_rest1 = filter f [6..]</code> (with some rewriting of the definition of filter). But to evaluate <code>f 5</code> you must first determine if <code>prime_rest</code> is <code>[]</code> or <code>_:_</code> (by the definiton of <code>f</code> and <code>init</code>); and <code>prime_rest</code> is the very expression you&#39;re currently evaluating."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1557781877, "post_id": 56119444, "comment_id": 98872942, "body": "@Cubic In other words, you can rewrite <code>prime_rest</code> to <code>case prime_rest of { [] -&gt; ..; [x] -&gt; ..; (x:xs) -&gt; .. }</code> with the outermost <code>case</code> statement being the definition of <code>init</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1558081160, "post_id": 56119444, "comment_id": 98990247, "body": "lotsa one-liners <a href=\"https://wiki.haskell.org/Prime_numbers_miscellaneous#One-liners\" rel=\"nofollow noreferrer\">here</a>. :)"}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 10, "last_activity_date": 1557781919, "last_edit_date": 1557781919, "creation_date": 1557779183, "answer_id": 56119444, "question_id": 56119201, "link": "https://stackoverflow.com/questions/56119201/primes-in-haskell/56119444#56119444", "title": "Primes in Haskell", "body": "<p>Well, for one let's look at what <code>init</code> does for a finite list:</p>\n\n<pre><code>init [1] == []\ninit [1,2] == [1]\ninit [1,2,3] == [1,2]\n</code></pre>\n\n<p>ok, so it gives us all but the last element of the list.</p>\n\n<p>So what's <code>init primes</code>? Well, <code>prime</code> without the last element. Hopefully if we implemented <code>prime</code> correctly it shouldn't <em>have</em> a last element (because there are infinitely many primes!), but more importantly we don't quite need to care yet because we don't have the full list for now anyway - we only care about the first couple of elements after all, so <em>for us</em> it's pretty much the same as just <code>prime</code> itself.</p>\n\n<p>Now, looking at <code>all</code>: What does this do? Well, it takes a list and a predicate and tells us if all the elements of the list satisfy the predicate:</p>\n\n<pre><code>all (&lt;5) [1..4] == True\nall even [1..4] == False\n</code></pre>\n\n<p>it even works with infinite lists!</p>\n\n<pre><code>all (&lt;5) [1..] == False\n</code></pre>\n\n<p>so what's going on here? Well, here's the thing: It does work with infinite lists... but only if we can actually evaluate the list up to the first element of the list that violates the predicate! Let's see if this holds true here:</p>\n\n<pre><code>all (\\y -&gt; (mod 5 y) &gt; 0) (init prime)\n</code></pre>\n\n<p>so to find out if <code>5</code> is a prime number, we'd have to check if there's a number in prime minus the last element of prime that divides it. Let's see if we can do that.</p>\n\n<p>Now let's look at the definition of prime, we get</p>\n\n<pre><code>all (\\y -&gt; (mod 5 y) &gt; 0) (2:3:filter (\\x -&gt; all (\\y -&gt; (mod x y) &gt; 0) (init prime)) [5..])\n</code></pre>\n\n<p>So to determine whether 5 is a prime number, we only have to check if it's:</p>\n\n<ol>\n<li>divisible by 2 - it's not, let's continue</li>\n<li>divisible by 3 - still no</li>\n<li>divisible by ...? Well, we're in the process of checking what the 3rd prime is so we don't know yet...</li>\n</ol>\n\n<p>and there's the crux of the problem. With this logic, to determine the third prime number you need to know the third prime number! Of course logically, we actually <em>don't</em> want to check this at all, rather we only need to check if any of the <em>smaller</em> prime numbers are divisors of the current candidate.</p>\n\n<p>So how do we go about doing that? Well, we'll have to change our logic unfortunately. One thing we can do is try to remember how many primes we already have, and only take as many as we need for our comparison:</p>\n\n<pre><code>prime = 2 : 3 : morePrimes 2 [5..]\n  morePrimes n (x:xs)\n    | all (\\y -&gt; mod x y &gt; 0) (take n prime) = x : morePrimes (n+1) xs\n    | otherwise                              = morePrimes n xs\n</code></pre>\n\n<p>so how does this work? Well, it basically does what we were just talking about: We remember how many primes we already have (starting at <code>2</code> because we know we have at least <code>[2,3]</code> in <code>n</code>. We then check if our next prime is divisible by any of the of <code>n</code> primes we already know by using <code>take n</code>, and if it is we know it's our next prime and we need to increment <code>n</code> - otherwise we just carry on.</p>\n\n<p>There's also the more well known form inspired by (although not quite the same as) the Sieve of Eratosthenes:</p>\n\n<pre><code>prime = sieve [2..] where\n  sieve (p:xs) = p : sieve (filter (\\x -&gt; mod x p &gt; 0) xs)\n</code></pre>\n\n<p>so how does this work? Well, again with a similar idea: We know that the next prime number needs to be non-divisible by any previous prime number. So what do we do? Well, starting at <code>2</code> we know that the first element in the list is a prime number. We then throw away every number divisible by that prime number using <code>filter</code>. And afterwards, the next item in the list is going to be a prime number again (because we didn't throw it away), so we can repeat the process.</p>\n\n<p>Neither of these are one liners like the one you were hoping for though.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1559128232, "creation_date": 1559128232, "answer_id": 56359208, "question_id": 56119201, "link": "https://stackoverflow.com/questions/56119201/primes-in-haskell/56359208#56359208", "title": "Primes in Haskell", "body": "<p>If the code in <a href=\"https://stackoverflow.com/a/56119444/849891\">the other answer</a> is restructured under the identity</p>\n\n<pre><code>[take n primes | n &lt;- [0..]]  ==  inits primes\n</code></pre>\n\n<p>eventually we get</p>\n\n<pre><code>import Data.List\n              -- [ ([], 2), ([2], 3), ([2,3], 5), ... ]\nprimes = 2 : [ c | (ps, p) &lt;- zip (inits primes) primes,  \n                   c &lt;- take 1 [c | c &lt;- [p+1..], \n                                    and [mod c p &gt; 0 | p &lt;- ps]]]\n</code></pre>\n\n<p>Further improving it algorithmically, it becomes</p>\n\n<pre><code>primes = 2 : [ c | (ps, r:q:_) &lt;- zip (inits primes)                  -- [] [3,4,...]\n                                      (tails $ 3 : map (^2) primes),  -- [2] [4,9,...]\n                   c &lt;- [r..q-1], and [mod c p &gt; 0 | p &lt;- ps]]        -- [2,3] [9,25,...]\n</code></pre>\n"}], "owner": {"reputation": 2843, "user_id": 113644, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LWJVp.png?s=128&g=1", "display_name": "G B", "link": "https://stackoverflow.com/users/113644/g-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 310, "favorite_count": 1, "accepted_answer_id": 56119444, "answer_count": 2, "score": 5, "last_activity_date": 1559128232, "creation_date": 1557777933, "question_id": 56119201, "link": "https://stackoverflow.com/questions/56119201/primes-in-haskell", "title": "Primes in Haskell", "body": "<p>I'm learning Haskell, and I've tried to generate an infinite list of primes, but I can't understand what my function is doing wrong.</p>\n\n<p>The function:</p>\n\n<pre><code>prime = 2:3:filter (\\x -&gt; all (\\y -&gt; (mod x y) &gt; 0) (init prime)) [5..]\n</code></pre>\n\n<p>I think it's the <code>init prime</code>, but the strange thing is that even if I set an upper bound to the range (<code>5..10</code> for example), the function loops forever and never gets any result for <code>prime !! 2</code></p>\n\n<p>Can you please tell me what I'm doing wrong?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557774535, "post_id": 56118477, "comment_id": 98870149, "body": "Well your <code>f x</code> will return something of type <code>E a</code> here, so you can just implement a functoin that &quot;unpacks&quot; the data constructor, and performs operations with it."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1557775763, "post_id": 56118477, "comment_id": 98870675, "body": "Did you mean <code>instance Monad E where ...</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1557775865, "post_id": 56118477, "comment_id": 98870711, "body": "That should also be <code>None &gt;&gt;= _ = None</code>, not <code>_ &gt;&gt;= None = None</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1557776484, "post_id": 56118477, "comment_id": 98870956, "body": "If you ignore the <code>B</code> constructor, this looks like a list, so you might get some inspiration by looking at the <code>Monad []</code> implementation.  What is this data type supposed to represent -- what do the various constructors <code>A</code>, <code>B</code>, <code>None</code> mean?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557776621, "post_id": 56118477, "comment_id": 98871014, "body": "<code>B</code> itself is somewhat redundant; <code>B</code> is basically <code>flip A None</code>."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1557776683, "post_id": 56118477, "comment_id": 98871040, "body": "I am sorry i wanted to represent something like a tree, but i wanted to simplify it with only one branch since i was interested only in the last case : dealing with a type constructor  that has a data constructor which holds both a concrete type and a [Type constructor] concrete_type. <code>data SomeType a=Ctor1 a (SomeType a) |......</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1557778702, "post_id": 56118477, "comment_id": 98871779, "body": "To reemphasize, you don&#39;t need a separate leaf constructor if you allow for empty trees with <code>None</code>: a leaf is just an <code>A</code> with no subtrees, <code>A x None None</code>. Probable duplicate: <a href=\"https://stackoverflow.com/q/6798699/1126841\">Monad instance for binary tree</a>."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1557829444, "post_id": 56118477, "comment_id": 98887748, "body": "I have updated my original post.However now my free variable must be a monoid is that not true ?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1558076896, "post_id": 56118477, "comment_id": 98988154, "body": "Your <code>unwrap</code> strategy is not going to work. The essence is to &quot;reshuffle&quot; <code>m (m a)</code> to an <code>m a</code>, preserving all the information.  It is not usually possible to pass through <code>m a -&gt; a</code> because that throws away information."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1558077177, "post_id": 56118477, "comment_id": 98988296, "body": "So what can i do with the free variable that is not an <code>ma</code> ?  How do i go from <code>a</code> -&gt; <code>m a</code> , apply the <code>f</code> and get it back to <code>a</code> , since clearly i have a data with both <code>[Constructor]  a  (m a)</code>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1558078925, "post_id": 56118477, "comment_id": 98989115, "body": "@BercoviciAdrian, it is not necessarily easy (fyi I do not see a solution); for many types it is not possible at all. Your <code>f x</code> returns a tree, and you also have the two trees you got from binding the children <code>mx&gt;&gt;=f</code> and <code>my&gt;&gt;=f</code>.  You need to decide what goes at the root of the result. What should go there? The root of <code>f x</code>? What if <code>f x</code> is empty? These questions need answers, and you get these answers from your <i>intention</i>. What is this data type a model of?"}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1558079257, "post_id": 56118477, "comment_id": 98989279, "body": "Its a binary tree , with some data stored at each node."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1558079293, "post_id": 56118477, "comment_id": 98989297, "body": "@BercoviciAdrian, does that answer what to put at the root of the tree that bind returns?  What makes you think a binary tree is a monad?"}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1558080631, "post_id": 56118477, "comment_id": 98989985, "body": "I thought i could make it , if only i could unwrap the root. (Still learning)"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1557777579, "post_id": 56118984, "comment_id": 98871360, "body": "Perhaps some intuition can be obtained using <code>data F a k = A a k | None</code> and then defining <code>type E a = Free (F a)</code>. Here, <code>Pure</code> would play the role of <code>B</code> in the original type. This, however, is probably NOT what the OP wants (?)."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 3, "last_activity_date": 1557776866, "creation_date": 1557776866, "answer_id": 56118984, "question_id": 56118477, "link": "https://stackoverflow.com/questions/56118477/implementing-monad-on-recursive-type/56118984#56118984", "title": "Implementing monad on recursive type", "body": "<p>To overcome your specific challenge, you should try pattern matching on the result of <code>f x</code>.</p>\n\n<pre><code>(&gt;&gt;=) (A x mx) f = \n    case f x of\n        A y my -&gt; \n        B y -&gt; \n        None -&gt; \n</code></pre>\n\n<p>Now you have perhaps a larger problem than the one you came in with.  There are now too many choices, as opposed to a poverty of them.  In the <code>A y my</code> case, you must combine <code>y</code>, <code>my</code>, and <code>mx</code> into the final result in some way.  Very likely most of the ways you think of will violate the laws.</p>\n\n<p>In this case it is hard to know what to do.  It is hard for me to implement a monad unless I am clear about the <em>meaning</em> of the data type.  I can \"visualize\" list as a monad because <code>join</code> (aka <code>(&gt;&gt;= id)</code>) is just concatenation</p>\n\n<pre><code>join :: [[a]] -&gt; [a]\njoin [ [ x, y ], [z], [], [w, q] ] = [x, y, z, w, q]\n</code></pre>\n\n<p>But for an arbitrary algebraic data type there is no clear path.  Where did this data type come from? -- what do you want from its monad instance? </p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1557829830, "creation_date": 1557774364, "last_edit_date": 1557829830, "question_id": 56118477, "link": "https://stackoverflow.com/questions/56118477/implementing-monad-on-recursive-type", "title": "Implementing monad on recursive type", "body": "<p>I have a recursive type: <br><code>data E a=A a (E a) (E a) | None</code><br>\nMy problem is the following :<br>\nIf i want to implement the <code>bind</code> operator how do i operate on both the Concrete type and the recursive one given the function to operate with?</p>\n\n<pre><code>instance Monad E where\n    return x= A x None None \n    (&gt;&gt;=) None _ = None\n    (&gt;&gt;=) (B t) f =  f t\n    (&gt;&gt;=) (A x mx my) f = A {f x} (mx&gt;&gt;=f)  (my&gt;&gt;=f) --here !!!\n                               ^\n                            result is ma but slot requires concrete type\n</code></pre>\n\n<p>For me to apply <code>&gt;&gt;=</code> on  <code>A a (E a) (E a)</code> for the <code>a</code> it seems i  need to unwrap it using a custom made <code>function</code>.</p>\n\n<p>How do i solve the <code>{f x}</code>so that i unwrap the result of <code>f x</code> to fit in the concrete slot of the <code>E</code></p>\n\n<p>I would need for a method that can take a function: <code>a-&gt; ma</code> and get it to <code>(ma -&gt;a)</code></p>\n\n<pre><code>    unwrap::E a-&gt;a\n    unwrap None= what here ? ( i need a neutral element for any kind of a)\n    unwrap (A x _ _)=x\n</code></pre>\n"}, {"tags": ["haskell", "tuples", "variable-assignment"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1557774202, "post_id": 56117822, "comment_id": 98870003, "body": "The \u2018best\u2019 way is to using tuples and use a record instead. This helps with understanding what your type represents, too."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 4, "creation_date": 1557776147, "post_id": 56117822, "comment_id": 98870825, "body": "@AJFarmar I think you accidentally a word. &quot;stop using tuples&quot; perhaps?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 1, "creation_date": 1557782211, "post_id": 56117822, "comment_id": 98873067, "body": "@moonGoose I&#39;m rationing my words. They don&#39;t grow on trees you know!"}], "answers": [{"tags": [], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "is_accepted": true, "score": 12, "last_activity_date": 1557771708, "creation_date": 1557771708, "answer_id": 56117890, "question_id": 56117822, "link": "https://stackoverflow.com/questions/56117822/how-to-modify-just-one-element-of-a-tuple-without-rewriting-it-completely/56117890#56117890", "title": "How to modify just one element of a tuple without rewriting it completely?", "body": "<p>I assume by \"rewriting the whole tuple\" you mean something like,</p>\n\n<pre><code>(\\(a,b,_,d,e) -&gt; (a,b,3.2,d,e))\n</code></pre>\n\n<p>There are <a href=\"http://hackage.haskell.org/package/lens-4.17.1/docs/Control-Lens-Tuple.html\" rel=\"noreferrer\">lenses</a> for tuples, the link has plenty of examples.</p>\n\n<pre><code>_3 .~ (3.2 :: Double)\n</code></pre>\n"}], "owner": {"reputation": 6365, "user_id": 4385532, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/0573709d0b88e4b50af0e28c3e96873b?s=128&d=identicon&r=PG&f=1", "display_name": "gaazkam", "link": "https://stackoverflow.com/users/4385532/gaazkam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 56117890, "answer_count": 1, "score": 2, "last_activity_date": 1557771708, "creation_date": 1557771393, "question_id": 56117822, "link": "https://stackoverflow.com/questions/56117822/how-to-modify-just-one-element-of-a-tuple-without-rewriting-it-completely", "title": "How to modify just one element of a tuple without rewriting it completely?", "body": "<p><a href=\"https://stackoverflow.com/questions/55837998/how-to-modify-just-one-field-of-a-record-without-rewriting-it-completely\">How to modify just one field of a record without rewriting it completely?</a></p>\n\n<p>Here I learned a helpful Haskell syntax to modify an element of a record without rewriting it completely:</p>\n\n<pre><code>oldrecord { somefield = newvalue }\n</code></pre>\n\n<p>Is something similar possible with tuples?</p>\n\n<pre><code>type ABigTuple = (Int, Int, Double, Int, String)\n\naBigTuple :: ABigTuple\naBigTuple = (5, 6, 3.2, 10, \"asdf\") \n\nanotherBigTuple = -- replace the 3rd elt of the prev tuple with 5.5 i/o 3.2\n</code></pre>\n\n<p>Is this possible in a manner similar to records, or do I have to rewrite the whole tuple?</p>\n"}, {"tags": ["haskell", "io"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1557774129, "post_id": 56117519, "comment_id": 98869977, "body": "<code>putStrLn</code> is the only thing defined by <i>Haskell</i>. Everything below that, in this case from <code>hPutStrLn</code> on down, is an implementation detail of GHC."}], "tags": [], "owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "is_accepted": true, "score": 6, "last_activity_date": 1557820113, "last_edit_date": 1557820113, "creation_date": 1557769908, "answer_id": 56117519, "question_id": 56117518, "link": "https://stackoverflow.com/questions/56117518/how-does-haskells-putstrln-perform-its-effect/56117519#56117519", "title": "How does Haskell&#39;s putStrLn perform its effect?", "body": "<h1>Using C</h1>\n\n<p>Seeing in <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/System.IO.html#putStrLn\" rel=\"nofollow noreferrer\">base</a> that</p>\n\n<pre><code>putStrLn s      =  hPutStrLn stdout s\n</code></pre>\n\n<p>I followed a trail of functions that eventually lead me to <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/System.Posix.Internals.html#c_write\" rel=\"nofollow noreferrer\"><code>c_write</code></a> which is defined like this:</p>\n\n<pre><code>foreign import capi unsafe \"HsBase.h _write\"\n  c_write :: CInt -&gt; Ptr Word8 -&gt; CUInt -&gt; IO CInt\n</code></pre>\n\n<p>Thus, it seems that the effect of writing to stdout is performed by calling native code.</p>\n\n<hr>\n\n<p>Some stops on my journey jumping from function to function (the arrow \u2192 means that the left function calls the right one):</p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.IO.Handle.Text.html#hPutStr%27\" rel=\"nofollow noreferrer\"><code>hPutStr'</code></a> \u2192 <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.IO.Handle.Text.html#writeBlocks\" rel=\"nofollow noreferrer\"><code>writeBlocks</code></a> \u2192 <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.IO.Handle.Text.html#commitBuffer\" rel=\"nofollow noreferrer\"><code>commitBuffer</code></a> \u2192 <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.IO.Handle.Internals.html#writeCharBuffer\" rel=\"nofollow noreferrer\"><code>writeCharBuffer</code></a>.</p>\n\n<p>Then, <code>writeCharBuffer</code> calls the typeclass method <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.IO.BufferedIO.html#flushWriteBuffer\" rel=\"nofollow noreferrer\"><code>BufferedIO.flushWriteBuffer</code></a> on <code>stdout</code>.</p>\n\n<p>Continuing in <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.IO.Handle.FD.html#stdout\" rel=\"nofollow noreferrer\"><code>stdout</code>'s typeclass instance</a> for <code>BufferedIO</code>:</p>\n\n<p><code>flushWriteBuffer</code> \u2192 <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.IO.FD.html#writeBuf%27\" rel=\"nofollow noreferrer\"><code>writeBuf'</code></a> \u2192 <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.IO.BufferedIO.html#writeBuf\" rel=\"nofollow noreferrer\"><code>writeBuf</code></a>. <code>writeBuf</code> calls <code>IODevice.write</code> on a <code>RawIO</code> device, also a typeclass for which there is an <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.IO.FD.html#line-97\" rel=\"nofollow noreferrer\">instance for stdout</a>. <code>write</code> relays to <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.IO.FD.html#fdWrite\" rel=\"nofollow noreferrer\"><code>fdwrite</code></a>.</p>\n\n<p><code>fdWrite</code> calls <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.IO.FD.html#writeRawBufferPtr\" rel=\"nofollow noreferrer\"><code>writeRawBufferPtr</code></a> \u2192 <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.IO.FD.html#local-6989586621679367082\" rel=\"nofollow noreferrer\"><code>do_write</code></a> which finally calls <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/System.Posix.Internals.html#c_write\" rel=\"nofollow noreferrer\"><code>c_write</code></a>.</p>\n"}], "owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "closed_date": 1557774055, "accepted_answer_id": 56117519, "answer_count": 1, "score": 1, "last_activity_date": 1557820113, "creation_date": 1557769908, "question_id": 56117518, "link": "https://stackoverflow.com/questions/56117518/how-does-haskells-putstrln-perform-its-effect", "closed_reason": "Duplicate", "title": "How does Haskell&#39;s putStrLn perform its effect?", "body": "<p>I'm wondering how <code>putStrLn</code> works: I can see that it has type <code>IO ()</code> but I've no notion of how Haskell actually performs the side effect of writing to standard out.</p>\n\n<pre><code>main :: IO ()\nmain = putStrLn \"Test\"\n</code></pre>\n\n<p>How does this program write to standard out?</p>\n"}, {"tags": ["haskell", "types", "compiler-construction", "type-inference"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 4, "creation_date": 1557767644, "post_id": 56116916, "comment_id": 98867342, "body": "&quot;official&quot; discussion doesn&#39;t get too formal.  Often times you&#39;re talking about hallway discussions at ICFP and emails on _@haskell.org.  If you are so inclined then write up a proposal and patch set for GHC."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1557769517, "post_id": 56116916, "comment_id": 98868093, "body": "I don&#39;t think you will find a more official answer than what&#39;s on the wiki. Infix expressions look like a minor feature for which there&#39;s, arguably, very little demand."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1557769610, "post_id": 56116916, "comment_id": 98868124, "body": "My personal headcanon for how a sensible extension for this would work would be to introduce &quot;`(&quot; and &quot;)`&quot; as the start and end tokens. It isn&#39;t currently allowed to put anything inside backquotes, so this shouldn&#39;t break any existing code, and it ought to make nesting unambiguous. There is some question about whether it could introduce some new ambiguity, though; e.g. consider <code>(foo)`bar`(baz)</code> which is currently valid and contains both new tokens..."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1557787975, "post_id": 56116916, "comment_id": 98874466, "body": "Strings are an example of a construct with the same start and end token. Which suggests backslash escapes as a possibility for handling nesting. I prefer Daniel Wagner&#39;s suggested syntax though. I also lean towards the &quot;you just can&#39;t nest them&quot; non-solution, given you can always use <code>let</code> binds to avoid the need for nesting, and that&#39;s likely to be clearer a lot of the time."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557788380, "post_id": 56116916, "comment_id": 98874533, "body": "I have sometimes wanted this feature. The vast majority of the time, I want a simple partial application in the middle. One big example is <code>xs `(liftA2 f)` ys</code> (where I specifically want <code>liftA2</code> and not a combination of <code>fmap</code> with <code>&lt;*&gt;</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557769252, "post_id": 56117303, "comment_id": 98867982, "body": "<code>infixl 3</code> seems pretty arbitrary. Why 3?"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557769360, "post_id": 56117303, "comment_id": 98868030, "body": "I saw some similar things in my searches (guess I should have mentioned it) but was looking for something more directly answering, why doesn&#39;t it exist <i>as part of the language</i> (either for historical or practical reasons)?"}], "tags": [], "owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "is_accepted": false, "score": 5, "last_activity_date": 1557768914, "creation_date": 1557768914, "answer_id": 56117303, "question_id": 56116916, "link": "https://stackoverflow.com/questions/56116916/why-doesnt-haskell-allow-more-complex-infix-expressions/56117303#56117303", "title": "Why doesn&#39;t Haskell allow more complex infix expressions?", "body": "<p>It can be faked</p>\n\n<pre><code>import Data.Function ( (&amp;) ) -- = flip ($)\n\ninfixl 3\n &lt;|,\n |&gt;\n\n(&lt;|) :: a -&gt; (a -&gt; b) -&gt; b\n(&lt;|) = (&amp;)\n\n(|&gt;) :: (a -&gt; b) -&gt; (a -&gt; b)\n(|&gt;) = ($)\n\nas :: Num c =&gt; [c] -&gt; [c] -&gt; [c]\nas xs ys = xs &lt;|zipWith (+)|&gt; ys\n\nbs :: (Int -&gt; Int -&gt; a -&gt; b -&gt; c) -&gt; (a -&gt; b -&gt; c)\nbs f l r = l &lt;|f 0 0|&gt; r\n</code></pre>\n\n<p>See also <a href=\"http://hackage.haskell.org/package/InfixApplicative-1.0.1/docs/Control-Applicative-Infix.html\" rel=\"noreferrer\">InfixApplicative</a></p>\n\n<pre><code>-- &gt;&gt; cs\n-- [9,19,29,39,8,18,28,38]\n\ncs :: [Int]\ncs = [1..2] &lt;^flip (-)^&gt; [10,20..40]\n</code></pre>\n"}], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1557768914, "creation_date": 1557767198, "question_id": 56116916, "link": "https://stackoverflow.com/questions/56116916/why-doesnt-haskell-allow-more-complex-infix-expressions", "title": "Why doesn&#39;t Haskell allow more complex infix expressions?", "body": "<p>Why doesn't Haskell allow more complex infix expressions, eg.</p>\n\n<pre><code>xs `zipWith (+)` ys\nl `f 0 0` r\n</code></pre>\n\n<p>It seems to have been <a href=\"https://wiki.haskell.org/Infix_expressions\" rel=\"nofollow noreferrer\">floated</a> since at least 2007. </p>\n\n<p><a href=\"https://wiki.haskell.org/Syntactic_sugar/Cons#Flexibility\" rel=\"nofollow noreferrer\">This page</a> suggests that it's because of problems parsing nested infix expressions, eg. </p>\n\n<pre><code>x `a `f` b` y\n</code></pre>\n\n<p>But I haven't found any \"official\" source for a discussion about it. Is this definitely the reason why, and does it preclude anything other than what we currently have? Obviously one simple solution would be to allow any expression that does not itself contain any infix notation, but is that too ad-hoc? Is the ambiguity insurmountable by a compiler, or is it simply regarded that any potential gains are not worth the effort? I can't immediately think of a comparable construct ie. where the \"start\" and \"end\" tokens are the same, and thus whether it's a solved problem or not.</p>\n"}, {"tags": ["list", "haskell", "char", "int"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557764114, "post_id": 56116208, "comment_id": 98865900, "body": "That&#39;s because it can not parse a <code>&quot;2,2&quot;</code> to an <code>Int</code>, or at least not directly."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557764146, "post_id": 56116208, "comment_id": 98865911, "body": "Hint: your signature for <code>f</code> is not entirely correct."}, {"owner": {"reputation": 101, "user_id": 11493867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03b70e3500af8bde8fc6b7b7d862e08b?s=128&d=identicon&r=PG&f=1", "display_name": "alekq", "link": "https://stackoverflow.com/users/11493867/alekq"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557764280, "post_id": 56116208, "comment_id": 98865972, "body": "can you explain or give me a hint  how to parse it not directly"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557764314, "post_id": 56116208, "comment_id": 98865988, "body": "you can split it with comma as a separator."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557773635, "post_id": 56116208, "comment_id": 98869763, "body": "I could imagine a list like that coming up because somebody called <code>lines</code> on the contents of a CSV file. If that&#39;s the situation you are in, then I strongly recommend using a real CSV parser library (say, cassava), so that you correctly handle escaping and the like."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1557765904, "post_id": 56116406, "comment_id": 98866645, "body": "Good point about <code>catMaybes</code>. Maybe you should add <code>traverse</code> and I should delete my otherwise inferior answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1557767657, "post_id": 56116406, "comment_id": 98867347, "body": "<code>readEither</code>, sadly, produces only useless error messages. The underlying parsers lack proper error handling support. Techniques like that become useful when you upgrade from <code>Read</code> to a real parsing system like <code>megaparsec</code>, <code>attoparsec</code>, <code>optparse-applicative</code>, <code>cassava</code>, etc."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1557772566, "last_edit_date": 1557772566, "creation_date": 1557764906, "answer_id": 56116406, "question_id": 56116208, "link": "https://stackoverflow.com/questions/56116208/haskell-char-to-int/56116406#56116406", "title": "haskell [[Char]] to [[Int]]", "body": "<p>The reason that this fails is because a string <code>\"2,2\"</code> can not be converted to an <code>Int</code> itself: this is a digit followed by a comma, followed by a digit. An <code>Int</code> is parsed by an optional minus sign, followed by some digits, and some extra possibilities like hexadecimal numbers, but let us ignore these for now.</p>\n\n<p>The type signature you specify for <code>f</code> is however incorrect, based on the expected output. Your output type seems to be a list of <em>lists</em> of <code>Int</code>s, so <code>[[Int]]</code>. That means that you should specify <code>f</code> as:</p>\n\n<pre><code>f :: [String] -&gt; <b>[[Int]]</b>\nf = ...</code></pre>\n\n<p>We thus need to read every <code>String</code> to an <code>[Int]</code>. We can not use <code>read</code> directly here, since <code>read</code>ing to an <code>[Int]</code> expects the string to start and end with <em>square brackets</em>. We can however add these manually like:</p>\n\n<pre><code>f :: [String] -&gt; [[Int]]\nf = map (<b>\\s -&gt; read ('[' : s ++ &quot;]&quot;)</b>)</code></pre>\n\n<p>or a <em>point-free</em> version:</p>\n\n<pre><code>f :: [String] -&gt; [[Int]]\nf = map (<b>read . ('[' :) . (++ &quot;]&quot;)</b>)</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; f [\"2\",\"2\",\"1\",\"2,2\",\"1\"] \n[[2],[2],[1],[2,2],[1]]\n</code></pre>\n\n<h1>Towards <em>safer</em> parsing with <code>readMaybe</code></h1>\n\n<p>Parsing from <code>String</code>s like in the above way is of course not very \"<em>safe</em>\", since it is possible that the <code>String</code> does not follow the format. We can make this more safe and use for example <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Text-Read.html#v:readMaybe\" rel=\"nofollow noreferrer\"><strong><code>readMaybe :: Read a =&gt; String -&gt; Maybe a</code></strong></a>:</p>\n\n<pre><code>import Text.Read(<b>readMaybe</b>)\n\nf :: [String] -&gt; [<b>Maybe</b> [Int]]\nf = map (<b>readMaybe</b> . ('[' :) . (++ &quot;]&quot;))</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude Text.Read&gt; f [\"2\", \"3;2\", \"4,7,3\", \"bla\"]\n[Just [2],Nothing,Just [4,7,3],Nothing]\n</code></pre>\n\n<p>we can omit the failed reads for example by using <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Maybe.html#v:catMaybes\" rel=\"nofollow noreferrer\"><strong><code>catMaybes :: [Maybe a] -&gt; [a]</code></strong></a>:</p>\n\n<pre><code>import Data.Maybe(<b>catMaybes</b>)\nimport Text.Read(readMaybe)\n\nf :: [String] -&gt; [[Int]]\nf = <b>catMaybes</b> . map (readMaybe . ('[' :) . (++ &quot;]&quot;))</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude Data.Maybe Text.Read&gt; f [\"2\", \"3;2\", \"4,7,3\", \"bla\"]\n[[2],[4,7,3]]\n</code></pre>\n\n<p>or as <a href=\"https://stackoverflow.com/questions/56116208/haskell-char-to-int/56116406?noredirect=1#comment98866645_56116406\">@dfeuer</a> said, we can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:traverse\" rel=\"nofollow noreferrer\"><strong><code>traverse :: (Applicative f, Traversable t) =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)</code></strong></a> to return an <code>[[Int]]</code> result wrapped in a <code>Just</code> if <em>all</em> parsing succeeded, and <code>Nothing</code> otherwise:</p>\n\n<pre><code>import Text.Read(readMaybe)\n\nf :: [String] -&gt; <b>Maybe</b> [[Int]]\nf = <b>traverse</b> (readMaybe . ('[' :) . (++ &quot;]&quot;))</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude Text.Read&gt; f [\"2\",\"2\",\"1\",\"2,2\",\"1\"] \nJust [[2],[2],[1],[2,2],[1]]\nPrelude Text.Read&gt; f [\"2\", \"3;2\", \"4,7,3\", \"bla\"]\nNothing\n</code></pre>\n\n<h1>Parse with error messages with <code>readEither</code></h1>\n\n<p>We can obtain an error message wrapped in a <code>Left</code> in case the parsing fails by using <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Text-Read.html#v:readEither\" rel=\"nofollow noreferrer\"><strong><code>readEither :: Read a =&gt; String -&gt; Either String a</code></strong></a>:</p>\n\n<pre><code>import Text.Read(<b>readEither</b>)\n\nf :: [String] -&gt; [<b>Either String</b> [Int]]\nf = map (<b>readEither</b> . ('[' :) . (++ &quot;]&quot;))</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude Text.Read&gt; f [\"2\", \"3;2\", \"4,7,3\", \"bla\"]\n[Right [2],Left \"Prelude.read: no parse\",Right [4,7,3],Left \"Prelude.read: no parse\"]\n</code></pre>\n\n<p>and use <code>traverse</code> in the same way to obtain an error message wrapped in a <code>Left</code> or the complete result in a <code>Right</code>:</p>\n\n<pre><code>import Text.Read(readEither)\n\nf :: [String] -&gt; <b>Either String</b> [[Int]]\nf = <b>traverse</b> (readEither . ('[' :) . (++ &quot;]&quot;))</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude Text.Read&gt; f [\"2\",\"2\",\"1\",\"2,2\",\"1\"] \nRight [[2],[2],[1],[2,2],[1]]\nPrelude Text.Read&gt; f [\"2\", \"3;2\", \"4,7,3\", \"bla\"]\nLeft \"Prelude.read: no parse\"\n</code></pre>\n\n<p>Here, like @dfeuer says, it does not really shows much information. There are however parsers that can provide more informative parsing errors.</p>\n"}], "owner": {"reputation": 101, "user_id": 11493867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03b70e3500af8bde8fc6b7b7d862e08b?s=128&d=identicon&r=PG&f=1", "display_name": "alekq", "link": "https://stackoverflow.com/users/11493867/alekq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 56116406, "answer_count": 1, "score": 4, "last_activity_date": 1557772566, "creation_date": 1557764062, "last_edit_date": 1557766936, "question_id": 56116208, "link": "https://stackoverflow.com/questions/56116208/haskell-char-to-int", "title": "haskell [[Char]] to [[Int]]", "body": "<p>I've got problem with a Haskell program.\nI'm trying to change <code>[[Char]]</code> to <code>[[Int]]</code>\nI've got</p>\n\n<pre><code>[\"2\",\"2\",\"1\",\"2,2\",\"1\"] \n</code></pre>\n\n<p>list of char list\nand I'm trying to change it to <code>[[Int]]</code></p>\n\n<pre><code>[[2],[2],[1],[2,2],[1]]\n</code></pre>\n\n<p>I've tried </p>\n\n<pre><code>f :: [String] -&gt; [Int]\nf = map read\n</code></pre>\n\n<p>but it gives me </p>\n\n<blockquote>\n  <p>[2,2,1,*** Exception: Prelude.read: no parse</p>\n</blockquote>\n\n<p>Can anybody help me with this?</p>\n"}, {"tags": ["haskell", "selection-sort"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1557750015, "post_id": 56112236, "comment_id": 98857888, "body": "Is this version tail-recursive? This does not look like a tail-recursive function, since you emit <code>(:) x (ssort (delete x xs))</code>, so <code>ssort</code> is not the &quot;outer&quot; function. This looks like <a href=\"https://en.wikipedia.org/wiki/Tail_call#Tail_recursion_modulo_cons\" rel=\"nofollow noreferrer\">&quot;tail recursion <i>modulo cons</i>&quot;</a>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557752952, "post_id": 56112236, "comment_id": 98859576, "body": "Haskell doesn&#39;t use (or need) tail-call optimization because of its lazy evaluation model."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557753306, "post_id": 56112236, "comment_id": 98859777, "body": "(Which means there&#39;s usually little reason to go out of your way to make a function tail-recursive.)"}, {"owner": {"reputation": 111, "user_id": 11489863, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-5jssk0bRFLA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdcrn218Qkp1Dvd7MJT90s-JEzNwQ/mo/photo.jpg?sz=128", "display_name": "P. Ez", "link": "https://stackoverflow.com/users/11489863/p-ez"}, "edited": false, "score": 0, "creation_date": 1557754014, "post_id": 56112236, "comment_id": 98860225, "body": "thanks for your feedback, the code is meant for an experiment in a prover system."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1557768020, "post_id": 56112236, "comment_id": 98867469, "body": "@chepner, I think that&#39;s somewhat misleading. Haskell very often <i>does</i> need functions to be written in a tail-recursive fashion. It just needs it in fewer cases than an eager language would. Any time you choose <code>foldl&#39;</code> over a similar <code>foldr</code> it is (or should be) because the problem demands tail recursion."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1557751919, "post_id": 56112411, "comment_id": 98858958, "body": "This sorts in reverse: <code>ssort [3,1,2] = [3,2,1]</code>. (Replace <code>minimum</code> with <code>maximum</code> to fix, because you are prepending an element to the result <i>before</i> making your recursive call now, rather than after.) The non-tail-recursive version isn&#39;t quite as bad as you make it out. Because of laziness, there&#39;s only ever one delayed call to <code>ssort</code> sitting in memory; you only need to evaluate that call to get the next item in the result, at which point the <i>next</i> delayed recursive call replaces the former."}, {"owner": {"reputation": 111, "user_id": 11489863, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-5jssk0bRFLA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdcrn218Qkp1Dvd7MJT90s-JEzNwQ/mo/photo.jpg?sz=128", "display_name": "P. Ez", "link": "https://stackoverflow.com/users/11489863/p-ez"}, "edited": false, "score": 0, "creation_date": 1557752276, "post_id": 56112411, "comment_id": 98859162, "body": "Thanks for your help. Is there anyway It can be sorted in increasing order, for example [1,2,3] instead of [3,2,1]. I think this change might work &quot;append  acc x&quot; instead of &quot;(x : acc)&quot; but not sure if this is the best approach."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 111, "user_id": 11489863, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-5jssk0bRFLA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdcrn218Qkp1Dvd7MJT90s-JEzNwQ/mo/photo.jpg?sz=128", "display_name": "P. Ez", "link": "https://stackoverflow.com/users/11489863/p-ez"}, "edited": false, "score": 2, "creation_date": 1557752871, "post_id": 56112411, "comment_id": 98859515, "body": "@PierreContreras Using <code>acc ++ [x]</code> would work, but would defeat the purpose of the tail-recursive call, as now you would just be piling up unevaluated calls to <code>++</code> (as well as make the traversal of the result an O(n^2) operation instead of an O(n) operation)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1557768262, "post_id": 56112411, "comment_id": 98867563, "body": "You&#39;re right that the code is not tail recursive, but it doesn&#39;t wait for the recursive call to finish before applying the <code>(:)</code> constructor."}], "tags": [], "owner": {"reputation": 490, "user_id": 10907391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ca22ed936e2ff650833d947c8e93762?s=128&d=identicon&r=PG&f=1", "display_name": "DanBrezeanu", "link": "https://stackoverflow.com/users/10907391/danbrezeanu"}, "is_accepted": true, "score": 3, "last_activity_date": 1557752243, "last_edit_date": 1557752243, "creation_date": 1557750635, "answer_id": 56112411, "question_id": 56112236, "link": "https://stackoverflow.com/questions/56112236/functional-non-tail-recursive-version-of-selection-sort-in-haskell/56112411#56112411", "title": "functional non-tail recursive version of selection sort in Haskell", "body": "<p>The code presented is not tail-recursive since you invoke the <code>:</code> cons function. All the recursive calls will be held on the memory stack waiting for the evaluation of <code>ssort (delete x xs)</code> to finish. A tail-recursive version could look like this:</p>\n\n<pre><code>import Data.List (minimum, delete)\n\nssort :: Ord t =&gt; [t] -&gt; [t] -&gt; [t]\nssort [] acc = reverse acc\nssort xs acc = let { x = minimum xs } in ssort (delete x xs) (x : acc)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1557773256, "last_edit_date": 1557773256, "creation_date": 1557750827, "answer_id": 56112468, "question_id": 56112236, "link": "https://stackoverflow.com/questions/56112236/functional-non-tail-recursive-version-of-selection-sort-in-haskell/56112468#56112468", "title": "functional non-tail recursive version of selection sort in Haskell", "body": "<p><strong>Short answer</strong>: the code is <strong>not tail-recursive</strong>.</p>\n\n<blockquote>\n  <p>Can you please provide with a non-tail recursive version of selection sort?</p>\n</blockquote>\n\n<p>The code is <em>not</em> tail recursive. It is <a href=\"https://en.wikipedia.org/wiki/Tail_call#Tail_recursion_modulo_cons\" rel=\"nofollow noreferrer\">\"<em>tail recursive modulo cons</em>\" [wiki]</a>, but not tail recursive.</p>\n\n<p>The <a href=\"https://wiki.haskell.org/Tail_recursion\" rel=\"nofollow noreferrer\">Haskell wiki</a> shows how to find out if a function is tail-recursive:</p>\n\n<blockquote>\n  <p>Here is formal definition of \"tail recursive\". \"<code>f</code> occurs in <code>t</code>\"\n  means <code>f</code> is a free variable of <code>t</code>.</p>\n  \n  <p>When a function is defined (in let or at the top level) as:</p>\n\n<pre><code>f = t\n</code></pre>\n  \n  <p>where <code>f</code> is a name and <code>t</code> is a lambda-term, <code>f</code> is tail recursive\n  iff <code>f</code> occurs tail recursively in <code>t</code>. <code>f</code> occurs tail recursively in\n  <code>t</code> iff <code>f</code> occurs in <code>t</code> and any of the following holds:</p>\n  \n  <ul>\n  <li><code>t</code> is variable;</li>\n  <li><code>t</code> is <code>\\var -&gt; t0</code> and f occurs tail recursively in <code>t0</code>;</li>\n  <li><code>t</code> is <code>t0 t1</code> and f occurs tail recursively in <code>t0</code> and does not occur in <code>t1</code>;</li>\n  <li><code>t</code> is <code>let bs in t0</code> and <code>f</code> occurs tail recursively in <code>t0</code> and for each binder <code>var = t1</code> in <code>bs</code>, <code>f</code> does not occur in <code>t1</code>; </li>\n  <li><code>t</code> is <code>case t0 of bs</code> and <code>f</code> does not occur in <code>t0</code> and for each branch <code>b</code> in <code>bs</code>, <code>f</code> does not\n  occur or occurs tail recursively in <code>b</code>;\n  \n  <ul>\n  <li>when we are saying \"occur in\n  <code>b</code>\", <code>b</code> has form <code>D vars -&gt; t1</code> (where <code>D</code> is some data constructor and\n  <code>vars</code> is a sequence of names), we are thinking of the\n  lambda-abstraction <code>\\vars -&gt; t1</code> instead of <code>b</code>.</li>\n  </ul></li>\n  </ul>\n</blockquote>\n\n<p>The expression <code>t</code> is <code>\\xs -&gt; let x = minimum xs in  x : ssort (delete x xs)</code>, so we can take the second item here, but then <code>ssort</code> needs to be tail-recursive in the <code>let ... in ...</code> statement, this is the fourth case.</p>\n\n<p>But this fourth case requires that that <code>ssort</code> is tail recursive in the \"body\" of the <code>let ... in ...</code> expression. This expression is <code>((:) x) (ssort delete xs)</code>. This is thus the third case.</p>\n\n<p>In the third case, the expression is of shape <code>t0 t1</code>, here with <code>t0 = (:) x</code> and <code>t1 = ssort delete xs</code>. Since <code>ssort</code> does not occur in <code>t0</code>, there is no tail recursion here.</p>\n"}], "owner": {"reputation": 111, "user_id": 11489863, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-5jssk0bRFLA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdcrn218Qkp1Dvd7MJT90s-JEzNwQ/mo/photo.jpg?sz=128", "display_name": "P. Ez", "link": "https://stackoverflow.com/users/11489863/p-ez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 56112411, "answer_count": 2, "score": 0, "last_activity_date": 1557773256, "creation_date": 1557749963, "question_id": 56112236, "link": "https://stackoverflow.com/questions/56112236/functional-non-tail-recursive-version-of-selection-sort-in-haskell", "title": "functional non-tail recursive version of selection sort in Haskell", "body": "<p>I am looking for the non-tail recursive version of the following <a href=\"https://en.wikipedia.org/wiki/Selection_sort\" rel=\"nofollow noreferrer\">selection sort</a> code in Haskell:</p>\n\n<pre><code>import Data.List (minimum, delete)\n\nssort :: Ord t =&gt; [t] -&gt; [t]\nssort [] = []\nssort xs = let { x = minimum xs } in  x : ssort (delete x xs)\n</code></pre>\n\n<p>Can you please provide with a non-tail recursive version of selection sort?</p>\n\n<p>I know it is not a good idea to change the original code but I need that version to proceed with an experiment.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557737173, "post_id": 56108679, "comment_id": 98851038, "body": "<code>(x:xs)</code> means you construct a list with <code>x</code> an element (type <code>a</code>), and <code>xs</code> the rest of the list (type <code>[a]</code>), but now you call it in a different way, hence the error."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557737266, "post_id": 56108679, "comment_id": 98851081, "body": "It looks however that you want to <i>rotate</i> the list."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1557738340, "last_edit_date": 1557738340, "creation_date": 1557737509, "answer_id": 56108803, "question_id": 56108679, "link": "https://stackoverflow.com/questions/56108679/haskell-shift-list/56108803#56108803", "title": "Haskell shift list", "body": "<blockquote>\n  <p>Why do I get an error if I want to change the order from <code>(x:xs)</code> to <code>(xs:x)</code>?</p>\n</blockquote>\n\n<p>Because the types do not match. The type of <code>(:)</code> is <code>(:) :: a -&gt; [a] -&gt; [a]</code>. It thus expects an element <code>x</code> (type <code>a</code>) and a list with the rest of the elements (type <code>[a]</code>). You can not just use <code>(:)</code> in the opposite way.</p>\n\n<p>You can use the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:-43--43-\" rel=\"nofollow noreferrer\"><strong><code>(++) :: [a] -&gt; [a] -&gt; [a]</code></strong></a> to concatenate two lists together. We can thus rotate to the left by dropping <code>n</code> elements from the list and concatenating this with the first <code>n</code> elements of the list to this.</p>\n\n<pre><code><b>rotateL</b> :: Int -&gt; [a] -&gt; [a]\nrotateL 0 list = list\nrotateL n list | n &lt; 0 = error &quot;Negative index&quot;\n               | otherwise = <b>drop n list ++ take n list</b></code></pre>\n\n<p>or we can, like <a href=\"https://stackoverflow.com/questions/56108679/haskell-shift-list/56108803?noredirect=1#comment98851525_56108803\">@YannVernier</a> says, use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:splitAt\" rel=\"nofollow noreferrer\"><strong><code>splitAt :: Int -&gt; [a] -&gt; ([a], [a])</code></strong></a>:</p>\n\n<pre><code>rotateL :: Int -&gt; [a] -&gt; [a]\nrotateL 0 list = list\nrotateL n list | n &lt; 0 = error &quot;Negative index&quot;\n               | otherwise = <b>lb ++ la</b>\n    where (la, lb) = splitAt n list</code></pre>\n\n<p>or without mentioning the <code>list</code> parameter:</p>\n\n<pre><code>rotateL :: Int -&gt; [a] -&gt; [a]\nrotateL 0 = id\nrotateL n | n &lt; 0 = error &quot;Negative index&quot;\n          | otherwise= <b>uncurry (flip (++)) . splitAt n</b></code></pre>\n\n<blockquote>\n  <p><strong>Note</strong>: based on how your attempt, I think you actually want to <em>rotate</em> the list to the left, not shift it, since that would mean that you simply <code>drop</code> the first <code>n</code> elements, and fill it perhaps with some extra value.</p>\n</blockquote>\n\n<p>&nbsp;</p>\n\n<blockquote>\n  <p><strong>Note</strong>: in case <code>n</code> is larger than the length of the list, then the <code>rotateL</code> will act as an identity function. That might not be the desired behavior. I leave it as an exercise to fix this edge-case.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1557738407, "post_id": 56108853, "comment_id": 98851722, "body": "Perhaps it is useful to note in your answer that <code>xs ++ [x]</code> is not the most efficient way, since this will turn the algorithm into an <i>O(n^2)</i> algorithm :)."}], "tags": [], "owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "is_accepted": false, "score": 2, "last_activity_date": 1557739091, "last_edit_date": 1557739091, "creation_date": 1557737681, "answer_id": 56108853, "question_id": 56108679, "link": "https://stackoverflow.com/questions/56108679/haskell-shift-list/56108853#56108853", "title": "Haskell shift list", "body": "<p>It's not the names that define the types, but the positions in a function call, or type declarations. If we check the type of <code>:</code>, we see that the second argument is a list:</p>\n\n<pre><code>Prelude&gt; :t (:)\n(:) :: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>So pattern matching on this constructor will always give you the <code>head</code> and <code>tail</code>, not the <code>init</code> and <code>last</code>. Thus, using both <code>x:xs</code> and <code>xs:x</code>, you've declared that <code>a</code> and <code>[a]</code> are the same type, and the compiler balks. You could perform the append using e.g. <code>xs ++ [x]</code>. </p>\n\n<p><a href=\"https://hackage.haskell.org/package/containers-0.6.0.1/docs/Data-Sequence.html\" rel=\"nofollow noreferrer\">Data.Sequence</a> has a type that does support both head and last patterns in the operators <code>:&lt;|</code> and <code>|&gt;:</code>. </p>\n\n<p>In general, (<a href=\"https://en.wikipedia.org/wiki/Linked_list#Singly_linked_list\" rel=\"nofollow noreferrer\">singly linked</a>) lists only make the head element efficiently accessible; operations like appending or even checking lengths are costly. When all you need is a stream or stack, they're great, but a long distance reordering operation like the rotation is better handled by a <a href=\"https://en.wikipedia.org/wiki/Rope_(data_structure)\" rel=\"nofollow noreferrer\">rope</a> or <a href=\"https://en.wikipedia.org/wiki/Circular_buffer\" rel=\"nofollow noreferrer\">circular buffer</a> type. Either is available in Haskell, in e.g. <a href=\"https://hackage.haskell.org/package/containers-0.6.0.1/docs/Data-Sequence.html\" rel=\"nofollow noreferrer\">container's Seq</a> or <a href=\"https://hackage.haskell.org/package/ring-buffer-0.4/docs/Data-RingBuffer.html\" rel=\"nofollow noreferrer\">ring-buffer's RingBuffer</a>. <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.2/docs/Data-ByteString-Lazy.html\" rel=\"nofollow noreferrer\">Data.ByteString.Lazy</a> and <a href=\"https://hackage.haskell.org/package/text-1.2.3.1/docs/Data-Text-Lazy.html\" rel=\"nofollow noreferrer\">Data.Text.Lazy</a> are also rope types. </p>\n"}], "owner": {"reputation": 533, "user_id": 7839759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b65e869f62a18de42a40546eb4806f2?s=128&d=identicon&r=PG&f=1", "display_name": "Habebit", "link": "https://stackoverflow.com/users/7839759/habebit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 981, "favorite_count": 0, "accepted_answer_id": 56108803, "answer_count": 2, "score": 1, "last_activity_date": 1557739091, "creation_date": 1557737084, "last_edit_date": 1557738046, "question_id": 56108679, "link": "https://stackoverflow.com/questions/56108679/haskell-shift-list", "title": "Haskell shift list", "body": "<p>I want to shift a list by n elements to the left. Why do I get an error if I want to change the order from <code>(x:xs)</code> to <code>(xs:x)</code>?</p>\n\n<pre><code>shift n list@(x:xs)\n    | n == 0 = list\n    | otherwise = shift (n-1) (xs:x) -- (xs:x) error\n</code></pre>\n\n<blockquote>\n  <p>Occurs check: cannot construct the infinite type: a ~ [a]</p>\n</blockquote>\n\n<p>I don't know how to interpret this error. Maybe someone of you can help me.\nThank you very much.</p>\n\n<blockquote>\n  <p><strong>EDIT: As it was already mentioned, the correct term to use is rotate and not shift</strong></p>\n</blockquote>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1557722279, "post_id": 56105812, "comment_id": 98845444, "body": "I tried this and putting a space between <code>-i lib</code> and neither worked..hmmm...what&#39;s the rhyme/reason in this command"}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1557722521, "post_id": 56105812, "comment_id": 98845490, "body": "I think you might have meant <code>stack runghc -- -i src&#47;* app&#47;Main.hs</code> but that didn&#39;t work, I got the error in the updated OP"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1557729554, "post_id": 56105812, "comment_id": 98847558, "body": "I made a typo, did you try -isrc?"}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1557732399, "post_id": 56105812, "comment_id": 98848707, "body": "yeah <code>-isrc</code> worked, what&#39;s the explanation for that? seems weird...why not <code>-i src</code> with a space?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 1, "creation_date": 1557742018, "post_id": 56105812, "comment_id": 98853812, "body": "That&#39;s simply the syntax for GHC&#39;s arguments"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 4, "last_activity_date": 1557729569, "last_edit_date": 1557729569, "creation_date": 1557722153, "answer_id": 56105812, "question_id": 56105510, "link": "https://stackoverflow.com/questions/56105510/how-to-import-adjacent-module-when-running-hs-file-as-script/56105812#56105812", "title": "How to import adjacent module when running .hs file as script", "body": "<p>You need to pass <code>runghc</code> the <code>-i</code> option to tell it about include paths. The following should work:</p>\n\n<pre><code>stack runghc -- -isrc app/Main.hs\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 1, "accepted_answer_id": 56105812, "answer_count": 1, "score": 3, "last_activity_date": 1557729569, "creation_date": 1557719121, "last_edit_date": 1557722511, "question_id": 56105510, "link": "https://stackoverflow.com/questions/56105510/how-to-import-adjacent-module-when-running-hs-file-as-script", "title": "How to import adjacent module when running .hs file as script", "body": "<p>I was following the directions here:\n<a href=\"https://haskell.fpcomplete.com/tutorial/stack-script\" rel=\"nofollow noreferrer\">https://haskell.fpcomplete.com/tutorial/stack-script</a></p>\n\n<p>I have a cabal/stack project with this file structure:</p>\n\n<pre><code>app/Main.hs\nsrc/Lib.hs\n</code></pre>\n\n<p>I can run Main.hs with:</p>\n\n<pre><code>stack runghc -- app/Main.hs \n</code></pre>\n\n<p>that works if Main.hs does not import Lib.hs, but if it does, I get this error:</p>\n\n<pre><code>app/Main.hs:3:1: error:\n    Ambiguous module name \u2018Lib\u2019:\n      it was found in multiple packages:\n      haskell-starter-0.1.0.0 libiserv-8.6.3\n  |\n3 | import Lib\n  | ^^^^^^^^^^\n</code></pre>\n\n<p>is there anyway to include the src/Lib.hs file in the build? For a package it would look like:</p>\n\n<pre><code>stack runghc --package xyz -- app/Main.hs \n</code></pre>\n\n<p>but what about for a module or file? Something like:</p>\n\n<pre><code>stack runghc --module src/Lib.hs -- app/Main.hs \n</code></pre>\n\n<p>?</p>\n\n<p><strong>Update</strong>: So I tried this:</p>\n\n<pre><code>stack runghc -- -i src/* app/Main.hs\n</code></pre>\n\n<p>And I got:</p>\n\n<blockquote>\n<pre><code>src/Lib.hs:0:66: error:\n    \u2022 Variable not in scope: main :: IO a0\n    \u2022 Perhaps you meant \u2018min\u2019 (imported from Prelude)\n</code></pre>\n</blockquote>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1557770609, "post_id": 56104272, "comment_id": 98868562, "body": "If you want to learn more about this property, it is called <i>alpha equivalence</i>."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 13, "last_activity_date": 1557703613, "creation_date": 1557703613, "answer_id": 56104272, "question_id": 56104258, "link": "https://stackoverflow.com/questions/56104258/the-type-of-map-const/56104272#56104272", "title": "The type of (.) map const", "body": "<p><code>a -&gt; [b] -&gt; [a]</code> and <code>b -&gt; [a] -&gt; [b]</code> are the same type (and so is, for example, <code>foo -&gt; [bar] -&gt; [foo]</code>). The names of type variables carry no meaning, so as long as the same ones are in the same places, the labels they have don't matter.</p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 8, "last_activity_date": 1557706020, "creation_date": 1557706020, "answer_id": 56104458, "question_id": 56104258, "link": "https://stackoverflow.com/questions/56104258/the-type-of-map-const/56104458#56104458", "title": "The type of (.) map const", "body": "<p>Answering your comment on @JosephSible's answer, it appears GHCi unification is favoring the type variables from <code>map</code>.  This is mere order of operations and arbitrary:</p>\n\n<pre><code>map' :: (mapA -&gt; mapB) -&gt; [mapA] -&gt; [mapB]\nmap' = map\n\ndot :: (dotB -&gt; dotC) -&gt; (dotA -&gt; dotB) -&gt; dotA -&gt; dotC\ndot = (.)\n\nconst' :: constA -&gt; constB -&gt; constA\nconst' = const\n</code></pre>\n\n<p>And</p>\n\n<pre><code>*Main&gt; :t dot map' const'\ndot map' const' :: mapB -&gt; [mapA] -&gt; [mapB]\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 10369741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51a031aaaf599db4565c089b108c18a8?s=128&d=identicon&r=PG&f=1", "display_name": "studentofcs", "link": "https://stackoverflow.com/users/10369741/studentofcs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 56104272, "answer_count": 2, "score": 5, "last_activity_date": 1557729232, "creation_date": 1557703412, "last_edit_date": 1557729232, "question_id": 56104258, "link": "https://stackoverflow.com/questions/56104258/the-type-of-map-const", "title": "The type of (.) map const", "body": "<p>I'm trying to determine the type of <code>(.) map const</code>.</p>\n\n<p>The type of <code>(.) map</code> gives me <code>(a1 -&gt; a2 -&gt; b) -&gt; a1 -&gt; [a2] -&gt; [b]</code></p>\n\n<p>The type of <code>const</code> is <code>a -&gt; b -&gt; a</code></p>\n\n<p>So when I'm trying to do <code>(.) map const</code>, shouldn't the <code>(a1 -&gt; a2 -&gt; b)</code> of <code>(.) map</code> unify with <code>(a -&gt; b -&gt; a)</code> from <code>const</code>? </p>\n\n<p>Thus, <code>a1</code> unifies with <code>a</code>, <code>a2</code> unifies with <code>b</code>, <code>b</code> unifies with <code>a</code>.\nI'm left with <code>a1 -&gt; [a2] -&gt; b</code> \nWith the unification it should leave me with <code>a -&gt; [b] -&gt; [a]</code></p>\n\n<p>However, the correct answer is <code>b -&gt; [a] -&gt; [b]</code></p>\n\n<p>Can someone explain how and why?</p>\n"}, {"tags": ["c", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 5, "last_activity_date": 1557703920, "creation_date": 1557703920, "answer_id": 56104293, "question_id": 56104179, "link": "https://stackoverflow.com/questions/56104179/tuples-cannot-be-marshalled-in-a-foreign-call-when-trying-to-export-a-haskell/56104293#56104293", "title": "Tuples &quot;cannot be marshalled in a foreign call&quot; when trying to export a Haskell function to C", "body": "<p>You're not supposed to uncurry the arguments of exported functions. Use this in place of your <code>func_hs</code> and it will work fine:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>func_hs :: CInt -&gt; CInt -&gt; CInt\n\nfunc_hs hp maxHp = if verify_hp(hp,maxHp) == hp + 10 &amp;&amp; hp &lt; maxHp then hp + 10 else maxHp\n\n\nforeign export ccall func_hs :: CInt -&gt; CInt -&gt; CInt\n</code></pre>\n\n<p>In the working version, the C signature of <code>func_hs</code> looks something like this:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>int func_hs(int hp, int maxHp);\n</code></pre>\n\n<p>In your original, non-working version, it would have to look something like this:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>int func_hs(tuple&lt;int, int&gt; hp_and_maxHp); // not valid C!\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 11490039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8968163d1cea0dfdc8bd009065bb8a75?s=128&d=identicon&r=PG&f=1", "display_name": "Garais16", "link": "https://stackoverflow.com/users/11490039/garais16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1557704516, "creation_date": 1557702396, "last_edit_date": 1557704516, "question_id": 56104179, "link": "https://stackoverflow.com/questions/56104179/tuples-cannot-be-marshalled-in-a-foreign-call-when-trying-to-export-a-haskell", "title": "Tuples &quot;cannot be marshalled in a foreign call&quot; when trying to export a Haskell function to C", "body": "<p>I'm trying to call Haskell from C using <code>Foreign.C.Types</code> in Haskell but it keeps showing this error in the compiler:</p>\n\n<blockquote>\n<pre><code>  * Unacceptable argument type in foreign declaration:\n        `(CInt, CInt)' cannot be marshalled in a foreign call\n    * When checking declaration:\n        foreign export ccall \"func_hs\" func_hs :: (CInt, CInt) -&gt; CInt\n   |\n15 | foreign export ccall func_hs :: (CInt, CInt) -&gt; CInt\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n</blockquote>\n\n<p>The exact code compiled by GHCi version 8.6.3:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Func where\n\nimport Foreign.C.Types\n\nverify_hp :: (CInt, CInt) -&gt; CInt\n\nverify_hp (hp, maxHp) = if hp &lt; maxHp then hp + 10 else maxHp\n\nfunc_hs :: (CInt, CInt) -&gt; CInt\n\nfunc_hs (hp, maxHp) = if verify_hp(hp,maxHp) == hp + 10 &amp;&amp; hp &lt; maxHp then hp + 10 else maxHp\n\n\nforeign export ccall func_hs :: (CInt, CInt) -&gt; CInt\n</code></pre>\n\n<p>Why is this occuring and how can I fix it?</p>\n"}, {"tags": ["haskell", "types", "category-theory", "type-level-computation", "curry-howard"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 5, "creation_date": 1557701224, "post_id": 56104029, "comment_id": 98842518, "body": "Your solution is correct, you just used tuples <code>(a,b)</code> as arguments. They&#39;re equivalent. In fact, that&#39;s a good exercise: show that if <code>(a, b) -&gt; c</code> then <code>a -&gt; (b -&gt; c)</code> too, and vice versa."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1557701284, "post_id": 56104029, "comment_id": 98842526, "body": "I don&#39;t think there&#39;s anything wrong with your solution or your understanding. Your solution and the book&#39;s are identical except that the book&#39;s version of <code>productToRuleMine</code> is curried, and yours is not. Without seeing the book I can&#39;t say why they chose to do it that way, since as you said, tuples are the CH equivalent of multiplication. (According to my own limited understanding.)"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1557703834, "post_id": 56104029, "comment_id": 98842867, "body": "@RobinZigmond The multiplication bit is the combinatoric interpretation. The logical interpretation is conjunction. The logical tautology being proved here, by pure Curry-Howard, is <code>(b -&gt; a &#47;\\ c -&gt; a) &lt;-&gt; (b \\&#47; c -&gt; a)</code>. The interpretation <code>a^b * a^c = a^(b + c)</code> is combinatoric. The Curry-Howard comes in here to show that it is possible for a program to prove that equality."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1557728951, "post_id": 56104029, "comment_id": 98847330, "body": "Yes your solution is essentially the same as the books. By the way, this is not technically a proof, but a statement of the theorem -- to prove it, you need to show <i>how</i> <code>productToRule . productFromRule</code> rewrites to <code>id</code>."}], "owner": {"reputation": 309, "user_id": 7571000, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155043356444224/picture?type=large", "display_name": "Shane Unger", "link": "https://stackoverflow.com/users/7571000/shane-unger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 167, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1580199076, "creation_date": 1557700604, "last_edit_date": 1580199076, "question_id": 56104029, "link": "https://stackoverflow.com/questions/56104029/understanding-curry-howard-isomorphism-exercise-from-thinking-with-types", "title": "Understanding Curry-Howard Isomorphism exercise from Thinking With Types", "body": "<p>I've begun reading the book Thinking With Types which is my first foray into type level programming. The author provides an exercise and the solution, and I cannot understand how the solution provided is correct. </p>\n\n<p>The exercise is </p>\n\n<p><a href=\"https://i.stack.imgur.com/yyHu7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/yyHu7.png\" alt=\"enter image description here\"></a></p>\n\n<p>I attempted to solve this exercise with the following</p>\n\n<pre><code>productToRuleMine :: (b -&gt; a, c -&gt; a) -&gt; Either b c -&gt; a\nproductToRuleMine (f, _) (Left b) = f b\nproductToRuleMine (_, g) (Right c) = g c\n\nproductFromRuleMine :: (Either b c -&gt; a) -&gt; (b -&gt; a, c -&gt; a)\nproductFromRuleMine f = (f . Left, f . Right)\n\nproductToRuleMine . productFromRuleMine = id\n</code></pre>\n\n<p>I feel this is a valid solution, however the book gives a different solution that doesn't seem to type check, leading me to believe my overall understanding is flawed</p>\n\n<pre><code>productToRuleBooks :: (b -&gt; a) -&gt; (c -&gt; a) -&gt; (Either b c) -&gt; a\nproductToRuleBooks f _ (Left b) = f b\nproductToRuleBooks _ g (Right c) = g c\n\nproductFromRuleBooks :: (Either b c -&gt; a) -&gt; (b -&gt; a, c -&gt; a)\nproductFromRuleBooks f = (f . Left, f . Right)\n</code></pre>\n\n<p>The only way I can get the books answer to type check is the following:</p>\n\n<pre><code>(uncurry productToRule1 . productFromRule1) = id\n</code></pre>\n\n<p>since the type signatures alone don't line up</p>\n\n<pre><code>(Either b c -&gt; a) -&gt; (b -&gt; a  ,   c -&gt; a)\n                     (b -&gt; a) -&gt; (c -&gt; a) -&gt; (Either b c) -&gt; a\n</code></pre>\n\n<p>So the question I have is, is my solution incorrect? Why does the books type signature for <code>productToRuleBooks</code> accept as it's first and second arguments the functions <code>b -&gt; a</code> and <code>c -&gt; a</code> when it's my understanding that <code>x (multiplication)</code> from algebra equates to the <code>(,)</code> in types, so why doesn't the books answer have <code>(b -&gt; a, c -&gt; a)</code> as the first argument?</p>\n"}, {"tags": ["haskell", "induction", "proof-of-correctness"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1557699338, "post_id": 56103618, "comment_id": 98842196, "body": "Side note: to prove the sorting function correct, you need to demonstrate two more things: 1. That the computation eventually terminates, and 2. That the the result of the function is a permutation of its argument (no element has been dropped, doubled, or added)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557699588, "post_id": 56103618, "comment_id": 98842254, "body": "Also, for what it&#39;s worth, I suspect you will find it easier to prove an implementation of insertion sort correct, which will lead you more or less directly to proving a mergesort correct. Proving selection sort correct seems like a bit of a dead end; some similar ideas show up in heap sort, but in considerably different clothing."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557700106, "post_id": 56103618, "comment_id": 98842346, "body": "@dfeuer I&#39;ll admit that the cases given elide some detail, but aren&#39;t both termination and permutation essentially covered by the same induction as presented? Read the induction on <code>n</code> to be &quot;<code>ssort</code> terminates with correct output (ie. a sorted permutation) of any input of length <code>n</code>&quot;. Yes, we assume some typeclass laws connecting the <code>eq</code>, <code>ord</code> instances, some properties of <code>delete</code>, and probably a couple other things but the essential structure of the proof doesn&#39;t need modification to account for those details?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557791229, "post_id": 56103618, "comment_id": 98875064, "body": "@moonGoose, you may be right. I know it can be rather tricky to get the permutation bit right in formal proofs, but it&#39;s probably not bad in informal ones."}], "answers": [{"tags": [], "owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "is_accepted": true, "score": 6, "last_activity_date": 1557697055, "creation_date": 1557697055, "answer_id": 56103672, "question_id": 56103618, "link": "https://stackoverflow.com/questions/56103618/recursive-selection-sort-proof-of-correctness/56103672#56103672", "title": "recursive selection sort proof of correctness", "body": "<p>Your inductive hypothesis is too weak. You should assume that <code>ssort</code> works correctly on <em>any</em> list of length <code>k</code> rather than <em>some specific</em> list <code>xs</code> of length <code>k</code>. </p>\n\n<p>So, instead, assuming <code>ssort</code> is correct on any list of length <code>k</code> and letting <code>xs</code> be any list of length <code>k+1</code>,  </p>\n\n<pre><code>ssort xs \n= let x = minimum xs in x : ssort (delete x xs) -- by definition of `ssort`\n= let x = minimum xs in x : sorted (delete x xs) -- `delete x xs` has length `k` so `ssort` sorts it correctly by IH\n= sorted xs -- by definition of sorted, minimum, delete\n</code></pre>\n"}], "owner": {"reputation": 111, "user_id": 11489863, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-5jssk0bRFLA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdcrn218Qkp1Dvd7MJT90s-JEzNwQ/mo/photo.jpg?sz=128", "display_name": "P. Ez", "link": "https://stackoverflow.com/users/11489863/p-ez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 1, "accepted_answer_id": 56103672, "answer_count": 1, "score": 3, "last_activity_date": 1557697055, "creation_date": 1557696345, "question_id": 56103618, "link": "https://stackoverflow.com/questions/56103618/recursive-selection-sort-proof-of-correctness", "title": "recursive selection sort proof of correctness", "body": "<p>I need to prove that the following <a href=\"https://en.wikipedia.org/wiki/Selection_sort\" rel=\"nofollow noreferrer\">selection sort</a> code (in Haskell) is always sorting:</p>\n\n<pre><code>import Data.List (minimum, delete)\n\nssort :: Ord t =&gt; [t] -&gt; [t]\nssort [] = []\nssort xs = let { x = minimum xs } in  x : ssort (delete x xs)\n</code></pre>\n\n<p>We can assume that we have a function called \"<strong>sorted</strong>\" that checks when a list is sorted.</p>\n\n<p>Statement to prove by structural induction: <strong>sorted(ssort xs)</strong></p>\n\n<p>I tried the following but I was not able to complete the proof. Can you please help me out to complete the proof?</p>\n\n<hr>\n\n<p><strong>Base case: xs = []</strong></p>\n\n<blockquote>\n  <p>sorted(ssort xs) =</p>\n  \n  <p>sorted(ssort []]) =</p>\n  \n  <p>sorted([]])</p>\n  \n  <p>correct since sorted([]) is always sorted</p>\n</blockquote>\n\n<hr>\n\n<p><strong>Inductive step</strong></p>\n\n<p>IH (inductive hypothesis) = sorted(ssort xs)</p>\n\n<p>show: sorted(ssort y#xs)</p>\n\n<blockquote>\n  <p><strong>case I: x = y = minimum</strong></p>\n  \n  <p>sorted(ssort y#xs) =</p>\n  \n  <p>sorted(let { x = minimum (y#xs)} in  x : ssort (delete x (y#xs))) =\n  (by definition)</p>\n  \n  <p>sorted(let { y = minimum (y#xs)} in  y : ssort (delete y (y#xs))) =\n  (by substitution)</p>\n  \n  <p>sorted(y : ssort (delete y (y#xs))) =</p>\n  \n  <p>sorted(y : ssort (xs)) = (by delete definition)</p>\n  \n  <p>sorted(y : ssort (xs))</p>\n  \n  <p>by IH we know that ssort (xs) is sorted, also y is the minimum value\n  so it goes first</p>\n  \n  <p><strong>case II: y is not minimum</strong></p>\n  \n  <p>sorted(ssort y#xs) =</p>\n  \n  <p>sorted(let { x = minimum (y#xs)} in  x : ssort (delete x (y#xs))) =\n  (by definition)</p>\n  \n  <p>.....</p>\n  \n  <p>no idea</p>\n</blockquote>\n"}, {"tags": ["haskell", "haskell-streaming"], "comments": [{"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 2, "creation_date": 1557697745, "post_id": 56103055, "comment_id": 98841917, "body": "I&#39;m not sure whether it&#39;d help someone more knowledgeable answer your question, but, where is <code>listenNaiveStreaming</code> coming from? At least it&#39;s not on hoogle. Also imo <code>iterate</code> would be easier to read with LambdaCase and using the <code>do</code> notation instead of manually <code>&gt;&gt;=</code>ing everything."}, {"owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557703560, "post_id": 56103055, "comment_id": 98842840, "body": "I fixed the typo. I am not familiar with LambdaCase; I&#39;ll look into it!"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1557721579, "post_id": 56103055, "comment_id": 98845321, "body": "Be warned, streaming libraries don&#39;t generally speed things up.  See <a href=\"https://stackoverflow.com/a/55814664/7203016\">stackoverflow.com/a/55814664/7203016</a>."}, {"owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1557722346, "post_id": 56103055, "comment_id": 98845456, "body": "@K.A.Buhr Thanks, actually that other post was by me too. I am still trying to get this working, but I will take your comment to heart for real projects in the future."}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 1, "creation_date": 1557759037, "post_id": 56103055, "comment_id": 98863191, "body": "My first intuition is that a file is getting opened on every iteration. Can you pull the <code>readFile &quot;filename&quot;</code> out and only pass in the file handle?"}, {"owner": {"reputation": 3278, "user_id": 709646, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/14ffa3e0a86607175971ead35d1b717f?s=128&d=identicon&r=PG", "display_name": "FooF", "link": "https://stackoverflow.com/users/709646/foof"}, "edited": false, "score": 0, "creation_date": 1557766249, "post_id": 56103055, "comment_id": 98866778, "body": "You could find how you trace the system calls in your environment (e.g. <code>strace</code> on Linux and <code>DTrace</code> on macOS and some others). Then you will easily find out where the problem come from. Also check out the operating system limits on file descriptors (<code>ulimit -a</code> on <code>bash</code> shell on POSIXy platforms). You can find out a lot of useful information before inspecting the actual libraries you are using. With the information you can focus where to actually search for the problem."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1557865461, "post_id": 56117798, "comment_id": 98907092, "body": "<code>null_</code> should be seen as completely consuming the stream. Using it again will perform the outermost effect(s) again. There certainly should be a version that produces a new stream that can be used safely. Would you like to open a ticket, or shall I?"}, {"owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "edited": false, "score": 1, "creation_date": 1557907222, "post_id": 56117798, "comment_id": 98918633, "body": "(isEmpty :&gt; bs) &lt;- BSSC.testNull bs_"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1557942714, "post_id": 56117798, "comment_id": 98939363, "body": "@dfeuer As paperduck mentions, that function already seems to exist! I had not seen it. It could be better documented though."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 2, "last_activity_date": 1557812788, "last_edit_date": 1557812788, "creation_date": 1557771295, "answer_id": 56117798, "question_id": 56103055, "link": "https://stackoverflow.com/questions/56103055/why-is-streaming-bytestring-giving-me-error-openbinaryfile-resource-exhausted/56117798#56117798", "title": "Why is streaming-bytestring giving me error &quot;openBinaryFile: resource exhausted (Too many open files)&quot;?", "body": "<p>When working with streaming libraries, it's usually a bad idea to reuse a effectful stream. That is, you can apply a function like <a href=\"http://hackage.haskell.org/package/streaming-bytestring-0.1.6/docs/Data-ByteString-Streaming-Char8.html#v:drop\" rel=\"nofollow noreferrer\"><code>drop</code></a> or <code>splitAt</code> to a stream and then continue working with the resulting stream, or you can consume the stream as a whole with a function like <a href=\"http://hackage.haskell.org/package/streaming-bytestring-0.1.6/docs/Data-ByteString-Streaming.html#v:fold\" rel=\"nofollow noreferrer\">fold</a>, which leaves you in the base monad. But you should never apply the same stream value to two different functions.</p>\n\n<p>Sadly, the Haskell type system as it stands is not able to enforce that restriction at compile time, it would require some form of <a href=\"https://www.tweag.io/posts/2018-06-21-linear-streams.html\" rel=\"nofollow noreferrer\">linear types</a>. Instead, it becomes the responsibility of the user.  </p>\n\n<p>The  <a href=\"http://hackage.haskell.org/package/streaming-bytestring-0.1.6/docs/Data-ByteString-Streaming.html#v:null_\" rel=\"nofollow noreferrer\"><code>null_</code></a> function is perhaps a wart in the <a href=\"http://hackage.haskell.org/package/streaming-bytestring-0.1.6\" rel=\"nofollow noreferrer\">streaming-bytestring</a> api, because it doesn\u2019t return a new stream along with the result, giving the impression that stream reuse is normal throughout the API. It would be better if it had a signature like \n <code>null_ :: ByteString m r -&gt; m (Bool, ByteString m r)</code>.</p>\n\n<p>Similarly, don't use <a href=\"http://hackage.haskell.org/package/streaming-bytestring-0.1.6/docs/Data-ByteString-Streaming.html#v:drop\" rel=\"nofollow noreferrer\"><code>drop</code></a> and <a href=\"http://hackage.haskell.org/package/streaming-bytestring-0.1.6/docs/Data-ByteString-Streaming.html#v:take\" rel=\"nofollow noreferrer\"><code>take</code></a> with the same stream value. Instead, use <a href=\"http://hackage.haskell.org/package/streaming-bytestring-0.1.6/docs/Data-ByteString-Streaming.html#v:splitAt\" rel=\"nofollow noreferrer\"><code>splitAt</code></a> or <a href=\"http://hackage.haskell.org/package/streaming-bytestring-0.1.6/docs/Data-ByteString-Streaming-Char8.html#v:uncons\" rel=\"nofollow noreferrer\"><code>uncons</code></a> and work with the divided result.</p>\n\n<pre><code>dump :: MonadIO m =&gt; BSS.ByteString m r -&gt; m ()\ndump bs = do\n    mc &lt;- BSSC.uncons bs -- bs is only used once\n    case mc of\n        Left _ -&gt; return ()\n        Right (c,rest) -&gt; do liftIO $ putChar c\n                             dump rest\n</code></pre>\n\n<hr>\n\n<p>So, about the error. As @BobDalgleish mentions in the comments, what is happening is that the file is opened when <code>null_</code> is invoked (it is the first time we \"demand\" something from the stream) . In the recursive call we pass the original <code>bs</code> value again, so it will open the file again, one time for each iteration, until we hit the file handle limit.</p>\n\n<hr>\n\n<p>Personally, I'm not a fan of using <a href=\"http://hackage.haskell.org/package/resourcet\" rel=\"nofollow noreferrer\"><code>ResourceT</code></a> with streaming libraries. I prefer opening the file with <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/System-IO.html#v:withFile\" rel=\"nofollow noreferrer\"><code>withFile</code></a> and then create and consume the stream withing the callback, if possible. But some things are more difficult that way.</p>\n"}], "owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 56117798, "answer_count": 1, "score": 2, "last_activity_date": 1557857588, "creation_date": 1557691789, "last_edit_date": 1557857588, "question_id": 56103055, "link": "https://stackoverflow.com/questions/56103055/why-is-streaming-bytestring-giving-me-error-openbinaryfile-resource-exhausted", "title": "Why is streaming-bytestring giving me error &quot;openBinaryFile: resource exhausted (Too many open files)&quot;?", "body": "<p>The  <a href=\"http://hackage.haskell.org/package/streaming-bytestring-0.1.6/docs/Data-ByteString-Streaming.html\" rel=\"nofollow noreferrer\">streaming-bytestring</a> library gives an error after printing about 512 bytes.</p>\n\n<p>Error:</p>\n\n<pre><code>openBinaryFile: resource exhausted (Too many open files)\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>import           Control.Monad.Trans (lift, MonadIO)\nimport           Control.Monad.Trans.Resource (runResourceT, MonadResource, MonadUnliftIO, ResourceT, liftResourceT)\nimport qualified Data.ByteString.Streaming          as BSS\nimport qualified Data.ByteString.Streaming.Char8    as BSSC\nimport           System.TimeIt\n\nmain :: IO ()\nmain = timeIt $ runResourceT $ dump $ BSS.drop 24 $ BSS.readFile \"filename\"\n\ndump :: MonadIO m =&gt; BSS.ByteString m r -&gt; m ()\ndump bs = do\n    isEmpty &lt;- BSS.null_ bs\n    if isEmpty then return ()\n    else do\n        BSSC.putStr $ BSS.take 1 bs\n        dump $ BSS.drop 1 bs\n</code></pre>\n"}, {"tags": ["haskell", "quickcheck"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557683583, "post_id": 56101904, "comment_id": 98838440, "body": "Although not the question, isn&#39;t this invalid? It looks to me that <code>reverse (xs ++ ys) == reverse ys ++ reverse xs</code> (so with <code>xs</code> and <code>ys</code> swapped)."}, {"owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "edited": false, "score": 0, "creation_date": 1557683842, "post_id": 56101904, "comment_id": 98838513, "body": "As defined, <code>xs</code> and <code>ys</code> have type <code>[a]</code>. I don&#39;t know this for a fact, but it makes sense that unspecified types would default to something, and <code>()</code> is a good candidate for that something. What would be the basis for generating any other value when you don&#39;t tell it what types of value to generate?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557684500, "post_id": 56101904, "comment_id": 98838688, "body": "@WillemVanOnsem the way I understood the question, that&#39;s the point. The test should fail, but apparently it passed (as it would if you restricted it to just lists of <code>()</code>)"}, {"owner": {"reputation": 810, "user_id": 223689, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/72513b978e46e0d0db13ec5ede02108b?s=128&d=identicon&r=PG", "display_name": "Paul Spencer", "link": "https://stackoverflow.com/users/223689/paul-spencer"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1557775995, "post_id": 56101904, "comment_id": 98870777, "body": "@RobinZigmond is correct, the paper is specifically showing this as a failing test."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 2, "last_activity_date": 1557686019, "creation_date": 1557686019, "answer_id": 56102283, "question_id": 56101904, "link": "https://stackoverflow.com/questions/56101904/why-does-quickcheck-create-lists-of-units/56102283#56102283", "title": "why does quickCheck create lists of units", "body": "<p>The <code>prop_revApp</code> function is quite generic:</p>\n\n<pre><code>*Main&gt; :t prop_revApp\nprop_revApp :: Eq a =&gt; [a] -&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>If you're just loading the code in GHCi, and run it, yes, indeed, the property passes:</p>\n\n<pre><code>*Main&gt; quickCheck prop_revApp\n+++ OK, passed 100 tests.\n</code></pre>\n\n<p>This is because GHCi comes with a set of preferred defaults. For convenience, it'll try to use the simplest type it can.</p>\n\n<p>It doesn't get much simpler than <code>()</code>, and since <code>()</code> has an <code>Eq</code> instance, it picks that.</p>\n\n<p>If, on the other hand, you actually try to write and compile some properties, the code doesn't compile:</p>\n\n<pre><code>import Test.Framework (defaultMain, testGroup)\nimport Test.Framework.Providers.QuickCheck2 (testProperty)\n\nimport Test.QuickCheck\n\nmain :: IO ()\nmain = defaultMain tests\n\nprop_revApp xs ys = reverse (xs ++ ys) == reverse xs ++ reverse ys\n\ntests = [\n        testGroup \"Example\" [\n                testProperty \"prop_revApp\" prop_revApp\n           ]\n      ]\n</code></pre>\n\n<p>If you try to run these tests with <code>stack test</code>, you'll get a compiler error:</p>\n\n<pre><code>test\\Spec.hs:11:17: error:\n    * Ambiguous type variable `a0' arising from a use of `testProperty'\n      prevents the constraint `(Arbitrary a0)' from being solved.\n      Probable fix: use a type annotation to specify what `a0' should be.\n      These potential instances exist:\n        instance (Arbitrary a, Arbitrary b) =&gt; Arbitrary (Either a b)\n          -- Defined in `Test.QuickCheck.Arbitrary'\n        instance Arbitrary Ordering\n          -- Defined in `Test.QuickCheck.Arbitrary'\n        instance Arbitrary Integer\n          -- Defined in `Test.QuickCheck.Arbitrary'\n        ...plus 19 others\n        ...plus 61 instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    * In the expression: testProperty \"prop_revApp\" prop_revApp\n      In the second argument of `testGroup', namely\n        `[testProperty \"prop_revApp\" prop_revApp]'\n      In the expression:\n        testGroup \"Example\" [testProperty \"prop_revApp\" prop_revApp]\n   |\n11 |                 testProperty \"prop_revApp\" prop_revApp\n   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>You'll have to give the property a more specific type; e.g.</p>\n\n<pre><code>tests = [\n        testGroup \"Example\" [\n                testProperty \"prop_revApp\" (prop_revApp :: [Int] -&gt; [Int] -&gt; Bool)\n           ]\n      ]\n</code></pre>\n\n<p>Now the test compiles, but fails:</p>\n\n<pre><code>$ stack test\nQ56101904-0.1.0.0: test (suite: Q56101904-test)\n\nExample:\n  prop_revApp: [Failed]\n*** Failed! Falsifiable (after 3 tests and 3 shrinks):\n[1]\n[0]\n(used seed -7398729956129639050)\n\n         Properties  Total\n Passed  0           0\n Failed  1           1\n Total   1           1\n\nQ56101904-0.1.0.0: Test suite Q56101904-test failed\nTest suite failure for package Q56101904-0.1.0.0\n    Q56101904-test:  exited with: ExitFailure 1\nLogs printed to console\n</code></pre>\n"}], "owner": {"reputation": 810, "user_id": 223689, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/72513b978e46e0d0db13ec5ede02108b?s=128&d=identicon&r=PG", "display_name": "Paul Spencer", "link": "https://stackoverflow.com/users/223689/paul-spencer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 56102283, "answer_count": 1, "score": 2, "last_activity_date": 1557686049, "creation_date": 1557683418, "last_edit_date": 1557686049, "question_id": 56101904, "link": "https://stackoverflow.com/questions/56101904/why-does-quickcheck-create-lists-of-units", "title": "why does quickCheck create lists of units", "body": "<p>I tried the following from the paper QuickCheck Testing for fun and profit.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>prop_revApp xs ys = reverse (xs ++ ys) == reverse xs ++ reverse ys\n</code></pre>\n\n<p>and it passed even though it should not have.\nI ran <code>verboseCheck</code> and I see that it is only checking lists of units, i.e.:</p>\n\n<pre><code>Passed:\n[(),(),(),(),(),(),(),(),(),(),(),(),(),()]\n</code></pre>\n\n<p>I was wondering why this was. </p>\n\n<p>I am aware I can fix it by defining the type of the property but was wondering if this was necessary or I was missing something. </p>\n"}, {"tags": ["haskell", "monoids"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 9, "last_activity_date": 1557734994, "last_edit_date": 1557734994, "creation_date": 1557669069, "answer_id": 56099924, "question_id": 56099868, "link": "https://stackoverflow.com/questions/56099868/getting-identity-for-type-parameter/56099924#56099924", "title": "Getting identity for type parameter?", "body": "<p>This can only happen if <code>a</code> itself is a <code>Monoid</code> type as well, so we can write this as:</p>\n\n<pre><code>instance <b>Monoid a</b> =&gt; Monoid (Tree <b>a</b>) where\n    mempty = Empty\n    mappend Empty a = a\n    mappend a Empty = a\n    mappend a b = Node <b>mempty</b> a b</code></pre>\n\n<p>The above will not work for an <code>Int</code>, since an <code>Int</code> is not a <code>Monoid</code>. There are two very popular candidates <em>(&#x2115;, +, 0)</em>, and <em>(&#x2115;, &times;, 1)</em>. You can however make use of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Monoid.html#t:Sum\" rel=\"nofollow noreferrer\"><strong><code>Sum</code></strong></a> which is the representation of the former monoid.</p>\n\n<p>The <code>mempty</code> in the body of the last line is thus <em>not</em> the <code>mempty</code> we are defining, but the <code>mempty</code> of type <code>a</code>.</p>\n\n<p>That being said, if you define a <code>Monoid Tree</code> like that, it means that you consider a <code>Node mempty (Node mempty a b) c == Node mempty a (Node mempty b c)</code>, since this is required by the <em>monoid laws</em>. So the <code>deriving Eq</code> is not completely in \"<em>harmony</em>\" here with the <code>mappend</code>. The <code>mappend</code> operator (in mathematics typically denoted as <em>&oplus;</em>), should satisfy the condition <em>&forall; a,b,c&in; S: a&oplus;(b&oplus;c) = (a&oplus;b)&oplus;c</em>.</p>\n\n<p>You either should implement <code>Eq</code> yourself differently, or you should try to come up with another structure for your monoid.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1557699012, "last_edit_date": 1557699012, "creation_date": 1557676329, "answer_id": 56100940, "question_id": 56099868, "link": "https://stackoverflow.com/questions/56099868/getting-identity-for-type-parameter/56100940#56100940", "title": "Getting identity for type parameter?", "body": "<p>This is not an answer, but it's far too long for a comment. As Willem Van Onsem suggests, your <code>Monoid</code> instance isn't lawful. I suspect you probably want one of two things:</p>\n\n<h3>A free magma</h3>\n\n<p>The free magma over a type can be defined</p>\n\n<pre><code>data Magma a = Branch (Magma a) (Magma a) | Leaf a | Empty\n  deriving Show\n</code></pre>\n\n<p>This isn't naturally a monoid, but it's sometimes useful to <em>pretend</em> it's one:</p>\n\n<pre><code>instance Monoid (Magma a) where\n  mempty = Empty\n  mappend = Branch\n\n-- For recent GHC, add this instance\ninstance Semigroup (Magma a) where\n  (&lt;&gt;) = Branch\n</code></pre>\n\n<p>This can be used with a fold to gain insight into the structure of that fold. To get a sense of how this works, compare the results of applying <code>foldMap Leaf</code> to <code>[1..20]</code>, <code>Data.Sequence.fromList [1..20]</code>, and <code>Data.Set.fromList [1..20]</code>.</p>\n\n<h3>A (particular) free monad</h3>\n\n<p>Consider generalizing your tree to allow different types in the internal nodes than in the leaves:</p>\n\n<pre><code>data Tree a b = Node a (Tree a b) (Tree a b) | Leaf b\n  deriving (Show, Eq)\n</code></pre>\n\n<p>(This turns out to be the free monad over the functor <code>Tree a</code>, defined</p>\n\n<pre><code>data TreeF a b = NodeF a b b\n</code></pre>\n\n<p>but we don't really need to get into the details of what that means.)</p>\n\n<p>The monad operation for the <code>Tree a</code> monad is a sort of \"grafting\", where the leaves are replaced by trees.</p>\n\n<pre><code>instance Functor (Tree a) where\n  fmap f (Leaf b) = Leaf (f b)\n  fmap f (Node a l r) = Node a (fmap f l) (fmap f r)\n\ninstance Applicative (Tree a) where\n  pure = Leaf\n  (&lt;*&gt;) = ap\n  liftA2 = liftM2\n\ninstance Monad (Tree a) where\n  Leaf b &gt;&gt;= f = f b\n  Node a l r &gt;&gt;= f = Node a (l &gt;&gt;= f) (r &gt;&gt;= f)\n</code></pre>\n\n<p>You can think of <code>&gt;&gt;=</code> as supporting a sort of vertical appending, where the tree grows downward from its leaves.</p>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 56099924, "answer_count": 2, "score": 2, "last_activity_date": 1557734994, "creation_date": 1557668824, "last_edit_date": 1557669606, "question_id": 56099868, "link": "https://stackoverflow.com/questions/56099868/getting-identity-for-type-parameter", "title": "Getting identity for type parameter?", "body": "<p>I have the following type that i want to be an instance of <code>Monoid</code> typeclass.I do not know how to set a  parametrized field to the identity.Is there any way when using parametrized type to get the identity of that type ?</p>\n\n<pre><code>data Tree a=Leaf a | Node a (Tree a) (Tree a) |Empty deriving (Eq,Show)\n\ninstance Monoid Tree where\n    mempty=Empty\n    mappend a Empty=a\n    mappend a b=Node (identity) x y\n</code></pre>\n\n<p>As you can see i need the simple field to be set to the identity of the parameter type.</p>\n\n<p>Example</p>\n\n<pre><code>mappend::Tree Int\nmappend (Leaf 1) (Leaf 2)=Node 0 (Leaf 1) (Leaf 2)\n\nmappend::Tree []\nmappend (Leaf [1,2])(Leaf [2,3])=Node [] (Leaf [1,2])(Leaf [2,3])\n</code></pre>\n"}, {"tags": ["haskell", "tuples", "list-comprehension"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557667382, "post_id": 56099664, "comment_id": 98834162, "body": "Can you show what you should do if the third element is an singleton list?"}, {"owner": {"reputation": 167, "user_id": 11426990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83513622a4a19d1bcdf43d7b7bd3fb9d?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Wiese", "link": "https://stackoverflow.com/users/11426990/ron-wiese"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557667661, "post_id": 56099664, "comment_id": 98834234, "body": "Singleton lists should not be valid inputs here."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557667687, "post_id": 56099664, "comment_id": 98834241, "body": "So <code>[(14,25, [3])]</code> is invalid?"}, {"owner": {"reputation": 167, "user_id": 11426990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83513622a4a19d1bcdf43d7b7bd3fb9d?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Wiese", "link": "https://stackoverflow.com/users/11426990/ron-wiese"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557667765, "post_id": 56099664, "comment_id": 98834253, "body": "Yes it should be. The third element should always be a list with 3 elements."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1557667812, "post_id": 56099664, "comment_id": 98834266, "body": "then it makes no sense to use a list, if something has a fixed number of elements, it is better to use a tuple, since that gives stronger guarantees."}, {"owner": {"reputation": 167, "user_id": 11426990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83513622a4a19d1bcdf43d7b7bd3fb9d?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Wiese", "link": "https://stackoverflow.com/users/11426990/ron-wiese"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557667941, "post_id": 56099664, "comment_id": 98834291, "body": "Nevermind the third element should contain 3 or more elements, but not less than 3."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 6, "creation_date": 1557668085, "post_id": 56099664, "comment_id": 98834333, "body": "Can you at least show <i>some</i> effort in solving the problem for a very limited subset of input?"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 2, "creation_date": 1557669270, "post_id": 56099664, "comment_id": 98834689, "body": "Hints: Try a nested list comprehension, one for the outer list and one for the list in each tuple, and <code>concat</code> to glue them back into one output list. You can also easily find out how to filter the output with list comprehension, any tutorial should cover it."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1557676126, "post_id": 56099664, "comment_id": 98836415, "body": "Consider <code>newtype ThreePlus a = ThreePlus a a a [a]</code> as a way to represent a &quot;list&quot; of three or more <code>a</code>s."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557678963, "post_id": 56099664, "comment_id": 98837219, "body": "Why is <code>(30,23)</code> not in the result?"}], "answers": [{"comments": [{"owner": {"reputation": 167, "user_id": 11426990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83513622a4a19d1bcdf43d7b7bd3fb9d?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Wiese", "link": "https://stackoverflow.com/users/11426990/ron-wiese"}, "edited": false, "score": 1, "creation_date": 1557679938, "post_id": 56101316, "comment_id": 98837520, "body": "Thanks for your answer. I think the output list of this exercise has a mistake in it. You are right (30,23) has to be included in the resulting list."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1557679175, "creation_date": 1557679175, "answer_id": 56101316, "question_id": 56099664, "link": "https://stackoverflow.com/questions/56099664/converting-tuples/56101316#56101316", "title": "Converting tuples", "body": "<p>You simply need to iterate further on the third element. We furthermore should add a <em>filter</em> a boolean expression in the \"body\" of the list-comprehension that is checked such that only items satisfying this condition are added:</p>\n\n<pre><code>convert xs :: (Num a, Ord a) =&gt; [(a, a, a)] -&gt; [(a, a, a)]\nconvert xs = [ (a*b,b+<b>c</b>) | (a, b, <b>cs</b>) &lt;- xs, <b>c &lt;- cs</b>, <b>a*b &gt; b+c</b> ]</code></pre>\n\n<p>we thus unpack the tuples in the original list <code>xs</code>, and then use <code>cs</code> (the third item of the tuple) as the source of the second generator.</p>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; convert [(13,25,[1,12,101]), (5,6,[7,17,27])]\n[(325,26),(325,37),(325,126),(30,13),(30,23)]\n</code></pre>\n\n<p>Or we can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:filter\" rel=\"nofollow noreferrer\"><strong><code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code></strong></a> instead:</p>\n\n<pre><code>convert xs :: (Num a, Ord a) =&gt; [(a, a, a)] -&gt; [(a, a, a)]\nconvert xs = <b>filter (uncurry (&gt;))</b> [ (a*b,b+c) | (a, b, cs) &lt;- xs, c &lt;- cs ]</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 11426990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83513622a4a19d1bcdf43d7b7bd3fb9d?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Wiese", "link": "https://stackoverflow.com/users/11426990/ron-wiese"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 56101316, "answer_count": 1, "score": -3, "last_activity_date": 1557679175, "creation_date": 1557667275, "last_edit_date": 1557678748, "question_id": 56099664, "link": "https://stackoverflow.com/questions/56099664/converting-tuples", "title": "Converting tuples", "body": "<p>I want to write a functions which takes the input parameter xs, which represents a list of tuples of the form (a,b,cs) and convert it to a list of tuples (a*b,b+c), for a and b representing whole numbers and all elements c in cs with cs representing a list of numbers. </p>\n\n<p>The result should only include tuples in which the first element of the tuple is bigger but not even than its second element.</p>\n\n<p>Example:      </p>\n\n<pre><code>  [(13,25,[1,12,101]), (5,6,[7,17,27])]\n\n  -- should be converted to \n\n  [(325,26),(325,37),(325,126),(30,13)]\n</code></pre>\n\n<p>Update: After a lot of testing i found this solution but I am not quite sure  how to remove the tuples which do not match the requirements from the resulting list:</p>\n\n<pre><code>  convert :: [(Int, Int, [Int])] -&gt; [(Int, Int)]\n  convert xs = [(a*b,b+c) | (a,b,cs) &lt;- xs, c &lt;- cs]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1557665593, "post_id": 56099420, "comment_id": 98833697, "body": "It seems like you never loaded your program, since it says &quot;no modules loaded&quot;. Did you run <code>ghci</code> with <code>ghci myfile.hs</code>?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1557665620, "post_id": 56099420, "comment_id": 98833706, "body": "<code>Prelude&gt; :r Ok, no modules loaded</code> - that makes it looks like you haven&#39;t actually loaded your module. You need to do <code>:l &lt;module_name&gt;</code> first (then you don&#39;t need <code>:r</code> until you&#39;ve made modifications and want to reload it)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557693090, "post_id": 56099420, "comment_id": 98840881, "body": "You can simplify this to <code>encode shift msg = map (chr. (+ shift) . ord) msg</code>; in general, <code>map f (map g xs) == map (f . g) xs</code>."}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 6, "last_activity_date": 1557666336, "creation_date": 1557666336, "answer_id": 56099529, "question_id": 56099420, "link": "https://stackoverflow.com/questions/56099420/why-is-variable-not-in-scope/56099529#56099529", "title": "Why is &quot;Variable not in scope&quot;", "body": "<p>There's an indentation error in your code. Here it is corrected:</p>\n\n<pre><code>encode :: Int -&gt; String -&gt; String\nencode shift msg =\n    let ords = map ord msg\n        shifted = map (+ shift) ords\n    in map chr shifted\n</code></pre>\n\n<p>In blocks like <code>let ... in ...</code> or <code>where ...</code>, <code>do ...</code> etc, it's important to not allow the indentation of subsequent lines to fall behind the indentation of the first \u2013 this is called the \u2018offside rule,\u2019 and it's how Haskell determines what belongs in what block.</p>\n\n<p>Start up GHCi with <code>ghci H2-2.hs</code> or write <code>:l H2-2.hs</code> to load the file. Once it's loaded, if you want to load some additional changes, only then should you use <code>:r</code>.</p>\n"}], "owner": {"reputation": 257, "user_id": 11484713, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jf7y-3MrxDE/AAAAAAAAAAI/AAAAAAAAAc8/ETJ5Qy_LNVg/photo.jpg?sz=128", "display_name": "Morgen Yang", "link": "https://stackoverflow.com/users/11484713/morgen-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1894, "favorite_count": 0, "accepted_answer_id": 56099529, "answer_count": 1, "score": 0, "last_activity_date": 1557667028, "creation_date": 1557665517, "last_edit_date": 1557667028, "question_id": 56099420, "link": "https://stackoverflow.com/questions/56099420/why-is-variable-not-in-scope", "title": "Why is &quot;Variable not in scope&quot;", "body": "<p>What's the problem with code.</p>\n\n<p>My Haskell platform is new . And I have tried to adjust the formats for many times. But it didn't work all the time.</p>\n\n<pre><code>import Data.Char\nimport Data.List\n\nencode :: Int -&gt; String -&gt; String\nencode shift msg =\n    let ords = map ord msg\n    shifted = map (+ shift) ords\n    in map chr shifted\n</code></pre>\n\n<p>The result is always like this</p>\n\n<pre><code>Prelude&gt; :r\nOk, no modules loaded.\nPrelude&gt; :type encode\n\n&lt;interactive&gt;:1:1: error: Variable not in scope: encode\n</code></pre>\n\n<p>When I load my files, it shows</p>\n\n<pre><code>Prelude&gt; :l H2-2.hs\n[1 of 1] Compiling Main             ( H2-2.hs, interpreted )\n\nH2-2.hs:56:3: error: parse error on input \u2018shifted\u2019\n   |\n56 |   shifted = map (+ shift) ords\n   |   ^^^^^^^\nFailed, no modules loaded.\n</code></pre>\n"}, {"tags": ["haskell", "type-inference", "lambda-calculus"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1557665096, "post_id": 56099252, "comment_id": 98833580, "body": "It&#39;s not clear to me why you think they should have the same types, since they have rather different implementations. Perhaps you should share which type you think GHCi has reported incorrectly, and what you think the type should be - together with your reasoning - then we can help to explain where you are mistaken."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1557667657, "last_edit_date": 1557667657, "creation_date": 1557666117, "answer_id": 56099499, "question_id": 56099252, "link": "https://stackoverflow.com/questions/56099252/two-functions-seem-equal-but-different-in-haskell/56099499#56099499", "title": "Two functions seem equal but different in Haskell", "body": "<h1>How to fix the encoding</h1>\n\n<p>Church encodings work very well in an untyped calculus.</p>\n\n<p>When types are added, things get more complicated. With simple types, for instance, the encodings are lost. With polymorphism they can be recovered, if higher ranks are supported. Note that type inference can't work well with higher types, so some explicit type annotation is needed.</p>\n\n<p>For example, your <code>not</code> should be written as:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\ntype ChBool = forall a. a -&gt; a -&gt; a\n\nnot :: ChBool -&gt; ChBool\nnot f x y = f y x\n</code></pre>\n\n<p>It is important that boolean values are modeled as polymorphic functions, since otherwise they can only be used on a single type, making many examples fail. For instance, consider</p>\n\n<pre><code>foo :: Bool -&gt; (Int, String)\nfoo b = (b 3 2, b \"aa\" \"bb\")\n</code></pre>\n\n<p>Here <code>b</code> needs to be used twice, once on <code>Int</code>s and once on <code>String</code>s. If <code>Bool</code> is not polymorphic this will fail.</p>\n\n<h1>Why beta-reduction changes the inferred type</h1>\n\n<p>Further, you seem to be convinced that you can beta-reduce Haskell expressions and the inferred type before and after the reduction must be the same. That's not true, in general, as you discovered in your experiments. To see why, here's a simple example:</p>\n\n<pre><code>id1 x = x\n</code></pre>\n\n<p>The inferred type here is <code>id1 :: forall a. a -&gt; a</code>, obviously. Consider instead this variant:</p>\n\n<pre><code>id2 x = (\\ _ -&gt; x) e\n</code></pre>\n\n<p>Note that <code>id2</code> beta-reduces to <code>id1</code>, <em>whatever <code>e</code> might be</em>. By choosing <code>e</code> carefully, though, we can restrict the type of <code>x</code>. E.g. let's choose <code>e = x \"hello\"</code></p>\n\n<pre><code>id2 x = (\\ _ -&gt; x) (x \"hello\")\n</code></pre>\n\n<p>Now, the inferred type is <code>id2 :: forall b. (String -&gt; b) -&gt; String -&gt; b</code> since <code>x</code> can only be a <code>String</code>-accepting function. It does not matter that <code>e</code> will not be evaluated, the type inference algorithm will make that well-typed anyway. This makes the inferred type of <code>id2</code> differ from the one of <code>id1</code>.</p>\n"}], "owner": {"reputation": 63, "user_id": 10052440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/206d810e1c62832e37936dceb9303234?s=128&d=identicon&r=PG&f=1", "display_name": "gihyeon", "link": "https://stackoverflow.com/users/10052440/gihyeon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "accepted_answer_id": 56099499, "answer_count": 1, "score": 4, "last_activity_date": 1557715722, "creation_date": 1557664110, "last_edit_date": 1557715722, "question_id": 56099252, "link": "https://stackoverflow.com/questions/56099252/two-functions-seem-equal-but-different-in-haskell", "title": "Two functions seem equal but different in Haskell", "body": "<p>I'm trying to implement boolean without Prelude in Haskell.</p>\n\n<p>When expression, <code>beq true true \"TRUE\" \"FALSE\"</code> is evaluated, it's okay. But when I try to evaluate <code>beq' true true \"TRUE\" \"FALSE\"</code>, it fails by some difference between expected type and actual type.</p>\n\n<p>This is the code.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import qualified Prelude as P\n\ni = \\x -&gt; x\nk = \\x y -&gt; x\nki = k i\n\ntrue = k\nfalse = ki\n\nnot = \\p -&gt; p false true\nbeq = \\p q -&gt; p (q true false) (q false true)\nbeq' = \\p q -&gt; p q (not q)\n</code></pre>\n\n<p>So I checked inferred types of theses.</p>\n\n<pre><code>*Main&gt; :type beq\nbeq\n  :: (t1 -&gt; t1 -&gt; t2)\n     -&gt; ((p1 -&gt; p1 -&gt; p1) -&gt; (p2 -&gt; p2 -&gt; p2) -&gt; t1) -&gt; t2\n\n*Main&gt; :type beq'\nbeq'\n  :: (((p1 -&gt; p2 -&gt; p2) -&gt; (p3 -&gt; p4 -&gt; p3) -&gt; t1) -&gt; t1 -&gt; t2)\n     -&gt; ((p1 -&gt; p2 -&gt; p2) -&gt; (p3 -&gt; p4 -&gt; p3) -&gt; t1) -&gt; t2\n</code></pre>\n\n<p>And it was not equal.</p>\n\n<p>Here are the questions.</p>\n\n<ol>\n<li><p>I thought it has the same type signature because <code>beq</code> and <code>beq'</code> seemingly make the same result when it folded and substituted. Like there are many ways to implement one function. But it wasn't. Are there some secret rules and syntax in Haskell?</p></li>\n<li><p>If I want to write <code>beq</code> with the function <code>not</code>, how can I make it works?</p></li>\n</ol>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 8, "creation_date": 1557627017, "post_id": 56095423, "comment_id": 98827189, "body": "You could use <code>permutations [1..7]</code> from <code>Data.List</code>"}], "answers": [{"tags": [], "owner": {"reputation": 154, "user_id": 10276432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d05baccb0bcda8ea7acf7f59c1f2145?s=128&d=identicon&r=PG&f=1", "display_name": "PF. Castro", "link": "https://stackoverflow.com/users/10276432/pf-castro"}, "is_accepted": true, "score": 6, "last_activity_date": 1557623717, "last_edit_date": 1557623717, "creation_date": 1557623696, "answer_id": 56095494, "question_id": 56095423, "link": "https://stackoverflow.com/questions/56095423/finding-combinations/56095494#56095494", "title": "Finding combinations", "body": "<p>What about something like:</p>\n\n<pre><code>import Data.List\nlist = [(a,b,c,d,e,f,g) | a &lt;- [1..7], b &lt;- [1..7], c &lt;- [1..7],\n        d &lt;- [1..7], e &lt;- [1..7], f &lt;- [1..7], g &lt;- [1..7], [1,2,3,4,5,6,7]\\\\[a,b,c,d,e,f,g]==[]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "is_accepted": false, "score": 9, "last_activity_date": 1557832838, "last_edit_date": 1557832838, "creation_date": 1557623880, "answer_id": 56095509, "question_id": 56095423, "link": "https://stackoverflow.com/questions/56095423/finding-combinations/56095509#56095509", "title": "Finding combinations", "body": "<p>You can use list difference <code>(\\\\)</code> from <code>Data.List</code>.</p>\n\n<pre><code>perms = [ (a,b,c,d,e,f,g) | a &lt;- [1..7]\n                          , b &lt;- [1..7] \\\\ [a]\n                          , c &lt;- [1..7] \\\\ [a,b]\n                          , d &lt;- [1..7] \\\\ [a,b,c]\n                          , e &lt;- [1..7] \\\\ [a,b,c,d]\n                          , f &lt;- [1..7] \\\\ [a,b,c,d,e]\n                          , g &lt;- [1..7] \\\\ [a,b,c,d,e,f] ]\n</code></pre>\n\n<p>This way <code>b</code> will be chosen to be different from <code>a</code>, <code>c</code> will be different from <code>a</code> and <code>b</code>, and so on.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1557652749, "post_id": 56097746, "comment_id": 98830780, "body": "I&#39;ve posted something similar, practically at the same time... You can improve your code a little bit by using <code>(f,[g]) &lt;- pick es</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1557652973, "post_id": 56097746, "comment_id": 98830821, "body": "@WillNess: yes, although the use case could change to &quot;pick 7 elements out of <code>[1..10]</code> for example, in which case the above will fail."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1557653030, "post_id": 56097746, "comment_id": 98830833, "body": "I have one old answer about this kind of stuff. Search for &quot;Euler 43 monad&quot;. Will find the link later. <a href=\"https://stackoverflow.com/a/9889702/849891\">Here it is</a>. With that monad, <code>perms</code> should become <code>replicateM 7 choose</code> or something."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1557652915, "last_edit_date": 1557652915, "creation_date": 1557652346, "answer_id": 56097746, "question_id": 56095423, "link": "https://stackoverflow.com/questions/56095423/finding-combinations/56097746#56097746", "title": "Finding combinations", "body": "<p>We can make a \"helper function\" here that for a given list <code>xs</code> generates a list of tuples where the first element is an element we picked, and the second the list of remaining elements, like:</p>\n\n<pre><code>import Data.List(inits, tails)\n\npick :: [a] -&gt; [(a, [a])]\npick ls = [(b, as ++ bs) | (as, (b:bs)) &lt;- zip (inits ls) (tails ls)]</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude Data.List&gt; pick [1..5]\n[(1,[2,3,4,5]),(2,[1,3,4,5]),(3,[1,2,4,5]),(4,[1,2,3,5]),(5,[1,2,3,4])]\n</code></pre>\n\n<p>each item thus picks an element from the list and returns a list where that picked element is removed. We can use this to then pass that list to the next generator.</p>\n\n<p>Then we can use this for example in a <code>do</code> block like:</p>\n\n<pre><code>perms :: (Num a, Enum a) =&gt; [(a, a, a, a, a, a, a)]\nperms = do\n    (a, as) &lt;- pick [1..7]\n    (b, bs) &lt;- pick as\n    (c, cs) &lt;- pick bs\n    (d, ds) &lt;- pick cs\n    (e, es) &lt;- pick ds\n    (f, [g]) &lt;- pick es\n    return (a, b, c, d, e, f, g)\n</code></pre>\n\n<p>which yields:</p>\n\n<pre><code>Prelude Data.List&gt; perms\n[(1,2,3,4,5,6,7),(1,2,3,4,5,7,6),(1,2,3,4,6,5,7),(1,2,3,4,6,7,5),(1,2,3,4,7,5,6),(1,2,3,4,7,6,5),(1,2,3,5,4,6,7),(1,2,3,5,4,7,6), ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 8, "last_activity_date": 1558360631, "last_edit_date": 1558360631, "creation_date": 1557652559, "answer_id": 56097767, "question_id": 56095423, "link": "https://stackoverflow.com/questions/56095423/finding-combinations/56097767#56097767", "title": "Finding combinations", "body": "<p>We can optimize the code from the <a href=\"https://stackoverflow.com/a/56095509/849891\">answer</a> by <a href=\"https://stackoverflow.com/users/1871467/kuoytfouy\">kuoytfouy</a>, as</p>\n\n<pre><code>perms = [(a,b,c,d,e,f,g) | a &lt;- [1..7], let dom6 = [1..7] \\\\ [a]\n                         , b &lt;- dom6,   let dom5 = dom6 \\\\ [b]\n                         , c &lt;- dom5,   let dom4 = dom5 \\\\ [c]\n                         , d &lt;- dom4,   let dom3 = dom4 \\\\ [d] \n                         , e &lt;- dom3,   let dom2 = dom3 \\\\ [e] \n                         , f &lt;- dom2,   let dom1 = dom2 \\\\ [f] \n                         , g &lt;- dom1,   let dom0 = dom1 \\\\ [g]  ]\n</code></pre>\n\n<p>and further improve it by cutting away the redundant computations,</p>\n\n<pre><code>perms = [(a,b,c,d,e,f,g) | a &lt;- [1..7], let dom6 = delete a [1..7]\n                         , b &lt;- dom6,   let dom5 = delete b dom6\n                         , c &lt;- dom5,   let dom4 = delete c dom5\n                         , d &lt;- dom4,   let dom3 = delete d dom4 \n                         , e &lt;- dom3,   let dom2 = delete e dom3 \n                         , f &lt;- dom2,   let [g]  = delete f dom2 ]\n</code></pre>\n\n<p>Composing the choosing of an element with its deletion from the current domain gives us one function that does the two jobs at the same time, usually called <code>picks</code>. It's been used in SO answers in the past and can be found there.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/a/12872133/849891\"><code>picks</code></a> from one <a href=\"https://stackoverflow.com/users/828361/pigworker\">pigworker</a></li>\n<li><a href=\"https://stackoverflow.com/a/9831493/849891\"><code>choose</code></a> in Unique Selection monad</li>\n<li>a <a href=\"https://stackoverflow.com/a/49907365/849891\">Common Lisp answer</a> of mine with an <em>efficient</em> code which actually shrinks the domain list by surgical mutation of the list structure, plucking the elements out one by one as we go down the recursively built nested loops; and healing it on the way back.<br>\nThat is to say, <code>choose</code>- (or equivalently, <code>picks</code>-) based Haskell code is under grave suspicion of being grossly inefficient (<code>inits</code> being quadratic when fully forced, for starters).<br>\nRe-calculating the shrunk domains each time, like in this answer, we only end up with seven (six, whatever)  domain lists at each point in time, each fully garbage collectible when done with -- <em>but</em>, each <code>delete</code> invocation searches <em>its</em> argument from the start anew (the inefficiency <code>picks</code> was invented to fix...), again suggesting the overall calculation being quadratic, inefficient. Food for thought!</li>\n</ul>\n"}], "owner": {"reputation": 167, "user_id": 11426990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83513622a4a19d1bcdf43d7b7bd3fb9d?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Wiese", "link": "https://stackoverflow.com/users/11426990/ron-wiese"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 2, "accepted_answer_id": 56095494, "answer_count": 4, "score": 7, "last_activity_date": 1558360631, "creation_date": 1557622649, "last_edit_date": 1557646045, "question_id": 56095423, "link": "https://stackoverflow.com/questions/56095423/finding-combinations", "title": "Finding combinations", "body": "<p>I want to write a function which calculates all combinations of the numbers 1 to 7 in 7-tuples, but every number can occur only once in every tuple.</p>\n\n<p>So far I found this approach, but it also returns combinations with multiple occurrences of the same number in every tuple. I am not quite sure how to remove tuples with multiple\noccurrences of the same number.</p>\n\n<pre><code>  a = [(a,b,c,d,e,f,g) | a &lt;- [1..7], b &lt;- [1..7], c &lt;- [1..7], \n        d &lt;- [1..7], e &lt;- [1..7], f &lt;- [1..7], g &lt;- [1..7]]\n</code></pre>\n\n<p>Example for goal result (all valid combinations should be in here):</p>\n\n<pre><code>  [(1,2,3,4,5,6,7),(2,1,3,4,5,6,7),(2,3,1,4,5,6,7),...]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 6, "creation_date": 1557623118, "post_id": 56095383, "comment_id": 98826746, "body": "In Haskell, you can&#39;t have an <code>if</code> expression without the <code>else</code> part."}, {"owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "edited": false, "score": 1, "creation_date": 1557623311, "post_id": 56095383, "comment_id": 98826772, "body": "In the second line you wrote <code>exsit&#39;z</code> instead of <code>exist&#39;z</code>."}], "answers": [{"tags": [], "owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "is_accepted": false, "score": 5, "last_activity_date": 1557623194, "creation_date": 1557623194, "answer_id": 56095457, "question_id": 56095383, "link": "https://stackoverflow.com/questions/56095383/new-to-haskell-if-statment-generating-parse-error/56095457#56095457", "title": "(new to haskell) if statment generating parse error", "body": "<p>In Haskell, <code>if</code> clauses are expressions. That implies that they need to always evaluate to a value, and also to have a definite type. More specifically, <code>if</code> clauses without an <code>else</code> are syntax errors. Also, the <code>then</code> and <code>else</code> cases need to have the same type.</p>\n\n<p>In your case, you can have a function create a list of tuples if the condition applies, but for the function to be well-typed, that function would need to return a list of tuples regardless. Why you want to return a list of tuples I'm not sure, since the way you wrote it it will always be a singleton in the <code>then</code> case. You can append <code>else []</code> and make it work, but perhaps a more suitable type for this would be <code>Maybe</code>:</p>\n\n<pre><code>exist'z :: String -&gt; String\nexist'z s = [ y | y &lt;- s, toLower y =='z' ]\n\nfreq'z :: String -&gt; Maybe (Char, Int)\nfreq'z s =  if (exist'z s /= \"\") then Just ( 'z', length (exist'z s )) else Nothing\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 11472082, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-l-15N7LfhG0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd8H6b8eu_iptMYxMddti7-SjmE-A/mo/photo.jpg?sz=128", "display_name": "FelixH", "link": "https://stackoverflow.com/users/11472082/felixh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1557623194, "creation_date": 1557622181, "question_id": 56095383, "link": "https://stackoverflow.com/questions/56095383/new-to-haskell-if-statment-generating-parse-error", "title": "(new to haskell) if statment generating parse error", "body": "<p>I want the function to create a list of a tuple if the condition applies but it doesnt seem to be working. (I'm new to haskell)</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\nexist'z s = [ y | y &lt;- s, toLower (y) =='z' ]\nfreq'z s =  if (exsit'z s /= \"\") then [( 'z', length (exist'z s ))]\n\n</code></pre>\n"}, {"tags": ["haskell", "haskell-streaming"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1557630510, "last_edit_date": 1557630510, "creation_date": 1557630109, "answer_id": 56095885, "question_id": 56095369, "link": "https://stackoverflow.com/questions/56095369/when-to-call-runresourcet-on-streaming-bytestring/56095885#56095885", "title": "When to call runResourceT on streaming-bytestring?", "body": "<p>The <code>ResourceT</code> monad just cleans up resources in a timely fashion when you're finished with them.  In this case, it will ensure the file handle opened by <code>BSS.readFile</code> is closed when the stream is consumed.  (Unless the stream truly is infinite, in which case I guess it won't.)</p>\n\n<p>In your application, you only want to call it once, since you don't want the file closed until you've read all the chunks.  Don't worry -- it has nothing to do with the timing of output or anything like that.</p>\n\n<p>Here's an example with a recursive <code>processByteChunks</code> that should work.  It will read lazily and generate output as chunks are lazily read:</p>\n\n<pre><code>import Control.Monad.IO.Class\nimport Control.Monad.Trans.Resource\nimport qualified Data.ByteString.Streaming as BSS\nimport qualified Data.ByteString as BS\nimport System.TimeIt\n\nmain :: IO ()\nmain = timeIt $ runResourceT $\n  processByteChunks $ BSS.drop 100 $ BSS.readFile \"filename\"\n\nprocessByteChunks :: MonadIO m =&gt; BSS.ByteString m () -&gt; m ()\nprocessByteChunks = go 0 0\n  where go len nulls stream = do\n          m &lt;- BSS.unconsChunk stream\n          case m of\n            Just (bs, stream') -&gt; do\n              let len' = len + BS.length bs\n                  nulls' = nulls + BS.length (BS.filter (==0) bs)\n              liftIO $ print $ \"cumulative length=\" ++ show len'\n                                      ++ \", nulls=\" ++ show nulls'\n              go len' nulls' stream'\n            Nothing -&gt; return ()\n</code></pre>\n"}], "owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 2, "accepted_answer_id": 56095885, "answer_count": 1, "score": 0, "last_activity_date": 1557857561, "creation_date": 1557621941, "last_edit_date": 1557857561, "question_id": 56095369, "link": "https://stackoverflow.com/questions/56095369/when-to-call-runresourcet-on-streaming-bytestring", "title": "When to call runResourceT on streaming-bytestring?", "body": "<p>I am a Haskell beginner and still learning about monad transformers.</p>\n\n<p>I am trying to use the <a href=\"http://hackage.haskell.org/package/streaming-bytestring\" rel=\"nofollow noreferrer\">streaming-bytestring</a> library to read a binary file, process chunks of bytes, and print the result as each chunk is processed. I believe this is the popular <code>streaming</code> library that provides an alternative to lazy bytestrings. It appears the authors copy-pasted the <a href=\"http://hackage.haskell.org/package/bytestring-0.10.8.2/docs/Data-ByteString-Lazy.html\" rel=\"nofollow noreferrer\">lazy bytestring</a> documentation and added some arbitrary examples. </p>\n\n<p>The examples mention <code>runResourceT</code> without going into any discussion of what it is or how to use it. It appears that should use <code>runResourceT</code> on any streaming-bytestring function that performs an action. That's fine, but what if I'm reading an infinite stream that processes chunks and prints them? Should I call runResourceT every time I want to process the chunk?</p>\n\n<p>My code is something like this:</p>\n\n<pre><code>import qualified Data.ByteString.Streaming as BSS\nimport System.TimeIt\n\nmain = timeIt $ processByteChunks $ BSS.drop 100 $ BSS.readFile \"filename\"\n</code></pre>\n\n<p>and I'm unsure of how to organize <code>processByteChunks</code> as a recursive function that iterates through the binary file. </p>\n\n<p>If I call <code>runResourceT</code> only once, it would read the infinite file BEFORE printing, right? That seems bad.</p>\n\n<pre><code>main = timeIt $ runResourceT $ processByteChunks $ BSS.drop 100 $ BSS.readFile \"filename\"\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "haskell-stack", "haskell-ffi"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1557635639, "creation_date": 1557635639, "answer_id": 56096258, "question_id": 56093821, "link": "https://stackoverflow.com/questions/56093821/stack-build-cannot-find-local-library/56096258#56096258", "title": "Stack Build Cannot Find Local Library", "body": "<p>As an aside, your motivation seems misguided.  I don't think there's any benefit to having a C event loop whose only purpose is to \"force evaluation\" on a regular schedule.  You can do that in Haskell just fine.</p>\n\n<p>What's going wrong in your example above is probably the <code>Lib</code> in the <code>ghc-options</code>.  However, there are other Cabal fields you should be using instead which will make things work more smoothly.</p>\n\n<p>Here's how to get your minimal example working with Stack.  Create a fresh directory with the four files listed below and run <code>stack build</code>, then <code>stack exec c-loop-exe</code>.</p>\n\n<p>A few points:</p>\n\n<ul>\n<li>You might be able to do this with a <code>package.yaml</code> file, but you'll have to convert the Cabal syntax over.</li>\n<li>You don't need all that <code>__stginit</code> and <code>hs_add_root</code> garbage anymore, unless you're using GHC &lt; 7.2.</li>\n<li>You don't need to hard-code the path for the stub, if you set up the Cabal file correctly (i.e., using <code>c-sources</code>).</li>\n<li>The <code>-opt-O2</code> flag is unnecessary.  It's the Stack default.</li>\n</ul>\n\n<p>The contents for the four files:</p>\n\n<pre><code>-- stack.yaml\nresolver: lts-13.21\npackages:\n- .\n\n-- c-loop.cabal\ncabal-version: 1.12\nname:           c-loop\nversion:        0.1.0.0\nbuild-type:     Simple\n\nexecutable c-loop-exe\n  main-is: src/Lib.hs\n  ghc-options: -no-hs-main\n  c-sources: c/eventLoop.c\n  build-depends:\n      base &gt;=4.7 &amp;&amp; &lt;5\n  default-language: Haskell2010\n\n-- c/eventLoop.c\n#include &lt;stdio.h&gt;\n#include &lt;time.h&gt;\n#include \"HsFFI.h\"\n#include \"Lib_stub.h\"\n\nint main(int argc, char *argv[])\n{\n    int i;\n    hs_init(&amp;argc, &amp;argv);\n    for (int m = 0; m &lt; 10; ++m) {\n        i = fibonacci_hs(42);\n        printf(\"Fibonacci: %d\\n\", i);\n    }\n    hs_exit();\n    return 0;\n}\n\n-- src/Lib.hs\n{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Lib where\n\nimport Foreign.C.Types\n\nfibonacci :: Int -&gt; Int\nfibonacci n = fibs !! n\n    where fibs = 0 : 1 : zipWith (+) fibs (tail fibs)\n\nfibonacci_hs :: CInt -&gt; CInt\nfibonacci_hs = fromIntegral . fibonacci . fromIntegral\n\nforeign export ccall fibonacci_hs :: CInt -&gt; CInt\n</code></pre>\n"}], "owner": {"reputation": 181, "user_id": 9985445, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-y4ooBZ_hzRc/AAAAAAAAAAI/AAAAAAAAAtQ/dL_nPMm3FLM/photo.jpg?sz=128", "display_name": "James Strieter", "link": "https://stackoverflow.com/users/9985445/james-strieter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 56096258, "answer_count": 1, "score": 0, "last_activity_date": 1557635639, "creation_date": 1557604811, "last_edit_date": 1557605155, "question_id": 56093821, "link": "https://stackoverflow.com/questions/56093821/stack-build-cannot-find-local-library", "title": "Stack Build Cannot Find Local Library", "body": "<p>I successfully replicated this example using GHC by itself.</p>\n\n<pre><code>https://wiki.haskell.org/Calling_Haskell_from_C\n</code></pre>\n\n<p>The end goal is to write 99% of my program in Haskell, and then call it from an event loop written in C:</p>\n\n<pre><code>#include &lt;HsFFI.h&gt;\n#ifdef __GLASGOW_HASKELL__\n#include \"../.stack-work/dist/x86_64-linux/Cabal-2.4.0.1/build/Lib_stub.h\"\nextern void __stginit_Lib(void);\n#endif\n#include &lt;stdio.h&gt;\n#include &lt;time.h&gt;\nextern void hs_add_root (void (*init_root)(void));\n\nint main(int argc, char *argv[])\n{\nint i;\n\nhs_init(&amp;argc, &amp;argv);\n\n#ifdef __GLASGOW_HASKELL__\n    hs_add_root(__stginit_Lib);\n#endif\n\nfor (int m = 0; m &lt; 10; ++m) {\n    i = fibonacci_hs(42);\n    printf(\"Fibonacci: %d\\n\", i);\n}\n\nhs_exit();\nreturn 0;\n}\n</code></pre>\n\n<p>The motivation to run an event loop in C is that, from what I've read, forcing evaluation X times/second is difficult or impossible in Haskell. </p>\n\n<p>Here is package.yaml:</p>\n\n<pre><code>name:                c-loop\nversion:             0.1.0.0\ngithub:              \"githubuser/c-loop\"\nlicense:             BSD3\nauthor:              \"Author name here\"\nmaintainer:          \"example@example.com\"\ncopyright:           \"2019 Author name here\"\n\nextra-source-files:\n- README.md\n- ChangeLog.md\n\n# Metadata used when publishing your package\n# synopsis:            Short description of your package\n# category:            Web\n\n# To avoid duplicated efforts in documentation and dealing with the\n# complications of embedding Haddock markup inside cabal files, it is\n# common to point users to the README.md file.\ndescription:         Please see the README on GitHub at   &lt;https://github.com/githubuser/c-loop#readme&gt;\n\ndependencies:\n- base &gt;= 4.7 &amp;&amp; &lt; 5\nlibrary:\n  source-dirs: src\n\nexecutables:\n  c-loop-exe:\n    main:                Main.hs\n    source-dirs:         app\n    ghc-options:\n    - -threaded\n    - -rtsopts\n    - -with-rtsopts=-N\n    - -fobject-code\n    #    - -no-hs-main\n    - --make -no-hs-main -optc-O ./c/eventLoop.c Lib -o eventLoop\ndependencies:\n- c-loop\n\ntests:\n  c-loop-test:\n    main:                Spec.hs\n    source-dirs:         test\n    ghc-options:\n    - -threaded\n    - -rtsopts\n    - -with-rtsopts=-N\n    dependencies:\n    - c-loop\n</code></pre>\n\n<p>When I run:</p>\n\n<pre><code>$ stack build\n</code></pre>\n\n<p>I get this: </p>\n\n<pre><code>&lt;no location info&gt;: error: module \u2018Lib\u2019 cannot be found locally\n</code></pre>\n\n<p>Does anyone know what is going on?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 121, "user_id": 9849454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab5d12f3f16b7d000a588241c8ab68c1?s=128&d=identicon&r=PG", "display_name": "moewb", "link": "https://stackoverflow.com/users/9849454/moewb"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557626137, "post_id": 56092971, "comment_id": 98827092, "body": "@Daniel Wagner \ud83d\ude02 Whoops, sorry about that and thank you for pointing it out. I guess it was a little too late at night when I typped that code \ud83d\ude05 I edited and corrected them."}], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 9849454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab5d12f3f16b7d000a588241c8ab68c1?s=128&d=identicon&r=PG", "display_name": "moewb", "link": "https://stackoverflow.com/users/9849454/moewb"}, "edited": false, "score": 0, "creation_date": 1557649720, "post_id": 56093656, "comment_id": 98830185, "body": "Thank you very much for your answer and sorry for the several typos \ud83d\ude05 I edited my original message and fixed them ."}], "tags": [], "owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "is_accepted": false, "score": 2, "last_activity_date": 1557603339, "creation_date": 1557603339, "answer_id": 56093656, "question_id": 56092971, "link": "https://stackoverflow.com/questions/56092971/free-monad-vs-explicitly-passing-functions/56093656#56093656", "title": "Free Monad vs explicitly passing functions", "body": "<p>There may be some non-style considerations like performance or ease of type inference that favor one over the other (my guess is that the <code>Capabilites</code>-style approach is probably a little better for both, but benchmark before you take that as truth), but by and large they are equivalent. You can take a program expressed with <code>Capabilities</code> and run it with <code>ioInterprefer</code> [sic], and you can take a program expressed with <code>Free MyGatd</code> [sic] and run it with an arbitrary <code>Capabilities</code>.</p>\n\n<p>Like this:</p>\n\n<pre><code>freeToCaps :: Monad m =&gt; FreeMonad.Free MyGatd () -&gt; Capabilities m -&gt; m ()\nfreeToCaps (FreeMonad.Pure x) _ = return x\nfreeToCaps (FreeMonad.Free (Read f)) c = myRead c &gt;&gt;= flip freeToCaps c . f\nfreeToCaps (FreeMonad.Free (Write str x)) c = myWrite c str &gt;&gt; freeToCaps x c\n\ncapsToFree :: Capabilities (FreeMonad.Free MyGatd)\ncapsToFree = Capabilities {myRead = FreeMonad.Free $ Read FreeMonad.Pure, myWrite = FreeMonad.Free . flip Write (FreeMonad.Pure ())}\n\nrunFreeToCaps :: IO ()\nrunFreeToCaps = freeToCaps programWithFreeMonad $ Capabilities {myRead = getLine, myWrite = putStrLn}\n\nrunCapsToFree :: IO ()\nrunCapsToFree = ioInterprefer $ programWithCapabilities capsToFree\n</code></pre>\n\n<p>My advice is to pick whichever feels more natural given the rest of your program, and know that if you change your mind, you can always write adapters like the above to help you refactor your program incrementally.</p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 9, "last_activity_date": 1557641040, "last_edit_date": 1557641040, "creation_date": 1557605738, "answer_id": 56093943, "question_id": 56092971, "link": "https://stackoverflow.com/questions/56092971/free-monad-vs-explicitly-passing-functions/56093943#56093943", "title": "Free Monad vs explicitly passing functions", "body": "<p>Even if we restrict ourselves to choosing between free monads and records-of-functions (leaving out solutions involving monad transformer stacks and MTL-like typeclasses) there's a lot of debate ongoing, and the matter it's not settled.</p>\n\n<p>The simple free monad has been traditionally accused of suffering from two flaws: runtime inefficiency (which might or not be important, depending on how slow the interpreter operations are by comparison) and lack of extensibility (how to lift a program into another having a richer set of effects?).</p>\n\n<p><a href=\"http://www.cs.ru.nl/~W.Swierstra/Publications/DataTypesALaCarte.pdf\" rel=\"nofollow noreferrer\">\"Data types a la carte\"</a> first attempted a solution to the extensibility problem. Later, the <a href=\"http://okmij.org/ftp/Haskell/extensible/more.pdf\" rel=\"nofollow noreferrer\">\"Freer Monads, More Extensible Effects\"</a> paper came out, which proposed a more sophisticated free type to increase the efficiency of the monadic bind, and also an extensible way of defining sets of operations. The main libraries implementing this approach are:</p>\n\n<ul>\n<li><p><a href=\"http://hackage.haskell.org/package/freer-simple\" rel=\"nofollow noreferrer\">freer-simple</a> The simplest to understand of the bunch, apparently also the slowest. It seems to have some limitations on bracket-type operations.</p></li>\n<li><p><a href=\"http://hackage.haskell.org/package/fused-effects\" rel=\"nofollow noreferrer\">fused-effects</a> More efficient library that allows bracket-type operations. But the types are also more complex.</p></li>\n<li><p><a href=\"http://hackage.haskell.org/package/polysemy\" rel=\"nofollow noreferrer\">polysemy</a> Relatively new library which aims to be fast and support bracket-type operations while retaining simple types.</p></li>\n</ul>\n\n<p>One appealing aspect of these libraries is that they let you interpret effects piecemeal, picking out one effect while leaving the rest uninterpreted. You can also interpret an abstract effect into other abstract effects, without having to go down to <code>IO</code> right away.</p>\n\n<hr>\n\n<p>As for the record-of-functions approach. Programs like <code>programWithCapabilities</code> which are polymorphic over a base monad, and which take a record of functions parameterized by the monad, are conceptually related to what is called the <a href=\"http://r6.ca/blog/20140210T181244Z.html\" rel=\"nofollow noreferrer\">van Laarhoven Free Monad</a>:</p>\n\n<pre><code>-- (ops m) is required to be isomorphic to (\u03a0 n. i_n -&gt; m j_n)\nnewtype VLMonad ops a = VLMonad { runVLMonad :: forall m. Monad m =&gt; ops m -&gt; m a }\n\ninstance Monad (VLMonad ops) where\n  return a = VLMonad (\\_ -&gt; return a)\n  m &gt;&gt;= f = VLMonad (\\ops -&gt; runVLMonad m ops &gt;&gt;= f' ops)\n   where\n    f' ops a = runVLMonad (f a) ops\n</code></pre>\n\n<p>From the linked post:</p>\n\n<blockquote>\n  <p>Swierstra notes that by summing together functors representing\n  primitive I/O actions and taking the free monad of that sum, we can\n  produce values use multiple I/O feature sets. Values defined on a\n  subset of features can be lifted into the free monad generated by the\n  sum. The equivalent process can be performed with the van Laarhoven\n  free monad by taking the product of records of the primitive\n  operations. Values defined on a subset of features can be lifted by\n  composing the van Laarhoven free monad with suitable projection\n  functions that pick out the requisite primitive operations.</p>\n</blockquote>\n\n<p>There don't seem to exist (?) libraries that give you a pre-fabricated <code>VLMonad</code> type. What does exist are libraries that take a record of functions but otherwise work over <code>IO</code>, like <a href=\"http://hackage.haskell.org/package/rio\" rel=\"nofollow noreferrer\"><code>RIO</code></a>. One can still abstract over the base monad in one's logic, and later use <code>RIO</code> when running the logic. Or prefer simplicity and rip the polymorphic veil that hides the <code>IO</code> from one's logic.</p>\n\n<p>The record-of-functions approach has perhaps the merit of being more easily grasped, being an incremental step-up from working directly on <code>IO</code>. It also more closely resembles the object-oriented way of doing dependency injection.</p>\n\n<p>The ergonomics of working with the record itself become central. Right now it is common to use <a href=\"https://stackoverflow.com/questions/38914782/how-to-get-classy-lenses-with-overloaded-field-names\">\"classy lenses\"</a> to make the program logic independent of the concrete record type and facilitate program composition. Perhaps one day extensible records could be used as well (like extensible sum types are used in the freer approach).  </p>\n"}], "owner": {"reputation": 121, "user_id": 9849454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab5d12f3f16b7d000a588241c8ab68c1?s=128&d=identicon&r=PG", "display_name": "moewb", "link": "https://stackoverflow.com/users/9849454/moewb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 2, "accepted_answer_id": 56093943, "answer_count": 2, "score": 8, "last_activity_date": 1557641040, "creation_date": 1557597637, "last_edit_date": 1557625938, "question_id": 56092971, "link": "https://stackoverflow.com/questions/56092971/free-monad-vs-explicitly-passing-functions", "title": "Free Monad vs explicitly passing functions", "body": "<p>I'm exploring options in Haskell that would let me separate business logic from the technical implementation of underlying systems. For example, in the context of a web server, separate how the web server treats the information it receives from how it reads from and writes to the database. To do such thing, there are many options but two caught my attention in particular: Free Monad and passing a capability record as argument. I'm having troubles seeing what would be the pros and cons of one over the other.</p>\n\n<p>A code snippet to illustrate what I'm talking about:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Lib where\n\nimport qualified Control.Monad.Free as FreeMonad\n\ndata MyGadt x\n  = Read (String -&gt; x)\n  | Write String\n          x\n\ninstance Functor MyGadt where\n  fmap f (Read g)      = Read (f . g)\n  fmap f (Write str x) = Write str (f x)\n\nprogramWithFreeMonad :: FreeMonad.Free MyGadt ()\nprogramWithFreeMonad = do\n  msg &lt;- FreeMonad.liftF $ Read id\n  FreeMonad.liftF $ Write msg ()\n\nioInterpreter :: FreeMonad.Free MyGadt x -&gt; IO x\nioInterpreter (FreeMonad.Pure x)             = return x\nioInterpreter (FreeMonad.Free (Read f))      = getLine &gt;&gt;= (ioInterpreter . f)\nioInterpreter (FreeMonad.Free (Write str x)) = putStrLn str &gt;&gt; ioInterpreter x\n\nrunProgramWithFreeMonad :: IO ()\nrunProgramWithFreeMonad = ioInterpreter programWithFreeMonad\n\ndata Capabilities m = Capabilities\n  { myRead  :: m String\n  , myWrite :: String -&gt; m ()\n  }\n\nprogramWithCapabilities :: Monad m =&gt; Capabilities m -&gt; m ()\nprogramWithCapabilities capabilities = do\n  msg &lt;- myRead capabilities\n  myWrite capabilities msg\n\nrunProgramWithCapabilities :: IO ()\nrunProgramWithCapabilities =\n  programWithCapabilities $ Capabilities {myRead = getLine, myWrite = putStrLn}\n\n</code></pre>\n\n<p>These two solutions are written differently so I think many have an opinion about how it looks and which one they prefer. But I was wondering if anyone had any insight about the pros and the cons of one solution over the other.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557596609, "post_id": 56092833, "comment_id": 98821701, "body": "It will just have type <code>id [] :: [a]</code>, so you can use this for whatever <code>a</code> you want."}, {"owner": {"reputation": 119, "user_id": 11105282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69760ebb467e75586cf0b3f3cdaf0cf2?s=128&d=identicon&r=PG&f=1", "display_name": "ErlGrey", "link": "https://stackoverflow.com/users/11105282/erlgrey"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557596864, "post_id": 56092833, "comment_id": 98821762, "body": "@WillemVanOnsem But it should return some concrete type, am I right?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1557596883, "post_id": 56092833, "comment_id": 98821766, "body": "@EricGrey: why should this be a concrete type?"}, {"owner": {"reputation": 119, "user_id": 11105282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69760ebb467e75586cf0b3f3cdaf0cf2?s=128&d=identicon&r=PG&f=1", "display_name": "ErlGrey", "link": "https://stackoverflow.com/users/11105282/erlgrey"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1557597145, "post_id": 56092833, "comment_id": 98821830, "body": "@WillemVanOnsem I don&#39;t know, it&#39;s a new language for me, I just thought about printing empty list, which is impossible if we haven&#39;t defined type of list"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557597264, "post_id": 56092833, "comment_id": 98821859, "body": "@EricGrey: there are some default rules at the end, but the concrete type of <code>id []</code> is derived from the context. For example if one uses <code>map (:&quot;&quot;) (id [])</code>, it is clear that the list is a list of <code>String</code>s."}, {"owner": {"reputation": 119, "user_id": 11105282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69760ebb467e75586cf0b3f3cdaf0cf2?s=128&d=identicon&r=PG&f=1", "display_name": "ErlGrey", "link": "https://stackoverflow.com/users/11105282/erlgrey"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557597640, "post_id": 56092833, "comment_id": 98821951, "body": "@WillemVanOnsem okey, so, if I apply filter function to it, e.g. <code>filter id []</code>, then return type will be bool?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1557597727, "post_id": 56092833, "comment_id": 98821982, "body": "@EricGrey: in that case the <code>[]</code> will be a list of <code>Bool</code>s, since you use <code>id</code> as <i>filter function</i>, and since <code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code> requires the filter function to be <code>a -&gt; Bool</code>, and <code>id</code> has type <code>b -&gt; b</code>, it reasons that <code>a ~ b ~ Bool</code>, and thus that <code>a</code> and <code>b</code> are <code>Bool</code>s, and thus <code>filter id []</code> &quot;collapses&quot; to <code>[Bool]</code>."}, {"owner": {"reputation": 119, "user_id": 11105282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69760ebb467e75586cf0b3f3cdaf0cf2?s=128&d=identicon&r=PG&f=1", "display_name": "ErlGrey", "link": "https://stackoverflow.com/users/11105282/erlgrey"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557597888, "post_id": 56092833, "comment_id": 98822026, "body": "@WillemVanOnsem Thank you! I think I understood this logic"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1557601620, "last_edit_date": 1557601620, "creation_date": 1557599591, "answer_id": 56093206, "question_id": 56092833, "link": "https://stackoverflow.com/questions/56092833/default-type-of-id-function/56093206#56093206", "title": "Default type of id function", "body": "<p><strong>In short</strong>: <code>id []</code> has type <code>[a]</code>, the exact type will depend on the context of the caller.</p>\n\n<p>We can perform the reasoning of the types ourselves. We basically have two items here: <code>id</code> and <code>[]</code>, <code>id</code> has as type <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:id\" rel=\"nofollow noreferrer\"><strong><code>id :: a -&gt; a</code></strong></a>, and <code>[]</code> is just a constructor, so it has type <strong><code>[] :: [b]</code></strong>.</p>\n\n<p>So we can derive the type with:</p>\n\n<pre><code>  id :: a   -&gt; a\n  [] :: [b]\n----------------\n  a ~ [b]\n</code></pre>\n\n<p>we thus conclude that the <code>a</code> in <code>id :: a -&gt; a</code> is the same type as <code>[b]</code>, and hence it means that the type of the result of <code>id []</code>, is <code>a</code> which is equal to <code>[b]</code>, so that means that:</p>\n\n<pre><code>id [] <b>:: [b]</b></code></pre>\n\n<p>We get the same result when we let <code>ghci</code> derive the type of <code>id []</code>:</p>\n\n<pre><code>Prelude&gt; :t id []\nid [] <b>:: [t]</b></code></pre>\n\n<p>Of course in a real program if you use <code>id []</code>, it will \"collapse\" to a certain type. That type depends on the use of <code>id []</code>, so of the \"caller\". For example if we call this with:</p>\n\n<pre><code><b>putStrLn</b> (id [])</code></pre>\n\n<p>Since <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:putStrLn\" rel=\"nofollow noreferrer\"><strong><code>putStrLn</code></strong></a> expects a <code>String</code> as parameter, this means that <code>id []</code> in <em>this</em> context should be a <code>String</code>. A <code>String</code> is just an <em>alias</em> for <code>[Char]</code>. So the type system reasons that in that case <code>b ~ Char</code>, so the list <code>[]</code> is in this context an empty list of <code>Char</code>s.</p>\n\n<p>But if we would use it in the context of <code>sum (id [])</code>, then the type would be totally different, since we can not <code>sum</code>up <code>Char</code>s, since we can only sum up types that are members of the <code>Num</code> type class.</p>\n\n<p>In case the ambiguity of the type ramains, Haskell has some <a href=\"https://kseo.github.io/posts/2017-01-04-type-defaulting-in-haskell.html\" rel=\"nofollow noreferrer\">defaulting rules [Kwang's Haskell blog]</a>. The <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-790004.3.4\" rel=\"nofollow noreferrer\">Haskell '10 report</a> for example also has a section on defining defaults for type classes.</p>\n"}], "owner": {"reputation": 119, "user_id": 11105282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69760ebb467e75586cf0b3f3cdaf0cf2?s=128&d=identicon&r=PG&f=1", "display_name": "ErlGrey", "link": "https://stackoverflow.com/users/11105282/erlgrey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1557601620, "creation_date": 1557596579, "question_id": 56092833, "link": "https://stackoverflow.com/questions/56092833/default-type-of-id-function", "title": "Default type of id function", "body": "<p>What type will have id function if I apply this function to an empty list? Is there some default type for id function or it depends on default type of list?</p>\n\n<pre><code>id []\n</code></pre>\n"}, {"tags": ["haskell", "io-monad"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557596008, "post_id": 56092743, "comment_id": 98821565, "body": "The error is probaby located in <code>ls &lt;- lines c</code>?"}, {"owner": {"reputation": 1477, "user_id": 6204637, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2aefad0b667887ac0c12219d41326a2e?s=128&d=identicon&r=PG&f=1", "display_name": "T.Poe", "link": "https://stackoverflow.com/users/6204637/t-poe"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557596181, "post_id": 56092743, "comment_id": 98821603, "body": "Yes, but I don&#39;t get it why..."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557596314, "post_id": 56092743, "comment_id": 98821631, "body": "because if you write <code>x &lt;- some_expr</code>, then <code>some_expr</code> needs to be of type <code>Monad m =&gt; m a</code>, and then <code>x</code> is of type <code>a</code>. Throughout a <code>do</code> block one uses the same monad <code>m</code>. <code>do</code> notation unfortunately may suggest that is just a bit of a different &quot;style&quot;. But in fact here monads come in to play. In short the idea is that Haskell is a <i>pure</i> functional language, and that a call with the same parameter always gives the same result. Stateful actions, like opening a file, etc. thus require a state. A monad <i>can</i> be used to <i>implictly</i> pass that state."}, {"owner": {"reputation": 1477, "user_id": 6204637, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2aefad0b667887ac0c12219d41326a2e?s=128&d=identicon&r=PG&f=1", "display_name": "T.Poe", "link": "https://stackoverflow.com/users/6204637/t-poe"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557596595, "post_id": 56092743, "comment_id": 98821699, "body": "Now it&#39;s clear to me, thank you for the explanation!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1557601187, "post_id": 56092743, "comment_id": 98822817, "body": "<code>ls &lt;- return $ lines c</code> wold work."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1557604409, "post_id": 56092743, "comment_id": 98823509, "body": "@WillNess Why involve <code>&lt;-</code> or <code>return</code> at all? Why not just <code>let ls = lines c</code>?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1557644501, "post_id": 56092743, "comment_id": 98829252, "body": "@JosephSible for uniformity? also, I was illustrating to the OP the types mismatch in their code."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1557597398, "creation_date": 1557597398, "answer_id": 56092939, "question_id": 56092743, "link": "https://stackoverflow.com/questions/56092743/couldnt-match-expected-type-io-string-with-actual-type-string/56092939#56092939", "title": "Couldn&#39;t match expected type \u2018IO [String]\u2019 with actual type \u2018[String]\u2019", "body": "<p>As Willem Van Onsem explained, you don't need <code>&lt;-</code> in that specific place because <code>lines c</code> is just a list of strings, and not an <code>IO</code> computation. If you want to give it a name, you can use a let-binding instead:</p>\n\n<pre><code>fdup' :: String -&gt; IO ()\nfdup' filename = do\n        h &lt;- openFile filename ReadMode\n        c &lt;- hGetContents h\n        let ls = lines c\n        putStr $ unlines $ parse $ ls\n        hClose h\n</code></pre>\n"}], "owner": {"reputation": 1477, "user_id": 6204637, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2aefad0b667887ac0c12219d41326a2e?s=128&d=identicon&r=PG&f=1", "display_name": "T.Poe", "link": "https://stackoverflow.com/users/6204637/t-poe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 56092939, "answer_count": 1, "score": 0, "last_activity_date": 1557597398, "creation_date": 1557595957, "question_id": 56092743, "link": "https://stackoverflow.com/questions/56092743/couldnt-match-expected-type-io-string-with-actual-type-string", "title": "Couldn&#39;t match expected type \u2018IO [String]\u2019 with actual type \u2018[String]\u2019", "body": "<p>I have these two code snippets, which I'd guess do the same thing, but they don't. Why is that?</p>\n\n<p>This one works fine:</p>\n\n<pre><code>fdup :: String -&gt; IO ()\nfdup filename = do\n        h &lt;- openFile filename ReadMode\n        c &lt;- hGetContents h\n        putStr $ unlines $ parse $ lines c\n        hClose h\n</code></pre>\n\n<p>This one returns an error <code>Couldn't match expected type \u2018IO [String]\u2019 with actual type \u2018[String]\u2019</code>:</p>\n\n<pre><code>fdup' :: String -&gt; IO ()\nfdup' filename = do\n        h &lt;- openFile filename ReadMode\n        c &lt;- hGetContents h\n        ls &lt;- lines c\n        putStr $ unlines $ parse $ ls\n        hClose h\n</code></pre>\n\n<p><code>parse :: [String] -&gt; [String]</code></p>\n\n<p>What is the difference between them?</p>\n"}, {"tags": ["haskell", "arrows"], "answers": [{"comments": [{"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "edited": false, "score": 0, "creation_date": 1557593201, "post_id": 56092045, "comment_id": 98820871, "body": "Wow, that was quick! Can you explain what the <code>@</code>s mean in the line <code>arrowfy f = arr (arrowfy @r @b @z . f)</code> ?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "edited": false, "score": 1, "creation_date": 1557594737, "post_id": 56092045, "comment_id": 98821266, "body": "I updated my answer with a note about typeapplications."}, {"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "edited": false, "score": 0, "creation_date": 1557826452, "post_id": 56092045, "comment_id": 98886011, "body": "Related side-question: Is it correct to assume that it is impossible to implement something like this without overlapping instances, because we have to check if <code>b</code> in <code>a -&gt; b</code> is another function or not? Or are there ways around this?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "edited": false, "score": 1, "creation_date": 1557840293, "post_id": 56092045, "comment_id": 98894104, "body": "Yes to decide whether a type is a function type or not, you need overlapping type class or type family instances in general. But for a less general situation, this is not necessary if you know that there are only a finite number of possible constructors at the root. The other approach I personally prefer is to explicitly annotate the number of arrows to &quot;lift&quot; through, so you would have <code>arrowfy @2 (+) :: r Int (r Int Int)</code> above, but you could also write <code>arrowfy @1 (+) :: r Int (Int -&gt; Int)</code> as well. This also avoids overlapping instances."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1557594725, "last_edit_date": 1557594725, "creation_date": 1557590730, "answer_id": 56092045, "question_id": 56091750, "link": "https://stackoverflow.com/questions/56091750/how-to-define-a-polyvariadic-arrow/56092045#56092045", "title": "How to define a polyvariadic arrow?", "body": "<p>Here's how you can define <code>arrowfy</code> to turn a function <code>a -&gt; b -&gt; ...</code> into an arrow <code>a `r` b `r` ...</code> (where <code>r :: Type -&gt; Type -&gt; Type</code> is your arrow type), and a function <code>uncurry_</code> to turn a function into one with a single tuple argument <code>(a, (b, ...)) -&gt; z</code> (which can then be lifted to an arbitrary arrow with <code>arr :: (u -&gt; v) -&gt; r u v</code>).</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE\n    AllowAmbiguousTypes,\n    FlexibleContexts,\n    FlexibleInstances,\n    MultiParamTypeClasses,\n    UndecidableInstances,\n    TypeApplications\n  #-}\n\nimport Control.Category hiding ((.), id)\nimport Control.Arrow\nimport Data.Kind (Type)\n</code></pre>\n\n<p>Both approaches use a multiparameter type class with overlapping instances. One instance for functions, which will be selected as long as the initial type is a function type, and one instance for the base case, which will be selected as soon as it's not a function type.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- Turn (a -&gt; (b -&gt; (c -&gt; ...))) into (a `r` (b `r` (c `r` ...)))\nclass Arrowfy (r :: Type -&gt; Type -&gt; Type) x y where\n  arrowfy :: x -&gt; y\n\ninstance {-# OVERLAPPING #-} (Arrow r, Arrowfy r b z, y ~ r a z) =&gt; Arrowfy r (a -&gt; b) y where\n  arrowfy f = arr (arrowfy @r @b @z . f)\n\ninstance (x ~ y) =&gt; Arrowfy r x y where\n  arrowfy = id\n</code></pre>\n\n<h3>Side note about <code>arrowfy @r @b @z</code> syntax</h3>\n\n<p>This is TypeApplications syntax, available since GHC 8.0.</p>\n\n<p>The type of arrowfy is:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>arrowfy :: forall r x y. Arrowfy r x y =&gt; x -&gt; y\n</code></pre>\n\n<p>The problem is that r is ambiguous: in an expression, the context can only determine x and y, and this doesn't necessarily restrict r.\nThe @r annotation allows us to explicitly specialize arrowfy.\nNote that the type arguments of arrowfy must occur in a fixed order:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>arrowfy :: forall r x y. ...\n\narrowfy @r1 @b @z             -- r = r1, x = b, y = z\n</code></pre>\n\n<p>(<a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-TypeApplications\" rel=\"nofollow noreferrer\">GHC user guide on <code>TypeApplications</code></a>)</p>\n\n<hr>\n\n<p>Now, for example, if you have an arrow <code>(:-&gt;)</code>, you can write this to turn it into an arrow:</p>\n\n<pre><code>test :: Int :-&gt; (Int :-&gt; Int)\ntest = arrowfy (+)\n</code></pre>\n\n<p>For <code>uncurry_</code>, there is a small additional trick so that n-argument functions are turned into functions on n-tuple, rather than (n+1)-tuples capped by a unit which you would get naively. Both instances are now indexed by function types, and what is actually being tested is whether the result type is a function.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- Turn (a -&gt; (b -&gt; (c -&gt; ... (... -&gt; z) ...))) into ((a, (b, (c, ...))) -&gt; z)\nclass Uncurry x y z where\n  uncurry_ :: x -&gt; y -&gt; z\n\ninstance {-# OVERLAPPING #-} (Uncurry (b -&gt; c) yb z, y ~ (a, yb)) =&gt; Uncurry (a -&gt; b -&gt; c) y z where\n  uncurry_ f (a, yb) = uncurry_ (f a) yb\n\ninstance (a ~ y, b ~ z) =&gt; Uncurry (a -&gt; b) y z where\n  uncurry_ = id\n</code></pre>\n\n<p>Some examples:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>testUncurry :: (Int, Int) -&gt; Int\ntestUncurry = uncurry_ (+)\n\n-- combined with arr\ntestUncurry2 :: (Int, (Int, (Int, Int))) :-&gt; Int\ntestUncurry2 = arr (uncurry_ (\\a b c d -&gt; a + b + c + d))\n</code></pre>\n\n<p>Full gist: <a href=\"https://gist.github.com/Lysxia/c754f2fd6a514d66559b92469e373352\" rel=\"nofollow noreferrer\">https://gist.github.com/Lysxia/c754f2fd6a514d66559b92469e373352</a></p>\n"}], "owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 1, "accepted_answer_id": 56092045, "answer_count": 1, "score": 2, "last_activity_date": 1560178124, "creation_date": 1557588678, "last_edit_date": 1560178124, "question_id": 56091750, "link": "https://stackoverflow.com/questions/56091750/how-to-define-a-polyvariadic-arrow", "title": "How to define a polyvariadic arrow?", "body": "<p>This question is somewhat related to <a href=\"https://stackoverflow.com/questions/56001863/how-to-work-with-types-that-change-under-composition\">this earlier one</a>:</p>\n\n<p>I am trying to define a couple of semi-dependent types, which allow you to track the 'monotonicity' of functions (as described in the <a href=\"https://infoscience.epfl.ch/record/231867/files/monotonicity-types.pdf\" rel=\"nofollow noreferrer\">Monotonicity Types</a> paper), so that the programmer does not have to do this manually (and fail at compile-time when a non-monotonic operation is passed to something that requires one).</p>\n\n<p>More generally: I'd like to keep track of some 'qualifiers' of a function</p>\n\n<p>Based on <a href=\"https://stackoverflow.com/questions/56001863/how-to-work-with-types-that-change-under-composition\">answers to this earlier question</a>, I have been able to define an 'indexed category' and 'indexed arrow' where the qualifiers of <code>h</code> in <code>h = f &gt;&gt;&gt; g</code> depend on the qualifiers of <code>f</code> and <code>g</code>.</p>\n\n<p>This works well, as long as you only work with single-argument functions. However, (and normal arrows also have this problem), when you try to create an arrow with multiple arguments, you have the following options. (Using <code>(+) :: Int -&gt; Int -&gt; Int</code> as example):</p>\n\n<ol>\n<li>Plain <code>arr (+)</code>. The result type of this will be <code>Arrow x =&gt; x Int (Int -&gt; Int)</code>, since the function is curried. This means that only the first parameter is lifted into the arrow context, since the arrow 'returns a function with one parameter less'. In other words: The arrow context is not used for the rest of the arguments, so that's not what we want.</li>\n<li><code>arr (uncurry (+))</code>. The result type of this will be <code>Arrow x =&gt; x (Int, Int) Int</code>. Now both parameters have become part of the arrow, but we lose the ability to e.g. partially apply it. It also is not clear to me how to do uncurrying in an arity-independent way: What if we want three, four, five, ...-parameter functions?</li>\n</ol>\n\n<p>I know it is possible to define a 'recursive typeclass' to create a polyvariadic function, such as for instance described on Rosettacode <a href=\"http://rosettacode.org/wiki/Variadic_function#Haskell\" rel=\"nofollow noreferrer\">here</a>. I have tried to define a more general function-wrapping type that might work that way, but I have not managed to do so far. I have no idea how to properly discern in the typeclass instance for <code>a -&gt; b</code> whether <code>b</code> is the final result or another function <code>(b' -&gt; c)</code>, and how to extract and use the qualifier of <code>b'</code> if it turns out to be the second case.</p>\n\n<p>Is this possible? Am I missing something here? Or am I completely on the wrong track and is there another way to lift an <em>n-argument</em> function into an arrow, regardless of the value of <em>n</em>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1557587017, "post_id": 56091494, "comment_id": 98819343, "body": "Hint: use <code>zip</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1557587317, "creation_date": 1557587317, "answer_id": 56091545, "question_id": 56091494, "link": "https://stackoverflow.com/questions/56091494/how-to-get-elements-index-in-list-when-using-foldl/56091545#56091545", "title": "How to get element&#39;s index in list when using foldl", "body": "<p>We can implement this in a more simple way. We can consider a infinite list where we repeat two functions: <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:id\" rel=\"noreferrer\"><strong><code>id :: a -&gt; a</code></strong></a>, and <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:negate\" rel=\"noreferrer\"><strong><code>negate :: Num a =&gt; a -&gt; a</code></strong></a>, and use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:cycle\" rel=\"noreferrer\"><strong><code>cycle :: [a] -&gt; [a]</code></strong></a> to construct an infinite list. So <code>cycle [id, negate]</code> will produce a list that looks like <code>[id, negate, id, negate, ...]</code>.</p>\n\n<p>We can then use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:zipWith\" rel=\"noreferrer\"><strong><code>zipWith</code></strong></a> to zip the infinite list with the list of values, and use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:-36-\" rel=\"noreferrer\"><strong><code>($) :: (a -&gt; b) -&gt; a -&gt; b</code></strong></a> as \"<em>zip function</em>\", so we get:</p>\n\n<pre><code>Prelude&gt; zipWith ($) (cycle [id, negate]) [1,4,2,5]\n[1,-4,2,-5]\n</code></pre>\n\n<p>The finally we can use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:sum\" rel=\"noreferrer\"><strong><code>sum :: Num a =&gt; [a] -&gt; a</code></strong></a> to sum up these values.</p>\n\n<p>So we can define the function as:</p>\n\n<pre><code>calculate :: Num a =&gt; [a] -&gt; a\ncalculate = sum . zipWith ($) (cycle [id, negate])</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; calculate [1,4,2,5]\n-6\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1557587686, "post_id": 56091582, "comment_id": 98819520, "body": "You can use <code>zip [1..] list</code>, and thus work with an <i>infinite</i> list, since <code>zip</code> stops from the moment one of the lists is exhausted :)"}], "tags": [], "owner": {"reputation": 83, "user_id": 10820642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df568521246bce63df8d5b02f96c060e?s=128&d=identicon&r=PG&f=1", "display_name": "J.G.", "link": "https://stackoverflow.com/users/10820642/j-g"}, "is_accepted": false, "score": 4, "last_activity_date": 1557587585, "creation_date": 1557587585, "answer_id": 56091582, "question_id": 56091494, "link": "https://stackoverflow.com/questions/56091494/how-to-get-elements-index-in-list-when-using-foldl/56091582#56091582", "title": "How to get element&#39;s index in list when using foldl", "body": "<p>Thanks to comment by Willem, I managed to do this in this way:</p>\n\n<pre><code>calculate list = foldl (\\x (index,el) -&gt; \n    x + (el * (-1)^(1 + index))\n    ) 0 (zip [1..length(list)] list)\n</code></pre>\n\n<p>For me, it's more readable one, because I'm newbie, I just posted it for others :)</p>\n"}], "owner": {"reputation": 83, "user_id": 10820642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df568521246bce63df8d5b02f96c060e?s=128&d=identicon&r=PG&f=1", "display_name": "J.G.", "link": "https://stackoverflow.com/users/10820642/j-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 494, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1557591054, "creation_date": 1557586872, "last_edit_date": 1557591054, "question_id": 56091494, "link": "https://stackoverflow.com/questions/56091494/how-to-get-elements-index-in-list-when-using-foldl", "title": "How to get element&#39;s index in list when using foldl", "body": "<p>I have to code a function to calculate <code>(sum k=1 to n) (-1)^(k+1) * a_k</code> from list <code>[a_1,a_2,a_3,..a_n]</code> using <code>foldl</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>calculate list = foldl (\\x xs -&gt; \n    x + (xs * (-1)^(??? + 1))\n    ) 0 list\n</code></pre>\n\n<p>I managed to write this code, but I don't have a clue what should replace <code>???</code>, how to get index of an element in given list.</p>\n"}, {"tags": ["list", "haskell", "list-comprehension"], "answers": [{"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1557581806, "post_id": 56090828, "comment_id": 98818123, "body": "The comprehension for A can be sped up a bit by using <code>[3, 38..]</code> as the source instead of the even numbers. That way it skips more invalid numbers."}], "tags": [], "owner": {"reputation": 8462, "user_id": 405865, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e29f04f339715955060858e0e65e1311?s=128&d=identicon&r=PG", "display_name": "fphilipe", "link": "https://stackoverflow.com/users/405865/fphilipe"}, "is_accepted": true, "score": 0, "last_activity_date": 1557581655, "creation_date": 1557581655, "answer_id": 56090828, "question_id": 56090713, "link": "https://stackoverflow.com/questions/56090713/haskell-list-comprehensions/56090828#56090828", "title": "Haskell: List Comprehensions", "body": "<p>a)</p>\n\n<pre><code>[n^2 | n &lt;- [2, 4..],\n       n `mod` 9 == 2,\n       n `mod` 35 == 3]\n</code></pre>\n\n<p>For b) it's important to list the sets in reverse order.</p>\n\n<pre><code>[(a, b, c, d) | d &lt;- ['Y', 'Z'],\n                c &lt;- [True, False],\n                b &lt;- ['p', 'r', 'g'],\n                a &lt;- [10, 34, 77, 180]]\n</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 11426990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83513622a4a19d1bcdf43d7b7bd3fb9d?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Wiese", "link": "https://stackoverflow.com/users/11426990/ron-wiese"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "closed_date": 1558436607, "accepted_answer_id": 56090828, "answer_count": 1, "score": -3, "last_activity_date": 1557581655, "creation_date": 1557580775, "last_edit_date": 1557581147, "question_id": 56090713, "link": "https://stackoverflow.com/questions/56090713/haskell-list-comprehensions", "closed_reason": "Needs more focus", "title": "Haskell: List Comprehensions", "body": "<p>I am practicing for my exam and have problems solving the following list-comprehensions-exercises:</p>\n\n<p>a) Create the infinite list of square numbers n^2, with n element of N,\nwhich are even numbers, have the rest 2 when they are divided by 9 and have the rest 3 when divided by 35, which means:</p>\n\n<pre><code>    [1444,446224,1684804,3717184,...]\n</code></pre>\n\n<p>b) Create a list of tupel (a, b, c, d) for all a \u2208 {10, 34, 77, 180}, b \u2208 {\u2019p\u2019,\u2019r\u2019,\u2019g\u2019}, c \u2208 {False, True} and d \u2208 {\u2019Y\u2019,\u2019Z\u2019}. The order of the elements should change numbers first, then lower letters, then boolean value and then upper letters, which means:</p>\n\n<pre><code>    [(10,\u2019p\u2019,False,\u2019Y\u2019),(34,\u2019p\u2019,False,\u2019Y\u2019),(77,\u2019p\u2019,False,\u2019Y\u2019) \n    (180,\u2019p\u2019,False,\u2019Y\u2019),(10,\u2019r\u2019,False,\u2019Y\u2019),(34,\u2019r\u2019,False,\u2019Y\u2019), \n    (77,\u2019r\u2019,False,\u2019Y\u2019),(180,\u2019r\u2019,False,\u2019Y\u2019)...]\n</code></pre>\n\n<p>I am not quite sure how to implement this in actual haskell code.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 8556, "user_id": 4892417, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NaBTj.jpg?s=128&g=1", "display_name": "oisdk", "link": "https://stackoverflow.com/users/4892417/oisdk"}, "is_accepted": false, "score": 5, "last_activity_date": 1557571982, "creation_date": 1557571982, "answer_id": 56089615, "question_id": 56088579, "link": "https://stackoverflow.com/questions/56088579/the-relationship-between-generic-lens-and-datakinds-ghc-extension/56089615#56089615", "title": "The relationship between generic-lens and DataKinds GHC extension", "body": "<p><code>DataKinds</code> is an extension that allows data types to be promoted to the type-level. What this means precisely is kind of a can of worms (it's one step on the way to dependent types), so I'll try and keep this explanation focused on just why generic-lens uses it (but bear in mind I'm simplifying here).</p>\n\n<p>First, a quick detour. What's the type of the following expression?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>mempty\n</code></pre>\n\n<p><code>mempty</code> comes from the <code>Monoid</code> class. However, in contrast to most methods, it doesn't take any arguments. So how does Haskell know which type to instantiate it as? All of the following are true:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>mempty == []\nmempty == Sum 0\nmempty == Any False\n</code></pre>\n\n<p>In short, Haskell (or GHC, rather) <em>infers</em> the type of the expression, and uses that inference to pick the right implementation. Sometimes, inference doesn't work. In the following expression, for instance:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>print mempty\n</code></pre>\n\n<p>We would have to give the type explicitly, like so:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>print (mempty :: [Int])\n</code></pre>\n\n<p>The <code>@</code> symbol is a syntax for applying any type that would usually be inferred. So, in this case, we could have written:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>print (mempty @[Int])\n</code></pre>\n\n<p>It's not the same as <code>::</code>, though: the <code>@</code> symbol specifically fills the first type hole that ghc was trying to guess. So we could have equally applied it in front of print:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>print @[Int] mempty\n</code></pre>\n\n<p>So, you can see that <code>@</code> is a way for us to apply a type to an expression. What it really lets us do, though, is get a <em>value</em> from a <em>type</em> (easily). For instance:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE TypeApplications, AllowAmbiguousTypes #-}\n\nclass TypeName a where\n    name :: String\n\ninstance TypeName Int where\n    name = \"Hello, I'm an Int!\"\n\ninstance TypeName Bool where\n    name = \"Bool!\"\n\nname @Int\n</code></pre>\n\n<p>In other words, we can have type-level programs produce value-level results. And this is where generic-lens comes in. This package uses it for fields. When you have a type like the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Person\n  = Person\n  { name :: String\n  , age  :: Int \n  }\n</code></pre>\n\n<p>You could produce two lenses, one called <code>_name</code>, and the other <code>_age</code> (or something). What generic-lens does is slightly more clever: it has one function (<a href=\"https://hackage.haskell.org/package/generic-lens-1.1.0.0/docs/Data-Generics-Labels.html#v:fieldLens\" rel=\"noreferrer\"><code>fieldLens</code></a>) which you use like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- age lens\nfieldLens @\"age\"\n</code></pre>\n\n<p>Here, finally, is where we need <code>DataKinds</code>. Traditionally speaking, only types are allowed at the type level, which is what the <code>@</code> symbol deals with. That above is a string, though: lifting this restriction is precisely what <code>DataKinds</code> does.</p>\n\n<p>Finally, you don't technically <em>need</em> <code>DataKinds</code> to fake the above behavior. You could just use types again. In fact, before <code>DataKinds</code>, people used to do things like the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data AgeField = DontConstructMe\n\nfieldLens @AgeField\n</code></pre>\n"}], "owner": {"reputation": 2659, "user_id": 581085, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5ef2ca8729e462595f1500b554ef95e0?s=128&d=identicon&r=PG", "display_name": "Dragno", "link": "https://stackoverflow.com/users/581085/dragno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1557571982, "creation_date": 1557563503, "question_id": 56088579, "link": "https://stackoverflow.com/questions/56088579/the-relationship-between-generic-lens-and-datakinds-ghc-extension", "title": "The relationship between generic-lens and DataKinds GHC extension", "body": "<p>If I try to access a field of a type using the @ symbol in generic-lens package GHC complains about enabling the DataKinds extension. Can you explain me in simple English what's the relationship generic-lens and DataKinds?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "random"], "comments": [{"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557524173, "post_id": 56084779, "comment_id": 98808439, "body": "How about statistics package?"}, {"owner": {"reputation": 285, "user_id": 3462133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08445007e5a529a2eeab334c7420ff63?s=128&d=identicon&r=PG", "display_name": "Kevin S. Van Horn", "link": "https://stackoverflow.com/users/3462133/kevin-s-van-horn"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557524580, "post_id": 56084779, "comment_id": 98808547, "body": "Same issue with the statistics package -- I get lost when I get down to the section on random number generation and it starts using <code>PrimState</code> and <code>PrimMonad</code> in the function signatures. Whatever happened to <code>System.Random.RandomGen</code>?"}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557524834, "post_id": 56084779, "comment_id": 98808604, "body": "How about <code>probable</code>? Seems to have some simple examples, works with distributions from statistics, updated recently."}, {"owner": {"reputation": 285, "user_id": 3462133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08445007e5a529a2eeab334c7420ff63?s=128&d=identicon&r=PG", "display_name": "Kevin S. Van Horn", "link": "https://stackoverflow.com/users/3462133/kevin-s-van-horn"}, "reply_to_user": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 0, "creation_date": 1557526846, "post_id": 56084779, "comment_id": 98809074, "body": "Same issue with <code>PrimState</code> and <code>PrimMonad</code> again. And trying to figure out where the standard <code>System.Random.RandomGen</code> fits in here, if at all."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1557526906, "post_id": 56084779, "comment_id": 98809082, "body": "Q: What happened to <code>System.Random.RandomGen</code>? A: It&#39;s slow and not very random, so people use better generators (that are, generally, both faster and less predictable) whenever they can. No sense whining about it; instead, take this as an opportunity to learn more about Haskell as you dig into the complicated API. (Yes, every part of the complication is well-motivated by technical considerations.)"}, {"owner": {"reputation": 285, "user_id": 3462133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08445007e5a529a2eeab334c7420ff63?s=128&d=identicon&r=PG", "display_name": "Kevin S. Van Horn", "link": "https://stackoverflow.com/users/3462133/kevin-s-van-horn"}, "edited": false, "score": 0, "creation_date": 1557528545, "post_id": 56084779, "comment_id": 98809472, "body": "OK, but where do I find a good explanation of <code>Gen</code>, <code>PrimState</code>, and <code>PrimMonad</code>? The official documentation is pretty opaque. And... as far as I can tell, these packages seem to have the underlying PRNG hard-wired in, which is <i>very much</i> contrary to the spirit of Haskell. (I hope this isn&#39;t actually the case!)"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1557531669, "post_id": 56084779, "comment_id": 98809973, "body": "@KevinS.VanHorn I&#39;m not sure where you&#39;re getting the idea of a &quot;hard coded&quot; random source from. That&#39;s absolutely not the case. You always have to provide your own source of randomness with these packages."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 2, "creation_date": 1557532421, "post_id": 56084779, "comment_id": 98810073, "body": "There are good answers to many of the questions you&#39;ve raised in comments -- it&#39;s not that hard to explain what <code>PrimMonad</code> is (and why it&#39;s used), and I believe you can use a <code>RandomGen</code> instance as a <code>random-fu</code> RNG without too much pain.  However, these answers won&#39;t fit in comments, and they aren&#39;t answers to the original question.  Perhaps you could post these as additional questions?"}, {"owner": {"reputation": 285, "user_id": 3462133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08445007e5a529a2eeab334c7420ff63?s=128&d=identicon&r=PG", "display_name": "Kevin S. Van Horn", "link": "https://stackoverflow.com/users/3462133/kevin-s-van-horn"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1557637988, "post_id": 56084779, "comment_id": 98828385, "body": "@cubic, AFAICT, all random variable generation in the package <code>statistics</code> requires an argument of the very specific type <code>Gen (PrimState m)</code>, and ultimately goes through <code>System.Random.MWC.uniform</code>, which ultimately calls <code>uniformWord32</code>, a very specific pseudo-random number generator that implements Marsaglia&#39;s MWC256 algorithm. This is  hard-wired in; there is no way for me to substitute in a different PRNG. The same seems to apply to all of these packages."}], "answers": [{"comments": [{"owner": {"reputation": 285, "user_id": 3462133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08445007e5a529a2eeab334c7420ff63?s=128&d=identicon&r=PG", "display_name": "Kevin S. Van Horn", "link": "https://stackoverflow.com/users/3462133/kevin-s-van-horn"}, "edited": false, "score": 0, "creation_date": 1557525443, "post_id": 56085157, "comment_id": 98808735, "body": "Thanks, that&#39;s a nice example. But the deciding factor is really that I can&#39;t figure out what the underlying source of random bits is in your example, or how to provide the underlying RNG in general. When I look at the documentation for <code>sample</code>, I see that I need to understand the typeclasses <code>Sampleable</code> and <code>MonadRandom</code>. The latter has barely any documentation -- not even a list of required methods! The former requires me to understand <code>RandomSource</code> and, possibly, <code>Lift</code>. The documentation for both of those is quite sparse."}, {"owner": {"reputation": 285, "user_id": 3462133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08445007e5a529a2eeab334c7420ff63?s=128&d=identicon&r=PG", "display_name": "Kevin S. Van Horn", "link": "https://stackoverflow.com/users/3462133/kevin-s-van-horn"}, "edited": false, "score": 0, "creation_date": 1557525769, "post_id": 56085157, "comment_id": 98808822, "body": "Similar comment with <code>mwc-probability</code> -- it&#39;s unclear where the underlying RNG is coming from, and function signatures for random variate generation refer to the mysterious typeclasses <code>PrimState</code> and <code>PrimMonad</code>. What happened to <code>System.Random.RandomGen</code>?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 285, "user_id": 3462133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08445007e5a529a2eeab334c7420ff63?s=128&d=identicon&r=PG", "display_name": "Kevin S. Van Horn", "link": "https://stackoverflow.com/users/3462133/kevin-s-van-horn"}, "edited": false, "score": 1, "creation_date": 1557527596, "post_id": 56085157, "comment_id": 98809247, "body": "Ah, in that case the answer is no, there is no (reasonably popular and maintained) Haskell package that includes samplers for a standard set of probability distributions, is well documented, can be understood without reference to a <code>MonadRandom</code> or mechanism of similar complexity, and would also support a monadic syntax similar to what you describe."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 285, "user_id": 3462133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08445007e5a529a2eeab334c7420ff63?s=128&d=identicon&r=PG", "display_name": "Kevin S. Van Horn", "link": "https://stackoverflow.com/users/3462133/kevin-s-van-horn"}, "edited": false, "score": 1, "creation_date": 1557533764, "post_id": 56085157, "comment_id": 98810254, "body": "@KevinS.VanHorn sounds like maybe it&#39;s time to level up your haskell-fu?  Try to understand despite the sparse documentation.  It&#39;s all open source after all.  Ask questions when you get stuck, we&#39;re here to help!"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 5, "last_activity_date": 1557524493, "creation_date": 1557524493, "answer_id": 56085157, "question_id": 56084779, "link": "https://stackoverflow.com/questions/56084779/haskell-package-for-sampling-from-standard-probability-distributions/56085157#56085157", "title": "Haskell package for sampling from standard probability distributions", "body": "<p>Well, if you want to be able to write code like this:</p>\n\n<pre><code>do n &lt;- poisson lambda\n   xs &lt;- replicateM n $ normal mu sigma\n   return $ maximum xs\n</code></pre>\n\n<p>then you presumably want to use <code>random-fu</code>:</p>\n\n<pre><code>import Control.Monad\nimport Data.Random\nimport Data.Random.Distribution.Poisson\nimport Data.Random.Distribution.Normal\n\nfoo :: RVar Double\nfoo = do\n  n &lt;- poisson lambda\n  xs &lt;- replicateM (n+1) $ normal mu sigma\n  return $ maximum xs\n\n  where lambda = 10 :: Double\n        mu = 0\n        sigma = 6\n\nmain :: IO ()\nmain = print =&lt;&lt; replicateM 10 (sample foo)\n</code></pre>\n\n<p>I'm not sure that lack of updates over the past three years should be a deciding factor.  Have there really been <em>that</em> many exciting advances in the world of gamma distributions?</p>\n\n<p>Actually, it looks like <code>mwc-probability</code> works about the same:</p>\n\n<pre><code>import Control.Monad\nimport System.Random.MWC.Probability\n\nfoo :: Prob IO Double\nfoo = do\n  n &lt;- poisson lambda\n  xs &lt;- replicateM (n+1) $ normal mu sigma\n  return $ maximum xs\n\n  where lambda = 10 :: Double\n        mu = 0\n        sigma = 6\n\nmain :: IO ()\nmain = do\n  gen &lt;- createSystemRandom\n  print =&lt;&lt; replicateM 10 (sample foo gen)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 285, "user_id": 3462133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08445007e5a529a2eeab334c7420ff63?s=128&d=identicon&r=PG", "display_name": "Kevin S. Van Horn", "link": "https://stackoverflow.com/users/3462133/kevin-s-van-horn"}, "is_accepted": false, "score": 1, "last_activity_date": 1558409802, "creation_date": 1558409802, "answer_id": 56230733, "question_id": 56084779, "link": "https://stackoverflow.com/questions/56084779/haskell-package-for-sampling-from-standard-probability-distributions/56230733#56230733", "title": "Haskell package for sampling from standard probability distributions", "body": "<p>I figured out the packages <code>mwc-random</code> and <code>statistics</code> sufficiently to make them usable for my purposes. To make them easier to use, I defined some wrappers, described below. The complete set of packages my solution uses is <code>transformers</code>, <code>vector</code>, <code>mwc-random</code>, and <code>statistics</code>.</p>\n\n<p>First, here are the needed language extensions and imports:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nimport Control.Monad (replicateM)\nimport Control.Monad.ST\nimport Control.Monad.Trans.Reader\nimport qualified Data.Vector as V\nimport Data.Vector.Generic hiding (replicateM, sum, product)\nimport Data.Word\nimport System.Random.MWC (Gen)\nimport qualified System.Random.MWC as R\nimport Statistics.Distribution\nimport Statistics.Distribution.Normal\n</code></pre>\n\n<p>I define a random-sampling monad <code>Rand</code> that hides from the user the need to understand <code>PrimMonad</code> and <code>PrimState</code>, and provides some needed utilities. (If you're interested in the details, <code>Gen s a</code> is a uniform PRNG that returns values of type <code>a</code>, <code>ST s</code> is a state-transformer monad, and the uninstantiated type variable <code>s</code> is part of a type-system hack that prevents state-updating side effects from escaping the monad.) An unfortunate feature of the <code>mwc-random</code> and <code>statistics</code> packages is that the primitive PRNG, based on Marsaglia's MWC256 algorithm, is hardwired-in; you cannot substitute a different PRNG.</p>\n\n<pre><code>type Rand0 s a = ReaderT (Gen s) (ST s) a\ntype Rand a = (forall s. Rand0 s a)  -- the random-sampling monad\n\n-- A draw from the Uniform(0.0, 1.0) distribution\nuniform01 :: Rand Double\nuniform01 = ask &gt;&gt;= R.uniform\n\n-- Provide a seed for the PRNG and return a draw from the random sampler\nrunRandL :: Rand a -&gt; [Word32] -&gt; a\nrunRandL rand seeds = runRandV rand (V.fromList seeds)\n\n-- Provide a seed for the PRNG and return a draw from the random sampler\nrunRandV :: Vector v Word32 =&gt; Rand a -&gt; v Word32 -&gt; a\nrunRandV rand seeds =\n  runST $ R.initialize seeds &gt;&gt;= runReaderT rand\n\n-- Seed the PRNG with data from the system's fast source of pseudo-random numbers,\n-- then return a draw from the random sampler\nrunRandIO :: Rand a -&gt; IO a\nrunRandIO rand = do\n  gen &lt;- R.createSystemRandom\n  seeds &lt;- R.fromSeed &lt;$&gt; R.save gen\n  return $ runRandV rand seeds\n</code></pre>\n\n<p>If you have <code>f :: Rand a</code> and you want <code>n</code> independent draws from <code>f</code>, then use <code>replicateM f :: Rand [a]</code> or <code>V.replicateM f :: Rand (V.Vector a)</code>. The following example returns a draw from the sum of <code>n</code> independent uniform random variables:</p>\n\n<pre><code>sumOfUniform :: Int -&gt; Rand Double\nsumOfUniform n = do\n  xs &lt;- replicateM n uniform01\n  return $ sum xs\n</code></pre>\n\n<p>The <code>statistics</code> package provides various data types that correspond to common statistical distributions. For example, <code>normalDistr mu sigma :: NormalDistribution</code> is an object representing a normal distribution; it contains the parameter values <code>mu</code> for the mean and <code>sigma</code> for the std deviation.</p>\n\n<p>Instances of type class <code>ContDistr d</code> provide density and inverse CDF (quantile) functions for objects of distribution type <code>d</code>.</p>\n\n<p>Instances of type class <code>ContGen d</code> provide a <code>genContVar</code> function for drawing from a continuous distribution, and instances of type class <code>DiscrGen d</code> provide a <code>genDiscrVar</code> function for drawing from a discrete distribution.</p>\n\n<p>To make all of this easy to use with the <code>Rand</code> monad, I define some wrappers:</p>\n\n<pre><code>-- Draw from the continuous distribution d\ngenContV :: ContGen d =&gt; d -&gt; Rand Double\ngenContV d = ask &gt;&gt;= genContVar d\n\n-- Draw from the discrete distribution d\ngenDiscrV :: DiscreteGen d =&gt; d -&gt; Rand Int\ngenDiscrV d = ask &gt;&gt;= genDiscreteVar d\n\n-- Draw from the continuous distribution d using the inverse CDF method.\ngenCont :: ContDistr d =&gt; d -&gt; Rand Double\ngenCont d = ask &gt;&gt;= genContinuous d\n\n-- Draw from the normal distribution with mean mu and std dev sigma\nnormal :: Double -&gt; Double -&gt; Rand Double\nnormal mu sigma = genContV $ normalDistr mu sigma\n</code></pre>\n\n<p>Wrappers for other distributions (exponential, beta, gamma, etc.) follow the same pattern as the wrapper for normal distributions.</p>\n\n<p>As a final example, here is a draw from the product of two normally-distributed random variables:</p>\n\n<pre><code>productOf2Normals :: Double -&gt; Double -&gt; Rand Double\nproductOf2Normals mu sigma = do\n  x1 &lt;- normal mu sigma\n  x2 &lt;- normal mu sigma\n  return $ x1 * x2\n</code></pre>\n"}], "owner": {"reputation": 285, "user_id": 3462133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08445007e5a529a2eeab334c7420ff63?s=128&d=identicon&r=PG", "display_name": "Kevin S. Van Horn", "link": "https://stackoverflow.com/users/3462133/kevin-s-van-horn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 2, "accepted_answer_id": 56085157, "answer_count": 2, "score": 6, "last_activity_date": 1558409802, "creation_date": 1557521949, "question_id": 56084779, "link": "https://stackoverflow.com/questions/56084779/haskell-package-for-sampling-from-standard-probability-distributions", "title": "Haskell package for sampling from standard probability distributions", "body": "<p>I would like to do some Monte Carlo analysis in Haskell. I would like to be able to write code like this:</p>\n\n<pre><code>do n &lt;- poisson lambda\n   xs &lt;- replicateM n $ normal mu sigma\n   return $ maximum xs\n</code></pre>\n\n<p>which corresponds to the stochastic model</p>\n\n<pre><code>n ~ Poisson(lambda)\nfor (i in 1:n)\n  x[i] ~ Normal(mu, sigma)\ny = max_{i=1}^n x[i]\n</code></pre>\n\n<p>I can see how to create the necessary random-sampling monad pretty easily. However, I would prefer not to have to implement samplers for all of the standard probability distributions. Is there a Haskell package that already has these implemented?</p>\n\n<p>I have looked at package <code>random-fu</code>, which has been stalled at version 0.2.7 for three years, but I can't make sense of it; it depends on typeclasses <code>MonadRandom</code> and <code>RandomSource</code>, which aren't well explained.</p>\n\n<p>I've also looked at package <code>mwc-probability</code>, but I can't make sense of it either -- it seems you have to already understand the <code>PrimMonad</code> and <code>PrimState</code> typeclasses.</p>\n\n<p>Both of these packages strike me as having overly complex APIs, and seem to have entirely abandoned the standard random-number-generation framework of Haskell as found in <code>System.Random</code>.</p>\n\n<p>Any advice would be appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 1, "creation_date": 1557514242, "post_id": 56083098, "comment_id": 98804896, "body": "What the teacher possibly wanted may be a classical helper function with an accumulator parameter. Moving mutable state into parameters is a typical FP trick. Filtering out the character while you&#39;re counting, and passing the filtered list to the next counting invocation helps both performance and logic."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 11482723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b293d0ce0f0f9254e7673128aedbcf9?s=128&d=identicon&r=PG&f=1", "display_name": "Snikcers", "link": "https://stackoverflow.com/users/11482723/snikcers"}, "edited": false, "score": 0, "creation_date": 1557514173, "post_id": 56083267, "comment_id": 98804871, "body": "Thanks a lot! How is the let expression changing this &quot;length [n | n &lt;- y, n == x]&quot; into a list? Isnt it a form of binder?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 23, "user_id": 11482723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b293d0ce0f0f9254e7673128aedbcf9?s=128&d=identicon&r=PG&f=1", "display_name": "Snikcers", "link": "https://stackoverflow.com/users/11482723/snikcers"}, "edited": false, "score": 1, "creation_date": 1557514274, "post_id": 56083267, "comment_id": 98804912, "body": "It doesn&#39;t change it to a list. <code>let</code> is for binding a value like you say."}], "tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": true, "score": 3, "last_activity_date": 1557526342, "last_edit_date": 1557526342, "creation_date": 1557513936, "answer_id": 56083267, "question_id": 56083098, "link": "https://stackoverflow.com/questions/56083098/counting-the-occurrences-of-chararacters-in-a-string/56083267#56083267", "title": "Counting the occurrences of chararacters in a string", "body": "<p><code>occur2</code> isn't working because <code>count x y</code> is not a list, so it can't be used for a generator expression like in <code>z &lt;- count x y</code>. Instead, use a <code>let</code> expression.</p>\n\n<p>You can remove the <code>count</code> definition by inlining it.</p>\n\n<pre><code>occur :: String -&gt; [(Char,Int)]\noccur y = [ (x,z) | x &lt;- ['a'..'z'], let z = length [n | n &lt;- y, n == x], z &gt; 0]\n</code></pre>\n\n<p>If you were to use libraries, a simple and efficient implementation would be to use a <a href=\"https://hackage.haskell.org/package/multiset-0.3.4.1/docs/Data-MultiSet.html#t:MultiSet\" rel=\"nofollow noreferrer\"><code>MultiSet</code></a>.</p>\n\n<pre><code>import qualified Data.MultiSet as MS\n\noccur :: String -&gt; [(Char,Int)]\noccur = MS.toAscOccurList . MS.fromList . filter (\\c -&gt; c &gt;= 'a' &amp;&amp; c &lt;= 'z')\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 11482723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b293d0ce0f0f9254e7673128aedbcf9?s=128&d=identicon&r=PG&f=1", "display_name": "Snikcers", "link": "https://stackoverflow.com/users/11482723/snikcers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 56083267, "answer_count": 1, "score": 2, "last_activity_date": 1557526342, "creation_date": 1557513131, "last_edit_date": 1557513430, "question_id": 56083098, "link": "https://stackoverflow.com/questions/56083098/counting-the-occurrences-of-chararacters-in-a-string", "title": "Counting the occurrences of chararacters in a string", "body": "<p>I got the task to count the number of occurrences of each (lower case) character in a string. I am not allowed to use any function of the library, I came up with the following, working solution.</p>\n\n<pre><code>occur :: String -&gt; [(Char,Int)]\noccur y =  [ (x,count x y) | x&lt;-['a'..'z'],  count x y &gt; 0]\n\n</code></pre>\n\n<p>I was trying at first:</p>\n\n<pre><code>occur2 :: String -&gt; [(Char,Int)]\noccur2 y =  [ (x,z) | x&lt;-['a'..'z'], z&lt;- count x y,  count x y &gt; 0]\n</code></pre>\n\n<p>I defined the helper function count like this:</p>\n\n<pre><code>count :: Char -&gt; String -&gt; Int\ncount k str = length [n | n &lt;- str, n == k]\n\n</code></pre>\n\n<p>Two questions:</p>\n\n<ol>\n<li>Why is occur2 not working?</li>\n<li>Is there any way to define occur without my aux function count?</li>\n</ol>\n"}, {"tags": ["haskell", "functional-programming", "higher-order-functions"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1557502351, "post_id": 56080676, "comment_id": 98799585, "body": "The word you&#39;re looking for is <code>currying</code>. Unlike most other programming languages, Haskell functions are &quot;curried&quot; by default, which makes usages like this possible (and natural)."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 9, "creation_date": 1557505033, "post_id": 56080676, "comment_id": 98800874, "body": "How does it know?  Types!"}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 1, "creation_date": 1557508099, "post_id": 56080676, "comment_id": 98802185, "body": "(Specifically, the type of <code>filter</code>. <code>filter</code> is declared with (curried) type <code>(a -&gt; Bool) -&gt; [a] -&gt; [a]</code>, which is the same as <code>(a -&gt; Bool) -&gt; ([a] -&gt; [a])</code> (function type arrow <code>-&gt;</code> is right associative, so you can always add parentheses on its right side). Therefore <code>filter anyPredicate</code> must have type <code>[a] -&gt; [a]</code>, which is a thing that expects an input list.)"}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 5, "creation_date": 1557509246, "post_id": 56080676, "comment_id": 98802721, "body": "You do this in English too.  You can say &quot;To teach is to understand&quot; (<code>teach = understand</code>) without having to say &quot;To teach something is to understand that thing&quot; (<code>teach x = understand x</code>)&quot;"}], "owner": {"reputation": 51, "user_id": 11210685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94ad41c917f7421efbd323a485d5d98b?s=128&d=identicon&r=PG&f=1", "display_name": "LemonPudding", "link": "https://stackoverflow.com/users/11210685/lemonpudding"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "closed_date": 1557512043, "answer_count": 0, "score": 2, "last_activity_date": 1557511799, "creation_date": 1557502138, "last_edit_date": 1557511799, "question_id": 56080676, "link": "https://stackoverflow.com/questions/56080676/why-can-higher-order-functions-be-declared-without-specifying-that-they-need-an", "closed_reason": "Duplicate", "title": "Why can higher order functions be declared without specifying that they need an input?", "body": "<p>For if I wanted to make a higher order function that filters even numbers out of a list using the predefined filter function I can do it like this:</p>\n\n<pre><code>filtereven list = filter even list\n</code></pre>\n\n<p>but another thing that still works is:</p>\n\n<pre><code>filtereven = filter even\n</code></pre>\n\n<p>why does this work and how does it know that it should expect an input list?</p>\n"}, {"tags": ["list", "haskell", "recursion", "indexing", "list-comprehension"], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1557508284, "post_id": 56079632, "comment_id": 98802273, "body": "Why is there still a zip at all in this implementation?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1557508991, "post_id": 56079632, "comment_id": 98802601, "body": "That&#39;s a good point @amalloy :) I just concentrated on explaining why the implementation in the OP didn&#39;t work, and how to fix it. And then went on to briefly mention easier ways to do it. And yes, I totally missed that the correction made <code>zip</code> completely unnecessary!"}, {"owner": {"reputation": 63, "user_id": 11481481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74d7cd831ec1895788526cde5765f781?s=128&d=identicon&r=PG&f=1", "display_name": "ProgramCat", "link": "https://stackoverflow.com/users/11481481/programcat"}, "edited": false, "score": 0, "creation_date": 1557515498, "post_id": 56079632, "comment_id": 98805417, "body": "After my list comprehension worked, i thought about to make it with zip in recursive way as well. At first i didn&#39;t thought about a faster runtime or anything like that, i just want to improve my skills by working with haskell. I guess it&#39;s  good to program the same programs in different ways. In additon you guys taught me a lot of new commands and the reaction of haskell. I&#39;m really thankful! :)"}], "tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": true, "score": 6, "last_activity_date": 1557513055, "last_edit_date": 1557513055, "creation_date": 1557498326, "answer_id": 56079632, "question_id": 56079450, "link": "https://stackoverflow.com/questions/56079450/how-to-get-the-index-of-an-element-in-a-list-by-not-using-list-comprehensions/56079632#56079632", "title": "How to get the Index of an element in a list, by not using &quot;list comprehensions&quot;?", "body": "<p>The problem with your attempt is simply that when you say:</p>\n\n<pre><code>let ((n,m):ns) = zip [0..(length (x:xs))] (x:xs)\n</code></pre>\n\n<p>then <code>n</code> will always be <code>0</code>. That's because you are matching <code>(n,m)</code> against the first element of <code>zip [0..(length (x:xs))] (x:xs)</code>, which will necessarily always be <code>(0,x)</code>.</p>\n\n<p>That's not a problem in itself - but it does mean you have to handle the recursive step properly. The way you have it now, <code>positions _ _</code>, if non-empty, will <em>always</em> have <code>0</code> as its first element, because the only way you allow it to find a match is if it's at the head of the list, resulting in an index of <code>0</code>. That means that your result will always be a list of the correct length, but with all elements <code>0</code> - as you're seeing.</p>\n\n<p>The problem isn't with your recursion scheme though, it's to do with the fact that you're not modifying the result to account for the fact that you don't always want <code>0</code> added to the front of the result list. Since each recursive call just adds 1 to the index you want to find, all you need to do is <code>map</code> the increment function <code>(+1)</code> over the recursive result:</p>\n\n<pre><code>positions' :: Eq a =&gt; a -&gt; [a] -&gt; [Int]\npositions' _ [] = []\npositions' a (x:xs) =\n    let ((0,m):ns) = zip [0..(length (x:xs))] (x:xs)\n    in if (a == m) then 0:(map (+1) (positions' a xs))\n       else (map (+1) (positions' a xs))\n</code></pre>\n\n<p>(Note that I've changed your <code>let</code> to be explicit that <code>n</code> will always be <code>0</code> - I prefer to be explicit this way but this in itself doesn't change the output.) Since <code>m</code> is always bound to <code>x</code> and <code>ns</code> isn't used at all, we can elide the let, inlining the definition of <code>m</code>:</p>\n\n<pre><code>positions' :: Eq a =&gt; a -&gt; [a] -&gt; [Int]\npositions' _ [] = []\npositions' a (x:xs) =\n    if a == x\n    then 0 : map (+1) (positions' a xs)\n    else     map (+1) (positions' a xs)\n</code></pre>\n\n<p>You could go on to factor out the repeated <code>map (+1) (positions' a xs)</code> if you wanted to.</p>\n\n<p>Incidentally, you didn't need explicit recursion to avoid a list comprehension here. For one, list comprehensions are basically a replacement for uses of <code>map</code> and <code>filter</code>. I was going to write this out explicitly, but I see @WillemVanOnsem has given this as an answer so I will simply refer you to his answer.</p>\n\n<p>Another way, although perhaps not acceptable if you were asked to implement this yourself, would be to just use the built-in <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:elemIndices\" rel=\"nofollow noreferrer\">elemIndices</a> function, which does exactly what you are trying to implement here.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1557499177, "last_edit_date": 1557499177, "creation_date": 1557498371, "answer_id": 56079642, "question_id": 56079450, "link": "https://stackoverflow.com/questions/56079450/how-to-get-the-index-of-an-element-in-a-list-by-not-using-list-comprehensions/56079642#56079642", "title": "How to get the Index of an element in a list, by not using &quot;list comprehensions&quot;?", "body": "<p>We can make use of a <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:filter\" rel=\"nofollow noreferrer\"><strong><code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</code></strong></a> and <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:map\" rel=\"nofollow noreferrer\"><strong><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code></strong></a> approach, like:</p>\n\n<pre><code>positions  :: Eq a =&gt; a -&gt; [a] -&gt; [Int]\npositions x = map fst . filter ((x ==) . snd) . zip [0..]</code></pre>\n\n<p>We thus first construct tuples of the form <code>(i, y<sub>i</sub>)</code>, next we filter such that we only retain these tuples for which <code>x == y<sub>i</sub></code>, and finally we fetch the first item of these tuples.</p>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; positions 'o' \"foobaraboof\" \n[1,2,8,9]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1557508534, "creation_date": 1557508534, "answer_id": 56082131, "question_id": 56079450, "link": "https://stackoverflow.com/questions/56079450/how-to-get-the-index-of-an-element-in-a-list-by-not-using-list-comprehensions/56082131#56082131", "title": "How to get the Index of an element in a list, by not using &quot;list comprehensions&quot;?", "body": "<p>Your</p>\n\n<pre><code>    let ((n,m):ns) = zip [0..(length (x:xs))] (x:xs)\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>== {- by laziness -}\n    let ((n,m):ns) = zip [0..] (x:xs)\n== {- by definition of zip -}\n    let ((n,m):ns) = (0,x) : zip [1..] xs\n== {- by pattern matching -}\n    let {(n,m)     = (0,x)\n        ;      ns  =         zip [1..] xs }\n== {- by pattern matching -}\n    let { n        =  0\n        ;   m      =    x\n        ;      ns  =         zip [1..] xs }\n</code></pre>\n\n<p>but you never reference <code>ns</code>! So we don't need its binding at all:</p>\n\n<pre><code>positions' a (x:xs) =\n    let { n = 0  ;  m = x } in\n    if (a == m) then n : (positions' a xs)\n                else     (positions' a xs) \n</code></pre>\n\n<p>and so, by substitution, you actually have</p>\n\n<pre><code>positions' :: Eq a =&gt; a -&gt; [a] -&gt; [Int]\npositions' _ [] = []\npositions' a (x:xs) =\n    if (a == x) then 0 : (positions' a xs)      -- NB: 0 \n                else     (positions' a xs) \n</code></pre>\n\n<p>And this is why all you ever produce are <code>0</code>s. But you want to produce the correct index: <code>0, 1, 2, 3, ...</code>. </p>\n\n<p>First, let's tweak your code a little bit further into</p>\n\n<pre><code>positions' :: Eq a =&gt; a -&gt; [a] -&gt; [Int]\npositions' a  =  go xs\n  where\n  go  []  = []\n  go (x:xs) | a == x    =  0 : go xs            -- NB: 0 \n            | otherwise =      go xs \n</code></pre>\n\n<p>This is known as a worker/wrapper transform. <code>go</code> is a worker, <code>positions'</code> is a wrapper. There's no need to pass <code>a</code> around from call to call, it doesn't change, and we have access to it anyway. It is in the <em>enclosing scope</em> with respect to the <em>inner</em> function, <code>go</code>. We've also used <em>guards</em> instead of the more verbose and less visually apparent <code>if ... then ... else</code>.</p>\n\n<p>Now we just need to use something -- the correct index value -- instead of 0. </p>\n\n<p>To use it, we must have it first. What is it? It starts as 0, then it is incremented on each step along the input list. </p>\n\n<p>When do we make a step along the input list? At the recursive call:</p>\n\n<pre><code>positions' :: Eq a =&gt; a -&gt; [a] -&gt; [Int]\npositions' a  =  go xs 0\n  where\n  go  []    _ = []\n  go (x:xs) i | a == x    =  0 : go xs (i+1)    -- NB: 0 \n              | otherwise =      go xs (i+1)\n</code></pre>\n\n<p><code>_</code> as a pattern means we don't care about the argument's value -- it's there but we're not going to use it.</p>\n\n<p>Now all that's left for us to do is to use that <code>i</code> in place of that <code>0</code>. </p>\n"}], "owner": {"reputation": 63, "user_id": 11481481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74d7cd831ec1895788526cde5765f781?s=128&d=identicon&r=PG&f=1", "display_name": "ProgramCat", "link": "https://stackoverflow.com/users/11481481/programcat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 734, "favorite_count": 0, "accepted_answer_id": 56079632, "answer_count": 3, "score": 6, "last_activity_date": 1557513055, "creation_date": 1557497651, "last_edit_date": 1557497763, "question_id": 56079450, "link": "https://stackoverflow.com/questions/56079450/how-to-get-the-index-of-an-element-in-a-list-by-not-using-list-comprehensions", "title": "How to get the Index of an element in a list, by not using &quot;list comprehensions&quot;?", "body": "<p>I'm new in haskell programming and I try to solve a problem by/not using list comprehensions.</p>\n\n<p>The Problem is to find the index of an element in a list and return a list of the indexes (where the elements in the list was found.)</p>\n\n<p>I already solved the problem by using list comprehensions but now i have some problems to solve the problem without using list comprehensions.</p>\n\n<p>On my recursive way:</p>\n\n<p>I tried to zip a list of <code>[0..(length list)]</code> and the list as it self.\nthen if the element  a  equals an element in the list -> make a new list with the first element of the Tupel of the zipped <code>list(my index)</code> and after that search the function on a recursive way until the list is [].</p>\n\n<p>That's my list comprehension (works):</p>\n\n<pre><code>positions :: Eq a =&gt; a -&gt; [a] -&gt; [Int]\npositions a list = [x | (x,y) &lt;- zip [0..(length list)] list, a == y]\n</code></pre>\n\n<p>That's my recursive way (not working): </p>\n\n<pre><code>positions' :: Eq a =&gt; a -&gt; [a] -&gt; [Int]\npositions' _ [] = []\npositions' a (x:xs) =\n    let ((n,m):ns) = zip [0..(length (x:xs))] (x:xs)\n    in if (a == m) then n:(positions' a xs)\n       else (positions' a xs) \n</code></pre>\n\n<p>*sorry I don't know how to highlight words</p>\n\n<p>but ghci says:</p>\n\n<pre><code>*Main&gt; positions' 2 [1,2,3,4,5,6,7,8,8,9,2]\n[0,0]\n</code></pre>\n\n<p>and it should be like that (my list comprehension): </p>\n\n<pre><code>*Main&gt; positions 2 [1,2,3,4,5,6,7,8,8,9,2]\n[1,10]\n</code></pre>\n\n<p>Where is my mistake ?</p>\n"}, {"tags": ["haskell", "custom-data-type"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1557485502, "post_id": 56076104, "comment_id": 98790393, "body": "What should be the type of the <code>something</code>?"}, {"owner": {"reputation": 167, "user_id": 7927309, "user_type": "registered", "profile_image": "https://graph.facebook.com/1378053178938566/picture?type=large", "display_name": "Pedro Fernandes", "link": "https://stackoverflow.com/users/7927309/pedro-fernandes"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557485615, "post_id": 56076104, "comment_id": 98790455, "body": "I think something should be an expression of some sort... inExpr must return an Expr, what I need is to somehow get &quot;(Op,(Expr, Expr)&quot; to match &quot;Bop&quot;"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557582622, "post_id": 56076104, "comment_id": 98818310, "body": "It&#39;s just <code>either Num (uncurry ((`ap` snd) . (. fst) . flip Bop))</code>, what&#39;s the problem? :)  (Courtesy of <a href=\"http://pointfree.io.\" rel=\"nofollow noreferrer\">pointfree.io.</a>)"}], "answers": [{"tags": [], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "is_accepted": true, "score": 9, "last_activity_date": 1557485591, "creation_date": 1557485591, "answer_id": 56076182, "question_id": 56076104, "link": "https://stackoverflow.com/questions/56076104/how-to-go-from-tuples-to-a-custom-data-type/56076182#56076182", "title": "How to go from tuples to a custom data type?", "body": "<p>Why don't just</p>\n\n<pre><code>inExpr ie = case ie of\n  Left n -&gt; Num n\n  Right (o, (e1, e2)) -&gt; Bop e1 o e2\n</code></pre>\n\n<p>?</p>\n\n<p>Or if you like <code>either</code> function</p>\n\n<pre><code>inExpr = either Num (\\(o, (e1, e2)) -&gt; Bop e1 o e2)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 167, "user_id": 7927309, "user_type": "registered", "profile_image": "https://graph.facebook.com/1378053178938566/picture?type=large", "display_name": "Pedro Fernandes", "link": "https://stackoverflow.com/users/7927309/pedro-fernandes"}, "edited": false, "score": 2, "creation_date": 1557486365, "post_id": 56076354, "comment_id": 98790819, "body": "Very well explained! Thank you!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1557493498, "last_edit_date": 1557493498, "creation_date": 1557486217, "answer_id": 56076354, "question_id": 56076104, "link": "https://stackoverflow.com/questions/56076104/how-to-go-from-tuples-to-a-custom-data-type/56076354#56076354", "title": "How to go from tuples to a custom data type?", "body": "<p>You are quite close. We can in fact easily derive the type of <code>something</code> by using a \"<em>hole</em>\" (<code>_</code>) in <code>ghci</code>:</p>\n\n<pre><code>Prelude Data.Either&gt; :{\nPrelude Data.Either| inExpr :: Either Int (Op,(Expr,Expr)) -&gt; Expr\nPrelude Data.Either| inExpr = either Num _\nPrelude Data.Either| :}\n&lt;interactive&gt;:36:21: error:\n    \u2022 Found hole: _ :: (Op, (Expr, Expr)) -&gt; Expr\n    \u2022 In the second argument of \u2018either\u2019, namely \u2018_\u2019\n      In the expression: either Num _\n      In an equation for \u2018inExpr\u2019: inExpr = either Num _\n    \u2022 Relevant bindings include\n        inExpr :: Either Int (Op, (Expr, Expr)) -&gt; Expr\n          (bound at &lt;interactive&gt;:36:1)\n</code></pre>\n\n<p>So we know that this function <code>_</code> will need to have as type <code>(Op, (Expr, Expr)) -&gt; Expr</code>.</p>\n\n<p>We can for example use a lambda-expression here:</p>\n\n<pre><code>inExpr :: Either Int (Op,(Expr,Expr)) -&gt; Expr\ninExpr = either Num <b>(\\(o, (l, r)) -> Bop l o r)</b></code></pre>\n\n<p>We thus \"unpack\" the tuple and the subtuple with a <code>(o, (l, r))</code> pattern, and then construct an <code>Expr</code> by using the <code>Bop</code> data constructor, with <code>l</code>, <code>o</code> and <code>r</code> as arguments.</p>\n\n<p>That being said, simple pattern matching, for example in the head of the fucntion, will do the trick as well, and is perhaps easier to understand:</p>\n\n<pre><code>inExpr :: Either Int (Op,(Expr,Expr)) -&gt; Expr\ninExpr (Left a) = Num a\ninExpr (Right (o, (l, r))) = Bop l o r</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 7927309, "user_type": "registered", "profile_image": "https://graph.facebook.com/1378053178938566/picture?type=large", "display_name": "Pedro Fernandes", "link": "https://stackoverflow.com/users/7927309/pedro-fernandes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 56076182, "answer_count": 2, "score": 1, "last_activity_date": 1557605334, "creation_date": 1557485345, "last_edit_date": 1557605334, "question_id": 56076104, "link": "https://stackoverflow.com/questions/56076104/how-to-go-from-tuples-to-a-custom-data-type", "title": "How to go from tuples to a custom data type?", "body": "<p>So, I'm having this class about catamorphisms and what not, and I need to code the in of a data type.</p>\n\n<p>The data type is </p>\n\n<pre><code>data Expr = Num Int | Bop Expr Op Expr  deriving  (Eq,Show)\n</code></pre>\n\n<p>and the function must have this signature</p>\n\n<pre><code>inExpr :: Either Int (Op,(Expr,Expr)) -&gt; Expr\n</code></pre>\n\n<p><code>inExpr</code> should be, I think,  something along the lines of</p>\n\n<pre><code>inExpr = Either Num (Bop something)\n</code></pre>\n\n<p>but I can't figure out the something.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1557449512, "post_id": 56069302, "comment_id": 98778094, "body": "What have you tried so far?"}, {"owner": {"reputation": 1, "user_id": 11478510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d68ee315e46b8efdf5978c6b97ab197c?s=128&d=identicon&r=PG&f=1", "display_name": "Jesica", "link": "https://stackoverflow.com/users/11478510/jesica"}, "reply_to_user": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1557449949, "post_id": 56069302, "comment_id": 98778159, "body": "I tried with zipWith.        replic lt = zipWith replicate [1..] lt     But I have to do it with map hof."}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1557453522, "post_id": 56069302, "comment_id": 98778706, "body": "Here&#39;s a hint: use <code>zip</code> instead of <code>zipWith</code>, and then use <code>map</code> on the result."}, {"owner": {"reputation": 1, "user_id": 11478510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d68ee315e46b8efdf5978c6b97ab197c?s=128&d=identicon&r=PG&f=1", "display_name": "Jesica", "link": "https://stackoverflow.com/users/11478510/jesica"}, "edited": false, "score": 0, "creation_date": 1557454801, "post_id": 56069302, "comment_id": 98778929, "body": "maps f [] = [] maps f (x:xs) = f [x] : maps f xs  rep a b   |b==0 = []   |b&lt;0 = error &quot;negative value&quot;   |otherwise = a ++ rep a (b-1)  replicas []=[] replicas (x:xs) = rep (x:xs) xs  replic (x:xs) = maps replicas (x:xs)"}, {"owner": {"reputation": 1, "user_id": 11478510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d68ee315e46b8efdf5978c6b97ab197c?s=128&d=identicon&r=PG&f=1", "display_name": "Jesica", "link": "https://stackoverflow.com/users/11478510/jesica"}, "edited": false, "score": 0, "creation_date": 1557454975, "post_id": 56069302, "comment_id": 98778959, "body": "but in the above code it&#39;s taking the each element and printing that many times."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1557455181, "post_id": 56069302, "comment_id": 98778995, "body": "put your work in the problem definition section. Not the comment section."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1557455465, "post_id": 56069302, "comment_id": 98779051, "body": "&quot;but there are some problem:&quot; doesn&#39;t help us help you. You tell us what you are trying to accomplish. Then you tell us what you did to try. Then you tell us exactly where you are having a problem. Then we can help."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1557455580, "post_id": 56069302, "comment_id": 98779074, "body": "Also , pay attention to what I did to fix your formatting. Please be mindful, and help us help you by being clear."}, {"owner": {"reputation": 1, "user_id": 11478510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d68ee315e46b8efdf5978c6b97ab197c?s=128&d=identicon&r=PG&f=1", "display_name": "Jesica", "link": "https://stackoverflow.com/users/11478510/jesica"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1557456568, "post_id": 56069302, "comment_id": 98779255, "body": "Thank you so much @MichaelLitchard for formatting. I will take care of this from the next time onwards."}, {"owner": {"reputation": 1, "user_id": 11478510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d68ee315e46b8efdf5978c6b97ab197c?s=128&d=identicon&r=PG&f=1", "display_name": "Jesica", "link": "https://stackoverflow.com/users/11478510/jesica"}, "edited": false, "score": 0, "creation_date": 1557456705, "post_id": 56069302, "comment_id": 98779282, "body": "Can you please help me to solve this problem. I am new to Haskell and trying to solve this but unable to do it."}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 1, "creation_date": 1557457561, "post_id": 56069302, "comment_id": 98779426, "body": "It&#39;s good to get in the habit of giving type signatures to your functions. You&#39;ve made a couple of mistakes here that I think would be easier for you to see if you had given each of your functions type signatures. Try giving each of <code>maps</code>, <code>rep</code>, <code>replicas</code>, and <code>replic</code> the signatures that you think they ought to have, and see if the resulting errors clear any of your problems up."}, {"owner": {"reputation": 1, "user_id": 11478510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d68ee315e46b8efdf5978c6b97ab197c?s=128&d=identicon&r=PG&f=1", "display_name": "Jesica", "link": "https://stackoverflow.com/users/11478510/jesica"}, "edited": false, "score": 0, "creation_date": 1557457907, "post_id": 56069302, "comment_id": 98779503, "body": "Missing binding for variable &quot;replicate&quot; in type signature. What does it mean? what can be the problem?"}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 1, "creation_date": 1557458018, "post_id": 56069302, "comment_id": 98779520, "body": "Can&#39;t help you with errors when you don&#39;t update your code in the question. You most certainly didn&#39;t get that error from the code that&#39;s there."}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1557458321, "post_id": 56069302, "comment_id": 98779571, "body": "If you give a type signature <code>replicate::Int -&gt; [a] -&gt; [a]</code>, Haskell is expecting you to follow that with a definition of <code>replicate</code>. Instead, you followed it with a definition of <code>replic</code>. If you want to use <code>replicate</code> from the prelude, you don&#39;t need to declare its type; just use it. If you want to define your own <code>replicate</code>, you have to actually do that."}, {"owner": {"reputation": 1, "user_id": 11478510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d68ee315e46b8efdf5978c6b97ab197c?s=128&d=identicon&r=PG&f=1", "display_name": "Jesica", "link": "https://stackoverflow.com/users/11478510/jesica"}, "reply_to_user": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1557460949, "post_id": 56069302, "comment_id": 98780101, "body": "@user11228628: I didn&#39;t get what you are suggesting."}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1557462237, "post_id": 56069302, "comment_id": 98780378, "body": "@Jesica, in the code in your last edit, the first line is a type signature for <code>replicate</code>, and the second line is a definition for <code>replic</code>, and the name <code>replic</code> is not the same as the name <code>replicate</code>. It&#39;s not allowed to define a type signature that isn&#39;t paired with a definition for the same name, so why did you write that? What were you trying to say with the <code>replicate</code> signature?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 1, "creation_date": 1557469007, "post_id": 56069302, "comment_id": 98782272, "body": "@user11228628, why do you recommend <code>zip</code> instead of <code>zipWith</code>? The obvious solution here is a direct application of <code>zipWith</code>."}, {"owner": {"reputation": 774, "user_id": 6034245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n3qwA.jpg?s=128&g=1", "display_name": "chrisheyn", "link": "https://stackoverflow.com/users/6034245/chrisheyn"}, "edited": false, "score": 0, "creation_date": 1557471053, "post_id": 56069302, "comment_id": 98783164, "body": "<code>import Data.List</code>  <code>replic xs = group $ go 1 xs</code>     <code>where go _ [] = []</code>           <code>go i (x:xs) = (take i $ repeat x) ++ go (i + 1) xs</code>"}, {"owner": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1557471564, "post_id": 56069302, "comment_id": 98783382, "body": "@dfeuer, only because OP repeatedly specified that <code>map</code> had to be involved. In the second comment, OP showed that she was aware of the direct <code>zipWith</code> solution but that it wouldn&#39;t do because it doesn&#39;t use <code>map</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1555, "user_id": 11228628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c463de7cfe16792a210e3531fef5ccb5?s=128&d=identicon&r=PG&f=1", "display_name": "user11228628", "link": "https://stackoverflow.com/users/11228628/user11228628"}, "edited": false, "score": 0, "creation_date": 1557506634, "post_id": 56069302, "comment_id": 98801543, "body": "@user11228628, ah, I missed that. By that point, it&#39;s just time to close the question."}], "answers": [{"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 4, "last_activity_date": 1557484364, "last_edit_date": 1557484364, "creation_date": 1557472418, "answer_id": 56072521, "question_id": 56069302, "link": "https://stackoverflow.com/questions/56069302/define-a-function-replic-lt-in-haskell/56072521#56072521", "title": "Define a function replic lt in Haskell", "body": "<p>What you could do is solve the problem using explicit recursion and then try to detect places where you can replace certain parts of the recursion with a higher-order function. Here are some hints for creating an explicitly recursive version:</p>\n\n<ol>\n<li><p>Give <code>replic</code> a type signature and a base case:</p>\n\n<pre><code>replic :: [a] -&gt; [[a]]\nreplic [] = ...\nreplic (x:xs) = ...\n</code></pre>\n\n<p>If the result were just <code>[ [1], [2], [3], ... ]</code> and not <code>[ [1], [2,2], [3,3,3], ... ]</code>, you could write <code>[x] : replic xs</code> as the recursive function body. But instead you need to create <em>n</em> copies of <code>x</code>, but you don't have access to any variable <code>n</code>. So you need to somehow introduce a counter.</p></li>\n<li><p>Since <code>replic</code> must take an <code>[a]</code> and return an <code>[[a]]</code>, there is no room in its type signature for a counter, so you could make a helper function with an extra accumulating argument:</p>\n\n<pre><code>replic :: [a] -&gt; [[a]]\nreplic = replic' 1\n\nreplic' :: Int -&gt; [a] -&gt; [[a]]\nreplic' n [] = ...\nreplic' n (x:xs) = ...\n</code></pre></li>\n<li><p>Now you have the input for creating <code>n</code> copies of <code>x</code>, so your <code>rep</code> function will come handy:</p>\n\n<pre><code>rep :: a -&gt; Int -&gt; [a]\nrep x n\n  | n &gt; 0  = x : rep x (n-1)\n  | otherwise = []\n</code></pre></li>\n</ol>\n\n<hr>\n\n<p>As for using higher-order functions to solve this, it's a little difficult to transform</p>\n\n<pre><code>[ 1, 3, 7, ... ]\n</code></pre>\n\n<p>into</p>\n\n<pre><code>[ [1], [3,3], [7,7,7], ... ]\n</code></pre>\n\n<p>with <code>map</code> because <code>map</code> performs the <em>same</em> transformation on each element, and</p>\n\n<pre><code>1 ~&gt; [1]\n3 ~&gt; [3,3]\n7 ~&gt; [7,7,7]\n</code></pre>\n\n<p>are not products of the same transformation, because <em>extra</em> information is required (the position in the list). The only way you can do this with <code>map</code> is to make the position in the list a part of the input to the function you're mapping with. If, for example you had to transform</p>\n\n<pre><code>[ (1,1), (3,2), (7,3), ... ]\n</code></pre>\n\n<p>into</p>\n\n<pre><code>[ [1], [3,3], [7,7,7], ... ]\n</code></pre>\n\n<p>then you could do this with <code>map</code> and your <code>rep</code>.</p>\n\n<p>But you cannot construct this <code>[ (1,1), (3,2), (7,3), ... ]</code> with <code>map</code>.</p>\n\n<p>You'd have to either do this using an explicitly recursive function, or with <code>(`zip` [1..])</code>.</p>\n\n<p>As others have recommended, <code>zipWith</code> combines <code>map</code> and <code>zip</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 11478510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d68ee315e46b8efdf5978c6b97ab197c?s=128&d=identicon&r=PG&f=1", "display_name": "Jesica", "link": "https://stackoverflow.com/users/11478510/jesica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "closed_date": 1557515665, "answer_count": 1, "score": -8, "last_activity_date": 1557484364, "creation_date": 1557449078, "last_edit_date": 1557470776, "question_id": 56069302, "link": "https://stackoverflow.com/questions/56069302/define-a-function-replic-lt-in-haskell", "closed_reason": "Needs more focus", "title": "Define a function replic lt in Haskell", "body": "<p>Define a function replic lt in haskell that replicates each element in lt into a list. If the element is in the kth position of lt, the resulting list contains k copies of the same element. You must define this function using the higher-order function of <code>map</code>.</p>\n\n<p>E.g.</p>\n\n<pre><code>&gt; replic [2,3,4,7,6]\n[[2], [3,3], [4,4,4], [7,7,7,7], [6,6,6,6,6]]\n</code></pre>\n\n<p>My Approach but there are some problem: </p>\n\n<pre><code>maps f [] = []\nmaps f (x:xs) = f [x] : maps f xs\n\nrep a b\n  |b==0 = []\n  |b&lt;0 = error \"negative value\"\n  |otherwise = a ++ rep a (b-1)\n\nreplicas []=[]\nreplicas (x:xs) = rep (x:xs) xs\n\nreplic (x:xs) = maps replicas (x:xs)\n</code></pre>\n\n<p>If I want to use this program how can I modify to get the correct result?\nPlease help me. :(</p>\n\n<pre><code>maps f [] = []\nmaps f (x:xs) = f [x] : maps f xs\n\nrep a b\n  |b==0 = []\n  |b&lt;0 = error \"negative value\"\n  |otherwise = a ++ rep a (b-1)\n\nreplicas []=[]\nreplicas (x:xs) = rep (x:xs) xs\n\nreplic (x:xs) = maps replicas (x:xs)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1557433680, "post_id": 56066979, "comment_id": 98773985, "body": "What do you expect <code>[a:b:c:d:e]</code> to match?"}, {"owner": {"reputation": 23, "user_id": 11460636, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZH8YR3UH4m4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rctf1KBNIx3cKwhHCxs-BQGCp9rzA/mo/photo.jpg?sz=128", "display_name": "jallexy", "link": "https://stackoverflow.com/users/11460636/jallexy"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1557433932, "post_id": 56066979, "comment_id": 98774090, "body": "@Rein Henrichs  i expect that there will 5 Strings, i just don&#39;t know another way to do this"}, {"owner": {"reputation": 23, "user_id": 11460636, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZH8YR3UH4m4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rctf1KBNIx3cKwhHCxs-BQGCp9rzA/mo/photo.jpg?sz=128", "display_name": "jallexy", "link": "https://stackoverflow.com/users/11460636/jallexy"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1557434072, "post_id": 56066979, "comment_id": 98774163, "body": "So if datatable type  [[String]], i expect that [a:b:c:d:e] - [String] one line of my initial table"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557434836, "post_id": 56066979, "comment_id": 98774433, "body": "Show the code that generates the error."}, {"owner": {"reputation": 23, "user_id": 11460636, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZH8YR3UH4m4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rctf1KBNIx3cKwhHCxs-BQGCp9rzA/mo/photo.jpg?sz=128", "display_name": "jallexy", "link": "https://stackoverflow.com/users/11460636/jallexy"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557435860, "post_id": 56066979, "comment_id": 98774803, "body": "@chepner I updated the question description. I would be grateful for any tips!"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557437845, "post_id": 56066979, "comment_id": 98775563, "body": "You can&#39;t just call <code>map</code> in the <code>do</code> block, as <code>map</code> returns a list, not an <code>IO</code> action. You want something like <code>print $ map buildObj datatable</code>."}, {"owner": {"reputation": 23, "user_id": 11460636, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZH8YR3UH4m4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rctf1KBNIx3cKwhHCxs-BQGCp9rzA/mo/photo.jpg?sz=128", "display_name": "jallexy", "link": "https://stackoverflow.com/users/11460636/jallexy"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1557439216, "post_id": 56066979, "comment_id": 98776002, "body": "@chepner do you mean <code>map buildObj datatable</code> returns a list [Obj] in my case? and thanks! this fixed the second error)"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 11460636, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZH8YR3UH4m4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rctf1KBNIx3cKwhHCxs-BQGCp9rzA/mo/photo.jpg?sz=128", "display_name": "jallexy", "link": "https://stackoverflow.com/users/11460636/jallexy"}, "edited": false, "score": 0, "creation_date": 1557435444, "post_id": 56067345, "comment_id": 98774651, "body": "Thank you! It helped me a lot! Maybe you can give a hint on this question: how to save all the data Obj to list [Obj] after calling  map buildObj datatable"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 5, "last_activity_date": 1557434816, "creation_date": 1557434816, "answer_id": 56067345, "question_id": 56066979, "link": "https://stackoverflow.com/questions/56066979/how-to-apply-function-to-nested-list-of-string-in-haskell/56067345#56067345", "title": "How to apply function to nested list of String in Haskell?", "body": "<p>The pattern <code>a:b:c:d:e</code> matches a <em>list</em> with the <em>head</em> <code>a</code> and <em>tail</em> <code>b:c:d:e</code>.</p>\n\n<p>The pattern <code>b:c:d:e</code>, likewise, would match a list with the <em>head</em> <code>b</code> and <em>tail</em> <code>c:d:e</code>.</p>\n\n<p>Reducing further, the pattern <code>d:e</code> would match a list with the <em>head</em> <code>d</code> and the the <em>tail</em> <code>e</code>.</p>\n\n<p>Thus, <code>e</code> is itself a list.</p>\n\n<p>If you want to match on a list with exactly five elements, you can write it as</p>\n\n<pre><code>a:b:c:d:e:[]\n</code></pre>\n\n<p>or, alternatively</p>\n\n<pre><code>[a,b,c,d,e]\n</code></pre>\n\n<p>Notice that this is an incomplete pattern match. You should also consider what to do if the list is smaller or larger than exactly five elements.</p>\n"}], "owner": {"reputation": 23, "user_id": 11460636, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZH8YR3UH4m4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rctf1KBNIx3cKwhHCxs-BQGCp9rzA/mo/photo.jpg?sz=128", "display_name": "jallexy", "link": "https://stackoverflow.com/users/11460636/jallexy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 56067345, "answer_count": 1, "score": 0, "last_activity_date": 1557475129, "creation_date": 1557433246, "last_edit_date": 1557475129, "question_id": 56066979, "link": "https://stackoverflow.com/questions/56066979/how-to-apply-function-to-nested-list-of-string-in-haskell", "title": "How to apply function to nested list of String in Haskell?", "body": "<p>I have parsed data from table (by tagSoup) and now i have nested list of data</p>\n\n<pre><code>datatable with type [[String]]\n</code></pre>\n\n<p>Now i want to save this data as list of objects [Obj] - lines of table. Each line consist of 5 Strings.</p>\n\n<pre><code>data Obj = Obj { pdDate :: String,\n    pdTournamentId :: String,\n    pdTournamentName :: String,\n    pdOperation :: String,\n    pdTown :: String }\n    deriving (Eq,Show,Read)\n</code></pre>\n\n<p>And I have a function to create the Obj</p>\n\n<pre><code>buildObj [a:b:c:d:e] = do\n    let lst = last e\n    let line = Obj {pdDate = a,\n    pdTournamentId = b,\n    pdTournamentName = c,\n    pdOperation  = d,\n    pdTown  = lst}\n    return line \n</code></pre>\n\n<p>To pass through the nested list in the main block, I call the function <code>map</code></p>\n\n<pre><code>    map buildObj datatable\n</code></pre>\n\n<ol>\n<li>And how to save all the data Obj to list [Obj]?</li>\n</ol>\n\n<p>I am very new in Haskell, so looking if anybody could give me pointers to it.</p>\n\n<p>Thanks!</p>\n\n<p>UPDATE: The answer of @Mark Seemann helped to fix error type [[[String]]]</p>\n\n<p>current errors</p>\n\n<pre><code> * Couldn't match expected type `Obj' with actual type `m0 Obj'\n    * In a stmt of a 'do' block: return line\n</code></pre>\n\n<p>and</p>\n\n<pre><code> * Couldn't match type `[]' with `IO'\n      Expected type: IO Obj\n        Actual type: [Obj]\n    * In a stmt of a 'do' block: map buildObj datatable\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1557432272, "post_id": 56066676, "comment_id": 98773457, "body": "Does the stuff in <code>(...)</code> refer to <code>logger</code> by name? That would be one obvious reason to want to have the logger available."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1557457925, "post_id": 56066676, "comment_id": 98779509, "body": "Is toWaiAppLogger not similar enough to toWaiApp to make the documentation accurate?"}, {"owner": {"reputation": 719, "user_id": 540718, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/64bb401eff530b423eae58217f2b1362?s=128&d=identicon&r=PG", "display_name": "nemron", "link": "https://stackoverflow.com/users/540718/nemron"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1557475947, "post_id": 56066676, "comment_id": 98785423, "body": "@amalloy Shame on my head, you are right. <code>logger</code> occurs in <code>(...)</code>."}], "owner": {"reputation": 719, "user_id": 540718, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/64bb401eff530b423eae58217f2b1362?s=128&d=identicon&r=PG", "display_name": "nemron", "link": "https://stackoverflow.com/users/540718/nemron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1557432167, "creation_date": 1557431674, "last_edit_date": 1557432167, "question_id": 56066676, "link": "https://stackoverflow.com/questions/56066676/is-there-a-reason-why-warp-doesnt-call-towaiapp", "title": "Is there a reason why warp doesn&#39;t call toWaiApp?", "body": "<p>Just for the sake of it, I'm interested in why <code>warp</code> doesn't call <code>toWaiApp</code> as stated in the comment:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>toWaiApp :: YesodDispatch site =&gt; site -&gt; IO W.Application\ntoWaiApp site = do\n    logger &lt;- makeLogger site\n    toWaiAppLogger logger site\n\n\n-- | [...] Automatically calls 'toWaiApp'. [...]\nwarp :: YesodDispatch site =&gt; Int -&gt; site -&gt; IO ()\nwarp port site = do\n    logger &lt;- makeLogger site\n    toWaiAppLogger logger site &gt;&gt;= Network.Wai.Handler.Warp.runSettings (...)\n</code></pre>\n\n<p>Why not calling <code>toWaiApp</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- | [...] Automatically calls 'toWaiApp'. [...]\nwarp :: YesodDispatch site =&gt; Int -&gt; site -&gt; IO ()\nwarp port site = toWaiApp site &gt;&gt;= Network.Wai.Handler.Warp.runSettings (...)\n</code></pre>\n\n<p><strong>Update</strong>: I'm on <code>yesod-core-1.6.14</code>.</p>\n"}, {"tags": ["linux", "bash", "haskell", "command-line", "ghc"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1557428795, "post_id": 56066048, "comment_id": 98771941, "body": "It prints them to the <code>stderr</code>, so you can redirect these with <code>ghc file.hs -Wall 2&gt;warnings.log</code>."}, {"owner": {"reputation": 542, "user_id": 4440871, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/8gHuC.jpg?s=128&g=1", "display_name": "Fabian Schneider", "link": "https://stackoverflow.com/users/4440871/fabian-schneider"}, "edited": false, "score": 1, "creation_date": 1557477225, "post_id": 56066048, "comment_id": 98785990, "body": "I know it is already resolved, but this should probably be tagged with a bash or linux tag ;)"}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1557494534, "post_id": 56066048, "comment_id": 98795103, "body": "If so you could edit the question yourself, but thanks for the notice!"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1557536121, "post_id": 56066048, "comment_id": 98810569, "body": "@schuelermine Users with less than 2,000 reputation cannot edit a different user\u2019s question."}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "reply_to_user": {"reputation": 542, "user_id": 4440871, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/8gHuC.jpg?s=128&g=1", "display_name": "Fabian Schneider", "link": "https://stackoverflow.com/users/4440871/fabian-schneider"}, "edited": false, "score": 0, "creation_date": 1589886781, "post_id": 56066048, "comment_id": 109464764, "body": "@FabianSchneider I added them"}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1589886794, "post_id": 56066048, "comment_id": 109464768, "body": "@David did not know that, thanks"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1557493382, "last_edit_date": 1557493382, "creation_date": 1557428886, "answer_id": 56066097, "question_id": 56066048, "link": "https://stackoverflow.com/questions/56066048/is-there-a-way-to-tell-ghc-to-dump-all-warnings-to-a-file/56066097#56066097", "title": "Is there a way to tell GHC to dump all warnings to a file?", "body": "<p>The reason why it still shows these warnings is because warnings and errors are printed on the standard <em>error</em> channel (stderr).</p>\n\n<p>You can thus redirect the errors to a file by redirecting the stderr, with:</p>\n\n<pre><code>ghc file.hs -Wall <b>2&gt;</b> warnings.log</code></pre>\n\n<p>Notice the <code>2</code> in <code><b>2</b>&gt;</code>. As said before, both the <em>warnings</em> and the <em>exceptions</em> are printed to this channel.</p>\n\n<p>We can redirect the error stream to <code>tee</code> in <code>bash</code> with:</p>\n\n<pre><code>ghc -Wall file.hs <b>2&gt; &gt;(tee warnings.log)</b></code></pre>\n\n<p>this features works for <code>bash</code>, but as far as I know, this is not defined in the POSIX standard. For <code>bash</code> this works, but for <code>sh</code>, this seems to fail.</p>\n"}], "owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 1, "accepted_answer_id": 56066097, "answer_count": 1, "score": 3, "last_activity_date": 1589886766, "creation_date": 1557428694, "last_edit_date": 1589886766, "question_id": 56066048, "link": "https://stackoverflow.com/questions/56066048/is-there-a-way-to-tell-ghc-to-dump-all-warnings-to-a-file", "title": "Is there a way to tell GHC to dump all warnings to a file?", "body": "<p>I've tried the following so far:</p>\n\n<pre><code>me@pc:~/code$ ghc file.hs -Wall | tee warnings.log\nme@pc:~/code$ ghc file.hs -Wall &gt; warnings.log\n</code></pre>\n\n<p>But <code>ghc</code> just prints the warnings like normal and only passes on the non-warning steps.</p>\n\n<p>Is there a way to do this?</p>\n"}, {"tags": ["dictionary", "haskell", "binary-tree"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557425125, "post_id": 56065204, "comment_id": 98770315, "body": "Do you understand the compiler error?"}, {"owner": {"reputation": 97, "user_id": 11246599, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cJXdU9dermI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdlo9h1LhUm7JilsjVFkjOOVtiVUQ/mo/photo.jpg?sz=128", "display_name": "tal", "link": "https://stackoverflow.com/users/11246599/tal"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1557425469, "post_id": 56065204, "comment_id": 98770462, "body": "the error means that the pattern matching is not the constructor as much as i understood, but i divided to both cases and didnt get what is wrong in this implementation"}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 2, "creation_date": 1557433200, "post_id": 56065312, "comment_id": 98773785, "body": "It appears OP is confusing the type-level and value-level parts of the data type definition, which is no surprise because the Haskell98 syntax doesn\u2019t really differentiate them. Lately I\u2019ve been liking <code>GADTSyntax</code>, which lets you write <code>data BinaryTree :: Type -&gt; Type where { Nil :: BinaryTree a; BNode :: a -&gt; BinaryTree a -&gt; BinaryTree a -&gt; BinaryTree a }</code>, and imo makes it clearer that <code>BinaryTree</code> is a <i>type</i> constructor and not a <i>data</i> constructor; it also makes it easier to introduce <code>GADTs</code> later on."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 9, "last_activity_date": 1557427590, "last_edit_date": 1557427590, "creation_date": 1557425561, "answer_id": 56065312, "question_id": 56065204, "link": "https://stackoverflow.com/questions/56065204/implementing-maptree-function/56065312#56065312", "title": "implementing mapTree function", "body": "<p>Your pattern <code>(BNode x (BinaryTree l) (BinaryTree r))</code> is <em>not</em> a valid pattern. Indeed the data definition of a binary tree says:</p>\n\n<pre><code>data BinaryTree a = Nil | <b>BNode a (BinaryTree a) (BinaryTree a)</b></code></pre>\n\n<p>so that means that <code>BNode</code> is a <em>data constructor</em> that packs three arguments. The <em>type</em> of the last two arguments is <code>BinaryTree a</code>, but you can not use types in pattern matching.</p>\n\n<p>You thus should use <code>l</code> and <code>r</code> as variables for these parameters (or you can use the data constructors of the <code>BinaryTree a</code> type).</p>\n\n<p>The same when you construct a <code>BinaryTree a</code> type. You call the constructor with <code>BNode x l r</code> with <code>x</code>, <code>l</code> and <code>r</code> the values, you do not specify the types here in the expression. You can specify the types, byt then you use the <code>::</code> operator.</p>\n\n<p>You can thus fix your code with:</p>\n\n<pre><code>treeMap :: (a -&gt; b) -&gt; BinaryTree a -&gt; BinaryTree b\ntreeMap f Nil  = Nil\ntreeMap f (BNode x <b>l</b> <b>r</b>) = BNode (f x) <b>(treeMap f l)</b> <b>(treeMap f r)</b></code></pre>\n\n<p>or more elegant:</p>\n\n<pre><code>treeMap :: (a -&gt; b) -&gt; BinaryTree a -&gt; BinaryTree b\ntreeMap f = go\n    where go Nil = Nil\n          go (BNode x l r) = BNode (f x) (go l) (go r)</code></pre>\n\n<p>That being said, you can let <code>ghc</code> derive the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#t:Functor\" rel=\"noreferrer\"><strong><code>Functor</code></strong></a> instance for you, by using the <code>DeriveFunctor</code> pragma:</p>\n\n<pre><code>{-# <b>LANGUAGE DeriveFunctor</b> #-}\n\ndata BinaryTree a = Nil | BNode a (BinaryTree a) (BinaryTree a) <b>deriving Functor</b></code></pre>\n\n<p>The <code>treeMap</code> is just <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:fmap\" rel=\"noreferrer\"><strong><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code></strong></a> with <code>f ~ BinaryTree</code> here.</p>\n"}], "owner": {"reputation": 97, "user_id": 11246599, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cJXdU9dermI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdlo9h1LhUm7JilsjVFkjOOVtiVUQ/mo/photo.jpg?sz=128", "display_name": "tal", "link": "https://stackoverflow.com/users/11246599/tal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 1, "accepted_answer_id": 56065312, "answer_count": 1, "score": 3, "last_activity_date": 1557427590, "creation_date": 1557425097, "question_id": 56065204, "link": "https://stackoverflow.com/questions/56065204/implementing-maptree-function", "title": "implementing mapTree function", "body": "<p>i am asket to Define the function:</p>\n\n<pre><code>treeMap :: (a -&gt; b) -&gt; BinaryTree a -&gt; BinaryTree b\n</code></pre>\n\n<p>Which takes a function and a binary tree, and produces a binary tree in which all nodes are the result of applying the function on the given tree</p>\n\n<p>the binary tree is:</p>\n\n<pre><code>data BinaryTree a = Nil | BNode a (BinaryTree a) (BinaryTree a)\n</code></pre>\n\n<p>and my code doesnt complie. i am getting an error of:</p>\n\n<pre><code>error: Not in scope: data constructor \u2018BinaryTree\u2019\ntreeMap f (BNode x (BinaryTree l) (BinaryTree r)) =    |                                    ^^^^^^^^^^\n</code></pre>\n\n<p>my code: </p>\n\n<pre><code>data BinaryTree a = Nil | BNode a (BinaryTree a) (BinaryTree a)\n\ntreeMap :: (a -&gt; b) -&gt; BinaryTree a -&gt; BinaryTree b\ntreeMap f Nil  = Nil\ntreeMap f (BNode x (BinaryTree l) (BinaryTree r)) =\n    BNode (f x) (BinaryTree (treeMap f l)) (BinaryTree (treeMap f r))\n</code></pre>\n"}, {"tags": ["haskell", "typechecking", "rank-n-types"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1557425911, "post_id": 56065005, "comment_id": 98770677, "body": "I&#39;m not sure what <code>tupleF</code> is in your second example, but in the first one the reason for the error seems clear.  <code>tupleF2</code> expects an input of type <code>forall a . a -&gt; b</code> - that is, a function which can take <i>any</i> input and produce an output of fixed type <code>b</code>. I&#39;m not sure if any such functions exist, except for <code>const x</code> where <code>x :: b</code> - but <code>length</code> clearly isn&#39;t one. For example you cannot apply <code>length</code> to an <code>Int</code>"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1557426027, "post_id": 56065005, "comment_id": 98770734, "body": "And whatever <code>tupleF</code> is, there is no <code>forall</code> in its argument type, so it can accept literally any function."}], "answers": [{"comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1557426124, "post_id": 56065353, "comment_id": 98770768, "body": "Thanks, this appeared while I was typing a comment saying effectively the same. I&#39;m not confident enough with higher rank types to have made it an answer, but I&#39;m glad I was essentially correct."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1557426196, "last_edit_date": 1557426196, "creation_date": 1557425710, "answer_id": 56065353, "question_id": 56065005, "link": "https://stackoverflow.com/questions/56065005/understanding-haskell-rankntypes-error-message/56065353#56065353", "title": "Understanding Haskell RankNTypes Error message", "body": "<p><code>forall a . a -&gt; b</code> is the type of a function <code>f</code> that can convert a value of any type <code>a</code> to some value of type <code>b</code>. Note that <code>f</code> must be ready to accept absolutely anything as input, i.e. all of these must type check</p>\n\n<pre><code>f ()\nf 32\nf True\nf 'a'\nf \"hello\"\nf (True, [2], False)\n</code></pre>\n\n<p><code>length</code> does not satisfy the requirement since e.g. <code>length ()</code> is ill typed -- <code>length</code> wants a foldable (like a list) as input, and <code>()</code> is not OK.</p>\n\n<p>Hence, <code>tupleF2 length</code> is ill typed.</p>\n\n<p>Pragmatically, note that <code>f</code> can only be a constant function, like</p>\n\n<pre><code>f x = True  -- assuming b = Bool\n</code></pre>\n\n<p>Indeed, <em>parametricity</em> guarantees that only a constant function can have type <code>forall a . a -&gt; b</code>. You can try <code>tupleF2 (const True) ((),\"hello\")</code> and obtain <code>(True, True)</code>.</p>\n"}], "owner": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 56065353, "answer_count": 1, "score": 3, "last_activity_date": 1557426196, "creation_date": 1557424327, "question_id": 56065005, "link": "https://stackoverflow.com/questions/56065005/understanding-haskell-rankntypes-error-message", "title": "Understanding Haskell RankNTypes Error message", "body": "<p>I'm trying to understand RankNTypes. </p>\n\n<p>Why does the compiler complain in this case can <code>a</code> NOT be <code>[a]</code>? </p>\n\n<pre><code>&gt; :{\n&gt; | tupleF2 :: (forall a . a -&gt; b) -&gt; (a1, a2) -&gt; (b, b)\n&gt; | tupleF2 elemF2 (x, y) = (elemF2 x, elemF2 y)\n&gt; | :}\n\n&gt; :t tupleF2  tupleF2 :: (forall a. a -&gt; b) -&gt; (a1, a2) -&gt; (b, b)\n\n&gt; :t tupleF2 length\n\n&lt;interactive&gt;:1:9: error:\n    \u2022 Couldn't match type \u2018a\u2019 with \u2018[a0]\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        a type expected by the context:\n          forall a. a -&gt; Int\n        at &lt;interactive&gt;:1:1-14\n      Expected type: a -&gt; Int\n        Actual type: [a0] -&gt; Int\n    \u2022 In the first argument of \u2018tupleF2\u2019, namely \u2018length\u2019\n      In the expression: tupleF2 length\n</code></pre>\n\n<p>While the following typechecks fine? and <code>t</code> is OK with <code>t a</code>.</p>\n\n<pre><code>&gt; :t tupleF length\ntupleF length :: Foldable t =&gt; (t a, t a) -&gt; (Int, Int)\n:t tupleF\ntupleF :: (t -&gt; b) -&gt; (t, t) -&gt; (b, b)\n</code></pre>\n\n<p>Is the above failure to compile only happens with enabling <code>RankNTypes</code>. Any pointers in understanding what is happening would be great.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "tree", "binary-tree"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1557424219, "post_id": 56063689, "comment_id": 98769888, "body": "<code>tr a = BNode a (tr a) (tr a)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 11246599, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cJXdU9dermI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdlo9h1LhUm7JilsjVFkjOOVtiVUQ/mo/photo.jpg?sz=128", "display_name": "tal", "link": "https://stackoverflow.com/users/11246599/tal"}, "edited": false, "score": 0, "creation_date": 1557419144, "post_id": 56063738, "comment_id": 98767604, "body": "could you please explain why this tree is infinite?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 97, "user_id": 11246599, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cJXdU9dermI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdlo9h1LhUm7JilsjVFkjOOVtiVUQ/mo/photo.jpg?sz=128", "display_name": "tal", "link": "https://stackoverflow.com/users/11246599/tal"}, "edited": false, "score": 3, "creation_date": 1557419515, "post_id": 56063738, "comment_id": 98767753, "body": "@tal If you tried to find the number of nodes in this tree, it would result in an infinite loop because it never reaches a <code>Nil</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1557420612, "post_id": 56063738, "comment_id": 98768239, "body": "Due to the self-referential nature of the value, it&#39;s an infinite tree <i>encoded</i> as a single node in memory."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 97, "user_id": 11246599, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cJXdU9dermI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdlo9h1LhUm7JilsjVFkjOOVtiVUQ/mo/photo.jpg?sz=128", "display_name": "tal", "link": "https://stackoverflow.com/users/11246599/tal"}, "edited": false, "score": 1, "creation_date": 1557423563, "post_id": 56063738, "comment_id": 98769579, "body": "@tal if you&#39;d enumerate the node values of the <code>infTree x</code> tree in a breadth-first fashion you&#39;d get the never ending list of <code>x</code>s."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1557424218, "post_id": 56063738, "comment_id": 98769887, "body": "Or: <code>infTree x = fix (join (BNode x))</code>, which simplifies to <code>infTree = fix . join . BNode</code>"}], "tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": true, "score": 7, "last_activity_date": 1557420259, "last_edit_date": 1557420259, "creation_date": 1557418858, "answer_id": 56063738, "question_id": 56063689, "link": "https://stackoverflow.com/questions/56063689/how-to-produce-an-infinite-binary-tree/56063738#56063738", "title": "How to produce an infinite binary tree?", "body": "<p>You can create a circular reference where both of the child nodes <strong>are</strong> the parent node.</p>\n\n<pre><code>infTree :: a -&gt; BinaryTree a\ninfTree x = tree\n  where\n    tree = BNode x tree tree\n</code></pre>\n\n<p>This is the same way the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:repeat\" rel=\"noreferrer\"><code>repeat</code></a> function is implemented:</p>\n\n<pre><code>repeat :: a -&gt; [a]\nrepeat x = xs where xs = x : xs\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 11246599, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cJXdU9dermI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdlo9h1LhUm7JilsjVFkjOOVtiVUQ/mo/photo.jpg?sz=128", "display_name": "tal", "link": "https://stackoverflow.com/users/11246599/tal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 0, "closed_date": 1557425515, "accepted_answer_id": 56063738, "answer_count": 1, "score": 1, "last_activity_date": 1557421024, "creation_date": 1557418698, "last_edit_date": 1557421024, "question_id": 56063689, "link": "https://stackoverflow.com/questions/56063689/how-to-produce-an-infinite-binary-tree", "closed_reason": "Needs more focus", "title": "How to produce an infinite binary tree?", "body": "<p>I'm asked to implement a function for the following binary tree:</p>\n\n<pre><code>data BinaryTree a = Nil | BNode a (BinaryTree a) (BinaryTree a) \n</code></pre>\n\n<p>The function I need to implement should produces a full, symmetric, infinite, binary tree of <code>a</code>'s, and should have the signature:</p>\n\n<pre><code>infTree :: a -&gt; BinaryTree a\n</code></pre>\n\n<p>How can I implement it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1557411949, "post_id": 56061474, "comment_id": 98763410, "body": "<code>&#39;0&#39;</code> and <code>&#39;1&#39;</code> are not integers. The single quotes mean treat this as a character. <code>7</code> is an integer, <code>&#39;7&#39;</code> isn&#39;t for the same reason <code>&#39;a&#39;</code> or <code>&#39;&#163;&#39;</code> isn&#39;t."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1557412360, "post_id": 56061474, "comment_id": 98763668, "body": "@Cubic No claim was made that <code>&#39;0&#39;</code> or <code>&#39;1&#39;</code> are integers."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557412420, "post_id": 56061474, "comment_id": 98763706, "body": "@DanielWagner The title is calling this a &quot;Bool to Int&quot; function"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557412448, "post_id": 56061474, "comment_id": 98763728, "body": "Hah! So it does. I&#39;ll fix it up to match the body of the question."}, {"owner": {"reputation": 101, "user_id": 10307181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/010391111deab16f5e9ee29276b22790?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/10307181/dominik"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1557412473, "post_id": 56061474, "comment_id": 98763743, "body": "@Cubic I know, I want to map every bool value to the character of it&#39;s value. (It&#39;s only an auxiliary function, I have a list of bools and want to map this list to a string which represents this list in the canonical way.) <b>EDIT:</b> Sorry, title was just a typo"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1557415616, "post_id": 56061474, "comment_id": 98765647, "body": "Be sure to search SO for the error you get (and try to post it in your question); most of these sorts of gotchas have been asked and answered before."}], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 10307181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/010391111deab16f5e9ee29276b22790?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/10307181/dominik"}, "edited": false, "score": 0, "creation_date": 1557411936, "post_id": 56061509, "comment_id": 98763397, "body": "Ok, I understand my problem. Thanks! Do you have any idea how to fix that? It&#39;s pretty obvious what these function should do..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 101, "user_id": 10307181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/010391111deab16f5e9ee29276b22790?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/10307181/dominik"}, "edited": false, "score": 11, "creation_date": 1557412028, "post_id": 56061509, "comment_id": 98763455, "body": "@Dominik Yes, I have an idea how to fix that: use a name that starts with a lower-case letter."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 11, "last_activity_date": 1557411512, "creation_date": 1557411512, "answer_id": 56061509, "question_id": 56061474, "link": "https://stackoverflow.com/questions/56061474/haskell-bool-to-char-function-seems-to-have-the-wrong-type/56061509#56061509", "title": "Haskell Bool to Char function seems to have the wrong type", "body": "<p>Variable names must start with lower-case letters (or non-<code>:</code> symbols if they are infix names), so that the compiler can easily distinguish them from constructors.</p>\n"}, {"tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": false, "score": 10, "last_activity_date": 1557411562, "last_edit_date": 1557411562, "creation_date": 1557411538, "answer_id": 56061513, "question_id": 56061474, "link": "https://stackoverflow.com/questions/56061474/haskell-bool-to-char-function-seems-to-have-the-wrong-type/56061513#56061513", "title": "Haskell Bool to Char function seems to have the wrong type", "body": "<p>Functions must start with a lowercase letter. Uppercase is treated as a data constructor.</p>\n"}], "owner": {"reputation": 101, "user_id": 10307181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/010391111deab16f5e9ee29276b22790?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik", "link": "https://stackoverflow.com/users/10307181/dominik"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "closed_date": 1557421665, "answer_count": 2, "score": -3, "last_activity_date": 1557412460, "creation_date": 1557411393, "last_edit_date": 1557412460, "question_id": 56061474, "link": "https://stackoverflow.com/questions/56061474/haskell-bool-to-char-function-seems-to-have-the-wrong-type", "closed_reason": "Duplicate", "title": "Haskell Bool to Char function seems to have the wrong type", "body": "<p>The following (very easy) code seems to have a type definition problem</p>\n\n<pre><code>BoolToChar :: Bool -&gt; Char\nBoolToChar False = '0'\nBoolToChar True = '1'\n</code></pre>\n\n<p>I don't see my mistake.</p>\n"}, {"tags": ["haskell", "time-complexity", "finger-tree"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 542, "user_id": 4440871, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/8gHuC.jpg?s=128&g=1", "display_name": "Fabian Schneider", "link": "https://stackoverflow.com/users/4440871/fabian-schneider"}, "edited": false, "score": 1, "creation_date": 1557412270, "post_id": 56061595, "comment_id": 98763597, "body": "@FabianSchneider I have deleted that comment. It was due to sloppy thinking on my part. But to answer your question anyway: &quot;space leak&quot; means keeping something in memory even though it will demonstrably not be needed later."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1557412235, "last_edit_date": 1557412235, "creation_date": 1557411791, "answer_id": 56061595, "question_id": 56061160, "link": "https://stackoverflow.com/questions/56061160/fingertree-head-complexity/56061595#56061595", "title": "Fingertree head complexity", "body": "<p>Yes, <code>head</code> and <code>head'</code> should have the same time complexity if handed to GHC. I would expect a small constant-factor difference in favor of <code>head</code> (maybe 60% confident of this -- the list fusion optimization stuff is pretty wild when it works).</p>\n"}], "owner": {"reputation": 542, "user_id": 4440871, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/8gHuC.jpg?s=128&g=1", "display_name": "Fabian Schneider", "link": "https://stackoverflow.com/users/4440871/fabian-schneider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 56061595, "answer_count": 1, "score": 2, "last_activity_date": 1557412235, "creation_date": 1557410436, "question_id": 56061160, "link": "https://stackoverflow.com/questions/56061160/fingertree-head-complexity", "title": "Fingertree head complexity", "body": "<p>I was just reading <a href=\"https://apfelmus.nfshost.com/articles/monoid-fingertree.html\" rel=\"nofollow noreferrer\">Apfelmus' excellent introduction to Finger Trees</a> for the second time and started to wonder about his implementation of head:</p>\n\n<pre><code>import Prelude hiding (head)\n\ndata Tree v a = Leaf   v a\n              | Branch v (Tree v a) (Tree v a)\n\ntoList :: Tree v a -&gt; [a]\ntoList (Leaf _ a)     = [a]\ntoList (Branch _ x y) = toList x ++ toList y\n\nhead :: Tree v a -&gt; a\nhead (Leaf _ a)     = a\nhead (Branch _ x _) = head x\n</code></pre>\n\n<p>As implementing functions in terms of one another is a quite nice way of reusing code, it got me thinking if the following implementation would be as efficient (complexity wise) as his original:</p>\n\n<pre><code>import Prelude -- not needed, just for making it obvious\ndata Tree v a = Leaf   v a\n              | Branch v (Tree v a) (Tree v a) deriving Show\n\ntoList :: Tree v a -&gt; [a]\ntoList (Leaf _ a)     = [a]\ntoList (Branch _ x y) = toList x ++ toList y\n\nhead' :: Tree v a -&gt; a\nhead' = head . toList\n</code></pre>\n\n<p>Is lazy evaluation as efficient as the original implementation?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 25, "user_id": 11475680, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6UYCnt4AXpg/AAAAAAAAAAI/AAAAAAAAADY/LrYqkp4ehfY/photo.jpg?sz=128", "display_name": "Kafai Law", "link": "https://stackoverflow.com/users/11475680/kafai-law"}, "edited": false, "score": 0, "creation_date": 1557406919, "post_id": 56060053, "comment_id": 98760439, "body": "I tried counts the number of elements in a rosetree.  roseSize x = case x of         RoseNode a [] -&gt; 0         RoseNode a (x:xs)-&gt;1 + roseSize (RoseNode a xs)"}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 1, "creation_date": 1557407395, "post_id": 56060053, "comment_id": 98760706, "body": "Where is your function? This is only a data type and a tree. Also, have you looked at Haskell&#39;s <a href=\"http://hackage.haskell.org/package/containers-0.6.0.1/docs/Data-Tree.html\" rel=\"nofollow noreferrer\"><code>Data.Tree</code></a> from the package <a href=\"http://hackage.haskell.org/package/containers\" rel=\"nofollow noreferrer\"><code>containers</code></a>? It is a rose tree."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 1, "creation_date": 1557407452, "post_id": 56060053, "comment_id": 98760728, "body": "@SimonShine An attempt was presented in the comments - I just edited it into the question."}], "answers": [{"tags": [], "owner": {"reputation": 154, "user_id": 10276432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d05baccb0bcda8ea7acf7f59c1f2145?s=128&d=identicon&r=PG&f=1", "display_name": "PF. Castro", "link": "https://stackoverflow.com/users/10276432/pf-castro"}, "is_accepted": false, "score": 4, "last_activity_date": 1557407573, "last_edit_date": 1557407573, "creation_date": 1557407418, "answer_id": 56060212, "question_id": 56060053, "link": "https://stackoverflow.com/questions/56060053/write-a-function-that-counts-the-number-of-elements-in-a-rosetree/56060212#56060212", "title": "Write a function that counts the number of elements in a rosetree", "body": "<p>You should use map and fold with RoseTrees, e.g.:</p>\n\n<pre><code>size (RoseNode x xs) = 1 + (sum (map size xs))\n</code></pre>\n\n<p>where sum is just:</p>\n\n<pre><code>sum = foldl (+) 0\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1557407931, "post_id": 56060260, "comment_id": 98761000, "body": "Testing in GHCi, this returns 26, not 27. Not sure why though."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "reply_to_user": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1557408078, "post_id": 56060260, "comment_id": 98761096, "body": "Ah, I don&#39;t know either."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1557408112, "post_id": 56060260, "comment_id": 98761119, "body": "I don&#39;t like this recursion, since <code>roseSize (RoseNode a [t1,t2,t3])</code> evaluates to <code>1 + roseSize t1 + 1 + roseSize t2 + 1 + roseSize t3</code> which looks wrong. Maybe it&#39;s correct after all, but I can&#39;t convince myself. Those extra <code>1</code>s look redundant."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1557408143, "post_id": 56060260, "comment_id": 98761140, "body": "I think actually it&#39;s because it should be <code>roseSize (RoseNode _ []) = 1</code>. I think this would also remove the <code>1+</code> from the second case, solving @chi&#39;s query as well."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1557408148, "post_id": 56060260, "comment_id": 98761145, "body": "I assume the intent is to count the number of nodes, so if nothing else the base case is wrong: <code>RoseNode _ []</code> should result in 1, not 0."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1557408284, "post_id": 56060260, "comment_id": 98761230, "body": "Also, if the base case is <code>1</code>, then the <code>1 +</code> should be removed as well from the second case. I mentioned this already but I feel it&#39;s important enough to say again."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1557408334, "post_id": 56060260, "comment_id": 98761260, "body": "Thanks, RobinZigmond and bradrn. :-)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1557409353, "post_id": 56060260, "comment_id": 98761865, "body": "The base case <i>must</i> be 1: this definition does not allow for an empty tree, so <code>roseSize</code> should never return 0. A node, however, <i>could</i> have no children, meaning the <i>sum</i> could evaluate to 0."}, {"owner": {"reputation": 25, "user_id": 11475680, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6UYCnt4AXpg/AAAAAAAAAAI/AAAAAAAAADY/LrYqkp4ehfY/photo.jpg?sz=128", "display_name": "Kafai Law", "link": "https://stackoverflow.com/users/11475680/kafai-law"}, "edited": false, "score": 0, "creation_date": 1557445700, "post_id": 56060260, "comment_id": 98777384, "body": "Your answer has illustrated my question clearly and I learn a lot from it. Thank you!!!"}, {"owner": {"reputation": 25, "user_id": 11475680, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6UYCnt4AXpg/AAAAAAAAAAI/AAAAAAAAADY/LrYqkp4ehfY/photo.jpg?sz=128", "display_name": "Kafai Law", "link": "https://stackoverflow.com/users/11475680/kafai-law"}, "edited": false, "score": 0, "creation_date": 1557451022, "post_id": 56060260, "comment_id": 98778317, "body": "I have done the roseFlatten,                                                    roseFlatten :: RoseTree a -&gt; [a] roseFlatten tree = case tree of   RoseNode x []-&gt; [x]   RoseNode a (x:xs) -&gt; (roseFlatten x) ++ (roseFlatten (RoseNode a xs))"}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "reply_to_user": {"reputation": 25, "user_id": 11475680, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6UYCnt4AXpg/AAAAAAAAAAI/AAAAAAAAADY/LrYqkp4ehfY/photo.jpg?sz=128", "display_name": "Kafai Law", "link": "https://stackoverflow.com/users/11475680/kafai-law"}, "edited": false, "score": 0, "creation_date": 1557470432, "post_id": 56060260, "comment_id": 98782869, "body": "@KafaiLaw: <code>Data.Tree</code> already has <a href=\"http://hackage.haskell.org/package/containers-0.6.0.1/docs/Data-Tree.html#v:flatten\" rel=\"nofollow noreferrer\"><code>flatten</code></a>. When you flatten a tree, you don&#39;t differentiate between leaf nodes and other nodes."}], "tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": true, "score": 6, "last_activity_date": 1557412725, "last_edit_date": 1592644375, "creation_date": 1557407633, "answer_id": 56060260, "question_id": 56060053, "link": "https://stackoverflow.com/questions/56060053/write-a-function-that-counts-the-number-of-elements-in-a-rosetree/56060260#56060260", "title": "Write a function that counts the number of elements in a rosetree", "body": "<blockquote>\n<p>It should be 27, however, it returns 4.</p>\n<pre><code>roseSize x = case x of\n  RoseNode a [] -&gt; 0\n  RoseNode a (x:xs) -&gt; 1 + roseSize (RoseNode a xs)\n</code></pre>\n</blockquote>\n<p>So you're not counting the sub-trees recursively. Try instead (<em>fixed: base case to <code>1</code></em>),</p>\n<pre><code>roseSize (RoseNode _ []) = 1\nroseSize (RoseNode a (t:ts)) = roseSize t + roseSize (RoseNode a ts)\n</code></pre>\n<p>The missing part is <code>roseSize t</code>.</p>\n<p>Otherwise you're only making recursive calls for the first layer of the tree.</p>\n<p>If you evaluate your function by hand this becomes apparent,</p>\n<pre><code>roseSize things\n  ~&gt; roseSize (RoseNode &quot;thing&quot; [ animals, metals, fruits, astronomical_objects ]\n  ~&gt; 1 + roseSize (RoseNode &quot;thing&quot; [ metals, fruits, astronomical_objects ])\n  ~&gt; 1 + 1 + roseSize (RoseNode &quot;thing&quot; [ fruits, astronomical_objects ])\n  ~&gt; 1 + 1 + 1 + roseSize (RoseNode &quot;thing&quot; [ astronomical_objects ])\n  ~&gt; 1 + 1 + 1 + 1 + roseSize (RoseNode &quot;thing&quot; [])\n  ~&gt; 1 + 1 + 1 + 1 + 0\n</code></pre>\n<p>whereas with <code>roseSize t</code> in the function body the evaluation becomes</p>\n<pre><code>roseSize things\n  ~&gt; roseSize (RoseNode &quot;thing&quot; [ animals, metals, fruits, astronomical_objects ]\n  ~&gt; roseSize animals\n      + roseSize (RoseNode &quot;thing&quot; [ metals, fruits, astronomical_objects ])\n  ~&gt; roseSize (RoseNode &quot;animal&quot; [ cat, dog ])\n      + roseSize (RoseNode &quot;thing&quot; [ metals, fruits, astronomical_objects ])\n  ~&gt; roseSize cat\n      + roseSize (RoseNode &quot;animal&quot; [ dog ])\n      + roseSize (RoseNode &quot;thing&quot; [ metals, fruits, astronomical_objects ])\n  ~&gt; 1 -- given the base case of 1 instead of 0\n      + roseSize (RoseNode &quot;animal&quot; [ dog ])\n      + roseSize (RoseNode &quot;thing&quot; [ metals, fruits, astronomical_objects ])\n  ~&gt; ...\n</code></pre>\n<hr />\n<p>As an exercise, making this function explicitly recursive is fine.</p>\n<p>But you may want to consider a more general approach, either using higher-order functions <a href=\"https://stackoverflow.com/a/56060212/235908\">like PF. Castro does it</a>, or an existing data structure like <a href=\"http://hackage.haskell.org/package/containers/docs/Data-Tree.html\" rel=\"nofollow noreferrer\"><code>Data.Tree</code></a> of <a href=\"http://hackage.haskell.org/package/containers\" rel=\"nofollow noreferrer\"><code>containers</code></a>:</p>\n<pre><code>import qualified Data.Tree as T\nimport           Data.Tree (Tree(..))\n\nthings :: Tree String\nthings = Node &quot;thing&quot; [ animals, metals, fruits, astronomical_objects ]\n  where\n    animals = Node &quot;animal&quot; (map pure [ &quot;cat&quot;, &quot;dog&quot; ])\n    metals = Node &quot;metal&quot; [ alloys, elements ]\n    alloys = Node &quot;alloy&quot; (map pure [ &quot;steel&quot;, &quot;bronze&quot; ])\n    elements = Node &quot;element&quot; (map pure [ &quot;gold&quot;, &quot;tin&quot;, &quot;iron&quot; ])\n    fruits = ...\n    astronomical_objects = ...\n</code></pre>\n<p>Since a <code>Data.Tree</code> is <code>Foldable</code>, you can use <code>length</code> on it.</p>\n<p>So it's not necessary to define a custom <code>roseSize</code> function.</p>\n<hr />\n<p>At this point you're counting the <em>nodes</em> in a tree, and not the <em>leaves</em> of a tree, with <em>leaves</em> being the actual objects rather than the <em>categories</em> to which they belong. So you may actually be interested in counting the <em>leaves</em>.</p>\n<p>You could do that by creating a function that finds the leaves:</p>\n<pre><code>leaves :: Tree a -&gt; [a]\nleaves (Node x []) = ... -- x is a leaf\nleaves (Node _x ts) = ... -- _x isn't a leaf\n</code></pre>\n<p>With this template you can't easily use explicit recursion, i.e. matching on <code>Node x (t:ts)</code> and calling <code>leaves</code> on <code>ts</code>, since then the non-leaf case eventually ends in the base case, making the exhausted category appear as a leaf. But you can use higher-order functions to abstract out the recursion, e.g. <code>concat</code>, <code>map</code>, or <code>concatMap</code> of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#g:13\" rel=\"nofollow noreferrer\"><code>Prelude</code></a>.</p>\n<hr />\n<p>Using a library rose tree gives you other advantages, too, for example a bunch of other type class instances (<code>Applicative</code> giving you <code>pure &quot;foo&quot;</code> to construct a singleton tree / leaf) and a pretty-printing function:</p>\n<pre><code>&gt; putStrLn $ T.drawTree things\nthing\n|\n+- animal\n|  |\n|  +- cat\n|  |\n|  `- dog\n|\n`- metal\n   |\n   +- alloy\n   |  |\n   |  +- steel\n   |  |\n   |  `- bronze\n   |\n   ...\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 11475680, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6UYCnt4AXpg/AAAAAAAAAAI/AAAAAAAAADY/LrYqkp4ehfY/photo.jpg?sz=128", "display_name": "Kafai Law", "link": "https://stackoverflow.com/users/11475680/kafai-law"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 580, "favorite_count": 0, "accepted_answer_id": 56060260, "answer_count": 2, "score": -1, "last_activity_date": 1557412725, "creation_date": 1557406893, "last_edit_date": 1557407389, "question_id": 56060053, "link": "https://stackoverflow.com/questions/56060053/write-a-function-that-counts-the-number-of-elements-in-a-rosetree", "title": "Write a function that counts the number of elements in a rosetree", "body": "<p>Write a function\nthat counts the number of elements in a rosetree.</p>\n\n<p>I tried counts the number of elements in a rosetree.</p>\n\n<pre><code>data RoseTree a = RoseNode a [RoseTree a]\n    deriving Show\nthings :: RoseTree String\nthings = \n    RoseNode \"thing\" [\n        RoseNode \"animal\" [\n            RoseNode \"cat\" [], RoseNode \"dog\" []\n        ],\n\n        RoseNode \"metal\" [\n            RoseNode \"alloy\" [\n                RoseNode \"steel\" [], RoseNode \"bronze\" []\n            ],\n            RoseNode \"element\" [\n                RoseNode \"gold\" [], RoseNode \"tin\" [], RoseNode \"iron\" []\n            ]\n        ],\n\n        RoseNode \"fruit\" [\n            RoseNode \"apple\" [\n                RoseNode \"Granny Smith\" [], RoseNode \"Pink Lady\" []\n            ],\n            RoseNode \"banana\" [],\n            RoseNode \"orange\" []\n        ],\n\n        RoseNode \"astronomical object\" [\n            RoseNode \"Planet\" [\n                RoseNode \"Earth\" [], RoseNode \"Mars\" []\n            ],\n            RoseNode \"Star\" [\n                RoseNode \"The Sun\" [], RoseNode \"Sirius\" []\n            ],\n            RoseNode \"Galaxy\" [\n                RoseNode \"Milky Way\" []\n            ]\n        ]\n    ] \n</code></pre>\n\n<p>It should be 27, however, it returns 4.</p>\n\n<p><strong>EDIT:</strong> Here is my attempt:</p>\n\n<pre><code>roseSize x = case x of\n    RoseNode a [] -&gt; 0\n    RoseNode a (x:xs) -&gt; 1 + roseSize (RoseNode a xs)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1557394270, "post_id": 56055988, "comment_id": 98753367, "body": "Surely it depends on what you want to achieve? If you think having a total function would make your code better, go for it."}, {"owner": {"reputation": 1610, "user_id": 11257715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7ef71a9bfa4abd30cb98cbb290b909?s=128&d=identicon&r=PG", "display_name": "moonGoose", "link": "https://stackoverflow.com/users/11257715/moongoose"}, "edited": false, "score": 6, "creation_date": 1557394446, "post_id": 56055988, "comment_id": 98753473, "body": "I think it depends on who you&#39;re expecting to use the library and what for? Though consensus seems to favour total functions. How about <code>NonEmpty a -&gt; InfList a</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1557404722, "post_id": 56057792, "comment_id": 98759155, "body": "What&#39;s so incredibly gross about fromJust?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1557406013, "post_id": 56057792, "comment_id": 98759930, "body": "Expecting <code>fromJust</code> to succeed implies that <code>Maybe</code> wasn&#39;t necessary in the first place. The purpose of <code>Maybe</code> is to encode the possibility of failure, and <code>fromJust</code> (which is equivalent to <code>fromMaybe undefined</code>) just sweeps that possibility under the rug."}, {"owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "edited": false, "score": 1, "creation_date": 1557409665, "post_id": 56057792, "comment_id": 98762026, "body": "Exactly. It is useful when you want to test some code that you are sure will return <code>Just</code>, but when I see it on production I am always suspicious whether it is conceptually proper. I saw once project where <code>fromJust</code> was banned and one had to use <code>fromJustNote :: String -&gt; Maybe a -&gt; a</code> that required justification of its use"}], "tags": [], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "is_accepted": true, "score": 4, "last_activity_date": 1557399160, "creation_date": 1557399160, "answer_id": 56057792, "question_id": 56055988, "link": "https://stackoverflow.com/questions/56055988/is-there-a-consensus-on-whether-or-not-newly-defined-utility-functions-should-be/56057792#56057792", "title": "Is there a consensus on whether or not newly defined utility functions should be partial?", "body": "<p>There is no general convention for this. You may provide both versions to let user choose who is responsible for handling possible errors caused by out-of-domain arguments.</p>\n\n<p>Take a look at <a href=\"https://hackage.haskell.org/package/semigroups-0.8/docs/Data-List-NonEmpty.html#v:fromList\" rel=\"nofollow noreferrer\">list to non-empty list conversion</a>. The author provides two constructing functions: <code>fromList</code> that assumes the list on input is non-empty, and <code>nonEmpty</code> that returns <code>Maybe</code>. In your case I would name them for example <code>fromCycle</code> and <code>cyclicInfList</code> respectively to match that convention.</p>\n\n<p>Sometimes it is hard to tell which implementation will be more accurate. In some cases the user may like to have control over it, but sometimes he is sure that argument is correct which would lead to abominations like use of <code>fromJust</code> (gross). In my opinion the most diplomatic way is to provide both definitions and move your dilemma to the next programmer. </p>\n"}], "owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "closed_date": 1557420087, "accepted_answer_id": 56057792, "answer_count": 1, "score": 2, "last_activity_date": 1557399160, "creation_date": 1557393004, "last_edit_date": 1557395187, "question_id": 56055988, "link": "https://stackoverflow.com/questions/56055988/is-there-a-consensus-on-whether-or-not-newly-defined-utility-functions-should-be", "closed_reason": "Opinion-based", "title": "Is there a consensus on whether or not newly defined utility functions should be partial?", "body": "<p>For example, many functions in <code>Data.List</code> are partial, such as <code>(cycle, (!!), init, tail, head, last)</code>. I'm currently writing a module which defines a type similar to lists, namely, infinite lists. This of course avoids certain partiality problems, but doesn't solve, for example, <code>cycle</code>.</p>\n\n<p>The dilemma I'm faced with now is the following:<br>\nDo I implement a safer version of <code>cycle :: [a] -&gt; Maybe (InfList a)</code>,<br>\nor do I implement a more useful, less safe, more <code>base</code>-like function?</p>\n\n<p>Is there any consensus on this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557411440, "post_id": 56053177, "comment_id": 98763092, "body": "Does <code>getURL</code> make any FFI-based calls?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1557423330, "post_id": 56053177, "comment_id": 98769482, "body": "@jberryman, I&#39;m not sure you&#39;re right about that. The non-threaded IO subsystem has a bit of edge-case wonkiness where it&#39;s not quite right and probably can&#39;t be. I don&#39;t remember where that is."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1557423926, "post_id": 56053177, "comment_id": 98769746, "body": "@jberryman GHC does <i>not</i> use pre-emptive multitasking. With some care, you can write pure Haskell code (not even <code>IO</code> is required!) which blocks all other threads on the same capability. It is cooperative, with yields happening at memory allocation by default (this is almost always often enough) or at every function call if you turn on <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/using-optimisation.html#ghc-flag--fomit-yields\" rel=\"nofollow noreferrer\"><code>-fno-omit-yields</code></a>. This is true of both the threaded and non-threaded runtime. <a href=\"https://stackoverflow.com/q/55336948/791604\">See also.</a>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557429417, "post_id": 56053177, "comment_id": 98772220, "body": "(erroneously deleted my comment, sorry!). @DanielWagner appreciate that point, but it seems to me it&#39;s debatable what to actually call GHC&#39;s model. In practice it feels and users expect it to behave as preemptive (albeit with a slightly sketchy implementation). That the compiler inserts yields at particular points to obtain (approximate) time-slicing is an implementation detail don&#39;t you think?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1557435757, "post_id": 56053177, "comment_id": 98774763, "body": "@jberryman Thinking of it abstractly as pre-emptive is a nice abstraction right up to the moment that the abstraction leaks. Then all of a sudden your tight, non-allocating loop is a bug instead of a feature, and your unsafe FFI call makes your program slower instead of faster."}], "answers": [{"tags": [], "owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "is_accepted": false, "score": 8, "last_activity_date": 1557422728, "last_edit_date": 1557422728, "creation_date": 1557385844, "answer_id": 56053987, "question_id": 56053177, "link": "https://stackoverflow.com/questions/56053177/do-io-operations-run-in-green-threads/56053987#56053987", "title": "Do IO operations run in green threads?", "body": "<p>From the documentation of <a href=\"http://hackage.haskell.org/package/async-2.2.1/docs/Control-Concurrent-Async.html\" rel=\"nofollow noreferrer\">Control.Concurrent.Async</a></p>\n\n<blockquote>\n  <p>This module provides a set of operations for running IO operations asynchronously and waiting for their results. It is a thin layer over the basic concurrency operations provided by Control.Concurrent. </p>\n</blockquote>\n\n<p>and <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Concurrent.html\" rel=\"nofollow noreferrer\">Control.Concurrent</a></p>\n\n<blockquote>\n  <p>Scheduling of Haskell threads is done internally in the Haskell runtime system, and doesn't make use of any operating system-supplied thread packages.</p>\n</blockquote>\n\n<p>This last may be a bit misleading if not interpreted carefully: although the <em>scheduling</em> of Haskell threads -- that is, the choice of which Haskell code to run next -- is done without using any OS facilities, GHC can and does use multiple OS threads to actually execute whatever code is chosen to be run, at least when using the threaded runtime system.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557411127, "post_id": 56057107, "comment_id": 98762910, "body": "Even with the threaded runtime, the default is one OS thread, not multiple. You have to explicitly ask for more threads, either via RTS options or programmatically."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557412086, "post_id": 56057107, "comment_id": 98763482, "body": "@DanielWagner I thought they changed the default to be one per CPU core (because people were confused by the default being only one thread)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1557412196, "post_id": 56057107, "comment_id": 98763546, "body": "Oh, hm. It doesn&#39;t seem to be that way in 8.4.3. I don&#39;t have an 8.6.* to check on at the moment, though none of the 8.6.* release notes mention the word &quot;thread&quot; anywhere."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1557412275, "post_id": 56057107, "comment_id": 98763604, "body": "Also, there&#39;s the FFI thread pool to consider, which isn&#39;t counted by the <code>-N</code> argument."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 3, "last_activity_date": 1557396653, "creation_date": 1557396653, "answer_id": 56057107, "question_id": 56053177, "link": "https://stackoverflow.com/questions/56053177/do-io-operations-run-in-green-threads/56057107#56057107", "title": "Do IO operations run in green threads?", "body": "<p>It should all be green threads.</p>\n\n<p>If your program is compiled (or rather, linked) with the single-threaded RTS, then all green threads run in a single OS thread. If your program is compiled (linked) with the multi-threaded RTS, then some arbitrary number of green threads are scheduled across (by default) one OS thread per CPU core.</p>\n\n<p>As far as I'm aware, in <em>either case</em> blocking I/O calls should only block one green thread. Other green threads should be completely unaffected.</p>\n"}, {"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 1, "last_activity_date": 1557412374, "last_edit_date": 1557412374, "creation_date": 1557411115, "answer_id": 56061389, "question_id": 56053177, "link": "https://stackoverflow.com/questions/56053177/do-io-operations-run-in-green-threads/56061389#56061389", "title": "Do IO operations run in green threads?", "body": "<p>This isn't as simple as the question seems to imply.  Haskell is a more capable programming language than most you would have run into.  In particular, <code>IO</code> operations that appear to block from an internal point of view may be implemented as the sequence \"start non-blocking IO operation, suspend thread, wait for that IO operation to complete in an IO manager that covers multiple Haskell threads, queue thread for resumption once the IO device is ready.\"</p>\n\n<p>See <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Exts.html#v:waitRead-35-\" rel=\"nofollow noreferrer\">waitRead#</a> and <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Exts.html#v:waitWrite-35-\" rel=\"nofollow noreferrer\">waitWrite#</a> for the api that provides that functionality with the standard global IO manager.</p>\n\n<p>Using green threads or not is mostly irrelevant with this pattern. IO operations can be written to use non-blocking IO behind the scenes, with proper multiplexing, while appearing to present a blocking interface to their users.</p>\n\n<p>Unfortunately, it's not that simple either.  The fact is that OS limitations get in the way.  Until very recently (I think the 5.1 kernel was released yesterday, maybe?), Linux has provided no good interface for non-blocking disk operations.  Sure there were things that looked like they should work, but in practice they weren't very good.  So disk reads/writes are actual blocking operations in GHC.  (Not just on linux, either. GHC doesn't have a lot of developers supporting it, so a lot of things are written with the same code that works on linux, even if there are other alternatives.)</p>\n\n<p>But it's not even as simple as \"network operations are hidden non-blocking, disk operations are blocking\".  At least maybe not.  I don't actually know, because it's so hard to find documentation on the non-threaded runtime.  I know the threaded runtime actually maintains a separate thread pool for performing FFI calls marked as \"safe\", which prevents them from blocking execution of green threads.  I don't know if the same is true with the non-threaded runtime.</p>\n\n<p>But for your example, I can say - assuming <code>getURL</code> uses the standard network library (it's a hypothetical function anyway), it'll be doing non-blocking IO with proper multiplexing behind the scenes.  So those operations will be truly concurrent, even without the threaded runtime.</p>\n"}], "owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1557422728, "creation_date": 1557382216, "last_edit_date": 1557382927, "question_id": 56053177, "link": "https://stackoverflow.com/questions/56053177/do-io-operations-run-in-green-threads", "title": "Do IO operations run in green threads?", "body": "<p>Given the example from <a href=\"http://hackage.haskell.org/package/async-2.2.1/docs/Control-Concurrent-Async.html\" rel=\"nofollow noreferrer\">Control.Concurrent.Async</a>:</p>\n\n<pre><code>do a1 &lt;- async (getURL url1)\n  a2 &lt;- async (getURL url2)\n  page1 &lt;- wait a1\n  page2 &lt;- wait a2\n</code></pre>\n\n<p>Do the two <code>getURL</code> calls run on different OS threads, or just different green threads? </p>\n\n<p>In case my question doesn't make sense... say the program is running on one OS thread only, will these calls still be made at the same time? Do blocking IO operations block the whole OS thread and all the green threads on that OS thread, or just one green thread?</p>\n"}]